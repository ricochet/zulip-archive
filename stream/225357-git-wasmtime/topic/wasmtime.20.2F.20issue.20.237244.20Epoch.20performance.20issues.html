<html>
<head><meta charset="utf-8"><title>wasmtime / issue #7244 Epoch performance issues · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237244.20Epoch.20performance.20issues.html">wasmtime / issue #7244 Epoch performance issues</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="396760359"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237244%20Epoch%20performance%20issues/near/396760359" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237244.20Epoch.20performance.20issues.html#396760359">(Oct 15 2023 at 14:51)</a>:</h4>
<p>wjr-z opened <a href="https://github.com/bytecodealliance/wasmtime/issues/7244">issue #7244</a>:</p>
<blockquote>
<p>At present, there seem to be serious issues with the epoch mechanism and register usage。<br>
For example, the following is a simple comparison of native and epoch assemblies for a double loop</p>
<p>wasmtiem release-13.0.0</p>
<p>native :</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">       </span><span class="mi">0</span>:   <span class="mi">55</span><span class="w">                      </span><span class="n">push</span><span class="w">   </span><span class="o">%</span><span class="n">rbp</span>
<span class="w">       </span><span class="mi">1</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">89</span><span class="w"> </span><span class="n">e5</span><span class="w">                </span><span class="n">mov</span><span class="w">    </span><span class="o">%</span><span class="n">rsp</span><span class="p">,</span><span class="o">%</span><span class="n">rbp</span>
<span class="w">       </span><span class="mi">4</span>:   <span class="mi">4</span><span class="n">c</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">57</span><span class="w"> </span><span class="mi">08</span><span class="w">             </span><span class="n">mov</span><span class="w">    </span><span class="mh">0x8</span><span class="p">(</span><span class="o">%</span><span class="n">rdi</span><span class="p">),</span><span class="o">%</span><span class="n">r10</span>
<span class="w">       </span><span class="mi">8</span>:   <span class="mi">4</span><span class="n">d</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">12</span><span class="w">                </span><span class="n">mov</span><span class="w">    </span><span class="p">(</span><span class="o">%</span><span class="n">r10</span><span class="p">),</span><span class="o">%</span><span class="n">r10</span>
<span class="w">       </span><span class="n">b</span>:   <span class="mi">49</span><span class="w"> </span><span class="mi">39</span><span class="w"> </span><span class="n">e2</span><span class="w">                </span><span class="n">cmp</span><span class="w">    </span><span class="o">%</span><span class="n">rsp</span><span class="p">,</span><span class="o">%</span><span class="n">r10</span>
<span class="w">       </span><span class="n">e</span>:   <span class="mi">0</span><span class="n">f</span><span class="w"> </span><span class="mi">87</span><span class="w"> </span><span class="mi">2</span><span class="n">a</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">       </span><span class="n">ja</span><span class="w">     </span><span class="mi">3</span><span class="n">e</span><span class="w"> </span><span class="o">&lt;</span><span class="n">wasm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>::<span class="n">function</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mh">0x3e</span><span class="o">&gt;</span>
<span class="w">      </span><span class="mi">14</span>:   <span class="mi">31</span><span class="w"> </span><span class="n">c9</span><span class="w">                   </span><span class="n">xor</span><span class="w">    </span><span class="o">%</span><span class="n">ecx</span><span class="p">,</span><span class="o">%</span><span class="n">ecx</span>
<span class="w">      </span><span class="mi">16</span>:   <span class="mi">45</span><span class="w"> </span><span class="mi">31</span><span class="w"> </span><span class="n">c9</span><span class="w">                </span><span class="n">xor</span><span class="w">    </span><span class="o">%</span><span class="n">r9d</span><span class="p">,</span><span class="o">%</span><span class="n">r9d</span>
<span class="w">      </span><span class="mi">19</span>:   <span class="mi">41</span><span class="w"> </span><span class="mi">83</span><span class="w"> </span><span class="n">c1</span><span class="w"> </span><span class="mi">01</span><span class="w">             </span><span class="n">add</span><span class="w">    </span><span class="cp">$</span><span class="mh">0x1</span><span class="p">,</span><span class="o">%</span><span class="n">r9d</span>
<span class="w">      </span><span class="mi">1</span><span class="n">d</span>:   <span class="mi">41</span><span class="w"> </span><span class="mi">81</span><span class="w"> </span><span class="n">f9</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">12</span><span class="w"> </span><span class="mi">7</span><span class="n">a</span><span class="w"> </span><span class="mi">00</span><span class="w">    </span><span class="n">cmp</span><span class="w">    </span><span class="cp">$</span><span class="mh">0x7a1200</span><span class="p">,</span><span class="o">%</span><span class="n">r9d</span>
<span class="w">      </span><span class="mi">24</span>:   <span class="mi">0</span><span class="n">f</span><span class="w"> </span><span class="mi">8</span><span class="n">c</span><span class="w"> </span><span class="n">ef</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w">       </span><span class="n">jl</span><span class="w">     </span><span class="mi">19</span><span class="w"> </span><span class="o">&lt;</span><span class="n">wasm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>::<span class="n">function</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mh">0x19</span><span class="o">&gt;</span>
<span class="w">      </span><span class="mi">2</span><span class="n">a</span>:   <span class="mi">83</span><span class="w"> </span><span class="n">c1</span><span class="w"> </span><span class="mi">01</span><span class="w">                </span><span class="n">add</span><span class="w">    </span><span class="cp">$</span><span class="mh">0x1</span><span class="p">,</span><span class="o">%</span><span class="n">ecx</span>
<span class="w">      </span><span class="mi">2</span><span class="n">d</span>:   <span class="mi">81</span><span class="w"> </span><span class="n">f9</span><span class="w"> </span><span class="mi">40</span><span class="w"> </span><span class="mi">9</span><span class="n">c</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">       </span><span class="n">cmp</span><span class="w">    </span><span class="cp">$</span><span class="mh">0x9c40</span><span class="p">,</span><span class="o">%</span><span class="n">ecx</span>
<span class="w">      </span><span class="mi">33</span>:   <span class="mi">0</span><span class="n">f</span><span class="w"> </span><span class="mi">8</span><span class="n">c</span><span class="w"> </span><span class="n">dd</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w">       </span><span class="n">jl</span><span class="w">     </span><span class="mi">16</span><span class="w"> </span><span class="o">&lt;</span><span class="n">wasm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>::<span class="n">function</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mh">0x16</span><span class="o">&gt;</span>
<span class="w">      </span><span class="mi">39</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">89</span><span class="w"> </span><span class="n">ec</span><span class="w">                </span><span class="n">mov</span><span class="w">    </span><span class="o">%</span><span class="n">rbp</span><span class="p">,</span><span class="o">%</span><span class="n">rsp</span>
<span class="w">      </span><span class="mi">3</span><span class="n">c</span>:   <span class="mi">5</span><span class="n">d</span><span class="w">                      </span><span class="n">pop</span><span class="w">    </span><span class="o">%</span><span class="n">rbp</span>
<span class="w">      </span><span class="mi">3</span><span class="n">d</span>:   <span class="nc">c3</span><span class="w">                      </span><span class="n">retq</span>
<span class="w">      </span><span class="mi">3</span><span class="n">e</span>:   <span class="mi">0</span><span class="n">f</span><span class="w"> </span><span class="mi">0</span><span class="n">b</span><span class="w">                   </span><span class="n">ud2</span>
</code></pre></div>
<p>epoch :</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">       </span><span class="mi">0</span>:   <span class="mi">55</span><span class="w">                      </span><span class="n">push</span><span class="w">   </span><span class="o">%</span><span class="n">rbp</span>
<span class="w">       </span><span class="mi">1</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">89</span><span class="w"> </span><span class="n">e5</span><span class="w">                </span><span class="n">mov</span><span class="w">    </span><span class="o">%</span><span class="n">rsp</span><span class="p">,</span><span class="o">%</span><span class="n">rbp</span>
<span class="w">       </span><span class="mi">4</span>:   <span class="mi">4</span><span class="n">c</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">57</span><span class="w"> </span><span class="mi">08</span><span class="w">             </span><span class="n">mov</span><span class="w">    </span><span class="mh">0x8</span><span class="p">(</span><span class="o">%</span><span class="n">rdi</span><span class="p">),</span><span class="o">%</span><span class="n">r10</span>
<span class="w">       </span><span class="mi">8</span>:   <span class="mi">4</span><span class="n">d</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">12</span><span class="w">                </span><span class="n">mov</span><span class="w">    </span><span class="p">(</span><span class="o">%</span><span class="n">r10</span><span class="p">),</span><span class="o">%</span><span class="n">r10</span>
<span class="w">       </span><span class="n">b</span>:   <span class="mi">49</span><span class="w"> </span><span class="mi">39</span><span class="w"> </span><span class="n">e2</span><span class="w">                </span><span class="n">cmp</span><span class="w">    </span><span class="o">%</span><span class="n">rsp</span><span class="p">,</span><span class="o">%</span><span class="n">r10</span>
<span class="w">       </span><span class="n">e</span>:   <span class="mi">0</span><span class="n">f</span><span class="w"> </span><span class="mi">87</span><span class="w"> </span><span class="mi">04</span><span class="w"> </span><span class="mi">01</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">       </span><span class="n">ja</span><span class="w">     </span><span class="mi">118</span><span class="w"> </span><span class="o">&lt;</span><span class="n">wasm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>::<span class="n">function</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mh">0x118</span><span class="o">&gt;</span>
<span class="w">      </span><span class="mi">14</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">83</span><span class="w"> </span><span class="n">ec</span><span class="w"> </span><span class="mi">20</span><span class="w">             </span><span class="n">sub</span><span class="w">    </span><span class="cp">$</span><span class="mh">0x20</span><span class="p">,</span><span class="o">%</span><span class="n">rsp</span>
<span class="w">      </span><span class="mi">18</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">89</span><span class="w"> </span><span class="mi">1</span><span class="n">c</span><span class="w"> </span><span class="mi">24</span><span class="w">             </span><span class="n">mov</span><span class="w">    </span><span class="o">%</span><span class="n">rbx</span><span class="p">,(</span><span class="o">%</span><span class="n">rsp</span><span class="p">)</span>
<span class="w">      </span><span class="mi">1</span><span class="n">c</span>:   <span class="mi">4</span><span class="n">c</span><span class="w"> </span><span class="mi">89</span><span class="w"> </span><span class="mi">6</span><span class="n">c</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="mi">08</span><span class="w">          </span><span class="n">mov</span><span class="w">    </span><span class="o">%</span><span class="n">r13</span><span class="p">,</span><span class="mh">0x8</span><span class="p">(</span><span class="o">%</span><span class="n">rsp</span><span class="p">)</span>
<span class="w">      </span><span class="mi">21</span>:   <span class="mi">4</span><span class="n">c</span><span class="w"> </span><span class="mi">89</span><span class="w"> </span><span class="mi">7</span><span class="n">c</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="mi">10</span><span class="w">          </span><span class="n">mov</span><span class="w">    </span><span class="o">%</span><span class="n">r15</span><span class="p">,</span><span class="mh">0x10</span><span class="p">(</span><span class="o">%</span><span class="n">rsp</span><span class="p">)</span>
<span class="w">      </span><span class="mi">26</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">77</span><span class="w"> </span><span class="mi">08</span><span class="w">             </span><span class="n">mov</span><span class="w">    </span><span class="mh">0x8</span><span class="p">(</span><span class="o">%</span><span class="n">rdi</span><span class="p">),</span><span class="o">%</span><span class="n">rsi</span>
<span class="w">      </span><span class="mi">2</span><span class="n">a</span>:   <span class="mi">4</span><span class="n">c</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">4</span><span class="n">e</span><span class="w"> </span><span class="mi">10</span><span class="w">             </span><span class="n">mov</span><span class="w">    </span><span class="mh">0x10</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">),</span><span class="o">%</span><span class="n">r9</span>
<span class="w">      </span><span class="mi">2</span><span class="n">e</span>:   <span class="mi">4</span><span class="n">c</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">6</span><span class="n">f</span><span class="w"> </span><span class="mi">18</span><span class="w">             </span><span class="n">mov</span><span class="w">    </span><span class="mh">0x18</span><span class="p">(</span><span class="o">%</span><span class="n">rdi</span><span class="p">),</span><span class="o">%</span><span class="n">r13</span>
<span class="w">      </span><span class="mi">32</span>:   <span class="mi">4</span><span class="n">d</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">55</span><span class="w"> </span><span class="mi">00</span><span class="w">             </span><span class="n">mov</span><span class="w">    </span><span class="mh">0x0</span><span class="p">(</span><span class="o">%</span><span class="n">r13</span><span class="p">),</span><span class="o">%</span><span class="n">r10</span>
<span class="w">      </span><span class="mi">36</span>:   <span class="mi">4</span><span class="n">d</span><span class="w"> </span><span class="mi">39</span><span class="w"> </span><span class="n">ca</span><span class="w">                </span><span class="n">cmp</span><span class="w">    </span><span class="o">%</span><span class="n">r9</span><span class="p">,</span><span class="o">%</span><span class="n">r10</span>
<span class="w">      </span><span class="mi">39</span>:   <span class="mi">0</span><span class="n">f</span><span class="w"> </span><span class="mi">83</span><span class="w"> </span><span class="mi">56</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">       </span><span class="n">jae</span><span class="w">    </span><span class="mi">95</span><span class="w"> </span><span class="o">&lt;</span><span class="n">wasm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>::<span class="n">function</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mh">0x95</span><span class="o">&gt;</span>
<span class="w">      </span><span class="mi">3</span><span class="n">f</span>:   <span class="mi">45</span><span class="w"> </span><span class="mi">31</span><span class="w"> </span><span class="n">ff</span><span class="w">                </span><span class="n">xor</span><span class="w">    </span><span class="o">%</span><span class="n">r15d</span><span class="p">,</span><span class="o">%</span><span class="n">r15d</span>
<span class="w">      </span><span class="mi">42</span>:   <span class="mi">4</span><span class="n">d</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">55</span><span class="w"> </span><span class="mi">00</span><span class="w">             </span><span class="n">mov</span><span class="w">    </span><span class="mh">0x0</span><span class="p">(</span><span class="o">%</span><span class="n">r13</span><span class="p">),</span><span class="o">%</span><span class="n">r10</span>
<span class="w">      </span><span class="mi">46</span>:   <span class="mi">4</span><span class="n">d</span><span class="w"> </span><span class="mi">39</span><span class="w"> </span><span class="n">ca</span><span class="w">                </span><span class="n">cmp</span><span class="w">    </span><span class="o">%</span><span class="n">r9</span><span class="p">,</span><span class="o">%</span><span class="n">r10</span>
<span class="w">      </span><span class="mi">49</span>:   <span class="mi">0</span><span class="n">f</span><span class="w"> </span><span class="mi">83</span><span class="w"> </span><span class="mi">6</span><span class="n">f</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">       </span><span class="n">jae</span><span class="w">    </span><span class="n">be</span><span class="w"> </span><span class="o">&lt;</span><span class="n">wasm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>::<span class="n">function</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mh">0xbe</span><span class="o">&gt;</span>
<span class="w">      </span><span class="mi">4</span><span class="n">f</span>:   <span class="mi">31</span><span class="w"> </span><span class="n">db</span><span class="w">                   </span><span class="n">xor</span><span class="w">    </span><span class="o">%</span><span class="n">ebx</span><span class="p">,</span><span class="o">%</span><span class="n">ebx</span>
<span class="w">      </span><span class="mi">51</span>:   <span class="mi">4</span><span class="n">d</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">5</span><span class="n">d</span><span class="w"> </span><span class="mi">00</span><span class="w">             </span><span class="n">mov</span><span class="w">    </span><span class="mh">0x0</span><span class="p">(</span><span class="o">%</span><span class="n">r13</span><span class="p">),</span><span class="o">%</span><span class="n">r11</span>
<span class="w">      </span><span class="mi">55</span>:   <span class="mi">4</span><span class="n">d</span><span class="w"> </span><span class="mi">39</span><span class="w"> </span><span class="n">cb</span><span class="w">                </span><span class="n">cmp</span><span class="w">    </span><span class="o">%</span><span class="n">r9</span><span class="p">,</span><span class="o">%</span><span class="n">r11</span>
<span class="w">      </span><span class="mi">58</span>:   <span class="mi">0</span><span class="n">f</span><span class="w"> </span><span class="mi">83</span><span class="w"> </span><span class="mi">8</span><span class="n">d</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">       </span><span class="n">jae</span><span class="w">    </span><span class="n">eb</span><span class="w"> </span><span class="o">&lt;</span><span class="n">wasm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>::<span class="n">function</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mh">0xeb</span><span class="o">&gt;</span>
<span class="w">      </span><span class="mi">5</span><span class="n">e</span>:   <span class="mi">83</span><span class="w"> </span><span class="n">c3</span><span class="w"> </span><span class="mi">01</span><span class="w">                </span><span class="n">add</span><span class="w">    </span><span class="cp">$</span><span class="mh">0x1</span><span class="p">,</span><span class="o">%</span><span class="n">ebx</span>
<span class="w">      </span><span class="mi">61</span>:   <span class="mi">81</span><span class="w"> </span><span class="n">fb</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">12</span><span class="w"> </span><span class="mi">7</span><span class="n">a</span><span class="w"> </span><span class="mi">00</span><span class="w">       </span><span class="n">cmp</span><span class="w">    </span><span class="cp">$</span><span class="mh">0x7a1200</span><span class="p">,</span><span class="o">%</span><span class="n">ebx</span>
<span class="w">      </span><span class="mi">67</span>:   <span class="mi">0</span><span class="n">f</span><span class="w"> </span><span class="mi">8</span><span class="n">c</span><span class="w"> </span><span class="n">e4</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w">       </span><span class="n">jl</span><span class="w">     </span><span class="mi">51</span><span class="w"> </span><span class="o">&lt;</span><span class="n">wasm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>::<span class="n">function</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mh">0x51</span><span class="o">&gt;</span>
<span class="w">      </span><span class="mi">6</span><span class="n">d</span>:   <span class="mi">41</span><span class="w"> </span><span class="mi">83</span><span class="w"> </span><span class="n">c7</span><span class="w"> </span><span class="mi">01</span><span class="w">             </span><span class="n">add</span><span class="w">    </span><span class="cp">$</span><span class="mh">0x1</span><span class="p">,</span><span class="o">%</span><span class="n">r15d</span>
<span class="w">      </span><span class="mi">71</span>:   <span class="mi">41</span><span class="w"> </span><span class="mi">81</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="mi">40</span><span class="w"> </span><span class="mi">9</span><span class="n">c</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">    </span><span class="n">cmp</span><span class="w">    </span><span class="cp">$</span><span class="mh">0x9c40</span><span class="p">,</span><span class="o">%</span><span class="n">r15d</span>
<span class="w">      </span><span class="mi">78</span>:   <span class="mi">0</span><span class="n">f</span><span class="w"> </span><span class="mi">8</span><span class="n">c</span><span class="w"> </span><span class="n">c4</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w">       </span><span class="n">jl</span><span class="w">     </span><span class="mi">42</span><span class="w"> </span><span class="o">&lt;</span><span class="n">wasm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>::<span class="n">function</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mh">0x42</span><span class="o">&gt;</span>
<span class="w">      </span><span class="mi">7</span><span class="n">e</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">1</span><span class="n">c</span><span class="w"> </span><span class="mi">24</span><span class="w">             </span><span class="n">mov</span><span class="w">    </span><span class="p">(</span><span class="o">%</span><span class="n">rsp</span><span class="p">),</span><span class="o">%</span><span class="n">rbx</span>
<span class="w">      </span><span class="mi">82</span>:   <span class="mi">4</span><span class="n">c</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">6</span><span class="n">c</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="mi">08</span><span class="w">          </span><span class="n">mov</span><span class="w">    </span><span class="mh">0x8</span><span class="p">(</span><span class="o">%</span><span class="n">rsp</span><span class="p">),</span><span class="o">%</span><span class="n">r13</span>
<span class="w">      </span><span class="mi">87</span>:   <span class="mi">4</span><span class="n">c</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">7</span><span class="n">c</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="mi">10</span><span class="w">          </span><span class="n">mov</span><span class="w">    </span><span class="mh">0x10</span><span class="p">(</span><span class="o">%</span><span class="n">rsp</span><span class="p">),</span><span class="o">%</span><span class="n">r15</span>
<span class="w">      </span><span class="mi">8</span><span class="n">c</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">83</span><span class="w"> </span><span class="n">c4</span><span class="w"> </span><span class="mi">20</span><span class="w">             </span><span class="n">add</span><span class="w">    </span><span class="cp">$</span><span class="mh">0x20</span><span class="p">,</span><span class="o">%</span><span class="n">rsp</span>
<span class="w">      </span><span class="mi">90</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">89</span><span class="w"> </span><span class="n">ec</span><span class="w">                </span><span class="n">mov</span><span class="w">    </span><span class="o">%</span><span class="n">rbp</span><span class="p">,</span><span class="o">%</span><span class="n">rsp</span>
<span class="w">      </span><span class="mi">93</span>:   <span class="mi">5</span><span class="n">d</span><span class="w">                      </span><span class="n">pop</span><span class="w">    </span><span class="o">%</span><span class="n">rbp</span>
<span class="w">      </span><span class="mi">94</span>:   <span class="nc">c3</span><span class="w">                      </span><span class="n">retq</span>
<span class="w">      </span><span class="mi">95</span>:   <span class="mi">4</span><span class="n">d</span><span class="w"> </span><span class="mi">39</span><span class="w"> </span><span class="n">ca</span><span class="w">                </span><span class="n">cmp</span><span class="w">    </span><span class="o">%</span><span class="n">r9</span><span class="p">,</span><span class="o">%</span><span class="n">r10</span>
<span class="w">      </span><span class="mi">98</span>:   <span class="mi">0</span><span class="n">f</span><span class="w"> </span><span class="mi">82</span><span class="w"> </span><span class="n">a1</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w">       </span><span class="n">jb</span><span class="w">     </span><span class="mi">3</span><span class="n">f</span><span class="w"> </span><span class="o">&lt;</span><span class="n">wasm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>::<span class="n">function</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mh">0x3f</span><span class="o">&gt;</span>
<span class="w">      </span><span class="mi">9</span><span class="n">e</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">47</span><span class="w"> </span><span class="mi">38</span><span class="w">             </span><span class="n">mov</span><span class="w">    </span><span class="mh">0x38</span><span class="p">(</span><span class="o">%</span><span class="n">rdi</span><span class="p">),</span><span class="o">%</span><span class="n">rax</span>
<span class="w">      </span><span class="n">a2</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">80</span><span class="w"> </span><span class="n">b0</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">    </span><span class="n">mov</span><span class="w">    </span><span class="mh">0xb0</span><span class="p">(</span><span class="o">%</span><span class="n">rax</span><span class="p">),</span><span class="o">%</span><span class="n">rax</span>
<span class="w">      </span><span class="n">a9</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">83</span><span class="w"> </span><span class="n">ec</span><span class="w"> </span><span class="mi">20</span><span class="w">             </span><span class="n">sub</span><span class="w">    </span><span class="cp">$</span><span class="mh">0x20</span><span class="p">,</span><span class="o">%</span><span class="n">rsp</span>
<span class="w">      </span><span class="n">ad</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">89</span><span class="w"> </span><span class="n">f9</span><span class="w">                </span><span class="n">mov</span><span class="w">    </span><span class="o">%</span><span class="n">rdi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span>
<span class="w">      </span><span class="n">b0</span>:   <span class="nc">ff</span><span class="w"> </span><span class="n">d0</span><span class="w">                   </span><span class="n">callq</span><span class="w">  </span><span class="o">*%</span><span class="n">rax</span>
<span class="w">      </span><span class="n">b2</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">83</span><span class="w"> </span><span class="n">c4</span><span class="w"> </span><span class="mi">20</span><span class="w">             </span><span class="n">add</span><span class="w">    </span><span class="cp">$</span><span class="mh">0x20</span><span class="p">,</span><span class="o">%</span><span class="n">rsp</span>
<span class="w">      </span><span class="n">b6</span>:   <span class="mi">49</span><span class="w"> </span><span class="mi">89</span><span class="w"> </span><span class="n">c1</span><span class="w">                </span><span class="n">mov</span><span class="w">    </span><span class="o">%</span><span class="n">rax</span><span class="p">,</span><span class="o">%</span><span class="n">r9</span>
<span class="w">      </span><span class="n">b9</span>:   <span class="nc">e9</span><span class="w"> </span><span class="mi">81</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w">          </span><span class="n">jmpq</span><span class="w">   </span><span class="mi">3</span><span class="n">f</span><span class="w"> </span><span class="o">&lt;</span><span class="n">wasm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>::<span class="n">function</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mh">0x3f</span><span class="o">&gt;</span>
<span class="w">      </span><span class="n">be</span>:   <span class="mi">4</span><span class="n">c</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">4</span><span class="n">e</span><span class="w"> </span><span class="mi">10</span><span class="w">             </span><span class="n">mov</span><span class="w">    </span><span class="mh">0x10</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">),</span><span class="o">%</span><span class="n">r9</span>
<span class="w">      </span><span class="n">c2</span>:   <span class="mi">4</span><span class="n">d</span><span class="w"> </span><span class="mi">39</span><span class="w"> </span><span class="n">ca</span><span class="w">                </span><span class="n">cmp</span><span class="w">    </span><span class="o">%</span><span class="n">r9</span><span class="p">,</span><span class="o">%</span><span class="n">r10</span>
<span class="w">      </span><span class="n">c5</span>:   <span class="mi">0</span><span class="n">f</span><span class="w"> </span><span class="mi">82</span><span class="w"> </span><span class="mi">84</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w">       </span><span class="n">jb</span><span class="w">     </span><span class="mi">4</span><span class="n">f</span><span class="w"> </span><span class="o">&lt;</span><span class="n">wasm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>::<span class="n">function</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mh">0x4f</span><span class="o">&gt;</span>
<span class="w">      </span><span class="n">cb</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">47</span><span class="w"> </span><span class="mi">38</span><span class="w">             </span><span class="n">mov</span><span class="w">    </span><span class="mh">0x38</span><span class="p">(</span><span class="o">%</span><span class="n">rdi</span><span class="p">),</span><span class="o">%</span><span class="n">rax</span>
<span class="w">      </span><span class="n">cf</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">80</span><span class="w"> </span><span class="n">b0</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">    </span><span class="n">mov</span><span class="w">    </span><span class="mh">0xb0</span><span class="p">(</span><span class="o">%</span><span class="n">rax</span><span class="p">),</span><span class="o">%</span><span class="n">rax</span>
<span class="w">      </span><span class="n">d6</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">83</span><span class="w"> </span><span class="n">ec</span><span class="w"> </span><span class="mi">20</span><span class="w">             </span><span class="n">sub</span><span class="w">    </span><span class="cp">$</span><span class="mh">0x20</span><span class="p">,</span><span class="o">%</span><span class="n">rsp</span>
<span class="w">      </span><span class="n">da</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">89</span><span class="w"> </span><span class="n">f9</span><span class="w">                </span><span class="n">mov</span><span class="w">    </span><span class="o">%</span><span class="n">rdi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span>
<span class="w">      </span><span class="n">dd</span>:   <span class="nc">ff</span><span class="w"> </span><span class="n">d0</span><span class="w">                   </span><span class="n">callq</span><span class="w">  </span><span class="o">*%</span><span class="n">rax</span>
<span class="w">      </span><span class="n">df</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">83</span><span class="w"> </span><span class="n">c4</span><span class="w"> </span><span class="mi">20</span><span class="w">             </span><span class="n">add</span><span class="w">    </span><span class="cp">$</span><span class="mh">0x20</span><span class="p">,</span><span class="o">%</span><span class="n">rsp</span>
<span class="w">      </span><span class="n">e3</span>:   <span class="mi">49</span><span class="w"> </span><span class="mi">89</span><span class="w"> </span><span class="n">c1</span><span class="w">                </span><span class="n">mov</span><span class="w">    </span><span class="o">%</span><span class="n">rax</span><span class="p">,</span><span class="o">%</span><span class="n">r9</span>
<span class="w">      </span><span class="n">e6</span>:   <span class="nc">e9</span><span class="w"> </span><span class="mi">64</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w">          </span><span class="n">jmpq</span><span class="w">   </span><span class="mi">4</span><span class="n">f</span><span class="w"> </span><span class="o">&lt;</span><span class="n">wasm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>::<span class="n">function</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mh">0x4f</span><span class="o">&gt;</span>
<span class="w">      </span><span class="n">eb</span>:   <span class="mi">4</span><span class="n">c</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">4</span><span class="n">e</span><span class="w"> </span><span class="mi">10</span><span class="w">             </span><span class="n">mov</span><span class="w">    </span><span class="mh">0x10</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">),</span><span class="o">%</span><span class="n">r9</span>
<span class="w">      </span><span class="n">ef</span>:   <span class="mi">4</span><span class="n">d</span><span class="w"> </span><span class="mi">39</span><span class="w"> </span><span class="n">cb</span><span class="w">                </span><span class="n">cmp</span><span class="w">    </span><span class="o">%</span><span class="n">r9</span><span class="p">,</span><span class="o">%</span><span class="n">r11</span>
<span class="w">      </span><span class="n">f2</span>:   <span class="mi">0</span><span class="n">f</span><span class="w"> </span><span class="mi">82</span><span class="w"> </span><span class="mi">66</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w">       </span><span class="n">jb</span><span class="w">     </span><span class="mi">5</span><span class="n">e</span><span class="w"> </span><span class="o">&lt;</span><span class="n">wasm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>::<span class="n">function</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mh">0x5e</span><span class="o">&gt;</span>
<span class="w">      </span><span class="n">f8</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">4</span><span class="n">f</span><span class="w"> </span><span class="mi">38</span><span class="w">             </span><span class="n">mov</span><span class="w">    </span><span class="mh">0x38</span><span class="p">(</span><span class="o">%</span><span class="n">rdi</span><span class="p">),</span><span class="o">%</span><span class="n">rcx</span>
<span class="w">      </span><span class="n">fc</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">91</span><span class="w"> </span><span class="n">b0</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">    </span><span class="n">mov</span><span class="w">    </span><span class="mh">0xb0</span><span class="p">(</span><span class="o">%</span><span class="n">rcx</span><span class="p">),</span><span class="o">%</span><span class="n">rdx</span>
<span class="w">     </span><span class="mi">103</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">83</span><span class="w"> </span><span class="n">ec</span><span class="w"> </span><span class="mi">20</span><span class="w">             </span><span class="n">sub</span><span class="w">    </span><span class="cp">$</span><span class="mh">0x20</span><span class="p">,</span><span class="o">%</span><span class="n">rsp</span>
<span class="w">     </span><span class="mi">107</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">89</span><span class="w"> </span><span class="n">f9</span><span class="w">                </span><span class="n">mov</span><span class="w">    </span><span class="o">%</span><span class="n">rdi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span>
<span class="w">     </span><span class="mi">10</span><span class="n">a</span>:   <span class="nc">ff</span><span class="w"> </span><span class="n">d2</span><span class="w">                   </span><span class="n">callq</span><span class="w">  </span><span class="o">*%</span><span class="n">rdx</span>
<span class="w">     </span><span class="mi">10</span><span class="n">c</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">83</span><span class="w"> </span><span class="n">c4</span><span class="w"> </span><span class="mi">20</span><span class="w">             </span><span class="n">add</span><span class="w">    </span><span class="cp">$</span><span class="mh">0x20</span><span class="p">,</span><span class="o">%</span><span class="n">rsp</span>
<span class="w">     </span><span class="mi">110</span>:   <span class="mi">49</span><span class="w"> </span><span class="mi">89</span><span class="w"> </span><span class="n">c1</span><span class="w">                </span><span class="n">mov</span><span class="w">    </span><span class="o">%</span><span class="n">rax</span><span class="p">,</span><span class="o">%</span><span class="n">r9</span>
<span class="w">     </span><span class="mi">113</span>:   <span class="nc">e9</span><span class="w"> </span><span class="mi">46</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w">          </span><span class="n">jmpq</span><span class="w">   </span><span class="mi">5</span><span class="n">e</span><span class="w"> </span><span class="o">&lt;</span><span class="n">wasm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>::<span class="n">function</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mh">0x5e</span><span class="o">&gt;</span>
<span class="w">     </span><span class="mi">118</span>:   <span class="mi">0</span><span class="n">f</span><span class="w"> </span><span class="mi">0</span><span class="n">b</span><span class="w">                   </span><span class="n">ud2</span>
</code></pre></div>
<p>The above example assigns some registers, such as ax and cx, to the check block of epoch. And bx has not been allocated for use at all. Actually, this is just a simple example, and more complex workloads have a significant performance impact on the box_seal.wasm, the cost has reached 25%! And after trying to manually fix the issue with epoch (non portable), the cost was only less than 7%.</p>
</blockquote>



<a name="396760595"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237244%20Epoch%20performance%20issues/near/396760595" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237244.20Epoch.20performance.20issues.html#396760595">(Oct 15 2023 at 14:54)</a>:</h4>
<p>wjr-z edited <a href="https://github.com/bytecodealliance/wasmtime/issues/7244">issue #7244</a>:</p>
<blockquote>
<p>At present, there seem to be serious issues with the epoch mechanism and register usage。<br>
For example, the following is a simple comparison of native and epoch assemblies for a double loop</p>
<p>wasmtiem release-13.0.0</p>
<p>native :</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">       </span><span class="mi">0</span>:   <span class="mi">55</span><span class="w">                      </span><span class="n">push</span><span class="w">   </span><span class="o">%</span><span class="n">rbp</span>
<span class="w">       </span><span class="mi">1</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">89</span><span class="w"> </span><span class="n">e5</span><span class="w">                </span><span class="n">mov</span><span class="w">    </span><span class="o">%</span><span class="n">rsp</span><span class="p">,</span><span class="o">%</span><span class="n">rbp</span>
<span class="w">       </span><span class="mi">4</span>:   <span class="mi">4</span><span class="n">c</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">57</span><span class="w"> </span><span class="mi">08</span><span class="w">             </span><span class="n">mov</span><span class="w">    </span><span class="mh">0x8</span><span class="p">(</span><span class="o">%</span><span class="n">rdi</span><span class="p">),</span><span class="o">%</span><span class="n">r10</span>
<span class="w">       </span><span class="mi">8</span>:   <span class="mi">4</span><span class="n">d</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">12</span><span class="w">                </span><span class="n">mov</span><span class="w">    </span><span class="p">(</span><span class="o">%</span><span class="n">r10</span><span class="p">),</span><span class="o">%</span><span class="n">r10</span>
<span class="w">       </span><span class="n">b</span>:   <span class="mi">49</span><span class="w"> </span><span class="mi">39</span><span class="w"> </span><span class="n">e2</span><span class="w">                </span><span class="n">cmp</span><span class="w">    </span><span class="o">%</span><span class="n">rsp</span><span class="p">,</span><span class="o">%</span><span class="n">r10</span>
<span class="w">       </span><span class="n">e</span>:   <span class="mi">0</span><span class="n">f</span><span class="w"> </span><span class="mi">87</span><span class="w"> </span><span class="mi">2</span><span class="n">a</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">       </span><span class="n">ja</span><span class="w">     </span><span class="mi">3</span><span class="n">e</span><span class="w"> </span><span class="o">&lt;</span><span class="n">wasm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>::<span class="n">function</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mh">0x3e</span><span class="o">&gt;</span>
<span class="w">      </span><span class="mi">14</span>:   <span class="mi">31</span><span class="w"> </span><span class="n">c9</span><span class="w">                   </span><span class="n">xor</span><span class="w">    </span><span class="o">%</span><span class="n">ecx</span><span class="p">,</span><span class="o">%</span><span class="n">ecx</span>
<span class="w">      </span><span class="mi">16</span>:   <span class="mi">45</span><span class="w"> </span><span class="mi">31</span><span class="w"> </span><span class="n">c9</span><span class="w">                </span><span class="n">xor</span><span class="w">    </span><span class="o">%</span><span class="n">r9d</span><span class="p">,</span><span class="o">%</span><span class="n">r9d</span>
<span class="w">      </span><span class="mi">19</span>:   <span class="mi">41</span><span class="w"> </span><span class="mi">83</span><span class="w"> </span><span class="n">c1</span><span class="w"> </span><span class="mi">01</span><span class="w">             </span><span class="n">add</span><span class="w">    </span><span class="cp">$</span><span class="mh">0x1</span><span class="p">,</span><span class="o">%</span><span class="n">r9d</span>
<span class="w">      </span><span class="mi">1</span><span class="n">d</span>:   <span class="mi">41</span><span class="w"> </span><span class="mi">81</span><span class="w"> </span><span class="n">f9</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">12</span><span class="w"> </span><span class="mi">7</span><span class="n">a</span><span class="w"> </span><span class="mi">00</span><span class="w">    </span><span class="n">cmp</span><span class="w">    </span><span class="cp">$</span><span class="mh">0x7a1200</span><span class="p">,</span><span class="o">%</span><span class="n">r9d</span>
<span class="w">      </span><span class="mi">24</span>:   <span class="mi">0</span><span class="n">f</span><span class="w"> </span><span class="mi">8</span><span class="n">c</span><span class="w"> </span><span class="n">ef</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w">       </span><span class="n">jl</span><span class="w">     </span><span class="mi">19</span><span class="w"> </span><span class="o">&lt;</span><span class="n">wasm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>::<span class="n">function</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mh">0x19</span><span class="o">&gt;</span>
<span class="w">      </span><span class="mi">2</span><span class="n">a</span>:   <span class="mi">83</span><span class="w"> </span><span class="n">c1</span><span class="w"> </span><span class="mi">01</span><span class="w">                </span><span class="n">add</span><span class="w">    </span><span class="cp">$</span><span class="mh">0x1</span><span class="p">,</span><span class="o">%</span><span class="n">ecx</span>
<span class="w">      </span><span class="mi">2</span><span class="n">d</span>:   <span class="mi">81</span><span class="w"> </span><span class="n">f9</span><span class="w"> </span><span class="mi">40</span><span class="w"> </span><span class="mi">9</span><span class="n">c</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">       </span><span class="n">cmp</span><span class="w">    </span><span class="cp">$</span><span class="mh">0x9c40</span><span class="p">,</span><span class="o">%</span><span class="n">ecx</span>
<span class="w">      </span><span class="mi">33</span>:   <span class="mi">0</span><span class="n">f</span><span class="w"> </span><span class="mi">8</span><span class="n">c</span><span class="w"> </span><span class="n">dd</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w">       </span><span class="n">jl</span><span class="w">     </span><span class="mi">16</span><span class="w"> </span><span class="o">&lt;</span><span class="n">wasm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>::<span class="n">function</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mh">0x16</span><span class="o">&gt;</span>
<span class="w">      </span><span class="mi">39</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">89</span><span class="w"> </span><span class="n">ec</span><span class="w">                </span><span class="n">mov</span><span class="w">    </span><span class="o">%</span><span class="n">rbp</span><span class="p">,</span><span class="o">%</span><span class="n">rsp</span>
<span class="w">      </span><span class="mi">3</span><span class="n">c</span>:   <span class="mi">5</span><span class="n">d</span><span class="w">                      </span><span class="n">pop</span><span class="w">    </span><span class="o">%</span><span class="n">rbp</span>
<span class="w">      </span><span class="mi">3</span><span class="n">d</span>:   <span class="nc">c3</span><span class="w">                      </span><span class="n">retq</span>
<span class="w">      </span><span class="mi">3</span><span class="n">e</span>:   <span class="mi">0</span><span class="n">f</span><span class="w"> </span><span class="mi">0</span><span class="n">b</span><span class="w">                   </span><span class="n">ud2</span>
</code></pre></div>
<p>epoch :</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">       </span><span class="mi">0</span>:   <span class="mi">55</span><span class="w">                      </span><span class="n">push</span><span class="w">   </span><span class="o">%</span><span class="n">rbp</span>
<span class="w">       </span><span class="mi">1</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">89</span><span class="w"> </span><span class="n">e5</span><span class="w">                </span><span class="n">mov</span><span class="w">    </span><span class="o">%</span><span class="n">rsp</span><span class="p">,</span><span class="o">%</span><span class="n">rbp</span>
<span class="w">       </span><span class="mi">4</span>:   <span class="mi">4</span><span class="n">c</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">57</span><span class="w"> </span><span class="mi">08</span><span class="w">             </span><span class="n">mov</span><span class="w">    </span><span class="mh">0x8</span><span class="p">(</span><span class="o">%</span><span class="n">rdi</span><span class="p">),</span><span class="o">%</span><span class="n">r10</span>
<span class="w">       </span><span class="mi">8</span>:   <span class="mi">4</span><span class="n">d</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">12</span><span class="w">                </span><span class="n">mov</span><span class="w">    </span><span class="p">(</span><span class="o">%</span><span class="n">r10</span><span class="p">),</span><span class="o">%</span><span class="n">r10</span>
<span class="w">       </span><span class="n">b</span>:   <span class="mi">49</span><span class="w"> </span><span class="mi">39</span><span class="w"> </span><span class="n">e2</span><span class="w">                </span><span class="n">cmp</span><span class="w">    </span><span class="o">%</span><span class="n">rsp</span><span class="p">,</span><span class="o">%</span><span class="n">r10</span>
<span class="w">       </span><span class="n">e</span>:   <span class="mi">0</span><span class="n">f</span><span class="w"> </span><span class="mi">87</span><span class="w"> </span><span class="mi">04</span><span class="w"> </span><span class="mi">01</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">       </span><span class="n">ja</span><span class="w">     </span><span class="mi">118</span><span class="w"> </span><span class="o">&lt;</span><span class="n">wasm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>::<span class="n">function</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mh">0x118</span><span class="o">&gt;</span>
<span class="w">      </span><span class="mi">14</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">83</span><span class="w"> </span><span class="n">ec</span><span class="w"> </span><span class="mi">20</span><span class="w">             </span><span class="n">sub</span><span class="w">    </span><span class="cp">$</span><span class="mh">0x20</span><span class="p">,</span><span class="o">%</span><span class="n">rsp</span>
<span class="w">      </span><span class="mi">18</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">89</span><span class="w"> </span><span class="mi">1</span><span class="n">c</span><span class="w"> </span><span class="mi">24</span><span class="w">             </span><span class="n">mov</span><span class="w">    </span><span class="o">%</span><span class="n">rbx</span><span class="p">,(</span><span class="o">%</span><span class="n">rsp</span><span class="p">)</span>
<span class="w">      </span><span class="mi">1</span><span class="n">c</span>:   <span class="mi">4</span><span class="n">c</span><span class="w"> </span><span class="mi">89</span><span class="w"> </span><span class="mi">6</span><span class="n">c</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="mi">08</span><span class="w">          </span><span class="n">mov</span><span class="w">    </span><span class="o">%</span><span class="n">r13</span><span class="p">,</span><span class="mh">0x8</span><span class="p">(</span><span class="o">%</span><span class="n">rsp</span><span class="p">)</span>
<span class="w">      </span><span class="mi">21</span>:   <span class="mi">4</span><span class="n">c</span><span class="w"> </span><span class="mi">89</span><span class="w"> </span><span class="mi">7</span><span class="n">c</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="mi">10</span><span class="w">          </span><span class="n">mov</span><span class="w">    </span><span class="o">%</span><span class="n">r15</span><span class="p">,</span><span class="mh">0x10</span><span class="p">(</span><span class="o">%</span><span class="n">rsp</span><span class="p">)</span>
<span class="w">      </span><span class="mi">26</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">77</span><span class="w"> </span><span class="mi">08</span><span class="w">             </span><span class="n">mov</span><span class="w">    </span><span class="mh">0x8</span><span class="p">(</span><span class="o">%</span><span class="n">rdi</span><span class="p">),</span><span class="o">%</span><span class="n">rsi</span>
<span class="w">      </span><span class="mi">2</span><span class="n">a</span>:   <span class="mi">4</span><span class="n">c</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">4</span><span class="n">e</span><span class="w"> </span><span class="mi">10</span><span class="w">             </span><span class="n">mov</span><span class="w">    </span><span class="mh">0x10</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">),</span><span class="o">%</span><span class="n">r9</span>
<span class="w">      </span><span class="mi">2</span><span class="n">e</span>:   <span class="mi">4</span><span class="n">c</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">6</span><span class="n">f</span><span class="w"> </span><span class="mi">18</span><span class="w">             </span><span class="n">mov</span><span class="w">    </span><span class="mh">0x18</span><span class="p">(</span><span class="o">%</span><span class="n">rdi</span><span class="p">),</span><span class="o">%</span><span class="n">r13</span>
<span class="w">      </span><span class="mi">32</span>:   <span class="mi">4</span><span class="n">d</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">55</span><span class="w"> </span><span class="mi">00</span><span class="w">             </span><span class="n">mov</span><span class="w">    </span><span class="mh">0x0</span><span class="p">(</span><span class="o">%</span><span class="n">r13</span><span class="p">),</span><span class="o">%</span><span class="n">r10</span>
<span class="w">      </span><span class="mi">36</span>:   <span class="mi">4</span><span class="n">d</span><span class="w"> </span><span class="mi">39</span><span class="w"> </span><span class="n">ca</span><span class="w">                </span><span class="n">cmp</span><span class="w">    </span><span class="o">%</span><span class="n">r9</span><span class="p">,</span><span class="o">%</span><span class="n">r10</span>
<span class="w">      </span><span class="mi">39</span>:   <span class="mi">0</span><span class="n">f</span><span class="w"> </span><span class="mi">83</span><span class="w"> </span><span class="mi">56</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">       </span><span class="n">jae</span><span class="w">    </span><span class="mi">95</span><span class="w"> </span><span class="o">&lt;</span><span class="n">wasm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>::<span class="n">function</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mh">0x95</span><span class="o">&gt;</span>
<span class="w">      </span><span class="mi">3</span><span class="n">f</span>:   <span class="mi">45</span><span class="w"> </span><span class="mi">31</span><span class="w"> </span><span class="n">ff</span><span class="w">                </span><span class="n">xor</span><span class="w">    </span><span class="o">%</span><span class="n">r15d</span><span class="p">,</span><span class="o">%</span><span class="n">r15d</span>
<span class="w">      </span><span class="mi">42</span>:   <span class="mi">4</span><span class="n">d</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">55</span><span class="w"> </span><span class="mi">00</span><span class="w">             </span><span class="n">mov</span><span class="w">    </span><span class="mh">0x0</span><span class="p">(</span><span class="o">%</span><span class="n">r13</span><span class="p">),</span><span class="o">%</span><span class="n">r10</span>
<span class="w">      </span><span class="mi">46</span>:   <span class="mi">4</span><span class="n">d</span><span class="w"> </span><span class="mi">39</span><span class="w"> </span><span class="n">ca</span><span class="w">                </span><span class="n">cmp</span><span class="w">    </span><span class="o">%</span><span class="n">r9</span><span class="p">,</span><span class="o">%</span><span class="n">r10</span>
<span class="w">      </span><span class="mi">49</span>:   <span class="mi">0</span><span class="n">f</span><span class="w"> </span><span class="mi">83</span><span class="w"> </span><span class="mi">6</span><span class="n">f</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">       </span><span class="n">jae</span><span class="w">    </span><span class="n">be</span><span class="w"> </span><span class="o">&lt;</span><span class="n">wasm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>::<span class="n">function</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mh">0xbe</span><span class="o">&gt;</span>
<span class="w">      </span><span class="mi">4</span><span class="n">f</span>:   <span class="mi">31</span><span class="w"> </span><span class="n">db</span><span class="w">                   </span><span class="n">xor</span><span class="w">    </span><span class="o">%</span><span class="n">ebx</span><span class="p">,</span><span class="o">%</span><span class="n">ebx</span>
<span class="w">      </span><span class="mi">51</span>:   <span class="mi">4</span><span class="n">d</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">5</span><span class="n">d</span><span class="w"> </span><span class="mi">00</span><span class="w">             </span><span class="n">mov</span><span class="w">    </span><span class="mh">0x0</span><span class="p">(</span><span class="o">%</span><span class="n">r13</span><span class="p">),</span><span class="o">%</span><span class="n">r11</span>
<span class="w">      </span><span class="mi">55</span>:   <span class="mi">4</span><span class="n">d</span><span class="w"> </span><span class="mi">39</span><span class="w"> </span><span class="n">cb</span><span class="w">                </span><span class="n">cmp</span><span class="w">    </span><span class="o">%</span><span class="n">r9</span><span class="p">,</span><span class="o">%</span><span class="n">r11</span>
<span class="w">      </span><span class="mi">58</span>:   <span class="mi">0</span><span class="n">f</span><span class="w"> </span><span class="mi">83</span><span class="w"> </span><span class="mi">8</span><span class="n">d</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">       </span><span class="n">jae</span><span class="w">    </span><span class="n">eb</span><span class="w"> </span><span class="o">&lt;</span><span class="n">wasm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>::<span class="n">function</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mh">0xeb</span><span class="o">&gt;</span>
<span class="w">      </span><span class="mi">5</span><span class="n">e</span>:   <span class="mi">83</span><span class="w"> </span><span class="n">c3</span><span class="w"> </span><span class="mi">01</span><span class="w">                </span><span class="n">add</span><span class="w">    </span><span class="cp">$</span><span class="mh">0x1</span><span class="p">,</span><span class="o">%</span><span class="n">ebx</span>
<span class="w">      </span><span class="mi">61</span>:   <span class="mi">81</span><span class="w"> </span><span class="n">fb</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">12</span><span class="w"> </span><span class="mi">7</span><span class="n">a</span><span class="w"> </span><span class="mi">00</span><span class="w">       </span><span class="n">cmp</span><span class="w">    </span><span class="cp">$</span><span class="mh">0x7a1200</span><span class="p">,</span><span class="o">%</span><span class="n">ebx</span>
<span class="w">      </span><span class="mi">67</span>:   <span class="mi">0</span><span class="n">f</span><span class="w"> </span><span class="mi">8</span><span class="n">c</span><span class="w"> </span><span class="n">e4</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w">       </span><span class="n">jl</span><span class="w">     </span><span class="mi">51</span><span class="w"> </span><span class="o">&lt;</span><span class="n">wasm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>::<span class="n">function</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mh">0x51</span><span class="o">&gt;</span>
<span class="w">      </span><span class="mi">6</span><span class="n">d</span>:   <span class="mi">41</span><span class="w"> </span><span class="mi">83</span><span class="w"> </span><span class="n">c7</span><span class="w"> </span><span class="mi">01</span><span class="w">             </span><span class="n">add</span><span class="w">    </span><span class="cp">$</span><span class="mh">0x1</span><span class="p">,</span><span class="o">%</span><span class="n">r15d</span>
<span class="w">      </span><span class="mi">71</span>:   <span class="mi">41</span><span class="w"> </span><span class="mi">81</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="mi">40</span><span class="w"> </span><span class="mi">9</span><span class="n">c</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">    </span><span class="n">cmp</span><span class="w">    </span><span class="cp">$</span><span class="mh">0x9c40</span><span class="p">,</span><span class="o">%</span><span class="n">r15d</span>
<span class="w">      </span><span class="mi">78</span>:   <span class="mi">0</span><span class="n">f</span><span class="w"> </span><span class="mi">8</span><span class="n">c</span><span class="w"> </span><span class="n">c4</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w">       </span><span class="n">jl</span><span class="w">     </span><span class="mi">42</span><span class="w"> </span><span class="o">&lt;</span><span class="n">wasm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>::<span class="n">function</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mh">0x42</span><span class="o">&gt;</span>
<span class="w">      </span><span class="mi">7</span><span class="n">e</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">1</span><span class="n">c</span><span class="w"> </span><span class="mi">24</span><span class="w">             </span><span class="n">mov</span><span class="w">    </span><span class="p">(</span><span class="o">%</span><span class="n">rsp</span><span class="p">),</span><span class="o">%</span><span class="n">rbx</span>
<span class="w">      </span><span class="mi">82</span>:   <span class="mi">4</span><span class="n">c</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">6</span><span class="n">c</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="mi">08</span><span class="w">          </span><span class="n">mov</span><span class="w">    </span><span class="mh">0x8</span><span class="p">(</span><span class="o">%</span><span class="n">rsp</span><span class="p">),</span><span class="o">%</span><span class="n">r13</span>
<span class="w">      </span><span class="mi">87</span>:   <span class="mi">4</span><span class="n">c</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">7</span><span class="n">c</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="mi">10</span><span class="w">          </span><span class="n">mov</span><span class="w">    </span><span class="mh">0x10</span><span class="p">(</span><span class="o">%</span><span class="n">rsp</span><span class="p">),</span><span class="o">%</span><span class="n">r15</span>
<span class="w">      </span><span class="mi">8</span><span class="n">c</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">83</span><span class="w"> </span><span class="n">c4</span><span class="w"> </span><span class="mi">20</span><span class="w">             </span><span class="n">add</span><span class="w">    </span><span class="cp">$</span><span class="mh">0x20</span><span class="p">,</span><span class="o">%</span><span class="n">rsp</span>
<span class="w">      </span><span class="mi">90</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">89</span><span class="w"> </span><span class="n">ec</span><span class="w">                </span><span class="n">mov</span><span class="w">    </span><span class="o">%</span><span class="n">rbp</span><span class="p">,</span><span class="o">%</span><span class="n">rsp</span>
<span class="w">      </span><span class="mi">93</span>:   <span class="mi">5</span><span class="n">d</span><span class="w">                      </span><span class="n">pop</span><span class="w">    </span><span class="o">%</span><span class="n">rbp</span>
<span class="w">      </span><span class="mi">94</span>:   <span class="nc">c3</span><span class="w">                      </span><span class="n">retq</span>
<span class="w">      </span><span class="mi">95</span>:   <span class="mi">4</span><span class="n">d</span><span class="w"> </span><span class="mi">39</span><span class="w"> </span><span class="n">ca</span><span class="w">                </span><span class="n">cmp</span><span class="w">    </span><span class="o">%</span><span class="n">r9</span><span class="p">,</span><span class="o">%</span><span class="n">r10</span>
<span class="w">      </span><span class="mi">98</span>:   <span class="mi">0</span><span class="n">f</span><span class="w"> </span><span class="mi">82</span><span class="w"> </span><span class="n">a1</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w">       </span><span class="n">jb</span><span class="w">     </span><span class="mi">3</span><span class="n">f</span><span class="w"> </span><span class="o">&lt;</span><span class="n">wasm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>::<span class="n">function</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mh">0x3f</span><span class="o">&gt;</span>
<span class="w">      </span><span class="mi">9</span><span class="n">e</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">47</span><span class="w"> </span><span class="mi">38</span><span class="w">             </span><span class="n">mov</span><span class="w">    </span><span class="mh">0x38</span><span class="p">(</span><span class="o">%</span><span class="n">rdi</span><span class="p">),</span><span class="o">%</span><span class="n">rax</span>
<span class="w">      </span><span class="n">a2</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">80</span><span class="w"> </span><span class="n">b0</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">    </span><span class="n">mov</span><span class="w">    </span><span class="mh">0xb0</span><span class="p">(</span><span class="o">%</span><span class="n">rax</span><span class="p">),</span><span class="o">%</span><span class="n">rax</span>
<span class="w">      </span><span class="n">a9</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">83</span><span class="w"> </span><span class="n">ec</span><span class="w"> </span><span class="mi">20</span><span class="w">             </span><span class="n">sub</span><span class="w">    </span><span class="cp">$</span><span class="mh">0x20</span><span class="p">,</span><span class="o">%</span><span class="n">rsp</span>
<span class="w">      </span><span class="n">ad</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">89</span><span class="w"> </span><span class="n">f9</span><span class="w">                </span><span class="n">mov</span><span class="w">    </span><span class="o">%</span><span class="n">rdi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span>
<span class="w">      </span><span class="n">b0</span>:   <span class="nc">ff</span><span class="w"> </span><span class="n">d0</span><span class="w">                   </span><span class="n">callq</span><span class="w">  </span><span class="o">*%</span><span class="n">rax</span>
<span class="w">      </span><span class="n">b2</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">83</span><span class="w"> </span><span class="n">c4</span><span class="w"> </span><span class="mi">20</span><span class="w">             </span><span class="n">add</span><span class="w">    </span><span class="cp">$</span><span class="mh">0x20</span><span class="p">,</span><span class="o">%</span><span class="n">rsp</span>
<span class="w">      </span><span class="n">b6</span>:   <span class="mi">49</span><span class="w"> </span><span class="mi">89</span><span class="w"> </span><span class="n">c1</span><span class="w">                </span><span class="n">mov</span><span class="w">    </span><span class="o">%</span><span class="n">rax</span><span class="p">,</span><span class="o">%</span><span class="n">r9</span>
<span class="w">      </span><span class="n">b9</span>:   <span class="nc">e9</span><span class="w"> </span><span class="mi">81</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w">          </span><span class="n">jmpq</span><span class="w">   </span><span class="mi">3</span><span class="n">f</span><span class="w"> </span><span class="o">&lt;</span><span class="n">wasm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>::<span class="n">function</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mh">0x3f</span><span class="o">&gt;</span>
<span class="w">      </span><span class="n">be</span>:   <span class="mi">4</span><span class="n">c</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">4</span><span class="n">e</span><span class="w"> </span><span class="mi">10</span><span class="w">             </span><span class="n">mov</span><span class="w">    </span><span class="mh">0x10</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">),</span><span class="o">%</span><span class="n">r9</span>
<span class="w">      </span><span class="n">c2</span>:   <span class="mi">4</span><span class="n">d</span><span class="w"> </span><span class="mi">39</span><span class="w"> </span><span class="n">ca</span><span class="w">                </span><span class="n">cmp</span><span class="w">    </span><span class="o">%</span><span class="n">r9</span><span class="p">,</span><span class="o">%</span><span class="n">r10</span>
<span class="w">      </span><span class="n">c5</span>:   <span class="mi">0</span><span class="n">f</span><span class="w"> </span><span class="mi">82</span><span class="w"> </span><span class="mi">84</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w">       </span><span class="n">jb</span><span class="w">     </span><span class="mi">4</span><span class="n">f</span><span class="w"> </span><span class="o">&lt;</span><span class="n">wasm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>::<span class="n">function</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mh">0x4f</span><span class="o">&gt;</span>
<span class="w">      </span><span class="n">cb</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">47</span><span class="w"> </span><span class="mi">38</span><span class="w">             </span><span class="n">mov</span><span class="w">    </span><span class="mh">0x38</span><span class="p">(</span><span class="o">%</span><span class="n">rdi</span><span class="p">),</span><span class="o">%</span><span class="n">rax</span>
<span class="w">      </span><span class="n">cf</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">80</span><span class="w"> </span><span class="n">b0</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">    </span><span class="n">mov</span><span class="w">    </span><span class="mh">0xb0</span><span class="p">(</span><span class="o">%</span><span class="n">rax</span><span class="p">),</span><span class="o">%</span><span class="n">rax</span>
<span class="w">      </span><span class="n">d6</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">83</span><span class="w"> </span><span class="n">ec</span><span class="w"> </span><span class="mi">20</span><span class="w">             </span><span class="n">sub</span><span class="w">    </span><span class="cp">$</span><span class="mh">0x20</span><span class="p">,</span><span class="o">%</span><span class="n">rsp</span>
<span class="w">      </span><span class="n">da</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">89</span><span class="w"> </span><span class="n">f9</span><span class="w">                </span><span class="n">mov</span><span class="w">    </span><span class="o">%</span><span class="n">rdi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span>
<span class="w">      </span><span class="n">dd</span>:   <span class="nc">ff</span><span class="w"> </span><span class="n">d0</span><span class="w">                   </span><span class="n">callq</span><span class="w">  </span><span class="o">*%</span><span class="n">rax</span>
<span class="w">      </span><span class="n">df</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">83</span><span class="w"> </span><span class="n">c4</span><span class="w"> </span><span class="mi">20</span><span class="w">             </span><span class="n">add</span><span class="w">    </span><span class="cp">$</span><span class="mh">0x20</span><span class="p">,</span><span class="o">%</span><span class="n">rsp</span>
<span class="w">      </span><span class="n">e3</span>:   <span class="mi">49</span><span class="w"> </span><span class="mi">89</span><span class="w"> </span><span class="n">c1</span><span class="w">                </span><span class="n">mov</span><span class="w">    </span><span class="o">%</span><span class="n">rax</span><span class="p">,</span><span class="o">%</span><span class="n">r9</span>
<span class="w">      </span><span class="n">e6</span>:   <span class="nc">e9</span><span class="w"> </span><span class="mi">64</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w">          </span><span class="n">jmpq</span><span class="w">   </span><span class="mi">4</span><span class="n">f</span><span class="w"> </span><span class="o">&lt;</span><span class="n">wasm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>::<span class="n">function</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mh">0x4f</span><span class="o">&gt;</span>
<span class="w">      </span><span class="n">eb</span>:   <span class="mi">4</span><span class="n">c</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">4</span><span class="n">e</span><span class="w"> </span><span class="mi">10</span><span class="w">             </span><span class="n">mov</span><span class="w">    </span><span class="mh">0x10</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">),</span><span class="o">%</span><span class="n">r9</span>
<span class="w">      </span><span class="n">ef</span>:   <span class="mi">4</span><span class="n">d</span><span class="w"> </span><span class="mi">39</span><span class="w"> </span><span class="n">cb</span><span class="w">                </span><span class="n">cmp</span><span class="w">    </span><span class="o">%</span><span class="n">r9</span><span class="p">,</span><span class="o">%</span><span class="n">r11</span>
<span class="w">      </span><span class="n">f2</span>:   <span class="mi">0</span><span class="n">f</span><span class="w"> </span><span class="mi">82</span><span class="w"> </span><span class="mi">66</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w">       </span><span class="n">jb</span><span class="w">     </span><span class="mi">5</span><span class="n">e</span><span class="w"> </span><span class="o">&lt;</span><span class="n">wasm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>::<span class="n">function</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mh">0x5e</span><span class="o">&gt;</span>
<span class="w">      </span><span class="n">f8</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">4</span><span class="n">f</span><span class="w"> </span><span class="mi">38</span><span class="w">             </span><span class="n">mov</span><span class="w">    </span><span class="mh">0x38</span><span class="p">(</span><span class="o">%</span><span class="n">rdi</span><span class="p">),</span><span class="o">%</span><span class="n">rcx</span>
<span class="w">      </span><span class="n">fc</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">91</span><span class="w"> </span><span class="n">b0</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">    </span><span class="n">mov</span><span class="w">    </span><span class="mh">0xb0</span><span class="p">(</span><span class="o">%</span><span class="n">rcx</span><span class="p">),</span><span class="o">%</span><span class="n">rdx</span>
<span class="w">     </span><span class="mi">103</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">83</span><span class="w"> </span><span class="n">ec</span><span class="w"> </span><span class="mi">20</span><span class="w">             </span><span class="n">sub</span><span class="w">    </span><span class="cp">$</span><span class="mh">0x20</span><span class="p">,</span><span class="o">%</span><span class="n">rsp</span>
<span class="w">     </span><span class="mi">107</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">89</span><span class="w"> </span><span class="n">f9</span><span class="w">                </span><span class="n">mov</span><span class="w">    </span><span class="o">%</span><span class="n">rdi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span>
<span class="w">     </span><span class="mi">10</span><span class="n">a</span>:   <span class="nc">ff</span><span class="w"> </span><span class="n">d2</span><span class="w">                   </span><span class="n">callq</span><span class="w">  </span><span class="o">*%</span><span class="n">rdx</span>
<span class="w">     </span><span class="mi">10</span><span class="n">c</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">83</span><span class="w"> </span><span class="n">c4</span><span class="w"> </span><span class="mi">20</span><span class="w">             </span><span class="n">add</span><span class="w">    </span><span class="cp">$</span><span class="mh">0x20</span><span class="p">,</span><span class="o">%</span><span class="n">rsp</span>
<span class="w">     </span><span class="mi">110</span>:   <span class="mi">49</span><span class="w"> </span><span class="mi">89</span><span class="w"> </span><span class="n">c1</span><span class="w">                </span><span class="n">mov</span><span class="w">    </span><span class="o">%</span><span class="n">rax</span><span class="p">,</span><span class="o">%</span><span class="n">r9</span>
<span class="w">     </span><span class="mi">113</span>:   <span class="nc">e9</span><span class="w"> </span><span class="mi">46</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w">          </span><span class="n">jmpq</span><span class="w">   </span><span class="mi">5</span><span class="n">e</span><span class="w"> </span><span class="o">&lt;</span><span class="n">wasm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>::<span class="n">function</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mh">0x5e</span><span class="o">&gt;</span>
<span class="w">     </span><span class="mi">118</span>:   <span class="mi">0</span><span class="n">f</span><span class="w"> </span><span class="mi">0</span><span class="n">b</span><span class="w">                   </span><span class="n">ud2</span>
</code></pre></div>
<p>The above example assigns some registers, such as ax and cx, to the check block of epoch. Actually, this is just a simple example, and more complex workloads have a significant performance impact on the box_seal.wasm, the cost has reached 25%! And after trying to manually fix the issue with epoch (non portable), the cost was only less than 7%.</p>
</blockquote>



<a name="396760628"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237244%20Epoch%20performance%20issues/near/396760628" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237244.20Epoch.20performance.20issues.html#396760628">(Oct 15 2023 at 14:54)</a>:</h4>
<p>wjr-z edited <a href="https://github.com/bytecodealliance/wasmtime/issues/7244">issue #7244</a>:</p>
<blockquote>
<p>At present, there seem to be serious issues with the epoch mechanism and register usage。<br>
For example, the following is a simple comparison of native and epoch assemblies for a double loop</p>
<p>wasmtiem release-13.0.0</p>
<p>native :</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">       </span><span class="mi">0</span>:   <span class="mi">55</span><span class="w">                      </span><span class="n">push</span><span class="w">   </span><span class="o">%</span><span class="n">rbp</span>
<span class="w">       </span><span class="mi">1</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">89</span><span class="w"> </span><span class="n">e5</span><span class="w">                </span><span class="n">mov</span><span class="w">    </span><span class="o">%</span><span class="n">rsp</span><span class="p">,</span><span class="o">%</span><span class="n">rbp</span>
<span class="w">       </span><span class="mi">4</span>:   <span class="mi">4</span><span class="n">c</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">57</span><span class="w"> </span><span class="mi">08</span><span class="w">             </span><span class="n">mov</span><span class="w">    </span><span class="mh">0x8</span><span class="p">(</span><span class="o">%</span><span class="n">rdi</span><span class="p">),</span><span class="o">%</span><span class="n">r10</span>
<span class="w">       </span><span class="mi">8</span>:   <span class="mi">4</span><span class="n">d</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">12</span><span class="w">                </span><span class="n">mov</span><span class="w">    </span><span class="p">(</span><span class="o">%</span><span class="n">r10</span><span class="p">),</span><span class="o">%</span><span class="n">r10</span>
<span class="w">       </span><span class="n">b</span>:   <span class="mi">49</span><span class="w"> </span><span class="mi">39</span><span class="w"> </span><span class="n">e2</span><span class="w">                </span><span class="n">cmp</span><span class="w">    </span><span class="o">%</span><span class="n">rsp</span><span class="p">,</span><span class="o">%</span><span class="n">r10</span>
<span class="w">       </span><span class="n">e</span>:   <span class="mi">0</span><span class="n">f</span><span class="w"> </span><span class="mi">87</span><span class="w"> </span><span class="mi">2</span><span class="n">a</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">       </span><span class="n">ja</span><span class="w">     </span><span class="mi">3</span><span class="n">e</span><span class="w"> </span><span class="o">&lt;</span><span class="n">wasm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>::<span class="n">function</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mh">0x3e</span><span class="o">&gt;</span>
<span class="w">      </span><span class="mi">14</span>:   <span class="mi">31</span><span class="w"> </span><span class="n">c9</span><span class="w">                   </span><span class="n">xor</span><span class="w">    </span><span class="o">%</span><span class="n">ecx</span><span class="p">,</span><span class="o">%</span><span class="n">ecx</span>
<span class="w">      </span><span class="mi">16</span>:   <span class="mi">45</span><span class="w"> </span><span class="mi">31</span><span class="w"> </span><span class="n">c9</span><span class="w">                </span><span class="n">xor</span><span class="w">    </span><span class="o">%</span><span class="n">r9d</span><span class="p">,</span><span class="o">%</span><span class="n">r9d</span>
<span class="w">      </span><span class="mi">19</span>:   <span class="mi">41</span><span class="w"> </span><span class="mi">83</span><span class="w"> </span><span class="n">c1</span><span class="w"> </span><span class="mi">01</span><span class="w">             </span><span class="n">add</span><span class="w">    </span><span class="cp">$</span><span class="mh">0x1</span><span class="p">,</span><span class="o">%</span><span class="n">r9d</span>
<span class="w">      </span><span class="mi">1</span><span class="n">d</span>:   <span class="mi">41</span><span class="w"> </span><span class="mi">81</span><span class="w"> </span><span class="n">f9</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">12</span><span class="w"> </span><span class="mi">7</span><span class="n">a</span><span class="w"> </span><span class="mi">00</span><span class="w">    </span><span class="n">cmp</span><span class="w">    </span><span class="cp">$</span><span class="mh">0x7a1200</span><span class="p">,</span><span class="o">%</span><span class="n">r9d</span>
<span class="w">      </span><span class="mi">24</span>:   <span class="mi">0</span><span class="n">f</span><span class="w"> </span><span class="mi">8</span><span class="n">c</span><span class="w"> </span><span class="n">ef</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w">       </span><span class="n">jl</span><span class="w">     </span><span class="mi">19</span><span class="w"> </span><span class="o">&lt;</span><span class="n">wasm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>::<span class="n">function</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mh">0x19</span><span class="o">&gt;</span>
<span class="w">      </span><span class="mi">2</span><span class="n">a</span>:   <span class="mi">83</span><span class="w"> </span><span class="n">c1</span><span class="w"> </span><span class="mi">01</span><span class="w">                </span><span class="n">add</span><span class="w">    </span><span class="cp">$</span><span class="mh">0x1</span><span class="p">,</span><span class="o">%</span><span class="n">ecx</span>
<span class="w">      </span><span class="mi">2</span><span class="n">d</span>:   <span class="mi">81</span><span class="w"> </span><span class="n">f9</span><span class="w"> </span><span class="mi">40</span><span class="w"> </span><span class="mi">9</span><span class="n">c</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">       </span><span class="n">cmp</span><span class="w">    </span><span class="cp">$</span><span class="mh">0x9c40</span><span class="p">,</span><span class="o">%</span><span class="n">ecx</span>
<span class="w">      </span><span class="mi">33</span>:   <span class="mi">0</span><span class="n">f</span><span class="w"> </span><span class="mi">8</span><span class="n">c</span><span class="w"> </span><span class="n">dd</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w">       </span><span class="n">jl</span><span class="w">     </span><span class="mi">16</span><span class="w"> </span><span class="o">&lt;</span><span class="n">wasm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>::<span class="n">function</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mh">0x16</span><span class="o">&gt;</span>
<span class="w">      </span><span class="mi">39</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">89</span><span class="w"> </span><span class="n">ec</span><span class="w">                </span><span class="n">mov</span><span class="w">    </span><span class="o">%</span><span class="n">rbp</span><span class="p">,</span><span class="o">%</span><span class="n">rsp</span>
<span class="w">      </span><span class="mi">3</span><span class="n">c</span>:   <span class="mi">5</span><span class="n">d</span><span class="w">                      </span><span class="n">pop</span><span class="w">    </span><span class="o">%</span><span class="n">rbp</span>
<span class="w">      </span><span class="mi">3</span><span class="n">d</span>:   <span class="nc">c3</span><span class="w">                      </span><span class="n">retq</span>
<span class="w">      </span><span class="mi">3</span><span class="n">e</span>:   <span class="mi">0</span><span class="n">f</span><span class="w"> </span><span class="mi">0</span><span class="n">b</span><span class="w">                   </span><span class="n">ud2</span>
</code></pre></div>
<p>epoch :</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">       </span><span class="mi">0</span>:   <span class="mi">55</span><span class="w">                      </span><span class="n">push</span><span class="w">   </span><span class="o">%</span><span class="n">rbp</span>
<span class="w">       </span><span class="mi">1</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">89</span><span class="w"> </span><span class="n">e5</span><span class="w">                </span><span class="n">mov</span><span class="w">    </span><span class="o">%</span><span class="n">rsp</span><span class="p">,</span><span class="o">%</span><span class="n">rbp</span>
<span class="w">       </span><span class="mi">4</span>:   <span class="mi">4</span><span class="n">c</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">57</span><span class="w"> </span><span class="mi">08</span><span class="w">             </span><span class="n">mov</span><span class="w">    </span><span class="mh">0x8</span><span class="p">(</span><span class="o">%</span><span class="n">rdi</span><span class="p">),</span><span class="o">%</span><span class="n">r10</span>
<span class="w">       </span><span class="mi">8</span>:   <span class="mi">4</span><span class="n">d</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">12</span><span class="w">                </span><span class="n">mov</span><span class="w">    </span><span class="p">(</span><span class="o">%</span><span class="n">r10</span><span class="p">),</span><span class="o">%</span><span class="n">r10</span>
<span class="w">       </span><span class="n">b</span>:   <span class="mi">49</span><span class="w"> </span><span class="mi">39</span><span class="w"> </span><span class="n">e2</span><span class="w">                </span><span class="n">cmp</span><span class="w">    </span><span class="o">%</span><span class="n">rsp</span><span class="p">,</span><span class="o">%</span><span class="n">r10</span>
<span class="w">       </span><span class="n">e</span>:   <span class="mi">0</span><span class="n">f</span><span class="w"> </span><span class="mi">87</span><span class="w"> </span><span class="mi">04</span><span class="w"> </span><span class="mi">01</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">       </span><span class="n">ja</span><span class="w">     </span><span class="mi">118</span><span class="w"> </span><span class="o">&lt;</span><span class="n">wasm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>::<span class="n">function</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mh">0x118</span><span class="o">&gt;</span>
<span class="w">      </span><span class="mi">14</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">83</span><span class="w"> </span><span class="n">ec</span><span class="w"> </span><span class="mi">20</span><span class="w">             </span><span class="n">sub</span><span class="w">    </span><span class="cp">$</span><span class="mh">0x20</span><span class="p">,</span><span class="o">%</span><span class="n">rsp</span>
<span class="w">      </span><span class="mi">18</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">89</span><span class="w"> </span><span class="mi">1</span><span class="n">c</span><span class="w"> </span><span class="mi">24</span><span class="w">             </span><span class="n">mov</span><span class="w">    </span><span class="o">%</span><span class="n">rbx</span><span class="p">,(</span><span class="o">%</span><span class="n">rsp</span><span class="p">)</span>
<span class="w">      </span><span class="mi">1</span><span class="n">c</span>:   <span class="mi">4</span><span class="n">c</span><span class="w"> </span><span class="mi">89</span><span class="w"> </span><span class="mi">6</span><span class="n">c</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="mi">08</span><span class="w">          </span><span class="n">mov</span><span class="w">    </span><span class="o">%</span><span class="n">r13</span><span class="p">,</span><span class="mh">0x8</span><span class="p">(</span><span class="o">%</span><span class="n">rsp</span><span class="p">)</span>
<span class="w">      </span><span class="mi">21</span>:   <span class="mi">4</span><span class="n">c</span><span class="w"> </span><span class="mi">89</span><span class="w"> </span><span class="mi">7</span><span class="n">c</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="mi">10</span><span class="w">          </span><span class="n">mov</span><span class="w">    </span><span class="o">%</span><span class="n">r15</span><span class="p">,</span><span class="mh">0x10</span><span class="p">(</span><span class="o">%</span><span class="n">rsp</span><span class="p">)</span>
<span class="w">      </span><span class="mi">26</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">77</span><span class="w"> </span><span class="mi">08</span><span class="w">             </span><span class="n">mov</span><span class="w">    </span><span class="mh">0x8</span><span class="p">(</span><span class="o">%</span><span class="n">rdi</span><span class="p">),</span><span class="o">%</span><span class="n">rsi</span>
<span class="w">      </span><span class="mi">2</span><span class="n">a</span>:   <span class="mi">4</span><span class="n">c</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">4</span><span class="n">e</span><span class="w"> </span><span class="mi">10</span><span class="w">             </span><span class="n">mov</span><span class="w">    </span><span class="mh">0x10</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">),</span><span class="o">%</span><span class="n">r9</span>
<span class="w">      </span><span class="mi">2</span><span class="n">e</span>:   <span class="mi">4</span><span class="n">c</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">6</span><span class="n">f</span><span class="w"> </span><span class="mi">18</span><span class="w">             </span><span class="n">mov</span><span class="w">    </span><span class="mh">0x18</span><span class="p">(</span><span class="o">%</span><span class="n">rdi</span><span class="p">),</span><span class="o">%</span><span class="n">r13</span>
<span class="w">      </span><span class="mi">32</span>:   <span class="mi">4</span><span class="n">d</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">55</span><span class="w"> </span><span class="mi">00</span><span class="w">             </span><span class="n">mov</span><span class="w">    </span><span class="mh">0x0</span><span class="p">(</span><span class="o">%</span><span class="n">r13</span><span class="p">),</span><span class="o">%</span><span class="n">r10</span>
<span class="w">      </span><span class="mi">36</span>:   <span class="mi">4</span><span class="n">d</span><span class="w"> </span><span class="mi">39</span><span class="w"> </span><span class="n">ca</span><span class="w">                </span><span class="n">cmp</span><span class="w">    </span><span class="o">%</span><span class="n">r9</span><span class="p">,</span><span class="o">%</span><span class="n">r10</span>
<span class="w">      </span><span class="mi">39</span>:   <span class="mi">0</span><span class="n">f</span><span class="w"> </span><span class="mi">83</span><span class="w"> </span><span class="mi">56</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">       </span><span class="n">jae</span><span class="w">    </span><span class="mi">95</span><span class="w"> </span><span class="o">&lt;</span><span class="n">wasm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>::<span class="n">function</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mh">0x95</span><span class="o">&gt;</span>
<span class="w">      </span><span class="mi">3</span><span class="n">f</span>:   <span class="mi">45</span><span class="w"> </span><span class="mi">31</span><span class="w"> </span><span class="n">ff</span><span class="w">                </span><span class="n">xor</span><span class="w">    </span><span class="o">%</span><span class="n">r15d</span><span class="p">,</span><span class="o">%</span><span class="n">r15d</span>
<span class="w">      </span><span class="mi">42</span>:   <span class="mi">4</span><span class="n">d</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">55</span><span class="w"> </span><span class="mi">00</span><span class="w">             </span><span class="n">mov</span><span class="w">    </span><span class="mh">0x0</span><span class="p">(</span><span class="o">%</span><span class="n">r13</span><span class="p">),</span><span class="o">%</span><span class="n">r10</span>
<span class="w">      </span><span class="mi">46</span>:   <span class="mi">4</span><span class="n">d</span><span class="w"> </span><span class="mi">39</span><span class="w"> </span><span class="n">ca</span><span class="w">                </span><span class="n">cmp</span><span class="w">    </span><span class="o">%</span><span class="n">r9</span><span class="p">,</span><span class="o">%</span><span class="n">r10</span>
<span class="w">      </span><span class="mi">49</span>:   <span class="mi">0</span><span class="n">f</span><span class="w"> </span><span class="mi">83</span><span class="w"> </span><span class="mi">6</span><span class="n">f</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">       </span><span class="n">jae</span><span class="w">    </span><span class="n">be</span><span class="w"> </span><span class="o">&lt;</span><span class="n">wasm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>::<span class="n">function</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mh">0xbe</span><span class="o">&gt;</span>
<span class="w">      </span><span class="mi">4</span><span class="n">f</span>:   <span class="mi">31</span><span class="w"> </span><span class="n">db</span><span class="w">                   </span><span class="n">xor</span><span class="w">    </span><span class="o">%</span><span class="n">ebx</span><span class="p">,</span><span class="o">%</span><span class="n">ebx</span>
<span class="w">      </span><span class="mi">51</span>:   <span class="mi">4</span><span class="n">d</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">5</span><span class="n">d</span><span class="w"> </span><span class="mi">00</span><span class="w">             </span><span class="n">mov</span><span class="w">    </span><span class="mh">0x0</span><span class="p">(</span><span class="o">%</span><span class="n">r13</span><span class="p">),</span><span class="o">%</span><span class="n">r11</span>
<span class="w">      </span><span class="mi">55</span>:   <span class="mi">4</span><span class="n">d</span><span class="w"> </span><span class="mi">39</span><span class="w"> </span><span class="n">cb</span><span class="w">                </span><span class="n">cmp</span><span class="w">    </span><span class="o">%</span><span class="n">r9</span><span class="p">,</span><span class="o">%</span><span class="n">r11</span>
<span class="w">      </span><span class="mi">58</span>:   <span class="mi">0</span><span class="n">f</span><span class="w"> </span><span class="mi">83</span><span class="w"> </span><span class="mi">8</span><span class="n">d</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">       </span><span class="n">jae</span><span class="w">    </span><span class="n">eb</span><span class="w"> </span><span class="o">&lt;</span><span class="n">wasm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>::<span class="n">function</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mh">0xeb</span><span class="o">&gt;</span>
<span class="w">      </span><span class="mi">5</span><span class="n">e</span>:   <span class="mi">83</span><span class="w"> </span><span class="n">c3</span><span class="w"> </span><span class="mi">01</span><span class="w">                </span><span class="n">add</span><span class="w">    </span><span class="cp">$</span><span class="mh">0x1</span><span class="p">,</span><span class="o">%</span><span class="n">ebx</span>
<span class="w">      </span><span class="mi">61</span>:   <span class="mi">81</span><span class="w"> </span><span class="n">fb</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">12</span><span class="w"> </span><span class="mi">7</span><span class="n">a</span><span class="w"> </span><span class="mi">00</span><span class="w">       </span><span class="n">cmp</span><span class="w">    </span><span class="cp">$</span><span class="mh">0x7a1200</span><span class="p">,</span><span class="o">%</span><span class="n">ebx</span>
<span class="w">      </span><span class="mi">67</span>:   <span class="mi">0</span><span class="n">f</span><span class="w"> </span><span class="mi">8</span><span class="n">c</span><span class="w"> </span><span class="n">e4</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w">       </span><span class="n">jl</span><span class="w">     </span><span class="mi">51</span><span class="w"> </span><span class="o">&lt;</span><span class="n">wasm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>::<span class="n">function</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mh">0x51</span><span class="o">&gt;</span>
<span class="w">      </span><span class="mi">6</span><span class="n">d</span>:   <span class="mi">41</span><span class="w"> </span><span class="mi">83</span><span class="w"> </span><span class="n">c7</span><span class="w"> </span><span class="mi">01</span><span class="w">             </span><span class="n">add</span><span class="w">    </span><span class="cp">$</span><span class="mh">0x1</span><span class="p">,</span><span class="o">%</span><span class="n">r15d</span>
<span class="w">      </span><span class="mi">71</span>:   <span class="mi">41</span><span class="w"> </span><span class="mi">81</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="mi">40</span><span class="w"> </span><span class="mi">9</span><span class="n">c</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">    </span><span class="n">cmp</span><span class="w">    </span><span class="cp">$</span><span class="mh">0x9c40</span><span class="p">,</span><span class="o">%</span><span class="n">r15d</span>
<span class="w">      </span><span class="mi">78</span>:   <span class="mi">0</span><span class="n">f</span><span class="w"> </span><span class="mi">8</span><span class="n">c</span><span class="w"> </span><span class="n">c4</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w">       </span><span class="n">jl</span><span class="w">     </span><span class="mi">42</span><span class="w"> </span><span class="o">&lt;</span><span class="n">wasm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>::<span class="n">function</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mh">0x42</span><span class="o">&gt;</span>
<span class="w">      </span><span class="mi">7</span><span class="n">e</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">1</span><span class="n">c</span><span class="w"> </span><span class="mi">24</span><span class="w">             </span><span class="n">mov</span><span class="w">    </span><span class="p">(</span><span class="o">%</span><span class="n">rsp</span><span class="p">),</span><span class="o">%</span><span class="n">rbx</span>
<span class="w">      </span><span class="mi">82</span>:   <span class="mi">4</span><span class="n">c</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">6</span><span class="n">c</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="mi">08</span><span class="w">          </span><span class="n">mov</span><span class="w">    </span><span class="mh">0x8</span><span class="p">(</span><span class="o">%</span><span class="n">rsp</span><span class="p">),</span><span class="o">%</span><span class="n">r13</span>
<span class="w">      </span><span class="mi">87</span>:   <span class="mi">4</span><span class="n">c</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">7</span><span class="n">c</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="mi">10</span><span class="w">          </span><span class="n">mov</span><span class="w">    </span><span class="mh">0x10</span><span class="p">(</span><span class="o">%</span><span class="n">rsp</span><span class="p">),</span><span class="o">%</span><span class="n">r15</span>
<span class="w">      </span><span class="mi">8</span><span class="n">c</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">83</span><span class="w"> </span><span class="n">c4</span><span class="w"> </span><span class="mi">20</span><span class="w">             </span><span class="n">add</span><span class="w">    </span><span class="cp">$</span><span class="mh">0x20</span><span class="p">,</span><span class="o">%</span><span class="n">rsp</span>
<span class="w">      </span><span class="mi">90</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">89</span><span class="w"> </span><span class="n">ec</span><span class="w">                </span><span class="n">mov</span><span class="w">    </span><span class="o">%</span><span class="n">rbp</span><span class="p">,</span><span class="o">%</span><span class="n">rsp</span>
<span class="w">      </span><span class="mi">93</span>:   <span class="mi">5</span><span class="n">d</span><span class="w">                      </span><span class="n">pop</span><span class="w">    </span><span class="o">%</span><span class="n">rbp</span>
<span class="w">      </span><span class="mi">94</span>:   <span class="nc">c3</span><span class="w">                      </span><span class="n">retq</span>
<span class="w">      </span><span class="mi">95</span>:   <span class="mi">4</span><span class="n">d</span><span class="w"> </span><span class="mi">39</span><span class="w"> </span><span class="n">ca</span><span class="w">                </span><span class="n">cmp</span><span class="w">    </span><span class="o">%</span><span class="n">r9</span><span class="p">,</span><span class="o">%</span><span class="n">r10</span>
<span class="w">      </span><span class="mi">98</span>:   <span class="mi">0</span><span class="n">f</span><span class="w"> </span><span class="mi">82</span><span class="w"> </span><span class="n">a1</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w">       </span><span class="n">jb</span><span class="w">     </span><span class="mi">3</span><span class="n">f</span><span class="w"> </span><span class="o">&lt;</span><span class="n">wasm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>::<span class="n">function</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mh">0x3f</span><span class="o">&gt;</span>
<span class="w">      </span><span class="mi">9</span><span class="n">e</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">47</span><span class="w"> </span><span class="mi">38</span><span class="w">             </span><span class="n">mov</span><span class="w">    </span><span class="mh">0x38</span><span class="p">(</span><span class="o">%</span><span class="n">rdi</span><span class="p">),</span><span class="o">%</span><span class="n">rax</span>
<span class="w">      </span><span class="n">a2</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">80</span><span class="w"> </span><span class="n">b0</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">    </span><span class="n">mov</span><span class="w">    </span><span class="mh">0xb0</span><span class="p">(</span><span class="o">%</span><span class="n">rax</span><span class="p">),</span><span class="o">%</span><span class="n">rax</span>
<span class="w">      </span><span class="n">a9</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">83</span><span class="w"> </span><span class="n">ec</span><span class="w"> </span><span class="mi">20</span><span class="w">             </span><span class="n">sub</span><span class="w">    </span><span class="cp">$</span><span class="mh">0x20</span><span class="p">,</span><span class="o">%</span><span class="n">rsp</span>
<span class="w">      </span><span class="n">ad</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">89</span><span class="w"> </span><span class="n">f9</span><span class="w">                </span><span class="n">mov</span><span class="w">    </span><span class="o">%</span><span class="n">rdi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span>
<span class="w">      </span><span class="n">b0</span>:   <span class="nc">ff</span><span class="w"> </span><span class="n">d0</span><span class="w">                   </span><span class="n">callq</span><span class="w">  </span><span class="o">*%</span><span class="n">rax</span>
<span class="w">      </span><span class="n">b2</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">83</span><span class="w"> </span><span class="n">c4</span><span class="w"> </span><span class="mi">20</span><span class="w">             </span><span class="n">add</span><span class="w">    </span><span class="cp">$</span><span class="mh">0x20</span><span class="p">,</span><span class="o">%</span><span class="n">rsp</span>
<span class="w">      </span><span class="n">b6</span>:   <span class="mi">49</span><span class="w"> </span><span class="mi">89</span><span class="w"> </span><span class="n">c1</span><span class="w">                </span><span class="n">mov</span><span class="w">    </span><span class="o">%</span><span class="n">rax</span><span class="p">,</span><span class="o">%</span><span class="n">r9</span>
<span class="w">      </span><span class="n">b9</span>:   <span class="nc">e9</span><span class="w"> </span><span class="mi">81</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w">          </span><span class="n">jmpq</span><span class="w">   </span><span class="mi">3</span><span class="n">f</span><span class="w"> </span><span class="o">&lt;</span><span class="n">wasm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>::<span class="n">function</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mh">0x3f</span><span class="o">&gt;</span>
<span class="w">      </span><span class="n">be</span>:   <span class="mi">4</span><span class="n">c</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">4</span><span class="n">e</span><span class="w"> </span><span class="mi">10</span><span class="w">             </span><span class="n">mov</span><span class="w">    </span><span class="mh">0x10</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">),</span><span class="o">%</span><span class="n">r9</span>
<span class="w">      </span><span class="n">c2</span>:   <span class="mi">4</span><span class="n">d</span><span class="w"> </span><span class="mi">39</span><span class="w"> </span><span class="n">ca</span><span class="w">                </span><span class="n">cmp</span><span class="w">    </span><span class="o">%</span><span class="n">r9</span><span class="p">,</span><span class="o">%</span><span class="n">r10</span>
<span class="w">      </span><span class="n">c5</span>:   <span class="mi">0</span><span class="n">f</span><span class="w"> </span><span class="mi">82</span><span class="w"> </span><span class="mi">84</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w">       </span><span class="n">jb</span><span class="w">     </span><span class="mi">4</span><span class="n">f</span><span class="w"> </span><span class="o">&lt;</span><span class="n">wasm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>::<span class="n">function</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mh">0x4f</span><span class="o">&gt;</span>
<span class="w">      </span><span class="n">cb</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">47</span><span class="w"> </span><span class="mi">38</span><span class="w">             </span><span class="n">mov</span><span class="w">    </span><span class="mh">0x38</span><span class="p">(</span><span class="o">%</span><span class="n">rdi</span><span class="p">),</span><span class="o">%</span><span class="n">rax</span>
<span class="w">      </span><span class="n">cf</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">80</span><span class="w"> </span><span class="n">b0</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">    </span><span class="n">mov</span><span class="w">    </span><span class="mh">0xb0</span><span class="p">(</span><span class="o">%</span><span class="n">rax</span><span class="p">),</span><span class="o">%</span><span class="n">rax</span>
<span class="w">      </span><span class="n">d6</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">83</span><span class="w"> </span><span class="n">ec</span><span class="w"> </span><span class="mi">20</span><span class="w">             </span><span class="n">sub</span><span class="w">    </span><span class="cp">$</span><span class="mh">0x20</span><span class="p">,</span><span class="o">%</span><span class="n">rsp</span>
<span class="w">      </span><span class="n">da</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">89</span><span class="w"> </span><span class="n">f9</span><span class="w">                </span><span class="n">mov</span><span class="w">    </span><span class="o">%</span><span class="n">rdi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span>
<span class="w">      </span><span class="n">dd</span>:   <span class="nc">ff</span><span class="w"> </span><span class="n">d0</span><span class="w">                   </span><span class="n">callq</span><span class="w">  </span><span class="o">*%</span><span class="n">rax</span>
<span class="w">      </span><span class="n">df</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">83</span><span class="w"> </span><span class="n">c4</span><span class="w"> </span><span class="mi">20</span><span class="w">             </span><span class="n">add</span><span class="w">    </span><span class="cp">$</span><span class="mh">0x20</span><span class="p">,</span><span class="o">%</span><span class="n">rsp</span>
<span class="w">      </span><span class="n">e3</span>:   <span class="mi">49</span><span class="w"> </span><span class="mi">89</span><span class="w"> </span><span class="n">c1</span><span class="w">                </span><span class="n">mov</span><span class="w">    </span><span class="o">%</span><span class="n">rax</span><span class="p">,</span><span class="o">%</span><span class="n">r9</span>
<span class="w">      </span><span class="n">e6</span>:   <span class="nc">e9</span><span class="w"> </span><span class="mi">64</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w">          </span><span class="n">jmpq</span><span class="w">   </span><span class="mi">4</span><span class="n">f</span><span class="w"> </span><span class="o">&lt;</span><span class="n">wasm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>::<span class="n">function</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mh">0x4f</span><span class="o">&gt;</span>
<span class="w">      </span><span class="n">eb</span>:   <span class="mi">4</span><span class="n">c</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">4</span><span class="n">e</span><span class="w"> </span><span class="mi">10</span><span class="w">             </span><span class="n">mov</span><span class="w">    </span><span class="mh">0x10</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">),</span><span class="o">%</span><span class="n">r9</span>
<span class="w">      </span><span class="n">ef</span>:   <span class="mi">4</span><span class="n">d</span><span class="w"> </span><span class="mi">39</span><span class="w"> </span><span class="n">cb</span><span class="w">                </span><span class="n">cmp</span><span class="w">    </span><span class="o">%</span><span class="n">r9</span><span class="p">,</span><span class="o">%</span><span class="n">r11</span>
<span class="w">      </span><span class="n">f2</span>:   <span class="mi">0</span><span class="n">f</span><span class="w"> </span><span class="mi">82</span><span class="w"> </span><span class="mi">66</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w">       </span><span class="n">jb</span><span class="w">     </span><span class="mi">5</span><span class="n">e</span><span class="w"> </span><span class="o">&lt;</span><span class="n">wasm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>::<span class="n">function</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mh">0x5e</span><span class="o">&gt;</span>
<span class="w">      </span><span class="n">f8</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">4</span><span class="n">f</span><span class="w"> </span><span class="mi">38</span><span class="w">             </span><span class="n">mov</span><span class="w">    </span><span class="mh">0x38</span><span class="p">(</span><span class="o">%</span><span class="n">rdi</span><span class="p">),</span><span class="o">%</span><span class="n">rcx</span>
<span class="w">      </span><span class="n">fc</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">91</span><span class="w"> </span><span class="n">b0</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">    </span><span class="n">mov</span><span class="w">    </span><span class="mh">0xb0</span><span class="p">(</span><span class="o">%</span><span class="n">rcx</span><span class="p">),</span><span class="o">%</span><span class="n">rdx</span>
<span class="w">     </span><span class="mi">103</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">83</span><span class="w"> </span><span class="n">ec</span><span class="w"> </span><span class="mi">20</span><span class="w">             </span><span class="n">sub</span><span class="w">    </span><span class="cp">$</span><span class="mh">0x20</span><span class="p">,</span><span class="o">%</span><span class="n">rsp</span>
<span class="w">     </span><span class="mi">107</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">89</span><span class="w"> </span><span class="n">f9</span><span class="w">                </span><span class="n">mov</span><span class="w">    </span><span class="o">%</span><span class="n">rdi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span>
<span class="w">     </span><span class="mi">10</span><span class="n">a</span>:   <span class="nc">ff</span><span class="w"> </span><span class="n">d2</span><span class="w">                   </span><span class="n">callq</span><span class="w">  </span><span class="o">*%</span><span class="n">rdx</span>
<span class="w">     </span><span class="mi">10</span><span class="n">c</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">83</span><span class="w"> </span><span class="n">c4</span><span class="w"> </span><span class="mi">20</span><span class="w">             </span><span class="n">add</span><span class="w">    </span><span class="cp">$</span><span class="mh">0x20</span><span class="p">,</span><span class="o">%</span><span class="n">rsp</span>
<span class="w">     </span><span class="mi">110</span>:   <span class="mi">49</span><span class="w"> </span><span class="mi">89</span><span class="w"> </span><span class="n">c1</span><span class="w">                </span><span class="n">mov</span><span class="w">    </span><span class="o">%</span><span class="n">rax</span><span class="p">,</span><span class="o">%</span><span class="n">r9</span>
<span class="w">     </span><span class="mi">113</span>:   <span class="nc">e9</span><span class="w"> </span><span class="mi">46</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w">          </span><span class="n">jmpq</span><span class="w">   </span><span class="mi">5</span><span class="n">e</span><span class="w"> </span><span class="o">&lt;</span><span class="n">wasm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>::<span class="n">function</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mh">0x5e</span><span class="o">&gt;</span>
<span class="w">     </span><span class="mi">118</span>:   <span class="mi">0</span><span class="n">f</span><span class="w"> </span><span class="mi">0</span><span class="n">b</span><span class="w">                   </span><span class="n">ud2</span>
</code></pre></div>
<p>The above example assigns some registers, such as ax and cx, to the check block of epoch. Actually, this is just a simple example, and more complex workloads have a significant performance impact on the box_seal.wasm, the cost has reached 25%! And after trying to manually fix the issue with epoch (Unstable), the cost was only less than 7%.</p>
</blockquote>



<a name="396762688"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237244%20Epoch%20performance%20issues/near/396762688" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237244.20Epoch.20performance.20issues.html#396762688">(Oct 15 2023 at 15:20)</a>:</h4>
<p>wjr-z edited <a href="https://github.com/bytecodealliance/wasmtime/issues/7244">issue #7244</a>:</p>
<blockquote>
<p>At present, there seem to be serious issues with the epoch mechanism and register usage。<br>
For example, the following is a simple comparison of native and epoch assemblies for a double loop</p>
<p>wasmtiem release-13.0.0</p>
<p>native :</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">       </span><span class="mi">0</span>:   <span class="mi">55</span><span class="w">                      </span><span class="n">push</span><span class="w">   </span><span class="o">%</span><span class="n">rbp</span>
<span class="w">       </span><span class="mi">1</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">89</span><span class="w"> </span><span class="n">e5</span><span class="w">                </span><span class="n">mov</span><span class="w">    </span><span class="o">%</span><span class="n">rsp</span><span class="p">,</span><span class="o">%</span><span class="n">rbp</span>
<span class="w">       </span><span class="mi">4</span>:   <span class="mi">4</span><span class="n">c</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">57</span><span class="w"> </span><span class="mi">08</span><span class="w">             </span><span class="n">mov</span><span class="w">    </span><span class="mh">0x8</span><span class="p">(</span><span class="o">%</span><span class="n">rdi</span><span class="p">),</span><span class="o">%</span><span class="n">r10</span>
<span class="w">       </span><span class="mi">8</span>:   <span class="mi">4</span><span class="n">d</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">12</span><span class="w">                </span><span class="n">mov</span><span class="w">    </span><span class="p">(</span><span class="o">%</span><span class="n">r10</span><span class="p">),</span><span class="o">%</span><span class="n">r10</span>
<span class="w">       </span><span class="n">b</span>:   <span class="mi">49</span><span class="w"> </span><span class="mi">39</span><span class="w"> </span><span class="n">e2</span><span class="w">                </span><span class="n">cmp</span><span class="w">    </span><span class="o">%</span><span class="n">rsp</span><span class="p">,</span><span class="o">%</span><span class="n">r10</span>
<span class="w">       </span><span class="n">e</span>:   <span class="mi">0</span><span class="n">f</span><span class="w"> </span><span class="mi">87</span><span class="w"> </span><span class="mi">2</span><span class="n">a</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">       </span><span class="n">ja</span><span class="w">     </span><span class="mi">3</span><span class="n">e</span><span class="w"> </span><span class="o">&lt;</span><span class="n">wasm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>::<span class="n">function</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mh">0x3e</span><span class="o">&gt;</span>
<span class="w">      </span><span class="mi">14</span>:   <span class="mi">31</span><span class="w"> </span><span class="n">c9</span><span class="w">                   </span><span class="n">xor</span><span class="w">    </span><span class="o">%</span><span class="n">ecx</span><span class="p">,</span><span class="o">%</span><span class="n">ecx</span>
<span class="w">      </span><span class="mi">16</span>:   <span class="mi">45</span><span class="w"> </span><span class="mi">31</span><span class="w"> </span><span class="n">c9</span><span class="w">                </span><span class="n">xor</span><span class="w">    </span><span class="o">%</span><span class="n">r9d</span><span class="p">,</span><span class="o">%</span><span class="n">r9d</span>
<span class="w">      </span><span class="mi">19</span>:   <span class="mi">41</span><span class="w"> </span><span class="mi">83</span><span class="w"> </span><span class="n">c1</span><span class="w"> </span><span class="mi">01</span><span class="w">             </span><span class="n">add</span><span class="w">    </span><span class="cp">$</span><span class="mh">0x1</span><span class="p">,</span><span class="o">%</span><span class="n">r9d</span>
<span class="w">      </span><span class="mi">1</span><span class="n">d</span>:   <span class="mi">41</span><span class="w"> </span><span class="mi">81</span><span class="w"> </span><span class="n">f9</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">12</span><span class="w"> </span><span class="mi">7</span><span class="n">a</span><span class="w"> </span><span class="mi">00</span><span class="w">    </span><span class="n">cmp</span><span class="w">    </span><span class="cp">$</span><span class="mh">0x7a1200</span><span class="p">,</span><span class="o">%</span><span class="n">r9d</span>
<span class="w">      </span><span class="mi">24</span>:   <span class="mi">0</span><span class="n">f</span><span class="w"> </span><span class="mi">8</span><span class="n">c</span><span class="w"> </span><span class="n">ef</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w">       </span><span class="n">jl</span><span class="w">     </span><span class="mi">19</span><span class="w"> </span><span class="o">&lt;</span><span class="n">wasm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>::<span class="n">function</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mh">0x19</span><span class="o">&gt;</span>
<span class="w">      </span><span class="mi">2</span><span class="n">a</span>:   <span class="mi">83</span><span class="w"> </span><span class="n">c1</span><span class="w"> </span><span class="mi">01</span><span class="w">                </span><span class="n">add</span><span class="w">    </span><span class="cp">$</span><span class="mh">0x1</span><span class="p">,</span><span class="o">%</span><span class="n">ecx</span>
<span class="w">      </span><span class="mi">2</span><span class="n">d</span>:   <span class="mi">81</span><span class="w"> </span><span class="n">f9</span><span class="w"> </span><span class="mi">40</span><span class="w"> </span><span class="mi">9</span><span class="n">c</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">       </span><span class="n">cmp</span><span class="w">    </span><span class="cp">$</span><span class="mh">0x9c40</span><span class="p">,</span><span class="o">%</span><span class="n">ecx</span>
<span class="w">      </span><span class="mi">33</span>:   <span class="mi">0</span><span class="n">f</span><span class="w"> </span><span class="mi">8</span><span class="n">c</span><span class="w"> </span><span class="n">dd</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w">       </span><span class="n">jl</span><span class="w">     </span><span class="mi">16</span><span class="w"> </span><span class="o">&lt;</span><span class="n">wasm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>::<span class="n">function</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mh">0x16</span><span class="o">&gt;</span>
<span class="w">      </span><span class="mi">39</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">89</span><span class="w"> </span><span class="n">ec</span><span class="w">                </span><span class="n">mov</span><span class="w">    </span><span class="o">%</span><span class="n">rbp</span><span class="p">,</span><span class="o">%</span><span class="n">rsp</span>
<span class="w">      </span><span class="mi">3</span><span class="n">c</span>:   <span class="mi">5</span><span class="n">d</span><span class="w">                      </span><span class="n">pop</span><span class="w">    </span><span class="o">%</span><span class="n">rbp</span>
<span class="w">      </span><span class="mi">3</span><span class="n">d</span>:   <span class="nc">c3</span><span class="w">                      </span><span class="n">retq</span>
<span class="w">      </span><span class="mi">3</span><span class="n">e</span>:   <span class="mi">0</span><span class="n">f</span><span class="w"> </span><span class="mi">0</span><span class="n">b</span><span class="w">                   </span><span class="n">ud2</span>
</code></pre></div>
<p>epoch :</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">       </span><span class="mi">0</span>:   <span class="mi">55</span><span class="w">                      </span><span class="n">push</span><span class="w">   </span><span class="o">%</span><span class="n">rbp</span>
<span class="w">       </span><span class="mi">1</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">89</span><span class="w"> </span><span class="n">e5</span><span class="w">                </span><span class="n">mov</span><span class="w">    </span><span class="o">%</span><span class="n">rsp</span><span class="p">,</span><span class="o">%</span><span class="n">rbp</span>
<span class="w">       </span><span class="mi">4</span>:   <span class="mi">4</span><span class="n">c</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">57</span><span class="w"> </span><span class="mi">08</span><span class="w">             </span><span class="n">mov</span><span class="w">    </span><span class="mh">0x8</span><span class="p">(</span><span class="o">%</span><span class="n">rdi</span><span class="p">),</span><span class="o">%</span><span class="n">r10</span>
<span class="w">       </span><span class="mi">8</span>:   <span class="mi">4</span><span class="n">d</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">12</span><span class="w">                </span><span class="n">mov</span><span class="w">    </span><span class="p">(</span><span class="o">%</span><span class="n">r10</span><span class="p">),</span><span class="o">%</span><span class="n">r10</span>
<span class="w">       </span><span class="n">b</span>:   <span class="mi">49</span><span class="w"> </span><span class="mi">39</span><span class="w"> </span><span class="n">e2</span><span class="w">                </span><span class="n">cmp</span><span class="w">    </span><span class="o">%</span><span class="n">rsp</span><span class="p">,</span><span class="o">%</span><span class="n">r10</span>
<span class="w">       </span><span class="n">e</span>:   <span class="mi">0</span><span class="n">f</span><span class="w"> </span><span class="mi">87</span><span class="w"> </span><span class="mi">04</span><span class="w"> </span><span class="mi">01</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">       </span><span class="n">ja</span><span class="w">     </span><span class="mi">118</span><span class="w"> </span><span class="o">&lt;</span><span class="n">wasm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>::<span class="n">function</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mh">0x118</span><span class="o">&gt;</span>
<span class="w">      </span><span class="mi">14</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">83</span><span class="w"> </span><span class="n">ec</span><span class="w"> </span><span class="mi">20</span><span class="w">             </span><span class="n">sub</span><span class="w">    </span><span class="cp">$</span><span class="mh">0x20</span><span class="p">,</span><span class="o">%</span><span class="n">rsp</span>
<span class="w">      </span><span class="mi">18</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">89</span><span class="w"> </span><span class="mi">1</span><span class="n">c</span><span class="w"> </span><span class="mi">24</span><span class="w">             </span><span class="n">mov</span><span class="w">    </span><span class="o">%</span><span class="n">rbx</span><span class="p">,(</span><span class="o">%</span><span class="n">rsp</span><span class="p">)</span>
<span class="w">      </span><span class="mi">1</span><span class="n">c</span>:   <span class="mi">4</span><span class="n">c</span><span class="w"> </span><span class="mi">89</span><span class="w"> </span><span class="mi">6</span><span class="n">c</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="mi">08</span><span class="w">          </span><span class="n">mov</span><span class="w">    </span><span class="o">%</span><span class="n">r13</span><span class="p">,</span><span class="mh">0x8</span><span class="p">(</span><span class="o">%</span><span class="n">rsp</span><span class="p">)</span>
<span class="w">      </span><span class="mi">21</span>:   <span class="mi">4</span><span class="n">c</span><span class="w"> </span><span class="mi">89</span><span class="w"> </span><span class="mi">7</span><span class="n">c</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="mi">10</span><span class="w">          </span><span class="n">mov</span><span class="w">    </span><span class="o">%</span><span class="n">r15</span><span class="p">,</span><span class="mh">0x10</span><span class="p">(</span><span class="o">%</span><span class="n">rsp</span><span class="p">)</span>
<span class="w">      </span><span class="mi">26</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">77</span><span class="w"> </span><span class="mi">08</span><span class="w">             </span><span class="n">mov</span><span class="w">    </span><span class="mh">0x8</span><span class="p">(</span><span class="o">%</span><span class="n">rdi</span><span class="p">),</span><span class="o">%</span><span class="n">rsi</span>
<span class="w">      </span><span class="mi">2</span><span class="n">a</span>:   <span class="mi">4</span><span class="n">c</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">4</span><span class="n">e</span><span class="w"> </span><span class="mi">10</span><span class="w">             </span><span class="n">mov</span><span class="w">    </span><span class="mh">0x10</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">),</span><span class="o">%</span><span class="n">r9</span>
<span class="w">      </span><span class="mi">2</span><span class="n">e</span>:   <span class="mi">4</span><span class="n">c</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">6</span><span class="n">f</span><span class="w"> </span><span class="mi">18</span><span class="w">             </span><span class="n">mov</span><span class="w">    </span><span class="mh">0x18</span><span class="p">(</span><span class="o">%</span><span class="n">rdi</span><span class="p">),</span><span class="o">%</span><span class="n">r13</span>
<span class="w">      </span><span class="mi">32</span>:   <span class="mi">4</span><span class="n">d</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">55</span><span class="w"> </span><span class="mi">00</span><span class="w">             </span><span class="n">mov</span><span class="w">    </span><span class="mh">0x0</span><span class="p">(</span><span class="o">%</span><span class="n">r13</span><span class="p">),</span><span class="o">%</span><span class="n">r10</span>
<span class="w">      </span><span class="mi">36</span>:   <span class="mi">4</span><span class="n">d</span><span class="w"> </span><span class="mi">39</span><span class="w"> </span><span class="n">ca</span><span class="w">                </span><span class="n">cmp</span><span class="w">    </span><span class="o">%</span><span class="n">r9</span><span class="p">,</span><span class="o">%</span><span class="n">r10</span>
<span class="w">      </span><span class="mi">39</span>:   <span class="mi">0</span><span class="n">f</span><span class="w"> </span><span class="mi">83</span><span class="w"> </span><span class="mi">56</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">       </span><span class="n">jae</span><span class="w">    </span><span class="mi">95</span><span class="w"> </span><span class="o">&lt;</span><span class="n">wasm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>::<span class="n">function</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mh">0x95</span><span class="o">&gt;</span>
<span class="w">      </span><span class="mi">3</span><span class="n">f</span>:   <span class="mi">45</span><span class="w"> </span><span class="mi">31</span><span class="w"> </span><span class="n">ff</span><span class="w">                </span><span class="n">xor</span><span class="w">    </span><span class="o">%</span><span class="n">r15d</span><span class="p">,</span><span class="o">%</span><span class="n">r15d</span>
<span class="w">      </span><span class="mi">42</span>:   <span class="mi">4</span><span class="n">d</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">55</span><span class="w"> </span><span class="mi">00</span><span class="w">             </span><span class="n">mov</span><span class="w">    </span><span class="mh">0x0</span><span class="p">(</span><span class="o">%</span><span class="n">r13</span><span class="p">),</span><span class="o">%</span><span class="n">r10</span>
<span class="w">      </span><span class="mi">46</span>:   <span class="mi">4</span><span class="n">d</span><span class="w"> </span><span class="mi">39</span><span class="w"> </span><span class="n">ca</span><span class="w">                </span><span class="n">cmp</span><span class="w">    </span><span class="o">%</span><span class="n">r9</span><span class="p">,</span><span class="o">%</span><span class="n">r10</span>
<span class="w">      </span><span class="mi">49</span>:   <span class="mi">0</span><span class="n">f</span><span class="w"> </span><span class="mi">83</span><span class="w"> </span><span class="mi">6</span><span class="n">f</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">       </span><span class="n">jae</span><span class="w">    </span><span class="n">be</span><span class="w"> </span><span class="o">&lt;</span><span class="n">wasm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>::<span class="n">function</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mh">0xbe</span><span class="o">&gt;</span>
<span class="w">      </span><span class="mi">4</span><span class="n">f</span>:   <span class="mi">31</span><span class="w"> </span><span class="n">db</span><span class="w">                   </span><span class="n">xor</span><span class="w">    </span><span class="o">%</span><span class="n">ebx</span><span class="p">,</span><span class="o">%</span><span class="n">ebx</span>
<span class="w">      </span><span class="mi">51</span>:   <span class="mi">4</span><span class="n">d</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">5</span><span class="n">d</span><span class="w"> </span><span class="mi">00</span><span class="w">             </span><span class="n">mov</span><span class="w">    </span><span class="mh">0x0</span><span class="p">(</span><span class="o">%</span><span class="n">r13</span><span class="p">),</span><span class="o">%</span><span class="n">r11</span>
<span class="w">      </span><span class="mi">55</span>:   <span class="mi">4</span><span class="n">d</span><span class="w"> </span><span class="mi">39</span><span class="w"> </span><span class="n">cb</span><span class="w">                </span><span class="n">cmp</span><span class="w">    </span><span class="o">%</span><span class="n">r9</span><span class="p">,</span><span class="o">%</span><span class="n">r11</span>
<span class="w">      </span><span class="mi">58</span>:   <span class="mi">0</span><span class="n">f</span><span class="w"> </span><span class="mi">83</span><span class="w"> </span><span class="mi">8</span><span class="n">d</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">       </span><span class="n">jae</span><span class="w">    </span><span class="n">eb</span><span class="w"> </span><span class="o">&lt;</span><span class="n">wasm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>::<span class="n">function</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mh">0xeb</span><span class="o">&gt;</span>
<span class="w">      </span><span class="mi">5</span><span class="n">e</span>:   <span class="mi">83</span><span class="w"> </span><span class="n">c3</span><span class="w"> </span><span class="mi">01</span><span class="w">                </span><span class="n">add</span><span class="w">    </span><span class="cp">$</span><span class="mh">0x1</span><span class="p">,</span><span class="o">%</span><span class="n">ebx</span>
<span class="w">      </span><span class="mi">61</span>:   <span class="mi">81</span><span class="w"> </span><span class="n">fb</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">12</span><span class="w"> </span><span class="mi">7</span><span class="n">a</span><span class="w"> </span><span class="mi">00</span><span class="w">       </span><span class="n">cmp</span><span class="w">    </span><span class="cp">$</span><span class="mh">0x7a1200</span><span class="p">,</span><span class="o">%</span><span class="n">ebx</span>
<span class="w">      </span><span class="mi">67</span>:   <span class="mi">0</span><span class="n">f</span><span class="w"> </span><span class="mi">8</span><span class="n">c</span><span class="w"> </span><span class="n">e4</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w">       </span><span class="n">jl</span><span class="w">     </span><span class="mi">51</span><span class="w"> </span><span class="o">&lt;</span><span class="n">wasm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>::<span class="n">function</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mh">0x51</span><span class="o">&gt;</span>
<span class="w">      </span><span class="mi">6</span><span class="n">d</span>:   <span class="mi">41</span><span class="w"> </span><span class="mi">83</span><span class="w"> </span><span class="n">c7</span><span class="w"> </span><span class="mi">01</span><span class="w">             </span><span class="n">add</span><span class="w">    </span><span class="cp">$</span><span class="mh">0x1</span><span class="p">,</span><span class="o">%</span><span class="n">r15d</span>
<span class="w">      </span><span class="mi">71</span>:   <span class="mi">41</span><span class="w"> </span><span class="mi">81</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="mi">40</span><span class="w"> </span><span class="mi">9</span><span class="n">c</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">    </span><span class="n">cmp</span><span class="w">    </span><span class="cp">$</span><span class="mh">0x9c40</span><span class="p">,</span><span class="o">%</span><span class="n">r15d</span>
<span class="w">      </span><span class="mi">78</span>:   <span class="mi">0</span><span class="n">f</span><span class="w"> </span><span class="mi">8</span><span class="n">c</span><span class="w"> </span><span class="n">c4</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w">       </span><span class="n">jl</span><span class="w">     </span><span class="mi">42</span><span class="w"> </span><span class="o">&lt;</span><span class="n">wasm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>::<span class="n">function</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mh">0x42</span><span class="o">&gt;</span>
<span class="w">      </span><span class="mi">7</span><span class="n">e</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">1</span><span class="n">c</span><span class="w"> </span><span class="mi">24</span><span class="w">             </span><span class="n">mov</span><span class="w">    </span><span class="p">(</span><span class="o">%</span><span class="n">rsp</span><span class="p">),</span><span class="o">%</span><span class="n">rbx</span>
<span class="w">      </span><span class="mi">82</span>:   <span class="mi">4</span><span class="n">c</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">6</span><span class="n">c</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="mi">08</span><span class="w">          </span><span class="n">mov</span><span class="w">    </span><span class="mh">0x8</span><span class="p">(</span><span class="o">%</span><span class="n">rsp</span><span class="p">),</span><span class="o">%</span><span class="n">r13</span>
<span class="w">      </span><span class="mi">87</span>:   <span class="mi">4</span><span class="n">c</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">7</span><span class="n">c</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="mi">10</span><span class="w">          </span><span class="n">mov</span><span class="w">    </span><span class="mh">0x10</span><span class="p">(</span><span class="o">%</span><span class="n">rsp</span><span class="p">),</span><span class="o">%</span><span class="n">r15</span>
<span class="w">      </span><span class="mi">8</span><span class="n">c</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">83</span><span class="w"> </span><span class="n">c4</span><span class="w"> </span><span class="mi">20</span><span class="w">             </span><span class="n">add</span><span class="w">    </span><span class="cp">$</span><span class="mh">0x20</span><span class="p">,</span><span class="o">%</span><span class="n">rsp</span>
<span class="w">      </span><span class="mi">90</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">89</span><span class="w"> </span><span class="n">ec</span><span class="w">                </span><span class="n">mov</span><span class="w">    </span><span class="o">%</span><span class="n">rbp</span><span class="p">,</span><span class="o">%</span><span class="n">rsp</span>
<span class="w">      </span><span class="mi">93</span>:   <span class="mi">5</span><span class="n">d</span><span class="w">                      </span><span class="n">pop</span><span class="w">    </span><span class="o">%</span><span class="n">rbp</span>
<span class="w">      </span><span class="mi">94</span>:   <span class="nc">c3</span><span class="w">                      </span><span class="n">retq</span>
<span class="w">      </span><span class="mi">95</span>:   <span class="mi">4</span><span class="n">d</span><span class="w"> </span><span class="mi">39</span><span class="w"> </span><span class="n">ca</span><span class="w">                </span><span class="n">cmp</span><span class="w">    </span><span class="o">%</span><span class="n">r9</span><span class="p">,</span><span class="o">%</span><span class="n">r10</span>
<span class="w">      </span><span class="mi">98</span>:   <span class="mi">0</span><span class="n">f</span><span class="w"> </span><span class="mi">82</span><span class="w"> </span><span class="n">a1</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w">       </span><span class="n">jb</span><span class="w">     </span><span class="mi">3</span><span class="n">f</span><span class="w"> </span><span class="o">&lt;</span><span class="n">wasm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>::<span class="n">function</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mh">0x3f</span><span class="o">&gt;</span>
<span class="w">      </span><span class="mi">9</span><span class="n">e</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">47</span><span class="w"> </span><span class="mi">38</span><span class="w">             </span><span class="n">mov</span><span class="w">    </span><span class="mh">0x38</span><span class="p">(</span><span class="o">%</span><span class="n">rdi</span><span class="p">),</span><span class="o">%</span><span class="n">rax</span>
<span class="w">      </span><span class="n">a2</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">80</span><span class="w"> </span><span class="n">b0</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">    </span><span class="n">mov</span><span class="w">    </span><span class="mh">0xb0</span><span class="p">(</span><span class="o">%</span><span class="n">rax</span><span class="p">),</span><span class="o">%</span><span class="n">rax</span>
<span class="w">      </span><span class="n">a9</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">83</span><span class="w"> </span><span class="n">ec</span><span class="w"> </span><span class="mi">20</span><span class="w">             </span><span class="n">sub</span><span class="w">    </span><span class="cp">$</span><span class="mh">0x20</span><span class="p">,</span><span class="o">%</span><span class="n">rsp</span>
<span class="w">      </span><span class="n">ad</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">89</span><span class="w"> </span><span class="n">f9</span><span class="w">                </span><span class="n">mov</span><span class="w">    </span><span class="o">%</span><span class="n">rdi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span>
<span class="w">      </span><span class="n">b0</span>:   <span class="nc">ff</span><span class="w"> </span><span class="n">d0</span><span class="w">                   </span><span class="n">callq</span><span class="w">  </span><span class="o">*%</span><span class="n">rax</span>
<span class="w">      </span><span class="n">b2</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">83</span><span class="w"> </span><span class="n">c4</span><span class="w"> </span><span class="mi">20</span><span class="w">             </span><span class="n">add</span><span class="w">    </span><span class="cp">$</span><span class="mh">0x20</span><span class="p">,</span><span class="o">%</span><span class="n">rsp</span>
<span class="w">      </span><span class="n">b6</span>:   <span class="mi">49</span><span class="w"> </span><span class="mi">89</span><span class="w"> </span><span class="n">c1</span><span class="w">                </span><span class="n">mov</span><span class="w">    </span><span class="o">%</span><span class="n">rax</span><span class="p">,</span><span class="o">%</span><span class="n">r9</span>
<span class="w">      </span><span class="n">b9</span>:   <span class="nc">e9</span><span class="w"> </span><span class="mi">81</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w">          </span><span class="n">jmpq</span><span class="w">   </span><span class="mi">3</span><span class="n">f</span><span class="w"> </span><span class="o">&lt;</span><span class="n">wasm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>::<span class="n">function</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mh">0x3f</span><span class="o">&gt;</span>
<span class="w">      </span><span class="n">be</span>:   <span class="mi">4</span><span class="n">c</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">4</span><span class="n">e</span><span class="w"> </span><span class="mi">10</span><span class="w">             </span><span class="n">mov</span><span class="w">    </span><span class="mh">0x10</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">),</span><span class="o">%</span><span class="n">r9</span>
<span class="w">      </span><span class="n">c2</span>:   <span class="mi">4</span><span class="n">d</span><span class="w"> </span><span class="mi">39</span><span class="w"> </span><span class="n">ca</span><span class="w">                </span><span class="n">cmp</span><span class="w">    </span><span class="o">%</span><span class="n">r9</span><span class="p">,</span><span class="o">%</span><span class="n">r10</span>
<span class="w">      </span><span class="n">c5</span>:   <span class="mi">0</span><span class="n">f</span><span class="w"> </span><span class="mi">82</span><span class="w"> </span><span class="mi">84</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w">       </span><span class="n">jb</span><span class="w">     </span><span class="mi">4</span><span class="n">f</span><span class="w"> </span><span class="o">&lt;</span><span class="n">wasm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>::<span class="n">function</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mh">0x4f</span><span class="o">&gt;</span>
<span class="w">      </span><span class="n">cb</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">47</span><span class="w"> </span><span class="mi">38</span><span class="w">             </span><span class="n">mov</span><span class="w">    </span><span class="mh">0x38</span><span class="p">(</span><span class="o">%</span><span class="n">rdi</span><span class="p">),</span><span class="o">%</span><span class="n">rax</span>
<span class="w">      </span><span class="n">cf</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">80</span><span class="w"> </span><span class="n">b0</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">    </span><span class="n">mov</span><span class="w">    </span><span class="mh">0xb0</span><span class="p">(</span><span class="o">%</span><span class="n">rax</span><span class="p">),</span><span class="o">%</span><span class="n">rax</span>
<span class="w">      </span><span class="n">d6</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">83</span><span class="w"> </span><span class="n">ec</span><span class="w"> </span><span class="mi">20</span><span class="w">             </span><span class="n">sub</span><span class="w">    </span><span class="cp">$</span><span class="mh">0x20</span><span class="p">,</span><span class="o">%</span><span class="n">rsp</span>
<span class="w">      </span><span class="n">da</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">89</span><span class="w"> </span><span class="n">f9</span><span class="w">                </span><span class="n">mov</span><span class="w">    </span><span class="o">%</span><span class="n">rdi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span>
<span class="w">      </span><span class="n">dd</span>:   <span class="nc">ff</span><span class="w"> </span><span class="n">d0</span><span class="w">                   </span><span class="n">callq</span><span class="w">  </span><span class="o">*%</span><span class="n">rax</span>
<span class="w">      </span><span class="n">df</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">83</span><span class="w"> </span><span class="n">c4</span><span class="w"> </span><span class="mi">20</span><span class="w">             </span><span class="n">add</span><span class="w">    </span><span class="cp">$</span><span class="mh">0x20</span><span class="p">,</span><span class="o">%</span><span class="n">rsp</span>
<span class="w">      </span><span class="n">e3</span>:   <span class="mi">49</span><span class="w"> </span><span class="mi">89</span><span class="w"> </span><span class="n">c1</span><span class="w">                </span><span class="n">mov</span><span class="w">    </span><span class="o">%</span><span class="n">rax</span><span class="p">,</span><span class="o">%</span><span class="n">r9</span>
<span class="w">      </span><span class="n">e6</span>:   <span class="nc">e9</span><span class="w"> </span><span class="mi">64</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w">          </span><span class="n">jmpq</span><span class="w">   </span><span class="mi">4</span><span class="n">f</span><span class="w"> </span><span class="o">&lt;</span><span class="n">wasm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>::<span class="n">function</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mh">0x4f</span><span class="o">&gt;</span>
<span class="w">      </span><span class="n">eb</span>:   <span class="mi">4</span><span class="n">c</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">4</span><span class="n">e</span><span class="w"> </span><span class="mi">10</span><span class="w">             </span><span class="n">mov</span><span class="w">    </span><span class="mh">0x10</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">),</span><span class="o">%</span><span class="n">r9</span>
<span class="w">      </span><span class="n">ef</span>:   <span class="mi">4</span><span class="n">d</span><span class="w"> </span><span class="mi">39</span><span class="w"> </span><span class="n">cb</span><span class="w">                </span><span class="n">cmp</span><span class="w">    </span><span class="o">%</span><span class="n">r9</span><span class="p">,</span><span class="o">%</span><span class="n">r11</span>
<span class="w">      </span><span class="n">f2</span>:   <span class="mi">0</span><span class="n">f</span><span class="w"> </span><span class="mi">82</span><span class="w"> </span><span class="mi">66</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w">       </span><span class="n">jb</span><span class="w">     </span><span class="mi">5</span><span class="n">e</span><span class="w"> </span><span class="o">&lt;</span><span class="n">wasm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>::<span class="n">function</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mh">0x5e</span><span class="o">&gt;</span>
<span class="w">      </span><span class="n">f8</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">4</span><span class="n">f</span><span class="w"> </span><span class="mi">38</span><span class="w">             </span><span class="n">mov</span><span class="w">    </span><span class="mh">0x38</span><span class="p">(</span><span class="o">%</span><span class="n">rdi</span><span class="p">),</span><span class="o">%</span><span class="n">rcx</span>
<span class="w">      </span><span class="n">fc</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">91</span><span class="w"> </span><span class="n">b0</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">    </span><span class="n">mov</span><span class="w">    </span><span class="mh">0xb0</span><span class="p">(</span><span class="o">%</span><span class="n">rcx</span><span class="p">),</span><span class="o">%</span><span class="n">rdx</span>
<span class="w">     </span><span class="mi">103</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">83</span><span class="w"> </span><span class="n">ec</span><span class="w"> </span><span class="mi">20</span><span class="w">             </span><span class="n">sub</span><span class="w">    </span><span class="cp">$</span><span class="mh">0x20</span><span class="p">,</span><span class="o">%</span><span class="n">rsp</span>
<span class="w">     </span><span class="mi">107</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">89</span><span class="w"> </span><span class="n">f9</span><span class="w">                </span><span class="n">mov</span><span class="w">    </span><span class="o">%</span><span class="n">rdi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span>
<span class="w">     </span><span class="mi">10</span><span class="n">a</span>:   <span class="nc">ff</span><span class="w"> </span><span class="n">d2</span><span class="w">                   </span><span class="n">callq</span><span class="w">  </span><span class="o">*%</span><span class="n">rdx</span>
<span class="w">     </span><span class="mi">10</span><span class="n">c</span>:   <span class="mi">48</span><span class="w"> </span><span class="mi">83</span><span class="w"> </span><span class="n">c4</span><span class="w"> </span><span class="mi">20</span><span class="w">             </span><span class="n">add</span><span class="w">    </span><span class="cp">$</span><span class="mh">0x20</span><span class="p">,</span><span class="o">%</span><span class="n">rsp</span>
<span class="w">     </span><span class="mi">110</span>:   <span class="mi">49</span><span class="w"> </span><span class="mi">89</span><span class="w"> </span><span class="n">c1</span><span class="w">                </span><span class="n">mov</span><span class="w">    </span><span class="o">%</span><span class="n">rax</span><span class="p">,</span><span class="o">%</span><span class="n">r9</span>
<span class="w">     </span><span class="mi">113</span>:   <span class="nc">e9</span><span class="w"> </span><span class="mi">46</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w">          </span><span class="n">jmpq</span><span class="w">   </span><span class="mi">5</span><span class="n">e</span><span class="w"> </span><span class="o">&lt;</span><span class="n">wasm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>::<span class="n">function</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mh">0x5e</span><span class="o">&gt;</span>
<span class="w">     </span><span class="mi">118</span>:   <span class="mi">0</span><span class="n">f</span><span class="w"> </span><span class="mi">0</span><span class="n">b</span><span class="w">                   </span><span class="n">ud2</span>
</code></pre></div>
<p>The above example assigns some registers, such as ax and cx, to the check block of epoch. Actually, this is just a simple example, and more complex workloads have a significant performance impact on the box_seal.wasm, the cost has reached 25%! And after trying to manually fix the issue with epoch (Unstable), the cost was only less than 7%.<br>
Especially for inner and outer loops, the outer loop uses r10 for storage, but the inner loop uses r11, which I cannot understand<br>
</p>
</blockquote>



<a name="396928848"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237244%20Epoch%20performance%20issues/near/396928848" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237244.20Epoch.20performance.20issues.html#396928848">(Oct 16 2023 at 15:30)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/7244#issuecomment-1764747399">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/7244">issue #7244</a>:</p>
<blockquote>
<p>Thanks for the report! Would you be able to share a wasm file or an example loop in source code to help reproduce this locally?</p>
</blockquote>



<a name="396931022"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237244%20Epoch%20performance%20issues/near/396931022" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237244.20Epoch.20performance.20issues.html#396931022">(Oct 16 2023 at 15:42)</a>:</h4>
<p>wjr-z <a href="https://github.com/bytecodealliance/wasmtime/issues/7244#issuecomment-1764769120">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/7244">issue #7244</a>:</p>
<blockquote>
<blockquote>
<p>Thanks for the report! Would you be able to share a wasm file or an example loop in source code to help reproduce this locally?</p>
</blockquote>
<p>Thank you for your reply. In fact, I am actively searching for the reason why I am interested in optimization.<br>
This is link to box_seal. wasm <a href="http://url">https://github.com/jedisct1/webassembly-benchmarks/blob/master/2021-Q1/wasm/box_seal.wasm</a><br>
Then, this is the code for the example loop.</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">(</span><span class="n">module</span>
<span class="w"> </span><span class="p">(</span><span class="n">export</span><span class="w"> </span><span class="s">"_start"</span><span class="w"> </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="cp">$_start</span><span class="p">))</span>
<span class="w"> </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="cp">$_start</span><span class="w"> </span><span class="p">(;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">;)</span>
<span class="w">    </span><span class="p">(</span><span class="n">local</span><span class="w"> </span><span class="cp">$i</span><span class="w"> </span><span class="kt">i32</span><span class="p">)</span>
<span class="w">    </span><span class="p">(</span><span class="n">local</span><span class="w"> </span><span class="cp">$i2</span><span class="w"> </span><span class="kt">i32</span><span class="p">)</span>
<span class="w">    </span><span class="kt">i32</span><span class="p">.</span><span class="k">const</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="n">local</span><span class="p">.</span><span class="n">set</span><span class="w"> </span><span class="cp">$i</span>
<span class="w">    </span><span class="k">loop</span><span class="w"> </span><span class="cp">$loop</span>
<span class="w">        </span><span class="kt">i32</span><span class="p">.</span><span class="k">const</span><span class="w"> </span><span class="mi">0</span>
<span class="w">        </span><span class="n">local</span><span class="p">.</span><span class="n">set</span><span class="w"> </span><span class="cp">$i2</span>
<span class="w">        </span><span class="k">loop</span><span class="w"> </span><span class="cp">$loop2</span>
<span class="w">            </span><span class="n">local</span><span class="p">.</span><span class="n">get</span><span class="w"> </span><span class="cp">$i2</span>
<span class="w">            </span><span class="kt">i32</span><span class="p">.</span><span class="k">const</span><span class="w"> </span><span class="mi">1</span>
<span class="w">            </span><span class="kt">i32</span><span class="p">.</span><span class="n">add</span>
<span class="w">            </span><span class="n">local</span><span class="p">.</span><span class="n">set</span><span class="w"> </span><span class="cp">$i2</span>
<span class="w">            </span><span class="n">local</span><span class="p">.</span><span class="n">get</span><span class="w"> </span><span class="cp">$i2</span>
<span class="w">            </span><span class="kt">i32</span><span class="p">.</span><span class="k">const</span><span class="w"> </span><span class="mi">80000</span>
<span class="w">            </span><span class="kt">i32</span><span class="p">.</span><span class="n">lt_s</span>
<span class="w">            </span><span class="n">br_if</span><span class="w"> </span><span class="cp">$loop2</span>
<span class="w">        </span><span class="n">end</span><span class="w"> </span><span class="cp">$loop2</span>
<span class="w">        </span><span class="n">local</span><span class="p">.</span><span class="n">get</span><span class="w"> </span><span class="cp">$i</span>
<span class="w">        </span><span class="kt">i32</span><span class="p">.</span><span class="k">const</span><span class="w"> </span><span class="mi">1</span>
<span class="w">        </span><span class="kt">i32</span><span class="p">.</span><span class="n">add</span>
<span class="w">        </span><span class="n">local</span><span class="p">.</span><span class="n">set</span><span class="w"> </span><span class="cp">$i</span>
<span class="w">        </span><span class="n">local</span><span class="p">.</span><span class="n">get</span><span class="w"> </span><span class="cp">$i</span>
<span class="w">        </span><span class="kt">i32</span><span class="p">.</span><span class="k">const</span><span class="w"> </span><span class="mi">40000</span>
<span class="w">        </span><span class="kt">i32</span><span class="p">.</span><span class="n">lt_s</span>
<span class="w">        </span><span class="n">br_if</span><span class="w"> </span><span class="cp">$loop</span>
<span class="w">    </span><span class="n">end</span><span class="w"> </span><span class="cp">$loop</span>
<span class="w"> </span><span class="p">)</span>
<span class="p">)</span>
</code></pre></div>
</blockquote>



<a name="396933525"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237244%20Epoch%20performance%20issues/near/396933525" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237244.20Epoch.20performance.20issues.html#396933525">(Oct 16 2023 at 15:57)</a>:</h4>
<p>wjr-z edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/7244#issuecomment-1764769120">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/7244">issue #7244</a>:</p>
<blockquote>
<blockquote>
<p>Thanks for the report! Would you be able to share a wasm file or an example loop in source code to help reproduce this locally?</p>
</blockquote>
<p>Thank you for your reply. In fact, I am actively searching for the reason .<br>
This is link to box_seal. wasm <a href="http://url">https://github.com/jedisct1/webassembly-benchmarks/blob/master/2021-Q1/wasm/box_seal.wasm</a><br>
Then, this is the code for the example loop.</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">(</span><span class="n">module</span>
<span class="w"> </span><span class="p">(</span><span class="n">export</span><span class="w"> </span><span class="s">"_start"</span><span class="w"> </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="cp">$_start</span><span class="p">))</span>
<span class="w"> </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="cp">$_start</span><span class="w"> </span><span class="p">(;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">;)</span>
<span class="w">    </span><span class="p">(</span><span class="n">local</span><span class="w"> </span><span class="cp">$i</span><span class="w"> </span><span class="kt">i32</span><span class="p">)</span>
<span class="w">    </span><span class="p">(</span><span class="n">local</span><span class="w"> </span><span class="cp">$i2</span><span class="w"> </span><span class="kt">i32</span><span class="p">)</span>
<span class="w">    </span><span class="kt">i32</span><span class="p">.</span><span class="k">const</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="n">local</span><span class="p">.</span><span class="n">set</span><span class="w"> </span><span class="cp">$i</span>
<span class="w">    </span><span class="k">loop</span><span class="w"> </span><span class="cp">$loop</span>
<span class="w">        </span><span class="kt">i32</span><span class="p">.</span><span class="k">const</span><span class="w"> </span><span class="mi">0</span>
<span class="w">        </span><span class="n">local</span><span class="p">.</span><span class="n">set</span><span class="w"> </span><span class="cp">$i2</span>
<span class="w">        </span><span class="k">loop</span><span class="w"> </span><span class="cp">$loop2</span>
<span class="w">            </span><span class="n">local</span><span class="p">.</span><span class="n">get</span><span class="w"> </span><span class="cp">$i2</span>
<span class="w">            </span><span class="kt">i32</span><span class="p">.</span><span class="k">const</span><span class="w"> </span><span class="mi">1</span>
<span class="w">            </span><span class="kt">i32</span><span class="p">.</span><span class="n">add</span>
<span class="w">            </span><span class="n">local</span><span class="p">.</span><span class="n">set</span><span class="w"> </span><span class="cp">$i2</span>
<span class="w">            </span><span class="n">local</span><span class="p">.</span><span class="n">get</span><span class="w"> </span><span class="cp">$i2</span>
<span class="w">            </span><span class="kt">i32</span><span class="p">.</span><span class="k">const</span><span class="w"> </span><span class="mi">80000</span>
<span class="w">            </span><span class="kt">i32</span><span class="p">.</span><span class="n">lt_s</span>
<span class="w">            </span><span class="n">br_if</span><span class="w"> </span><span class="cp">$loop2</span>
<span class="w">        </span><span class="n">end</span><span class="w"> </span><span class="cp">$loop2</span>
<span class="w">        </span><span class="n">local</span><span class="p">.</span><span class="n">get</span><span class="w"> </span><span class="cp">$i</span>
<span class="w">        </span><span class="kt">i32</span><span class="p">.</span><span class="k">const</span><span class="w"> </span><span class="mi">1</span>
<span class="w">        </span><span class="kt">i32</span><span class="p">.</span><span class="n">add</span>
<span class="w">        </span><span class="n">local</span><span class="p">.</span><span class="n">set</span><span class="w"> </span><span class="cp">$i</span>
<span class="w">        </span><span class="n">local</span><span class="p">.</span><span class="n">get</span><span class="w"> </span><span class="cp">$i</span>
<span class="w">        </span><span class="kt">i32</span><span class="p">.</span><span class="k">const</span><span class="w"> </span><span class="mi">40000</span>
<span class="w">        </span><span class="kt">i32</span><span class="p">.</span><span class="n">lt_s</span>
<span class="w">        </span><span class="n">br_if</span><span class="w"> </span><span class="cp">$loop</span>
<span class="w">    </span><span class="n">end</span><span class="w"> </span><span class="cp">$loop</span>
<span class="w"> </span><span class="p">)</span>
<span class="p">)</span>
</code></pre></div>
</blockquote>



<a name="396935526"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237244%20Epoch%20performance%20issues/near/396935526" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237244.20Epoch.20performance.20issues.html#396935526">(Oct 16 2023 at 16:07)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/7244#issuecomment-1764814103">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/7244">issue #7244</a>:</p>
<blockquote>
<p>Thanks! Could you detail a bit more what you mean by "manually fix the issue with epoch (Unstable), the cost was only less than 7%"? </p>
<p>Looking at the disassembly it's not obvious to me what the issue is and how such a large win could be gained, so I'm curious how you were able to achieve it!</p>
</blockquote>



<a name="397207218"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237244%20Epoch%20performance%20issues/near/397207218" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237244.20Epoch.20performance.20issues.html#397207218">(Oct 18 2023 at 01:17)</a>:</h4>
<p>wjr-z <a href="https://github.com/bytecodealliance/wasmtime/issues/7244#issuecomment-1767446017">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/7244">issue #7244</a>:</p>
<blockquote>
<blockquote>
<p>Thanks! Could you detail a bit more what you mean by "manually fix the issue with epoch (Unstable), the cost was only less than 7%"?</p>
<p>Looking at the disassembly it's not obvious to me what the issue is and how such a large win could be gained, so I'm curious how you were able to achieve it!</p>
</blockquote>
<p>Unfortunately, the data on the server was lost. I'll try to reproduce it next week.</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>