<html>
<head><meta charset="utf-8"><title>wasmtime / issue #7500 ISLE: make multi-constructors more... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237500.20ISLE.3A.20make.20multi-constructors.20more.2E.2E.2E.html">wasmtime / issue #7500 ISLE: make multi-constructors more...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="400972796"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237500%20ISLE%3A%20make%20multi-constructors%20more.../near/400972796" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237500.20ISLE.3A.20make.20multi-constructors.20more.2E.2E.2E.html#400972796">(Nov 08 2023 at 15:53)</a>:</h4>
<p><a href="https://github.com/fitzgen">fitzgen</a> added the isle label to <a href="https://github.com/bytecodealliance/wasmtime/issues/7500">Issue #7500</a>.</p>



<a name="400972801"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237500%20ISLE%3A%20make%20multi-constructors%20more.../near/400972801" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237500.20ISLE.3A.20make.20multi-constructors.20more.2E.2E.2E.html#400972801">(Nov 08 2023 at 15:53)</a>:</h4>
<p>fitzgen opened <a href="https://github.com/bytecodealliance/wasmtime/issues/7500">issue #7500</a>:</p>
<blockquote>
<ul>
<li>
<p>[ ] Instead of having the generated code construct and return an iterator on every call, callers should pass in a reusable vec that gets pushed onto. We use smallvecs right now, which is better than nothing, but once we exceed the inline capacity, we start making lots of temporary allocations.</p>
</li>
<li>
<p>[ ] We limit the number of rewritten values added to the egraph, and only consider the first 5 values returned by ISLE code:</p>
<p><a href="https://github.com/bytecodealliance/wasmtime/blob/b9f2a3060b95a479a5e52ad410f77d43bf1a2a59/cranelift/codegen/src/egraph.rs#L249-L260">https://github.com/bytecodealliance/wasmtime/blob/b9f2a3060b95a479a5e52ad410f77d43bf1a2a59/cranelift/codegen/src/egraph.rs#L249-L260</a></p>
<p>But the ISLE code still builds up an unbounded number of rewritten values to return. Ideally our rule set would never exhibit this behavior, but it does happen. Since we only take the first N anyways, the generated ISLE code should check if we've reached our max limit (configured at ISLE compile time? or maybe via the context?) and early return instead of spend time matching rewrites whose results will be ignored.</p>
</li>
</ul>
</blockquote>



<a name="400972977"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237500%20ISLE%3A%20make%20multi-constructors%20more.../near/400972977" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237500.20ISLE.3A.20make.20multi-constructors.20more.2E.2E.2E.html#400972977">(Nov 08 2023 at 15:54)</a>:</h4>
<p>github-actions[bot] <a href="https://github.com/bytecodealliance/wasmtime/issues/7500#issuecomment-1802177807">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/7500">issue #7500</a>:</p>
<blockquote>
<h4>Subscribe to Label Action</h4>
<p>cc @cfallin, @fitzgen</p>
<p>&lt;details&gt;<br>
This issue or pull request has been labeled: "isle"</p>
<p>Thus the following users have been cc'd because of the following labels:</p>
<ul>
<li>cfallin: isle</li>
<li>fitzgen: isle</li>
</ul>
<p>To subscribe or unsubscribe from this label, edit the &lt;code&gt;.github/subscribe-to-label.json&lt;/code&gt; configuration file.</p>
<p><a href="https://github.com/bytecodealliance/subscribe-to-label-action">Learn more.</a><br>
&lt;/details&gt;</p>
</blockquote>



<a name="401835160"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237500%20ISLE%3A%20make%20multi-constructors%20more.../near/401835160" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237500.20ISLE.3A.20make.20multi-constructors.20more.2E.2E.2E.html#401835160">(Nov 13 2023 at 19:56)</a>:</h4>
<p>fitzgen closed <a href="https://github.com/bytecodealliance/wasmtime/issues/7500">issue #7500</a>:</p>
<blockquote>
<ul>
<li>
<p>[ ] Instead of having the generated code construct and return an iterator on every call, callers should pass in a reusable vec that gets pushed onto. We use smallvecs right now, which is better than nothing, but once we exceed the inline capacity, we start making lots of temporary allocations.</p>
</li>
<li>
<p>[ ] We limit the number of rewritten values added to the egraph, and only consider the first 5 values returned by ISLE code:</p>
<p><a href="https://github.com/bytecodealliance/wasmtime/blob/b9f2a3060b95a479a5e52ad410f77d43bf1a2a59/cranelift/codegen/src/egraph.rs#L249-L260">https://github.com/bytecodealliance/wasmtime/blob/b9f2a3060b95a479a5e52ad410f77d43bf1a2a59/cranelift/codegen/src/egraph.rs#L249-L260</a></p>
<p>But the ISLE code still builds up an unbounded number of rewritten values to return. Ideally our rule set would never exhibit this behavior, but it does happen. Since we only take the first N anyways, the generated ISLE code should check if we've reached our max limit (configured at ISLE compile time? or maybe via the context?) and early return instead of spend time matching rewrites whose results will be ignored.</p>
</li>
</ul>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>