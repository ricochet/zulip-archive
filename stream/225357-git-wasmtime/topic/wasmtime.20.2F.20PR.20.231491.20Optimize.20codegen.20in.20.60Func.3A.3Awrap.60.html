<html>
<head><meta charset="utf-8"><title>wasmtime / PR #1491 Optimize codegen in `Func::wrap` · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231491.20Optimize.20codegen.20in.20.60Func.3A.3Awrap.60.html">wasmtime / PR #1491 Optimize codegen in `Func::wrap`</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="193497692"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231491%20Optimize%20codegen%20in%20%60Func%3A%3Awrap%60/near/193497692" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231491.20Optimize.20codegen.20in.20.60Func.3A.3Awrap.60.html#193497692">(Apr 09 2020 at 19:23)</a>:</h4>
<p>alexcrichton opened <a href="https://github.com/bytecodealliance/wasmtime/pull/1491" title="https://github.com/bytecodealliance/wasmtime/pull/1491">PR #1491</a> from <code>optimize-func-wrap</code> to <code>master</code>:</p>
<blockquote>
<p>This commit optimizes the codegen of <code>Func::wrap</code> such that if you do<br>
something like <code>Func::wrap(&amp;store, || {})</code> then the shim generated<br>
contains zero code (as expected). In general this means that the extra<br>
tidbits generated by wasmtime are all eligible to be entirely optimized<br>
away so long as you don't actually rely on something.</p>
</blockquote>



<a name="193588339"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231491%20Optimize%20codegen%20in%20%60Func%3A%3Awrap%60/near/193588339" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231491.20Optimize.20codegen.20in.20.60Func.3A.3Awrap.60.html#193588339">(Apr 10 2020 at 16:28)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/fitzgen" title="https://github.com/fitzgen">fitzgen</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/1491" title="https://github.com/bytecodealliance/wasmtime/pull/1491">PR #1491</a>.</p>



<a name="193595963"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231491%20Optimize%20codegen%20in%20%60Func%3A%3Awrap%60/near/193595963" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231491.20Optimize.20codegen.20in.20.60Func.3A.3Awrap.60.html#193595963">(Apr 10 2020 at 17:35)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1491#pullrequestreview-391566831" title="https://github.com/bytecodealliance/wasmtime/pull/1491#pullrequestreview-391566831">PR Review</a>.</p>



<a name="193595964"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231491%20Optimize%20codegen%20in%20%60Func%3A%3Awrap%60/near/193595964" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231491.20Optimize.20codegen.20in.20.60Func.3A.3Awrap.60.html#193595964">(Apr 10 2020 at 17:35)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1491#pullrequestreview-391566831" title="https://github.com/bytecodealliance/wasmtime/pull/1491#pullrequestreview-391566831">PR Review</a>.</p>



<a name="193595965"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231491%20Optimize%20codegen%20in%20%60Func%3A%3Awrap%60/near/193595965" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231491.20Optimize.20codegen.20in.20.60Func.3A.3Awrap.60.html#193595965">(Apr 10 2020 at 17:35)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/1491#discussion_r406862697" title="https://github.com/bytecodealliance/wasmtime/pull/1491#discussion_r406862697">PR Review Comment</a>:</p>
<blockquote>
<p>Seems a little simpler/more concise as</p>
<div class="codehilite"><pre><span></span><span class="n">debug_assert</span><span class="o">!</span><span class="p">(</span><span class="n">state</span><span class="p">.</span><span class="n">is</span>::<span class="o">&lt;</span><span class="p">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">Store</span><span class="p">)</span><span class="o">&gt;</span><span class="p">());</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">func</span><span class="p">,</span><span class="w"> </span><span class="n">store</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;*</span><span class="p">(</span><span class="n">state</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="o">*</span><span class="k">const</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="o">*</span><span class="k">const</span><span class="w"> </span><span class="p">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">Store</span><span class="p">));</span><span class="w"></span>
</pre></div>


</blockquote>



<a name="193597664"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231491%20Optimize%20codegen%20in%20%60Func%3A%3Awrap%60/near/193597664" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231491.20Optimize.20codegen.20in.20.60Func.3A.3Awrap.60.html#193597664">(Apr 10 2020 at 17:51)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1491" title="https://github.com/bytecodealliance/wasmtime/pull/1491">PR #1491</a> from <code>optimize-func-wrap</code> to <code>master</code>:</p>
<blockquote>
<p>This commit optimizes the codegen of <code>Func::wrap</code> such that if you do<br>
something like <code>Func::wrap(&amp;store, || {})</code> then the shim generated<br>
contains zero code (as expected). In general this means that the extra<br>
tidbits generated by wasmtime are all eligible to be entirely optimized<br>
away so long as you don't actually rely on something.</p>
</blockquote>



<a name="193597727"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231491%20Optimize%20codegen%20in%20%60Func%3A%3Awrap%60/near/193597727" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231491.20Optimize.20codegen.20in.20.60Func.3A.3Awrap.60.html#193597727">(Apr 10 2020 at 17:52)</a>:</h4>
<p>alexcrichton merged <a href="https://github.com/bytecodealliance/wasmtime/pull/1491" title="https://github.com/bytecodealliance/wasmtime/pull/1491">PR #1491</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>