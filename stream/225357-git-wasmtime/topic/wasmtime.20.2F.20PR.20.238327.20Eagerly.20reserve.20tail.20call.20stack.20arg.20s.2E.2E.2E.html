<html>
<head><meta charset="utf-8"><title>wasmtime / PR #8327 Eagerly reserve tail call stack arg s... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238327.20Eagerly.20reserve.20tail.20call.20stack.20arg.20s.2E.2E.2E.html">wasmtime / PR #8327 Eagerly reserve tail call stack arg s...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="432607412"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238327%20Eagerly%20reserve%20tail%20call%20stack%20arg%20s.../near/432607412" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238327.20Eagerly.20reserve.20tail.20call.20stack.20arg.20s.2E.2E.2E.html#432607412">(Apr 11 2024 at 00:08)</a>:</h4>
<p>elliottt opened <a href="https://github.com/bytecodealliance/wasmtime/pull/8327">PR #8327</a> from <code>elliottt:trevor/eagerly-reserve-tail-call-arg-space</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>Rebased on #8319</p>
<p>Instead of explicitly growing and shrinking the stack argument area for a tail call, resize it to the maximum needed in the function prologue, and shrink when a tail call happens.</p>
<p>&lt;!--<br>
Please make sure you include the following information:</p>
<ul>
<li>
<p>If this work has been discussed elsewhere, please include a link to that<br>
  conversation. If it was discussed in an issue, just mention "issue #...".</p>
</li>
<li>
<p>Explain why this change is needed. If the details are in an issue already,<br>
  this can be brief.</p>
</li>
</ul>
<p>Our development process is documented in the Wasmtime book:<br>
<a href="https://docs.wasmtime.dev/contributing-development-process.html">https://docs.wasmtime.dev/contributing-development-process.html</a></p>
<p>Please ensure all communication follows the code of conduct:<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>
--&gt;</p>
</blockquote>



<a name="432607439"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238327%20Eagerly%20reserve%20tail%20call%20stack%20arg%20s.../near/432607439" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238327.20Eagerly.20reserve.20tail.20call.20stack.20arg.20s.2E.2E.2E.html#432607439">(Apr 11 2024 at 00:08)</a>:</h4>
<p>elliottt edited <a href="https://github.com/bytecodealliance/wasmtime/pull/8327">PR #8327</a>:</p>
<blockquote>
<p>Rebased on #8319</p>
<p>Instead of explicitly growing and shrinking the stack argument area for a tail call, resize it to the maximum needed in the function prologue, and shrink when a tail call happens.</p>
<p>Co-authored-by: Jamey Sharp &lt;<a href="mailto:jsharp@fastly.com">jsharp@fastly.com</a>&gt;</p>
<p>&lt;!--<br>
Please make sure you include the following information:</p>
<ul>
<li>
<p>If this work has been discussed elsewhere, please include a link to that<br>
  conversation. If it was discussed in an issue, just mention "issue #...".</p>
</li>
<li>
<p>Explain why this change is needed. If the details are in an issue already,<br>
  this can be brief.</p>
</li>
</ul>
<p>Our development process is documented in the Wasmtime book:<br>
<a href="https://docs.wasmtime.dev/contributing-development-process.html">https://docs.wasmtime.dev/contributing-development-process.html</a></p>
<p>Please ensure all communication follows the code of conduct:<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>
--&gt;</p>
</blockquote>



<a name="432761988"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238327%20Eagerly%20reserve%20tail%20call%20stack%20arg%20s.../near/432761988" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238327.20Eagerly.20reserve.20tail.20call.20stack.20arg.20s.2E.2E.2E.html#432761988">(Apr 11 2024 at 18:14)</a>:</h4>
<p>jameysharp submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8327#pullrequestreview-1994929763">PR review</a>.</p>



<a name="432761991"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238327%20Eagerly%20reserve%20tail%20call%20stack%20arg%20s.../near/432761991" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238327.20Eagerly.20reserve.20tail.20call.20stack.20arg.20s.2E.2E.2E.html#432761991">(Apr 11 2024 at 18:14)</a>:</h4>
<p>jameysharp created <a href="https://github.com/bytecodealliance/wasmtime/pull/8327#discussion_r1561444671">PR review comment</a>:</p>
<blockquote>
<p>If we switch <code>IncomingArg</code> to holding offsets from the highest address in the incoming argument area, instead of the lowest address, then we don't need to also store the size of the incoming argument area with it. Finalizing such an amode then amounts to finding the highest address in the stack frame (e.g. <code>rbp</code> plus the <code>setup_area_size</code> and <code>stack_args_size</code> from the frame layout), then subtracting the offset that's in <code>IncomingArg</code>.</p>
</blockquote>



<a name="432764721"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238327%20Eagerly%20reserve%20tail%20call%20stack%20arg%20s.../near/432764721" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238327.20Eagerly.20reserve.20tail.20call.20stack.20arg.20s.2E.2E.2E.html#432764721">(Apr 11 2024 at 18:30)</a>:</h4>
<p>elliottt updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8327">PR #8327</a>.</p>



<a name="432765765"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238327%20Eagerly%20reserve%20tail%20call%20stack%20arg%20s.../near/432765765" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238327.20Eagerly.20reserve.20tail.20call.20stack.20arg.20s.2E.2E.2E.html#432765765">(Apr 11 2024 at 18:37)</a>:</h4>
<p>elliottt updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8327">PR #8327</a>.</p>



<a name="432766587"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238327%20Eagerly%20reserve%20tail%20call%20stack%20arg%20s.../near/432766587" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238327.20Eagerly.20reserve.20tail.20call.20stack.20arg.20s.2E.2E.2E.html#432766587">(Apr 11 2024 at 18:43)</a>:</h4>
<p>elliottt updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8327">PR #8327</a>.</p>



<a name="432768673"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238327%20Eagerly%20reserve%20tail%20call%20stack%20arg%20s.../near/432768673" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238327.20Eagerly.20reserve.20tail.20call.20stack.20arg.20s.2E.2E.2E.html#432768673">(Apr 11 2024 at 18:57)</a>:</h4>
<p>elliottt updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8327">PR #8327</a>.</p>



<a name="432777979"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238327%20Eagerly%20reserve%20tail%20call%20stack%20arg%20s.../near/432777979" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238327.20Eagerly.20reserve.20tail.20call.20stack.20arg.20s.2E.2E.2E.html#432777979">(Apr 11 2024 at 19:59)</a>:</h4>
<p>elliottt updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8327">PR #8327</a>.</p>



<a name="432785181"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238327%20Eagerly%20reserve%20tail%20call%20stack%20arg%20s.../near/432785181" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238327.20Eagerly.20reserve.20tail.20call.20stack.20arg.20s.2E.2E.2E.html#432785181">(Apr 11 2024 at 20:50)</a>:</h4>
<p><strong>jameysharp</strong> has marked <a href="https://github.com/bytecodealliance/wasmtime/pull/8327">PR #8327</a> as ready for review.</p>



<a name="432785185"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238327%20Eagerly%20reserve%20tail%20call%20stack%20arg%20s.../near/432785185" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238327.20Eagerly.20reserve.20tail.20call.20stack.20arg.20s.2E.2E.2E.html#432785185">(Apr 11 2024 at 20:50)</a>:</h4>
<p><strong>jameysharp</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-compiler-reviewers">wasmtime-compiler-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/8327">PR #8327</a>.</p>



<a name="432785186"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238327%20Eagerly%20reserve%20tail%20call%20stack%20arg%20s.../near/432785186" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238327.20Eagerly.20reserve.20tail.20call.20stack.20arg.20s.2E.2E.2E.html#432785186">(Apr 11 2024 at 20:50)</a>:</h4>
<p><strong>jameysharp</strong> requested <a href="https://github.com/abrown">abrown</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/8327">PR #8327</a>.</p>



<a name="432785475"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238327%20Eagerly%20reserve%20tail%20call%20stack%20arg%20s.../near/432785475" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238327.20Eagerly.20reserve.20tail.20call.20stack.20arg.20s.2E.2E.2E.html#432785475">(Apr 11 2024 at 20:52)</a>:</h4>
<p>elliottt edited <a href="https://github.com/bytecodealliance/wasmtime/pull/8327">PR #8327</a>:</p>
<blockquote>
<p>Instead of explicitly growing and shrinking the stack argument area for a tail call, resize it to the maximum needed in the function prologue, and shrink when a tail call happens.</p>
<p>Co-authored-by: Jamey Sharp &lt;<a href="mailto:jsharp@fastly.com">jsharp@fastly.com</a>&gt;</p>
<p>&lt;!--<br>
Please make sure you include the following information:</p>
<ul>
<li>
<p>If this work has been discussed elsewhere, please include a link to that<br>
  conversation. If it was discussed in an issue, just mention "issue #...".</p>
</li>
<li>
<p>Explain why this change is needed. If the details are in an issue already,<br>
  this can be brief.</p>
</li>
</ul>
<p>Our development process is documented in the Wasmtime book:<br>
<a href="https://docs.wasmtime.dev/contributing-development-process.html">https://docs.wasmtime.dev/contributing-development-process.html</a></p>
<p>Please ensure all communication follows the code of conduct:<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>
--&gt;</p>
</blockquote>



<a name="432791201"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238327%20Eagerly%20reserve%20tail%20call%20stack%20arg%20s.../near/432791201" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238327.20Eagerly.20reserve.20tail.20call.20stack.20arg.20s.2E.2E.2E.html#432791201">(Apr 11 2024 at 21:32)</a>:</h4>
<p><strong>elliottt</strong> requested <a href="https://github.com/fitzgen">fitzgen</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/8327">PR #8327</a>.</p>



<a name="432791702"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238327%20Eagerly%20reserve%20tail%20call%20stack%20arg%20s.../near/432791702" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238327.20Eagerly.20reserve.20tail.20call.20stack.20arg.20s.2E.2E.2E.html#432791702">(Apr 11 2024 at 21:36)</a>:</h4>
<p>elliottt edited <a href="https://github.com/bytecodealliance/wasmtime/pull/8327">PR #8327</a>:</p>
<blockquote>
<p>Instead of explicitly growing and shrinking the incoming stack argument area for a tail call, resize it to the maximum needed in the function prologue. This ensures that we have enough space for any tail call present within the function body, however if the tail-callee requires fewer stack arguments we shrink the incoming argument area before jumping to it.</p>
<p>This change is currently only implemented for the x64 backend, but does greatly simplify the generated code as we no longer need to move the contents of the frame when resizing the incoming argument area. Accordingly, we've deleted the <code>ShrinkArgumentArea</code> and <code>GrowArgumentArea</code> pseudo-instructions, as they're no longer necessary.</p>
<p>Co-authored-by: Jamey Sharp &lt;<a href="mailto:jsharp@fastly.com">jsharp@fastly.com</a>&gt;</p>
<p>&lt;!--<br>
Please make sure you include the following information:</p>
<ul>
<li>
<p>If this work has been discussed elsewhere, please include a link to that<br>
  conversation. If it was discussed in an issue, just mention "issue #...".</p>
</li>
<li>
<p>Explain why this change is needed. If the details are in an issue already,<br>
  this can be brief.</p>
</li>
</ul>
<p>Our development process is documented in the Wasmtime book:<br>
<a href="https://docs.wasmtime.dev/contributing-development-process.html">https://docs.wasmtime.dev/contributing-development-process.html</a></p>
<p>Please ensure all communication follows the code of conduct:<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>
--&gt;</p>
</blockquote>



<a name="432792922"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238327%20Eagerly%20reserve%20tail%20call%20stack%20arg%20s.../near/432792922" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238327.20Eagerly.20reserve.20tail.20call.20stack.20arg.20s.2E.2E.2E.html#432792922">(Apr 11 2024 at 21:46)</a>:</h4>
<p>elliottt updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8327">PR #8327</a>.</p>



<a name="432792926"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238327%20Eagerly%20reserve%20tail%20call%20stack%20arg%20s.../near/432792926" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238327.20Eagerly.20reserve.20tail.20call.20stack.20arg.20s.2E.2E.2E.html#432792926">(Apr 11 2024 at 21:46)</a>:</h4>
<p>elliottt edited <a href="https://github.com/bytecodealliance/wasmtime/pull/8327">PR #8327</a>:</p>
<blockquote>
<p><code>return_call</code> instructions reuse the incoming argument area of the caller's frame. As such if the caller's incoming argument area is  not exactly the right size for the callee, some resizing will need to take place to ensure that the return address, frame pointer, clobbers, and stack slots don't get overwritten. The current solution on the main branch for the x64 backend is to explicitly resize the frame via <code>ShrinkArgumentArea</code> or <code>GrowArgumentArea</code> right before the <code>return_call</code> arguments are written to the stack, ensuring that there is sufficient space. While this does work, it does make a <code>return_call</code> more expensive when the resizing is necessary.</p>
<p>To simplify this, we instead resize the incoming argument area in the function prologue to accommodate the largest possible argument area of any <code>return_call</code> instruction in the function. We then shrink back down when necessary before an individual <code>return_call</code>. This simplifies the implementation of tail calls on x86_64, as we no longer need to move the entire frame, just the return address before we jump to the tail-callee.</p>
<p>Co-authored-by: Jamey Sharp &lt;<a href="mailto:jsharp@fastly.com">jsharp@fastly.com</a>&gt;</p>
<p>&lt;!--<br>
Please make sure you include the following information:</p>
<ul>
<li>
<p>If this work has been discussed elsewhere, please include a link to that<br>
  conversation. If it was discussed in an issue, just mention "issue #...".</p>
</li>
<li>
<p>Explain why this change is needed. If the details are in an issue already,<br>
  this can be brief.</p>
</li>
</ul>
<p>Our development process is documented in the Wasmtime book:<br>
<a href="https://docs.wasmtime.dev/contributing-development-process.html">https://docs.wasmtime.dev/contributing-development-process.html</a></p>
<p>Please ensure all communication follows the code of conduct:<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>
--&gt;</p>
</blockquote>



<a name="432793846"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238327%20Eagerly%20reserve%20tail%20call%20stack%20arg%20s.../near/432793846" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238327.20Eagerly.20reserve.20tail.20call.20stack.20arg.20s.2E.2E.2E.html#432793846">(Apr 11 2024 at 21:55)</a>:</h4>
<p>elliottt updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8327">PR #8327</a>.</p>



<a name="432800588"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238327%20Eagerly%20reserve%20tail%20call%20stack%20arg%20s.../near/432800588" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238327.20Eagerly.20reserve.20tail.20call.20stack.20arg.20s.2E.2E.2E.html#432800588">(Apr 11 2024 at 22:58)</a>:</h4>
<p>elliottt submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8327#pullrequestreview-1995606569">PR review</a>.</p>



<a name="432800595"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238327%20Eagerly%20reserve%20tail%20call%20stack%20arg%20s.../near/432800595" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238327.20Eagerly.20reserve.20tail.20call.20stack.20arg.20s.2E.2E.2E.html#432800595">(Apr 11 2024 at 22:58)</a>:</h4>
<p>elliottt created <a href="https://github.com/bytecodealliance/wasmtime/pull/8327#discussion_r1561836257">PR review comment</a>:</p>
<blockquote>
<p>We may need to add this to <code>offset_upward_to_caller_sp</code> in the unwind info below.</p>
</blockquote>



<a name="432801182"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238327%20Eagerly%20reserve%20tail%20call%20stack%20arg%20s.../near/432801182" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238327.20Eagerly.20reserve.20tail.20call.20stack.20arg.20s.2E.2E.2E.html#432801182">(Apr 11 2024 at 23:03)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8327#pullrequestreview-1995601264">PR review</a>:</p>
<blockquote>
<p>Nice!</p>
</blockquote>



<a name="432801183"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238327%20Eagerly%20reserve%20tail%20call%20stack%20arg%20s.../near/432801183" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238327.20Eagerly.20reserve.20tail.20call.20stack.20arg.20s.2E.2E.2E.html#432801183">(Apr 11 2024 at 23:03)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8327#pullrequestreview-1995601264">PR review</a>:</p>
<blockquote>
<p>Nice!</p>
</blockquote>



<a name="432801184"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238327%20Eagerly%20reserve%20tail%20call%20stack%20arg%20s.../near/432801184" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238327.20Eagerly.20reserve.20tail.20call.20stack.20arg.20s.2E.2E.2E.html#432801184">(Apr 11 2024 at 23:03)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/8327#discussion_r1561832601">PR review comment</a>:</p>
<blockquote>
<p><span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span> </p>
</blockquote>



<a name="432801185"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238327%20Eagerly%20reserve%20tail%20call%20stack%20arg%20s.../near/432801185" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238327.20Eagerly.20reserve.20tail.20call.20stack.20arg.20s.2E.2E.2E.html#432801185">(Apr 11 2024 at 23:03)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/8327#discussion_r1561838565">PR review comment</a>:</p>
<blockquote>
<p>Definitely not a blocker for landing this PR, but it would be nice if we could get this to be a single <code>sub $rsp, M+N</code> followed by <code>mov temp, [$rsp + OLD_RA_OFFSET]; mov [$rsp + NEW_RA_OFFSET]</code> and similar for the saved FP, instead of an initial sub to establish the frame followed by a second sub for tail call arguments space.</p>
</blockquote>



<a name="432801520"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238327%20Eagerly%20reserve%20tail%20call%20stack%20arg%20s.../near/432801520" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238327.20Eagerly.20reserve.20tail.20call.20stack.20arg.20s.2E.2E.2E.html#432801520">(Apr 11 2024 at 23:06)</a>:</h4>
<p>elliottt submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8327#pullrequestreview-1995613069">PR review</a>.</p>



<a name="432801521"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238327%20Eagerly%20reserve%20tail%20call%20stack%20arg%20s.../near/432801521" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238327.20Eagerly.20reserve.20tail.20call.20stack.20arg.20s.2E.2E.2E.html#432801521">(Apr 11 2024 at 23:06)</a>:</h4>
<p>elliottt created <a href="https://github.com/bytecodealliance/wasmtime/pull/8327#discussion_r1561840717">PR review comment</a>:</p>
<blockquote>
<p>We're experimenting with that on a different branch based on this PR, as a follow-up. Moving the stack check before the frame setup means that we can cut out even more instructions, as there's no need to move the frame pointer as well.</p>
</blockquote>



<a name="433362054"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238327%20Eagerly%20reserve%20tail%20call%20stack%20arg%20s.../near/433362054" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238327.20Eagerly.20reserve.20tail.20call.20stack.20arg.20s.2E.2E.2E.html#433362054">(Apr 15 2024 at 18:45)</a>:</h4>
<p>elliottt updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8327">PR #8327</a>.</p>



<a name="433362371"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238327%20Eagerly%20reserve%20tail%20call%20stack%20arg%20s.../near/433362371" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238327.20Eagerly.20reserve.20tail.20call.20stack.20arg.20s.2E.2E.2E.html#433362371">(Apr 15 2024 at 18:47)</a>:</h4>
<p>elliottt updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8327">PR #8327</a>.</p>



<a name="433362752"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238327%20Eagerly%20reserve%20tail%20call%20stack%20arg%20s.../near/433362752" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238327.20Eagerly.20reserve.20tail.20call.20stack.20arg.20s.2E.2E.2E.html#433362752">(Apr 15 2024 at 18:49)</a>:</h4>
<p>elliottt updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8327">PR #8327</a>.</p>



<a name="433380212"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238327%20Eagerly%20reserve%20tail%20call%20stack%20arg%20s.../near/433380212" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238327.20Eagerly.20reserve.20tail.20call.20stack.20arg.20s.2E.2E.2E.html#433380212">(Apr 15 2024 at 20:25)</a>:</h4>
<p>elliottt merged <a href="https://github.com/bytecodealliance/wasmtime/pull/8327">PR #8327</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>