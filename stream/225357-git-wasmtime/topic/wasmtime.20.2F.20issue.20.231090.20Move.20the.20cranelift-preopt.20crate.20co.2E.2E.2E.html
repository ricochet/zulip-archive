<html>
<head><meta charset="utf-8"><title>wasmtime / issue #1090 Move the cranelift-preopt crate co... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.231090.20Move.20the.20cranelift-preopt.20crate.20co.2E.2E.2E.html">wasmtime / issue #1090 Move the cranelift-preopt crate co...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="281218124"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%231090%20Move%20the%20cranelift-preopt%20crate%20co.../near/281218124" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.231090.20Move.20the.20cranelift-preopt.20crate.20co.2E.2E.2E.html#281218124">(May 04 2022 at 20:55)</a>:</h4>
<p>cfallin labeled <a href="https://github.com/bytecodealliance/wasmtime/issues/1090">issue #1090</a>:</p>
<blockquote>
<p>I think cranelift-preopt was separated from cranelift-codegen because we assume that, in general, the input IR has been generated by an optimizing compiler (namely, one that ran constant folding). This being said, in our use case, when translating wasm to clif, we're likely to introduce redundancies and constant-foldable instructions that aren't obvious to catch (because we're operating on one wasm binary opcode at a time). There was also another instance of constant-foldable operations being emitted by legalization recently.</p>
<p>In principle, every pass that takes IR and augments it (by adding more IR nodes) is likely to introduce redundancies / constant-foldable instructions. I'd like someone to get more data on this, but how would people feel about putting the cranelift-preopt constant folding facilities into codegen instead?</p>
</blockquote>



<a name="323814756"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%231090%20Move%20the%20cranelift-preopt%20crate%20co.../near/323814756" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.231090.20Move.20the.20cranelift-preopt.20crate.20co.2E.2E.2E.html#323814756">(Jan 26 2023 at 18:59)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/issues/1090#issuecomment-1405463071">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/1090">issue #1090</a>:</p>
<blockquote>
<p>This could be merged into the egraph impl, right?</p>
</blockquote>



<a name="323819913"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%231090%20Move%20the%20cranelift-preopt%20crate%20co.../near/323819913" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.231090.20Move.20the.20cranelift-preopt.20crate.20co.2E.2E.2E.html#323819913">(Jan 26 2023 at 19:23)</a>:</h4>
<p>jameysharp <a href="https://github.com/bytecodealliance/wasmtime/issues/1090#issuecomment-1405492024">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/1090">issue #1090</a>:</p>
<blockquote>
<p>I didn't know cranelift-preopt existed. Wow. Looks like 1) most of it is covered by <code>cprop.isle</code> in the egraph work already; 2) the cranelift-preopt rules for <code>udiv</code> are wrong in two ways I think?</p>
<p>We should add appropriate floating-point rules to <code>cprop.isle</code>, but even without that I'd be inclined to just delete this crate, unless somebody has objections.</p>
</blockquote>



<a name="323824461"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%231090%20Move%20the%20cranelift-preopt%20crate%20co.../near/323824461" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.231090.20Move.20the.20cranelift-preopt.20crate.20co.2E.2E.2E.html#323824461">(Jan 26 2023 at 19:46)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/issues/1090#issuecomment-1405535647">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/1090">issue #1090</a>:</p>
<blockquote>
<p>No objections from me. I don't use it in cg_clif.</p>
</blockquote>



<a name="323913261"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%231090%20Move%20the%20cranelift-preopt%20crate%20co.../near/323913261" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.231090.20Move.20the.20cranelift-preopt.20crate.20co.2E.2E.2E.html#323913261">(Jan 26 2023 at 21:32)</a>:</h4>
<p>jameysharp closed <a href="https://github.com/bytecodealliance/wasmtime/issues/1090">issue #1090</a>:</p>
<blockquote>
<p>I think cranelift-preopt was separated from cranelift-codegen because we assume that, in general, the input IR has been generated by an optimizing compiler (namely, one that ran constant folding). This being said, in our use case, when translating wasm to clif, we're likely to introduce redundancies and constant-foldable instructions that aren't obvious to catch (because we're operating on one wasm binary opcode at a time). There was also another instance of constant-foldable operations being emitted by legalization recently.</p>
<p>In principle, every pass that takes IR and augments it (by adding more IR nodes) is likely to introduce redundancies / constant-foldable instructions. I'd like someone to get more data on this, but how would people feel about putting the cranelift-preopt constant folding facilities into codegen instead?</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>