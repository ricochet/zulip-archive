<html>
<head><meta charset="utf-8"><title>wasmtime / PR #4202 Refactor some internals of wasmtime-c... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234202.20Refactor.20some.20internals.20of.20wasmtime-c.2E.2E.2E.html">wasmtime / PR #4202 Refactor some internals of wasmtime-c...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="284646876"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234202%20Refactor%20some%20internals%20of%20wasmtime-c.../near/284646876" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234202.20Refactor.20some.20internals.20of.20wasmtime-c.2E.2E.2E.html#284646876">(Jun 01 2022 at 17:55)</a>:</h4>
<p>alexcrichton opened <a href="https://github.com/bytecodealliance/wasmtime/pull/4202">PR #4202</a> from <code>refactor-cranelift-obj-builder</code> to <code>main</code>:</p>
<blockquote>
<p>In an effort to make future PRs for component-model functionality smaller I'm splitting off pieces into smaller PRs to get independently reviewed ahead of time. This round of refactorings for wasmtime-cranelift is targeted at splitting out pieces which will be used for the component model. Specifically the wasm-to-host trampoline function was split into components (hah) and the <code>ObjectBuilder</code> type was refactored to remove unwind information and additionally split out dwarf processing into the main <code>Compiler</code> type.</p>
</blockquote>



<a name="284646878"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234202%20Refactor%20some%20internals%20of%20wasmtime-c.../near/284646878" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234202.20Refactor.20some.20internals.20of.20wasmtime-c.2E.2E.2E.html#284646878">(Jun 01 2022 at 17:55)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/fitzgen">fitzgen</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/4202">PR #4202</a>.</p>



<a name="284649546"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234202%20Refactor%20some%20internals%20of%20wasmtime-c.../near/284649546" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234202.20Refactor.20some.20internals.20of.20wasmtime-c.2E.2E.2E.html#284649546">(Jun 01 2022 at 18:15)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4202#pullrequestreview-992489363">PR review</a>.</p>



<a name="284649547"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234202%20Refactor%20some%20internals%20of%20wasmtime-c.../near/284649547" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234202.20Refactor.20some.20internals.20of.20wasmtime-c.2E.2E.2E.html#284649547">(Jun 01 2022 at 18:15)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/4202#discussion_r887163601">PR review comment</a>:</p>
<blockquote>
<p><div class="codehilite" data-code-language="suggestion"><pre><span></span><code>       // Write all debug data relocations.
</code></pre></div><br>
</p>
</blockquote>



<a name="284650733"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234202%20Refactor%20some%20internals%20of%20wasmtime-c.../near/284650733" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234202.20Refactor.20some.20internals.20of.20wasmtime-c.2E.2E.2E.html#284650733">(Jun 01 2022 at 18:24)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4202">PR #4202</a> from <code>refactor-cranelift-obj-builder</code> to <code>main</code>.</p>



<a name="284660468"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234202%20Refactor%20some%20internals%20of%20wasmtime-c.../near/284660468" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234202.20Refactor.20some.20internals.20of.20wasmtime-c.2E.2E.2E.html#284660468">(Jun 01 2022 at 19:47)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4202#pullrequestreview-992492932">PR review</a>.</p>



<a name="284660469"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234202%20Refactor%20some%20internals%20of%20wasmtime-c.../near/284660469" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234202.20Refactor.20some.20internals.20of.20wasmtime-c.2E.2E.2E.html#284660469">(Jun 01 2022 at 19:47)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4202#pullrequestreview-992492932">PR review</a>.</p>



<a name="284660470"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234202%20Refactor%20some%20internals%20of%20wasmtime-c.../near/284660470" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234202.20Refactor.20some.20internals.20of.20wasmtime-c.2E.2E.2E.html#284660470">(Jun 01 2022 at 19:47)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/4202#discussion_r887165025">PR review comment</a>:</p>
<blockquote>
<p>Pre-existing, but why do we pass <code>host_fn</code> as a <code>usize</code> rather than a function pointer with the appropriate signature that we then cast to an integer here?</p>
</blockquote>



<a name="284666445"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234202%20Refactor%20some%20internals%20of%20wasmtime-c.../near/284666445" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234202.20Refactor.20some.20internals.20of.20wasmtime-c.2E.2E.2E.html#284666445">(Jun 01 2022 at 20:39)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4202#pullrequestreview-992651843">PR review</a>.</p>



<a name="284666446"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234202%20Refactor%20some%20internals%20of%20wasmtime-c.../near/284666446" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234202.20Refactor.20some.20internals.20of.20wasmtime-c.2E.2E.2E.html#284666446">(Jun 01 2022 at 20:39)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4202#discussion_r887278834">PR review comment</a>:</p>
<blockquote>
<p>That's a good question...</p>
<p>Looking into it it appears that it's because the compiler type is defined in the <code>wasmtime-environ</code> crate but the types for the function pointer signature (e.g. <code>VMContext</code> and <code>ValRaw</code>) are located in the <code>wasmtime-runtime</code> crate which <code>wasmtime-cranelift</code> doesn't depend on, so I think the dependency tree is thwarting that plumbing of information.</p>
</blockquote>



<a name="284666460"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234202%20Refactor%20some%20internals%20of%20wasmtime-c.../near/284666460" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234202.20Refactor.20some.20internals.20of.20wasmtime-c.2E.2E.2E.html#284666460">(Jun 01 2022 at 20:39)</a>:</h4>
<p>alexcrichton merged <a href="https://github.com/bytecodealliance/wasmtime/pull/4202">PR #4202</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>