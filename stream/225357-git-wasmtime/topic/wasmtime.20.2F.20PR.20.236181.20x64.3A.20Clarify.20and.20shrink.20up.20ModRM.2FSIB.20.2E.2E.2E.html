<html>
<head><meta charset="utf-8"><title>wasmtime / PR #6181 x64: Clarify and shrink up ModRM/SIB ... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236181.20x64.3A.20Clarify.20and.20shrink.20up.20ModRM.2FSIB.20.2E.2E.2E.html">wasmtime / PR #6181 x64: Clarify and shrink up ModRM/SIB ...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="347737343"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236181%20x64%3A%20Clarify%20and%20shrink%20up%20ModRM/SIB%20.../near/347737343" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236181.20x64.3A.20Clarify.20and.20shrink.20up.20ModRM.2FSIB.20.2E.2E.2E.html#347737343">(Apr 07 2023 at 20:00)</a>:</h4>
<p>alexcrichton opened <a href="https://github.com/bytecodealliance/wasmtime/pull/6181">PR #6181</a> from <code>alexcrichton:improve-modrm</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>I noticed recently that for the <code>ImmRegRegShift</code> addressing mode Cranelift will unconditionally emit at least a 1-byte immediate for the offset to be added to the register addition computation, even when the offset is zero. In this case though the instruction encoding can be slightly more compact and remove a byte. This commit started off by applying this optimization, which resulted in the <code>*.clif</code> test changes in this commit.</p>
<p>Further reading this code, however, I personally found it quite hard to follow what was happening with all the various branches and ModRM/SIB bits. I reviewed these encodings in the x64 architecture manual and attempted to improve the logic for encoding here. The new version in this commit is intended to be functionally equivalent to the prior version where dropping a zero-offset from the <code>ImmRegRegShift</code> variant is the only change.</p>
<p>&lt;!--<br>
Please make sure you include the following information:</p>
<ul>
<li>
<p>If this work has been discussed elsewhere, please include a link to that<br>
  conversation. If it was discussed in an issue, just mention "issue #...".</p>
</li>
<li>
<p>Explain why this change is needed. If the details are in an issue already,<br>
  this can be brief.</p>
</li>
</ul>
<p>Our development process is documented in the Wasmtime book:<br>
<a href="https://docs.wasmtime.dev/contributing-development-process.html">https://docs.wasmtime.dev/contributing-development-process.html</a></p>
<p>Please ensure all communication follows the code of conduct:<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>
--&gt;</p>
</blockquote>



<a name="347737344"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236181%20x64%3A%20Clarify%20and%20shrink%20up%20ModRM/SIB%20.../near/347737344" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236181.20x64.3A.20Clarify.20and.20shrink.20up.20ModRM.2FSIB.20.2E.2E.2E.html#347737344">(Apr 07 2023 at 20:00)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/abrown">abrown</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/6181">PR #6181</a>.</p>



<a name="347737345"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236181%20x64%3A%20Clarify%20and%20shrink%20up%20ModRM/SIB%20.../near/347737345" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236181.20x64.3A.20Clarify.20and.20shrink.20up.20ModRM.2FSIB.20.2E.2E.2E.html#347737345">(Apr 07 2023 at 20:00)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/fitzgen">fitzgen</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/6181">PR #6181</a>.</p>



<a name="347737346"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236181%20x64%3A%20Clarify%20and%20shrink%20up%20ModRM/SIB%20.../near/347737346" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236181.20x64.3A.20Clarify.20and.20shrink.20up.20ModRM.2FSIB.20.2E.2E.2E.html#347737346">(Apr 07 2023 at 20:00)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-compiler-reviewers">wasmtime-compiler-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/6181">PR #6181</a>.</p>



<a name="348290667"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236181%20x64%3A%20Clarify%20and%20shrink%20up%20ModRM/SIB%20.../near/348290667" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236181.20x64.3A.20Clarify.20and.20shrink.20up.20ModRM.2FSIB.20.2E.2E.2E.html#348290667">(Apr 10 2023 at 19:37)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6181#pullrequestreview-1378030720">PR review</a>.</p>



<a name="348296849"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236181%20x64%3A%20Clarify%20and%20shrink%20up%20ModRM/SIB%20.../near/348296849" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236181.20x64.3A.20Clarify.20and.20shrink.20up.20ModRM.2FSIB.20.2E.2E.2E.html#348296849">(Apr 10 2023 at 20:14)</a>:</h4>
<p>fitzgen merged <a href="https://github.com/bytecodealliance/wasmtime/pull/6181">PR #6181</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>