<html>
<head><meta charset="utf-8"><title>wasmtime / PR #4892 Cranelift: use regalloc2 constraints ... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234892.20Cranelift.3A.20use.20regalloc2.20constraints.20.2E.2E.2E.html">wasmtime / PR #4892 Cranelift: use regalloc2 constraints ...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="298059648"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234892%20Cranelift%3A%20use%20regalloc2%20constraints%20.../near/298059648" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234892.20Cranelift.3A.20use.20regalloc2.20constraints.20.2E.2E.2E.html#298059648">(Sep 09 2022 at 21:59)</a>:</h4>
<p><strong>cfallin</strong> requested <a href="https://github.com/elliottt">elliottt</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/4892">PR #4892</a>.</p>



<a name="298059649"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234892%20Cranelift%3A%20use%20regalloc2%20constraints%20.../near/298059649" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234892.20Cranelift.3A.20use.20regalloc2.20constraints.20.2E.2E.2E.html#298059649">(Sep 09 2022 at 21:59)</a>:</h4>
<p><strong>cfallin</strong> requested <a href="https://github.com/fitzgen">fitzgen</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/4892">PR #4892</a>.</p>



<a name="298059650"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234892%20Cranelift%3A%20use%20regalloc2%20constraints%20.../near/298059650" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234892.20Cranelift.3A.20use.20regalloc2.20constraints.20.2E.2E.2E.html#298059650">(Sep 09 2022 at 21:59)</a>:</h4>
<p>cfallin opened <a href="https://github.com/bytecodealliance/wasmtime/pull/4892">PR #4892</a> from <code>abi-reg-constraints</code> to <code>main</code>:</p>
<blockquote>
<p>This PR updates the shared ABI code and backends to use register-operand constraints rather than explicit pinned-vreg moves for register arguments and return values.</p>
<p>The s390x backend was not updated, because it has its own implementation of ABI code. Ideally we could converge back to the code shared by x64 and aarch64 (which didn't exist when s390x ported calls to ISLE, so the current situation is underestandable, to be clear!). I'll leave this for future work.</p>
<p>This PR exposed several places where regalloc2 needed to be a bit more flexible with constraints; it requires regalloc2#74 to be merged and pulled in. Right now CI will fail because <code>Cargo.toml</code> points to a local checkout; I'll update this after<br>
the regalloc2 changes are in.</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;<br>
</p>
</blockquote>



<a name="298059651"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234892%20Cranelift%3A%20use%20regalloc2%20constraints%20.../near/298059651" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234892.20Cranelift.3A.20use.20regalloc2.20constraints.20.2E.2E.2E.html#298059651">(Sep 09 2022 at 21:59)</a>:</h4>
<p><strong>cfallin</strong> requested <a href="https://github.com/bnjbvr">bnjbvr</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/4892">PR #4892</a>.</p>



<a name="298801406"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234892%20Cranelift%3A%20use%20regalloc2%20constraints%20.../near/298801406" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234892.20Cranelift.3A.20use.20regalloc2.20constraints.20.2E.2E.2E.html#298801406">(Sep 14 2022 at 16:09)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4892#pullrequestreview-1107726730">PR review</a>.</p>



<a name="298801407"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234892%20Cranelift%3A%20use%20regalloc2%20constraints%20.../near/298801407" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234892.20Cranelift.3A.20use.20regalloc2.20constraints.20.2E.2E.2E.html#298801407">(Sep 14 2022 at 16:09)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/4892#discussion_r970961589">PR review comment</a>:</p>
<blockquote>
<ol>
<li>Can we type def this small vec since it is used all over the place?</li>
<li>This change is doubling the size of these small vecs since each element is two regs instead of one now, and I wonder if it makes sense to cut the inline capacity in half? Or at least remeasure a little to see where the sweet spot is now?</li>
</ol>
</blockquote>



<a name="298801408"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234892%20Cranelift%3A%20use%20regalloc2%20constraints%20.../near/298801408" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234892.20Cranelift.3A.20use.20regalloc2.20constraints.20.2E.2E.2E.html#298801408">(Sep 14 2022 at 16:09)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/4892#discussion_r970966026">PR review comment</a>:</p>
<blockquote>
<p>Let's debug assert that this isn't a call the probestack libcall here, since we rely on probestacks being inserted after regalloc and use that fact to justify avoiding listing their uses as an optimization. This way, if we ever start probestacking earlier, we will hit this assertion and be reminded to fix up that code.</p>
</blockquote>



<a name="298801409"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234892%20Cranelift%3A%20use%20regalloc2%20constraints%20.../near/298801409" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234892.20Cranelift.3A.20use.20regalloc2.20constraints.20.2E.2E.2E.html#298801409">(Sep 14 2022 at 16:09)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4892#pullrequestreview-1107726730">PR review</a>.</p>



<a name="298801410"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234892%20Cranelift%3A%20use%20regalloc2%20constraints%20.../near/298801410" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234892.20Cranelift.3A.20use.20regalloc2.20constraints.20.2E.2E.2E.html#298801410">(Sep 14 2022 at 16:09)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/4892#discussion_r970979770">PR review comment</a>:</p>
<blockquote>
<p>Why 4? Is that the max that this will ever use? If so, then it should probably be an <code>arrayvec</code> instead. If not, I think we can go larger since this is just a one-off vector in a stack frame, not something where we have to worry too much about the size of the smallvec because it is inside a bunch of heap allocated structs.</p>
</blockquote>



<a name="298801411"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234892%20Cranelift%3A%20use%20regalloc2%20constraints%20.../near/298801411" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234892.20Cranelift.3A.20use.20regalloc2.20constraints.20.2E.2E.2E.html#298801411">(Sep 14 2022 at 16:09)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/4892#discussion_r970968573">PR review comment</a>:</p>
<blockquote>
<p>Should probably update the docs for this trait method. We shouldn't clobber caller-saved registers anymore right? Instead we should use the given temps if needed, correct?</p>
</blockquote>



<a name="298801413"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234892%20Cranelift%3A%20use%20regalloc2%20constraints%20.../near/298801413" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234892.20Cranelift.3A.20use.20regalloc2.20constraints.20.2E.2E.2E.html#298801413">(Sep 14 2022 at 16:09)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/4892#discussion_r971026303">PR review comment</a>:</p>
<blockquote>
<p>nitpick: Line wrap is a bit funky here.</p>
</blockquote>



<a name="298801414"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234892%20Cranelift%3A%20use%20regalloc2%20constraints%20.../near/298801414" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234892.20Cranelift.3A.20use.20regalloc2.20constraints.20.2E.2E.2E.html#298801414">(Sep 14 2022 at 16:09)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/4892#discussion_r971024859">PR review comment</a>:</p>
<blockquote>
<p>We could allow taking the signatures out of the context temporarily, so that we could immutably borrow them while mutably borrowing the lowering context. This would avoid needing to pre-allocate temps up front.</p>
</blockquote>



<a name="298801415"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234892%20Cranelift%3A%20use%20regalloc2%20constraints%20.../near/298801415" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234892.20Cranelift.3A.20use.20regalloc2.20constraints.20.2E.2E.2E.html#298801415">(Sep 14 2022 at 16:09)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/4892#discussion_r970976715">PR review comment</a>:</p>
<blockquote>
<p>Similarly:</p>
<p><div class="codehilite" data-code-language="suggestion"><pre><span></span><code>                    &amp;ABIArgSlot::Reg { extension: ir::ArgumentExtension::None, ty, .. } =&gt; ty.is_ref() as _,
                    &amp;ABIArgSlot::Reg { .. } =&gt; 1,
</code></pre></div><br>
</p>
</blockquote>



<a name="298801416"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234892%20Cranelift%3A%20use%20regalloc2%20constraints%20.../near/298801416" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234892.20Cranelift.3A.20use.20regalloc2.20constraints.20.2E.2E.2E.html#298801416">(Sep 14 2022 at 16:09)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/4892#discussion_r970974669">PR review comment</a>:</p>
<blockquote>
<p>Could code golf this down a little bit, if you wanted:</p>
<p><div class="codehilite" data-code-language="suggestion"><pre><span></span><code>                    &amp;ABIArgSlot::Stack { extension: ir::ArgumentExtension::None, .. } =&gt; 0,
                    &amp;ABIArgSlot::Stack { .. } =&gt; 1,
</code></pre></div><br>
</p>
</blockquote>



<a name="298801417"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234892%20Cranelift%3A%20use%20regalloc2%20constraints%20.../near/298801417" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234892.20Cranelift.3A.20use.20regalloc2.20constraints.20.2E.2E.2E.html#298801417">(Sep 14 2022 at 16:09)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/4892#discussion_r971027667">PR review comment</a>:</p>
<blockquote>
<p>Kinda strange to have two different kinds of comments here? Should <code>#</code> just be <code>;</code>?</p>
</blockquote>



<a name="299861668"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234892%20Cranelift%3A%20use%20regalloc2%20constraints%20.../near/299861668" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234892.20Cranelift.3A.20use.20regalloc2.20constraints.20.2E.2E.2E.html#299861668">(Sep 20 2022 at 23:14)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4892">PR #4892</a> from <code>abi-reg-constraints</code> to <code>main</code>.</p>



<a name="299863156"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234892%20Cranelift%3A%20use%20regalloc2%20constraints%20.../near/299863156" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234892.20Cranelift.3A.20use.20regalloc2.20constraints.20.2E.2E.2E.html#299863156">(Sep 20 2022 at 23:32)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4892">PR #4892</a> from <code>abi-reg-constraints</code> to <code>main</code>.</p>



<a name="299863158"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234892%20Cranelift%3A%20use%20regalloc2%20constraints%20.../near/299863158" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234892.20Cranelift.3A.20use.20regalloc2.20constraints.20.2E.2E.2E.html#299863158">(Sep 20 2022 at 23:32)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4892#pullrequestreview-1114579333">PR review</a>.</p>



<a name="299863160"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234892%20Cranelift%3A%20use%20regalloc2%20constraints%20.../near/299863160" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234892.20Cranelift.3A.20use.20regalloc2.20constraints.20.2E.2E.2E.html#299863160">(Sep 20 2022 at 23:32)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/4892#discussion_r975892669">PR review comment</a>:</p>
<blockquote>
<p><code>;</code> is actually not a comment in the generated assembly format, though -- the punctuation above breaks down as:</p>
<ul>
<li>initial column <code>;</code> is <code>filecheck</code>'s comment, and serves here to give the <code>precise-output</code> expected text</li>
<li>the <code>;</code>s in line 45 separate additional instructions (<code>ldr</code>, then <code>b</code>, then a <code>data</code> pseudoinstruction)</li>
<li>the <code>#</code> on line 46 introduces an actual comment that gives more info about the call</li>
</ul>
<p>so the <code>; ... # ...</code> is a comment-within-a-comment, if that makes sense...</p>
</blockquote>



<a name="299863162"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234892%20Cranelift%3A%20use%20regalloc2%20constraints%20.../near/299863162" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234892.20Cranelift.3A.20use.20regalloc2.20constraints.20.2E.2E.2E.html#299863162">(Sep 20 2022 at 23:32)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4892#pullrequestreview-1114579372">PR review</a>.</p>



<a name="299863163"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234892%20Cranelift%3A%20use%20regalloc2%20constraints%20.../near/299863163" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234892.20Cranelift.3A.20use.20regalloc2.20constraints.20.2E.2E.2E.html#299863163">(Sep 20 2022 at 23:32)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/4892#discussion_r975892697">PR review comment</a>:</p>
<blockquote>
<p>Fixed, thanks!</p>
</blockquote>



<a name="299863193"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234892%20Cranelift%3A%20use%20regalloc2%20constraints%20.../near/299863193" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234892.20Cranelift.3A.20use.20regalloc2.20constraints.20.2E.2E.2E.html#299863193">(Sep 20 2022 at 23:32)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4892#pullrequestreview-1114579649">PR review</a>.</p>



<a name="299863194"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234892%20Cranelift%3A%20use%20regalloc2%20constraints%20.../near/299863194" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234892.20Cranelift.3A.20use.20regalloc2.20constraints.20.2E.2E.2E.html#299863194">(Sep 20 2022 at 23:32)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/4892#discussion_r975892880">PR review comment</a>:</p>
<blockquote>
<p>True, though imho that is probably best done as a follow-up refactor...</p>
</blockquote>



<a name="299863219"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234892%20Cranelift%3A%20use%20regalloc2%20constraints%20.../near/299863219" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234892.20Cranelift.3A.20use.20regalloc2.20constraints.20.2E.2E.2E.html#299863219">(Sep 20 2022 at 23:33)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4892#pullrequestreview-1114579802">PR review</a>.</p>



<a name="299863220"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234892%20Cranelift%3A%20use%20regalloc2%20constraints%20.../near/299863220" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234892.20Cranelift.3A.20use.20regalloc2.20constraints.20.2E.2E.2E.html#299863220">(Sep 20 2022 at 23:33)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/4892#discussion_r975893017">PR review comment</a>:</p>
<blockquote>
<p>Good point, updated to 16; it's bounded only by the number of args so it could be larger.</p>
</blockquote>



<a name="299863355"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234892%20Cranelift%3A%20use%20regalloc2%20constraints%20.../near/299863355" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234892.20Cranelift.3A.20use.20regalloc2.20constraints.20.2E.2E.2E.html#299863355">(Sep 20 2022 at 23:34)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4892#pullrequestreview-1114580360">PR review</a>.</p>



<a name="299863356"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234892%20Cranelift%3A%20use%20regalloc2%20constraints%20.../near/299863356" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234892.20Cranelift.3A.20use.20regalloc2.20constraints.20.2E.2E.2E.html#299863356">(Sep 20 2022 at 23:34)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/4892#discussion_r975893414">PR review comment</a>:</p>
<blockquote>
<p>Took almost this, just a bit different -- I kept the <code>extension != None</code> as a guard-<code>if</code> on the match arm, as it reads more clearly to me that way, semantically (the case we want to handle is "has extension", not "has no extension", so the subpattern match doesn't work as well).</p>
</blockquote>



<a name="299863373"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234892%20Cranelift%3A%20use%20regalloc2%20constraints%20.../near/299863373" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234892.20Cranelift.3A.20use.20regalloc2.20constraints.20.2E.2E.2E.html#299863373">(Sep 20 2022 at 23:34)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4892#pullrequestreview-1114580464">PR review</a>.</p>



<a name="299863374"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234892%20Cranelift%3A%20use%20regalloc2%20constraints%20.../near/299863374" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234892.20Cranelift.3A.20use.20regalloc2.20constraints.20.2E.2E.2E.html#299863374">(Sep 20 2022 at 23:34)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/4892#discussion_r975893479">PR review comment</a>:</p>
<blockquote>
<p>Updated!</p>
</blockquote>



<a name="299863378"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234892%20Cranelift%3A%20use%20regalloc2%20constraints%20.../near/299863378" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234892.20Cranelift.3A.20use.20regalloc2.20constraints.20.2E.2E.2E.html#299863378">(Sep 20 2022 at 23:34)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/4892#discussion_r975893528">PR review comment</a>:</p>
<blockquote>
<p>Added!</p>
</blockquote>



<a name="299863379"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234892%20Cranelift%3A%20use%20regalloc2%20constraints%20.../near/299863379" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234892.20Cranelift.3A.20use.20regalloc2.20constraints.20.2E.2E.2E.html#299863379">(Sep 20 2022 at 23:34)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4892#pullrequestreview-1114580527">PR review</a>.</p>



<a name="299863445"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234892%20Cranelift%3A%20use%20regalloc2%20constraints%20.../near/299863445" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234892.20Cranelift.3A.20use.20regalloc2.20constraints.20.2E.2E.2E.html#299863445">(Sep 20 2022 at 23:35)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4892#pullrequestreview-1114581190">PR review</a>.</p>



<a name="299863446"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234892%20Cranelift%3A%20use%20regalloc2%20constraints%20.../near/299863446" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234892.20Cranelift.3A.20use.20regalloc2.20constraints.20.2E.2E.2E.html#299863446">(Sep 20 2022 at 23:35)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/4892#discussion_r975894088">PR review comment</a>:</p>
<blockquote>
<p>Added typedefs! I kept the size at <code>8</code> as IMHO it's important to avoid heap allocs for most functions here, and when I've looked before, there are a good number with more than four args. Once we have a stats framework this would be a good thing to rexamine though, I agree.</p>
</blockquote>



<a name="299863776"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234892%20Cranelift%3A%20use%20regalloc2%20constraints%20.../near/299863776" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234892.20Cranelift.3A.20use.20regalloc2.20constraints.20.2E.2E.2E.html#299863776">(Sep 20 2022 at 23:39)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4892">PR #4892</a> from <code>abi-reg-constraints</code> to <code>main</code>.</p>



<a name="299864215"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234892%20Cranelift%3A%20use%20regalloc2%20constraints%20.../near/299864215" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234892.20Cranelift.3A.20use.20regalloc2.20constraints.20.2E.2E.2E.html#299864215">(Sep 20 2022 at 23:44)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4892">PR #4892</a> from <code>abi-reg-constraints</code> to <code>main</code>.</p>



<a name="299864490"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234892%20Cranelift%3A%20use%20regalloc2%20constraints%20.../near/299864490" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234892.20Cranelift.3A.20use.20regalloc2.20constraints.20.2E.2E.2E.html#299864490">(Sep 20 2022 at 23:49)</a>:</h4>
<p><strong>cfallin</strong> has marked <a href="https://github.com/bytecodealliance/wasmtime/pull/4892">PR #4892</a> as ready for review.</p>



<a name="299864516"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234892%20Cranelift%3A%20use%20regalloc2%20constraints%20.../near/299864516" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234892.20Cranelift.3A.20use.20regalloc2.20constraints.20.2E.2E.2E.html#299864516">(Sep 20 2022 at 23:49)</a>:</h4>
<p>cfallin has enabled auto merge for <a href="https://github.com/bytecodealliance/wasmtime/pull/4892">PR #4892</a>.</p>



<a name="299866476"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234892%20Cranelift%3A%20use%20regalloc2%20constraints%20.../near/299866476" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234892.20Cranelift.3A.20use.20regalloc2.20constraints.20.2E.2E.2E.html#299866476">(Sep 21 2022 at 00:14)</a>:</h4>
<p>cfallin has disabled auto merge for <a href="https://github.com/bytecodealliance/wasmtime/pull/4892">PR #4892</a>.</p>



<a name="299867531"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234892%20Cranelift%3A%20use%20regalloc2%20constraints%20.../near/299867531" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234892.20Cranelift.3A.20use.20regalloc2.20constraints.20.2E.2E.2E.html#299867531">(Sep 21 2022 at 00:29)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4892">PR #4892</a> from <code>abi-reg-constraints</code> to <code>main</code>.</p>



<a name="299868805"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234892%20Cranelift%3A%20use%20regalloc2%20constraints%20.../near/299868805" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234892.20Cranelift.3A.20use.20regalloc2.20constraints.20.2E.2E.2E.html#299868805">(Sep 21 2022 at 00:44)</a>:</h4>
<p>cfallin has enabled auto merge for <a href="https://github.com/bytecodealliance/wasmtime/pull/4892">PR #4892</a>.</p>



<a name="299871103"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234892%20Cranelift%3A%20use%20regalloc2%20constraints%20.../near/299871103" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234892.20Cranelift.3A.20use.20regalloc2.20constraints.20.2E.2E.2E.html#299871103">(Sep 21 2022 at 01:17)</a>:</h4>
<p>cfallin merged <a href="https://github.com/bytecodealliance/wasmtime/pull/4892">PR #4892</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>