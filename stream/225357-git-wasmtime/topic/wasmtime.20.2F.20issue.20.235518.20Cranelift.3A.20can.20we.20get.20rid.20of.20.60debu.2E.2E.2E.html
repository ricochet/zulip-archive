<html>
<head><meta charset="utf-8"><title>wasmtime / issue #5518 Cranelift: can we get rid of `debu... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235518.20Cranelift.3A.20can.20we.20get.20rid.20of.20.60debu.2E.2E.2E.html">wasmtime / issue #5518 Cranelift: can we get rid of `debu...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="320748527"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235518%20Cranelift%3A%20can%20we%20get%20rid%20of%20%60debu.../near/320748527" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235518.20Cranelift.3A.20can.20we.20get.20rid.20of.20.60debu.2E.2E.2E.html#320748527">(Jan 11 2023 at 16:48)</a>:</h4>
<p>fitzgen edited <a href="https://github.com/bytecodealliance/wasmtime/issues/5518">issue #5518</a>:</p>
<blockquote>
<p>I <em>think</em> these were a SpiderMonkey-ism? Unused now, AFAICT.</p>
</blockquote>



<a name="320750525"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235518%20Cranelift%3A%20can%20we%20get%20rid%20of%20%60debu.../near/320750525" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235518.20Cranelift.3A.20can.20we.20get.20rid.20of.20.60debu.2E.2E.2E.html#320750525">(Jan 11 2023 at 16:57)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/issues/5518#issuecomment-1379164126">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/5518">issue #5518</a>:</p>
<blockquote>
<p>Note that <code>debug_trap</code> must keep <code>int3</code> as lowering. Otherwise debuggers get confused. This could be done by adding a trap code for a breakpoint. I don't think there is precedent for changing codegen depending on the trap code though. I believe it is currently extra information that can be stored in a side table.</p>
</blockquote>



<a name="444767929"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235518%20Cranelift%3A%20can%20we%20get%20rid%20of%20%60debu.../near/444767929" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235518.20Cranelift.3A.20can.20we.20get.20rid.20of.20.60debu.2E.2E.2E.html#444767929">(Jun 14 2024 at 18:52)</a>:</h4>
<p>fitzgen closed <a href="https://github.com/bytecodealliance/wasmtime/issues/5518">issue #5518</a>:</p>
<blockquote>
<p>I <em>think</em> these were a SpiderMonkey-ism? Unused now, AFAICT.</p>
</blockquote>



<a name="444767932"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235518%20Cranelift%3A%20can%20we%20get%20rid%20of%20%60debu.../near/444767932" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235518.20Cranelift.3A.20can.20we.20get.20rid.20of.20.60debu.2E.2E.2E.html#444767932">(Jun 14 2024 at 18:52)</a>:</h4>
<p>fitzgen <a href="https://github.com/bytecodealliance/wasmtime/issues/5518#issuecomment-2168583715">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/5518">issue #5518</a>:</p>
<blockquote>
<p>I think we must have gotten rid of this at some point, because <code>debug_trap</code> no longer exists in the code base.</p>
</blockquote>



<a name="444770264"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235518%20Cranelift%3A%20can%20we%20get%20rid%20of%20%60debu.../near/444770264" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235518.20Cranelift.3A.20can.20we.20get.20rid.20of.20.60debu.2E.2E.2E.html#444770264">(Jun 14 2024 at 19:08)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/issues/5518#issuecomment-2168605353">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/5518">issue #5518</a>:</p>
<blockquote>
<p>It is now called <code>debugtrap</code> and still used by cg_clif for implementing the <code>breakpoint</code> rust intrinsic.</p>
</blockquote>



<a name="444772476"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235518%20Cranelift%3A%20can%20we%20get%20rid%20of%20%60debu.../near/444772476" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235518.20Cranelift.3A.20can.20we.20get.20rid.20of.20.60debu.2E.2E.2E.html#444772476">(Jun 14 2024 at 19:22)</a>:</h4>
<p>fitzgen <a href="https://github.com/bytecodealliance/wasmtime/issues/5518#issuecomment-2168627529">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/5518">issue #5518</a>:</p>
<blockquote>
<p>Yeah, I actually discovered the renaming that took place at some point just now as well.</p>
<p>Is there a reason that cg_clif has to use <code>debugtrap</code> instead of a normal <code>trap</code>?</p>
</blockquote>



<a name="444772968"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235518%20Cranelift%3A%20can%20we%20get%20rid%20of%20%60debu.../near/444772968" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235518.20Cranelift.3A.20can.20we.20get.20rid.20of.20.60debu.2E.2E.2E.html#444772968">(Jun 14 2024 at 19:25)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/issues/5518#issuecomment-2168631258">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/5518">issue #5518</a>:</p>
<blockquote>
<p><code>trap</code> generates <code>ud2</code> which is not resumable and produces <code>SIGILL</code>, while <code>debugtrap</code> generates <code>int3</code> which is resumable and which debuggers handle identical to a breakpoint set using the debugger itself.</p>
</blockquote>



<a name="444773540"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235518%20Cranelift%3A%20can%20we%20get%20rid%20of%20%60debu.../near/444773540" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235518.20Cranelift.3A.20can.20we.20get.20rid.20of.20.60debu.2E.2E.2E.html#444773540">(Jun 14 2024 at 19:28)</a>:</h4>
<p>fitzgen <a href="https://github.com/bytecodealliance/wasmtime/issues/5518#issuecomment-2168634991">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/5518">issue #5518</a>:</p>
<blockquote>
<p>Gotcha.</p>
<p>FWIW, <code>debugtrap</code> produces <code>hlt</code>, not <code>int3</code>, on x64 right now. I guess this doesn't matter though?</p>
</blockquote>



<a name="444774341"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235518%20Cranelift%3A%20can%20we%20get%20rid%20of%20%60debu.../near/444774341" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235518.20Cranelift.3A.20can.20we.20get.20rid.20of.20.60debu.2E.2E.2E.html#444774341">(Jun 14 2024 at 19:32)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/issues/5518#issuecomment-2168640101">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/5518">issue #5518</a>:</p>
<blockquote>
<p>It actually generates <code>int3</code>, but the instruction is called wrong in the Cranelift backend: <a href="https://github.com/bytecodealliance/wasmtime/blob/34b6b6738e22e13e66336a28fb4f1a1beb3e46e5/cranelift/codegen/src/isa/x64/inst/emit.rs#L4018-L4020">https://github.com/bytecodealliance/wasmtime/blob/34b6b6738e22e13e66336a28fb4f1a1beb3e46e5/cranelift/codegen/src/isa/x64/inst/emit.rs#L4018-L4020</a> <code>0xcc</code> is <code>int3</code>. <code>hlt</code> would be <code>0xf4</code>.</p>
</blockquote>



<a name="444774361"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235518%20Cranelift%3A%20can%20we%20get%20rid%20of%20%60debu.../near/444774361" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235518.20Cranelift.3A.20can.20we.20get.20rid.20of.20.60debu.2E.2E.2E.html#444774361">(Jun 14 2024 at 19:32)</a>:</h4>
<p>bjorn3 edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/5518#issuecomment-2168640101">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/5518">issue #5518</a>:</p>
<blockquote>
<p>It actually generates <code>int3</code>, but the instruction is called wrong in the x86_64 backend: <a href="https://github.com/bytecodealliance/wasmtime/blob/34b6b6738e22e13e66336a28fb4f1a1beb3e46e5/cranelift/codegen/src/isa/x64/inst/emit.rs#L4018-L4020">https://github.com/bytecodealliance/wasmtime/blob/34b6b6738e22e13e66336a28fb4f1a1beb3e46e5/cranelift/codegen/src/isa/x64/inst/emit.rs#L4018-L4020</a> <code>0xcc</code> is <code>int3</code>. <code>hlt</code> would be <code>0xf4</code>.</p>
</blockquote>



<a name="444774468"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235518%20Cranelift%3A%20can%20we%20get%20rid%20of%20%60debu.../near/444774468" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235518.20Cranelift.3A.20can.20we.20get.20rid.20of.20.60debu.2E.2E.2E.html#444774468">(Jun 14 2024 at 19:33)</a>:</h4>
<p>bjorn3 edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/5518#issuecomment-2168640101">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/5518">issue #5518</a>:</p>
<blockquote>
<p>It actually generates <code>int3</code>, but the instruction is called wrong in the x86_64 backend: <a href="https://github.com/bytecodealliance/wasmtime/blob/34b6b6738e22e13e66336a28fb4f1a1beb3e46e5/cranelift/codegen/src/isa/x64/inst/emit.rs#L4018-L4020">https://github.com/bytecodealliance/wasmtime/blob/34b6b6738e22e13e66336a28fb4f1a1beb3e46e5/cranelift/codegen/src/isa/x64/inst/emit.rs#L4018-L4020</a> <code>0xcc</code> is <code>int3</code>[^1]. <code>hlt</code> would be <code>0xf4</code>[^2].</p>
<p>[^1]: <a href="https://www.felixcloutier.com/x86/intn:into:int3:int1">https://www.felixcloutier.com/x86/intn:into:int3:int1</a><br>
[^2]: <a href="https://www.felixcloutier.com/x86/hlt">https://www.felixcloutier.com/x86/hlt</a></p>
</blockquote>



<a name="444778352"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235518%20Cranelift%3A%20can%20we%20get%20rid%20of%20%60debu.../near/444778352" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235518.20Cranelift.3A.20can.20we.20get.20rid.20of.20.60debu.2E.2E.2E.html#444778352">(Jun 14 2024 at 19:58)</a>:</h4>
<p>fitzgen <a href="https://github.com/bytecodealliance/wasmtime/issues/5518#issuecomment-2168674129">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/5518">issue #5518</a>:</p>
<blockquote>
<p>Good to know. Either way, it seems like we shouldn't actually get rid of this, so I'm leaving the issue closed.</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>