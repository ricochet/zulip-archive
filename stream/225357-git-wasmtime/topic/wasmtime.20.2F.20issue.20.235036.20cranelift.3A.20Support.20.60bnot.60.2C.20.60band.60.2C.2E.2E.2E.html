<html>
<head><meta charset="utf-8"><title>wasmtime / issue #5036 cranelift: Support `bnot`, `band`,... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235036.20cranelift.3A.20Support.20.60bnot.60.2C.20.60band.60.2C.2E.2E.2E.html">wasmtime / issue #5036 cranelift: Support `bnot`, `band`,...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="304833608"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235036%20cranelift%3A%20Support%20%60bnot%60%2C%20%60band%60%2C.../near/304833608" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235036.20cranelift.3A.20Support.20.60bnot.60.2C.20.60band.60.2C.2E.2E.2E.html#304833608">(Oct 18 2022 at 20:19)</a>:</h4>
<p>ArtBlnd <a href="https://github.com/bytecodealliance/wasmtime/pull/5036#issuecomment-1282955279">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5036">issue #5036</a>:</p>
<blockquote>
<p>I need to make test for float to vec. xor operation may generate incorrect code because current xor implementation does use <code>vector_all_ones</code> which will flip all unused bits. </p>
</blockquote>



<a name="304833713"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235036%20cranelift%3A%20Support%20%60bnot%60%2C%20%60band%60%2C.../near/304833713" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235036.20cranelift.3A.20Support.20.60bnot.60.2C.20.60band.60.2C.2E.2E.2E.html#304833713">(Oct 18 2022 at 20:20)</a>:</h4>
<p>ArtBlnd edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/5036#issuecomment-1282955279">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5036">issue #5036</a>:</p>
<blockquote>
<p>I need to make test for float to vec. xor operation may generate incorrect code because current xor implementation does use <code>vector_all_ones</code> which will flip all unused bits. </p>
<p>I am finding a efficient  way to generate single slot bit mask. </p>
</blockquote>



<a name="304833843"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235036%20cranelift%3A%20Support%20%60bnot%60%2C%20%60band%60%2C.../near/304833843" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235036.20cranelift.3A.20Support.20.60bnot.60.2C.20.60band.60.2C.2E.2E.2E.html#304833843">(Oct 18 2022 at 20:20)</a>:</h4>
<p>ArtBlnd edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/5036#issuecomment-1282955279">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5036">issue #5036</a>:</p>
<blockquote>
<p>first of all, I need to make test for float to vec to check that unused bits are filtered out. xor operation may generate incorrect code because current xor implementation does use <code>vector_all_ones</code> which will flip all unused bits. </p>
<p>I am finding a efficient  way to generate single slot bit mask. </p>
</blockquote>



<a name="304833939"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235036%20cranelift%3A%20Support%20%60bnot%60%2C%20%60band%60%2C.../near/304833939" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235036.20cranelift.3A.20Support.20.60bnot.60.2C.20.60band.60.2C.2E.2E.2E.html#304833939">(Oct 18 2022 at 20:21)</a>:</h4>
<p>ArtBlnd edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/5036#issuecomment-1282955279">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5036">issue #5036</a>:</p>
<blockquote>
<p>first of all, I need to make test for float to vec to check that unused bits are filtered out. xor operation may generate incorrect code because current xor implementation does use <code>vector_all_ones</code> which will flip all unused bits. </p>
<p>so I am finding a efficient  way to generate single slot bit mask. (not using load ops. that will need extra stack allocations.)</p>
</blockquote>



<a name="304834133"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235036%20cranelift%3A%20Support%20%60bnot%60%2C%20%60band%60%2C.../near/304834133" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235036.20cranelift.3A.20Support.20.60bnot.60.2C.20.60band.60.2C.2E.2E.2E.html#304834133">(Oct 18 2022 at 20:22)</a>:</h4>
<p>ArtBlnd edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/5036#issuecomment-1282955279">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5036">issue #5036</a>:</p>
<blockquote>
<p>first of all, I need to make test for float to vec to check that unused bits are filtered out. bnot operation may generate incorrect code because current bnot implementation does use <code>vector_all_ones</code> which will flip all unused bits. </p>
<p>so I am finding a efficient  way to generate single slot bit mask. (not using load ops. that will need extra stack allocations.)</p>
</blockquote>



<a name="304834166"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235036%20cranelift%3A%20Support%20%60bnot%60%2C%20%60band%60%2C.../near/304834166" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235036.20cranelift.3A.20Support.20.60bnot.60.2C.20.60band.60.2C.2E.2E.2E.html#304834166">(Oct 18 2022 at 20:22)</a>:</h4>
<p>ArtBlnd edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/5036#issuecomment-1282955279">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5036">issue #5036</a>:</p>
<blockquote>
<p>first of all, I need to make test for float to vec to check that unused bits are filtered out. bnot operation may generate incorrect code because current bnot implementation does use <code>vector_all_ones</code> which will flip all unused bits. </p>
<p>so I am finding a efficient  way to generate single slot bit mask. (not using load ops. that will need extra stack allocations.)</p>
<p><a href="https://github.com/bytecodealliance/wasmtime/pull/5036/files#diff-4fb30cf23cc13cba2f11079dc6d0305f972170585aab27b27d143c2f3252e4faR1270-R1274">https://github.com/bytecodealliance/wasmtime/pull/5036/files#diff-4fb30cf23cc13cba2f11079dc6d0305f972170585aab27b27d143c2f3252e4faR1270-R1274</a></p>
</blockquote>



<a name="304835035"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235036%20cranelift%3A%20Support%20%60bnot%60%2C%20%60band%60%2C.../near/304835035" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235036.20cranelift.3A.20Support.20.60bnot.60.2C.20.60band.60.2C.2E.2E.2E.html#304835035">(Oct 18 2022 at 20:29)</a>:</h4>
<p>ArtBlnd edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/5036#issuecomment-1282955279">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5036">issue #5036</a>:</p>
<blockquote>
<p>first of all, I need to make test for float to vec to check that unused bits are filtered out. bnot operation may generate incorrect code because current bnot implementation does use <code>vector_all_ones</code> which will flip all unused bits. means it has side-effect.</p>
<p>so I am finding a efficient  way to generate single slot bit mask. (not using load ops. that will need extra stack allocations.)</p>
<p><a href="https://github.com/bytecodealliance/wasmtime/pull/5036/files#diff-4fb30cf23cc13cba2f11079dc6d0305f972170585aab27b27d143c2f3252e4faR1270-R1274">https://github.com/bytecodealliance/wasmtime/pull/5036/files#diff-4fb30cf23cc13cba2f11079dc6d0305f972170585aab27b27d143c2f3252e4faR1270-R1274</a></p>
</blockquote>



<a name="304840346"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235036%20cranelift%3A%20Support%20%60bnot%60%2C%20%60band%60%2C.../near/304840346" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235036.20cranelift.3A.20Support.20.60bnot.60.2C.20.60band.60.2C.2E.2E.2E.html#304840346">(Oct 18 2022 at 21:02)</a>:</h4>
<p>abrown <a href="https://github.com/bytecodealliance/wasmtime/pull/5036#issuecomment-1283000303">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5036">issue #5036</a>:</p>
<blockquote>
<p>You can tag me once you're ready for review; I glanced over this and it made sense.</p>
</blockquote>



<a name="305570177"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235036%20cranelift%3A%20Support%20%60bnot%60%2C%20%60band%60%2C.../near/305570177" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235036.20cranelift.3A.20Support.20.60bnot.60.2C.20.60band.60.2C.2E.2E.2E.html#305570177">(Oct 22 2022 at 18:50)</a>:</h4>
<p>ArtBlnd <a href="https://github.com/bytecodealliance/wasmtime/pull/5036#issuecomment-1287882662">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5036">issue #5036</a>:</p>
<blockquote>
<p>I think there is no cheap way to generate masks...</p>
</blockquote>



<a name="305570239"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235036%20cranelift%3A%20Support%20%60bnot%60%2C%20%60band%60%2C.../near/305570239" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235036.20cranelift.3A.20Support.20.60bnot.60.2C.20.60band.60.2C.2E.2E.2E.html#305570239">(Oct 22 2022 at 18:51)</a>:</h4>
<p>ArtBlnd edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/5036#issuecomment-1287882662">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5036">issue #5036</a>:</p>
<blockquote>
<p>I think there is no cheap way to generate masks...</p>
<p>maybe we need to truncate all unused vector slots when using <code>scalar_to_vector</code></p>
</blockquote>



<a name="305570383"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235036%20cranelift%3A%20Support%20%60bnot%60%2C%20%60band%60%2C.../near/305570383" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235036.20cranelift.3A.20Support.20.60bnot.60.2C.20.60band.60.2C.2E.2E.2E.html#305570383">(Oct 22 2022 at 18:54)</a>:</h4>
<p>ArtBlnd edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/5036#issuecomment-1287882662">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5036">issue #5036</a>:</p>
<blockquote>
<p>I think there is no cheap way to generate masks...</p>
<p>maybe we need to truncate all unused vector slots when using <code>scalar_to_vector</code><br>
I'll make seperate PR for this task.</p>
</blockquote>



<a name="305573777"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235036%20cranelift%3A%20Support%20%60bnot%60%2C%20%60band%60%2C.../near/305573777" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235036.20cranelift.3A.20Support.20.60bnot.60.2C.20.60band.60.2C.2E.2E.2E.html#305573777">(Oct 22 2022 at 19:15)</a>:</h4>
<p>ArtBlnd edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/5036#issuecomment-1287882662">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5036">issue #5036</a>:</p>
<blockquote>
<p>I think there is no cheap way to generate masks...</p>
<p><del>maybe we need to truncate all unused vector slots when using <code>scalar_to_vector</code></del><br>
<del>I'll make seperate PR for this task.</del></p>
<p>nevermind. scalar_to_vector is using movss, movsd.</p>
</blockquote>



<a name="305574705"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235036%20cranelift%3A%20Support%20%60bnot%60%2C%20%60band%60%2C.../near/305574705" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235036.20cranelift.3A.20Support.20.60bnot.60.2C.20.60band.60.2C.2E.2E.2E.html#305574705">(Oct 22 2022 at 19:22)</a>:</h4>
<p>ArtBlnd <a href="https://github.com/bytecodealliance/wasmtime/pull/5036#issuecomment-1287889690">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5036">issue #5036</a>:</p>
<blockquote>
<p>@abrown I think its ready to review.</p>
</blockquote>



<a name="307649562"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235036%20cranelift%3A%20Support%20%60bnot%60%2C%20%60band%60%2C.../near/307649562" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235036.20cranelift.3A.20Support.20.60bnot.60.2C.20.60band.60.2C.2E.2E.2E.html#307649562">(Nov 03 2022 at 02:56)</a>:</h4>
<p>ArtBlnd <a href="https://github.com/bytecodealliance/wasmtime/pull/5036#issuecomment-1301585990">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5036">issue #5036</a>:</p>
<blockquote>
<p>sorry for the very late response for the review.</p>
</blockquote>



<a name="309061077"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235036%20cranelift%3A%20Support%20%60bnot%60%2C%20%60band%60%2C.../near/309061077" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235036.20cranelift.3A.20Support.20.60bnot.60.2C.20.60band.60.2C.2E.2E.2E.html#309061077">(Nov 10 2022 at 19:22)</a>:</h4>
<p>abrown <a href="https://github.com/bytecodealliance/wasmtime/pull/5036#issuecomment-1310787470">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5036">issue #5036</a>:</p>
<blockquote>
<p>@ArtBlnd, I believe the CI failure here is due to some rustc changes between when this PR was open and now. Can you rebase this PR and see if that resolves things?</p>
</blockquote>



<a name="310744948"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235036%20cranelift%3A%20Support%20%60bnot%60%2C%20%60band%60%2C.../near/310744948" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235036.20cranelift.3A.20Support.20.60bnot.60.2C.20.60band.60.2C.2E.2E.2E.html#310744948">(Nov 18 2022 at 04:05)</a>:</h4>
<p>ArtBlnd <a href="https://github.com/bytecodealliance/wasmtime/pull/5036#issuecomment-1319515908">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5036">issue #5036</a>:</p>
<blockquote>
<blockquote>
<p>@ArtBlnd, I believe the CI failure here is due to some rustc changes between when this PR was open and now. Can you rebase this PR and see if that resolves things?</p>
</blockquote>
<p>Done.</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>