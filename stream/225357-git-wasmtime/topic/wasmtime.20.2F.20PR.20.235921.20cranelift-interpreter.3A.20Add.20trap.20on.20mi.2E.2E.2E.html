<html>
<head><meta charset="utf-8"><title>wasmtime / PR #5921 cranelift-interpreter: Add trap on mi... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235921.20cranelift-interpreter.3A.20Add.20trap.20on.20mi.2E.2E.2E.html">wasmtime / PR #5921 cranelift-interpreter: Add trap on mi...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="339362080"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235921%20cranelift-interpreter%3A%20Add%20trap%20on%20mi.../near/339362080" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235921.20cranelift-interpreter.3A.20Add.20trap.20on.20mi.2E.2E.2E.html#339362080">(Mar 03 2023 at 14:39)</a>:</h4>
<p>jan-justin opened <a href="https://github.com/bytecodealliance/wasmtime/pull/5921">PR #5921</a> from <code>cranelift-interpreter-trap-misaligned</code> to <code>main</code>:</p>
<blockquote>
<p>This PR adds trap generation on misaligned memory accesses when the <code>aligned</code> memory flag is set, as proposed over at #5899.</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;<br>
</p>
</blockquote>



<a name="339556100"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235921%20cranelift-interpreter%3A%20Add%20trap%20on%20mi.../near/339556100" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235921.20cranelift-interpreter.3A.20Add.20trap.20on.20mi.2E.2E.2E.html#339556100">(Mar 04 2023 at 13:29)</a>:</h4>
<p>afonso360 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5921#pullrequestreview-1325020445">PR review</a>.</p>



<a name="339556101"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235921%20cranelift-interpreter%3A%20Add%20trap%20on%20mi.../near/339556101" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235921.20cranelift-interpreter.3A.20Add.20trap.20on.20mi.2E.2E.2E.html#339556101">(Mar 04 2023 at 13:29)</a>:</h4>
<p>afonso360 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5921#pullrequestreview-1325020445">PR review</a>.</p>



<a name="339556102"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235921%20cranelift-interpreter%3A%20Add%20trap%20on%20mi.../near/339556102" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235921.20cranelift-interpreter.3A.20Add.20trap.20on.20mi.2E.2E.2E.html#339556102">(Mar 04 2023 at 13:29)</a>:</h4>
<p>afonso360 created <a href="https://github.com/bytecodealliance/wasmtime/pull/5921#discussion_r1125462721">PR review comment</a>:</p>
<blockquote>
<p>Me and @jan-justin were discussing this on Zulip, and we were unsure if unaligned <code>stack_{load,store}</code>s allowed. By coincidence the fuzzer found a similar issue in #5922 so we will probably get our answer there!</p>
</blockquote>



<a name="339556103"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235921%20cranelift-interpreter%3A%20Add%20trap%20on%20mi.../near/339556103" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235921.20cranelift-interpreter.3A.20Add.20trap.20on.20mi.2E.2E.2E.html#339556103">(Mar 04 2023 at 13:29)</a>:</h4>
<p>afonso360 created <a href="https://github.com/bytecodealliance/wasmtime/pull/5921#discussion_r1125468638">PR review comment</a>:</p>
<blockquote>
<p>Can we change this to be <code>explicit_slot 16</code>? The reason is that this store is accessing memory out of bounds, and the interpreter didn't catch it!</p>
<p>Technically the <a href="https://docs.rs/cranelift-codegen/latest/cranelift_codegen/ir/entities/struct.StackSlot.html">stack slots can be reordered</a>, so we could reorder this slot to be at the end, and then we would access past the end of the stack. The interpreter never does that so it would never detect that case.</p>
<p>I've opened #5927 to track this!</p>
</blockquote>



<a name="339556315"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235921%20cranelift-interpreter%3A%20Add%20trap%20on%20mi.../near/339556315" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235921.20cranelift-interpreter.3A.20Add.20trap.20on.20mi.2E.2E.2E.html#339556315">(Mar 04 2023 at 13:31)</a>:</h4>
<p>afonso360 edited <a href="https://github.com/bytecodealliance/wasmtime/pull/5921#discussion_r1125468638">PR review comment</a>.</p>



<a name="339673526"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235921%20cranelift-interpreter%3A%20Add%20trap%20on%20mi.../near/339673526" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235921.20cranelift-interpreter.3A.20Add.20trap.20on.20mi.2E.2E.2E.html#339673526">(Mar 05 2023 at 10:47)</a>:</h4>
<p>jan-justin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5921">PR #5921</a> from <code>cranelift-interpreter-trap-misaligned</code> to <code>main</code>.</p>



<a name="339992040"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235921%20cranelift-interpreter%3A%20Add%20trap%20on%20mi.../near/339992040" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235921.20cranelift-interpreter.3A.20Add.20trap.20on.20mi.2E.2E.2E.html#339992040">(Mar 07 2023 at 00:06)</a>:</h4>
<p>jameysharp submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5921#pullrequestreview-1327416550">PR review</a>.</p>



<a name="339996721"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235921%20cranelift-interpreter%3A%20Add%20trap%20on%20mi.../near/339996721" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235921.20cranelift-interpreter.3A.20Add.20trap.20on.20mi.2E.2E.2E.html#339996721">(Mar 07 2023 at 00:45)</a>:</h4>
<p>jameysharp merged <a href="https://github.com/bytecodealliance/wasmtime/pull/5921">PR #5921</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>