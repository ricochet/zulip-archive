<html>
<head><meta charset="utf-8"><title>wasmtime / Issue #1565 Reactor support. · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231565.20Reactor.20support.2E.html">wasmtime / Issue #1565 Reactor support.</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="194814313"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231565%20Reactor%20support./near/194814313" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231565.20Reactor.20support.2E.html#194814313">(Apr 21 2020 at 14:59)</a>:</h4>
<p>github-actions[bot] <a href="https://github.com/bytecodealliance/wasmtime/pull/1565#issuecomment-617234156" title="https://github.com/bytecodealliance/wasmtime/pull/1565#issuecomment-617234156">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1565" title="https://github.com/bytecodealliance/wasmtime/pull/1565">Issue #1565</a>:</p>
<blockquote>
<h4>Subscribe to Label Action</h4>
<p>cc @kubkon, @peterhuene</p>
<p>&lt;details&gt;<br>
This issue or pull request has been labeled: "wasi", "wasmtime", "wasmtime:api", "wasmtime:docs"</p>
<p>Thus the following users have been cc'd because of the following labels:</p>
<ul>
<li>kubkon: wasi</li>
<li>peterhuene: wasmtime:api</li>
</ul>
<p>To subscribe or unsubscribe from this label, edit the &lt;code&gt;.github/subscribe-to-label.json&lt;/code&gt; configuration file.</p>
<p><a href="https://github.com/bytecodealliance/subscribe-to-label-action" title="https://github.com/bytecodealliance/subscribe-to-label-action">Learn more.</a><br>
&lt;/details&gt;</p>
</blockquote>



<a name="198006071"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231565%20Reactor%20support./near/198006071" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231565.20Reactor.20support.2E.html#198006071">(May 18 2020 at 23:02)</a>:</h4>
<p>github-actions[bot] <a href="https://github.com/bytecodealliance/wasmtime/pull/1565#issuecomment-630479191">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1565">Issue #1565</a>:</p>
<blockquote>
<h4>Subscribe to Label Action</h4>
<p>cc @peterhuene</p>
<p>&lt;details&gt;<br>
This issue or pull request has been labeled: "wasmtime:c-api"</p>
<p>Thus the following users have been cc'd because of the following labels:</p>
<ul>
<li>peterhuene: wasmtime:c-api</li>
</ul>
<p>To subscribe or unsubscribe from this label, edit the &lt;code&gt;.github/subscribe-to-label.json&lt;/code&gt; configuration file.</p>
<p><a href="https://github.com/bytecodealliance/subscribe-to-label-action">Learn more.</a><br>
&lt;/details&gt;</p>
</blockquote>



<a name="198205761"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231565%20Reactor%20support./near/198205761" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231565.20Reactor.20support.2E.html#198205761">(May 20 2020 at 14:24)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/1565#issuecomment-631506404">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1565">Issue #1565</a>:</p>
<blockquote>
<p>I do like this approach better myself, but I feel like it's still a bit too heavyweight because it makes <code>NewInstance</code> almost exclusively WASI-focused. I would expect <code>Instance</code> to be neutral with respect to WASI-or-not and users have to opt-in to WASI-specific hooks.</p>
<p>I realize it can be a small footgun if these methods are added directly to <code>Instance</code>, but I feel that the footgun is worth it in terms of ergonomics. For example if you're reading the documentation of the <code>wasmtime</code> crate all the examples have <code>init_reactor(&amp;[])</code> which is somewhat bizarre if you've never heard of WASI before.</p>
</blockquote>



<a name="198254223"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231565%20Reactor%20support./near/198254223" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231565.20Reactor.20support.2E.html#198254223">(May 20 2020 at 20:38)</a>:</h4>
<p>sunfishcode <a href="https://github.com/bytecodealliance/wasmtime/pull/1565#issuecomment-631713238">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1565">Issue #1565</a>:</p>
<blockquote>
<p>They aren't really WASI-specific. I expect that between the linking spec and interface types, the definition of commands and reactors will eventually want to move out of WASI and into one of those other specs. Would it help if we moved the definition into tool-conventions for now? We could then avoid calling these "WASI" functions. Would that help avoid confusion?</p>
<p>I'm also not tied to the name <code>init_reactor</code>. Would <code>.initialize(&amp;[])</code> or something else look less surprising?</p>
</blockquote>



<a name="198269382"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231565%20Reactor%20support./near/198269382" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231565.20Reactor.20support.2E.html#198269382">(May 20 2020 at 23:19)</a>:</h4>
<p>github-actions[bot] <a href="https://github.com/bytecodealliance/wasmtime/pull/1565#issuecomment-631787886">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1565">Issue #1565</a>:</p>
<blockquote>
<h4>Subscribe to Label Action</h4>
<p>cc @fitzgen</p>
<p>&lt;details&gt;<br>
This issue or pull request has been labeled: "fuzzing"</p>
<p>Thus the following users have been cc'd because of the following labels:</p>
<ul>
<li>fitzgen: fuzzing</li>
</ul>
<p>To subscribe or unsubscribe from this label, edit the &lt;code&gt;.github/subscribe-to-label.json&lt;/code&gt; configuration file.</p>
<p><a href="https://github.com/bytecodealliance/subscribe-to-label-action">Learn more.</a><br>
&lt;/details&gt;</p>
</blockquote>



<a name="198325750"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231565%20Reactor%20support./near/198325750" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231565.20Reactor.20support.2E.html#198325750">(May 21 2020 at 14:18)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/1565#issuecomment-632112022">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1565">Issue #1565</a>:</p>
<blockquote>
<p>Oh sorry, so I mean to say that the current as-is state of <code>NewInstance</code> feels very WASI-specific. The options you have are:</p>
<ul>
<li><code>start</code> - this is actually somewhat unrelated to the wasm <code>start</code> function and classifies every "normal" wasm module as a "reactor"</li>
<li><code>run_command</code>, <code>init_reactor</code> - WASI-specific</li>
</ul>
<p>There's not really an easy option for "just give me the <code>Instance</code> I don't care about WASI". Even with <code>init_reactor</code> you have to pass an array of arguments which can be confusing.</p>
<p>This is why I still think it's best to return an work with an <code>Instance</code>. The type-level distinction of a <code>NewInstance</code> I don't think is buying us much here. If we really want we could always probe what an <code>Instance</code> looks like and dynamically guard invocations of functions. We could say, for example, that you can't call WASI functions before you call the wasi initialization function which does the command/reactor thing.</p>
</blockquote>



<a name="198499642"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231565%20Reactor%20support./near/198499642" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231565.20Reactor.20support.2E.html#198499642">(May 22 2020 at 21:59)</a>:</h4>
<p>sunfishcode <a href="https://github.com/bytecodealliance/wasmtime/pull/1565#issuecomment-632924883">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1565">Issue #1565</a>:</p>
<blockquote>
<p>Ok, I've now gone back to <code>Instance::new</code> not doing any command/reactor stuff. I kept <code>NewInstance</code>, with a <code>start</code> function that now just runs the wasm start function. That also simplifies the C API story, so this patch now has C API updates corresponding to the Rust API updates.</p>
<p>The new approach now adds a new function <code>Linker::module</code>, which handles instantiating the module, automatically handling command/reactor semantics, which ends up being a lot nicer because we don't need APIs that conditionally consume an <code>Instance</code>. <code>Linker::module</code> avoids the user having to deal with <code>Instance</code>s altogether.</p>
</blockquote>



<a name="198781013"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231565%20Reactor%20support./near/198781013" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231565.20Reactor.20support.2E.html#198781013">(May 26 2020 at 15:39)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/1565#issuecomment-634104591">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1565">Issue #1565</a>:</p>
<blockquote>
<p>Ok this all looks great to me, thanks again for this @sunfishcode! I feel like anything further we can continue to iterate on in-tree if necessary, so I'm gonna merge.</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>