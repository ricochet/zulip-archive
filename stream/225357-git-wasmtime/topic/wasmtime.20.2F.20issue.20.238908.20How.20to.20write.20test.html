<html>
<head><meta charset="utf-8"><title>wasmtime / issue #8908 How to write test · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238908.20How.20to.20write.20test.html">wasmtime / issue #8908 How to write test</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="449607796"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238908%20How%20to%20write%20test/near/449607796" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238908.20How.20to.20write.20test.html#449607796">(Jul 07 2024 at 05:32)</a>:</h4>
<p>Shyam-Raghuwanshi opened <a href="https://github.com/bytecodealliance/wasmtime/issues/8908">issue #8908</a>:</p>
<blockquote>
<p>I have a project similar to this how can I test it ? I am able to run the guest from host but unable to figure out how to test or How to write test</p>
<p><code> guest/src/lib.rs</code></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">use</span><span class="w"> </span><span class="n">wit</span><span class="p">::</span><span class="n">demo</span><span class="p">::</span><span class="n">utils</span><span class="p">::</span><span class="n">complex</span><span class="p">::</span><span class="n">Num</span><span class="p">;</span>

<span class="k">mod</span><span class="w"> </span><span class="nn">wit</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">use</span><span class="w"> </span><span class="n">wit_bindgen</span><span class="p">::</span><span class="n">generate</span><span class="p">;</span>
<span class="w">    </span><span class="n">generate</span><span class="o">!</span><span class="p">({</span>
<span class="w">        </span><span class="n">path</span><span class="p">:</span><span class="s">"../wit"</span><span class="p">,</span>
<span class="w">        </span><span class="n">world</span><span class="p">:</span><span class="s">"reactor"</span><span class="p">,</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="k">use</span><span class="w"> </span><span class="k">super</span><span class="p">::</span><span class="n">Guest</span><span class="p">;</span>
<span class="w">    </span><span class="n">export</span><span class="o">!</span><span class="p">(</span><span class="n">Guest</span><span class="p">);</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="bp">self</span><span class="p">::</span><span class="n">exports</span><span class="p">::</span><span class="n">demo</span><span class="p">::</span><span class="n">utils</span><span class="p">::</span><span class="n">inbound_http</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">Guest</span><span class="p">;</span>

<span class="k">impl</span><span class="w"> </span><span class="n">wit</span><span class="p">::</span><span class="n">exports</span><span class="p">::</span><span class="n">demo</span><span class="p">::</span><span class="n">utils</span><span class="p">::</span><span class="n">inbound_http</span><span class="p">::</span><span class="n">Guest</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Guest</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">handle_request</span><span class="p">(</span><span class="n">req</span><span class="p">:</span><span class="w"> </span><span class="nc">wit</span><span class="p">::</span><span class="n">Request</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">wit</span><span class="p">::</span><span class="n">Response</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="fm">println!</span><span class="p">(</span><span class="s">"Request {:?}"</span><span class="p">,</span><span class="w"> </span><span class="n">req</span><span class="p">);</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">sum</span><span class="w"> </span><span class="o">=</span>
<span class="w">            </span><span class="n">wit</span><span class="p">::</span><span class="n">demo</span><span class="p">::</span><span class="n">utils</span><span class="p">::</span><span class="n">operation</span><span class="p">::</span><span class="n">add</span><span class="p">(</span><span class="n">Num</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">real</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="n">imag</span><span class="p">:</span><span class="w"> </span><span class="mi">55</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">Num</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">real</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="n">imag</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="p">});</span>
<span class="w">        </span><span class="c1">// let sum = wit::demo::utils::operation::add(</span>
<span class="w">        </span><span class="c1">//     wit::demo::utils::complex::Num { real: 1, imag: 1 },</span>
<span class="w">        </span><span class="c1">//     wit::demo::utils::complex::Num { real: 2, imag: 2 },</span>
<span class="w">        </span><span class="c1">// );</span>
<span class="w">        </span><span class="fm">println!</span><span class="p">(</span><span class="s">"Sum is = {:?}"</span><span class="p">,</span><span class="w"> </span><span class="n">sum</span><span class="p">);</span>
<span class="w">        </span><span class="n">wit</span><span class="p">::</span><span class="n">Response</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">status</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span>
<span class="w">            </span><span class="n">headers</span><span class="p">:</span><span class="w"> </span><span class="nb">None</span><span class="p">,</span>
<span class="w">            </span><span class="n">body</span><span class="p">:</span><span class="w"> </span><span class="nb">None</span><span class="p">,</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p><code>host/src/main.rs</code></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">use</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">env</span><span class="p">;</span>

<span class="c1">// use wasmtime_wasi::WasiCtx;</span>
<span class="k">use</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">path</span><span class="p">::</span><span class="n">PathBuf</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="n">wasmtime</span><span class="p">::{</span><span class="n">component</span><span class="p">::</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">Module</span><span class="p">,</span><span class="w"> </span><span class="n">Table</span><span class="p">};</span>
<span class="k">use</span><span class="w"> </span><span class="n">wasmtime</span><span class="p">::{</span><span class="n">Config</span><span class="p">,</span><span class="w"> </span><span class="n">Engine</span><span class="p">,</span><span class="w"> </span><span class="n">Store</span><span class="p">};</span>
<span class="k">use</span><span class="w"> </span><span class="n">wasmtime_wasi</span><span class="p">::</span><span class="n">bindings</span><span class="p">::{</span><span class="bp">self</span><span class="p">};</span>
<span class="k">use</span><span class="w"> </span><span class="n">wasmtime_wasi</span><span class="p">::</span><span class="n">pipe</span><span class="p">::</span><span class="n">MemoryOutputPipe</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="n">wasmtime_wasi</span><span class="p">::{</span><span class="n">WasiCtx</span><span class="p">,</span><span class="w"> </span><span class="n">WasiCtxBuilder</span><span class="p">,</span><span class="w"> </span><span class="n">WasiView</span><span class="p">};</span>

<span class="k">mod</span><span class="w"> </span><span class="nn">wit</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">wasmtime</span><span class="p">::</span><span class="n">component</span><span class="p">::</span><span class="n">bindgen</span><span class="o">!</span><span class="p">({</span>
<span class="w">        </span><span class="n">path</span><span class="p">:</span><span class="s">"../wit"</span><span class="p">,</span>
<span class="w">        </span><span class="n">world</span><span class="p">:</span><span class="s">"reactor"</span><span class="p">,</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">}</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">Host</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">table</span><span class="p">:</span><span class="w"> </span><span class="nc">ResourceTable</span><span class="p">,</span>
<span class="w">    </span><span class="n">wasi</span><span class="p">:</span><span class="w"> </span><span class="nc">WasiCtx</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1">// impl wit::demo::utils::host::Host for Host {</span>
<span class="c1">//     fn greet(&amp;mut self) -&gt; wasmtime::Result&lt;u8&gt; {</span>
<span class="c1">//         Ok(10)</span>
<span class="c1">//     }</span>
<span class="c1">// }</span>

<span class="k">impl</span><span class="w"> </span><span class="n">WasiView</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Host</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">table</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">ResourceTable</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">table</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">ctx</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">wasmtime_wasi</span><span class="p">::</span><span class="n">WasiCtx</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">wasi</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">use</span><span class="w"> </span><span class="n">wit</span><span class="p">::</span><span class="n">demo</span><span class="p">::</span><span class="n">utils</span><span class="p">::</span><span class="n">complex</span><span class="p">::</span><span class="n">Num</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="n">wit</span><span class="p">::</span><span class="n">demo</span><span class="p">::</span><span class="n">utils</span><span class="p">::</span><span class="n">http_types</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="n">wit</span><span class="p">::</span><span class="n">demo</span><span class="p">::</span><span class="n">utils</span><span class="p">::</span><span class="n">operation</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="n">wit</span><span class="p">::</span><span class="n">exports</span><span class="p">::</span><span class="n">demo</span><span class="p">::</span><span class="n">utils</span><span class="p">::</span><span class="n">inbound_http</span><span class="p">;</span>

<span class="k">impl</span><span class="w"> </span><span class="n">wit</span><span class="p">::</span><span class="n">demo</span><span class="p">::</span><span class="n">utils</span><span class="p">::</span><span class="n">complex</span><span class="p">::</span><span class="n">Host</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Host</span><span class="w"> </span><span class="p">{}</span>
<span class="k">impl</span><span class="w"> </span><span class="n">wit</span><span class="p">::</span><span class="n">demo</span><span class="p">::</span><span class="n">utils</span><span class="p">::</span><span class="n">http_types</span><span class="p">::</span><span class="n">Host</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Host</span><span class="w"> </span><span class="p">{}</span>

<span class="k">impl</span><span class="w"> </span><span class="n">operation</span><span class="p">::</span><span class="n">Host</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Host</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">:</span><span class="w"> </span><span class="nc">Num</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">:</span><span class="w"> </span><span class="nc">Num</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">wasmtime</span><span class="p">::</span><span class="nb">Result</span><span class="o">&lt;</span><span class="n">Num</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nb">Ok</span><span class="p">(</span><span class="n">Num</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">real</span><span class="p">:</span><span class="w"> </span><span class="nc">a</span><span class="p">.</span><span class="n">real</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">real</span><span class="p">,</span>
<span class="w">            </span><span class="n">imag</span><span class="p">:</span><span class="w"> </span><span class="nc">a</span><span class="p">.</span><span class="n">imag</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">imag</span><span class="p">,</span>
<span class="w">        </span><span class="p">})</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// #[tokio::main]</span>
<span class="k">fn</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">wasmtime</span><span class="p">::</span><span class="nb">Result</span><span class="o">&lt;</span><span class="p">()</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// let engine = wasmtime::Engine::default();</span>
<span class="w">    </span><span class="c1">// let mut store = wasmtime::Store::new(&amp;engine, ());</span>
<span class="w">    </span><span class="c1">// let bytes = std::fs::read("../target/wasm32-wasi/debug/guest.wasm")?;</span>
<span class="w">    </span><span class="c1">// let mut linker: wasmtime::component::Linker&lt;WasiCtx&gt; = wasmtime::component::Linker::new(&amp;engine);</span>
<span class="w">    </span><span class="n">env</span><span class="p">::</span><span class="n">set_var</span><span class="p">(</span><span class="s">"WASMTIME_BACKTRACE_DETAILS"</span><span class="p">,</span><span class="w"> </span><span class="s">"1"</span><span class="p">);</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Config</span><span class="p">::</span><span class="n">new</span><span class="p">();</span>
<span class="w">    </span><span class="n">config</span><span class="p">.</span><span class="n">wasm_component_model</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">    </span><span class="n">config</span><span class="p">.</span><span class="n">async_support</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>

<span class="w">    </span><span class="c1">//In the context of wasmtime, Engine is a struct that represents the configuration and context for compiling WebAssembly modules. It is a central part of the Wasmtime API, responsible for managing the lifecycle of compiled WebAssembly code and providing the necessary environment for execution.</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">engine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Engine</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">config</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="o">=</span>
<span class="w">        </span><span class="n">Component</span><span class="p">::</span><span class="n">from_file</span><span class="p">(</span><span class="o">&amp;</span><span class="n">engine</span><span class="p">,</span><span class="w"> </span><span class="s">"guest.wasm"</span><span class="p">).</span><span class="n">expect</span><span class="p">(</span><span class="s">"guest.wasm not found"</span><span class="p">);</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">linker</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Linker</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">engine</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Create our wasi context.</span>
<span class="w">    </span><span class="c1">// let mut builder = WasiCtxBuilder::new();</span>

<span class="w">    </span><span class="c1">// let stdout = MemoryOutputPipe::new(4096);</span>
<span class="w">    </span><span class="c1">// let stderr = MemoryOutputPipe::new(4096);</span>
<span class="w">    </span><span class="c1">// builder.stdout(stdout.clone()).stderr(stderr.clone());</span>

<span class="w">    </span><span class="n">bindings</span><span class="p">::</span><span class="n">cli</span><span class="p">::</span><span class="n">environment</span><span class="p">::</span><span class="n">add_to_linker</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">linker</span><span class="p">,</span><span class="w"> </span><span class="o">|</span><span class="n">x</span><span class="o">|</span><span class="w"> </span><span class="n">x</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">"Unable to add environment"</span><span class="p">);</span>
<span class="w">    </span><span class="n">bindings</span><span class="p">::</span><span class="n">cli</span><span class="p">::</span><span class="n">exit</span><span class="p">::</span><span class="n">add_to_linker</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">linker</span><span class="p">,</span><span class="w"> </span><span class="o">|</span><span class="n">x</span><span class="o">|</span><span class="w"> </span><span class="n">x</span><span class="p">).</span><span class="n">expect</span><span class="p">(</span><span class="s">"Unable to add cli"</span><span class="p">);</span>
<span class="w">    </span><span class="n">bindings</span><span class="p">::</span><span class="n">io</span><span class="p">::</span><span class="n">error</span><span class="p">::</span><span class="n">add_to_linker</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">linker</span><span class="p">,</span><span class="w"> </span><span class="o">|</span><span class="n">x</span><span class="o">|</span><span class="w"> </span><span class="n">x</span><span class="p">).</span><span class="n">expect</span><span class="p">(</span><span class="s">"Unable to add io error"</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// bindings::sync::io::streams::add_to_linker(&amp;mut linker, |x| x)</span>
<span class="w">    </span><span class="c1">//     .expect("Unable to add io streams");</span>
<span class="w">    </span><span class="n">bindings</span><span class="p">::</span><span class="n">sync_io</span><span class="p">::</span><span class="n">io</span><span class="p">::</span><span class="n">streams</span><span class="p">::</span><span class="n">add_to_linker</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">linker</span><span class="p">,</span><span class="w"> </span><span class="o">|</span><span class="n">x</span><span class="o">|</span><span class="w"> </span><span class="n">x</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">"Unable to add io streams"</span><span class="p">);</span>
<span class="w">    </span><span class="n">bindings</span><span class="p">::</span><span class="n">cli</span><span class="p">::</span><span class="n">stdin</span><span class="p">::</span><span class="n">add_to_linker</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">linker</span><span class="p">,</span><span class="w"> </span><span class="o">|</span><span class="n">x</span><span class="o">|</span><span class="w"> </span><span class="n">x</span><span class="p">).</span><span class="n">expect</span><span class="p">(</span><span class="s">"Unable to add cli stdin"</span><span class="p">);</span>
<span class="w">    </span><span class="n">bindings</span><span class="p">::</span><span class="n">cli</span><span class="p">::</span><span class="n">stdout</span><span class="p">::</span><span class="n">add_to_linker</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">linker</span><span class="p">,</span><span class="w"> </span><span class="o">|</span><span class="n">x</span><span class="o">|</span><span class="w"> </span><span class="n">x</span><span class="p">).</span><span class="n">expect</span><span class="p">(</span><span class="s">"Unable to add cli stdout"</span><span class="p">);</span>
<span class="w">    </span><span class="n">bindings</span><span class="p">::</span><span class="n">cli</span><span class="p">::</span><span class="n">stderr</span><span class="p">::</span><span class="n">add_to_linker</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">linker</span><span class="p">,</span><span class="w"> </span><span class="o">|</span><span class="n">x</span><span class="o">|</span><span class="w"> </span><span class="n">x</span><span class="p">).</span><span class="n">expect</span><span class="p">(</span><span class="s">"Unable to add cli stderr"</span><span class="p">);</span>
<span class="w">    </span><span class="n">bindings</span><span class="p">::</span><span class="n">clocks</span><span class="p">::</span><span class="n">wall_clock</span><span class="p">::</span><span class="n">add_to_linker</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">linker</span><span class="p">,</span><span class="w"> </span><span class="o">|</span><span class="n">x</span><span class="o">|</span><span class="w"> </span><span class="n">x</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">"Unable to add clocks wallclock"</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// bindings::sync::filesystem::types::add_to_linker(&amp;mut linker, |x| x)</span>
<span class="w">    </span><span class="c1">//     .expect("Unable to add filesystem types");</span>
<span class="w">    </span><span class="n">bindings</span><span class="p">::</span><span class="n">sync_io</span><span class="p">::</span><span class="n">filesystem</span><span class="p">::</span><span class="n">types</span><span class="p">::</span><span class="n">add_to_linker</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">linker</span><span class="p">,</span><span class="w"> </span><span class="o">|</span><span class="n">x</span><span class="o">|</span><span class="w"> </span><span class="n">x</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">"Unable to add filesystem types"</span><span class="p">);</span>
<span class="w">    </span><span class="n">bindings</span><span class="p">::</span><span class="n">filesystem</span><span class="p">::</span><span class="n">preopens</span><span class="p">::</span><span class="n">add_to_linker</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">linker</span><span class="p">,</span><span class="w"> </span><span class="o">|</span><span class="n">x</span><span class="o">|</span><span class="w"> </span><span class="n">x</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">"Unable to add filesystem preopens"</span><span class="p">);</span>

<span class="w">    </span><span class="n">wit</span><span class="p">::</span><span class="n">Reactor</span><span class="p">::</span><span class="n">add_to_linker</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">linker</span><span class="p">,</span><span class="w"> </span><span class="o">|</span><span class="n">x</span><span class="o">|</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">table</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ResourceTable</span><span class="p">::</span><span class="n">new</span><span class="p">();</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">wasi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WasiCtxBuilder</span><span class="p">::</span><span class="n">new</span><span class="p">().</span><span class="n">inherit_stdio</span><span class="p">().</span><span class="n">build</span><span class="p">();</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">store</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Store</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">engine</span><span class="p">,</span><span class="w"> </span><span class="n">Host</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">table</span><span class="p">,</span><span class="w"> </span><span class="n">wasi</span><span class="w"> </span><span class="p">});</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">reactor</span><span class="p">,</span><span class="w"> </span><span class="n">instance</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wit</span><span class="p">::</span><span class="n">Reactor</span><span class="p">::</span><span class="n">instantiate</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">component</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">linker</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// let guest = reactor.demo_utils_guest();</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">guest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reactor</span><span class="p">.</span><span class="n">demo_utils_inbound_http</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// let result = guest.call_get_data(&amp;mut store)?;</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">inbound_http</span><span class="p">::</span><span class="n">Request</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">method</span><span class="p">:</span><span class="w"> </span><span class="nc">http_types</span><span class="p">::</span><span class="n">Method</span><span class="p">::</span><span class="n">Get</span><span class="p">,</span>
<span class="w">        </span><span class="n">uri</span><span class="p">:</span><span class="w"> </span><span class="s">"http://google.com"</span><span class="p">.</span><span class="n">to_string</span><span class="p">(),</span>
<span class="w">        </span><span class="n">headers</span><span class="p">:</span><span class="w"> </span><span class="nc">vec</span><span class="o">!</span><span class="p">[(</span><span class="nb">String</span><span class="p">::</span><span class="n">from</span><span class="p">(</span><span class="s">"method"</span><span class="p">),</span><span class="w"> </span><span class="nb">String</span><span class="p">::</span><span class="n">from</span><span class="p">(</span><span class="s">"get"</span><span class="p">))],</span>
<span class="w">        </span><span class="n">params</span><span class="p">:</span><span class="w"> </span><span class="nc">vec</span><span class="o">!</span><span class="p">[],</span>
<span class="w">        </span><span class="n">body</span><span class="p">:</span><span class="w"> </span><span class="nb">None</span><span class="p">,</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">guest</span><span class="p">.</span><span class="n">call_handle_request</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">request</span><span class="p">);</span>
<span class="w">    </span><span class="k">match</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nb">Ok</span><span class="p">(</span><span class="n">res</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="fm">println!</span><span class="p">(</span><span class="s">"Response : {:?}"</span><span class="p">,</span><span class="w"> </span><span class="n">res</span><span class="p">),</span>
<span class="w">        </span><span class="nb">Err</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="fm">println!</span><span class="p">(</span><span class="s">"Error occured : {:?}"</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="p">),</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">    </span><span class="c1">// let linker = wasmtime::Linker::new(&amp;engine);</span>
<span class="w">    </span><span class="c1">// let module_instance = linker</span>
<span class="w">    </span><span class="c1">//     .instantiate(&amp;mut store, &amp;module)</span>
<span class="w">    </span><span class="c1">//     .expect("Unable to get module instance");</span>
<span class="w">    </span><span class="c1">// let bye = module_instance.get_typed_func::&lt;(), u32&gt;(&amp;mut store, "bye")?;</span>

<span class="w">    </span><span class="c1">// let bye_result = bye.call(&amp;mut store, ()).expect("Function run failed");</span>
<span class="w">    </span><span class="c1">// println!("From bye {}",bye_result);</span>

<span class="w">    </span><span class="c1">// let callme = instance.get_typed_func::&lt;(), ()&gt;(&amp;mut store, "getData")?;</span>
<span class="w">    </span><span class="c1">// callme.call(&amp;mut store, ())?;</span>
<span class="w">    </span><span class="nb">Ok</span><span class="p">(())</span>
<span class="p">}</span>
</code></pre></div>
<h3>Wit files</h3>
<p><code>demo.wit</code></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">package</span><span class="w"> </span><span class="n">demo</span><span class="p">:</span><span class="nc">utils</span><span class="p">;</span>

<span class="n">world</span><span class="w"> </span><span class="n">reactor</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">import</span><span class="w"> </span><span class="n">operation</span><span class="p">;</span>
<span class="w">    </span><span class="n">export</span><span class="w"> </span><span class="n">inbound</span><span class="o">-</span><span class="n">http</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p><code>complex.wit</code></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">interface</span><span class="w"> </span><span class="n">complex</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">record</span><span class="w"> </span><span class="n">num</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">real</span><span class="p">:</span><span class="w"> </span><span class="kt">u16</span><span class="p">,</span>
<span class="w">        </span><span class="n">imag</span><span class="p">:</span><span class="w"> </span><span class="kt">u16</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p><code>http-types.wit</code></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">interface</span><span class="w"> </span><span class="n">http</span><span class="o">-</span><span class="n">types</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="k">type</span><span class="w"> </span><span class="nc">http</span><span class="o">-</span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">u16</span><span class="p">;</span>
<span class="w">   </span><span class="k">type</span><span class="w"> </span><span class="nc">body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">list</span><span class="o">&lt;</span><span class="kt">u8</span><span class="o">&gt;</span><span class="p">;</span>
<span class="w">   </span><span class="k">type</span><span class="w"> </span><span class="nc">headers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">list</span><span class="o">&lt;</span><span class="n">tuple</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="n">string</span><span class="o">&gt;&gt;</span><span class="p">;</span>
<span class="w">   </span><span class="k">type</span><span class="w"> </span><span class="nc">params</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">list</span><span class="o">&lt;</span><span class="n">tuple</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="n">string</span><span class="o">&gt;&gt;</span><span class="p">;</span>
<span class="w">   </span><span class="k">type</span><span class="w"> </span><span class="nc">uri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">string</span><span class="p">;</span>

<span class="w">    </span><span class="k">enum</span><span class="w"> </span><span class="nc">method</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">get</span><span class="p">,</span>
<span class="w">        </span><span class="n">post</span><span class="p">,</span>
<span class="w">        </span><span class="n">put</span><span class="p">,</span>
<span class="w">        </span><span class="n">delete</span><span class="p">,</span>
<span class="w">        </span><span class="n">patch</span><span class="p">,</span>
<span class="w">        </span><span class="n">head</span><span class="p">,</span>
<span class="w">        </span><span class="n">options</span><span class="p">,</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">record</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">method</span><span class="p">:</span><span class="w"> </span><span class="nc">method</span><span class="p">,</span>
<span class="w">        </span><span class="n">uri</span><span class="p">:</span><span class="w"> </span><span class="nc">uri</span><span class="p">,</span>
<span class="w">        </span><span class="n">headers</span><span class="p">:</span><span class="w"> </span><span class="nc">headers</span><span class="p">,</span>
<span class="w">        </span><span class="n">params</span><span class="p">:</span><span class="w"> </span><span class="nc">params</span><span class="p">,</span>
<span class="w">        </span><span class="n">body</span><span class="p">:</span><span class="w"> </span><span class="nc">option</span><span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">record</span><span class="w"> </span><span class="n">response</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">status</span><span class="p">:</span><span class="w"> </span><span class="nc">http</span><span class="o">-</span><span class="n">status</span><span class="p">,</span>
<span class="w">        </span><span class="n">headers</span><span class="p">:</span><span class="w"> </span><span class="nc">option</span><span class="o">&lt;</span><span class="n">headers</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">        </span><span class="n">body</span><span class="p">:</span><span class="w"> </span><span class="nc">option</span><span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">enum</span><span class="w"> </span><span class="nc">http</span><span class="o">-</span><span class="n">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">success</span><span class="p">,</span>
<span class="w">        </span><span class="n">destination</span><span class="o">-</span><span class="n">not</span><span class="o">-</span><span class="n">allowed</span><span class="p">,</span>
<span class="w">        </span><span class="n">invalid</span><span class="o">-</span><span class="n">url</span><span class="p">,</span>
<span class="w">        </span><span class="n">request</span><span class="o">-</span><span class="n">error</span><span class="p">,</span>
<span class="w">        </span><span class="n">runtime</span><span class="o">-</span><span class="n">error</span><span class="p">,</span>
<span class="w">        </span><span class="n">too</span><span class="o">-</span><span class="n">many</span><span class="o">-</span><span class="n">requests</span><span class="p">,</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p><code>inbound-http</code></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">interface</span><span class="w"> </span><span class="n">inbound</span><span class="o">-</span><span class="n">http</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">use</span><span class="w"> </span><span class="n">http</span><span class="o">-</span><span class="n">types</span><span class="p">.{</span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">response</span><span class="p">};</span>

<span class="w">    </span><span class="n">handle</span><span class="o">-</span><span class="n">request</span><span class="p">:</span><span class="w"> </span><span class="nc">func</span><span class="p">(</span><span class="n">req</span><span class="p">:</span><span class="w"> </span><span class="nc">request</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">response</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p><code>sum.wit</code></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">interface</span><span class="w"> </span><span class="n">operation</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">use</span><span class="w"> </span><span class="n">complex</span><span class="p">.{</span><span class="n">num</span><span class="p">};</span>
<span class="w">    </span><span class="n">add</span><span class="p">:</span><span class="w"> </span><span class="nc">func</span><span class="p">(</span><span class="n">a</span><span class="p">:</span><span class="nc">num</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">:</span><span class="nc">num</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">num</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
</blockquote>



<a name="449608920"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238908%20How%20to%20write%20test/near/449608920" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238908.20How.20to.20write.20test.html#449608920">(Jul 07 2024 at 05:50)</a>:</h4>
<p>Shyam-Raghuwanshi edited <a href="https://github.com/bytecodealliance/wasmtime/issues/8908">issue #8908</a>:</p>
<blockquote>
<p>I have a project similar to this how can I test it ? I am able to run the guest from host but unable to figure out how to test or How to write test</p>
<p><code> guest/src/lib.rs</code></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">use</span><span class="w"> </span><span class="n">wit</span><span class="p">::</span><span class="n">demo</span><span class="p">::</span><span class="n">utils</span><span class="p">::</span><span class="n">complex</span><span class="p">::</span><span class="n">Num</span><span class="p">;</span>

<span class="k">mod</span><span class="w"> </span><span class="nn">wit</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">use</span><span class="w"> </span><span class="n">wit_bindgen</span><span class="p">::</span><span class="n">generate</span><span class="p">;</span>
<span class="w">    </span><span class="n">generate</span><span class="o">!</span><span class="p">({</span>
<span class="w">        </span><span class="n">path</span><span class="p">:</span><span class="s">"../wit"</span><span class="p">,</span>
<span class="w">        </span><span class="n">world</span><span class="p">:</span><span class="s">"reactor"</span><span class="p">,</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="k">use</span><span class="w"> </span><span class="k">super</span><span class="p">::</span><span class="n">Guest</span><span class="p">;</span>
<span class="w">    </span><span class="n">export</span><span class="o">!</span><span class="p">(</span><span class="n">Guest</span><span class="p">);</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="bp">self</span><span class="p">::</span><span class="n">exports</span><span class="p">::</span><span class="n">demo</span><span class="p">::</span><span class="n">utils</span><span class="p">::</span><span class="n">inbound_http</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">Guest</span><span class="p">;</span>

<span class="k">impl</span><span class="w"> </span><span class="n">wit</span><span class="p">::</span><span class="n">exports</span><span class="p">::</span><span class="n">demo</span><span class="p">::</span><span class="n">utils</span><span class="p">::</span><span class="n">inbound_http</span><span class="p">::</span><span class="n">Guest</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Guest</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">handle_request</span><span class="p">(</span><span class="n">req</span><span class="p">:</span><span class="w"> </span><span class="nc">wit</span><span class="p">::</span><span class="n">Request</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">wit</span><span class="p">::</span><span class="n">Response</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="fm">println!</span><span class="p">(</span><span class="s">"Request {:?}"</span><span class="p">,</span><span class="w"> </span><span class="n">req</span><span class="p">);</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">sum</span><span class="w"> </span><span class="o">=</span>
<span class="w">            </span><span class="n">wit</span><span class="p">::</span><span class="n">demo</span><span class="p">::</span><span class="n">utils</span><span class="p">::</span><span class="n">operation</span><span class="p">::</span><span class="n">add</span><span class="p">(</span><span class="n">Num</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">real</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="n">imag</span><span class="p">:</span><span class="w"> </span><span class="mi">55</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">Num</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">real</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="n">imag</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="p">});</span>
<span class="w">        </span><span class="c1">// let sum = wit::demo::utils::operation::add(</span>
<span class="w">        </span><span class="c1">//     wit::demo::utils::complex::Num { real: 1, imag: 1 },</span>
<span class="w">        </span><span class="c1">//     wit::demo::utils::complex::Num { real: 2, imag: 2 },</span>
<span class="w">        </span><span class="c1">// );</span>
<span class="w">        </span><span class="fm">println!</span><span class="p">(</span><span class="s">"Sum is = {:?}"</span><span class="p">,</span><span class="w"> </span><span class="n">sum</span><span class="p">);</span>
<span class="w">        </span><span class="n">wit</span><span class="p">::</span><span class="n">Response</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">status</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span>
<span class="w">            </span><span class="n">headers</span><span class="p">:</span><span class="w"> </span><span class="nb">None</span><span class="p">,</span>
<span class="w">            </span><span class="n">body</span><span class="p">:</span><span class="w"> </span><span class="nb">None</span><span class="p">,</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p><code>host/src/main.rs</code></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">use</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">env</span><span class="p">;</span>

<span class="c1">// use wasmtime_wasi::WasiCtx;</span>
<span class="k">use</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">path</span><span class="p">::</span><span class="n">PathBuf</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="n">wasmtime</span><span class="p">::{</span><span class="n">component</span><span class="p">::</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">Module</span><span class="p">,</span><span class="w"> </span><span class="n">Table</span><span class="p">};</span>
<span class="k">use</span><span class="w"> </span><span class="n">wasmtime</span><span class="p">::{</span><span class="n">Config</span><span class="p">,</span><span class="w"> </span><span class="n">Engine</span><span class="p">,</span><span class="w"> </span><span class="n">Store</span><span class="p">};</span>
<span class="k">use</span><span class="w"> </span><span class="n">wasmtime_wasi</span><span class="p">::</span><span class="n">bindings</span><span class="p">::{</span><span class="bp">self</span><span class="p">};</span>
<span class="k">use</span><span class="w"> </span><span class="n">wasmtime_wasi</span><span class="p">::</span><span class="n">pipe</span><span class="p">::</span><span class="n">MemoryOutputPipe</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="n">wasmtime_wasi</span><span class="p">::{</span><span class="n">WasiCtx</span><span class="p">,</span><span class="w"> </span><span class="n">WasiCtxBuilder</span><span class="p">,</span><span class="w"> </span><span class="n">WasiView</span><span class="p">};</span>

<span class="k">mod</span><span class="w"> </span><span class="nn">wit</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">wasmtime</span><span class="p">::</span><span class="n">component</span><span class="p">::</span><span class="n">bindgen</span><span class="o">!</span><span class="p">({</span>
<span class="w">        </span><span class="n">path</span><span class="p">:</span><span class="s">"../wit"</span><span class="p">,</span>
<span class="w">        </span><span class="n">world</span><span class="p">:</span><span class="s">"reactor"</span><span class="p">,</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">}</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">Host</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">table</span><span class="p">:</span><span class="w"> </span><span class="nc">ResourceTable</span><span class="p">,</span>
<span class="w">    </span><span class="n">wasi</span><span class="p">:</span><span class="w"> </span><span class="nc">WasiCtx</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1">// impl wit::demo::utils::host::Host for Host {</span>
<span class="c1">//     fn greet(&amp;mut self) -&gt; wasmtime::Result&lt;u8&gt; {</span>
<span class="c1">//         Ok(10)</span>
<span class="c1">//     }</span>
<span class="c1">// }</span>

<span class="k">impl</span><span class="w"> </span><span class="n">WasiView</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Host</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">table</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">ResourceTable</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">table</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">ctx</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">wasmtime_wasi</span><span class="p">::</span><span class="n">WasiCtx</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">wasi</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">use</span><span class="w"> </span><span class="n">wit</span><span class="p">::</span><span class="n">demo</span><span class="p">::</span><span class="n">utils</span><span class="p">::</span><span class="n">complex</span><span class="p">::</span><span class="n">Num</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="n">wit</span><span class="p">::</span><span class="n">demo</span><span class="p">::</span><span class="n">utils</span><span class="p">::</span><span class="n">http_types</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="n">wit</span><span class="p">::</span><span class="n">demo</span><span class="p">::</span><span class="n">utils</span><span class="p">::</span><span class="n">operation</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="n">wit</span><span class="p">::</span><span class="n">exports</span><span class="p">::</span><span class="n">demo</span><span class="p">::</span><span class="n">utils</span><span class="p">::</span><span class="n">inbound_http</span><span class="p">;</span>

<span class="k">impl</span><span class="w"> </span><span class="n">wit</span><span class="p">::</span><span class="n">demo</span><span class="p">::</span><span class="n">utils</span><span class="p">::</span><span class="n">complex</span><span class="p">::</span><span class="n">Host</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Host</span><span class="w"> </span><span class="p">{}</span>
<span class="k">impl</span><span class="w"> </span><span class="n">wit</span><span class="p">::</span><span class="n">demo</span><span class="p">::</span><span class="n">utils</span><span class="p">::</span><span class="n">http_types</span><span class="p">::</span><span class="n">Host</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Host</span><span class="w"> </span><span class="p">{}</span>

<span class="k">impl</span><span class="w"> </span><span class="n">operation</span><span class="p">::</span><span class="n">Host</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Host</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">:</span><span class="w"> </span><span class="nc">Num</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">:</span><span class="w"> </span><span class="nc">Num</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">wasmtime</span><span class="p">::</span><span class="nb">Result</span><span class="o">&lt;</span><span class="n">Num</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nb">Ok</span><span class="p">(</span><span class="n">Num</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">real</span><span class="p">:</span><span class="w"> </span><span class="nc">a</span><span class="p">.</span><span class="n">real</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">real</span><span class="p">,</span>
<span class="w">            </span><span class="n">imag</span><span class="p">:</span><span class="w"> </span><span class="nc">a</span><span class="p">.</span><span class="n">imag</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">imag</span><span class="p">,</span>
<span class="w">        </span><span class="p">})</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// #[tokio::main]</span>
<span class="k">fn</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">wasmtime</span><span class="p">::</span><span class="nb">Result</span><span class="o">&lt;</span><span class="p">()</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// let engine = wasmtime::Engine::default();</span>
<span class="w">    </span><span class="c1">// let mut store = wasmtime::Store::new(&amp;engine, ());</span>
<span class="w">    </span><span class="c1">// let bytes = std::fs::read("../target/wasm32-wasi/debug/guest.wasm")?;</span>
<span class="w">    </span><span class="c1">// let mut linker: wasmtime::component::Linker&lt;WasiCtx&gt; = wasmtime::component::Linker::new(&amp;engine);</span>
<span class="w">    </span><span class="n">env</span><span class="p">::</span><span class="n">set_var</span><span class="p">(</span><span class="s">"WASMTIME_BACKTRACE_DETAILS"</span><span class="p">,</span><span class="w"> </span><span class="s">"1"</span><span class="p">);</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Config</span><span class="p">::</span><span class="n">new</span><span class="p">();</span>
<span class="w">    </span><span class="n">config</span><span class="p">.</span><span class="n">wasm_component_model</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">    </span><span class="n">config</span><span class="p">.</span><span class="n">async_support</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>

<span class="w">    </span><span class="c1">//In the context of wasmtime, Engine is a struct that represents the configuration and context for compiling WebAssembly modules. It is a central part of the Wasmtime API, responsible for managing the lifecycle of compiled WebAssembly code and providing the necessary environment for execution.</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">engine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Engine</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">config</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="o">=</span>
<span class="w">        </span><span class="n">Component</span><span class="p">::</span><span class="n">from_file</span><span class="p">(</span><span class="o">&amp;</span><span class="n">engine</span><span class="p">,</span><span class="w"> </span><span class="s">"guest.wasm"</span><span class="p">).</span><span class="n">expect</span><span class="p">(</span><span class="s">"guest.wasm not found"</span><span class="p">);</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">linker</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Linker</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">engine</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Create our wasi context.</span>
<span class="w">    </span><span class="c1">// let mut builder = WasiCtxBuilder::new();</span>

<span class="w">    </span><span class="c1">// let stdout = MemoryOutputPipe::new(4096);</span>
<span class="w">    </span><span class="c1">// let stderr = MemoryOutputPipe::new(4096);</span>
<span class="w">    </span><span class="c1">// builder.stdout(stdout.clone()).stderr(stderr.clone());</span>

<span class="w">    </span><span class="n">bindings</span><span class="p">::</span><span class="n">cli</span><span class="p">::</span><span class="n">environment</span><span class="p">::</span><span class="n">add_to_linker</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">linker</span><span class="p">,</span><span class="w"> </span><span class="o">|</span><span class="n">x</span><span class="o">|</span><span class="w"> </span><span class="n">x</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">"Unable to add environment"</span><span class="p">);</span>
<span class="w">    </span><span class="n">bindings</span><span class="p">::</span><span class="n">cli</span><span class="p">::</span><span class="n">exit</span><span class="p">::</span><span class="n">add_to_linker</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">linker</span><span class="p">,</span><span class="w"> </span><span class="o">|</span><span class="n">x</span><span class="o">|</span><span class="w"> </span><span class="n">x</span><span class="p">).</span><span class="n">expect</span><span class="p">(</span><span class="s">"Unable to add cli"</span><span class="p">);</span>
<span class="w">    </span><span class="n">bindings</span><span class="p">::</span><span class="n">io</span><span class="p">::</span><span class="n">error</span><span class="p">::</span><span class="n">add_to_linker</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">linker</span><span class="p">,</span><span class="w"> </span><span class="o">|</span><span class="n">x</span><span class="o">|</span><span class="w"> </span><span class="n">x</span><span class="p">).</span><span class="n">expect</span><span class="p">(</span><span class="s">"Unable to add io error"</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// bindings::sync::io::streams::add_to_linker(&amp;mut linker, |x| x)</span>
<span class="w">    </span><span class="c1">//     .expect("Unable to add io streams");</span>
<span class="w">    </span><span class="n">bindings</span><span class="p">::</span><span class="n">sync_io</span><span class="p">::</span><span class="n">io</span><span class="p">::</span><span class="n">streams</span><span class="p">::</span><span class="n">add_to_linker</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">linker</span><span class="p">,</span><span class="w"> </span><span class="o">|</span><span class="n">x</span><span class="o">|</span><span class="w"> </span><span class="n">x</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">"Unable to add io streams"</span><span class="p">);</span>
<span class="w">    </span><span class="n">bindings</span><span class="p">::</span><span class="n">cli</span><span class="p">::</span><span class="n">stdin</span><span class="p">::</span><span class="n">add_to_linker</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">linker</span><span class="p">,</span><span class="w"> </span><span class="o">|</span><span class="n">x</span><span class="o">|</span><span class="w"> </span><span class="n">x</span><span class="p">).</span><span class="n">expect</span><span class="p">(</span><span class="s">"Unable to add cli stdin"</span><span class="p">);</span>
<span class="w">    </span><span class="n">bindings</span><span class="p">::</span><span class="n">cli</span><span class="p">::</span><span class="n">stdout</span><span class="p">::</span><span class="n">add_to_linker</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">linker</span><span class="p">,</span><span class="w"> </span><span class="o">|</span><span class="n">x</span><span class="o">|</span><span class="w"> </span><span class="n">x</span><span class="p">).</span><span class="n">expect</span><span class="p">(</span><span class="s">"Unable to add cli stdout"</span><span class="p">);</span>
<span class="w">    </span><span class="n">bindings</span><span class="p">::</span><span class="n">cli</span><span class="p">::</span><span class="n">stderr</span><span class="p">::</span><span class="n">add_to_linker</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">linker</span><span class="p">,</span><span class="w"> </span><span class="o">|</span><span class="n">x</span><span class="o">|</span><span class="w"> </span><span class="n">x</span><span class="p">).</span><span class="n">expect</span><span class="p">(</span><span class="s">"Unable to add cli stderr"</span><span class="p">);</span>
<span class="w">    </span><span class="n">bindings</span><span class="p">::</span><span class="n">clocks</span><span class="p">::</span><span class="n">wall_clock</span><span class="p">::</span><span class="n">add_to_linker</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">linker</span><span class="p">,</span><span class="w"> </span><span class="o">|</span><span class="n">x</span><span class="o">|</span><span class="w"> </span><span class="n">x</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">"Unable to add clocks wallclock"</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// bindings::sync::filesystem::types::add_to_linker(&amp;mut linker, |x| x)</span>
<span class="w">    </span><span class="c1">//     .expect("Unable to add filesystem types");</span>
<span class="w">    </span><span class="n">bindings</span><span class="p">::</span><span class="n">sync_io</span><span class="p">::</span><span class="n">filesystem</span><span class="p">::</span><span class="n">types</span><span class="p">::</span><span class="n">add_to_linker</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">linker</span><span class="p">,</span><span class="w"> </span><span class="o">|</span><span class="n">x</span><span class="o">|</span><span class="w"> </span><span class="n">x</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">"Unable to add filesystem types"</span><span class="p">);</span>
<span class="w">    </span><span class="n">bindings</span><span class="p">::</span><span class="n">filesystem</span><span class="p">::</span><span class="n">preopens</span><span class="p">::</span><span class="n">add_to_linker</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">linker</span><span class="p">,</span><span class="w"> </span><span class="o">|</span><span class="n">x</span><span class="o">|</span><span class="w"> </span><span class="n">x</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">"Unable to add filesystem preopens"</span><span class="p">);</span>

<span class="w">    </span><span class="n">wit</span><span class="p">::</span><span class="n">Reactor</span><span class="p">::</span><span class="n">add_to_linker</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">linker</span><span class="p">,</span><span class="w"> </span><span class="o">|</span><span class="n">x</span><span class="o">|</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">table</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ResourceTable</span><span class="p">::</span><span class="n">new</span><span class="p">();</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">wasi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WasiCtxBuilder</span><span class="p">::</span><span class="n">new</span><span class="p">().</span><span class="n">inherit_stdio</span><span class="p">().</span><span class="n">build</span><span class="p">();</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">store</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Store</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">engine</span><span class="p">,</span><span class="w"> </span><span class="n">Host</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">table</span><span class="p">,</span><span class="w"> </span><span class="n">wasi</span><span class="w"> </span><span class="p">});</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">reactor</span><span class="p">,</span><span class="w"> </span><span class="n">instance</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wit</span><span class="p">::</span><span class="n">Reactor</span><span class="p">::</span><span class="n">instantiate</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">component</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">linker</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// let guest = reactor.demo_utils_guest();</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">guest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reactor</span><span class="p">.</span><span class="n">demo_utils_inbound_http</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// let result = guest.call_get_data(&amp;mut store)?;</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">inbound_http</span><span class="p">::</span><span class="n">Request</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">method</span><span class="p">:</span><span class="w"> </span><span class="nc">http_types</span><span class="p">::</span><span class="n">Method</span><span class="p">::</span><span class="n">Get</span><span class="p">,</span>
<span class="w">        </span><span class="n">uri</span><span class="p">:</span><span class="w"> </span><span class="s">"http://google.com"</span><span class="p">.</span><span class="n">to_string</span><span class="p">(),</span>
<span class="w">        </span><span class="n">headers</span><span class="p">:</span><span class="w"> </span><span class="nc">vec</span><span class="o">!</span><span class="p">[(</span><span class="nb">String</span><span class="p">::</span><span class="n">from</span><span class="p">(</span><span class="s">"method"</span><span class="p">),</span><span class="w"> </span><span class="nb">String</span><span class="p">::</span><span class="n">from</span><span class="p">(</span><span class="s">"get"</span><span class="p">))],</span>
<span class="w">        </span><span class="n">params</span><span class="p">:</span><span class="w"> </span><span class="nc">vec</span><span class="o">!</span><span class="p">[],</span>
<span class="w">        </span><span class="n">body</span><span class="p">:</span><span class="w"> </span><span class="nb">None</span><span class="p">,</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">guest</span><span class="p">.</span><span class="n">call_handle_request</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">request</span><span class="p">);</span>
<span class="w">    </span><span class="k">match</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nb">Ok</span><span class="p">(</span><span class="n">res</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="fm">println!</span><span class="p">(</span><span class="s">"Response : {:?}"</span><span class="p">,</span><span class="w"> </span><span class="n">res</span><span class="p">),</span>
<span class="w">        </span><span class="nb">Err</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="fm">println!</span><span class="p">(</span><span class="s">"Error occured : {:?}"</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="p">),</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">    </span><span class="c1">// let linker = wasmtime::Linker::new(&amp;engine);</span>
<span class="w">    </span><span class="c1">// let module_instance = linker</span>
<span class="w">    </span><span class="c1">//     .instantiate(&amp;mut store, &amp;module)</span>
<span class="w">    </span><span class="c1">//     .expect("Unable to get module instance");</span>
<span class="w">    </span><span class="c1">// let bye = module_instance.get_typed_func::&lt;(), u32&gt;(&amp;mut store, "bye")?;</span>

<span class="w">    </span><span class="c1">// let bye_result = bye.call(&amp;mut store, ()).expect("Function run failed");</span>
<span class="w">    </span><span class="c1">// println!("From bye {}",bye_result);</span>

<span class="w">    </span><span class="c1">// let callme = instance.get_typed_func::&lt;(), ()&gt;(&amp;mut store, "getData")?;</span>
<span class="w">    </span><span class="c1">// callme.call(&amp;mut store, ())?;</span>
<span class="w">    </span><span class="nb">Ok</span><span class="p">(())</span>
<span class="p">}</span>
</code></pre></div>
<h3>Wit files</h3>
<p><code>demo.wit</code></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">package</span><span class="w"> </span><span class="n">demo</span><span class="p">:</span><span class="nc">utils</span><span class="p">;</span>

<span class="n">world</span><span class="w"> </span><span class="n">reactor</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">import</span><span class="w"> </span><span class="n">operation</span><span class="p">;</span>
<span class="w">    </span><span class="n">export</span><span class="w"> </span><span class="n">inbound</span><span class="o">-</span><span class="n">http</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p><code>complex.wit</code></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">interface</span><span class="w"> </span><span class="n">complex</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">record</span><span class="w"> </span><span class="n">num</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">real</span><span class="p">:</span><span class="w"> </span><span class="kt">u16</span><span class="p">,</span>
<span class="w">        </span><span class="n">imag</span><span class="p">:</span><span class="w"> </span><span class="kt">u16</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p><code>http-types.wit</code></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">interface</span><span class="w"> </span><span class="n">http</span><span class="o">-</span><span class="n">types</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="k">type</span><span class="w"> </span><span class="nc">http</span><span class="o">-</span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">u16</span><span class="p">;</span>
<span class="w">   </span><span class="k">type</span><span class="w"> </span><span class="nc">body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">list</span><span class="o">&lt;</span><span class="kt">u8</span><span class="o">&gt;</span><span class="p">;</span>
<span class="w">   </span><span class="k">type</span><span class="w"> </span><span class="nc">headers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">list</span><span class="o">&lt;</span><span class="n">tuple</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="n">string</span><span class="o">&gt;&gt;</span><span class="p">;</span>
<span class="w">   </span><span class="k">type</span><span class="w"> </span><span class="nc">params</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">list</span><span class="o">&lt;</span><span class="n">tuple</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="n">string</span><span class="o">&gt;&gt;</span><span class="p">;</span>
<span class="w">   </span><span class="k">type</span><span class="w"> </span><span class="nc">uri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">string</span><span class="p">;</span>

<span class="w">    </span><span class="k">enum</span><span class="w"> </span><span class="nc">method</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">get</span><span class="p">,</span>
<span class="w">        </span><span class="n">post</span><span class="p">,</span>
<span class="w">        </span><span class="n">put</span><span class="p">,</span>
<span class="w">        </span><span class="n">delete</span><span class="p">,</span>
<span class="w">        </span><span class="n">patch</span><span class="p">,</span>
<span class="w">        </span><span class="n">head</span><span class="p">,</span>
<span class="w">        </span><span class="n">options</span><span class="p">,</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">record</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">method</span><span class="p">:</span><span class="w"> </span><span class="nc">method</span><span class="p">,</span>
<span class="w">        </span><span class="n">uri</span><span class="p">:</span><span class="w"> </span><span class="nc">uri</span><span class="p">,</span>
<span class="w">        </span><span class="n">headers</span><span class="p">:</span><span class="w"> </span><span class="nc">headers</span><span class="p">,</span>
<span class="w">        </span><span class="n">params</span><span class="p">:</span><span class="w"> </span><span class="nc">params</span><span class="p">,</span>
<span class="w">        </span><span class="n">body</span><span class="p">:</span><span class="w"> </span><span class="nc">option</span><span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">record</span><span class="w"> </span><span class="n">response</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">status</span><span class="p">:</span><span class="w"> </span><span class="nc">http</span><span class="o">-</span><span class="n">status</span><span class="p">,</span>
<span class="w">        </span><span class="n">headers</span><span class="p">:</span><span class="w"> </span><span class="nc">option</span><span class="o">&lt;</span><span class="n">headers</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">        </span><span class="n">body</span><span class="p">:</span><span class="w"> </span><span class="nc">option</span><span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">enum</span><span class="w"> </span><span class="nc">http</span><span class="o">-</span><span class="n">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">success</span><span class="p">,</span>
<span class="w">        </span><span class="n">destination</span><span class="o">-</span><span class="n">not</span><span class="o">-</span><span class="n">allowed</span><span class="p">,</span>
<span class="w">        </span><span class="n">invalid</span><span class="o">-</span><span class="n">url</span><span class="p">,</span>
<span class="w">        </span><span class="n">request</span><span class="o">-</span><span class="n">error</span><span class="p">,</span>
<span class="w">        </span><span class="n">runtime</span><span class="o">-</span><span class="n">error</span><span class="p">,</span>
<span class="w">        </span><span class="n">too</span><span class="o">-</span><span class="n">many</span><span class="o">-</span><span class="n">requests</span><span class="p">,</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p><code>inbound-http</code></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">interface</span><span class="w"> </span><span class="n">inbound</span><span class="o">-</span><span class="n">http</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">use</span><span class="w"> </span><span class="n">http</span><span class="o">-</span><span class="n">types</span><span class="p">.{</span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">response</span><span class="p">};</span>

<span class="w">    </span><span class="n">handle</span><span class="o">-</span><span class="n">request</span><span class="p">:</span><span class="w"> </span><span class="nc">func</span><span class="p">(</span><span class="n">req</span><span class="p">:</span><span class="w"> </span><span class="nc">request</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">response</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p><code>sum.wit</code></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">interface</span><span class="w"> </span><span class="n">operation</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">use</span><span class="w"> </span><span class="n">complex</span><span class="p">.{</span><span class="n">num</span><span class="p">};</span>
<span class="w">    </span><span class="n">add</span><span class="p">:</span><span class="w"> </span><span class="nc">func</span><span class="p">(</span><span class="n">a</span><span class="p">:</span><span class="nc">num</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">:</span><span class="nc">num</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">num</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>```[tasklist]</p>
<h3>Tasks</h3>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="o">~~~</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="449608933"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238908%20How%20to%20write%20test/near/449608933" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238908.20How.20to.20write.20test.html#449608933">(Jul 07 2024 at 05:51)</a>:</h4>
<p>Shyam-Raghuwanshi edited <a href="https://github.com/bytecodealliance/wasmtime/issues/8908">issue #8908</a>:</p>
<blockquote>
<p>I have a project similar to this how can I test it ? I am able to run the guest from host but unable to figure out how to test or How to write test</p>
<p><code> guest/src/lib.rs</code></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">use</span><span class="w"> </span><span class="n">wit</span><span class="p">::</span><span class="n">demo</span><span class="p">::</span><span class="n">utils</span><span class="p">::</span><span class="n">complex</span><span class="p">::</span><span class="n">Num</span><span class="p">;</span>

<span class="k">mod</span><span class="w"> </span><span class="nn">wit</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">use</span><span class="w"> </span><span class="n">wit_bindgen</span><span class="p">::</span><span class="n">generate</span><span class="p">;</span>
<span class="w">    </span><span class="n">generate</span><span class="o">!</span><span class="p">({</span>
<span class="w">        </span><span class="n">path</span><span class="p">:</span><span class="s">"../wit"</span><span class="p">,</span>
<span class="w">        </span><span class="n">world</span><span class="p">:</span><span class="s">"reactor"</span><span class="p">,</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="k">use</span><span class="w"> </span><span class="k">super</span><span class="p">::</span><span class="n">Guest</span><span class="p">;</span>
<span class="w">    </span><span class="n">export</span><span class="o">!</span><span class="p">(</span><span class="n">Guest</span><span class="p">);</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="bp">self</span><span class="p">::</span><span class="n">exports</span><span class="p">::</span><span class="n">demo</span><span class="p">::</span><span class="n">utils</span><span class="p">::</span><span class="n">inbound_http</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">Guest</span><span class="p">;</span>

<span class="k">impl</span><span class="w"> </span><span class="n">wit</span><span class="p">::</span><span class="n">exports</span><span class="p">::</span><span class="n">demo</span><span class="p">::</span><span class="n">utils</span><span class="p">::</span><span class="n">inbound_http</span><span class="p">::</span><span class="n">Guest</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Guest</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">handle_request</span><span class="p">(</span><span class="n">req</span><span class="p">:</span><span class="w"> </span><span class="nc">wit</span><span class="p">::</span><span class="n">Request</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">wit</span><span class="p">::</span><span class="n">Response</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="fm">println!</span><span class="p">(</span><span class="s">"Request {:?}"</span><span class="p">,</span><span class="w"> </span><span class="n">req</span><span class="p">);</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">sum</span><span class="w"> </span><span class="o">=</span>
<span class="w">            </span><span class="n">wit</span><span class="p">::</span><span class="n">demo</span><span class="p">::</span><span class="n">utils</span><span class="p">::</span><span class="n">operation</span><span class="p">::</span><span class="n">add</span><span class="p">(</span><span class="n">Num</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">real</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="n">imag</span><span class="p">:</span><span class="w"> </span><span class="mi">55</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">Num</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">real</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="n">imag</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="p">});</span>
<span class="w">        </span><span class="c1">// let sum = wit::demo::utils::operation::add(</span>
<span class="w">        </span><span class="c1">//     wit::demo::utils::complex::Num { real: 1, imag: 1 },</span>
<span class="w">        </span><span class="c1">//     wit::demo::utils::complex::Num { real: 2, imag: 2 },</span>
<span class="w">        </span><span class="c1">// );</span>
<span class="w">        </span><span class="fm">println!</span><span class="p">(</span><span class="s">"Sum is = {:?}"</span><span class="p">,</span><span class="w"> </span><span class="n">sum</span><span class="p">);</span>
<span class="w">        </span><span class="n">wit</span><span class="p">::</span><span class="n">Response</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">status</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span>
<span class="w">            </span><span class="n">headers</span><span class="p">:</span><span class="w"> </span><span class="nb">None</span><span class="p">,</span>
<span class="w">            </span><span class="n">body</span><span class="p">:</span><span class="w"> </span><span class="nb">None</span><span class="p">,</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p><code>host/src/main.rs</code></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">use</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">env</span><span class="p">;</span>

<span class="c1">// use wasmtime_wasi::WasiCtx;</span>
<span class="k">use</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">path</span><span class="p">::</span><span class="n">PathBuf</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="n">wasmtime</span><span class="p">::{</span><span class="n">component</span><span class="p">::</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">Module</span><span class="p">,</span><span class="w"> </span><span class="n">Table</span><span class="p">};</span>
<span class="k">use</span><span class="w"> </span><span class="n">wasmtime</span><span class="p">::{</span><span class="n">Config</span><span class="p">,</span><span class="w"> </span><span class="n">Engine</span><span class="p">,</span><span class="w"> </span><span class="n">Store</span><span class="p">};</span>
<span class="k">use</span><span class="w"> </span><span class="n">wasmtime_wasi</span><span class="p">::</span><span class="n">bindings</span><span class="p">::{</span><span class="bp">self</span><span class="p">};</span>
<span class="k">use</span><span class="w"> </span><span class="n">wasmtime_wasi</span><span class="p">::</span><span class="n">pipe</span><span class="p">::</span><span class="n">MemoryOutputPipe</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="n">wasmtime_wasi</span><span class="p">::{</span><span class="n">WasiCtx</span><span class="p">,</span><span class="w"> </span><span class="n">WasiCtxBuilder</span><span class="p">,</span><span class="w"> </span><span class="n">WasiView</span><span class="p">};</span>

<span class="k">mod</span><span class="w"> </span><span class="nn">wit</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">wasmtime</span><span class="p">::</span><span class="n">component</span><span class="p">::</span><span class="n">bindgen</span><span class="o">!</span><span class="p">({</span>
<span class="w">        </span><span class="n">path</span><span class="p">:</span><span class="s">"../wit"</span><span class="p">,</span>
<span class="w">        </span><span class="n">world</span><span class="p">:</span><span class="s">"reactor"</span><span class="p">,</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">}</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">Host</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">table</span><span class="p">:</span><span class="w"> </span><span class="nc">ResourceTable</span><span class="p">,</span>
<span class="w">    </span><span class="n">wasi</span><span class="p">:</span><span class="w"> </span><span class="nc">WasiCtx</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1">// impl wit::demo::utils::host::Host for Host {</span>
<span class="c1">//     fn greet(&amp;mut self) -&gt; wasmtime::Result&lt;u8&gt; {</span>
<span class="c1">//         Ok(10)</span>
<span class="c1">//     }</span>
<span class="c1">// }</span>

<span class="k">impl</span><span class="w"> </span><span class="n">WasiView</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Host</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">table</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">ResourceTable</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">table</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">ctx</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">wasmtime_wasi</span><span class="p">::</span><span class="n">WasiCtx</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">wasi</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">use</span><span class="w"> </span><span class="n">wit</span><span class="p">::</span><span class="n">demo</span><span class="p">::</span><span class="n">utils</span><span class="p">::</span><span class="n">complex</span><span class="p">::</span><span class="n">Num</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="n">wit</span><span class="p">::</span><span class="n">demo</span><span class="p">::</span><span class="n">utils</span><span class="p">::</span><span class="n">http_types</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="n">wit</span><span class="p">::</span><span class="n">demo</span><span class="p">::</span><span class="n">utils</span><span class="p">::</span><span class="n">operation</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="n">wit</span><span class="p">::</span><span class="n">exports</span><span class="p">::</span><span class="n">demo</span><span class="p">::</span><span class="n">utils</span><span class="p">::</span><span class="n">inbound_http</span><span class="p">;</span>

<span class="k">impl</span><span class="w"> </span><span class="n">wit</span><span class="p">::</span><span class="n">demo</span><span class="p">::</span><span class="n">utils</span><span class="p">::</span><span class="n">complex</span><span class="p">::</span><span class="n">Host</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Host</span><span class="w"> </span><span class="p">{}</span>
<span class="k">impl</span><span class="w"> </span><span class="n">wit</span><span class="p">::</span><span class="n">demo</span><span class="p">::</span><span class="n">utils</span><span class="p">::</span><span class="n">http_types</span><span class="p">::</span><span class="n">Host</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Host</span><span class="w"> </span><span class="p">{}</span>

<span class="k">impl</span><span class="w"> </span><span class="n">operation</span><span class="p">::</span><span class="n">Host</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Host</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">:</span><span class="w"> </span><span class="nc">Num</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">:</span><span class="w"> </span><span class="nc">Num</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">wasmtime</span><span class="p">::</span><span class="nb">Result</span><span class="o">&lt;</span><span class="n">Num</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nb">Ok</span><span class="p">(</span><span class="n">Num</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">real</span><span class="p">:</span><span class="w"> </span><span class="nc">a</span><span class="p">.</span><span class="n">real</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">real</span><span class="p">,</span>
<span class="w">            </span><span class="n">imag</span><span class="p">:</span><span class="w"> </span><span class="nc">a</span><span class="p">.</span><span class="n">imag</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">imag</span><span class="p">,</span>
<span class="w">        </span><span class="p">})</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// #[tokio::main]</span>
<span class="k">fn</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">wasmtime</span><span class="p">::</span><span class="nb">Result</span><span class="o">&lt;</span><span class="p">()</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// let engine = wasmtime::Engine::default();</span>
<span class="w">    </span><span class="c1">// let mut store = wasmtime::Store::new(&amp;engine, ());</span>
<span class="w">    </span><span class="c1">// let bytes = std::fs::read("../target/wasm32-wasi/debug/guest.wasm")?;</span>
<span class="w">    </span><span class="c1">// let mut linker: wasmtime::component::Linker&lt;WasiCtx&gt; = wasmtime::component::Linker::new(&amp;engine);</span>
<span class="w">    </span><span class="n">env</span><span class="p">::</span><span class="n">set_var</span><span class="p">(</span><span class="s">"WASMTIME_BACKTRACE_DETAILS"</span><span class="p">,</span><span class="w"> </span><span class="s">"1"</span><span class="p">);</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Config</span><span class="p">::</span><span class="n">new</span><span class="p">();</span>
<span class="w">    </span><span class="n">config</span><span class="p">.</span><span class="n">wasm_component_model</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">    </span><span class="n">config</span><span class="p">.</span><span class="n">async_support</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>

<span class="w">    </span><span class="c1">//In the context of wasmtime, Engine is a struct that represents the configuration and context for compiling WebAssembly modules. It is a central part of the Wasmtime API, responsible for managing the lifecycle of compiled WebAssembly code and providing the necessary environment for execution.</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">engine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Engine</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">config</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="o">=</span>
<span class="w">        </span><span class="n">Component</span><span class="p">::</span><span class="n">from_file</span><span class="p">(</span><span class="o">&amp;</span><span class="n">engine</span><span class="p">,</span><span class="w"> </span><span class="s">"guest.wasm"</span><span class="p">).</span><span class="n">expect</span><span class="p">(</span><span class="s">"guest.wasm not found"</span><span class="p">);</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">linker</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Linker</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">engine</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Create our wasi context.</span>
<span class="w">    </span><span class="c1">// let mut builder = WasiCtxBuilder::new();</span>

<span class="w">    </span><span class="c1">// let stdout = MemoryOutputPipe::new(4096);</span>
<span class="w">    </span><span class="c1">// let stderr = MemoryOutputPipe::new(4096);</span>
<span class="w">    </span><span class="c1">// builder.stdout(stdout.clone()).stderr(stderr.clone());</span>

<span class="w">    </span><span class="n">bindings</span><span class="p">::</span><span class="n">cli</span><span class="p">::</span><span class="n">environment</span><span class="p">::</span><span class="n">add_to_linker</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">linker</span><span class="p">,</span><span class="w"> </span><span class="o">|</span><span class="n">x</span><span class="o">|</span><span class="w"> </span><span class="n">x</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">"Unable to add environment"</span><span class="p">);</span>
<span class="w">    </span><span class="n">bindings</span><span class="p">::</span><span class="n">cli</span><span class="p">::</span><span class="n">exit</span><span class="p">::</span><span class="n">add_to_linker</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">linker</span><span class="p">,</span><span class="w"> </span><span class="o">|</span><span class="n">x</span><span class="o">|</span><span class="w"> </span><span class="n">x</span><span class="p">).</span><span class="n">expect</span><span class="p">(</span><span class="s">"Unable to add cli"</span><span class="p">);</span>
<span class="w">    </span><span class="n">bindings</span><span class="p">::</span><span class="n">io</span><span class="p">::</span><span class="n">error</span><span class="p">::</span><span class="n">add_to_linker</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">linker</span><span class="p">,</span><span class="w"> </span><span class="o">|</span><span class="n">x</span><span class="o">|</span><span class="w"> </span><span class="n">x</span><span class="p">).</span><span class="n">expect</span><span class="p">(</span><span class="s">"Unable to add io error"</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// bindings::sync::io::streams::add_to_linker(&amp;mut linker, |x| x)</span>
<span class="w">    </span><span class="c1">//     .expect("Unable to add io streams");</span>
<span class="w">    </span><span class="n">bindings</span><span class="p">::</span><span class="n">sync_io</span><span class="p">::</span><span class="n">io</span><span class="p">::</span><span class="n">streams</span><span class="p">::</span><span class="n">add_to_linker</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">linker</span><span class="p">,</span><span class="w"> </span><span class="o">|</span><span class="n">x</span><span class="o">|</span><span class="w"> </span><span class="n">x</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">"Unable to add io streams"</span><span class="p">);</span>
<span class="w">    </span><span class="n">bindings</span><span class="p">::</span><span class="n">cli</span><span class="p">::</span><span class="n">stdin</span><span class="p">::</span><span class="n">add_to_linker</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">linker</span><span class="p">,</span><span class="w"> </span><span class="o">|</span><span class="n">x</span><span class="o">|</span><span class="w"> </span><span class="n">x</span><span class="p">).</span><span class="n">expect</span><span class="p">(</span><span class="s">"Unable to add cli stdin"</span><span class="p">);</span>
<span class="w">    </span><span class="n">bindings</span><span class="p">::</span><span class="n">cli</span><span class="p">::</span><span class="n">stdout</span><span class="p">::</span><span class="n">add_to_linker</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">linker</span><span class="p">,</span><span class="w"> </span><span class="o">|</span><span class="n">x</span><span class="o">|</span><span class="w"> </span><span class="n">x</span><span class="p">).</span><span class="n">expect</span><span class="p">(</span><span class="s">"Unable to add cli stdout"</span><span class="p">);</span>
<span class="w">    </span><span class="n">bindings</span><span class="p">::</span><span class="n">cli</span><span class="p">::</span><span class="n">stderr</span><span class="p">::</span><span class="n">add_to_linker</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">linker</span><span class="p">,</span><span class="w"> </span><span class="o">|</span><span class="n">x</span><span class="o">|</span><span class="w"> </span><span class="n">x</span><span class="p">).</span><span class="n">expect</span><span class="p">(</span><span class="s">"Unable to add cli stderr"</span><span class="p">);</span>
<span class="w">    </span><span class="n">bindings</span><span class="p">::</span><span class="n">clocks</span><span class="p">::</span><span class="n">wall_clock</span><span class="p">::</span><span class="n">add_to_linker</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">linker</span><span class="p">,</span><span class="w"> </span><span class="o">|</span><span class="n">x</span><span class="o">|</span><span class="w"> </span><span class="n">x</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">"Unable to add clocks wallclock"</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// bindings::sync::filesystem::types::add_to_linker(&amp;mut linker, |x| x)</span>
<span class="w">    </span><span class="c1">//     .expect("Unable to add filesystem types");</span>
<span class="w">    </span><span class="n">bindings</span><span class="p">::</span><span class="n">sync_io</span><span class="p">::</span><span class="n">filesystem</span><span class="p">::</span><span class="n">types</span><span class="p">::</span><span class="n">add_to_linker</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">linker</span><span class="p">,</span><span class="w"> </span><span class="o">|</span><span class="n">x</span><span class="o">|</span><span class="w"> </span><span class="n">x</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">"Unable to add filesystem types"</span><span class="p">);</span>
<span class="w">    </span><span class="n">bindings</span><span class="p">::</span><span class="n">filesystem</span><span class="p">::</span><span class="n">preopens</span><span class="p">::</span><span class="n">add_to_linker</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">linker</span><span class="p">,</span><span class="w"> </span><span class="o">|</span><span class="n">x</span><span class="o">|</span><span class="w"> </span><span class="n">x</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">"Unable to add filesystem preopens"</span><span class="p">);</span>

<span class="w">    </span><span class="n">wit</span><span class="p">::</span><span class="n">Reactor</span><span class="p">::</span><span class="n">add_to_linker</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">linker</span><span class="p">,</span><span class="w"> </span><span class="o">|</span><span class="n">x</span><span class="o">|</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">table</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ResourceTable</span><span class="p">::</span><span class="n">new</span><span class="p">();</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">wasi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WasiCtxBuilder</span><span class="p">::</span><span class="n">new</span><span class="p">().</span><span class="n">inherit_stdio</span><span class="p">().</span><span class="n">build</span><span class="p">();</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">store</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Store</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">engine</span><span class="p">,</span><span class="w"> </span><span class="n">Host</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">table</span><span class="p">,</span><span class="w"> </span><span class="n">wasi</span><span class="w"> </span><span class="p">});</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">reactor</span><span class="p">,</span><span class="w"> </span><span class="n">instance</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wit</span><span class="p">::</span><span class="n">Reactor</span><span class="p">::</span><span class="n">instantiate</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">component</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">linker</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// let guest = reactor.demo_utils_guest();</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">guest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reactor</span><span class="p">.</span><span class="n">demo_utils_inbound_http</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// let result = guest.call_get_data(&amp;mut store)?;</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">inbound_http</span><span class="p">::</span><span class="n">Request</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">method</span><span class="p">:</span><span class="w"> </span><span class="nc">http_types</span><span class="p">::</span><span class="n">Method</span><span class="p">::</span><span class="n">Get</span><span class="p">,</span>
<span class="w">        </span><span class="n">uri</span><span class="p">:</span><span class="w"> </span><span class="s">"http://google.com"</span><span class="p">.</span><span class="n">to_string</span><span class="p">(),</span>
<span class="w">        </span><span class="n">headers</span><span class="p">:</span><span class="w"> </span><span class="nc">vec</span><span class="o">!</span><span class="p">[(</span><span class="nb">String</span><span class="p">::</span><span class="n">from</span><span class="p">(</span><span class="s">"method"</span><span class="p">),</span><span class="w"> </span><span class="nb">String</span><span class="p">::</span><span class="n">from</span><span class="p">(</span><span class="s">"get"</span><span class="p">))],</span>
<span class="w">        </span><span class="n">params</span><span class="p">:</span><span class="w"> </span><span class="nc">vec</span><span class="o">!</span><span class="p">[],</span>
<span class="w">        </span><span class="n">body</span><span class="p">:</span><span class="w"> </span><span class="nb">None</span><span class="p">,</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">guest</span><span class="p">.</span><span class="n">call_handle_request</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">request</span><span class="p">);</span>
<span class="w">    </span><span class="k">match</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nb">Ok</span><span class="p">(</span><span class="n">res</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="fm">println!</span><span class="p">(</span><span class="s">"Response : {:?}"</span><span class="p">,</span><span class="w"> </span><span class="n">res</span><span class="p">),</span>
<span class="w">        </span><span class="nb">Err</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="fm">println!</span><span class="p">(</span><span class="s">"Error occured : {:?}"</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="p">),</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">    </span><span class="c1">// let linker = wasmtime::Linker::new(&amp;engine);</span>
<span class="w">    </span><span class="c1">// let module_instance = linker</span>
<span class="w">    </span><span class="c1">//     .instantiate(&amp;mut store, &amp;module)</span>
<span class="w">    </span><span class="c1">//     .expect("Unable to get module instance");</span>
<span class="w">    </span><span class="c1">// let bye = module_instance.get_typed_func::&lt;(), u32&gt;(&amp;mut store, "bye")?;</span>

<span class="w">    </span><span class="c1">// let bye_result = bye.call(&amp;mut store, ()).expect("Function run failed");</span>
<span class="w">    </span><span class="c1">// println!("From bye {}",bye_result);</span>

<span class="w">    </span><span class="c1">// let callme = instance.get_typed_func::&lt;(), ()&gt;(&amp;mut store, "getData")?;</span>
<span class="w">    </span><span class="c1">// callme.call(&amp;mut store, ())?;</span>
<span class="w">    </span><span class="nb">Ok</span><span class="p">(())</span>
<span class="p">}</span>
</code></pre></div>
<h3>Wit files</h3>
<p><code>demo.wit</code></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">package</span><span class="w"> </span><span class="n">demo</span><span class="p">:</span><span class="nc">utils</span><span class="p">;</span>

<span class="n">world</span><span class="w"> </span><span class="n">reactor</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">import</span><span class="w"> </span><span class="n">operation</span><span class="p">;</span>
<span class="w">    </span><span class="n">export</span><span class="w"> </span><span class="n">inbound</span><span class="o">-</span><span class="n">http</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p><code>complex.wit</code></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">interface</span><span class="w"> </span><span class="n">complex</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">record</span><span class="w"> </span><span class="n">num</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">real</span><span class="p">:</span><span class="w"> </span><span class="kt">u16</span><span class="p">,</span>
<span class="w">        </span><span class="n">imag</span><span class="p">:</span><span class="w"> </span><span class="kt">u16</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p><code>http-types.wit</code></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">interface</span><span class="w"> </span><span class="n">http</span><span class="o">-</span><span class="n">types</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="k">type</span><span class="w"> </span><span class="nc">http</span><span class="o">-</span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">u16</span><span class="p">;</span>
<span class="w">   </span><span class="k">type</span><span class="w"> </span><span class="nc">body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">list</span><span class="o">&lt;</span><span class="kt">u8</span><span class="o">&gt;</span><span class="p">;</span>
<span class="w">   </span><span class="k">type</span><span class="w"> </span><span class="nc">headers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">list</span><span class="o">&lt;</span><span class="n">tuple</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="n">string</span><span class="o">&gt;&gt;</span><span class="p">;</span>
<span class="w">   </span><span class="k">type</span><span class="w"> </span><span class="nc">params</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">list</span><span class="o">&lt;</span><span class="n">tuple</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="n">string</span><span class="o">&gt;&gt;</span><span class="p">;</span>
<span class="w">   </span><span class="k">type</span><span class="w"> </span><span class="nc">uri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">string</span><span class="p">;</span>

<span class="w">    </span><span class="k">enum</span><span class="w"> </span><span class="nc">method</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">get</span><span class="p">,</span>
<span class="w">        </span><span class="n">post</span><span class="p">,</span>
<span class="w">        </span><span class="n">put</span><span class="p">,</span>
<span class="w">        </span><span class="n">delete</span><span class="p">,</span>
<span class="w">        </span><span class="n">patch</span><span class="p">,</span>
<span class="w">        </span><span class="n">head</span><span class="p">,</span>
<span class="w">        </span><span class="n">options</span><span class="p">,</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">record</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">method</span><span class="p">:</span><span class="w"> </span><span class="nc">method</span><span class="p">,</span>
<span class="w">        </span><span class="n">uri</span><span class="p">:</span><span class="w"> </span><span class="nc">uri</span><span class="p">,</span>
<span class="w">        </span><span class="n">headers</span><span class="p">:</span><span class="w"> </span><span class="nc">headers</span><span class="p">,</span>
<span class="w">        </span><span class="n">params</span><span class="p">:</span><span class="w"> </span><span class="nc">params</span><span class="p">,</span>
<span class="w">        </span><span class="n">body</span><span class="p">:</span><span class="w"> </span><span class="nc">option</span><span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">record</span><span class="w"> </span><span class="n">response</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">status</span><span class="p">:</span><span class="w"> </span><span class="nc">http</span><span class="o">-</span><span class="n">status</span><span class="p">,</span>
<span class="w">        </span><span class="n">headers</span><span class="p">:</span><span class="w"> </span><span class="nc">option</span><span class="o">&lt;</span><span class="n">headers</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">        </span><span class="n">body</span><span class="p">:</span><span class="w"> </span><span class="nc">option</span><span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">enum</span><span class="w"> </span><span class="nc">http</span><span class="o">-</span><span class="n">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">success</span><span class="p">,</span>
<span class="w">        </span><span class="n">destination</span><span class="o">-</span><span class="n">not</span><span class="o">-</span><span class="n">allowed</span><span class="p">,</span>
<span class="w">        </span><span class="n">invalid</span><span class="o">-</span><span class="n">url</span><span class="p">,</span>
<span class="w">        </span><span class="n">request</span><span class="o">-</span><span class="n">error</span><span class="p">,</span>
<span class="w">        </span><span class="n">runtime</span><span class="o">-</span><span class="n">error</span><span class="p">,</span>
<span class="w">        </span><span class="n">too</span><span class="o">-</span><span class="n">many</span><span class="o">-</span><span class="n">requests</span><span class="p">,</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p><code>inbound-http</code></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">interface</span><span class="w"> </span><span class="n">inbound</span><span class="o">-</span><span class="n">http</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">use</span><span class="w"> </span><span class="n">http</span><span class="o">-</span><span class="n">types</span><span class="p">.{</span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">response</span><span class="p">};</span>

<span class="w">    </span><span class="n">handle</span><span class="o">-</span><span class="n">request</span><span class="p">:</span><span class="w"> </span><span class="nc">func</span><span class="p">(</span><span class="n">req</span><span class="p">:</span><span class="w"> </span><span class="nc">request</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">response</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p><code>sum.wit</code></p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">interface</span><span class="w"> </span><span class="n">operation</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">use</span><span class="w"> </span><span class="n">complex</span><span class="p">.{</span><span class="n">num</span><span class="p">};</span>
<span class="w">    </span><span class="n">add</span><span class="p">:</span><span class="w"> </span><span class="nc">func</span><span class="p">(</span><span class="n">a</span><span class="p">:</span><span class="nc">num</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">:</span><span class="nc">num</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">num</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="449945696"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238908%20How%20to%20write%20test/near/449945696" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238908.20How.20to.20write.20test.html#449945696">(Jul 08 2024 at 18:13)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/8908#issuecomment-2214866103">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/8908">issue #8908</a>:</p>
<blockquote>
<p>"how to write test" is a pretty general and broad question, do you have something more specific you'd like to ask? For example one way to test would be to take <code>fn main()</code> and wrap it up in a helper function and then invoke that in individual tests. Whether or not that solves your use case though I'm not sure.</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>