<html>
<head><meta charset="utf-8"><title>wasmtime / PR #2202 wasi common: move fs and path into En... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232202.20wasi.20common.3A.20move.20fs.20and.20path.20into.20En.2E.2E.2E.html">wasmtime / PR #2202 wasi common: move fs and path into En...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="210078036"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232202%20wasi%20common%3A%20move%20fs%20and%20path%20into%20En.../near/210078036" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232202.20wasi.20common.3A.20move.20fs.20and.20path.20into.20En.2E.2E.2E.html#210078036">(Sep 15 2020 at 00:12)</a>:</h4>
<p>pchickey opened <a href="https://github.com/bytecodealliance/wasmtime/pull/2202">PR #2202</a> from <code>pch/wasi_common_move_entry_methods</code> to <code>main</code>:</p>
<blockquote>
<p>based on #2201 </p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
</blockquote>



<a name="210158937"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232202%20wasi%20common%3A%20move%20fs%20and%20path%20into%20En.../near/210158937" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232202.20wasi.20common.3A.20move.20fs.20and.20path.20into.20En.2E.2E.2E.html#210158937">(Sep 15 2020 at 17:11)</a>:</h4>
<p>pchickey updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2202">PR #2202</a> from <code>pch/wasi_common_move_entry_methods</code> to <code>main</code>:</p>
<blockquote>
<p>based on #2201 </p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
</blockquote>



<a name="210160480"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232202%20wasi%20common%3A%20move%20fs%20and%20path%20into%20En.../near/210160480" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232202.20wasi.20common.3A.20move.20fs.20and.20path.20into.20En.2E.2E.2E.html#210160480">(Sep 15 2020 at 17:22)</a>:</h4>
<p>pchickey updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2202">PR #2202</a> from <code>pch/wasi_common_move_entry_methods</code> to <code>main</code>:</p>
<blockquote>
<p>based on #2201 </p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
</blockquote>



<a name="210161956"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232202%20wasi%20common%3A%20move%20fs%20and%20path%20into%20En.../near/210161956" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232202.20wasi.20common.3A.20move.20fs.20and.20path.20into.20En.2E.2E.2E.html#210161956">(Sep 15 2020 at 17:34)</a>:</h4>
<p>pchickey updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2202">PR #2202</a> from <code>pch/wasi_common_move_entry_methods</code> to <code>main</code>:</p>
<blockquote>
<p>based on #2201 </p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
</blockquote>



<a name="210162303"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232202%20wasi%20common%3A%20move%20fs%20and%20path%20into%20En.../near/210162303" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232202.20wasi.20common.3A.20move.20fs.20and.20path.20into.20En.2E.2E.2E.html#210162303">(Sep 15 2020 at 17:37)</a>:</h4>
<p>pchickey edited <a href="https://github.com/bytecodealliance/wasmtime/pull/2202">PR #2202</a> from <code>pch/wasi_common_move_entry_methods</code> to <code>main</code>:</p>
<blockquote>
<p>based on #2201 </p>
<p>This PR refactors the bodies of all <code>fs</code> and <code>path</code> functions in snapshot 1 into <code>Entry</code> methods.</p>
<p>Anything that just requires an entry be in scope is moved to <code>entry/fd.rs</code><br>
and <code>entry/path.rs</code>, which just contain <code>impl Entry</code> blocks.</p>
<p>Additionally, the bodies of these functions were transformed so that as<br>
much GuestPtr dereference as possible happens out in<br>
wasi_snapshot_preview1.  Entry methods just get a <code>&amp; T</code> or <code>&amp;mut T</code><br>
passed in.</p>
<p>However, there are a few functions where multiple GuestPtrs are passed<br>
into a wasi_snapshot_preview1 function. We cannot safely dereference<br>
both at once, because it is semantically valid for these memory<br>
regions to overlap, but the wiggle borrow checker will refuse to<br>
borrow overlapping regions. In these cases, we have to pass the GuestPtr<br>
into the Entity method to be dereferenced in a smaller scope where<br>
exclusive access is possible.</p>
<p>Additionally, we make the minor transformation so that <code>crate::path::get</code> becomes<br>
<code>Entry::path_get</code>. This moves from src/path.rs to src/entry/path.rs. This is just code<br>
motion and doesn't make a difference.</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
</blockquote>



<a name="210163690"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232202%20wasi%20common%3A%20move%20fs%20and%20path%20into%20En.../near/210163690" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232202.20wasi.20common.3A.20move.20fs.20and.20path.20into.20En.2E.2E.2E.html#210163690">(Sep 15 2020 at 17:46)</a>:</h4>
<p>pchickey updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2202">PR #2202</a> from <code>pch/wasi_common_move_entry_methods</code> to <code>main</code>:</p>
<blockquote>
<p>based on #2201 </p>
<p>This PR refactors the bodies of all <code>fs</code> and <code>path</code> functions in snapshot 1 into <code>Entry</code> methods.</p>
<p>Anything that just requires an entry be in scope is moved to <code>entry/fd.rs</code><br>
and <code>entry/path.rs</code>, which just contain <code>impl Entry</code> blocks.</p>
<p>Additionally, the bodies of these functions were transformed so that as<br>
much GuestPtr dereference as possible happens out in<br>
wasi_snapshot_preview1.  Entry methods just get a <code>&amp; T</code> or <code>&amp;mut T</code><br>
passed in.</p>
<p>However, there are a few functions where multiple GuestPtrs are passed<br>
into a wasi_snapshot_preview1 function. We cannot safely dereference<br>
both at once, because it is semantically valid for these memory<br>
regions to overlap, but the wiggle borrow checker will refuse to<br>
borrow overlapping regions. In these cases, we have to pass the GuestPtr<br>
into the Entity method to be dereferenced in a smaller scope where<br>
exclusive access is possible.</p>
<p>Additionally, we make the minor transformation so that <code>crate::path::get</code> becomes<br>
<code>Entry::path_get</code>. This moves from src/path.rs to src/entry/path.rs. This is just code<br>
motion and doesn't make a difference.</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
</blockquote>



<a name="210325093"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232202%20wasi%20common%3A%20move%20fs%20and%20path%20into%20En.../near/210325093" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232202.20wasi.20common.3A.20move.20fs.20and.20path.20into.20En.2E.2E.2E.html#210325093">(Sep 16 2020 at 21:54)</a>:</h4>
<p>pchickey updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2202">PR #2202</a> from <code>pch/wasi_common_move_entry_methods</code> to <code>main</code>:</p>
<blockquote>
<p>based on #2201 </p>
<p>This PR refactors the bodies of all <code>fs</code> and <code>path</code> functions in snapshot 1 into <code>Entry</code> methods.</p>
<p>Anything that just requires an entry be in scope is moved to <code>entry/fd.rs</code><br>
and <code>entry/path.rs</code>, which just contain <code>impl Entry</code> blocks.</p>
<p>Additionally, the bodies of these functions were transformed so that as<br>
much GuestPtr dereference as possible happens out in<br>
wasi_snapshot_preview1.  Entry methods just get a <code>&amp; T</code> or <code>&amp;mut T</code><br>
passed in.</p>
<p>However, there are a few functions where multiple GuestPtrs are passed<br>
into a wasi_snapshot_preview1 function. We cannot safely dereference<br>
both at once, because it is semantically valid for these memory<br>
regions to overlap, but the wiggle borrow checker will refuse to<br>
borrow overlapping regions. In these cases, we have to pass the GuestPtr<br>
into the Entity method to be dereferenced in a smaller scope where<br>
exclusive access is possible.</p>
<p>Additionally, we make the minor transformation so that <code>crate::path::get</code> becomes<br>
<code>Entry::path_get</code>. This moves from src/path.rs to src/entry/path.rs. This is just code<br>
motion and doesn't make a difference.</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
</blockquote>



<a name="210928676"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232202%20wasi%20common%3A%20move%20fs%20and%20path%20into%20En.../near/210928676" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232202.20wasi.20common.3A.20move.20fs.20and.20path.20into.20En.2E.2E.2E.html#210928676">(Sep 22 2020 at 20:42)</a>:</h4>
<p><strong>pchickey</strong> requested <a href="https://github.com/iximeow">iximeow</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/2202">PR #2202</a>.</p>



<a name="211066098"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232202%20wasi%20common%3A%20move%20fs%20and%20path%20into%20En.../near/211066098" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232202.20wasi.20common.3A.20move.20fs.20and.20path.20into.20En.2E.2E.2E.html#211066098">(Sep 23 2020 at 21:44)</a>:</h4>
<p>sunfishcode submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2202#pullrequestreview-495070963">PR Review</a>.</p>



<a name="216260043"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232202%20wasi%20common%3A%20move%20fs%20and%20path%20into%20En.../near/216260043" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232202.20wasi.20common.3A.20move.20fs.20and.20path.20into.20En.2E.2E.2E.html#216260043">(Nov 10 2020 at 19:15)</a>:</h4>
<p>pchickey updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2202">PR #2202</a> from <code>pch/wasi_common_move_entry_methods</code> to <code>main</code>:</p>
<blockquote>
<p>based on #2201 </p>
<p>This PR refactors the bodies of all <code>fs</code> and <code>path</code> functions in snapshot 1 into <code>Entry</code> methods.</p>
<p>Anything that just requires an entry be in scope is moved to <code>entry/fd.rs</code><br>
and <code>entry/path.rs</code>, which just contain <code>impl Entry</code> blocks.</p>
<p>Additionally, the bodies of these functions were transformed so that as<br>
much GuestPtr dereference as possible happens out in<br>
wasi_snapshot_preview1.  Entry methods just get a <code>&amp; T</code> or <code>&amp;mut T</code><br>
passed in.</p>
<p>However, there are a few functions where multiple GuestPtrs are passed<br>
into a wasi_snapshot_preview1 function. We cannot safely dereference<br>
both at once, because it is semantically valid for these memory<br>
regions to overlap, but the wiggle borrow checker will refuse to<br>
borrow overlapping regions. In these cases, we have to pass the GuestPtr<br>
into the Entity method to be dereferenced in a smaller scope where<br>
exclusive access is possible.</p>
<p>Additionally, we make the minor transformation so that <code>crate::path::get</code> becomes<br>
<code>Entry::path_get</code>. This moves from src/path.rs to src/entry/path.rs. This is just code<br>
motion and doesn't make a difference.</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
</blockquote>



<a name="218621667"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232202%20wasi%20common%3A%20move%20fs%20and%20path%20into%20En.../near/218621667" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232202.20wasi.20common.3A.20move.20fs.20and.20path.20into.20En.2E.2E.2E.html#218621667">(Dec 02 2020 at 21:23)</a>:</h4>
<p>pchickey closed without merge <a href="https://github.com/bytecodealliance/wasmtime/pull/2202">PR #2202</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>