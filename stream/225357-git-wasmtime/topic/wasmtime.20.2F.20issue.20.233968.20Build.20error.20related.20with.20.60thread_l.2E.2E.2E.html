<html>
<head><meta charset="utf-8"><title>wasmtime / issue #3968 Build error related with `thread_l... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233968.20Build.20error.20related.20with.20.60thread_l.2E.2E.2E.html">wasmtime / issue #3968 Build error related with `thread_l...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="277094242"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233968%20Build%20error%20related%20with%20%60thread_l.../near/277094242" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233968.20Build.20error.20related.20with.20.60thread_l.2E.2E.2E.html#277094242">(Mar 30 2022 at 04:47)</a>:</h4>
<p>kimdora opened <a href="https://github.com/bytecodealliance/wasmtime/issues/3968">issue #3968</a>:</p>
<blockquote>
<p>Hello, when I tried to build <code>wasmtime</code> from source code, I got a following error.</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">error</span><span class="p">[</span><span class="n">E0658</span><span class="p">]</span>: <span class="nc">use</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">unstable</span><span class="w"> </span><span class="n">library</span><span class="w"> </span><span class="n">feature</span><span class="w"> </span><span class="o">'</span><span class="na">thread_local_const_init</span><span class="o">'</span><span class="w"></span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">crates</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">traphandlers</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">390</span>:<span class="mi">9</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="mi">390</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="fm">thread_local!</span><span class="p">(</span><span class="k">static</span><span class="w"> </span><span class="n">PTR</span>: <span class="nc">Cell</span><span class="o">&lt;</span><span class="p">(</span><span class="n">Ptr</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="p">)</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Cell</span>::<span class="n">new</span><span class="p">((</span><span class="n">ptr</span>::<span class="n">null</span><span class="p">(),</span><span class="w"> </span><span class="kc">false</span><span class="p">))</span><span class="w"> </span><span class="p">});</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">         </span><span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">see</span><span class="w"> </span><span class="n">issue</span><span class="w"> </span>#<span class="mi">84223</span><span class="w"> </span><span class="o">&lt;</span><span class="n">https</span>:<span class="c1">//github.com/rust-lang/rust/issues/84223&gt; for more information</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">this</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="n">originates</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="kr">macro</span><span class="w"> </span><span class="err">`</span><span class="cp">$crate</span>::<span class="n">__thread_local_inner</span><span class="err">`</span><span class="w"> </span><span class="p">(</span><span class="k">in</span><span class="w"> </span><span class="n">Nightly</span><span class="w"> </span><span class="n">builds</span><span class="p">,</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="o">-</span><span class="n">Z</span><span class="w"> </span><span class="kr">macro</span><span class="o">-</span><span class="n">backtrace</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">info</span><span class="p">)</span><span class="w"></span>

<span class="n">For</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">information</span><span class="w"> </span><span class="n">about</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">error</span><span class="p">,</span><span class="w"> </span><span class="kr">try</span><span class="w"> </span><span class="err">`</span><span class="n">rustc</span><span class="w"> </span><span class="o">--</span><span class="n">explain</span><span class="w"> </span><span class="n">E0658</span><span class="err">`</span><span class="p">.</span><span class="w"></span>
</code></pre></div>
<p>How can I fix it?</p>
</blockquote>



<a name="277094968"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233968%20Build%20error%20related%20with%20%60thread_l.../near/277094968" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233968.20Build.20error.20related.20with.20.60thread_l.2E.2E.2E.html#277094968">(Mar 30 2022 at 05:02)</a>:</h4>
<p>kimdora <a href="https://github.com/bytecodealliance/wasmtime/issues/3968#issuecomment-1082623912">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3968">issue #3968</a>:</p>
<blockquote>
<p>So I built <code>wasmtime</code> from current master branch <a href="https://github.com/bytecodealliance/wasmtime/tree/5d8dd648d71db22838e376b18ecd03b015a08485"><code>5d8dd64</code></a> so that I got the error.<br>
But when I change the version to <a href="https://github.com/bytecodealliance/wasmtime/tree/release-0.35.1"><code>release-0.35.1</code></a> which is the latest version now, I successfully build <code>wasmtime</code>. </p>
</blockquote>



<a name="277094969"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233968%20Build%20error%20related%20with%20%60thread_l.../near/277094969" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233968.20Build.20error.20related.20with.20.60thread_l.2E.2E.2E.html#277094969">(Mar 30 2022 at 05:02)</a>:</h4>
<p>kimdora closed <a href="https://github.com/bytecodealliance/wasmtime/issues/3968">issue #3968</a>:</p>
<blockquote>
<p>Hello, when I tried to build <code>wasmtime</code> from source code, I got a following error.</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">error</span><span class="p">[</span><span class="n">E0658</span><span class="p">]</span>: <span class="nc">use</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">unstable</span><span class="w"> </span><span class="n">library</span><span class="w"> </span><span class="n">feature</span><span class="w"> </span><span class="o">'</span><span class="na">thread_local_const_init</span><span class="o">'</span><span class="w"></span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">crates</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">traphandlers</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">390</span>:<span class="mi">9</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="mi">390</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="fm">thread_local!</span><span class="p">(</span><span class="k">static</span><span class="w"> </span><span class="n">PTR</span>: <span class="nc">Cell</span><span class="o">&lt;</span><span class="p">(</span><span class="n">Ptr</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="p">)</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Cell</span>::<span class="n">new</span><span class="p">((</span><span class="n">ptr</span>::<span class="n">null</span><span class="p">(),</span><span class="w"> </span><span class="kc">false</span><span class="p">))</span><span class="w"> </span><span class="p">});</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">         </span><span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">see</span><span class="w"> </span><span class="n">issue</span><span class="w"> </span>#<span class="mi">84223</span><span class="w"> </span><span class="o">&lt;</span><span class="n">https</span>:<span class="c1">//github.com/rust-lang/rust/issues/84223&gt; for more information</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">this</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="n">originates</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="kr">macro</span><span class="w"> </span><span class="err">`</span><span class="cp">$crate</span>::<span class="n">__thread_local_inner</span><span class="err">`</span><span class="w"> </span><span class="p">(</span><span class="k">in</span><span class="w"> </span><span class="n">Nightly</span><span class="w"> </span><span class="n">builds</span><span class="p">,</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="o">-</span><span class="n">Z</span><span class="w"> </span><span class="kr">macro</span><span class="o">-</span><span class="n">backtrace</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">info</span><span class="p">)</span><span class="w"></span>

<span class="n">For</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">information</span><span class="w"> </span><span class="n">about</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">error</span><span class="p">,</span><span class="w"> </span><span class="kr">try</span><span class="w"> </span><span class="err">`</span><span class="n">rustc</span><span class="w"> </span><span class="o">--</span><span class="n">explain</span><span class="w"> </span><span class="n">E0658</span><span class="err">`</span><span class="p">.</span><span class="w"></span>
</code></pre></div>
<p>How can I fix it?</p>
</blockquote>



<a name="277097749"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233968%20Build%20error%20related%20with%20%60thread_l.../near/277097749" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233968.20Build.20error.20related.20with.20.60thread_l.2E.2E.2E.html#277097749">(Mar 30 2022 at 06:01)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/issues/3968#issuecomment-1082654281">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3968">issue #3968</a>:</p>
<blockquote>
<p>@kimdora It's likely that your Rust compiler is a bit out-of-date. We test Wasmtime with the latest stable Rust; you should be able to build our <code>main</code> branch if you update (if you installed via <code>rustup</code>) with:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">rustup</span><span class="w"> </span><span class="n">update</span><span class="w"></span>
</code></pre></div>
<p>If that doesn't work, let us know what <code>rustc --version</code> says and we can try to help further!</p>
</blockquote>



<a name="277100233"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233968%20Build%20error%20related%20with%20%60thread_l.../near/277100233" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233968.20Build.20error.20related.20with.20.60thread_l.2E.2E.2E.html#277100233">(Mar 30 2022 at 06:47)</a>:</h4>
<p>kimdora <a href="https://github.com/bytecodealliance/wasmtime/issues/3968#issuecomment-1082691399">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3968">issue #3968</a>:</p>
<blockquote>
<p>@cfallin , thank you for your comment! After I updated <code>rustup</code> that you said, I can build successfully on master branch!<br>
Thank you!</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>