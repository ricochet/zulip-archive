<html>
<head><meta charset="utf-8"><title>wasmtime / issue #9382 not all headers are installed for ... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239382.20not.20all.20headers.20are.20installed.20for.20.2E.2E.2E.html">wasmtime / issue #9382 not all headers are installed for ...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="475089306"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239382%20not%20all%20headers%20are%20installed%20for%20.../near/475089306" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239382.20not.20all.20headers.20are.20installed.20for.20.2E.2E.2E.html#475089306">(Oct 06 2024 at 11:12)</a>:</h4>
<p>ognevny opened <a href="https://github.com/bytecodealliance/wasmtime/issues/9382">issue #9382</a>:</p>
<blockquote>
<p>when built with MSYS2 toolchain, <code>wasmtime/conf.h</code> isn't installed, and (for example) tree-sitter compilation fails with</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">In</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">included</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">C</span><span class="p">:</span><span class="o">/</span><span class="n">msys64</span><span class="o">/</span><span class="n">clang64</span><span class="o">/</span><span class="n">include</span><span class="o">/</span><span class="n">wasmtime</span><span class="p">.</span><span class="n">h</span><span class="p">:</span><span class="mi">182</span><span class="p">:</span>
<span class="nc">C</span><span class="p">:</span><span class="o">/</span><span class="n">msys64</span><span class="o">/</span><span class="n">clang64</span><span class="o">/</span><span class="n">include</span><span class="o">/</span><span class="n">wasi</span><span class="p">.</span><span class="n">h</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="mi">10</span><span class="p">:</span><span class="w"> </span><span class="nc">fatal</span><span class="w"> </span><span class="n">error</span><span class="p">:</span><span class="w"> </span><span class="o">'</span><span class="na">wasmtime</span><span class="o">/</span><span class="n">conf</span><span class="p">.</span><span class="n">h</span><span class="o">'</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">found</span>
<span class="w">   </span><span class="mi">12</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">#</span><span class="n">include</span><span class="w"> </span><span class="o">&lt;</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">conf</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;</span>
<span class="w">      </span><span class="o">|</span><span class="w">          </span><span class="o">^~~~~~~~~~~~~~~~~</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="475140213"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239382%20not%20all%20headers%20are%20installed%20for%20.../near/475140213" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239382.20not.20all.20headers.20are.20installed.20for.20.2E.2E.2E.html#475140213">(Oct 06 2024 at 20:30)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/9382#issuecomment-2395575188">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9382">issue #9382</a>:</p>
<blockquote>
<p>Thanks for the report! The installation of the C API changed a few versions ago in Wasmtime to use <code>cmake</code> to install, and cmake should install the <code>conf.h</code> header file. If it's missing here then that means whatever is managing the C API probably isn't pulling in the latest version one way or another. There's been a few other PRs/issues for tree-sitter using a Rust dependency on the C API and getting that working too. </p>
<p>If you're interested in primarily packaging tree-sitter this might be a better issue to raise with them? They might be more familiar with the build system and packaging of tree sitter.</p>
</blockquote>



<a name="478313481"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239382%20not%20all%20headers%20are%20installed%20for%20.../near/478313481" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239382.20not.20all.20headers.20are.20installed.20for.20.2E.2E.2E.html#478313481">(Oct 22 2024 at 15:29)</a>:</h4>
<p>ognevny <a href="https://github.com/bytecodealliance/wasmtime/issues/9382#issuecomment-2429600607">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9382">issue #9382</a>:</p>
<blockquote>
<p>I forgot to answer, but cmake doesn't install <code>conf.h</code> this just can't be issue from tree-sitter's side</p>
</blockquote>



<a name="478354362"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239382%20not%20all%20headers%20are%20installed%20for%20.../near/478354362" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239382.20not.20all.20headers.20are.20installed.20for.20.2E.2E.2E.html#478354362">(Oct 22 2024 at 19:34)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/9382#issuecomment-2430092427">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9382">issue #9382</a>:</p>
<blockquote>
<p>Would you be able to provide some steps for reproduction? </p>
</blockquote>



<a name="478405937"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239382%20not%20all%20headers%20are%20installed%20for%20.../near/478405937" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239382.20not.20all.20headers.20are.20installed.20for.20.2E.2E.2E.html#478405937">(Oct 23 2024 at 03:44)</a>:</h4>
<p>ognevny <a href="https://github.com/bytecodealliance/wasmtime/issues/9382#issuecomment-2430799981">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9382">issue #9382</a>:</p>
<blockquote>
<p>download msys2<br>
run <code>makepkg-mingw -s</code> for <a href="https://github.com/msys2/MINGW-packages/blob/master/mingw-w64-wasmtime%2FPKGBUILD">recipe</a></p>
</blockquote>



<a name="478406712"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239382%20not%20all%20headers%20are%20installed%20for%20.../near/478406712" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239382.20not.20all.20headers.20are.20installed.20for.20.2E.2E.2E.html#478406712">(Oct 23 2024 at 03:53)</a>:</h4>
<p>ognevny <a href="https://github.com/bytecodealliance/wasmtime/issues/9382#issuecomment-2430810618">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9382">issue #9382</a>:</p>
<blockquote>
<p>but without the line, that install conf.h _manually_</p>
</blockquote>



<a name="478406815"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239382%20not%20all%20headers%20are%20installed%20for%20.../near/478406815" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239382.20not.20all.20headers.20are.20installed.20for.20.2E.2E.2E.html#478406815">(Oct 23 2024 at 03:54)</a>:</h4>
<p>ognevny edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/9382#issuecomment-2430810618">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9382">issue #9382</a>:</p>
<blockquote>
<p>but without the line, that install conf.h _manually_ (<a href="https://github.com/msys2/MINGW-packages/blob/cb29d91491e2e202d66e0ffc5a1ff2ed068e8622/mingw-w64-wasmtime/PKGBUILD#L118">https://github.com/msys2/MINGW-packages/blob/cb29d91491e2e202d66e0ffc5a1ff2ed068e8622/mingw-w64-wasmtime/PKGBUILD#L118</a>)</p>
</blockquote>



<a name="478406848"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239382%20not%20all%20headers%20are%20installed%20for%20.../near/478406848" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239382.20not.20all.20headers.20are.20installed.20for.20.2E.2E.2E.html#478406848">(Oct 23 2024 at 03:55)</a>:</h4>
<p>ognevny edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/9382#issuecomment-2430799981">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9382">issue #9382</a>:</p>
<blockquote>
<p>download msys2<br>
run <code>makepkg-mingw -s</code> for <a href="https://github.com/msys2/MINGW-packages/blob/cb29d91491e2e202d66e0ffc5a1ff2ed068e8622/mingw-w64-wasmtime%2FPKGBUILD">recipe</a></p>
</blockquote>



<a name="478536304"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239382%20not%20all%20headers%20are%20installed%20for%20.../near/478536304" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239382.20not.20all.20headers.20are.20installed.20for.20.2E.2E.2E.html#478536304">(Oct 23 2024 at 16:25)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/9382#issuecomment-2432791313">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9382">issue #9382</a>:</p>
<blockquote>
<p>I ran these commands:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">cmake</span><span class="w"> </span><span class="o">-</span><span class="n">G</span><span class="w"> </span><span class="n">Ninja</span><span class="w"> </span><span class="o">-</span><span class="n">DCMAKE_INSTALL_PREFIX</span><span class="o">=</span><span class="err">`</span><span class="n">pwd</span><span class="err">`</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">c</span><span class="o">-</span><span class="n">api</span><span class="o">-</span><span class="n">install</span><span class="w"> </span><span class="o">-</span><span class="n">DBUILD_SHARED_LIBS</span><span class="o">=</span><span class="n">OFF</span><span class="w"> </span><span class="o">-</span><span class="n">S</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">c</span><span class="o">-</span><span class="n">api</span><span class="w"> </span><span class="o">-</span><span class="n">B</span><span class="w"> </span><span class="n">target</span><span class="o">/</span><span class="n">build</span><span class="o">-</span><span class="k">static</span>
<span class="cp">$</span><span class="w"> </span><span class="n">cmake</span><span class="w"> </span><span class="o">--</span><span class="n">build</span><span class="w"> </span><span class="n">target</span><span class="o">/</span><span class="n">build</span><span class="o">-</span><span class="k">static</span>
<span class="cp">$</span><span class="w"> </span><span class="n">DESTDIR</span><span class="o">=</span><span class="p">.</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">c</span><span class="o">-</span><span class="n">api</span><span class="o">-</span><span class="n">install2</span><span class="w"> </span><span class="n">cmake</span><span class="w"> </span><span class="o">--</span><span class="n">install</span><span class="w"> </span><span class="n">target</span><span class="o">/</span><span class="n">build</span><span class="o">-</span><span class="k">static</span>
</code></pre></div>
<p>to model what that script is doing</p>
<p>The <code>--install</code> step shows:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="o">..</span><span class="p">.</span>
<span class="o">--</span><span class="w"> </span><span class="n">Installing</span><span class="p">:</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">alex</span><span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">c</span><span class="o">-</span><span class="n">api</span><span class="o">-</span><span class="n">install</span><span class="o">/</span><span class="n">include</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">conf</span><span class="p">.</span><span class="n">h</span>
<span class="o">--</span><span class="w"> </span><span class="n">Up</span><span class="o">-</span><span class="n">to</span><span class="o">-</span><span class="n">date</span><span class="p">:</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">c</span><span class="o">-</span><span class="n">api</span><span class="o">-</span><span class="n">install2</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">alex</span><span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">c</span><span class="o">-</span><span class="n">api</span><span class="o">-</span><span class="n">install</span><span class="o">/</span><span class="n">include</span>
<span class="o">--</span><span class="w"> </span><span class="n">Installing</span><span class="p">:</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">c</span><span class="o">-</span><span class="n">api</span><span class="o">-</span><span class="n">install2</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">alex</span><span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">c</span><span class="o">-</span><span class="n">api</span><span class="o">-</span><span class="n">install</span><span class="o">/</span><span class="n">include</span><span class="o">/</span><span class="n">wasi</span><span class="p">.</span><span class="n">h</span>
<span class="o">..</span><span class="p">.</span>
</code></pre></div>
<p>which shows that the <code>conf.h</code> is being installed, just to the wrong spot.</p>
<p>I think this has to do with the combination of <code>DESTDIR</code> and <code>-DCMAKE_INSTALL_PREFIX</code> and those being different. I fear though that I'm not knowledgable enough with CMake to know how best to solve this.</p>
</blockquote>



<a name="478537581"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239382%20not%20all%20headers%20are%20installed%20for%20.../near/478537581" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239382.20not.20all.20headers.20are.20installed.20for.20.2E.2E.2E.html#478537581">(Oct 23 2024 at 16:31)</a>:</h4>
<p>ognevny <a href="https://github.com/bytecodealliance/wasmtime/issues/9382#issuecomment-2432804631">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9382">issue #9382</a>:</p>
<blockquote>
<p>I wonder can you switch to meson?</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>