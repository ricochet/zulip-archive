<html>
<head><meta charset="utf-8"><title>wasmtime / Issue #1490 Implement interrupting wasm code, ... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231490.20Implement.20interrupting.20wasm.20code.2C.20.2E.2E.2E.html">wasmtime / Issue #1490 Implement interrupting wasm code, ...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="193498830"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231490%20Implement%20interrupting%20wasm%20code%2C%20.../near/193498830" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231490.20Implement.20interrupting.20wasm.20code.2C.20.2E.2E.2E.html#193498830">(Apr 09 2020 at 19:32)</a>:</h4>
<p>github-actions[bot] <a href="https://github.com/bytecodealliance/wasmtime/pull/1490#issuecomment-611713740" title="https://github.com/bytecodealliance/wasmtime/pull/1490#issuecomment-611713740">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1490" title="https://github.com/bytecodealliance/wasmtime/pull/1490">Issue #1490</a>:</p>
<blockquote>
<h4>Subscribe to Label Action</h4>
<p>This issue or pull request has been labeled: "cranelift", "fuzzing", "wasmtime:api", "wasmtime:c-api"</p>
<p>&lt;details&gt; &lt;summary&gt;Users Subscribed to "cranelift"&lt;/summary&gt;</p>
<ul>
<li>@bnjbvr</li>
</ul>
<p>&lt;/details&gt;<br>
&lt;details&gt; &lt;summary&gt;Users Subscribed to "fuzzing"&lt;/summary&gt;</p>
<ul>
<li>@fitzgen</li>
</ul>
<p>&lt;/details&gt;<br>
&lt;details&gt; &lt;summary&gt;Users Subscribed to "wasmtime:api"&lt;/summary&gt;</p>
<ul>
<li>@peterhuene</li>
</ul>
<p>&lt;/details&gt;<br>
&lt;details&gt; &lt;summary&gt;Users Subscribed to "wasmtime:c-api"&lt;/summary&gt;</p>
<ul>
<li>@peterhuene</li>
</ul>
<p>&lt;/details&gt;</p>
<p>To subscribe or unsubscribe from this label, edit the &lt;code&gt;.github/subscribe-to-label.json&lt;/code&gt; configuration file.</p>
<p><a href="https://github.com/bytecodealliance/subscribe-to-label-action" title="https://github.com/bytecodealliance/subscribe-to-label-action">Learn more.</a></p>
</blockquote>



<a name="193500290"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231490%20Implement%20interrupting%20wasm%20code%2C%20.../near/193500290" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231490.20Implement.20interrupting.20wasm.20code.2C.20.2E.2E.2E.html#193500290">(Apr 09 2020 at 19:46)</a>:</h4>
<p>fitzgen <a href="https://github.com/bytecodealliance/wasmtime/pull/1490#issuecomment-611719230" title="https://github.com/bytecodealliance/wasmtime/pull/1490#issuecomment-611719230">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1490" title="https://github.com/bytecodealliance/wasmtime/pull/1490">Issue #1490</a>:</p>
<blockquote>
<p>Haven't looked at the code yet, but I have a question:</p>
<blockquote>
<p>The <code>wasmtime::Store</code> type has a<br>
method to acquire an <code>InterruptHandle</code>,</p>
</blockquote>
<p>Does this mean that the finest granularity of interrupt is a store?</p>
<p>That seems fine for now, in the single-threaded wasm world, but will likely need reworking to be finer grained when we support threads. Do you have an idea how much more work it would be to make this per-instance?</p>
</blockquote>



<a name="193500405"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231490%20Implement%20interrupting%20wasm%20code%2C%20.../near/193500405" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231490.20Implement.20interrupting.20wasm.20code.2C.20.2E.2E.2E.html#193500405">(Apr 09 2020 at 19:47)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/1490#issuecomment-611719698" title="https://github.com/bytecodealliance/wasmtime/pull/1490#issuecomment-611719698">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1490" title="https://github.com/bytecodealliance/wasmtime/pull/1490">Issue #1490</a>:</p>
<blockquote>
<p>@fitzgen yeah adapting this shouldn't be too hard at all, it's just a shared <code>Arc</code> data structure and it would be easy to arrange all instances linked together to have access to that <code>Arc</code></p>
</blockquote>



<a name="193502405"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231490%20Implement%20interrupting%20wasm%20code%2C%20.../near/193502405" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231490.20Implement.20interrupting.20wasm.20code.2C.20.2E.2E.2E.html#193502405">(Apr 09 2020 at 20:05)</a>:</h4>
<p>github-actions[bot] <a href="https://github.com/bytecodealliance/wasmtime/pull/1490#issuecomment-611727280" title="https://github.com/bytecodealliance/wasmtime/pull/1490#issuecomment-611727280">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1490" title="https://github.com/bytecodealliance/wasmtime/pull/1490">Issue #1490</a>:</p>
<blockquote>
<h4>Subscribe to Label Action</h4>
<p>This issue or pull request has been labeled: "wasi"</p>
<p>&lt;details&gt; &lt;summary&gt;Users Subscribed to "wasi"&lt;/summary&gt;</p>
<ul>
<li>@kubkon</li>
</ul>
<p>&lt;/details&gt;</p>
<p>To subscribe or unsubscribe from this label, edit the &lt;code&gt;.github/subscribe-to-label.json&lt;/code&gt; configuration file.</p>
<p><a href="https://github.com/bytecodealliance/subscribe-to-label-action" title="https://github.com/bytecodealliance/subscribe-to-label-action">Learn more.</a></p>
</blockquote>



<a name="194506059"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231490%20Implement%20interrupting%20wasm%20code%2C%20.../near/194506059" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231490.20Implement.20interrupting.20wasm.20code.2C.20.2E.2E.2E.html#194506059">(Apr 17 2020 at 22:05)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/1490#issuecomment-615484586" title="https://github.com/bytecodealliance/wasmtime/pull/1490#issuecomment-615484586">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1490" title="https://github.com/bytecodealliance/wasmtime/pull/1490">Issue #1490</a>:</p>
<blockquote>
<p>Ok I've pushed up a commit which uses a <code>GlobalValue</code> for the stack limit instead of a closure, and there's a "mini interpreter" of this <code>GlobalValue</code> since <code>ins().global_value(...)</code> can't be used this late after legalization. It's hopefully sufficient enough for now but also with better future-compatibility.</p>
<p>I'm not really sure how to serialize this out or parse it in the text format. If that's required can folks point me in the right direction of how to do that?</p>
</blockquote>



<a name="194506315"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231490%20Implement%20interrupting%20wasm%20code%2C%20.../near/194506315" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231490.20Implement.20interrupting.20wasm.20code.2C.20.2E.2E.2E.html#194506315">(Apr 17 2020 at 22:08)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/pull/1490#issuecomment-615485617" title="https://github.com/bytecodealliance/wasmtime/pull/1490#issuecomment-615485617">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1490" title="https://github.com/bytecodealliance/wasmtime/pull/1490">Issue #1490</a>:</p>
<blockquote>
<p>You should serialize it in <code>write_function</code> and then parse it in <code>cranelift-reader</code>.</p>
</blockquote>



<a name="194688486"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231490%20Implement%20interrupting%20wasm%20code%2C%20.../near/194688486" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231490.20Implement.20interrupting.20wasm.20code.2C.20.2E.2E.2E.html#194688486">(Apr 20 2020 at 15:11)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/1490#issuecomment-616616848" title="https://github.com/bytecodealliance/wasmtime/pull/1490#issuecomment-616616848">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1490" title="https://github.com/bytecodealliance/wasmtime/pull/1490">Issue #1490</a>:</p>
<blockquote>
<p>Ok @sunfishcode, should be updated!</p>
</blockquote>



<a name="194694791"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231490%20Implement%20interrupting%20wasm%20code%2C%20.../near/194694791" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231490.20Implement.20interrupting.20wasm.20code.2C.20.2E.2E.2E.html#194694791">(Apr 20 2020 at 15:50)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/1490#issuecomment-616641597" title="https://github.com/bytecodealliance/wasmtime/pull/1490#issuecomment-616641597">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1490" title="https://github.com/bytecodealliance/wasmtime/pull/1490">Issue #1490</a>:</p>
<blockquote>
<p>Ok after some discussion with @sunfishcode I brought back the <code>SA_ONSTACK</code> flag so we can be sure to still execute the fallback to libstd's segfault handler on the sigaltstack. We already have the code to make the sigaltstack bigger, so that should cover our own purposes for now as well. This means that all signals still go through the sigaltstack.</p>
</blockquote>



<a name="194731788"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231490%20Implement%20interrupting%20wasm%20code%2C%20.../near/194731788" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231490.20Implement.20interrupting.20wasm.20code.2C.20.2E.2E.2E.html#194731788">(Apr 20 2020 at 20:53)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/1490#issuecomment-616803186" title="https://github.com/bytecodealliance/wasmtime/pull/1490#issuecomment-616803186">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1490" title="https://github.com/bytecodealliance/wasmtime/pull/1490">Issue #1490</a>:</p>
<blockquote>
<p>Ok the last commit should be the stack limit parsing via the syntax you suggested</p>
</blockquote>



<a name="194758708"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231490%20Implement%20interrupting%20wasm%20code%2C%20.../near/194758708" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231490.20Implement.20interrupting.20wasm.20code.2C.20.2E.2E.2E.html#194758708">(Apr 21 2020 at 03:54)</a>:</h4>
<p>sunfishcode <a href="https://github.com/bytecodealliance/wasmtime/pull/1490#issuecomment-616936154" title="https://github.com/bytecodealliance/wasmtime/pull/1490#issuecomment-616936154">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1490" title="https://github.com/bytecodealliance/wasmtime/pull/1490">Issue #1490</a>:</p>
<blockquote>
<p>Looks good! There's now just the two CI failures. One is an easy fix I just commented on above.</p>
<p>There other is a failure in <a href="http://host_segfault.rs" title="http://host_segfault.rs">host_segfault.rs</a> on macos-latest CI:</p>
<div class="codehilite"><pre><span></span>     Running target/release/deps/host_segfault-de61d05b549d9afb

thread &#39;main&#39; panicked at &#39;assertion failed: stderr.contains(&quot;thread &#39;main&#39; has overflowed its stack&quot;)&#39;, tests/host_segfault.rs:95:9
stack backtrace:
   0: &lt;std::sys_common::backtrace::_print::DisplayBacktrace as core::fmt::Display&gt;::fmt
   1: core::fmt::write
   2: std::io::Write::write_fmt
   3: std::panicking::default_hook::{{closure}}
   4: std::panicking::default_hook
   5: std::panicking::rust_panic_with_hook
   6: std::panicking::begin_panic
   7: host_segfault::main
   8: std::rt::lang_start::{{closure}}
   9: std::panicking::try::do_call
  10: __rust_maybe_catch_panic
  11: std::rt::lang_start_internal
  12: main
</pre></div>


</blockquote>



<a name="194837484"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231490%20Implement%20interrupting%20wasm%20code%2C%20.../near/194837484" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231490.20Implement.20interrupting.20wasm.20code.2C.20.2E.2E.2E.html#194837484">(Apr 21 2020 at 17:43)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/1490#issuecomment-617312290" title="https://github.com/bytecodealliance/wasmtime/pull/1490#issuecomment-617312290">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1490" title="https://github.com/bytecodealliance/wasmtime/pull/1490">Issue #1490</a>:</p>
<blockquote>
<p>Ok all green now!</p>
</blockquote>



<a name="194840074"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231490%20Implement%20interrupting%20wasm%20code%2C%20.../near/194840074" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231490.20Implement.20interrupting.20wasm.20code.2C.20.2E.2E.2E.html#194840074">(Apr 21 2020 at 18:03)</a>:</h4>
<p>sunfishcode <a href="https://github.com/bytecodealliance/wasmtime/pull/1490#issuecomment-617323177" title="https://github.com/bytecodealliance/wasmtime/pull/1490#issuecomment-617323177">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1490" title="https://github.com/bytecodealliance/wasmtime/pull/1490">Issue #1490</a>:</p>
<blockquote>
<p>Great!</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>