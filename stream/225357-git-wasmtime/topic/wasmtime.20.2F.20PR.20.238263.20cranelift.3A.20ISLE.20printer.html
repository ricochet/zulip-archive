<html>
<head><meta charset="utf-8"><title>wasmtime / PR #8263 cranelift: ISLE printer · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238263.20cranelift.3A.20ISLE.20printer.html">wasmtime / PR #8263 cranelift: ISLE printer</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="430189870"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238263%20cranelift%3A%20ISLE%20printer/near/430189870" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238263.20cranelift.3A.20ISLE.20printer.html#430189870">(Mar 29 2024 at 02:01)</a>:</h4>
<p><strong>mmcloughlin</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-compiler-reviewers">wasmtime-compiler-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/8263">PR #8263</a>.</p>



<a name="430189872"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238263%20cranelift%3A%20ISLE%20printer/near/430189872" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238263.20cranelift.3A.20ISLE.20printer.html#430189872">(Mar 29 2024 at 02:01)</a>:</h4>
<p><strong>mmcloughlin</strong> requested <a href="https://github.com/fitzgen">fitzgen</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/8263">PR #8263</a>.</p>



<a name="430189875"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238263%20cranelift%3A%20ISLE%20printer/near/430189875" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238263.20cranelift.3A.20ISLE.20printer.html#430189875">(Mar 29 2024 at 02:01)</a>:</h4>
<p><strong>mmcloughlin</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-default-reviewers">wasmtime-default-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/8263">PR #8263</a>.</p>



<a name="430189876"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238263%20cranelift%3A%20ISLE%20printer/near/430189876" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238263.20cranelift.3A.20ISLE.20printer.html#430189876">(Mar 29 2024 at 02:01)</a>:</h4>
<p>mmcloughlin opened <a href="https://github.com/bytecodealliance/wasmtime/pull/8263">PR #8263</a> from <code>mmcloughlin:cranelift-isle-printer</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>This PR adds a printer to the ISLE library. This is intended to support tooling which generates ISLE source code. In such cases, this printer library allows applications to work with ISLE's AST types rather than raw string manipulation, and produce more readable output due to the pretty-printing features.</p>
<p>Printing is implemented using the <a href="https://crates.io/crates/pretty"><code>pretty</code></a> crate, which in turn is an implementation of Wadler's classic Haskell pretty printer for Rust. In order to avoid required dependencies the printer module is guarded by a new <code>printer</code> feature.</p>
<p>The printer is tested with a new integration test that verifies the print-parse roundtrip property for provided ISLE files.</p>
<p>In the future, it's possible that an ISLE printer could be used to provide an <code>islefmt</code> tool, but comment representation in the AST would be required before that could be considered.</p>
</blockquote>



<a name="430191222"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238263%20cranelift%3A%20ISLE%20printer/near/430191222" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238263.20cranelift.3A.20ISLE.20printer.html#430191222">(Mar 29 2024 at 02:20)</a>:</h4>
<p>mmcloughlin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8263#pullrequestreview-1967695878">PR review</a>.</p>



<a name="430191223"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238263%20cranelift%3A%20ISLE%20printer/near/430191223" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238263.20cranelift.3A.20ISLE.20printer.html#430191223">(Mar 29 2024 at 02:20)</a>:</h4>
<p>mmcloughlin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8263#pullrequestreview-1967695878">PR review</a>.</p>



<a name="430191224"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238263%20cranelift%3A%20ISLE%20printer/near/430191224" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238263.20cranelift.3A.20ISLE.20printer.html#430191224">(Mar 29 2024 at 02:20)</a>:</h4>
<p>mmcloughlin created <a href="https://github.com/bytecodealliance/wasmtime/pull/8263#discussion_r1543957716">PR review comment</a>:</p>
<blockquote>
<p>Under this implementation, I believe the printer tests would not be run by default in CI.</p>
<p>It would be nice if cargo supported some kind of "default test features" configuration, but as far as I can tell this isn't possible. Nor is there much appetite for adding it according to <a href="https://github.com/rust-lang/cargo/issues/2911">https://github.com/rust-lang/cargo/issues/2911</a>.</p>
<p>Perhaps if we cared enough we could edit the Github actions workflows to invoke these tests with the right <code>--feature</code> argument. But having poked around the CI config a little, it's not clear how to do that without causing a mess.</p>
<p>Another option is to have the printer tests in a different crate that can depend on this one with the right feature set.</p>
<p>All that said, I'm not sure it's worth it just for these tests, but I wanted to mention it in case you had a simple suggestion for how to run them?</p>
</blockquote>



<a name="430191225"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238263%20cranelift%3A%20ISLE%20printer/near/430191225" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238263.20cranelift.3A.20ISLE.20printer.html#430191225">(Mar 29 2024 at 02:20)</a>:</h4>
<p>mmcloughlin created <a href="https://github.com/bytecodealliance/wasmtime/pull/8263#discussion_r1543958858">PR review comment</a>:</p>
<blockquote>
<p>I considered the alternative of adding this to the existing <code>run_tests.rs</code> instead. This would have required sprinkling <code>#[cfg(feature = "printer")]</code> everywhere, so I settled on the alternative of a separate test binary with <code>required-features = ["printer"]</code>.</p>
<p>Either works though. Please let me know if you have a preference.</p>
</blockquote>



<a name="430191226"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238263%20cranelift%3A%20ISLE%20printer/near/430191226" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238263.20cranelift.3A.20ISLE.20printer.html#430191226">(Mar 29 2024 at 02:20)</a>:</h4>
<p>mmcloughlin created <a href="https://github.com/bytecodealliance/wasmtime/pull/8263#discussion_r1543966705">PR review comment</a>:</p>
<blockquote>
<p>I really don't like this, but I also couldn't think of a better way. Please let me know if you have an alternative suggestion.</p>
<ul>
<li>Having <code>parse_without_pos</code> as a public function is a bit distasteful. Previously I had <code>parse_without_pos</code> in the test binary instead, but that requires you to export <code>Parser</code> itself, and that seems worse.</li>
<li>We can't guard <code>parse_without_pos</code> with <code>#[cfg(test)]</code> because then it's not visible to an integration test binary.</li>
<li>Potentially the printer tests could be structured as unit tests instead of modeled off the <code>run_tests.rs</code> binary, which would allow use of conditional compilation for test only.</li>
<li>We could have an <code>eq_without_pos</code> on AST types instead. However, I assumed that would require a lot of hand- or macro-generated boilerplate.</li>
</ul>
<p>If <code>parse_without_pos</code> really is the best option, I also wondered if it would be nicer to instead augment the <code>parse</code> method with a <code>Positions</code> enum argument to configure whether positions are populated or dropped.</p>
</blockquote>



<a name="430191783"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238263%20cranelift%3A%20ISLE%20printer/near/430191783" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238263.20cranelift.3A.20ISLE.20printer.html#430191783">(Mar 29 2024 at 02:28)</a>:</h4>
<p><strong>cfallin</strong> requested <a href="https://github.com/cfallin">cfallin</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/8263">PR #8263</a>.</p>



<a name="430191809"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238263%20cranelift%3A%20ISLE%20printer/near/430191809" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238263.20cranelift.3A.20ISLE.20printer.html#430191809">(Mar 29 2024 at 02:29)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/8263#issuecomment-2026497967">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/8263">PR #8263</a>:</p>
<blockquote>
<p>Adding myself as a reviewer; happy to take a look at this at the beginning of next week (thanks!). For context for folks, this comes out of the ISLE-based Cranelift verification project.</p>
</blockquote>



<a name="430193017"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238263%20cranelift%3A%20ISLE%20printer/near/430193017" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238263.20cranelift.3A.20ISLE.20printer.html#430193017">(Mar 29 2024 at 02:44)</a>:</h4>
<p>github-actions[bot] <a href="https://github.com/bytecodealliance/wasmtime/pull/8263#issuecomment-2026515369">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/8263">PR #8263</a>:</p>
<blockquote>
<h4>Subscribe to Label Action</h4>
<p>cc @cfallin, @fitzgen</p>
<p>&lt;details&gt;<br>
This issue or pull request has been labeled: "cranelift", "isle"</p>
<p>Thus the following users have been cc'd because of the following labels:</p>
<ul>
<li>cfallin: isle</li>
<li>fitzgen: isle</li>
</ul>
<p>To subscribe or unsubscribe from this label, edit the &lt;code&gt;.github/subscribe-to-label.json&lt;/code&gt; configuration file.</p>
<p><a href="https://github.com/bytecodealliance/subscribe-to-label-action">Learn more.</a><br>
&lt;/details&gt;</p>
</blockquote>



<a name="430661814"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238263%20cranelift%3A%20ISLE%20printer/near/430661814" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238263.20cranelift.3A.20ISLE.20printer.html#430661814">(Apr 01 2024 at 20:51)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8263#pullrequestreview-1972090505">PR review</a>:</p>
<blockquote>
<p>Thanks -- a few more thoughts below.</p>
<p>After reading through <code>printer.rs</code> itself, I'm not super-convinced of the need for a library crate to help here -- certainly it's nice to use prebuilt helpers, but printing S-expressions is still not too complex to do by hand (even with indenting); if you don't mind, I think it'd be better to avoid the dependency.</p>
<p>(There are also additional steps we have to go through if we want to add a new dep -- vetting, etc -- and especially after recent events I'm personally going to have a higher bar for that too.)</p>
</blockquote>



<a name="430661815"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238263%20cranelift%3A%20ISLE%20printer/near/430661815" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238263.20cranelift.3A.20ISLE.20printer.html#430661815">(Apr 01 2024 at 20:51)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8263#pullrequestreview-1972090505">PR review</a>:</p>
<blockquote>
<p>Thanks -- a few more thoughts below.</p>
<p>After reading through <code>printer.rs</code> itself, I'm not super-convinced of the need for a library crate to help here -- certainly it's nice to use prebuilt helpers, but printing S-expressions is still not too complex to do by hand (even with indenting); if you don't mind, I think it'd be better to avoid the dependency.</p>
<p>(There are also additional steps we have to go through if we want to add a new dep -- vetting, etc -- and especially after recent events I'm personally going to have a higher bar for that too.)</p>
</blockquote>



<a name="430661816"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238263%20cranelift%3A%20ISLE%20printer/near/430661816" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238263.20cranelift.3A.20ISLE.20printer.html#430661816">(Apr 01 2024 at 20:51)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/8263#discussion_r1546828734">PR review comment</a>:</p>
<blockquote>
<p>If possible, I'd rather not have an explicit "... to stdout" in the API -- that's something that the caller can easily wire up, and there's otherwise no particular reason to hardcode one special <code>Writer</code> in an API like this. (In general, bad form to reach for "ambient capabilities" rather than those that are passed in, in core libraries, IMHO.)</p>
</blockquote>



<a name="430661818"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238263%20cranelift%3A%20ISLE%20printer/near/430661818" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238263.20cranelift.3A.20ISLE.20printer.html#430661818">(Apr 01 2024 at 20:51)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/8263#discussion_r1546827820">PR review comment</a>:</p>
<blockquote>
<p>A final option: a helper that maps through all AST nodes and sets positions to e.g. zero? That seems easiest to keep up to date and least likely to be subtly incorrect (vs. hand-written equality predicates), especially given compile errors on new AST node kinds.</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>