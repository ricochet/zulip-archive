<html>
<head><meta charset="utf-8"><title>wasmtime / PR #5512 riscv64: Implement fcmp in ISLE · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235512.20riscv64.3A.20Implement.20fcmp.20in.20ISLE.html">wasmtime / PR #5512 riscv64: Implement fcmp in ISLE</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="319333450"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235512%20riscv64%3A%20Implement%20fcmp%20in%20ISLE/near/319333450" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235512.20riscv64.3A.20Implement.20fcmp.20in.20ISLE.html#319333450">(Jan 04 2023 at 07:03)</a>:</h4>
<p>elliottt edited <a href="https://github.com/bytecodealliance/wasmtime/pull/5512">PR #5512</a> from <code>trevor/riscv64-br-fcmp</code> to <code>main</code>:</p>
<blockquote>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;<br>
</p>
</blockquote>



<a name="319333888"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235512%20riscv64%3A%20Implement%20fcmp%20in%20ISLE/near/319333888" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235512.20riscv64.3A.20Implement.20fcmp.20in.20ISLE.html#319333888">(Jan 04 2023 at 07:08)</a>:</h4>
<p>elliottt edited <a href="https://github.com/bytecodealliance/wasmtime/pull/5512">PR #5512</a> from <code>trevor/riscv64-br-fcmp</code> to <code>main</code>:</p>
<blockquote>
<p>Rework the compilation of fcmp in the riscv64 backend to be in ISLE, removing the need for the dedicated <code>Fcmp</code> instruction. This change is motivated by #5500, which showed that the riscv64 backend was generating branch instructions in the middle of a basic block.</p>
<p>Fixes #5500 </p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;<br>
</p>
</blockquote>



<a name="319340896"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235512%20riscv64%3A%20Implement%20fcmp%20in%20ISLE/near/319340896" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235512.20riscv64.3A.20Implement.20fcmp.20in.20ISLE.html#319340896">(Jan 04 2023 at 08:20)</a>:</h4>
<p>elliottt updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5512">PR #5512</a> from <code>trevor/riscv64-br-fcmp</code> to <code>main</code>.</p>



<a name="319341023"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235512%20riscv64%3A%20Implement%20fcmp%20in%20ISLE/near/319341023" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235512.20riscv64.3A.20Implement.20fcmp.20in.20ISLE.html#319341023">(Jan 04 2023 at 08:21)</a>:</h4>
<p>elliottt edited <a href="https://github.com/bytecodealliance/wasmtime/pull/5512">PR #5512</a> from <code>trevor/riscv64-br-fcmp</code> to <code>main</code>:</p>
<blockquote>
<p>Rework the compilation of fcmp in the riscv64 backend to be in ISLE, removing the need for the dedicated <code>Fcmp</code> instruction. This change is motivated by #5500, which showed that the riscv64 backend was generating branch instructions in the middle of a basic block.</p>
<p>We can't quite remove <code>lower_br_fcmp</code> yet as it's used in a few places in the <code>emit</code> module, but it's now no longer reachable from the ISLE lowerings.</p>
<p>Fixes #5500 </p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;<br>
</p>
</blockquote>



<a name="319341059"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235512%20riscv64%3A%20Implement%20fcmp%20in%20ISLE/near/319341059" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235512.20riscv64.3A.20Implement.20fcmp.20in.20ISLE.html#319341059">(Jan 04 2023 at 08:21)</a>:</h4>
<p>elliottt edited <a href="https://github.com/bytecodealliance/wasmtime/pull/5512">PR #5512</a> from <code>trevor/riscv64-br-fcmp</code> to <code>main</code>:</p>
<blockquote>
<p>Rework the compilation of fcmp in the riscv64 backend to be in ISLE, removing the need for the dedicated <code>Fcmp</code> instruction. This change is motivated by #5500, which showed that the riscv64 backend was generating branch instructions in the middle of a basic block.</p>
<p>We can't remove <code>lower_br_fcmp</code> quite yet as it's used in a few places in the <code>emit</code> module, but it's now no longer reachable from the ISLE lowerings.</p>
<p>Fixes #5500 </p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;<br>
</p>
</blockquote>



<a name="319432055"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235512%20riscv64%3A%20Implement%20fcmp%20in%20ISLE/near/319432055" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235512.20riscv64.3A.20Implement.20fcmp.20in.20ISLE.html#319432055">(Jan 04 2023 at 17:06)</a>:</h4>
<p>elliottt updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5512">PR #5512</a> from <code>trevor/riscv64-br-fcmp</code> to <code>main</code>.</p>



<a name="319441270"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235512%20riscv64%3A%20Implement%20fcmp%20in%20ISLE/near/319441270" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235512.20riscv64.3A.20Implement.20fcmp.20in.20ISLE.html#319441270">(Jan 04 2023 at 17:58)</a>:</h4>
<p><strong>elliottt</strong> has marked <a href="https://github.com/bytecodealliance/wasmtime/pull/5512">PR #5512</a> as ready for review.</p>



<a name="319441553"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235512%20riscv64%3A%20Implement%20fcmp%20in%20ISLE/near/319441553" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235512.20riscv64.3A.20Implement.20fcmp.20in.20ISLE.html#319441553">(Jan 04 2023 at 18:00)</a>:</h4>
<p><strong>elliottt</strong> requested <a href="https://github.com/jameysharp">jameysharp</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/5512">PR #5512</a>.</p>



<a name="319447584"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235512%20riscv64%3A%20Implement%20fcmp%20in%20ISLE/near/319447584" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235512.20riscv64.3A.20Implement.20fcmp.20in.20ISLE.html#319447584">(Jan 04 2023 at 18:33)</a>:</h4>
<p>jameysharp submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5512#pullrequestreview-1236295540">PR review</a>.</p>



<a name="319447585"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235512%20riscv64%3A%20Implement%20fcmp%20in%20ISLE/near/319447585" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235512.20riscv64.3A.20Implement.20fcmp.20in.20ISLE.html#319447585">(Jan 04 2023 at 18:33)</a>:</h4>
<p>jameysharp submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5512#pullrequestreview-1236295540">PR review</a>.</p>



<a name="319447586"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235512%20riscv64%3A%20Implement%20fcmp%20in%20ISLE/near/319447586" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235512.20riscv64.3A.20Implement.20fcmp.20in.20ISLE.html#319447586">(Jan 04 2023 at 18:33)</a>:</h4>
<p>jameysharp created <a href="https://github.com/bytecodealliance/wasmtime/pull/5512#discussion_r1061761060">PR review comment</a>:</p>
<blockquote>
<p><div class="codehilite" data-code-language="suggestion"><pre><span></span><code>;; Construct an IntegerCompare value.
</code></pre></div><br>
</p>
</blockquote>



<a name="319447587"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235512%20riscv64%3A%20Implement%20fcmp%20in%20ISLE/near/319447587" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235512.20riscv64.3A.20Implement.20fcmp.20in.20ISLE.html#319447587">(Jan 04 2023 at 18:33)</a>:</h4>
<p>jameysharp created <a href="https://github.com/bytecodealliance/wasmtime/pull/5512#discussion_r1061762743">PR review comment</a>:</p>
<blockquote>
<p>This comment should say <code>a == b</code> rather than <code>a &lt; b</code>, I think.</p>
</blockquote>



<a name="319447589"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235512%20riscv64%3A%20Implement%20fcmp%20in%20ISLE/near/319447589" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235512.20riscv64.3A.20Implement.20fcmp.20in.20ISLE.html#319447589">(Jan 04 2023 at 18:33)</a>:</h4>
<p>jameysharp created <a href="https://github.com/bytecodealliance/wasmtime/pull/5512#discussion_r1061772265">PR review comment</a>:</p>
<blockquote>
<p>Was this change supposed to be in this PR? It looks like it's a part of #5515 that leaked into here.</p>
</blockquote>



<a name="319449711"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235512%20riscv64%3A%20Implement%20fcmp%20in%20ISLE/near/319449711" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235512.20riscv64.3A.20Implement.20fcmp.20in.20ISLE.html#319449711">(Jan 04 2023 at 18:45)</a>:</h4>
<p>elliottt submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5512#pullrequestreview-1236331164">PR review</a>.</p>



<a name="319449713"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235512%20riscv64%3A%20Implement%20fcmp%20in%20ISLE/near/319449713" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235512.20riscv64.3A.20Implement.20fcmp.20in.20ISLE.html#319449713">(Jan 04 2023 at 18:45)</a>:</h4>
<p>elliottt created <a href="https://github.com/bytecodealliance/wasmtime/pull/5512#discussion_r1061784992">PR review comment</a>:</p>
<blockquote>
<p>Thanks for catching that! Originally I was trying to remove <code>lower_br_fcmp</code> in this PR, but started feeling like it was becoming a bit unwieldy.</p>
</blockquote>



<a name="319450325"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235512%20riscv64%3A%20Implement%20fcmp%20in%20ISLE/near/319450325" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235512.20riscv64.3A.20Implement.20fcmp.20in.20ISLE.html#319450325">(Jan 04 2023 at 18:48)</a>:</h4>
<p>elliottt updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5512">PR #5512</a> from <code>trevor/riscv64-br-fcmp</code> to <code>main</code>.</p>



<a name="319452247"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235512%20riscv64%3A%20Implement%20fcmp%20in%20ISLE/near/319452247" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235512.20riscv64.3A.20Implement.20fcmp.20in.20ISLE.html#319452247">(Jan 04 2023 at 18:58)</a>:</h4>
<p>elliottt updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5512">PR #5512</a> from <code>trevor/riscv64-br-fcmp</code> to <code>main</code>.</p>



<a name="319461391"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235512%20riscv64%3A%20Implement%20fcmp%20in%20ISLE/near/319461391" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235512.20riscv64.3A.20Implement.20fcmp.20in.20ISLE.html#319461391">(Jan 04 2023 at 19:52)</a>:</h4>
<p>elliottt merged <a href="https://github.com/bytecodealliance/wasmtime/pull/5512">PR #5512</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>