<html>
<head><meta charset="utf-8"><title>wasmtime / issue #3759 memfd: Some minor follow-ups · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233759.20memfd.3A.20Some.20minor.20follow-ups.html">wasmtime / issue #3759 memfd: Some minor follow-ups</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="270462485"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233759%20memfd%3A%20Some%20minor%20follow-ups/near/270462485" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233759.20memfd.3A.20Some.20minor.20follow-ups.html#270462485">(Feb 02 2022 at 21:41)</a>:</h4>
<p>github-actions[bot] <a href="https://github.com/bytecodealliance/wasmtime/pull/3759#issuecomment-1028384530">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/3759">issue #3759</a>:</p>
<blockquote>
<h4>Subscribe to Label Action</h4>
<p>cc @peterhuene</p>
<p>&lt;details&gt;<br>
This issue or pull request has been labeled: "wasmtime:api"</p>
<p>Thus the following users have been cc'd because of the following labels:</p>
<ul>
<li>peterhuene: wasmtime:api</li>
</ul>
<p>To subscribe or unsubscribe from this label, edit the &lt;code&gt;.github/subscribe-to-label.json&lt;/code&gt; configuration file.</p>
<p><a href="https://github.com/bytecodealliance/subscribe-to-label-action">Learn more.</a><br>
&lt;/details&gt;</p>
</blockquote>



<a name="270463165"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233759%20memfd%3A%20Some%20minor%20follow-ups/near/270463165" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233759.20memfd.3A.20Some.20minor.20follow-ups.html#270463165">(Feb 02 2022 at 21:46)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/3759#issuecomment-1028388534">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/3759">issue #3759</a>:</p>
<blockquote>
<p>Re: pooling allocator on-by-default, I wonder if we should evaluate the default limits at the same time? IIRC, for example, a build of SpiderMonkey/WASI doesn't fit within the defaults; when testing with the pooling allocator I've had to bump the limits. One advantage of the on-demand allocator is that since it does a heap allocation just once, for just the right amount of <code>VMContext</code> space, it doesn't need to be as careful; while the pooling allocator can easily mmap significant amounts of memory for instances if it makes too-conservative assumptions.</p>
<p>(Perhaps a way around that is for the pooling allocator defaults to allow for very large instances -- as high as, say, what a typical browser would have for implementation-defined limits -- but only one instance slot?)</p>
</blockquote>



<a name="270465928"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233759%20memfd%3A%20Some%20minor%20follow-ups/near/270465928" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233759.20memfd.3A.20Some.20minor.20follow-ups.html#270465928">(Feb 02 2022 at 22:06)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/3759#issuecomment-1028402683">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/3759">issue #3759</a>:</p>
<blockquote>
<p>That makes sense to me, but to clarify the pooling allocator is already enabled by default, this shouldn't change that. I do think it's reasonable to up the limits though (or measure the impact of malloc-ing the <code>VMContext</code> instead of mmap-ing it to avoid the need for most limits)</p>
</blockquote>



<a name="270474306"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233759%20memfd%3A%20Some%20minor%20follow-ups/near/270474306" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233759.20memfd.3A.20Some.20minor.20follow-ups.html#270474306">(Feb 02 2022 at 23:15)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/3759#issuecomment-1028446939">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/3759">issue #3759</a>:</p>
<blockquote>
<blockquote>
<p>That makes sense to me, but to clarify the pooling allocator is already enabled by default, this shouldn't change that</p>
</blockquote>
<p>Even for <code>wasmtime-cli</code> though? I was referring to your third commit, which I think changes this -- that's the part I'd worry about potentially surprising someone who's using wasmtime to run big modules from the commandline...</p>
</blockquote>



<a name="270564829"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233759%20memfd%3A%20Some%20minor%20follow-ups/near/270564829" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233759.20memfd.3A.20Some.20minor.20follow-ups.html#270564829">(Feb 03 2022 at 15:17)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/3759#issuecomment-1029094636">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/3759">issue #3759</a>:</p>
<blockquote>
<p>Oh I see it's in a somewhat inconsistent state right now I think. The pooling allocator is enabled on the <code>wasmtime</code> crate unconditionally but the top-level feature is disabled by default. In any case I think that it's best to defer the limits question to later, AFAIK this is mostly just used for our own internal testing right now since there's not really much purpose for using the pooling allocator on the CLI anyway. It should be pretty easy to tweak the limits in the future if necessary.</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>