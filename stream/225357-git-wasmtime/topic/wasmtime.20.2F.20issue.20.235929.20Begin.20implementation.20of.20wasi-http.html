<html>
<head><meta charset="utf-8"><title>wasmtime / issue #5929 Begin implementation of wasi-http · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235929.20Begin.20implementation.20of.20wasi-http.html">wasmtime / issue #5929 Begin implementation of wasi-http</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="341365778"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235929%20Begin%20implementation%20of%20wasi-http/near/341365778" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235929.20Begin.20implementation.20of.20wasi-http.html#341365778">(Mar 13 2023 at 04:00)</a>:</h4>
<p>brendandburns <a href="https://github.com/bytecodealliance/wasmtime/pull/5929#issuecomment-1465474050">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5929">issue #5929</a>:</p>
<blockquote>
<p>@pchickey I think this is ready for an initial high-level review.</p>
<p>Everything is implemented in terms of the <code>wit-bindgen</code> interfaces, and then an adapter is introduced which maps from the wit-bindgen to the current <code>wasmtime::Linker</code> implementation.</p>
<p>This means that it is very forward compatible with the component model linker going forward.</p>
<p>If you can take a quick look at the rough layout and see if this is on the path to merging that would be great.</p>
<p>After we get the rough layout right, we can move on to a more detailed review.</p>
<p>Thanks!</p>
</blockquote>



<a name="341365811"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235929%20Begin%20implementation%20of%20wasi-http/near/341365811" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235929.20Begin.20implementation.20of.20wasi-http.html#341365811">(Mar 13 2023 at 04:01)</a>:</h4>
<p>brendandburns <a href="https://github.com/bytecodealliance/wasmtime/pull/5929#issuecomment-1465474482">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5929">issue #5929</a>:</p>
<blockquote>
<p>There's also a pretty extensive example that can be used to test this implementation in <code>crates/wasi-http/example</code></p>
</blockquote>



<a name="341620162"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235929%20Begin%20implementation%20of%20wasi-http/near/341620162" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235929.20Begin.20implementation.20of.20wasi-http.html#341620162">(Mar 14 2023 at 04:44)</a>:</h4>
<p>brendandburns <a href="https://github.com/bytecodealliance/wasmtime/pull/5929#issuecomment-1467350680">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5929">issue #5929</a>:</p>
<blockquote>
<p>Comments addressed except the macro vs fn comment because I'm not clear how to resolve the compile error.</p>
<p>Please take another look.</p>
</blockquote>



<a name="342163810"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235929%20Begin%20implementation%20of%20wasi-http/near/342163810" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235929.20Begin.20implementation.20of.20wasi-http.html#342163810">(Mar 15 2023 at 20:52)</a>:</h4>
<p>brendandburns edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/5929#issuecomment-1467350680">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5929">issue #5929</a>:</p>
<blockquote>
<p>Comments addressed ~except the macro vs fn comment because I'm not clear how to resolve the compile error.~</p>
<p>Please take another look.</p>
</blockquote>



<a name="342711647"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235929%20Begin%20implementation%20of%20wasi-http/near/342711647" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235929.20Begin.20implementation.20of.20wasi-http.html#342711647">(Mar 18 2023 at 05:30)</a>:</h4>
<p>brendandburns <a href="https://github.com/bytecodealliance/wasmtime/pull/5929#issuecomment-1474719918">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5929">issue #5929</a>:</p>
<blockquote>
<p>Ok, this was switched to hyper. I'm not sure it really saved you very many dependencies, but if there are other ways to reduce the dependency count, let me know. Hyper doesn't implement TLS, so I had to pull in <code>hyper_native_tls</code></p>
<p>I think this is ready to go, let me know if there is a good way to add tests, it seems the other modules don't really have tests.</p>
</blockquote>



<a name="343268089"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235929%20Begin%20implementation%20of%20wasi-http/near/343268089" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235929.20Begin.20implementation.20of.20wasi-http.html#343268089">(Mar 21 2023 at 03:33)</a>:</h4>
<p>brendandburns <a href="https://github.com/bytecodealliance/wasmtime/pull/5929#issuecomment-1477235241">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5929">issue #5929</a>:</p>
<blockquote>
<p>@pchickey </p>
<p>Ok, I implemented timeouts. I think that the client side implementation is now basically feature complete. Ready for a more detailed review whenever you have time.</p>
<p>Thanks!</p>
</blockquote>



<a name="343268163"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235929%20Begin%20implementation%20of%20wasi-http/near/343268163" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235929.20Begin.20implementation.20of.20wasi-http.html#343268163">(Mar 21 2023 at 03:34)</a>:</h4>
<p>brendandburns <a href="https://github.com/bytecodealliance/wasmtime/pull/5929#issuecomment-1477235566">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5929">issue #5929</a>:</p>
<blockquote>
<p>Oh, and I plan on starting the server side implementation in a different branch.</p>
</blockquote>



<a name="344362138"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235929%20Begin%20implementation%20of%20wasi-http/near/344362138" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235929.20Begin.20implementation.20of.20wasi-http.html#344362138">(Mar 24 2023 at 20:27)</a>:</h4>
<p>pchickey <a href="https://github.com/bytecodealliance/wasmtime/pull/5929#issuecomment-1483370305">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5929">issue #5929</a>:</p>
<blockquote>
<p>I left some fixes last night in <a href="https://github.com/brendandburns/wasmtime/pull/1">https://github.com/brendandburns/wasmtime/pull/1</a> but it looks like they now conflict</p>
</blockquote>



<a name="344362184"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235929%20Begin%20implementation%20of%20wasi-http/near/344362184" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235929.20Begin.20implementation.20of.20wasi-http.html#344362184">(Mar 24 2023 at 20:27)</a>:</h4>
<p>pchickey edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/5929#issuecomment-1483370305">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5929">issue #5929</a>:</p>
<blockquote>
<p>I left some fixes last night in <a href="https://github.com/brendandburns/wasmtime/pull/1">https://github.com/brendandburns/wasmtime/pull/1</a> but it looks like they now conflict - I'll rebase that PR on the current state of this branch</p>
</blockquote>



<a name="344365576"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235929%20Begin%20implementation%20of%20wasi-http/near/344365576" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235929.20Begin.20implementation.20of.20wasi-http.html#344365576">(Mar 24 2023 at 20:51)</a>:</h4>
<p>pchickey edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/5929#issuecomment-1483370305">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5929">issue #5929</a>:</p>
<blockquote>
<p>I left some fixes last night in <a href="https://github.com/brendandburns/wasmtime/pull/1">https://github.com/brendandburns/wasmtime/pull/1</a> but it looks like they now conflict - I'll rebase that PR on the current state of this branch (edit: done now!)</p>
</blockquote>



<a name="344365895"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235929%20Begin%20implementation%20of%20wasi-http/near/344365895" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235929.20Begin.20implementation.20of.20wasi-http.html#344365895">(Mar 24 2023 at 20:53)</a>:</h4>
<p>pchickey <a href="https://github.com/bytecodealliance/wasmtime/pull/5929#issuecomment-1483393105">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5929">issue #5929</a>:</p>
<blockquote>
<p>from my point of view we still need to fix 2 architectural issues before we can merge:</p>
<ul>
<li>wasmtime should be running in the tokio executor, rather than using block_on inside a Func. </li>
<li>rather than examples provided in C, we need to rewrite those to be test-programs written in Rust, because our CI environment doesn't have a C compiler installed.</li>
</ul>
<p>I'll work on both of those things right now, and send them as PRs like the above:</p>
</blockquote>



<a name="344376758"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235929%20Begin%20implementation%20of%20wasi-http/near/344376758" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235929.20Begin.20implementation.20of.20wasi-http.html#344376758">(Mar 24 2023 at 22:15)</a>:</h4>
<p>eduardomourar <a href="https://github.com/bytecodealliance/wasmtime/pull/5929#issuecomment-1483496665">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5929">issue #5929</a>:</p>
<blockquote>
<p>@pchickey , I believe you can borrow code from <a href="https://github.com/eduardomourar/smithy-rs/blob/support-wasi-http/aws/sdk/integration-tests/webassembly/src/adapter/http_client.rs">here</a> for your Rust example.</p>
</blockquote>



<a name="344377699"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235929%20Begin%20implementation%20of%20wasi-http/near/344377699" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235929.20Begin.20implementation.20of.20wasi-http.html#344377699">(Mar 24 2023 at 22:22)</a>:</h4>
<p>brendandburns <a href="https://github.com/bytecodealliance/wasmtime/pull/5929#issuecomment-1483506481">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5929">issue #5929</a>:</p>
<blockquote>
<p>@pchickey thanks for the PR, I merged it. Let me know if you want me to take on either of those tasks.<br>
</p>
</blockquote>



<a name="344794638"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235929%20Begin%20implementation%20of%20wasi-http/near/344794638" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235929.20Begin.20implementation.20of.20wasi-http.html#344794638">(Mar 27 2023 at 08:26)</a>:</h4>
<p>eduardomourar edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/5929#issuecomment-1483496665">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5929">issue #5929</a>:</p>
<blockquote>
<p>@pchickey , I believe you can borrow code from <a href="https://github.com/bytecodealliance/preview2-prototyping/blob/63fd0626b38a99288c5e2fc1d531b9c203ae13ec/wasi/src/http.rs">here</a> for your Rust example.</p>
</blockquote>



<a name="345005219"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235929%20Begin%20implementation%20of%20wasi-http/near/345005219" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235929.20Begin.20implementation.20of.20wasi-http.html#345005219">(Mar 28 2023 at 01:27)</a>:</h4>
<p>brendandburns <a href="https://github.com/bytecodealliance/wasmtime/pull/5929#issuecomment-1486077555">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5929">issue #5929</a>:</p>
<blockquote>
<p>@pchickey unless you've already started on this, I can take care of those two items.</p>
</blockquote>



<a name="345021731"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235929%20Begin%20implementation%20of%20wasi-http/near/345021731" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235929.20Begin.20implementation.20of.20wasi-http.html#345021731">(Mar 28 2023 at 04:35)</a>:</h4>
<p>brendandburns <a href="https://github.com/bytecodealliance/wasmtime/pull/5929#issuecomment-1486202629">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5929">issue #5929</a>:</p>
<blockquote>
<p>Ok, I switched the executor on the <code>Host</code> to use <code>tokio::Runtime::block_on</code> instead of <code>executors</code>.</p>
<p>I don't think it is required to build out the full async support in this first PR, but if that's really a blocker, I will.</p>
<p>I also added an example implemented in rust for use as a test or just another example.</p>
<p>Please take another look.</p>
</blockquote>



<a name="345021802"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235929%20Begin%20implementation%20of%20wasi-http/near/345021802" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235929.20Begin.20implementation.20of.20wasi-http.html#345021802">(Mar 28 2023 at 04:36)</a>:</h4>
<p>brendandburns edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/5929#issuecomment-1486202629">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5929">issue #5929</a>:</p>
<blockquote>
<p>Ok, I switched the executor on the <code>Host</code> to use <code>tokio::Runtime::block_on</code> instead of <code>executors</code>.</p>
<p>I don't think it is required to build out the full async support in this first PR, but if that's really a blocker, I will.</p>
<p>We can't just use <code>spawn_task</code> and <code>await</code> in that function because it is not declared <code>async</code></p>
<p>I also added an example implemented in rust for use as a test or just another example.</p>
<p>Please take another look.</p>
</blockquote>



<a name="345026304"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235929%20Begin%20implementation%20of%20wasi-http/near/345026304" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235929.20Begin.20implementation.20of.20wasi-http.html#345026304">(Mar 28 2023 at 05:14)</a>:</h4>
<p>pchickey <a href="https://github.com/bytecodealliance/wasmtime/pull/5929#issuecomment-1486228458">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5929">issue #5929</a>:</p>
<blockquote>
<p>I just finished writing basically the same rust example this morning but I didn't push it yet because I need to hook its build and execution into the <code>test-programs</code> machinery. I'll wrap that up tomorrow and push it to you.</p>
<p>And yeah lets just do async after we land this PR. We'll have to string async through everywhere, including into the wasmtime cli to run things under tokio when the http module is enabled.</p>
</blockquote>



<a name="345171272"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235929%20Begin%20implementation%20of%20wasi-http/near/345171272" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235929.20Begin.20implementation.20of.20wasi-http.html#345171272">(Mar 28 2023 at 15:38)</a>:</h4>
<p>brendandburns <a href="https://github.com/bytecodealliance/wasmtime/pull/5929#issuecomment-1487145206">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5929">issue #5929</a>:</p>
<blockquote>
<p>@pchickey sounds good, I'm happy to delete my Rust example and just use yours if that is easier.</p>
</blockquote>



<a name="345480233"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235929%20Begin%20implementation%20of%20wasi-http/near/345480233" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235929.20Begin.20implementation.20of.20wasi-http.html#345480233">(Mar 29 2023 at 18:06)</a>:</h4>
<p>pchickey <a href="https://github.com/bytecodealliance/wasmtime/pull/5929#issuecomment-1489069050">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5929">issue #5929</a>:</p>
<blockquote>
<p><a href="https://github.com/brendandburns/wasmtime/pull/2">https://github.com/brendandburns/wasmtime/pull/2</a> finishes up the testing changes. I am working on the supply chain stuff today, I will send a PR with any changes needed here but most of those I'll have to submit to wasmtime in a separate PR that will merge before this one.</p>
</blockquote>



<a name="345511332"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235929%20Begin%20implementation%20of%20wasi-http/near/345511332" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235929.20Begin.20implementation.20of.20wasi-http.html#345511332">(Mar 29 2023 at 20:39)</a>:</h4>
<p>brendandburns <a href="https://github.com/bytecodealliance/wasmtime/pull/5929#issuecomment-1489278534">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5929">issue #5929</a>:</p>
<blockquote>
<p>Cool. I squashed/merged that PR. Let me know if you need anything else from me.</p>
</blockquote>



<a name="345536909"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235929%20Begin%20implementation%20of%20wasi-http/near/345536909" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235929.20Begin.20implementation.20of.20wasi-http.html#345536909">(Mar 30 2023 at 00:23)</a>:</h4>
<p>pchickey <a href="https://github.com/bytecodealliance/wasmtime/pull/5929#issuecomment-1489515544">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5929">issue #5929</a>:</p>
<blockquote>
<p><a href="https://github.com/bytecodealliance/wasmtime/pull/6121">https://github.com/bytecodealliance/wasmtime/pull/6121</a> will need to land and merge to make the deny and vet CI steps pass. Then, we expect the rest of the steps will pass, since they did locally, but windows and mac can surprise me sometimes.</p>
<p>We will need to remove the contents of <code>crates/wasi-http/example/</code>, and at that point I think we are good to go, I'll make one pass with fresh eyes tomorrow.</p>
</blockquote>



<a name="345538259"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235929%20Begin%20implementation%20of%20wasi-http/near/345538259" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235929.20Begin.20implementation.20of.20wasi-http.html#345538259">(Mar 30 2023 at 00:35)</a>:</h4>
<p>pchickey edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/5929#issuecomment-1489515544">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5929">issue #5929</a>:</p>
<blockquote>
<p><a href="https://github.com/bytecodealliance/wasmtime/pull/6121">https://github.com/bytecodealliance/wasmtime/pull/6121</a> will need to land and merge to make the deny and vet CI steps pass. Then, we expect the rest of the steps will pass, since they did locally, but windows and mac can surprise me sometimes.</p>
<p>We will need to remove the contents of <code>crates/wasi-http/example/</code>: we don't want any code in the tree which isn't checked by CI, because it is bound to get out of date. At that point I think we are good to go, I'll make one more pass with fresh eyes tomorrow.</p>
</blockquote>



<a name="345718514"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235929%20Begin%20implementation%20of%20wasi-http/near/345718514" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235929.20Begin.20implementation.20of.20wasi-http.html#345718514">(Mar 30 2023 at 15:51)</a>:</h4>
<p>pchickey <a href="https://github.com/bytecodealliance/wasmtime/pull/5929#issuecomment-1490539633">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5929">issue #5929</a>:</p>
<blockquote>
<p><a href="https://github.com/brendandburns/wasmtime/pull/3">https://github.com/brendandburns/wasmtime/pull/3</a> will make the cargo vet step pass</p>
</blockquote>



<a name="345721721"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235929%20Begin%20implementation%20of%20wasi-http/near/345721721" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235929.20Begin.20implementation.20of.20wasi-http.html#345721721">(Mar 30 2023 at 16:01)</a>:</h4>
<p>brendandburns <a href="https://github.com/bytecodealliance/wasmtime/pull/5929#issuecomment-1490554085">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5929">issue #5929</a>:</p>
<blockquote>
<ul>
<li>PRs merged (thanks!)</li>
<li>example directory removed</li>
</ul>
<p>I think this is ready to go.</p>
</blockquote>



<a name="345726025"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235929%20Begin%20implementation%20of%20wasi-http/near/345726025" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235929.20Begin.20implementation.20of.20wasi-http.html#345726025">(Mar 30 2023 at 16:16)</a>:</h4>
<p>pchickey <a href="https://github.com/bytecodealliance/wasmtime/pull/5929#issuecomment-1490574910">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5929">issue #5929</a>:</p>
<blockquote>
<p>It looks like I missed the vet of some stuff I introduced in #2, I'll get those if you can fix the warnings I sloppily left in the test</p>
</blockquote>



<a name="345792571"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235929%20Begin%20implementation%20of%20wasi-http/near/345792571" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235929.20Begin.20implementation.20of.20wasi-http.html#345792571">(Mar 30 2023 at 21:43)</a>:</h4>
<p>pchickey <a href="https://github.com/bytecodealliance/wasmtime/pull/5929#issuecomment-1491005323">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5929">issue #5929</a>:</p>
<blockquote>
<p>in order to make CI faster, we don't run every step until its time to go in the merge queue. <a href="https://github.com/brendandburns/wasmtime/pull/4">https://github.com/brendandburns/wasmtime/pull/4</a> fixes the publishing issues.</p>
</blockquote>



<a name="345796582"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235929%20Begin%20implementation%20of%20wasi-http/near/345796582" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235929.20Begin.20implementation.20of.20wasi-http.html#345796582">(Mar 30 2023 at 22:14)</a>:</h4>
<p>eduardomourar <a href="https://github.com/bytecodealliance/wasmtime/pull/5929#issuecomment-1491035247">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5929">issue #5929</a>:</p>
<blockquote>
<p>@pchickey , I know this is a little bit late, but can we change this package name to <code>wasmtime-wasi-http</code>, please? I feel that the current name there will eventually be used for the guest bindings and its high-level basic implementation.</p>
</blockquote>



<a name="345805579"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235929%20Begin%20implementation%20of%20wasi-http/near/345805579" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235929.20Begin.20implementation.20of.20wasi-http.html#345805579">(Mar 30 2023 at 23:24)</a>:</h4>
<p>pchickey <a href="https://github.com/bytecodealliance/wasmtime/pull/5929#issuecomment-1491089961">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5929">issue #5929</a>:</p>
<blockquote>
<p>@eduardomourar I think that is a good idea but lets get things merged and then rename it - we have a few more days before the release gets cut.</p>
</blockquote>



<a name="345809486"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235929%20Begin%20implementation%20of%20wasi-http/near/345809486" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235929.20Begin.20implementation.20of.20wasi-http.html#345809486">(Mar 31 2023 at 00:05)</a>:</h4>
<p>brendandburns <a href="https://github.com/bytecodealliance/wasmtime/pull/5929#issuecomment-1491116366">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5929">issue #5929</a>:</p>
<blockquote>
<p>Merged the PR. I will send a couple of follow on PRs (including the rename) this evening.</p>
</blockquote>



<a name="345815700"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235929%20Begin%20implementation%20of%20wasi-http/near/345815700" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235929.20Begin.20implementation.20of.20wasi-http.html#345815700">(Mar 31 2023 at 01:03)</a>:</h4>
<p>eduardomourar <a href="https://github.com/bytecodealliance/wasmtime/pull/5929#issuecomment-1491150227">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5929">issue #5929</a>:</p>
<blockquote>
<p>Here is an initial stab at the guest binding: <a href="https://github.com/bytecodealliance/wasi/pull/69">https://github.com/bytecodealliance/wasi/pull/69</a></p>
</blockquote>



<a name="345830235"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235929%20Begin%20implementation%20of%20wasi-http/near/345830235" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235929.20Begin.20implementation.20of.20wasi-http.html#345830235">(Mar 31 2023 at 03:33)</a>:</h4>
<p>jeffparsons <a href="https://github.com/bytecodealliance/wasmtime/pull/5929#issuecomment-1491241013">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5929">issue #5929</a>:</p>
<blockquote>
<p>Is it easy/possible to play with these WASI module implementations from Rust as they land? E.g. if I copy a snapshot of the relevant wit files locally and then build a component using cargo-component and its adapter magic, could I then run that in Wasmtime and expect something to happen?</p>
<p>Just having a bit of trouble understanding what pieces already work together, and which need other pieces (new WASI target in rustc, completed component model support in Wasmtime) to land first.</p>
</blockquote>



<a name="345830356"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235929%20Begin%20implementation%20of%20wasi-http/near/345830356" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235929.20Begin.20implementation.20of.20wasi-http.html#345830356">(Mar 31 2023 at 03:34)</a>:</h4>
<p>jeffparsons edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/5929#issuecomment-1491241013">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5929">issue #5929</a>:</p>
<blockquote>
<p>Is it easy/possible to play with these WASI module implementations from Rust as they land? E.g. if I copy a snapshot of the relevant wit files locally and then build a component using cargo-component and its adapter magic (edit: that attempts to use wasi-http), could I then run that in Wasmtime and expect something to happen?</p>
<p>Just having a bit of trouble understanding what pieces already work together, and which need other pieces (new WASI target in rustc, completed component model support in Wasmtime) to land first.</p>
</blockquote>



<a name="345985148"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235929%20Begin%20implementation%20of%20wasi-http/near/345985148" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235929.20Begin.20implementation.20of.20wasi-http.html#345985148">(Mar 31 2023 at 15:26)</a>:</h4>
<p>brendandburns <a href="https://github.com/bytecodealliance/wasmtime/pull/5929#issuecomment-1492125169">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5929">issue #5929</a>:</p>
<blockquote>
<p>@jeffparsons yes, it's pretty easy to play with the modules.</p>
<p>You need to:</p>
<p>Run <code>wit-bindgen rust wasmtime/crates/wasi-http/wit</code> this will generate the Rust client side bindings (you can substitute <code>wit-bindgen c ...</code> if you want the c bindings instead.</p>
<p>Once you have that, here's a small example program that you can compile:</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">use</span><span class="w"> </span><span class="k">crate</span>::<span class="n">proxy</span>::<span class="n">types</span>::<span class="n">new_fields</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="k">crate</span>::<span class="n">proxy</span>::<span class="n">types</span>::<span class="n">new_outgoing_request</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="k">crate</span>::<span class="n">proxy</span>::<span class="n">types</span>::<span class="n">MethodParam</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="k">crate</span>::<span class="n">proxy</span>::<span class="n">types</span>::<span class="n">SchemeParam</span><span class="p">;</span>

<span class="k">pub</span><span class="w"> </span><span class="k">mod</span> <span class="nn">proxy</span><span class="p">;</span>

<span class="k">fn</span> <span class="nf">request</span><span class="p">(</span><span class="n">method</span>: <span class="nc">MethodParam</span><span class="p">,</span><span class="w"> </span><span class="n">scheme</span>: <span class="nb">Option</span><span class="o">&lt;</span><span class="n">SchemeParam</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">host</span>: <span class="kp">&amp;</span><span class="kt">str</span><span class="p">,</span><span class="w"> </span><span class="n">path</span>: <span class="kp">&amp;</span><span class="kt">str</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">headers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new_fields</span><span class="p">(</span><span class="o">&amp;</span><span class="p">[</span>
<span class="w">        </span><span class="p">(</span><span class="s">"Content-type"</span><span class="p">,</span><span class="w"> </span><span class="s">"text/plain"</span><span class="p">),</span>
<span class="w">        </span><span class="p">(</span><span class="s">"User-agent"</span><span class="p">,</span><span class="w"> </span><span class="s">"wasm32-wasi-rust"</span><span class="p">),</span>
<span class="w">    </span><span class="p">]);</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">req</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new_outgoing_request</span><span class="p">(</span><span class="n">method</span><span class="p">,</span><span class="w"> </span><span class="n">path</span><span class="p">,</span><span class="w"> </span><span class="s">""</span><span class="p">,</span><span class="w"> </span><span class="n">scheme</span><span class="p">,</span><span class="w"> </span><span class="n">host</span><span class="p">,</span><span class="w"> </span><span class="n">headers</span><span class="p">);</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">fut</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">crate</span>::<span class="n">proxy</span>::<span class="n">default_outgoing_http</span>::<span class="n">handle</span><span class="p">(</span><span class="n">req</span><span class="p">,</span><span class="w"> </span><span class="nb">None</span><span class="p">);</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">crate</span>::<span class="n">proxy</span>::<span class="n">types</span>::<span class="n">future_incoming_response_get</span><span class="p">(</span><span class="n">fut</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="n">unwrap</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="n">unwrap</span><span class="p">();</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">crate</span>::<span class="n">proxy</span>::<span class="n">types</span>::<span class="n">incoming_response_status</span><span class="p">(</span><span class="n">res</span><span class="p">);</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">response_headers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">crate</span>::<span class="n">proxy</span>::<span class="n">types</span>::<span class="n">incoming_response_headers</span><span class="p">(</span><span class="n">res</span><span class="p">);</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">stream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">crate</span>::<span class="n">proxy</span>::<span class="n">types</span>::<span class="n">incoming_response_consume</span><span class="p">(</span><span class="n">res</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">crate</span>::<span class="n">proxy</span>::<span class="n">streams</span>::<span class="n">read</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span><span class="w"> </span><span class="mi">60</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">1024</span><span class="p">).</span><span class="n">unwrap</span><span class="p">().</span><span class="mi">0</span><span class="p">;</span>

<span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">"Status is {}"</span><span class="p">,</span><span class="w"> </span><span class="n">code</span><span class="p">);</span>
<span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">"Headers are:"</span><span class="p">);</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">entries</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">crate</span>::<span class="n">proxy</span>::<span class="n">types</span>::<span class="n">fields_entries</span><span class="p">(</span><span class="n">response_headers</span><span class="p">);</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">tuple</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">entries</span><span class="p">.</span><span class="n">iter</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="fm">println!</span><span class="p">(</span><span class="s">"{}: {}"</span><span class="p">,</span><span class="w"> </span><span class="n">tuple</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">tuple</span><span class="p">.</span><span class="mi">1</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span><span class="w"> </span><span class="nb">String</span>::<span class="n">from_utf8</span><span class="p">(</span><span class="n">body</span><span class="p">).</span><span class="n">unwrap</span><span class="p">());</span>
<span class="p">}</span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">request</span><span class="p">(</span>
<span class="w">        </span><span class="n">MethodParam</span>::<span class="n">Get</span><span class="p">,</span>
<span class="w">        </span><span class="nb">Some</span><span class="p">(</span><span class="n">SchemeParam</span>::<span class="n">Https</span><span class="p">),</span>
<span class="w">        </span><span class="s">"postman-echo.com"</span><span class="p">,</span>
<span class="w">        </span><span class="s">"/get"</span><span class="p">,</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">    </span><span class="n">request</span><span class="p">(</span>
<span class="w">        </span><span class="n">MethodParam</span>::<span class="n">Post</span><span class="p">,</span>
<span class="w">        </span><span class="nb">Some</span><span class="p">(</span><span class="n">SchemeParam</span>::<span class="n">Https</span><span class="p">),</span>
<span class="w">        </span><span class="s">"postman-echo.com"</span><span class="p">,</span>
<span class="w">        </span><span class="s">"/post"</span><span class="p">,</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">    </span><span class="n">request</span><span class="p">(</span>
<span class="w">        </span><span class="n">MethodParam</span>::<span class="n">Put</span><span class="p">,</span>
<span class="w">        </span><span class="nb">Some</span><span class="p">(</span><span class="n">SchemeParam</span>::<span class="n">Http</span><span class="p">),</span>
<span class="w">        </span><span class="s">"postman-echo.com"</span><span class="p">,</span>
<span class="w">        </span><span class="s">"/put"</span><span class="p">,</span>
<span class="w">    </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="345985373"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235929%20Begin%20implementation%20of%20wasi-http/near/345985373" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235929.20Begin.20implementation.20of.20wasi-http.html#345985373">(Mar 31 2023 at 15:26)</a>:</h4>
<p>brendandburns edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/5929#issuecomment-1492125169">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5929">issue #5929</a>:</p>
<blockquote>
<p>@jeffparsons yes, it's pretty easy to play with the modules, it doesn't require any of the component stuff (yet)</p>
<p>You need to:</p>
<p>Run <code>wit-bindgen rust wasmtime/crates/wasi-http/wit</code> this will generate the Rust client side bindings (you can substitute <code>wit-bindgen c ...</code> if you want the c bindings instead.</p>
<p>Once you have that, here's a small example program that you can compile:</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">use</span><span class="w"> </span><span class="k">crate</span>::<span class="n">proxy</span>::<span class="n">types</span>::<span class="n">new_fields</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="k">crate</span>::<span class="n">proxy</span>::<span class="n">types</span>::<span class="n">new_outgoing_request</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="k">crate</span>::<span class="n">proxy</span>::<span class="n">types</span>::<span class="n">MethodParam</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="k">crate</span>::<span class="n">proxy</span>::<span class="n">types</span>::<span class="n">SchemeParam</span><span class="p">;</span>

<span class="k">pub</span><span class="w"> </span><span class="k">mod</span> <span class="nn">proxy</span><span class="p">;</span>

<span class="k">fn</span> <span class="nf">request</span><span class="p">(</span><span class="n">method</span>: <span class="nc">MethodParam</span><span class="p">,</span><span class="w"> </span><span class="n">scheme</span>: <span class="nb">Option</span><span class="o">&lt;</span><span class="n">SchemeParam</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">host</span>: <span class="kp">&amp;</span><span class="kt">str</span><span class="p">,</span><span class="w"> </span><span class="n">path</span>: <span class="kp">&amp;</span><span class="kt">str</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">headers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new_fields</span><span class="p">(</span><span class="o">&amp;</span><span class="p">[</span>
<span class="w">        </span><span class="p">(</span><span class="s">"Content-type"</span><span class="p">,</span><span class="w"> </span><span class="s">"text/plain"</span><span class="p">),</span>
<span class="w">        </span><span class="p">(</span><span class="s">"User-agent"</span><span class="p">,</span><span class="w"> </span><span class="s">"wasm32-wasi-rust"</span><span class="p">),</span>
<span class="w">    </span><span class="p">]);</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">req</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new_outgoing_request</span><span class="p">(</span><span class="n">method</span><span class="p">,</span><span class="w"> </span><span class="n">path</span><span class="p">,</span><span class="w"> </span><span class="s">""</span><span class="p">,</span><span class="w"> </span><span class="n">scheme</span><span class="p">,</span><span class="w"> </span><span class="n">host</span><span class="p">,</span><span class="w"> </span><span class="n">headers</span><span class="p">);</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">fut</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">crate</span>::<span class="n">proxy</span>::<span class="n">default_outgoing_http</span>::<span class="n">handle</span><span class="p">(</span><span class="n">req</span><span class="p">,</span><span class="w"> </span><span class="nb">None</span><span class="p">);</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">crate</span>::<span class="n">proxy</span>::<span class="n">types</span>::<span class="n">future_incoming_response_get</span><span class="p">(</span><span class="n">fut</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="n">unwrap</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="n">unwrap</span><span class="p">();</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">crate</span>::<span class="n">proxy</span>::<span class="n">types</span>::<span class="n">incoming_response_status</span><span class="p">(</span><span class="n">res</span><span class="p">);</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">response_headers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">crate</span>::<span class="n">proxy</span>::<span class="n">types</span>::<span class="n">incoming_response_headers</span><span class="p">(</span><span class="n">res</span><span class="p">);</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">stream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">crate</span>::<span class="n">proxy</span>::<span class="n">types</span>::<span class="n">incoming_response_consume</span><span class="p">(</span><span class="n">res</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">crate</span>::<span class="n">proxy</span>::<span class="n">streams</span>::<span class="n">read</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span><span class="w"> </span><span class="mi">60</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">1024</span><span class="p">).</span><span class="n">unwrap</span><span class="p">().</span><span class="mi">0</span><span class="p">;</span>

<span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">"Status is {}"</span><span class="p">,</span><span class="w"> </span><span class="n">code</span><span class="p">);</span>
<span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">"Headers are:"</span><span class="p">);</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">entries</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">crate</span>::<span class="n">proxy</span>::<span class="n">types</span>::<span class="n">fields_entries</span><span class="p">(</span><span class="n">response_headers</span><span class="p">);</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">tuple</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">entries</span><span class="p">.</span><span class="n">iter</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="fm">println!</span><span class="p">(</span><span class="s">"{}: {}"</span><span class="p">,</span><span class="w"> </span><span class="n">tuple</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">tuple</span><span class="p">.</span><span class="mi">1</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span><span class="w"> </span><span class="nb">String</span>::<span class="n">from_utf8</span><span class="p">(</span><span class="n">body</span><span class="p">).</span><span class="n">unwrap</span><span class="p">());</span>
<span class="p">}</span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">request</span><span class="p">(</span>
<span class="w">        </span><span class="n">MethodParam</span>::<span class="n">Get</span><span class="p">,</span>
<span class="w">        </span><span class="nb">Some</span><span class="p">(</span><span class="n">SchemeParam</span>::<span class="n">Https</span><span class="p">),</span>
<span class="w">        </span><span class="s">"postman-echo.com"</span><span class="p">,</span>
<span class="w">        </span><span class="s">"/get"</span><span class="p">,</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">    </span><span class="n">request</span><span class="p">(</span>
<span class="w">        </span><span class="n">MethodParam</span>::<span class="n">Post</span><span class="p">,</span>
<span class="w">        </span><span class="nb">Some</span><span class="p">(</span><span class="n">SchemeParam</span>::<span class="n">Https</span><span class="p">),</span>
<span class="w">        </span><span class="s">"postman-echo.com"</span><span class="p">,</span>
<span class="w">        </span><span class="s">"/post"</span><span class="p">,</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">    </span><span class="n">request</span><span class="p">(</span>
<span class="w">        </span><span class="n">MethodParam</span>::<span class="n">Put</span><span class="p">,</span>
<span class="w">        </span><span class="nb">Some</span><span class="p">(</span><span class="n">SchemeParam</span>::<span class="n">Http</span><span class="p">),</span>
<span class="w">        </span><span class="s">"postman-echo.com"</span><span class="p">,</span>
<span class="w">        </span><span class="s">"/put"</span><span class="p">,</span>
<span class="w">    </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="345985533"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235929%20Begin%20implementation%20of%20wasi-http/near/345985533" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235929.20Begin.20implementation.20of.20wasi-http.html#345985533">(Mar 31 2023 at 15:27)</a>:</h4>
<p>brendandburns edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/5929#issuecomment-1492125169">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5929">issue #5929</a>:</p>
<blockquote>
<p>@jeffparsons yes, it's pretty easy to play with the modules, it doesn't require any of the component stuff (yet)</p>
<p>You need to:</p>
<p>Run <code>wit-bindgen rust wasmtime/crates/wasi-http/wit</code> this will generate the Rust client side bindings (you can substitute <code>wit-bindgen c ...</code> if you want the c bindings instead.</p>
<p>Once you have that, here's a small example program that you can compile:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">use</span><span class="w"> </span><span class="k">crate</span>::<span class="n">proxy</span>::<span class="n">types</span>::<span class="n">new_fields</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="k">crate</span>::<span class="n">proxy</span>::<span class="n">types</span>::<span class="n">new_outgoing_request</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="k">crate</span>::<span class="n">proxy</span>::<span class="n">types</span>::<span class="n">MethodParam</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="k">crate</span>::<span class="n">proxy</span>::<span class="n">types</span>::<span class="n">SchemeParam</span><span class="p">;</span>

<span class="k">pub</span><span class="w"> </span><span class="k">mod</span> <span class="nn">proxy</span><span class="p">;</span>

<span class="k">fn</span> <span class="nf">request</span><span class="p">(</span><span class="n">method</span>: <span class="nc">MethodParam</span><span class="p">,</span><span class="w"> </span><span class="n">scheme</span>: <span class="nb">Option</span><span class="o">&lt;</span><span class="n">SchemeParam</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">host</span>: <span class="kp">&amp;</span><span class="kt">str</span><span class="p">,</span><span class="w"> </span><span class="n">path</span>: <span class="kp">&amp;</span><span class="kt">str</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">headers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new_fields</span><span class="p">(</span><span class="o">&amp;</span><span class="p">[</span>
<span class="w">        </span><span class="p">(</span><span class="s">"Content-type"</span><span class="p">,</span><span class="w"> </span><span class="s">"text/plain"</span><span class="p">),</span>
<span class="w">        </span><span class="p">(</span><span class="s">"User-agent"</span><span class="p">,</span><span class="w"> </span><span class="s">"wasm32-wasi-rust"</span><span class="p">),</span>
<span class="w">    </span><span class="p">]);</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">req</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new_outgoing_request</span><span class="p">(</span><span class="n">method</span><span class="p">,</span><span class="w"> </span><span class="n">path</span><span class="p">,</span><span class="w"> </span><span class="s">""</span><span class="p">,</span><span class="w"> </span><span class="n">scheme</span><span class="p">,</span><span class="w"> </span><span class="n">host</span><span class="p">,</span><span class="w"> </span><span class="n">headers</span><span class="p">);</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">fut</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">crate</span>::<span class="n">proxy</span>::<span class="n">default_outgoing_http</span>::<span class="n">handle</span><span class="p">(</span><span class="n">req</span><span class="p">,</span><span class="w"> </span><span class="nb">None</span><span class="p">);</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">crate</span>::<span class="n">proxy</span>::<span class="n">types</span>::<span class="n">future_incoming_response_get</span><span class="p">(</span><span class="n">fut</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="n">unwrap</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="n">unwrap</span><span class="p">();</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">crate</span>::<span class="n">proxy</span>::<span class="n">types</span>::<span class="n">incoming_response_status</span><span class="p">(</span><span class="n">res</span><span class="p">);</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">response_headers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">crate</span>::<span class="n">proxy</span>::<span class="n">types</span>::<span class="n">incoming_response_headers</span><span class="p">(</span><span class="n">res</span><span class="p">);</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">stream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">crate</span>::<span class="n">proxy</span>::<span class="n">types</span>::<span class="n">incoming_response_consume</span><span class="p">(</span><span class="n">res</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">crate</span>::<span class="n">proxy</span>::<span class="n">streams</span>::<span class="n">read</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span><span class="w"> </span><span class="mi">60</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">1024</span><span class="p">).</span><span class="n">unwrap</span><span class="p">().</span><span class="mi">0</span><span class="p">;</span>

<span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">"Status is {}"</span><span class="p">,</span><span class="w"> </span><span class="n">code</span><span class="p">);</span>
<span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">"Headers are:"</span><span class="p">);</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">entries</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">crate</span>::<span class="n">proxy</span>::<span class="n">types</span>::<span class="n">fields_entries</span><span class="p">(</span><span class="n">response_headers</span><span class="p">);</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">tuple</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">entries</span><span class="p">.</span><span class="n">iter</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="fm">println!</span><span class="p">(</span><span class="s">"{}: {}"</span><span class="p">,</span><span class="w"> </span><span class="n">tuple</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">tuple</span><span class="p">.</span><span class="mi">1</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span><span class="w"> </span><span class="nb">String</span>::<span class="n">from_utf8</span><span class="p">(</span><span class="n">body</span><span class="p">).</span><span class="n">unwrap</span><span class="p">());</span>
<span class="p">}</span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">request</span><span class="p">(</span>
<span class="w">        </span><span class="n">MethodParam</span>::<span class="n">Get</span><span class="p">,</span>
<span class="w">        </span><span class="nb">Some</span><span class="p">(</span><span class="n">SchemeParam</span>::<span class="n">Https</span><span class="p">),</span>
<span class="w">        </span><span class="s">"postman-echo.com"</span><span class="p">,</span>
<span class="w">        </span><span class="s">"/get"</span><span class="p">,</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">    </span><span class="n">request</span><span class="p">(</span>
<span class="w">        </span><span class="n">MethodParam</span>::<span class="n">Post</span><span class="p">,</span>
<span class="w">        </span><span class="nb">Some</span><span class="p">(</span><span class="n">SchemeParam</span>::<span class="n">Https</span><span class="p">),</span>
<span class="w">        </span><span class="s">"postman-echo.com"</span><span class="p">,</span>
<span class="w">        </span><span class="s">"/post"</span><span class="p">,</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">    </span><span class="n">request</span><span class="p">(</span>
<span class="w">        </span><span class="n">MethodParam</span>::<span class="n">Put</span><span class="p">,</span>
<span class="w">        </span><span class="nb">Some</span><span class="p">(</span><span class="n">SchemeParam</span>::<span class="n">Http</span><span class="p">),</span>
<span class="w">        </span><span class="s">"postman-echo.com"</span><span class="p">,</span>
<span class="w">        </span><span class="s">"/put"</span><span class="p">,</span>
<span class="w">    </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>once you compile that to <code>main.wasm</code> (or whatever) you can run:</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">wasmtime</span><span class="w"> </span><span class="o">--</span><span class="n">wasi</span><span class="o">-</span><span class="n">modules</span><span class="o">=</span><span class="n">experimental</span><span class="o">-</span><span class="n">wasi</span><span class="o">-</span><span class="n">http</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">wasm</span><span class="err">`</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">work</span><span class="w"> </span><span class="n">correctly</span><span class="p">.</span>
<span class="o">~~~</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="346001233"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235929%20Begin%20implementation%20of%20wasi-http/near/346001233" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235929.20Begin.20implementation.20of.20wasi-http.html#346001233">(Mar 31 2023 at 16:23)</a>:</h4>
<p>pchickey <a href="https://github.com/bytecodealliance/wasmtime/pull/5929#issuecomment-1492230954">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5929">issue #5929</a>:</p>
<blockquote>
<p>@jeffparsons we still need to land the preview 1 adapter and a component model implementation of the rest of wasi before this becomes usable from components. the preview 1 adapter means we don't have to worry about a new wasi target in the rust toolchain at this time.</p>
</blockquote>



<a name="346011590"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235929%20Begin%20implementation%20of%20wasi-http/near/346011590" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235929.20Begin.20implementation.20of.20wasi-http.html#346011590">(Mar 31 2023 at 17:04)</a>:</h4>
<p>brendandburns <a href="https://github.com/bytecodealliance/wasmtime/pull/5929#issuecomment-1492274125">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5929">issue #5929</a>:</p>
<blockquote>
<p>@pchickey looks like the merge failed b/c libssl isn't installed on some of the test environments :(</p>
<p>How do you want to handle fixing this?</p>
</blockquote>



<a name="346023572"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235929%20Begin%20implementation%20of%20wasi-http/near/346023572" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235929.20Begin.20implementation.20of.20wasi-http.html#346023572">(Mar 31 2023 at 17:57)</a>:</h4>
<p>pchickey <a href="https://github.com/bytecodealliance/wasmtime/pull/5929#issuecomment-1492385735">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5929">issue #5929</a>:</p>
<blockquote>
<p>I am a bit stumped on how to fix this.</p>
<p>To maximize linux libc compatibility, we perform our linux release builds on centos 7 (<a href="https://github.com/bytecodealliance/wasmtime/blob/main/ci/docker/x86_64-linux/Dockerfile">https://github.com/bytecodealliance/wasmtime/blob/main/ci/docker/x86_64-linux/Dockerfile</a>). If we were to install the default libssl from centos 7 in the builder, it would mean all of our wasmtime linux users would need openssl 1.0.2 installed, which has been out of support since the start of 2020, so that isn't an acceptable solution.</p>
<p>I don't know enough about the linux and openssl ecosystem to know what minimum version is acceptable, but clearly it reduce our binary compatibility to take on this dep. I also don't know if there are any knobs we can tweak in the build to lazily load the openssl dylib, so users are opting in to needing it by passing the <code>--wasi-modules=experimental-wasi-http</code> flag.</p>
<p>Finally, I don't know if there are alternatives we can swap in for needing openssl on linux. I am aware that <code>rustls</code> exists, but I don't know if it is a complete alternative. I'll ask some of my colleagues who have spent more time in this space.</p>
</blockquote>



<a name="346027450"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235929%20Begin%20implementation%20of%20wasi-http/near/346027450" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235929.20Begin.20implementation.20of.20wasi-http.html#346027450">(Mar 31 2023 at 18:18)</a>:</h4>
<p>rvolosatovs <a href="https://github.com/bytecodealliance/wasmtime/pull/5929#issuecomment-1492408406">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5929">issue #5929</a>:</p>
<blockquote>
<blockquote>
<p>I am a bit stumped on how to fix this.</p>
<p>To maximize linux libc compatibility, we perform our linux release builds on centos 7 (<a href="https://github.com/bytecodealliance/wasmtime/blob/main/ci/docker/x86_64-linux/Dockerfile?rgh-link-date=2023-03-31T17%3A57%3A37Z"><code>main</code>/ci/docker/x86_64-linux/Dockerfile</a>). If we were to install the default libssl from centos 7 in the builder, it would mean all of our wasmtime linux users would need openssl 1.0.2 installed, which has been out of support since the start of 2020, so that isn't an acceptable solution.</p>
<p>I don't know enough about the linux and openssl ecosystem to know what minimum version is acceptable, but clearly it reduce our binary compatibility to take on this dep. I also don't know if there are any knobs we can tweak in the build to lazily load the openssl dylib, so users are opting in to needing it by passing the <code>--wasi-modules=experimental-wasi-http</code> flag.</p>
<p>Finally, I don't know if there are alternatives we can swap in for needing openssl on linux. I am aware that <code>rustls</code> exists, but I don't know if it is a complete alternative. I'll ask some of my colleagues who have spent more time in this space.</p>
</blockquote>
<p>FWIW, we have used <code>rustls</code> in <a href="https://github.com/enarx/enarx">https://github.com/enarx/enarx</a> to provide transparent TLS to guests by wrapping the wasmtime WASI TCP traits and it was perfectly sufficient for that particular use case, which seems quite related.</p>
<p>Depending on <code>rustls</code> would be best for both compatibility and simplicity of development. Definitely would vote for depending on <code>rustls</code> instead of <code>openssl</code></p>
<p>This would also make (perhaps eventually) static builds much easier</p>
</blockquote>



<a name="346027627"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235929%20Begin%20implementation%20of%20wasi-http/near/346027627" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235929.20Begin.20implementation.20of.20wasi-http.html#346027627">(Mar 31 2023 at 18:18)</a>:</h4>
<p>rvolosatovs edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/5929#issuecomment-1492408406">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5929">issue #5929</a>:</p>
<blockquote>
<blockquote>
<p>I am a bit stumped on how to fix this.</p>
<p>To maximize linux libc compatibility, we perform our linux release builds on centos 7 (<a href="https://github.com/bytecodealliance/wasmtime/blob/main/ci/docker/x86_64-linux/Dockerfile?rgh-link-date=2023-03-31T17%3A57%3A37Z"><code>main</code>/ci/docker/x86_64-linux/Dockerfile</a>). If we were to install the default libssl from centos 7 in the builder, it would mean all of our wasmtime linux users would need openssl 1.0.2 installed, which has been out of support since the start of 2020, so that isn't an acceptable solution.</p>
<p>I don't know enough about the linux and openssl ecosystem to know what minimum version is acceptable, but clearly it reduce our binary compatibility to take on this dep. I also don't know if there are any knobs we can tweak in the build to lazily load the openssl dylib, so users are opting in to needing it by passing the <code>--wasi-modules=experimental-wasi-http</code> flag.</p>
<p>Finally, I don't know if there are alternatives we can swap in for needing openssl on linux. I am aware that <code>rustls</code> exists, but I don't know if it is a complete alternative. I'll ask some of my colleagues who have spent more time in this space.</p>
</blockquote>
<p>FWIW, we have used <code>rustls</code> in <a href="https://github.com/enarx/enarx">https://github.com/enarx/enarx</a> to provide transparent TLS to guests by wrapping the wasmtime WASI TCP traits and it was perfectly sufficient for that particular use case, which seems quite related.</p>
<p>Depending on <code>rustls</code> would be best for both compatibility and simplicity of development. Definitely would vote for depending on <code>rustls</code> instead of <code>openssl</code></p>
<p>This would also make (perhaps eventually) static builds much easier</p>
<p>The only drawback I see is that <code>rustls</code> has not been through the same audits as <code>openssl</code> has, but IMO that is acceptable</p>
</blockquote>



<a name="346027948"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235929%20Begin%20implementation%20of%20wasi-http/near/346027948" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235929.20Begin.20implementation.20of.20wasi-http.html#346027948">(Mar 31 2023 at 18:20)</a>:</h4>
<p>rvolosatovs edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/5929#issuecomment-1492408406">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5929">issue #5929</a>:</p>
<blockquote>
<blockquote>
<p>I am a bit stumped on how to fix this.</p>
<p>To maximize linux libc compatibility, we perform our linux release builds on centos 7 (<a href="https://github.com/bytecodealliance/wasmtime/blob/main/ci/docker/x86_64-linux/Dockerfile?rgh-link-date=2023-03-31T17%3A57%3A37Z"><code>main</code>/ci/docker/x86_64-linux/Dockerfile</a>). If we were to install the default libssl from centos 7 in the builder, it would mean all of our wasmtime linux users would need openssl 1.0.2 installed, which has been out of support since the start of 2020, so that isn't an acceptable solution.</p>
<p>I don't know enough about the linux and openssl ecosystem to know what minimum version is acceptable, but clearly it reduce our binary compatibility to take on this dep. I also don't know if there are any knobs we can tweak in the build to lazily load the openssl dylib, so users are opting in to needing it by passing the <code>--wasi-modules=experimental-wasi-http</code> flag.</p>
<p>Finally, I don't know if there are alternatives we can swap in for needing openssl on linux. I am aware that <code>rustls</code> exists, but I don't know if it is a complete alternative. I'll ask some of my colleagues who have spent more time in this space.</p>
</blockquote>
<p>FWIW, we have used <code>rustls</code> in <a href="https://github.com/enarx/enarx">https://github.com/enarx/enarx</a> to provide transparent TLS to guests by wrapping the wasmtime WASI TCP traits and it was perfectly sufficient for that particular use case (both incoming and outbound), which seems quite related.</p>
<p>Depending on <code>rustls</code> would be best for both compatibility and simplicity of development. Definitely would vote for depending on <code>rustls</code> instead of <code>openssl</code></p>
<p>This would also make (perhaps eventually) static builds much easier</p>
<p>The only drawback I see is that <code>rustls</code> has not been through the same audits as <code>openssl</code> has, but IMO that is acceptable</p>
</blockquote>



<a name="346030262"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235929%20Begin%20implementation%20of%20wasi-http/near/346030262" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235929.20Begin.20implementation.20of.20wasi-http.html#346030262">(Mar 31 2023 at 18:32)</a>:</h4>
<p>pchickey <a href="https://github.com/bytecodealliance/wasmtime/pull/5929#issuecomment-1492423584">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5929">issue #5929</a>:</p>
<blockquote>
<p>Thanks, I asked around and we don't use rustls inside fastly for reasons that aren't relevant to this case. @brendandburns are you up for switching things to use rustls? I can do whatever supply chain audits that requires as soon as we know which crates it will take.</p>
<p>I guess it is a good time to rename the <code>wasi-http</code> crate to <code>wasmtime-wasi-http</code> in this PR since we'll be squeaking in before the release is cut next week.</p>
</blockquote>



<a name="346031245"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235929%20Begin%20implementation%20of%20wasi-http/near/346031245" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235929.20Begin.20implementation.20of.20wasi-http.html#346031245">(Mar 31 2023 at 18:37)</a>:</h4>
<p>pchickey <a href="https://github.com/bytecodealliance/wasmtime/pull/5929#issuecomment-1492429600">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5929">issue #5929</a>:</p>
<blockquote>
<p>I was just told we use rustls in <a href="https://github.com/fastly/viceroy">https://github.com/fastly/viceroy</a> and it has worked great for that use case.</p>
</blockquote>



<a name="346050884"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235929%20Begin%20implementation%20of%20wasi-http/near/346050884" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235929.20Begin.20implementation.20of.20wasi-http.html#346050884">(Mar 31 2023 at 20:28)</a>:</h4>
<p>brendandburns <a href="https://github.com/bytecodealliance/wasmtime/pull/5929#issuecomment-1492574122">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5929">issue #5929</a>:</p>
<blockquote>
<p>I will try switching to <code>rustls</code> I believe that it should be a pretty easy switch. I have a commit for the rename queued up also, so I will add that to this PR too.</p>
</blockquote>



<a name="346059390"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235929%20Begin%20implementation%20of%20wasi-http/near/346059390" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235929.20Begin.20implementation.20of.20wasi-http.html#346059390">(Mar 31 2023 at 21:24)</a>:</h4>
<p>brendandburns <a href="https://github.com/bytecodealliance/wasmtime/pull/5929#issuecomment-1492628300">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5929">issue #5929</a>:</p>
<blockquote>
<p>@pchickey this is switched to <code>rustls</code> and the rename (and a few minor cleanups) are added also.</p>
<p>Please take another look. I think you may have to vet a couple more packages :(</p>
</blockquote>



<a name="346417742"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235929%20Begin%20implementation%20of%20wasi-http/near/346417742" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235929.20Begin.20implementation.20of.20wasi-http.html#346417742">(Apr 02 2023 at 21:56)</a>:</h4>
<p>pchickey <a href="https://github.com/bytecodealliance/wasmtime/pull/5929#issuecomment-1493449134">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5929">issue #5929</a>:</p>
<blockquote>
<p>I'm not a license lawyer at all but it appears the config our team selected for cargo-deny doesn't permit the use of <code>webpki-roots</code>:<br>
<a href="https://github.com/bytecodealliance/wasmtime/actions/runs/4579627092/jobs/8087593223?pr=5929#step:5:160">https://github.com/bytecodealliance/wasmtime/actions/runs/4579627092/jobs/8087593223?pr=5929#step:5:160</a><br>
Could we swap it out to use <a href="https://github.com/rustls/rustls-native-certs">https://github.com/rustls/rustls-native-certs</a> instead?</p>
</blockquote>



<a name="346418222"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235929%20Begin%20implementation%20of%20wasi-http/near/346418222" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235929.20Begin.20implementation.20of.20wasi-http.html#346418222">(Apr 02 2023 at 22:03)</a>:</h4>
<p>pchickey edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/5929#issuecomment-1493449134">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5929">issue #5929</a>:</p>
<blockquote>
<p>I'm not a license lawyer at all but it appears the config our team selected for cargo-deny doesn't permit the use of <code>webpki-roots</code>:<br>
<a href="https://github.com/bytecodealliance/wasmtime/actions/runs/4579627092/jobs/8087593223?pr=5929#step:5:160">https://github.com/bytecodealliance/wasmtime/actions/runs/4579627092/jobs/8087593223?pr=5929#step:5:160</a><br>
Could we swap it out to use <a href="https://github.com/rustls/rustls-native-certs">https://github.com/rustls/rustls-native-certs</a> instead?</p>
<p>There is a related warning about <code>ring</code>, but it appears from the license file that it contains code with MIT, ISC, and the OpenSSL license <a href="https://github.com/briansmith/ring/blob/main/LICENSE">https://github.com/briansmith/ring/blob/main/LICENSE</a>. The only one there we don't currently permit is OpenSSL. I will have to seek guidance from the Bytecode Alliance TSC or board to see if we can allow that.</p>
</blockquote>



<a name="346418233"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235929%20Begin%20implementation%20of%20wasi-http/near/346418233" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235929.20Begin.20implementation.20of.20wasi-http.html#346418233">(Apr 02 2023 at 22:03)</a>:</h4>
<p>pchickey edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/5929#issuecomment-1493449134">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5929">issue #5929</a>:</p>
<blockquote>
<p>I'm not a license lawyer at all but it appears the config our team selected for cargo-deny doesn't permit the use of <code>webpki-roots</code>:<br>
<a href="https://github.com/bytecodealliance/wasmtime/actions/runs/4579627092/jobs/8087593223?pr=5929#step:5:160">https://github.com/bytecodealliance/wasmtime/actions/runs/4579627092/jobs/8087593223?pr=5929#step:5:160</a><br>
Could we swap it out to use <a href="https://github.com/rustls/rustls-native-certs">https://github.com/rustls/rustls-native-certs</a> instead?</p>
<p>There is a related warning about <code>ring</code>, but it appears from the license file that it contains code with MIT, ISC, and the OpenSSL license <a href="https://github.com/briansmith/ring/blob/main/LICENSE">https://github.com/briansmith/ring/blob/main/LICENSE</a>. The only one there we don't currently permit is OpenSSL. I will have to seek guidance from the Bytecode Alliance TSC or board to see if we can allow that, cc @tschneidereit @ricochet @fitzgen </p>
</blockquote>



<a name="346419821"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235929%20Begin%20implementation%20of%20wasi-http/near/346419821" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235929.20Begin.20implementation.20of.20wasi-http.html#346419821">(Apr 02 2023 at 22:23)</a>:</h4>
<p>tschneidereit <a href="https://github.com/bytecodealliance/wasmtime/pull/5929#issuecomment-1493454356">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5929">issue #5929</a>:</p>
<blockquote>
<p>If our cargo deny config doesn't accept MPL I'd argue we should change it. The MPL 2.0 is one of the most well designed and carefully legally vetted licenses out there, and has all the key properties we need, in particular only per-file copyleft and a patent grant</p>
</blockquote>



<a name="346693532"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235929%20Begin%20implementation%20of%20wasi-http/near/346693532" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235929.20Begin.20implementation.20of.20wasi-http.html#346693532">(Apr 03 2023 at 22:56)</a>:</h4>
<p>pchickey <a href="https://github.com/bytecodealliance/wasmtime/pull/5929#issuecomment-1495089732">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5929">issue #5929</a>:</p>
<blockquote>
<p>@brendandburns please merge <code>main</code> and this should pass CI, fingers crossed</p>
</blockquote>



<a name="346923213"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235929%20Begin%20implementation%20of%20wasi-http/near/346923213" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235929.20Begin.20implementation.20of.20wasi-http.html#346923213">(Apr 04 2023 at 17:14)</a>:</h4>
<p>brendandburns <a href="https://github.com/bytecodealliance/wasmtime/pull/5929#issuecomment-1496326630">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5929">issue #5929</a>:</p>
<blockquote>
<p>@pchickey thanks, rebased on <code>main</code> this looks like it's ready to go (again :))</p>
</blockquote>



<a name="346946349"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235929%20Begin%20implementation%20of%20wasi-http/near/346946349" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235929.20Begin.20implementation.20of.20wasi-http.html#346946349">(Apr 04 2023 at 19:01)</a>:</h4>
<p>brendandburns <a href="https://github.com/bytecodealliance/wasmtime/pull/5929#issuecomment-1496456345">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5929">issue #5929</a>:</p>
<blockquote>
<p>@pchickey I missed the rename in <code>scripts/publish.rs</code> so this got bounced out of the queue. </p>
<p>This is now fixed, hopefully it will pass the merge queue this time...</p>
</blockquote>



<a name="346983198"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235929%20Begin%20implementation%20of%20wasi-http/near/346983198" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235929.20Begin.20implementation.20of.20wasi-http.html#346983198">(Apr 04 2023 at 22:41)</a>:</h4>
<p>pchickey <a href="https://github.com/bytecodealliance/wasmtime/pull/5929#issuecomment-1496689481">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5929">issue #5929</a>:</p>
<blockquote>
<p>Unfortunately, it appears <code>ring</code> does not support riscv64. I think we will have to juggle some cargo feature flags around to disable including the <code>wasmtime-wasi-http</code> crate into <code>wasmtime-cli</code> on that platform.</p>
<p>Also, I just learned that you can use the magic string <code>prtest:full</code> in a commit message, and github will run the complete CI instead of just the automatically-estimated subset. That will at least get these issues to show up more eagerly, rather than waiting to enter the main merge queue.</p>
</blockquote>



<a name="347007801"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235929%20Begin%20implementation%20of%20wasi-http/near/347007801" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235929.20Begin.20implementation.20of.20wasi-http.html#347007801">(Apr 05 2023 at 02:31)</a>:</h4>
<p>brendandburns <a href="https://github.com/bytecodealliance/wasmtime/pull/5929#issuecomment-1496835783">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5929">issue #5929</a>:</p>
<blockquote>
<p>@pchickey ok, I will see about flipping the feature flags the right way (and thanks for the tip on the prtest:full, that will definitely enable quicker iteration.</p>
</blockquote>



<a name="347013064"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235929%20Begin%20implementation%20of%20wasi-http/near/347013064" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235929.20Begin.20implementation.20of.20wasi-http.html#347013064">(Apr 05 2023 at 03:29)</a>:</h4>
<p>brendandburns <a href="https://github.com/bytecodealliance/wasmtime/pull/5929#issuecomment-1496872497">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5929">issue #5929</a>:</p>
<blockquote>
<p>@pchickey I conditionalized tls to disable it on <code>riscv64gc</code></p>
<p>I tried the <code>prtest:full</code> thing but it didn't seem to work for me, maybe I did it wrong...</p>
<p>Anyhow, perhaps we can give this another try? If there's a way for me to trigger the full test runs w/o you adding it to the merge queue, let me know what I need to change in my commit message.</p>
<p>Thanks!</p>
</blockquote>



<a name="347013559"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235929%20Begin%20implementation%20of%20wasi-http/near/347013559" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235929.20Begin.20implementation.20of.20wasi-http.html#347013559">(Apr 05 2023 at 03:34)</a>:</h4>
<p>brendandburns edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/5929#issuecomment-1496872497">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5929">issue #5929</a>:</p>
<blockquote>
<p>@pchickey I conditionalized tls to disable it on <code>riscv64gc</code></p>
<p>~I tried the <code>prtest:full</code> thing but it didn't seem to work for me, maybe I did it wrong...~</p>
<p>~Anyhow, perhaps we can give this another try? If there's a way for me to trigger the full test runs w/o you adding it to the merge queue, let me know what I need to change in my commit message.~</p>
<p>Turns out the gh status was just cached and lagging, <code>prtest:full</code> appears to work correctly.</p>
<p>Turns out that <code>ring</code> doesn't work on <code>s390x</code> either, so I conditionalized that also. We may want to investigate how we can go back to native SSL, but that's for another PR...<br>
</p>
</blockquote>



<a name="347018462"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235929%20Begin%20implementation%20of%20wasi-http/near/347018462" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235929.20Begin.20implementation.20of.20wasi-http.html#347018462">(Apr 05 2023 at 04:26)</a>:</h4>
<p>brendandburns <a href="https://github.com/bytecodealliance/wasmtime/pull/5929#issuecomment-1496900371">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5929">issue #5929</a>:</p>
<blockquote>
<p>cc @pchickey </p>
<p>Ok, next issue hit:</p>
<p>The <code>wasmtime::component::bindgen!</code> macro expects a folder named <code>wit</code> in the same directory as the <code>Cargo.toml</code></p>
<p>The challenge is that if we want to pull the <code>wasi-http</code> repository in as a git submodule, then the directory structure is messed up, so I used a symbolic link to link <code>wit</code> -&gt; <code>wasi-http/wit</code> but it looks like those symbolic links don't work properly for Windows.</p>
<p>I can get rid of the git submodule, and just check in the <code>wit</code> files directly into this repo, it will make it a little more annoying to keep the wit files in-sync but it's do-able.</p>
<p>Let me know what you think.</p>
<p>`</p>
</blockquote>



<a name="347018692"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235929%20Begin%20implementation%20of%20wasi-http/near/347018692" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235929.20Begin.20implementation.20of.20wasi-http.html#347018692">(Apr 05 2023 at 04:29)</a>:</h4>
<p>brendandburns <a href="https://github.com/bytecodealliance/wasmtime/pull/5929#issuecomment-1496901912">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5929">issue #5929</a>:</p>
<blockquote>
<p>It looks like _maybe_ setting <code>git config --global core.symlinks true</code> in our builds would fix things? But I'm not certain where those builds are configured, I can't seem to find them in <code>main.yml</code></p>
</blockquote>



<a name="347021228"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235929%20Begin%20implementation%20of%20wasi-http/near/347021228" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235929.20Begin.20implementation.20of.20wasi-http.html#347021228">(Apr 05 2023 at 04:54)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/5929#issuecomment-1496915598">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5929">issue #5929</a>:</p>
<blockquote>
<p>Is it possible to modify the macro to have a configurable path? I think we'd probably prefer that over most any directory-structure or build-time hack (symlinks, copying files, or the like).</p>
</blockquote>



<a name="347038249"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235929%20Begin%20implementation%20of%20wasi-http/near/347038249" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235929.20Begin.20implementation.20of.20wasi-http.html#347038249">(Apr 05 2023 at 06:55)</a>:</h4>
<p>eduardomourar <a href="https://github.com/bytecodealliance/wasmtime/pull/5929#issuecomment-1497007469">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5929">issue #5929</a>:</p>
<blockquote>
<p>I believe the macro does accept a path property and you can check it here: <a href="https://github.com/bytecodealliance/wasmtime/blob/main/crates/component-macro/tests/codegen.rs">https://github.com/bytecodealliance/wasmtime/blob/main/crates/component-macro/tests/codegen.rs</a></p>
</blockquote>



<a name="347153535"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235929%20Begin%20implementation%20of%20wasi-http/near/347153535" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235929.20Begin.20implementation.20of.20wasi-http.html#347153535">(Apr 05 2023 at 13:56)</a>:</h4>
<p>brendandburns <a href="https://github.com/bytecodealliance/wasmtime/pull/5929#issuecomment-1497530793">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5929">issue #5929</a>:</p>
<blockquote>
<p>@eduardomourar thanks for the pointer (I don't think that's documented anywhere :() I updated this to use <code>path</code> and I removed the symlink.</p>
<p><em>crosses fingers</em></p>
</blockquote>



<a name="347218810"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235929%20Begin%20implementation%20of%20wasi-http/near/347218810" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235929.20Begin.20implementation.20of.20wasi-http.html#347218810">(Apr 05 2023 at 17:48)</a>:</h4>
<p>brendandburns <a href="https://github.com/bytecodealliance/wasmtime/pull/5929#issuecomment-1497885388">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5929">issue #5929</a>:</p>
<blockquote>
<p>@pchickey This passed complete CI, but it needed a rebase. I'm pretty sure that it will pass the merge queue this time.</p>
<p>Thanks for the patience!</p>
</blockquote>



<a name="347257709"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235929%20Begin%20implementation%20of%20wasi-http/near/347257709" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235929.20Begin.20implementation.20of.20wasi-http.html#347257709">(Apr 05 2023 at 21:35)</a>:</h4>
<p>brendandburns <a href="https://github.com/bytecodealliance/wasmtime/pull/5929#issuecomment-1498191063">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5929">issue #5929</a>:</p>
<blockquote>
<p><span aria-label="clink" class="emoji emoji-1f942" role="img" title="clink">:clink:</span> <span aria-label="confetti" class="emoji emoji-1f38a" role="img" title="confetti">:confetti:</span> <span aria-label="clink" class="emoji emoji-1f942" role="img" title="clink">:clink:</span> </p>
<p>Thanks for the patience here, I'll send in some follow-on PRs.</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>