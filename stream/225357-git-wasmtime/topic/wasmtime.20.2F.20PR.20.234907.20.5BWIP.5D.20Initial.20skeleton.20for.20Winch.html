<html>
<head><meta charset="utf-8"><title>wasmtime / PR #4907 [WIP] Initial skeleton for Winch · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234907.20.5BWIP.5D.20Initial.20skeleton.20for.20Winch.html">wasmtime / PR #4907 [WIP] Initial skeleton for Winch</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="298627213"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234907%20%5BWIP%5D%20Initial%20skeleton%20for%20Winch/near/298627213" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234907.20.5BWIP.5D.20Initial.20skeleton.20for.20Winch.html#298627213">(Sep 13 2022 at 16:55)</a>:</h4>
<p>saulecabrera opened <a href="https://github.com/bytecodealliance/wasmtime/pull/4907">PR #4907</a> from <code>winch-skeleton</code> to <code>main</code>:</p>
<blockquote>
<p>Ref: <a href="https://github.com/bytecodealliance/rfcs/pull/28">https://github.com/bytecodealliance/rfcs/pull/28</a></p>
<hr>
<p>This change introduces the initial skeleton for Winch, the "baseline" compiler.</p>
<p>This skeleton contains mostly setup code for the ISA, ABI, registers, and compilation environment abstractions. It also includes the calculation of function local slots.</p>
<p>As of the first commit, the structure of these abstractions looks like the following:</p>
<div class="codehilite"><pre><span></span><code>                    +------------------------+
                    |                        v
 +----------+     +-----+     +-----------+-----+-----------------+
 | Compiler | --&gt; | ISA | --&gt; | Registers | ABI | Compilation Env |
 +----------+     +-----+     +-----------+-----+-----------------+
                    |                              ^
                    +------------------------------+
</code></pre></div>

<hr>
<p>I'm opening this as a draft, since there are several items that I'd like to finish before continuing to iterate in-tree, namely:</p>
<ul>
<li>[ ] Prologue</li>
<li>[ ] Function body with (<strong>debug</strong>) <code>i32.add</code> support</li>
<li>[ ] Epilogue</li>
<li>[ ] Initial skeleton of a (<strong>debug</strong>) Assembler interface</li>
<li>[ ] Increase test coverage and include unit tests in CI</li>
</ul>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;<br>
</p>
</blockquote>



<a name="298627409"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234907%20%5BWIP%5D%20Initial%20skeleton%20for%20Winch/near/298627409" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234907.20.5BWIP.5D.20Initial.20skeleton.20for.20Winch.html#298627409">(Sep 13 2022 at 16:56)</a>:</h4>
<p>saulecabrera updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4907">PR #4907</a> from <code>winch-skeleton</code> to <code>main</code>.</p>



<a name="300257151"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234907%20%5BWIP%5D%20Initial%20skeleton%20for%20Winch/near/300257151" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234907.20.5BWIP.5D.20Initial.20skeleton.20for.20Winch.html#300257151">(Sep 22 2022 at 22:16)</a>:</h4>
<p>saulecabrera updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4907">PR #4907</a> from <code>winch-skeleton</code> to <code>main</code>.</p>



<a name="300333709"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234907%20%5BWIP%5D%20Initial%20skeleton%20for%20Winch/near/300333709" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234907.20.5BWIP.5D.20Initial.20skeleton.20for.20Winch.html#300333709">(Sep 23 2022 at 10:41)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/4907#discussion_r978501022">PR review comment</a>:</p>
<blockquote>
<p>This should probably replaced with features on winch that enable the respective feature of cranelift-codegen and additionally enabling the target architecture if no architecture is selected, just like for cranelift-codegen.</p>
</blockquote>



<a name="300333710"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234907%20%5BWIP%5D%20Initial%20skeleton%20for%20Winch/near/300333710" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234907.20.5BWIP.5D.20Initial.20skeleton.20for.20Winch.html#300333710">(Sep 23 2022 at 10:41)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4907#pullrequestreview-1118248825">PR review</a>.</p>



<a name="300444349"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234907%20%5BWIP%5D%20Initial%20skeleton%20for%20Winch/near/300444349" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234907.20.5BWIP.5D.20Initial.20skeleton.20for.20Winch.html#300444349">(Sep 23 2022 at 20:19)</a>:</h4>
<p>saulecabrera updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4907">PR #4907</a> from <code>winch-skeleton</code> to <code>main</code>.</p>



<a name="300444605"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234907%20%5BWIP%5D%20Initial%20skeleton%20for%20Winch/near/300444605" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234907.20.5BWIP.5D.20Initial.20skeleton.20for.20Winch.html#300444605">(Sep 23 2022 at 20:21)</a>:</h4>
<p>saulecabrera updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4907">PR #4907</a> from <code>winch-skeleton</code> to <code>main</code>.</p>



<a name="300914531"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234907%20%5BWIP%5D%20Initial%20skeleton%20for%20Winch/near/300914531" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234907.20.5BWIP.5D.20Initial.20skeleton.20for.20Winch.html#300914531">(Sep 26 2022 at 23:19)</a>:</h4>
<p>saulecabrera updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4907">PR #4907</a> from <code>winch-skeleton</code> to <code>main</code>.</p>



<a name="301035162"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234907%20%5BWIP%5D%20Initial%20skeleton%20for%20Winch/near/301035162" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234907.20.5BWIP.5D.20Initial.20skeleton.20for.20Winch.html#301035162">(Sep 27 2022 at 15:22)</a>:</h4>
<p>saulecabrera updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4907">PR #4907</a> from <code>winch-skeleton</code> to <code>main</code>.</p>



<a name="301727715"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234907%20%5BWIP%5D%20Initial%20skeleton%20for%20Winch/near/301727715" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234907.20.5BWIP.5D.20Initial.20skeleton.20for.20Winch.html#301727715">(Sep 30 2022 at 20:19)</a>:</h4>
<p>saulecabrera updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4907">PR #4907</a> from <code>winch-skeleton</code> to <code>main</code>.</p>



<a name="301727760"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234907%20%5BWIP%5D%20Initial%20skeleton%20for%20Winch/near/301727760" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234907.20.5BWIP.5D.20Initial.20skeleton.20for.20Winch.html#301727760">(Sep 30 2022 at 20:19)</a>:</h4>
<p>saulecabrera updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4907">PR #4907</a> from <code>winch-skeleton</code> to <code>main</code>.</p>



<a name="301747993"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234907%20%5BWIP%5D%20Initial%20skeleton%20for%20Winch/near/301747993" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234907.20.5BWIP.5D.20Initial.20skeleton.20for.20Winch.html#301747993">(Sep 30 2022 at 23:05)</a>:</h4>
<p>saulecabrera updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4907">PR #4907</a> from <code>winch-skeleton</code> to <code>main</code>.</p>



<a name="302822024"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234907%20%5BWIP%5D%20Initial%20skeleton%20for%20Winch/near/302822024" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234907.20.5BWIP.5D.20Initial.20skeleton.20for.20Winch.html#302822024">(Oct 07 2022 at 10:42)</a>:</h4>
<p>saulecabrera updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4907">PR #4907</a> from <code>winch-skeleton</code> to <code>main</code>.</p>



<a name="302822190"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234907%20%5BWIP%5D%20Initial%20skeleton%20for%20Winch/near/302822190" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234907.20.5BWIP.5D.20Initial.20skeleton.20for.20Winch.html#302822190">(Oct 07 2022 at 10:43)</a>:</h4>
<p>saulecabrera updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4907">PR #4907</a> from <code>winch-skeleton</code> to <code>main</code>.</p>



<a name="302861642"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234907%20%5BWIP%5D%20Initial%20skeleton%20for%20Winch/near/302861642" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234907.20.5BWIP.5D.20Initial.20skeleton.20for.20Winch.html#302861642">(Oct 07 2022 at 14:16)</a>:</h4>
<p>saulecabrera updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4907">PR #4907</a> from <code>winch-skeleton</code> to <code>main</code>.</p>



<a name="302897770"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234907%20%5BWIP%5D%20Initial%20skeleton%20for%20Winch/near/302897770" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234907.20.5BWIP.5D.20Initial.20skeleton.20for.20Winch.html#302897770">(Oct 07 2022 at 17:11)</a>:</h4>
<p>saulecabrera updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4907">PR #4907</a> from <code>winch-skeleton</code> to <code>main</code>.</p>



<a name="303595123"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234907%20%5BWIP%5D%20Initial%20skeleton%20for%20Winch/near/303595123" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234907.20.5BWIP.5D.20Initial.20skeleton.20for.20Winch.html#303595123">(Oct 12 2022 at 10:01)</a>:</h4>
<p>saulecabrera updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4907">PR #4907</a> from <code>winch-skeleton</code> to <code>main</code>.</p>



<a name="303595214"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234907%20%5BWIP%5D%20Initial%20skeleton%20for%20Winch/near/303595214" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234907.20.5BWIP.5D.20Initial.20skeleton.20for.20Winch.html#303595214">(Oct 12 2022 at 10:02)</a>:</h4>
<p>saulecabrera edited <a href="https://github.com/bytecodealliance/wasmtime/pull/4907">PR #4907</a> from <code>winch-skeleton</code> to <code>main</code>:</p>
<blockquote>
<p>Ref: <a href="https://github.com/bytecodealliance/rfcs/pull/28">https://github.com/bytecodealliance/rfcs/pull/28</a></p>
<hr>
<p>This change introduces the initial skeleton for Winch, the "baseline" compiler.</p>
<p>This skeleton contains mostly setup code for the ISA, ABI, registers, and compilation environment abstractions. It also includes the calculation of function local slots.</p>
<p>As of the first commit, the structure of these abstractions looks like the following:</p>
<div class="codehilite"><pre><span></span><code>                    +------------------------+
                    |                        v
 +----------+     +-----+     +-----------+-----+-----------------+
 | Compiler | --&gt; | ISA | --&gt; | Registers | ABI | Compilation Env |
 +----------+     +-----+     +-----------+-----+-----------------+
                    |                              ^
                    +------------------------------+
</code></pre></div>

<hr>
<p>I'm opening this as a draft, since there are several items that I'd like to finish before continuing to iterate in-tree, namely:</p>
<ul>
<li>[x] Prologue</li>
<li>[ ] Function body with (<strong>debug</strong>) <code>i32.add</code> support</li>
<li>[ ] Epilogue</li>
<li>[ ] Initial skeleton of a (<strong>debug</strong>) Assembler interface</li>
<li>[ ] Increase test coverage and include unit tests in CI</li>
</ul>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;<br>
</p>
</blockquote>



<a name="303595228"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234907%20%5BWIP%5D%20Initial%20skeleton%20for%20Winch/near/303595228" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234907.20.5BWIP.5D.20Initial.20skeleton.20for.20Winch.html#303595228">(Oct 12 2022 at 10:02)</a>:</h4>
<p>saulecabrera edited <a href="https://github.com/bytecodealliance/wasmtime/pull/4907">PR #4907</a> from <code>winch-skeleton</code> to <code>main</code>:</p>
<blockquote>
<p>Ref: <a href="https://github.com/bytecodealliance/rfcs/pull/28">https://github.com/bytecodealliance/rfcs/pull/28</a></p>
<hr>
<p>This change introduces the initial skeleton for Winch, the "baseline" compiler.</p>
<p>This skeleton contains mostly setup code for the ISA, ABI, registers, and compilation environment abstractions. It also includes the calculation of function local slots.</p>
<p>As of the first commit, the structure of these abstractions looks like the following:</p>
<div class="codehilite"><pre><span></span><code>                    +------------------------+
                    |                        v
 +----------+     +-----+     +-----------+-----+-----------------+
 | Compiler | --&gt; | ISA | --&gt; | Registers | ABI | Compilation Env |
 +----------+     +-----+     +-----------+-----+-----------------+
                    |                              ^
                    +------------------------------+
</code></pre></div>

<hr>
<p>I'm opening this as a draft, since there are several items that I'd like to finish before continuing to iterate in-tree, namely:</p>
<ul>
<li>[x] Prologue</li>
<li>[x] Function body with (<strong>debug</strong>) <code>i32.add</code> support</li>
<li>[ ] Epilogue</li>
<li>[ ] Initial skeleton of a (<strong>debug</strong>) Assembler interface</li>
<li>[ ] Increase test coverage and include unit tests in CI</li>
</ul>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;<br>
</p>
</blockquote>



<a name="303595230"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234907%20%5BWIP%5D%20Initial%20skeleton%20for%20Winch/near/303595230" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234907.20.5BWIP.5D.20Initial.20skeleton.20for.20Winch.html#303595230">(Oct 12 2022 at 10:02)</a>:</h4>
<p>saulecabrera edited <a href="https://github.com/bytecodealliance/wasmtime/pull/4907">PR #4907</a> from <code>winch-skeleton</code> to <code>main</code>:</p>
<blockquote>
<p>Ref: <a href="https://github.com/bytecodealliance/rfcs/pull/28">https://github.com/bytecodealliance/rfcs/pull/28</a></p>
<hr>
<p>This change introduces the initial skeleton for Winch, the "baseline" compiler.</p>
<p>This skeleton contains mostly setup code for the ISA, ABI, registers, and compilation environment abstractions. It also includes the calculation of function local slots.</p>
<p>As of the first commit, the structure of these abstractions looks like the following:</p>
<div class="codehilite"><pre><span></span><code>                    +------------------------+
                    |                        v
 +----------+     +-----+     +-----------+-----+-----------------+
 | Compiler | --&gt; | ISA | --&gt; | Registers | ABI | Compilation Env |
 +----------+     +-----+     +-----------+-----+-----------------+
                    |                              ^
                    +------------------------------+
</code></pre></div>

<hr>
<p>I'm opening this as a draft, since there are several items that I'd like to finish before continuing to iterate in-tree, namely:</p>
<ul>
<li>[x] Prologue</li>
<li>[x] Function body with (<strong>debug</strong>) <code>i32.add</code> support</li>
<li>[x] Epilogue</li>
<li>[ ] Initial skeleton of a (<strong>debug</strong>) Assembler interface</li>
<li>[ ] Increase test coverage and include unit tests in CI</li>
</ul>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;<br>
</p>
</blockquote>



<a name="303595233"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234907%20%5BWIP%5D%20Initial%20skeleton%20for%20Winch/near/303595233" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234907.20.5BWIP.5D.20Initial.20skeleton.20for.20Winch.html#303595233">(Oct 12 2022 at 10:02)</a>:</h4>
<p>saulecabrera edited <a href="https://github.com/bytecodealliance/wasmtime/pull/4907">PR #4907</a> from <code>winch-skeleton</code> to <code>main</code>:</p>
<blockquote>
<p>Ref: <a href="https://github.com/bytecodealliance/rfcs/pull/28">https://github.com/bytecodealliance/rfcs/pull/28</a></p>
<hr>
<p>This change introduces the initial skeleton for Winch, the "baseline" compiler.</p>
<p>This skeleton contains mostly setup code for the ISA, ABI, registers, and compilation environment abstractions. It also includes the calculation of function local slots.</p>
<p>As of the first commit, the structure of these abstractions looks like the following:</p>
<div class="codehilite"><pre><span></span><code>                    +------------------------+
                    |                        v
 +----------+     +-----+     +-----------+-----+-----------------+
 | Compiler | --&gt; | ISA | --&gt; | Registers | ABI | Compilation Env |
 +----------+     +-----+     +-----------+-----+-----------------+
                    |                              ^
                    +------------------------------+
</code></pre></div>

<hr>
<p>I'm opening this as a draft, since there are several items that I'd like to finish before continuing to iterate in-tree, namely:</p>
<ul>
<li>[x] Prologue</li>
<li>[x] Function body with (<strong>debug</strong>) <code>i32.add</code> support</li>
<li>[x] Epilogue</li>
<li>[x] Initial skeleton of a (<strong>debug</strong>) Assembler interface</li>
<li>[ ] Increase test coverage and include unit tests in CI</li>
</ul>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;<br>
</p>
</blockquote>



<a name="303595694"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234907%20%5BWIP%5D%20Initial%20skeleton%20for%20Winch/near/303595694" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234907.20.5BWIP.5D.20Initial.20skeleton.20for.20Winch.html#303595694">(Oct 12 2022 at 10:05)</a>:</h4>
<p>saulecabrera updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4907">PR #4907</a> from <code>winch-skeleton</code> to <code>main</code>.</p>



<a name="304591121"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234907%20%5BWIP%5D%20Initial%20skeleton%20for%20Winch/near/304591121" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234907.20.5BWIP.5D.20Initial.20skeleton.20for.20Winch.html#304591121">(Oct 18 2022 at 01:16)</a>:</h4>
<p>saulecabrera updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4907">PR #4907</a> from <code>winch-skeleton</code> to <code>main</code>.</p>



<a name="304591249"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234907%20%5BWIP%5D%20Initial%20skeleton%20for%20Winch/near/304591249" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234907.20.5BWIP.5D.20Initial.20skeleton.20for.20Winch.html#304591249">(Oct 18 2022 at 01:17)</a>:</h4>
<p>saulecabrera edited <a href="https://github.com/bytecodealliance/wasmtime/pull/4907">PR #4907</a> from <code>winch-skeleton</code> to <code>main</code>:</p>
<blockquote>
<p>Ref: <a href="https://github.com/bytecodealliance/rfcs/pull/28">https://github.com/bytecodealliance/rfcs/pull/28</a></p>
<hr>
<p>This change introduces the initial skeleton for Winch, the "baseline" compiler.</p>
<p>This skeleton contains mostly setup code for the ISA, ABI, registers, and compilation environment abstractions. It also includes the calculation of function local slots.</p>
<p>As of the first commit, the structure of these abstractions looks like the following:</p>
<div class="codehilite"><pre><span></span><code>                    +------------------------+
                    |                        v
 +----------+     +-----+     +-----------+-----+-----------------+
 | Compiler | --&gt; | ISA | --&gt; | Registers | ABI | Compilation Env |
 +----------+     +-----+     +-----------+-----+-----------------+
                    |                              ^
                    +------------------------------+
</code></pre></div>

<hr>
<p>I'm opening this as a draft, since there are several items that I'd like to finish before continuing to iterate in-tree, namely:</p>
<ul>
<li>[x] Prologue</li>
<li>[x] Function body with (<strong>debug</strong>) <code>i32.add</code> support</li>
<li>[x] Epilogue</li>
<li>[x] Initial skeleton of a (<strong>debug</strong>) Assembler interface<br>
&lt;!--</li>
</ul>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;<br>
</p>
</blockquote>



<a name="304591385"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234907%20%5BWIP%5D%20Initial%20skeleton%20for%20Winch/near/304591385" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234907.20.5BWIP.5D.20Initial.20skeleton.20for.20Winch.html#304591385">(Oct 18 2022 at 01:19)</a>:</h4>
<p>saulecabrera edited <a href="https://github.com/bytecodealliance/wasmtime/pull/4907">PR #4907</a> from <code>winch-skeleton</code> to <code>main</code>:</p>
<blockquote>
<p>Ref: <a href="https://github.com/bytecodealliance/rfcs/pull/28">https://github.com/bytecodealliance/rfcs/pull/28</a></p>
<hr>
<p>This change introduces the initial skeleton for Winch, the "baseline" compiler.</p>
<p>This skeleton contains mostly setup code for the ISA, ABI, registers, and compilation environment abstractions. It also includes the calculation of function local slots.</p>
<p>As of the first commit, the structure of these abstractions looks like the following:</p>
<div class="codehilite"><pre><span></span><code>                    +------------------------+
                    |                        v
 +----------+     +-----+     +-----------+-----+-----------------+
 | Compiler | --&gt; | ISA | --&gt; | Registers | ABI | Compilation Env |
 +----------+     +-----+     +-----------+-----+-----------------+
                    |                              ^
                    +------------------------------+
</code></pre></div>

<hr>
<p>I'm opening this as a draft, since there are several items that I'd like to finish before continuing to iterate in-tree, namely:</p>
<ul>
<li>[x] Prologue</li>
<li>[x] Function body with (<strong>debug</strong>) <code>i32.add</code>, <code>local.get</code> and <code>local.set</code> support</li>
<li>[x] Epilogue</li>
<li>[x] Initial skeleton of a (<strong>debug</strong>) MacroAssembler and Assembler (x64) interface<br>
&lt;!--</li>
</ul>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;<br>
</p>
</blockquote>



<a name="304595555"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234907%20%5BWIP%5D%20Initial%20skeleton%20for%20Winch/near/304595555" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234907.20.5BWIP.5D.20Initial.20skeleton.20for.20Winch.html#304595555">(Oct 18 2022 at 02:04)</a>:</h4>
<p>saulecabrera edited <a href="https://github.com/bytecodealliance/wasmtime/pull/4907">PR #4907</a> from <code>winch-skeleton</code> to <code>main</code>:</p>
<blockquote>
<p>This change introduces the initial skeleton for Winch, the "baseline" compiler, discussed <a href="https://github.com/bytecodealliance/rfcs/pull/28">https://github.com/bytecodealliance/rfcs/pull/28</a></p>
<p>The skeleton contains the just the necessary code for the main abstractions to support the following:</p>
<ul>
<li>Function prologue and epilogue (excluding stack checks)</li>
<li>Calculation of local slots</li>
<li>An initial pass on a generic MacroAssembler interface</li>
<li>An initial pass on a x64 Assembler</li>
<li>A simple CLI tools to compile WebAssembly programs (<code>crates/winch/src/main.rs</code>)</li>
<li>String based emission for programs that use the following WebAssembly instructions: <code>i32.add</code>, <code>local.get</code>, <code>local.set</code></li>
</ul>
<p>As of this change, the high-level structure of the compiler is as follows:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">      </span><span class="o">+-----------------------+</span><span class="w"></span>
<span class="w">       </span><span class="o">|</span><span class="w">                       </span><span class="o">|</span><span class="w"></span>
<span class="w">       </span><span class="o">|</span><span class="w">  </span><span class="o">+-----------+</span><span class="w">      </span><span class="o">+---------------------+</span><span class="w"></span>
<span class="w">       </span><span class="o">|</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">Compiler</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="o">--</span>-&gt; <span class="o">|</span><span class="w">         </span><span class="n">ISA</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="o">---------------------------------------------------------------+</span><span class="w"></span>
<span class="w">       </span><span class="o">|</span><span class="w">  </span><span class="o">+-----------+</span><span class="w">      </span><span class="o">+---------------------+</span><span class="w">                                                                </span><span class="o">|</span><span class="w"></span>
<span class="w">       </span><span class="o">|</span><span class="w">                       </span><span class="o">|</span><span class="w">                                                                                    </span><span class="o">|</span><span class="w"></span>
<span class="w">       </span><span class="o">|</span><span class="w">                       </span><span class="o">|</span><span class="w">                                                                                    </span><span class="o">|</span><span class="w"></span>
<span class="w">       </span><span class="o">|</span><span class="w">                       </span><span class="n">v</span><span class="w">                                                                                    </span><span class="o">|</span><span class="w"></span>
<span class="w">       </span><span class="o">|</span><span class="w">  </span><span class="o">+-----------+-----+----------------------+</span><span class="w">     </span><span class="o">+----------------+</span><span class="w">     </span><span class="o">+-------+----------------+-------+</span><span class="w">  </span><span class="o">|</span><span class="w"></span>
<span class="w">       </span><span class="o">+&gt;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Registers</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ABI</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="n">CodeGen</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="o">-</span>-&gt; <span class="o">|</span><span class="w"> </span><span class="n">CodeGenContext</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">-</span>-&gt; <span class="o">|</span><span class="w"> </span><span class="n">Frame</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">MacroAssembler</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Stack</span><span class="w"> </span><span class="o">|</span><span class="w">  </span><span class="o">|</span><span class="w"></span>
<span class="w">          </span><span class="o">+-----------+-----+----------------------+</span><span class="w">     </span><span class="o">+----------------+</span><span class="w">     </span><span class="o">+-------+----------------+-------+</span><span class="w">  </span><span class="o">|</span><span class="w"></span>
<span class="w">                         </span><span class="o">^</span><span class="w">     </span><span class="o">|</span><span class="w">                                                                                    </span><span class="o">|</span><span class="w"></span>
<span class="w">                         </span><span class="o">+-----+------------------------------------------------------------------------------------+</span><span class="w"></span>
<span class="w">                               </span><span class="o">|</span><span class="w"></span>
<span class="w">                               </span><span class="o">|</span><span class="w"></span>
<span class="w">                               </span><span class="o">|</span><span class="w"></span>
<span class="w">                               </span><span class="n">v</span><span class="w"></span>
<span class="w">                             </span><span class="o">+---------------------+</span><span class="w"></span>
<span class="w">                             </span><span class="o">|</span><span class="w"> </span><span class="n">Register</span><span class="w"> </span><span class="n">Allocation</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="w">                             </span><span class="o">+---------------------+</span><span class="w"></span>
</code></pre></div>
<hr>
<p><strong>Next steps</strong></p>
<p>As mentioned above, this change doesn't use any of Cranelift's backends for code emission, yet. These are the immediate next steps after landing this change:</p>
<ul>
<li>Extract the relevant Cranelift pieces into the <code>cranelift_asm</code> crate, which will be used by Winch</li>
<li>Swap the string based implementation of the x64 assembler and use the assembler provided by <code>cranelift_asm</code></li>
<li>Add initial support for arm64 through <code>cranelift_asm</code></li>
<li>Increase test coverage</li>
</ul>
<hr>
<p><strong>Misc</strong> </p>
<p>Winch's CLI can be used by running `cargo run -- path/to/file.wat --target=&lt;target&gt;</p>
<p>Here's a set of WebAssembly programs and their corresponding x64 output:<br>
&lt;details&gt;<br>
&lt;summary&gt;Basic i32 add&lt;/summary&gt;</p>
<div class="codehilite" data-code-language="WebAssembly"><pre><span></span><code><span class="p">(</span><span class="k">module</span>
  <span class="p">(</span><span class="k">export</span> <span class="s2">"main"</span> <span class="p">(</span><span class="k">func</span> <span class="nv">$main</span><span class="p">))</span>

  <span class="p">(</span><span class="k">func</span> <span class="nv">$main</span> <span class="p">(</span><span class="k">result</span> <span class="kt">i32</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">i32.const</span> <span class="mi">10</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">i32.const</span> <span class="mi">20</span><span class="p">)</span>
    <span class="nb">i32.add</span><span class="p">)</span>
<span class="p">)</span>
</code></pre></div>
<div class="codehilite" data-code-language="GAS"><pre><span></span><code><span class="nf">push</span><span class="w"> </span><span class="no">rbp</span><span class="w"></span>
<span class="nf">mov</span><span class="w"> </span><span class="no">rbp</span><span class="p">,</span><span class="w"> </span><span class="no">rsp</span><span class="w"></span>
<span class="nf">mov</span><span class="w"> </span><span class="no">eax</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="w"></span>
<span class="nf">add</span><span class="w"> </span><span class="no">eax</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="w"></span>
<span class="nf">pop</span><span class="w"> </span><span class="no">rbp</span><span class="w"></span>
<span class="nf">ret</span><span class="w"></span>
</code></pre></div>
<p>&lt;/details&gt;</p>
<p>&lt;details&gt;<br>
&lt;summary&gt; i32 add with local operators &lt;/summary&gt;</p>
<div class="codehilite" data-code-language="WebAssembly"><pre><span></span><code><span class="p">(</span><span class="k">module</span>
  <span class="p">(</span><span class="k">export</span> <span class="s2">"main"</span> <span class="p">(</span><span class="k">func</span> <span class="nv">$main</span><span class="p">))</span>

  <span class="p">(</span><span class="k">func</span> <span class="nv">$main</span> <span class="p">(</span><span class="k">result</span> <span class="kt">i32</span><span class="p">)</span>
    <span class="p">(</span><span class="k">local</span> <span class="nv">$foo</span> <span class="kt">i32</span><span class="p">)</span>
    <span class="p">(</span><span class="k">local</span> <span class="nv">$bar</span> <span class="kt">i32</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">i32.const</span> <span class="mi">10</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">local.set</span> <span class="nv">$foo</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">i32.const</span> <span class="mi">20</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">local.set</span> <span class="nv">$bar</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">local.get</span> <span class="nv">$foo</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">local.get</span> <span class="nv">$bar</span><span class="p">)</span>
    <span class="nb">i32.add</span>
  <span class="p">)</span>
<span class="p">)</span>
</code></pre></div>
<div class="codehilite" data-code-language="GAS"><pre><span></span><code><span class="nf">push</span><span class="w"> </span><span class="no">rbp</span><span class="w"></span>
<span class="nf">mov</span><span class="w"> </span><span class="no">rbp</span><span class="p">,</span><span class="w"> </span><span class="no">rsp</span><span class="w"></span>
<span class="nf">sub</span><span class="w"> </span><span class="no">rsp</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="w"></span>
<span class="nf">mov</span><span class="w"> </span><span class="no">qword</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="p">],</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="nf">mov</span><span class="w"> </span><span class="no">eax</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="w"></span>
<span class="nf">mov</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="w"> </span><span class="err">+</span><span class="w"> </span><span class="mi">4</span><span class="p">],</span><span class="w"> </span><span class="no">eax</span><span class="w"></span>
<span class="nf">mov</span><span class="w"> </span><span class="no">ecx</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="w"></span>
<span class="nf">mov</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="p">],</span><span class="w"> </span><span class="no">ecx</span><span class="w"></span>
<span class="nf">mov</span><span class="w"> </span><span class="no">eax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="p">]</span><span class="w"></span>
<span class="nf">mov</span><span class="w"> </span><span class="no">edx</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="w"> </span><span class="err">+</span><span class="w"> </span><span class="mi">4</span><span class="p">]</span><span class="w"></span>
<span class="nf">add</span><span class="w"> </span><span class="no">edx</span><span class="p">,</span><span class="w"> </span><span class="no">eax</span><span class="w"></span>
<span class="nf">mov</span><span class="w"> </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="no">rdx</span><span class="w"></span>
<span class="nf">add</span><span class="w"> </span><span class="no">rsp</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="w"></span>
<span class="nf">pop</span><span class="w"> </span><span class="no">rbp</span><span class="w"></span>
<span class="nf">ret</span><span class="w"></span>
</code></pre></div>
<p>&lt;/details&gt;</p>
<p>&lt;details&gt;<br>
&lt;summary&gt;Basic i32 with function arguments &lt;/summary&gt;</p>
<div class="codehilite" data-code-language="WebAssembly"><pre><span></span><code><span class="p">(</span><span class="k">module</span>
  <span class="p">(</span><span class="k">export</span> <span class="s2">"main"</span> <span class="p">(</span><span class="k">func</span> <span class="nv">$main</span><span class="p">))</span>

  <span class="p">(</span><span class="k">func</span> <span class="nv">$main</span> <span class="p">(</span><span class="k">param</span> <span class="kt">i32</span><span class="p">)</span> <span class="p">(</span><span class="k">param</span> <span class="kt">i32</span><span class="p">)</span> <span class="p">(</span><span class="k">result</span> <span class="kt">i32</span><span class="p">)</span>
      <span class="p">(</span><span class="nb">local.get</span> <span class="mi">0</span><span class="p">)</span>
      <span class="p">(</span><span class="nb">local.get</span> <span class="mi">1</span><span class="p">)</span>
      <span class="nb">i32.add</span>
    <span class="p">)</span>
<span class="p">)</span>
</code></pre></div>
<div class="codehilite" data-code-language="GAS"><pre><span></span><code><span class="nf">push</span><span class="w"> </span><span class="no">rbp</span><span class="w"></span>
<span class="nf">mov</span><span class="w"> </span><span class="no">rbp</span><span class="p">,</span><span class="w"> </span><span class="no">rsp</span><span class="w"></span>
<span class="nf">sub</span><span class="w"> </span><span class="no">rsp</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="w"></span>
<span class="nf">mov</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="w"> </span><span class="err">+</span><span class="w"> </span><span class="mi">4</span><span class="p">],</span><span class="w"> </span><span class="no">edi</span><span class="w"></span>
<span class="nf">mov</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="p">],</span><span class="w"> </span><span class="no">esi</span><span class="w"></span>
<span class="nf">mov</span><span class="w"> </span><span class="no">eax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="p">]</span><span class="w"></span>
<span class="nf">mov</span><span class="w"> </span><span class="no">ecx</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="w"> </span><span class="err">+</span><span class="w"> </span><span class="mi">4</span><span class="p">]</span><span class="w"></span>
<span class="nf">add</span><span class="w"> </span><span class="no">ecx</span><span class="p">,</span><span class="w"> </span><span class="no">eax</span><span class="w"></span>
<span class="nf">mov</span><span class="w"> </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="no">rcx</span><span class="w"></span>
<span class="nf">add</span><span class="w"> </span><span class="no">rsp</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="w"></span>
<span class="nf">pop</span><span class="w"> </span><span class="no">rbp</span><span class="w"></span>
<span class="nf">ret</span><span class="w"></span>
</code></pre></div>
<p>&lt;/details&gt;</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</li>
<li>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</li>
<li>[ ] This PR contains test cases, if meaningful.</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the <br>
[message truncated]</li>
</ul>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>