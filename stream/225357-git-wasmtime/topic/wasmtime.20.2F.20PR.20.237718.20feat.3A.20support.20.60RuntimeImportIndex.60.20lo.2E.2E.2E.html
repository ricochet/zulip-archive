<html>
<head><meta charset="utf-8"><title>wasmtime / PR #7718 feat: support `RuntimeImportIndex` lo... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237718.20feat.3A.20support.20.60RuntimeImportIndex.60.20lo.2E.2E.2E.html">wasmtime / PR #7718 feat: support `RuntimeImportIndex` lo...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="409424037"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237718%20feat%3A%20support%20%60RuntimeImportIndex%60%20lo.../near/409424037" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237718.20feat.3A.20support.20.60RuntimeImportIndex.60.20lo.2E.2E.2E.html#409424037">(Dec 21 2023 at 16:32)</a>:</h4>
<p>rvolosatovs opened <a href="https://github.com/bytecodealliance/wasmtime/pull/7718">PR #7718</a> from <code>rvolosatovs:feat/dynamic-resources-by-path</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>Follow-up on #7688<br>
Closes #7714 </p>
</blockquote>



<a name="409427037"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237718%20feat%3A%20support%20%60RuntimeImportIndex%60%20lo.../near/409427037" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237718.20feat.3A.20support.20.60RuntimeImportIndex.60.20lo.2E.2E.2E.html#409427037">(Dec 21 2023 at 16:48)</a>:</h4>
<p>rvolosatovs updated <a href="https://github.com/bytecodealliance/wasmtime/pull/7718">PR #7718</a>.</p>



<a name="409454446"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237718%20feat%3A%20support%20%60RuntimeImportIndex%60%20lo.../near/409454446" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237718.20feat.3A.20support.20.60RuntimeImportIndex.60.20lo.2E.2E.2E.html#409454446">(Dec 21 2023 at 19:44)</a>:</h4>
<p>github-actions[bot] <a href="https://github.com/bytecodealliance/wasmtime/pull/7718#issuecomment-1866839848">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/7718">PR #7718</a>:</p>
<blockquote>
<h4>Subscribe to Label Action</h4>
<p>cc @peterhuene</p>
<p>&lt;details&gt;<br>
This issue or pull request has been labeled: "wasmtime:api"</p>
<p>Thus the following users have been cc'd because of the following labels:</p>
<ul>
<li>peterhuene: wasmtime:api</li>
</ul>
<p>To subscribe or unsubscribe from this label, edit the &lt;code&gt;.github/subscribe-to-label.json&lt;/code&gt; configuration file.</p>
<p><a href="https://github.com/bytecodealliance/subscribe-to-label-action">Learn more.</a><br>
&lt;/details&gt;</p>
</blockquote>



<a name="409586609"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237718%20feat%3A%20support%20%60RuntimeImportIndex%60%20lo.../near/409586609" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237718.20feat.3A.20support.20.60RuntimeImportIndex.60.20lo.2E.2E.2E.html#409586609">(Dec 22 2023 at 13:57)</a>:</h4>
<p>rvolosatovs updated <a href="https://github.com/bytecodealliance/wasmtime/pull/7718">PR #7718</a>.</p>



<a name="409586853"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237718%20feat%3A%20support%20%60RuntimeImportIndex%60%20lo.../near/409586853" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237718.20feat.3A.20support.20.60RuntimeImportIndex.60.20lo.2E.2E.2E.html#409586853">(Dec 22 2023 at 13:59)</a>:</h4>
<p>rvolosatovs edited <a href="https://github.com/bytecodealliance/wasmtime/pull/7718">PR #7718</a>:</p>
<blockquote>
<p>Follow-up on #7688<br>
Closes #7714 </p>
<p>Just <a href="https://github.com/bytecodealliance/wasmtime/pull/7718/commits/3680ff4c32d06fba7c43e27ab2030bf32927b116">https://github.com/bytecodealliance/wasmtime/pull/7718/commits/3680ff4c32d06fba7c43e27ab2030bf32927b116</a> relevant here</p>
</blockquote>



<a name="410904766"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237718%20feat%3A%20support%20%60RuntimeImportIndex%60%20lo.../near/410904766" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237718.20feat.3A.20support.20.60RuntimeImportIndex.60.20lo.2E.2E.2E.html#410904766">(Jan 02 2024 at 20:58)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/7718#issuecomment-1874550607">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/7718">PR #7718</a>:</p>
<blockquote>
<p>I personally fall on the conservative side of API design, so my knee-jerk reaction is to not include something like this. Could you expand a bit more on the motivation, however?</p>
</blockquote>



<a name="411730859"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237718%20feat%3A%20support%20%60RuntimeImportIndex%60%20lo.../near/411730859" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237718.20feat.3A.20support.20.60RuntimeImportIndex.60.20lo.2E.2E.2E.html#411730859">(Jan 08 2024 at 12:40)</a>:</h4>
<p>rvolosatovs <a href="https://github.com/bytecodealliance/wasmtime/pull/7718#issuecomment-1880933285">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/7718">PR #7718</a>:</p>
<blockquote>
<blockquote>
<p>I personally fall on the conservative side of API design, so my knee-jerk reaction is to not include something like this. Could you expand a bit more on the motivation, however?</p>
</blockquote>
<p>Sure, this is primarily to address <a href="https://github.com/bytecodealliance/wasmtime/issues/7714">https://github.com/bytecodealliance/wasmtime/issues/7714</a> and potentially help with <a href="https://github.com/bytecodealliance/wasmtime/issues/7726">https://github.com/bytecodealliance/wasmtime/issues/7726</a>.<br>
Most important reason for this to exist is that the embedder may not necessarily be directly calling e.g. <code>Linker::resource</code> and therefore may not have the <code>ResourceImportIndex</code> associated with it - this is the case today, for example, for any resources added to the linker via generated <code>add_to_linker</code> from bindgen. To address this <code>add_to_linker</code> would need to return a mapping of resource type import paths (expressed as strings, generated statically-typed structs or otherwise) to their respective import indexes. The intention of this change is therefore to:</p>
<ul>
<li>Serve as a opt-in simple solution for use cases where initial linking performance is not a bottleneck/not critical and/or implementation simplicity and readability are more important - this is also relevant for prototyping.</li>
<li>While a more performant solution (hooking into the bindgen, I suppose) is built, unblock WASI resource <code>ResourceAny</code> conversion.</li>
<li>(in the general case) Provide for use cases where the <code>Linker::resource</code> calls are wrapped in an external API. (in case that Wasmtime WASI implementation is updated to expose the mapping somehow, third parties may still provide APIs wrapping <code>Linker::resource</code> without exposing the indexes and lack of path-based lookups, even if less performant than they could otherwise be, would block users from benefiting from those said APIs)</li>
</ul>
</blockquote>



<a name="411730895"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237718%20feat%3A%20support%20%60RuntimeImportIndex%60%20lo.../near/411730895" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237718.20feat.3A.20support.20.60RuntimeImportIndex.60.20lo.2E.2E.2E.html#411730895">(Jan 08 2024 at 12:41)</a>:</h4>
<p>rvolosatovs updated <a href="https://github.com/bytecodealliance/wasmtime/pull/7718">PR #7718</a>.</p>



<a name="411731060"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237718%20feat%3A%20support%20%60RuntimeImportIndex%60%20lo.../near/411731060" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237718.20feat.3A.20support.20.60RuntimeImportIndex.60.20lo.2E.2E.2E.html#411731060">(Jan 08 2024 at 12:42)</a>:</h4>
<p>rvolosatovs edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/7718#issuecomment-1880933285">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/7718">PR #7718</a>:</p>
<blockquote>
<blockquote>
<p>I personally fall on the conservative side of API design, so my knee-jerk reaction is to not include something like this. Could you expand a bit more on the motivation, however?</p>
</blockquote>
<p>Sure, this is primarily to address <a href="https://github.com/bytecodealliance/wasmtime/issues/7714">https://github.com/bytecodealliance/wasmtime/issues/7714</a> and potentially help with <a href="https://github.com/bytecodealliance/wasmtime/issues/7726">https://github.com/bytecodealliance/wasmtime/issues/7726</a>.<br>
Most important reason for this to exist is that the embedder may not necessarily be directly calling e.g. <code>Linker::resource</code> and therefore may not have the <code>ResourceImportIndex</code> associated with it - this is the case today, for example, for any resources added to the linker via generated <code>add_to_linker</code> from bindgen. To address this <code>add_to_linker</code> would need to return a mapping of resource type import paths (expressed as strings, generated statically-typed structs or otherwise) to their respective import indexes. The intention of this change is therefore to:</p>
<ul>
<li>Serve as a opt-in simple solution for use cases where initial linking performance is not a bottleneck/not critical and/or implementation simplicity and readability are more important - for example, it's very relevant for rapid prototyping.</li>
<li>While a more performant solution (hooking into the bindgen, I suppose) is built, unblock WASI resource <code>ResourceAny</code> conversion.</li>
<li>(in the general case) Provide for use cases where the <code>Linker::resource</code> calls are wrapped in an external API. (in case that Wasmtime WASI implementation is updated to expose the mapping somehow, third parties may still provide APIs wrapping <code>Linker::resource</code> without exposing the indexes and lack of path-based lookups, even if less performant than they could otherwise be, would block users from benefiting from those said APIs)</li>
</ul>
</blockquote>



<a name="411731705"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237718%20feat%3A%20support%20%60RuntimeImportIndex%60%20lo.../near/411731705" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237718.20feat.3A.20support.20.60RuntimeImportIndex.60.20lo.2E.2E.2E.html#411731705">(Jan 08 2024 at 12:46)</a>:</h4>
<p>rvolosatovs edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/7718#issuecomment-1880933285">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/7718">PR #7718</a>:</p>
<blockquote>
<blockquote>
<p>I personally fall on the conservative side of API design, so my knee-jerk reaction is to not include something like this. Could you expand a bit more on the motivation, however?</p>
</blockquote>
<p>Sure, this is primarily to address <a href="https://github.com/bytecodealliance/wasmtime/issues/7714">https://github.com/bytecodealliance/wasmtime/issues/7714</a> and potentially help with <a href="https://github.com/bytecodealliance/wasmtime/issues/7726">https://github.com/bytecodealliance/wasmtime/issues/7726</a>.<br>
Most important reason for this to exist is that the embedder may not necessarily be directly calling e.g. <code>Linker::resource</code> and therefore may not have the <code>ResourceImportIndex</code> associated with it - this is the case today, for example, for any resources added to the linker via generated <code>add_to_linker</code> from bindgen. To address this <code>add_to_linker</code> would need to return a mapping of resource type import paths (expressed as strings, generated statically-typed structs or otherwise) to their respective import indexes. The intention of this change is therefore to:</p>
<ul>
<li>Serve as a opt-in simple solution for use cases where initial linking performance is not a bottleneck/not critical and/or implementation simplicity and readability are more important - for example, it's very relevant for rapid prototyping.</li>
<li>While a more performant solution (hooking into the bindgen, I suppose) is built, unblock WASI resource <code>ResourceAny</code> conversion.</li>
<li>(in the general case) Provide for use cases where the <code>Linker::resource</code> calls are wrapped in an external API. (in case that Wasmtime WASI implementation is updated to expose the mapping somehow, third parties may still provide APIs wrapping <code>Linker::resource</code> without exposing the indexes and lack of path-based lookups, even if less performant than they could otherwise be, would block users from benefiting from those said APIs)</li>
</ul>
<p>Short term, by far the most important aspect of this for me is unblocking the "WASI resource -&gt; <code>ResourceAny</code>"conversion (#7714) without the need for manual reimplementation of <code>add_to_linker</code> for all interfaces containing resources. Perhaps you have another idea how this can be solved?</p>
<p>Note that one potential compromise here, which could assist with the string lookup performance penalty, could be introducing a "cell" type, which could store the initial lookup result (originally proposed by @fitzgen in a very brief chat about this topic)</p>
</blockquote>



<a name="411731932"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237718%20feat%3A%20support%20%60RuntimeImportIndex%60%20lo.../near/411731932" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237718.20feat.3A.20support.20.60RuntimeImportIndex.60.20lo.2E.2E.2E.html#411731932">(Jan 08 2024 at 12:48)</a>:</h4>
<p>rvolosatovs edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/7718#issuecomment-1880933285">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/7718">PR #7718</a>:</p>
<blockquote>
<blockquote>
<p>I personally fall on the conservative side of API design, so my knee-jerk reaction is to not include something like this. Could you expand a bit more on the motivation, however?</p>
</blockquote>
<p>Sure, this is primarily to address <a href="https://github.com/bytecodealliance/wasmtime/issues/7714">https://github.com/bytecodealliance/wasmtime/issues/7714</a> and potentially help with <a href="https://github.com/bytecodealliance/wasmtime/issues/7726">https://github.com/bytecodealliance/wasmtime/issues/7726</a>.<br>
Most important reason for this to exist is that the embedder may not necessarily be directly calling e.g. <code>Linker::resource</code> and therefore may not have the <code>ResourceImportIndex</code> associated with it - this is the case today, for example, for any resources added to the linker via generated <code>add_to_linker</code> from bindgen. To address this <code>add_to_linker</code> would need to return a mapping of resource type import paths (expressed as strings, generated statically-typed structs or otherwise) to their respective import indexes. The intention of this change is therefore to:</p>
<ul>
<li>Serve as a opt-in simple solution for use cases where initial linking performance is not a bottleneck/not critical and/or implementation simplicity and readability are more important - for example, it's very relevant for rapid prototyping.</li>
<li>While a more performant solution (hooking into the bindgen, I suppose) is built, unblock WASI resource <code>ResourceAny</code> conversion.</li>
<li>(in the general case) Provide for use cases where the <code>Linker::resource</code> calls are wrapped in an external API. (in case that Wasmtime WASI implementation is updated to expose the mapping somehow, third parties may still provide APIs wrapping <code>Linker::resource</code> without exposing the indexes and lack of path-based lookups, even if less performant than they could otherwise be, would block users from benefiting from those said APIs)</li>
</ul>
<p>Short term, by far the most important aspect of this for me is unblocking the "WASI resource -&gt; <code>ResourceAny</code>"conversion (#7714) without the need for manual reimplementation of <code>add_to_linker</code> for all interfaces containing resources. Perhaps you have another idea how this can be solved?</p>
<p>Note that one potential compromise here, which could assist with the string lookup performance penalty, could be introducing a "cell" type, which could store the initial lookup result (originally proposed by @fitzgen in a very brief chat about this topic)</p>
<p>I suspect this we will end up in a very similar situation here working on #7726</p>
</blockquote>



<a name="411732074"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237718%20feat%3A%20support%20%60RuntimeImportIndex%60%20lo.../near/411732074" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237718.20feat.3A.20support.20.60RuntimeImportIndex.60.20lo.2E.2E.2E.html#411732074">(Jan 08 2024 at 12:49)</a>:</h4>
<p>rvolosatovs edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/7718#issuecomment-1880933285">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/7718">PR #7718</a>:</p>
<blockquote>
<blockquote>
<p>I personally fall on the conservative side of API design, so my knee-jerk reaction is to not include something like this. Could you expand a bit more on the motivation, however?</p>
</blockquote>
<p>Sure, this is primarily to address <a href="https://github.com/bytecodealliance/wasmtime/issues/7714">https://github.com/bytecodealliance/wasmtime/issues/7714</a> and potentially help with <a href="https://github.com/bytecodealliance/wasmtime/issues/7726">https://github.com/bytecodealliance/wasmtime/issues/7726</a>.<br>
Most important reason for this to exist is that the embedder may not necessarily be directly calling e.g. <code>Linker::resource</code> and therefore may not have the <code>ResourceImportIndex</code> associated with it - this is the case today, for example, for any resources added to the linker via generated <code>add_to_linker</code> from bindgen. To address this <code>add_to_linker</code> would need to return a mapping of resource type import paths (expressed as strings, generated statically-typed structs or otherwise) to their respective import indexes. The intention of this change is therefore to:</p>
<ul>
<li>Serve as a opt-in simple solution for use cases where initial linking performance is not a bottleneck/not critical and/or implementation simplicity and readability are more important - for example, it's very relevant for rapid prototyping.</li>
<li>While a more performant solution (hooking into the bindgen, I suppose) is built, unblock WASI resource <code>ResourceAny</code> conversion. (#7714)</li>
<li>(in the general case) Provide for use cases where the <code>Linker::resource</code> calls are wrapped in an external API. (in case that Wasmtime WASI implementation is updated to expose the mapping somehow, third parties may still provide APIs wrapping <code>Linker::resource</code> without exposing the indexes and lack of path-based lookups, even if less performant than they could otherwise be, would block users from benefiting from those said APIs)</li>
</ul>
<p>Short term, by far the most important aspect of this for me is unblocking the "WASI resource -&gt; <code>ResourceAny</code>"conversion (#7714) without the need for manual reimplementation of <code>add_to_linker</code> for all interfaces containing resources. Perhaps you have another idea how this can be solved?</p>
<p>Note that one potential compromise here, which could assist with the string lookup performance penalty, could be introducing a "cell" type, which could store the initial lookup result (originally proposed by @fitzgen in a very brief chat about this topic)</p>
<p>I suspect this we will end up in a very similar situation here working on #7726</p>
</blockquote>



<a name="411732350"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237718%20feat%3A%20support%20%60RuntimeImportIndex%60%20lo.../near/411732350" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237718.20feat.3A.20support.20.60RuntimeImportIndex.60.20lo.2E.2E.2E.html#411732350">(Jan 08 2024 at 12:50)</a>:</h4>
<p><strong>rvolosatovs</strong> has marked <a href="https://github.com/bytecodealliance/wasmtime/pull/7718">PR #7718</a> as ready for review.</p>



<a name="411732352"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237718%20feat%3A%20support%20%60RuntimeImportIndex%60%20lo.../near/411732352" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237718.20feat.3A.20support.20.60RuntimeImportIndex.60.20lo.2E.2E.2E.html#411732352">(Jan 08 2024 at 12:50)</a>:</h4>
<p><strong>rvolosatovs</strong> requested <a href="https://github.com/fitzgen">fitzgen</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/7718">PR #7718</a>.</p>



<a name="411732355"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237718%20feat%3A%20support%20%60RuntimeImportIndex%60%20lo.../near/411732355" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237718.20feat.3A.20support.20.60RuntimeImportIndex.60.20lo.2E.2E.2E.html#411732355">(Jan 08 2024 at 12:50)</a>:</h4>
<p><strong>rvolosatovs</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/7718">PR #7718</a>.</p>



<a name="411732676"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237718%20feat%3A%20support%20%60RuntimeImportIndex%60%20lo.../near/411732676" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237718.20feat.3A.20support.20.60RuntimeImportIndex.60.20lo.2E.2E.2E.html#411732676">(Jan 08 2024 at 12:52)</a>:</h4>
<p>rvolosatovs edited <a href="https://github.com/bytecodealliance/wasmtime/pull/7718">PR #7718</a>:</p>
<blockquote>
<p>Follow-up on #7688<br>
Closes #7714 </p>
</blockquote>



<a name="411732744"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237718%20feat%3A%20support%20%60RuntimeImportIndex%60%20lo.../near/411732744" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237718.20feat.3A.20support.20.60RuntimeImportIndex.60.20lo.2E.2E.2E.html#411732744">(Jan 08 2024 at 12:53)</a>:</h4>
<p>rvolosatovs edited <a href="https://github.com/bytecodealliance/wasmtime/pull/7718">PR #7718</a>:</p>
<blockquote>
<p>Follow-up on #7688<br>
Closes #7714 (a more performant solution should probably exist, but this addressed the immediate issue)</p>
</blockquote>



<a name="411732785"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237718%20feat%3A%20support%20%60RuntimeImportIndex%60%20lo.../near/411732785" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237718.20feat.3A.20support.20.60RuntimeImportIndex.60.20lo.2E.2E.2E.html#411732785">(Jan 08 2024 at 12:53)</a>:</h4>
<p>rvolosatovs edited <a href="https://github.com/bytecodealliance/wasmtime/pull/7718">PR #7718</a>:</p>
<blockquote>
<p>Follow-up on #7688<br>
Closes #7714 (a more performant solution should probably exist, but this addresses the immediate issue)</p>
</blockquote>



<a name="411771670"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237718%20feat%3A%20support%20%60RuntimeImportIndex%60%20lo.../near/411771670" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237718.20feat.3A.20support.20.60RuntimeImportIndex.60.20lo.2E.2E.2E.html#411771670">(Jan 08 2024 at 16:22)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/7718#issuecomment-1881403344">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/7718">PR #7718</a>:</p>
<blockquote>
<p>Thanks for expanding! What you're saying makes sense and give me a better understanding as to the pieces here.</p>
<p>I'd be inclined to go the route of #7714 first, however. This PR is exposing yet-more-details about the internal representation of components which otherwise needs documentation (e.g. the doc blocks here don't really explain anything about the deeper meaning of the constructs here). For example:</p>
<ul>
<li>Currently <code>RuntimeImportIndex</code> is a "private" type which is just an implementation detail of Wasmtime. This is exporting it to the public interface without explaining what it means or represents. Under the hood it's sort of an irrelevant implementation detail to embedders where it happens to be the specific order of arguments being passed to the component and it can be used to lookup the runtime type used for a particular import.</li>
<li>Additionally the concept of a "path" for an import is introduced here in the public API. The <code>Linker</code> for example does not operate on this and instead works with instances.</li>
</ul>
<p>I understand that this is an "easy" PR but that's typically how these things go. Wasmtime doesn't implement the real feature here (#7714) so it's easier to basically make more things <code>pub</code> than to implement the real feature. The cost of this though is maintenance over time. These APIs will need to be documented and maintained and kept in sync with all other component-related APIs. Additionally the runtime functionality would need to be preserved here across refactorings of Wasmtime's internals and all that.</p>
<p>More-or-less I understand that this is an easy PR and gets the job done, but if you're ok I'd prefer to go down the route of #7714 first to avoid adding two more concepts to the component embedding API (runtime import indices and import paths). If it's necessary to add them then it's necessary but if possible I'd prefer to avoid adding them since the embedding API is already quite complicated.</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>