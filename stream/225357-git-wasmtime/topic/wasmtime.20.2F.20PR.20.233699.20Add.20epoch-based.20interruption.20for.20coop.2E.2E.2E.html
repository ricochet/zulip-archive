<html>
<head><meta charset="utf-8"><title>wasmtime / PR #3699 Add epoch-based interruption for coop... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233699.20Add.20epoch-based.20interruption.20for.20coop.2E.2E.2E.html">wasmtime / PR #3699 Add epoch-based interruption for coop...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="268481657"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233699%20Add%20epoch-based%20interruption%20for%20coop.../near/268481657" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233699.20Add.20epoch-based.20interruption.20for.20coop.2E.2E.2E.html#268481657">(Jan 19 2022 at 01:36)</a>:</h4>
<p>cfallin opened <a href="https://github.com/bytecodealliance/wasmtime/pull/3699">PR #3699</a> from <code>epoch-interruption</code> to <code>main</code>:</p>
<blockquote>
<p>(Builds on #3698)</p>
<p>This PR introduces a new way of performing cooperative timeslicing that<br>
is intended to replace the "fuel" mechanism. The tradeoff is that this<br>
mechanism interrupts with less precision: not at deterministic points<br>
where fuel runs out, but rather when the Engine enters a new epoch. The<br>
generated code instrumentation is substantially faster, however, because<br>
it does not need to do as much work as when tracking fuel; it only loads<br>
the global "epoch counter" and does a compare-and-branch at backedges<br>
and function prologues.</p>
<p>This change has been measured as ~twice as fast as fuel-based<br>
timeslicing for some workloads, especially control-flow-intensive<br>
workloads such as the SpiderMonkey JS interpreter on Wasm/WASI.</p>
<p>The intended interface is that the embedder of the <code>Engine</code> performs an<br>
<code>engine.increment_epoch()</code> call periodically, e.g. once per millisecond.<br>
An async invocation of a Wasm guest on a <code>Store</code> can specify a number of<br>
epoch-ticks that are allowed before an async yield back to the<br>
executor's event loop. (The initial amount and automatic "refills" are<br>
configured on the <code>Store</code>, just as for fuel.) This call does only<br>
signal-safe work (it increments an <code>AtomicU64</code>) so could be invoked from<br>
a periodic signal, or from a thread that wakes up once per period.</p>
</blockquote>



<a name="268481663"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233699%20Add%20epoch-based%20interruption%20for%20coop.../near/268481663" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233699.20Add.20epoch-based.20interruption.20for.20coop.2E.2E.2E.html#268481663">(Jan 19 2022 at 01:36)</a>:</h4>
<p><strong>cfallin</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/3699">PR #3699</a>.</p>



<a name="268558608"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233699%20Add%20epoch-based%20interruption%20for%20coop.../near/268558608" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233699.20Add.20epoch-based.20interruption.20for.20coop.2E.2E.2E.html#268558608">(Jan 19 2022 at 15:48)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3699#pullrequestreview-856957403">PR review</a>.</p>



<a name="268558609"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233699%20Add%20epoch-based%20interruption%20for%20coop.../near/268558609" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233699.20Add.20epoch-based.20interruption.20for.20coop.2E.2E.2E.html#268558609">(Jan 19 2022 at 15:48)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3699#pullrequestreview-856957403">PR review</a>.</p>



<a name="268558610"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233699%20Add%20epoch-based%20interruption%20for%20coop.../near/268558610" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233699.20Add.20epoch-based.20interruption.20for.20coop.2E.2E.2E.html#268558610">(Jan 19 2022 at 15:48)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/3699#discussion_r787864527">PR review comment</a>:</p>
<blockquote>
<p>I don't think that the result here can be ignored and the result should be plumbed back the wasmtime-runtime, the meaning of the <code>Trap</code> is that, during the yield, the future was dropped so this wasm module needs to be cleaned up ASAP which basically means raising a trap to get back to the base of the stack.</p>
</blockquote>



<a name="268558611"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233699%20Add%20epoch-based%20interruption%20for%20coop.../near/268558611" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233699.20Add.20epoch-based.20interruption.20for.20coop.2E.2E.2E.html#268558611">(Jan 19 2022 at 15:48)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/3699#discussion_r787865284">PR review comment</a>:</p>
<blockquote>
<p>I think it might be good to have a configuration mode where, like for fuel, an epoch also has the ability to raise a trap, basically as a form of interruption. This would enable us later to remove the current interruption mechanism which is subsequently redundant.</p>
</blockquote>



<a name="268558612"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233699%20Add%20epoch-based%20interruption%20for%20coop.../near/268558612" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233699.20Add.20epoch-based.20interruption.20for.20coop.2E.2E.2E.html#268558612">(Jan 19 2022 at 15:48)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/3699#discussion_r787867940">PR review comment</a>:</p>
<blockquote>
<p>Could this comment how the deadline is store-local and not operated on by other threads so the <code>unsafe</code> here should be ok? Also that this value is cached by compiled code on the stack but it's reloaded before any new epoch is entered.</p>
</blockquote>



<a name="268558613"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233699%20Add%20epoch-based%20interruption%20for%20coop.../near/268558613" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233699.20Add.20epoch-based.20interruption.20for.20coop.2E.2E.2E.html#268558613">(Jan 19 2022 at 15:48)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/3699#discussion_r787865991">PR review comment</a>:</p>
<blockquote>
<p>There's a <code>#[doc(cfg(...))]</code> incantation which is used elsewhere in Wasmtime which makes thte requirement for this feature show up in the documentation, could that be used here as well?</p>
</blockquote>



<a name="268558615"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233699%20Add%20epoch-based%20interruption%20for%20coop.../near/268558615" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233699.20Add.20epoch-based.20interruption.20for.20coop.2E.2E.2E.html#268558615">(Jan 19 2022 at 15:48)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/3699#discussion_r787876278">PR review comment</a>:</p>
<blockquote>
<p>Ideally we'll have one location for documenting epochs, what they're used for, and perhaps an example or two as well. I think that this <code>Config</code> method may be one of the better places to put the user-facing documentation. Ideally we'd have some sort of book chapter on all the methods of interrupting executing WebAssembly but for now I think <code>Config</code> methods will suffice. Could this get filled in with more high-level details and get an example?</p>
<p>(or really as long as the "canonical documentation" for epochs is in one place and everywhere else refers to that I think it's ok. I'm not sure this is something we've otherwise been diligent or great about with fuel or other various mechanisms implemented by Wasmtime)</p>
</blockquote>



<a name="268558616"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233699%20Add%20epoch-based%20interruption%20for%20coop.../near/268558616" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233699.20Add.20epoch-based.20interruption.20for.20coop.2E.2E.2E.html#268558616">(Jan 19 2022 at 15:48)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/3699#discussion_r787881225">PR review comment</a>:</p>
<blockquote>
<p>I think it'd be good to add a few more tests for epochs such as:</p>
<ul>
<li>Infinite loops can be interrupted from another thread</li>
<li>Function entries can be interrupted from another thread (I think fuel has this test?)</li>
<li>Something which exercises the double-check block, such as a function which calls another which changes the epoch but only one yield happens instead of multiple as it returns back up the stack or otherwise hits other functions.</li>
<li>Dropping an in-progress future which is yielded on an epoch doesn't execute any further wasm.</li>
<li>Initially a store's epoch deadline is zero and a yield immediately happens<br>
</li>
</ul>
</blockquote>



<a name="268558617"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233699%20Add%20epoch-based%20interruption%20for%20coop.../near/268558617" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233699.20Add.20epoch-based.20interruption.20for.20coop.2E.2E.2E.html#268558617">(Jan 19 2022 at 15:48)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/3699#discussion_r787873747">PR review comment</a>:</p>
<blockquote>
<p>Could this link to the <code>Config</code> documentation for epochs?</p>
</blockquote>



<a name="268558618"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233699%20Add%20epoch-based%20interruption%20for%20coop.../near/268558618" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233699.20Add.20epoch-based.20interruption.20for.20coop.2E.2E.2E.html#268558618">(Jan 19 2022 at 15:48)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/3699#discussion_r787873440">PR review comment</a>:</p>
<blockquote>
<p>Could the documentation here elaborate on how the delta provided is added to the current engine-configured epoch and that's the new deadline?</p>
<p>Also could this link to the <code>Config</code> documentation for epochs?</p>
</blockquote>



<a name="268558619"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233699%20Add%20epoch-based%20interruption%20for%20coop.../near/268558619" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233699.20Add.20epoch-based.20interruption.20for.20coop.2E.2E.2E.html#268558619">(Jan 19 2022 at 15:48)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/3699#discussion_r787872235">PR review comment</a>:</p>
<blockquote>
<p>The naming here and with <code>refill_epoch_deadline</code> is a little confusing to me, perhaps something like:</p>
<ul>
<li><code>set_epoch_yield_delta</code> - for this function</li>
<li><code>set_epoch</code> - the below function</li>
</ul>
<p>and along the lines of a different comment if <code>set_epoch</code> is called (which should be available without the <code>async</code> feature I think) and <code>set_epoch_yield_delta</code> isn't called then we can trap on the first epoch change)</p>
</blockquote>



<a name="268558620"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233699%20Add%20epoch-based%20interruption%20for%20coop.../near/268558620" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233699.20Add.20epoch-based.20interruption.20for.20coop.2E.2E.2E.html#268558620">(Jan 19 2022 at 15:48)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/3699#discussion_r787877049">PR review comment</a>:</p>
<blockquote>
<p>Could this use <code>$foo</code> for names of functions?</p>
</blockquote>



<a name="268558621"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233699%20Add%20epoch-based%20interruption%20for%20coop.../near/268558621" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233699.20Add.20epoch-based.20interruption.20for.20coop.2E.2E.2E.html#268558621">(Jan 19 2022 at 15:48)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/3699#discussion_r787881926">PR review comment</a>:</p>
<blockquote>
<p>Can this be passed as an <code>Option</code> instead of 0-or-nonzero?</p>
<p>Also can the documentation for this function be updated to indicate that might be used for non-fuel-based-scenarios? (perhaps renaming the function as well)</p>
</blockquote>



<a name="268558622"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233699%20Add%20epoch-based%20interruption%20for%20coop.../near/268558622" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233699.20Add.20epoch-based.20interruption.20for.20coop.2E.2E.2E.html#268558622">(Jan 19 2022 at 15:48)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/3699#discussion_r787882669">PR review comment</a>:</p>
<blockquote>
<p>One idea perhaps is for <code>new_epoch</code> to return the new epoch so a reload doesn't have to happen afterwards to cut down on the code size slightly.</p>
</blockquote>



<a name="268558623"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233699%20Add%20epoch-based%20interruption%20for%20coop.../near/268558623" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233699.20Add.20epoch-based.20interruption.20for.20coop.2E.2E.2E.html#268558623">(Jan 19 2022 at 15:48)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/3699#discussion_r787884519">PR review comment</a>:</p>
<blockquote>
<p>Would you be able to experiment with saving this value into an <code>ir::Variable</code> to avoid having to reload it?</p>
</blockquote>



<a name="268558624"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233699%20Add%20epoch-based%20interruption%20for%20coop.../near/268558624" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233699.20Add.20epoch-based.20interruption.20for.20coop.2E.2E.2E.html#268558624">(Jan 19 2022 at 15:48)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/3699#discussion_r787883416">PR review comment</a>:</p>
<blockquote>
<p>Would you be able to perform a quick check to get a gut feeling on the compiled code size overhead of epoch checks vs fuel checks?</p>
</blockquote>



<a name="268631327"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233699%20Add%20epoch-based%20interruption%20for%20coop.../near/268631327" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233699.20Add.20epoch-based.20interruption.20for.20coop.2E.2E.2E.html#268631327">(Jan 20 2022 at 02:07)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3699">PR #3699</a> from <code>epoch-interruption</code> to <code>main</code>.</p>



<a name="268631349"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233699%20Add%20epoch-based%20interruption%20for%20coop.../near/268631349" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233699.20Add.20epoch-based.20interruption.20for.20coop.2E.2E.2E.html#268631349">(Jan 20 2022 at 02:07)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3699#pullrequestreview-857564409">PR review</a>.</p>



<a name="268631350"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233699%20Add%20epoch-based%20interruption%20for%20coop.../near/268631350" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233699.20Add.20epoch-based.20interruption.20for.20coop.2E.2E.2E.html#268631350">(Jan 20 2022 at 02:07)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/3699#discussion_r788292897">PR review comment</a>:</p>
<blockquote>
<p>Fixed, thanks! This now has the trap-or-refill configurable behavior that fuel does as well.</p>
</blockquote>



<a name="268631366"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233699%20Add%20epoch-based%20interruption%20for%20coop.../near/268631366" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233699.20Add.20epoch-based.20interruption.20for.20coop.2E.2E.2E.html#268631366">(Jan 20 2022 at 02:07)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3699#pullrequestreview-857564533">PR review</a>.</p>



<a name="268631367"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233699%20Add%20epoch-based%20interruption%20for%20coop.../near/268631367" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233699.20Add.20epoch-based.20interruption.20for.20coop.2E.2E.2E.html#268631367">(Jan 20 2022 at 02:07)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/3699#discussion_r788292997">PR review comment</a>:</p>
<blockquote>
<p>Nice, had no idea about this -- added!</p>
</blockquote>



<a name="268631413"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233699%20Add%20epoch-based%20interruption%20for%20coop.../near/268631413" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233699.20Add.20epoch-based.20interruption.20for.20coop.2E.2E.2E.html#268631413">(Jan 20 2022 at 02:08)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3699#pullrequestreview-857564660">PR review</a>.</p>



<a name="268631414"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233699%20Add%20epoch-based%20interruption%20for%20coop.../near/268631414" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233699.20Add.20epoch-based.20interruption.20for.20coop.2E.2E.2E.html#268631414">(Jan 20 2022 at 02:08)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/3699#discussion_r788293078">PR review comment</a>:</p>
<blockquote>
<p>Added!</p>
</blockquote>



<a name="268631422"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233699%20Add%20epoch-based%20interruption%20for%20coop.../near/268631422" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233699.20Add.20epoch-based.20interruption.20for.20coop.2E.2E.2E.html#268631422">(Jan 20 2022 at 02:08)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3699#pullrequestreview-857564771">PR review</a>.</p>



<a name="268631423"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233699%20Add%20epoch-based%20interruption%20for%20coop.../near/268631423" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233699.20Add.20epoch-based.20interruption.20for.20coop.2E.2E.2E.html#268631423">(Jan 20 2022 at 02:08)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/3699#discussion_r788293170">PR review comment</a>:</p>
<blockquote>
<p>Added a comment describing the safety here.</p>
</blockquote>



<a name="268631484"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233699%20Add%20epoch-based%20interruption%20for%20coop.../near/268631484" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233699.20Add.20epoch-based.20interruption.20for.20coop.2E.2E.2E.html#268631484">(Jan 20 2022 at 02:09)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3699">PR #3699</a> from <code>epoch-interruption</code> to <code>main</code>.</p>



<a name="268631584"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233699%20Add%20epoch-based%20interruption%20for%20coop.../near/268631584" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233699.20Add.20epoch-based.20interruption.20for.20coop.2E.2E.2E.html#268631584">(Jan 20 2022 at 02:11)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3699#pullrequestreview-857566053">PR review</a>.</p>



<a name="268631585"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233699%20Add%20epoch-based%20interruption%20for%20coop.../near/268631585" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233699.20Add.20epoch-based.20interruption.20for.20coop.2E.2E.2E.html#268631585">(Jan 20 2022 at 02:11)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/3699#discussion_r788294201">PR review comment</a>:</p>
<blockquote>
<p>I've renamed the methods to <code>set_epoch_deadline</code> for the "set deadline to N ticks in the future" action (analogous to <code>add_fuel</code>), and added <code>epoch_deadline_trap</code> and <code>epoch_deadline_async_yield_and_update</code> to configure the two different behaviors when deadline is reached.</p>
</blockquote>



<a name="268631597"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233699%20Add%20epoch-based%20interruption%20for%20coop.../near/268631597" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233699.20Add.20epoch-based.20interruption.20for.20coop.2E.2E.2E.html#268631597">(Jan 20 2022 at 02:11)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/3699#discussion_r788294264">PR review comment</a>:</p>
<blockquote>
<p>Updated docs here and elsewhere!</p>
</blockquote>



<a name="268631598"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233699%20Add%20epoch-based%20interruption%20for%20coop.../near/268631598" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233699.20Add.20epoch-based.20interruption.20for.20coop.2E.2E.2E.html#268631598">(Jan 20 2022 at 02:11)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3699#pullrequestreview-857566135">PR review</a>.</p>



<a name="268631685"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233699%20Add%20epoch-based%20interruption%20for%20coop.../near/268631685" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233699.20Add.20epoch-based.20interruption.20for.20coop.2E.2E.2E.html#268631685">(Jan 20 2022 at 02:12)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3699#pullrequestreview-857566678">PR review</a>.</p>



<a name="268631686"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233699%20Add%20epoch-based%20interruption%20for%20coop.../near/268631686" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233699.20Add.20epoch-based.20interruption.20for.20coop.2E.2E.2E.html#268631686">(Jan 20 2022 at 02:12)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/3699#discussion_r788294693">PR review comment</a>:</p>
<blockquote>
<p>I wrote a long doc comment here and linked it from all the other method doc-comments (and expanded the others significantly too). Hopefully this is a bit more polished now.</p>
<p>No example yet but I can add that too if we think it's important -- I see that fuel has some toplevel examples in <code>examples/</code>; maybe that would be appropriate?</p>
</blockquote>



<a name="268633999"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233699%20Add%20epoch-based%20interruption%20for%20coop.../near/268633999" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233699.20Add.20epoch-based.20interruption.20for.20coop.2E.2E.2E.html#268633999">(Jan 20 2022 at 02:52)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3699">PR #3699</a> from <code>epoch-interruption</code> to <code>main</code>.</p>



<a name="268634030"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233699%20Add%20epoch-based%20interruption%20for%20coop.../near/268634030" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233699.20Add.20epoch-based.20interruption.20for.20coop.2E.2E.2E.html#268634030">(Jan 20 2022 at 02:52)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3699#pullrequestreview-857585197">PR review</a>.</p>



<a name="268634032"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233699%20Add%20epoch-based%20interruption%20for%20coop.../near/268634032" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233699.20Add.20epoch-based.20interruption.20for.20coop.2E.2E.2E.html#268634032">(Jan 20 2022 at 02:52)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/3699#discussion_r788308744">PR review comment</a>:</p>
<blockquote>
<p>Fixed -- this is now <code>async_yield_impl</code> and the fuel update happens in <code>out_of_gas</code> (one of its callers) instead.</p>
</blockquote>



<a name="268634047"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233699%20Add%20epoch-based%20interruption%20for%20coop.../near/268634047" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233699.20Add.20epoch-based.20interruption.20for.20coop.2E.2E.2E.html#268634047">(Jan 20 2022 at 02:53)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/3699#discussion_r788308810">PR review comment</a>:</p>
<blockquote>
<p>Added all of these -- thanks!</p>
</blockquote>



<a name="268634048"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233699%20Add%20epoch-based%20interruption%20for%20coop.../near/268634048" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233699.20Add.20epoch-based.20interruption.20for.20coop.2E.2E.2E.html#268634048">(Jan 20 2022 at 02:53)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3699#pullrequestreview-857585301">PR review</a>.</p>



<a name="268634053"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233699%20Add%20epoch-based%20interruption%20for%20coop.../near/268634053" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233699.20Add.20epoch-based.20interruption.20for.20coop.2E.2E.2E.html#268634053">(Jan 20 2022 at 02:53)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3699#pullrequestreview-857585359">PR review</a>.</p>



<a name="268634054"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233699%20Add%20epoch-based%20interruption%20for%20coop.../near/268634054" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233699.20Add.20epoch-based.20interruption.20for.20coop.2E.2E.2E.html#268634054">(Jan 20 2022 at 02:53)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/3699#discussion_r788308855">PR review comment</a>:</p>
<blockquote>
<p>Done!</p>
</blockquote>



<a name="268634125"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233699%20Add%20epoch-based%20interruption%20for%20coop.../near/268634125" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233699.20Add.20epoch-based.20interruption.20for.20coop.2E.2E.2E.html#268634125">(Jan 20 2022 at 02:54)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3699#pullrequestreview-857585758">PR review</a>.</p>



<a name="268634126"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233699%20Add%20epoch-based%20interruption%20for%20coop.../near/268634126" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233699.20Add.20epoch-based.20interruption.20for.20coop.2E.2E.2E.html#268634126">(Jan 20 2022 at 02:54)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/3699#discussion_r788309130">PR review comment</a>:</p>
<blockquote>
<p>I went ahead and did this; I think it's better to let the regalloc keep it in a register when possible and spill as it needs, because the spill isn't any worse than eagerly reloading each time as we do now. I can test this in more detail tomorrow though.</p>
</blockquote>



<a name="268634471"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233699%20Add%20epoch-based%20interruption%20for%20coop.../near/268634471" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233699.20Add.20epoch-based.20interruption.20for.20coop.2E.2E.2E.html#268634471">(Jan 20 2022 at 02:59)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3699#pullrequestreview-857588541">PR review</a>.</p>



<a name="268634472"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233699%20Add%20epoch-based%20interruption%20for%20coop.../near/268634472" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233699.20Add.20epoch-based.20interruption.20for.20coop.2E.2E.2E.html#268634472">(Jan 20 2022 at 02:59)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/3699#discussion_r788311144">PR review comment</a>:</p>
<blockquote>
<p>Just tested with a <code>spidermonkey.wasm</code> I had laying around: baseline (no fuel or epoch-interruption) produced a 54MB <code>.cwasm</code> via <code>wasmtime compile</code>; with <code>--consume-fuel</code> I get 68MB; with <code>--epoch-interruption</code> I get 62MB.</p>
<p>So on that wasm module, fuel instrumentation has a 26% overhead while epoch instrumentation has a 15% overhead.</p>
</blockquote>



<a name="268635241"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233699%20Add%20epoch-based%20interruption%20for%20coop.../near/268635241" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233699.20Add.20epoch-based.20interruption.20for.20coop.2E.2E.2E.html#268635241">(Jan 20 2022 at 03:09)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3699#pullrequestreview-857592819">PR review</a>.</p>



<a name="268635242"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233699%20Add%20epoch-based%20interruption%20for%20coop.../near/268635242" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233699.20Add.20epoch-based.20interruption.20for.20coop.2E.2E.2E.html#268635242">(Jan 20 2022 at 03:09)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/3699#discussion_r788314628">PR review comment</a>:</p>
<blockquote>
<p>Good idea! This actually shaved the 62MB below down to 61MB.</p>
</blockquote>



<a name="268635302"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233699%20Add%20epoch-based%20interruption%20for%20coop.../near/268635302" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233699.20Add.20epoch-based.20interruption.20for.20coop.2E.2E.2E.html#268635302">(Jan 20 2022 at 03:10)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3699">PR #3699</a> from <code>epoch-interruption</code> to <code>main</code>.</p>



<a name="268635464"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233699%20Add%20epoch-based%20interruption%20for%20coop.../near/268635464" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233699.20Add.20epoch-based.20interruption.20for.20coop.2E.2E.2E.html#268635464">(Jan 20 2022 at 03:13)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3699">PR #3699</a> from <code>epoch-interruption</code> to <code>main</code>.</p>



<a name="268707861"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233699%20Add%20epoch-based%20interruption%20for%20coop.../near/268707861" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233699.20Add.20epoch-based.20interruption.20for.20coop.2E.2E.2E.html#268707861">(Jan 20 2022 at 15:20)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3699#pullrequestreview-858389876">PR review</a>.</p>



<a name="268707863"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233699%20Add%20epoch-based%20interruption%20for%20coop.../near/268707863" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233699.20Add.20epoch-based.20interruption.20for.20coop.2E.2E.2E.html#268707863">(Jan 20 2022 at 15:20)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3699#pullrequestreview-858389876">PR review</a>.</p>



<a name="268707864"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233699%20Add%20epoch-based%20interruption%20for%20coop.../near/268707864" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233699.20Add.20epoch-based.20interruption.20for.20coop.2E.2E.2E.html#268707864">(Jan 20 2022 at 15:20)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/3699#discussion_r788863210">PR review comment</a>:</p>
<blockquote>
<p>instrumentatino</p>
</blockquote>



<a name="268707865"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233699%20Add%20epoch-based%20interruption%20for%20coop.../near/268707865" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233699.20Add.20epoch-based.20interruption.20for.20coop.2E.2E.2E.html#268707865">(Jan 20 2022 at 15:20)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/3699#discussion_r788862934">PR review comment</a>:</p>
<blockquote>
<p>I might rephrase this from "it would be better to have..." to something focusing on how epochs are an alternative to fuel which is more lightweight. This seems to imply that fuel isn't really that useful but it's still useful for the determinism aspect (which doesn't necessarily need to be mentioned here)</p>
</blockquote>



<a name="268707866"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233699%20Add%20epoch-based%20interruption%20for%20coop.../near/268707866" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233699.20Add.20epoch-based.20interruption.20for.20coop.2E.2E.2E.html#268707866">(Jan 20 2022 at 15:20)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/3699#discussion_r788864870">PR review comment</a>:</p>
<blockquote>
<p>The docs here look great to me, thanks!</p>
<p>But yeah if you'd be up for adding an epoch-equivalent example that'd be awesome.</p>
</blockquote>



<a name="268762130"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233699%20Add%20epoch-based%20interruption%20for%20coop.../near/268762130" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233699.20Add.20epoch-based.20interruption.20for.20coop.2E.2E.2E.html#268762130">(Jan 20 2022 at 21:39)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3699">PR #3699</a> from <code>epoch-interruption</code> to <code>main</code>.</p>



<a name="268762715"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233699%20Add%20epoch-based%20interruption%20for%20coop.../near/268762715" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233699.20Add.20epoch-based.20interruption.20for.20coop.2E.2E.2E.html#268762715">(Jan 20 2022 at 21:44)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3699#pullrequestreview-858835195">PR review</a>.</p>



<a name="268762716"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233699%20Add%20epoch-based%20interruption%20for%20coop.../near/268762716" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233699.20Add.20epoch-based.20interruption.20for.20coop.2E.2E.2E.html#268762716">(Jan 20 2022 at 21:44)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/3699#discussion_r789173492">PR review comment</a>:</p>
<blockquote>
<p>I just measured this (for future: <code>--epoch-interruption</code> on both <code>wasmtime compile</code> and <code>wasmtime run</code>, and hack <code>src/commands/run.rs</code> to set a nonzero epoch deadline on the store, then build .cwasm and run it). It seems to be in the noise at least on SpiderMonkey running a CPU-intensive workload (<code>fib()</code>) -- this tells me that the regalloc is doing the right thing and spilling where it needs to, so it's reasonable to use a <code>Variable</code> here as you suggest for slightly simpler/smaller IR, I think. Thanks!</p>
</blockquote>



<a name="268763897"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233699%20Add%20epoch-based%20interruption%20for%20coop.../near/268763897" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233699.20Add.20epoch-based.20interruption.20for.20coop.2E.2E.2E.html#268763897">(Jan 20 2022 at 21:54)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3699">PR #3699</a> from <code>epoch-interruption</code> to <code>main</code>.</p>



<a name="268764341"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233699%20Add%20epoch-based%20interruption%20for%20coop.../near/268764341" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233699.20Add.20epoch-based.20interruption.20for.20coop.2E.2E.2E.html#268764341">(Jan 20 2022 at 21:58)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3699">PR #3699</a> from <code>epoch-interruption</code> to <code>main</code>.</p>



<a name="268769023"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233699%20Add%20epoch-based%20interruption%20for%20coop.../near/268769023" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233699.20Add.20epoch-based.20interruption.20for.20coop.2E.2E.2E.html#268769023">(Jan 20 2022 at 22:45)</a>:</h4>
<p>cfallin merged <a href="https://github.com/bytecodealliance/wasmtime/pull/3699">PR #3699</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>