<html>
<head><meta charset="utf-8"><title>wasmtime / Issue #2010 WASI: make O_CREAT|O_TRUNC actuall... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232010.20WASI.3A.20make.20O_CREAT.7CO_TRUNC.20actuall.2E.2E.2E.html">wasmtime / Issue #2010 WASI: make O_CREAT|O_TRUNC actuall...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="203550016"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232010%20WASI%3A%20make%20O_CREAT%7CO_TRUNC%20actuall.../near/203550016" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232010.20WASI.3A.20make.20O_CREAT.7CO_TRUNC.20actuall.2E.2E.2E.html#203550016">(Jul 10 2020 at 19:41)</a>:</h4>
<p>github-actions[bot] <a href="https://github.com/bytecodealliance/wasmtime/pull/2010#issuecomment-656856968">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/2010">Issue #2010</a>:</p>
<blockquote>
<h4>Subscribe to Label Action</h4>
<p>cc @kubkon</p>
<p>&lt;details&gt;<br>
This issue or pull request has been labeled: "wasi"</p>
<p>Thus the following users have been cc'd because of the following labels:</p>
<ul>
<li>kubkon: wasi</li>
</ul>
<p>To subscribe or unsubscribe from this label, edit the &lt;code&gt;.github/subscribe-to-label.json&lt;/code&gt; configuration file.</p>
<p><a href="https://github.com/bytecodealliance/subscribe-to-label-action">Learn more.</a><br>
&lt;/details&gt;</p>
</blockquote>



<a name="203550432"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232010%20WASI%3A%20make%20O_CREAT%7CO_TRUNC%20actuall.../near/203550432" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232010.20WASI.3A.20make.20O_CREAT.7CO_TRUNC.20actuall.2E.2E.2E.html#203550432">(Jul 10 2020 at 19:45)</a>:</h4>
<p>whitequark <a href="https://github.com/bytecodealliance/wasmtime/pull/2010#issuecomment-656858819">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/2010">Issue #2010</a>:</p>
<blockquote>
<blockquote>
<p>Would it be possible to add your test case (ported to a test-programs test maybe) to ensure we don't regress this fix?</p>
</blockquote>
<p>Sorry, I'm not familiar with this part of wasmtime's testing infrastructure, and the test case is pretty dirty (as-is it uses libc++...). If you have a step-by-step guide for doing this I could do it though!</p>
</blockquote>



<a name="203551102"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232010%20WASI%3A%20make%20O_CREAT%7CO_TRUNC%20actuall.../near/203551102" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232010.20WASI.3A.20make.20O_CREAT.7CO_TRUNC.20actuall.2E.2E.2E.html#203551102">(Jul 10 2020 at 19:52)</a>:</h4>
<p>peterhuene <a href="https://github.com/bytecodealliance/wasmtime/pull/2010#issuecomment-656861318">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/2010">Issue #2010</a>:</p>
<blockquote>
<p>No worries!  There's a bunch of tests in <code>crates/test-programs/wasi-tests</code> that use the <code>wasi</code> crate to directly test against the Wasmtime's WASI API surface.</p>
<p>I think a new test case in there that creates a file with some text, closes it, and then opens it with <code>OFLAGS_CREAT</code> AND <code>OFLAGS_TRUNC</code>, then reads it to confirm it is truncated would do the trick.</p>
<p>I'd be happy to write one if you would like.</p>
</blockquote>



<a name="203551135"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232010%20WASI%3A%20make%20O_CREAT%7CO_TRUNC%20actuall.../near/203551135" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232010.20WASI.3A.20make.20O_CREAT.7CO_TRUNC.20actuall.2E.2E.2E.html#203551135">(Jul 10 2020 at 19:52)</a>:</h4>
<p>peterhuene edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/2010#issuecomment-656861318">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/2010">Issue #2010</a>:</p>
<blockquote>
<p>No worries!  There's a bunch of tests in <code>crates/test-programs/wasi-tests</code> that use the <code>wasi</code> crate to directly test against the Wasmtime's WASI API surface.</p>
<p>I think a new test case in there that creates a file with some text, closes it, and then opens it with <code>OFLAGS_CREAT | OFLAGS_TRUNC</code>, then reads it to confirm it is truncated would do the trick.</p>
<p>I'd be happy to write one if you would like.</p>
</blockquote>



<a name="203551260"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232010%20WASI%3A%20make%20O_CREAT%7CO_TRUNC%20actuall.../near/203551260" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232010.20WASI.3A.20make.20O_CREAT.7CO_TRUNC.20actuall.2E.2E.2E.html#203551260">(Jul 10 2020 at 19:54)</a>:</h4>
<p>whitequark <a href="https://github.com/bytecodealliance/wasmtime/pull/2010#issuecomment-656862055">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/2010">Issue #2010</a>:</p>
<blockquote>
<blockquote>
<p>I'd be happy to write one if you would like.</p>
</blockquote>
<p>Please do, that would help a lot.</p>
</blockquote>



<a name="203554278"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232010%20WASI%3A%20make%20O_CREAT%7CO_TRUNC%20actuall.../near/203554278" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232010.20WASI.3A.20make.20O_CREAT.7CO_TRUNC.20actuall.2E.2E.2E.html#203554278">(Jul 10 2020 at 20:26)</a>:</h4>
<p>kubkon <a href="https://github.com/bytecodealliance/wasmtime/pull/2010#issuecomment-656874850">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/2010">Issue #2010</a>:</p>
<blockquote>
<blockquote>
<p>No worries! There's a bunch of tests in <code>crates/test-programs/wasi-tests</code> that use the <code>wasi</code> crate to directly test against the Wasmtime's WASI API surface.</p>
<p>I think a new test case in there that creates a file with some text, closes it, and then opens it with <code>OFLAGS_CREAT | OFLAGS_TRUNC</code>, then reads it to confirm it is truncated would do the trick.</p>
<p>I'd be happy to write one if you would like.</p>
</blockquote>
<p>Would it make sense to modify <a href="https://github.com/bytecodealliance/wasmtime/blob/main/crates/test-programs/wasi-tests/src/bin/truncation_rights.rs">truncation_rights.rs</a> instead of/in addition to adding a new one? It seems this one should already test what has been discussed here, but due to the fact the file is always empty and never reopened, this bug was missed on Windows.</p>
</blockquote>



<a name="203555261"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232010%20WASI%3A%20make%20O_CREAT%7CO_TRUNC%20actuall.../near/203555261" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232010.20WASI.3A.20make.20O_CREAT.7CO_TRUNC.20actuall.2E.2E.2E.html#203555261">(Jul 10 2020 at 20:37)</a>:</h4>
<p>peterhuene <a href="https://github.com/bytecodealliance/wasmtime/pull/2010#issuecomment-656879066">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/2010">Issue #2010</a>:</p>
<blockquote>
<p>I think that <code>truncation_rights</code> is specifically centered around the WASI right checking whereas the new test would be simply to check that <code>OFLAGS_TRUNC</code> was respected properly for <code>path_open</code>.</p>
<p>Personally I'd prefer two smaller tests to one complicated test.</p>
</blockquote>



<a name="203555340"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232010%20WASI%3A%20make%20O_CREAT%7CO_TRUNC%20actuall.../near/203555340" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232010.20WASI.3A.20make.20O_CREAT.7CO_TRUNC.20actuall.2E.2E.2E.html#203555340">(Jul 10 2020 at 20:38)</a>:</h4>
<p>peterhuene edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/2010#issuecomment-656879066">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/2010">Issue #2010</a>:</p>
<blockquote>
<p>I think that <code>truncation_rights</code> is specifically centered around the WASI rights checking whereas the new test would be simply to check that <code>OFLAGS_TRUNC</code> was respected properly for <code>path_open</code>.</p>
<p>Personally I'd prefer two smaller tests to one complicated test.</p>
</blockquote>



<a name="203556788"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232010%20WASI%3A%20make%20O_CREAT%7CO_TRUNC%20actuall.../near/203556788" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232010.20WASI.3A.20make.20O_CREAT.7CO_TRUNC.20actuall.2E.2E.2E.html#203556788">(Jul 10 2020 at 20:54)</a>:</h4>
<p>peterhuene <a href="https://github.com/bytecodealliance/wasmtime/pull/2010#issuecomment-656885985">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/2010">Issue #2010</a>:</p>
<blockquote>
<p>@kubkon I've pushed up a test case for file truncation.  Would you mind reviewing it?  I've confirmed the test fails without @whitequark's fix and passes with the fix on Windows.</p>
</blockquote>



<a name="203559071"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232010%20WASI%3A%20make%20O_CREAT%7CO_TRUNC%20actuall.../near/203559071" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232010.20WASI.3A.20make.20O_CREAT.7CO_TRUNC.20actuall.2E.2E.2E.html#203559071">(Jul 10 2020 at 21:20)</a>:</h4>
<p>peterhuene edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/2010#issuecomment-656861318">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/2010">Issue #2010</a>:</p>
<blockquote>
<p>No worries!  There's a bunch of tests in <code>crates/test-programs/wasi-tests</code> that use the <code>wasi</code> crate to directly test against Wasmtime's WASI API surface.</p>
<p>I think a new test case in there that creates a file with some text, closes it, and then opens it with <code>OFLAGS_CREAT | OFLAGS_TRUNC</code>, then reads it to confirm it is truncated would do the trick.</p>
<p>I'd be happy to write one if you would like.</p>
</blockquote>



<a name="203559892"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232010%20WASI%3A%20make%20O_CREAT%7CO_TRUNC%20actuall.../near/203559892" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232010.20WASI.3A.20make.20O_CREAT.7CO_TRUNC.20actuall.2E.2E.2E.html#203559892">(Jul 10 2020 at 21:30)</a>:</h4>
<p>peterhuene <a href="https://github.com/bytecodealliance/wasmtime/pull/2010#issuecomment-656900212">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/2010">Issue #2010</a>:</p>
<blockquote>
<p>Third time's a charm on those force pushes (I was lazy and just <code>cargo test --feature test_programs</code> the test programs crate directly, which doesn't error on unused imports when building).</p>
</blockquote>



<a name="203560236"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232010%20WASI%3A%20make%20O_CREAT%7CO_TRUNC%20actuall.../near/203560236" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232010.20WASI.3A.20make.20O_CREAT.7CO_TRUNC.20actuall.2E.2E.2E.html#203560236">(Jul 10 2020 at 21:35)</a>:</h4>
<p>peterhuene edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/2010#issuecomment-656900212">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/2010">Issue #2010</a>:</p>
<blockquote>
<p>Third time's a charm on those force pushes (I was lazy and just <code>cargo test --feature test_programs</code> the test programs crate directly, which doesn't error on unused imports when building like in CI).</p>
</blockquote>



<a name="203619512"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232010%20WASI%3A%20make%20O_CREAT%7CO_TRUNC%20actuall.../near/203619512" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232010.20WASI.3A.20make.20O_CREAT.7CO_TRUNC.20actuall.2E.2E.2E.html#203619512">(Jul 12 2020 at 00:11)</a>:</h4>
<p>peterhuene <a href="https://github.com/bytecodealliance/wasmtime/pull/2010#issuecomment-657151652">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/2010">Issue #2010</a>:</p>
<blockquote>
<p>@whitequark thanks for fixing this!</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>