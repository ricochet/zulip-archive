<html>
<head><meta charset="utf-8"><title>wasmtime / PR #6440 feat(preview1): implement core I/O fu... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236440.20feat.28preview1.29.3A.20implement.20core.20I.2FO.20fu.2E.2E.2E.html">wasmtime / PR #6440 feat(preview1): implement core I/O fu...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="360589808"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236440%20feat%28preview1%29%3A%20implement%20core%20I/O%20fu.../near/360589808" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236440.20feat.28preview1.29.3A.20implement.20core.20I.2FO.20fu.2E.2E.2E.html#360589808">(May 23 2023 at 16:58)</a>:</h4>
<p>rvolosatovs opened <a href="https://github.com/bytecodealliance/wasmtime/pull/6440">PR #6440</a> from <code>rvolosatovs:feat/preview1-preview2</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>Moved from <a href="https://github.com/bytecodealliance/preview2-prototyping/pull/175">https://github.com/bytecodealliance/preview2-prototyping/pull/175</a></p>
<p>There's a platform-specific bug somewhere, which I suspect originates somewhere in <code>path_open</code> flag translation logic</p>
</blockquote>



<a name="360591605"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236440%20feat%28preview1%29%3A%20implement%20core%20I/O%20fu.../near/360591605" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236440.20feat.28preview1.29.3A.20implement.20core.20I.2FO.20fu.2E.2E.2E.html#360591605">(May 23 2023 at 17:05)</a>:</h4>
<p>rvolosatovs updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6440">PR #6440</a>.</p>



<a name="360599364"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236440%20feat%28preview1%29%3A%20implement%20core%20I/O%20fu.../near/360599364" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236440.20feat.28preview1.29.3A.20implement.20core.20I.2FO.20fu.2E.2E.2E.html#360599364">(May 23 2023 at 17:40)</a>:</h4>
<p>rvolosatovs updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6440">PR #6440</a>.</p>



<a name="360599656"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236440%20feat%28preview1%29%3A%20implement%20core%20I/O%20fu.../near/360599656" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236440.20feat.28preview1.29.3A.20implement.20core.20I.2FO.20fu.2E.2E.2E.html#360599656">(May 23 2023 at 17:42)</a>:</h4>
<p>rvolosatovs edited <a href="https://github.com/bytecodealliance/wasmtime/pull/6440">PR #6440</a>:</p>
<blockquote>
<p>Moved from <a href="https://github.com/bytecodealliance/preview2-prototyping/pull/175">https://github.com/bytecodealliance/preview2-prototyping/pull/175</a></p>
</blockquote>



<a name="360609613"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236440%20feat%28preview1%29%3A%20implement%20core%20I/O%20fu.../near/360609613" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236440.20feat.28preview1.29.3A.20implement.20core.20I.2FO.20fu.2E.2E.2E.html#360609613">(May 23 2023 at 18:25)</a>:</h4>
<p>rvolosatovs edited <a href="https://github.com/bytecodealliance/wasmtime/pull/6440">PR #6440</a>:</p>
<blockquote>
<p>Moved from <a href="https://github.com/bytecodealliance/preview2-prototyping/pull/175">https://github.com/bytecodealliance/preview2-prototyping/pull/175</a></p>
<p>The implementation tries to follow existing preview1 behavior as much as possible - as a result, there are a few differences in behavior from existing adapter. Please see the original PR for more details.</p>
<p>A follow-up PRs fill be filed for:</p>
<ul>
<li><code>fd_readdir</code></li>
<li>fixing <code>windows</code> support for a few tests (still not sure what's causing it)</li>
<li>making all preview1 implementations consistent</li>
</ul>
</blockquote>



<a name="360609647"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236440%20feat%28preview1%29%3A%20implement%20core%20I/O%20fu.../near/360609647" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236440.20feat.28preview1.29.3A.20implement.20core.20I.2FO.20fu.2E.2E.2E.html#360609647">(May 23 2023 at 18:25)</a>:</h4>
<p><strong>rvolosatovs</strong> has marked <a href="https://github.com/bytecodealliance/wasmtime/pull/6440">PR #6440</a> as ready for review.</p>



<a name="360609652"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236440%20feat%28preview1%29%3A%20implement%20core%20I/O%20fu.../near/360609652" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236440.20feat.28preview1.29.3A.20implement.20core.20I.2FO.20fu.2E.2E.2E.html#360609652">(May 23 2023 at 18:25)</a>:</h4>
<p><strong>rvolosatovs</strong> requested <a href="https://github.com/itsrainy">itsrainy</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/6440">PR #6440</a>.</p>



<a name="360609653"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236440%20feat%28preview1%29%3A%20implement%20core%20I/O%20fu.../near/360609653" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236440.20feat.28preview1.29.3A.20implement.20core.20I.2FO.20fu.2E.2E.2E.html#360609653">(May 23 2023 at 18:25)</a>:</h4>
<p><strong>rvolosatovs</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/6440">PR #6440</a>.</p>



<a name="360610148"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236440%20feat%28preview1%29%3A%20implement%20core%20I/O%20fu.../near/360610148" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236440.20feat.28preview1.29.3A.20implement.20core.20I.2FO.20fu.2E.2E.2E.html#360610148">(May 23 2023 at 18:27)</a>:</h4>
<p>rvolosatovs edited <a href="https://github.com/bytecodealliance/wasmtime/pull/6440">PR #6440</a>:</p>
<blockquote>
<p>Moved from <a href="https://github.com/bytecodealliance/preview2-prototyping/pull/175">https://github.com/bytecodealliance/preview2-prototyping/pull/175</a></p>
<p>The implementation tries to follow existing preview1 behavior as much as possible - as a result, there are a few differences in behavior from existing adapter. Please see the original PR for more details.</p>
<p>A follow-up PRs fill be filed for:</p>
<ul>
<li><code>fd_readdir</code></li>
<li>fixing <code>windows</code> support for a few tests (still not sure what's causing the failures)</li>
<li>making all preview1 implementations consistent</li>
</ul>
</blockquote>



<a name="360631434"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236440%20feat%28preview1%29%3A%20implement%20core%20I/O%20fu.../near/360631434" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236440.20feat.28preview1.29.3A.20implement.20core.20I.2FO.20fu.2E.2E.2E.html#360631434">(May 23 2023 at 20:20)</a>:</h4>
<p><strong>itsrainy</strong> requested <a href="https://github.com/pchickey">pchickey</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/6440">PR #6440</a>.</p>



<a name="360637504"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236440%20feat%28preview1%29%3A%20implement%20core%20I/O%20fu.../near/360637504" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236440.20feat.28preview1.29.3A.20implement.20core.20I.2FO.20fu.2E.2E.2E.html#360637504">(May 23 2023 at 20:58)</a>:</h4>
<p>pchickey submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6440#pullrequestreview-1440540915">PR review</a>:</p>
<blockquote>
<p>This is great work! Just a few small issues. Thank you for finding all of these bad behaviors in the legacy implementation!</p>
</blockquote>



<a name="360637507"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236440%20feat%28preview1%29%3A%20implement%20core%20I/O%20fu.../near/360637507" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236440.20feat.28preview1.29.3A.20implement.20core.20I.2FO.20fu.2E.2E.2E.html#360637507">(May 23 2023 at 20:58)</a>:</h4>
<p>pchickey submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6440#pullrequestreview-1440540915">PR review</a>:</p>
<blockquote>
<p>This is great work! Just a few small issues. Thank you for finding all of these bad behaviors in the legacy implementation!</p>
</blockquote>



<a name="360637509"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236440%20feat%28preview1%29%3A%20implement%20core%20I/O%20fu.../near/360637509" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236440.20feat.28preview1.29.3A.20implement.20core.20I.2FO.20fu.2E.2E.2E.html#360637509">(May 23 2023 at 20:58)</a>:</h4>
<p>pchickey created <a href="https://github.com/bytecodealliance/wasmtime/pull/6440#discussion_r1202991271">PR review comment</a>:</p>
<blockquote>
<p>this is still a <code>todo!()</code> - we can leave it to a follow up PR, but <code>unreachable!()</code> communicates to me that it is a bug in this code if it is reachable, while this is reachable from any guest program.</p>
</blockquote>



<a name="360637510"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236440%20feat%28preview1%29%3A%20implement%20core%20I/O%20fu.../near/360637510" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236440.20feat.28preview1.29.3A.20implement.20core.20I.2FO.20fu.2E.2E.2E.html#360637510">(May 23 2023 at 20:58)</a>:</h4>
<p>pchickey created <a href="https://github.com/bytecodealliance/wasmtime/pull/6440#discussion_r1202985205">PR review comment</a>:</p>
<blockquote>
<p>I wasn't expecting this sort of machinery to be required - we can't get away with implementing the DescriptorsRef methods on WasiPreview1Ctx? I can't intuit where the problem is in a more straightforward implementation, so if this is required, lets leave a comment on the struct definition explaining why.</p>
</blockquote>



<a name="360637511"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236440%20feat%28preview1%29%3A%20implement%20core%20I/O%20fu.../near/360637511" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236440.20feat.28preview1.29.3A.20implement.20core.20I.2FO.20fu.2E.2E.2E.html#360637511">(May 23 2023 at 20:58)</a>:</h4>
<p>pchickey created <a href="https://github.com/bytecodealliance/wasmtime/pull/6440#discussion_r1202998079">PR review comment</a>:</p>
<blockquote>
<p>lets definitely not preserve that bug :). That one has been around for a while! Lets get rid of this check and follow up with a PR to fix the legacy impl, and a test. I expect that fix will only be around for its final release, but its still worth doing.</p>
</blockquote>



<a name="360752472"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236440%20feat%28preview1%29%3A%20implement%20core%20I/O%20fu.../near/360752472" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236440.20feat.28preview1.29.3A.20implement.20core.20I.2FO.20fu.2E.2E.2E.html#360752472">(May 24 2023 at 10:45)</a>:</h4>
<p>rvolosatovs created <a href="https://github.com/bytecodealliance/wasmtime/pull/6440#discussion_r1203880574">PR review comment</a>:</p>
<blockquote>
<p>I took this directly from <a href="https://github.com/bytecodealliance/wasmtime/blob/5b93cdb84def5fa7cb3ff823bc80216f19c296c5/crates/wasi-preview1-component-adapter/src/lib.rs#L560-L569">https://github.com/bytecodealliance/wasmtime/blob/5b93cdb84def5fa7cb3ff823bc80216f19c296c5/crates/wasi-preview1-component-adapter/src/lib.rs#L560-L569</a> and it was surprising to me as well.<br>
It seems to me that the adapter has to implement rights handling, which the existing one does not do. I'll mark this as <code>todo!</code> and file an issue for rights handling follow-up</p>
</blockquote>



<a name="360764236"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236440%20feat%28preview1%29%3A%20implement%20core%20I/O%20fu.../near/360764236" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236440.20feat.28preview1.29.3A.20implement.20core.20I.2FO.20fu.2E.2E.2E.html#360764236">(May 24 2023 at 11:40)</a>:</h4>
<p>rvolosatovs created <a href="https://github.com/bytecodealliance/wasmtime/pull/6440#discussion_r1203957746">PR review comment</a>:</p>
<blockquote>
<p>I'll add a comment, but the biggest reasons why this is required are:</p>
<ol>
<li>By far the biggest issue is <code>bindgen</code> generating host methods with <code>&amp;mut self</code> receivers, preventing e.g. simultaneous lazy initialization of the descriptor table and calling a preview2 method using any data borrowed from that table, even looking up something like <code>table().is_file</code> is problematic</li>
<li><code>WasiPreview1Adapter</code> (assuming that's what you meant by WasiPreview1Ctx) does not have access to preview2 functionality and/or the underlying table, so it cannot initialize itself using something like <a href="https://docs.rs/once_cell/latest/once_cell/sync/struct.Lazy.html">https://docs.rs/once_cell/latest/once_cell/sync/struct.Lazy.html</a> . Lazily initializing the descriptor map requires access to both the <code>WasiPreview1Adapter</code> and <code>wasi::preopens::Host</code>, so the only place where this functionality could exist is in an extension trait (<code>WasiPreview1ViewExt</code>). Note that from within this trait, we can never return anything borrowed directly, because we'd first need to call <code>adapter_mut()</code> to get access to the state (which we may need to lazily initialize). And even if we had a way to return a borrowed descriptor table directly, it would not be possible to call any other method on <code>self</code> due to 1., since that would cause a double mutable borrow, which is not allowed.</li>
</ol>
<p>In short, an alternative solution would be storing <code>Option&lt;Arc&lt;Mutex&lt;Descriptors&gt;&gt;&gt;</code> in the adapter and returning <code>Arc&lt;Mutex&lt;Descriptors&gt;&gt;</code> in the <code>WasiPreview1AdapterExt::descriptors(&amp;mut self)</code> method, which IMO is way more awkward to work with and simply redundant complexity.<br>
Overall, the <code>DescriptorsRef</code> is just a workaround for <code>bindgen</code> design drawbacks. I believe this could be simplified dramatically if host methods would just take <code>&amp;self</code></p>
</blockquote>



<a name="360776362"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236440%20feat%28preview1%29%3A%20implement%20core%20I/O%20fu.../near/360776362" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236440.20feat.28preview1.29.3A.20implement.20core.20I.2FO.20fu.2E.2E.2E.html#360776362">(May 24 2023 at 12:34)</a>:</h4>
<p>rvolosatovs updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6440">PR #6440</a>.</p>



<a name="360777636"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236440%20feat%28preview1%29%3A%20implement%20core%20I/O%20fu.../near/360777636" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236440.20feat.28preview1.29.3A.20implement.20core.20I.2FO.20fu.2E.2E.2E.html#360777636">(May 24 2023 at 12:40)</a>:</h4>
<p><strong>rvolosatovs</strong> requested <a href="https://github.com/pchickey">pchickey</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/6440">PR #6440</a>.</p>



<a name="360777663"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236440%20feat%28preview1%29%3A%20implement%20core%20I/O%20fu.../near/360777663" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236440.20feat.28preview1.29.3A.20implement.20core.20I.2FO.20fu.2E.2E.2E.html#360777663">(May 24 2023 at 12:40)</a>:</h4>
<p>rvolosatovs edited <a href="https://github.com/bytecodealliance/wasmtime/pull/6440">PR #6440</a>:</p>
<blockquote>
<p>Moved from <a href="https://github.com/bytecodealliance/preview2-prototyping/pull/175">https://github.com/bytecodealliance/preview2-prototyping/pull/175</a></p>
<p>The implementation tries to follow existing preview1 behavior as much as possible - as a result, there are a few differences in behavior from existing adapter. Please see the original PR for more details.</p>
<p>A follow-up PRs fill be filed for:</p>
<ul>
<li><code>fd_readdir</code></li>
<li>fixing <code>windows</code> support for a few tests (still not sure what's causing the failures)</li>
<li>making all preview1 implementations consistent</li>
<li>add rights handling</li>
</ul>
</blockquote>



<a name="360777698"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236440%20feat%28preview1%29%3A%20implement%20core%20I/O%20fu.../near/360777698" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236440.20feat.28preview1.29.3A.20implement.20core.20I.2FO.20fu.2E.2E.2E.html#360777698">(May 24 2023 at 12:40)</a>:</h4>
<p>rvolosatovs edited <a href="https://github.com/bytecodealliance/wasmtime/pull/6440">PR #6440</a>:</p>
<blockquote>
<p>Moved from <a href="https://github.com/bytecodealliance/preview2-prototyping/pull/175">https://github.com/bytecodealliance/preview2-prototyping/pull/175</a></p>
<p>The implementation tries to follow existing preview1 behavior as much as possible - as a result, there are a few differences in behavior from existing adapter. Please see the original PR for more details.</p>
<p>A follow-up issues/PRs fill be filed for:</p>
<ul>
<li><code>fd_readdir</code></li>
<li>fixing <code>windows</code> support for a few tests (still not sure what's causing the failures)</li>
<li>making all preview1 implementations consistent</li>
<li>adding rights handling</li>
</ul>
</blockquote>



<a name="360806997"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236440%20feat%28preview1%29%3A%20implement%20core%20I/O%20fu.../near/360806997" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236440.20feat.28preview1.29.3A.20implement.20core.20I.2FO.20fu.2E.2E.2E.html#360806997">(May 24 2023 at 14:28)</a>:</h4>
<p>rvolosatovs edited <a href="https://github.com/bytecodealliance/wasmtime/pull/6440">PR #6440</a>:</p>
<blockquote>
<p>Moved from <a href="https://github.com/bytecodealliance/preview2-prototyping/pull/175">https://github.com/bytecodealliance/preview2-prototyping/pull/175</a></p>
<p>Refs <a href="https://github.com/bytecodealliance/wasmtime/issues/6370">https://github.com/bytecodealliance/wasmtime/issues/6370</a></p>
<p>The implementation tries to follow existing preview1 behavior as much as possible - as a result, there are a few differences in behavior from existing adapter. Please see the original PR for more details.</p>
<p>A follow-up issues/PRs fill be filed for:</p>
<ul>
<li><code>fd_readdir</code></li>
<li>fixing <code>windows</code> support for a few tests (still not sure what's causing the failures)</li>
<li>making all preview1 implementations consistent</li>
<li>adding rights handling</li>
</ul>
</blockquote>



<a name="360816835"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236440%20feat%28preview1%29%3A%20implement%20core%20I/O%20fu.../near/360816835" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236440.20feat.28preview1.29.3A.20implement.20core.20I.2FO.20fu.2E.2E.2E.html#360816835">(May 24 2023 at 15:02)</a>:</h4>
<p>pchickey created <a href="https://github.com/bytecodealliance/wasmtime/pull/6440#discussion_r1204334345">PR review comment</a>:</p>
<blockquote>
<p>Oh, that is indeed a bug in the component adapter as well. <code>unreachabable!()</code> is just how we spell <code>todo!()</code> and <code>panic!()</code> and etc over there since we cant use std's macros.</p>
<p>In the legacy implementation, set_rights is a no-op, it only validates the fd. That is the correct behavior for both of these spots. Would you mind making this fix to the component adapter as well?</p>
</blockquote>



<a name="360817380"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236440%20feat%28preview1%29%3A%20implement%20core%20I/O%20fu.../near/360817380" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236440.20feat.28preview1.29.3A.20implement.20core.20I.2FO.20fu.2E.2E.2E.html#360817380">(May 24 2023 at 15:04)</a>:</h4>
<p>pchickey created <a href="https://github.com/bytecodealliance/wasmtime/pull/6440#discussion_r1204338956">PR review comment</a>:</p>
<blockquote>
<p>That makes sense. Thank you.</p>
<p>We should look into adding a bindgen option to enable &amp;self receivers in the future, and then we may be able to unwind a bit of this complexity. For now, this is a fine implementation once it has a comment.</p>
</blockquote>



<a name="360826459"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236440%20feat%28preview1%29%3A%20implement%20core%20I/O%20fu.../near/360826459" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236440.20feat.28preview1.29.3A.20implement.20core.20I.2FO.20fu.2E.2E.2E.html#360826459">(May 24 2023 at 15:37)</a>:</h4>
<p>rvolosatovs created <a href="https://github.com/bytecodealliance/wasmtime/pull/6440#discussion_r1204409247">PR review comment</a>:</p>
<blockquote>
<p>I've added a few comments and renamed the struct to <code>Transaction</code> so it's a bit more obvious what it actually is</p>
</blockquote>



<a name="360826747"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236440%20feat%28preview1%29%3A%20implement%20core%20I/O%20fu.../near/360826747" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236440.20feat.28preview1.29.3A.20implement.20core.20I.2FO.20fu.2E.2E.2E.html#360826747">(May 24 2023 at 15:38)</a>:</h4>
<p>rvolosatovs created <a href="https://github.com/bytecodealliance/wasmtime/pull/6440#discussion_r1204411049">PR review comment</a>:</p>
<blockquote>
<p>Let's take care of it as part of <a href="https://github.com/bytecodealliance/wasmtime/issues/6446">https://github.com/bytecodealliance/wasmtime/issues/6446</a> ?</p>
</blockquote>



<a name="360832312"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236440%20feat%28preview1%29%3A%20implement%20core%20I/O%20fu.../near/360832312" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236440.20feat.28preview1.29.3A.20implement.20core.20I.2FO.20fu.2E.2E.2E.html#360832312">(May 24 2023 at 16:00)</a>:</h4>
<p>rvolosatovs created <a href="https://github.com/bytecodealliance/wasmtime/pull/6440#discussion_r1204441447">PR review comment</a>:</p>
<blockquote>
<p><a href="https://github.com/bytecodealliance/wasmtime/pull/6444">https://github.com/bytecodealliance/wasmtime/pull/6444</a></p>
</blockquote>



<a name="360853361"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236440%20feat%28preview1%29%3A%20implement%20core%20I/O%20fu.../near/360853361" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236440.20feat.28preview1.29.3A.20implement.20core.20I.2FO.20fu.2E.2E.2E.html#360853361">(May 24 2023 at 17:29)</a>:</h4>
<p>pchickey submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6440#pullrequestreview-1442430135">PR review</a>.</p>



<a name="360861435"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236440%20feat%28preview1%29%3A%20implement%20core%20I/O%20fu.../near/360861435" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236440.20feat.28preview1.29.3A.20implement.20core.20I.2FO.20fu.2E.2E.2E.html#360861435">(May 24 2023 at 18:07)</a>:</h4>
<p>pchickey merged <a href="https://github.com/bytecodealliance/wasmtime/pull/6440">PR #6440</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>