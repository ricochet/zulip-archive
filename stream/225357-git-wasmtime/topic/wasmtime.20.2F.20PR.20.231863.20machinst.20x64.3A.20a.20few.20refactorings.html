<html>
<head><meta charset="utf-8"><title>wasmtime / PR #1863 machinst x64: a few refactorings · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231863.20machinst.20x64.3A.20a.20few.20refactorings.html">wasmtime / PR #1863 machinst x64: a few refactorings</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="200556227"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231863%20machinst%20x64%3A%20a%20few%20refactorings/near/200556227" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231863.20machinst.20x64.3A.20a.20few.20refactorings.html#200556227">(Jun 11 2020 at 15:02)</a>:</h4>
<p>bnjbvr opened <a href="https://github.com/bytecodealliance/wasmtime/pull/1863">PR #1863</a> from <code>x64</code> to <code>master</code>:</p>
<blockquote>
<p>This renames and encapsulates some concepts a bit more; no functional changes have been done, as confirmed by the tests still passing :-)</p>
</blockquote>



<a name="200556271"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231863%20machinst%20x64%3A%20a%20few%20refactorings/near/200556271" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231863.20machinst.20x64.3A.20a.20few.20refactorings.html#200556271">(Jun 11 2020 at 15:02)</a>:</h4>
<p><strong>bnjbvr</strong> requested <a href="https://github.com/julian-seward1">julian-seward1</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/1863">PR #1863</a>.</p>



<a name="200563225"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231863%20machinst%20x64%3A%20a%20few%20refactorings/near/200563225" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231863.20machinst.20x64.3A.20a.20few.20refactorings.html#200563225">(Jun 11 2020 at 15:49)</a>:</h4>
<p>bnjbvr updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1863">PR #1863</a> from <code>x64</code> to <code>master</code>:</p>
<blockquote>
<p>This renames and encapsulates some concepts a bit more; no functional changes have been done, as confirmed by the tests still passing :-)</p>
</blockquote>



<a name="200563985"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231863%20machinst%20x64%3A%20a%20few%20refactorings/near/200563985" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231863.20machinst.20x64.3A.20a.20few.20refactorings.html#200563985">(Jun 11 2020 at 15:55)</a>:</h4>
<p>julian-seward1 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1863#pullrequestreview-429011310">PR Review</a>.</p>



<a name="200563986"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231863%20machinst%20x64%3A%20a%20few%20refactorings/near/200563986" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231863.20machinst.20x64.3A.20a.20few.20refactorings.html#200563986">(Jun 11 2020 at 15:55)</a>:</h4>
<p>julian-seward1 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1863#discussion_r438866800">PR Review Comment</a>:</p>
<blockquote>
<p>I see from reading later that we can extract the SSE level by passing calling its <code>.available_from</code> method.  But I don't see the win here .. it places more of a burden on readers of the code, who now have to look in some other place to figure out the SSE level.</p>
</blockquote>



<a name="200563987"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231863%20machinst%20x64%3A%20a%20few%20refactorings/near/200563987" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231863.20machinst.20x64.3A.20a.20few.20refactorings.html#200563987">(Jun 11 2020 at 15:55)</a>:</h4>
<p>julian-seward1 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1863#pullrequestreview-429011310">PR Review</a>.</p>



<a name="200563988"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231863%20machinst%20x64%3A%20a%20few%20refactorings/near/200563988" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231863.20machinst.20x64.3A.20a.20few.20refactorings.html#200563988">(Jun 11 2020 at 15:55)</a>:</h4>
<p>julian-seward1 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1863#discussion_r438862966">PR Review Comment</a>:</p>
<blockquote>
<p>Ahh ... this renaming loses the SSE-level on the name; I specifically wanted to retain that -- per discussion with Johnny in PR1665.  Can you reinstate it somehow?  I think it will be confusing and difficult -- especially later, when we add even more opcodes (and there are zillions of them) -- if we cannot look at an SseOpcode value and know directly what level it is for.</p>
</blockquote>



<a name="200563990"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231863%20machinst%20x64%3A%20a%20few%20refactorings/near/200563990" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231863.20machinst.20x64.3A.20a.20few.20refactorings.html#200563990">(Jun 11 2020 at 15:55)</a>:</h4>
<p>julian-seward1 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1863#discussion_r438870384">PR Review Comment</a>:</p>
<blockquote>
<p>Hmm .. I'm not entirely happy about the <code>i</code> in <code>Rmi</code> here.  Those immediates are often an opcode extension, especially for the comparison instructions, and not really an operand.  By contrast, the <code>i</code> in <code>AluRmi</code> really is an operand.  Hence there's a conceptual inconsistency.  Not sure what a better name is though.</p>
</blockquote>



<a name="200563991"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231863%20machinst%20x64%3A%20a%20few%20refactorings/near/200563991" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231863.20machinst.20x64.3A.20a.20few.20refactorings.html#200563991">(Jun 11 2020 at 15:55)</a>:</h4>
<p>julian-seward1 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1863#discussion_r438859994">PR Review Comment</a>:</p>
<blockquote>
<p>At some point this will need to be expanded to include whole-register copies (mova<strong>/movu</strong>).</p>
</blockquote>



<a name="200563993"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231863%20machinst%20x64%3A%20a%20few%20refactorings/near/200563993" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231863.20machinst.20x64.3A.20a.20few.20refactorings.html#200563993">(Jun 11 2020 at 15:55)</a>:</h4>
<p>julian-seward1 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1863#discussion_r438882187">PR Review Comment</a>:</p>
<blockquote>
<p>What is this used for?  I don't see a previous version of it, and I feel nervous about having a function that gets the encoding for a register without checking the class.  (cf inconsistency with <code>int_reg_enc</code>).  At some point soon I guess we'll need an <code>xmm_reg_enc</code> as a dual to <code>int_reg_enc</code>?</p>
</blockquote>



<a name="200563994"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231863%20machinst%20x64%3A%20a%20few%20refactorings/near/200563994" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231863.20machinst.20x64.3A.20a.20few.20refactorings.html#200563994">(Jun 11 2020 at 15:55)</a>:</h4>
<p>julian-seward1 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1863#discussion_r438883631">PR Review Comment</a>:</p>
<blockquote>
<p>I'm not sure what the sentence "A select prefix .. " means (what's a "select" prefix?)  Maybe rm this sentence?  In any case none of this machinery will work for creating VEX- or EVEX-prefixed instructions; we'll have to redo it for those.</p>
</blockquote>



<a name="200563995"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231863%20machinst%20x64%3A%20a%20few%20refactorings/near/200563995" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231863.20machinst.20x64.3A.20a.20few.20refactorings.html#200563995">(Jun 11 2020 at 15:55)</a>:</h4>
<p>julian-seward1 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1863#discussion_r438889251">PR Review Comment</a>:</p>
<blockquote>
<p>Hmm, also here is inconsistent now.</p>
<p>There are two axes of differentiation in the old naming:</p>
<ul>
<li>E is reg vs E is mem   (G is always a reg)</li>
<li>whether reg values are indicated by passing a Reg ("reg") or just its encoding number ("enc")</li>
</ul>
<p>Can you rename so as to bring back those distinctions?</p>
</blockquote>



<a name="200563996"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231863%20machinst%20x64%3A%20a%20few%20refactorings/near/200563996" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231863.20machinst.20x64.3A.20a.20few.20refactorings.html#200563996">(Jun 11 2020 at 15:55)</a>:</h4>
<p>julian-seward1 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1863#discussion_r438892223">PR Review Comment</a>:</p>
<blockquote>
<p>Can this be called <code>RexFlags</code>?  Calling it simply <code>Rex</code> might lead one to believe that it itself is a Rex prefix, when it is not.</p>
</blockquote>



<a name="200563997"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231863%20machinst%20x64%3A%20a%20few%20refactorings/near/200563997" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231863.20machinst.20x64.3A.20a.20few.20refactorings.html#200563997">(Jun 11 2020 at 15:55)</a>:</h4>
<p>julian-seward1 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1863#discussion_r438885380">PR Review Comment</a>:</p>
<blockquote>
<p>Hmm, this renaming hides the fact that the E operand is memory.  <code>.._enc_g_mem_e</code> ?</p>
</blockquote>



<a name="200564674"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231863%20machinst%20x64%3A%20a%20few%20refactorings/near/200564674" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231863.20machinst.20x64.3A.20a.20few.20refactorings.html#200564674">(Jun 11 2020 at 15:58)</a>:</h4>
<p>julian-seward1 edited <a href="https://github.com/bytecodealliance/wasmtime/pull/1863#discussion_r438866800">PR Review Comment</a>.</p>



<a name="200566144"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231863%20machinst%20x64%3A%20a%20few%20refactorings/near/200566144" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231863.20machinst.20x64.3A.20a.20few.20refactorings.html#200566144">(Jun 11 2020 at 16:09)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1863#pullrequestreview-429068998">PR Review</a>.</p>



<a name="200566145"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231863%20machinst%20x64%3A%20a%20few%20refactorings/near/200566145" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231863.20machinst.20x64.3A.20a.20few.20refactorings.html#200566145">(Jun 11 2020 at 16:09)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/1863#discussion_r438904303">PR Review Comment</a>:</p>
<blockquote>
<p>Sorry, i should have commented a bit in the commit message. With the <code>available_from</code> function, we can then automate the checks that the instructions are available when comparing to a given SSE level. So this could be used to dynamically (at runtime) check that we only use allowed instructions, as well as selecting instructions based on the real SSE level.</p>
<p>So it's slightly more indirection, but with this check (to come in a subsequent pull request), there's no way it can be misused. In terms of developer experience, in most modern editors, this is a "jump to definition" then grep for "available_from", which is not too bad (and should not be done so often). Overall I found better to have something that could be probed and checked programmatically rather than a "visual" check that's subject to operators errors :)</p>
<p>With this new information, do you agree with the current form, or do you strongly feel about reverting it?</p>
</blockquote>



<a name="200566405"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231863%20machinst%20x64%3A%20a%20few%20refactorings/near/200566405" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231863.20machinst.20x64.3A.20a.20few.20refactorings.html#200566405">(Jun 11 2020 at 16:11)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1863#pullrequestreview-429070702">PR Review</a>.</p>



<a name="200566406"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231863%20machinst%20x64%3A%20a%20few%20refactorings/near/200566406" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231863.20machinst.20x64.3A.20a.20few.20refactorings.html#200566406">(Jun 11 2020 at 16:11)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/1863#discussion_r438905508">PR Review Comment</a>:</p>
<blockquote>
<p>I see. What about <code>SseRmIOpcode</code> (with capital I), to indicate it is its own operand? Or in a more verbose way, <code>SseRmImmOpcode</code>?</p>
</blockquote>



<a name="200566513"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231863%20machinst%20x64%3A%20a%20few%20refactorings/near/200566513" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231863.20machinst.20x64.3A.20a.20few.20refactorings.html#200566513">(Jun 11 2020 at 16:12)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/1863#discussion_r438906106">PR Review Comment</a>:</p>
<blockquote>
<p>There were two TODOs (removed in this patch) that said that two <code>int_reg_enc</code> calls should really be replaced with a new <code>reg_enc</code>, because registers that could flow in could be either GPRs or SSE. Hence this new function.</p>
</blockquote>



<a name="200566514"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231863%20machinst%20x64%3A%20a%20few%20refactorings/near/200566514" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231863.20machinst.20x64.3A.20a.20few.20refactorings.html#200566514">(Jun 11 2020 at 16:12)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1863#pullrequestreview-429071434">PR Review</a>.</p>



<a name="200566605"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231863%20machinst%20x64%3A%20a%20few%20refactorings/near/200566605" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231863.20machinst.20x64.3A.20a.20few.20refactorings.html#200566605">(Jun 11 2020 at 16:12)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1863#pullrequestreview-429071770">PR Review</a>.</p>



<a name="200566606"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231863%20machinst%20x64%3A%20a%20few%20refactorings/near/200566606" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231863.20machinst.20x64.3A.20a.20few.20refactorings.html#200566606">(Jun 11 2020 at 16:12)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/1863#discussion_r438906409">PR Review Comment</a>:</p>
<blockquote>
<p>This is preexisting :-) Maybe "a given prefix" would make more sense here?</p>
</blockquote>



<a name="200566633"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231863%20machinst%20x64%3A%20a%20few%20refactorings/near/200566633" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231863.20machinst.20x64.3A.20a.20few.20refactorings.html#200566633">(Jun 11 2020 at 16:12)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1863#pullrequestreview-429071904">PR Review</a>.</p>



<a name="200566634"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231863%20machinst%20x64%3A%20a%20few%20refactorings/near/200566634" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231863.20machinst.20x64.3A.20a.20few.20refactorings.html#200566634">(Jun 11 2020 at 16:12)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/1863#discussion_r438906499">PR Review Comment</a>:</p>
<blockquote>
<p>Sure!</p>
</blockquote>



<a name="200566934"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231863%20machinst%20x64%3A%20a%20few%20refactorings/near/200566934" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231863.20machinst.20x64.3A.20a.20few.20refactorings.html#200566934">(Jun 11 2020 at 16:14)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1863#pullrequestreview-429073648">PR Review</a>.</p>



<a name="200566936"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231863%20machinst%20x64%3A%20a%20few%20refactorings/near/200566936" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231863.20machinst.20x64.3A.20a.20few.20refactorings.html#200566936">(Jun 11 2020 at 16:14)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/1863#discussion_r438907765">PR Review Comment</a>:</p>
<blockquote>
<p>Hmm, my memories of x86 told me that SIB could only be used with a memory operand, so the presence of "sib" in the name implied a memory operand. Besides, I was trying to shorten the name a bit :-) But yeah, I could add it back and it wouldn't be too terrible.</p>
</blockquote>



<a name="200567481"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231863%20machinst%20x64%3A%20a%20few%20refactorings/near/200567481" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231863.20machinst.20x64.3A.20a.20few.20refactorings.html#200567481">(Jun 11 2020 at 16:18)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1863#pullrequestreview-429077309">PR Review</a>.</p>



<a name="200567482"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231863%20machinst%20x64%3A%20a%20few%20refactorings/near/200567482" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231863.20machinst.20x64.3A.20a.20few.20refactorings.html#200567482">(Jun 11 2020 at 16:18)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/1863#discussion_r438910738">PR Review Comment</a>:</p>
<blockquote>
<p>I thought I kept this distinction with the "enc" that's before "ge", and "reg" before "ge" in the other variants, but I see that I used "rm" for the Reg/Addr variant of <code>emit_modrm_sib_enc_ge</code>. Let's discuss it offline.</p>
</blockquote>



<a name="200572346"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231863%20machinst%20x64%3A%20a%20few%20refactorings/near/200572346" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231863.20machinst.20x64.3A.20a.20few.20refactorings.html#200572346">(Jun 11 2020 at 16:54)</a>:</h4>
<p>bnjbvr updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1863">PR #1863</a> from <code>x64</code> to <code>master</code>:</p>
<blockquote>
<p>This renames and encapsulates some concepts a bit more; no functional changes have been done, as confirmed by the tests still passing :-)</p>
</blockquote>



<a name="200572363"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231863%20machinst%20x64%3A%20a%20few%20refactorings/near/200572363" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231863.20machinst.20x64.3A.20a.20few.20refactorings.html#200572363">(Jun 11 2020 at 16:54)</a>:</h4>
<p><strong>bnjbvr</strong> requested <a href="https://github.com/julian-seward1">julian-seward1</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/1863">PR #1863</a>.</p>



<a name="200572434"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231863%20machinst%20x64%3A%20a%20few%20refactorings/near/200572434" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231863.20machinst.20x64.3A.20a.20few.20refactorings.html#200572434">(Jun 11 2020 at 16:55)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1863#pullrequestreview-429105633">PR Review</a>.</p>



<a name="200572435"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231863%20machinst%20x64%3A%20a%20few%20refactorings/near/200572435" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231863.20machinst.20x64.3A.20a.20few.20refactorings.html#200572435">(Jun 11 2020 at 16:55)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/1863#discussion_r438932457">PR Review Comment</a>:</p>
<blockquote>
<p>We settle on <code>emit_std_{enc,reg}_{mem,reg}</code> variants here.</p>
</blockquote>



<a name="200697247"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231863%20machinst%20x64%3A%20a%20few%20refactorings/near/200697247" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231863.20machinst.20x64.3A.20a.20few.20refactorings.html#200697247">(Jun 12 2020 at 17:09)</a>:</h4>
<p>bnjbvr updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1863">PR #1863</a> from <code>x64</code> to <code>master</code>:</p>
<blockquote>
<p>This renames and encapsulates some concepts a bit more; no functional changes have been done, as confirmed by the tests still passing :-)</p>
</blockquote>



<a name="200699243"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231863%20machinst%20x64%3A%20a%20few%20refactorings/near/200699243" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231863.20machinst.20x64.3A.20a.20few.20refactorings.html#200699243">(Jun 12 2020 at 17:26)</a>:</h4>
<p>bnjbvr updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1863">PR #1863</a> from <code>x64</code> to <code>master</code>:</p>
<blockquote>
<p>This renames and encapsulates some concepts a bit more; no functional changes have been done, as confirmed by the tests still passing :-)</p>
</blockquote>



<a name="200865580"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231863%20machinst%20x64%3A%20a%20few%20refactorings/near/200865580" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231863.20machinst.20x64.3A.20a.20few.20refactorings.html#200865580">(Jun 15 2020 at 09:17)</a>:</h4>
<p>julian-seward1 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1863#pullrequestreview-430463832">PR Review</a>.</p>



<a name="200865581"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231863%20machinst%20x64%3A%20a%20few%20refactorings/near/200865581" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231863.20machinst.20x64.3A.20a.20few.20refactorings.html#200865581">(Jun 15 2020 at 09:17)</a>:</h4>
<p>julian-seward1 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1863#discussion_r440040213">PR Review Comment</a>:</p>
<blockquote>
<p>That still doesn't make clear that the imm isn't an operand.  How about <code>SseRmExtendedOpcode</code> ?</p>
</blockquote>



<a name="200865638"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231863%20machinst%20x64%3A%20a%20few%20refactorings/near/200865638" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231863.20machinst.20x64.3A.20a.20few.20refactorings.html#200865638">(Jun 15 2020 at 09:17)</a>:</h4>
<p>julian-seward1 edited <a href="https://github.com/bytecodealliance/wasmtime/pull/1863#discussion_r440040213">PR Review Comment</a>.</p>



<a name="200868234"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231863%20machinst%20x64%3A%20a%20few%20refactorings/near/200868234" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231863.20machinst.20x64.3A.20a.20few.20refactorings.html#200868234">(Jun 15 2020 at 09:45)</a>:</h4>
<p>julian-seward1 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1863#pullrequestreview-430484372">PR Review</a>.</p>



<a name="200868236"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231863%20machinst%20x64%3A%20a%20few%20refactorings/near/200868236" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231863.20machinst.20x64.3A.20a.20few.20refactorings.html#200868236">(Jun 15 2020 at 09:45)</a>:</h4>
<p>julian-seward1 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1863#pullrequestreview-430484372">PR Review</a>.</p>



<a name="200868237"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231863%20machinst%20x64%3A%20a%20few%20refactorings/near/200868237" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231863.20machinst.20x64.3A.20a.20few.20refactorings.html#200868237">(Jun 15 2020 at 09:45)</a>:</h4>
<p>julian-seward1 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1863#discussion_r440056103">PR Review Comment</a>:</p>
<blockquote>
<p>Actually .. thinking about this more .. I don't think there is any point in having these be separate from the plain <code>SseOpcode</code>.  They are "just more" SSE* instructions and the only difference is that the encoding of the instruction has an extra byte, which IIRC is always right at the end of the instruction.  So I think you should merge these into <code>SseOpcode</code> and delete <code>SseRmiOpcode</code>.  (w/ apologies for changing my story on this)</p>
</blockquote>



<a name="200891310"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231863%20machinst%20x64%3A%20a%20few%20refactorings/near/200891310" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231863.20machinst.20x64.3A.20a.20few.20refactorings.html#200891310">(Jun 15 2020 at 13:52)</a>:</h4>
<p>bnjbvr updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1863">PR #1863</a> from <code>x64</code> to <code>master</code>:</p>
<blockquote>
<p>This renames and encapsulates some concepts a bit more; no functional changes have been done, as confirmed by the tests still passing :-)</p>
</blockquote>



<a name="200891323"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231863%20machinst%20x64%3A%20a%20few%20refactorings/near/200891323" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231863.20machinst.20x64.3A.20a.20few.20refactorings.html#200891323">(Jun 15 2020 at 13:52)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1863#pullrequestreview-430664345">PR Review</a>.</p>



<a name="200891325"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231863%20machinst%20x64%3A%20a%20few%20refactorings/near/200891325" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231863.20machinst.20x64.3A.20a.20few.20refactorings.html#200891325">(Jun 15 2020 at 13:52)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/1863#discussion_r440191352">PR Review Comment</a>:</p>
<blockquote>
<p>Discussed on irc and Julian agreed with this, resolving.</p>
</blockquote>



<a name="200892338"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231863%20machinst%20x64%3A%20a%20few%20refactorings/near/200892338" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231863.20machinst.20x64.3A.20a.20few.20refactorings.html#200892338">(Jun 15 2020 at 14:00)</a>:</h4>
<p>bnjbvr updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1863">PR #1863</a> from <code>x64</code> to <code>master</code>:</p>
<blockquote>
<p>This renames and encapsulates some concepts a bit more; no functional changes have been done, as confirmed by the tests still passing :-)</p>
</blockquote>



<a name="200897839"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231863%20machinst%20x64%3A%20a%20few%20refactorings/near/200897839" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231863.20machinst.20x64.3A.20a.20few.20refactorings.html#200897839">(Jun 15 2020 at 14:39)</a>:</h4>
<p>bnjbvr merged <a href="https://github.com/bytecodealliance/wasmtime/pull/1863">PR #1863</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>