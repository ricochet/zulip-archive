<html>
<head><meta charset="utf-8"><title>wasmtime / Issue #2666 Panic &quot;ABI argument v5 should be i... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232666.20Panic.20.22ABI.20argument.20v5.20should.20be.20i.2E.2E.2E.html">wasmtime / Issue #2666 Panic &quot;ABI argument v5 should be i...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="226851391"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232666%20Panic%20%22ABI%20argument%20v5%20should%20be%20i.../near/226851391" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232666.20Panic.20.22ABI.20argument.20v5.20should.20be.20i.2E.2E.2E.html#226851391">(Feb 18 2021 at 17:55)</a>:</h4>
<p>alexcrichton opened <a href="https://github.com/bytecodealliance/wasmtime/issues/2666">Issue #2666</a>:</p>
<blockquote>
<p>I was doing a bit of work today to sync rust-lang/rust's wasm simd support with the current spec, but unfortunately the file produced by LLVM couldn't execute in wasmtime due to a panic:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">thread</span><span class="w"> </span><span class="o">'&lt;</span><span class="n">unnamed</span><span class="o">&gt;'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">'</span><span class="na">ABI</span><span class="w"> </span><span class="n">argument</span><span class="w"> </span><span class="n">v5</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">register</span><span class="o">'</span><span class="p">,</span><span class="w"> </span><span class="n">cranelift</span><span class="o">/</span><span class="n">codegen</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">regalloc</span><span class="o">/</span><span class="n">coloring</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">409</span>:<span class="mi">21</span><span class="w"></span>
</code></pre></div>
<p>This can be reproduced with <a href="https://github.com/bytecodealliance/wasmtime/files/6004823/core_arch-0fbe1ece0f9fbcb5.wasm.gz">this wasm file</a> by running:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">core_arch</span><span class="o">-</span><span class="mi">0</span><span class="n">fbe1ece0f9fbcb5</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span><span class="n">enable</span><span class="o">-</span><span class="n">simd</span><span class="w"></span>
<span class="n">thread</span><span class="w"> </span><span class="o">'&lt;</span><span class="n">unnamed</span><span class="o">&gt;'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">'</span><span class="na">ABI</span><span class="w"> </span><span class="n">argument</span><span class="w"> </span><span class="n">v5</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">register</span><span class="o">'</span><span class="p">,</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">acrichton</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">codegen</span><span class="o">-</span><span class="mf">0.70.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">regalloc</span><span class="o">/</span><span class="n">coloring</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">409</span>:<span class="mi">21</span><span class="w"></span>
<span class="n">note</span>: <span class="nc">run</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="err">`</span><span class="n">RUST_BACKTRACE</span><span class="o">=</span><span class="mi">1</span><span class="err">`</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">display</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">backtrace</span><span class="w"></span>
<span class="n">thread</span><span class="w"> </span><span class="o">'&lt;</span><span class="n">unnamed</span><span class="o">&gt;'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">'</span><span class="na">ABI</span><span class="w"> </span><span class="n">argument</span><span class="w"> </span><span class="n">v4</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">register</span><span class="o">'</span><span class="p">,</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">acrichton</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">codegen</span><span class="o">-</span><span class="mf">0.70.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">regalloc</span><span class="o">/</span><span class="n">coloring</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">409</span>:<span class="mi">21</span><span class="w"></span>
<span class="n">thread</span><span class="w"> </span><span class="o">'&lt;</span><span class="n">unnamed</span><span class="o">&gt;'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">'</span><span class="na">ABI</span><span class="w"> </span><span class="n">argument</span><span class="w"> </span><span class="n">v5</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">register</span><span class="o">'</span><span class="p">,</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">acrichton</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">codegen</span><span class="o">-</span><span class="mf">0.70.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">regalloc</span><span class="o">/</span><span class="n">coloring</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">409</span>:<span class="mi">21</span><span class="w"></span>
</code></pre></div>
<p>Note that I'm testing the main branch of the repo as-of-now which means the fix for <a href="https://github.com/bytecodealliance/wasmtime/pull/2658">https://github.com/bytecodealliance/wasmtime/pull/2658</a> didn't cover this case as well.</p>
</blockquote>



<a name="226851875"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232666%20Panic%20%22ABI%20argument%20v5%20should%20be%20i.../near/226851875" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232666.20Panic.20.22ABI.20argument.20v5.20should.20be.20i.2E.2E.2E.html#226851875">(Feb 18 2021 at 17:58)</a>:</h4>
<p>abrown <a href="https://github.com/bytecodealliance/wasmtime/issues/2666#issuecomment-781528858">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2666">Issue #2666</a>:</p>
<blockquote>
<p>On x64?</p>
</blockquote>



<a name="226852086"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232666%20Panic%20%22ABI%20argument%20v5%20should%20be%20i.../near/226852086" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232666.20Panic.20.22ABI.20argument.20v5.20should.20be.20i.2E.2E.2E.html#226852086">(Feb 18 2021 at 18:00)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/2666#issuecomment-781529999">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2666">Issue #2666</a>:</p>
<blockquote>
<p>It looks like this doesn't happen on x64, only on the old backend. Do we not care enough about the old backend to fix it?</p>
<p>It also looks like there's unsupported opcodes in that file as well so it won't finish running anyway (the new backend stops at a wasm validation error for unknown opcodes)</p>
</blockquote>



<a name="226853196"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232666%20Panic%20%22ABI%20argument%20v5%20should%20be%20i.../near/226853196" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232666.20Panic.20.22ABI.20argument.20v5.20should.20be.20i.2E.2E.2E.html#226853196">(Feb 18 2021 at 18:06)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/issues/2666#issuecomment-781534207">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2666">Issue #2666</a>:</p>
<blockquote>
<p>It seems to me that this tradeoff (fix vs. wait) depends on relative timings. The switch to the new backend as Wasmtime's default will hopefully happen soon; it depends on a little more implementation (Windows support) which I'm hoping to get to next week. However if this becomes a blocker to fully supporting SIMD then we could certainly dig into the old regalloc. There might be significant ramp-up time there, though. It seems to me that the more important question is whether the old regalloc continues to generate <em>correct</em> code when it doesn't panic (if not, we need to jump on it right away); otherwise on balance I'd say we should just wait for the transition. Thoughts?</p>
</blockquote>



<a name="226858522"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232666%20Panic%20%22ABI%20argument%20v5%20should%20be%20i.../near/226858522" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232666.20Panic.20.22ABI.20argument.20v5.20should.20be.20i.2E.2E.2E.html#226858522">(Feb 18 2021 at 18:38)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/2666#issuecomment-781554057">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2666">Issue #2666</a>:</p>
<blockquote>
<p>Oh this isn't urgent at all, I mostly wanted to just report the issue in case it wasn't already known. If it's known that x64 fixes this and x86 isn't expected to get fixed any time soon, then I think closing this is quite reasonable!</p>
</blockquote>



<a name="226858523"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232666%20Panic%20%22ABI%20argument%20v5%20should%20be%20i.../near/226858523" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232666.20Panic.20.22ABI.20argument.20v5.20should.20be.20i.2E.2E.2E.html#226858523">(Feb 18 2021 at 18:38)</a>:</h4>
<p>alexcrichton closed <a href="https://github.com/bytecodealliance/wasmtime/issues/2666">Issue #2666</a>:</p>
<blockquote>
<p>I was doing a bit of work today to sync rust-lang/rust's wasm simd support with the current spec, but unfortunately the file produced by LLVM couldn't execute in wasmtime due to a panic:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">thread</span><span class="w"> </span><span class="o">'&lt;</span><span class="n">unnamed</span><span class="o">&gt;'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">'</span><span class="na">ABI</span><span class="w"> </span><span class="n">argument</span><span class="w"> </span><span class="n">v5</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">register</span><span class="o">'</span><span class="p">,</span><span class="w"> </span><span class="n">cranelift</span><span class="o">/</span><span class="n">codegen</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">regalloc</span><span class="o">/</span><span class="n">coloring</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">409</span>:<span class="mi">21</span><span class="w"></span>
</code></pre></div>
<p>This can be reproduced with <a href="https://github.com/bytecodealliance/wasmtime/files/6004823/core_arch-0fbe1ece0f9fbcb5.wasm.gz">this wasm file</a> by running:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">core_arch</span><span class="o">-</span><span class="mi">0</span><span class="n">fbe1ece0f9fbcb5</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span><span class="n">enable</span><span class="o">-</span><span class="n">simd</span><span class="w"></span>
<span class="n">thread</span><span class="w"> </span><span class="o">'&lt;</span><span class="n">unnamed</span><span class="o">&gt;'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">'</span><span class="na">ABI</span><span class="w"> </span><span class="n">argument</span><span class="w"> </span><span class="n">v5</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">register</span><span class="o">'</span><span class="p">,</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">acrichton</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">codegen</span><span class="o">-</span><span class="mf">0.70.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">regalloc</span><span class="o">/</span><span class="n">coloring</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">409</span>:<span class="mi">21</span><span class="w"></span>
<span class="n">note</span>: <span class="nc">run</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="err">`</span><span class="n">RUST_BACKTRACE</span><span class="o">=</span><span class="mi">1</span><span class="err">`</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">display</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">backtrace</span><span class="w"></span>
<span class="n">thread</span><span class="w"> </span><span class="o">'&lt;</span><span class="n">unnamed</span><span class="o">&gt;'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">'</span><span class="na">ABI</span><span class="w"> </span><span class="n">argument</span><span class="w"> </span><span class="n">v4</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">register</span><span class="o">'</span><span class="p">,</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">acrichton</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">codegen</span><span class="o">-</span><span class="mf">0.70.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">regalloc</span><span class="o">/</span><span class="n">coloring</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">409</span>:<span class="mi">21</span><span class="w"></span>
<span class="n">thread</span><span class="w"> </span><span class="o">'&lt;</span><span class="n">unnamed</span><span class="o">&gt;'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">'</span><span class="na">ABI</span><span class="w"> </span><span class="n">argument</span><span class="w"> </span><span class="n">v5</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">register</span><span class="o">'</span><span class="p">,</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">acrichton</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">codegen</span><span class="o">-</span><span class="mf">0.70.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">regalloc</span><span class="o">/</span><span class="n">coloring</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">409</span>:<span class="mi">21</span><span class="w"></span>
</code></pre></div>
<p>Note that I'm testing the main branch of the repo as-of-now which means the fix for <a href="https://github.com/bytecodealliance/wasmtime/pull/2658">https://github.com/bytecodealliance/wasmtime/pull/2658</a> didn't cover this case as well.</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>