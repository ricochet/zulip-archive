<html>
<head><meta charset="utf-8"><title>wasmtime / PR #9682 Put MemoryPool and MmapMemory mmaps b... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239682.20Put.20MemoryPool.20and.20MmapMemory.20mmaps.20b.2E.2E.2E.html">wasmtime / PR #9682 Put MemoryPool and MmapMemory mmaps b...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="484453364"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239682%20Put%20MemoryPool%20and%20MmapMemory%20mmaps%20b.../near/484453364" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239682.20Put.20MemoryPool.20and.20MmapMemory.20mmaps.20b.2E.2E.2E.html#484453364">(Nov 26 2024 at 08:04)</a>:</h4>
<p><strong>sunshowers</strong> requested <a href="https://github.com/pchickey">pchickey</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/9682">PR #9682</a>.</p>



<a name="484453367"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239682%20Put%20MemoryPool%20and%20MmapMemory%20mmaps%20b.../near/484453367" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239682.20Put.20MemoryPool.20and.20MmapMemory.20mmaps.20b.2E.2E.2E.html#484453367">(Nov 26 2024 at 08:04)</a>:</h4>
<p>sunshowers opened <a href="https://github.com/bytecodealliance/wasmtime/pull/9682">PR #9682</a> from <code>sunshowers:move-arc</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>In upcoming work we're going to centralize memory management inside <code>Mmap</code>.  In order to do that, we need memory that logically borrows from the <code>Mmap</code> to have access to it. That turns out to be possible in some situations but very difficult in others (see #9681 for an attempt that was a real hassle to get working).</p>
<p>To prepare for this work, start moving these uses to be behind <code>Arc</code>. These aren't cloned at the moment, but they will be in the future.<br>
</p>
</blockquote>



<a name="484453368"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239682%20Put%20MemoryPool%20and%20MmapMemory%20mmaps%20b.../near/484453368" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239682.20Put.20MemoryPool.20and.20MmapMemory.20mmaps.20b.2E.2E.2E.html#484453368">(Nov 26 2024 at 08:04)</a>:</h4>
<p><strong>sunshowers</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/9682">PR #9682</a>.</p>



<a name="484453689"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239682%20Put%20MemoryPool%20and%20MmapMemory%20mmaps%20b.../near/484453689" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239682.20Put.20MemoryPool.20and.20MmapMemory.20mmaps.20b.2E.2E.2E.html#484453689">(Nov 26 2024 at 08:06)</a>:</h4>
<p>sunshowers submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9682#pullrequestreview-2460697942">PR review</a>.</p>



<a name="484453690"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239682%20Put%20MemoryPool%20and%20MmapMemory%20mmaps%20b.../near/484453690" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239682.20Put.20MemoryPool.20and.20MmapMemory.20mmaps.20b.2E.2E.2E.html#484453690">(Nov 26 2024 at 08:06)</a>:</h4>
<p>sunshowers created <a href="https://github.com/bytecodealliance/wasmtime/pull/9682#discussion_r1857998933">PR review comment</a>:</p>
<blockquote>
<p>This was somewhat annoying but I think this approach makes sense -- basically ensure that any <code>&amp;mut</code> references are very short-lived as required by Rust's <a href="https://doc.rust-lang.org/std/ptr/index.html#pointer-to-reference-conversion">aliasing rules</a>.</p>
</blockquote>



<a name="484453940"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239682%20Put%20MemoryPool%20and%20MmapMemory%20mmaps%20b.../near/484453940" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239682.20Put.20MemoryPool.20and.20MmapMemory.20mmaps.20b.2E.2E.2E.html#484453940">(Nov 26 2024 at 08:08)</a>:</h4>
<p>sunshowers edited <a href="https://github.com/bytecodealliance/wasmtime/pull/9682">PR #9682</a>:</p>
<blockquote>
<p>In upcoming work we're going to centralize memory management inside <code>Mmap</code>.  In order to do that, we need memory that logically borrows from the <code>Mmap</code> to have access to it. That turns out to be possible to do by passing in <code>&amp;Mmap</code> in some situations but very difficult in others (see #9681 for an attempt that was a real hassle to get working and still had a bunch of incomplete questions within it).</p>
<p>To prepare for this work, start moving these uses to be behind <code>Arc</code>. These aren't cloned at the moment, but they will be in the future.<br>
</p>
</blockquote>



<a name="484544650"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239682%20Put%20MemoryPool%20and%20MmapMemory%20mmaps%20b.../near/484544650" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239682.20Put.20MemoryPool.20and.20MmapMemory.20mmaps.20b.2E.2E.2E.html#484544650">(Nov 26 2024 at 15:50)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/9682#issuecomment-2501221999">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/9682">PR #9682</a>:</p>
<blockquote>
<p>I think this can make sense but I'm having a hard time understanding the end goal without the second piece here of using the <code>Arc</code> itself. Would you be ok delaying merging this until the second half is in place? It'd be easier for me to review once that's there (I'm ok reviewing the two together as two separate commits myself)</p>
</blockquote>



<a name="485886864"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239682%20Put%20MemoryPool%20and%20MmapMemory%20mmaps%20b.../near/485886864" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239682.20Put.20MemoryPool.20and.20MmapMemory.20mmaps.20b.2E.2E.2E.html#485886864">(Dec 03 2024 at 15:47)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9682#pullrequestreview-2476093573">PR review</a>:</p>
<blockquote>
<p>Ok thanks for #9687! That looks reasonable to me so let's go ahead and land this <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span> </p>
</blockquote>



<a name="485892178"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239682%20Put%20MemoryPool%20and%20MmapMemory%20mmaps%20b.../near/485892178" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239682.20Put.20MemoryPool.20and.20MmapMemory.20mmaps.20b.2E.2E.2E.html#485892178">(Dec 03 2024 at 16:07)</a>:</h4>
<p>alexcrichton merged <a href="https://github.com/bytecodealliance/wasmtime/pull/9682">PR #9682</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>