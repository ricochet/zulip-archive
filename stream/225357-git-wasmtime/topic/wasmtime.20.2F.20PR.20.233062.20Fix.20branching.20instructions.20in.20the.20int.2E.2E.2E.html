<html>
<head><meta charset="utf-8"><title>wasmtime / PR #3062 Fix branching instructions in the int... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html">wasmtime / PR #3062 Fix branching instructions in the int...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="244875867"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/244875867" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#244875867">(Jul 04 2021 at 20:23)</a>:</h4>
<p>afonso360 opened <a href="https://github.com/bytecodealliance/wasmtime/pull/3062">PR #3062</a> from <code>interpreter-branches</code> to <code>main</code>:</p>
<blockquote>
<p>Hey, branches were causing the interpreter to crash.</p>
</blockquote>



<a name="244876895"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/244876895" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#244876895">(Jul 04 2021 at 20:49)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3062#pullrequestreview-698707151">PR review</a>.</p>



<a name="244876896"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/244876896" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#244876896">(Jul 04 2021 at 20:49)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/3062#discussion_r663555044">PR review comment</a>:</p>
<blockquote>
<p>Fallthrough will likely be removed together with the old backend framework.</p>
</blockquote>



<a name="244878792"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/244878792" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#244878792">(Jul 04 2021 at 21:38)</a>:</h4>
<p>afonso360 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3062">PR #3062</a> from <code>interpreter-branches</code> to <code>main</code>.</p>



<a name="244908404"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/244908404" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#244908404">(Jul 05 2021 at 08:35)</a>:</h4>
<p>afonso360 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3062">PR #3062</a> from <code>interpreter-branches</code> to <code>main</code>.</p>



<a name="245099729"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/245099729" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#245099729">(Jul 06 2021 at 21:15)</a>:</h4>
<p>afonso360 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3062">PR #3062</a> from <code>interpreter-branches</code> to <code>main</code>.</p>



<a name="245102416"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/245102416" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#245102416">(Jul 06 2021 at 21:41)</a>:</h4>
<p>afonso360 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3062">PR #3062</a> from <code>interpreter-branches</code> to <code>main</code>.</p>



<a name="245102886"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/245102886" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#245102886">(Jul 06 2021 at 21:46)</a>:</h4>
<p>afonso360 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3062">PR #3062</a> from <code>interpreter-branches</code> to <code>main</code>.</p>



<a name="245105464"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/245105464" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#245105464">(Jul 06 2021 at 22:15)</a>:</h4>
<p>afonso360 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3062">PR #3062</a> from <code>interpreter-branches</code> to <code>main</code>.</p>



<a name="245206832"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/245206832" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#245206832">(Jul 07 2021 at 16:27)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3062#pullrequestreview-701201575">PR review</a>.</p>



<a name="245206833"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/245206833" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#245206833">(Jul 07 2021 at 16:27)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3062#pullrequestreview-701201575">PR review</a>.</p>



<a name="245206834"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/245206834" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#245206834">(Jul 07 2021 at 16:27)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/3062#discussion_r665519389">PR review comment</a>:</p>
<blockquote>
<p>(But also looking at that issue, I must have thought when I wrote it that we could at least pass <code>b1</code> and <code>b8</code>? Is that not the case anymore?)</p>
</blockquote>



<a name="245206835"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/245206835" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#245206835">(Jul 07 2021 at 16:27)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/3062#discussion_r665526128">PR review comment</a>:</p>
<blockquote>
<p>Hm, not totally sure about how to go about this; seems like there are a few options:</p>
<ul>
<li>keep this as you implemented it, which is a bit more verbose</li>
<li>implement <code>into_bool</code> for integer types, but this may be a bit confusing because for other <code>into_*</code> functions we error when the type doesn't match</li>
<li>implement a <code>ValueConversionKind::ToBoolean</code> and just use <code>arg(0)?.convert(ValueConversionKind::ToBoolean)</code> here; I would probably lean this direction</li>
</ul>
<p>Thoughts?</p>
</blockquote>



<a name="245206836"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/245206836" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#245206836">(Jul 07 2021 at 16:27)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/3062#discussion_r665528642">PR review comment</a>:</p>
<blockquote>
<p>@akirilov-arm, could you take a look at this? I think everything else makes sense but I don't know enough about the aarch64 backend to approve this part.</p>
</blockquote>



<a name="245206837"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/245206837" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#245206837">(Jul 07 2021 at 16:27)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/3062#discussion_r665518651">PR review comment</a>:</p>
<blockquote>
<p>For reference, the issue that fixes this is #2237.</p>
</blockquote>



<a name="245206838"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/245206838" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#245206838">(Jul 07 2021 at 16:27)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/3062#discussion_r665527703">PR review comment</a>:</p>
<blockquote>
<p>Ah, I see... I thought this meant "of" as in "a value of..." but I think it is an abbreviation of "overflows," right? Let's just go with the longer version to avoid confusion.</p>
</blockquote>



<a name="245206839"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/245206839" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#245206839">(Jul 07 2021 at 16:27)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/3062#discussion_r665520218">PR review comment</a>:</p>
<blockquote>
<p>BTW, I really appreciate you adding a bunch more CLIF tests!</p>
</blockquote>



<a name="245211231"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/245211231" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#245211231">(Jul 07 2021 at 17:00)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3062#pullrequestreview-701246703">PR review</a>.</p>



<a name="245211234"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/245211234" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#245211234">(Jul 07 2021 at 17:00)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/3062#discussion_r665553380">PR review comment</a>:</p>
<blockquote>
<p>Could you add some more explanation of this sequence?</p>
<p>I think I understand what's going on here -- we have a 0/1 flag generated by <code>cset</code> that is the actual overflow indicator, then we cause the main compare instruction to subtract that value from <code>INT32_MIN</code>, so we get an overflow (or underflow actually) on the subtract-as-compare. But it's somewhat difficult to work out!</p>
</blockquote>



<a name="245223893"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/245223893" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#245223893">(Jul 07 2021 at 18:37)</a>:</h4>
<p>afonso360 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3062#pullrequestreview-701331892">PR review</a>.</p>



<a name="245223894"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/245223894" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#245223894">(Jul 07 2021 at 18:37)</a>:</h4>
<p>afonso360 created <a href="https://github.com/bytecodealliance/wasmtime/pull/3062#discussion_r665618700">PR review comment</a>:</p>
<blockquote>
<blockquote>
<p>implement into_bool for integer types, but this may be a bit confusing because for other into_* functions we error when the type doesn't match</p>
</blockquote>
<p>I actually started by doing this, but it didn't feel "right" so I changed it.</p>
<p>Yeah, I think the <code>ValueConversionKind</code> is a good way to go, I'll update the PR</p>
</blockquote>



<a name="245226910"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/245226910" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#245226910">(Jul 07 2021 at 18:59)</a>:</h4>
<p>afonso360 created <a href="https://github.com/bytecodealliance/wasmtime/pull/3062#discussion_r665632585">PR review comment</a>:</p>
<blockquote>
<p>Yes,</p>
<p>The "main" overflow check is the <code>sub</code> and <code>cmp</code> with the extends, however this produces the result as a <code>ne</code> flag.</p>
<p>However the main issue is that the caller of this function is expecting to use the <code>vs</code> flag, and we (currently) don't have a way to tell it to use another flag. So we set the overflow flag by subtracting either 1 / 0 from INT32_MIN.</p>
<p>I'll update the comments to reflect this.</p>
</blockquote>



<a name="245226912"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/245226912" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#245226912">(Jul 07 2021 at 18:59)</a>:</h4>
<p>afonso360 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3062#pullrequestreview-701349706">PR review</a>.</p>



<a name="245227846"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/245227846" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#245227846">(Jul 07 2021 at 19:06)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3062#pullrequestreview-701355951">PR review</a>.</p>



<a name="245227848"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/245227848" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#245227848">(Jul 07 2021 at 19:06)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/3062#discussion_r665637115">PR review comment</a>:</p>
<blockquote>
<p>FWIW, that sounds like a reasonable refactor, if you'd prefer to go that way: return the (possibly modified) condition flag and use that in the caller. I think that at every place where we use <code>lower_icmp</code>, we have full control over what condition code we actually use, so this should be pretty reasonable, and would improve the generated code.</p>
</blockquote>



<a name="245230230"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/245230230" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#245230230">(Jul 07 2021 at 19:26)</a>:</h4>
<p>akirilov-arm submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3062#pullrequestreview-701371797">PR review</a>.</p>



<a name="245230231"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/245230231" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#245230231">(Jul 07 2021 at 19:26)</a>:</h4>
<p>akirilov-arm created <a href="https://github.com/bytecodealliance/wasmtime/pull/3062#discussion_r665648964">PR review comment</a>:</p>
<blockquote>
<p>... and would also simplify the explanation that @cfallin has asked for :-). My vote would go towards refactoring as well.</p>
</blockquote>



<a name="245232073"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/245232073" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#245232073">(Jul 07 2021 at 19:41)</a>:</h4>
<p>afonso360 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3062#pullrequestreview-701382562">PR review</a>.</p>



<a name="245232074"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/245232074" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#245232074">(Jul 07 2021 at 19:41)</a>:</h4>
<p>afonso360 created <a href="https://github.com/bytecodealliance/wasmtime/pull/3062#discussion_r665657148">PR review comment</a>:</p>
<blockquote>
<p>Tested this again now, curiously, it works if we enable just the <code>interpret</code> test, but stops working with the <code>run</code> test.</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">test</span><span class="w"> </span><span class="n">interpret</span><span class="w"></span>
<span class="n">test</span><span class="w"> </span><span class="n">run</span><span class="w"></span>
<span class="n">target</span><span class="w"> </span><span class="n">x86_64</span><span class="w"> </span><span class="n">machinst</span><span class="w"></span>

<span class="n">function</span><span class="w"> </span><span class="o">%</span><span class="n">brnz_b1</span><span class="p">(</span><span class="n">b1</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">b1</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="n">block0</span><span class="p">(</span><span class="n">v1</span>: <span class="nc">b1</span><span class="p">)</span>:
    <span class="nc">brnz</span><span class="w"> </span><span class="n">v1</span><span class="p">,</span><span class="w"> </span><span class="n">block1</span><span class="w"></span>
<span class="w">    </span><span class="n">jump</span><span class="w"> </span><span class="n">block2</span><span class="w"></span>

<span class="n">block1</span>:
    <span class="nc">v2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bconst</span><span class="p">.</span><span class="n">b1</span><span class="w"> </span><span class="kc">true</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">v2</span><span class="w"></span>

<span class="n">block2</span>:
    <span class="nc">v3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bconst</span><span class="p">.</span><span class="n">b1</span><span class="w"> </span><span class="kc">false</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">v3</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="p">;</span><span class="w"> </span><span class="n">run</span>: <span class="o">%</span><span class="n">brnz_b1</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">true</span><span class="w"></span>
<span class="p">;</span><span class="w"> </span><span class="n">run</span>: <span class="o">%</span><span class="n">brnz_b1</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">false</span><span class="w"></span>
</code></pre></div>
<p>We get:</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">     </span><span class="n">Running</span><span class="w"> </span><span class="err">`</span><span class="n">C</span>:<span class="err">\</span><span class="n">Users</span><span class="err">\</span><span class="n">Afonso</span><span class="err">\</span><span class="n">CLionProjects</span><span class="err">\</span><span class="n">wasmtime</span><span class="err">\</span><span class="n">target</span><span class="err">\</span><span class="n">debug</span><span class="err">\</span><span class="n">clif</span><span class="o">-</span><span class="n">util</span><span class="p">.</span><span class="n">exe</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">test</span><span class="p">.</span><span class="n">clif</span><span class="err">`</span><span class="w"></span>
<span class="n">thread</span><span class="w"> </span><span class="o">'</span><span class="na">worker</span><span class="w"> </span>#<span class="mi">0</span><span class="o">'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">'</span><span class="na">argument</span><span class="w"> </span><span class="k">type</span> <span class="nc">mismatch</span>: <span class="nc">b8</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">b1</span><span class="o">'</span><span class="p">,</span><span class="w"> </span><span class="n">cranelift</span><span class="err">\</span><span class="n">filetests</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">function_runner</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">200</span>:<span class="mi">13</span><span class="w"></span>
<span class="n">note</span>: <span class="nc">run</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="err">`</span><span class="n">RUST_BACKTRACE</span><span class="o">=</span><span class="mi">1</span><span class="err">`</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">display</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">backtrace</span><span class="w"></span>
<span class="n">FAIL</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">test</span><span class="p">.</span><span class="n">clif</span>: <span class="nc">panicked</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">worker</span><span class="w"> </span>#<span class="mi">0</span>: <span class="nc">argument</span><span class="w"> </span><span class="k">type</span> <span class="nc">mismatch</span>: <span class="nc">b8</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">b1</span><span class="w"></span>
<span class="mi">1</span><span class="w"> </span><span class="n">tests</span><span class="w"></span>
<span class="n">Error</span>: <span class="mi">1</span><span class="w"> </span><span class="n">failure</span><span class="w"></span>
</code></pre></div><br>
</p>
</blockquote>



<a name="245232268"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/245232268" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#245232268">(Jul 07 2021 at 19:42)</a>:</h4>
<p>afonso360 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3062#pullrequestreview-701383641">PR review</a>.</p>



<a name="245232269"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/245232269" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#245232269">(Jul 07 2021 at 19:42)</a>:</h4>
<p>afonso360 created <a href="https://github.com/bytecodealliance/wasmtime/pull/3062#discussion_r665657985">PR review comment</a>:</p>
<blockquote>
<p>Ok, I'll update into that model instead.</p>
</blockquote>



<a name="245331186"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/245331186" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#245331186">(Jul 08 2021 at 15:36)</a>:</h4>
<p>afonso360 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3062">PR #3062</a> from <code>interpreter-branches</code> to <code>main</code>.</p>



<a name="245334034"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/245334034" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#245334034">(Jul 08 2021 at 15:58)</a>:</h4>
<p>afonso360 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3062#pullrequestreview-702243029">PR review</a>.</p>



<a name="245334035"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/245334035" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#245334035">(Jul 08 2021 at 15:58)</a>:</h4>
<p>afonso360 created <a href="https://github.com/bytecodealliance/wasmtime/pull/3062#discussion_r666324630">PR review comment</a>:</p>
<blockquote>
<p>I'm not 100% happy with how this turned out.</p>
<p>My issue is that this signature implies that we can change the output register, despite us never doing that. However changing <code>IcmpResult</code> into something like:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">enum</span> <span class="nc">IcmpResult</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">Flag</span><span class="p">(</span><span class="n">IntCC</span><span class="p">),</span><span class="w"></span>
<span class="w">    </span><span class="n">Register</span><span class="p">,</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>Also doesn't seem great, because now the output is inconsistent: if you request flag outputs you have to check the result and if you request register outputs you can ignore the result.</p>
<p>Do you guys have any suggestion on how to improve this?</p>
<p>This PR is also getting pretty big on the AArch64 side, if you would like me to separate it into 2 PR's let me know!<br>
</p>
</blockquote>



<a name="245364419"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/245364419" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#245364419">(Jul 08 2021 at 20:03)</a>:</h4>
<p>afonso360 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3062">PR #3062</a> from <code>interpreter-branches</code> to <code>main</code>.</p>



<a name="245498362"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/245498362" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#245498362">(Jul 09 2021 at 21:04)</a>:</h4>
<p><strong>afonso360</strong> requested <a href="https://github.com/cfallin">cfallin</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/3062">PR #3062</a>.</p>



<a name="245498401"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/245498401" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#245498401">(Jul 09 2021 at 21:05)</a>:</h4>
<p><strong>afonso360</strong> requested <a href="https://github.com/abrown">abrown</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/3062">PR #3062</a>.</p>



<a name="245514116"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/245514116" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#245514116">(Jul 09 2021 at 22:44)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3062#pullrequestreview-703431270">PR review</a>.</p>



<a name="245514117"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/245514117" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#245514117">(Jul 09 2021 at 22:44)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/3062#discussion_r667243294">PR review comment</a>:</p>
<blockquote>
<p>Well, I guess we'll just have to fix it all in #2237 <span aria-label="grinning face with smiling eyes" class="emoji emoji-1f601" role="img" title="grinning face with smiling eyes">:grinning_face_with_smiling_eyes:</span> </p>
</blockquote>



<a name="245514190"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/245514190" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#245514190">(Jul 09 2021 at 22:45)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3062#pullrequestreview-703431557">PR review</a>.</p>



<a name="245801579"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/245801579" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#245801579">(Jul 13 2021 at 09:55)</a>:</h4>
<p>afonso360 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3062">PR #3062</a> from <code>interpreter-branches</code> to <code>main</code>.</p>



<a name="245801603"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/245801603" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#245801603">(Jul 13 2021 at 09:55)</a>:</h4>
<p>afonso360 deleted <a href="https://github.com/bytecodealliance/wasmtime/pull/3062#discussion_r666324630">PR review comment</a>.</p>



<a name="245901353"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/245901353" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#245901353">(Jul 13 2021 at 23:10)</a>:</h4>
<p>akirilov-arm submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3062#pullrequestreview-705712961">PR review</a>.</p>



<a name="245901354"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/245901354" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#245901354">(Jul 13 2021 at 23:10)</a>:</h4>
<p>akirilov-arm submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3062#pullrequestreview-705712961">PR review</a>.</p>



<a name="245901355"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/245901355" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#245901355">(Jul 13 2021 at 23:10)</a>:</h4>
<p>akirilov-arm created <a href="https://github.com/bytecodealliance/wasmtime/pull/3062#discussion_r669164152">PR review comment</a>:</p>
<blockquote>
<p>At this point we should operate on <code>Cond</code>, not <code>IntCC</code>. Also, let's call this <code>Condcode</code> instead of <code>Flag</code>.</p>
</blockquote>



<a name="245901356"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/245901356" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#245901356">(Jul 13 2021 at 23:10)</a>:</h4>
<p>akirilov-arm created <a href="https://github.com/bytecodealliance/wasmtime/pull/3062#discussion_r669167043">PR review comment</a>:</p>
<blockquote>
<p>Can we add an assertion that we have not asked for <code>IcmpOutput::Flags</code> in this case?</p>
</blockquote>



<a name="245902027"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/245902027" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#245902027">(Jul 13 2021 at 23:19)</a>:</h4>
<p>akirilov-arm submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3062#pullrequestreview-705722379">PR review</a>.</p>



<a name="245902028"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/245902028" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#245902028">(Jul 13 2021 at 23:19)</a>:</h4>
<p>akirilov-arm created <a href="https://github.com/bytecodealliance/wasmtime/pull/3062#discussion_r669172059">PR review comment</a>:</p>
<blockquote>
<p>Nit - the code structure looks like this:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">  </span><span class="o">..</span><span class="p">.</span><span class="w"></span>
<span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="o">!</span><span class="n">cond</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="o">..</span><span class="p">.</span><span class="w"></span>
<span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="o">..</span><span class="p">.</span><span class="w"></span>
</code></pre></div>
<p>Since you are changing the surrounding code significantly, could you also transform this, so that it does not use a negated condition:</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">  </span><span class="o">..</span><span class="p">.</span><span class="w"></span>
<span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">cond</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="o">..</span><span class="p">.</span><span class="w"></span>
<span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="o">..</span><span class="p">.</span><span class="w"></span>
</code></pre></div><br>
</p>
</blockquote>



<a name="245902215"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/245902215" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#245902215">(Jul 13 2021 at 23:22)</a>:</h4>
<p>akirilov-arm submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3062#pullrequestreview-705723484">PR review</a>.</p>



<a name="245902216"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/245902216" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#245902216">(Jul 13 2021 at 23:22)</a>:</h4>
<p>akirilov-arm created <a href="https://github.com/bytecodealliance/wasmtime/pull/3062#discussion_r669173100">PR review comment</a>:</p>
<blockquote>
<p>I think that there should be just a single block like this one, right before the function returns.</p>
</blockquote>



<a name="245903073"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/245903073" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#245903073">(Jul 13 2021 at 23:34)</a>:</h4>
<p>akirilov-arm submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3062#pullrequestreview-705728601">PR review</a>.</p>



<a name="245903074"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/245903074" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#245903074">(Jul 13 2021 at 23:34)</a>:</h4>
<p>akirilov-arm created <a href="https://github.com/bytecodealliance/wasmtime/pull/3062#discussion_r669177656">PR review comment</a>:</p>
<blockquote>
<p><code>comparison</code></p>
<p>Also, there is no <code>NE</code> flag - it is called <code>Z</code>. However, a better way to phrase this is to say <code>The result of this comparison is either the EQ or NE condition code ...</code>.</p>
</blockquote>



<a name="246158151"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/246158151" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#246158151">(Jul 15 2021 at 21:20)</a>:</h4>
<p>afonso360 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3062#pullrequestreview-707830068">PR review</a>.</p>



<a name="246158152"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/246158152" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#246158152">(Jul 15 2021 at 21:20)</a>:</h4>
<p>afonso360 created <a href="https://github.com/bytecodealliance/wasmtime/pull/3062#discussion_r670813090">PR review comment</a>:</p>
<blockquote>
<p>We should emit the correct results if the caller asked for flags, we emit a <code>subs</code>.</p>
<p>Although, looking at this again, we can probably improve codegen by emitting a <code>sub</code> instead if the caller requested <code>Registers</code>.</p>
<p>I'll change that as well</p>
</blockquote>



<a name="246158362"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/246158362" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#246158362">(Jul 15 2021 at 21:22)</a>:</h4>
<p>afonso360 edited <a href="https://github.com/bytecodealliance/wasmtime/pull/3062#discussion_r670813090">PR review comment</a>.</p>



<a name="246158524"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/246158524" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#246158524">(Jul 15 2021 at 21:24)</a>:</h4>
<p>afonso360 deleted <a href="https://github.com/bytecodealliance/wasmtime/pull/3062#discussion_r670813090">PR review comment</a>.</p>



<a name="246168514"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/246168514" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#246168514">(Jul 15 2021 at 23:25)</a>:</h4>
<p>afonso360 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3062">PR #3062</a> from <code>interpreter-branches</code> to <code>main</code>.</p>



<a name="246168518"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/246168518" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#246168518">(Jul 15 2021 at 23:25)</a>:</h4>
<p>afonso360 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3062#pullrequestreview-707893359">PR review</a>.</p>



<a name="246168519"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/246168519" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#246168519">(Jul 15 2021 at 23:25)</a>:</h4>
<p>afonso360 created <a href="https://github.com/bytecodealliance/wasmtime/pull/3062#discussion_r670866092">PR review comment</a>:</p>
<blockquote>
<p>We don't do this everywhere, namely I128 gt/lt/etc and vector icmps, so I don't know how well this ends up being in practice. But I pushed a commit with this at the end, let me know which way you prefer it.</p>
</blockquote>



<a name="246168676"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/246168676" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#246168676">(Jul 15 2021 at 23:28)</a>:</h4>
<p>afonso360 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3062">PR #3062</a> from <code>interpreter-branches</code> to <code>main</code>.</p>



<a name="246169854"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/246169854" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#246169854">(Jul 15 2021 at 23:46)</a>:</h4>
<p>akirilov-arm submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3062#pullrequestreview-707901122">PR review</a>.</p>



<a name="246169855"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/246169855" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#246169855">(Jul 15 2021 at 23:46)</a>:</h4>
<p>akirilov-arm created <a href="https://github.com/bytecodealliance/wasmtime/pull/3062#discussion_r670873050">PR review comment</a>:</p>
<blockquote>
<p>Are you saying that there are cases in which we pass <code>IcmpOutput::Flags</code>, but we return the result in a register (or vice versa)?</p>
</blockquote>



<a name="246173213"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/246173213" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#246173213">(Jul 16 2021 at 00:39)</a>:</h4>
<p>akirilov-arm submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3062#pullrequestreview-707904245">PR review</a>.</p>



<a name="246173214"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/246173214" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#246173214">(Jul 16 2021 at 00:39)</a>:</h4>
<p>akirilov-arm created <a href="https://github.com/bytecodealliance/wasmtime/pull/3062#discussion_r670886335">PR review comment</a>:</p>
<blockquote>
<p>This should be <code>CondCode</code> as well, for consistency with <code>IcmpResult</code>.</p>
</blockquote>



<a name="246173215"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/246173215" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#246173215">(Jul 16 2021 at 00:39)</a>:</h4>
<p>akirilov-arm submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3062#pullrequestreview-707904245">PR review</a>.</p>



<a name="246173216"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/246173216" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#246173216">(Jul 16 2021 at 00:39)</a>:</h4>
<p>akirilov-arm created <a href="https://github.com/bytecodealliance/wasmtime/pull/3062#discussion_r670875932">PR review comment</a>:</p>
<blockquote>
<p>Actually they are not - there is a very small number of optional instructions that perform partial NZCV updates, but they are quite specialized, so I do not anticipate that we are ever going to need them in Cranelift.</p>
<p>That's why I also suggested the term "condition code" instead of "flag".</p>
</blockquote>



<a name="246174091"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/246174091" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#246174091">(Jul 16 2021 at 00:54)</a>:</h4>
<p>akirilov-arm edited <a href="https://github.com/bytecodealliance/wasmtime/pull/3062#discussion_r670873050">PR review comment</a>.</p>



<a name="246198624"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/246198624" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#246198624">(Jul 16 2021 at 08:46)</a>:</h4>
<p>afonso360 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3062#pullrequestreview-708147052">PR review</a>.</p>



<a name="246198625"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/246198625" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#246198625">(Jul 16 2021 at 08:46)</a>:</h4>
<p>afonso360 created <a href="https://github.com/bytecodealliance/wasmtime/pull/3062#discussion_r671076737">PR review comment</a>:</p>
<blockquote>
<p>This is here to sort of warn callers that we may set flags that they do not expect, not that we really don't know what they are.</p>
<p>An example of this is the I128 EQ/NE implementation, we end that by emitting a <code>CMN</code> on the XOR of the inputs, this works for EQ/NE but if the caller tried to use any other cond code would result in wrong behaviour.</p>
<p>But I think we can clarify this by saying that callers can check the output <code>cond</code> and its negative.</p>
</blockquote>



<a name="246198772"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/246198772" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#246198772">(Jul 16 2021 at 08:48)</a>:</h4>
<p>afonso360 edited <a href="https://github.com/bytecodealliance/wasmtime/pull/3062#discussion_r671076737">PR review comment</a>.</p>



<a name="246199087"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/246199087" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#246199087">(Jul 16 2021 at 08:52)</a>:</h4>
<p>afonso360 edited <a href="https://github.com/bytecodealliance/wasmtime/pull/3062#discussion_r671076737">PR review comment</a>.</p>



<a name="246199156"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/246199156" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#246199156">(Jul 16 2021 at 08:53)</a>:</h4>
<p>afonso360 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3062#pullrequestreview-708152781">PR review</a>.</p>



<a name="246199157"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/246199157" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#246199157">(Jul 16 2021 at 08:53)</a>:</h4>
<p>afonso360 created <a href="https://github.com/bytecodealliance/wasmtime/pull/3062#discussion_r671081251">PR review comment</a>:</p>
<blockquote>
<p>Thanks, that is much better!</p>
</blockquote>



<a name="246209087"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/246209087" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#246209087">(Jul 16 2021 at 10:57)</a>:</h4>
<p>afonso360 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3062">PR #3062</a> from <code>interpreter-branches</code> to <code>main</code>.</p>



<a name="246209187"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/246209187" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#246209187">(Jul 16 2021 at 10:58)</a>:</h4>
<p>afonso360 edited <a href="https://github.com/bytecodealliance/wasmtime/pull/3062#discussion_r671081251">PR review comment</a>.</p>



<a name="246209391"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/246209391" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#246209391">(Jul 16 2021 at 11:00)</a>:</h4>
<p><strong>afonso360</strong> requested <a href="https://github.com/akirilov-arm">akirilov-arm</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/3062">PR #3062</a>.</p>



<a name="246259411"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/246259411" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#246259411">(Jul 16 2021 at 18:10)</a>:</h4>
<p>akirilov-arm submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3062#pullrequestreview-708632781">PR review</a>.</p>



<a name="246259412"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/246259412" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#246259412">(Jul 16 2021 at 18:10)</a>:</h4>
<p>akirilov-arm submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3062#pullrequestreview-708632781">PR review</a>.</p>



<a name="246259413"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/246259413" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#246259413">(Jul 16 2021 at 18:10)</a>:</h4>
<p>akirilov-arm created <a href="https://github.com/bytecodealliance/wasmtime/pull/3062#discussion_r671437940">PR review comment</a>:</p>
<blockquote>
<p>Typo - <code>comparison</code>.</p>
</blockquote>



<a name="246259414"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/246259414" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#246259414">(Jul 16 2021 at 18:10)</a>:</h4>
<p>akirilov-arm created <a href="https://github.com/bytecodealliance/wasmtime/pull/3062#discussion_r671436171">PR review comment</a>:</p>
<blockquote>
<p>I just realized that this could be simplified further:</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">should_materialize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">output</span><span class="p">.</span><span class="n">reg</span><span class="p">().</span><span class="n">is_some</span><span class="p">();</span><span class="w"></span>
</code></pre></div><br>
</p>
</blockquote>



<a name="246259415"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/246259415" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#246259415">(Jul 16 2021 at 18:10)</a>:</h4>
<p>akirilov-arm created <a href="https://github.com/bytecodealliance/wasmtime/pull/3062#discussion_r671438757">PR review comment</a>:</p>
<blockquote>
<p>Typo - <code>comparisons</code>.</p>
</blockquote>



<a name="246259717"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/246259717" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#246259717">(Jul 16 2021 at 18:14)</a>:</h4>
<p>afonso360 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3062">PR #3062</a> from <code>interpreter-branches</code> to <code>main</code>.</p>



<a name="246260157"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/246260157" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#246260157">(Jul 16 2021 at 18:17)</a>:</h4>
<p>akirilov-arm submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3062#pullrequestreview-708643583">PR review</a>.</p>



<a name="246260158"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/246260158" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#246260158">(Jul 16 2021 at 18:17)</a>:</h4>
<p>akirilov-arm created <a href="https://github.com/bytecodealliance/wasmtime/pull/3062#discussion_r671444423">PR review comment</a>:</p>
<blockquote>
<p>Oh, right, a bit of tunnel vision on my side - I was absolutely concentrating on the flags case.</p>
</blockquote>



<a name="246281222"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/246281222" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#246281222">(Jul 16 2021 at 21:16)</a>:</h4>
<p>akirilov-arm submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3062#pullrequestreview-708753693">PR review</a>.</p>



<a name="246478247"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233062%20Fix%20branching%20instructions%20in%20the%20int.../near/246478247" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233062.20Fix.20branching.20instructions.20in.20the.20int.2E.2E.2E.html#246478247">(Jul 19 2021 at 16:31)</a>:</h4>
<p>abrown merged <a href="https://github.com/bytecodealliance/wasmtime/pull/3062">PR #3062</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>