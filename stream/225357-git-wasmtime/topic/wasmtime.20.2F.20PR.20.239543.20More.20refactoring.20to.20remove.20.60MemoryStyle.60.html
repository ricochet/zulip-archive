<html>
<head><meta charset="utf-8"><title>wasmtime / PR #9543 More refactoring to remove `MemoryStyle` · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239543.20More.20refactoring.20to.20remove.20.60MemoryStyle.60.html">wasmtime / PR #9543 More refactoring to remove `MemoryStyle`</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="480178640"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239543%20More%20refactoring%20to%20remove%20%60MemoryStyle%60/near/480178640" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239543.20More.20refactoring.20to.20remove.20.60MemoryStyle.60.html#480178640">(Nov 02 2024 at 03:36)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/abrown">abrown</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/9543">PR #9543</a>.</p>



<a name="480178641"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239543%20More%20refactoring%20to%20remove%20%60MemoryStyle%60/near/480178641" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239543.20More.20refactoring.20to.20remove.20.60MemoryStyle.60.html#480178641">(Nov 02 2024 at 03:37)</a>:</h4>
<p>alexcrichton opened <a href="https://github.com/bytecodealliance/wasmtime/pull/9543">PR #9543</a> from <code>alexcrichton:push-memory-type-down-in-compilers</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>This commit has more refactoring to simplify handling of linear memories in Wasmtime. The end goal is to remove the static/dynamic distinction and simplify the internal implementation and external interface. This is along the same lines of #9528, #9532, #9531, and #9530. The goal of this PR is a series of standalone commits which work towards futher "pushing down" the usage of <code>MemoryStyle</code> down to the consumers of bounds check code. The goal here is to remove layers of abstraction and instead unify everything around the same abstraction of <code>Tunables</code> and <code>wasmtime_environ::Memory</code>. Many fields in Winch/Cranelift <code>HeapData</code> have been removed in favor of storing <code>Memory</code> directly.</p>
<p>This PR affects generated golden tests because previously the global value for the heap bound was not generated if the heap was a "static" heap. With the eventual removal of static/dynamic distinction it's easier to just always generate this and have it not get used most of the time. Thus while the clif output tests are changing none of the actual generated code itself should be changing.</p>
</blockquote>



<a name="480178642"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239543%20More%20refactoring%20to%20remove%20%60MemoryStyle%60/near/480178642" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239543.20More.20refactoring.20to.20remove.20.60MemoryStyle.60.html#480178642">(Nov 02 2024 at 03:37)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-compiler-reviewers">wasmtime-compiler-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/9543">PR #9543</a>.</p>



<a name="480178644"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239543%20More%20refactoring%20to%20remove%20%60MemoryStyle%60/near/480178644" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239543.20More.20refactoring.20to.20remove.20.60MemoryStyle.60.html#480178644">(Nov 02 2024 at 03:37)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/pchickey">pchickey</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/9543">PR #9543</a>.</p>



<a name="480178645"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239543%20More%20refactoring%20to%20remove%20%60MemoryStyle%60/near/480178645" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239543.20More.20refactoring.20to.20remove.20.60MemoryStyle.60.html#480178645">(Nov 02 2024 at 03:37)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/9543">PR #9543</a>.</p>



<a name="480490109"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239543%20More%20refactoring%20to%20remove%20%60MemoryStyle%60/near/480490109" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239543.20More.20refactoring.20to.20remove.20.60MemoryStyle.60.html#480490109">(Nov 04 2024 at 17:12)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9543#pullrequestreview-2413644893">PR review</a>.</p>



<a name="480490111"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239543%20More%20refactoring%20to%20remove%20%60MemoryStyle%60/near/480490111" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239543.20More.20refactoring.20to.20remove.20.60MemoryStyle.60.html#480490111">(Nov 04 2024 at 17:12)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/9543#discussion_r1828087164">PR review comment</a>:</p>
<blockquote>
<p>It's this extra global that is causing the changes in the disassembly tests, right? E.g., <code>gv5</code>?</p>
</blockquote>



<a name="480490527"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239543%20More%20refactoring%20to%20remove%20%60MemoryStyle%60/near/480490527" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239543.20More.20refactoring.20to.20remove.20.60MemoryStyle.60.html#480490527">(Nov 04 2024 at 17:14)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9543#pullrequestreview-2413649443">PR review</a>.</p>



<a name="480490528"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239543%20More%20refactoring%20to%20remove%20%60MemoryStyle%60/near/480490528" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239543.20More.20refactoring.20to.20remove.20.60MemoryStyle.60.html#480490528">(Nov 04 2024 at 17:14)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/9543#discussion_r1828089880">PR review comment</a>:</p>
<blockquote>
<p>It would appear that <code>gv4</code> is not being used in those tests, so we're adding an unused global here and I'm debating the pros and cons of that.</p>
</blockquote>



<a name="480500828"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239543%20More%20refactoring%20to%20remove%20%60MemoryStyle%60/near/480500828" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239543.20More.20refactoring.20to.20remove.20.60MemoryStyle.60.html#480500828">(Nov 04 2024 at 18:15)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9543#pullrequestreview-2413801089">PR review</a>.</p>



<a name="480500830"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239543%20More%20refactoring%20to%20remove%20%60MemoryStyle%60/near/480500830" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239543.20More.20refactoring.20to.20remove.20.60MemoryStyle.60.html#480500830">(Nov 04 2024 at 18:15)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/9543#discussion_r1828182780">PR review comment</a>:</p>
<blockquote>
<p>Right yeah this is the global being added. I <a href="https://github.com/bytecodealliance/wasmtime/pull/9543#issue-2630163393">wrote up a bit above about this</a> but it's essentially easier given the current code shape to assume that the global value is always there rather than calculate if it'll be needed in a function body and create it and/or lazily creating it on-demand. My hope is that the "overhead" here is just a few bytes in a vector per-function which in theory doesn't have too much impact, but I'll admit I haven't measured.</p>
</blockquote>



<a name="480541911"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239543%20More%20refactoring%20to%20remove%20%60MemoryStyle%60/near/480541911" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239543.20More.20refactoring.20to.20remove.20.60MemoryStyle.60.html#480541911">(Nov 04 2024 at 23:03)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/fitzgen">fitzgen</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/9543">PR #9543</a>.</p>



<a name="480554775"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239543%20More%20refactoring%20to%20remove%20%60MemoryStyle%60/near/480554775" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239543.20More.20refactoring.20to.20remove.20.60MemoryStyle.60.html#480554775">(Nov 05 2024 at 01:01)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9543#pullrequestreview-2414430001">PR review</a>:</p>
<blockquote>
<p>Well, beyond my question about the additional global, which I'm not terribly opposed to anyways, I think this makes sense.</p>
</blockquote>



<a name="480746456"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239543%20More%20refactoring%20to%20remove%20%60MemoryStyle%60/near/480746456" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239543.20More.20refactoring.20to.20remove.20.60MemoryStyle.60.html#480746456">(Nov 05 2024 at 15:26)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/9543">PR #9543</a>.</p>



<a name="480746560"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239543%20More%20refactoring%20to%20remove%20%60MemoryStyle%60/near/480746560" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239543.20More.20refactoring.20to.20remove.20.60MemoryStyle.60.html#480746560">(Nov 05 2024 at 15:26)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/9543#issuecomment-2457472147">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/9543">PR #9543</a>:</p>
<blockquote>
<p>@fitzgen mind giving a once-over confirmation here as well?</p>
</blockquote>



<a name="480795874"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239543%20More%20refactoring%20to%20remove%20%60MemoryStyle%60/near/480795874" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239543.20More.20refactoring.20to.20remove.20.60MemoryStyle.60.html#480795874">(Nov 05 2024 at 20:35)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9543#pullrequestreview-2416639798">PR review</a>:</p>
<blockquote>
<p>LGTM!</p>
</blockquote>



<a name="480799916"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239543%20More%20refactoring%20to%20remove%20%60MemoryStyle%60/near/480799916" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239543.20More.20refactoring.20to.20remove.20.60MemoryStyle.60.html#480799916">(Nov 05 2024 at 21:05)</a>:</h4>
<p>fitzgen merged <a href="https://github.com/bytecodealliance/wasmtime/pull/9543">PR #9543</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>