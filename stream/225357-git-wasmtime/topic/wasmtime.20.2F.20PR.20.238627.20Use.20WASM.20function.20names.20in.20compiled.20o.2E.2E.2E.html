<html>
<head><meta charset="utf-8"><title>wasmtime / PR #8627 Use WASM function names in compiled o... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238627.20Use.20WASM.20function.20names.20in.20compiled.20o.2E.2E.2E.html">wasmtime / PR #8627 Use WASM function names in compiled o...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="438851351"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238627%20Use%20WASM%20function%20names%20in%20compiled%20o.../near/438851351" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238627.20Use.20WASM.20function.20names.20in.20compiled.20o.2E.2E.2E.html#438851351">(May 15 2024 at 17:16)</a>:</h4>
<p>lpereira opened <a href="https://github.com/bytecodealliance/wasmtime/pull/8627">PR #8627</a> from <code>lpereira:wasm-func-names-in-objs</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>Instead of generating symbol names in the format<br>
"wasm[$MODULE_ID]::function[$FUNCTION_INDEX]", generate (if possible) something more readable, such as "wasm[$MODULE_ID]::$FUNCTION_NAME". This helps when debugging or profiling the generated code.<br>
</p>
</blockquote>



<a name="438851353"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238627%20Use%20WASM%20function%20names%20in%20compiled%20o.../near/438851353" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238627.20Use.20WASM.20function.20names.20in.20compiled.20o.2E.2E.2E.html#438851353">(May 15 2024 at 17:16)</a>:</h4>
<p><strong>lpereira</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/8627">PR #8627</a>.</p>



<a name="438851354"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238627%20Use%20WASM%20function%20names%20in%20compiled%20o.../near/438851354" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238627.20Use.20WASM.20function.20names.20in.20compiled.20o.2E.2E.2E.html#438851354">(May 15 2024 at 17:16)</a>:</h4>
<p><strong>lpereira</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/8627">PR #8627</a>.</p>



<a name="438852214"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238627%20Use%20WASM%20function%20names%20in%20compiled%20o.../near/438852214" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238627.20Use.20WASM.20function.20names.20in.20compiled.20o.2E.2E.2E.html#438852214">(May 15 2024 at 17:21)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/pull/8627#issuecomment-2113071875">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/8627">PR #8627</a>:</p>
<blockquote>
<p>Is it guaranteed that the names section only contains unique names?</p>
</blockquote>



<a name="438852425"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238627%20Use%20WASM%20function%20names%20in%20compiled%20o.../near/438852425" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238627.20Use.20WASM.20function.20names.20in.20compiled.20o.2E.2E.2E.html#438852425">(May 15 2024 at 17:23)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/8627#issuecomment-2113073503">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/8627">PR #8627</a>:</p>
<blockquote>
<p>Thanks! This makes sense to me and I've often thought this would be nice as well. A hesitation I've had in the past though is that I'm a bit wary about exposing user-provided data to native tools like <code>perf</code> and <code>objdump</code> and such. The name section has completely arbitrary strings and I while I can't say for certainty that native tooling behaves well in the face of arbitrary strings I suspect that there might be a security issue waiting to happen along the lines of "if you run <code>ldd</code> over a binary it can run arbitrary code" or something like that.</p>
<p>(a good example being @bjorn3's suggestion where the <code>name</code> section has no guarantees of uniqueness and I'm not sure what tooling would do with same-named-symbols)</p>
</blockquote>



<a name="438854795"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238627%20Use%20WASM%20function%20names%20in%20compiled%20o.../near/438854795" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238627.20Use.20WASM.20function.20names.20in.20compiled.20o.2E.2E.2E.html#438854795">(May 15 2024 at 17:37)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/8627#issuecomment-2113097889">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/8627">PR #8627</a>:</p>
<blockquote>
<p>I wonder if we could define suitable "cleanup" for names: (i) rewrite duplicates with numeric suffixes, (ii) replace or remove any characters not in the usual set (<code>[A-Za-z0-9-_]</code> -- maybe spaces too? can tools handle those?), (iii) cap the length at something reasonable like 32 or 64 characters?</p>
</blockquote>



<a name="438856376"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238627%20Use%20WASM%20function%20names%20in%20compiled%20o.../near/438856376" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238627.20Use.20WASM.20function.20names.20in.20compiled.20o.2E.2E.2E.html#438856376">(May 15 2024 at 17:46)</a>:</h4>
<p>lpereira <a href="https://github.com/bytecodealliance/wasmtime/pull/8627#issuecomment-2113112774">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/8627">PR #8627</a>:</p>
<blockquote>
<p>Could also add the function_index for the cases where uniqueness isn't guaranteed.  Alright, I'll cook up a patch with the suggestions.</p>
</blockquote>



<a name="438856506"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238627%20Use%20WASM%20function%20names%20in%20compiled%20o.../near/438856506" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238627.20Use.20WASM.20function.20names.20in.20compiled.20o.2E.2E.2E.html#438856506">(May 15 2024 at 17:47)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/8627#issuecomment-2113114460">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/8627">PR #8627</a>:</p>
<blockquote>
<p>Yeah I think that'd work well (albeit bit a bit more involved in the implementation). While I can't say for certainty that spaces are not supported my guess is that tools would likely eventually choke on non-C-looking symbols so I'd be tempted to leave them out. </p>
</blockquote>



<a name="438859089"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238627%20Use%20WASM%20function%20names%20in%20compiled%20o.../near/438859089" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238627.20Use.20WASM.20function.20names.20in.20compiled.20o.2E.2E.2E.html#438859089">(May 15 2024 at 18:02)</a>:</h4>
<p>fitzgen <a href="https://github.com/bytecodealliance/wasmtime/pull/8627#issuecomment-2113138170">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/8627">PR #8627</a>:</p>
<blockquote>
<p>How about</p>
<ul>
<li><code>wasm[N]::func[M]</code> if no name section entry</li>
<li><code>wasm[N]::func[m]: &lt;name&gt;</code> where <code>&lt;name&gt;</code> is sanitized and has a capped length if there is an entry</li>
</ul>
<p>?</p>
</blockquote>



<a name="438859293"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238627%20Use%20WASM%20function%20names%20in%20compiled%20o.../near/438859293" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238627.20Use.20WASM.20function.20names.20in.20compiled.20o.2E.2E.2E.html#438859293">(May 15 2024 at 18:03)</a>:</h4>
<p>fitzgen edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/8627#issuecomment-2113138170">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/8627">PR #8627</a>:</p>
<blockquote>
<p>How about</p>
<ul>
<li><code>wasm[N]::func[M]</code> if no name section entry</li>
<li><code>wasm[N]::func[M]: &lt;name&gt;</code> where <code>&lt;name&gt;</code> is sanitized and has a capped length if there is an entry</li>
</ul>
<p>?</p>
<p>This avoids needing to either add numbers into the sanitized name and then worrying about removing those numbers when capping the length, or needing to account for the length of the numbers that might be added after sanitizing and capping the name.</p>
</blockquote>



<a name="438864805"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238627%20Use%20WASM%20function%20names%20in%20compiled%20o.../near/438864805" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238627.20Use.20WASM.20function.20names.20in.20compiled.20o.2E.2E.2E.html#438864805">(May 15 2024 at 18:41)</a>:</h4>
<p>lpereira updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8627">PR #8627</a>.</p>



<a name="438865517"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238627%20Use%20WASM%20function%20names%20in%20compiled%20o.../near/438865517" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238627.20Use.20WASM.20function.20names.20in.20compiled.20o.2E.2E.2E.html#438865517">(May 15 2024 at 18:46)</a>:</h4>
<p>lpereira <a href="https://github.com/bytecodealliance/wasmtime/pull/8627#issuecomment-2113227438">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/8627">PR #8627</a>:</p>
<blockquote>
<p>Alright, pushed some changes that:</p>
<ul>
<li>Will filter symbols to only include alphanumeric characters and others that might be generated by name mangling and whatnot, and replace runs of them with a single '?'</li>
<li>Always include the function index in the symbol name</li>
<li>Truncate the symbol name to 96 characters</li>
</ul>
<p>I think this should be sufficient, although I'm not really sold on how good the string filtering code is. I wish there was a <code>String::translate()</code> that would work similarly to <code>String::retain()</code>, but replace the character with what the callback function returns.  I'm a newbie in Rust, though, so maybe there's a way I couldn't figure out? </p>
</blockquote>



<a name="438866162"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238627%20Use%20WASM%20function%20names%20in%20compiled%20o.../near/438866162" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238627.20Use.20WASM.20function.20names.20in.20compiled.20o.2E.2E.2E.html#438866162">(May 15 2024 at 18:50)</a>:</h4>
<p>lpereira edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/8627#issuecomment-2113227438">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/8627">PR #8627</a>:</p>
<blockquote>
<p>Alright, pushed some changes that:</p>
<ul>
<li>Will filter symbols to only include alphanumeric characters and others that might be generated by name mangling and whatnot, and replace runs of them with a single '?'</li>
<li>Always include the function index in the symbol name</li>
<li>Truncate the symbol name to 96 characters</li>
</ul>
<p>I think this should be sufficient, although I'm not really sold on how good the string filtering code is (in fact, it's pretty bad, as it always goes back to the beginning of the string to find the next match; I'll force-push a new thing soon). I wish there was a <code>String::translate()</code> that would work similarly to <code>String::retain()</code>, but replace the character with what the callback function returns.  I'm a newbie in Rust, though, so maybe there's a way I couldn't figure out? </p>
</blockquote>



<a name="438868622"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238627%20Use%20WASM%20function%20names%20in%20compiled%20o.../near/438868622" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238627.20Use.20WASM.20function.20names.20in.20compiled.20o.2E.2E.2E.html#438868622">(May 15 2024 at 19:05)</a>:</h4>
<p>lpereira updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8627">PR #8627</a>.</p>



<a name="438868697"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238627%20Use%20WASM%20function%20names%20in%20compiled%20o.../near/438868697" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238627.20Use.20WASM.20function.20names.20in.20compiled.20o.2E.2E.2E.html#438868697">(May 15 2024 at 19:06)</a>:</h4>
<p>lpereira edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/8627#issuecomment-2113227438">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/8627">PR #8627</a>:</p>
<blockquote>
<p>Alright, pushed some changes that:</p>
<ul>
<li>Will filter symbols to only include alphanumeric characters and others that might be generated by name mangling and whatnot, and replace runs of them with a single '?'</li>
<li>Always include the function index in the symbol name</li>
<li>Truncate the symbol name to 96 characters</li>
</ul>
<p>I think this should be sufficient. Can anyone please take a look again?</p>
</blockquote>



<a name="438868894"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238627%20Use%20WASM%20function%20names%20in%20compiled%20o.../near/438868894" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238627.20Use.20WASM.20function.20names.20in.20compiled.20o.2E.2E.2E.html#438868894">(May 15 2024 at 19:07)</a>:</h4>
<p>lpereira updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8627">PR #8627</a>.</p>



<a name="438869040"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238627%20Use%20WASM%20function%20names%20in%20compiled%20o.../near/438869040" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238627.20Use.20WASM.20function.20names.20in.20compiled.20o.2E.2E.2E.html#438869040">(May 15 2024 at 19:08)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8627#pullrequestreview-2058802627">PR review</a>.</p>



<a name="438869041"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238627%20Use%20WASM%20function%20names%20in%20compiled%20o.../near/438869041" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238627.20Use.20WASM.20function.20names.20in.20compiled.20o.2E.2E.2E.html#438869041">(May 15 2024 at 19:08)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8627#pullrequestreview-2058802627">PR review</a>.</p>



<a name="438869042"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238627%20Use%20WASM%20function%20names%20in%20compiled%20o.../near/438869042" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238627.20Use.20WASM.20function.20names.20in.20compiled.20o.2E.2E.2E.html#438869042">(May 15 2024 at 19:08)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/8627#discussion_r1602125950">PR review comment</a>:</p>
<blockquote>
<p>I think you can do something better with iterators, and also we'll want to avoid allocating a string in the common case -- perhaps something like:</p>
<ul>
<li>Define a predicate <code>fn bad_char(c: char) -&gt; bool { ... }</code> inside this function</li>
<li>Guard on no bad chars, to allow the common case without allocations; if any bad chars, do an iterator stream filter</li>
</ul>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">name</span><span class="p">.</span><span class="n">chars</span><span class="p">().</span><span class="n">any</span><span class="p">(</span><span class="o">|</span><span class="n">c</span><span class="o">|</span><span class="w"> </span><span class="n">bad_char</span><span class="p">(</span><span class="n">c</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">Cow</span>::<span class="n">Owned</span><span class="p">(</span><span class="n">name</span><span class="p">.</span><span class="n">chars</span><span class="p">().</span><span class="n">map</span><span class="p">(</span><span class="o">|</span><span class="n">c</span><span class="o">|</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">bad_char</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="sc">'?'</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="p">}).</span><span class="n">collect</span>::<span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span><span class="p">())</span>
<span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">Cow</span>::<span class="n">Borrowed</span><span class="p">(</span><span class="o">&amp;</span><span class="n">name</span><span class="p">[</span><span class="o">..</span><span class="p">])</span>
<span class="p">}</span>
</code></pre></div>
<p>Thoughts?</p>
</blockquote>



<a name="438869249"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238627%20Use%20WASM%20function%20names%20in%20compiled%20o.../near/438869249" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238627.20Use.20WASM.20function.20names.20in.20compiled.20o.2E.2E.2E.html#438869249">(May 15 2024 at 19:09)</a>:</h4>
<p>lpereira updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8627">PR #8627</a>.</p>



<a name="438870176"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238627%20Use%20WASM%20function%20names%20in%20compiled%20o.../near/438870176" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238627.20Use.20WASM.20function.20names.20in.20compiled.20o.2E.2E.2E.html#438870176">(May 15 2024 at 19:16)</a>:</h4>
<p>lpereira updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8627">PR #8627</a>.</p>



<a name="438870469"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238627%20Use%20WASM%20function%20names%20in%20compiled%20o.../near/438870469" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238627.20Use.20WASM.20function.20names.20in.20compiled.20o.2E.2E.2E.html#438870469">(May 15 2024 at 19:18)</a>:</h4>
<p>lpereira submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8627#pullrequestreview-2058824725">PR review</a>.</p>



<a name="438870470"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238627%20Use%20WASM%20function%20names%20in%20compiled%20o.../near/438870470" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238627.20Use.20WASM.20function.20names.20in.20compiled.20o.2E.2E.2E.html#438870470">(May 15 2024 at 19:18)</a>:</h4>
<p>lpereira created <a href="https://github.com/bytecodealliance/wasmtime/pull/8627#discussion_r1602137600">PR review comment</a>:</p>
<blockquote>
<p>Yup, right after I pushed this I found about the <code>map()</code> method.  Let me use <code>Cow</code> too, as this should reduce quite a bit of writes in the happy path.</p>
</blockquote>



<a name="438879958"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238627%20Use%20WASM%20function%20names%20in%20compiled%20o.../near/438879958" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238627.20Use.20WASM.20function.20names.20in.20compiled.20o.2E.2E.2E.html#438879958">(May 15 2024 at 20:28)</a>:</h4>
<p>lpereira updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8627">PR #8627</a>.</p>



<a name="438880126"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238627%20Use%20WASM%20function%20names%20in%20compiled%20o.../near/438880126" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238627.20Use.20WASM.20function.20names.20in.20compiled.20o.2E.2E.2E.html#438880126">(May 15 2024 at 20:29)</a>:</h4>
<p>lpereira submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8627#pullrequestreview-2058944213">PR review</a>.</p>



<a name="438880128"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238627%20Use%20WASM%20function%20names%20in%20compiled%20o.../near/438880128" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238627.20Use.20WASM.20function.20names.20in.20compiled.20o.2E.2E.2E.html#438880128">(May 15 2024 at 20:29)</a>:</h4>
<p>lpereira created <a href="https://github.com/bytecodealliance/wasmtime/pull/8627#discussion_r1602207583">PR review comment</a>:</p>
<blockquote>
<p>Done, thanks!</p>
</blockquote>



<a name="438880347"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238627%20Use%20WASM%20function%20names%20in%20compiled%20o.../near/438880347" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238627.20Use.20WASM.20function.20names.20in.20compiled.20o.2E.2E.2E.html#438880347">(May 15 2024 at 20:30)</a>:</h4>
<p>lpereira updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8627">PR #8627</a>.</p>



<a name="438881329"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238627%20Use%20WASM%20function%20names%20in%20compiled%20o.../near/438881329" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238627.20Use.20WASM.20function.20names.20in.20compiled.20o.2E.2E.2E.html#438881329">(May 15 2024 at 20:37)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8627#pullrequestreview-2058966897">PR review</a>.</p>



<a name="438881330"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238627%20Use%20WASM%20function%20names%20in%20compiled%20o.../near/438881330" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238627.20Use.20WASM.20function.20names.20in.20compiled.20o.2E.2E.2E.html#438881330">(May 15 2024 at 20:37)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/8627#discussion_r1602221176">PR review comment</a>:</p>
<blockquote>
<p>.take(N) in the iterator chain should allow the truncation to happen inline (and stop iteration early if so, since the whole chain is lazy)</p>
</blockquote>



<a name="438882655"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238627%20Use%20WASM%20function%20names%20in%20compiled%20o.../near/438882655" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238627.20Use.20WASM.20function.20names.20in.20compiled.20o.2E.2E.2E.html#438882655">(May 15 2024 at 20:47)</a>:</h4>
<p>lpereira updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8627">PR #8627</a>.</p>



<a name="438882661"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238627%20Use%20WASM%20function%20names%20in%20compiled%20o.../near/438882661" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238627.20Use.20WASM.20function.20names.20in.20compiled.20o.2E.2E.2E.html#438882661">(May 15 2024 at 20:47)</a>:</h4>
<p>lpereira submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8627#pullrequestreview-2058986156">PR review</a>.</p>



<a name="438882663"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238627%20Use%20WASM%20function%20names%20in%20compiled%20o.../near/438882663" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238627.20Use.20WASM.20function.20names.20in.20compiled.20o.2E.2E.2E.html#438882663">(May 15 2024 at 20:47)</a>:</h4>
<p>lpereira created <a href="https://github.com/bytecodealliance/wasmtime/pull/8627#discussion_r1602233055">PR review comment</a>:</p>
<blockquote>
<p>Done.</p>
</blockquote>



<a name="438884314"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238627%20Use%20WASM%20function%20names%20in%20compiled%20o.../near/438884314" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238627.20Use.20WASM.20function.20names.20in.20compiled.20o.2E.2E.2E.html#438884314">(May 15 2024 at 20:59)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8627#pullrequestreview-2059006313">PR review</a>:</p>
<blockquote>
<p>Looks reasonable to me, thanks for the iterations!</p>
</blockquote>



<a name="438884349"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238627%20Use%20WASM%20function%20names%20in%20compiled%20o.../near/438884349" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238627.20Use.20WASM.20function.20names.20in.20compiled.20o.2E.2E.2E.html#438884349">(May 15 2024 at 20:59)</a>:</h4>
<p>lpereira updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8627">PR #8627</a>.</p>



<a name="438884357"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238627%20Use%20WASM%20function%20names%20in%20compiled%20o.../near/438884357" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238627.20Use.20WASM.20function.20names.20in.20compiled.20o.2E.2E.2E.html#438884357">(May 15 2024 at 20:59)</a>:</h4>
<p>lpereira submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8627#pullrequestreview-2059006721">PR review</a>.</p>



<a name="438884358"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238627%20Use%20WASM%20function%20names%20in%20compiled%20o.../near/438884358" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238627.20Use.20WASM.20function.20names.20in.20compiled.20o.2E.2E.2E.html#438884358">(May 15 2024 at 20:59)</a>:</h4>
<p>lpereira created <a href="https://github.com/bytecodealliance/wasmtime/pull/8627#discussion_r1602246067">PR review comment</a>:</p>
<blockquote>
<p>Actually, no, I'm not sure how to do this; I want to truncate the string after <code>trim_matches('?')</code> removed repeated occurrences of <code>'?'</code> in the cleaned string, not before.</p>
</blockquote>



<a name="438884404"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238627%20Use%20WASM%20function%20names%20in%20compiled%20o.../near/438884404" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238627.20Use.20WASM.20function.20names.20in.20compiled.20o.2E.2E.2E.html#438884404">(May 15 2024 at 20:59)</a>:</h4>
<p>cfallin has enabled auto merge for <a href="https://github.com/bytecodealliance/wasmtime/pull/8627">PR #8627</a>.</p>



<a name="438884535"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238627%20Use%20WASM%20function%20names%20in%20compiled%20o.../near/438884535" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238627.20Use.20WASM.20function.20names.20in.20compiled.20o.2E.2E.2E.html#438884535">(May 15 2024 at 21:00)</a>:</h4>
<p>cfallin has disabled auto merge for <a href="https://github.com/bytecodealliance/wasmtime/pull/8627">PR #8627</a>.</p>



<a name="438884617"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238627%20Use%20WASM%20function%20names%20in%20compiled%20o.../near/438884617" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238627.20Use.20WASM.20function.20names.20in.20compiled.20o.2E.2E.2E.html#438884617">(May 15 2024 at 21:00)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/8627#issuecomment-2113447975">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/8627">PR #8627</a>:</p>
<blockquote>
<p>Ah, force-pushed after my review; could you do subsequent updates as additional commits? Let me know when stable and I can re-review.</p>
</blockquote>



<a name="438901623"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238627%20Use%20WASM%20function%20names%20in%20compiled%20o.../near/438901623" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238627.20Use.20WASM.20function.20names.20in.20compiled.20o.2E.2E.2E.html#438901623">(May 15 2024 at 23:17)</a>:</h4>
<p>lpereira <a href="https://github.com/bytecodealliance/wasmtime/pull/8627#issuecomment-2113633815">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/8627">PR #8627</a>:</p>
<blockquote>
<p>It's stable now.  (I'm not using the <code>take()</code> method for the reason I stated above, so I reverted to the previous version.)</p>
</blockquote>



<a name="438936132"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238627%20Use%20WASM%20function%20names%20in%20compiled%20o.../near/438936132" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238627.20Use.20WASM.20function.20names.20in.20compiled.20o.2E.2E.2E.html#438936132">(May 16 2024 at 05:11)</a>:</h4>
<p>jameysharp submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8627#pullrequestreview-2059555029">PR review</a>:</p>
<blockquote>
<p>This is going to be such a big usability improvement for people using tools like perf! I'm excited.</p>
</blockquote>



<a name="438936133"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238627%20Use%20WASM%20function%20names%20in%20compiled%20o.../near/438936133" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238627.20Use.20WASM.20function.20names.20in.20compiled.20o.2E.2E.2E.html#438936133">(May 16 2024 at 05:11)</a>:</h4>
<p>jameysharp submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8627#pullrequestreview-2059555029">PR review</a>:</p>
<blockquote>
<p>This is going to be such a big usability improvement for people using tools like perf! I'm excited.</p>
</blockquote>



<a name="438936135"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238627%20Use%20WASM%20function%20names%20in%20compiled%20o.../near/438936135" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238627.20Use.20WASM.20function.20names.20in.20compiled.20o.2E.2E.2E.html#438936135">(May 16 2024 at 05:11)</a>:</h4>
<p>jameysharp created <a href="https://github.com/bytecodealliance/wasmtime/pull/8627#discussion_r1602624110">PR review comment</a>:</p>
<blockquote>
<p>Maybe you wanted <a href="https://doc.rust-lang.org/std/primitive.char.html#method.is_ascii_alphanumeric">is_ascii_alphanumeric</a> here instead, rather than allowing all Unicode alpha/numeric codepoints?</p>
<p><div class="codehilite" data-code-language="suggestion"><pre><span></span><code>        let bad_char = |c: char| !c.is_ascii_alphanumeric() &amp;&amp; !r"&lt;&gt;[]_-:@$".contains(c);
</code></pre></div><br>
</p>
</blockquote>



<a name="438936136"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238627%20Use%20WASM%20function%20names%20in%20compiled%20o.../near/438936136" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238627.20Use.20WASM.20function.20names.20in.20compiled.20o.2E.2E.2E.html#438936136">(May 16 2024 at 05:11)</a>:</h4>
<p>jameysharp created <a href="https://github.com/bytecodealliance/wasmtime/pull/8627#discussion_r1602598665">PR review comment</a>:</p>
<blockquote>
<p>I guess the name should still be truncated even if there are no bad characters, right?</p>
<p><div class="codehilite" data-code-language="suggestion"><pre><span></span><code>            Cow::Borrowed(&amp;name[..Self::MAX_SYMBOL_LEN])
</code></pre></div><br>
</p>
</blockquote>



<a name="438936137"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238627%20Use%20WASM%20function%20names%20in%20compiled%20o.../near/438936137" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238627.20Use.20WASM.20function.20names.20in.20compiled.20o.2E.2E.2E.html#438936137">(May 16 2024 at 05:11)</a>:</h4>
<p>jameysharp created <a href="https://github.com/bytecodealliance/wasmtime/pull/8627#discussion_r1602618129">PR review comment</a>:</p>
<blockquote>
<p>You mention that you intended to turn any run of multiple <code>?</code> into a single <code>?</code>. Note that <code>trim_matches</code> doesn't do that. Instead, it deletes all copies of the given pattern from both ends of the string. That's why it can return a borrowed <code>&amp;str</code> instead of a heap-allocated <code>String</code>: it doesn't change the middle of the string, so it can just adjust the start pointer and the length.</p>
<p>I think this should do more or less what you want (though I'm typing it in GitHub's web editor without testing it so who knows). It deletes all <code>?</code> at the beginning of the string, then compresses any run of multiple <code>?</code> into a single <code>?</code>. It can leave a single <code>?</code> at the end of the string but I couldn't think of a simple way to fix that and I don't think it matters. Also it uses <code>take</code> like Chris suggested.</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">last_char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sc">'?'</span><span class="p">;</span>
<span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">name</span>
<span class="w">                </span><span class="p">.</span><span class="n">chars</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="o">|</span><span class="n">c</span><span class="o">|</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">bad_char</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="sc">'?'</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="p">})</span>
<span class="w">                </span><span class="p">.</span><span class="n">filter</span><span class="p">(</span><span class="o">|</span><span class="n">c</span><span class="o">|</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="n">keep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">last_char</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">c</span><span class="p">;</span><span class="w"> </span><span class="n">last_char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="p">;</span><span class="w"> </span><span class="n">keep</span><span class="w"> </span><span class="p">})</span>
<span class="w">                </span><span class="p">.</span><span class="n">take</span><span class="p">(</span><span class="bp">Self</span>::<span class="n">MAX_SYMBOL_LEN</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="n">collect</span>::<span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span><span class="p">();</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="438939138"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238627%20Use%20WASM%20function%20names%20in%20compiled%20o.../near/438939138" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238627.20Use.20WASM.20function.20names.20in.20compiled.20o.2E.2E.2E.html#438939138">(May 16 2024 at 05:33)</a>:</h4>
<p>jameysharp <a href="https://github.com/bytecodealliance/wasmtime/pull/8627#issuecomment-2114065831">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/8627">PR #8627</a>:</p>
<blockquote>
<p>Ah, the CI test failures are because <code>tests/disas.rs</code> is specifically looking for symbol names which contain both <code>wasm</code> and <code>function</code> in their names, and you've shortened the latter to <code>func</code>. This is near the beginning of <code>disas_elf</code>.</p>
<p>I don't like that this test is relying on this implementation detail of Wasmtime, but I suppose it's fine. So you can either change this PR to continue to use <code>function</code>, or change <code>disas.rs</code> to search for <code>func</code>.</p>
<p>Either way, you'll also need to run <code>WASMTIME_TEST_BLESS=1 cargo test --test disas</code> to update the tests to reflect this change. Some of them do have function names, and those now show up in the expected test output, which is a fantastic bonus.</p>
</blockquote>



<a name="439058014"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238627%20Use%20WASM%20function%20names%20in%20compiled%20o.../near/439058014" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238627.20Use.20WASM.20function.20names.20in.20compiled.20o.2E.2E.2E.html#439058014">(May 16 2024 at 16:25)</a>:</h4>
<p>lpereira created <a href="https://github.com/bytecodealliance/wasmtime/pull/8627#discussion_r1603685973">PR review comment</a>:</p>
<blockquote>
<p>Done!</p>
</blockquote>



<a name="439058015"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238627%20Use%20WASM%20function%20names%20in%20compiled%20o.../near/439058015" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238627.20Use.20WASM.20function.20names.20in.20compiled.20o.2E.2E.2E.html#439058015">(May 16 2024 at 16:25)</a>:</h4>
<p>lpereira submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8627#pullrequestreview-2061312868">PR review</a>.</p>



<a name="439058166"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238627%20Use%20WASM%20function%20names%20in%20compiled%20o.../near/439058166" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238627.20Use.20WASM.20function.20names.20in.20compiled.20o.2E.2E.2E.html#439058166">(May 16 2024 at 16:26)</a>:</h4>
<p>lpereira submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8627#pullrequestreview-2061314812">PR review</a>.</p>



<a name="439058169"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238627%20Use%20WASM%20function%20names%20in%20compiled%20o.../near/439058169" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238627.20Use.20WASM.20function.20names.20in.20compiled.20o.2E.2E.2E.html#439058169">(May 16 2024 at 16:26)</a>:</h4>
<p>lpereira created <a href="https://github.com/bytecodealliance/wasmtime/pull/8627#discussion_r1603687698">PR review comment</a>:</p>
<blockquote>
<p>Yup, had this change locally and forgot to push. Good catch!</p>
</blockquote>



<a name="439058646"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238627%20Use%20WASM%20function%20names%20in%20compiled%20o.../near/439058646" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238627.20Use.20WASM.20function.20names.20in.20compiled.20o.2E.2E.2E.html#439058646">(May 16 2024 at 16:29)</a>:</h4>
<p>lpereira updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8627">PR #8627</a>.</p>



<a name="439060371"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238627%20Use%20WASM%20function%20names%20in%20compiled%20o.../near/439060371" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238627.20Use.20WASM.20function.20names.20in.20compiled.20o.2E.2E.2E.html#439060371">(May 16 2024 at 16:39)</a>:</h4>
<p>lpereira updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8627">PR #8627</a>.</p>



<a name="439060506"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238627%20Use%20WASM%20function%20names%20in%20compiled%20o.../near/439060506" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238627.20Use.20WASM.20function.20names.20in.20compiled.20o.2E.2E.2E.html#439060506">(May 16 2024 at 16:40)</a>:</h4>
<p>lpereira <a href="https://github.com/bytecodealliance/wasmtime/pull/8627#issuecomment-2115735680">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/8627">PR #8627</a>:</p>
<blockquote>
<p>Alright, thanks for the review!  This should be the last round.</p>
<p>(@jameysharp, that filter wouldn't work -- words like "keep", which are fine, would be transformed to "kep" -- but I tweaked it to consider that case.)</p>
</blockquote>



<a name="439070673"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238627%20Use%20WASM%20function%20names%20in%20compiled%20o.../near/439070673" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238627.20Use.20WASM.20function.20names.20in.20compiled.20o.2E.2E.2E.html#439070673">(May 16 2024 at 17:42)</a>:</h4>
<p>jameysharp <a href="https://github.com/bytecodealliance/wasmtime/pull/8627#issuecomment-2115846547">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/8627">PR #8627</a>:</p>
<blockquote>
<blockquote>
<p>(@jameysharp, that filter wouldn't work -- words like "keep", which are fine, would be transformed to "kep" -- but I tweaked it to consider that case.)</p>
</blockquote>
<p>Oh, you're absolutely right. <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>
<p>Looks good to me, let's ship it!</p>
</blockquote>



<a name="439073260"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238627%20Use%20WASM%20function%20names%20in%20compiled%20o.../near/439073260" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238627.20Use.20WASM.20function.20names.20in.20compiled.20o.2E.2E.2E.html#439073260">(May 16 2024 at 17:58)</a>:</h4>
<p>jameysharp merged <a href="https://github.com/bytecodealliance/wasmtime/pull/8627">PR #8627</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>