<html>
<head><meta charset="utf-8"><title>wasmtime / PR #6086 x64: emit_cmp: use x64_test for compa... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236086.20x64.3A.20emit_cmp.3A.20use.20x64_test.20for.20compa.2E.2E.2E.html">wasmtime / PR #6086 x64: emit_cmp: use x64_test for compa...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="343645453"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236086%20x64%3A%20emit_cmp%3A%20use%20x64_test%20for%20compa.../near/343645453" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236086.20x64.3A.20emit_cmp.3A.20use.20x64_test.20for.20compa.2E.2E.2E.html#343645453">(Mar 22 2023 at 11:21)</a>:</h4>
<p>meithecatte opened <a href="https://github.com/bytecodealliance/wasmtime/pull/6086">PR #6086</a> from <code>emit-cmp-test</code> to <code>main</code>:</p>
<blockquote>
<p>This implements the first part of the improvement described in #5869.</p>
<p>The PR template suggests I assign someone for review, but I have no idea who'd be best suited for this.</p>
<p>cc @elliottt <br>
</p>
</blockquote>



<a name="343940821"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236086%20x64%3A%20emit_cmp%3A%20use%20x64_test%20for%20compa.../near/343940821" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236086.20x64.3A.20emit_cmp.3A.20use.20x64_test.20for.20compa.2E.2E.2E.html#343940821">(Mar 23 2023 at 11:03)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6086#pullrequestreview-1354325725">PR review</a>.</p>



<a name="343940822"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236086%20x64%3A%20emit_cmp%3A%20use%20x64_test%20for%20compa.../near/343940822" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236086.20x64.3A.20emit_cmp.3A.20use.20x64_test.20for.20compa.2E.2E.2E.html#343940822">(Mar 23 2023 at 11:03)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6086#pullrequestreview-1354325725">PR review</a>.</p>



<a name="343940825"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236086%20x64%3A%20emit_cmp%3A%20use%20x64_test%20for%20compa.../near/343940825" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236086.20x64.3A.20emit_cmp.3A.20use.20x64_test.20for.20compa.2E.2E.2E.html#343940825">(Mar 23 2023 at 11:03)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/6086#discussion_r1146006407">PR review comment</a>:</p>
<blockquote>
<p>As a note for others: I was a bit nervous about <code>reverse</code> here and ended up looking up whether <code>inverse</code> is actually the right thing &mdash; we can see from <code>rule 1</code>, though, that <code>reverse</code> is used there as well.</p>
</blockquote>



<a name="344009255"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236086%20x64%3A%20emit_cmp%3A%20use%20x64_test%20for%20compa.../near/344009255" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236086.20x64.3A.20emit_cmp.3A.20use.20x64_test.20for.20compa.2E.2E.2E.html#344009255">(Mar 23 2023 at 15:08)</a>:</h4>
<p>jameysharp submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6086#pullrequestreview-1354854790">PR review</a>.</p>



<a name="344009256"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236086%20x64%3A%20emit_cmp%3A%20use%20x64_test%20for%20compa.../near/344009256" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236086.20x64.3A.20emit_cmp.3A.20use.20x64_test.20for.20compa.2E.2E.2E.html#344009256">(Mar 23 2023 at 15:08)</a>:</h4>
<p>jameysharp created <a href="https://github.com/bytecodealliance/wasmtime/pull/6086#discussion_r1146346401">PR review comment</a>:</p>
<blockquote>
<p>Yeah, I'm frequently confused between <code>inverse</code> and <code>reverse</code> too. I think both names are correct descriptions of what they do, but maybe later we can come up with alternate names that are less confusing. Maybe "negate" instead of "inverse", and "swap" instead of "reverse", for example.</p>
</blockquote>



<a name="344013040"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236086%20x64%3A%20emit_cmp%3A%20use%20x64_test%20for%20compa.../near/344013040" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236086.20x64.3A.20emit_cmp.3A.20use.20x64_test.20for.20compa.2E.2E.2E.html#344013040">(Mar 23 2023 at 15:21)</a>:</h4>
<p>meithecatte submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6086#pullrequestreview-1354882959">PR review</a>.</p>



<a name="344013041"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236086%20x64%3A%20emit_cmp%3A%20use%20x64_test%20for%20compa.../near/344013041" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236086.20x64.3A.20emit_cmp.3A.20use.20x64_test.20for.20compa.2E.2E.2E.html#344013041">(Mar 23 2023 at 15:21)</a>:</h4>
<p>meithecatte created <a href="https://github.com/bytecodealliance/wasmtime/pull/6086#discussion_r1146365206">PR review comment</a>:</p>
<blockquote>
<p>@jameysharp Good idea! I think these are much better names.</p>
</blockquote>



<a name="344049048"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236086%20x64%3A%20emit_cmp%3A%20use%20x64_test%20for%20compa.../near/344049048" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236086.20x64.3A.20emit_cmp.3A.20use.20x64_test.20for.20compa.2E.2E.2E.html#344049048">(Mar 23 2023 at 17:23)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6086#pullrequestreview-1355134612">PR review</a>.</p>



<a name="344049050"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236086%20x64%3A%20emit_cmp%3A%20use%20x64_test%20for%20compa.../near/344049050" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236086.20x64.3A.20emit_cmp.3A.20use.20x64_test.20for.20compa.2E.2E.2E.html#344049050">(Mar 23 2023 at 17:23)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/6086#discussion_r1146534099">PR review comment</a>:</p>
<blockquote>
<p>To fix the issue on CI, I think this should work?</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="n">OperandSize</span><span class="w"> </span><span class="p">(</span><span class="n">raw_operand_size_of_type</span><span class="w"> </span><span class="n">ty</span><span class="p">))</span>
<span class="w">    </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="n">Gpr</span><span class="w"> </span><span class="p">(</span><span class="n">put_in_gpr</span><span class="w"> </span><span class="n">a</span><span class="p">))</span>
<span class="w">  </span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="n">icmp_cond_result</span><span class="w"> </span><span class="p">(</span><span class="n">x64_test</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="n">cc</span><span class="p">))</span>
</code></pre></div>
<p>Basically by forcing <code>a</code> into a register earlier it's not separately converted to both <code>GprMem</code> and <code>Gpr</code></p>
</blockquote>



<a name="344049846"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236086%20x64%3A%20emit_cmp%3A%20use%20x64_test%20for%20compa.../near/344049846" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236086.20x64.3A.20emit_cmp.3A.20use.20x64_test.20for.20compa.2E.2E.2E.html#344049846">(Mar 23 2023 at 17:27)</a>:</h4>
<p>jameysharp submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6086#pullrequestreview-1355145265">PR review</a>.</p>



<a name="344049849"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236086%20x64%3A%20emit_cmp%3A%20use%20x64_test%20for%20compa.../near/344049849" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236086.20x64.3A.20emit_cmp.3A.20use.20x64_test.20for.20compa.2E.2E.2E.html#344049849">(Mar 23 2023 at 17:27)</a>:</h4>
<p>jameysharp created <a href="https://github.com/bytecodealliance/wasmtime/pull/6086#discussion_r1146541408">PR review comment</a>:</p>
<blockquote>
<p>Yes, I think that's the right fix!</p>
</blockquote>



<a name="344188688"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236086%20x64%3A%20emit_cmp%3A%20use%20x64_test%20for%20compa.../near/344188688" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236086.20x64.3A.20emit_cmp.3A.20use.20x64_test.20for.20compa.2E.2E.2E.html#344188688">(Mar 24 2023 at 08:25)</a>:</h4>
<p>meithecatte updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6086">PR #6086</a> from <code>emit-cmp-test</code> to <code>main</code>.</p>



<a name="344189069"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236086%20x64%3A%20emit_cmp%3A%20use%20x64_test%20for%20compa.../near/344189069" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236086.20x64.3A.20emit_cmp.3A.20use.20x64_test.20for.20compa.2E.2E.2E.html#344189069">(Mar 24 2023 at 08:26)</a>:</h4>
<p>meithecatte submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6086#pullrequestreview-1356200696">PR review</a>.</p>



<a name="344189071"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236086%20x64%3A%20emit_cmp%3A%20use%20x64_test%20for%20compa.../near/344189071" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236086.20x64.3A.20emit_cmp.3A.20use.20x64_test.20for.20compa.2E.2E.2E.html#344189071">(Mar 24 2023 at 08:26)</a>:</h4>
<p>meithecatte created <a href="https://github.com/bytecodealliance/wasmtime/pull/6086#discussion_r1147252142">PR review comment</a>:</p>
<blockquote>
<p>Yup, that works. I added a filetest that triggers this assertion, too.</p>
</blockquote>



<a name="344901284"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236086%20x64%3A%20emit_cmp%3A%20use%20x64_test%20for%20compa.../near/344901284" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236086.20x64.3A.20emit_cmp.3A.20use.20x64_test.20for.20compa.2E.2E.2E.html#344901284">(Mar 27 2023 at 15:38)</a>:</h4>
<p>jameysharp submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6086#pullrequestreview-1359346475">PR review</a>.</p>



<a name="344911343"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236086%20x64%3A%20emit_cmp%3A%20use%20x64_test%20for%20compa.../near/344911343" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236086.20x64.3A.20emit_cmp.3A.20use.20x64_test.20for.20compa.2E.2E.2E.html#344911343">(Mar 27 2023 at 16:17)</a>:</h4>
<p>jameysharp merged <a href="https://github.com/bytecodealliance/wasmtime/pull/6086">PR #6086</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>