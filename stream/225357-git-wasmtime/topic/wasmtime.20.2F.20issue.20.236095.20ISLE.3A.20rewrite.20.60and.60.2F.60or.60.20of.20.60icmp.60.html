<html>
<head><meta charset="utf-8"><title>wasmtime / issue #6095 ISLE: rewrite `and`/`or` of `icmp` · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236095.20ISLE.3A.20rewrite.20.60and.60.2F.60or.60.20of.20.60icmp.60.html">wasmtime / issue #6095 ISLE: rewrite `and`/`or` of `icmp`</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="344137080"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236095%20ISLE%3A%20rewrite%20%60and%60/%60or%60%20of%20%60icmp%60/near/344137080" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236095.20ISLE.3A.20rewrite.20.60and.60.2F.60or.60.20of.20.60icmp.60.html#344137080">(Mar 24 2023 at 01:39)</a>:</h4>
<p>jameysharp <a href="https://github.com/bytecodealliance/wasmtime/pull/6095#issuecomment-1482133404">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/6095">issue #6095</a>:</p>
<blockquote>
<p>I think we can factor these rules in a different way to reduce a bunch of the duplication. But I haven't figured out the details. I was fiddling with ideas like the following, though I'm not sure if this actually turns out any shorter:</p>
<p><div class="codehilite" data-code-language="Common Lisp"><pre><span></span><code><span class="p">(</span><span class="nv">decl</span><span class="w"> </span><span class="nv">pure</span><span class="w"> </span><span class="nv">partial</span><span class="w"> </span><span class="nv">eq_implies</span><span class="w"> </span><span class="p">(</span><span class="nv">Value</span><span class="w"> </span><span class="nv">Value</span><span class="w"> </span><span class="nv">Value</span><span class="p">)</span><span class="w"> </span><span class="nv">bool</span><span class="p">)</span>
<span class="p">(</span><span class="nv">rule</span><span class="w"> </span><span class="p">(</span><span class="nv">eq_implies</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="w"> </span><span class="p">(</span><span class="nb">eq</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="p">))</span><span class="w"> </span><span class="nv">$true</span><span class="p">)</span>
<span class="p">(</span><span class="nv">rule</span><span class="w"> </span><span class="p">(</span><span class="nv">eq_implies</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="w"> </span><span class="p">(</span><span class="nb">eq</span><span class="w"> </span><span class="nv">y</span><span class="w"> </span><span class="nv">x</span><span class="p">))</span><span class="w"> </span><span class="nv">$true</span><span class="p">)</span>
<span class="p">(</span><span class="nv">rule</span><span class="w"> </span><span class="p">(</span><span class="nv">eq_implies</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="w"> </span><span class="p">(</span><span class="nv">ule</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="p">))</span><span class="w"> </span><span class="nv">$true</span><span class="p">)</span>
<span class="p">(</span><span class="nv">rule</span><span class="w"> </span><span class="p">(</span><span class="nv">eq_implies</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="w"> </span><span class="p">(</span><span class="nv">uge</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="p">))</span><span class="w"> </span><span class="nv">$true</span><span class="p">)</span>
<span class="p">(</span><span class="nv">rule</span><span class="w"> </span><span class="p">(</span><span class="nv">eq_implies</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="w"> </span><span class="p">(</span><span class="nv">sle</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="p">))</span><span class="w"> </span><span class="nv">$true</span><span class="p">)</span>
<span class="p">(</span><span class="nv">rule</span><span class="w"> </span><span class="p">(</span><span class="nv">eq_implies</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="w"> </span><span class="p">(</span><span class="nv">sge</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="p">))</span><span class="w"> </span><span class="nv">$true</span><span class="p">)</span>
<span class="p">(</span><span class="nv">rule</span><span class="w"> </span><span class="p">(</span><span class="nv">eq_implies</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="w"> </span><span class="p">(</span><span class="nv">ne</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="p">))</span><span class="w"> </span><span class="nv">$false</span><span class="p">)</span>
<span class="p">(</span><span class="nv">rule</span><span class="w"> </span><span class="p">(</span><span class="nv">eq_implies</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="w"> </span><span class="p">(</span><span class="nv">ne</span><span class="w"> </span><span class="nv">y</span><span class="w"> </span><span class="nv">x</span><span class="p">))</span><span class="w"> </span><span class="nv">$false</span><span class="p">)</span>
<span class="p">(</span><span class="nv">rule</span><span class="w"> </span><span class="p">(</span><span class="nv">eq_implies</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="w"> </span><span class="p">(</span><span class="nv">ult</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="p">))</span><span class="w"> </span><span class="nv">$false</span><span class="p">)</span>
<span class="p">(</span><span class="nv">rule</span><span class="w"> </span><span class="p">(</span><span class="nv">eq_implies</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="w"> </span><span class="p">(</span><span class="nv">ugt</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="p">))</span><span class="w"> </span><span class="nv">$false</span><span class="p">)</span>
<span class="p">(</span><span class="nv">rule</span><span class="w"> </span><span class="p">(</span><span class="nv">eq_implies</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="w"> </span><span class="p">(</span><span class="nv">slt</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="p">))</span><span class="w"> </span><span class="nv">$false</span><span class="p">)</span>
<span class="p">(</span><span class="nv">rule</span><span class="w"> </span><span class="p">(</span><span class="nv">eq_implies</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="w"> </span><span class="p">(</span><span class="nv">sgt</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="p">))</span><span class="w"> </span><span class="nv">$false</span><span class="p">)</span>

<span class="p">(</span><span class="nv">decl</span><span class="w"> </span><span class="nv">pure</span><span class="w"> </span><span class="nv">partial</span><span class="w"> </span><span class="nv">ult_implies</span><span class="w"> </span><span class="p">(</span><span class="nv">Value</span><span class="w"> </span><span class="nv">Value</span><span class="w"> </span><span class="nv">Value</span><span class="p">)</span><span class="w"> </span><span class="nv">bool</span><span class="p">)</span>
<span class="p">(</span><span class="nv">rule</span><span class="w"> </span><span class="p">(</span><span class="nv">ult_implies</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="w"> </span><span class="p">(</span><span class="nb">eq</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="p">))</span><span class="w"> </span><span class="nv">$false</span><span class="p">)</span>
<span class="p">(</span><span class="nv">rule</span><span class="w"> </span><span class="p">(</span><span class="nv">ult_implies</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="w"> </span><span class="p">(</span><span class="nb">eq</span><span class="w"> </span><span class="nv">y</span><span class="w"> </span><span class="nv">x</span><span class="p">))</span><span class="w"> </span><span class="nv">$false</span><span class="p">)</span>
<span class="p">(</span><span class="nv">rule</span><span class="w"> </span><span class="p">(</span><span class="nv">ult_implies</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="w"> </span><span class="p">(</span><span class="nv">ne</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="p">))</span><span class="w"> </span><span class="nv">$true</span><span class="p">)</span>
<span class="p">(</span><span class="nv">rule</span><span class="w"> </span><span class="p">(</span><span class="nv">ult_implies</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="w"> </span><span class="p">(</span><span class="nv">ne</span><span class="w"> </span><span class="nv">y</span><span class="w"> </span><span class="nv">x</span><span class="p">))</span><span class="w"> </span><span class="nv">$true</span><span class="p">)</span>
<span class="p">(</span><span class="nv">rule</span><span class="w"> </span><span class="p">(</span><span class="nv">ult_implies</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="w"> </span><span class="p">(</span><span class="nv">ult</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="p">))</span><span class="w"> </span><span class="nv">$true</span><span class="p">)</span>
<span class="p">(</span><span class="nv">rule</span><span class="w"> </span><span class="p">(</span><span class="nv">ult_implies</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="w"> </span><span class="p">(</span><span class="nv">ule</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="p">))</span><span class="w"> </span><span class="nv">$true</span><span class="p">)</span>
<span class="p">(</span><span class="nv">rule</span><span class="w"> </span><span class="p">(</span><span class="nv">ult_implies</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="w"> </span><span class="p">(</span><span class="nv">uge</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="p">))</span><span class="w"> </span><span class="nv">$false</span><span class="p">)</span>
<span class="p">(</span><span class="nv">rule</span><span class="w"> </span><span class="p">(</span><span class="nv">ult_implies</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="w"> </span><span class="p">(</span><span class="nv">ugt</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="p">))</span><span class="w"> </span><span class="nv">$false</span><span class="p">)</span>

<span class="p">(</span><span class="nv">rule</span><span class="w"> </span><span class="p">(</span><span class="nv">simplify</span><span class="w"> </span><span class="p">(</span><span class="nv">band</span><span class="w"> </span><span class="nv">ty</span><span class="w"> </span><span class="p">(</span><span class="nb">eq</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="p">)</span><span class="w"> </span><span class="nv">other</span><span class="p">))</span>
<span class="w">  </span><span class="p">(</span><span class="nv">if-let</span><span class="w"> </span><span class="nv">$true</span><span class="w"> </span><span class="p">(</span><span class="nv">eq_implies</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="w"> </span><span class="nv">other</span><span class="p">))</span>
<span class="w">  </span><span class="p">(</span><span class="nv">subsume</span><span class="w"> </span><span class="p">(</span><span class="nv">iconst</span><span class="w"> </span><span class="nv">ty</span><span class="w"> </span><span class="mi">1</span><span class="p">)))</span>

<span class="p">(</span><span class="nv">rule</span><span class="w"> </span><span class="p">(</span><span class="nv">simplify</span><span class="w"> </span><span class="p">(</span><span class="nv">band</span><span class="w"> </span><span class="nv">ty</span><span class="w"> </span><span class="nv">other</span><span class="w"> </span><span class="p">(</span><span class="nb">eq</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="p">)))</span>
<span class="w">  </span><span class="p">(</span><span class="nv">if-let</span><span class="w"> </span><span class="nv">$true</span><span class="w"> </span><span class="p">(</span><span class="nv">eq_implies</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="w"> </span><span class="nv">other</span><span class="p">))</span>
<span class="w">  </span><span class="p">(</span><span class="nv">subsume</span><span class="w"> </span><span class="p">(</span><span class="nv">iconst</span><span class="w"> </span><span class="nv">ty</span><span class="w"> </span><span class="mi">1</span><span class="p">)))</span>

<span class="p">(</span><span class="nv">rule</span><span class="w"> </span><span class="p">(</span><span class="nv">simplify</span><span class="w"> </span><span class="p">(</span><span class="nv">band</span><span class="w"> </span><span class="nv">ty</span><span class="w"> </span><span class="p">(</span><span class="nb">eq</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="p">)</span><span class="w"> </span><span class="nv">other</span><span class="p">))</span>
<span class="w">  </span><span class="p">(</span><span class="nv">if-let</span><span class="w"> </span><span class="nv">$false</span><span class="w"> </span><span class="p">(</span><span class="nv">eq_implies</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="w"> </span><span class="nv">other</span><span class="p">))</span>
<span class="w">  </span><span class="p">(</span><span class="nv">subsume</span><span class="w"> </span><span class="p">(</span><span class="nv">iconst</span><span class="w"> </span><span class="nv">ty</span><span class="w"> </span><span class="mi">0</span><span class="p">)))</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="344140462"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236095%20ISLE%3A%20rewrite%20%60and%60/%60or%60%20of%20%60icmp%60/near/344140462" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236095.20ISLE.3A.20rewrite.20.60and.60.2F.60or.60.20of.20.60icmp.60.html#344140462">(Mar 24 2023 at 02:16)</a>:</h4>
<p>Kmeakin <a href="https://github.com/bytecodealliance/wasmtime/pull/6095#issuecomment-1482157140">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/6095">issue #6095</a>:</p>
<blockquote>
<blockquote>
<p>I think we can factor these rules in a different way to reduce a bunch of the duplication. But I haven't figured out the details. I was fiddling with ideas like the following, though I'm not sure if this actually turns out any shorter:</p>
</blockquote>
<p>I think this would work out to being basically the same length. We could remove half the cases by adding rules to make <code>band</code> and <code>bor</code> commutative. Not sure if that would lead to a performance penalty though. </p>
</blockquote>



<a name="344610940"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236095%20ISLE%3A%20rewrite%20%60and%60/%60or%60%20of%20%60icmp%60/near/344610940" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236095.20ISLE.3A.20rewrite.20.60and.60.2F.60or.60.20of.20.60icmp.60.html#344610940">(Mar 26 2023 at 08:06)</a>:</h4>
<p>jameysharp <a href="https://github.com/bytecodealliance/wasmtime/pull/6095#issuecomment-1484026261">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/6095">issue #6095</a>:</p>
<blockquote>
<p>I've been unable to let go of this and just enjoy my weekend, so:</p>
<p>Can we do it this way? Decompose both condition codes into separate "less than", "equal to", and "greater than" booleans, then pairwise apply "and"/"or" to the booleans according to whether the comparisons were combined with <code>band</code> or <code>bor</code>, and finally compose the booleans back into a condition code.</p>
<div class="codehilite" data-code-language="Common Lisp"><pre><span></span><code><span class="p">(</span><span class="nv">decl</span><span class="w"> </span><span class="nv">pure</span><span class="w"> </span><span class="nv">decompose_intcc</span><span class="w"> </span><span class="p">(</span><span class="nv">IntCC</span><span class="p">)</span><span class="w"> </span><span class="nv">u64</span><span class="p">)</span>
<span class="p">(</span><span class="nv">rule</span><span class="w"> </span><span class="p">(</span><span class="nv">decompose_intcc</span><span class="w"> </span><span class="nv">IntCC.Equal</span><span class="p">)</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="p">(</span><span class="nv">rule</span><span class="w"> </span><span class="p">(</span><span class="nv">decompose_intcc</span><span class="w"> </span><span class="nv">IntCC.UnsignedLessThan</span><span class="p">)</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>
<span class="p">(</span><span class="nv">rule</span><span class="w"> </span><span class="p">(</span><span class="nv">decompose_intcc</span><span class="w"> </span><span class="nv">IntCC.UnsignedLessThanOrEqual</span><span class="p">)</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span>
<span class="p">(</span><span class="nv">rule</span><span class="w"> </span><span class="p">(</span><span class="nv">decompose_intcc</span><span class="w"> </span><span class="nv">IntCC.UnsignedGreaterThan</span><span class="p">)</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span>
<span class="p">(</span><span class="nv">rule</span><span class="w"> </span><span class="p">(</span><span class="nv">decompose_intcc</span><span class="w"> </span><span class="nv">IntCC.UnsignedGreaterThanOrEqual</span><span class="p">)</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span>
<span class="p">(</span><span class="nv">rule</span><span class="w"> </span><span class="p">(</span><span class="nv">decompose_intcc</span><span class="w"> </span><span class="nv">IntCC.NotEqual</span><span class="p">)</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span>

<span class="p">(</span><span class="nv">decl</span><span class="w"> </span><span class="nv">pure</span><span class="w"> </span><span class="nv">partial</span><span class="w"> </span><span class="nv">compose_intcc</span><span class="w"> </span><span class="p">(</span><span class="nv">u64</span><span class="p">)</span><span class="w"> </span><span class="nv">IntCC</span><span class="p">)</span>
<span class="c1">; inverse of `decompose_intcc`</span>

<span class="p">(</span><span class="nv">rule</span><span class="w"> </span><span class="p">(</span><span class="nv">simplify</span><span class="w"> </span><span class="p">(</span><span class="nv">band</span><span class="w"> </span><span class="nv">ty</span><span class="w"> </span><span class="p">(</span><span class="nv">icmp</span><span class="w"> </span><span class="nv">ty</span><span class="w"> </span><span class="nv">cc1</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nv">icmp</span><span class="w"> </span><span class="nv">ty</span><span class="w"> </span><span class="nv">cc2</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="p">)))</span>
<span class="w">  </span><span class="p">(</span><span class="nv">if-let</span><span class="w"> </span><span class="nv">cc</span><span class="w"> </span><span class="p">(</span><span class="nv">compose_intcc</span><span class="w"> </span><span class="p">(</span><span class="nv">u64_and</span><span class="w"> </span><span class="p">(</span><span class="nv">decompose_intcc</span><span class="w"> </span><span class="nv">cc1</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nv">decompose_intcc</span><span class="w"> </span><span class="nv">cc2</span><span class="p">))))</span>
<span class="w">  </span><span class="p">(</span><span class="nv">icmp</span><span class="w"> </span><span class="nv">ty</span><span class="w"> </span><span class="nv">cc</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="p">))</span>
<span class="p">(</span><span class="nv">rule</span><span class="w"> </span><span class="p">(</span><span class="nv">simplify</span><span class="w"> </span><span class="p">(</span><span class="nv">band</span><span class="w"> </span><span class="nv">ty</span><span class="w"> </span><span class="p">(</span><span class="nv">icmp</span><span class="w"> </span><span class="nv">ty</span><span class="w"> </span><span class="nv">cc1</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nv">icmp</span><span class="w"> </span><span class="nv">ty</span><span class="w"> </span><span class="nv">cc2</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="p">)))</span>
<span class="w">  </span><span class="p">(</span><span class="nv">if-let</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="nv">u64_and</span><span class="w"> </span><span class="p">(</span><span class="nv">decompose_intcc</span><span class="w"> </span><span class="nv">cc1</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nv">decompose_intcc</span><span class="w"> </span><span class="nv">cc2</span><span class="p">)))</span>
<span class="w">  </span><span class="p">(</span><span class="nv">subsume</span><span class="w"> </span><span class="p">(</span><span class="nv">iconst</span><span class="w"> </span><span class="nv">ty</span><span class="w"> </span><span class="p">(</span><span class="nv">imm64</span><span class="w"> </span><span class="mi">0</span><span class="p">))))</span>

<span class="p">(</span><span class="nv">rule</span><span class="w"> </span><span class="p">(</span><span class="nv">simplify</span><span class="w"> </span><span class="p">(</span><span class="nv">bor</span><span class="w"> </span><span class="nv">ty</span><span class="w"> </span><span class="p">(</span><span class="nv">icmp</span><span class="w"> </span><span class="nv">ty</span><span class="w"> </span><span class="nv">cc1</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nv">icmp</span><span class="w"> </span><span class="nv">ty</span><span class="w"> </span><span class="nv">cc2</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="p">)))</span>
<span class="w">  </span><span class="p">(</span><span class="nv">if-let</span><span class="w"> </span><span class="nv">cc</span><span class="w"> </span><span class="p">(</span><span class="nv">compose_intcc</span><span class="w"> </span><span class="p">(</span><span class="nv">u64_or</span><span class="w"> </span><span class="p">(</span><span class="nv">decompose_intcc</span><span class="w"> </span><span class="nv">cc1</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nv">decompose_intcc</span><span class="w"> </span><span class="nv">cc2</span><span class="p">))))</span>
<span class="w">  </span><span class="p">(</span><span class="nv">icmp</span><span class="w"> </span><span class="nv">ty</span><span class="w"> </span><span class="nv">cc</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="p">))</span>
<span class="p">(</span><span class="nv">rule</span><span class="w"> </span><span class="p">(</span><span class="nv">simplify</span><span class="w"> </span><span class="p">(</span><span class="nv">bor</span><span class="w"> </span><span class="nv">ty</span><span class="w"> </span><span class="p">(</span><span class="nv">icmp</span><span class="w"> </span><span class="nv">ty</span><span class="w"> </span><span class="nv">cc1</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nv">icmp</span><span class="w"> </span><span class="nv">ty</span><span class="w"> </span><span class="nv">cc2</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="p">)))</span>
<span class="w">  </span><span class="p">(</span><span class="nv">if-let</span><span class="w"> </span><span class="mi">7</span><span class="w"> </span><span class="p">(</span><span class="nv">u64_or</span><span class="w"> </span><span class="p">(</span><span class="nv">decompose_intcc</span><span class="w"> </span><span class="nv">cc1</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nv">decompose_intcc</span><span class="w"> </span><span class="nv">cc2</span><span class="p">)))</span>
<span class="w">  </span><span class="p">(</span><span class="nv">subsume</span><span class="w"> </span><span class="p">(</span><span class="nv">iconst</span><span class="w"> </span><span class="nv">ty</span><span class="w"> </span><span class="p">(</span><span class="nv">imm64</span><span class="w"> </span><span class="mi">1</span><span class="p">))))</span>
</code></pre></div>
<p>That doesn't handle signedness but I think fixing that shouldn't be too much more involved.</p>
<p>Adding the cases where one of the comparisons has its operands flipped (<code>icmp ty cc2 y x</code>) should be easy to handle this way too; we just need to use <code>intcc_reverse</code> on <code>cc2</code>.</p>
<p>Also I think this extends in the obvious way to <code>xor</code>, which may not be important but seems nice to have.</p>
</blockquote>



<a name="344699301"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236095%20ISLE%3A%20rewrite%20%60and%60/%60or%60%20of%20%60icmp%60/near/344699301" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236095.20ISLE.3A.20rewrite.20.60and.60.2F.60or.60.20of.20.60icmp.60.html#344699301">(Mar 26 2023 at 18:09)</a>:</h4>
<p>jameysharp <a href="https://github.com/bytecodealliance/wasmtime/pull/6095#issuecomment-1484175597">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/6095">issue #6095</a>:</p>
<blockquote>
<p>The signedness condition can work in a similar way:</p>
<div class="codehilite" data-code-language="Common Lisp"><pre><span></span><code><span class="p">(</span><span class="nv">decl</span><span class="w"> </span><span class="nv">pure</span><span class="w"> </span><span class="nv">intcc_class</span><span class="w"> </span><span class="p">(</span><span class="nv">IntCC</span><span class="p">)</span><span class="w"> </span><span class="nv">u64</span><span class="p">)</span>
<span class="p">(</span><span class="nv">rule</span><span class="w"> </span><span class="p">(</span><span class="nv">intcc_class</span><span class="w"> </span><span class="nv">IntCC.UnsignedLessThan</span><span class="p">)</span><span class="w"> </span><span class="nv">0b01</span><span class="p">)</span>
<span class="p">(</span><span class="nv">rule</span><span class="w"> </span><span class="p">(</span><span class="nv">intcc_class</span><span class="w"> </span><span class="nv">IntCC.UnsignedLessThanEqual</span><span class="p">)</span><span class="w"> </span><span class="nv">0b01</span><span class="p">)</span>
<span class="p">(</span><span class="nv">rule</span><span class="w"> </span><span class="p">(</span><span class="nv">intcc_class</span><span class="w"> </span><span class="nv">IntCC.UnsignedGreaterThan</span><span class="p">)</span><span class="w"> </span><span class="nv">0b01</span><span class="p">)</span>
<span class="p">(</span><span class="nv">rule</span><span class="w"> </span><span class="p">(</span><span class="nv">intcc_class</span><span class="w"> </span><span class="nv">IntCC.UnsignedGreaterThanEqual</span><span class="p">)</span><span class="w"> </span><span class="nv">0b01</span><span class="p">)</span>
<span class="p">(</span><span class="nv">rule</span><span class="w"> </span><span class="p">(</span><span class="nv">intcc_class</span><span class="w"> </span><span class="nv">IntCC.SignedLessThan</span><span class="p">)</span><span class="w"> </span><span class="nv">0b10</span><span class="p">)</span>
<span class="p">(</span><span class="nv">rule</span><span class="w"> </span><span class="p">(</span><span class="nv">intcc_class</span><span class="w"> </span><span class="nv">IntCC.SignedLessThanEqual</span><span class="p">)</span><span class="w"> </span><span class="nv">0b10</span><span class="p">)</span>
<span class="p">(</span><span class="nv">rule</span><span class="w"> </span><span class="p">(</span><span class="nv">intcc_class</span><span class="w"> </span><span class="nv">IntCC.SignedGreaterThan</span><span class="p">)</span><span class="w"> </span><span class="nv">0b10</span><span class="p">)</span>
<span class="p">(</span><span class="nv">rule</span><span class="w"> </span><span class="p">(</span><span class="nv">intcc_class</span><span class="w"> </span><span class="nv">IntCC.SignedGreaterThanEqual</span><span class="p">)</span><span class="w"> </span><span class="nv">0b10</span><span class="p">)</span>
<span class="p">(</span><span class="nv">rule</span><span class="w"> </span><span class="p">(</span><span class="nv">intcc_class</span><span class="w"> </span><span class="nv">IntCC.Equal</span><span class="p">)</span><span class="w"> </span><span class="nv">0b11</span><span class="p">)</span>
<span class="p">(</span><span class="nv">rule</span><span class="w"> </span><span class="p">(</span><span class="nv">intcc_class</span><span class="w"> </span><span class="nv">IntCC.NotEqual</span><span class="p">)</span><span class="w"> </span><span class="nv">0b11</span><span class="p">)</span>

<span class="p">(</span><span class="nv">decl</span><span class="w"> </span><span class="nv">pure</span><span class="w"> </span><span class="nv">intcc_comparable</span><span class="w"> </span><span class="p">(</span><span class="nv">IntCC</span><span class="w"> </span><span class="nv">IntCC</span><span class="p">)</span><span class="w"> </span><span class="nv">Unit</span><span class="p">)</span>
<span class="p">(</span><span class="nv">rule</span><span class="w"> </span><span class="p">(</span><span class="nv">intcc_comparable</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nv">if-let</span><span class="w"> </span><span class="p">(</span><span class="nv">u64_nonzero</span><span class="w"> </span><span class="nv">_</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nv">u64_and</span><span class="w"> </span><span class="p">(</span><span class="nv">intcc_class</span><span class="w"> </span><span class="nv">x</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nv">intcc_class</span><span class="w"> </span><span class="nv">y</span><span class="p">)))</span>
<span class="w">  </span><span class="p">(</span><span class="nv">unit</span><span class="p">))</span>
</code></pre></div>
<p>Then add <code>(if-let _ (intcc_comparable cc1 cc2))</code> to the <code>simplify</code> rules that I wrote out earlier.</p>
<p>The <code>decompose_intcc</code> rules might be easier to understand with binary literals instead of decimal, too: <code>Equal</code> is <code>0b001</code>, <code>LessThan</code> is <code>0b010</code>, <code>LessThanOrEqual</code> is <code>0b011</code>, etc. At the least all of this needs comments identifying which bit means what; I just wanted to write it out quickly to illustrate the idea.</p>
</blockquote>



<a name="344702242"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236095%20ISLE%3A%20rewrite%20%60and%60/%60or%60%20of%20%60icmp%60/near/344702242" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236095.20ISLE.3A.20rewrite.20.60and.60.2F.60or.60.20of.20.60icmp.60.html#344702242">(Mar 26 2023 at 18:41)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/6095#issuecomment-1484183322">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/6095">issue #6095</a>:</p>
<blockquote>
<p>That's a really incredibly neat way of seeing the rewrite!</p>
<p>I was trying to work out for myself <em>why</em> it should work, since it's non-obvious (at least to me!) why AND of the bitfield representation should be AND of the <code>icmp</code> results. I think both OR and AND work because of the following (let's take just unsigneds for now):</p>
<ul>
<li>An <code>IntCC</code> condition is a disjunction (OR) of up to three "fundamental" comparisons: e.g. <code>UnsignedLessThanOrEqual</code> is logically <code>LessThan OR Equal</code>.</li>
<li>As such, your three-bit encoding could be seen as a Boolean polynomial that describes the <code>icmp</code> result. Take <code>x := LT, y := EQ, z: GT</code>, then one might have <code>icmp(..) = x + y</code> (<code>011</code>) or <code>icmp(..) = x + z</code> (<code>101</code>) or just <code>icmp(..) = y</code> (<code>010</code>).</li>
<li>The OR of the <code>icmp</code> results is then the OR of these polynomials, and Boolean logic tells us that they add in exactly the way that the OR of the bitfield representation would give us. So if <code>result = icmp(cc1, ..) + icmp(cc2, ..)</code> and we have the substitutions <code>result = (x + y) + (x + z)</code>, then we get <code>result = x + y + z</code> and convert that back into a condition code.<ul>
<li>Incidentally, <code>x + y + z</code> here reduces to constant true which corresponds to your special-case rule for <code>7</code>!</li>
</ul>
</li>
<li>The AND is where it gets interesting! This looks like: <code>result = icmp(cc1, ..) * icmp(cc2, ..) = (x + y) * (x + z)</code>, and AND distributes over OR so we can do the binomial expansion <code>x*x + x*z + y*x + y*z</code>, then use identities (x AND x = x) and a fact about our inputs, namely that <code>x</code>, <code>y</code>, and <code>z</code> are disjoint (x AND z = 0, y AND z = 0, x AND y = 0), to realize that the simplified product <code>x</code> is exactly the sum of terms that appear in both sides of the product. That's the bitwise AND.</li>
</ul>
<p>The above line of reasoning doesn't quite work directly for XOR (XOR does not distribute over OR in general) but I think given the disjointness property one could argue that it does in this case.</p>
</blockquote>



<a name="344711107"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236095%20ISLE%3A%20rewrite%20%60and%60/%60or%60%20of%20%60icmp%60/near/344711107" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236095.20ISLE.3A.20rewrite.20.60and.60.2F.60or.60.20of.20.60icmp.60.html#344711107">(Mar 26 2023 at 20:14)</a>:</h4>
<p>jameysharp <a href="https://github.com/bytecodealliance/wasmtime/pull/6095#issuecomment-1484210350">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/6095">issue #6095</a>:</p>
<blockquote>
<p>That's a nice way to prove it! I was thinking about it differently, by conditioning on the actual relationship between the inputs. For example, assume that <code>x</code> is less than <code>y</code>. Then and-of-icmp is true iff both icmp conditions include less-than. Similar reasoning applies to the case where <code>x</code> is equal to <code>y</code>, for any other boolean operator, and so on.</p>
<p>On further thought I think there are even more concise ways to factor this:</p>
<p><div class="codehilite" data-code-language="Common Lisp"><pre><span></span><code><span class="p">(</span><span class="nv">decl</span><span class="w"> </span><span class="nv">pure</span><span class="w"> </span><span class="nv">partial</span><span class="w"> </span><span class="nv">intcc_comparable</span><span class="w"> </span><span class="p">(</span><span class="nv">IntCC</span><span class="w"> </span><span class="nv">IntCC</span><span class="p">)</span><span class="w"> </span><span class="nv">bool</span><span class="p">)</span>
<span class="p">(</span><span class="nv">rule</span><span class="w"> </span><span class="p">(</span><span class="nv">intcc_comparable</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nv">if-let</span><span class="w"> </span><span class="p">(</span><span class="nv">u64_nonzero</span><span class="w"> </span><span class="nc">class</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nv">u64_and</span><span class="w"> </span><span class="p">(</span><span class="nv">intcc_class</span><span class="w"> </span><span class="nv">x</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nv">intcc_class</span><span class="w"> </span><span class="nv">y</span><span class="p">)))</span>
<span class="w">  </span><span class="p">(</span><span class="nv">u64_eq</span><span class="w"> </span><span class="nv">0b10</span><span class="w"> </span><span class="nc">class</span><span class="p">))</span>

<span class="p">(</span><span class="nv">decl</span><span class="w"> </span><span class="nv">pure</span><span class="w"> </span><span class="nv">compose_icmp</span><span class="w"> </span><span class="p">(</span><span class="nv">Type</span><span class="w"> </span><span class="nv">u64</span><span class="w"> </span><span class="nv">bool</span><span class="w"> </span><span class="nv">Value</span><span class="w"> </span><span class="nv">Value</span><span class="p">)</span><span class="w"> </span><span class="nv">Value</span><span class="p">)</span>
<span class="p">(</span><span class="nv">rule</span><span class="w"> </span><span class="p">(</span><span class="nv">compose_icmp</span><span class="w"> </span><span class="nv">ty</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nv">subsume</span><span class="w"> </span><span class="p">(</span><span class="nv">iconst</span><span class="w"> </span><span class="nv">ty</span><span class="w"> </span><span class="p">(</span><span class="nv">imm64</span><span class="w"> </span><span class="mi">0</span><span class="p">))))</span>
<span class="p">(</span><span class="nv">rule</span><span class="w"> </span><span class="p">(</span><span class="nv">compose_icmp</span><span class="w"> </span><span class="nv">ty</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nv">icmp</span><span class="w"> </span><span class="nv">ty</span><span class="w"> </span><span class="nv">IntCC.Equal</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="p">))</span>
<span class="p">(</span><span class="nv">rule</span><span class="w"> </span><span class="p">(</span><span class="nv">compose_icmp</span><span class="w"> </span><span class="nv">ty</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="nv">$false</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nv">icmp</span><span class="w"> </span><span class="nv">ty</span><span class="w"> </span><span class="nv">IntCC.UnsignedLessThan</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="p">))</span>
<span class="p">(</span><span class="nv">rule</span><span class="w"> </span><span class="p">(</span><span class="nv">compose_icmp</span><span class="w"> </span><span class="nv">ty</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="nv">$true</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nv">icmp</span><span class="w"> </span><span class="nv">ty</span><span class="w"> </span><span class="nv">IntCC.SignedLessThan</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="p">))</span>
<span class="c1">; ...</span>
<span class="p">(</span><span class="nv">rule</span><span class="w"> </span><span class="p">(</span><span class="nv">compose_icmp</span><span class="w"> </span><span class="nv">ty</span><span class="w"> </span><span class="mi">6</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nv">icmp</span><span class="w"> </span><span class="nv">ty</span><span class="w"> </span><span class="nv">IntCC.NotEqual</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="p">))</span>
<span class="p">(</span><span class="nv">rule</span><span class="w"> </span><span class="p">(</span><span class="nv">compose_icmp</span><span class="w"> </span><span class="nv">ty</span><span class="w"> </span><span class="mi">7</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">_</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nv">subsume</span><span class="w"> </span><span class="p">(</span><span class="nv">iconst</span><span class="w"> </span><span class="nv">ty</span><span class="w"> </span><span class="p">(</span><span class="nv">imm64</span><span class="w"> </span><span class="mi">1</span><span class="p">))))</span>

<span class="p">(</span><span class="nv">rule</span><span class="w"> </span><span class="p">(</span><span class="nv">simplify</span><span class="w"> </span><span class="p">(</span><span class="nv">band</span><span class="w"> </span><span class="nv">ty</span><span class="w"> </span><span class="p">(</span><span class="nv">icmp</span><span class="w"> </span><span class="nv">ty</span><span class="w"> </span><span class="nv">cc1</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nv">icmp</span><span class="w"> </span><span class="nv">ty</span><span class="w"> </span><span class="nv">cc2</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="p">)))</span>
<span class="w">  </span><span class="p">(</span><span class="nv">if-let</span><span class="w"> </span><span class="nv">signed</span><span class="w"> </span><span class="p">(</span><span class="nv">intcc_comparable</span><span class="w"> </span><span class="nv">cc1</span><span class="w"> </span><span class="nv">cc2</span><span class="p">))</span>
<span class="w">  </span><span class="p">(</span><span class="nv">compose_icmp</span><span class="w"> </span><span class="nv">ty</span><span class="w"> </span><span class="p">(</span><span class="nv">u64_and</span><span class="w"> </span><span class="p">(</span><span class="nv">decompose_intcc</span><span class="w"> </span><span class="nv">cc1</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nv">decompose_intcc</span><span class="w"> </span><span class="nv">cc2</span><span class="p">))</span><span class="w"> </span><span class="nv">signed</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="p">))</span>

<span class="p">(</span><span class="nv">rule</span><span class="w"> </span><span class="p">(</span><span class="nv">simplify</span><span class="w"> </span><span class="p">(</span><span class="nv">bor</span><span class="w"> </span><span class="nv">ty</span><span class="w"> </span><span class="p">(</span><span class="nv">icmp</span><span class="w"> </span><span class="nv">ty</span><span class="w"> </span><span class="nv">cc1</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nv">icmp</span><span class="w"> </span><span class="nv">ty</span><span class="w"> </span><span class="nv">cc2</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="p">)))</span>
<span class="w">  </span><span class="p">(</span><span class="nv">if-let</span><span class="w"> </span><span class="nv">signed</span><span class="w"> </span><span class="p">(</span><span class="nv">intcc_comparable</span><span class="w"> </span><span class="nv">cc1</span><span class="w"> </span><span class="nv">cc2</span><span class="p">))</span>
<span class="w">  </span><span class="p">(</span><span class="nv">compose_icmp</span><span class="w"> </span><span class="nv">ty</span><span class="w"> </span><span class="p">(</span><span class="nv">u64_or</span><span class="w"> </span><span class="p">(</span><span class="nv">decompose_intcc</span><span class="w"> </span><span class="nv">cc1</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nv">decompose_intcc</span><span class="w"> </span><span class="nv">cc2</span><span class="p">))</span><span class="w"> </span><span class="nv">signed</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="p">))</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="345002939"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236095%20ISLE%3A%20rewrite%20%60and%60/%60or%60%20of%20%60icmp%60/near/345002939" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236095.20ISLE.3A.20rewrite.20.60and.60.2F.60or.60.20of.20.60icmp.60.html#345002939">(Mar 28 2023 at 01:05)</a>:</h4>
<p>Kmeakin <a href="https://github.com/bytecodealliance/wasmtime/pull/6095#issuecomment-1486063681">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/6095">issue #6095</a>:</p>
<blockquote>
<p>Thank you @jameysharp and @cfallin. I have updated the patch with your contributions</p>
</blockquote>



<a name="345005544"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236095%20ISLE%3A%20rewrite%20%60and%60/%60or%60%20of%20%60icmp%60/near/345005544" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236095.20ISLE.3A.20rewrite.20.60and.60.2F.60or.60.20of.20.60icmp.60.html#345005544">(Mar 28 2023 at 01:30)</a>:</h4>
<p>jameysharp <a href="https://github.com/bytecodealliance/wasmtime/pull/6095#issuecomment-1486079211">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/6095">issue #6095</a>:</p>
<blockquote>
<p>Nice! This means the changes to <code>prelude.isle</code> and the various corresponding Rust sources are no longer necessary, right?</p>
<p>I meant to ask before: could you commit the script you used to generate the tests too? We have precedent for that in <code>cranelift/filetests/filetests/wasm/load-store/make-load-store-tests.sh</code>.</p>
<p>Also, I guess now we need to either merge #6111 before finishing this PR, or decide we want these tests to not check the full output and back out the precise-output changes. I haven't thought about this enough to have an opinion on that question yet.</p>
</blockquote>



<a name="345006514"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236095%20ISLE%3A%20rewrite%20%60and%60/%60or%60%20of%20%60icmp%60/near/345006514" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236095.20ISLE.3A.20rewrite.20.60and.60.2F.60or.60.20of.20.60icmp.60.html#345006514">(Mar 28 2023 at 01:42)</a>:</h4>
<p>Kmeakin <a href="https://github.com/bytecodealliance/wasmtime/pull/6095#issuecomment-1486086464">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/6095">issue #6095</a>:</p>
<blockquote>
<blockquote>
<p>Nice! This means the changes to <code>prelude.isle</code> and the various corresponding Rust sources are no longer necessary, right?</p>
</blockquote>
<p>Good point, I forgot to remove those</p>
<blockquote>
<p>I meant to ask before: could you commit the script you used to generate the tests too? We have precedent for that in <code>cranelift/filetests/filetests/wasm/load-store/make-load-store-tests.sh</code>.</p>
</blockquote>
<p>I used a rust program but I can convert it to a shell script</p>
<blockquote>
<p>Also, I guess now we need to either merge #6111 before finishing this PR, or decide we want these tests to not check the full output and back out the precise-output changes. I haven't thought about this enough to have an opinion on that question yet.</p>
</blockquote>
<p>I would prefer to wait for #6111</p>
</blockquote>



<a name="345007074"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236095%20ISLE%3A%20rewrite%20%60and%60/%60or%60%20of%20%60icmp%60/near/345007074" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236095.20ISLE.3A.20rewrite.20.60and.60.2F.60or.60.20of.20.60icmp.60.html#345007074">(Mar 28 2023 at 01:50)</a>:</h4>
<p>jameysharp <a href="https://github.com/bytecodealliance/wasmtime/pull/6095#issuecomment-1486090651">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/6095">issue #6095</a>:</p>
<blockquote>
<p>You can remove the changes in <code>cranelift/codegen/src/ir/condcodes.rs</code> too, right?</p>
<p>And the changes in <code>cranelift/codegen/src/isle_prelude.rs</code> aren't necessary; I think I prefer the existing way. If somebody added a condition code for some reason, using a wildcard match here hides potential bugs.</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>