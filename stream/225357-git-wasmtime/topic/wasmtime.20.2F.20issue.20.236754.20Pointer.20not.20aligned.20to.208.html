<html>
<head><meta charset="utf-8"><title>wasmtime / issue #6754 Pointer not aligned to 8 · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236754.20Pointer.20not.20aligned.20to.208.html">wasmtime / issue #6754 Pointer not aligned to 8</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="376941044"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236754%20Pointer%20not%20aligned%20to%208/near/376941044" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236754.20Pointer.20not.20aligned.20to.208.html#376941044">(Jul 20 2023 at 11:23)</a>:</h4>
<p><a href="https://github.com/dbezhetskov">dbezhetskov</a> added the <a href="https://api.github.com/repos/bytecodealliance/wasmtime/labels/bug">bug</a> label to <a href="https://github.com/bytecodealliance/wasmtime/issues/6754">Issue #6754</a>.</p>



<a name="376941046"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236754%20Pointer%20not%20aligned%20to%208/near/376941046" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236754.20Pointer.20not.20aligned.20to.208.html#376941046">(Jul 20 2023 at 11:23)</a>:</h4>
<p>dbezhetskov opened <a href="https://github.com/bytecodealliance/wasmtime/issues/6754">issue #6754</a>:</p>
<blockquote>
<h3>Test Case</h3>
<p>I'm experimenting with generating wasm and SpiderMonkey. The test case is a bit hard to reproduce but it is just executing a mix of generated by hand wasm and SpiderMonkey compiled to wasm.</p>
<h3>Steps to Reproduce</h3>
<p>...</p>
<h3>Expected Results</h3>
<p>No bug.</p>
<h3>Actual Results</h3>
<p>wasmtime._error.WasmtimeError: error while executing at wasm backtrace:<br>
    0: 0x776866 - &lt;unknown&gt;!__wasi_clock_time_get<br>
    1: 0x77667d - &lt;unknown&gt;!__clock_gettime<br>
    2: 0x10b26 - &lt;unknown&gt;!mozilla::TimeStamp::Now(bool)<br>
    3: 0x466d61 - &lt;unknown&gt;!js::jit::BaselineCacheIRCompiler::compile()<br>
    4: 0x46fbc9 - &lt;unknown&gt;!js::jit::AttachBaselineCacheIRStub(JSContext<em>, js::jit::CacheIRWriter const&amp;, js::jit::CacheKind, JSScript</em>, js::jit::ICScript<em>, js::jit::ICFallbackStub</em>, char const*)<br>
    5: 0x48bd4d - &lt;unknown&gt;!js::jit::DoSetElemFallback(JSContext<em>, js::jit::BaselineFrame</em>, js::jit::ICFallbackStub<em>, JS::Value</em>, JS::Handle&lt;JS::Value&gt;, JS::Handle&lt;JS::Value&gt;, JS::Handle&lt;JS::Value&gt;)<br>
    6:  0xdbc - &lt;unknown&gt;!&lt;wasm function 11&gt;<br>
    7: 0x2674 - &lt;unknown&gt;!&lt;wasm function 37&gt;<br>
    8: 0x2022 - &lt;unknown&gt;!&lt;wasm function 33&gt;<br>
    9:  0x393 - &lt;unknown&gt;!&lt;wasm function 0&gt;<br>
   10: 0x5c315f - &lt;unknown&gt;!js::jit::MaybeEnterJit(JSContext*, js::RunState&amp;)<br>
   11: 0x8bfbf - &lt;unknown&gt;!js::RunScript(JSContext*, js::RunState&amp;)<br>
   12: 0x9cdc4 - &lt;unknown&gt;!js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&amp;, js::MaybeConstruct, js::CallReason)<br>
   13: 0x9d541 - &lt;unknown&gt;!js::CallFromStack(JSContext*, JS::CallArgs const&amp;, js::CallReason)<br>
   14: 0x48efd5 - &lt;unknown&gt;!js::jit::DoCallFallback(JSContext<em>, js::jit::BaselineFrame</em>, js::jit::ICFallbackStub<em>, unsigned int, JS::Value</em>, JS::MutableHandle&lt;JS::Value&gt;)<br>
   15:  0x86c - &lt;unknown&gt;!&lt;wasm function 5&gt;<br>
   16: 0x231d - &lt;unknown&gt;!&lt;wasm function 35&gt;<br>
   17: 0x21a6 - &lt;unknown&gt;!&lt;wasm function 34&gt;<br>
   18:  0x393 - &lt;unknown&gt;!&lt;wasm function 0&gt;<br>
   19: 0x5c315f - &lt;unknown&gt;!js::jit::MaybeEnterJit(JSContext*, js::RunState&amp;)<br>
   20: 0x8bfbf - &lt;unknown&gt;!js::RunScript(JSContext*, js::RunState&amp;)<br>
   21: 0x9cdc4 - &lt;unknown&gt;!js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&amp;, js::MaybeConstruct, js::CallReason)<br>
   22: 0x9d653 - &lt;unknown&gt;!js::Call(JSContext*, JS::Handle&lt;JS::Value&gt;, JS::Handle&lt;JS::Value&gt;, js::AnyInvokeArgs const&amp;, JS::MutableHandle&lt;JS::Value&gt;, js::CallReason)<br>
   23: 0x2875af - &lt;unknown&gt;!JS_CallFunctionName(JSContext<em>, JS::Handle&lt;JSObject</em>&gt;, char const*, JS::HandleValueArray const&amp;, JS::MutableHandle&lt;JS::Value&gt;)<br>
   24: 0xdab4 - CallFunctionByName(char*, bool)</p>
<h3>Versions and Environment</h3>
<p>Wasmtime version or commit: wasmtime-cli 8.0.1</p>
<p>Operating system: Ubuntu</p>
<p>Architecture: amd_x64</p>
<h3>Extra Info</h3>
<p>My question is - what pointers should I align to be able to call __wasi_clock_time_get? StackPointer?<br>
I export StackPointer from SpiderMonkey instance and use it to allocate stack.<br>
I'm just curious of restrictions that I should to follow.</p>
</blockquote>



<a name="376966723"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236754%20Pointer%20not%20aligned%20to%208/near/376966723" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236754.20Pointer.20not.20aligned.20to.208.html#376966723">(Jul 20 2023 at 12:50)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/6754#issuecomment-1643869561">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/6754">issue #6754</a>:</p>
<blockquote>
<p>Low level details of WASI APIs such as alignment aren't super well documented for preview1 but it's possible to dig into them if you're interested. In general alignment behaves like C and 64-bit types are 8-byte aligned. You'll likely want to have a reference for the ABI of preview1 on-hand when digging into that.</p>
<p>In the meantime though if you're modifying the stack pointer directly then it seems like one of the more likely causes of this error is that LLVM-generated wasm expects the in-wasm stack pointer to be 16-byte aligned. Are your modifications preserving this alignment or should you perhaps also be adding alignment in?</p>
</blockquote>



<a name="388386107"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236754%20Pointer%20not%20aligned%20to%208/near/388386107" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236754.20Pointer.20not.20aligned.20to.208.html#388386107">(Aug 31 2023 at 18:42)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/6754#issuecomment-1701576462">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/6754">issue #6754</a>:</p>
<blockquote>
<p>I'm going to close this since we haven't gotten many more details and the suspicion is that the modifications here are changing the stack pointer, but please feel free to comment with more details and I can reopen and/or help investigate further.</p>
</blockquote>



<a name="388386110"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236754%20Pointer%20not%20aligned%20to%208/near/388386110" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236754.20Pointer.20not.20aligned.20to.208.html#388386110">(Aug 31 2023 at 18:42)</a>:</h4>
<p>alexcrichton closed <a href="https://github.com/bytecodealliance/wasmtime/issues/6754">issue #6754</a>:</p>
<blockquote>
<h3>Test Case</h3>
<p>I'm experimenting with generating wasm and SpiderMonkey. The test case is a bit hard to reproduce but it is just executing a mix of generated by hand wasm and SpiderMonkey compiled to wasm.</p>
<h3>Steps to Reproduce</h3>
<p>...</p>
<h3>Expected Results</h3>
<p>No bug.</p>
<h3>Actual Results</h3>
<p>wasmtime._error.WasmtimeError: error while executing at wasm backtrace:<br>
    0: 0x776866 - &lt;unknown&gt;!__wasi_clock_time_get<br>
    1: 0x77667d - &lt;unknown&gt;!__clock_gettime<br>
    2: 0x10b26 - &lt;unknown&gt;!mozilla::TimeStamp::Now(bool)<br>
    3: 0x466d61 - &lt;unknown&gt;!js::jit::BaselineCacheIRCompiler::compile()<br>
    4: 0x46fbc9 - &lt;unknown&gt;!js::jit::AttachBaselineCacheIRStub(JSContext<em>, js::jit::CacheIRWriter const&amp;, js::jit::CacheKind, JSScript</em>, js::jit::ICScript<em>, js::jit::ICFallbackStub</em>, char const*)<br>
    5: 0x48bd4d - &lt;unknown&gt;!js::jit::DoSetElemFallback(JSContext<em>, js::jit::BaselineFrame</em>, js::jit::ICFallbackStub<em>, JS::Value</em>, JS::Handle&lt;JS::Value&gt;, JS::Handle&lt;JS::Value&gt;, JS::Handle&lt;JS::Value&gt;)<br>
    6:  0xdbc - &lt;unknown&gt;!&lt;wasm function 11&gt;<br>
    7: 0x2674 - &lt;unknown&gt;!&lt;wasm function 37&gt;<br>
    8: 0x2022 - &lt;unknown&gt;!&lt;wasm function 33&gt;<br>
    9:  0x393 - &lt;unknown&gt;!&lt;wasm function 0&gt;<br>
   10: 0x5c315f - &lt;unknown&gt;!js::jit::MaybeEnterJit(JSContext*, js::RunState&amp;)<br>
   11: 0x8bfbf - &lt;unknown&gt;!js::RunScript(JSContext*, js::RunState&amp;)<br>
   12: 0x9cdc4 - &lt;unknown&gt;!js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&amp;, js::MaybeConstruct, js::CallReason)<br>
   13: 0x9d541 - &lt;unknown&gt;!js::CallFromStack(JSContext*, JS::CallArgs const&amp;, js::CallReason)<br>
   14: 0x48efd5 - &lt;unknown&gt;!js::jit::DoCallFallback(JSContext<em>, js::jit::BaselineFrame</em>, js::jit::ICFallbackStub<em>, unsigned int, JS::Value</em>, JS::MutableHandle&lt;JS::Value&gt;)<br>
   15:  0x86c - &lt;unknown&gt;!&lt;wasm function 5&gt;<br>
   16: 0x231d - &lt;unknown&gt;!&lt;wasm function 35&gt;<br>
   17: 0x21a6 - &lt;unknown&gt;!&lt;wasm function 34&gt;<br>
   18:  0x393 - &lt;unknown&gt;!&lt;wasm function 0&gt;<br>
   19: 0x5c315f - &lt;unknown&gt;!js::jit::MaybeEnterJit(JSContext*, js::RunState&amp;)<br>
   20: 0x8bfbf - &lt;unknown&gt;!js::RunScript(JSContext*, js::RunState&amp;)<br>
   21: 0x9cdc4 - &lt;unknown&gt;!js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&amp;, js::MaybeConstruct, js::CallReason)<br>
   22: 0x9d653 - &lt;unknown&gt;!js::Call(JSContext*, JS::Handle&lt;JS::Value&gt;, JS::Handle&lt;JS::Value&gt;, js::AnyInvokeArgs const&amp;, JS::MutableHandle&lt;JS::Value&gt;, js::CallReason)<br>
   23: 0x2875af - &lt;unknown&gt;!JS_CallFunctionName(JSContext<em>, JS::Handle&lt;JSObject</em>&gt;, char const*, JS::HandleValueArray const&amp;, JS::MutableHandle&lt;JS::Value&gt;)<br>
   24: 0xdab4 - CallFunctionByName(char*, bool)</p>
<h3>Versions and Environment</h3>
<p>Wasmtime version or commit: wasmtime-cli 8.0.1</p>
<p>Operating system: Ubuntu</p>
<p>Architecture: amd_x64</p>
<h3>Extra Info</h3>
<p>My question is - what pointers should I align to be able to call __wasi_clock_time_get? StackPointer?<br>
I export StackPointer from SpiderMonkey instance and use it to allocate stack.<br>
I'm just curious of restrictions that I should to follow.</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>