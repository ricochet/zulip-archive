<html>
<head><meta charset="utf-8"><title>wasmtime / PR #6835 Wasmtime: refactor the pooling alloca... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236835.20Wasmtime.3A.20refactor.20the.20pooling.20alloca.2E.2E.2E.html">wasmtime / PR #6835 Wasmtime: refactor the pooling alloca...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="383775798"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236835%20Wasmtime%3A%20refactor%20the%20pooling%20alloca.../near/383775798" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236835.20Wasmtime.3A.20refactor.20the.20pooling.20alloca.2E.2E.2E.html#383775798">(Aug 10 2023 at 22:54)</a>:</h4>
<p>fitzgen opened <a href="https://github.com/bytecodealliance/wasmtime/pull/6835">PR #6835</a> from <code>fitzgen:refactor-pooling-allocator</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>We used to have one index allocator, an index per instance, and give out N<br>
tables and M memories to every instance regardless how many tables and memories<br>
they need.</p>
<p>Now we have an index allocator for memories and another for tables. An instance<br>
isn't associated with a single instance, each of its memories and tables have an<br>
index. We allocate exactly as many tables and memories as the instance actually<br>
needs.</p>
<p>Ultimately, this gives us better component support, where a component instance<br>
might have varying numbers of internal tables and memories.</p>
<p>Additionally, you can now limit the number of tables, memories, and core<br>
instances a single component can allocate from the pooling allocator, even if<br>
there is the capacity for that many available. This is to give embedders tools<br>
to limit individual component instances and prevent them from hogging too much<br>
of the pooling allocator's resources.</p>
<hr>
<p>TODO before landing:</p>
<ul>
<li>[ ] Update <code>RELEASES.md</code> with a heads up about the config changes and give a small guide of how to migrate existing set ups</li>
</ul>
</blockquote>



<a name="383775799"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236835%20Wasmtime%3A%20refactor%20the%20pooling%20alloca.../near/383775799" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236835.20Wasmtime.3A.20refactor.20the.20pooling.20alloca.2E.2E.2E.html#383775799">(Aug 10 2023 at 22:54)</a>:</h4>
<p><strong>fitzgen</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/6835">PR #6835</a>.</p>



<a name="383775800"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236835%20Wasmtime%3A%20refactor%20the%20pooling%20alloca.../near/383775800" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236835.20Wasmtime.3A.20refactor.20the.20pooling.20alloca.2E.2E.2E.html#383775800">(Aug 10 2023 at 22:54)</a>:</h4>
<p><strong>fitzgen</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/6835">PR #6835</a>.</p>



<a name="383775967"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236835%20Wasmtime%3A%20refactor%20the%20pooling%20alloca.../near/383775967" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236835.20Wasmtime.3A.20refactor.20the.20pooling.20alloca.2E.2E.2E.html#383775967">(Aug 10 2023 at 22:56)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6835#pullrequestreview-1572832679">PR review</a>.</p>



<a name="383775968"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236835%20Wasmtime%3A%20refactor%20the%20pooling%20alloca.../near/383775968" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236835.20Wasmtime.3A.20refactor.20the.20pooling.20alloca.2E.2E.2E.html#383775968">(Aug 10 2023 at 22:56)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6835#pullrequestreview-1572832679">PR review</a>.</p>



<a name="383775969"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236835%20Wasmtime%3A%20refactor%20the%20pooling%20alloca.../near/383775969" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236835.20Wasmtime.3A.20refactor.20the.20pooling.20alloca.2E.2E.2E.html#383775969">(Aug 10 2023 at 22:56)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/6835#discussion_r1290754485">PR review comment</a>:</p>
<blockquote>
<p>Unsure whether this is better as-written, or if moving the <code>MemoryAllocationIndex</code> into <code>wasmtime_runtime::Memory</code> is better. Feel free to bike shed.</p>
</blockquote>



<a name="384070546"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236835%20Wasmtime%3A%20refactor%20the%20pooling%20alloca.../near/384070546" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236835.20Wasmtime.3A.20refactor.20the.20pooling.20alloca.2E.2E.2E.html#384070546">(Aug 11 2023 at 19:09)</a>:</h4>
<p><strong>fitzgen</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-fuzz-reviewers">wasmtime-fuzz-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/6835">PR #6835</a>.</p>



<a name="384070547"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236835%20Wasmtime%3A%20refactor%20the%20pooling%20alloca.../near/384070547" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236835.20Wasmtime.3A.20refactor.20the.20pooling.20alloca.2E.2E.2E.html#384070547">(Aug 11 2023 at 19:09)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6835">PR #6835</a>.</p>



<a name="384070550"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236835%20Wasmtime%3A%20refactor%20the%20pooling%20alloca.../near/384070550" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236835.20Wasmtime.3A.20refactor.20the.20pooling.20alloca.2E.2E.2E.html#384070550">(Aug 11 2023 at 19:09)</a>:</h4>
<p><strong>fitzgen</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-default-reviewers">wasmtime-default-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/6835">PR #6835</a>.</p>



<a name="384084306"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236835%20Wasmtime%3A%20refactor%20the%20pooling%20alloca.../near/384084306" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236835.20Wasmtime.3A.20refactor.20the.20pooling.20alloca.2E.2E.2E.html#384084306">(Aug 11 2023 at 20:17)</a>:</h4>
<p>fitzgen edited <a href="https://github.com/bytecodealliance/wasmtime/pull/6835">PR #6835</a>:</p>
<blockquote>
<p>We used to have one index allocator, an index per instance, and give out N<br>
tables and M memories to every instance regardless how many tables and memories<br>
they need.</p>
<p>Now we have an index allocator for memories and another for tables. An instance<br>
isn't associated with a single instance, each of its memories and tables have an<br>
index. We allocate exactly as many tables and memories as the instance actually<br>
needs.</p>
<p>Ultimately, this gives us better component support, where a component instance<br>
might have varying numbers of internal tables and memories.</p>
<p>Additionally, you can now limit the number of tables, memories, and core<br>
instances a single component can allocate from the pooling allocator, even if<br>
there is the capacity for that many available. This is to give embedders tools<br>
to limit individual component instances and prevent them from hogging too much<br>
of the pooling allocator's resources.</p>
<hr>
<p>TODO before landing:</p>
<ul>
<li>[x] Update <code>RELEASES.md</code> with a heads up about the config changes and give a small guide of how to migrate existing set ups</li>
</ul>
</blockquote>



<a name="384104569"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236835%20Wasmtime%3A%20refactor%20the%20pooling%20alloca.../near/384104569" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236835.20Wasmtime.3A.20refactor.20the.20pooling.20alloca.2E.2E.2E.html#384104569">(Aug 11 2023 at 22:28)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6835">PR #6835</a>.</p>



<a name="384104884"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236835%20Wasmtime%3A%20refactor%20the%20pooling%20alloca.../near/384104884" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236835.20Wasmtime.3A.20refactor.20the.20pooling.20alloca.2E.2E.2E.html#384104884">(Aug 11 2023 at 22:30)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6835">PR #6835</a>.</p>



<a name="384926894"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236835%20Wasmtime%3A%20refactor%20the%20pooling%20alloca.../near/384926894" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236835.20Wasmtime.3A.20refactor.20the.20pooling.20alloca.2E.2E.2E.html#384926894">(Aug 14 2023 at 23:13)</a>:</h4>
<p><strong>fitzgen</strong> requested <a href="https://github.com/cfallin">cfallin</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/6835">PR #6835</a>.</p>



<a name="385280732"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236835%20Wasmtime%3A%20refactor%20the%20pooling%20alloca.../near/385280732" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236835.20Wasmtime.3A.20refactor.20the.20pooling.20alloca.2E.2E.2E.html#385280732">(Aug 15 2023 at 20:22)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6835#pullrequestreview-1579353276">PR review</a>.</p>



<a name="385282464"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236835%20Wasmtime%3A%20refactor%20the%20pooling%20alloca.../near/385282464" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236835.20Wasmtime.3A.20refactor.20the.20pooling.20alloca.2E.2E.2E.html#385282464">(Aug 15 2023 at 20:38)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/6835#discussion_r1295068708">PR review comment</a>:</p>
<blockquote>
<p>Note from Chris on zoom: can we RAII this stuff?</p>
</blockquote>



<a name="385284873"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236835%20Wasmtime%3A%20refactor%20the%20pooling%20alloca.../near/385284873" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236835.20Wasmtime.3A.20refactor.20the.20pooling.20alloca.2E.2E.2E.html#385284873">(Aug 15 2023 at 20:59)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6835#pullrequestreview-1579357015">PR review</a>.</p>



<a name="385284876"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236835%20Wasmtime%3A%20refactor%20the%20pooling%20alloca.../near/385284876" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236835.20Wasmtime.3A.20refactor.20the.20pooling.20alloca.2E.2E.2E.html#385284876">(Aug 15 2023 at 20:59)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/6835#discussion_r1295105511">PR review comment</a>:</p>
<blockquote>
<p>hoist to avoid allocating code objects and things when validation will fail</p>
</blockquote>



<a name="385284877"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236835%20Wasmtime%3A%20refactor%20the%20pooling%20alloca.../near/385284877" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236835.20Wasmtime.3A.20refactor.20the.20pooling.20alloca.2E.2E.2E.html#385284877">(Aug 15 2023 at 20:59)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/6835#discussion_r1295091853">PR review comment</a>:</p>
<blockquote>
<p>note from chris: can we newtype this tuple? <code>ModuleAndMemory</code> or something like that</p>
</blockquote>



<a name="385284890"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236835%20Wasmtime%3A%20refactor%20the%20pooling%20alloca.../near/385284890" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236835.20Wasmtime.3A.20refactor.20the.20pooling.20alloca.2E.2E.2E.html#385284890">(Aug 15 2023 at 20:59)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/6835#discussion_r1295097723">PR review comment</a>:</p>
<blockquote>
<p>comment out of date</p>
</blockquote>



<a name="385284956"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236835%20Wasmtime%3A%20refactor%20the%20pooling%20alloca.../near/385284956" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236835.20Wasmtime.3A.20refactor.20the.20pooling.20alloca.2E.2E.2E.html#385284956">(Aug 15 2023 at 21:00)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6835#pullrequestreview-1579357015">PR review</a>.</p>



<a name="385285348"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236835%20Wasmtime%3A%20refactor%20the%20pooling%20alloca.../near/385285348" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236835.20Wasmtime.3A.20refactor.20the.20pooling.20alloca.2E.2E.2E.html#385285348">(Aug 15 2023 at 21:02)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/6835#discussion_r1295083928">PR review comment</a>:</p>
<blockquote>
<p>note from Chris: seems like some abstraction here could maybe improve things but I don't know what it is.</p>
<p>for now can we have a comment about why we can't use associated types because of how this is used as a trait object</p>
</blockquote>



<a name="385285591"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236835%20Wasmtime%3A%20refactor%20the%20pooling%20alloca.../near/385285591" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236835.20Wasmtime.3A.20refactor.20the.20pooling.20alloca.2E.2E.2E.html#385285591">(Aug 15 2023 at 21:04)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/6835#discussion_r1295093192">PR review comment</a>:</p>
<blockquote>
<p>note from chris: diagram/comment need updates</p>
</blockquote>



<a name="385285894"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236835%20Wasmtime%3A%20refactor%20the%20pooling%20alloca.../near/385285894" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236835.20Wasmtime.3A.20refactor.20the.20pooling.20alloca.2E.2E.2E.html#385285894">(Aug 15 2023 at 21:07)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/6835#discussion_r1295101405">PR review comment</a>:</p>
<blockquote>
<p>leave a comment that we could keep track of how many memories we have per module instead of probing all possible indices if this ever shows up in a profile</p>
</blockquote>



<a name="385286553"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236835%20Wasmtime%3A%20refactor%20the%20pooling%20alloca.../near/385286553" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236835.20Wasmtime.3A.20refactor.20the.20pooling.20alloca.2E.2E.2E.html#385286553">(Aug 15 2023 at 21:12)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/6835#discussion_r1295120342">PR review comment</a>:</p>
<blockquote>
<p>Note: I am going to avoid an RAII type because</p>
<ol>
<li>we would need two types, one for core module instantiation and one for component instantiation, and</li>
<li>only the error paths would be able to use these, not the success paths, because the RAII type would need to wrap <code>self</code> here, which isn't feasible once the instance is returned.</li>
</ol>
<p>Therefore, I'll do the immediately-invoked closure thing instead.</p>
</blockquote>



<a name="385286622"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236835%20Wasmtime%3A%20refactor%20the%20pooling%20alloca.../near/385286622" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236835.20Wasmtime.3A.20refactor.20the.20pooling.20alloca.2E.2E.2E.html#385286622">(Aug 15 2023 at 21:13)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6835#pullrequestreview-1579437783">PR review</a>.</p>



<a name="385286804"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236835%20Wasmtime%3A%20refactor%20the%20pooling%20alloca.../near/385286804" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236835.20Wasmtime.3A.20refactor.20the.20pooling.20alloca.2E.2E.2E.html#385286804">(Aug 15 2023 at 21:14)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/6835#discussion_r1295075340">PR review comment</a>:</p>
<blockquote>
<p>request for comment: deallocation needs to be infallible, because if it wasn't we could leak if say the first of two memories failed to drop.</p>
</blockquote>



<a name="385286886"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236835%20Wasmtime%3A%20refactor%20the%20pooling%20alloca.../near/385286886" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236835.20Wasmtime.3A.20refactor.20the.20pooling.20alloca.2E.2E.2E.html#385286886">(Aug 15 2023 at 21:15)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/6835#discussion_r1295071027">PR review comment</a>:</p>
<blockquote>
<p>or we can use an immediately-invoked closure so that we can <code>?</code> inside it but still have only a single place for clean up on error</p>
</blockquote>



<a name="385287010"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236835%20Wasmtime%3A%20refactor%20the%20pooling%20alloca.../near/385287010" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236835.20Wasmtime.3A.20refactor.20the.20pooling.20alloca.2E.2E.2E.html#385287010">(Aug 15 2023 at 21:16)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/6835#discussion_r1295096775">PR review comment</a>:</p>
<blockquote>
<p>add comment about how this is needed for validation but does not factor into the pre-allocated pool size and its layout</p>
</blockquote>



<a name="385290093"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236835%20Wasmtime%3A%20refactor%20the%20pooling%20alloca.../near/385290093" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236835.20Wasmtime.3A.20refactor.20the.20pooling.20alloca.2E.2E.2E.html#385290093">(Aug 15 2023 at 21:46)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6835#pullrequestreview-1579476938">PR review</a>:</p>
<blockquote>
<p>Together with earlier zoom review and associated comments, this overall looks great to me! High-quality implementation with good attention paid to safety (e.g. index newtypes). A few comments below as well but nothing too major.</p>
</blockquote>



<a name="385290095"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236835%20Wasmtime%3A%20refactor%20the%20pooling%20alloca.../near/385290095" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236835.20Wasmtime.3A.20refactor.20the.20pooling.20alloca.2E.2E.2E.html#385290095">(Aug 15 2023 at 21:46)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6835#pullrequestreview-1579476938">PR review</a>:</p>
<blockquote>
<p>Together with earlier zoom review and associated comments, this overall looks great to me! High-quality implementation with good attention paid to safety (e.g. index newtypes). A few comments below as well but nothing too major.</p>
</blockquote>



<a name="385290096"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236835%20Wasmtime%3A%20refactor%20the%20pooling%20alloca.../near/385290096" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236835.20Wasmtime.3A.20refactor.20the.20pooling.20alloca.2E.2E.2E.html#385290096">(Aug 15 2023 at 21:46)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/6835#discussion_r1295145441">PR review comment</a>:</p>
<blockquote>
<p>likewise here, and for stacks, total core instances, ... below</p>
</blockquote>



<a name="385290097"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236835%20Wasmtime%3A%20refactor%20the%20pooling%20alloca.../near/385290097" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236835.20Wasmtime.3A.20refactor.20the.20pooling.20alloca.2E.2E.2E.html#385290097">(Aug 15 2023 at 21:46)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/6835#discussion_r1295145050">PR review comment</a>:</p>
<blockquote>
<p>should this be called <code>max_...</code> (in line with the other limits)?</p>
</blockquote>



<a name="385290098"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236835%20Wasmtime%3A%20refactor%20the%20pooling%20alloca.../near/385290098" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236835.20Wasmtime.3A.20refactor.20the.20pooling.20alloca.2E.2E.2E.html#385290098">(Aug 15 2023 at 21:46)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/6835#discussion_r1295145317">PR review comment</a>:</p>
<blockquote>
<p>as above, <code>max_...</code> ?</p>
</blockquote>



<a name="385290099"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236835%20Wasmtime%3A%20refactor%20the%20pooling%20alloca.../near/385290099" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236835.20Wasmtime.3A.20refactor.20the.20pooling.20alloca.2E.2E.2E.html#385290099">(Aug 15 2023 at 21:46)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/6835#discussion_r1295147412">PR review comment</a>:</p>
<blockquote>
<p>here we're using the component-instance array just for its length -- could we store a counter rather than actual instance handles?</p>
</blockquote>



<a name="385519399"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236835%20Wasmtime%3A%20refactor%20the%20pooling%20alloca.../near/385519399" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236835.20Wasmtime.3A.20refactor.20the.20pooling.20alloca.2E.2E.2E.html#385519399">(Aug 16 2023 at 18:42)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6835#pullrequestreview-1581219093">PR review</a>.</p>



<a name="385519401"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236835%20Wasmtime%3A%20refactor%20the%20pooling%20alloca.../near/385519401" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236835.20Wasmtime.3A.20refactor.20the.20pooling.20alloca.2E.2E.2E.html#385519401">(Aug 16 2023 at 18:42)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/6835#discussion_r1296298270">PR review comment</a>:</p>
<blockquote>
<p>This one isn't really a maximum, it is the exact number of memories we will have capacity for in the pool. So I'll leave it as-is.</p>
</blockquote>



<a name="385519413"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236835%20Wasmtime%3A%20refactor%20the%20pooling%20alloca.../near/385519413" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236835.20Wasmtime.3A.20refactor.20the.20pooling.20alloca.2E.2E.2E.html#385519413">(Aug 16 2023 at 18:42)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6835#pullrequestreview-1581219274">PR review</a>.</p>



<a name="385519414"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236835%20Wasmtime%3A%20refactor%20the%20pooling%20alloca.../near/385519414" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236835.20Wasmtime.3A.20refactor.20the.20pooling.20alloca.2E.2E.2E.html#385519414">(Aug 16 2023 at 18:42)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/6835#discussion_r1296298385">PR review comment</a>:</p>
<blockquote>
<p>Ditto.</p>
</blockquote>



<a name="385520302"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236835%20Wasmtime%3A%20refactor%20the%20pooling%20alloca.../near/385520302" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236835.20Wasmtime.3A.20refactor.20the.20pooling.20alloca.2E.2E.2E.html#385520302">(Aug 16 2023 at 18:48)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6835#pullrequestreview-1581229736">PR review</a>.</p>



<a name="385520303"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236835%20Wasmtime%3A%20refactor%20the%20pooling%20alloca.../near/385520303" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236835.20Wasmtime.3A.20refactor.20the.20pooling.20alloca.2E.2E.2E.html#385520303">(Aug 16 2023 at 18:48)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/6835#discussion_r1296304495">PR review comment</a>:</p>
<blockquote>
<p>Hmm, yeah, I guess it's kind of a matter of semantics -- it <em>is</em> the maximum number that we can allocate across the whole pool. ("Capacity" is another way of saying "maximum", I guess.) But I'll defer to your judgment here if you want to keep as-is.</p>
</blockquote>



<a name="385547324"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236835%20Wasmtime%3A%20refactor%20the%20pooling%20alloca.../near/385547324" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236835.20Wasmtime.3A.20refactor.20the.20pooling.20alloca.2E.2E.2E.html#385547324">(Aug 16 2023 at 21:43)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6835">PR #6835</a>.</p>



<a name="385706335"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236835%20Wasmtime%3A%20refactor%20the%20pooling%20alloca.../near/385706335" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236835.20Wasmtime.3A.20refactor.20the.20pooling.20alloca.2E.2E.2E.html#385706335">(Aug 17 2023 at 16:00)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6835">PR #6835</a>.</p>



<a name="385706399"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236835%20Wasmtime%3A%20refactor%20the%20pooling%20alloca.../near/385706399" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236835.20Wasmtime.3A.20refactor.20the.20pooling.20alloca.2E.2E.2E.html#385706399">(Aug 17 2023 at 16:00)</a>:</h4>
<p>fitzgen has enabled auto merge for <a href="https://github.com/bytecodealliance/wasmtime/pull/6835">PR #6835</a>.</p>



<a name="385711223"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236835%20Wasmtime%3A%20refactor%20the%20pooling%20alloca.../near/385711223" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236835.20Wasmtime.3A.20refactor.20the.20pooling.20alloca.2E.2E.2E.html#385711223">(Aug 17 2023 at 16:24)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6835">PR #6835</a>.</p>



<a name="385725742"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236835%20Wasmtime%3A%20refactor%20the%20pooling%20alloca.../near/385725742" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236835.20Wasmtime.3A.20refactor.20the.20pooling.20alloca.2E.2E.2E.html#385725742">(Aug 17 2023 at 17:59)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6835">PR #6835</a>.</p>



<a name="385736901"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236835%20Wasmtime%3A%20refactor%20the%20pooling%20alloca.../near/385736901" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236835.20Wasmtime.3A.20refactor.20the.20pooling.20alloca.2E.2E.2E.html#385736901">(Aug 17 2023 at 19:19)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6835">PR #6835</a>.</p>



<a name="385736926"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236835%20Wasmtime%3A%20refactor%20the%20pooling%20alloca.../near/385736926" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236835.20Wasmtime.3A.20refactor.20the.20pooling.20alloca.2E.2E.2E.html#385736926">(Aug 17 2023 at 19:19)</a>:</h4>
<p>fitzgen has enabled auto merge for <a href="https://github.com/bytecodealliance/wasmtime/pull/6835">PR #6835</a>.</p>



<a name="385979373"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236835%20Wasmtime%3A%20refactor%20the%20pooling%20alloca.../near/385979373" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236835.20Wasmtime.3A.20refactor.20the.20pooling.20alloca.2E.2E.2E.html#385979373">(Aug 18 2023 at 19:52)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6835">PR #6835</a>.</p>



<a name="385979389"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236835%20Wasmtime%3A%20refactor%20the%20pooling%20alloca.../near/385979389" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236835.20Wasmtime.3A.20refactor.20the.20pooling.20alloca.2E.2E.2E.html#385979389">(Aug 18 2023 at 19:52)</a>:</h4>
<p>fitzgen has enabled auto merge for <a href="https://github.com/bytecodealliance/wasmtime/pull/6835">PR #6835</a>.</p>



<a name="385988464"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236835%20Wasmtime%3A%20refactor%20the%20pooling%20alloca.../near/385988464" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236835.20Wasmtime.3A.20refactor.20the.20pooling.20alloca.2E.2E.2E.html#385988464">(Aug 18 2023 at 21:01)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6835">PR #6835</a>.</p>



<a name="385988482"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236835%20Wasmtime%3A%20refactor%20the%20pooling%20alloca.../near/385988482" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236835.20Wasmtime.3A.20refactor.20the.20pooling.20alloca.2E.2E.2E.html#385988482">(Aug 18 2023 at 21:01)</a>:</h4>
<p>fitzgen has enabled auto merge for <a href="https://github.com/bytecodealliance/wasmtime/pull/6835">PR #6835</a>.</p>



<a name="385994686"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236835%20Wasmtime%3A%20refactor%20the%20pooling%20alloca.../near/385994686" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236835.20Wasmtime.3A.20refactor.20the.20pooling.20alloca.2E.2E.2E.html#385994686">(Aug 18 2023 at 22:04)</a>:</h4>
<p>fitzgen merged <a href="https://github.com/bytecodealliance/wasmtime/pull/6835">PR #6835</a>.</p>



<a name="386425730"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236835%20Wasmtime%3A%20refactor%20the%20pooling%20alloca.../near/386425730" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236835.20Wasmtime.3A.20refactor.20the.20pooling.20alloca.2E.2E.2E.html#386425730">(Aug 21 2023 at 15:48)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6835#pullrequestreview-1587280243">PR review</a>:</p>
<blockquote>
<p>This all looks great to me, thanks again for tackling this!</p>
</blockquote>



<a name="386425731"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236835%20Wasmtime%3A%20refactor%20the%20pooling%20alloca.../near/386425731" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236835.20Wasmtime.3A.20refactor.20the.20pooling.20alloca.2E.2E.2E.html#386425731">(Aug 21 2023 at 15:48)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6835#pullrequestreview-1587280243">PR review</a>:</p>
<blockquote>
<p>This all looks great to me, thanks again for tackling this!</p>
</blockquote>



<a name="386425732"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236835%20Wasmtime%3A%20refactor%20the%20pooling%20alloca.../near/386425732" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236835.20Wasmtime.3A.20refactor.20the.20pooling.20alloca.2E.2E.2E.html#386425732">(Aug 21 2023 at 15:48)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/6835#discussion_r1300305546">PR review comment</a>:</p>
<blockquote>
<p>Mind throwing in a debug assert here that the return value is not 0? (e.g. this never goes negative)</p>
</blockquote>



<a name="386425733"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236835%20Wasmtime%3A%20refactor%20the%20pooling%20alloca.../near/386425733" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236835.20Wasmtime.3A.20refactor.20the.20pooling.20alloca.2E.2E.2E.html#386425733">(Aug 21 2023 at 15:48)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/6835#discussion_r1300292277">PR review comment</a>:</p>
<blockquote>
<p>Would it be possible to keep this as one trait? Inferring why this was split into two it seems like it wants to guarantee that the default implementations of methods are used, but this is purely internal and it's already an <code>unsafe trait</code>, so I think that should be enough to cover the bases? (I don't think we're at risk of duplicating these default trait method implementations anywhere)</p>
</blockquote>



<a name="386425734"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236835%20Wasmtime%3A%20refactor%20the%20pooling%20alloca.../near/386425734" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236835.20Wasmtime.3A.20refactor.20the.20pooling.20alloca.2E.2E.2E.html#386425734">(Aug 21 2023 at 15:48)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/6835#discussion_r1300283508">PR review comment</a>:</p>
<blockquote>
<p>I mentioned this in person as well, but would it be possible to eschew this index (and the one above) and infer the index from an address in the pooling allocator?</p>
</blockquote>



<a name="386425735"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236835%20Wasmtime%3A%20refactor%20the%20pooling%20alloca.../near/386425735" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236835.20Wasmtime.3A.20refactor.20the.20pooling.20alloca.2E.2E.2E.html#386425735">(Aug 21 2023 at 15:48)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/6835#discussion_r1300305781">PR review comment</a>:</p>
<blockquote>
<p>(and the other decrement methods too)</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>