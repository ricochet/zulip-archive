<html>
<head><meta charset="utf-8"><title>wasmtime / PR #5826 Add Engine::precompile_compatibility_key · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235826.20Add.20Engine.3A.3Aprecompile_compatibility_key.html">wasmtime / PR #5826 Add Engine::precompile_compatibility_key</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="328566941"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235826%20Add%20Engine%3A%3Aprecompile_compatibility_key/near/328566941" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235826.20Add.20Engine.3A.3Aprecompile_compatibility_key.html#328566941">(Feb 17 2023 at 21:31)</a>:</h4>
<p>lann edited <a href="https://github.com/bytecodealliance/wasmtime/pull/5826">PR #5826</a> from <code>precompile-compat-key</code> to <code>main</code>:</p>
<blockquote>
<p>Draft for #5802 for naming / impl feedback prior to writing tests.</p>
<p>After writing the implementation I landed on <code>precompile_compatibility_key</code> to show the relationship with <code>precompile_{module,component}</code>, but can revert to the discussed <code>cache_key</code> if desired.</p>
</blockquote>



<a name="328567035"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235826%20Add%20Engine%3A%3Aprecompile_compatibility_key/near/328567035" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235826.20Add.20Engine.3A.3Aprecompile_compatibility_key.html#328567035">(Feb 17 2023 at 21:32)</a>:</h4>
<p>lann edited <a href="https://github.com/bytecodealliance/wasmtime/pull/5826">PR #5826</a> from <code>precompile-compat-key</code> to <code>main</code>:</p>
<blockquote>
<p>Draft for #5802 for naming / impl feedback while working on tests.</p>
<p>After writing the implementation I landed on <code>precompile_compatibility_key</code> to show the relationship with <code>precompile_{module,component}</code>, but can revert to the discussed <code>cache_key</code> if desired.</p>
</blockquote>



<a name="328567565"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235826%20Add%20Engine%3A%3Aprecompile_compatibility_key/near/328567565" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235826.20Add.20Engine.3A.3Aprecompile_compatibility_key.html#328567565">(Feb 17 2023 at 21:36)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5826#pullrequestreview-1304233590">PR review</a>.</p>



<a name="328567568"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235826%20Add%20Engine%3A%3Aprecompile_compatibility_key/near/328567568" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235826.20Add.20Engine.3A.3Aprecompile_compatibility_key.html#328567568">(Feb 17 2023 at 21:36)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/5826#discussion_r1110390175">PR review comment</a>:</p>
<blockquote>
<p>Hashbrown uses ahash which doesn't guarantee stability between different systems. In fact it returns different values between systems with hardware AES instructions and those that don't. As such using ahash here will break cross-compilation.</p>
</blockquote>



<a name="328568721"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235826%20Add%20Engine%3A%3Aprecompile_compatibility_key/near/328568721" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235826.20Add.20Engine.3A.3Aprecompile_compatibility_key.html#328568721">(Feb 17 2023 at 21:44)</a>:</h4>
<p>lann submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5826#pullrequestreview-1304241086">PR review</a>.</p>



<a name="328568725"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235826%20Add%20Engine%3A%3Aprecompile_compatibility_key/near/328568725" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235826.20Add.20Engine.3A.3Aprecompile_compatibility_key.html#328568725">(Feb 17 2023 at 21:44)</a>:</h4>
<p>lann created <a href="https://github.com/bytecodealliance/wasmtime/pull/5826#discussion_r1110395383">PR review comment</a>:</p>
<blockquote>
<p>Ah good to know, thanks.</p>
</blockquote>



<a name="328569617"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235826%20Add%20Engine%3A%3Aprecompile_compatibility_key/near/328569617" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235826.20Add.20Engine.3A.3Aprecompile_compatibility_key.html#328569617">(Feb 17 2023 at 21:50)</a>:</h4>
<p>lann updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5826">PR #5826</a> from <code>precompile-compat-key</code> to <code>main</code>.</p>



<a name="328569910"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235826%20Add%20Engine%3A%3Aprecompile_compatibility_key/near/328569910" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235826.20Add.20Engine.3A.3Aprecompile_compatibility_key.html#328569910">(Feb 17 2023 at 21:52)</a>:</h4>
<p>lann submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5826#pullrequestreview-1304247982">PR review</a>.</p>



<a name="328569912"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235826%20Add%20Engine%3A%3Aprecompile_compatibility_key/near/328569912" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235826.20Add.20Engine.3A.3Aprecompile_compatibility_key.html#328569912">(Feb 17 2023 at 21:52)</a>:</h4>
<p>lann created <a href="https://github.com/bytecodealliance/wasmtime/pull/5826#discussion_r1110401107">PR review comment</a>:</p>
<blockquote>
<p>Replaced with sha2, which is probably where I should have started anyway. Its a new dep under some feature sets but it is already used by the cache system.</p>
</blockquote>



<a name="328569924"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235826%20Add%20Engine%3A%3Aprecompile_compatibility_key/near/328569924" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235826.20Add.20Engine.3A.3Aprecompile_compatibility_key.html#328569924">(Feb 17 2023 at 21:53)</a>:</h4>
<p>lann edited <a href="https://github.com/bytecodealliance/wasmtime/pull/5826#discussion_r1110401107">PR review comment</a>.</p>



<a name="328570010"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235826%20Add%20Engine%3A%3Aprecompile_compatibility_key/near/328570010" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235826.20Add.20Engine.3A.3Aprecompile_compatibility_key.html#328570010">(Feb 17 2023 at 21:53)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5826#pullrequestreview-1304248637">PR review</a>.</p>



<a name="328570011"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235826%20Add%20Engine%3A%3Aprecompile_compatibility_key/near/328570011" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235826.20Add.20Engine.3A.3Aprecompile_compatibility_key.html#328570011">(Feb 17 2023 at 21:53)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/5826#discussion_r1110401554">PR review comment</a>:</p>
<blockquote>
<p>sha512 is faster on 64bit systems as it can consume more bytes at once. Not that it really matters here. This hashing is highly unlikely to ever become a bottleneck.</p>
</blockquote>



<a name="328573654"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235826%20Add%20Engine%3A%3Aprecompile_compatibility_key/near/328573654" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235826.20Add.20Engine.3A.3Aprecompile_compatibility_key.html#328573654">(Feb 17 2023 at 22:20)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5826#pullrequestreview-1304266232">PR review</a>.</p>



<a name="328573656"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235826%20Add%20Engine%3A%3Aprecompile_compatibility_key/near/328573656" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235826.20Add.20Engine.3A.3Aprecompile_compatibility_key.html#328573656">(Feb 17 2023 at 22:20)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5826#pullrequestreview-1304266232">PR review</a>.</p>



<a name="328573657"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235826%20Add%20Engine%3A%3Aprecompile_compatibility_key/near/328573657" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235826.20Add.20Engine.3A.3Aprecompile_compatibility_key.html#328573657">(Feb 17 2023 at 22:20)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/5826#discussion_r1110415134">PR review comment</a>:</p>
<blockquote>
<p>I think the documentation here may want to be a bit more nuanced because if two blobs are the same then you should be able to load between engines but if they're different they may still load correctly. For example different values of <code>generate_address_map</code> will produce different blobs but that's not checked when loading modules into engines.</p>
<p>I think it may be best to reword this as something along the lines of "if two blobs are equal artifacts from one engine are guaranteed to be loadable in another" or something like that.</p>
</blockquote>



<a name="328573658"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235826%20Add%20Engine%3A%3Aprecompile_compatibility_key/near/328573658" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235826.20Add.20Engine.3A.3Aprecompile_compatibility_key.html#328573658">(Feb 17 2023 at 22:20)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/5826#discussion_r1110413451">PR review comment</a>:</p>
<blockquote>
<p>I think it's fine to just return the whole blob here and let embedders hash it if they want. That avoids a dependency here and should enable a bit more flexibility for embedders as well.</p>
</blockquote>



<a name="328573659"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235826%20Add%20Engine%3A%3Aprecompile_compatibility_key/near/328573659" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235826.20Add.20Engine.3A.3Aprecompile_compatibility_key.html#328573659">(Feb 17 2023 at 22:20)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/5826#discussion_r1110415390">PR review comment</a>:</p>
<blockquote>
<p>If this compiles without the <code>#[cfg]</code> no need for the attribute. If the <code>#[cfg]</code> is required, though, then this attribute is also required for better display in documentation.</p>
</blockquote>



<a name="328574221"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235826%20Add%20Engine%3A%3Aprecompile_compatibility_key/near/328574221" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235826.20Add.20Engine.3A.3Aprecompile_compatibility_key.html#328574221">(Feb 17 2023 at 22:24)</a>:</h4>
<p>lann submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5826#pullrequestreview-1304272031">PR review</a>.</p>



<a name="328574222"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235826%20Add%20Engine%3A%3Aprecompile_compatibility_key/near/328574222" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235826.20Add.20Engine.3A.3Aprecompile_compatibility_key.html#328574222">(Feb 17 2023 at 22:24)</a>:</h4>
<p>lann created <a href="https://github.com/bytecodealliance/wasmtime/pull/5826#discussion_r1110417529">PR review comment</a>:</p>
<blockquote>
<p>Yeah that's what I was trying to convey but "if" is ambiguous. I'll be more explicit about it.</p>
</blockquote>



<a name="328574697"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235826%20Add%20Engine%3A%3Aprecompile_compatibility_key/near/328574697" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235826.20Add.20Engine.3A.3Aprecompile_compatibility_key.html#328574697">(Feb 17 2023 at 22:27)</a>:</h4>
<p>lann updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5826">PR #5826</a> from <code>precompile-compat-key</code> to <code>main</code>.</p>



<a name="350884627"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235826%20Add%20Engine%3A%3Aprecompile_compatibility_key/near/350884627" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235826.20Add.20Engine.3A.3Aprecompile_compatibility_key.html#350884627">(Apr 18 2023 at 21:03)</a>:</h4>
<p>lann updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5826">PR #5826</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>