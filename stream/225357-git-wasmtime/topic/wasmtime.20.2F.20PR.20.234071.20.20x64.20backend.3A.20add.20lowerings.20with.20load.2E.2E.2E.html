<html>
<head><meta charset="utf-8"><title>wasmtime / PR #4071  x64 backend: add lowerings with load... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234071.20.20x64.20backend.3A.20add.20lowerings.20with.20load.2E.2E.2E.html">wasmtime / PR #4071  x64 backend: add lowerings with load...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="280151346"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234071%20%20x64%20backend%3A%20add%20lowerings%20with%20load.../near/280151346" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234071.20.20x64.20backend.3A.20add.20lowerings.20with.20load.2E.2E.2E.html#280151346">(Apr 26 2022 at 01:32)</a>:</h4>
<p>cfallin opened <a href="https://github.com/bytecodealliance/wasmtime/pull/4071">PR #4071</a> from <code>x64-load-op-store</code> to <code>main</code>:</p>
<blockquote>
<p>These lowerings use the <code>OP [mem], reg</code> forms (or in AT&amp;T syntax, <code>OP
%reg, (mem)</code>) -- i.e., x86 instructions that load from memory, perform<br>
an ALU operation, and store the result, all in one instruction. Using<br>
these instruction forms, we can merge three CLIF ops together: a load,<br>
an arithmetic operation, and a store.</p>
</blockquote>



<a name="280151347"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234071%20%20x64%20backend%3A%20add%20lowerings%20with%20load.../near/280151347" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234071.20.20x64.20backend.3A.20add.20lowerings.20with.20load.2E.2E.2E.html#280151347">(Apr 26 2022 at 01:32)</a>:</h4>
<p><strong>cfallin</strong> requested <a href="https://github.com/fitzgen">fitzgen</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/4071">PR #4071</a>.</p>



<a name="280151348"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234071%20%20x64%20backend%3A%20add%20lowerings%20with%20load.../near/280151348" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234071.20.20x64.20backend.3A.20add.20lowerings.20with.20load.2E.2E.2E.html#280151348">(Apr 26 2022 at 01:32)</a>:</h4>
<p><strong>cfallin</strong> requested <a href="https://github.com/abrown">abrown</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/4071">PR #4071</a>.</p>



<a name="280151455"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234071%20%20x64%20backend%3A%20add%20lowerings%20with%20load.../near/280151455" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234071.20.20x64.20backend.3A.20add.20lowerings.20with.20load.2E.2E.2E.html#280151455">(Apr 26 2022 at 01:34)</a>:</h4>
<p>cfallin edited <a href="https://github.com/bytecodealliance/wasmtime/pull/4071">PR #4071</a> from <code>x64-load-op-store</code> to <code>main</code>:</p>
<blockquote>
<p>These lowerings use the <code>OP [mem], reg</code> forms (or in AT&amp;T syntax, <code>OP %reg, (mem)</code>) --<br>
i.e., x86 instructions that load from memory, perform<br>
an ALU operation, and store the result, all in one instruction. Using<br>
these instruction forms, we can merge three CLIF ops together: a load,<br>
an arithmetic operation, and a store.</p>
<p>Stacks on top of #4069; last two commits are new.</p>
</blockquote>



<a name="280237943"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234071%20%20x64%20backend%3A%20add%20lowerings%20with%20load.../near/280237943" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234071.20.20x64.20backend.3A.20add.20lowerings.20with.20load.2E.2E.2E.html#280237943">(Apr 26 2022 at 16:51)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4071">PR #4071</a> from <code>x64-load-op-store</code> to <code>main</code>.</p>



<a name="280242980"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234071%20%20x64%20backend%3A%20add%20lowerings%20with%20load.../near/280242980" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234071.20.20x64.20backend.3A.20add.20lowerings.20with.20load.2E.2E.2E.html#280242980">(Apr 26 2022 at 17:25)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4071#pullrequestreview-953760970">PR review</a>.</p>



<a name="280242983"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234071%20%20x64%20backend%3A%20add%20lowerings%20with%20load.../near/280242983" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234071.20.20x64.20backend.3A.20add.20lowerings.20with.20load.2E.2E.2E.html#280242983">(Apr 26 2022 at 17:25)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/4071#discussion_r858974095">PR review comment</a>:</p>
<blockquote>
<p>I don't think these should be presented in 3-operand form. It doesn't match x86_64, which is confusing.</p>
</blockquote>



<a name="280267502"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234071%20%20x64%20backend%3A%20add%20lowerings%20with%20load.../near/280267502" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234071.20.20x64.20backend.3A.20add.20lowerings.20with.20load.2E.2E.2E.html#280267502">(Apr 26 2022 at 20:27)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4071#pullrequestreview-953951684">PR review</a>.</p>



<a name="280267503"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234071%20%20x64%20backend%3A%20add%20lowerings%20with%20load.../near/280267503" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234071.20.20x64.20backend.3A.20add.20lowerings.20with.20load.2E.2E.2E.html#280267503">(Apr 26 2022 at 20:27)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4071#pullrequestreview-953951684">PR review</a>.</p>



<a name="280267504"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234071%20%20x64%20backend%3A%20add%20lowerings%20with%20load.../near/280267504" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234071.20.20x64.20backend.3A.20add.20lowerings.20with.20load.2E.2E.2E.html#280267504">(Apr 26 2022 at 20:27)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/4071#discussion_r859109702">PR review comment</a>:</p>
<blockquote>
<p>Newlines between these for readability and consistency with others</p>
</blockquote>



<a name="280267505"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234071%20%20x64%20backend%3A%20add%20lowerings%20with%20load.../near/280267505" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234071.20.20x64.20backend.3A.20add.20lowerings.20with.20load.2E.2E.2E.html#280267505">(Apr 26 2022 at 20:27)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/4071#discussion_r859111513">PR review comment</a>:</p>
<blockquote>
<p>Strange that the first occurrence of <code>flags</code> has the <code>=</code> here rather than the second. Is that necessary?</p>
<p>Aside: I feel like we shouldn't even have the <code>=</code> syntax, and if you use the same variable name in multiple places we automatically unify.</p>
</blockquote>



<a name="280269492"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234071%20%20x64%20backend%3A%20add%20lowerings%20with%20load.../near/280269492" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234071.20.20x64.20backend.3A.20add.20lowerings.20with.20load.2E.2E.2E.html#280269492">(Apr 26 2022 at 20:43)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4071#pullrequestreview-953982204">PR review</a>.</p>



<a name="280269493"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234071%20%20x64%20backend%3A%20add%20lowerings%20with%20load.../near/280269493" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234071.20.20x64.20backend.3A.20add.20lowerings.20with.20load.2E.2E.2E.html#280269493">(Apr 26 2022 at 20:43)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/4071#discussion_r859129855">PR review comment</a>:</p>
<blockquote>
<p>I was perplexed as well; it has to do with the inline extractor expanding with the arguments in a flipped order.</p>
<p>I agree that inferring <code>=</code> should be totally possible depending on whether the variable is already captured or not, and I don't know why we didn't think of that earlier! I'll follow up with a PR to allow that and see what folks think.</p>
</blockquote>



<a name="280274206"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234071%20%20x64%20backend%3A%20add%20lowerings%20with%20load.../near/280274206" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234071.20.20x64.20backend.3A.20add.20lowerings.20with.20load.2E.2E.2E.html#280274206">(Apr 26 2022 at 21:22)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4071">PR #4071</a> from <code>x64-load-op-store</code> to <code>main</code>.</p>



<a name="280274231"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234071%20%20x64%20backend%3A%20add%20lowerings%20with%20load.../near/280274231" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234071.20.20x64.20backend.3A.20add.20lowerings.20with.20load.2E.2E.2E.html#280274231">(Apr 26 2022 at 21:23)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4071#pullrequestreview-954019736">PR review</a>.</p>



<a name="280274232"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234071%20%20x64%20backend%3A%20add%20lowerings%20with%20load.../near/280274232" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234071.20.20x64.20backend.3A.20add.20lowerings.20with.20load.2E.2E.2E.html#280274232">(Apr 26 2022 at 21:23)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/4071#discussion_r859157135">PR review comment</a>:</p>
<blockquote>
<p>Yeah, that's probably true; I was trying to mirror the SSA-ified view of the reg-reg forms but with a memory dest I think it's just as clear in "actual" form (since the memory dest is a source from a regalloc perspective). Updated.</p>
</blockquote>



<a name="280274249"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234071%20%20x64%20backend%3A%20add%20lowerings%20with%20load.../near/280274249" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234071.20.20x64.20backend.3A.20add.20lowerings.20with.20load.2E.2E.2E.html#280274249">(Apr 26 2022 at 21:23)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4071#pullrequestreview-954019868">PR review</a>.</p>



<a name="280274250"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234071%20%20x64%20backend%3A%20add%20lowerings%20with%20load.../near/280274250" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234071.20.20x64.20backend.3A.20add.20lowerings.20with.20load.2E.2E.2E.html#280274250">(Apr 26 2022 at 21:23)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/4071#discussion_r859157242">PR review comment</a>:</p>
<blockquote>
<p>Fixed.</p>
</blockquote>



<a name="280286720"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234071%20%20x64%20backend%3A%20add%20lowerings%20with%20load.../near/280286720" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234071.20.20x64.20backend.3A.20add.20lowerings.20with.20load.2E.2E.2E.html#280286720">(Apr 26 2022 at 23:41)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4071">PR #4071</a> from <code>x64-load-op-store</code> to <code>main</code>.</p>



<a name="280288997"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234071%20%20x64%20backend%3A%20add%20lowerings%20with%20load.../near/280288997" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234071.20.20x64.20backend.3A.20add.20lowerings.20with.20load.2E.2E.2E.html#280288997">(Apr 27 2022 at 00:13)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4071">PR #4071</a> from <code>x64-load-op-store</code> to <code>main</code>.</p>



<a name="280295129"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234071%20%20x64%20backend%3A%20add%20lowerings%20with%20load.../near/280295129" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234071.20.20x64.20backend.3A.20add.20lowerings.20with.20load.2E.2E.2E.html#280295129">(Apr 27 2022 at 01:58)</a>:</h4>
<p>cfallin merged <a href="https://github.com/bytecodealliance/wasmtime/pull/4071">PR #4071</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>