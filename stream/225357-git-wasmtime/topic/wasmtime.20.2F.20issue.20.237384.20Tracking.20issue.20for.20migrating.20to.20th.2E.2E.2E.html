<html>
<head><meta charset="utf-8"><title>wasmtime / issue #7384 Tracking issue for migrating to th... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237384.20Tracking.20issue.20for.20migrating.20to.20th.2E.2E.2E.html">wasmtime / issue #7384 Tracking issue for migrating to th...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="398766337"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237384%20Tracking%20issue%20for%20migrating%20to%20th.../near/398766337" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237384.20Tracking.20issue.20for.20migrating.20to.20th.2E.2E.2E.html#398766337">(Oct 26 2023 at 20:58)</a>:</h4>
<p>alexcrichton opened <a href="https://github.com/bytecodealliance/wasmtime/issues/7384">issue #7384</a>:</p>
<blockquote>
<p>I'm opening this as a tracking issue to assist users in migrating from the old<br>
Wasmtime 13-and-prior CLI to the new Wasmtime 14-and-later CLI. Wasmtime 14.0.x<br>
is going to receive a patch update which restores support for the old CLI to<br>
simultaneously support both the old and the new. The support, however, will<br>
issue warnings that point to this issue. Specifically:</p>
<ul>
<li>
<p>If a CLI invocation parses different in Wasmtime 13 ("the old") and Wasmtime<br>
  14 ("the new") then a warning is issued. For example:</p>
<p><code>
wasmtime run foo.wasm --invoke bar
</code></p>
<p>Was parsed in the old parser as invoking the <code>bar</code> function of <code>foo.wasm</code>. In<br>
the new parser this parses as passing the <code>--invoke</code> flag to the <code>foo.wasm</code><br>
CLI program. In this situation a warning will be issued. This example could be<br>
fixed by changing the order of the arguments:</p>
<p><code>
wasmtime run --invoke bar foo.wasm
</code></p>
<p>which will no longer emit a warning.</p>
</li>
<li>
<p>CLI invocations which fail to parse in the new parser but succeed in the old<br>
  parser will continue to work but emit a warning. For example:</p>
<p><code>
wasmtime run --disable-cache foo.wasm
</code></p>
<p>no longer works because <code>--disable-cache</code> was renamed to <code>-C cache=n</code>. This<br>
will continue to work through but emit a warning.</p>
</li>
</ul>
<p>This issue is being filed as I'm going to hardcode in the source code a print<br>
of a warning which points here for users to find and discuss. My hope is to<br>
incorporate feedback here into future iterations of the warning and/or the CLI.</p>
<h1>Changes in Wasmtime 14</h1>
<p>In Wasmtime 14 the <code>wasmtime</code> executable CLI syntax changed. #6925 has a<br>
summary of the changes as well as a detailed table to renamed flags, but a<br>
summary is restated here as well.</p>
<h2>Parsing Changes</h2>
<p>The first major change in Wasmtime 14 was a change to how arguments are parsed<br>
to Wasmtime vs the WebAssembly program being run. Previously Wasmtime would<br>
parse arguments anywhere before a <code>--</code> on the CLI as its own, and everything<br>
else was passed to the wasm program. This is a future compatibility hazard<br>
though because <code>--</code> is often omitted meaning that in the future it could be<br>
difficult for Wasmtime to add new CLI options as they would shadow any matching<br>
option passed to wasm itself.</p>
<p>Instead, starting in Wasmtime 14, all flags to Wasmtime must happen between the<br>
<code>wasmtime</code> subcommand and the WebAssembly program being run. For example:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">wasmtime</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="p">[</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">flags</span><span class="p">]</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="p">[</span><span class="n">wasm</span><span class="o">-</span><span class="n">flags</span><span class="p">]</span>
</code></pre></div>
<p>or</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">wasmtime</span><span class="w"> </span><span class="p">[</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">flags</span><span class="p">]</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="p">[</span><span class="n">wasm</span><span class="o">-</span><span class="n">flags</span><span class="p">]</span>
</code></pre></div>
<h2>Syntax Changes</h2>
<p>The second major change in Wasmtime 14 was a change to the syntax of how many<br>
arguments are passed. The Wasmtime CLI had previously organically grown where<br>
options were inconsistently named and surfaced. This ended up with a sprawling<br>
<code>--help</code> page as well differences between option names. Options are now<br>
categorized into five broad categories:</p>
<ul>
<li><code>-O foo</code> - an optimization or performance-tuning related option</li>
<li><code>-C foo</code> - a codegen option affecting the compilation process.</li>
<li><code>-D foo</code> - a debug-related option</li>
<li><code>-W foo</code> - a wasm-related option, for example changing wasm semantics</li>
<li><code>-S foo</code> - a WASI-related option, configuring various proposals for example</li>
</ul>
<p>These single-letter flags additionally have <code>--longer</code> names as well. Nearly<br>
all configuration and tuning options for Wasmtime are now housed behind one of<br>
these flags. Each flag can be explored with <code>wasmtime -O help</code> for example.</p>
<h1>Examples of handling warnings</h1>
<p>This section is intended to list a suite of old CLI invocations and their<br>
equivalent in the new CLI. Where possible a new command is listed which parses<br>
the same both under the old CLI and the new CLI.</p>
<p><strong>Moving Wasmtime options before the WebAssembly file</strong></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">old</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span><span class="n">invoke</span><span class="w"> </span><span class="n">bar</span>
<span class="n">new</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">--</span><span class="n">invoke</span><span class="w"> </span><span class="n">bar</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span>
</code></pre></div>
<p><strong>Renaming Wasmtime options</strong></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">old</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span><span class="n">disable</span><span class="o">-</span><span class="n">cache</span>
<span class="n">new</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">-</span><span class="n">C</span><span class="w"> </span><span class="n">cache</span><span class="o">=</span><span class="n">n</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span>
</code></pre></div>
<p><strong>Renaming Wasmtime options</strong></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">old</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">--</span><span class="n">disable</span><span class="o">-</span><span class="n">cache</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span>
<span class="n">new</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">-</span><span class="n">C</span><span class="w"> </span><span class="n">cache</span><span class="o">=</span><span class="n">n</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span>
</code></pre></div>
<p><strong>Passing flags to WebAssembly files</strong></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">old</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="o">--</span><span class="n">flag</span>
<span class="n">new</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span><span class="n">flag</span>
</code></pre></div>
<p>Note that the new CLI also accepts <code>wasmtime run foo.wasm --flag</code> but the old<br>
CLI does not accept this.</p>
<p><strong>Passing <code>--</code> to a wasm file</strong></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">old</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="o">--</span>
<span class="n">new</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span>
</code></pre></div>
<p>Note that the new CLI also accepts <code>wasmtime run foo.wasm --</code> but the old<br>
CLI does not accept this.<br>
</p>
</blockquote>



<a name="398767111"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237384%20Tracking%20issue%20for%20migrating%20to%20th.../near/398767111" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237384.20Tracking.20issue.20for.20migrating.20to.20th.2E.2E.2E.html#398767111">(Oct 26 2023 at 21:03)</a>:</h4>
<p>alexcrichton edited <a href="https://github.com/bytecodealliance/wasmtime/issues/7384">issue #7384</a>:</p>
<blockquote>
<p>I'm opening this as a tracking issue to assist users in migrating from the old<br>
Wasmtime 13-and-prior CLI to the new Wasmtime 14-and-later CLI. Wasmtime 14.0.x<br>
is going to receive a patch update which restores support for the old CLI to<br>
simultaneously support both the old and the new. The support, however, will<br>
issue warnings that point to this issue. Specifically:</p>
<ul>
<li>
<p>If a CLI invocation parses different in Wasmtime 13 ("the old") and Wasmtime<br>
  14 ("the new") then a warning is issued. For example:</p>
<p><code>
wasmtime run foo.wasm --invoke bar
</code></p>
<p>Was parsed in the old parser as invoking the <code>bar</code> function of <code>foo.wasm</code>. In<br>
the new parser this parses as passing the <code>--invoke</code> flag to the <code>foo.wasm</code><br>
CLI program. In this situation a warning will be issued. This example could be<br>
fixed by changing the order of the arguments:</p>
<p><code>
wasmtime run --invoke bar foo.wasm
</code></p>
<p>which will no longer emit a warning.</p>
</li>
<li>
<p>CLI invocations which fail to parse in the new parser but succeed in the old<br>
  parser will continue to work but emit a warning. For example:</p>
<p><code>
wasmtime run --disable-cache foo.wasm
</code></p>
<p>no longer works because <code>--disable-cache</code> was renamed to <code>-C cache=n</code>. This<br>
will continue to work through but emit a warning.</p>
</li>
</ul>
<p>This issue is being filed as I'm going to hardcode in the source code a print<br>
of a warning which points here for users to find and discuss. My hope is to<br>
incorporate feedback here into future iterations of the warning and/or the CLI.</p>
<h1>Changes in Wasmtime 14</h1>
<p>In Wasmtime 14 the <code>wasmtime</code> executable CLI syntax changed. #6925 has a<br>
summary of the changes as well as a detailed table to renamed flags, but a<br>
summary is restated here as well.</p>
<h2>Parsing Changes</h2>
<p>The first major change in Wasmtime 14 was a change to how arguments are parsed<br>
to Wasmtime vs the WebAssembly program being run. Previously Wasmtime would<br>
parse arguments anywhere before a <code>--</code> on the CLI as its own, and everything<br>
else was passed to the wasm program. This is a future compatibility hazard<br>
though because <code>--</code> is often omitted meaning that in the future it could be<br>
difficult for Wasmtime to add new CLI options as they would shadow any matching<br>
option passed to wasm itself.</p>
<p>Instead, starting in Wasmtime 14, all flags to Wasmtime must happen between the<br>
<code>wasmtime</code> subcommand and the WebAssembly program being run. For example:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">wasmtime</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="p">[</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">flags</span><span class="p">]</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="p">[</span><span class="n">wasm</span><span class="o">-</span><span class="n">flags</span><span class="p">]</span>
</code></pre></div>
<p>or</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">wasmtime</span><span class="w"> </span><span class="p">[</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">flags</span><span class="p">]</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="p">[</span><span class="n">wasm</span><span class="o">-</span><span class="n">flags</span><span class="p">]</span>
</code></pre></div>
<h2>Syntax Changes</h2>
<p>The second major change in Wasmtime 14 was a change to the syntax of how many<br>
arguments are passed. The Wasmtime CLI had previously organically grown where<br>
options were inconsistently named and surfaced. This ended up with a sprawling<br>
<code>--help</code> page as well differences between option names. Options are now<br>
categorized into five broad categories:</p>
<ul>
<li><code>-O foo</code> - an optimization or performance-tuning related option</li>
<li><code>-C foo</code> - a codegen option affecting the compilation process.</li>
<li><code>-D foo</code> - a debug-related option</li>
<li><code>-W foo</code> - a wasm-related option, for example changing wasm semantics</li>
<li><code>-S foo</code> - a WASI-related option, configuring various proposals for example</li>
</ul>
<p>These single-letter flags additionally have <code>--longer</code> names as well. Nearly<br>
all configuration and tuning options for Wasmtime are now housed behind one of<br>
these flags. Each flag can be explored with <code>wasmtime -O help</code> for example.</p>
<h1>Examples of handling warnings</h1>
<p>This section is intended to list a suite of old CLI invocations and their<br>
equivalent in the new CLI. Where possible a new command is listed which parses<br>
the same both under the old CLI and the new CLI.</p>
<p><strong>Moving Wasmtime options before the WebAssembly file</strong></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">[</span><span class="n">old</span><span class="p">]</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span><span class="n">invoke</span><span class="w"> </span><span class="n">bar</span>
<span class="p">[</span><span class="n">new</span><span class="p">]</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">--</span><span class="n">invoke</span><span class="w"> </span><span class="n">bar</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span>
</code></pre></div>
<p><strong>Renaming Wasmtime options</strong></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">[</span><span class="n">old</span><span class="p">]</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span><span class="n">disable</span><span class="o">-</span><span class="n">cache</span>
<span class="p">[</span><span class="n">new</span><span class="p">]</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">-</span><span class="n">C</span><span class="w"> </span><span class="n">cache</span><span class="o">=</span><span class="n">n</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span>
</code></pre></div>
<p><strong>Renaming Wasmtime options</strong></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">[</span><span class="n">old</span><span class="p">]</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">--</span><span class="n">disable</span><span class="o">-</span><span class="n">cache</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span>
<span class="p">[</span><span class="n">new</span><span class="p">]</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">-</span><span class="n">C</span><span class="w"> </span><span class="n">cache</span><span class="o">=</span><span class="n">n</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span>
</code></pre></div>
<p><strong>Passing flags to WebAssembly files</strong></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">[</span><span class="n">old</span><span class="p">]</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="o">--</span><span class="n">flag</span>
<span class="p">[</span><span class="n">new</span><span class="p">]</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span><span class="n">flag</span>
</code></pre></div>
<p>Note that the new CLI also accepts <code>wasmtime run foo.wasm --flag</code> but the old CLI does not accept this. Additionally this will print a warning while the old CLI is still supported.</p>
<p><strong>Passing <code>--</code> to a wasm file</strong></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">[</span><span class="n">old</span><span class="p">]</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="o">--</span>
<span class="p">[</span><span class="n">new</span><span class="p">]</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span>
</code></pre></div>
<p>Note that the new CLI also accepts <code>wasmtime run foo.wasm --</code> but the old CLI does not accept this. Additionally this will print a warning while the old CLI is still supported.<br>
CLI does not accept this.<br>
</p>
</blockquote>



<a name="398767371"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237384%20Tracking%20issue%20for%20migrating%20to%20th.../near/398767371" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237384.20Tracking.20issue.20for.20migrating.20to.20th.2E.2E.2E.html#398767371">(Oct 26 2023 at 21:04)</a>:</h4>
<p>alexcrichton edited <a href="https://github.com/bytecodealliance/wasmtime/issues/7384">issue #7384</a>:</p>
<blockquote>
<blockquote>
<p><strong>Note</strong>: if you'd rather not read up on this change and deal with it later then set <code>WASMTIME_NEW_CLI=0</code> to force usage of the old CLI or <code>WASMTIME_NEW_CLI=1</code> to force usage of the new CLI. This environment variable will go away in the future and the old CLI will be removed. This won't happen at least until Wasmtime 16 and at this time no exact time to make this change has been determined.</p>
</blockquote>
<p>I'm opening this as a tracking issue to assist users in migrating from the old<br>
Wasmtime 13-and-prior CLI to the new Wasmtime 14-and-later CLI. Wasmtime 14.0.x<br>
is going to receive a patch update which restores support for the old CLI to<br>
simultaneously support both the old and the new. The support, however, will<br>
issue warnings that point to this issue. Specifically:</p>
<ul>
<li>
<p>If a CLI invocation parses different in Wasmtime 13 ("the old") and Wasmtime<br>
  14 ("the new") then a warning is issued. For example:</p>
<p><code>
wasmtime run foo.wasm --invoke bar
</code></p>
<p>Was parsed in the old parser as invoking the <code>bar</code> function of <code>foo.wasm</code>. In<br>
the new parser this parses as passing the <code>--invoke</code> flag to the <code>foo.wasm</code><br>
CLI program. In this situation a warning will be issued. This example could be<br>
fixed by changing the order of the arguments:</p>
<p><code>
wasmtime run --invoke bar foo.wasm
</code></p>
<p>which will no longer emit a warning.</p>
</li>
<li>
<p>CLI invocations which fail to parse in the new parser but succeed in the old<br>
  parser will continue to work but emit a warning. For example:</p>
<p><code>
wasmtime run --disable-cache foo.wasm
</code></p>
<p>no longer works because <code>--disable-cache</code> was renamed to <code>-C cache=n</code>. This<br>
will continue to work through but emit a warning.</p>
</li>
</ul>
<p>This issue is being filed as I'm going to hardcode in the source code a print<br>
of a warning which points here for users to find and discuss. My hope is to<br>
incorporate feedback here into future iterations of the warning and/or the CLI.</p>
<h1>Changes in Wasmtime 14</h1>
<p>In Wasmtime 14 the <code>wasmtime</code> executable CLI syntax changed. #6925 has a<br>
summary of the changes as well as a detailed table to renamed flags, but a<br>
summary is restated here as well.</p>
<h2>Parsing Changes</h2>
<p>The first major change in Wasmtime 14 was a change to how arguments are parsed<br>
to Wasmtime vs the WebAssembly program being run. Previously Wasmtime would<br>
parse arguments anywhere before a <code>--</code> on the CLI as its own, and everything<br>
else was passed to the wasm program. This is a future compatibility hazard<br>
though because <code>--</code> is often omitted meaning that in the future it could be<br>
difficult for Wasmtime to add new CLI options as they would shadow any matching<br>
option passed to wasm itself.</p>
<p>Instead, starting in Wasmtime 14, all flags to Wasmtime must happen between the<br>
<code>wasmtime</code> subcommand and the WebAssembly program being run. For example:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">wasmtime</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="p">[</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">flags</span><span class="p">]</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="p">[</span><span class="n">wasm</span><span class="o">-</span><span class="n">flags</span><span class="p">]</span>
</code></pre></div>
<p>or</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">wasmtime</span><span class="w"> </span><span class="p">[</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">flags</span><span class="p">]</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="p">[</span><span class="n">wasm</span><span class="o">-</span><span class="n">flags</span><span class="p">]</span>
</code></pre></div>
<h2>Syntax Changes</h2>
<p>The second major change in Wasmtime 14 was a change to the syntax of how many<br>
arguments are passed. The Wasmtime CLI had previously organically grown where<br>
options were inconsistently named and surfaced. This ended up with a sprawling<br>
<code>--help</code> page as well differences between option names. Options are now<br>
categorized into five broad categories:</p>
<ul>
<li><code>-O foo</code> - an optimization or performance-tuning related option</li>
<li><code>-C foo</code> - a codegen option affecting the compilation process.</li>
<li><code>-D foo</code> - a debug-related option</li>
<li><code>-W foo</code> - a wasm-related option, for example changing wasm semantics</li>
<li><code>-S foo</code> - a WASI-related option, configuring various proposals for example</li>
</ul>
<p>These single-letter flags additionally have <code>--longer</code> names as well. Nearly<br>
all configuration and tuning options for Wasmtime are now housed behind one of<br>
these flags. Each flag can be explored with <code>wasmtime -O help</code> for example.</p>
<h1>Examples of handling warnings</h1>
<p>This section is intended to list a suite of old CLI invocations and their<br>
equivalent in the new CLI. Where possible a new command is listed which parses<br>
the same both under the old CLI and the new CLI.</p>
<p><strong>Moving Wasmtime options before the WebAssembly file</strong></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">[</span><span class="n">old</span><span class="p">]</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span><span class="n">invoke</span><span class="w"> </span><span class="n">bar</span>
<span class="p">[</span><span class="n">new</span><span class="p">]</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">--</span><span class="n">invoke</span><span class="w"> </span><span class="n">bar</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span>
</code></pre></div>
<p><strong>Renaming Wasmtime options</strong></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">[</span><span class="n">old</span><span class="p">]</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span><span class="n">disable</span><span class="o">-</span><span class="n">cache</span>
<span class="p">[</span><span class="n">new</span><span class="p">]</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">-</span><span class="n">C</span><span class="w"> </span><span class="n">cache</span><span class="o">=</span><span class="n">n</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span>
</code></pre></div>
<p><strong>Renaming Wasmtime options</strong></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">[</span><span class="n">old</span><span class="p">]</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">--</span><span class="n">disable</span><span class="o">-</span><span class="n">cache</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span>
<span class="p">[</span><span class="n">new</span><span class="p">]</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">-</span><span class="n">C</span><span class="w"> </span><span class="n">cache</span><span class="o">=</span><span class="n">n</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span>
</code></pre></div>
<p><strong>Passing flags to WebAssembly files</strong></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">[</span><span class="n">old</span><span class="p">]</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="o">--</span><span class="n">flag</span>
<span class="p">[</span><span class="n">new</span><span class="p">]</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span><span class="n">flag</span>
</code></pre></div>
<p>Note that the new CLI also accepts <code>wasmtime run foo.wasm --flag</code> but the old CLI does not accept this. Additionally this will print a warning while the old CLI is still supported.</p>
<p><strong>Passing <code>--</code> to a wasm file</strong></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">[</span><span class="n">old</span><span class="p">]</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="o">--</span>
<span class="p">[</span><span class="n">new</span><span class="p">]</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span>
</code></pre></div>
<p>Note that the new CLI also accepts <code>wasmtime run foo.wasm --</code> but the old CLI does not accept this. Additionally this will print a warning while the old CLI is still supported.<br>
CLI does not accept this.<br>
</p>
</blockquote>



<a name="398768923"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237384%20Tracking%20issue%20for%20migrating%20to%20th.../near/398768923" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237384.20Tracking.20issue.20for.20migrating.20to.20th.2E.2E.2E.html#398768923">(Oct 26 2023 at 21:16)</a>:</h4>
<p>alexcrichton edited <a href="https://github.com/bytecodealliance/wasmtime/issues/7384">issue #7384</a>:</p>
<blockquote>
<blockquote>
<p><strong>Note</strong>: if you'd rather not read up on this change and deal with it later then set <code>WASMTIME_NEW_CLI=0</code> to force usage of the old CLI or <code>WASMTIME_NEW_CLI=1</code> to force usage of the new CLI. This environment variable will go away in the future and the old CLI will be removed. This won't happen at least until Wasmtime 16 and at this time no exact time to make this change has been determined.</p>
</blockquote>
<p>I'm opening this as a tracking issue to assist users in migrating from the old<br>
Wasmtime 13-and-prior CLI to the new Wasmtime 14-and-later CLI. Wasmtime 14.0.x<br>
is going to receive a patch update which restores support for the old CLI to<br>
simultaneously support both the old and the new. The support, however, will<br>
issue warnings that point to this issue. Specifically:</p>
<ul>
<li>
<p>If a CLI invocation parses different in Wasmtime 13 ("the old") and Wasmtime<br>
  14 ("the new") then a warning is issued. For example:</p>
<p><code>
wasmtime run foo.wasm --invoke bar
</code></p>
<p>Was parsed in the old parser as invoking the <code>bar</code> function of <code>foo.wasm</code>. In<br>
the new parser this parses as passing the <code>--invoke</code> flag to the <code>foo.wasm</code><br>
CLI program. In this situation a warning will be issued. This example could be<br>
fixed by changing the order of the arguments:</p>
<p><code>
wasmtime run --invoke bar foo.wasm
</code></p>
<p>which will no longer emit a warning.</p>
</li>
<li>
<p>CLI invocations which fail to parse in the new parser but succeed in the old<br>
  parser will continue to work but emit a warning. For example:</p>
<p><code>
wasmtime run --disable-cache foo.wasm
</code></p>
<p>no longer works because <code>--disable-cache</code> was renamed to <code>-C cache=n</code>. This<br>
will continue to work through but emit a warning.</p>
</li>
</ul>
<p>This issue is being filed as I'm going to hardcode in the source code a print<br>
of a warning which points here for users to find and discuss. My hope is to<br>
incorporate feedback here into future iterations of the warning and/or the CLI.</p>
<h1>Changes in Wasmtime 14</h1>
<p>In Wasmtime 14 the <code>wasmtime</code> executable CLI syntax changed. #6925 has a<br>
summary of the changes as well as a detailed table to renamed flags, but a<br>
summary is restated here as well.</p>
<h2>Parsing Changes</h2>
<p>The first major change in Wasmtime 14 was a change to how arguments are parsed<br>
to Wasmtime vs the WebAssembly program being run. Previously Wasmtime would<br>
parse arguments anywhere before a <code>--</code> on the CLI as its own, and everything<br>
else was passed to the wasm program. This is a future compatibility hazard<br>
though because <code>--</code> is often omitted meaning that in the future it could be<br>
difficult for Wasmtime to add new CLI options as they would shadow any matching<br>
option passed to wasm itself.</p>
<p>Instead, starting in Wasmtime 14, all flags to Wasmtime must happen between the<br>
<code>wasmtime</code> subcommand and the WebAssembly program being run. For example:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">wasmtime</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="p">[</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">flags</span><span class="p">]</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="p">[</span><span class="n">wasm</span><span class="o">-</span><span class="n">flags</span><span class="p">]</span>
</code></pre></div>
<p>or</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">wasmtime</span><span class="w"> </span><span class="p">[</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">flags</span><span class="p">]</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="p">[</span><span class="n">wasm</span><span class="o">-</span><span class="n">flags</span><span class="p">]</span>
</code></pre></div>
<h2>Syntax Changes</h2>
<p>The second major change in Wasmtime 14 was a change to the syntax of how many<br>
arguments are passed. The Wasmtime CLI had previously organically grown where<br>
options were inconsistently named and surfaced. This ended up with a sprawling<br>
<code>--help</code> page as well differences between option names. Options are now<br>
categorized into five broad categories:</p>
<ul>
<li><code>-O foo</code> - an optimization or performance-tuning related option</li>
<li><code>-C foo</code> - a codegen option affecting the compilation process.</li>
<li><code>-D foo</code> - a debug-related option</li>
<li><code>-W foo</code> - a wasm-related option, for example changing wasm semantics</li>
<li><code>-S foo</code> - a WASI-related option, configuring various proposals for example</li>
</ul>
<p>These single-letter flags additionally have <code>--longer</code> names as well. Nearly<br>
all configuration and tuning options for Wasmtime are now housed behind one of<br>
these flags. Each flag can be explored with <code>wasmtime -O help</code> for example.</p>
<h1>Examples of handling warnings</h1>
<p>This section is intended to list a suite of old CLI invocations and their<br>
equivalent in the new CLI. Where possible a new command is listed which parses<br>
the same both under the old CLI and the new CLI.</p>
<p><strong>Moving Wasmtime options before the WebAssembly file</strong></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">[</span><span class="n">old</span><span class="p">]</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span><span class="n">invoke</span><span class="w"> </span><span class="n">bar</span>
<span class="p">[</span><span class="n">new</span><span class="p">]</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="o">--</span><span class="n">invoke</span><span class="w"> </span><span class="n">bar</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span>
<span class="p">[</span><span class="n">old</span><span class="p">]</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span><span class="n">invoke</span><span class="w"> </span><span class="n">bar</span>
<span class="p">[</span><span class="n">new</span><span class="p">]</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">--</span><span class="n">invoke</span><span class="w"> </span><span class="n">bar</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span>
</code></pre></div>
<p><strong>Renaming Wasmtime options</strong></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">[</span><span class="n">old</span><span class="p">]</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span><span class="n">disable</span><span class="o">-</span><span class="n">cache</span>
<span class="p">[</span><span class="n">new</span><span class="p">]</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">-</span><span class="n">C</span><span class="w"> </span><span class="n">cache</span><span class="o">=</span><span class="n">n</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span>
</code></pre></div>
<p><strong>Renaming Wasmtime options</strong></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">[</span><span class="n">old</span><span class="p">]</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="o">--</span><span class="n">disable</span><span class="o">-</span><span class="n">cache</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span>
<span class="p">[</span><span class="n">new</span><span class="p">]</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="o">-</span><span class="n">C</span><span class="w"> </span><span class="n">cache</span><span class="o">=</span><span class="n">n</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span>
<span class="p">[</span><span class="n">old</span><span class="p">]</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">--</span><span class="n">disable</span><span class="o">-</span><span class="n">cache</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span>
<span class="p">[</span><span class="n">new</span><span class="p">]</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">-</span><span class="n">C</span><span class="w"> </span><span class="n">cache</span><span class="o">=</span><span class="n">n</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span>
</code></pre></div>
<p><strong>Passing flags to WebAssembly files</strong></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">[</span><span class="n">old</span><span class="p">]</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="o">--</span><span class="n">flag</span>
<span class="p">[</span><span class="n">new</span><span class="p">]</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span><span class="n">flag</span>
</code></pre></div>
<p>Note that the new CLI also accepts <code>wasmtime run foo.wasm --flag</code> but the old CLI does not accept this. Additionally this will print a warning while the old CLI is still supported.</p>
<p><strong>Passing <code>--</code> to a wasm file</strong></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">[</span><span class="n">old</span><span class="p">]</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="o">--</span>
<span class="p">[</span><span class="n">new</span><span class="p">]</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span>
</code></pre></div>
<p>Note that the new CLI also accepts <code>wasmtime run foo.wasm --</code> but the old CLI does not accept this. Additionally this will print a warning while the old CLI is still supported.<br>
CLI does not accept this.<br>
</p>
</blockquote>



<a name="398768966"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237384%20Tracking%20issue%20for%20migrating%20to%20th.../near/398768966" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237384.20Tracking.20issue.20for.20migrating.20to.20th.2E.2E.2E.html#398768966">(Oct 26 2023 at 21:17)</a>:</h4>
<p>alexcrichton edited <a href="https://github.com/bytecodealliance/wasmtime/issues/7384">issue #7384</a>:</p>
<blockquote>
<blockquote>
<p><strong>Note</strong>: if you'd rather not read up on this change and deal with it later then set <code>WASMTIME_NEW_CLI=0</code> to force usage of the old CLI or <code>WASMTIME_NEW_CLI=1</code> to force usage of the new CLI. This environment variable will go away in the future and the old CLI will be removed. This won't happen at least until Wasmtime 16 and at this time no exact time to make this change has been determined.</p>
</blockquote>
<p>I'm opening this as a tracking issue to assist users in migrating from the old<br>
Wasmtime 13-and-prior CLI to the new Wasmtime 14-and-later CLI. Wasmtime 14.0.x<br>
is going to receive a patch update which restores support for the old CLI to<br>
simultaneously support both the old and the new. The support, however, will<br>
issue warnings that point to this issue. Specifically:</p>
<ul>
<li>
<p>If a CLI invocation parses different in Wasmtime 13 ("the old") and Wasmtime<br>
  14 ("the new") then a warning is issued. For example:</p>
<p><code>
wasmtime run foo.wasm --invoke bar
</code></p>
<p>Was parsed in the old parser as invoking the <code>bar</code> function of <code>foo.wasm</code>. In<br>
the new parser this parses as passing the <code>--invoke</code> flag to the <code>foo.wasm</code><br>
CLI program. In this situation a warning will be issued. This example could be<br>
fixed by changing the order of the arguments:</p>
<p><code>
wasmtime run --invoke bar foo.wasm
</code></p>
<p>which will no longer emit a warning.</p>
</li>
<li>
<p>CLI invocations which fail to parse in the new parser but succeed in the old<br>
  parser will continue to work but emit a warning. For example:</p>
<p><code>
wasmtime run --disable-cache foo.wasm
</code></p>
<p>no longer works because <code>--disable-cache</code> was renamed to <code>-C cache=n</code>. This<br>
will continue to work through but emit a warning.</p>
</li>
</ul>
<p>This issue is being filed as I'm going to hardcode in the source code a print<br>
of a warning which points here for users to find and discuss. My hope is to<br>
incorporate feedback here into future iterations of the warning and/or the CLI.</p>
<h1>Changes in Wasmtime 14</h1>
<p>In Wasmtime 14 the <code>wasmtime</code> executable CLI syntax changed. #6925 has a<br>
summary of the changes as well as a detailed table to renamed flags, but a<br>
summary is restated here as well.</p>
<h2>Parsing Changes</h2>
<p>The first major change in Wasmtime 14 was a change to how arguments are parsed<br>
to Wasmtime vs the WebAssembly program being run. Previously Wasmtime would<br>
parse arguments anywhere before a <code>--</code> on the CLI as its own, and everything<br>
else was passed to the wasm program. This is a future compatibility hazard<br>
though because <code>--</code> is often omitted meaning that in the future it could be<br>
difficult for Wasmtime to add new CLI options as they would shadow any matching<br>
option passed to wasm itself.</p>
<p>Instead, starting in Wasmtime 14, all flags to Wasmtime must happen between the<br>
<code>wasmtime</code> subcommand and the WebAssembly program being run. For example:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">wasmtime</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="p">[</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">flags</span><span class="p">]</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="p">[</span><span class="n">wasm</span><span class="o">-</span><span class="n">flags</span><span class="p">]</span>
</code></pre></div>
<p>or</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">wasmtime</span><span class="w"> </span><span class="p">[</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">flags</span><span class="p">]</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="p">[</span><span class="n">wasm</span><span class="o">-</span><span class="n">flags</span><span class="p">]</span>
</code></pre></div>
<h2>Syntax Changes</h2>
<p>The second major change in Wasmtime 14 was a change to the syntax of how many<br>
arguments are passed. The Wasmtime CLI had previously organically grown where<br>
options were inconsistently named and surfaced. This ended up with a sprawling<br>
<code>--help</code> page as well differences between option names. Options are now<br>
categorized into five broad categories:</p>
<ul>
<li><code>-O foo</code> - an optimization or performance-tuning related option</li>
<li><code>-C foo</code> - a codegen option affecting the compilation process.</li>
<li><code>-D foo</code> - a debug-related option</li>
<li><code>-W foo</code> - a wasm-related option, for example changing wasm semantics</li>
<li><code>-S foo</code> - a WASI-related option, configuring various proposals for example</li>
</ul>
<p>These single-letter flags additionally have <code>--longer</code> names as well. Nearly<br>
all configuration and tuning options for Wasmtime are now housed behind one of<br>
these flags. Each flag can be explored with <code>wasmtime -O help</code> for example.</p>
<h1>Examples of handling warnings</h1>
<p>This section is intended to list a suite of old CLI invocations and their<br>
equivalent in the new CLI. Where possible a new command is listed which parses<br>
the same both under the old CLI and the new CLI.</p>
<p><strong>Moving Wasmtime options before the WebAssembly file</strong></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">[</span><span class="n">old</span><span class="p">]</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span><span class="n">invoke</span><span class="w"> </span><span class="n">bar</span>
<span class="p">[</span><span class="n">new</span><span class="p">]</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="o">--</span><span class="n">invoke</span><span class="w"> </span><span class="n">bar</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span>
<span class="p">[</span><span class="n">old</span><span class="p">]</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span><span class="n">invoke</span><span class="w"> </span><span class="n">bar</span>
<span class="p">[</span><span class="n">new</span><span class="p">]</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">--</span><span class="n">invoke</span><span class="w"> </span><span class="n">bar</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span>
</code></pre></div>
<p><strong>Renaming Wasmtime options</strong></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">[</span><span class="n">old</span><span class="p">]</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="o">--</span><span class="n">disable</span><span class="o">-</span><span class="n">cache</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span>
<span class="p">[</span><span class="n">new</span><span class="p">]</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="o">-</span><span class="n">C</span><span class="w"> </span><span class="n">cache</span><span class="o">=</span><span class="n">n</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span>
<span class="p">[</span><span class="n">old</span><span class="p">]</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">--</span><span class="n">disable</span><span class="o">-</span><span class="n">cache</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span>
<span class="p">[</span><span class="n">new</span><span class="p">]</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">-</span><span class="n">C</span><span class="w"> </span><span class="n">cache</span><span class="o">=</span><span class="n">n</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span>
</code></pre></div>
<p><strong>Passing flags to WebAssembly files</strong></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">[</span><span class="n">old</span><span class="p">]</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="o">--</span><span class="n">flag</span>
<span class="p">[</span><span class="n">new</span><span class="p">]</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span><span class="n">flag</span>
</code></pre></div>
<p>Note that the new CLI also accepts <code>wasmtime run foo.wasm --flag</code> but the old CLI does not accept this. Additionally this will print a warning while the old CLI is still supported.</p>
<p><strong>Passing <code>--</code> to a wasm file</strong></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">[</span><span class="n">old</span><span class="p">]</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="o">--</span>
<span class="p">[</span><span class="n">new</span><span class="p">]</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span>
</code></pre></div>
<p>Note that the new CLI also accepts <code>wasmtime run foo.wasm --</code> but the old CLI does not accept this. Additionally this will print a warning while the old CLI is still supported.<br>
CLI does not accept this.<br>
</p>
</blockquote>



<a name="398769093"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237384%20Tracking%20issue%20for%20migrating%20to%20th.../near/398769093" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237384.20Tracking.20issue.20for.20migrating.20to.20th.2E.2E.2E.html#398769093">(Oct 26 2023 at 21:18)</a>:</h4>
<p>alexcrichton edited <a href="https://github.com/bytecodealliance/wasmtime/issues/7384">issue #7384</a>:</p>
<blockquote>
<blockquote>
<p><strong>Note</strong>: if you'd rather not read up on this change and deal with it later then set <code>WASMTIME_NEW_CLI=0</code> to force usage of the old CLI or <code>WASMTIME_NEW_CLI=1</code> to force usage of the new CLI. This environment variable will go away in the future and the old CLI will be removed. This won't happen at least until Wasmtime 16 and at this time no exact time to make this change has been determined.</p>
</blockquote>
<p>I'm opening this as a tracking issue to assist users in migrating from the old<br>
Wasmtime 13-and-prior CLI to the new Wasmtime 14-and-later CLI. Wasmtime 14.0.x<br>
is going to receive a patch update which restores support for the old CLI to<br>
simultaneously support both the old and the new. The support, however, will<br>
issue warnings that point to this issue. Specifically:</p>
<ul>
<li>
<p>If a CLI invocation parses different in Wasmtime 13 ("the old") and Wasmtime<br>
  14 ("the new") then a warning is issued. For example:</p>
<p><code>
wasmtime run foo.wasm --invoke bar
</code></p>
<p>Was parsed in the old parser as invoking the <code>bar</code> function of <code>foo.wasm</code>. In<br>
the new parser this parses as passing the <code>--invoke</code> flag to the <code>foo.wasm</code><br>
CLI program. In this situation a warning will be issued. This example could be<br>
fixed by changing the order of the arguments:</p>
<p><code>
wasmtime run --invoke bar foo.wasm
</code></p>
<p>which will no longer emit a warning.</p>
</li>
<li>
<p>CLI invocations which fail to parse in the new parser but succeed in the old<br>
  parser will continue to work but emit a warning. For example:</p>
<p><code>
wasmtime run --disable-cache foo.wasm
</code></p>
<p>no longer works because <code>--disable-cache</code> was renamed to <code>-C cache=n</code>. This<br>
will continue to work through but emit a warning.</p>
</li>
</ul>
<p>This issue is being filed as I'm going to hardcode in the source code a print<br>
of a warning which points here for users to find and discuss. My hope is to<br>
incorporate feedback here into future iterations of the warning and/or the CLI.</p>
<h1>Changes in Wasmtime 14</h1>
<p>In Wasmtime 14 the <code>wasmtime</code> executable CLI syntax changed. #6925 has a<br>
summary of the changes as well as a detailed table to renamed flags, but a<br>
summary is restated here as well.</p>
<h2>Parsing Changes</h2>
<p>The first major change in Wasmtime 14 was a change to how arguments are parsed<br>
to Wasmtime vs the WebAssembly program being run. Previously Wasmtime would<br>
parse arguments anywhere before a <code>--</code> on the CLI as its own, and everything<br>
else was passed to the wasm program. This is a future compatibility hazard<br>
though because <code>--</code> is often omitted meaning that in the future it could be<br>
difficult for Wasmtime to add new CLI options as they would shadow any matching<br>
option passed to wasm itself.</p>
<p>Instead, starting in Wasmtime 14, all flags to Wasmtime must happen between the<br>
<code>wasmtime</code> subcommand and the WebAssembly program being run. For example:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">wasmtime</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="p">[</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">flags</span><span class="p">]</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="p">[</span><span class="n">wasm</span><span class="o">-</span><span class="n">flags</span><span class="p">]</span>
</code></pre></div>
<p>or</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">wasmtime</span><span class="w"> </span><span class="p">[</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">flags</span><span class="p">]</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="p">[</span><span class="n">wasm</span><span class="o">-</span><span class="n">flags</span><span class="p">]</span>
</code></pre></div>
<h2>Syntax Changes</h2>
<p>The second major change in Wasmtime 14 was a change to the syntax of how many<br>
arguments are passed. The Wasmtime CLI had previously organically grown where<br>
options were inconsistently named and surfaced. This ended up with a sprawling<br>
<code>--help</code> page as well differences between option names. Options are now<br>
categorized into five broad categories:</p>
<ul>
<li><code>-O foo</code> - an optimization or performance-tuning related option</li>
<li><code>-C foo</code> - a codegen option affecting the compilation process.</li>
<li><code>-D foo</code> - a debug-related option</li>
<li><code>-W foo</code> - a wasm-related option, for example changing wasm semantics</li>
<li><code>-S foo</code> - a WASI-related option, configuring various proposals for example</li>
</ul>
<p>These single-letter flags additionally have <code>--longer</code> names as well. Nearly<br>
all configuration and tuning options for Wasmtime are now housed behind one of<br>
these flags. Each flag can be explored with <code>wasmtime -O help</code> for example.</p>
<h1>Examples of handling warnings</h1>
<p>This section is intended to list a suite of old CLI invocations and their<br>
equivalent in the new CLI. Where possible a new command is listed which parses<br>
the same both under the old CLI and the new CLI.</p>
<p><strong>Moving Wasmtime options before the WebAssembly file</strong></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">[</span><span class="n">old</span><span class="p">]</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span><span class="n">invoke</span><span class="w"> </span><span class="n">bar</span>
<span class="p">[</span><span class="n">new</span><span class="p">]</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="o">--</span><span class="n">invoke</span><span class="w"> </span><span class="n">bar</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span>
<span class="p">[</span><span class="n">old</span><span class="p">]</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span><span class="n">invoke</span><span class="w"> </span><span class="n">bar</span>
<span class="p">[</span><span class="n">new</span><span class="p">]</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">--</span><span class="n">invoke</span><span class="w"> </span><span class="n">bar</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span>
</code></pre></div>
<p><strong>Renaming Wasmtime options</strong></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">[</span><span class="n">old</span><span class="p">]</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="o">--</span><span class="n">disable</span><span class="o">-</span><span class="n">cache</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span>
<span class="p">[</span><span class="n">new</span><span class="p">]</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="o">-</span><span class="n">C</span><span class="w"> </span><span class="n">cache</span><span class="o">=</span><span class="n">n</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span>
<span class="p">[</span><span class="n">old</span><span class="p">]</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">--</span><span class="n">disable</span><span class="o">-</span><span class="n">cache</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span>
<span class="p">[</span><span class="n">new</span><span class="p">]</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">-</span><span class="n">C</span><span class="w"> </span><span class="n">cache</span><span class="o">=</span><span class="n">n</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span>
</code></pre></div>
<p><strong>Passing flags to WebAssembly files</strong></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">[</span><span class="n">old</span><span class="p">]</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="o">--</span><span class="n">flag</span>
<span class="p">[</span><span class="n">new</span><span class="p">]</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span><span class="n">flag</span>
</code></pre></div>
<p>Note that the new CLI also accepts <code>wasmtime run foo.wasm --flag</code> but the old CLI does not accept this. Additionally this will print a warning while the old CLI is still supported.</p>
<p><strong>Passing <code>--</code> to a wasm file</strong></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">[</span><span class="n">old</span><span class="p">]</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="o">--</span>
<span class="p">[</span><span class="n">new</span><span class="p">]</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span>
</code></pre></div>
<p>Note that the new CLI also accepts <code>wasmtime run foo.wasm --</code> but the old CLI does not accept this. Additionally this will print a warning while the old CLI is still supported.<br>
</p>
</blockquote>



<a name="399356618"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237384%20Tracking%20issue%20for%20migrating%20to%20th.../near/399356618" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237384.20Tracking.20issue.20for.20migrating.20to.20th.2E.2E.2E.html#399356618">(Oct 30 2023 at 18:31)</a>:</h4>
<p>eminence <a href="https://github.com/bytecodealliance/wasmtime/issues/7384#issuecomment-1785816734">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/7384">issue #7384</a>:</p>
<blockquote>
<p>Some things to add to the TODO list, when you have a chance:</p>
<ul>
<li>Update the usage examples in the output of <code>wasmtime --help</code></li>
<li>Update the online docs (for example <a href="https://docs.wasmtime.dev/lang-bash.html">https://docs.wasmtime.dev/lang-bash.html</a>)</li>
</ul>
</blockquote>



<a name="399357758"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237384%20Tracking%20issue%20for%20migrating%20to%20th.../near/399357758" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237384.20Tracking.20issue.20for.20migrating.20to.20th.2E.2E.2E.html#399357758">(Oct 30 2023 at 18:38)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/7384#issuecomment-1785827805">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/7384">issue #7384</a>:</p>
<blockquote>
<p>Thanks for the heads up! I posted <a href="https://github.com/bytecodealliance/wasmtime/pull/7408">https://github.com/bytecodealliance/wasmtime/pull/7408</a> to cover those. Apologies for missing the <code>--help</code>, I thought I went through that but I ended up missing it...</p>
</blockquote>



<a name="446199671"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237384%20Tracking%20issue%20for%20migrating%20to%20th.../near/446199671" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237384.20Tracking.20issue.20for.20migrating.20to.20th.2E.2E.2E.html#446199671">(Jun 22 2024 at 00:30)</a>:</h4>
<p>alexcrichton closed <a href="https://github.com/bytecodealliance/wasmtime/issues/7384">issue #7384</a>:</p>
<blockquote>
<blockquote>
<p><strong>Note</strong>: if you'd rather not read up on this change and deal with it later then set <code>WASMTIME_NEW_CLI=0</code> to force usage of the old CLI or <code>WASMTIME_NEW_CLI=1</code> to force usage of the new CLI. This environment variable will go away in the future and the old CLI will be removed. This won't happen at least until Wasmtime 16 and at this time no exact time to make this change has been determined.</p>
</blockquote>
<p>I'm opening this as a tracking issue to assist users in migrating from the old<br>
Wasmtime 13-and-prior CLI to the new Wasmtime 14-and-later CLI. Wasmtime 14.0.x<br>
is going to receive a patch update which restores support for the old CLI to<br>
simultaneously support both the old and the new. The support, however, will<br>
issue warnings that point to this issue. Specifically:</p>
<ul>
<li>
<p>If a CLI invocation parses different in Wasmtime 13 ("the old") and Wasmtime<br>
  14 ("the new") then a warning is issued. For example:</p>
<p><code>
wasmtime run foo.wasm --invoke bar
</code></p>
<p>Was parsed in the old parser as invoking the <code>bar</code> function of <code>foo.wasm</code>. In<br>
the new parser this parses as passing the <code>--invoke</code> flag to the <code>foo.wasm</code><br>
CLI program. In this situation a warning will be issued. This example could be<br>
fixed by changing the order of the arguments:</p>
<p><code>
wasmtime run --invoke bar foo.wasm
</code></p>
<p>which will no longer emit a warning.</p>
</li>
<li>
<p>CLI invocations which fail to parse in the new parser but succeed in the old<br>
  parser will continue to work but emit a warning. For example:</p>
<p><code>
wasmtime run --disable-cache foo.wasm
</code></p>
<p>no longer works because <code>--disable-cache</code> was renamed to <code>-C cache=n</code>. This<br>
will continue to work through but emit a warning.</p>
</li>
</ul>
<p>This issue is being filed as I'm going to hardcode in the source code a print<br>
of a warning which points here for users to find and discuss. My hope is to<br>
incorporate feedback here into future iterations of the warning and/or the CLI.</p>
<h1>Changes in Wasmtime 14</h1>
<p>In Wasmtime 14 the <code>wasmtime</code> executable CLI syntax changed. #6925 has a<br>
summary of the changes as well as a detailed table to renamed flags, but a<br>
summary is restated here as well.</p>
<h2>Parsing Changes</h2>
<p>The first major change in Wasmtime 14 was a change to how arguments are parsed<br>
to Wasmtime vs the WebAssembly program being run. Previously Wasmtime would<br>
parse arguments anywhere before a <code>--</code> on the CLI as its own, and everything<br>
else was passed to the wasm program. This is a future compatibility hazard<br>
though because <code>--</code> is often omitted meaning that in the future it could be<br>
difficult for Wasmtime to add new CLI options as they would shadow any matching<br>
option passed to wasm itself.</p>
<p>Instead, starting in Wasmtime 14, all flags to Wasmtime must happen between the<br>
<code>wasmtime</code> subcommand and the WebAssembly program being run. For example:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">wasmtime</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="p">[</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">flags</span><span class="p">]</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="p">[</span><span class="n">wasm</span><span class="o">-</span><span class="n">flags</span><span class="p">]</span>
</code></pre></div>
<p>or</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">wasmtime</span><span class="w"> </span><span class="p">[</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">flags</span><span class="p">]</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="p">[</span><span class="n">wasm</span><span class="o">-</span><span class="n">flags</span><span class="p">]</span>
</code></pre></div>
<h2>Syntax Changes</h2>
<p>The second major change in Wasmtime 14 was a change to the syntax of how many<br>
arguments are passed. The Wasmtime CLI had previously organically grown where<br>
options were inconsistently named and surfaced. This ended up with a sprawling<br>
<code>--help</code> page as well differences between option names. Options are now<br>
categorized into five broad categories:</p>
<ul>
<li><code>-O foo</code> - an optimization or performance-tuning related option</li>
<li><code>-C foo</code> - a codegen option affecting the compilation process.</li>
<li><code>-D foo</code> - a debug-related option</li>
<li><code>-W foo</code> - a wasm-related option, for example changing wasm semantics</li>
<li><code>-S foo</code> - a WASI-related option, configuring various proposals for example</li>
</ul>
<p>These single-letter flags additionally have <code>--longer</code> names as well. Nearly<br>
all configuration and tuning options for Wasmtime are now housed behind one of<br>
these flags. Each flag can be explored with <code>wasmtime -O help</code> for example.</p>
<h1>Examples of handling warnings</h1>
<p>This section is intended to list a suite of old CLI invocations and their<br>
equivalent in the new CLI. Where possible a new command is listed which parses<br>
the same both under the old CLI and the new CLI.</p>
<p><strong>Moving Wasmtime options before the WebAssembly file</strong></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">[</span><span class="n">old</span><span class="p">]</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span><span class="n">invoke</span><span class="w"> </span><span class="n">bar</span>
<span class="p">[</span><span class="n">new</span><span class="p">]</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="o">--</span><span class="n">invoke</span><span class="w"> </span><span class="n">bar</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span>
<span class="p">[</span><span class="n">old</span><span class="p">]</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span><span class="n">invoke</span><span class="w"> </span><span class="n">bar</span>
<span class="p">[</span><span class="n">new</span><span class="p">]</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">--</span><span class="n">invoke</span><span class="w"> </span><span class="n">bar</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span>
</code></pre></div>
<p><strong>Renaming Wasmtime options</strong></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">[</span><span class="n">old</span><span class="p">]</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="o">--</span><span class="n">disable</span><span class="o">-</span><span class="n">cache</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span>
<span class="p">[</span><span class="n">new</span><span class="p">]</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="o">-</span><span class="n">C</span><span class="w"> </span><span class="n">cache</span><span class="o">=</span><span class="n">n</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span>
<span class="p">[</span><span class="n">old</span><span class="p">]</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">--</span><span class="n">disable</span><span class="o">-</span><span class="n">cache</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span>
<span class="p">[</span><span class="n">new</span><span class="p">]</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">-</span><span class="n">C</span><span class="w"> </span><span class="n">cache</span><span class="o">=</span><span class="n">n</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span>
</code></pre></div>
<p><strong>Passing flags to WebAssembly files</strong></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">[</span><span class="n">old</span><span class="p">]</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="o">--</span><span class="n">flag</span>
<span class="p">[</span><span class="n">new</span><span class="p">]</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span><span class="n">flag</span>
</code></pre></div>
<p>Note that the new CLI also accepts <code>wasmtime run foo.wasm --flag</code> but the old CLI does not accept this. Additionally this will print a warning while the old CLI is still supported.</p>
<p><strong>Passing <code>--</code> to a wasm file</strong></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">[</span><span class="n">old</span><span class="p">]</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="o">--</span>
<span class="p">[</span><span class="n">new</span><span class="p">]</span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span>
</code></pre></div>
<p>Note that the new CLI also accepts <code>wasmtime run foo.wasm --</code> but the old CLI does not accept this. Additionally this will print a warning while the old CLI is still supported.<br>
</p>
</blockquote>



<a name="446199672"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237384%20Tracking%20issue%20for%20migrating%20to%20th.../near/446199672" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237384.20Tracking.20issue.20for.20migrating.20to.20th.2E.2E.2E.html#446199672">(Jun 22 2024 at 00:30)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/7384#issuecomment-2183609117">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/7384">issue #7384</a>:</p>
<blockquote>
<p>The old CLI was removed in <a href="https://github.com/bytecodealliance/wasmtime/pull/8597">https://github.com/bytecodealliance/wasmtime/pull/8597</a> and Wasmtime 22 no longer supports the old CLI</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>