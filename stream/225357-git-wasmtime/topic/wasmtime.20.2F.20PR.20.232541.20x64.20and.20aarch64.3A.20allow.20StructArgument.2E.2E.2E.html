<html>
<head><meta charset="utf-8"><title>wasmtime / PR #2541 x64 and aarch64: allow StructArgument... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232541.20x64.20and.20aarch64.3A.20allow.20StructArgument.2E.2E.2E.html">wasmtime / PR #2541 x64 and aarch64: allow StructArgument...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="221493034"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232541%20x64%20and%20aarch64%3A%20allow%20StructArgument.../near/221493034" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232541.20x64.20and.20aarch64.3A.20allow.20StructArgument.2E.2E.2E.html#221493034">(Jan 04 2021 at 06:30)</a>:</h4>
<p>cfallin opened <a href="https://github.com/bytecodealliance/wasmtime/pull/2541">PR #2541</a> from <code>struct-arg-ret</code> to <code>main</code>:</p>
<blockquote>
<p>This PR depends on #2538 and #2539 and includes those commits.</p>
<p>The StructReturn ABI is fairly simple at the codegen/isel level: we only<br>
need to take care to return the sret pointer as one of the return values<br>
if that wasn't specified in the initial function signature.</p>
<p>Struct arguments are a little more complex. A struct argument is stored<br>
as a chunk of memory in the stack-args space. However, the CLIF<br>
semantics are slightly special: on the caller side, the parameter passed<br>
in is a pointer to an arbitrary memory block, and we must memcpy this<br>
data to the on-stack struct-argument; and on the callee side, we provide<br>
a pointer to the passed-in struct-argument as the CLIF block param<br>
value.</p>
<p>This is necessary to support various ABIs other than Wasm, such as that<br>
of Rust (with the cg_clif codegen backend).<br>
</p>
</blockquote>



<a name="221493035"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232541%20x64%20and%20aarch64%3A%20allow%20StructArgument.../near/221493035" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232541.20x64.20and.20aarch64.3A.20allow.20StructArgument.2E.2E.2E.html#221493035">(Jan 04 2021 at 06:30)</a>:</h4>
<p><strong>cfallin</strong> requested <a href="https://github.com/bnjbvr">bnjbvr</a> and <a href="https://github.com/julian-seward1">julian-seward1</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/2541">PR #2541</a>.</p>



<a name="221493036"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232541%20x64%20and%20aarch64%3A%20allow%20StructArgument.../near/221493036" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232541.20x64.20and.20aarch64.3A.20allow.20StructArgument.2E.2E.2E.html#221493036">(Jan 04 2021 at 06:30)</a>:</h4>
<p><strong>cfallin</strong> requested <a href="https://github.com/bnjbvr">bnjbvr</a> and <a href="https://github.com/julian-seward1">julian-seward1</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/2541">PR #2541</a>.</p>



<a name="221564716"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232541%20x64%20and%20aarch64%3A%20allow%20StructArgument.../near/221564716" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232541.20x64.20and.20aarch64.3A.20allow.20StructArgument.2E.2E.2E.html#221564716">(Jan 04 2021 at 18:55)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2541#pullrequestreview-561262129">PR Review</a>.</p>



<a name="221579170"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232541%20x64%20and%20aarch64%3A%20allow%20StructArgument.../near/221579170" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232541.20x64.20and.20aarch64.3A.20allow.20StructArgument.2E.2E.2E.html#221579170">(Jan 04 2021 at 20:54)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2541">PR #2541</a> from <code>struct-arg-ret</code> to <code>main</code>:</p>
<blockquote>
<p>This PR depends on #2538 and #2539 and includes those commits.</p>
<p>The StructReturn ABI is fairly simple at the codegen/isel level: we only<br>
need to take care to return the sret pointer as one of the return values<br>
if that wasn't specified in the initial function signature.</p>
<p>Struct arguments are a little more complex. A struct argument is stored<br>
as a chunk of memory in the stack-args space. However, the CLIF<br>
semantics are slightly special: on the caller side, the parameter passed<br>
in is a pointer to an arbitrary memory block, and we must memcpy this<br>
data to the on-stack struct-argument; and on the callee side, we provide<br>
a pointer to the passed-in struct-argument as the CLIF block param<br>
value.</p>
<p>This is necessary to support various ABIs other than Wasm, such as that<br>
of Rust (with the cg_clif codegen backend).<br>
</p>
</blockquote>



<a name="221579891"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232541%20x64%20and%20aarch64%3A%20allow%20StructArgument.../near/221579891" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232541.20x64.20and.20aarch64.3A.20allow.20StructArgument.2E.2E.2E.html#221579891">(Jan 04 2021 at 21:00)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2541">PR #2541</a> from <code>struct-arg-ret</code> to <code>main</code>:</p>
<blockquote>
<p>This PR depends on #2538 and #2539 and includes those commits.</p>
<p>The StructReturn ABI is fairly simple at the codegen/isel level: we only<br>
need to take care to return the sret pointer as one of the return values<br>
if that wasn't specified in the initial function signature.</p>
<p>Struct arguments are a little more complex. A struct argument is stored<br>
as a chunk of memory in the stack-args space. However, the CLIF<br>
semantics are slightly special: on the caller side, the parameter passed<br>
in is a pointer to an arbitrary memory block, and we must memcpy this<br>
data to the on-stack struct-argument; and on the callee side, we provide<br>
a pointer to the passed-in struct-argument as the CLIF block param<br>
value.</p>
<p>This is necessary to support various ABIs other than Wasm, such as that<br>
of Rust (with the cg_clif codegen backend).<br>
</p>
</blockquote>



<a name="221726396"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232541%20x64%20and%20aarch64%3A%20allow%20StructArgument.../near/221726396" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232541.20x64.20and.20aarch64.3A.20allow.20StructArgument.2E.2E.2E.html#221726396">(Jan 06 2021 at 02:10)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2541">PR #2541</a> from <code>struct-arg-ret</code> to <code>main</code>:</p>
<blockquote>
<p>This PR depends on #2538 and #2539 and includes those commits.</p>
<p>The StructReturn ABI is fairly simple at the codegen/isel level: we only<br>
need to take care to return the sret pointer as one of the return values<br>
if that wasn't specified in the initial function signature.</p>
<p>Struct arguments are a little more complex. A struct argument is stored<br>
as a chunk of memory in the stack-args space. However, the CLIF<br>
semantics are slightly special: on the caller side, the parameter passed<br>
in is a pointer to an arbitrary memory block, and we must memcpy this<br>
data to the on-stack struct-argument; and on the callee side, we provide<br>
a pointer to the passed-in struct-argument as the CLIF block param<br>
value.</p>
<p>This is necessary to support various ABIs other than Wasm, such as that<br>
of Rust (with the cg_clif codegen backend).<br>
</p>
</blockquote>



<a name="221800232"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232541%20x64%20and%20aarch64%3A%20allow%20StructArgument.../near/221800232" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232541.20x64.20and.20aarch64.3A.20allow.20StructArgument.2E.2E.2E.html#221800232">(Jan 06 2021 at 18:01)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2541">PR #2541</a> from <code>struct-arg-ret</code> to <code>main</code>:</p>
<blockquote>
<p>This PR depends on #2538 and #2539 and includes those commits.</p>
<p>The StructReturn ABI is fairly simple at the codegen/isel level: we only<br>
need to take care to return the sret pointer as one of the return values<br>
if that wasn't specified in the initial function signature.</p>
<p>Struct arguments are a little more complex. A struct argument is stored<br>
as a chunk of memory in the stack-args space. However, the CLIF<br>
semantics are slightly special: on the caller side, the parameter passed<br>
in is a pointer to an arbitrary memory block, and we must memcpy this<br>
data to the on-stack struct-argument; and on the callee side, we provide<br>
a pointer to the passed-in struct-argument as the CLIF block param<br>
value.</p>
<p>This is necessary to support various ABIs other than Wasm, such as that<br>
of Rust (with the cg_clif codegen backend).<br>
</p>
</blockquote>



<a name="222448550"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232541%20x64%20and%20aarch64%3A%20allow%20StructArgument.../near/222448550" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232541.20x64.20and.20aarch64.3A.20allow.20StructArgument.2E.2E.2E.html#222448550">(Jan 12 2021 at 15:40)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2541#pullrequestreview-566352134">PR Review</a>.</p>



<a name="222448551"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232541%20x64%20and%20aarch64%3A%20allow%20StructArgument.../near/222448551" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232541.20x64.20and.20aarch64.3A.20allow.20StructArgument.2E.2E.2E.html#222448551">(Jan 12 2021 at 15:40)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2541#pullrequestreview-566352134">PR Review</a>.</p>



<a name="222448552"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232541%20x64%20and%20aarch64%3A%20allow%20StructArgument.../near/222448552" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232541.20x64.20and.20aarch64.3A.20allow.20StructArgument.2E.2E.2E.html#222448552">(Jan 12 2021 at 15:40)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2541#discussion_r555834015">PR Review Comment</a>:</p>
<blockquote>
<p>Could <code>x64::lower::emit_vm_call</code> be hoisted/split in a way that it could be reused, instead of having this specific helper?</p>
</blockquote>



<a name="222448553"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232541%20x64%20and%20aarch64%3A%20allow%20StructArgument.../near/222448553" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232541.20x64.20and.20aarch64.3A.20allow.20StructArgument.2E.2E.2E.html#222448553">(Jan 12 2021 at 15:40)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2541#discussion_r555832255">PR Review Comment</a>:</p>
<blockquote>
<p>Is there an implicit invariant on the struct argument's size being a multiple of 8 or 16, so the callee can address it? If so, could we add an explicit assert here?</p>
</blockquote>



<a name="222448554"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232541%20x64%20and%20aarch64%3A%20allow%20StructArgument.../near/222448554" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232541.20x64.20and.20aarch64.3A.20allow.20StructArgument.2E.2E.2E.html#222448554">(Jan 12 2021 at 15:40)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2541#discussion_r555836407">PR Review Comment</a>:</p>
<blockquote>
<p>Here we should probably use the <code>emit_vm_call</code>.</p>
</blockquote>



<a name="222448555"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232541%20x64%20and%20aarch64%3A%20allow%20StructArgument.../near/222448555" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232541.20x64.20and.20aarch64.3A.20allow.20StructArgument.2E.2E.2E.html#222448555">(Jan 12 2021 at 15:40)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2541#discussion_r555860816">PR Review Comment</a>:</p>
<blockquote>
<p>Is it wanted to a function returning multiple values, the second of which would be a struct return, would trigger the insertion below? (in other words: should this be "any return is the struct return")</p>
</blockquote>



<a name="222448557"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232541%20x64%20and%20aarch64%3A%20allow%20StructArgument.../near/222448557" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232541.20x64.20and.20aarch64.3A.20allow.20StructArgument.2E.2E.2E.html#222448557">(Jan 12 2021 at 15:40)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2541#discussion_r555842180">PR Review Comment</a>:</p>
<blockquote>
<p>Is the clone necessary here?</p>
</blockquote>



<a name="222448558"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232541%20x64%20and%20aarch64%3A%20allow%20StructArgument.../near/222448558" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232541.20x64.20and.20aarch64.3A.20allow.20StructArgument.2E.2E.2E.html#222448558">(Jan 12 2021 at 15:40)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2541#discussion_r555860026">PR Review Comment</a>:</p>
<blockquote>
<p>Since this is a single-purpose legalization enforcing the presence of a StructReturn ret if there's an StructReturn input, how about naming it <code>ensure_struct_return_is_in_out</code>, or something more targeted and precise?</p>
</blockquote>



<a name="222448559"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232541%20x64%20and%20aarch64%3A%20allow%20StructArgument.../near/222448559" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232541.20x64.20and.20aarch64.3A.20allow.20StructArgument.2E.2E.2E.html#222448559">(Jan 12 2021 at 15:40)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2541#discussion_r555835769">PR Review Comment</a>:</p>
<blockquote>
<p>Same question about alignment.</p>
</blockquote>



<a name="222448560"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232541%20x64%20and%20aarch64%3A%20allow%20StructArgument.../near/222448560" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232541.20x64.20and.20aarch64.3A.20allow.20StructArgument.2E.2E.2E.html#222448560">(Jan 12 2021 at 15:40)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2541#discussion_r555861721">PR Review Comment</a>:</p>
<blockquote>
<p>light suggestion: could we use a newtype here (and below, where this comment is also repeated), explaining what the normalization is about?</p>
</blockquote>



<a name="222448561"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232541%20x64%20and%20aarch64%3A%20allow%20StructArgument.../near/222448561" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232541.20x64.20and.20aarch64.3A.20allow.20StructArgument.2E.2E.2E.html#222448561">(Jan 12 2021 at 15:40)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2541#discussion_r555867299">PR Review Comment</a>:</p>
<blockquote>
<p>Can you add a comment referring to the <code>legalize_signature</code> function (or whatever is its new name), saying that it ensured its first <code>retval</code> register <em>is</em> the struct return value?</p>
<p>Also... would this unnecessarily add spill pressure for the entire function's lifetime to do it here (since one more register is blocked), instead of doing in the retval setup function?</p>
</blockquote>



<a name="222448563"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232541%20x64%20and%20aarch64%3A%20allow%20StructArgument.../near/222448563" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232541.20x64.20and.20aarch64.3A.20allow.20StructArgument.2E.2E.2E.html#222448563">(Jan 12 2021 at 15:40)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2541#discussion_r555863871">PR Review Comment</a>:</p>
<blockquote>
<p>There may be at most one struct arg, so we could break after this. There's even an <code>index</code> function we can use on <code>iter()</code> that would allow this to be a one-liner I think.</p>
</blockquote>



<a name="222449716"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232541%20x64%20and%20aarch64%3A%20allow%20StructArgument.../near/222449716" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232541.20x64.20and.20aarch64.3A.20allow.20StructArgument.2E.2E.2E.html#222449716">(Jan 12 2021 at 15:47)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2541#pullrequestreview-566409901">PR Review</a>.</p>



<a name="222449717"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232541%20x64%20and%20aarch64%3A%20allow%20StructArgument.../near/222449717" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232541.20x64.20and.20aarch64.3A.20allow.20StructArgument.2E.2E.2E.html#222449717">(Jan 12 2021 at 15:47)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/2541#discussion_r555875059">PR Review Comment</a>:</p>
<blockquote>
<p>Such an invariant shouldn't exist. Or at least cg_clif doesn't honour it. Maybe the abi requires it, in which case it would be nice to automatically add padding.</p>
</blockquote>



<a name="222450041"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232541%20x64%20and%20aarch64%3A%20allow%20StructArgument.../near/222450041" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232541.20x64.20and.20aarch64.3A.20allow.20StructArgument.2E.2E.2E.html#222450041">(Jan 12 2021 at 15:50)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2541#pullrequestreview-566412017">PR Review</a>.</p>



<a name="222450042"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232541%20x64%20and%20aarch64%3A%20allow%20StructArgument.../near/222450042" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232541.20x64.20and.20aarch64.3A.20allow.20StructArgument.2E.2E.2E.html#222450042">(Jan 12 2021 at 15:50)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/2541#discussion_r555876672">PR Review Comment</a>:</p>
<blockquote>
<p>It is important that the stack space for the outgoing arguments is not clobbered other than the stack space for the argument this should write. Using <code>emit_vm_call</code> makes it much harder to prevent accidentally doing this I think.</p>
</blockquote>



<a name="222803335"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232541%20x64%20and%20aarch64%3A%20allow%20StructArgument.../near/222803335" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232541.20x64.20and.20aarch64.3A.20allow.20StructArgument.2E.2E.2E.html#222803335">(Jan 15 2021 at 00:07)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2541">PR #2541</a> from <code>struct-arg-ret</code> to <code>main</code>:</p>
<blockquote>
<p>This PR depends on #2538 and #2539 and includes those commits.</p>
<p>The StructReturn ABI is fairly simple at the codegen/isel level: we only<br>
need to take care to return the sret pointer as one of the return values<br>
if that wasn't specified in the initial function signature.</p>
<p>Struct arguments are a little more complex. A struct argument is stored<br>
as a chunk of memory in the stack-args space. However, the CLIF<br>
semantics are slightly special: on the caller side, the parameter passed<br>
in is a pointer to an arbitrary memory block, and we must memcpy this<br>
data to the on-stack struct-argument; and on the callee side, we provide<br>
a pointer to the passed-in struct-argument as the CLIF block param<br>
value.</p>
<p>This is necessary to support various ABIs other than Wasm, such as that<br>
of Rust (with the cg_clif codegen backend).<br>
</p>
</blockquote>



<a name="222803341"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232541%20x64%20and%20aarch64%3A%20allow%20StructArgument.../near/222803341" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232541.20x64.20and.20aarch64.3A.20allow.20StructArgument.2E.2E.2E.html#222803341">(Jan 15 2021 at 00:07)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2541#pullrequestreview-568725117">PR Review</a>.</p>



<a name="222803343"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232541%20x64%20and%20aarch64%3A%20allow%20StructArgument.../near/222803343" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232541.20x64.20and.20aarch64.3A.20allow.20StructArgument.2E.2E.2E.html#222803343">(Jan 15 2021 at 00:07)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/2541#discussion_r557779038">PR Review Comment</a>:</p>
<blockquote>
<p>Good point; actually it could be <em>not</em> the first return value, so I've changed this to be more general and just find the StructReturn one (panic'ing if not present).</p>
<p>Re: register pressure, yes, possibly, though we're basically passing a value through from an arg to a return value so we either have to keep it in a vreg (note that <code>retval_regs</code> is filled with vregs; the move to rax happens in the epilogue) or create a pseudo-spill-slot ourselves to save it; we can't recompute it later. So I don't think we can do better than this given the ABI, sadly...</p>
</blockquote>



<a name="222803346"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232541%20x64%20and%20aarch64%3A%20allow%20StructArgument.../near/222803346" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232541.20x64.20and.20aarch64.3A.20allow.20StructArgument.2E.2E.2E.html#222803346">(Jan 15 2021 at 00:07)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2541#pullrequestreview-568725142">PR Review</a>.</p>



<a name="222803347"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232541%20x64%20and%20aarch64%3A%20allow%20StructArgument.../near/222803347" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232541.20x64.20and.20aarch64.3A.20allow.20StructArgument.2E.2E.2E.html#222803347">(Jan 15 2021 at 00:07)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/2541#discussion_r557779059">PR Review Comment</a>:</p>
<blockquote>
<p>I think there may be more than one struct arg? Struct return, yes, only one (unless we have multi-value with structs someday); but an arbitrary subset of the args may be struct types, I think.</p>
</blockquote>



<a name="222803349"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232541%20x64%20and%20aarch64%3A%20allow%20StructArgument.../near/222803349" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232541.20x64.20and.20aarch64.3A.20allow.20StructArgument.2E.2E.2E.html#222803349">(Jan 15 2021 at 00:07)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2541#pullrequestreview-568725161">PR Review</a>.</p>



<a name="222803350"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232541%20x64%20and%20aarch64%3A%20allow%20StructArgument.../near/222803350" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232541.20x64.20and.20aarch64.3A.20allow.20StructArgument.2E.2E.2E.html#222803350">(Jan 15 2021 at 00:07)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/2541#discussion_r557779081">PR Review Comment</a>:</p>
<blockquote>
<p>I considered this, but we mostly just hold onto it to return it back through the ABI trait, at which point we strip off the newtype wrapper anyway, so it didn't seem to add very much; happy to propagate it upward if you think that's best though!</p>
</blockquote>



<a name="222803354"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232541%20x64%20and%20aarch64%3A%20allow%20StructArgument.../near/222803354" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232541.20x64.20and.20aarch64.3A.20allow.20StructArgument.2E.2E.2E.html#222803354">(Jan 15 2021 at 00:07)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2541#pullrequestreview-568725208">PR Review</a>.</p>



<a name="222803355"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232541%20x64%20and%20aarch64%3A%20allow%20StructArgument.../near/222803355" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232541.20x64.20and.20aarch64.3A.20allow.20StructArgument.2E.2E.2E.html#222803355">(Jan 15 2021 at 00:07)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/2541#discussion_r557779111">PR Review Comment</a>:</p>
<blockquote>
<p>Fixed -- it should match any return value's purpose.</p>
</blockquote>



<a name="222803362"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232541%20x64%20and%20aarch64%3A%20allow%20StructArgument.../near/222803362" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232541.20x64.20and.20aarch64.3A.20allow.20StructArgument.2E.2E.2E.html#222803362">(Jan 15 2021 at 00:07)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/2541#discussion_r557779142">PR Review Comment</a>:</p>
<blockquote>
<p>Done!</p>
</blockquote>



<a name="222803364"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232541%20x64%20and%20aarch64%3A%20allow%20StructArgument.../near/222803364" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232541.20x64.20and.20aarch64.3A.20allow.20StructArgument.2E.2E.2E.html#222803364">(Jan 15 2021 at 00:07)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2541#pullrequestreview-568725250">PR Review</a>.</p>



<a name="222803369"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232541%20x64%20and%20aarch64%3A%20allow%20StructArgument.../near/222803369" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232541.20x64.20and.20aarch64.3A.20allow.20StructArgument.2E.2E.2E.html#222803369">(Jan 15 2021 at 00:07)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2541#pullrequestreview-568725278">PR Review</a>.</p>



<a name="222803370"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232541%20x64%20and%20aarch64%3A%20allow%20StructArgument.../near/222803370" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232541.20x64.20and.20aarch64.3A.20allow.20StructArgument.2E.2E.2E.html#222803370">(Jan 15 2021 at 00:07)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/2541#discussion_r557779168">PR Review Comment</a>:</p>
<blockquote>
<p>Unfortunately yes, otherwise this holds an immutable borrow on <code>vcode</code> for the duration of the loop while we also pass in <code>&amp;mut vcode</code> to <code>alloc_vregs()</code> below. I considered turning some subset of the vcode inside-out somehow to work around this but it didn't seem worth it...</p>
</blockquote>



<a name="222803378"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232541%20x64%20and%20aarch64%3A%20allow%20StructArgument.../near/222803378" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232541.20x64.20and.20aarch64.3A.20allow.20StructArgument.2E.2E.2E.html#222803378">(Jan 15 2021 at 00:07)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/2541#discussion_r557779276">PR Review Comment</a>:</p>
<blockquote>
<p>Resolved as above :-)</p>
</blockquote>



<a name="222803379"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232541%20x64%20and%20aarch64%3A%20allow%20StructArgument.../near/222803379" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232541.20x64.20and.20aarch64.3A.20allow.20StructArgument.2E.2E.2E.html#222803379">(Jan 15 2021 at 00:07)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2541#pullrequestreview-568725382">PR Review</a>.</p>



<a name="222803385"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232541%20x64%20and%20aarch64%3A%20allow%20StructArgument.../near/222803385" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232541.20x64.20and.20aarch64.3A.20allow.20StructArgument.2E.2E.2E.html#222803385">(Jan 15 2021 at 00:07)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2541#pullrequestreview-568725411">PR Review</a>.</p>



<a name="222803386"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232541%20x64%20and%20aarch64%3A%20allow%20StructArgument.../near/222803386" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232541.20x64.20and.20aarch64.3A.20allow.20StructArgument.2E.2E.2E.html#222803386">(Jan 15 2021 at 00:07)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/2541#discussion_r557779325">PR Review Comment</a>:</p>
<blockquote>
<p>My reading of the <a href="https://github.com/ARM-software/abi-aa/blob/master/aapcs64/aapcs64.rst#parameter-passing-rules">aarch64 spec</a> is that on-stack args have 8-byte-aligned sizes; as far as I can tell the <a href="https://www.uclibc.org/docs/psABI-x86_64.pdf">x64 SystemV spec</a> also shows on-stack args broken down into "eightbytes". I've added an align-to-8 assert for both architectures.</p>
</blockquote>



<a name="222803394"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232541%20x64%20and%20aarch64%3A%20allow%20StructArgument.../near/222803394" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232541.20x64.20and.20aarch64.3A.20allow.20StructArgument.2E.2E.2E.html#222803394">(Jan 15 2021 at 00:07)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2541#pullrequestreview-568725447">PR Review</a>.</p>



<a name="222803395"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232541%20x64%20and%20aarch64%3A%20allow%20StructArgument.../near/222803395" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232541.20x64.20and.20aarch64.3A.20allow.20StructArgument.2E.2E.2E.html#222803395">(Jan 15 2021 at 00:07)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/2541#discussion_r557779379">PR Review Comment</a>:</p>
<blockquote>
<p>Yep, we need to be careful in exactly how we set up args and emit this call here, so I think it's best to open-code it.</p>
</blockquote>



<a name="222803727"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232541%20x64%20and%20aarch64%3A%20allow%20StructArgument.../near/222803727" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232541.20x64.20and.20aarch64.3A.20allow.20StructArgument.2E.2E.2E.html#222803727">(Jan 15 2021 at 00:13)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2541#pullrequestreview-568727593">PR Review</a>.</p>



<a name="222803728"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232541%20x64%20and%20aarch64%3A%20allow%20StructArgument.../near/222803728" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232541.20x64.20and.20aarch64.3A.20allow.20StructArgument.2E.2E.2E.html#222803728">(Jan 15 2021 at 00:13)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/2541#discussion_r557781262">PR Review Comment</a>:</p>
<blockquote>
<p>So I started down this path, but pulling on the string actually unravels a <em>lot</em> of things -- <code>emit_vm_call</code> takes a LowerCtx and emits directly, which we need to do because the caller-side ABI object that it uses requires this; but <code>gen_memcpy()</code> returns a list of instructions because we cannot parameterize on the <code>LowerCtx</code> in the callee-side ABI object, because it is used as a dyn trait. This is slightly unfortunate, to say the least. If you think it will be a problem in practice then I can do this, but it requires altering the caller-side stuff to use more Vecs. In practice I <em>think</em> this will be OK because: struct args will only show up in SystemV and Fastcall cases; in both cases we can handle three register args; no stack adjustment or other ABI stuff should be necessary. Thoughts?</p>
</blockquote>



<a name="222854683"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232541%20x64%20and%20aarch64%3A%20allow%20StructArgument.../near/222854683" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232541.20x64.20and.20aarch64.3A.20allow.20StructArgument.2E.2E.2E.html#222854683">(Jan 15 2021 at 13:10)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2541#pullrequestreview-569244873">PR Review</a>.</p>



<a name="222854684"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232541%20x64%20and%20aarch64%3A%20allow%20StructArgument.../near/222854684" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232541.20x64.20and.20aarch64.3A.20allow.20StructArgument.2E.2E.2E.html#222854684">(Jan 15 2021 at 13:10)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2541#discussion_r558296082">PR Review Comment</a>:</p>
<blockquote>
<p>Ah, didn't see the LowerCtx trait coming! Okay, I'm convinced that this shouldn't be a problem for Fastcall too, so we can keep this code like this. If there's a <code>call_conv</code> hanging around, could we assert it's either equal to <code>SystemV</code> or <code>Fastcall</code>, just for future-proofing?</p>
</blockquote>



<a name="222854864"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232541%20x64%20and%20aarch64%3A%20allow%20StructArgument.../near/222854864" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232541.20x64.20and.20aarch64.3A.20allow.20StructArgument.2E.2E.2E.html#222854864">(Jan 15 2021 at 13:12)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2541#pullrequestreview-569246094">PR Review</a>.</p>



<a name="222854867"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232541%20x64%20and%20aarch64%3A%20allow%20StructArgument.../near/222854867" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232541.20x64.20and.20aarch64.3A.20allow.20StructArgument.2E.2E.2E.html#222854867">(Jan 15 2021 at 13:12)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2541#discussion_r558297002">PR Review Comment</a>:</p>
<blockquote>
<p>I was looking for a way to document a bit better what this signature is about, and when it should be used in place of the Function's signature field. The newtype would make it semi-obvious, but it could be sufficient with a good comment here/on the getter too. Let's keep it as is.</p>
</blockquote>



<a name="222854986"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232541%20x64%20and%20aarch64%3A%20allow%20StructArgument.../near/222854986" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232541.20x64.20and.20aarch64.3A.20allow.20StructArgument.2E.2E.2E.html#222854986">(Jan 15 2021 at 13:13)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2541#pullrequestreview-569247015">PR Review</a>.</p>



<a name="222854987"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232541%20x64%20and%20aarch64%3A%20allow%20StructArgument.../near/222854987" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232541.20x64.20and.20aarch64.3A.20allow.20StructArgument.2E.2E.2E.html#222854987">(Jan 15 2021 at 13:13)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2541#discussion_r558297684">PR Review Comment</a>:</p>
<blockquote>
<blockquote>
<p>Good point; actually it could be not the first return value, so I've changed this to be more general and just find the StructReturn one (panic'ing if not present).</p>
</blockquote>
<p>Is there a test for this? (and if there's not, can you add one please?)</p>
</blockquote>



<a name="222863418"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232541%20x64%20and%20aarch64%3A%20allow%20StructArgument.../near/222863418" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232541.20x64.20and.20aarch64.3A.20allow.20StructArgument.2E.2E.2E.html#222863418">(Jan 15 2021 at 14:25)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2541#pullrequestreview-569263859">PR Review</a>.</p>



<a name="222863419"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232541%20x64%20and%20aarch64%3A%20allow%20StructArgument.../near/222863419" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232541.20x64.20and.20aarch64.3A.20allow.20StructArgument.2E.2E.2E.html#222863419">(Jan 15 2021 at 14:25)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2541#pullrequestreview-569263859">PR Review</a>.</p>



<a name="222863420"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232541%20x64%20and%20aarch64%3A%20allow%20StructArgument.../near/222863420" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232541.20x64.20and.20aarch64.3A.20allow.20StructArgument.2E.2E.2E.html#222863420">(Jan 15 2021 at 14:25)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2541#discussion_r558310519">PR Review Comment</a>:</p>
<blockquote>
<p>uber-nit: <code>unimplemented!</code> or <code>todo!</code> here?</p>
</blockquote>



<a name="222863421"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232541%20x64%20and%20aarch64%3A%20allow%20StructArgument.../near/222863421" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232541.20x64.20and.20aarch64.3A.20allow.20StructArgument.2E.2E.2E.html#222863421">(Jan 15 2021 at 14:25)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2541#discussion_r558314642">PR Review Comment</a>:</p>
<blockquote>
<p>nit: It really could be any pointer-typed temporary vreg here, right? This is only used to store the callee address, not an argument per se. It would require changing the signature of this function for a new temporary register. If your intent was to use one register, that happens to be fixed (because it's simpler than passing the temp) but while making sure it was unused by the other three, maybe rename the variable and add a comment here?</p>
</blockquote>



<a name="222863422"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232541%20x64%20and%20aarch64%3A%20allow%20StructArgument.../near/222863422" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232541.20x64.20and.20aarch64.3A.20allow.20StructArgument.2E.2E.2E.html#222863422">(Jan 15 2021 at 14:25)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2541#discussion_r558337592">PR Review Comment</a>:</p>
<blockquote>
<p>Can you add a test case with a call to a function that has two struct arguments, located at different offsets, please?</p>
</blockquote>



<a name="222863423"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232541%20x64%20and%20aarch64%3A%20allow%20StructArgument.../near/222863423" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232541.20x64.20and.20aarch64.3A.20allow.20StructArgument.2E.2E.2E.html#222863423">(Jan 15 2021 at 14:25)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2541#discussion_r558339560">PR Review Comment</a>:</p>
<blockquote>
<p>Just saw this TODO question: for the calling convention, there's actually <code>CallConv::for_libcall</code>. For the rest of the signature, we should assert in the <code>gen_memcpy</code> impl that the calling convention is one of a few known (e.g., not any of the <code>Baldrdash</code> ones).</p>
</blockquote>



<a name="222863424"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232541%20x64%20and%20aarch64%3A%20allow%20StructArgument.../near/222863424" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232541.20x64.20and.20aarch64.3A.20allow.20StructArgument.2E.2E.2E.html#222863424">(Jan 15 2021 at 14:25)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2541#discussion_r558317671">PR Review Comment</a>:</p>
<blockquote>
<p>Is there, like on x64, some helper we could use to abstract "the first register argument", etc.?</p>
</blockquote>



<a name="222863425"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232541%20x64%20and%20aarch64%3A%20allow%20StructArgument.../near/222863425" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232541.20x64.20and.20aarch64.3A.20allow.20StructArgument.2E.2E.2E.html#222863425">(Jan 15 2021 at 14:25)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2541#discussion_r558312458">PR Review Comment</a>:</p>
<blockquote>
<p>(Looks like <code>get_intreg_for_arg_system</code> will check for the calling convention, so we should be fine!)</p>
</blockquote>



<a name="223087212"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232541%20x64%20and%20aarch64%3A%20allow%20StructArgument.../near/223087212" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232541.20x64.20and.20aarch64.3A.20allow.20StructArgument.2E.2E.2E.html#223087212">(Jan 18 2021 at 07:12)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2541">PR #2541</a> from <code>struct-arg-ret</code> to <code>main</code>:</p>
<blockquote>
<p>This PR depends on #2538 and #2539 and includes those commits.</p>
<p>The StructReturn ABI is fairly simple at the codegen/isel level: we only<br>
need to take care to return the sret pointer as one of the return values<br>
if that wasn't specified in the initial function signature.</p>
<p>Struct arguments are a little more complex. A struct argument is stored<br>
as a chunk of memory in the stack-args space. However, the CLIF<br>
semantics are slightly special: on the caller side, the parameter passed<br>
in is a pointer to an arbitrary memory block, and we must memcpy this<br>
data to the on-stack struct-argument; and on the callee side, we provide<br>
a pointer to the passed-in struct-argument as the CLIF block param<br>
value.</p>
<p>This is necessary to support various ABIs other than Wasm, such as that<br>
of Rust (with the cg_clif codegen backend).<br>
</p>
</blockquote>



<a name="223087231"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232541%20x64%20and%20aarch64%3A%20allow%20StructArgument.../near/223087231" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232541.20x64.20and.20aarch64.3A.20allow.20StructArgument.2E.2E.2E.html#223087231">(Jan 18 2021 at 07:12)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2541#pullrequestreview-570216707">PR Review</a>.</p>



<a name="223087232"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232541%20x64%20and%20aarch64%3A%20allow%20StructArgument.../near/223087232" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232541.20x64.20and.20aarch64.3A.20allow.20StructArgument.2E.2E.2E.html#223087232">(Jan 18 2021 at 07:12)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/2541#discussion_r559354768">PR Review Comment</a>:</p>
<blockquote>
<p>Ah, that's more canonical, yes. Updated this and added asserts in x64/aarch64 <code>gen_memcpy()</code> that we aren't using a Baldrdash calling convention -- we should never be seeing struct args there anyway.</p>
</blockquote>



<a name="223087234"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232541%20x64%20and%20aarch64%3A%20allow%20StructArgument.../near/223087234" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232541.20x64.20and.20aarch64.3A.20allow.20StructArgument.2E.2E.2E.html#223087234">(Jan 18 2021 at 07:12)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2541#pullrequestreview-570216746">PR Review</a>.</p>



<a name="223087235"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232541%20x64%20and%20aarch64%3A%20allow%20StructArgument.../near/223087235" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232541.20x64.20and.20aarch64.3A.20allow.20StructArgument.2E.2E.2E.html#223087235">(Jan 18 2021 at 07:12)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/2541#discussion_r559354796">PR Review Comment</a>:</p>
<blockquote>
<p>Done!</p>
</blockquote>



<a name="223087239"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232541%20x64%20and%20aarch64%3A%20allow%20StructArgument.../near/223087239" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232541.20x64.20and.20aarch64.3A.20allow.20StructArgument.2E.2E.2E.html#223087239">(Jan 18 2021 at 07:12)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2541#pullrequestreview-570216768">PR Review</a>.</p>



<a name="223087240"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232541%20x64%20and%20aarch64%3A%20allow%20StructArgument.../near/223087240" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232541.20x64.20and.20aarch64.3A.20allow.20StructArgument.2E.2E.2E.html#223087240">(Jan 18 2021 at 07:12)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/2541#discussion_r559354811">PR Review Comment</a>:</p>
<blockquote>
<p>The aarch64 ABI impl is a bit simpler in this regard (because arg <code>i</code> is in X-reg <code>i</code>), so no helper is defined, but I've created named <code>let</code>-bindings to make this a bit clearer.</p>
</blockquote>



<a name="223087245"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232541%20x64%20and%20aarch64%3A%20allow%20StructArgument.../near/223087245" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232541.20x64.20and.20aarch64.3A.20allow.20StructArgument.2E.2E.2E.html#223087245">(Jan 18 2021 at 07:13)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2541#pullrequestreview-570216813">PR Review</a>.</p>



<a name="223087246"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232541%20x64%20and%20aarch64%3A%20allow%20StructArgument.../near/223087246" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232541.20x64.20and.20aarch64.3A.20allow.20StructArgument.2E.2E.2E.html#223087246">(Jan 18 2021 at 07:13)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/2541#discussion_r559354837">PR Review Comment</a>:</p>
<blockquote>
<p>Done!</p>
</blockquote>



<a name="223087256"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232541%20x64%20and%20aarch64%3A%20allow%20StructArgument.../near/223087256" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232541.20x64.20and.20aarch64.3A.20allow.20StructArgument.2E.2E.2E.html#223087256">(Jan 18 2021 at 07:13)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2541#pullrequestreview-570216848">PR Review</a>.</p>



<a name="223087257"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232541%20x64%20and%20aarch64%3A%20allow%20StructArgument.../near/223087257" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232541.20x64.20and.20aarch64.3A.20allow.20StructArgument.2E.2E.2E.html#223087257">(Jan 18 2021 at 07:13)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/2541#discussion_r559354861">PR Review Comment</a>:</p>
<blockquote>
<p>Done!</p>
</blockquote>



<a name="223089230"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232541%20x64%20and%20aarch64%3A%20allow%20StructArgument.../near/223089230" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232541.20x64.20and.20aarch64.3A.20allow.20StructArgument.2E.2E.2E.html#223089230">(Jan 18 2021 at 07:50)</a>:</h4>
<p>cfallin merged <a href="https://github.com/bytecodealliance/wasmtime/pull/2541">PR #2541</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>