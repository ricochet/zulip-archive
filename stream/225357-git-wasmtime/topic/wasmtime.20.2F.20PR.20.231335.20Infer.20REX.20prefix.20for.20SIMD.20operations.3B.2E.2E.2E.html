<html>
<head><meta charset="utf-8"><title>wasmtime / PR #1335 Infer REX prefix for SIMD operations;... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231335.20Infer.20REX.20prefix.20for.20SIMD.20operations.3B.2E.2E.2E.html">wasmtime / PR #1335 Infer REX prefix for SIMD operations;...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="190800011"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231335%20Infer%20REX%20prefix%20for%20SIMD%20operations%3B.../near/190800011" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231335.20Infer.20REX.20prefix.20for.20SIMD.20operations.3B.2E.2E.2E.html#190800011">(Mar 17 2020 at 01:28)</a>:</h4>
<p>abrown opened <a href="https://github.com/bytecodealliance/wasmtime/pull/1335" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1335">PR #1335</a> from <code>infer-rex</code> to <code>master</code>:</p>
<blockquote>
<ul>
<li>Convert recipes to have necessary size calculator</li>
<li>Add a missing binemit function, <code>put_dynrexmp3</code></li>
<li>Modify the meta-encodings of x86 SIMD instructions to use <code>infer_rex()</code>, mostly through the <code>enc_both_inferred()</code> helper</li>
<li>Fix up tests that previously always emitted a REX prefix</li>
</ul>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md" target="_blank" title="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
</blockquote>



<a name="190800016"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231335%20Infer%20REX%20prefix%20for%20SIMD%20operations%3B.../near/190800016" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231335.20Infer.20REX.20prefix.20for.20SIMD.20operations.3B.2E.2E.2E.html#190800016">(Mar 17 2020 at 01:28)</a>:</h4>
<p><strong>abrown</strong> requested <a href="https://github.com/bnjbvr" target="_blank" title="https://github.com/bnjbvr">bnjbvr</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/1335" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1335">PR #1335</a>.</p>



<a name="190800023"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231335%20Infer%20REX%20prefix%20for%20SIMD%20operations%3B.../near/190800023" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231335.20Infer.20REX.20prefix.20for.20SIMD.20operations.3B.2E.2E.2E.html#190800023">(Mar 17 2020 at 01:28)</a>:</h4>
<p><strong>abrown</strong> requested <a href="https://github.com/bnjbvr" target="_blank" title="https://github.com/bnjbvr">bnjbvr</a>, and <a href="https://github.com/iximeow" target="_blank" title="https://github.com/iximeow">iximeow</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/1335" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1335">PR #1335</a>.</p>



<a name="190873985"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231335%20Infer%20REX%20prefix%20for%20SIMD%20operations%3B.../near/190873985" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231335.20Infer.20REX.20prefix.20for.20SIMD.20operations.3B.2E.2E.2E.html#190873985">(Mar 17 2020 at 16:26)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1335#pullrequestreview-376169193" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1335#pullrequestreview-376169193">PR Review</a>.</p>



<a name="190873987"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231335%20Infer%20REX%20prefix%20for%20SIMD%20operations%3B.../near/190873987" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231335.20Infer.20REX.20prefix.20for.20SIMD.20operations.3B.2E.2E.2E.html#190873987">(Mar 17 2020 at 16:26)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1335#pullrequestreview-376169193" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1335#pullrequestreview-376169193">PR Review</a>.</p>



<a name="190873989"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231335%20Infer%20REX%20prefix%20for%20SIMD%20operations%3B.../near/190873989" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231335.20Infer.20REX.20prefix.20for.20SIMD.20operations.3B.2E.2E.2E.html#190873989">(Mar 17 2020 at 16:26)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/1335#discussion_r393784241" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1335#discussion_r393784241">PR Review Comment</a>:</p>
<blockquote>
<p>As discussed, whenever we need the REX.W bit to be set, we can just use <code>rex()</code> instead of <code>infer_rex()</code>, so it avoids the runtime decision.</p>
</blockquote>



<a name="190873990"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231335%20Infer%20REX%20prefix%20for%20SIMD%20operations%3B.../near/190873990" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231335.20Infer.20REX.20prefix.20for.20SIMD.20operations.3B.2E.2E.2E.html#190873990">(Mar 17 2020 at 16:26)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/1335#discussion_r393785559" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1335#discussion_r393785559">PR Review Comment</a>:</p>
<blockquote>
<p>ditto here</p>
</blockquote>



<a name="190873991"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231335%20Infer%20REX%20prefix%20for%20SIMD%20operations%3B.../near/190873991" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231335.20Infer.20REX.20prefix.20for.20SIMD.20operations.3B.2E.2E.2E.html#190873991">(Mar 17 2020 at 16:26)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/1335#discussion_r393786362" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1335#discussion_r393786362">PR Review Comment</a>:</p>
<blockquote>
<p>Do we need the clone on <code>template.clone()</code>? <code>infer_rex</code> takes <code>&amp;self</code> and returns a copy, if I'm not mistaken.</p>
</blockquote>



<a name="190873992"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231335%20Infer%20REX%20prefix%20for%20SIMD%20operations%3B.../near/190873992" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231335.20Infer.20REX.20prefix.20for.20SIMD.20operations.3B.2E.2E.2E.html#190873992">(Mar 17 2020 at 16:26)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/1335#discussion_r393803067" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1335#discussion_r393803067">PR Review Comment</a>:</p>
<blockquote>
<p>ditto here</p>
</blockquote>



<a name="190873993"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231335%20Infer%20REX%20prefix%20for%20SIMD%20operations%3B.../near/190873993" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231335.20Infer.20REX.20prefix.20for.20SIMD.20operations.3B.2E.2E.2E.html#190873993">(Mar 17 2020 at 16:26)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/1335#discussion_r393790686" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1335#discussion_r393790686">PR Review Comment</a>:</p>
<blockquote>
<p>nit: ditto here</p>
</blockquote>



<a name="190873994"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231335%20Infer%20REX%20prefix%20for%20SIMD%20operations%3B.../near/190873994" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231335.20Infer.20REX.20prefix.20for.20SIMD.20operations.3B.2E.2E.2E.html#190873994">(Mar 17 2020 at 16:26)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/1335#discussion_r393786586" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1335#discussion_r393786586">PR Review Comment</a>:</p>
<blockquote>
<p>Ditto here.</p>
</blockquote>



<a name="190873995"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231335%20Infer%20REX%20prefix%20for%20SIMD%20operations%3B.../near/190873995" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231335.20Infer.20REX.20prefix.20for.20SIMD.20operations.3B.2E.2E.2E.html#190873995">(Mar 17 2020 at 16:26)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/1335#discussion_r393806720" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1335#discussion_r393806720">PR Review Comment</a>:</p>
<blockquote>
<p>If that's not too much hassle, can you, for each different recipe involved, duplicate the test with a register that would require a REX prefix, please?</p>
</blockquote>



<a name="190874681"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231335%20Infer%20REX%20prefix%20for%20SIMD%20operations%3B.../near/190874681" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231335.20Infer.20REX.20prefix.20for.20SIMD.20operations.3B.2E.2E.2E.html#190874681">(Mar 17 2020 at 16:30)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1335#pullrequestreview-376203161" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1335#pullrequestreview-376203161">PR Review</a>.</p>



<a name="190874682"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231335%20Infer%20REX%20prefix%20for%20SIMD%20operations%3B.../near/190874682" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231335.20Infer.20REX.20prefix.20for.20SIMD.20operations.3B.2E.2E.2E.html#190874682">(Mar 17 2020 at 16:30)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/1335#discussion_r393810652" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1335#discussion_r393810652">PR Review Comment</a>:</p>
<blockquote>
<p>I will change this and I opened #1342 to avoid this type of thing altogether.</p>
</blockquote>



<a name="191006897"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231335%20Infer%20REX%20prefix%20for%20SIMD%20operations%3B.../near/191006897" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231335.20Infer.20REX.20prefix.20for.20SIMD.20operations.3B.2E.2E.2E.html#191006897">(Mar 18 2020 at 16:35)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1335" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1335">PR #1335</a> from <code>infer-rex</code> to <code>master</code>:</p>
<blockquote>
<ul>
<li>Convert recipes to have necessary size calculator</li>
<li>Add a missing binemit function, <code>put_dynrexmp3</code></li>
<li>Modify the meta-encodings of x86 SIMD instructions to use <code>infer_rex()</code>, mostly through the <code>enc_both_inferred()</code> helper</li>
<li>Fix up tests that previously always emitted a REX prefix</li>
</ul>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md" target="_blank" title="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
</blockquote>



<a name="191007649"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231335%20Infer%20REX%20prefix%20for%20SIMD%20operations%3B.../near/191007649" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231335.20Infer.20REX.20prefix.20for.20SIMD.20operations.3B.2E.2E.2E.html#191007649">(Mar 18 2020 at 16:40)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1335#pullrequestreview-377044054" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1335#pullrequestreview-377044054">PR Review</a>.</p>



<a name="191007650"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231335%20Infer%20REX%20prefix%20for%20SIMD%20operations%3B.../near/191007650" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231335.20Infer.20REX.20prefix.20for.20SIMD.20operations.3B.2E.2E.2E.html#191007650">(Mar 18 2020 at 16:40)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/1335#discussion_r394487814" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1335#discussion_r394487814">PR Review Comment</a>:</p>
<blockquote>
<p>Ok, I added some REX-inducing tests; it's not 100% coverage but that is a rather high bar with all of the variations of these instructions.</p>
</blockquote>



<a name="191012238"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231335%20Infer%20REX%20prefix%20for%20SIMD%20operations%3B.../near/191012238" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231335.20Infer.20REX.20prefix.20for.20SIMD.20operations.3B.2E.2E.2E.html#191012238">(Mar 18 2020 at 17:12)</a>:</h4>
<p>abrown merged <a href="https://github.com/bytecodealliance/wasmtime/pull/1335" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1335">PR #1335</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>