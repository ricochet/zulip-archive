<html>
<head><meta charset="utf-8"><title>wasmtime / PR #7728 Add more necessary linkers to wasi-http · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237728.20Add.20more.20necessary.20linkers.20to.20wasi-http.html">wasmtime / PR #7728 Add more necessary linkers to wasi-http</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="410098554"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237728%20Add%20more%20necessary%20linkers%20to%20wasi-http/near/410098554" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237728.20Add.20more.20necessary.20linkers.20to.20wasi-http.html#410098554">(Dec 27 2023 at 03:38)</a>:</h4>
<p>iawia002 opened <a href="https://github.com/bytecodealliance/wasmtime/pull/7728">PR #7728</a> from <code>iawia002:wasi-http-linker</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>When I attempt to run the <a href="https://github.com/sunfishcode/hello-wasi-http">hello-wasi-http</a> example using wasmtime 16, I encounter the following error(which did not occur in previous versions):</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">serve</span><span class="w"> </span><span class="n">hello_wasi_http</span><span class="p">.</span><span class="n">wasm</span>

<span class="n">Error</span>: <span class="nc">import</span><span class="w"> </span><span class="err">`</span><span class="n">wasi</span>:<span class="nc">cli</span><span class="o">/</span><span class="n">environment</span><span class="o">@</span><span class="mf">0.2.0</span><span class="o">-</span><span class="n">rc</span><span class="o">-</span><span class="mi">2023</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">05</span><span class="err">`</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">wrong</span><span class="w"> </span><span class="k">type</span>

<span class="nc">Caused</span><span class="w"> </span><span class="n">by</span>:
    <span class="mi">0</span>: <span class="nc">instance</span><span class="w"> </span><span class="n">export</span><span class="w"> </span><span class="err">`</span><span class="n">get</span><span class="o">-</span><span class="n">environment</span><span class="err">`</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">wrong</span><span class="w"> </span><span class="k">type</span>
    <span class="mi">1</span>: <span class="nc">expected</span><span class="w"> </span><span class="n">func</span><span class="w"> </span><span class="n">found</span><span class="w"> </span><span class="n">nothing</span>
</code></pre></div>
<p>I realize that this may be related to PR #7597, where we might have trimmed too much "world" to the point where a simple HTTP hello world example cannot run. So, this patch adds some content, and now the example can run successfully:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">wasmtime</span><span class="w"> </span><span class="n">serve</span><span class="w"> </span><span class="n">hello_wasi_http</span><span class="p">.</span><span class="n">wasm</span>

<span class="n">Serving</span><span class="w"> </span><span class="n">HTTP</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">http</span>:<span class="c1">//0.0.0.0:8080/</span>
</code></pre></div>
<p>Related: #7716 </p>
</blockquote>



<a name="410098556"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237728%20Add%20more%20necessary%20linkers%20to%20wasi-http/near/410098556" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237728.20Add.20more.20necessary.20linkers.20to.20wasi-http.html#410098556">(Dec 27 2023 at 03:38)</a>:</h4>
<p><strong>iawia002</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/7728">PR #7728</a>.</p>



<a name="410098557"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237728%20Add%20more%20necessary%20linkers%20to%20wasi-http/near/410098557" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237728.20Add.20more.20necessary.20linkers.20to.20wasi-http.html#410098557">(Dec 27 2023 at 03:38)</a>:</h4>
<p><strong>iawia002</strong> requested <a href="https://github.com/fitzgen">fitzgen</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/7728">PR #7728</a>.</p>



<a name="410862711"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237728%20Add%20more%20necessary%20linkers%20to%20wasi-http/near/410862711" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237728.20Add.20more.20necessary.20linkers.20to.20wasi-http.html#410862711">(Jan 02 2024 at 15:27)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/7728#issuecomment-1874172137">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/7728">PR #7728</a>:</p>
<blockquote>
<p>Thanks for the PR, but these interfaces are all <a href="https://github.com/WebAssembly/wasi-http/blob/main/wit/proxy.wit">explicitly missing from the standard <code>proxy</code> world</a>. The <code>wasmtime serve</code> subcommand <a href="https://github.com/bytecodealliance/wasmtime/blob/b583c54fda13b53dea362861125dd1e2ced1381d/src/commands/serve.rs#L202-L216">has an <code>-Scommon</code> flag</a> to enable the interfaces in an opt-in basis. Otherwise though this was an intentional behavior change from <a href="https://github.com/bytecodealliance/wasmtime/pull/7597">https://github.com/bytecodealliance/wasmtime/pull/7597</a></p>
</blockquote>



<a name="410945667"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237728%20Add%20more%20necessary%20linkers%20to%20wasi-http/near/410945667" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237728.20Add.20more.20necessary.20linkers.20to.20wasi-http.html#410945667">(Jan 03 2024 at 02:48)</a>:</h4>
<p>iawia002 <a href="https://github.com/bytecodealliance/wasmtime/pull/7728#issuecomment-1874786592">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/7728">PR #7728</a>:</p>
<blockquote>
<p>OK, but I'm getting a little confused, I know <code>-Scommon</code> flag will make it work because it adds all the linkers, in other words, can I say <code>wasmtime serve</code> won't work without the <code>-Scommon</code> flag? Since I'm just running the basic hello world example.</p>
<blockquote>
<p>but these interfaces are all <a href="https://github.com/WebAssembly/wasi-http/blob/main/wit/proxy.wit">explicitly missing from the standard proxy world</a>.</p>
</blockquote>
<p>So do we count this as an issue? I'm not familiar with this, I can't figure out why the proxy world needs those.</p>
</blockquote>



<a name="411056162"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237728%20Add%20more%20necessary%20linkers%20to%20wasi-http/near/411056162" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237728.20Add.20more.20necessary.20linkers.20to.20wasi-http.html#411056162">(Jan 03 2024 at 18:02)</a>:</h4>
<p>pchickey <a href="https://github.com/bytecodealliance/wasmtime/pull/7728#issuecomment-1875760205">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/7728">PR #7728</a>:</p>
<blockquote>
<p>The issue is that the <a href="https://github.com/sunfishcode/hello-wasi-http">https://github.com/sunfishcode/hello-wasi-http</a> instructions aren't up to date with wasmtime 16, which requires passing in the <code>-Scommon</code> flag. Please file an issue or PR over there to add that command line flag.</p>
</blockquote>



<a name="411120861"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237728%20Add%20more%20necessary%20linkers%20to%20wasi-http/near/411120861" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237728.20Add.20more.20necessary.20linkers.20to.20wasi-http.html#411120861">(Jan 04 2024 at 03:36)</a>:</h4>
<p>iawia002 <a href="https://github.com/bytecodealliance/wasmtime/pull/7728#issuecomment-1876263472">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/7728">PR #7728</a>:</p>
<blockquote>
<blockquote>
<p>The issue is that the <a href="https://github.com/sunfishcode/hello-wasi-http">https://github.com/sunfishcode/hello-wasi-http</a> instructions aren't up to date with wasmtime 16, which requires passing in the <code>-Scommon</code> flag. Please file an issue or PR over there to add that command line flag.</p>
</blockquote>
<p>Actually, I made some updates based on hello-wasi-http to adapt to wasmtime 16. I updated <a href="https://github.com/bytecodealliance/cargo-component">cargo-component</a> version to <code>0.6.0</code> and updated <code>wasi:http/proxy</code> to <code>0.2.0-rc-2023-12-05</code>, if you use the original hello-wasi-http directly, even if the <code>-Scommon</code> flag is added, it still cannot run (because the wit definition does not match):</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">wasmtime</span><span class="w"> </span><span class="n">serve</span><span class="w"> </span><span class="o">-</span><span class="n">Scommon</span><span class="w"> </span><span class="n">hello_wasi_http</span><span class="p">.</span><span class="n">wasm</span>
<span class="n">Error</span>: <span class="nc">import</span><span class="w"> </span><span class="err">`</span><span class="n">wasi</span>:<span class="nc">cli</span><span class="o">/</span><span class="n">stdout</span><span class="o">@</span><span class="mf">0.2.0</span><span class="o">-</span><span class="n">rc</span><span class="o">-</span><span class="mi">2023</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">18</span><span class="err">`</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">wrong</span><span class="w"> </span><span class="k">type</span>

<span class="nc">Caused</span><span class="w"> </span><span class="n">by</span>:
    <span class="mi">0</span>: <span class="nc">instance</span><span class="w"> </span><span class="n">export</span><span class="w"> </span><span class="err">`</span><span class="n">get</span><span class="o">-</span><span class="n">stdout</span><span class="err">`</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">wrong</span><span class="w"> </span><span class="k">type</span>
    <span class="mi">1</span>: <span class="nc">expected</span><span class="w"> </span><span class="n">func</span><span class="w"> </span><span class="n">found</span><span class="w"> </span><span class="n">nothing</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="411131439"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237728%20Add%20more%20necessary%20linkers%20to%20wasi-http/near/411131439" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237728.20Add.20more.20necessary.20linkers.20to.20wasi-http.html#411131439">(Jan 04 2024 at 05:37)</a>:</h4>
<p>iawia002 edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/7728#issuecomment-1876263472">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/7728">PR #7728</a>:</p>
<blockquote>
<blockquote>
<p>The issue is that the <a href="https://github.com/sunfishcode/hello-wasi-http">https://github.com/sunfishcode/hello-wasi-http</a> instructions aren't up to date with wasmtime 16, which requires passing in the <code>-Scommon</code> flag. Please file an issue or PR over there to add that command line flag.</p>
</blockquote>
<p>Actually, I made some updates based on hello-wasi-http to adapt wasmtime 16. I updated <a href="https://github.com/bytecodealliance/cargo-component">cargo-component</a> version to <code>0.6.0</code> and updated <code>wasi:http/proxy</code> to <code>0.2.0-rc-2023-12-05</code>, if you use the original hello-wasi-http directly, even if the <code>-Scommon</code> flag is added, it still cannot run (because the wit definition does not match):</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">serve</span><span class="w"> </span><span class="o">-</span><span class="n">Scommon</span><span class="w"> </span><span class="n">hello_wasi_http</span><span class="p">.</span><span class="n">wasm</span>
<span class="n">Error</span>: <span class="nc">import</span><span class="w"> </span><span class="err">`</span><span class="n">wasi</span>:<span class="nc">cli</span><span class="o">/</span><span class="n">stdout</span><span class="o">@</span><span class="mf">0.2.0</span><span class="o">-</span><span class="n">rc</span><span class="o">-</span><span class="mi">2023</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">18</span><span class="err">`</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">wrong</span><span class="w"> </span><span class="k">type</span>

<span class="nc">Caused</span><span class="w"> </span><span class="n">by</span>:
    <span class="mi">0</span>: <span class="nc">instance</span><span class="w"> </span><span class="n">export</span><span class="w"> </span><span class="err">`</span><span class="n">get</span><span class="o">-</span><span class="n">stdout</span><span class="err">`</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">wrong</span><span class="w"> </span><span class="k">type</span>
    <span class="mi">1</span>: <span class="nc">expected</span><span class="w"> </span><span class="n">func</span><span class="w"> </span><span class="n">found</span><span class="w"> </span><span class="n">nothing</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="411135098"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237728%20Add%20more%20necessary%20linkers%20to%20wasi-http/near/411135098" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237728.20Add.20more.20necessary.20linkers.20to.20wasi-http.html#411135098">(Jan 04 2024 at 06:24)</a>:</h4>
<p>iawia002 <a href="https://github.com/bytecodealliance/wasmtime/pull/7728#issuecomment-1876459486">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/7728">PR #7728</a>:</p>
<blockquote>
<p>My code: <a href="https://github.com/iawia002/hello-wasi-http/tree/adapt-wasmtime-16">https://github.com/iawia002/hello-wasi-http/tree/adapt-wasmtime-16</a><br>
The diff (basically only version and dependency updates): <a href="https://github.com/iawia002/hello-wasi-http/commit/8fa967735f40988badf3a473459cb3e4c9cb8595">https://github.com/iawia002/hello-wasi-http/commit/8fa967735f40988badf3a473459cb3e4c9cb8595</a><br>
Compiled wasm file: <a href="https://github.com/bytecodealliance/wasmtime/files/13826925/hello_wasi_http.wasm.zip">hello_wasi_http.wasm.zip</a></p>
</blockquote>



<a name="411221245"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237728%20Add%20more%20necessary%20linkers%20to%20wasi-http/near/411221245" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237728.20Add.20more.20necessary.20linkers.20to.20wasi-http.html#411221245">(Jan 04 2024 at 16:27)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/7728#issuecomment-1877392464">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/7728">PR #7728</a>:</p>
<blockquote>
<p>It looks like you may be running into versioning issues, so I'd recommend double-checking that the adapter in use and the Wasmtime in use are from the same version. I'll also point out that there's an <a href="https://github.com/bytecodealliance/wasmtime/releases/download/v16.0.0/wasi_snapshot_preview1.proxy.wasm">adapter specific to a proxy</a> which avoids the need for <code>-Scommon</code></p>
</blockquote>



<a name="411295232"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237728%20Add%20more%20necessary%20linkers%20to%20wasi-http/near/411295232" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237728.20Add.20more.20necessary.20linkers.20to.20wasi-http.html#411295232">(Jan 05 2024 at 01:58)</a>:</h4>
<p>iawia002 <a href="https://github.com/bytecodealliance/wasmtime/pull/7728#issuecomment-1878006794">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/7728">PR #7728</a>:</p>
<blockquote>
<p>I'm using wasmtime 16 and <a href="https://github.com/bytecodealliance/cargo-component/releases/tag/v0.6.0">cargo-component 0.6.0</a> which adapts wasmtime 16 and <code>wasi:http/proxy@0.2.0-rc-2023-12-05</code> which exactly the same with <a href="https://github.com/bytecodealliance/wasmtime/tree/release-16.0.0/crates/wasi-http/wit/deps">wit definition in wasmtime 16</a>.</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="o">-</span><span class="n">V</span>
<span class="n">wasmtime</span><span class="o">-</span><span class="n">cli</span><span class="w"> </span><span class="mf">16.0.0</span><span class="w"> </span><span class="p">(</span><span class="mi">6613</span><span class="n">acd1e</span><span class="w"> </span><span class="mi">2023</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">20</span><span class="p">)</span>
</code></pre></div>
<p>So I think I've taken care of versioning issues.</p>
</blockquote>



<a name="411398182"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237728%20Add%20more%20necessary%20linkers%20to%20wasi-http/near/411398182" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237728.20Add.20more.20necessary.20linkers.20to.20wasi-http.html#411398182">(Jan 05 2024 at 16:39)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/7728#issuecomment-1878956972">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/7728">PR #7728</a>:</p>
<blockquote>
<p>Are you still getting an error about <code>wasi:cli/stdout@0.2.0-rc-2023-10-18</code>? If so that means there's a versioning problem somewhere because 2023-10-18 is a more historical version than Wasmtime 16.</p>
</blockquote>



<a name="411463697"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237728%20Add%20more%20necessary%20linkers%20to%20wasi-http/near/411463697" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237728.20Add.20more.20necessary.20linkers.20to.20wasi-http.html#411463697">(Jan 06 2024 at 01:58)</a>:</h4>
<p>iawia002 <a href="https://github.com/bytecodealliance/wasmtime/pull/7728#issuecomment-1879494568">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/7728">PR #7728</a>:</p>
<blockquote>
<p>Oops, @alexcrichton I think you misunderstood, @pchickey says I'm encountering this issue due to the  <a href="https://github.com/sunfishcode/hello-wasi-http">https://github.com/sunfishcode/hello-wasi-http</a> not adapting with wasmtime 16, I'm trying to explain to you that I'm not using the original hello-wasi-http example and I did some update to make it adapt with wasmtime 16, but even I make those updates, I'm still encountering the issue in the PR description.</p>
<p>Using <a href="https://github.com/sunfishcode/hello-wasi-http">https://github.com/sunfishcode/hello-wasi-http</a>, with or without <code>-Scommon</code> flag, we'll encounter this error:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">serve</span><span class="w"> </span><span class="o">-</span><span class="n">Scommon</span><span class="w"> </span><span class="n">hello_wasi_http</span><span class="p">.</span><span class="n">wasm</span>
<span class="n">Error</span>: <span class="nc">import</span><span class="w"> </span><span class="err">`</span><span class="n">wasi</span>:<span class="nc">cli</span><span class="o">/</span><span class="n">stdout</span><span class="o">@</span><span class="mf">0.2.0</span><span class="o">-</span><span class="n">rc</span><span class="o">-</span><span class="mi">2023</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">18</span><span class="err">`</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">wrong</span><span class="w"> </span><span class="k">type</span>

<span class="nc">Caused</span><span class="w"> </span><span class="n">by</span>:
    <span class="mi">0</span>: <span class="nc">instance</span><span class="w"> </span><span class="n">export</span><span class="w"> </span><span class="err">`</span><span class="n">get</span><span class="o">-</span><span class="n">stdout</span><span class="err">`</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">wrong</span><span class="w"> </span><span class="k">type</span>
    <span class="mi">1</span>: <span class="nc">expected</span><span class="w"> </span><span class="n">func</span><span class="w"> </span><span class="n">found</span><span class="w"> </span><span class="n">nothing</span>
</code></pre></div>
<p>Using <a href="https://github.com/iawia002/hello-wasi-http/tree/adapt-wasmtime-16">https://github.com/iawia002/hello-wasi-http/tree/adapt-wasmtime-16</a> which adapts wasmtime 16, with <code>-Scommon</code> flag, it works, but without it, we'll encounter this error in the PR description:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">serve</span><span class="w"> </span><span class="n">hello_wasi_http</span><span class="p">.</span><span class="n">wasm</span>

<span class="n">Error</span>: <span class="nc">import</span><span class="w"> </span><span class="err">`</span><span class="n">wasi</span>:<span class="nc">cli</span><span class="o">/</span><span class="n">environment</span><span class="o">@</span><span class="mf">0.2.0</span><span class="o">-</span><span class="n">rc</span><span class="o">-</span><span class="mi">2023</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">05</span><span class="err">`</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">wrong</span><span class="w"> </span><span class="k">type</span>

<span class="nc">Caused</span><span class="w"> </span><span class="n">by</span>:
    <span class="mi">0</span>: <span class="nc">instance</span><span class="w"> </span><span class="n">export</span><span class="w"> </span><span class="err">`</span><span class="n">get</span><span class="o">-</span><span class="n">environment</span><span class="err">`</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">wrong</span><span class="w"> </span><span class="k">type</span>
    <span class="mi">1</span>: <span class="nc">expected</span><span class="w"> </span><span class="n">func</span><span class="w"> </span><span class="n">found</span><span class="w"> </span><span class="n">nothing</span>
</code></pre></div>
<p>Though it will work with <code>-Scommon</code> flag, I still want to ask the same question from my previous comments:</p>
<blockquote>
<p>I know <code>-Scommon</code> flag will make it work because it adds all the linkers, in other words, can I say <code>wasmtime serve</code> won't work without the <code>-Scommon</code> flag? Since I'm just running the basic hello world example.</p>
</blockquote>
</blockquote>



<a name="411759088"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237728%20Add%20more%20necessary%20linkers%20to%20wasi-http/near/411759088" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237728.20Add.20more.20necessary.20linkers.20to.20wasi-http.html#411759088">(Jan 08 2024 at 15:19)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/7728#issuecomment-1881213026">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/7728">PR #7728</a>:</p>
<blockquote>
<p>This all boils down to the adapter you're using. If you use the <code>*.reactor.wasm</code> adapter then yes that won't work for <code>wasmtime serve</code> because it's not intended to work with <code>wasmtime serve</code>. If you use <code>*.proxy.wasm</code> then it will work with <code>wasmtime serve</code> because it's intended to work with the subcommand.</p>
<p>What you're basically running into here is difficulties and road bumps in how a component is built. This doesn't have all that much to do with the runtime per se. This is definitely something we need more documentation and guidance on, and we're doing our best on that.</p>
</blockquote>



<a name="412872987"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237728%20Add%20more%20necessary%20linkers%20to%20wasi-http/near/412872987" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237728.20Add.20more.20necessary.20linkers.20to.20wasi-http.html#412872987">(Jan 15 2024 at 02:05)</a>:</h4>
<p>iawia002 closed without merge <a href="https://github.com/bytecodealliance/wasmtime/pull/7728">PR #7728</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>