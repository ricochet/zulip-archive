<html>
<head><meta charset="utf-8"><title>wasmtime / issue #9426 Wasm component module debugging - ... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239426.20Wasm.20component.20module.20debugging.20-.20.2E.2E.2E.html">wasmtime / issue #9426 Wasm component module debugging - ...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="475929463"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239426%20Wasm%20component%20module%20debugging%20-%20.../near/475929463" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239426.20Wasm.20component.20module.20debugging.20-.20.2E.2E.2E.html#475929463">(Oct 09 2024 at 18:19)</a>:</h4>
<p>ggjjj opened <a href="https://github.com/bytecodealliance/wasmtime/issues/9426">issue #9426</a>:</p>
<blockquote>
<p><a href="https://github.com/bytecodealliance/wasm-tools/issues/1854">https://github.com/bytecodealliance/wasm-tools/issues/1854</a> </p>
<p>I am using a rust application that launches the wasmtime with debug_info() set to true and loads a WASM module that implements component module. </p>
<p>I use wasm-tools to get the module adapted to wasi by<br>
    wasm-tools component new ./target/wasm32-wasip1/debug/module1.wasm -o ./tests/data/wasm-modules/processor-module1-$(VERSION).wasm --adapt wasi_snapshot_preview1.reactor.wasm</p>
<p>I also confirmed that the <code>wasm-tools objdump</code> to see that the debug_info information exists.</p>
<p>now once I launch the debugger for the rust application, I am only able to step into a <code>call()</code> function and but not in the wasm module source code. </p>
<p>is there any other step am I missing?</p>
</blockquote>



<a name="475929584"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239426%20Wasm%20component%20module%20debugging%20-%20.../near/475929584" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239426.20Wasm.20component.20module.20debugging.20-.20.2E.2E.2E.html#475929584">(Oct 09 2024 at 18:20)</a>:</h4>
<p>ggjjj <a href="https://github.com/bytecodealliance/wasmtime/issues/9426#issuecomment-2402990341">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9426">issue #9426</a>:</p>
<blockquote>
<p>Configuration of wasmtime engine</p>
<p><code>let mut engine_config = Config::new();
    engine_config
        .debug_info(true)
        .cranelift_opt_level(OptLevel::None)
        .wasm_component_model(true);</code></p>
</blockquote>



<a name="475929669"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239426%20Wasm%20component%20module%20debugging%20-%20.../near/475929669" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239426.20Wasm.20component.20module.20debugging.20-.20.2E.2E.2E.html#475929669">(Oct 09 2024 at 18:20)</a>:</h4>
<p>ggjjj <a href="https://github.com/bytecodealliance/wasmtime/issues/9426#issuecomment-2402991503">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9426">issue #9426</a>:</p>
<blockquote>
<p><code>wasm-tools objdump</code> of the module1 in question</p>
<p><a href="https://github.com/bytecodealliance/wasm-tools/issues/1854#issuecomment-2400748393">https://github.com/bytecodealliance/wasm-tools/issues/1854#issuecomment-2400748393</a> </p>
</blockquote>



<a name="475929741"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239426%20Wasm%20component%20module%20debugging%20-%20.../near/475929741" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239426.20Wasm.20component.20module.20debugging.20-.20.2E.2E.2E.html#475929741">(Oct 09 2024 at 18:21)</a>:</h4>
<p>ggjjj edited <a href="https://github.com/bytecodealliance/wasmtime/issues/9426">issue #9426</a>:</p>
<blockquote>
<p><a href="https://github.com/bytecodealliance/wasm-tools/issues/1854">https://github.com/bytecodealliance/wasm-tools/issues/1854</a> </p>
<p>I am using a rust application that launches the wasmtime with debug_info() set to true and loads a WASM module that implements component module. </p>
<p>I use wasm-tools to get the module adapted to wasi by<br>
<code>wasm-tools component new ./target/wasm32-wasip1/debug/module1.wasm -o ./tests/data/wasm-modules/processor-module1-$(VERSION).wasm --adapt wasi_snapshot_preview1.reactor.wasm</code></p>
<p>I also confirmed that the <code>wasm-tools objdump</code> to see that the debug_info information exists.</p>
<p>now once I launch the debugger for the rust application, I am only able to step into a <code>call()</code> function and but not in the wasm module source code. </p>
<p>is there any other step am I missing?</p>
</blockquote>



<a name="475932211"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239426%20Wasm%20component%20module%20debugging%20-%20.../near/475932211" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239426.20Wasm.20component.20module.20debugging.20-.20.2E.2E.2E.html#475932211">(Oct 09 2024 at 18:37)</a>:</h4>
<p>ggjjj <a href="https://github.com/bytecodealliance/wasmtime/issues/9426#issuecomment-2403021143">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9426">issue #9426</a>:</p>
<blockquote>
<p>Do I need to include this feature   "debug-builtins" in wasmtime crate to enable the debug symbols?</p>
</blockquote>



<a name="475932628"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239426%20Wasm%20component%20module%20debugging%20-%20.../near/475932628" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239426.20Wasm.20component.20module.20debugging.20-.20.2E.2E.2E.html#475932628">(Oct 09 2024 at 18:40)</a>:</h4>
<p>ggjjj <a href="https://github.com/bytecodealliance/wasmtime/issues/9426#issuecomment-2403036906">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9426">issue #9426</a>:</p>
<blockquote>
<p>well adding the crate feature also did not help</p>
</blockquote>



<a name="475977071"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239426%20Wasm%20component%20module%20debugging%20-%20.../near/475977071" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239426.20Wasm.20component.20module.20debugging.20-.20.2E.2E.2E.html#475977071">(Oct 09 2024 at 23:39)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/9426#issuecomment-2403624240">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9426">issue #9426</a>:</p>
<blockquote>
<p>Would you be able to share snippets of the component/embedding in question? Or perhaps a snippet using the <code>wasmtime</code> CLI? It sounds like you're doing everything right, so it may come down to the details as to why this isn't working</p>
</blockquote>



<a name="475994689"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239426%20Wasm%20component%20module%20debugging%20-%20.../near/475994689" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239426.20Wasm.20component.20module.20debugging.20-.20.2E.2E.2E.html#475994689">(Oct 10 2024 at 01:44)</a>:</h4>
<p>ggjjj <a href="https://github.com/bytecodealliance/wasmtime/issues/9426#issuecomment-2403730717">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9426">issue #9426</a>:</p>
<blockquote>
<p><strong>Module Code</strong></p>
<p><code>mod map_fah_to_cel {
    wit_bindgen::generate!({ path: "xxx", world "map-iml",});
    // we also use some SDK elements for the exports
    impl exports::xx:xx::xx:xx for Module {
    fn process(message_input) -&gt; message_output
    }
    export!(Module);
}</code></p>
</blockquote>



<a name="475994736"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239426%20Wasm%20component%20module%20debugging%20-%20.../near/475994736" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239426.20Wasm.20component.20module.20debugging.20-.20.2E.2E.2E.html#475994736">(Oct 10 2024 at 01:45)</a>:</h4>
<p>ggjjj edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/9426#issuecomment-2403730717">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9426">issue #9426</a>:</p>
<blockquote>
<p><strong>Module Code</strong></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">mod</span><span class="w"> </span><span class="nn">map_fah_to_cel</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">wit_bindgen</span><span class="p">::</span><span class="n">generate</span><span class="o">!</span><span class="p">({</span><span class="w"> </span><span class="n">path</span><span class="p">:</span><span class="w"> </span><span class="s">"xxx"</span><span class="p">,</span><span class="w"> </span><span class="n">world</span><span class="w"> </span><span class="s">"map-iml"</span><span class="p">,});</span>
<span class="w">    </span><span class="c1">// we also use some SDK elements for the exports</span>
<span class="w">    </span><span class="k">impl</span><span class="w"> </span><span class="n">exports</span><span class="p">::</span><span class="n">xx</span><span class="p">:</span><span class="nc">xx</span><span class="p">::</span><span class="n">xx</span><span class="p">:</span><span class="nc">xx</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Module</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">process</span><span class="p">(</span><span class="n">message_input</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">message_output</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">export</span><span class="o">!</span><span class="p">(</span><span class="n">Module</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
</blockquote>



<a name="475995543"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239426%20Wasm%20component%20module%20debugging%20-%20.../near/475995543" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239426.20Wasm.20component.20module.20debugging.20-.20.2E.2E.2E.html#475995543">(Oct 10 2024 at 01:51)</a>:</h4>
<p>ggjjj <a href="https://github.com/bytecodealliance/wasmtime/issues/9426#issuecomment-2403736295">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9426">issue #9426</a>:</p>
<blockquote>
<p><strong>App code that launches the runtime and loads the module</strong></p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="n">thread</span><span class="p">::</span><span class="n">scope</span><span class="p">(</span><span class="o">|</span><span class="n">scope</span><span class="o">|</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="cm">/*</span>

<span class="cm">         *  As wasm runtime &amp; module have to be running on the same OS thread,</span>
<span class="cm">         *  use new_current_thread() to build a tokio runtime with the current</span>
<span class="cm">         *  thread scheduler selected.</span>
<span class="cm">         */</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">runtime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">runtime</span><span class="p">::</span><span class="n">Builder</span><span class="p">::</span><span class="n">new_current_thread</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="n">enable_all</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="n">build</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="n">unwrap</span><span class="p">();</span>

<span class="w">        </span><span class="n">runtime</span><span class="p">.</span><span class="n">block_on</span><span class="p">(</span><span class="n">async_main</span><span class="p">(</span><span class="n">scope</span><span class="p">));</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">}</span>

<span class="k">async</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">async_main</span><span class="p">(</span><span class="n">scope</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">engine_config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Config</span><span class="p">::</span><span class="n">new</span><span class="p">();</span>
<span class="w">    </span><span class="n">engine_config</span>
<span class="w">        </span><span class="p">.</span><span class="n">debug_info</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="n">cranelift_opt_level</span><span class="p">(</span><span class="n">OptLevel</span><span class="p">::</span><span class="nb">None</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="n">wasm_component_model</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="n">wasm_file_name</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="kt">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"../../tests/data/wasm-modules/processor-module1-v1.wasm"</span><span class="p">;</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="n">wasm_component_info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="o">*</span><span class="n">wasm_component_info</span><span class="p">.</span><span class="n">lock</span><span class="p">();</span>
<span class="w">            </span><span class="n">wasm_component_info</span><span class="p">.</span><span class="n">insert_component</span><span class="p">(</span><span class="o">&amp;</span><span class="n">wasm_module_id</span><span class="p">,</span><span class="w"> </span><span class="n">wasm_file_name</span><span class="p">.</span><span class="n">to_owned</span><span class="p">());</span>
<span class="w">        </span><span class="p">}</span>
<span class="c1">// insert_wasm_module()</span>
<span class="c1">// call_map_fn()</span>
<span class="c1">// wait for wasm device manager by join()</span>
<span class="p">}</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="475995632"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239426%20Wasm%20component%20module%20debugging%20-%20.../near/475995632" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239426.20Wasm.20component.20module.20debugging.20-.20.2E.2E.2E.html#475995632">(Oct 10 2024 at 01:52)</a>:</h4>
<p>ggjjj <a href="https://github.com/bytecodealliance/wasmtime/issues/9426#issuecomment-2403736952">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9426">issue #9426</a>:</p>
<blockquote>
<p>My goal is to step into the source code of <code>process()</code> when the <code>call_map_fn()</code> is executed.</p>
</blockquote>



<a name="476008874"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239426%20Wasm%20component%20module%20debugging%20-%20.../near/476008874" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239426.20Wasm.20component.20module.20debugging.20-.20.2E.2E.2E.html#476008874">(Oct 10 2024 at 02:51)</a>:</h4>
<p>ggjjj edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/9426#issuecomment-2403736295">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9426">issue #9426</a>:</p>
<blockquote>
<p><strong>App code that launches the runtime and loads the module</strong></p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="n">thread</span><span class="p">::</span><span class="n">scope</span><span class="p">(</span><span class="o">|</span><span class="n">scope</span><span class="o">|</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="cm">/*</span>

<span class="cm">         *  As wasm runtime &amp; module have to be running on the same OS thread,</span>
<span class="cm">         *  use new_current_thread() to build a tokio runtime with the current</span>
<span class="cm">         *  thread scheduler selected.</span>
<span class="cm">         */</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">runtime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">runtime</span><span class="p">::</span><span class="n">Builder</span><span class="p">::</span><span class="n">new_current_thread</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="n">enable_all</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="n">build</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="n">unwrap</span><span class="p">();</span>

<span class="w">        </span><span class="n">runtime</span><span class="p">.</span><span class="n">block_on</span><span class="p">(</span><span class="n">async_main</span><span class="p">(</span><span class="n">scope</span><span class="p">));</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">}</span>

<span class="k">async</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">async_main</span><span class="p">(</span><span class="n">scope</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">engine_config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Config</span><span class="p">::</span><span class="n">new</span><span class="p">();</span>
<span class="w">    </span><span class="n">engine_config</span>
<span class="w">        </span><span class="p">.</span><span class="n">debug_info</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="n">cranelift_opt_level</span><span class="p">(</span><span class="n">OptLevel</span><span class="p">::</span><span class="nb">None</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="n">wasm_component_model</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">wasm_file_name</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="kt">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"../../tests/data/wasm-modules/processor-module1-v1.wasm"</span><span class="p">;</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">         </span><span class="kd">let</span><span class="w"> </span><span class="n">wasm_component_info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="o">*</span><span class="n">wasm_component_info</span><span class="p">.</span><span class="n">lock</span><span class="p">();</span>
<span class="w">         </span><span class="n">wasm_component_info</span><span class="p">.</span><span class="n">insert_component</span><span class="p">(</span><span class="o">&amp;</span><span class="n">wasm_module_id</span><span class="p">,</span><span class="w"> </span><span class="n">wasm_file_name</span><span class="p">.</span><span class="n">to_owned</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>
<span class="c1">// insert_wasm_module()</span>
<span class="c1">// call_map_fn()</span>
<span class="c1">// wait for wasm device manager by join()</span>
<span class="p">}</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="476024791"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239426%20Wasm%20component%20module%20debugging%20-%20.../near/476024791" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239426.20Wasm.20component.20module.20debugging.20-.20.2E.2E.2E.html#476024791">(Oct 10 2024 at 04:05)</a>:</h4>
<p>ggjjj edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/9426#issuecomment-2403736295">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9426">issue #9426</a>:</p>
<blockquote>
<p><strong>App code that launches the runtime and loads the module and I am debugging this app</strong> </p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="n">thread</span><span class="p">::</span><span class="n">scope</span><span class="p">(</span><span class="o">|</span><span class="n">scope</span><span class="o">|</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="cm">/*</span>

<span class="cm">         *  As wasm runtime &amp; module have to be running on the same OS thread,</span>
<span class="cm">         *  use new_current_thread() to build a tokio runtime with the current</span>
<span class="cm">         *  thread scheduler selected.</span>
<span class="cm">         */</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">runtime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">runtime</span><span class="p">::</span><span class="n">Builder</span><span class="p">::</span><span class="n">new_current_thread</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="n">enable_all</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="n">build</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="n">unwrap</span><span class="p">();</span>

<span class="w">        </span><span class="n">runtime</span><span class="p">.</span><span class="n">block_on</span><span class="p">(</span><span class="n">async_main</span><span class="p">(</span><span class="n">scope</span><span class="p">));</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">}</span>

<span class="k">async</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">async_main</span><span class="p">(</span><span class="n">scope</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">engine_config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Config</span><span class="p">::</span><span class="n">new</span><span class="p">();</span>
<span class="w">    </span><span class="n">engine_config</span>
<span class="w">        </span><span class="p">.</span><span class="n">debug_info</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="n">cranelift_opt_level</span><span class="p">(</span><span class="n">OptLevel</span><span class="p">::</span><span class="nb">None</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="n">wasm_component_model</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">wasm_file_name</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="kt">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"../../tests/data/wasm-modules/processor-module1-v1.wasm"</span><span class="p">;</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">         </span><span class="kd">let</span><span class="w"> </span><span class="n">wasm_component_info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="o">*</span><span class="n">wasm_component_info</span><span class="p">.</span><span class="n">lock</span><span class="p">();</span>
<span class="w">         </span><span class="n">wasm_component_info</span><span class="p">.</span><span class="n">insert_component</span><span class="p">(</span><span class="o">&amp;</span><span class="n">wasm_module_id</span><span class="p">,</span><span class="w"> </span><span class="n">wasm_file_name</span><span class="p">.</span><span class="n">to_owned</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>
<span class="c1">// insert_wasm_module()</span>
<span class="c1">// call_map_fn()</span>
<span class="c1">// wait for wasm device manager by join()</span>
<span class="p">}</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="476156337"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239426%20Wasm%20component%20module%20debugging%20-%20.../near/476156337" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239426.20Wasm.20component.20module.20debugging.20-.20.2E.2E.2E.html#476156337">(Oct 10 2024 at 15:04)</a>:</h4>
<p>fitzgen <a href="https://github.com/bytecodealliance/wasmtime/issues/9426#issuecomment-2405382633">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9426">issue #9426</a>:</p>
<blockquote>
<p>@ggjjj I appreciate that you provided some source code here, but it is incomplete and contains syntactical errors (eg no type on <code>async_main</code>'s parameter).</p>
<p>Could you provide a git repo containing a fully self contained example that we can simply clone as well as detailed steps reproduce with exactly that git repo? Something like the following:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Minimal</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="n">case</span><span class="p">:</span><span class="w"> </span><span class="nc">url</span><span class="o">-</span><span class="n">of</span><span class="o">-</span><span class="n">git</span><span class="o">-</span><span class="n">repo</span>

<span class="n">Steps</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">reproduce</span><span class="p">:</span>


<span class="o">*</span><span class="w"> </span><span class="n">clone</span><span class="w"> </span><span class="n">git</span><span class="w"> </span><span class="n">repo</span>
<span class="o">*</span><span class="w"> </span><span class="n">Run</span><span class="w"> </span><span class="err">`</span><span class="n">cargo</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="n">build</span><span class="err">`</span><span class="w"> </span><span class="n">inside</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">git</span><span class="w"> </span><span class="n">repo</span>
<span class="o">*</span><span class="w"> </span><span class="n">Run</span><span class="w"> </span><span class="err">`</span><span class="n">lldb</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">-</span><span class="n">g</span><span class="w"> </span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">test</span><span class="p">.</span><span class="n">wasm</span><span class="err">`</span>
<span class="o">*</span><span class="w"> </span><span class="n">step</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="n">times</span><span class="p">,</span><span class="w"> </span><span class="n">until</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">reach</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="err">`</span><span class="n">foo</span><span class="err">`</span><span class="w"> </span><span class="n">function</span>

<span class="n">Expected</span><span class="w"> </span><span class="n">Results</span>


<span class="o">*</span><span class="w"> </span><span class="n">You</span><span class="w"> </span><span class="n">stepped</span><span class="w"> </span><span class="n">through</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="err">`</span><span class="n">a</span><span class="p">.</span><span class="n">wasm</span><span class="p">::</span><span class="n">bar</span><span class="err">`</span><span class="w"> </span><span class="n">function</span>

<span class="n">Actual</span><span class="w"> </span><span class="n">Results</span>


<span class="o">*</span><span class="w"> </span><span class="n">You</span><span class="w"> </span><span class="n">never</span><span class="w"> </span><span class="n">stepped</span><span class="w"> </span><span class="n">through</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="err">`</span><span class="n">a</span><span class="p">.</span><span class="n">wasm</span><span class="p">::</span><span class="n">bar</span><span class="err">`</span><span class="w"> </span><span class="n">function</span>
</code></pre></div>
<p>The easier you can make it to reproduce the bug exactly, without needing to fix source code that doesn't build or infer steps that are implied but not explicitly described, the better we can help you and diagnose/resolve the bug that you are seeing.</p>
<p>Thanks!</p>
</blockquote>



<a name="476184555"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239426%20Wasm%20component%20module%20debugging%20-%20.../near/476184555" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239426.20Wasm.20component.20module.20debugging.20-.20.2E.2E.2E.html#476184555">(Oct 10 2024 at 17:26)</a>:</h4>
<p>ggjjj <a href="https://github.com/bytecodealliance/wasmtime/issues/9426#issuecomment-2405670263">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9426">issue #9426</a>:</p>
<blockquote>
<p>I understand but we are working on private code. so is there any way I can debug this further?  @fitzgen </p>
</blockquote>



<a name="476185468"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239426%20Wasm%20component%20module%20debugging%20-%20.../near/476185468" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239426.20Wasm.20component.20module.20debugging.20-.20.2E.2E.2E.html#476185468">(Oct 10 2024 at 17:31)</a>:</h4>
<p>fitzgen <a href="https://github.com/bytecodealliance/wasmtime/issues/9426#issuecomment-2405680723">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9426">issue #9426</a>:</p>
<blockquote>
<p>Have you tried making a minimal reproducer that doesn't contain your private code?</p>
</blockquote>



<a name="476185749"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239426%20Wasm%20component%20module%20debugging%20-%20.../near/476185749" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239426.20Wasm.20component.20module.20debugging.20-.20.2E.2E.2E.html#476185749">(Oct 10 2024 at 17:33)</a>:</h4>
<p>ggjjj <a href="https://github.com/bytecodealliance/wasmtime/issues/9426#issuecomment-2405683927">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9426">issue #9426</a>:</p>
<blockquote>
<p>I am trying that. Is this the sample that you recommend?</p>
<p><a href="https://github.com/bytecodealliance/component-docs/blob/main/component-model/examples/example-host/src/add.rs">https://github.com/bytecodealliance/component-docs/blob/main/component-model/examples/example-host/src/add.rs</a></p>
</blockquote>



<a name="476185778"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239426%20Wasm%20component%20module%20debugging%20-%20.../near/476185778" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239426.20Wasm.20component.20module.20debugging.20-.20.2E.2E.2E.html#476185778">(Oct 10 2024 at 17:33)</a>:</h4>
<p>ggjjj edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/9426#issuecomment-2405683927">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9426">issue #9426</a>:</p>
<blockquote>
<p>I am trying that. Is this a sample that you recommend?</p>
<p><a href="https://github.com/bytecodealliance/component-docs/blob/main/component-model/examples/example-host/src/add.rs">https://github.com/bytecodealliance/component-docs/blob/main/component-model/examples/example-host/src/add.rs</a></p>
</blockquote>



<a name="476189398"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239426%20Wasm%20component%20module%20debugging%20-%20.../near/476189398" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239426.20Wasm.20component.20module.20debugging.20-.20.2E.2E.2E.html#476189398">(Oct 10 2024 at 17:55)</a>:</h4>
<p>fitzgen <a href="https://github.com/bytecodealliance/wasmtime/issues/9426#issuecomment-2405722405">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9426">issue #9426</a>:</p>
<blockquote>
<p>If you can get that example to reproduce your issue, then that sounds great. If you can't get that example to reproduce your issue, then I'd suggest trying to make calls and link modules/components together in a similar shape as your private code in an effort to find something that will reproduce the bug.</p>
</blockquote>



<a name="476235960"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239426%20Wasm%20component%20module%20debugging%20-%20.../near/476235960" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239426.20Wasm.20component.20module.20debugging.20-.20.2E.2E.2E.html#476235960">(Oct 10 2024 at 22:23)</a>:</h4>
<p>ggjjj <a href="https://github.com/bytecodealliance/wasmtime/issues/9426#issuecomment-2406145123">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9426">issue #9426</a>:</p>
<blockquote>
<p>Sample  tried - <code>https://github.com/bytecodealliance/wasmtime/tree/main/examples/component</code> </p>
<p>Steps followed</p>
<ol>
<li>cargo build -p example-component-wasm --target wasm32-unknown-unknown</li>
<li>cargo run --example component</li>
</ol>
<p>I was succesfully able to step into source code in <a href="http://guest.rs">guest.rs</a></p>
<p>Next I switched to <code>wasm32-wasip1</code> target</p>
<p>Steps followed</p>
<ol>
<li>cargo build -p example-component-wasm --target wasm32-wasip1</li>
<li>cargo run --example component</li>
</ol>
<p>**Error: failed to decode world from module</p>
<p>Caused by:<br>
    0: module was not valid<br>
    1: failed to resolve import <code>wasi_snapshot_preview1::fd_write</code><br>
    2: module requires an import interface named `wasi_snapshot_preview1**</p>
</blockquote>



<a name="476236164"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239426%20Wasm%20component%20module%20debugging%20-%20.../near/476236164" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239426.20Wasm.20component.20module.20debugging.20-.20.2E.2E.2E.html#476236164">(Oct 10 2024 at 22:24)</a>:</h4>
<p>ggjjj <a href="https://github.com/bytecodealliance/wasmtime/issues/9426#issuecomment-2406146596">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9426">issue #9426</a>:</p>
<blockquote>
<p>My goal was to convert the module to adapt to wasi-preview1</p>
<p>by</p>
<p><code>wasm-tools component new ./target/wasm32-wasip1/debug/guest.wasm -o ./target/wasm32-wasip1/debug/guest-wasi.wasm  --adapt wasi_snapshot_preview1.reactor.wasm</code> </p>
<p>But I couldn't get to this step <br>
</p>
</blockquote>



<a name="476236218"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239426%20Wasm%20component%20module%20debugging%20-%20.../near/476236218" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239426.20Wasm.20component.20module.20debugging.20-.20.2E.2E.2E.html#476236218">(Oct 10 2024 at 22:25)</a>:</h4>
<p>ggjjj edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/9426#issuecomment-2406146596">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9426">issue #9426</a>:</p>
<blockquote>
<p>My goal was to convert the module to adapt to wasi-preview1</p>
<p>by</p>
<p><code>wasm-tools component new ./target/wasm32-wasip1/debug/guest.wasm -o ./target/wasm32-wasip1/debug/guest-wasi.wasm  --adapt wasi_snapshot_preview1.reactor.wasm</code> </p>
<p>and use guest-wasi.wasm to load in <code>main.rs</code> of component <br>
But I couldn't get to this step <br>
</p>
</blockquote>



<a name="476237476"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239426%20Wasm%20component%20module%20debugging%20-%20.../near/476237476" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239426.20Wasm.20component.20module.20debugging.20-.20.2E.2E.2E.html#476237476">(Oct 10 2024 at 22:35)</a>:</h4>
<p>ggjjj <a href="https://github.com/bytecodealliance/wasmtime/issues/9426#issuecomment-2406157301">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9426">issue #9426</a>:</p>
<blockquote>
<p>I tried to use the guest-wasi.wasm in line53 of <a href="http://main.rs">main.rs</a></p>
<div class="codehilite"><pre><span></span><code>let component = convert_to_component(&quot;target/wasm32-wasip1/debug/guest-wasi.wasm&quot;)?;

while running it

I got this error

**Error: decoding a component is not supported**
</code></pre></div>

</blockquote>



<a name="476237524"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239426%20Wasm%20component%20module%20debugging%20-%20.../near/476237524" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239426.20Wasm.20component.20module.20debugging.20-.20.2E.2E.2E.html#476237524">(Oct 10 2024 at 22:35)</a>:</h4>
<p>ggjjj <a href="https://github.com/bytecodealliance/wasmtime/issues/9426#issuecomment-2406157690">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9426">issue #9426</a>:</p>
<blockquote>
<p>I used 25.0.2 snapshot file <br>
<a href="https://github.com/bytecodealliance/wasmtime/releases/download/v25.0.2/wasi_snapshot_preview1.reactor.wasm">https://github.com/bytecodealliance/wasmtime/releases/download/v25.0.2/wasi_snapshot_preview1.reactor.wasm</a></p>
</blockquote>



<a name="476237597"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239426%20Wasm%20component%20module%20debugging%20-%20.../near/476237597" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239426.20Wasm.20component.20module.20debugging.20-.20.2E.2E.2E.html#476237597">(Oct 10 2024 at 22:36)</a>:</h4>
<p>ggjjj edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/9426#issuecomment-2406157301">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9426">issue #9426</a>:</p>
<blockquote>
<p>I tried to use the guest-wasi.wasm in line53 of <a href="http://main.rs">main.rs</a></p>
<p><code>  let component = convert_to_component("target/wasm32-wasip1/debug/guest-wasi.wasm")?;</code></p>
<div class="codehilite"><pre><span></span><code>while running it

I got this error

**Error: decoding a component is not supported**
</code></pre></div>

</blockquote>



<a name="476237630"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239426%20Wasm%20component%20module%20debugging%20-%20.../near/476237630" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239426.20Wasm.20component.20module.20debugging.20-.20.2E.2E.2E.html#476237630">(Oct 10 2024 at 22:36)</a>:</h4>
<p>ggjjj edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/9426#issuecomment-2406157301">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9426">issue #9426</a>:</p>
<blockquote>
<p>I tried to use the guest-wasi.wasm in line53 of <a href="http://main.rs">main.rs</a></p>
<p><code>  let component = convert_to_component("target/wasm32-wasip1/debug/guest-wasi.wasm")?;</code><br>
     while running it,  I got this error</p>
<div class="codehilite"><pre><span></span><code>**Error: decoding a component is not supported**
</code></pre></div>

</blockquote>



<a name="476238501"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239426%20Wasm%20component%20module%20debugging%20-%20.../near/476238501" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239426.20Wasm.20component.20module.20debugging.20-.20.2E.2E.2E.html#476238501">(Oct 10 2024 at 22:43)</a>:</h4>
<p>ggjjj <a href="https://github.com/bytecodealliance/wasmtime/issues/9426#issuecomment-2406165170">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9426">issue #9426</a>:</p>
<blockquote>
<p>May I know why 26.0.0 is wasmtime version when only 25.0.2 is released?<br>
</p>
</blockquote>



<a name="476282608"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239426%20Wasm%20component%20module%20debugging%20-%20.../near/476282608" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239426.20Wasm.20component.20module.20debugging.20-.20.2E.2E.2E.html#476282608">(Oct 11 2024 at 03:22)</a>:</h4>
<p>ggjjj edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/9426#issuecomment-2406157301">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9426">issue #9426</a>:</p>
<blockquote>
<p>I tried to use the guest-wasi.wasm in line53 of <a href="http://main.rs">main.rs</a> after the above <code>wasm-tools</code> command</p>
<p><code>  let component = convert_to_component("target/wasm32-wasip1/debug/guest-wasi.wasm")?;</code><br>
     while running it,  I got this error</p>
<div class="codehilite"><pre><span></span><code>**Error: decoding a component is not supported**
</code></pre></div>

</blockquote>



<a name="476433553"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239426%20Wasm%20component%20module%20debugging%20-%20.../near/476433553" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239426.20Wasm.20component.20module.20debugging.20-.20.2E.2E.2E.html#476433553">(Oct 11 2024 at 17:47)</a>:</h4>
<p>ggjjj <a href="https://github.com/bytecodealliance/wasmtime/issues/9426#issuecomment-2407874538">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9426">issue #9426</a>:</p>
<blockquote>
<p>@fitzgen  Hey Nick did you get  a chance to look at this one?</p>
</blockquote>



<a name="476467922"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239426%20Wasm%20component%20module%20debugging%20-%20.../near/476467922" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239426.20Wasm.20component.20module.20debugging.20-.20.2E.2E.2E.html#476467922">(Oct 11 2024 at 22:31)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/9426#issuecomment-2408198458">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9426">issue #9426</a>:</p>
<blockquote>
<p>@ggjjj it looks like there's a lot going on here with quite a few possibilities of what could be going wrong. We can try to piece together everything from the snippets of information you're posting but it'd be much more helpful to us as maintainers if you're able to do what <a href="https://github.com/bytecodealliance/wasmtime/issues/9426#issuecomment-2405382633">Nick mentioned above</a> with having a reproducible set of steps. It looks like you're trying a lot of things all at once and each thing is failing in different ways which may be unrelated to the original issue</p>
</blockquote>



<a name="476564306"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239426%20Wasm%20component%20module%20debugging%20-%20.../near/476564306" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239426.20Wasm.20component.20module.20debugging.20-.20.2E.2E.2E.html#476564306">(Oct 13 2024 at 01:00)</a>:</h4>
<p>ggjjj <a href="https://github.com/bytecodealliance/wasmtime/issues/9426#issuecomment-2408769810">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9426">issue #9426</a>:</p>
<blockquote>
<p>Agree and apologize for including some many of the methods I tried in once. ok let me start step by step.</p>
<p><strong>Goal 1 - try the component example with wasm32-wasip1.</strong></p>
<p>Minimal test case: <a href="https://github.com/ggjjj/wasmtime">url-of-git-repo</a></p>
<p>Steps to reproduce:</p>
<ul>
<li>clone git repo</li>
<li>cargo build -p example-component-wasm --target wasm32-wasip1</li>
<li>cargo run --example wasm32-wasip1</li>
</ul>
<p>Expected Results</p>
<ul>
<li>Converted to <a href="http://74.xxx">74.xxx</a></li>
</ul>
<p>Actual Results</p>
<p>Error: failed to decode world from module</p>
<p>Caused by:<br>
    0: module was not valid<br>
    1: failed to resolve import <code>wasi_snapshot_preview1::fd_write</code><br>
    2: module requires an import interface named <code>wasi_snapshot_preview1</code></p>
</blockquote>



<a name="476564343"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239426%20Wasm%20component%20module%20debugging%20-%20.../near/476564343" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239426.20Wasm.20component.20module.20debugging.20-.20.2E.2E.2E.html#476564343">(Oct 13 2024 at 01:00)</a>:</h4>
<p>ggjjj edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/9426#issuecomment-2408769810">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9426">issue #9426</a>:</p>
<blockquote>
<p>Agree and apologize for including some many of the methods I tried in once. ok let me start step by step.</p>
<p><strong>Goal 1 - try the component example with wasm32-wasip1.</strong></p>
<p>Minimal test case: <a href="https://github.com/ggjjj/wasmtime">url-of-git-repo</a></p>
<p>Steps to reproduce:</p>
<ul>
<li>clone git repo</li>
<li>cargo build -p example-component-wasm --target wasm32-wasip1</li>
<li>cargo run --example wasm32-wasip1</li>
</ul>
<p>Expected Results</p>
<ul>
<li>Converted to <a href="http://74.xxx">74.xxx</a></li>
</ul>
<p>Actual Results</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Error</span><span class="p">:</span><span class="w"> </span><span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">decode</span><span class="w"> </span><span class="n">world</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">module</span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span><span class="p">:</span>
<span class="w">    </span><span class="mi">0</span><span class="p">:</span><span class="w"> </span><span class="nc">module</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">valid</span>
<span class="w">    </span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">resolve</span><span class="w"> </span><span class="n">import</span><span class="w"> </span><span class="err">`</span><span class="n">wasi_snapshot_preview1</span><span class="p">::</span><span class="n">fd_write</span><span class="err">`</span>
<span class="w">    </span><span class="mi">2</span><span class="p">:</span><span class="w"> </span><span class="nc">module</span><span class="w"> </span><span class="n">requires</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">import</span><span class="w"> </span><span class="n">interface</span><span class="w"> </span><span class="n">named</span><span class="w"> </span><span class="err">`</span><span class="n">wasi_snapshot_preview1</span><span class="err">`</span>
</code></pre></div>
</blockquote>



<a name="476564375"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239426%20Wasm%20component%20module%20debugging%20-%20.../near/476564375" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239426.20Wasm.20component.20module.20debugging.20-.20.2E.2E.2E.html#476564375">(Oct 13 2024 at 01:01)</a>:</h4>
<p>ggjjj edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/9426#issuecomment-2408769810">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9426">issue #9426</a>:</p>
<blockquote>
<p>Agree and apologize for including some many of the methods I tried in once. ok let me start step by step.</p>
<p><strong>Goal 1 - Try the <a href="https://github.com/bytecodealliance/wasmtime/tree/main/examples/component">component example</a> with wasm32-wasip1.</strong></p>
<p>Minimal test case: <a href="https://github.com/ggjjj/wasmtime">url-of-git-repo</a></p>
<p>Steps to reproduce:</p>
<ul>
<li>clone git repo</li>
<li>cargo build -p example-component-wasm --target wasm32-wasip1</li>
<li>cargo run --example wasm32-wasip1</li>
</ul>
<p>Expected Results</p>
<ul>
<li>Converted to <a href="http://74.xxx">74.xxx</a></li>
</ul>
<p>Actual Results</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Error</span><span class="p">:</span><span class="w"> </span><span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">decode</span><span class="w"> </span><span class="n">world</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">module</span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span><span class="p">:</span>
<span class="w">    </span><span class="mi">0</span><span class="p">:</span><span class="w"> </span><span class="nc">module</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">valid</span>
<span class="w">    </span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">resolve</span><span class="w"> </span><span class="n">import</span><span class="w"> </span><span class="err">`</span><span class="n">wasi_snapshot_preview1</span><span class="p">::</span><span class="n">fd_write</span><span class="err">`</span>
<span class="w">    </span><span class="mi">2</span><span class="p">:</span><span class="w"> </span><span class="nc">module</span><span class="w"> </span><span class="n">requires</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">import</span><span class="w"> </span><span class="n">interface</span><span class="w"> </span><span class="n">named</span><span class="w"> </span><span class="err">`</span><span class="n">wasi_snapshot_preview1</span><span class="err">`</span>
</code></pre></div>
</blockquote>



<a name="476850252"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239426%20Wasm%20component%20module%20debugging%20-%20.../near/476850252" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239426.20Wasm.20component.20module.20debugging.20-.20.2E.2E.2E.html#476850252">(Oct 14 2024 at 20:49)</a>:</h4>
<p>ggjjj <a href="https://github.com/bytecodealliance/wasmtime/issues/9426#issuecomment-2412309983">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9426">issue #9426</a>:</p>
<blockquote>
<p>@alexcrichton @fitzgen  Is the above format okay? Is there any other information needed? Please advise<br>
</p>
</blockquote>



<a name="477101972"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239426%20Wasm%20component%20module%20debugging%20-%20.../near/477101972" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239426.20Wasm.20component.20module.20debugging.20-.20.2E.2E.2E.html#477101972">(Oct 16 2024 at 01:56)</a>:</h4>
<p>ggjjj <a href="https://github.com/bytecodealliance/wasmtime/issues/9426#issuecomment-2415566039">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9426">issue #9426</a>:</p>
<blockquote>
<p>I figured out what I was missing. Once I defined the wasibuilder, I was able to get it all to working and eventually step into the source code. Sample is somewhat closer to the app we have in house but it does create two threads<br>
One thread is to create engine, linker, store and another thread is to extract and call component function. any thoughts on if that would affect the debug symbols to be lost in someway?  @alexcrichton @fitzgen </p>
</blockquote>



<a name="477129794"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239426%20Wasm%20component%20module%20debugging%20-%20.../near/477129794" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239426.20Wasm.20component.20module.20debugging.20-.20.2E.2E.2E.html#477129794">(Oct 16 2024 at 06:12)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/9426#issuecomment-2415818842">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9426">issue #9426</a>:</p>
<blockquote>
<p>@ggjjj from <a href="https://github.com/bytecodealliance/wasmtime/issues/9426#issuecomment-2408769810">your comment above</a> the error is happening because conversion to a component is a bit more subtle when the different target of <code>wasm32-wasip1</code> is used. Nowadays if you use <code>wasm32-wasip2</code> the target automatically produces a component which is probably what we should update the example to be doing.</p>
<blockquote>
<p>any thoughts on if that would affect the debug symbols to be lost in someway?</p>
</blockquote>
<p>Hm in theory no, having separate threads shouldn't affect anything. Were you able to get a reproduction we could poke around though?</p>
</blockquote>



<a name="477340595"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239426%20Wasm%20component%20module%20debugging%20-%20.../near/477340595" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239426.20Wasm.20component.20module.20debugging.20-.20.2E.2E.2E.html#477340595">(Oct 17 2024 at 03:12)</a>:</h4>
<p>ggjjj closed <a href="https://github.com/bytecodealliance/wasmtime/issues/9426">issue #9426</a>:</p>
<blockquote>
<p><a href="https://github.com/bytecodealliance/wasm-tools/issues/1854">https://github.com/bytecodealliance/wasm-tools/issues/1854</a> </p>
<p>I am using a rust application that launches the wasmtime with debug_info() set to true and loads a WASM module that implements component module. </p>
<p>I use wasm-tools to get the module adapted to wasi by<br>
<code>wasm-tools component new ./target/wasm32-wasip1/debug/module1.wasm -o ./tests/data/wasm-modules/processor-module1-$(VERSION).wasm --adapt wasi_snapshot_preview1.reactor.wasm</code></p>
<p>I also confirmed that the <code>wasm-tools objdump</code> to see that the debug_info information exists.</p>
<p>now once I launch the debugger for the rust application, I am only able to step into a <code>call()</code> function and but not in the wasm module source code. </p>
<p>is there any other step am I missing?</p>
</blockquote>



<a name="477340596"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239426%20Wasm%20component%20module%20debugging%20-%20.../near/477340596" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239426.20Wasm.20component.20module.20debugging.20-.20.2E.2E.2E.html#477340596">(Oct 17 2024 at 03:12)</a>:</h4>
<p>ggjjj <a href="https://github.com/bytecodealliance/wasmtime/issues/9426#issuecomment-2418406478">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9426">issue #9426</a>:</p>
<blockquote>
<p>Looks it its not the separate threads its the wasmtime version. 24.0.0 did not work. 25.0.2 worked. Thanks for all the insights. closing the issue</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>