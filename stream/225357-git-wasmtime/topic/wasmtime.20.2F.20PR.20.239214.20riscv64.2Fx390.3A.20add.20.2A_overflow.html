<html>
<head><meta charset="utf-8"><title>wasmtime / PR #9214 riscv64/x390: add *_overflow · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239214.20riscv64.2Fx390.3A.20add.20.2A_overflow.html">wasmtime / PR #9214 riscv64/x390: add *_overflow</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="468525351"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239214%20riscv64/x390%3A%20add%20%2A_overflow/near/468525351" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239214.20riscv64.2Fx390.3A.20add.20.2A_overflow.html#468525351">(Sep 08 2024 at 07:18)</a>:</h4>
<p>ghostway0 opened <a href="https://github.com/bytecodealliance/wasmtime/pull/9214">PR #9214</a> from <code>ghostway0:ghostway/9186</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>currently a draft and only riscv64</p>
</blockquote>



<a name="468844307"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239214%20riscv64/x390%3A%20add%20%2A_overflow/near/468844307" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239214.20riscv64.2Fx390.3A.20add.20.2A_overflow.html#468844307">(Sep 09 2024 at 15:56)</a>:</h4>
<p>ghostway0 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/9214">PR #9214</a>.</p>



<a name="468868004"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239214%20riscv64/x390%3A%20add%20%2A_overflow/near/468868004" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239214.20riscv64.2Fx390.3A.20add.20.2A_overflow.html#468868004">(Sep 09 2024 at 17:23)</a>:</h4>
<p>ghostway0 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/9214">PR #9214</a>.</p>



<a name="468882386"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239214%20riscv64/x390%3A%20add%20%2A_overflow/near/468882386" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239214.20riscv64.2Fx390.3A.20add.20.2A_overflow.html#468882386">(Sep 09 2024 at 18:34)</a>:</h4>
<p>ghostway0 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/9214">PR #9214</a>.</p>



<a name="469410381"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239214%20riscv64/x390%3A%20add%20%2A_overflow/near/469410381" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239214.20riscv64.2Fx390.3A.20add.20.2A_overflow.html#469410381">(Sep 11 2024 at 14:08)</a>:</h4>
<p>ghostway0 <a href="https://github.com/bytecodealliance/wasmtime/pull/9214#issuecomment-2343783858">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/9214">PR #9214</a>:</p>
<blockquote>
<p>@bjorn3 can you take a look? also, I haven't found umul equivalent (or mul with zext*) in s390x. do you know what are their names?</p>
</blockquote>



<a name="469410473"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239214%20riscv64/x390%3A%20add%20%2A_overflow/near/469410473" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239214.20riscv64.2Fx390.3A.20add.20.2A_overflow.html#469410473">(Sep 11 2024 at 14:09)</a>:</h4>
<p>ghostway0 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/9214">PR #9214</a>.</p>



<a name="471486786"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239214%20riscv64/x390%3A%20add%20%2A_overflow/near/471486786" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239214.20riscv64.2Fx390.3A.20add.20.2A_overflow.html#471486786">(Sep 19 2024 at 13:28)</a>:</h4>
<p>uweigand <a href="https://github.com/bytecodealliance/wasmtime/pull/9214#issuecomment-2360990227">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/9214">PR #9214</a>:</p>
<blockquote>
<p>Hi @ghostway0,   a few comments on the s390x part:</p>
<ul>
<li>All the new instruction rules you added seem to provide only a single return, the overflow bit.  However, my understanding is that <code>smul_overflow</code> and all the other overflow instructions are defined to have <em>two</em> returns, the low-part result and the overflow bit.  I think you'll need to use some form of <code>with_flags</code> to construct the pair of results (like x86 and aarch64 already do).</li>
<li>You're simply re-using the same instructions used for the "normal" operation (add/sub/mul) also for the overflow operation.  That is correct for 32-bit and 64-bit operations, but <em>not</em> for 8-bit and 16-bit operations.  The reason is that the 390x ISA does not actually have any 8-bit or 16-bit arithmetic instructions, so we simply use the 32-bit version also for 8-bit and 16-bit operations.  That provides the correct (low-part) result, but any overflow indication would be incorrect.</li>
<li>There is no unsigned-multiply instruction with overflow indication on our platform.  What other compilers do is to use the 32x32-&gt;64 or 64x64-&gt;128 bit wide multiply instruction, and check whether the high-part of the output is zero.<br>
</li>
</ul>
</blockquote>



<a name="471970237"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239214%20riscv64/x390%3A%20add%20%2A_overflow/near/471970237" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239214.20riscv64.2Fx390.3A.20add.20.2A_overflow.html#471970237">(Sep 21 2024 at 19:58)</a>:</h4>
<p>afonso360 created <a href="https://github.com/bytecodealliance/wasmtime/pull/9214#discussion_r1769526759">PR review comment</a>:</p>
<blockquote>
<p>Ditto here</p>
</blockquote>



<a name="471970238"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239214%20riscv64/x390%3A%20add%20%2A_overflow/near/471970238" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239214.20riscv64.2Fx390.3A.20add.20.2A_overflow.html#471970238">(Sep 21 2024 at 19:58)</a>:</h4>
<p>afonso360 created <a href="https://github.com/bytecodealliance/wasmtime/pull/9214#discussion_r1769527126">PR review comment</a>:</p>
<blockquote>
<p>It might be better to use <code>rv_sltu</code> here instead of a select between one and zero. The RISC-V comparision functions already return a zero or one, and they are a lot shorter than our current implementation of <code>select_xreg</code></p>
</blockquote>



<a name="471970240"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239214%20riscv64/x390%3A%20add%20%2A_overflow/near/471970240" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239214.20riscv64.2Fx390.3A.20add.20.2A_overflow.html#471970240">(Sep 21 2024 at 19:58)</a>:</h4>
<p>afonso360 created <a href="https://github.com/bytecodealliance/wasmtime/pull/9214#discussion_r1769526855">PR review comment</a>:</p>
<blockquote>
<p>It might be better to use <code>rv_snez</code> here instead of a select between one and zero.<br>
</p>
</blockquote>



<a name="471970241"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239214%20riscv64/x390%3A%20add%20%2A_overflow/near/471970241" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239214.20riscv64.2Fx390.3A.20add.20.2A_overflow.html#471970241">(Sep 21 2024 at 19:58)</a>:</h4>
<p>afonso360 created <a href="https://github.com/bytecodealliance/wasmtime/pull/9214#discussion_r1769621234">PR review comment</a>:</p>
<blockquote>
<p>Same here</p>
</blockquote>



<a name="471970242"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239214%20riscv64/x390%3A%20add%20%2A_overflow/near/471970242" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239214.20riscv64.2Fx390.3A.20add.20.2A_overflow.html#471970242">(Sep 21 2024 at 19:58)</a>:</h4>
<p>afonso360 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9214#pullrequestreview-2319706108">PR review</a>:</p>
<blockquote>
<p><span aria-label="wave" class="emoji emoji-1f44b" role="img" title="wave">:wave:</span> Hey,</p>
<p>I don't know if this is ready for review yet, but It's a great start!</p>
<p>A few comments for the RISC-V part. I didn't check the lowerings in a lot of detail, mostly just spotting a few things that could be shorter.</p>
<p>Thanks for working on this!<br>
</p>
</blockquote>



<a name="471970243"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239214%20riscv64/x390%3A%20add%20%2A_overflow/near/471970243" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239214.20riscv64.2Fx390.3A.20add.20.2A_overflow.html#471970243">(Sep 21 2024 at 19:58)</a>:</h4>
<p>afonso360 created <a href="https://github.com/bytecodealliance/wasmtime/pull/9214#discussion_r1769527518">PR review comment</a>:</p>
<blockquote>
<p>Ditto here for <code>sltu</code>.</p>
</blockquote>



<a name="471970244"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239214%20riscv64/x390%3A%20add%20%2A_overflow/near/471970244" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239214.20riscv64.2Fx390.3A.20add.20.2A_overflow.html#471970244">(Sep 21 2024 at 19:58)</a>:</h4>
<p>afonso360 created <a href="https://github.com/bytecodealliance/wasmtime/pull/9214#discussion_r1769622243">PR review comment</a>:</p>
<blockquote>
<p>This <code>one</code> doesn't seem to be used anywhere, similarly in the rules below there are a few <code>one</code> unused instructions.</p>
</blockquote>



<a name="471970245"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239214%20riscv64/x390%3A%20add%20%2A_overflow/near/471970245" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239214.20riscv64.2Fx390.3A.20add.20.2A_overflow.html#471970245">(Sep 21 2024 at 19:58)</a>:</h4>
<p>afonso360 created <a href="https://github.com/bytecodealliance/wasmtime/pull/9214#discussion_r1769621689">PR review comment</a>:</p>
<blockquote>
<p>This <code>one</code> doesn't seem to be used anywhere.</p>
</blockquote>



<a name="471970246"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239214%20riscv64/x390%3A%20add%20%2A_overflow/near/471970246" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239214.20riscv64.2Fx390.3A.20add.20.2A_overflow.html#471970246">(Sep 21 2024 at 19:58)</a>:</h4>
<p>afonso360 created <a href="https://github.com/bytecodealliance/wasmtime/pull/9214#discussion_r1769621163">PR review comment</a>:</p>
<blockquote>
<p>This could also be a <code>snez</code></p>
</blockquote>



<a name="471970247"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239214%20riscv64/x390%3A%20add%20%2A_overflow/near/471970247" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239214.20riscv64.2Fx390.3A.20add.20.2A_overflow.html#471970247">(Sep 21 2024 at 19:58)</a>:</h4>
<p>afonso360 created <a href="https://github.com/bytecodealliance/wasmtime/pull/9214#discussion_r1769624508">PR review comment</a>:</p>
<blockquote>
<p>This could also be replaced with a <code>sltu</code> instruction which is a shorter sequence than a full select.</p>
</blockquote>



<a name="471970248"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239214%20riscv64/x390%3A%20add%20%2A_overflow/near/471970248" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239214.20riscv64.2Fx390.3A.20add.20.2A_overflow.html#471970248">(Sep 21 2024 at 19:58)</a>:</h4>
<p>afonso360 created <a href="https://github.com/bytecodealliance/wasmtime/pull/9214#discussion_r1769622825">PR review comment</a>:</p>
<blockquote>
<p>Instead of doing madd here, we can just multiply <code>x_lo</code> and <code>y_lo</code> and save one instruction.</p>
</blockquote>



<a name="471970249"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239214%20riscv64/x390%3A%20add%20%2A_overflow/near/471970249" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239214.20riscv64.2Fx390.3A.20add.20.2A_overflow.html#471970249">(Sep 21 2024 at 19:58)</a>:</h4>
<p>afonso360 created <a href="https://github.com/bytecodealliance/wasmtime/pull/9214#discussion_r1769624444">PR review comment</a>:</p>
<blockquote>
<p>We could replace this with a <code>snez</code> instruction</p>
</blockquote>



<a name="471970250"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239214%20riscv64/x390%3A%20add%20%2A_overflow/near/471970250" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239214.20riscv64.2Fx390.3A.20add.20.2A_overflow.html#471970250">(Sep 21 2024 at 19:58)</a>:</h4>
<p>afonso360 created <a href="https://github.com/bytecodealliance/wasmtime/pull/9214#discussion_r1769624293">PR review comment</a>:</p>
<blockquote>
<p>Here we could use <code>mul</code> instead of <code>madd</code> and save one instruction.</p>
</blockquote>



<a name="471970269"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239214%20riscv64/x390%3A%20add%20%2A_overflow/near/471970269" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239214.20riscv64.2Fx390.3A.20add.20.2A_overflow.html#471970269">(Sep 21 2024 at 19:59)</a>:</h4>
<p>afonso360 edited <a href="https://github.com/bytecodealliance/wasmtime/pull/9214#discussion_r1769526855">PR review comment</a>.</p>



<a name="471970271"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239214%20riscv64/x390%3A%20add%20%2A_overflow/near/471970271" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239214.20riscv64.2Fx390.3A.20add.20.2A_overflow.html#471970271">(Sep 21 2024 at 19:59)</a>:</h4>
<p>afonso360 edited <a href="https://github.com/bytecodealliance/wasmtime/pull/9214#discussion_r1769526759">PR review comment</a>.</p>



<a name="472046160"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239214%20riscv64/x390%3A%20add%20%2A_overflow/near/472046160" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239214.20riscv64.2Fx390.3A.20add.20.2A_overflow.html#472046160">(Sep 22 2024 at 13:15)</a>:</h4>
<p>afonso360 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9214#pullrequestreview-2319706108">PR review</a>:</p>
<blockquote>
<p><span aria-label="wave" class="emoji emoji-1f44b" role="img" title="wave">:wave:</span> Hey,</p>
<p>I don't know if this is ready for review yet, but It's a great start!</p>
<p>A few comments for the RISC-V part. I didn't check the lowerings in a lot of detail, mostly just spotting a few things that could be shorter.</p>
<p>Thanks for working on this!</p>
<p>Edit: I also ran the fuzzer (with these <a href="https://github.com/afonso360/wasmtime/commit/b6b15dac87c4854b8ab7c75bf887aeb78ed9b4f4">changes</a>) and it pointed out this testcase.</p>
<p>&lt;details&gt;</p>
<p>&lt;summary&gt;Fuzzer testcase&lt;/summary&gt;</p>
<p>Testcase:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">test</span><span class="w"> </span><span class="n">interpret</span>
<span class="n">test</span><span class="w"> </span><span class="n">run</span>
<span class="n">target</span><span class="w"> </span><span class="n">riscv64gc</span>
<span class="n">target</span><span class="w"> </span><span class="n">x86_64</span>

<span class="n">function</span><span class="w"> </span><span class="o">%</span><span class="n">a</span><span class="p">(</span><span class="kt">i8</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="kt">i8</span><span class="w"> </span><span class="p">{</span>
<span class="n">block0</span><span class="p">(</span><span class="n">v0</span><span class="p">:</span><span class="w"> </span><span class="kt">i8</span><span class="p">):</span>
<span class="w">    </span><span class="nc">v1</span><span class="p">,</span><span class="w"> </span><span class="n">v2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">smul_overflow</span><span class="w"> </span><span class="n">v0</span><span class="p">,</span><span class="w"> </span><span class="n">v0</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">v2</span>
<span class="p">}</span>
<span class="p">;</span><span class="w"> </span><span class="n">run</span><span class="p">:</span><span class="w"> </span><span class="o">%</span><span class="n">a</span><span class="p">(</span><span class="o">-</span><span class="mi">15</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span>
</code></pre></div>
<p>Result:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w"> </span><span class="n">ERROR</span><span class="w"> </span><span class="n">cranelift_filetests</span><span class="p">::</span><span class="n">concurrent</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">FAIL</span><span class="p">:</span><span class="w"> </span><span class="nc">run</span>
<span class="n">FAIL</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">test</span><span class="p">.</span><span class="n">clif</span><span class="p">:</span><span class="w"> </span><span class="nc">run</span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span><span class="p">:</span>
<span class="w">    </span><span class="nc">Failed</span><span class="w"> </span><span class="n">test</span><span class="p">:</span><span class="w"> </span><span class="nc">run</span><span class="p">:</span><span class="w"> </span><span class="o">%</span><span class="n">a</span><span class="p">(</span><span class="o">-</span><span class="mi">15</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">actual</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
<span class="mi">1</span><span class="w"> </span><span class="n">tests</span>
<span class="n">Error</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">failure</span>
</code></pre></div>
<p>&lt;/summary&gt;<br>
</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>