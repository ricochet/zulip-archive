<html>
<head><meta charset="utf-8"><title>wasmtime / PR #2791 Add a compile command to Wasmtime. · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html">wasmtime / PR #2791 Add a compile command to Wasmtime.</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="232360906"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232360906" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232360906">(Mar 30 2021 at 01:36)</a>:</h4>
<p>peterhuene opened <a href="https://github.com/bytecodealliance/wasmtime/pull/2791">PR #2791</a> from <code>compile-command</code> to <code>main</code>:</p>
<blockquote>
<p>This PR adds a <code>compile</code> command to the Wasmtime CLI.</p>
<p>The command can be used to Ahead-Of-Time (AOT) compile WebAssembly modules.</p>
<p>With the <code>all-arch</code> feature enabled, AOT compilation can be performed for<br>
non-native architectures (i.e. cross-compilation).</p>
<p>The <code>Module::compile</code> method has been added to perform AOT compilation.</p>
<p>A few of the CLI flags relating to "on by default" Wasm features have been<br>
changed to be "--disable-XYZ" flags.</p>
<p>A simple example of using the <code>wasmtime compile</code> command:</p>
<p><div class="codehilite" data-code-language="Text only"><pre><span></span><code>$ wasmtime compile input.wasm
$ wasmtime input.cwasm
</code></pre></div><br>
</p>
</blockquote>



<a name="232361275"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232361275" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232361275">(Mar 30 2021 at 01:42)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2791">PR #2791</a> from <code>compile-command</code> to <code>main</code>.</p>



<a name="232374792"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232374792" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232374792">(Mar 30 2021 at 05:06)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#pullrequestreview-623847237">PR Review</a>.</p>



<a name="232374793"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232374793" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232374793">(Mar 30 2021 at 05:06)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r603784421">PR Review Comment</a>:</p>
<blockquote>
<p>*entries</p>
</blockquote>



<a name="232374851"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232374851" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232374851">(Mar 30 2021 at 05:07)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#pullrequestreview-623847888">PR Review</a>.</p>



<a name="232374852"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232374852" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232374852">(Mar 30 2021 at 05:07)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r603784905">PR Review Comment</a>:</p>
<blockquote>
<p><div class="codehilite" data-code-language="suggestion"><pre><span></span><code>const COMPILED_MODULE_HEADER: &amp;[u8] = b"\0wasmtimeaot";
</code></pre></div><br>
</p>
</blockquote>



<a name="232375805"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232375805" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232375805">(Mar 30 2021 at 05:24)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2791">PR #2791</a> from <code>compile-command</code> to <code>main</code>.</p>



<a name="232376037"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232376037" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232376037">(Mar 30 2021 at 05:29)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#pullrequestreview-623856322">PR Review</a>.</p>



<a name="232376038"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232376038" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232376038">(Mar 30 2021 at 05:29)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r603791918">PR Review Comment</a>:</p>
<blockquote>
<p>Are you sure I didn't mean uncastrated male horse? <span aria-label="scream" class="emoji emoji-1f631" role="img" title="scream">:scream:</span> </p>
<p>Good eye! I selected the wrong word in the spell checker drop-down menu it seems.</p>
</blockquote>



<a name="232376045"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232376045" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232376045">(Mar 30 2021 at 05:29)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2791">PR #2791</a> from <code>compile-command</code> to <code>main</code>.</p>



<a name="232438243"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232438243" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232438243">(Mar 30 2021 at 14:48)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#pullrequestreview-624321464">PR Review</a>.</p>



<a name="232438244"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232438244" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232438244">(Mar 30 2021 at 14:48)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r604141629">PR Review Comment</a>:</p>
<blockquote>
<p>I think that this can be done with <code>cranelift_other_flag(flag, "true")</code>, right? (not sure if we needed an extra method for this)</p>
</blockquote>



<a name="232438245"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232438245" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232438245">(Mar 30 2021 at 14:48)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#pullrequestreview-624321464">PR Review</a>.</p>



<a name="232438246"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232438246" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232438246">(Mar 30 2021 at 14:48)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r604143302">PR Review Comment</a>:</p>
<blockquote>
<p>FWIW this method can probably be removed since we can just hash the return value of <code>enabled_isa_flags</code> I think?</p>
</blockquote>



<a name="232438247"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232438247" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232438247">(Mar 30 2021 at 14:48)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r604145481">PR Review Comment</a>:</p>
<blockquote>
<p>I've seen this in a few places, could this perhaps be refactored to a common function in <code>src/lib.rs</code>?</p>
</blockquote>



<a name="232438248"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232438248" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232438248">(Mar 30 2021 at 14:48)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r604144518">PR Review Comment</a>:</p>
<blockquote>
<p>We may actually want to avoid this to avoid duplicating the logic below, and instead we could initialize <code>ret</code> like <code>wasm_backtrace_details</code> is initialized perhaps?</p>
</blockquote>



<a name="232438250"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232438250" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232438250">(Mar 30 2021 at 14:48)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r604142389">PR Review Comment</a>:</p>
<blockquote>
<p>Instead of being a separate constructor could this be a configuration method?</p>
<p>We could document <code>Config::new</code> as matching whatever the native machine is and then a <code>.target(..)</code> method which resets that internally?</p>
</blockquote>



<a name="232438251"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232438251" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232438251">(Mar 30 2021 at 14:48)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r604148068">PR Review Comment</a>:</p>
<blockquote>
<p>FWIW I was just thinking about this recently and how we might have to do this. It seems kinda bad that we're guaranteed to break anyone using these flags as soon as things stabilize, and it feels kinda odd having a mishmash of enable/disable.</p>
<p>To help reduce the clutter in the CLI options as well as to make this a bit more future proof, what do you think of something like:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="o">--</span><span class="n">wasm</span><span class="o">-</span><span class="n">features</span><span class="o">=+</span><span class="n">simd</span><span class="w"></span>
<span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="o">--</span><span class="n">wasm</span><span class="o">-</span><span class="n">features</span><span class="o">=-</span><span class="n">bulk</span><span class="o">-</span><span class="n">memory</span><span class="w"></span>
<span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="o">--</span><span class="n">wasm</span><span class="o">-</span><span class="n">features</span><span class="o">=+</span><span class="n">multi</span><span class="o">-</span><span class="n">value</span><span class="p">,</span><span class="o">-</span><span class="n">bulk</span><span class="o">-</span><span class="n">memory</span><span class="p">,</span><span class="o">+</span><span class="n">threads</span><span class="w"></span>
<span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="o">--</span><span class="n">wasm</span><span class="o">-</span><span class="n">features</span><span class="o">=+</span><span class="n">all</span><span class="w"></span>
</code></pre></div>
<p>(similar to LLVM features and <code>-Ctarget-feature</code> in Rust)</p>
<p>This also seems fine for me to file a follow-up too</p>
</blockquote>



<a name="232438252"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232438252" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232438252">(Mar 30 2021 at 14:48)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r604153537">PR Review Comment</a>:</p>
<blockquote>
<p>This sort of makes me think that we should lean towards <code>-C</code> flags which affect codegen. In any case though this might be good to lift into <code>CommonOptions</code> perhaps?</p>
</blockquote>



<a name="232438253"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232438253" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232438253">(Mar 30 2021 at 14:48)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r604156044">PR Review Comment</a>:</p>
<blockquote>
<p>Could this method perhaps be written as <code>Module::new(engine, bytes)?.serialize_into(output)</code>?</p>
<p>I'd ideally prefer to avoid having this method since it seems like it should be a trivial combination of a constructor plus a <code>serialize</code> invocation, and splitting it up shouldn't be all that much less ergonomic. (I'd imagine it's fine to add the compiled module header to serialized modules too and we could even support them in <code>Module::new</code> to automatically <code>deserialize</code> as well)</p>
</blockquote>



<a name="232438254"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232438254" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232438254">(Mar 30 2021 at 14:48)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r604152644">PR Review Comment</a>:</p>
<blockquote>
<p>I think it'd be best if we didn't have to list out flags like this. I find it pretty unwieldy for the CLI since <code>wasmtime --help</code> becomes <em>super</em> long in not always so interesting ways.</p>
<p>I thought that this could be done with <code>--cranelift-extra-flag has_znver1=true</code>, but that's naturally a whole lot more wordy than <code>--znver1</code>. Could we perhaps take some liberties and make this a bit more compact though? Similar to what I'm thinking below with wasm features we could do something like:</p>
<ul>
<li>Backends have the ability to return all possible flags (removing the need to keep the backend in sync with this file)</li>
<li>We have a general <code>--codegen-features=...</code> or something similar to Rust's <code>-C</code> flag where we do <code>-Ccranelift=...</code></li>
<li>The CLI would parse everything received and then match that against what the backend says is available, returning errors for anything enabled that the backend doesn't support</li>
<li>We could implement something like <code>--codegen-features=help</code> to print out a helpful listing of all codegen features (similar to <code>-Ctarget-feature=help</code>)</li>
</ul>
<p>I think that'd help reduce the need to keep this file in sync with the cranelift backends and also clean up the CLI UI perhaps?</p>
</blockquote>



<a name="232438256"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232438256" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232438256">(Mar 30 2021 at 14:48)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r604156706">PR Review Comment</a>:</p>
<blockquote>
<p>FWIW using <code>wat::parse_file</code> was done before because it automatically gives better error messages if the input file is <code>*.wat</code>. We can give rustc-style errors with filenames/line numbers and snippets outlined.</p>
</blockquote>



<a name="232438257"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232438257" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232438257">(Mar 30 2021 at 14:48)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r604160134">PR Review Comment</a>:</p>
<blockquote>
<p>FWIW for this to be a bit more robust I think we'd want to move this outside of the bincode-encoded payload. Bincode may change formats (perhaps?) or we could change the structure here which means that if you're mismatching versions you're unlikely to get the error about different versions, that's only if the binary formats happen to align well.</p>
</blockquote>



<a name="232438258"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232438258" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232438258">(Mar 30 2021 at 14:48)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r604158504">PR Review Comment</a>:</p>
<blockquote>
<p>With these various <code>check_*</code> methods we can probably remove the <code>Hash</code> implementation for <code>Compiler</code> since IIRC it's only really used for this?</p>
</blockquote>



<a name="232438259"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232438259" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232438259">(Mar 30 2021 at 14:48)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r604163216">PR Review Comment</a>:</p>
<blockquote>
<p>I always get this confused with the <code>isa_flags</code> below. Do you think we could use different names for these flags? IIRC there's like a two-level table of flags for cranelift ISAs, the "this applies to all targets" table and the "this applies to only one target" table. I think this is checking the target-independent table, right? And the <code>check_isa_flags</code> below is checking the target-specific table?</p>
<p>I basically found it a bit confusing to have this and <code>check_isa_flags</code> below.</p>
</blockquote>



<a name="232438260"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232438260" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232438260">(Mar 30 2021 at 14:48)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r604161846">PR Review Comment</a>:</p>
<blockquote>
<p>Do you think it's worth ignoring this? Out of the codegen options this is definitely one where it doesn't actually affect the output in a super meaningful way. An unoptimized <code>Engine</code> could easily take an optimized precompiled wasm module</p>
</blockquote>



<a name="232438261"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232438261" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232438261">(Mar 30 2021 at 14:48)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r604168260">PR Review Comment</a>:</p>
<blockquote>
<p>I wondering, instead of hashing all flags could we alter cranelift to return an iterator over enabled configuration settings and their values? That way we could store the full map here and have better error messages perhaps</p>
</blockquote>



<a name="232438262"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232438262" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232438262">(Mar 30 2021 at 14:48)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r604165040">PR Review Comment</a>:</p>
<blockquote>
<p>Similar to above using a destructuring statement to exhaustively list all fields I think might work well here too?</p>
</blockquote>



<a name="232438263"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232438263" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232438263">(Mar 30 2021 at 14:48)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r604164522">PR Review Comment</a>:</p>
<blockquote>
<p>Could this use named fields along the lines of:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">Tunables</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">static_memory_bound</span><span class="p">,</span><span class="w"> </span><span class="cm">/* ... */</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">tunables</span><span class="p">;</span><span class="w"></span>
<span class="c1">// .. check all the fields</span>
</code></pre></div>
<p>so when we add a field to <code>Tunables</code> we're sure to add a case here too?</p>
</blockquote>



<a name="232438264"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232438264" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232438264">(Mar 30 2021 at 14:48)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r604144806">PR Review Comment</a>:</p>
<blockquote>
<p>(ideally the same could be done for <code>opt_level</code> too)</p>
</blockquote>



<a name="232438265"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232438265" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232438265">(Mar 30 2021 at 14:48)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r604166015">PR Review Comment</a>:</p>
<blockquote>
<p>Also I've personally never been really that sold on the <code>impl Write</code> output for this sort of use case. It's hard for me to imagine where the output is so large it must be streamed rather than being held resident in memory.</p>
</blockquote>



<a name="232476249"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232476249" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232476249">(Mar 30 2021 at 18:43)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#pullrequestreview-624592778">PR Review</a>.</p>



<a name="232476250"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232476250" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232476250">(Mar 30 2021 at 18:43)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r604346886">PR Review Comment</a>:</p>
<blockquote>
<p>Unfortunately not; <code>Configurable::set</code> and <code>Configurable::enable</code> have different functionality relating to presets: the former will error for a preset whereas the latter applies it.</p>
</blockquote>



<a name="232476346"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232476346" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232476346">(Mar 30 2021 at 18:44)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#pullrequestreview-624593080">PR Review</a>.</p>



<a name="232476347"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232476347" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232476347">(Mar 30 2021 at 18:44)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r604347106">PR Review Comment</a>:</p>
<blockquote>
<p>That sounds good <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span>  I'll make that change.</p>
</blockquote>



<a name="232476659"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232476659" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232476659">(Mar 30 2021 at 18:46)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r604348248">PR Review Comment</a>:</p>
<blockquote>
<p>This is still used for the compiler's hash implementation to generate the unique-for-this-system hash used by the code cache.</p>
<p>Given that implementation is based on <code>Hash</code>, I felt it easier to just keep as-is than implement something else that could do the less-specific checks that deserializing the AOT artifact now does.</p>
</blockquote>



<a name="232476660"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232476660" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232476660">(Mar 30 2021 at 18:46)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#pullrequestreview-624594585">PR Review</a>.</p>



<a name="232476716"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232476716" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232476716">(Mar 30 2021 at 18:46)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#pullrequestreview-624594925">PR Review</a>.</p>



<a name="232476718"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232476718" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232476718">(Mar 30 2021 at 18:46)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r604348509">PR Review Comment</a>:</p>
<blockquote>
<p><span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span> I'll make this change to keep the two in sync.</p>
</blockquote>



<a name="232476758"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232476758" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232476758">(Mar 30 2021 at 18:46)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r604348659">PR Review Comment</a>:</p>
<blockquote>
<p>I'll extract this out.</p>
</blockquote>



<a name="232476759"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232476759" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232476759">(Mar 30 2021 at 18:46)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#pullrequestreview-624595133">PR Review</a>.</p>



<a name="232477633"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232477633" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232477633">(Mar 30 2021 at 18:52)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#pullrequestreview-624599739">PR Review</a>.</p>



<a name="232477634"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232477634" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232477634">(Mar 30 2021 at 18:52)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r604352326">PR Review Comment</a>:</p>
<blockquote>
<p>That makes sense to me.  I'll move this out and validate it from there.</p>
</blockquote>



<a name="232478344"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232478344" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232478344">(Mar 30 2021 at 18:57)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#pullrequestreview-624603832">PR Review</a>.</p>



<a name="232478345"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232478345" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232478345">(Mar 30 2021 at 18:57)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r604355417">PR Review Comment</a>:</p>
<blockquote>
<p>Agreed, there's no reason this can't be done.  The intention behind this was to keep the previous requirement of having the common flags match 1:1, but loosen the requirement behind the ISA flags as they are (currently) just CPU features and having the feature present on the host running the code (e.g. "I have AVX") while not targeted by AOT compilation (i.e. "I don't use AVX") should be allowed.</p>
<p>I can remove this check and allow the optimization level to differ (although I think it's a bit weird to say "I want to run this module as 'none' when it was already compiled optimized").</p>
</blockquote>



<a name="232478383"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232478383" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232478383">(Mar 30 2021 at 18:57)</a>:</h4>
<p>peterhuene edited <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r604355417">PR Review Comment</a>.</p>



<a name="232478618"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232478618" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232478618">(Mar 30 2021 at 18:59)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#pullrequestreview-624605443">PR Review</a>.</p>



<a name="232478619"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232478619" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232478619">(Mar 30 2021 at 18:59)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r604356627">PR Review Comment</a>:</p>
<blockquote>
<p>Agreed, it is confusing.  <code>flags_hash</code> here is the hash of the common/shared Cranelift flags and the <code>isa_flags</code> are those enabled by the target ISA (currently these are 1:1 with CPU features).</p>
<p>I can see about a better name.</p>
</blockquote>



<a name="232478885"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232478885" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232478885">(Mar 30 2021 at 19:00)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r604357481">PR Review Comment</a>:</p>
<blockquote>
<p>Excellent suggestion, I'll add that and we can then remove the assert on hashes as that was the intention for at least catching this case at runtime.</p>
</blockquote>



<a name="232478887"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232478887" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232478887">(Mar 30 2021 at 19:00)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#pullrequestreview-624606562">PR Review</a>.</p>



<a name="232478922"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232478922" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232478922">(Mar 30 2021 at 19:00)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#pullrequestreview-624606742">PR Review</a>.</p>



<a name="232478923"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232478923" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232478923">(Mar 30 2021 at 19:00)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r604357613">PR Review Comment</a>:</p>
<blockquote>
<p>Definitely will add <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span> </p>
</blockquote>



<a name="232479946"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232479946" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232479946">(Mar 30 2021 at 19:06)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#pullrequestreview-624611790">PR Review</a>.</p>



<a name="232479947"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232479947" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232479947">(Mar 30 2021 at 19:06)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r604361198">PR Review Comment</a>:</p>
<blockquote>
<p>I'll see what I can do to improve this.</p>
</blockquote>



<a name="232480056"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232480056" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232480056">(Mar 30 2021 at 19:07)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r604361520">PR Review Comment</a>:</p>
<blockquote>
<p>It's still used for the code cache, which remains <code>Hash</code>-based.</p>
</blockquote>



<a name="232480057"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232480057" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232480057">(Mar 30 2021 at 19:07)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#pullrequestreview-624612250">PR Review</a>.</p>



<a name="232480406"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232480406" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232480406">(Mar 30 2021 at 19:09)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#pullrequestreview-624613913">PR Review</a>.</p>



<a name="232480407"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232480407" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232480407">(Mar 30 2021 at 19:09)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r604362827">PR Review Comment</a>:</p>
<blockquote>
<p>Do you know how it does that as I'm looking at the implementation of <code>_parse_file</code> in <code>wat</code> and it seems to just read the file to a <code>Vec&lt;u8&gt;</code> and call <code>parse_bytes</code>, effectively what we're doing here?</p>
</blockquote>



<a name="232480678"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232480678" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232480678">(Mar 30 2021 at 19:10)</a>:</h4>
<p>peterhuene edited <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r604362827">PR Review Comment</a>.</p>



<a name="232481742"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232481742" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232481742">(Mar 30 2021 at 19:17)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#pullrequestreview-624620787">PR Review</a>.</p>



<a name="232481743"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232481743" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232481743">(Mar 30 2021 at 19:17)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r604368090">PR Review Comment</a>:</p>
<blockquote>
<p>I like that idea.</p>
<p>I propose that we keep the <code>--enable-XXX</code> as deprecated, undocumented flags for now for backcompat and to clean up <code>--help</code>, but perhaps break the <code>--enable-XXX false</code> options that only exist for the on-by-default ones by turning them back to bools; those users we'd steer to <code>--wasm-features=-XXX</code> immediately.</p>
<p>Re the name: might <code>wasm-features</code> be slightly redundant given this is _wasm_time?  Perhaps just <code>features</code>?</p>
</blockquote>



<a name="232483518"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232483518" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232483518">(Mar 30 2021 at 19:29)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#pullrequestreview-624629948">PR Review</a>.</p>



<a name="232483519"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232483519" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232483519">(Mar 30 2021 at 19:29)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r604374950">PR Review Comment</a>:</p>
<blockquote>
<p>There's one big reason we _don't_ call <code>Module::new</code> from <code>Module::compile</code>: this explicitly does not want to call <code>CompiledModule::from_artifacts_list</code> as that will register the JIT'd code for the platform.</p>
<p>The compilation might be for a target completely foreign to the host, so creating a <code>Module</code>, even a short-lived one that gets immediately serialized and dropped, doesn't make much sense.</p>
<p>In fact, given that <code>Config</code> can now have a foreign target, I propose that <code>Module</code>'s constructors should be verifying that the given config's target matches the host before even attempting JIT compilation.  I'll add that.</p>
<p>Re: <code>impl Write</code> I don't see much point in buffering unbounded data entirely in memory to immediately write it to disk and discard it like we'd do for the compile command.  I think, from an API-design perspective, that <code>impl Write</code> offers maximum flexibility for users of the API to do as they see fit: they can always just pass a <code>Vec&lt;u8&gt;</code> and be done.</p>
</blockquote>



<a name="232484752"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232484752" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232484752">(Mar 30 2021 at 19:37)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#pullrequestreview-624636169">PR Review</a>.</p>



<a name="232484754"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232484754" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232484754">(Mar 30 2021 at 19:37)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r604379548">PR Review Comment</a>:</p>
<blockquote>
<p>Lifting it into <code>CommonOptions</code> means <code>wasmtime run --interuptable foo.cwasm</code> would be possible, which to me doesn't make nearly as much sense as the <code>--wasm-timeout</code> option specific to the run command that inherently enables interruption in a useful way.</p>
<p>I think <code>wasmtime compile --interruptable foo.wasm</code> and then <code>wasmtime run --wasm-timeout 60s foo.cwasm</code> would make sense to users (the latter errors if <code>--interruptable</code> wasn't given to the compile command).</p>
<p>That said, though, I could be convinced that <code>wasmtime run --interruptable foo.cwasm</code> is a way to run a AOT module that was compiled with interruption support without specifying a timeout, similar to <code>--wasm-timeout &lt;some-reaaaaaally-long-timeout&gt;</code>.</p>
</blockquote>



<a name="232484954"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232484954" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232484954">(Mar 30 2021 at 19:39)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#pullrequestreview-624637357">PR Review</a>.</p>



<a name="232484955"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232484955" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232484955">(Mar 30 2021 at 19:39)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r604380495">PR Review Comment</a>:</p>
<blockquote>
<p>Oh whoops, I missed the <code>set_path</code> call in the error handling.  I'll change this back.</p>
</blockquote>



<a name="232485881"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232485881" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232485881">(Mar 30 2021 at 19:46)</a>:</h4>
<p>peterhuene edited <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r604380495">PR Review Comment</a>.</p>



<a name="232487815"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232487815" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232487815">(Mar 30 2021 at 19:59)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#pullrequestreview-624653107">PR Review</a>.</p>



<a name="232487816"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232487816" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232487816">(Mar 30 2021 at 19:59)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r604392537">PR Review Comment</a>:</p>
<blockquote>
<p>As I'd like to avoid opening the file twice (once to check if the AOT header is present before handing it off to <code>wat::parse_file</code> which opens the file in turn), do you think we could add a <code>wat::Error::set_path</code> method that sets the path if the underlying error kind is <code>Wast</code>?</p>
</blockquote>



<a name="232487893"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232487893" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232487893">(Mar 30 2021 at 20:00)</a>:</h4>
<p>peterhuene edited <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r604392537">PR Review Comment</a>.</p>



<a name="232488062"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232488062" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232488062">(Mar 30 2021 at 20:00)</a>:</h4>
<p>peterhuene edited <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r604392537">PR Review Comment</a>.</p>



<a name="232489408"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232489408" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232489408">(Mar 30 2021 at 20:09)</a>:</h4>
<p>peterhuene edited <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r604368090">PR Review Comment</a>.</p>



<a name="232489677"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232489677" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232489677">(Mar 30 2021 at 20:11)</a>:</h4>
<p>peterhuene edited <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r604368090">PR Review Comment</a>.</p>



<a name="232490066"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232490066" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232490066">(Mar 30 2021 at 20:13)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#pullrequestreview-624663926">PR Review</a>.</p>



<a name="232490067"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232490067" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232490067">(Mar 30 2021 at 20:13)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r604400625">PR Review Comment</a>:</p>
<blockquote>
<p>I like the idea of a <code>--codegen-features</code> option.  This will require a bit of refactoring in the generated code for Cranelift's settings as the metadata about the settings isn't suitable for describing the settings to users this way.</p>
<p>I'll see what I can make happen.<br>
</p>
</blockquote>



<a name="232501574"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232501574" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232501574">(Mar 30 2021 at 21:33)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#pullrequestreview-624722666">PR Review</a>.</p>



<a name="232501575"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232501575" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232501575">(Mar 30 2021 at 21:33)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r604446523">PR Review Comment</a>:</p>
<blockquote>
<p>I've opened <a href="https://github.com/bytecodealliance/wasm-tools/pull/252">https://github.com/bytecodealliance/wasm-tools/pull/252</a> that would allow us to set the path in the error without having to resort to opening the file twice.</p>
</blockquote>



<a name="232518122"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232518122" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232518122">(Mar 31 2021 at 00:24)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2791">PR #2791</a> from <code>compile-command</code> to <code>main</code>.</p>



<a name="232544664"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232544664" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232544664">(Mar 31 2021 at 06:59)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2791">PR #2791</a> from <code>compile-command</code> to <code>main</code>.</p>



<a name="232544670"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232544670" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232544670">(Mar 31 2021 at 06:59)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#pullrequestreview-624951295">PR Review</a>.</p>



<a name="232544673"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232544673" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232544673">(Mar 31 2021 at 06:59)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r604642085">PR Review Comment</a>:</p>
<blockquote>
<p>I've added a <code>--wasm-features</code> option with the latest commit.</p>
</blockquote>



<a name="232545066"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232545066" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232545066">(Mar 31 2021 at 07:03)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2791">PR #2791</a> from <code>compile-command</code> to <code>main</code>.</p>



<a name="232603321"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232603321" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232603321">(Mar 31 2021 at 14:41)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r604955396">PR Review Comment</a>:</p>
<blockquote>
<p><span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span> </p>
</blockquote>



<a name="232603350"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232603350" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232603350">(Mar 31 2021 at 14:41)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#pullrequestreview-625357441">PR Review</a>.</p>



<a name="232603351"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232603351" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232603351">(Mar 31 2021 at 14:41)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r604947597">PR Review Comment</a>:</p>
<blockquote>
<p>Perhaps we could just outright remove this method now? With <code>Config::target</code> it doesn't seem too useful any more</p>
</blockquote>



<a name="232603353"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232603353" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232603353">(Mar 31 2021 at 14:41)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r604948225">PR Review Comment</a>:</p>
<blockquote>
<p>Could this method (the one below that I can't actually comment on) be renamed to <code>cranelift_flag_set</code> to mirror the <code>cranelift_flag_enable</code>?</p>
</blockquote>



<a name="232603355"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232603355" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232603355">(Mar 31 2021 at 14:41)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#pullrequestreview-625357441">PR Review</a>.</p>



<a name="232603364"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232603364" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232603364">(Mar 31 2021 at 14:42)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r604952828">PR Review Comment</a>:</p>
<blockquote>
<p>Yeah that was kind of my thinking where you could evaluate the overhead of interruptability with <code>wasmtime run --interruptable</code>, but I don't think it's super important so seems fine to stay here for now.</p>
</blockquote>



<a name="232603365"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232603365" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232603365">(Mar 31 2021 at 14:42)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r604954459">PR Review Comment</a>:</p>
<blockquote>
<p>Nah seems fine to just leave this until it trips someone up.</p>
</blockquote>



<a name="232603367"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232603367" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232603367">(Mar 31 2021 at 14:42)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r604950853">PR Review Comment</a>:</p>
<blockquote>
<p>To bikeshed a bit, could this perhaps be called <code>cranelift_enable</code> and the above method is called <code>cranelift_set</code>? (I figure that if cranelift wants two different operations we could probably mostly just try to mirror them here well enough</p>
</blockquote>



<a name="232603430"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232603430" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232603430">(Mar 31 2021 at 14:42)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#pullrequestreview-625370504">PR Review</a>.</p>



<a name="232603479"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232603479" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232603479">(Mar 31 2021 at 14:42)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r604957154">PR Review Comment</a>:</p>
<blockquote>
<p>Bah ok, well in that case we should probably lean into this naming in all the various places, either <code>set</code> or <code>enable</code> I think to be consistent about what maps to what</p>
</blockquote>



<a name="232604050"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232604050" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232604050">(Mar 31 2021 at 14:45)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#pullrequestreview-625371632">PR Review</a>.</p>



<a name="232604137"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232604137" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232604137">(Mar 31 2021 at 14:46)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r604957942">PR Review Comment</a>:</p>
<blockquote>
<p>Ah ok seems fine to leave for now in that case. I think this means, though, that we're ripe to refactor that part now too and use the same serialization/deserialization system at some point, but that's fine to happen later.</p>
</blockquote>



<a name="232604508"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232604508" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232604508">(Mar 31 2021 at 14:48)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#pullrequestreview-625376421">PR Review</a>.</p>



<a name="232605046"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232605046" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232605046">(Mar 31 2021 at 14:51)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r604961427">PR Review Comment</a>:</p>
<blockquote>
<p>Ah I see, those are good points. I think though I'd ideally still like to push on a small set of constructors for <code>Module</code> instead of a standalone <code>compile</code> function. Could we perhaps defer the registration of JIT'd code for the platform to instantiation? I'm imagining we could have a <code>Mutex</code> of some kind which mutates the state of <code>Module</code> the first time it's instantiated or something like that.</p>
<p>Personally I think it'd be a bummer if, when using cross-compilation, you're forced to never touch <code>Module::new</code> and friends and you instead have to use <code>Module::compile</code>, but there's no real fundamental reason to do so per se.</p>
<p>Another possible alternative is that if the module looks cross-compiled we just never do the registration bits (and somehow we should error-out in <code>Instantiate</code> if the target actually mismatches the current host...), but I think I'd prefer to have the defer for now to avoid registering jit code on hosts where you don't actually do any instantiation.</p>
</blockquote>



<a name="232646465"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232646465" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232646465">(Mar 31 2021 at 19:01)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#pullrequestreview-625624148">PR Review</a>.</p>



<a name="232646466"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232646466" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232646466">(Mar 31 2021 at 19:01)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r605148141">PR Review Comment</a>:</p>
<blockquote>
<p>I'm still inclined to believe that constructing a <code>Module</code> implies it's usable (i.e.instantiatable) for the current host.  I think the constructors should error if 1) the module is AOT-compiled for a different target or 2) the associated <code>Config</code> has a target other than host and thus JIT doesn't make sense.</p>
<p>I'm also inclined to believe that it's not desirable to produce a <code>Module</code> for AOT compilation (even internally) as the point of AOT compilation is getting an artifact that can be loaded _at a later time_ and likely from a different host.  I think that anyone making use of <code>Module::compile</code> would not be using <code>Module::new</code> on the artifact from the same host as doing AOT compilation and loading it on the same host isn't gaining anything over the code cache.</p>
<p>It's not just code registration that we're skipping in <code>Module::compile</code> currently, but all the work done to get the module ready to be executed (i.e. "linking it" - copying the text sections into executable memory, applying relocations, etc.), none of which is required for AOT compilation.</p>
<p>To me, at least, AOT compilation is a pretty explicit action that's independent of constructing a <code>Module</code> that can be executed.  Perhaps <code>Module::compile</code> isn't the best place for this, but I am strongly in favor of now allowing a <code>Module</code> to construct if the target isn't for host.</p>
</blockquote>



<a name="232646656"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232646656" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232646656">(Mar 31 2021 at 19:02)</a>:</h4>
<p>peterhuene edited <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r605148141">PR Review Comment</a>.</p>



<a name="232647569"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232647569" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232647569">(Mar 31 2021 at 19:08)</a>:</h4>
<p>peterhuene edited <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r605148141">PR Review Comment</a>.</p>



<a name="232648900"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232648900" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232648900">(Mar 31 2021 at 19:17)</a>:</h4>
<p>peterhuene edited <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r605148141">PR Review Comment</a>.</p>



<a name="232668107"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232668107" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232668107">(Mar 31 2021 at 21:29)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#pullrequestreview-625734809">PR Review</a>.</p>



<a name="232668108"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232668108" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232668108">(Mar 31 2021 at 21:29)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r605233113">PR Review Comment</a>:</p>
<blockquote>
<p>My main worry is that having <code>Module::{new, compile}</code> could possibly be confusing for users because they both look like constructors and most might even lean towards "compile" since wasm is generally understood to be compiled to native code. Perhaps though we can solve all this by tweaking things a bit API-wise.</p>
<p>In a hypothetical future version of the <code>wasmtime</code> crate you'll be able to jettison the runtime entirely and instead only have the cranelift compiler (and vice versa, you could only have the runtime without the compiler). In this hypothetical world if <code>Module</code> is a "ready to instantiate module" then we wouldn't want to expose it from the version of the crate that is missing the runtime. That would put <code>Module::compile</code> in a weird place since it needs to exist but the type it's attached to doesn't want to exist.</p>
<p>Perhaps we could solve this by moving the method to <code>Engine::compile</code>? That way it's theoretically far away enough api-wise to not confuse users, we'll still have an <code>Engine</code> even with all modes of the wasmtime crate (whether you're removing the runtime or not), and we can clearly document that it's only intended for ahead-of-time-compiled cases.</p>
<p>I think though that I would still want to tweak things a bit ideally:</p>
<ul>
<li>I think the format of the data from <code>Module::compile</code> and <code>Module::serialize</code> should be the same</li>
<li>We could probably remove <code>Module::deserialize</code> and just document more sources of binary data for <code>Module::new</code> and/or <code>from_binary</code></li>
<li>Personally I would still like to remove the <code>impl Write</code> in favor of just returning a <code>Vec&lt;u8&gt;</code>. I think that working with a <code>Vec&lt;u8&gt;</code> is generally more convenient and if we really need it for performance we could always add something like <code>compile_into</code> or <code>serialize_into</code>.</li>
</ul>
<p>How does that all sound?</p>
</blockquote>



<a name="232668898"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232668898" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232668898">(Mar 31 2021 at 21:35)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r605236136">PR Review Comment</a>:</p>
<blockquote>
<p>I'm on-board with everything you just proposed; I agree that moving <code>compile</code> out of <code>Module</code> into (perhaps) <code>Engine::compile_module</code> would make it clear that this is not useful for constructing a <code>Module</code> itself.</p>
<p>I also am not opposed to using <code>Vec&lt;u8&gt;</code> instead of <code>impl Write</code>; agree that it's easy enough to enhance if necessary in the future.</p>
</blockquote>



<a name="232668899"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232668899" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232668899">(Mar 31 2021 at 21:35)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#pullrequestreview-625738601">PR Review</a>.</p>



<a name="232670346"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232670346" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232670346">(Mar 31 2021 at 21:47)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#pullrequestreview-625745644">PR Review</a>.</p>



<a name="232670347"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232670347" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232670347">(Mar 31 2021 at 21:47)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r605241899">PR Review Comment</a>:</p>
<blockquote>
<p>Oh actually a nice name might be <code>precompile_module</code> or something like that to emphasize it a bit more?</p>
</blockquote>



<a name="232677092"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232677092" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232677092">(Mar 31 2021 at 22:44)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#pullrequestreview-625775924">PR Review</a>.</p>



<a name="232677093"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232677093" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232677093">(Mar 31 2021 at 22:44)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r605266773">PR Review Comment</a>:</p>
<blockquote>
<p>Even better!</p>
</blockquote>



<a name="232707566"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232707566" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232707566">(Apr 01 2021 at 05:48)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2791">PR #2791</a> from <code>compile-command</code> to <code>main</code>.</p>



<a name="232707686"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232707686" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232707686">(Apr 01 2021 at 05:50)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#pullrequestreview-625918535">PR Review</a>.</p>



<a name="232707687"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232707687" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232707687">(Apr 01 2021 at 05:50)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r605391469">PR Review Comment</a>:</p>
<blockquote>
<p>Okay, so I kept the <code>--cranelift-set</code> and <code>--cranelift-enable</code> flags, removed the various Cranelift flags from <code>wasmtime compile</code>, and added a <code>wasmtime settings</code> command that prints out the available settings for the target triple, e.g.:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">settings</span><span class="w"></span>
<span class="n">Cranelift</span><span class="w"> </span><span class="n">settings</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">target</span><span class="w"> </span><span class="o">'</span><span class="na">x86_64</span><span class="o">-</span><span class="n">apple</span><span class="o">-</span><span class="n">darwin</span><span class="o">'</span>:

<span class="nc">Boolean</span><span class="w"> </span><span class="n">settings</span>:
  <span class="nc">has_sse3</span><span class="w">       </span><span class="n">Has</span><span class="w"> </span><span class="n">support</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">SSE3</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="n">has_ssse3</span><span class="w">      </span><span class="n">Has</span><span class="w"> </span><span class="n">support</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">SSSE3</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="n">has_sse41</span><span class="w">      </span><span class="n">Has</span><span class="w"> </span><span class="n">support</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">SSE4</span><span class="p">.</span><span class="mf">1.</span><span class="w"></span>
<span class="w">  </span><span class="n">has_sse42</span><span class="w">      </span><span class="n">Has</span><span class="w"> </span><span class="n">support</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">SSE4</span><span class="p">.</span><span class="mf">2.</span><span class="w"></span>
<span class="w">  </span><span class="n">has_avx</span><span class="w">        </span><span class="n">Has</span><span class="w"> </span><span class="n">support</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">AVX</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="n">has_avx2</span><span class="w">       </span><span class="n">Has</span><span class="w"> </span><span class="n">support</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">AVX2</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="n">has_avx512dq</span><span class="w">   </span><span class="n">Has</span><span class="w"> </span><span class="n">support</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">AVX512DQ</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="n">has_avx512vl</span><span class="w">   </span><span class="n">Has</span><span class="w"> </span><span class="n">support</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">AVX512VL</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="n">has_avx512f</span><span class="w">    </span><span class="n">Has</span><span class="w"> </span><span class="n">support</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">AVX512F</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="n">has_popcnt</span><span class="w">     </span><span class="n">Has</span><span class="w"> </span><span class="n">support</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">POPCNT</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="n">has_bmi1</span><span class="w">       </span><span class="n">Has</span><span class="w"> </span><span class="n">support</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">BMI1</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="n">has_bmi2</span><span class="w">       </span><span class="n">Has</span><span class="w"> </span><span class="n">support</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">BMI2</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="n">has_lzcnt</span><span class="w">      </span><span class="n">Has</span><span class="w"> </span><span class="n">support</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">LZCNT</span><span class="p">.</span><span class="w"></span>

<span class="n">Presets</span>:
  <span class="nc">baseline</span><span class="w">     </span><span class="n">A</span><span class="w"> </span><span class="n">baseline</span><span class="w"> </span><span class="n">preset</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">no</span><span class="w"> </span><span class="n">extensions</span><span class="w"> </span><span class="n">enabled</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="n">nehalem</span><span class="w">      </span><span class="n">Nehalem</span><span class="w"> </span><span class="n">microarchitecture</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="n">haswell</span><span class="w">      </span><span class="n">Haswell</span><span class="w"> </span><span class="n">microarchitecture</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="n">broadwell</span><span class="w">    </span><span class="n">Broadwell</span><span class="w"> </span><span class="n">microarchitecture</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="n">skylake</span><span class="w">      </span><span class="n">Skylake</span><span class="w"> </span><span class="n">microarchitecture</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="n">cannonlake</span><span class="w">   </span><span class="n">Canon</span><span class="w"> </span><span class="n">Lake</span><span class="w"> </span><span class="n">microarchitecture</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="n">icelake</span><span class="w">      </span><span class="n">Ice</span><span class="w"> </span><span class="n">Lake</span><span class="w"> </span><span class="n">microarchitecture</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="n">znver1</span><span class="w">       </span><span class="n">Zen</span><span class="w"> </span><span class="p">(</span><span class="n">first</span><span class="w"> </span><span class="n">generation</span><span class="p">)</span><span class="w"> </span><span class="n">microarchitecture</span><span class="p">.</span><span class="w"></span>

<span class="n">Settings</span><span class="w"> </span><span class="n">enabled</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">host</span>:
  <span class="o">-</span><span class="w"> </span><span class="n">has_sse3</span><span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">has_ssse3</span><span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">has_sse41</span><span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">has_sse42</span><span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">has_avx</span><span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">has_avx2</span><span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">has_popcnt</span><span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">has_bmi1</span><span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">has_bmi2</span><span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">has_lzcnt</span><span class="w"></span>
</code></pre></div>
<p>I've pushed up the commit, so let me know if this is inline with what you were thinking.</p>
</blockquote>



<a name="232707923"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232707923" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232707923">(Apr 01 2021 at 05:54)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#pullrequestreview-625920258">PR Review</a>.</p>



<a name="232707924"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232707924" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232707924">(Apr 01 2021 at 05:54)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r605392886">PR Review Comment</a>:</p>
<blockquote>
<p>The command intentionally doesn't present any of the "shared" settings as those really shouldn't be mucked around with by users, but we allow them for <code>--cranelift-set</code>/<code>--cranelift-enable</code> for users that know what they're doing.</p>
</blockquote>



<a name="232708060"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232708060" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232708060">(Apr 01 2021 at 05:56)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2791">PR #2791</a> from <code>compile-command</code> to <code>main</code>.</p>



<a name="232708436"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232708436" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232708436">(Apr 01 2021 at 06:02)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2791">PR #2791</a> from <code>compile-command</code> to <code>main</code>.</p>



<a name="232711650"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232711650" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232711650">(Apr 01 2021 at 06:48)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2791">PR #2791</a> from <code>compile-command</code> to <code>main</code>.</p>



<a name="232711909"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232711909" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232711909">(Apr 01 2021 at 06:53)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2791">PR #2791</a> from <code>compile-command</code> to <code>main</code>.</p>



<a name="232713290"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232713290" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232713290">(Apr 01 2021 at 07:09)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2791">PR #2791</a> from <code>compile-command</code> to <code>main</code>.</p>



<a name="232716226"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232716226" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232716226">(Apr 01 2021 at 07:39)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2791">PR #2791</a> from <code>compile-command</code> to <code>main</code>.</p>



<a name="232766532"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232766532" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232766532">(Apr 01 2021 at 14:33)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#pullrequestreview-626323844">PR Review</a>.</p>



<a name="232766533"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232766533" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232766533">(Apr 01 2021 at 14:33)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r605700403">PR Review Comment</a>:</p>
<blockquote>
<p>Technically I think we might want to check a number of things here in the limit, e.g. if you enable avx512 or something like that but you don't have it we should probably bail out here at some point. I'm fine with that being a FIXME though to basically check things other than just the target.</p>
</blockquote>



<a name="232766534"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232766534" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232766534">(Apr 01 2021 at 14:33)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r605702428">PR Review Comment</a>:</p>
<blockquote>
<p>Reading this again, is there perhaps a method on a<code>target_lexicon</code> for checking this? For example if the arch/os match you could I suppose in theory have a glibc/musl mismatch which would prevent running things. That's never an issue for us in wasmtime but this seems like an abstract thing <code>target_lexicon</code> might handle for us.</p>
</blockquote>



<a name="232766535"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232766535" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232766535">(Apr 01 2021 at 14:33)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r605706444">PR Review Comment</a>:</p>
<blockquote>
<p>Are these groups still applicable? (I won't pretend to know what clap is doing here)</p>
</blockquote>



<a name="232766537"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232766537" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232766537">(Apr 01 2021 at 14:33)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r605699180">PR Review Comment</a>:</p>
<blockquote>
<p>Could the documentation be expanded here to mention that the intent of this method is that you'd take these bytes to <code>Module::new</code> at some other time, perhaps on a different machine or in a different process?</p>
</blockquote>



<a name="232766538"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232766538" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232766538">(Apr 01 2021 at 14:33)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r605707092">PR Review Comment</a>:</p>
<blockquote>
<p>That looks fantastic to me, thanks for doing that!</p>
</blockquote>



<a name="232766674"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232766674" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232766674">(Apr 01 2021 at 14:34)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#pullrequestreview-626335220">PR Review</a>.</p>



<a name="232805861"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232805861" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232805861">(Apr 01 2021 at 18:47)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#pullrequestreview-626555099">PR Review</a>.</p>



<a name="232805862"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232805862" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232805862">(Apr 01 2021 at 18:47)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r605873712">PR Review Comment</a>:</p>
<blockquote>
<p>There's nothing I can see in <code>target_lexicon</code> (re: a "compatibility check") that would be useful here.  Did you happen to spot something that might be?</p>
</blockquote>



<a name="232805910"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232805910" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232805910">(Apr 01 2021 at 18:48)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#pullrequestreview-626555222">PR Review</a>.</p>



<a name="232805913"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232805913" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232805913">(Apr 01 2021 at 18:48)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r605873828">PR Review Comment</a>:</p>
<blockquote>
<p>Good eye, these should be removed.</p>
</blockquote>



<a name="232853668"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232853668" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232853668">(Apr 02 2021 at 02:55)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2791">PR #2791</a> from <code>compile-command</code> to <code>main</code>.</p>



<a name="232853676"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232853676" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232853676">(Apr 02 2021 at 02:55)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#pullrequestreview-626761897">PR Review</a>.</p>



<a name="232853677"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232853677" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232853677">(Apr 02 2021 at 02:55)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r606046980">PR Review Comment</a>:</p>
<blockquote>
<p>I've removed <code>flags_hash</code> in favor of storing all of the shared and ISA-specific settings in the compiled module.</p>
</blockquote>



<a name="232853735"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232853735" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232853735">(Apr 02 2021 at 02:56)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#pullrequestreview-626762040">PR Review</a>.</p>



<a name="232853737"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232853737" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232853737">(Apr 02 2021 at 02:56)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r606047104">PR Review Comment</a>:</p>
<blockquote>
<p>I've done just that; we now store all the shared and ISA-specific settings in the compiled module and can now print out which of the shared flags is missing or different.</p>
</blockquote>



<a name="232854742"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232854742" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232854742">(Apr 02 2021 at 03:12)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2791">PR #2791</a> from <code>compile-command</code> to <code>main</code>.</p>



<a name="232859534"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232859534" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232859534">(Apr 02 2021 at 04:40)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2791">PR #2791</a> from <code>compile-command</code> to <code>main</code>.</p>



<a name="232910146"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232910146" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232910146">(Apr 02 2021 at 15:13)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#pullrequestreview-627038488">PR Review</a>.</p>



<a name="232910147"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232910147" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232910147">(Apr 02 2021 at 15:13)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r606280443">PR Review Comment</a>:</p>
<blockquote>
<p>Nah this is more of just a random musing.</p>
</blockquote>



<a name="232910148"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232910148" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232910148">(Apr 02 2021 at 15:13)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#pullrequestreview-627038488">PR Review</a>.</p>



<a name="232930170"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232930170" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232930170">(Apr 02 2021 at 17:49)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#pullrequestreview-627148676">PR Review</a>.</p>



<a name="232930171"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232930171" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232930171">(Apr 02 2021 at 17:49)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r606347097">PR Review Comment</a>:</p>
<blockquote>
<p>One possible backwards-compatibility consideration: it looks like this will result in no encoding of default options in the saved compiled module, but if we later change a default in an incompatible way, would we want to catch that?</p>
<p>(It's entirely possible that this is made irrelevant by some other versioning -- do you encode e.g. a git hash or wasmtime version in the <code>.cwasm</code> file too?)</p>
</blockquote>



<a name="232933257"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232933257" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232933257">(Apr 02 2021 at 18:14)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#pullrequestreview-627160621">PR Review</a>.</p>



<a name="232933258"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232933258" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232933258">(Apr 02 2021 at 18:14)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r606356580">PR Review Comment</a>:</p>
<blockquote>
<p>Agreed that there are way too many ways incompatibilities can be introduced, so to combat that we do indeed record the version in the cwasm and must be an identical match for now.</p>
</blockquote>



<a name="232933317"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232933317" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232933317">(Apr 02 2021 at 18:15)</a>:</h4>
<p>peterhuene edited <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r606356580">PR Review Comment</a>.</p>



<a name="232933505"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232933505" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232933505">(Apr 02 2021 at 18:16)</a>:</h4>
<p>peterhuene edited <a href="https://github.com/bytecodealliance/wasmtime/pull/2791#discussion_r606356580">PR Review Comment</a>.</p>



<a name="232933675"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232791%20Add%20a%20compile%20command%20to%20Wasmtime./near/232933675" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232791.20Add.20a.20compile.20command.20to.20Wasmtime.2E.html#232933675">(Apr 02 2021 at 18:18)</a>:</h4>
<p>peterhuene merged <a href="https://github.com/bytecodealliance/wasmtime/pull/2791">PR #2791</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>