<html>
<head><meta charset="utf-8"><title>wasmtime / PR #2550 wiggle: introduce Trap enum · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232550.20wiggle.3A.20introduce.20Trap.20enum.html">wasmtime / PR #2550 wiggle: introduce Trap enum</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="221727009"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232550%20wiggle%3A%20introduce%20Trap%20enum/near/221727009" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232550.20wiggle.3A.20introduce.20Trap.20enum.html#221727009">(Jan 06 2021 at 02:23)</a>:</h4>
<p>pchickey opened <a href="https://github.com/bytecodealliance/wasmtime/pull/2550">PR #2550</a> from <code>pch/wiggle_trapping</code> to <code>main</code>:</p>
<blockquote>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;<br>
</p>
</blockquote>



<a name="221727417"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232550%20wiggle%3A%20introduce%20Trap%20enum/near/221727417" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232550.20wiggle.3A.20introduce.20Trap.20enum.html#221727417">(Jan 06 2021 at 02:31)</a>:</h4>
<p>pchickey updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2550">PR #2550</a> from <code>pch/wiggle_trapping</code> to <code>main</code>:</p>
<blockquote>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;<br>
</p>
</blockquote>



<a name="221776467"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232550%20wiggle%3A%20introduce%20Trap%20enum/near/221776467" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232550.20wiggle.3A.20introduce.20Trap.20enum.html#221776467">(Jan 06 2021 at 15:00)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2550#pullrequestreview-562776453">PR Review</a>.</p>



<a name="221807119"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232550%20wiggle%3A%20introduce%20Trap%20enum/near/221807119" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232550.20wiggle.3A.20introduce.20Trap.20enum.html#221807119">(Jan 06 2021 at 18:57)</a>:</h4>
<p>pchickey updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2550">PR #2550</a> from <code>pch/wiggle_trapping</code> to <code>main</code>:</p>
<blockquote>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;<br>
</p>
</blockquote>



<a name="221815138"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232550%20wiggle%3A%20introduce%20Trap%20enum/near/221815138" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232550.20wiggle.3A.20introduce.20Trap.20enum.html#221815138">(Jan 06 2021 at 20:01)</a>:</h4>
<p>pchickey updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2550">PR #2550</a> from <code>pch/wiggle_trapping</code> to <code>main</code>:</p>
<blockquote>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;<br>
</p>
</blockquote>



<a name="221825796"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232550%20wiggle%3A%20introduce%20Trap%20enum/near/221825796" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232550.20wiggle.3A.20introduce.20Trap.20enum.html#221825796">(Jan 06 2021 at 21:25)</a>:</h4>
<p>pchickey updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2550">PR #2550</a> from <code>pch/wiggle_trapping</code> to <code>main</code>:</p>
<blockquote>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;<br>
</p>
</blockquote>



<a name="221828127"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232550%20wiggle%3A%20introduce%20Trap%20enum/near/221828127" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232550.20wiggle.3A.20introduce.20Trap.20enum.html#221828127">(Jan 06 2021 at 21:49)</a>:</h4>
<p>pchickey updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2550">PR #2550</a> from <code>pch/wiggle_trapping</code> to <code>main</code>:</p>
<blockquote>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;<br>
</p>
</blockquote>



<a name="221830217"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232550%20wiggle%3A%20introduce%20Trap%20enum/near/221830217" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232550.20wiggle.3A.20introduce.20Trap.20enum.html#221830217">(Jan 06 2021 at 22:09)</a>:</h4>
<p>pchickey updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2550">PR #2550</a> from <code>pch/wiggle_trapping</code> to <code>main</code>:</p>
<blockquote>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;<br>
</p>
</blockquote>



<a name="221991086"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232550%20wiggle%3A%20introduce%20Trap%20enum/near/221991086" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232550.20wiggle.3A.20introduce.20Trap.20enum.html#221991086">(Jan 07 2021 at 19:45)</a>:</h4>
<p>pchickey updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2550">PR #2550</a> from <code>pch/wiggle_trapping</code> to <code>main</code>:</p>
<blockquote>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;<br>
</p>
</blockquote>



<a name="222006134"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232550%20wiggle%3A%20introduce%20Trap%20enum/near/222006134" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232550.20wiggle.3A.20introduce.20Trap.20enum.html#222006134">(Jan 07 2021 at 21:49)</a>:</h4>
<p>pchickey edited <a href="https://github.com/bytecodealliance/wasmtime/pull/2550">PR #2550</a> from <code>pch/wiggle_trapping</code> to <code>main</code>:</p>
<blockquote>
<p>This improves the design of Wiggle's ability to terminate WebAssembly execution by introducing a new<br>
<code>enum Trap { I32Exit(i32), String(String) }</code>.</p>
<p>Previously, Wiggle users could terminate WebAssembly by giving an <code>Err(String)</code> in the <code>UserErrorConversion</code> impl. This has evolved into <code>Err(wiggle::Trap)</code>, so that the termination can either give a human-readable trap, or an i32 exit code.</p>
<p>The big win here is we can finally implement wasi's <code>proc_exit</code> function in "pure" Wiggle, without the function override facility. So, this change has been threaded through the <code>wasi-common</code> crate and then into <code>wasi-wasmtime</code>.</p>
<p>I even uncovered some cli tests that technically didn't conform to the Wasi command spec because they didn't export a memory - wiggle now catches this, the old proc_exit override did not. These were trivially fixed.</p>
<p>The function override facility has been left in Wiggle for the time being, but I expect to remove it soon.</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;<br>
</p>
</blockquote>



<a name="222008177"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232550%20wiggle%3A%20introduce%20Trap%20enum/near/222008177" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232550.20wiggle.3A.20introduce.20Trap.20enum.html#222008177">(Jan 07 2021 at 22:05)</a>:</h4>
<p>pchickey edited <a href="https://github.com/bytecodealliance/wasmtime/pull/2550">PR #2550</a> from <code>pch/wiggle_trapping</code> to <code>main</code>:</p>
<blockquote>
<p>This improves the design of Wiggle's ability to terminate WebAssembly execution by introducing a new<br>
<code>enum Trap { I32Exit(i32), String(String) }</code>.</p>
<p>Previously, Wiggle users could terminate WebAssembly by giving an <code>Err(String)</code> in the <code>UserErrorConversion</code> impl. This has evolved into <code>Err(wiggle::Trap)</code>, so that the termination can either give a human-readable trap, or an i32 exit code.</p>
<p>The big win here is we can finally implement wasi's <code>proc_exit</code> function in "pure" Wiggle, without the function override facility. So, this change has been threaded through the <code>wasi-common</code> crate and then into <code>wasi-wasmtime</code>.</p>
<p>I even uncovered some cli tests that technically didn't conform to the Wasi command spec because they didn't export a memory - wiggle now catches this, the old proc_exit override did not. These were trivially fixed.</p>
<p>Finally, instead of leaving the <code>unimplemented!</code> macro in the several spots in the wasi trait, I replaced them with an <code>Error::Unsupported</code> variant that produces a <code>Trap</code>.</p>
<p>The function override facility has been left in Wiggle for the time being, but I expect to remove it soon.</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;<br>
</p>
</blockquote>



<a name="222008211"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232550%20wiggle%3A%20introduce%20Trap%20enum/near/222008211" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232550.20wiggle.3A.20introduce.20Trap.20enum.html#222008211">(Jan 07 2021 at 22:05)</a>:</h4>
<p><strong>pchickey</strong> has marked <a href="https://github.com/bytecodealliance/wasmtime/pull/2550">PR #2550</a> as ready for review.</p>



<a name="222008326"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232550%20wiggle%3A%20introduce%20Trap%20enum/near/222008326" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232550.20wiggle.3A.20introduce.20Trap.20enum.html#222008326">(Jan 07 2021 at 22:06)</a>:</h4>
<p>pchickey updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2550">PR #2550</a> from <code>pch/wiggle_trapping</code> to <code>main</code>:</p>
<blockquote>
<p>This improves the design of Wiggle's ability to terminate WebAssembly execution by introducing a new<br>
<code>enum Trap { I32Exit(i32), String(String) }</code>.</p>
<p>Previously, Wiggle users could terminate WebAssembly by giving an <code>Err(String)</code> in the <code>UserErrorConversion</code> impl. This has evolved into <code>Err(wiggle::Trap)</code>, so that the termination can either give a human-readable trap, or an i32 exit code.</p>
<p>The big win here is we can finally implement wasi's <code>proc_exit</code> function in "pure" Wiggle, without the function override facility. So, this change has been threaded through the <code>wasi-common</code> crate and then into <code>wasi-wasmtime</code>.</p>
<p>I even uncovered some cli tests that technically didn't conform to the Wasi command spec because they didn't export a memory - wiggle now catches this, the old proc_exit override did not. These were trivially fixed.</p>
<p>Finally, instead of leaving the <code>unimplemented!</code> macro in the several spots in the wasi trait, I replaced them with an <code>Error::Unsupported</code> variant that produces a <code>Trap</code>.</p>
<p>The function override facility has been left in Wiggle for the time being, but I expect to remove it soon.</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;<br>
</p>
</blockquote>



<a name="222008345"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232550%20wiggle%3A%20introduce%20Trap%20enum/near/222008345" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232550.20wiggle.3A.20introduce.20Trap.20enum.html#222008345">(Jan 07 2021 at 22:06)</a>:</h4>
<p><strong>pchickey</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/2550">PR #2550</a>.</p>



<a name="222008447"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232550%20wiggle%3A%20introduce%20Trap%20enum/near/222008447" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232550.20wiggle.3A.20introduce.20Trap.20enum.html#222008447">(Jan 07 2021 at 22:07)</a>:</h4>
<p>pchickey edited <a href="https://github.com/bytecodealliance/wasmtime/pull/2550">PR #2550</a> from <code>pch/wiggle_trapping</code> to <code>main</code>:</p>
<blockquote>
<p>This improves the design of Wiggle's ability to terminate WebAssembly execution by introducing a new<br>
<code>enum Trap { I32Exit(i32), String(String) }</code>. This is just a simple version of Wasmtime's own <code>Trap</code>, which will be compatible with Lucet as well.</p>
<p>Previously, Wiggle users could terminate WebAssembly by giving an <code>Err(String)</code> in the <code>UserErrorConversion</code> impl. This has evolved into <code>Err(wiggle::Trap)</code>, so that the termination can either give a human-readable trap, or an i32 exit code.</p>
<p>The big win here is we can finally implement wasi's <code>proc_exit</code> function in "pure" Wiggle, without the function override facility. So, this change has been threaded through the <code>wasi-common</code> crate and then into <code>wasi-wasmtime</code>.</p>
<p>I even uncovered some cli tests that technically didn't conform to the Wasi command spec because they didn't export a memory - wiggle now catches this, the old proc_exit override did not. These were trivially fixed.</p>
<p>Finally, instead of leaving the <code>unimplemented!</code> macro in the several spots in the wasi trait, I replaced them with an <code>Error::Unsupported</code> variant that produces a <code>Trap</code>.</p>
<p>The function override facility has been left in Wiggle for the time being, but I expect to remove it soon.</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;<br>
</p>
</blockquote>



<a name="222012319"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232550%20wiggle%3A%20introduce%20Trap%20enum/near/222012319" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232550.20wiggle.3A.20introduce.20Trap.20enum.html#222012319">(Jan 07 2021 at 22:42)</a>:</h4>
<p>pchickey edited <a href="https://github.com/bytecodealliance/wasmtime/pull/2550">PR #2550</a> from <code>pch/wiggle_trapping</code> to <code>main</code>:</p>
<blockquote>
<p>This improves the design of Wiggle's ability to terminate WebAssembly execution by introducing a new<br>
<code>enum Trap { I32Exit(i32), String(String) }</code>. This is just a simple version of Wasmtime's own <code>Trap</code>, which will be compatible with Lucet as well.</p>
<p>Previously, Wiggle users could terminate WebAssembly by giving an <code>Err(String)</code> in the <code>UserErrorConversion</code> impl. This has evolved into <code>Err(wiggle::Trap)</code>, so that the termination can either give a human-readable trap, or an i32 exit code.</p>
<p>Additionally, functions which are <code>(@witx noreturn)</code> now have a return type of <code>wiggle::Trap</code>, using the type system to enforce that they terminate WebAssembly execution.</p>
<p>The big win here is we can finally implement wasi's <code>proc_exit</code> function in "pure" Wiggle, without the function override facility. So, this change has been threaded through the <code>wasi-common</code> crate and then into <code>wasi-wasmtime</code>.</p>
<p>I even uncovered some cli tests that technically didn't conform to the Wasi command spec because they didn't export a memory - wiggle now catches this, the old proc_exit override did not. These were trivially fixed.</p>
<p>Finally, instead of leaving the <code>unimplemented!</code> macro in the several spots in the wasi trait, I replaced them with an <code>Error::Unsupported</code> variant that produces a <code>Trap</code>.</p>
<p>The function override facility has been left in Wiggle for the time being, but I expect to remove it soon.</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;<br>
</p>
</blockquote>



<a name="222012703"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232550%20wiggle%3A%20introduce%20Trap%20enum/near/222012703" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232550.20wiggle.3A.20introduce.20Trap.20enum.html#222012703">(Jan 07 2021 at 22:46)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2550#pullrequestreview-563884376">PR Review</a>.</p>



<a name="222012826"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232550%20wiggle%3A%20introduce%20Trap%20enum/near/222012826" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232550.20wiggle.3A.20introduce.20Trap.20enum.html#222012826">(Jan 07 2021 at 22:47)</a>:</h4>
<p>pchickey updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2550">PR #2550</a> from <code>pch/wiggle_trapping</code> to <code>main</code>:</p>
<blockquote>
<p>This improves the design of Wiggle's ability to terminate WebAssembly execution by introducing a new<br>
<code>enum Trap { I32Exit(i32), String(String) }</code>. This is just a simple version of Wasmtime's own <code>Trap</code>, which will be compatible with Lucet as well.</p>
<p>Previously, Wiggle users could terminate WebAssembly by giving an <code>Err(String)</code> in the <code>UserErrorConversion</code> impl. This has evolved into <code>Err(wiggle::Trap)</code>, so that the termination can either give a human-readable trap, or an i32 exit code.</p>
<p>Additionally, functions which are <code>(@witx noreturn)</code> now have a return type of <code>wiggle::Trap</code>, using the type system to enforce that they terminate WebAssembly execution.</p>
<p>The big win here is we can finally implement wasi's <code>proc_exit</code> function in "pure" Wiggle, without the function override facility. So, this change has been threaded through the <code>wasi-common</code> crate and then into <code>wasi-wasmtime</code>.</p>
<p>I even uncovered some cli tests that technically didn't conform to the Wasi command spec because they didn't export a memory - wiggle now catches this, the old proc_exit override did not. These were trivially fixed.</p>
<p>Finally, instead of leaving the <code>unimplemented!</code> macro in the several spots in the wasi trait, I replaced them with an <code>Error::Unsupported</code> variant that produces a <code>Trap</code>.</p>
<p>The function override facility has been left in Wiggle for the time being, but I expect to remove it soon.</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;<br>
</p>
</blockquote>



<a name="222013812"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232550%20wiggle%3A%20introduce%20Trap%20enum/near/222013812" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232550.20wiggle.3A.20introduce.20Trap.20enum.html#222013812">(Jan 07 2021 at 22:57)</a>:</h4>
<p>pchickey updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2550">PR #2550</a> from <code>pch/wiggle_trapping</code> to <code>main</code>:</p>
<blockquote>
<p>This improves the design of Wiggle's ability to terminate WebAssembly execution by introducing a new<br>
<code>enum Trap { I32Exit(i32), String(String) }</code>. This is just a simple version of Wasmtime's own <code>Trap</code>, which will be compatible with Lucet as well.</p>
<p>Previously, Wiggle users could terminate WebAssembly by giving an <code>Err(String)</code> in the <code>UserErrorConversion</code> impl. This has evolved into <code>Err(wiggle::Trap)</code>, so that the termination can either give a human-readable trap, or an i32 exit code.</p>
<p>Additionally, functions which are <code>(@witx noreturn)</code> now have a return type of <code>wiggle::Trap</code>, using the type system to enforce that they terminate WebAssembly execution.</p>
<p>The big win here is we can finally implement wasi's <code>proc_exit</code> function in "pure" Wiggle, without the function override facility. So, this change has been threaded through the <code>wasi-common</code> crate and then into <code>wasi-wasmtime</code>.</p>
<p>I even uncovered some cli tests that technically didn't conform to the Wasi command spec because they didn't export a memory - wiggle now catches this, the old proc_exit override did not. These were trivially fixed.</p>
<p>Finally, instead of leaving the <code>unimplemented!</code> macro in the several spots in the wasi trait, I replaced them with an <code>Error::Unsupported</code> variant that produces a <code>Trap</code>.</p>
<p>The function override facility has been left in Wiggle for the time being, but I expect to remove it soon.</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;<br>
</p>
</blockquote>



<a name="222020725"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232550%20wiggle%3A%20introduce%20Trap%20enum/near/222020725" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232550.20wiggle.3A.20introduce.20Trap.20enum.html#222020725">(Jan 08 2021 at 00:23)</a>:</h4>
<p>fitzgen merged <a href="https://github.com/bytecodealliance/wasmtime/pull/2550">PR #2550</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>