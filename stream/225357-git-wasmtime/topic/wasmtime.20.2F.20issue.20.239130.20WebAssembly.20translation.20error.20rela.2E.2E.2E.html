<html>
<head><meta charset="utf-8"><title>wasmtime / issue #9130 WebAssembly translation error rela... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239130.20WebAssembly.20translation.20error.20rela.2E.2E.2E.html">wasmtime / issue #9130 WebAssembly translation error rela...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="462387531"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239130%20WebAssembly%20translation%20error%20rela.../near/462387531" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239130.20WebAssembly.20translation.20error.20rela.2E.2E.2E.html#462387531">(Aug 14 2024 at 17:13)</a>:</h4>
<p><a href="https://github.com/CryZe">CryZe</a> added the bug label to <a href="https://github.com/bytecodealliance/wasmtime/issues/9130">Issue #9130</a>.</p>



<a name="462387532"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239130%20WebAssembly%20translation%20error%20rela.../near/462387532" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239130.20WebAssembly.20translation.20error.20rela.2E.2E.2E.html#462387532">(Aug 14 2024 at 17:13)</a>:</h4>
<p>CryZe opened <a href="https://github.com/bytecodealliance/wasmtime/issues/9130">issue #9130</a>:</p>
<blockquote>
<h3>Test Case</h3>
<p><a href="https://github.com/user-attachments/files/16616175/furious_fish_auto_splitter.zip">furious_fish_auto_splitter.zip</a></p>
<h3>Steps to Reproduce</h3>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">engine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wasmtime</span><span class="p">::</span><span class="n">Engine</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">wasmtime</span><span class="p">::</span><span class="n">Config</span><span class="p">::</span><span class="n">new</span><span class="p">()).</span><span class="n">unwrap</span><span class="p">();</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wasmtime</span><span class="p">::</span><span class="n">Module</span><span class="p">::</span><span class="n">new</span><span class="p">(</span>
<span class="w">        </span><span class="o">&amp;</span><span class="n">engine</span><span class="p">,</span>
<span class="w">        </span><span class="fm">include_bytes!</span><span class="p">(</span><span class="s">"furious_fish_auto_splitter.wasm"</span><span class="p">),</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">unwrap</span><span class="p">();</span>
</code></pre></div>
<div class="codehilite" data-code-language="TOML"><pre><span></span><code><span class="n">wasmtime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">version</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">"23.0.2"</span><span class="p">,</span><span class="w"> </span><span class="n">default-features</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="n">features</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="s2">"cranelift"</span><span class="p">,</span><span class="w"> </span><span class="s2">"runtime"</span><span class="p">]</span><span class="w"> </span><span class="p">}</span>
</code></pre></div>
<h3>Expected Results</h3>
<p>I'm expecting the wasm module to be parsed.</p>
<h3>Actual Results</h3>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">thread</span><span class="w"> </span><span class="o">'</span><span class="na">main</span><span class="o">'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span><span class="p">:</span><span class="mi">18</span><span class="p">:</span><span class="mi">6</span><span class="p">:</span>
<span class="nc">called</span><span class="w"> </span><span class="err">`</span><span class="nb">Result</span><span class="p">::</span><span class="n">unwrap</span><span class="p">()</span><span class="err">`</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="err">`</span><span class="nb">Err</span><span class="err">`</span><span class="w"> </span><span class="n">value</span><span class="p">:</span><span class="w"> </span><span class="nc">WebAssembly</span><span class="w"> </span><span class="n">translation</span><span class="w"> </span><span class="n">error</span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span><span class="p">:</span>
<span class="w">    </span><span class="nc">Invalid</span><span class="w"> </span><span class="n">input</span><span class="w"> </span><span class="n">WebAssembly</span><span class="w"> </span><span class="n">code</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">offset</span><span class="w"> </span><span class="mi">44300</span><span class="p">:</span><span class="w"> </span><span class="nc">zero</span><span class="w"> </span><span class="n">byte</span><span class="w"> </span><span class="n">expected</span>
</code></pre></div>
<h3>Versions and Environment</h3>
<p>Wasmtime version or commit: 23.0.2</p>
<p>Operating system: Windows</p>
<p>Architecture: x86_64</p>
<h3>Extra Info</h3>
<p>I did by now debug this issue far enough and it turns out that the <code>gc</code> feature needs to be active, for the module to be parsed correctly.</p>
<p>This to me seems surprising and wasn't ever needed for a wasm module that got compiled by Rust, which does not make use of any GC related feature. I'm guessing vtable pointers use function references, and the parsing infrastructure for those accidentally got gated with the GC proposal because of the "typed function references" proposal. If this is fully intended, this can be closed right away.<br>
</p>
</blockquote>



<a name="462387675"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239130%20WebAssembly%20translation%20error%20rela.../near/462387675" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239130.20WebAssembly.20translation.20error.20rela.2E.2E.2E.html#462387675">(Aug 14 2024 at 17:14)</a>:</h4>
<p>CryZe edited <a href="https://github.com/bytecodealliance/wasmtime/issues/9130">issue #9130</a>:</p>
<blockquote>
<h3>Test Case</h3>
<p><a href="https://github.com/user-attachments/files/16616175/furious_fish_auto_splitter.zip">furious_fish_auto_splitter.zip</a></p>
<h3>Steps to Reproduce</h3>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">engine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wasmtime</span><span class="p">::</span><span class="n">Engine</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">wasmtime</span><span class="p">::</span><span class="n">Config</span><span class="p">::</span><span class="n">new</span><span class="p">()).</span><span class="n">unwrap</span><span class="p">();</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wasmtime</span><span class="p">::</span><span class="n">Module</span><span class="p">::</span><span class="n">new</span><span class="p">(</span>
<span class="w">        </span><span class="o">&amp;</span><span class="n">engine</span><span class="p">,</span>
<span class="w">        </span><span class="fm">include_bytes!</span><span class="p">(</span><span class="s">"furious_fish_auto_splitter.wasm"</span><span class="p">),</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">unwrap</span><span class="p">();</span>
</code></pre></div>
<div class="codehilite" data-code-language="TOML"><pre><span></span><code><span class="n">wasmtime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">version</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">"23.0.2"</span><span class="p">,</span><span class="w"> </span><span class="n">default-features</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="n">features</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="s2">"cranelift"</span><span class="p">,</span><span class="w"> </span><span class="s2">"runtime"</span><span class="p">]</span><span class="w"> </span><span class="p">}</span>
</code></pre></div>
<h3>Expected Results</h3>
<p>I'm expecting the wasm module to be parsed.</p>
<h3>Actual Results</h3>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">thread</span><span class="w"> </span><span class="o">'</span><span class="na">main</span><span class="o">'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span><span class="p">:</span><span class="mi">18</span><span class="p">:</span><span class="mi">6</span><span class="p">:</span>
<span class="nc">called</span><span class="w"> </span><span class="err">`</span><span class="nb">Result</span><span class="p">::</span><span class="n">unwrap</span><span class="p">()</span><span class="err">`</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="err">`</span><span class="nb">Err</span><span class="err">`</span><span class="w"> </span><span class="n">value</span><span class="p">:</span><span class="w"> </span><span class="nc">WebAssembly</span><span class="w"> </span><span class="n">translation</span><span class="w"> </span><span class="n">error</span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span><span class="p">:</span>
<span class="w">    </span><span class="nc">Invalid</span><span class="w"> </span><span class="n">input</span><span class="w"> </span><span class="n">WebAssembly</span><span class="w"> </span><span class="n">code</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">offset</span><span class="w"> </span><span class="mi">44300</span><span class="p">:</span><span class="w"> </span><span class="nc">zero</span><span class="w"> </span><span class="n">byte</span><span class="w"> </span><span class="n">expected</span>
</code></pre></div>
<h3>Versions and Environment</h3>
<p>Wasmtime version or commit: 23.0.2</p>
<p>Operating system: Windows</p>
<p>Architecture: x86_64</p>
<h3>Extra Info</h3>
<p>I did by now debug this issue far enough and it turns out that the <code>gc</code> feature needs to be active for the module to be parsed correctly.</p>
<p>This to me seems surprising and wasn't ever needed for a wasm module that got compiled by Rust, which does not make use of any GC related feature. I'm guessing vtable pointers use function references, and the parsing infrastructure for those accidentally got gated with the GC proposal because of the "typed function references" proposal. If this is fully intended, this can be closed right away.<br>
</p>
</blockquote>



<a name="462387741"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239130%20WebAssembly%20translation%20error%20rela.../near/462387741" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239130.20WebAssembly.20translation.20error.20rela.2E.2E.2E.html#462387741">(Aug 14 2024 at 17:15)</a>:</h4>
<p>CryZe edited <a href="https://github.com/bytecodealliance/wasmtime/issues/9130">issue #9130</a>:</p>
<blockquote>
<h3>Test Case</h3>
<p><a href="https://github.com/user-attachments/files/16616175/furious_fish_auto_splitter.zip">furious_fish_auto_splitter.zip</a></p>
<h3>Steps to Reproduce</h3>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">engine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wasmtime</span><span class="p">::</span><span class="n">Engine</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">wasmtime</span><span class="p">::</span><span class="n">Config</span><span class="p">::</span><span class="n">new</span><span class="p">()).</span><span class="n">unwrap</span><span class="p">();</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wasmtime</span><span class="p">::</span><span class="n">Module</span><span class="p">::</span><span class="n">new</span><span class="p">(</span>
<span class="w">        </span><span class="o">&amp;</span><span class="n">engine</span><span class="p">,</span>
<span class="w">        </span><span class="fm">include_bytes!</span><span class="p">(</span><span class="s">"furious_fish_auto_splitter.wasm"</span><span class="p">),</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">unwrap</span><span class="p">();</span>
</code></pre></div>
<div class="codehilite" data-code-language="TOML"><pre><span></span><code><span class="n">wasmtime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">version</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">"23.0.2"</span><span class="p">,</span><span class="w"> </span><span class="n">default-features</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="n">features</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="s2">"cranelift"</span><span class="p">,</span><span class="w"> </span><span class="s2">"runtime"</span><span class="p">]</span><span class="w"> </span><span class="p">}</span>
</code></pre></div>
<h3>Expected Results</h3>
<p>I'm expecting the wasm module to be parsed.</p>
<h3>Actual Results</h3>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">thread</span><span class="w"> </span><span class="o">'</span><span class="na">main</span><span class="o">'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span><span class="p">:</span><span class="mi">18</span><span class="p">:</span><span class="mi">6</span><span class="p">:</span>
<span class="nc">called</span><span class="w"> </span><span class="err">`</span><span class="nb">Result</span><span class="p">::</span><span class="n">unwrap</span><span class="p">()</span><span class="err">`</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="err">`</span><span class="nb">Err</span><span class="err">`</span><span class="w"> </span><span class="n">value</span><span class="p">:</span><span class="w"> </span><span class="nc">WebAssembly</span><span class="w"> </span><span class="n">translation</span><span class="w"> </span><span class="n">error</span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span><span class="p">:</span>
<span class="w">    </span><span class="nc">Invalid</span><span class="w"> </span><span class="n">input</span><span class="w"> </span><span class="n">WebAssembly</span><span class="w"> </span><span class="n">code</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">offset</span><span class="w"> </span><span class="mi">44300</span><span class="p">:</span><span class="w"> </span><span class="nc">zero</span><span class="w"> </span><span class="n">byte</span><span class="w"> </span><span class="n">expected</span>
</code></pre></div>
<h3>Versions and Environment</h3>
<p>Wasmtime version or commit: 23.0.2</p>
<p>Operating system: Windows</p>
<p>Architecture: x86_64</p>
<h3>Extra Info</h3>
<p>I did by now debug this issue far enough and it turns out that the <code>gc</code> feature needs to be active for the module to be parsed correctly.</p>
<p>This to me seems surprising and wasn't ever needed for a wasm module that got compiled by Rust, which does not make use of any GC related feature. I'm guessing vtables make use of function references, and the parsing infrastructure for those accidentally got gated with the GC proposal because of the "typed function references" proposal. If this is fully intended, this can be closed right away.<br>
</p>
</blockquote>



<a name="462396188"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239130%20WebAssembly%20translation%20error%20rela.../near/462396188" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239130.20WebAssembly.20translation.20error.20rela.2E.2E.2E.html#462396188">(Aug 14 2024 at 18:15)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/9130#issuecomment-2289516086">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9130">issue #9130</a>:</p>
<blockquote>
<p>Ah yes as you've discovered this is due to the fact that the way you're depending on the <code>wasmtime</code> crate disables the <code>gc</code> feature. That in turn auto-disables the <code>reference-types</code> WebAssembly proposal which is what's needed here. The module itself isn't using GC or anything like that, but it has:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">  </span><span class="mh">0xad06</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">11</span><span class="w"> </span><span class="mi">80</span><span class="w"> </span><span class="mi">80</span><span class="w"> </span><span class="mi">80</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">call_indirect</span><span class="w"> </span><span class="n">type_index</span><span class="p">:</span><span class="mi">0</span><span class="w"> </span><span class="n">table_index</span><span class="p">:</span><span class="mi">0</span>
<span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="mi">80</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">80</span><span class="w"> </span><span class="mi">80</span>
<span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="mi">80</span><span class="w"> </span><span class="mi">80</span><span class="w"> </span><span class="mi">00</span>
</code></pre></div>
<p>that encoding of <code>call_indirect</code> was not valid before the <code>reference_types</code> proposal, notably the overlong encoding of <code>table_index: 0</code> as <code>80 80 80 80 00</code>. With the <code>reference-types</code> feature disabled the instruction cannot be parsed. With <code>reference-types</code> enabled, which enabling the <code>gc</code> crate feature does automatically, then the module can be parsed.</p>
</blockquote>



<a name="462397201"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239130%20WebAssembly%20translation%20error%20rela.../near/462397201" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239130.20WebAssembly.20translation.20error.20rela.2E.2E.2E.html#462397201">(Aug 14 2024 at 18:23)</a>:</h4>
<p>CryZe closed <a href="https://github.com/bytecodealliance/wasmtime/issues/9130">issue #9130</a>:</p>
<blockquote>
<h3>Test Case</h3>
<p><a href="https://github.com/user-attachments/files/16616175/furious_fish_auto_splitter.zip">furious_fish_auto_splitter.zip</a></p>
<h3>Steps to Reproduce</h3>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">engine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wasmtime</span><span class="p">::</span><span class="n">Engine</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">wasmtime</span><span class="p">::</span><span class="n">Config</span><span class="p">::</span><span class="n">new</span><span class="p">()).</span><span class="n">unwrap</span><span class="p">();</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wasmtime</span><span class="p">::</span><span class="n">Module</span><span class="p">::</span><span class="n">new</span><span class="p">(</span>
<span class="w">        </span><span class="o">&amp;</span><span class="n">engine</span><span class="p">,</span>
<span class="w">        </span><span class="fm">include_bytes!</span><span class="p">(</span><span class="s">"furious_fish_auto_splitter.wasm"</span><span class="p">),</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">unwrap</span><span class="p">();</span>
</code></pre></div>
<div class="codehilite" data-code-language="TOML"><pre><span></span><code><span class="n">wasmtime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">version</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">"23.0.2"</span><span class="p">,</span><span class="w"> </span><span class="n">default-features</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="n">features</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="s2">"cranelift"</span><span class="p">,</span><span class="w"> </span><span class="s2">"runtime"</span><span class="p">]</span><span class="w"> </span><span class="p">}</span>
</code></pre></div>
<h3>Expected Results</h3>
<p>I'm expecting the wasm module to be parsed.</p>
<h3>Actual Results</h3>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">thread</span><span class="w"> </span><span class="o">'</span><span class="na">main</span><span class="o">'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span><span class="p">:</span><span class="mi">18</span><span class="p">:</span><span class="mi">6</span><span class="p">:</span>
<span class="nc">called</span><span class="w"> </span><span class="err">`</span><span class="nb">Result</span><span class="p">::</span><span class="n">unwrap</span><span class="p">()</span><span class="err">`</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="err">`</span><span class="nb">Err</span><span class="err">`</span><span class="w"> </span><span class="n">value</span><span class="p">:</span><span class="w"> </span><span class="nc">WebAssembly</span><span class="w"> </span><span class="n">translation</span><span class="w"> </span><span class="n">error</span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span><span class="p">:</span>
<span class="w">    </span><span class="nc">Invalid</span><span class="w"> </span><span class="n">input</span><span class="w"> </span><span class="n">WebAssembly</span><span class="w"> </span><span class="n">code</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">offset</span><span class="w"> </span><span class="mi">44300</span><span class="p">:</span><span class="w"> </span><span class="nc">zero</span><span class="w"> </span><span class="n">byte</span><span class="w"> </span><span class="n">expected</span>
</code></pre></div>
<h3>Versions and Environment</h3>
<p>Wasmtime version or commit: 23.0.2</p>
<p>Operating system: Windows</p>
<p>Architecture: x86_64</p>
<h3>Extra Info</h3>
<p>I did by now debug this issue far enough and it turns out that the <code>gc</code> feature needs to be active for the module to be parsed correctly.</p>
<p>This to me seems surprising and wasn't ever needed for a wasm module that got compiled by Rust, which does not make use of any GC related feature. I'm guessing vtables make use of function references, and the parsing infrastructure for those accidentally got gated with the GC proposal because of the "typed function references" proposal. If this is fully intended, this can be closed right away.<br>
</p>
</blockquote>



<a name="462397203"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239130%20WebAssembly%20translation%20error%20rela.../near/462397203" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239130.20WebAssembly.20translation.20error.20rela.2E.2E.2E.html#462397203">(Aug 14 2024 at 18:23)</a>:</h4>
<p>CryZe <a href="https://github.com/bytecodealliance/wasmtime/issues/9130#issuecomment-2289547391">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9130">issue #9130</a>:</p>
<blockquote>
<p>Ah and that's because I use the nightly Rust compiler with the update to LLVM 19, which enables <code>reference-types</code> by default. Though I was not aware that it actually had some sort of impact. Good to know. Thank you for looking into it.</p>
</blockquote>



<a name="464672369"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239130%20WebAssembly%20translation%20error%20rela.../near/464672369" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239130.20WebAssembly.20translation.20error.20rela.2E.2E.2E.html#464672369">(Aug 23 2024 at 15:26)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/9130#issuecomment-2307318840">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9130">issue #9130</a>:</p>
<blockquote>
<p>In case anyone comes across this in the future, Wasmtime 25 will include <a href="https://github.com/bytecodealliance/wasmtime/pull/9162">https://github.com/bytecodealliance/wasmtime/pull/9162</a> which means that this issue should no longer come up or be relevant. Disabling the <code>gc</code> feature of Wasmtime will preserve the ability of Wasmtime to read LLVM 19+ modules, and only use of <code>externref</code> in wasm modules (and other gc types) will be gated when the Wasmtime compile-time-feature of <code>gc</code> is disabled.</p>
</blockquote>



<a name="464675280"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239130%20WebAssembly%20translation%20error%20rela.../near/464675280" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239130.20WebAssembly.20translation.20error.20rela.2E.2E.2E.html#464675280">(Aug 23 2024 at 15:35)</a>:</h4>
<p>brooksmtownsend <a href="https://github.com/bytecodealliance/wasmtime/issues/9130#issuecomment-2307335484">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9130">issue #9130</a>:</p>
<blockquote>
<p>@alexcrichton perfect timing! I just came across this issue this AM looking to enable running wasm32-wasip2 components built via <code>cargo +nightly</code> and I was looking to enable the <code>gc</code> feature to enable it <a href="https://github.com/wasmCloud/wasmCloud/pull/2848">https://github.com/wasmCloud/wasmCloud/pull/2848</a>.</p>
<p>So in wasmtime 25 I won't need the <code>gc</code> feature?</p>
</blockquote>



<a name="464676623"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239130%20WebAssembly%20translation%20error%20rela.../near/464676623" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239130.20WebAssembly.20translation.20error.20rela.2E.2E.2E.html#464676623">(Aug 23 2024 at 15:43)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/9130#issuecomment-2307348947">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9130">issue #9130</a>:</p>
<blockquote>
<p>Correct!</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>