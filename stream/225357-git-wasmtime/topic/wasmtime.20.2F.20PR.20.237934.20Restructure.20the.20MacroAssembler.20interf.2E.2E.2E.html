<html>
<head><meta charset="utf-8"><title>wasmtime / PR #7934 Restructure the MacroAssembler interf... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237934.20Restructure.20the.20MacroAssembler.20interf.2E.2E.2E.html">wasmtime / PR #7934 Restructure the MacroAssembler interf...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="421356985"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237934%20Restructure%20the%20MacroAssembler%20interf.../near/421356985" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237934.20Restructure.20the.20MacroAssembler.20interf.2E.2E.2E.html#421356985">(Feb 14 2024 at 02:00)</a>:</h4>
<p>elliottt opened <a href="https://github.com/bytecodealliance/wasmtime/pull/7934">PR #7934</a> from <code>elliottt:trevor/winch-clobbers</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>To prepare for moving the stack check into the function prologue, rework the macro assembler's interface to clobbers to ensure that the unwind info defines the prologue correctly on windows.</p>
<p>&lt;!--<br>
Please make sure you include the following information:</p>
<ul>
<li>
<p>If this work has been discussed elsewhere, please include a link to that<br>
  conversation. If it was discussed in an issue, just mention "issue #...".</p>
</li>
<li>
<p>Explain why this change is needed. If the details are in an issue already,<br>
  this can be brief.</p>
</li>
</ul>
<p>Our development process is documented in the Wasmtime book:<br>
<a href="https://docs.wasmtime.dev/contributing-development-process.html">https://docs.wasmtime.dev/contributing-development-process.html</a></p>
<p>Please ensure all communication follows the code of conduct:<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>
--&gt;</p>
</blockquote>



<a name="421365569"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237934%20Restructure%20the%20MacroAssembler%20interf.../near/421365569" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237934.20Restructure.20the.20MacroAssembler.20interf.2E.2E.2E.html#421365569">(Feb 14 2024 at 03:44)</a>:</h4>
<p>github-actions[bot] <a href="https://github.com/bytecodealliance/wasmtime/pull/7934#issuecomment-1943038530">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/7934">PR #7934</a>:</p>
<blockquote>
<h4>Subscribe to Label Action</h4>
<p>cc @saulecabrera</p>
<p>&lt;details&gt;<br>
This issue or pull request has been labeled: "winch"</p>
<p>Thus the following users have been cc'd because of the following labels:</p>
<ul>
<li>saulecabrera: winch</li>
</ul>
<p>To subscribe or unsubscribe from this label, edit the &lt;code&gt;.github/subscribe-to-label.json&lt;/code&gt; configuration file.</p>
<p><a href="https://github.com/bytecodealliance/subscribe-to-label-action">Learn more.</a><br>
&lt;/details&gt;</p>
</blockquote>



<a name="421375050"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237934%20Restructure%20the%20MacroAssembler%20interf.../near/421375050" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237934.20Restructure.20the.20MacroAssembler.20interf.2E.2E.2E.html#421375050">(Feb 14 2024 at 05:54)</a>:</h4>
<p>elliottt updated <a href="https://github.com/bytecodealliance/wasmtime/pull/7934">PR #7934</a>.</p>



<a name="421390829"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237934%20Restructure%20the%20MacroAssembler%20interf.../near/421390829" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237934.20Restructure.20the.20MacroAssembler.20interf.2E.2E.2E.html#421390829">(Feb 14 2024 at 08:09)</a>:</h4>
<p>elliottt edited <a href="https://github.com/bytecodealliance/wasmtime/pull/7934">PR #7934</a>:</p>
<blockquote>
<p>To prepare for moving the stack check into the function prologue, rework the macro assembler's interface to clobbers to ensure that the unwind info defines the prologue correctly on windows. Though clobbers are only used in two trampolines, it's a nice interface to use the save/restore points to bracket the code between the prologue and epilogue.</p>
<p>&lt;!--<br>
Please make sure you include the following information:</p>
<ul>
<li>
<p>If this work has been discussed elsewhere, please include a link to that<br>
  conversation. If it was discussed in an issue, just mention "issue #...".</p>
</li>
<li>
<p>Explain why this change is needed. If the details are in an issue already,<br>
  this can be brief.</p>
</li>
</ul>
<p>Our development process is documented in the Wasmtime book:<br>
<a href="https://docs.wasmtime.dev/contributing-development-process.html">https://docs.wasmtime.dev/contributing-development-process.html</a></p>
<p>Please ensure all communication follows the code of conduct:<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>
--&gt;</p>
</blockquote>



<a name="421390835"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237934%20Restructure%20the%20MacroAssembler%20interf.../near/421390835" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237934.20Restructure.20the.20MacroAssembler.20interf.2E.2E.2E.html#421390835">(Feb 14 2024 at 08:09)</a>:</h4>
<p><strong>elliottt</strong> has marked <a href="https://github.com/bytecodealliance/wasmtime/pull/7934">PR #7934</a> as ready for review.</p>



<a name="421390839"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237934%20Restructure%20the%20MacroAssembler%20interf.../near/421390839" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237934.20Restructure.20the.20MacroAssembler.20interf.2E.2E.2E.html#421390839">(Feb 14 2024 at 08:09)</a>:</h4>
<p><strong>elliottt</strong> requested <a href="https://github.com/abrown">abrown</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/7934">PR #7934</a>.</p>



<a name="421390840"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237934%20Restructure%20the%20MacroAssembler%20interf.../near/421390840" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237934.20Restructure.20the.20MacroAssembler.20interf.2E.2E.2E.html#421390840">(Feb 14 2024 at 08:09)</a>:</h4>
<p><strong>elliottt</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-compiler-reviewers">wasmtime-compiler-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/7934">PR #7934</a>.</p>



<a name="421390847"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237934%20Restructure%20the%20MacroAssembler%20interf.../near/421390847" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237934.20Restructure.20the.20MacroAssembler.20interf.2E.2E.2E.html#421390847">(Feb 14 2024 at 08:09)</a>:</h4>
<p><strong>elliottt</strong> requested <a href="https://github.com/saulecabrera">saulecabrera</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/7934">PR #7934</a>.</p>



<a name="421487844"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237934%20Restructure%20the%20MacroAssembler%20interf.../near/421487844" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237934.20Restructure.20the.20MacroAssembler.20interf.2E.2E.2E.html#421487844">(Feb 14 2024 at 16:48)</a>:</h4>
<p>elliottt edited <a href="https://github.com/bytecodealliance/wasmtime/pull/7934">PR #7934</a>:</p>
<blockquote>
<p>To prepare for moving the stack check into the function prologue, rework the macro assembler's interface to clobbers to ensure that the unwind info defines the prologue correctly on windows. Though clobbers are only used in two trampolines, it's a nice interface to use the save/restore points to bracket the code between the prologue and epilogue.</p>
<p>I made an additional change that's not strictly necessary in this PR: reserving the space for clobbers with <code>reserve_stack</code>, and then storing values, rather than calling push for each value. I opted to maintain 16-byte stack alignment in this case, despite winch fixing stack alignment up around calls, and this paid off in trampolines that require clobbers as they do one fewer push/pop combination.</p>
<p>&lt;!--<br>
Please make sure you include the following information:</p>
<ul>
<li>
<p>If this work has been discussed elsewhere, please include a link to that<br>
  conversation. If it was discussed in an issue, just mention "issue #...".</p>
</li>
<li>
<p>Explain why this change is needed. If the details are in an issue already,<br>
  this can be brief.</p>
</li>
</ul>
<p>Our development process is documented in the Wasmtime book:<br>
<a href="https://docs.wasmtime.dev/contributing-development-process.html">https://docs.wasmtime.dev/contributing-development-process.html</a></p>
<p>Please ensure all communication follows the code of conduct:<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>
--&gt;</p>
</blockquote>



<a name="421490922"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237934%20Restructure%20the%20MacroAssembler%20interf.../near/421490922" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237934.20Restructure.20the.20MacroAssembler.20interf.2E.2E.2E.html#421490922">(Feb 14 2024 at 17:03)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7934#pullrequestreview-1880821341">PR review</a>.</p>



<a name="421490924"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237934%20Restructure%20the%20MacroAssembler%20interf.../near/421490924" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237934.20Restructure.20the.20MacroAssembler.20interf.2E.2E.2E.html#421490924">(Feb 14 2024 at 17:03)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7934#pullrequestreview-1880821341">PR review</a>.</p>



<a name="421490925"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237934%20Restructure%20the%20MacroAssembler%20interf.../near/421490925" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237934.20Restructure.20the.20MacroAssembler.20interf.2E.2E.2E.html#421490925">(Feb 14 2024 at 17:03)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/7934#discussion_r1489802537">PR review comment</a>:</p>
<blockquote>
<p>Should we have something like:</p>
<p><div class="codehilite" data-code-language="suggestion"><pre><span></span><code>        debug_assert!(self.callee_saved_regs.is_empty());
        self.masm.restore_clobbers(&amp;[]);
</code></pre></div><br>
</p>
</blockquote>



<a name="421492572"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237934%20Restructure%20the%20MacroAssembler%20interf.../near/421492572" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237934.20Restructure.20the.20MacroAssembler.20interf.2E.2E.2E.html#421492572">(Feb 14 2024 at 17:11)</a>:</h4>
<p>elliottt submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7934#pullrequestreview-1880839053">PR review</a>.</p>



<a name="421492573"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237934%20Restructure%20the%20MacroAssembler%20interf.../near/421492573" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237934.20Restructure.20the.20MacroAssembler.20interf.2E.2E.2E.html#421492573">(Feb 14 2024 at 17:11)</a>:</h4>
<p>elliottt created <a href="https://github.com/bytecodealliance/wasmtime/pull/7934#discussion_r1489813320">PR review comment</a>:</p>
<blockquote>
<p>That's a great idea, thanks Andrew!</p>
</blockquote>



<a name="421492589"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237934%20Restructure%20the%20MacroAssembler%20interf.../near/421492589" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237934.20Restructure.20the.20MacroAssembler.20interf.2E.2E.2E.html#421492589">(Feb 14 2024 at 17:11)</a>:</h4>
<p>elliottt updated <a href="https://github.com/bytecodealliance/wasmtime/pull/7934">PR #7934</a>.</p>



<a name="421493782"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237934%20Restructure%20the%20MacroAssembler%20interf.../near/421493782" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237934.20Restructure.20the.20MacroAssembler.20interf.2E.2E.2E.html#421493782">(Feb 14 2024 at 17:17)</a>:</h4>
<p>saulecabrera submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7934#pullrequestreview-1880846694">PR review</a>:</p>
<blockquote>
<p>Thanks for re-structuring this, and sorry it took me a bit to get to it. I left a couple of small suggestions. </p>
</blockquote>



<a name="421493783"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237934%20Restructure%20the%20MacroAssembler%20interf.../near/421493783" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237934.20Restructure.20the.20MacroAssembler.20interf.2E.2E.2E.html#421493783">(Feb 14 2024 at 17:17)</a>:</h4>
<p>saulecabrera submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7934#pullrequestreview-1880846694">PR review</a>:</p>
<blockquote>
<p>Thanks for re-structuring this, and sorry it took me a bit to get to it. I left a couple of small suggestions. </p>
</blockquote>



<a name="421493784"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237934%20Restructure%20the%20MacroAssembler%20interf.../near/421493784" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237934.20Restructure.20the.20MacroAssembler.20interf.2E.2E.2E.html#421493784">(Feb 14 2024 at 17:17)</a>:</h4>
<p>saulecabrera created <a href="https://github.com/bytecodealliance/wasmtime/pull/7934#discussion_r1489817913">PR review comment</a>:</p>
<blockquote>
<p>Would it make sense to use <code>ABI::word_bytes()</code> and <code>ABI::word_bytes() * 2</code> here?</p>
</blockquote>



<a name="421493785"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237934%20Restructure%20the%20MacroAssembler%20interf.../near/421493785" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237934.20Restructure.20the.20MacroAssembler.20interf.2E.2E.2E.html#421493785">(Feb 14 2024 at 17:17)</a>:</h4>
<p>saulecabrera created <a href="https://github.com/bytecodealliance/wasmtime/pull/7934#discussion_r1489818000">PR review comment</a>:</p>
<blockquote>
<p>Do we still want to keep this <code>debug_assert_eq</code>?</p>
</blockquote>



<a name="421494445"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237934%20Restructure%20the%20MacroAssembler%20interf.../near/421494445" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237934.20Restructure.20the.20MacroAssembler.20interf.2E.2E.2E.html#421494445">(Feb 14 2024 at 17:20)</a>:</h4>
<p>elliottt submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7934#pullrequestreview-1880856259">PR review</a>.</p>



<a name="421494446"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237934%20Restructure%20the%20MacroAssembler%20interf.../near/421494446" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237934.20Restructure.20the.20MacroAssembler.20interf.2E.2E.2E.html#421494446">(Feb 14 2024 at 17:20)</a>:</h4>
<p>elliottt created <a href="https://github.com/bytecodealliance/wasmtime/pull/7934#discussion_r1489823792">PR review comment</a>:</p>
<blockquote>
<p>Ah on further thought (and after this assertion failed locally) we unconditionally populate the list of callee save regs, but then the wasm-&gt;native trampoline doesn't need to save any registers, as the winch abi does not have any callee saves. We could conditionally populate this based on the the way the <code>Trampoline</code> is compiled, but that feels like we're pushing an invariant out to the caller that would be better enforced through types: maybe the trampoline functions could also call <code>finalize()</code>, and take ownership of <code>self</code> to avoid potentially calling multiple strategies?</p>
</blockquote>



<a name="421494491"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237934%20Restructure%20the%20MacroAssembler%20interf.../near/421494491" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237934.20Restructure.20the.20MacroAssembler.20interf.2E.2E.2E.html#421494491">(Feb 14 2024 at 17:20)</a>:</h4>
<p>elliottt updated <a href="https://github.com/bytecodealliance/wasmtime/pull/7934">PR #7934</a>.</p>



<a name="421495056"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237934%20Restructure%20the%20MacroAssembler%20interf.../near/421495056" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237934.20Restructure.20the.20MacroAssembler.20interf.2E.2E.2E.html#421495056">(Feb 14 2024 at 17:23)</a>:</h4>
<p>elliottt submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7934#pullrequestreview-1880862138">PR review</a>.</p>



<a name="421495058"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237934%20Restructure%20the%20MacroAssembler%20interf.../near/421495058" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237934.20Restructure.20the.20MacroAssembler.20interf.2E.2E.2E.html#421495058">(Feb 14 2024 at 17:23)</a>:</h4>
<p>elliottt created <a href="https://github.com/bytecodealliance/wasmtime/pull/7934#discussion_r1489827551">PR review comment</a>:</p>
<blockquote>
<p>I like that! I think it also gives good justification to uncommenting the debug assert you mentioned below, as now it's checking the connection between the <code>word_bytes()</code> and <code>OperandSize::bytes()</code> results.</p>
</blockquote>



<a name="421495090"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237934%20Restructure%20the%20MacroAssembler%20interf.../near/421495090" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237934.20Restructure.20the.20MacroAssembler.20interf.2E.2E.2E.html#421495090">(Feb 14 2024 at 17:23)</a>:</h4>
<p>elliottt submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7934#pullrequestreview-1880862465">PR review</a>.</p>



<a name="421495092"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237934%20Restructure%20the%20MacroAssembler%20interf.../near/421495092" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237934.20Restructure.20the.20MacroAssembler.20interf.2E.2E.2E.html#421495092">(Feb 14 2024 at 17:23)</a>:</h4>
<p>elliottt created <a href="https://github.com/bytecodealliance/wasmtime/pull/7934#discussion_r1489827751">PR review comment</a>:</p>
<blockquote>
<p>I think so, after the change above. I'll uncomment it :)</p>
</blockquote>



<a name="421495293"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237934%20Restructure%20the%20MacroAssembler%20interf.../near/421495293" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237934.20Restructure.20the.20MacroAssembler.20interf.2E.2E.2E.html#421495293">(Feb 14 2024 at 17:24)</a>:</h4>
<p>elliottt updated <a href="https://github.com/bytecodealliance/wasmtime/pull/7934">PR #7934</a>.</p>



<a name="421497890"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237934%20Restructure%20the%20MacroAssembler%20interf.../near/421497890" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237934.20Restructure.20the.20MacroAssembler.20interf.2E.2E.2E.html#421497890">(Feb 14 2024 at 17:38)</a>:</h4>
<p>elliottt updated <a href="https://github.com/bytecodealliance/wasmtime/pull/7934">PR #7934</a>.</p>



<a name="421498176"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237934%20Restructure%20the%20MacroAssembler%20interf.../near/421498176" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237934.20Restructure.20the.20MacroAssembler.20interf.2E.2E.2E.html#421498176">(Feb 14 2024 at 17:40)</a>:</h4>
<p>elliottt updated <a href="https://github.com/bytecodealliance/wasmtime/pull/7934">PR #7934</a>.</p>



<a name="421508363"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237934%20Restructure%20the%20MacroAssembler%20interf.../near/421508363" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237934.20Restructure.20the.20MacroAssembler.20interf.2E.2E.2E.html#421508363">(Feb 14 2024 at 18:38)</a>:</h4>
<p>elliottt merged <a href="https://github.com/bytecodealliance/wasmtime/pull/7934">PR #7934</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>