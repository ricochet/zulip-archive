<html>
<head><meta charset="utf-8"><title>wasmtime / issue #9625 More context on a cranelift-codege... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239625.20More.20context.20on.20a.20cranelift-codege.2E.2E.2E.html">wasmtime / issue #9625 More context on a cranelift-codege...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="483403779"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239625%20More%20context%20on%20a%20cranelift-codege.../near/483403779" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239625.20More.20context.20on.20a.20cranelift-codege.2E.2E.2E.html#483403779">(Nov 20 2024 at 04:24)</a>:</h4>
<p>arihant2math opened <a href="https://github.com/bytecodealliance/wasmtime/issues/9625">issue #9625</a>:</p>
<blockquote>
<p>Currently if an explicit isle directory is found when the "isle-in-source-tree" feature is not enabled, the following error message is shown by the build script for cranelift-codegen:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w"> </span><span class="o">---</span><span class="w"> </span><span class="n">stderr</span>
<span class="w">  </span><span class="n">Error</span><span class="p">:</span><span class="w"> </span><span class="nc">directory</span><span class="w"> </span><span class="n">isle_generated_code</span><span class="o">/</span><span class="w"> </span><span class="n">exists</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">only</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">when</span>
<span class="w">  </span><span class="err">`</span><span class="o">--</span><span class="n">feature</span><span class="w"> </span><span class="n">isle</span><span class="o">-</span><span class="k">in</span><span class="o">-</span><span class="n">source</span><span class="o">-</span><span class="n">tree</span><span class="err">`</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">specified</span><span class="p">.</span><span class="w"> </span><span class="n">To</span><span class="w"> </span><span class="n">prevent</span><span class="w"> </span><span class="n">confusion</span><span class="p">,</span>
<span class="w">  </span><span class="n">this</span><span class="w"> </span><span class="n">build</span><span class="w"> </span><span class="n">script</span><span class="w"> </span><span class="n">requires</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">directory</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">removed</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">reverting</span>
<span class="w">  </span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">usual</span><span class="w"> </span><span class="n">generated</span><span class="w"> </span><span class="n">code</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">target</span><span class="o">/</span><span class="p">.</span><span class="w"> </span><span class="n">Please</span><span class="w"> </span><span class="n">delete</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">directory</span><span class="w"> </span><span class="n">and</span>
<span class="w">  </span><span class="n">re</span><span class="o">-</span><span class="n">run</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">build</span><span class="p">.</span>
</code></pre></div>
<p>as emitted by <a href="https://github.com/bytecodealliance/wasmtime/blob/3e0b7e501beebf5d7c094b7ac751f582ba12bc95/cranelift/codegen/build.rs#L78">https://github.com/bytecodealliance/wasmtime/blob/3e0b7e501beebf5d7c094b7ac751f582ba12bc95/cranelift/codegen/build.rs#L78</a>.</p>
<p>However this is misleading as deleting the <code>target/</code> directory (atleast on windows) does not fix the issue. The directory, for me, was located in <code>%HOME%\\.cargo\\registry\\src\\index.crates.io-6f17d22bba15001f\\cranelift-codegen-0.113.1\\isle_generated_code</code>. Could there possibly be a better check/error message and/or the actual directory located printed out to stderr?</p>
</blockquote>



<a name="483403837"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239625%20More%20context%20on%20a%20cranelift-codege.../near/483403837" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239625.20More.20context.20on.20a.20cranelift-codege.2E.2E.2E.html#483403837">(Nov 20 2024 at 04:25)</a>:</h4>
<p>arihant2math edited <a href="https://github.com/bytecodealliance/wasmtime/issues/9625">issue #9625</a>:</p>
<blockquote>
<p>Currently if an explicit isle directory is found when the "isle-in-source-tree" feature is not enabled, the following error message is shown by the build script for cranelift-codegen:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w"> </span><span class="o">---</span><span class="w"> </span><span class="n">stderr</span>
<span class="w">  </span><span class="n">Error</span><span class="p">:</span><span class="w"> </span><span class="nc">directory</span><span class="w"> </span><span class="n">isle_generated_code</span><span class="o">/</span><span class="w"> </span><span class="n">exists</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">only</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">when</span>
<span class="w">  </span><span class="err">`</span><span class="o">--</span><span class="n">feature</span><span class="w"> </span><span class="n">isle</span><span class="o">-</span><span class="k">in</span><span class="o">-</span><span class="n">source</span><span class="o">-</span><span class="n">tree</span><span class="err">`</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">specified</span><span class="p">.</span><span class="w"> </span><span class="n">To</span><span class="w"> </span><span class="n">prevent</span><span class="w"> </span><span class="n">confusion</span><span class="p">,</span>
<span class="w">  </span><span class="n">this</span><span class="w"> </span><span class="n">build</span><span class="w"> </span><span class="n">script</span><span class="w"> </span><span class="n">requires</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">directory</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">removed</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">reverting</span>
<span class="w">  </span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">usual</span><span class="w"> </span><span class="n">generated</span><span class="w"> </span><span class="n">code</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">target</span><span class="o">/</span><span class="p">.</span><span class="w"> </span><span class="n">Please</span><span class="w"> </span><span class="n">delete</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">directory</span><span class="w"> </span><span class="n">and</span>
<span class="w">  </span><span class="n">re</span><span class="o">-</span><span class="n">run</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">build</span><span class="p">.</span>
</code></pre></div>
<p>as emitted by <a href="https://github.com/bytecodealliance/wasmtime/blob/main/cranelift/codegen/build.rs#L78C9-L87C10">https://github.com/bytecodealliance/wasmtime/blob/main/cranelift/codegen/build.rs#L78C9-L87C10</a>.</p>
<p>However this is misleading as deleting the <code>target/</code> directory (atleast on windows) does not fix the issue. The directory, for me, was located in <code>%HOME%\\.cargo\\registry\\src\\index.crates.io-6f17d22bba15001f\\cranelift-codegen-0.113.1\\isle_generated_code</code>. Could there possibly be a better check/error message and/or the actual directory located printed out to stderr?</p>
</blockquote>



<a name="483404266"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239625%20More%20context%20on%20a%20cranelift-codege.../near/483404266" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239625.20More.20context.20on.20a.20cranelift-codege.2E.2E.2E.html#483404266">(Nov 20 2024 at 04:30)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/issues/9625#issuecomment-2487401317">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9625">issue #9625</a>:</p>
<blockquote>
<p>This seems to be a duplicate of #9588. That directory should not ever be created inside the <code>.cargo</code> path. Could you say more about how you're building Cranelift?</p>
</blockquote>



<a name="483421059"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239625%20More%20context%20on%20a%20cranelift-codege.../near/483421059" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239625.20More.20context.20on.20a.20cranelift-codege.2E.2E.2E.html#483421059">(Nov 20 2024 at 07:34)</a>:</h4>
<p>arihant2math <a href="https://github.com/bytecodealliance/wasmtime/issues/9625#issuecomment-2487731606">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9625">issue #9625</a>:</p>
<blockquote>
<p>I'm using wasmtime, so building is done because/through that. I'm not using any special features, just the default configuration. </p>
<p>I did some digging around the code, I think the bug is around L61 when calling <code> env::current_dir()</code>, since I'm pretty sure that's inconsistent when used in build scripts, I printed it out and got   "%HOME%\\.cargo\\registry\src\index.crates.io-6f17d22bba15001f\\cranelift-codegen-0.113.1", which seems to be the issue.</p>
<p>If changed to the <code>OUT_DIR</code> env variable, it would be in the target folder, which would be an improvement.</p>
</blockquote>



<a name="483430625"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239625%20More%20context%20on%20a%20cranelift-codege.../near/483430625" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239625.20More.20context.20on.20a.20cranelift-codege.2E.2E.2E.html#483430625">(Nov 20 2024 at 08:41)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/issues/9625#issuecomment-2487901715">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9625">issue #9625</a>:</p>
<blockquote>
<p><code>env::current_dir()</code> is used for exactly two purposes in the build script:</p>
<ul>
<li>Getting the source files. Using <code>OUT_DIR</code> here would be wrong.</li>
<li>Looking for a <code>isle_generated_code</code> directory in the source directory to use if <code>isle-in-source-tree</code> is enabled. The very intent of <code>isle-in-source-tree</code> requires this to keep using the source directory too.</li>
</ul>
<p>If you aren't doing development on Cranelift itself, <code>isle-in-source-tree</code> should never be enabled (and it definitively shouldn't be enabled when using it as <a href="http://crates.io">crates.io</a> dependency as those are not allowed to write to their source directory) and as such <code>isle_generated_code</code> should never be generated in the source directory. We want to know why it is generated anyway. Is any project you built that depends on Cranelift using <code>isle-in-source-tree</code>?</p>
</blockquote>



<a name="483431305"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239625%20More%20context%20on%20a%20cranelift-codege.../near/483431305" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239625.20More.20context.20on.20a.20cranelift-codege.2E.2E.2E.html#483431305">(Nov 20 2024 at 08:45)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/issues/9625#issuecomment-2487912206">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9625">issue #9625</a>:</p>
<blockquote>
<p>So turns out until very recently Wasmer was enabling <code>isle-in-source-tree</code>: <a href="https://github.com/wasmerio/wasmer/pull/5202">https://github.com/wasmerio/wasmer/pull/5202</a> Did you build Wasmer within the past couple of weeks? Note that Wasmer and Wasmtime are two entirely separate wasm engines. They just happen to share Cranelift as one of the compiler backends they use.</p>
</blockquote>



<a name="483525148"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239625%20More%20context%20on%20a%20cranelift-codege.../near/483525148" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239625.20More.20context.20on.20a.20cranelift-codege.2E.2E.2E.html#483525148">(Nov 20 2024 at 16:27)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/issues/9625#issuecomment-2489045452">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9625">issue #9625</a>:</p>
<blockquote>
<p>That's fairly obnoxious. Perhaps we should remove the feature altogether, unless folks are still using it -- I'll bring this up in the Cranelift meeting in a few minutes.</p>
</blockquote>



<a name="483545134"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239625%20More%20context%20on%20a%20cranelift-codege.../near/483545134" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239625.20More.20context.20on.20a.20cranelift-codege.2E.2E.2E.html#483545134">(Nov 20 2024 at 18:15)</a>:</h4>
<p>alexcrichton closed <a href="https://github.com/bytecodealliance/wasmtime/issues/9625">issue #9625</a>:</p>
<blockquote>
<p>Currently if an explicit isle directory is found when the "isle-in-source-tree" feature is not enabled, the following error message is shown by the build script for cranelift-codegen:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w"> </span><span class="o">---</span><span class="w"> </span><span class="n">stderr</span>
<span class="w">  </span><span class="n">Error</span><span class="p">:</span><span class="w"> </span><span class="nc">directory</span><span class="w"> </span><span class="n">isle_generated_code</span><span class="o">/</span><span class="w"> </span><span class="n">exists</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">only</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">when</span>
<span class="w">  </span><span class="err">`</span><span class="o">--</span><span class="n">feature</span><span class="w"> </span><span class="n">isle</span><span class="o">-</span><span class="k">in</span><span class="o">-</span><span class="n">source</span><span class="o">-</span><span class="n">tree</span><span class="err">`</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">specified</span><span class="p">.</span><span class="w"> </span><span class="n">To</span><span class="w"> </span><span class="n">prevent</span><span class="w"> </span><span class="n">confusion</span><span class="p">,</span>
<span class="w">  </span><span class="n">this</span><span class="w"> </span><span class="n">build</span><span class="w"> </span><span class="n">script</span><span class="w"> </span><span class="n">requires</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">directory</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">removed</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">reverting</span>
<span class="w">  </span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">usual</span><span class="w"> </span><span class="n">generated</span><span class="w"> </span><span class="n">code</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">target</span><span class="o">/</span><span class="p">.</span><span class="w"> </span><span class="n">Please</span><span class="w"> </span><span class="n">delete</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">directory</span><span class="w"> </span><span class="n">and</span>
<span class="w">  </span><span class="n">re</span><span class="o">-</span><span class="n">run</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">build</span><span class="p">.</span>
</code></pre></div>
<p>as emitted by <a href="https://github.com/bytecodealliance/wasmtime/blob/main/cranelift/codegen/build.rs#L78C9-L87C10">https://github.com/bytecodealliance/wasmtime/blob/main/cranelift/codegen/build.rs#L78C9-L87C10</a>.</p>
<p>However this is misleading as deleting the <code>target/</code> directory (atleast on windows) does not fix the issue. The directory, for me, was located in <code>%HOME%\\.cargo\\registry\\src\\index.crates.io-6f17d22bba15001f\\cranelift-codegen-0.113.1\\isle_generated_code</code>. Could there possibly be a better check/error message and/or the actual directory located printed out to stderr?</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>