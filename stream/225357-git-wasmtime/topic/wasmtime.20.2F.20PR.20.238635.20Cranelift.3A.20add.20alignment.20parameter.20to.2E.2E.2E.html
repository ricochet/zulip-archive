<html>
<head><meta charset="utf-8"><title>wasmtime / PR #8635 Cranelift: add alignment parameter to... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238635.20Cranelift.3A.20add.20alignment.20parameter.20to.2E.2E.2E.html">wasmtime / PR #8635 Cranelift: add alignment parameter to...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="439045762"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238635%20Cranelift%3A%20add%20alignment%20parameter%20to.../near/439045762" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238635.20Cranelift.3A.20add.20alignment.20parameter.20to.2E.2E.2E.html#439045762">(May 16 2024 at 15:21)</a>:</h4>
<p><strong>cfallin</strong> requested <a href="https://github.com/fitzgen">fitzgen</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/8635">PR #8635</a>.</p>



<a name="439045763"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238635%20Cranelift%3A%20add%20alignment%20parameter%20to.../near/439045763" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238635.20Cranelift.3A.20add.20alignment.20parameter.20to.2E.2E.2E.html#439045763">(May 16 2024 at 15:21)</a>:</h4>
<p><strong>cfallin</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-compiler-reviewers">wasmtime-compiler-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/8635">PR #8635</a>.</p>



<a name="439045764"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238635%20Cranelift%3A%20add%20alignment%20parameter%20to.../near/439045764" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238635.20Cranelift.3A.20add.20alignment.20parameter.20to.2E.2E.2E.html#439045764">(May 16 2024 at 15:21)</a>:</h4>
<p><strong>cfallin</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/8635">PR #8635</a>.</p>



<a name="439045765"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238635%20Cranelift%3A%20add%20alignment%20parameter%20to.../near/439045765" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238635.20Cranelift.3A.20add.20alignment.20parameter.20to.2E.2E.2E.html#439045765">(May 16 2024 at 15:21)</a>:</h4>
<p>cfallin opened <a href="https://github.com/bytecodealliance/wasmtime/pull/8635">PR #8635</a> from <code>cfallin:stackslot-alignment</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>Fixes #6716.</p>
<p>Currently, stack slots on the stack are aligned only to a machine-word boundary. This is insufficient for some use-cases: for example, storing SIMD data or structs that require a larger alignment.</p>
<p>This PR adds a parameter to the <code>StackSlotData</code> to specify alignment, and the associated logic to the CLIF parser and printer. It updates the shared ABI code to compute the stackslot layout taking the alignment into account. In order to ensure the alignment is always a power of two, it is stored as a shift amount (log2 of actual alignment) in the IR.</p>
<p>&lt;!--<br>
Please make sure you include the following information:</p>
<ul>
<li>
<p>If this work has been discussed elsewhere, please include a link to that<br>
  conversation. If it was discussed in an issue, just mention "issue #...".</p>
</li>
<li>
<p>Explain why this change is needed. If the details are in an issue already,<br>
  this can be brief.</p>
</li>
</ul>
<p>Our development process is documented in the Wasmtime book:<br>
<a href="https://docs.wasmtime.dev/contributing-development-process.html">https://docs.wasmtime.dev/contributing-development-process.html</a></p>
<p>Please ensure all communication follows the code of conduct:<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>
--&gt;</p>
</blockquote>



<a name="439046049"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238635%20Cranelift%3A%20add%20alignment%20parameter%20to.../near/439046049" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238635.20Cranelift.3A.20add.20alignment.20parameter.20to.2E.2E.2E.html#439046049">(May 16 2024 at 15:23)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8635#pullrequestreview-2061155344">PR review</a>.</p>



<a name="439046052"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238635%20Cranelift%3A%20add%20alignment%20parameter%20to.../near/439046052" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238635.20Cranelift.3A.20add.20alignment.20parameter.20to.2E.2E.2E.html#439046052">(May 16 2024 at 15:23)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/8635#discussion_r1603590632">PR review comment</a>:</p>
<blockquote>
<p>(Just below this point) the old <code>alignment</code> function didn't seem to be used in the ABI code or anywhere else; it's likely left over from some earlier use-case. The "largest power of two that divides..." logic is a little weird (it can result in an alignment less than requested?) so I removed it and pushed the alignment computation to the <code>std::cmp::max</code> in <code>abi.rs</code>.</p>
</blockquote>



<a name="439046909"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238635%20Cranelift%3A%20add%20alignment%20parameter%20to.../near/439046909" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238635.20Cranelift.3A.20add.20alignment.20parameter.20to.2E.2E.2E.html#439046909">(May 16 2024 at 15:27)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8635">PR #8635</a>.</p>



<a name="439047240"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238635%20Cranelift%3A%20add%20alignment%20parameter%20to.../near/439047240" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238635.20Cranelift.3A.20add.20alignment.20parameter.20to.2E.2E.2E.html#439047240">(May 16 2024 at 15:28)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/8635#issuecomment-2115553785">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/8635">PR #8635</a>:</p>
<blockquote>
<p>(for the record: work on this now spawned by <a href="#narrow/stream/217117-cranelift/topic/Retrieve.20alignment.20of.20architecture">this thread</a>)</p>
</blockquote>



<a name="439051177"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238635%20Cranelift%3A%20add%20alignment%20parameter%20to.../near/439051177" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238635.20Cranelift.3A.20add.20alignment.20parameter.20to.2E.2E.2E.html#439051177">(May 16 2024 at 15:48)</a>:</h4>
<p>elliottt submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8635#pullrequestreview-2061211926">PR review</a>:</p>
<blockquote>
<p>Awesome!</p>
</blockquote>



<a name="439051179"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238635%20Cranelift%3A%20add%20alignment%20parameter%20to.../near/439051179" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238635.20Cranelift.3A.20add.20alignment.20parameter.20to.2E.2E.2E.html#439051179">(May 16 2024 at 15:48)</a>:</h4>
<p>elliottt submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8635#pullrequestreview-2061211926">PR review</a>:</p>
<blockquote>
<p>Awesome!</p>
</blockquote>



<a name="439051180"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238635%20Cranelift%3A%20add%20alignment%20parameter%20to.../near/439051180" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238635.20Cranelift.3A.20add.20alignment.20parameter.20to.2E.2E.2E.html#439051180">(May 16 2024 at 15:48)</a>:</h4>
<p>elliottt created <a href="https://github.com/bytecodealliance/wasmtime/pull/8635#discussion_r1603629276">PR review comment</a>:</p>
<blockquote>
<p>Do we have a way of enabling an explicit stack check in clif tests? That would be a nice way of verifying that the total stack space required is accounted for.</p>
</blockquote>



<a name="439051181"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238635%20Cranelift%3A%20add%20alignment%20parameter%20to.../near/439051181" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238635.20Cranelift.3A.20add.20alignment.20parameter.20to.2E.2E.2E.html#439051181">(May 16 2024 at 15:48)</a>:</h4>
<p>elliottt created <a href="https://github.com/bytecodealliance/wasmtime/pull/8635#discussion_r1603633297">PR review comment</a>:</p>
<blockquote>
<p><div class="codehilite" data-code-language="suggestion"><pre><span></span><code>            u32::try_from(align).map_err(|_| self.error("alignment must be a 32-bit unsigned integer"))?
</code></pre></div><br>
</p>
</blockquote>



<a name="439052294"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238635%20Cranelift%3A%20add%20alignment%20parameter%20to.../near/439052294" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238635.20Cranelift.3A.20add.20alignment.20parameter.20to.2E.2E.2E.html#439052294">(May 16 2024 at 15:55)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8635#pullrequestreview-2061233849">PR review</a>.</p>



<a name="439052295"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238635%20Cranelift%3A%20add%20alignment%20parameter%20to.../near/439052295" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238635.20Cranelift.3A.20add.20alignment.20parameter.20to.2E.2E.2E.html#439052295">(May 16 2024 at 15:55)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8635#pullrequestreview-2061233849">PR review</a>.</p>



<a name="439052296"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238635%20Cranelift%3A%20add%20alignment%20parameter%20to.../near/439052296" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238635.20Cranelift.3A.20add.20alignment.20parameter.20to.2E.2E.2E.html#439052296">(May 16 2024 at 15:55)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/8635#discussion_r1603642829">PR review comment</a>:</p>
<blockquote>
<p>Can this be set to 4? The ValRaw bits in Wasmtime require a 16-byte alignment </p>
</blockquote>



<a name="439054536"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238635%20Cranelift%3A%20add%20alignment%20parameter%20to.../near/439054536" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238635.20Cranelift.3A.20add.20alignment.20parameter.20to.2E.2E.2E.html#439054536">(May 16 2024 at 16:05)</a>:</h4>
<p>elliottt submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8635#pullrequestreview-2061260427">PR review</a>.</p>



<a name="439054537"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238635%20Cranelift%3A%20add%20alignment%20parameter%20to.../near/439054537" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238635.20Cranelift.3A.20add.20alignment.20parameter.20to.2E.2E.2E.html#439054537">(May 16 2024 at 16:05)</a>:</h4>
<p>elliottt created <a href="https://github.com/bytecodealliance/wasmtime/pull/8635#discussion_r1603657812">PR review comment</a>:</p>
<blockquote>
<p>Ah!</p>
<p><div class="codehilite" data-code-language="suggestion"><pre><span></span><code>function %f0() -&gt; i64, i64, i64, i64 {
  gv0 = vmctx
  ss0 = explicit_slot 8, align=16
  ss1 = explicit_slot 8, align=16
  ss2 = explicit_slot 4
  ss3 = explicit_slot 4
  ss4 = stack_limit gv0
</code></pre></div><br>
</p>
</blockquote>



<a name="439054660"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238635%20Cranelift%3A%20add%20alignment%20parameter%20to.../near/439054660" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238635.20Cranelift.3A.20add.20alignment.20parameter.20to.2E.2E.2E.html#439054660">(May 16 2024 at 16:06)</a>:</h4>
<p>elliottt edited <a href="https://github.com/bytecodealliance/wasmtime/pull/8635#discussion_r1603657812">PR review comment</a>.</p>



<a name="439056854"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238635%20Cranelift%3A%20add%20alignment%20parameter%20to.../near/439056854" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238635.20Cranelift.3A.20add.20alignment.20parameter.20to.2E.2E.2E.html#439056854">(May 16 2024 at 16:18)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8635">PR #8635</a>.</p>



<a name="439057263"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238635%20Cranelift%3A%20add%20alignment%20parameter%20to.../near/439057263" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238635.20Cranelift.3A.20add.20alignment.20parameter.20to.2E.2E.2E.html#439057263">(May 16 2024 at 16:20)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8635">PR #8635</a>.</p>



<a name="439057381"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238635%20Cranelift%3A%20add%20alignment%20parameter%20to.../near/439057381" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238635.20Cranelift.3A.20add.20alignment.20parameter.20to.2E.2E.2E.html#439057381">(May 16 2024 at 16:21)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8635">PR #8635</a>.</p>



<a name="439057395"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238635%20Cranelift%3A%20add%20alignment%20parameter%20to.../near/439057395" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238635.20Cranelift.3A.20add.20alignment.20parameter.20to.2E.2E.2E.html#439057395">(May 16 2024 at 16:21)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8635#pullrequestreview-2061299676">PR review</a>.</p>



<a name="439057396"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238635%20Cranelift%3A%20add%20alignment%20parameter%20to.../near/439057396" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238635.20Cranelift.3A.20add.20alignment.20parameter.20to.2E.2E.2E.html#439057396">(May 16 2024 at 16:21)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/8635#discussion_r1603680930">PR review comment</a>:</p>
<blockquote>
<p>Done!</p>
</blockquote>



<a name="439057931"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238635%20Cranelift%3A%20add%20alignment%20parameter%20to.../near/439057931" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238635.20Cranelift.3A.20add.20alignment.20parameter.20to.2E.2E.2E.html#439057931">(May 16 2024 at 16:24)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8635">PR #8635</a>.</p>



<a name="439058030"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238635%20Cranelift%3A%20add%20alignment%20parameter%20to.../near/439058030" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238635.20Cranelift.3A.20add.20alignment.20parameter.20to.2E.2E.2E.html#439058030">(May 16 2024 at 16:25)</a>:</h4>
<p>cfallin has enabled auto merge for <a href="https://github.com/bytecodealliance/wasmtime/pull/8635">PR #8635</a>.</p>



<a name="439058224"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238635%20Cranelift%3A%20add%20alignment%20parameter%20to.../near/439058224" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238635.20Cranelift.3A.20add.20alignment.20parameter.20to.2E.2E.2E.html#439058224">(May 16 2024 at 16:26)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8635">PR #8635</a>.</p>



<a name="439064357"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238635%20Cranelift%3A%20add%20alignment%20parameter%20to.../near/439064357" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238635.20Cranelift.3A.20add.20alignment.20parameter.20to.2E.2E.2E.html#439064357">(May 16 2024 at 17:02)</a>:</h4>
<p>cfallin merged <a href="https://github.com/bytecodealliance/wasmtime/pull/8635">PR #8635</a>.</p>



<a name="439090416"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238635%20Cranelift%3A%20add%20alignment%20parameter%20to.../near/439090416" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238635.20Cranelift.3A.20add.20alignment.20parameter.20to.2E.2E.2E.html#439090416">(May 16 2024 at 19:50)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8635#pullrequestreview-2061746320">PR review</a>.</p>



<a name="439090417"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238635%20Cranelift%3A%20add%20alignment%20parameter%20to.../near/439090417" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238635.20Cranelift.3A.20add.20alignment.20parameter.20to.2E.2E.2E.html#439090417">(May 16 2024 at 19:50)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/8635#discussion_r1603954465">PR review comment</a>:</p>
<blockquote>
<p>If the alignment is bigger than the ABI stack alignment it would be necessary to adjust the stack pointer to correctly align it. This is missing here. Rust allows arbitrary power of two alignments for stack variables, even something crazy like a 1GB alignment. More realistically though, cache line alignment is used by crates like rayon for performance reasons. Without correctly aligning, rustc will trigger a debug assertion in some cases like for the aforementioned rayon crate.</p>
</blockquote>



<a name="439102436"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238635%20Cranelift%3A%20add%20alignment%20parameter%20to.../near/439102436" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238635.20Cranelift.3A.20add.20alignment.20parameter.20to.2E.2E.2E.html#439102436">(May 16 2024 at 21:13)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8635#pullrequestreview-2061901730">PR review</a>.</p>



<a name="439102437"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238635%20Cranelift%3A%20add%20alignment%20parameter%20to.../near/439102437" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238635.20Cranelift.3A.20add.20alignment.20parameter.20to.2E.2E.2E.html#439102437">(May 16 2024 at 21:13)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/8635#discussion_r1604049170">PR review comment</a>:</p>
<blockquote>
<p>Ah, yes, that's a good point -- to summarize: alignment of offset within the stack frame to alignment A does not imply alignment to A overall, because SP itself may be aligned less (e.g. only to A/4).</p>
<p>I don't have time to work further on this at the moment, but I'd be happy to review a PR that addressed this.</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>