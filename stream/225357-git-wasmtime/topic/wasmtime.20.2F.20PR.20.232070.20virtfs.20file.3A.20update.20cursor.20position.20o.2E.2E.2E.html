<html>
<head><meta charset="utf-8"><title>wasmtime / PR #2070 virtfs file: update cursor position o... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232070.20virtfs.20file.3A.20update.20cursor.20position.20o.2E.2E.2E.html">wasmtime / PR #2070 virtfs file: update cursor position o...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="205051564"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232070%20virtfs%20file%3A%20update%20cursor%20position%20o.../near/205051564" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232070.20virtfs.20file.3A.20update.20cursor.20position.20o.2E.2E.2E.html#205051564">(Jul 26 2020 at 13:07)</a>:</h4>
<p>ueno opened <a href="https://github.com/bytecodealliance/wasmtime/pull/2070">PR #2070</a> from <code>wip/dueno/fd-read-virtfs</code> to <code>main</code>:</p>
<blockquote>
<p>If a handle is backed by <code>InMemoryFile</code>, <code>fd_read</code> (turned into <code>Handle::read_vectored</code>) doesn't update the cursor position properly and thus prevents the caller from detecting EOF.</p>
</blockquote>



<a name="205051665"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232070%20virtfs%20file%3A%20update%20cursor%20position%20o.../near/205051665" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232070.20virtfs.20file.3A.20update.20cursor.20position.20o.2E.2E.2E.html#205051665">(Jul 26 2020 at 13:10)</a>:</h4>
<p><strong>tschneidereit</strong> requested <a href="https://github.com/kubkon">kubkon</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/2070">PR #2070</a>.</p>



<a name="205051683"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232070%20virtfs%20file%3A%20update%20cursor%20position%20o.../near/205051683" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232070.20virtfs.20file.3A.20update.20cursor.20position.20o.2E.2E.2E.html#205051683">(Jul 26 2020 at 13:10)</a>:</h4>
<p><strong>tschneidereit</strong> requested <a href="https://github.com/pchickey">pchickey</a> and <a href="https://github.com/kubkon">kubkon</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/2070">PR #2070</a>.</p>



<a name="205052117"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232070%20virtfs%20file%3A%20update%20cursor%20position%20o.../near/205052117" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232070.20virtfs.20file.3A.20update.20cursor.20position.20o.2E.2E.2E.html#205052117">(Jul 26 2020 at 13:23)</a>:</h4>
<p>ueno updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2070">PR #2070</a> from <code>wip/dueno/fd-read-virtfs</code> to <code>main</code>:</p>
<blockquote>
<p>If a handle is backed by <code>InMemoryFile</code>, <code>fd_read</code> (turned into <code>Handle::read_vectored</code>) doesn't update the cursor position properly and thus prevents the caller from detecting EOF.</p>
</blockquote>



<a name="205052853"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232070%20virtfs%20file%3A%20update%20cursor%20position%20o.../near/205052853" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232070.20virtfs.20file.3A.20update.20cursor.20position.20o.2E.2E.2E.html#205052853">(Jul 26 2020 at 13:42)</a>:</h4>
<p>ueno updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2070">PR #2070</a> from <code>wip/dueno/fd-read-virtfs</code> to <code>main</code>:</p>
<blockquote>
<p>If a handle is backed by <code>InMemoryFile</code>, <code>fd_read</code> (turned into <code>Handle::read_vectored</code>) doesn't update the cursor position properly and thus prevents the caller from detecting EOF.</p>
</blockquote>



<a name="205059796"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232070%20virtfs%20file%3A%20update%20cursor%20position%20o.../near/205059796" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232070.20virtfs.20file.3A.20update.20cursor.20position.20o.2E.2E.2E.html#205059796">(Jul 26 2020 at 17:16)</a>:</h4>
<p>ueno updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2070">PR #2070</a> from <code>wip/dueno/fd-read-virtfs</code> to <code>main</code>:</p>
<blockquote>
<p>If a handle is backed by <code>InMemoryFile</code>, <code>fd_read</code> (turned into <code>Handle::read_vectored</code>) doesn't update the cursor position properly and thus prevents the caller from detecting EOF.</p>
</blockquote>



<a name="205062628"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232070%20virtfs%20file%3A%20update%20cursor%20position%20o.../near/205062628" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232070.20virtfs.20file.3A.20update.20cursor.20position.20o.2E.2E.2E.html#205062628">(Jul 26 2020 at 18:42)</a>:</h4>
<p>ueno updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2070">PR #2070</a> from <code>wip/dueno/fd-read-virtfs</code> to <code>main</code>:</p>
<blockquote>
<p>If a handle is backed by <code>InMemoryFile</code>, <code>fd_read</code> (turned into <code>Handle::read_vectored</code>) doesn't update the cursor position properly and thus prevents the caller from detecting EOF.</p>
</blockquote>



<a name="205064423"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232070%20virtfs%20file%3A%20update%20cursor%20position%20o.../near/205064423" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232070.20virtfs.20file.3A.20update.20cursor.20position.20o.2E.2E.2E.html#205064423">(Jul 26 2020 at 19:37)</a>:</h4>
<p>ueno updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2070">PR #2070</a> from <code>wip/dueno/fd-read-virtfs</code> to <code>main</code>:</p>
<blockquote>
<p>If a handle is backed by <code>InMemoryFile</code>, <code>fd_read</code> (turned into <code>Handle::read_vectored</code>) doesn't update the cursor position properly and thus prevents the caller from detecting EOF.</p>
</blockquote>



<a name="205064659"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232070%20virtfs%20file%3A%20update%20cursor%20position%20o.../near/205064659" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232070.20virtfs.20file.3A.20update.20cursor.20position.20o.2E.2E.2E.html#205064659">(Jul 26 2020 at 19:45)</a>:</h4>
<p>ueno updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2070">PR #2070</a> from <code>wip/dueno/fd-read-virtfs</code> to <code>main</code>:</p>
<blockquote>
<p>If a handle is backed by <code>InMemoryFile</code>, <code>fd_read</code> (turned into <code>Handle::read_vectored</code>) doesn't update the cursor position properly and thus prevents the caller from detecting EOF.</p>
</blockquote>



<a name="205080210"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232070%20virtfs%20file%3A%20update%20cursor%20position%20o.../near/205080210" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232070.20virtfs.20file.3A.20update.20cursor.20position.20o.2E.2E.2E.html#205080210">(Jul 27 2020 at 04:00)</a>:</h4>
<p>ueno updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2070">PR #2070</a> from <code>wip/dueno/fd-read-virtfs</code> to <code>main</code>:</p>
<blockquote>
<p>If a handle is backed by <code>InMemoryFile</code>, <code>fd_read</code> (turned into <code>Handle::read_vectored</code>) doesn't update the cursor position properly and thus prevents the caller from detecting EOF.</p>
</blockquote>



<a name="205081894"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232070%20virtfs%20file%3A%20update%20cursor%20position%20o.../near/205081894" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232070.20virtfs.20file.3A.20update.20cursor.20position.20o.2E.2E.2E.html#205081894">(Jul 27 2020 at 04:56)</a>:</h4>
<p>ueno edited <a href="https://github.com/bytecodealliance/wasmtime/pull/2070">PR #2070</a> from <code>wip/dueno/fd-read-virtfs</code> to <code>main</code>:</p>
<blockquote>
<p>If a handle is backed by <code>InMemoryFile</code>, <code>fd_read</code> (turned into <code>Handle::read_vectored</code>) doesn't update the cursor position properly and thus prevents the caller from detecting EOF.</p>
<p>This also fixes a similar issue in <code>fd_pread</code>, which doesn't advance the read offset when reading data into multiple iovecs.</p>
</blockquote>



<a name="205082038"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232070%20virtfs%20file%3A%20update%20cursor%20position%20o.../near/205082038" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232070.20virtfs.20file.3A.20update.20cursor.20position.20o.2E.2E.2E.html#205082038">(Jul 27 2020 at 05:00)</a>:</h4>
<p>ueno updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2070">PR #2070</a> from <code>wip/dueno/fd-read-virtfs</code> to <code>main</code>:</p>
<blockquote>
<p>If a handle is backed by <code>InMemoryFile</code>, <code>fd_read</code> (turned into <code>Handle::read_vectored</code>) doesn't update the cursor position properly and thus prevents the caller from detecting EOF.</p>
<p>This also fixes a similar issue in <code>fd_pread</code>, which doesn't advance the read offset when reading data into multiple iovecs.</p>
</blockquote>



<a name="205090358"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232070%20virtfs%20file%3A%20update%20cursor%20position%20o.../near/205090358" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232070.20virtfs.20file.3A.20update.20cursor.20position.20o.2E.2E.2E.html#205090358">(Jul 27 2020 at 08:03)</a>:</h4>
<p>kubkon submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2070#pullrequestreview-455512506">PR Review</a>.</p>



<a name="205090359"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232070%20virtfs%20file%3A%20update%20cursor%20position%20o.../near/205090359" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232070.20virtfs.20file.3A.20update.20cursor.20position.20o.2E.2E.2E.html#205090359">(Jul 27 2020 at 08:03)</a>:</h4>
<p>kubkon submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2070#pullrequestreview-455512506">PR Review</a>.</p>



<a name="205090360"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232070%20virtfs%20file%3A%20update%20cursor%20position%20o.../near/205090360" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232070.20virtfs.20file.3A.20update.20cursor.20position.20o.2E.2E.2E.html#205090360">(Jul 27 2020 at 08:03)</a>:</h4>
<p>kubkon created <a href="https://github.com/bytecodealliance/wasmtime/pull/2070#discussion_r460682186">PR Review Comment</a>:</p>
<blockquote>
<p>Would you mind extracting this out into a temp variable such as <code>let nread = ...</code> and then doing an assertion <code>assert_eq!(nread, buffer.len(), ...)</code>? This hopefully should aid readability.</p>
</blockquote>



<a name="205090361"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232070%20virtfs%20file%3A%20update%20cursor%20position%20o.../near/205090361" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232070.20virtfs.20file.3A.20update.20cursor.20position.20o.2E.2E.2E.html#205090361">(Jul 27 2020 at 08:03)</a>:</h4>
<p>kubkon created <a href="https://github.com/bytecodealliance/wasmtime/pull/2070#discussion_r460681312">PR Review Comment</a>:</p>
<blockquote>
<p>Would you mind tweaking the message here to "seeking to the beginning of the file again" or something like this? This should help in debugging especially in the CI should we introduce a regression at some point in the future.</p>
</blockquote>



<a name="205090362"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232070%20virtfs%20file%3A%20update%20cursor%20position%20o.../near/205090362" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232070.20virtfs.20file.3A.20update.20cursor.20position.20o.2E.2E.2E.html#205090362">(Jul 27 2020 at 08:03)</a>:</h4>
<p>kubkon created <a href="https://github.com/bytecodealliance/wasmtime/pull/2070#discussion_r460685397">PR Review Comment</a>:</p>
<blockquote>
<p>In case <code>types::Filesize</code> ever changes its ABI from <code>u64</code> into something different, would you mind using <code>From</code> trait to do the cast here: <code>read_total.into()</code> or <code>u64::from(read_total)</code>?</p>
</blockquote>



<a name="205090363"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232070%20virtfs%20file%3A%20update%20cursor%20position%20o.../near/205090363" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232070.20virtfs.20file.3A.20update.20cursor.20position.20o.2E.2E.2E.html#205090363">(Jul 27 2020 at 08:03)</a>:</h4>
<p>kubkon created <a href="https://github.com/bytecodealliance/wasmtime/pull/2070#discussion_r460685623">PR Review Comment</a>:</p>
<blockquote>
<p>Like above, if you could tweak this to use the <code>From</code> trait instead of using an explicit <code>as</code> cast.</p>
</blockquote>



<a name="205090364"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232070%20virtfs%20file%3A%20update%20cursor%20position%20o.../near/205090364" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232070.20virtfs.20file.3A.20update.20cursor.20position.20o.2E.2E.2E.html#205090364">(Jul 27 2020 at 08:03)</a>:</h4>
<p>kubkon created <a href="https://github.com/bytecodealliance/wasmtime/pull/2070#discussion_r460680753">PR Review Comment</a>:</p>
<blockquote>
<p>Is there any reason for this name change?</p>
</blockquote>



<a name="205090365"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232070%20virtfs%20file%3A%20update%20cursor%20position%20o.../near/205090365" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232070.20virtfs.20file.3A.20update.20cursor.20position.20o.2E.2E.2E.html#205090365">(Jul 27 2020 at 08:03)</a>:</h4>
<p>kubkon created <a href="https://github.com/bytecodealliance/wasmtime/pull/2070#discussion_r460714089">PR Review Comment</a>:</p>
<blockquote>
<p>I think this should either be <code>EFAULT</code> or <code>ENOMEM</code>. The former seems to be accurate for Linux, while the latter for macOS (and probably BSDs in general). But to get another pair of eyes on this, @sunfishcode could you offer some advice here please?</p>
</blockquote>



<a name="205094193"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232070%20virtfs%20file%3A%20update%20cursor%20position%20o.../near/205094193" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232070.20virtfs.20file.3A.20update.20cursor.20position.20o.2E.2E.2E.html#205094193">(Jul 27 2020 at 09:03)</a>:</h4>
<p>ueno updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2070">PR #2070</a> from <code>wip/dueno/fd-read-virtfs</code> to <code>main</code>:</p>
<blockquote>
<p>If a handle is backed by <code>InMemoryFile</code>, <code>fd_read</code> (turned into <code>Handle::read_vectored</code>) doesn't update the cursor position properly and thus prevents the caller from detecting EOF.</p>
<p>This also fixes a similar issue in <code>fd_pread</code>, which doesn't advance the read offset when reading data into multiple iovecs.</p>
</blockquote>



<a name="205094589"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232070%20virtfs%20file%3A%20update%20cursor%20position%20o.../near/205094589" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232070.20virtfs.20file.3A.20update.20cursor.20position.20o.2E.2E.2E.html#205094589">(Jul 27 2020 at 09:08)</a>:</h4>
<p>ueno submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2070#pullrequestreview-455605686">PR Review</a>.</p>



<a name="205094593"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232070%20virtfs%20file%3A%20update%20cursor%20position%20o.../near/205094593" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232070.20virtfs.20file.3A.20update.20cursor.20position.20o.2E.2E.2E.html#205094593">(Jul 27 2020 at 09:08)</a>:</h4>
<p>ueno created <a href="https://github.com/bytecodealliance/wasmtime/pull/2070#discussion_r460751417">PR Review Comment</a>:</p>
<blockquote>
<p>This is just for consistency; in other tests such as <code>fd_flags_set.rs</code> or <code>file_truncate.rs</code>, "buffer" (or "buf") is used as a name of mutable buffers, and immutable buffers are called "data" or "contents". As we call <code>fd_read</code> below and need to assign a name to the immutable buffer, I thought it might be less confusing to follow the convention.</p>
</blockquote>



<a name="205094678"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232070%20virtfs%20file%3A%20update%20cursor%20position%20o.../near/205094678" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232070.20virtfs.20file.3A.20update.20cursor.20position.20o.2E.2E.2E.html#205094678">(Jul 27 2020 at 09:09)</a>:</h4>
<p>kubkon submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2070#pullrequestreview-455606882">PR Review</a>.</p>



<a name="205094679"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232070%20virtfs%20file%3A%20update%20cursor%20position%20o.../near/205094679" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232070.20virtfs.20file.3A.20update.20cursor.20position.20o.2E.2E.2E.html#205094679">(Jul 27 2020 at 09:09)</a>:</h4>
<p>kubkon created <a href="https://github.com/bytecodealliance/wasmtime/pull/2070#discussion_r460752372">PR Review Comment</a>:</p>
<blockquote>
<p>Huh, I didn't know we had a convention for this, but this makes sense! I'll make sure that we keep it that way from now on. Thanks!</p>
</blockquote>



<a name="205096558"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232070%20virtfs%20file%3A%20update%20cursor%20position%20o.../near/205096558" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232070.20virtfs.20file.3A.20update.20cursor.20position.20o.2E.2E.2E.html#205096558">(Jul 27 2020 at 09:34)</a>:</h4>
<p>ueno updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2070">PR #2070</a> from <code>wip/dueno/fd-read-virtfs</code> to <code>main</code>:</p>
<blockquote>
<p>If a handle is backed by <code>InMemoryFile</code>, <code>fd_read</code> (turned into <code>Handle::read_vectored</code>) doesn't update the cursor position properly and thus prevents the caller from detecting EOF.</p>
<p>This also fixes a similar issue in <code>fd_pread</code>, which doesn't advance the read offset when reading data into multiple iovecs.</p>
</blockquote>



<a name="205096974"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232070%20virtfs%20file%3A%20update%20cursor%20position%20o.../near/205096974" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232070.20virtfs.20file.3A.20update.20cursor.20position.20o.2E.2E.2E.html#205096974">(Jul 27 2020 at 09:39)</a>:</h4>
<p>ueno submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2070#pullrequestreview-455628261">PR Review</a>.</p>



<a name="205096975"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232070%20virtfs%20file%3A%20update%20cursor%20position%20o.../near/205096975" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232070.20virtfs.20file.3A.20update.20cursor.20position.20o.2E.2E.2E.html#205096975">(Jul 27 2020 at 09:39)</a>:</h4>
<p>ueno created <a href="https://github.com/bytecodealliance/wasmtime/pull/2070#discussion_r460769274">PR Review Comment</a>:</p>
<blockquote>
<p>Since there is no auto conversion from <code>usize</code> to <code>u64</code>, I added a temporary variable with type annotation and used <code>try_into</code>, but I suppose there is a simpler solution.</p>
<p>Btw, while doing that I also noticed <code>fd_pwrite</code> has the same issue, so I included a fix for that as well.</p>
</blockquote>



<a name="205098363"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232070%20virtfs%20file%3A%20update%20cursor%20position%20o.../near/205098363" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232070.20virtfs.20file.3A.20update.20cursor.20position.20o.2E.2E.2E.html#205098363">(Jul 27 2020 at 09:54)</a>:</h4>
<p>ueno updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2070">PR #2070</a> from <code>wip/dueno/fd-read-virtfs</code> to <code>main</code>:</p>
<blockquote>
<p>If a handle is backed by <code>InMemoryFile</code>, <code>fd_read</code> (turned into <code>Handle::read_vectored</code>) doesn't update the cursor position properly and thus prevents the caller from detecting EOF.</p>
<p>This also fixes a similar issue in <code>fd_pread</code>, which doesn't advance the read offset when reading data into multiple iovecs.</p>
</blockquote>



<a name="205100925"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232070%20virtfs%20file%3A%20update%20cursor%20position%20o.../near/205100925" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232070.20virtfs.20file.3A.20update.20cursor.20position.20o.2E.2E.2E.html#205100925">(Jul 27 2020 at 10:25)</a>:</h4>
<p>ueno updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2070">PR #2070</a> from <code>wip/dueno/fd-read-virtfs</code> to <code>main</code>:</p>
<blockquote>
<p>If a handle is backed by <code>InMemoryFile</code>, <code>fd_read</code> (turned into <code>Handle::read_vectored</code>) doesn't update the cursor position properly and thus prevents the caller from detecting EOF.</p>
<p>This also fixes a similar issue in <code>fd_pread</code>, which doesn't advance the read offset when reading data into multiple iovecs.</p>
</blockquote>



<a name="205103460"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232070%20virtfs%20file%3A%20update%20cursor%20position%20o.../near/205103460" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232070.20virtfs.20file.3A.20update.20cursor.20position.20o.2E.2E.2E.html#205103460">(Jul 27 2020 at 11:00)</a>:</h4>
<p>kubkon submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2070#pullrequestreview-455680545">PR Review</a>.</p>



<a name="205103462"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232070%20virtfs%20file%3A%20update%20cursor%20position%20o.../near/205103462" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232070.20virtfs.20file.3A.20update.20cursor.20position.20o.2E.2E.2E.html#205103462">(Jul 27 2020 at 11:00)</a>:</h4>
<p>kubkon created <a href="https://github.com/bytecodealliance/wasmtime/pull/2070#discussion_r460811191">PR Review Comment</a>:</p>
<blockquote>
<p>@ueno could you replace this <code>as</code> cast with <code>TryInto</code> as well here?</p>
</blockquote>



<a name="205107334"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232070%20virtfs%20file%3A%20update%20cursor%20position%20o.../near/205107334" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232070.20virtfs.20file.3A.20update.20cursor.20position.20o.2E.2E.2E.html#205107334">(Jul 27 2020 at 11:52)</a>:</h4>
<p>ueno updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2070">PR #2070</a> from <code>wip/dueno/fd-read-virtfs</code> to <code>main</code>:</p>
<blockquote>
<p>If a handle is backed by <code>InMemoryFile</code>, <code>fd_read</code> (turned into <code>Handle::read_vectored</code>) doesn't update the cursor position properly and thus prevents the caller from detecting EOF.</p>
<p>This also fixes a similar issue in <code>fd_pread</code>, which doesn't advance the read offset when reading data into multiple iovecs.</p>
</blockquote>



<a name="205113282"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232070%20virtfs%20file%3A%20update%20cursor%20position%20o.../near/205113282" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232070.20virtfs.20file.3A.20update.20cursor.20position.20o.2E.2E.2E.html#205113282">(Jul 27 2020 at 12:59)</a>:</h4>
<p>ueno updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2070">PR #2070</a> from <code>wip/dueno/fd-read-virtfs</code> to <code>main</code>:</p>
<blockquote>
<p>If a handle is backed by <code>InMemoryFile</code>, <code>fd_read</code> (turned into <code>Handle::read_vectored</code>) doesn't update the cursor position properly and thus prevents the caller from detecting EOF.</p>
<p>This also fixes a similar issue in <code>fd_pread</code>, which doesn't advance the read offset when reading data into multiple iovecs.</p>
</blockquote>



<a name="205128737"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232070%20virtfs%20file%3A%20update%20cursor%20position%20o.../near/205128737" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232070.20virtfs.20file.3A.20update.20cursor.20position.20o.2E.2E.2E.html#205128737">(Jul 27 2020 at 15:06)</a>:</h4>
<p>kubkon submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2070#pullrequestreview-455872483">PR Review</a>.</p>



<a name="205128738"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232070%20virtfs%20file%3A%20update%20cursor%20position%20o.../near/205128738" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232070.20virtfs.20file.3A.20update.20cursor.20position.20o.2E.2E.2E.html#205128738">(Jul 27 2020 at 15:06)</a>:</h4>
<p>kubkon created <a href="https://github.com/bytecodealliance/wasmtime/pull/2070#discussion_r460959918">PR Review Comment</a>:</p>
<blockquote>
<p>Would you mind linking in <a href="https://github.com/rust-lang/rust/issues/74825">rust-lang/rust#74825</a> for posterity?</p>
</blockquote>



<a name="205128756"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232070%20virtfs%20file%3A%20update%20cursor%20position%20o.../near/205128756" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232070.20virtfs.20file.3A.20update.20cursor.20position.20o.2E.2E.2E.html#205128756">(Jul 27 2020 at 15:06)</a>:</h4>
<p>kubkon submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2070#pullrequestreview-455872643">PR Review</a>.</p>



<a name="205128757"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232070%20virtfs%20file%3A%20update%20cursor%20position%20o.../near/205128757" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232070.20virtfs.20file.3A.20update.20cursor.20position.20o.2E.2E.2E.html#205128757">(Jul 27 2020 at 15:06)</a>:</h4>
<p>kubkon created <a href="https://github.com/bytecodealliance/wasmtime/pull/2070#discussion_r460960065">PR Review Comment</a>:</p>
<blockquote>
<p>And here?</p>
</blockquote>



<a name="205129702"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232070%20virtfs%20file%3A%20update%20cursor%20position%20o.../near/205129702" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232070.20virtfs.20file.3A.20update.20cursor.20position.20o.2E.2E.2E.html#205129702">(Jul 27 2020 at 15:13)</a>:</h4>
<p>ueno updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2070">PR #2070</a> from <code>wip/dueno/fd-read-virtfs</code> to <code>main</code>:</p>
<blockquote>
<p>If a handle is backed by <code>InMemoryFile</code>, <code>fd_read</code> (turned into <code>Handle::read_vectored</code>) doesn't update the cursor position properly and thus prevents the caller from detecting EOF.</p>
<p>This also fixes a similar issue in <code>fd_pread</code>, which doesn't advance the read offset when reading data into multiple iovecs.</p>
</blockquote>



<a name="205168130"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232070%20virtfs%20file%3A%20update%20cursor%20position%20o.../near/205168130" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232070.20virtfs.20file.3A.20update.20cursor.20position.20o.2E.2E.2E.html#205168130">(Jul 27 2020 at 21:04)</a>:</h4>
<p>sunfishcode submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2070#pullrequestreview-456134282">PR Review</a>.</p>



<a name="205168131"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232070%20virtfs%20file%3A%20update%20cursor%20position%20o.../near/205168131" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232070.20virtfs.20file.3A.20update.20cursor.20position.20o.2E.2E.2E.html#205168131">(Jul 27 2020 at 21:04)</a>:</h4>
<p>sunfishcode created <a href="https://github.com/bytecodealliance/wasmtime/pull/2070#discussion_r461169202">PR Review Comment</a>:</p>
<blockquote>
<p>Looking at POSIX, this looks like more of an <code>EINVAL</code> situation than <code>EFAULT</code>.</p>
<p><a href="https://pubs.opengroup.org/onlinepubs/009695399/functions/pread.html">https://pubs.opengroup.org/onlinepubs/009695399/functions/pread.html</a></p>
<p><code>EINVAL</code> is for "the offset argument is not valid".</p>
</blockquote>



<a name="205200919"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232070%20virtfs%20file%3A%20update%20cursor%20position%20o.../near/205200919" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232070.20virtfs.20file.3A.20update.20cursor.20position.20o.2E.2E.2E.html#205200919">(Jul 28 2020 at 06:06)</a>:</h4>
<p>ueno updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2070">PR #2070</a> from <code>wip/dueno/fd-read-virtfs</code> to <code>main</code>:</p>
<blockquote>
<p>If a handle is backed by <code>InMemoryFile</code>, <code>fd_read</code> (turned into <code>Handle::read_vectored</code>) doesn't update the cursor position properly and thus prevents the caller from detecting EOF.</p>
<p>This also fixes a similar issue in <code>fd_pread</code>, which doesn't advance the read offset when reading data into multiple iovecs.</p>
</blockquote>



<a name="205200935"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232070%20virtfs%20file%3A%20update%20cursor%20position%20o.../near/205200935" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232070.20virtfs.20file.3A.20update.20cursor.20position.20o.2E.2E.2E.html#205200935">(Jul 28 2020 at 06:06)</a>:</h4>
<p>ueno submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2070#pullrequestreview-456326389">PR Review</a>.</p>



<a name="205200936"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232070%20virtfs%20file%3A%20update%20cursor%20position%20o.../near/205200936" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232070.20virtfs.20file.3A.20update.20cursor.20position.20o.2E.2E.2E.html#205200936">(Jul 28 2020 at 06:06)</a>:</h4>
<p>ueno created <a href="https://github.com/bytecodealliance/wasmtime/pull/2070#discussion_r461339358">PR Review Comment</a>:</p>
<blockquote>
<p>Thank you for the pointer; I've updated it to using <code>EINVAL</code>.</p>
</blockquote>



<a name="205202826"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232070%20virtfs%20file%3A%20update%20cursor%20position%20o.../near/205202826" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232070.20virtfs.20file.3A.20update.20cursor.20position.20o.2E.2E.2E.html#205202826">(Jul 28 2020 at 06:50)</a>:</h4>
<p>ueno updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2070">PR #2070</a> from <code>wip/dueno/fd-read-virtfs</code> to <code>main</code>:</p>
<blockquote>
<p>If a handle is backed by <code>InMemoryFile</code>, <code>fd_read</code> (turned into <code>Handle::read_vectored</code>) doesn't update the cursor position properly and thus prevents the caller from detecting EOF.</p>
<p>This also fixes a similar issue in <code>fd_pread</code>, which doesn't advance the read offset when reading data into multiple iovecs.</p>
</blockquote>



<a name="205204802"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232070%20virtfs%20file%3A%20update%20cursor%20position%20o.../near/205204802" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232070.20virtfs.20file.3A.20update.20cursor.20position.20o.2E.2E.2E.html#205204802">(Jul 28 2020 at 07:29)</a>:</h4>
<p>ueno updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2070">PR #2070</a> from <code>wip/dueno/fd-read-virtfs</code> to <code>main</code>:</p>
<blockquote>
<p>If a handle is backed by <code>InMemoryFile</code>, <code>fd_read</code> (turned into <code>Handle::read_vectored</code>) doesn't update the cursor position properly and thus prevents the caller from detecting EOF.</p>
<p>This also fixes a similar issue in <code>fd_pread</code>, which doesn't advance the read offset when reading data into multiple iovecs.</p>
</blockquote>



<a name="205213518"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232070%20virtfs%20file%3A%20update%20cursor%20position%20o.../near/205213518" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232070.20virtfs.20file.3A.20update.20cursor.20position.20o.2E.2E.2E.html#205213518">(Jul 28 2020 at 09:18)</a>:</h4>
<p>kubkon submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2070#pullrequestreview-456453386">PR Review</a>.</p>



<a name="205231972"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232070%20virtfs%20file%3A%20update%20cursor%20position%20o.../near/205231972" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232070.20virtfs.20file.3A.20update.20cursor.20position.20o.2E.2E.2E.html#205231972">(Jul 28 2020 at 13:04)</a>:</h4>
<p>ueno updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2070">PR #2070</a> from <code>wip/dueno/fd-read-virtfs</code> to <code>main</code>:</p>
<blockquote>
<p>If a handle is backed by <code>InMemoryFile</code>, <code>fd_read</code> (turned into <code>Handle::read_vectored</code>) doesn't update the cursor position properly and thus prevents the caller from detecting EOF.</p>
<p>This also fixes a similar issue in <code>fd_pread</code>, which doesn't advance the read offset when reading data into multiple iovecs.</p>
</blockquote>



<a name="205348582"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232070%20virtfs%20file%3A%20update%20cursor%20position%20o.../near/205348582" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232070.20virtfs.20file.3A.20update.20cursor.20position.20o.2E.2E.2E.html#205348582">(Jul 29 2020 at 12:19)</a>:</h4>
<p>kubkon merged <a href="https://github.com/bytecodealliance/wasmtime/pull/2070">PR #2070</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>