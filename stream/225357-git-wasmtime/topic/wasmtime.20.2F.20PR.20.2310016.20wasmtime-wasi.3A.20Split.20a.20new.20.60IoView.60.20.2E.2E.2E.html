<html>
<head><meta charset="utf-8"><title>wasmtime / PR #10016 wasmtime-wasi: Split a new `IoView` ... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310016.20wasmtime-wasi.3A.20Split.20a.20new.20.60IoView.60.20.2E.2E.2E.html">wasmtime / PR #10016 wasmtime-wasi: Split a new `IoView` ...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="493670573"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310016%20wasmtime-wasi%3A%20Split%20a%20new%20%60IoView%60%20.../near/493670573" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310016.20wasmtime-wasi.3A.20Split.20a.20new.20.60IoView.60.20.2E.2E.2E.html#493670573">(Jan 14 2025 at 21:06)</a>:</h4>
<p>pchickey opened <a href="https://github.com/bytecodealliance/wasmtime/pull/10016">PR #10016</a> from <code>bytecodealliance:pch/wasi_view_traits</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>&lt;!--<br>
Please make sure you include the following information:</p>
<ul>
<li>
<p>If this work has been discussed elsewhere, please include a link to that<br>
  conversation. If it was discussed in an issue, just mention "issue #...".</p>
</li>
<li>
<p>Explain why this change is needed. If the details are in an issue already,<br>
  this can be brief.</p>
</li>
</ul>
<p>Our development process is documented in the Wasmtime book:<br>
<a href="https://docs.wasmtime.dev/contributing-development-process.html">https://docs.wasmtime.dev/contributing-development-process.html</a></p>
<p>Please ensure all communication follows the code of conduct:<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>
--&gt;</p>
</blockquote>



<a name="493673709"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310016%20wasmtime-wasi%3A%20Split%20a%20new%20%60IoView%60%20.../near/493673709" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310016.20wasmtime-wasi.3A.20Split.20a.20new.20.60IoView.60.20.2E.2E.2E.html#493673709">(Jan 14 2025 at 21:27)</a>:</h4>
<p>pchickey updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10016">PR #10016</a>.</p>



<a name="493694078"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310016%20wasmtime-wasi%3A%20Split%20a%20new%20%60IoView%60%20.../near/493694078" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310016.20wasmtime-wasi.3A.20Split.20a.20new.20.60IoView.60.20.2E.2E.2E.html#493694078">(Jan 15 2025 at 00:27)</a>:</h4>
<p>pchickey updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10016">PR #10016</a>.</p>



<a name="494025408"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310016%20wasmtime-wasi%3A%20Split%20a%20new%20%60IoView%60%20.../near/494025408" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310016.20wasmtime-wasi.3A.20Split.20a.20new.20.60IoView.60.20.2E.2E.2E.html#494025408">(Jan 15 2025 at 22:05)</a>:</h4>
<p>pchickey updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10016">PR #10016</a>.</p>



<a name="494025590"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310016%20wasmtime-wasi%3A%20Split%20a%20new%20%60IoView%60%20.../near/494025590" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310016.20wasmtime-wasi.3A.20Split.20a.20new.20.60IoView.60.20.2E.2E.2E.html#494025590">(Jan 15 2025 at 22:06)</a>:</h4>
<p>pchickey updated <a href="https://github.com/bytecodealliance/wasmtime/pull/10016">PR #10016</a>.</p>



<a name="494229968"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310016%20wasmtime-wasi%3A%20Split%20a%20new%20%60IoView%60%20.../near/494229968" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310016.20wasmtime-wasi.3A.20Split.20a.20new.20.60IoView.60.20.2E.2E.2E.html#494229968">(Jan 16 2025 at 20:47)</a>:</h4>
<p>pchickey edited <a href="https://github.com/bytecodealliance/wasmtime/pull/10016">PR #10016</a>:</p>
<blockquote>
<p>This PR prepares the wasi-io aspects of the wasmtime-wasi crate to be split off into its own independent crate, in order for the common base of wasi-io functionality to be reusable in a variety of host implementations which do not intend to reuse all of wasmtime-wasi.</p>
<h2>Summary for users</h2>
<p>You're using wasmtime-wasi, and maybe even wasmtime-wasi-http. You defined a struct like:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">use</span><span class="w"> </span><span class="n">wasmtime</span><span class="p">::</span><span class="n">component</span><span class="p">::</span><span class="n">ResourceTable</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="n">wasmtime_wasi</span><span class="p">::</span><span class="n">WasiCtx</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="n">wasmtime_wasi_http</span><span class="p">::</span><span class="n">WasiHttpCtx</span><span class="p">;</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">MyCtx</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">table</span><span class="p">:</span><span class="w"> </span><span class="nc">ResourceTable</span><span class="p">,</span>
<span class="w">    </span><span class="n">wasi</span><span class="p">:</span><span class="w"> </span><span class="nc">WasiCtx</span><span class="p">,</span>
<span class="w">    </span><span class="n">http</span><span class="p">:</span><span class="w"> </span><span class="nc">WasiHttpCtx</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div>
<p>Prior to this PR, you'd hook your <code>MyCtx</code> up to the <code>WasiView</code> and <code>WasiHttpView</code> traits like:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">impl</span><span class="w"> </span><span class="n">WasiView</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">MyCtx</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">table</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">ResourceTable</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">table</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">ctx</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">WasiCtx</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">wasi</span><span class="w"> </span><span class="p">}</span>
<span class="p">}</span>
<span class="k">impl</span><span class="w"> </span><span class="n">WasiHttpView</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">MyCtx</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">table</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">ResourceTable</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">table</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">ctx</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">WasiHttpCtx</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">http</span><span class="w"> </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>After this PR, you rewrite that to:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">impl</span><span class="w"> </span><span class="n">IoView</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">MyCtx</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">table</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">ResourceTable</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">table</span><span class="w"> </span><span class="p">}</span>
<span class="p">}</span>
<span class="k">impl</span><span class="w"> </span><span class="n">WasiView</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">MyCtx</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">ctx</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">WasiCtx</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">wasi</span><span class="w"> </span><span class="p">}</span>
<span class="p">}</span>
<span class="k">impl</span><span class="w"> </span><span class="n">WasiHttpView</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">MyCtx</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">ctx</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">WasiHttpCtx</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">http</span><span class="w"> </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Thats it. For almost all users, you don't have to worry about anything else. All of the other aspects of <code>wasmtime_wasi{,_http}::add_to_linker_{sync,async}</code> keep working exactly like before. Semantically, nothing changed. The <code>WasiView</code> and <code>WasiHttpView</code> traits grew a common implies on the <code>IoView</code> trait, i.e. <code>trait WasiView: IoView {...}</code>, <code>trait WasiHttpView: IoView {...}</code>. </p>
</blockquote>



<a name="494230727"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310016%20wasmtime-wasi%3A%20Split%20a%20new%20%60IoView%60%20.../near/494230727" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310016.20wasmtime-wasi.3A.20Split.20a.20new.20.60IoView.60.20.2E.2E.2E.html#494230727">(Jan 16 2025 at 20:53)</a>:</h4>
<p>pchickey edited <a href="https://github.com/bytecodealliance/wasmtime/pull/10016">PR #10016</a>:</p>
<blockquote>
<p>This PR prepares the wasi-io aspects of the wasmtime-wasi crate to be split off into its own independent crate, in order for the common base of wasi-io functionality to be reusable in a variety of host implementations which do not intend to reuse all of wasmtime-wasi.</p>
<h2>Summary for users</h2>
<p>You're an embedder using wasmtime-wasi, and maybe even wasmtime-wasi-http. You defined a struct like:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">use</span><span class="w"> </span><span class="n">wasmtime</span><span class="p">::</span><span class="n">component</span><span class="p">::</span><span class="n">ResourceTable</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="n">wasmtime_wasi</span><span class="p">::</span><span class="n">WasiCtx</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="n">wasmtime_wasi_http</span><span class="p">::</span><span class="n">WasiHttpCtx</span><span class="p">;</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">MyCtx</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">table</span><span class="p">:</span><span class="w"> </span><span class="nc">ResourceTable</span><span class="p">,</span>
<span class="w">    </span><span class="n">wasi</span><span class="p">:</span><span class="w"> </span><span class="nc">WasiCtx</span><span class="p">,</span>
<span class="w">    </span><span class="n">http</span><span class="p">:</span><span class="w"> </span><span class="nc">WasiHttpCtx</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div>
<p>Prior to this PR, you'd hook your <code>MyCtx</code> up to the <code>WasiView</code> and <code>WasiHttpView</code> traits like:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">impl</span><span class="w"> </span><span class="n">WasiView</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">MyCtx</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">table</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">ResourceTable</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">table</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">ctx</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">WasiCtx</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">wasi</span><span class="w"> </span><span class="p">}</span>
<span class="p">}</span>
<span class="k">impl</span><span class="w"> </span><span class="n">WasiHttpView</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">MyCtx</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">table</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">ResourceTable</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">table</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">ctx</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">WasiHttpCtx</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">http</span><span class="w"> </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>After this PR, you rewrite that to:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">impl</span><span class="w"> </span><span class="n">IoView</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">MyCtx</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">table</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">ResourceTable</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">table</span><span class="w"> </span><span class="p">}</span>
<span class="p">}</span>
<span class="k">impl</span><span class="w"> </span><span class="n">WasiView</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">MyCtx</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">ctx</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">WasiCtx</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">wasi</span><span class="w"> </span><span class="p">}</span>
<span class="p">}</span>
<span class="k">impl</span><span class="w"> </span><span class="n">WasiHttpView</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">MyCtx</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">ctx</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">WasiHttpCtx</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">http</span><span class="w"> </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Thats it. For almost all users, you don't have to worry about anything else. All of the other aspects of <code>wasmtime_wasi{,_http}::add_to_linker_{sync,async}</code> keep working exactly like before. Semantically, nothing changed. The <code>WasiView</code> and <code>WasiHttpView</code> traits grew a common implies on the <code>IoView</code> trait, i.e. <code>trait WasiView: IoView {...}</code>, <code>trait WasiHttpView: IoView {...}</code>. </p>
<h2>More details</h2>
<p>You probably don't care about these, unless you are doing low level linker stuff and probably can just read the source code to figure it out.</p>
<p>There's a new <code>IoImpl</code> struct that the wasi-io Host trait impls, instead of <code>WasiImpl</code>. Like <code>WasiImpl</code> this struct is <code>#[repr(transparent)]</code>. Anytime you were constructing a <code>WasiImpl(t)</code>, you now construct <code>WasiImpl(IoImpl(t))</code>, e.g. <a href="https://github.com/bytecodealliance/wasmtime/pull/10016/files#diff-a6ec073ba5d074b65f0bcbf8df48af2b126d65034398905bf74d8f10a5c5f8b6R288">https://github.com/bytecodealliance/wasmtime/pull/10016/files#diff-a6ec073ba5d074b65f0bcbf8df48af2b126d65034398905bf74d8f10a5c5f8b6R288</a></p>
<p>If you're using the wasmtime-wit-bindgen generated add_to_linker_ funcs directly, you'll need a variant on the <code>type_annotate</code> hack to get rustc to infer IoView in the right places, e.g. <a href="https://github.com/bytecodealliance/wasmtime/pull/10016/files#diff-a6ec073ba5d074b65f0bcbf8df48af2b126d65034398905bf74d8f10a5c5f8b6R287">https://github.com/bytecodealliance/wasmtime/pull/10016/files#diff-a6ec073ba5d074b65f0bcbf8df48af2b126d65034398905bf74d8f10a5c5f8b6R287</a>. </p>
</blockquote>



<a name="494230740"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310016%20wasmtime-wasi%3A%20Split%20a%20new%20%60IoView%60%20.../near/494230740" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310016.20wasmtime-wasi.3A.20Split.20a.20new.20.60IoView.60.20.2E.2E.2E.html#494230740">(Jan 16 2025 at 20:53)</a>:</h4>
<p><strong>pchickey</strong> has marked <a href="https://github.com/bytecodealliance/wasmtime/pull/10016">PR #10016</a> as ready for review.</p>



<a name="494230744"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310016%20wasmtime-wasi%3A%20Split%20a%20new%20%60IoView%60%20.../near/494230744" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310016.20wasmtime-wasi.3A.20Split.20a.20new.20.60IoView.60.20.2E.2E.2E.html#494230744">(Jan 16 2025 at 20:53)</a>:</h4>
<p><strong>pchickey</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/10016">PR #10016</a>.</p>



<a name="494230745"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310016%20wasmtime-wasi%3A%20Split%20a%20new%20%60IoView%60%20.../near/494230745" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310016.20wasmtime-wasi.3A.20Split.20a.20new.20.60IoView.60.20.2E.2E.2E.html#494230745">(Jan 16 2025 at 20:53)</a>:</h4>
<p><strong>pchickey</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/10016">PR #10016</a>.</p>



<a name="494238410"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310016%20wasmtime-wasi%3A%20Split%20a%20new%20%60IoView%60%20.../near/494238410" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310016.20wasmtime-wasi.3A.20Split.20a.20new.20.60IoView.60.20.2E.2E.2E.html#494238410">(Jan 16 2025 at 21:45)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10016#pullrequestreview-2557416825">PR review</a>.</p>



<a name="494238412"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310016%20wasmtime-wasi%3A%20Split%20a%20new%20%60IoView%60%20.../near/494238412" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310016.20wasmtime-wasi.3A.20Split.20a.20new.20.60IoView.60.20.2E.2E.2E.html#494238412">(Jan 16 2025 at 21:45)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/10016#discussion_r1919261046">PR review comment</a>:</p>
<blockquote>
<p>These docs are now appended to the ones above, so should these words move above the example perhaps?</p>
</blockquote>



<a name="494238413"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310016%20wasmtime-wasi%3A%20Split%20a%20new%20%60IoView%60%20.../near/494238413" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310016.20wasmtime-wasi.3A.20Split.20a.20new.20.60IoView.60.20.2E.2E.2E.html#494238413">(Jan 16 2025 at 21:45)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/10016#discussion_r1919263315">PR review comment</a>:</p>
<blockquote>
<p>To perhaps bikeshed a bit, maybe <code>TableView</code>?</p>
</blockquote>



<a name="494238414"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310016%20wasmtime-wasi%3A%20Split%20a%20new%20%60IoView%60%20.../near/494238414" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310016.20wasmtime-wasi.3A.20Split.20a.20new.20.60IoView.60.20.2E.2E.2E.html#494238414">(Jan 16 2025 at 21:45)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/10016#discussion_r1919264245">PR review comment</a>:</p>
<blockquote>
<p>Also mind ensuring there's documentation for this trait as well? (similar to the <code>WasiView</code> one below)</p>
</blockquote>



<a name="494238415"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310016%20wasmtime-wasi%3A%20Split%20a%20new%20%60IoView%60%20.../near/494238415" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310016.20wasmtime-wasi.3A.20Split.20a.20new.20.60IoView.60.20.2E.2E.2E.html#494238415">(Jan 16 2025 at 21:45)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/10016#discussion_r1919262725">PR review comment</a>:</p>
<blockquote>
<p>Could this retain some of the documentation from before as well? Ideally with an example or links to other examples throughout the crate.</p>
</blockquote>



<a name="494240823"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310016%20wasmtime-wasi%3A%20Split%20a%20new%20%60IoView%60%20.../near/494240823" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310016.20wasmtime-wasi.3A.20Split.20a.20new.20.60IoView.60.20.2E.2E.2E.html#494240823">(Jan 16 2025 at 22:01)</a>:</h4>
<p>pchickey submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10016#pullrequestreview-2557496872">PR review</a>.</p>



<a name="494240824"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310016%20wasmtime-wasi%3A%20Split%20a%20new%20%60IoView%60%20.../near/494240824" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310016.20wasmtime-wasi.3A.20Split.20a.20new.20.60IoView.60.20.2E.2E.2E.html#494240824">(Jan 16 2025 at 22:01)</a>:</h4>
<p>pchickey created <a href="https://github.com/bytecodealliance/wasmtime/pull/10016#discussion_r1919296403">PR review comment</a>:</p>
<blockquote>
<p>I named it <code>Io</code> instead of <code>Table</code> view in anticipation of factoring it out for the <code>wasmtime-wasi-io</code> crate. I don't mind renaming it, but thats why I was thinking <code>Io</code> over <code>Table</code>.</p>
</blockquote>



<a name="494241237"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310016%20wasmtime-wasi%3A%20Split%20a%20new%20%60IoView%60%20.../near/494241237" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310016.20wasmtime-wasi.3A.20Split.20a.20new.20.60IoView.60.20.2E.2E.2E.html#494241237">(Jan 16 2025 at 22:04)</a>:</h4>
<p>pchickey submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10016#pullrequestreview-2557505871">PR review</a>.</p>



<a name="494241239"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310016%20wasmtime-wasi%3A%20Split%20a%20new%20%60IoView%60%20.../near/494241239" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310016.20wasmtime-wasi.3A.20Split.20a.20new.20.60IoView.60.20.2E.2E.2E.html#494241239">(Jan 16 2025 at 22:04)</a>:</h4>
<p>pchickey created <a href="https://github.com/bytecodealliance/wasmtime/pull/10016#discussion_r1919300230">PR review comment</a>:</p>
<blockquote>
<p>I made lots of fixes to the docs during the code motion for <a href="https://github.com/bytecodealliance/wasmtime/pull/10036">https://github.com/bytecodealliance/wasmtime/pull/10036</a> - can we put off the docs review and check it all over there?</p>
</blockquote>



<a name="494241620"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310016%20wasmtime-wasi%3A%20Split%20a%20new%20%60IoView%60%20.../near/494241620" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310016.20wasmtime-wasi.3A.20Split.20a.20new.20.60IoView.60.20.2E.2E.2E.html#494241620">(Jan 16 2025 at 22:07)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/10016#pullrequestreview-2557510078">PR review</a>.</p>



<a name="494241621"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310016%20wasmtime-wasi%3A%20Split%20a%20new%20%60IoView%60%20.../near/494241621" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310016.20wasmtime-wasi.3A.20Split.20a.20new.20.60IoView.60.20.2E.2E.2E.html#494241621">(Jan 16 2025 at 22:07)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/10016#discussion_r1919302870">PR review comment</a>:</p>
<blockquote>
<p>Sounds reasonable to me <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span> </p>
</blockquote>



<a name="494244293"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310016%20wasmtime-wasi%3A%20Split%20a%20new%20%60IoView%60%20.../near/494244293" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310016.20wasmtime-wasi.3A.20Split.20a.20new.20.60IoView.60.20.2E.2E.2E.html#494244293">(Jan 16 2025 at 22:27)</a>:</h4>
<p>alexcrichton merged <a href="https://github.com/bytecodealliance/wasmtime/pull/10016">PR #10016</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>