<html>
<head><meta charset="utf-8"><title>wasmtime / PR #6467 x64: Add pre-SSE4.1 compatible loweri... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236467.20x64.3A.20Add.20pre-SSE4.2E1.20compatible.20loweri.2E.2E.2E.html">wasmtime / PR #6467 x64: Add pre-SSE4.1 compatible loweri...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="361376836"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236467%20x64%3A%20Add%20pre-SSE4.1%20compatible%20loweri.../near/361376836" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236467.20x64.3A.20Add.20pre-SSE4.2E1.20compatible.20loweri.2E.2E.2E.html#361376836">(May 26 2023 at 16:16)</a>:</h4>
<p>alexcrichton opened <a href="https://github.com/bytecodealliance/wasmtime/pull/6467">PR #6467</a> from <code>alexcrichton:x64-misc-less-sse41</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>This commit updates some lowerings using SSE4.1 instructions in miscellaneous locations to compatible versions not using these instructions. This primarily worked by extracting some rules to helpers and delegating to the helpers instead of specific instructions.</p>
<p>One large-ish instruction updated here is the <code>unarrow</code> instruction which lowers to <code>packusdw</code> and doesn't seem to have any "easy" lowering so I took a look at LLVM and tried to simplify it for ISLE.</p>
<p>&lt;!--<br>
Please make sure you include the following information:</p>
<ul>
<li>
<p>If this work has been discussed elsewhere, please include a link to that<br>
  conversation. If it was discussed in an issue, just mention "issue #...".</p>
</li>
<li>
<p>Explain why this change is needed. If the details are in an issue already,<br>
  this can be brief.</p>
</li>
</ul>
<p>Our development process is documented in the Wasmtime book:<br>
<a href="https://docs.wasmtime.dev/contributing-development-process.html">https://docs.wasmtime.dev/contributing-development-process.html</a></p>
<p>Please ensure all communication follows the code of conduct:<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>
--&gt;</p>
</blockquote>



<a name="361376838"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236467%20x64%3A%20Add%20pre-SSE4.1%20compatible%20loweri.../near/361376838" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236467.20x64.3A.20Add.20pre-SSE4.2E1.20compatible.20loweri.2E.2E.2E.html#361376838">(May 26 2023 at 16:16)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/abrown">abrown</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/6467">PR #6467</a>.</p>



<a name="361376842"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236467%20x64%3A%20Add%20pre-SSE4.1%20compatible%20loweri.../near/361376842" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236467.20x64.3A.20Add.20pre-SSE4.2E1.20compatible.20loweri.2E.2E.2E.html#361376842">(May 26 2023 at 16:16)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-compiler-reviewers">wasmtime-compiler-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/6467">PR #6467</a>.</p>



<a name="362565618"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236467%20x64%3A%20Add%20pre-SSE4.1%20compatible%20loweri.../near/362565618" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236467.20x64.3A.20Add.20pre-SSE4.2E1.20compatible.20loweri.2E.2E.2E.html#362565618">(May 31 2023 at 20:32)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6467#pullrequestreview-1454086873">PR review</a>:</p>
<blockquote>
<p>LGTM! Thanks for doing all of this work.</p>
</blockquote>



<a name="362565620"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236467%20x64%3A%20Add%20pre-SSE4.1%20compatible%20loweri.../near/362565620" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236467.20x64.3A.20Add.20pre-SSE4.2E1.20compatible.20loweri.2E.2E.2E.html#362565620">(May 31 2023 at 20:32)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6467#pullrequestreview-1454086873">PR review</a>:</p>
<blockquote>
<p>LGTM! Thanks for doing all of this work.</p>
</blockquote>



<a name="362565621"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236467%20x64%3A%20Add%20pre-SSE4.1%20compatible%20loweri.../near/362565621" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236467.20x64.3A.20Add.20pre-SSE4.2E1.20compatible.20loweri.2E.2E.2E.html#362565621">(May 31 2023 at 20:32)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/6467#discussion_r1212261828">PR review comment</a>:</p>
<blockquote>
<p>Not sure I completely understand: this seems to be saying that we expect <code>a</code> to already be in a register. So I assume all the lowering rules already do this and this is just an extra check that this is the case?</p>
</blockquote>



<a name="362566659"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236467%20x64%3A%20Add%20pre-SSE4.1%20compatible%20loweri.../near/362566659" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236467.20x64.3A.20Add.20pre-SSE4.2E1.20compatible.20loweri.2E.2E.2E.html#362566659">(May 31 2023 at 20:37)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/6467#discussion_r1212283035">PR review comment</a>:</p>
<blockquote>
<p>Ah so before it was <code>a: Value</code> but I called this helper from another location which only had a register so I changed it to <code>a: RegMem</code>. This meant that anything coerced into memory had to be explicitly lifted from memory (the last rule here) so the base rules like making calls only worked with registers.</p>
</blockquote>



<a name="362574982"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236467%20x64%3A%20Add%20pre-SSE4.1%20compatible%20loweri.../near/362574982" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236467.20x64.3A.20Add.20pre-SSE4.2E1.20compatible.20loweri.2E.2E.2E.html#362574982">(May 31 2023 at 21:20)</a>:</h4>
<p>alexcrichton merged <a href="https://github.com/bytecodealliance/wasmtime/pull/6467">PR #6467</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>