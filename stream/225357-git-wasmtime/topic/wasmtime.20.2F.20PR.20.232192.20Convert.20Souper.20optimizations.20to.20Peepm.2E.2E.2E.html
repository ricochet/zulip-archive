<html>
<head><meta charset="utf-8"><title>wasmtime / PR #2192 Convert Souper optimizations to Peepm... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232192.20Convert.20Souper.20optimizations.20to.20Peepm.2E.2E.2E.html">wasmtime / PR #2192 Convert Souper optimizations to Peepm...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="209703228"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232192%20Convert%20Souper%20optimizations%20to%20Peepm.../near/209703228" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232192.20Convert.20Souper.20optimizations.20to.20Peepm.2E.2E.2E.html#209703228">(Sep 10 2020 at 20:14)</a>:</h4>
<p>fitzgen opened <a href="https://github.com/bytecodealliance/wasmtime/pull/2192">PR #2192</a> from <code>souper-to-peepmatic</code> to <code>main</code>:</p>
<blockquote>
<p>Conversion from Souper into Peepmatic is implemented with a straightforward, top-down recursive traversal of the optimization's left- and right-hand side expression DAGs. Most Souper instructions have a corresponding Peepmatic instruction. If we run into an instruction where that isn't the case, we skip that Souper optimization and move on to the next one.</p>
<p>Note that Souper fully supports DAGs, for example:</p>
<div class="codehilite"><pre><span></span><code>%0 = var
%1 = add 1, %0
%2 = add %1, %1       ;; Two edges to `%1` makes this a DAG.
</code></pre></div>


<p>On the other hand, Peepmatic only currently supports trees, so shared subexpressions are duplicated:</p>
<div class="codehilite"><pre><span></span><code>(iadd (iadd 1 $x)
      (iadd 1 $x))    ;; The shared subexpression is duplicated.
</code></pre></div>


<p>This does not, however, affect correctness.</p>
<p>See also #2184, which is related. </p>
</blockquote>



<a name="209703229"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232192%20Convert%20Souper%20optimizations%20to%20Peepm.../near/209703229" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232192.20Convert.20Souper.20optimizations.20to.20Peepm.2E.2E.2E.html#209703229">(Sep 10 2020 at 20:14)</a>:</h4>
<p><strong>fitzgen</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/2192">PR #2192</a>.</p>



<a name="209707742"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232192%20Convert%20Souper%20optimizations%20to%20Peepm.../near/209707742" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232192.20Convert.20Souper.20optimizations.20to.20Peepm.2E.2E.2E.html#209707742">(Sep 10 2020 at 20:54)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2192#pullrequestreview-486298234">PR Review</a>.</p>



<a name="209707743"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232192%20Convert%20Souper%20optimizations%20to%20Peepm.../near/209707743" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232192.20Convert.20Souper.20optimizations.20to.20Peepm.2E.2E.2E.html#209707743">(Sep 10 2020 at 20:54)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2192#pullrequestreview-486298234">PR Review</a>.</p>



<a name="209707745"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232192%20Convert%20Souper%20optimizations%20to%20Peepm.../near/209707745" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232192.20Convert.20Souper.20optimizations.20to.20Peepm.2E.2E.2E.html#209707745">(Sep 10 2020 at 20:54)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/2192#discussion_r486624008">PR Review Comment</a>:</p>
<blockquote>
<p>You could use <code>as_bytes()[1]</code> as <code>%</code> is in the ascii range and you are checking if it is an ascii lowercase alphabetic character.</p>
</blockquote>



<a name="209720461"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232192%20Convert%20Souper%20optimizations%20to%20Peepm.../near/209720461" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232192.20Convert.20Souper.20optimizations.20to.20Peepm.2E.2E.2E.html#209720461">(Sep 10 2020 at 23:06)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2192">PR #2192</a> from <code>souper-to-peepmatic</code> to <code>main</code>:</p>
<blockquote>
<p>Conversion from Souper into Peepmatic is implemented with a straightforward, top-down recursive traversal of the optimization's left- and right-hand side expression DAGs. Most Souper instructions have a corresponding Peepmatic instruction. If we run into an instruction where that isn't the case, we skip that Souper optimization and move on to the next one.</p>
<p>Note that Souper fully supports DAGs, for example:</p>
<div class="codehilite"><pre><span></span><code>%0 = var
%1 = add 1, %0
%2 = add %1, %1       ;; Two edges to `%1` makes this a DAG.
</code></pre></div>


<p>On the other hand, Peepmatic only currently supports trees, so shared subexpressions are duplicated:</p>
<div class="codehilite"><pre><span></span><code>(iadd (iadd 1 $x)
      (iadd 1 $x))    ;; The shared subexpression is duplicated.
</code></pre></div>


<p>This does not, however, affect correctness.</p>
<p>See also #2184, which is related. </p>
</blockquote>



<a name="209816529"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232192%20Convert%20Souper%20optimizations%20to%20Peepm.../near/209816529" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232192.20Convert.20Souper.20optimizations.20to.20Peepm.2E.2E.2E.html#209816529">(Sep 11 2020 at 18:18)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2192#pullrequestreview-487024775">PR Review</a>.</p>



<a name="209836368"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232192%20Convert%20Souper%20optimizations%20to%20Peepm.../near/209836368" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232192.20Convert.20Souper.20optimizations.20to.20Peepm.2E.2E.2E.html#209836368">(Sep 11 2020 at 21:18)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2192">PR #2192</a> from <code>souper-to-peepmatic</code> to <code>main</code>:</p>
<blockquote>
<p>Conversion from Souper into Peepmatic is implemented with a straightforward, top-down recursive traversal of the optimization's left- and right-hand side expression DAGs. Most Souper instructions have a corresponding Peepmatic instruction. If we run into an instruction where that isn't the case, we skip that Souper optimization and move on to the next one.</p>
<p>Note that Souper fully supports DAGs, for example:</p>
<div class="codehilite"><pre><span></span><code>%0 = var
%1 = add 1, %0
%2 = add %1, %1       ;; Two edges to `%1` makes this a DAG.
</code></pre></div>


<p>On the other hand, Peepmatic only currently supports trees, so shared subexpressions are duplicated:</p>
<div class="codehilite"><pre><span></span><code>(iadd (iadd 1 $x)
      (iadd 1 $x))    ;; The shared subexpression is duplicated.
</code></pre></div>


<p>This does not, however, affect correctness.</p>
<p>See also #2184, which is related. </p>
</blockquote>



<a name="209836587"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232192%20Convert%20Souper%20optimizations%20to%20Peepm.../near/209836587" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232192.20Convert.20Souper.20optimizations.20to.20Peepm.2E.2E.2E.html#209836587">(Sep 11 2020 at 21:21)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2192">PR #2192</a> from <code>souper-to-peepmatic</code> to <code>main</code>:</p>
<blockquote>
<p>Conversion from Souper into Peepmatic is implemented with a straightforward, top-down recursive traversal of the optimization's left- and right-hand side expression DAGs. Most Souper instructions have a corresponding Peepmatic instruction. If we run into an instruction where that isn't the case, we skip that Souper optimization and move on to the next one.</p>
<p>Note that Souper fully supports DAGs, for example:</p>
<div class="codehilite"><pre><span></span><code>%0 = var
%1 = add 1, %0
%2 = add %1, %1       ;; Two edges to `%1` makes this a DAG.
</code></pre></div>


<p>On the other hand, Peepmatic only currently supports trees, so shared subexpressions are duplicated:</p>
<div class="codehilite"><pre><span></span><code>(iadd (iadd 1 $x)
      (iadd 1 $x))    ;; The shared subexpression is duplicated.
</code></pre></div>


<p>This does not, however, affect correctness.</p>
<p>See also #2184, which is related. </p>
</blockquote>



<a name="209839882"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232192%20Convert%20Souper%20optimizations%20to%20Peepm.../near/209839882" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232192.20Convert.20Souper.20optimizations.20to.20Peepm.2E.2E.2E.html#209839882">(Sep 11 2020 at 21:54)</a>:</h4>
<p>fitzgen merged <a href="https://github.com/bytecodealliance/wasmtime/pull/2192">PR #2192</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>