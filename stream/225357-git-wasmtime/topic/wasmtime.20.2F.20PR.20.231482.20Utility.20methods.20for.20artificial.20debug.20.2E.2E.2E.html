<html>
<head><meta charset="utf-8"><title>wasmtime / PR #1482 Utility methods for artificial debug ... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231482.20Utility.20methods.20for.20artificial.20debug.20.2E.2E.2E.html">wasmtime / PR #1482 Utility methods for artificial debug ...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="193250540"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231482%20Utility%20methods%20for%20artificial%20debug%20.../near/193250540" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231482.20Utility.20methods.20for.20artificial.20debug.20.2E.2E.2E.html#193250540">(Apr 07 2020 at 21:25)</a>:</h4>
<p>yurydelendik opened <a href="https://github.com/bytecodealliance/wasmtime/pull/1482" title="https://github.com/bytecodealliance/wasmtime/pull/1482">PR #1482</a> from <code>unwrap-ptr</code> to <code>master</code>:</p>
<blockquote>
<p>Currently, artificial "wrapper" types are created for pointer types. These wrappers display Wasm pointers as i32. To deference such wrapper/pointer the function's vmctx is needed. This PR is an attempt to provide overrides for artificial type for <code>operator*</code> and <code>operator-&gt;</code>.</p>
<p>The runtime/host has to have <code>set_vmctx_memory</code> and <code>resolve_vmctx_memory_ptr</code> builtins. The former sets current context and the former derefernces the Wasm pointer using current context's memory base.</p>
<p>During LLDB session, a user has to call <code>__vmctx.set()</code> to set the current context before calling any dereference operators. It can be automated via e.g. <code>command regex pp 's/(.+)/p __vmctx-&gt;set(),%1/'</code>.</p>
<p>Example of the LLDB session (see also <a href="https://gist.github.com/yurydelendik/ba86fe491765bfd073c6e08d056c8012" title="https://gist.github.com/yurydelendik/ba86fe491765bfd073c6e08d056c8012">gist</a>):</p>
<div class="codehilite"><pre><span></span>Process 50041 stopped

* thread #1, queue = &#39;com.apple.main-thread&#39;, stop reason = breakpoint 1.1
    frame #0: 0x00000001042ca05d JIT(0x105000600)`check(i=1) at t.c:13:3
   10
   11   int check(size_t i) {
   12     struct Test *y = t + i;
-&gt; 13     y-&gt;i++;
   14     return y-&gt;j;
   15   }
   16
(lldb) p y
(WebAssemblyPtrWrapper&lt;Test&gt;) $0 = (__ptr = 1032)
(lldb) pp *y
(Test) $1 = (i = 3, j = 4)
(lldb) pp y-&gt;j
(int) $2 = 4
(lldb) fr v
(WasmtimeVMContext *) __vmctx = 0x0000000103503ba0
(size_t) i = 1
(WebAssemblyPtrWrapper&lt;Test&gt;) y = (__ptr = 1032)
</pre></div>


<p>TODO:</p>
<ul>
<li>[ ] access to non-exported memory</li>
<li>[ ] find better way to keep <code>_set_vmctx_memory</code> / <code>_resolve_vmctx_memory_ptr</code> exported</li>
</ul>
</blockquote>



<a name="193251601"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231482%20Utility%20methods%20for%20artificial%20debug%20.../near/193251601" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231482.20Utility.20methods.20for.20artificial.20debug.20.2E.2E.2E.html#193251601">(Apr 07 2020 at 21:36)</a>:</h4>
<p>yurydelendik edited <a href="https://github.com/bytecodealliance/wasmtime/pull/1482" title="https://github.com/bytecodealliance/wasmtime/pull/1482">PR #1482</a> from <code>unwrap-ptr</code> to <code>master</code>:</p>
<blockquote>
<p>Currently, artificial "wrapper" types are created for pointer types. These wrappers display Wasm pointers as i32. To deference such wrapper/pointer the function's vmctx is needed. This PR is an attempt to provide overrides for artificial type for <code>operator*</code> and <code>operator-&gt;</code>.</p>
<p>The runtime/host has to have <code>set_vmctx_memory</code> and <code>resolve_vmctx_memory_ptr</code> builtins. The former sets current context and the former derefernces the Wasm pointer using current context's memory base.</p>
<p>During LLDB session, a user has to call <code>__vmctx.set()</code> to set the current context before calling any dereference operators. It can be automated via e.g. <code>command regex pp 's/(.+)/p __vmctx-&gt;set(),%1/'</code>.</p>
<p>Example of the LLDB session (see also <a href="https://gist.github.com/yurydelendik/ba86fe491765bfd073c6e08d056c8012" title="https://gist.github.com/yurydelendik/ba86fe491765bfd073c6e08d056c8012">gist</a>):</p>
<div class="codehilite"><pre><span></span>Process 50041 stopped

* thread #1, queue = &#39;com.apple.main-thread&#39;, stop reason = breakpoint 1.1
    frame #0: 0x00000001042ca05d JIT(0x105000600)`check(i=1) at t.c:13:3
   10
   11   int check(size_t i) {
   12     struct Test *y = t + i;
-&gt; 13     y-&gt;i++;
   14     return y-&gt;j;
   15   }
   16
(lldb) p y
(WebAssemblyPtrWrapper&lt;Test&gt;) $0 = (__ptr = 1032)
(lldb) pp *y
(Test) $1 = (i = 3, j = 4)
(lldb) pp y-&gt;j
(int) $2 = 4
(lldb) fr v
(WasmtimeVMContext *) __vmctx = 0x0000000103503ba0
(size_t) i = 1
(WebAssemblyPtrWrapper&lt;Test&gt;) y = (__ptr = 1032)
</pre></div>


<p>TODO:</p>
<ul>
<li>[ ] access to non-exported memory</li>
<li>[ ] find better way to keep <code>_set_vmctx_memory</code> / <code>_resolve_vmctx_memory_ptr</code> exported (<a href="https://github.com/rust-lang/rust/issues/25057" title="https://github.com/rust-lang/rust/issues/25057">https://github.com/rust-lang/rust/issues/25057</a> ?)</li>
</ul>
</blockquote>



<a name="193360777"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231482%20Utility%20methods%20for%20artificial%20debug%20.../near/193360777" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231482.20Utility.20methods.20for.20artificial.20debug.20.2E.2E.2E.html#193360777">(Apr 08 2020 at 18:35)</a>:</h4>
<p>yurydelendik edited <a href="https://github.com/bytecodealliance/wasmtime/pull/1482" title="https://github.com/bytecodealliance/wasmtime/pull/1482">PR #1482</a> from <code>unwrap-ptr</code> to <code>master</code>:</p>
<blockquote>
<p>Currently, artificial "wrapper" types are created for pointer types. These wrappers display Wasm pointers as i32. To dereference such wrapper/pointer the function's vmctx is needed. This PR is an attempt to provide overrides for artificial type for <code>operator*</code> and <code>operator-&gt;</code>.</p>
<p>The runtime/host has to have <code>set_vmctx_memory</code> and <code>resolve_vmctx_memory_ptr</code> builtins. The former sets current context and the former derefernces the Wasm pointer using current context's memory base.</p>
<p>During LLDB session, a user has to call <code>__vmctx.set()</code> to set the current context before calling any dereference operators. It can be automated via e.g. <code>command regex pp 's/(.+)/p __vmctx-&gt;set(),%1/'</code>.</p>
<p>Example of the LLDB session (see also <a href="https://gist.github.com/yurydelendik/ba86fe491765bfd073c6e08d056c8012" title="https://gist.github.com/yurydelendik/ba86fe491765bfd073c6e08d056c8012">gist</a>):</p>
<div class="codehilite"><pre><span></span>Process 50041 stopped

* thread #1, queue = &#39;com.apple.main-thread&#39;, stop reason = breakpoint 1.1
    frame #0: 0x00000001042ca05d JIT(0x105000600)`check(i=1) at t.c:13:3
   10
   11   int check(size_t i) {
   12     struct Test *y = t + i;
-&gt; 13     y-&gt;i++;
   14     return y-&gt;j;
   15   }
   16
(lldb) p y
(WebAssemblyPtrWrapper&lt;Test&gt;) $0 = (__ptr = 1032)
(lldb) pp *y
(Test) $1 = (i = 3, j = 4)
(lldb) pp y-&gt;j
(int) $2 = 4
(lldb) fr v
(WasmtimeVMContext *) __vmctx = 0x0000000103503ba0
(size_t) i = 1
(WebAssemblyPtrWrapper&lt;Test&gt;) y = (__ptr = 1032)
</pre></div>


<p>TODO:</p>
<ul>
<li>[ ] access to non-exported memory</li>
<li>[ ] find better way to keep <code>_set_vmctx_memory</code> / <code>_resolve_vmctx_memory_ptr</code> exported (<a href="https://github.com/rust-lang/rust/issues/25057" title="https://github.com/rust-lang/rust/issues/25057">https://github.com/rust-lang/rust/issues/25057</a> ?)</li>
</ul>
</blockquote>



<a name="193371300"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231482%20Utility%20methods%20for%20artificial%20debug%20.../near/193371300" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231482.20Utility.20methods.20for.20artificial.20debug.20.2E.2E.2E.html#193371300">(Apr 08 2020 at 20:00)</a>:</h4>
<p>yurydelendik edited <a href="https://github.com/bytecodealliance/wasmtime/pull/1482" title="https://github.com/bytecodealliance/wasmtime/pull/1482">PR #1482</a> from <code>unwrap-ptr</code> to <code>master</code>:</p>
<blockquote>
<p>Currently, artificial "wrapper" types are created for pointer types. These wrappers display Wasm pointers as i32. To dereference such wrapper/pointer the function's vmctx is needed. This PR is an attempt to provide overrides for artificial type for <code>operator*</code> and <code>operator-&gt;</code>.</p>
<p>The runtime/host has to have <code>set_vmctx_memory</code> and <code>resolve_vmctx_memory_ptr</code> builtins. The former sets current context and the former derefernces the Wasm pointer using current context's memory base.</p>
<p>During LLDB session, a user has to call <code>__vmctx.set()</code> to set the current context before calling any dereference operators. It can be automated via e.g. <code>command regex pp 's/(.+)/p __vmctx-&gt;set(),%1/'</code>.</p>
<p>Example of the LLDB session (see also <a href="https://gist.github.com/yurydelendik/ba86fe491765bfd073c6e08d056c8012" title="https://gist.github.com/yurydelendik/ba86fe491765bfd073c6e08d056c8012">gist</a>):</p>
<div class="codehilite"><pre><span></span>Process 50041 stopped

* thread #1, queue = &#39;com.apple.main-thread&#39;, stop reason = breakpoint 1.1
    frame #0: 0x00000001042ca05d JIT(0x105000600)`check(i=1) at t.c:13:3
   10
   11   int check(size_t i) {
   12     struct Test *y = t + i;
-&gt; 13     y-&gt;i++;
   14     return y-&gt;j;
   15   }
   16
(lldb) p y
(WebAssemblyPtrWrapper&lt;Test&gt;) $0 = (__ptr = 1032)
(lldb) pp *y
(Test) $1 = (i = 3, j = 4)
(lldb) pp y-&gt;j
(int) $2 = 4
(lldb) fr v
(WasmtimeVMContext *) __vmctx = 0x0000000103503ba0
(size_t) i = 1
(WebAssemblyPtrWrapper&lt;Test&gt;) y = (__ptr = 1032)
</pre></div>


<p>TODO:</p>
<ul>
<li>[ ] access to non-exported memory</li>
<li>[x] find better way to keep <code>_set_vmctx_memory</code> / <code>_resolve_vmctx_memory_ptr</code> exported (<a href="https://github.com/rust-lang/rust/issues/25057" title="https://github.com/rust-lang/rust/issues/25057">https://github.com/rust-lang/rust/issues/25057</a> ?)</li>
</ul>
</blockquote>



<a name="193375276"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231482%20Utility%20methods%20for%20artificial%20debug%20.../near/193375276" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231482.20Utility.20methods.20for.20artificial.20debug.20.2E.2E.2E.html#193375276">(Apr 08 2020 at 20:35)</a>:</h4>
<p>yurydelendik updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1482" title="https://github.com/bytecodealliance/wasmtime/pull/1482">PR #1482</a> from <code>unwrap-ptr</code> to <code>master</code>:</p>
<blockquote>
<p>Currently, artificial "wrapper" types are created for pointer types. These wrappers display Wasm pointers as i32. To dereference such wrapper/pointer the function's vmctx is needed. This PR is an attempt to provide overrides for artificial type for <code>operator*</code> and <code>operator-&gt;</code>.</p>
<p>The runtime/host has to have <code>set_vmctx_memory</code> and <code>resolve_vmctx_memory_ptr</code> builtins. The former sets current context and the former derefernces the Wasm pointer using current context's memory base.</p>
<p>During LLDB session, a user has to call <code>__vmctx.set()</code> to set the current context before calling any dereference operators. It can be automated via e.g. <code>command regex pp 's/(.+)/p __vmctx-&gt;set(),%1/'</code>.</p>
<p>Example of the LLDB session (see also <a href="https://gist.github.com/yurydelendik/ba86fe491765bfd073c6e08d056c8012" title="https://gist.github.com/yurydelendik/ba86fe491765bfd073c6e08d056c8012">gist</a>):</p>
<div class="codehilite"><pre><span></span>Process 50041 stopped

* thread #1, queue = &#39;com.apple.main-thread&#39;, stop reason = breakpoint 1.1
    frame #0: 0x00000001042ca05d JIT(0x105000600)`check(i=1) at t.c:13:3
   10
   11   int check(size_t i) {
   12     struct Test *y = t + i;
-&gt; 13     y-&gt;i++;
   14     return y-&gt;j;
   15   }
   16
(lldb) p y
(WebAssemblyPtrWrapper&lt;Test&gt;) $0 = (__ptr = 1032)
(lldb) pp *y
(Test) $1 = (i = 3, j = 4)
(lldb) pp y-&gt;j
(int) $2 = 4
(lldb) fr v
(WasmtimeVMContext *) __vmctx = 0x0000000103503ba0
(size_t) i = 1
(WebAssemblyPtrWrapper&lt;Test&gt;) y = (__ptr = 1032)
</pre></div>


<p>TODO:</p>
<ul>
<li>[ ] access to non-exported memory</li>
<li>[x] find better way to keep <code>_set_vmctx_memory</code> / <code>_resolve_vmctx_memory_ptr</code> exported (<a href="https://github.com/rust-lang/rust/issues/25057" title="https://github.com/rust-lang/rust/issues/25057">https://github.com/rust-lang/rust/issues/25057</a> ?)</li>
</ul>
</blockquote>



<a name="193381201"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231482%20Utility%20methods%20for%20artificial%20debug%20.../near/193381201" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231482.20Utility.20methods.20for.20artificial.20debug.20.2E.2E.2E.html#193381201">(Apr 08 2020 at 21:32)</a>:</h4>
<p>yurydelendik updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1482" title="https://github.com/bytecodealliance/wasmtime/pull/1482">PR #1482</a> from <code>unwrap-ptr</code> to <code>master</code>:</p>
<blockquote>
<p>Currently, artificial "wrapper" types are created for pointer types. These wrappers display Wasm pointers as i32. To dereference such wrapper/pointer the function's vmctx is needed. This PR is an attempt to provide overrides for artificial type for <code>operator*</code> and <code>operator-&gt;</code>.</p>
<p>The runtime/host has to have <code>set_vmctx_memory</code> and <code>resolve_vmctx_memory_ptr</code> builtins. The former sets current context and the former derefernces the Wasm pointer using current context's memory base.</p>
<p>During LLDB session, a user has to call <code>__vmctx.set()</code> to set the current context before calling any dereference operators. It can be automated via e.g. <code>command regex pp 's/(.+)/p __vmctx-&gt;set(),%1/'</code>.</p>
<p>Example of the LLDB session (see also <a href="https://gist.github.com/yurydelendik/ba86fe491765bfd073c6e08d056c8012" title="https://gist.github.com/yurydelendik/ba86fe491765bfd073c6e08d056c8012">gist</a>):</p>
<div class="codehilite"><pre><span></span>Process 50041 stopped

* thread #1, queue = &#39;com.apple.main-thread&#39;, stop reason = breakpoint 1.1
    frame #0: 0x00000001042ca05d JIT(0x105000600)`check(i=1) at t.c:13:3
   10
   11   int check(size_t i) {
   12     struct Test *y = t + i;
-&gt; 13     y-&gt;i++;
   14     return y-&gt;j;
   15   }
   16
(lldb) p y
(WebAssemblyPtrWrapper&lt;Test&gt;) $0 = (__ptr = 1032)
(lldb) pp *y
(Test) $1 = (i = 3, j = 4)
(lldb) pp y-&gt;j
(int) $2 = 4
(lldb) fr v
(WasmtimeVMContext *) __vmctx = 0x0000000103503ba0
(size_t) i = 1
(WebAssemblyPtrWrapper&lt;Test&gt;) y = (__ptr = 1032)
</pre></div>


<p>TODO:</p>
<ul>
<li>[ ] access to non-exported memory</li>
<li>[x] find better way to keep <code>_set_vmctx_memory</code> / <code>_resolve_vmctx_memory_ptr</code> exported (<a href="https://github.com/rust-lang/rust/issues/25057" title="https://github.com/rust-lang/rust/issues/25057">https://github.com/rust-lang/rust/issues/25057</a> ?)</li>
</ul>
</blockquote>



<a name="193381207"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231482%20Utility%20methods%20for%20artificial%20debug%20.../near/193381207" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231482.20Utility.20methods.20for.20artificial.20debug.20.2E.2E.2E.html#193381207">(Apr 08 2020 at 21:32)</a>:</h4>
<p>yurydelendik edited <a href="https://github.com/bytecodealliance/wasmtime/pull/1482" title="https://github.com/bytecodealliance/wasmtime/pull/1482">PR #1482</a> from <code>unwrap-ptr</code> to <code>master</code>:</p>
<blockquote>
<p>Currently, artificial "wrapper" types are created for pointer types. These wrappers display Wasm pointers as i32. To dereference such wrapper/pointer the function's vmctx is needed. This PR is an attempt to provide overrides for artificial type for <code>operator*</code> and <code>operator-&gt;</code>.</p>
<p>The runtime/host has to have <code>set_vmctx_memory</code> and <code>resolve_vmctx_memory_ptr</code> builtins. The former sets current context and the former derefernces the Wasm pointer using current context's memory base.</p>
<p>During LLDB session, a user has to call <code>__vmctx.set()</code> to set the current context before calling any dereference operators. It can be automated via e.g. <code>command regex pp 's/(.+)/p __vmctx-&gt;set(),%1/'</code>.</p>
<p>Example of the LLDB session (see also <a href="https://gist.github.com/yurydelendik/ba86fe491765bfd073c6e08d056c8012" title="https://gist.github.com/yurydelendik/ba86fe491765bfd073c6e08d056c8012">gist</a>):</p>
<div class="codehilite"><pre><span></span>Process 50041 stopped

* thread #1, queue = &#39;com.apple.main-thread&#39;, stop reason = breakpoint 1.1
    frame #0: 0x00000001042ca05d JIT(0x105000600)`check(i=1) at t.c:13:3
   10
   11   int check(size_t i) {
   12     struct Test *y = t + i;
-&gt; 13     y-&gt;i++;
   14     return y-&gt;j;
   15   }
   16
(lldb) p y
(WebAssemblyPtrWrapper&lt;Test&gt;) $0 = (__ptr = 1032)
(lldb) pp *y
(Test) $1 = (i = 3, j = 4)
(lldb) pp y-&gt;j
(int) $2 = 4
(lldb) fr v
(WasmtimeVMContext *) __vmctx = 0x0000000103503ba0
(size_t) i = 1
(WebAssemblyPtrWrapper&lt;Test&gt;) y = (__ptr = 1032)
</pre></div>


<p>TODO:</p>
<ul>
<li>[x] access to non-exported memory</li>
<li>[x] find better way to keep <code>_set_vmctx_memory</code> / <code>_resolve_vmctx_memory_ptr</code> exported (<a href="https://github.com/rust-lang/rust/issues/25057" title="https://github.com/rust-lang/rust/issues/25057">https://github.com/rust-lang/rust/issues/25057</a> ?)</li>
</ul>
</blockquote>



<a name="193387188"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231482%20Utility%20methods%20for%20artificial%20debug%20.../near/193387188" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231482.20Utility.20methods.20for.20artificial.20debug.20.2E.2E.2E.html#193387188">(Apr 08 2020 at 22:37)</a>:</h4>
<p>yurydelendik updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1482" title="https://github.com/bytecodealliance/wasmtime/pull/1482">PR #1482</a> from <code>unwrap-ptr</code> to <code>master</code>:</p>
<blockquote>
<p>Currently, artificial "wrapper" types are created for pointer types. These wrappers display Wasm pointers as i32. To dereference such wrapper/pointer the function's vmctx is needed. This PR is an attempt to provide overrides for artificial type for <code>operator*</code> and <code>operator-&gt;</code>.</p>
<p>The runtime/host has to have <code>set_vmctx_memory</code> and <code>resolve_vmctx_memory_ptr</code> builtins. The former sets current context and the former derefernces the Wasm pointer using current context's memory base.</p>
<p>During LLDB session, a user has to call <code>__vmctx.set()</code> to set the current context before calling any dereference operators. It can be automated via e.g. <code>command regex pp 's/(.+)/p __vmctx-&gt;set(),%1/'</code>.</p>
<p>Example of the LLDB session (see also <a href="https://gist.github.com/yurydelendik/ba86fe491765bfd073c6e08d056c8012" title="https://gist.github.com/yurydelendik/ba86fe491765bfd073c6e08d056c8012">gist</a>):</p>
<div class="codehilite"><pre><span></span>Process 50041 stopped

* thread #1, queue = &#39;com.apple.main-thread&#39;, stop reason = breakpoint 1.1
    frame #0: 0x00000001042ca05d JIT(0x105000600)`check(i=1) at t.c:13:3
   10
   11   int check(size_t i) {
   12     struct Test *y = t + i;
-&gt; 13     y-&gt;i++;
   14     return y-&gt;j;
   15   }
   16
(lldb) p y
(WebAssemblyPtrWrapper&lt;Test&gt;) $0 = (__ptr = 1032)
(lldb) pp *y
(Test) $1 = (i = 3, j = 4)
(lldb) pp y-&gt;j
(int) $2 = 4
(lldb) fr v
(WasmtimeVMContext *) __vmctx = 0x0000000103503ba0
(size_t) i = 1
(WebAssemblyPtrWrapper&lt;Test&gt;) y = (__ptr = 1032)
</pre></div>


<p>TODO:</p>
<ul>
<li>[x] access to non-exported memory</li>
<li>[x] find better way to keep <code>_set_vmctx_memory</code> / <code>_resolve_vmctx_memory_ptr</code> exported (<a href="https://github.com/rust-lang/rust/issues/25057" title="https://github.com/rust-lang/rust/issues/25057">https://github.com/rust-lang/rust/issues/25057</a> ?)</li>
</ul>
</blockquote>



<a name="193463162"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231482%20Utility%20methods%20for%20artificial%20debug%20.../near/193463162" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231482.20Utility.20methods.20for.20artificial.20debug.20.2E.2E.2E.html#193463162">(Apr 09 2020 at 15:09)</a>:</h4>
<p>yurydelendik updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1482" title="https://github.com/bytecodealliance/wasmtime/pull/1482">PR #1482</a> from <code>unwrap-ptr</code> to <code>master</code>:</p>
<blockquote>
<p>Currently, artificial "wrapper" types are created for pointer types. These wrappers display Wasm pointers as i32. To dereference such wrapper/pointer the function's vmctx is needed. This PR is an attempt to provide overrides for artificial type for <code>operator*</code> and <code>operator-&gt;</code>.</p>
<p>The runtime/host has to have <code>set_vmctx_memory</code> and <code>resolve_vmctx_memory_ptr</code> builtins. The former sets current context and the former derefernces the Wasm pointer using current context's memory base.</p>
<p>During LLDB session, a user has to call <code>__vmctx.set()</code> to set the current context before calling any dereference operators. It can be automated via e.g. <code>command regex pp 's/(.+)/p __vmctx-&gt;set(),%1/'</code>.</p>
<p>Example of the LLDB session (see also <a href="https://gist.github.com/yurydelendik/ba86fe491765bfd073c6e08d056c8012" title="https://gist.github.com/yurydelendik/ba86fe491765bfd073c6e08d056c8012">gist</a>):</p>
<div class="codehilite"><pre><span></span>Process 50041 stopped

* thread #1, queue = &#39;com.apple.main-thread&#39;, stop reason = breakpoint 1.1
    frame #0: 0x00000001042ca05d JIT(0x105000600)`check(i=1) at t.c:13:3
   10
   11   int check(size_t i) {
   12     struct Test *y = t + i;
-&gt; 13     y-&gt;i++;
   14     return y-&gt;j;
   15   }
   16
(lldb) p y
(WebAssemblyPtrWrapper&lt;Test&gt;) $0 = (__ptr = 1032)
(lldb) pp *y
(Test) $1 = (i = 3, j = 4)
(lldb) pp y-&gt;j
(int) $2 = 4
(lldb) fr v
(WasmtimeVMContext *) __vmctx = 0x0000000103503ba0
(size_t) i = 1
(WebAssemblyPtrWrapper&lt;Test&gt;) y = (__ptr = 1032)
</pre></div>


<p>TODO:</p>
<ul>
<li>[x] access to non-exported memory</li>
<li>[x] find better way to keep <code>_set_vmctx_memory</code> / <code>_resolve_vmctx_memory_ptr</code> exported (<a href="https://github.com/rust-lang/rust/issues/25057" title="https://github.com/rust-lang/rust/issues/25057">https://github.com/rust-lang/rust/issues/25057</a> ?)</li>
</ul>
</blockquote>



<a name="193474023"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231482%20Utility%20methods%20for%20artificial%20debug%20.../near/193474023" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231482.20Utility.20methods.20for.20artificial.20debug.20.2E.2E.2E.html#193474023">(Apr 09 2020 at 16:23)</a>:</h4>
<p>yurydelendik updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1482" title="https://github.com/bytecodealliance/wasmtime/pull/1482">PR #1482</a> from <code>unwrap-ptr</code> to <code>master</code>:</p>
<blockquote>
<p>Currently, artificial "wrapper" types are created for pointer types. These wrappers display Wasm pointers as i32. To dereference such wrapper/pointer the function's vmctx is needed. This PR is an attempt to provide overrides for artificial type for <code>operator*</code> and <code>operator-&gt;</code>.</p>
<p>The runtime/host has to have <code>set_vmctx_memory</code> and <code>resolve_vmctx_memory_ptr</code> builtins. The former sets current context and the former derefernces the Wasm pointer using current context's memory base.</p>
<p>During LLDB session, a user has to call <code>__vmctx.set()</code> to set the current context before calling any dereference operators. It can be automated via e.g. <code>command regex pp 's/(.+)/p __vmctx-&gt;set(),%1/'</code>.</p>
<p>Example of the LLDB session (see also <a href="https://gist.github.com/yurydelendik/ba86fe491765bfd073c6e08d056c8012" title="https://gist.github.com/yurydelendik/ba86fe491765bfd073c6e08d056c8012">gist</a>):</p>
<div class="codehilite"><pre><span></span>Process 50041 stopped

* thread #1, queue = &#39;com.apple.main-thread&#39;, stop reason = breakpoint 1.1
    frame #0: 0x00000001042ca05d JIT(0x105000600)`check(i=1) at t.c:13:3
   10
   11   int check(size_t i) {
   12     struct Test *y = t + i;
-&gt; 13     y-&gt;i++;
   14     return y-&gt;j;
   15   }
   16
(lldb) p y
(WebAssemblyPtrWrapper&lt;Test&gt;) $0 = (__ptr = 1032)
(lldb) pp *y
(Test) $1 = (i = 3, j = 4)
(lldb) pp y-&gt;j
(int) $2 = 4
(lldb) fr v
(WasmtimeVMContext *) __vmctx = 0x0000000103503ba0
(size_t) i = 1
(WebAssemblyPtrWrapper&lt;Test&gt;) y = (__ptr = 1032)
</pre></div>


<p>TODO:</p>
<ul>
<li>[x] access to non-exported memory</li>
<li>[x] find better way to keep <code>_set_vmctx_memory</code> / <code>_resolve_vmctx_memory_ptr</code> exported (<a href="https://github.com/rust-lang/rust/issues/25057" title="https://github.com/rust-lang/rust/issues/25057">https://github.com/rust-lang/rust/issues/25057</a> ?)</li>
</ul>
</blockquote>



<a name="193474123"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231482%20Utility%20methods%20for%20artificial%20debug%20.../near/193474123" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231482.20Utility.20methods.20for.20artificial.20debug.20.2E.2E.2E.html#193474123">(Apr 09 2020 at 16:24)</a>:</h4>
<p><strong>yurydelendik</strong> requested <a href="https://github.com/fitzgen" title="https://github.com/fitzgen">fitzgen</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/1482" title="https://github.com/bytecodealliance/wasmtime/pull/1482">PR #1482</a>.</p>



<a name="193484051"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231482%20Utility%20methods%20for%20artificial%20debug%20.../near/193484051" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231482.20Utility.20methods.20for.20artificial.20debug.20.2E.2E.2E.html#193484051">(Apr 09 2020 at 17:37)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1482#pullrequestreview-390984818" title="https://github.com/bytecodealliance/wasmtime/pull/1482#pullrequestreview-390984818">PR Review</a>.</p>



<a name="193484052"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231482%20Utility%20methods%20for%20artificial%20debug%20.../near/193484052" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231482.20Utility.20methods.20for.20artificial.20debug.20.2E.2E.2E.html#193484052">(Apr 09 2020 at 17:37)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1482#pullrequestreview-390984818" title="https://github.com/bytecodealliance/wasmtime/pull/1482#pullrequestreview-390984818">PR Review</a>.</p>



<a name="193484053"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231482%20Utility%20methods%20for%20artificial%20debug%20.../near/193484053" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231482.20Utility.20methods.20for.20artificial.20debug.20.2E.2E.2E.html#193484053">(Apr 09 2020 at 17:37)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/1482#discussion_r406359625" title="https://github.com/bytecodealliance/wasmtime/pull/1482#discussion_r406359625">PR Review Comment</a>:</p>
<blockquote>
<p>Want to create a tracking issue for multi-memory and add a checkbox for this there? That way we're less likely to forget about this when we actually implement multi-memory.</p>
</blockquote>



<a name="193484055"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231482%20Utility%20methods%20for%20artificial%20debug%20.../near/193484055" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231482.20Utility.20methods.20for.20artificial.20debug.20.2E.2E.2E.html#193484055">(Apr 09 2020 at 17:37)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/1482#discussion_r406356781" title="https://github.com/bytecodealliance/wasmtime/pull/1482#discussion_r406356781">PR Review Comment</a>:</p>
<blockquote>
<p>If this module is <code>pub</code> (can also be <code>#[doc(hidden)]</code> to avoid "really" making it public) then I _think_ we don't need this hack.</p>
</blockquote>



<a name="193484056"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231482%20Utility%20methods%20for%20artificial%20debug%20.../near/193484056" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231482.20Utility.20methods.20for.20artificial.20debug.20.2E.2E.2E.html#193484056">(Apr 09 2020 at 17:37)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/1482#discussion_r406366292" title="https://github.com/bytecodealliance/wasmtime/pull/1482#discussion_r406366292">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>    assert!(!VMCTX_AND_MEMORY.0.is_null(), &quot;must call `__vmctx-&gt;set()` before resolving Wasm pointers&quot;);
</pre></div>


<p>So that users get a slightly better message if they get here.</p>
</blockquote>



<a name="193492721"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231482%20Utility%20methods%20for%20artificial%20debug%20.../near/193492721" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231482.20Utility.20methods.20for.20artificial.20debug.20.2E.2E.2E.html#193492721">(Apr 09 2020 at 18:44)</a>:</h4>
<p>yurydelendik updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1482" title="https://github.com/bytecodealliance/wasmtime/pull/1482">PR #1482</a> from <code>unwrap-ptr</code> to <code>master</code>:</p>
<blockquote>
<p>Currently, artificial "wrapper" types are created for pointer types. These wrappers display Wasm pointers as i32. To dereference such wrapper/pointer the function's vmctx is needed. This PR is an attempt to provide overrides for artificial type for <code>operator*</code> and <code>operator-&gt;</code>.</p>
<p>The runtime/host has to have <code>set_vmctx_memory</code> and <code>resolve_vmctx_memory_ptr</code> builtins. The former sets current context and the former derefernces the Wasm pointer using current context's memory base.</p>
<p>During LLDB session, a user has to call <code>__vmctx.set()</code> to set the current context before calling any dereference operators. It can be automated via e.g. <code>command regex pp 's/(.+)/p __vmctx-&gt;set(),%1/'</code>.</p>
<p>Example of the LLDB session (see also <a href="https://gist.github.com/yurydelendik/ba86fe491765bfd073c6e08d056c8012" title="https://gist.github.com/yurydelendik/ba86fe491765bfd073c6e08d056c8012">gist</a>):</p>
<div class="codehilite"><pre><span></span>Process 50041 stopped

* thread #1, queue = &#39;com.apple.main-thread&#39;, stop reason = breakpoint 1.1
    frame #0: 0x00000001042ca05d JIT(0x105000600)`check(i=1) at t.c:13:3
   10
   11   int check(size_t i) {
   12     struct Test *y = t + i;
-&gt; 13     y-&gt;i++;
   14     return y-&gt;j;
   15   }
   16
(lldb) p y
(WebAssemblyPtrWrapper&lt;Test&gt;) $0 = (__ptr = 1032)
(lldb) pp *y
(Test) $1 = (i = 3, j = 4)
(lldb) pp y-&gt;j
(int) $2 = 4
(lldb) fr v
(WasmtimeVMContext *) __vmctx = 0x0000000103503ba0
(size_t) i = 1
(WebAssemblyPtrWrapper&lt;Test&gt;) y = (__ptr = 1032)
</pre></div>


<p>TODO:</p>
<ul>
<li>[x] access to non-exported memory</li>
<li>[x] find better way to keep <code>_set_vmctx_memory</code> / <code>_resolve_vmctx_memory_ptr</code> exported (<a href="https://github.com/rust-lang/rust/issues/25057" title="https://github.com/rust-lang/rust/issues/25057">https://github.com/rust-lang/rust/issues/25057</a> ?)</li>
</ul>
</blockquote>



<a name="193493311"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231482%20Utility%20methods%20for%20artificial%20debug%20.../near/193493311" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231482.20Utility.20methods.20for.20artificial.20debug.20.2E.2E.2E.html#193493311">(Apr 09 2020 at 18:49)</a>:</h4>
<p>yurydelendik updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1482" title="https://github.com/bytecodealliance/wasmtime/pull/1482">PR #1482</a> from <code>unwrap-ptr</code> to <code>master</code>:</p>
<blockquote>
<p>Currently, artificial "wrapper" types are created for pointer types. These wrappers display Wasm pointers as i32. To dereference such wrapper/pointer the function's vmctx is needed. This PR is an attempt to provide overrides for artificial type for <code>operator*</code> and <code>operator-&gt;</code>.</p>
<p>The runtime/host has to have <code>set_vmctx_memory</code> and <code>resolve_vmctx_memory_ptr</code> builtins. The former sets current context and the former derefernces the Wasm pointer using current context's memory base.</p>
<p>During LLDB session, a user has to call <code>__vmctx.set()</code> to set the current context before calling any dereference operators. It can be automated via e.g. <code>command regex pp 's/(.+)/p __vmctx-&gt;set(),%1/'</code>.</p>
<p>Example of the LLDB session (see also <a href="https://gist.github.com/yurydelendik/ba86fe491765bfd073c6e08d056c8012" title="https://gist.github.com/yurydelendik/ba86fe491765bfd073c6e08d056c8012">gist</a>):</p>
<div class="codehilite"><pre><span></span>Process 50041 stopped

* thread #1, queue = &#39;com.apple.main-thread&#39;, stop reason = breakpoint 1.1
    frame #0: 0x00000001042ca05d JIT(0x105000600)`check(i=1) at t.c:13:3
   10
   11   int check(size_t i) {
   12     struct Test *y = t + i;
-&gt; 13     y-&gt;i++;
   14     return y-&gt;j;
   15   }
   16
(lldb) p y
(WebAssemblyPtrWrapper&lt;Test&gt;) $0 = (__ptr = 1032)
(lldb) pp *y
(Test) $1 = (i = 3, j = 4)
(lldb) pp y-&gt;j
(int) $2 = 4
(lldb) fr v
(WasmtimeVMContext *) __vmctx = 0x0000000103503ba0
(size_t) i = 1
(WebAssemblyPtrWrapper&lt;Test&gt;) y = (__ptr = 1032)
</pre></div>


<p>TODO:</p>
<ul>
<li>[x] access to non-exported memory</li>
<li>[x] find better way to keep <code>_set_vmctx_memory</code> / <code>_resolve_vmctx_memory_ptr</code> exported (<a href="https://github.com/rust-lang/rust/issues/25057" title="https://github.com/rust-lang/rust/issues/25057">https://github.com/rust-lang/rust/issues/25057</a> ?)</li>
</ul>
</blockquote>



<a name="193494443"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231482%20Utility%20methods%20for%20artificial%20debug%20.../near/193494443" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231482.20Utility.20methods.20for.20artificial.20debug.20.2E.2E.2E.html#193494443">(Apr 09 2020 at 18:59)</a>:</h4>
<p>yurydelendik submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1482#pullrequestreview-391053091" title="https://github.com/bytecodealliance/wasmtime/pull/1482#pullrequestreview-391053091">PR Review</a>.</p>



<a name="193494444"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231482%20Utility%20methods%20for%20artificial%20debug%20.../near/193494444" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231482.20Utility.20methods.20for.20artificial.20debug.20.2E.2E.2E.html#193494444">(Apr 09 2020 at 18:59)</a>:</h4>
<p>yurydelendik created <a href="https://github.com/bytecodealliance/wasmtime/pull/1482#discussion_r406413123" title="https://github.com/bytecodealliance/wasmtime/pull/1482#discussion_r406413123">PR Review Comment</a>:</p>
<blockquote>
<p><a href="https://github.com/bytecodealliance/wasmtime/issues/1489" title="https://github.com/bytecodealliance/wasmtime/issues/1489">https://github.com/bytecodealliance/wasmtime/issues/1489</a></p>
</blockquote>



<a name="193494640"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231482%20Utility%20methods%20for%20artificial%20debug%20.../near/193494640" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231482.20Utility.20methods.20for.20artificial.20debug.20.2E.2E.2E.html#193494640">(Apr 09 2020 at 19:00)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1482#pullrequestreview-391053939" title="https://github.com/bytecodealliance/wasmtime/pull/1482#pullrequestreview-391053939">PR Review</a>.</p>



<a name="193494642"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231482%20Utility%20methods%20for%20artificial%20debug%20.../near/193494642" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231482.20Utility.20methods.20for.20artificial.20debug.20.2E.2E.2E.html#193494642">(Apr 09 2020 at 19:00)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1482#discussion_r406413783" title="https://github.com/bytecodealliance/wasmtime/pull/1482#discussion_r406413783">PR Review Comment</a>:</p>
<blockquote>
<p>Or use <code>#[doc(hidden)] pub use crate::debug_builtins::{set_vmctx_memory, resolve_vmctx_memory_ptr};</code> in the crate root.</p>
</blockquote>



<a name="193501645"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231482%20Utility%20methods%20for%20artificial%20debug%20.../near/193501645" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231482.20Utility.20methods.20for.20artificial.20debug.20.2E.2E.2E.html#193501645">(Apr 09 2020 at 19:58)</a>:</h4>
<p>yurydelendik submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1482#pullrequestreview-391091046" title="https://github.com/bytecodealliance/wasmtime/pull/1482#pullrequestreview-391091046">PR Review</a>.</p>



<a name="193501646"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231482%20Utility%20methods%20for%20artificial%20debug%20.../near/193501646" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231482.20Utility.20methods.20for.20artificial.20debug.20.2E.2E.2E.html#193501646">(Apr 09 2020 at 19:58)</a>:</h4>
<p>yurydelendik created <a href="https://github.com/bytecodealliance/wasmtime/pull/1482#discussion_r406443736" title="https://github.com/bytecodealliance/wasmtime/pull/1482#discussion_r406443736">PR Review Comment</a>:</p>
<blockquote>
<p>If you are suggesting to remove <code>ensure_exported</code>, then it does not work. See <a href="https://github.com/rust-lang/rust/issues/25057" title="https://github.com/rust-lang/rust/issues/25057">rust-lang/rust#25057</a></p>
</blockquote>



<a name="193579437"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231482%20Utility%20methods%20for%20artificial%20debug%20.../near/193579437" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231482.20Utility.20methods.20for.20artificial.20debug.20.2E.2E.2E.html#193579437">(Apr 10 2020 at 15:13)</a>:</h4>
<p>yurydelendik updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1482" title="https://github.com/bytecodealliance/wasmtime/pull/1482">PR #1482</a> from <code>unwrap-ptr</code> to <code>master</code>:</p>
<blockquote>
<p>Currently, artificial "wrapper" types are created for pointer types. These wrappers display Wasm pointers as i32. To dereference such wrapper/pointer the function's vmctx is needed. This PR is an attempt to provide overrides for artificial type for <code>operator*</code> and <code>operator-&gt;</code>.</p>
<p>The runtime/host has to have <code>set_vmctx_memory</code> and <code>resolve_vmctx_memory_ptr</code> builtins. The former sets current context and the former derefernces the Wasm pointer using current context's memory base.</p>
<p>During LLDB session, a user has to call <code>__vmctx.set()</code> to set the current context before calling any dereference operators. It can be automated via e.g. <code>command regex pp 's/(.+)/p __vmctx-&gt;set(),%1/'</code>.</p>
<p>Example of the LLDB session (see also <a href="https://gist.github.com/yurydelendik/ba86fe491765bfd073c6e08d056c8012" title="https://gist.github.com/yurydelendik/ba86fe491765bfd073c6e08d056c8012">gist</a>):</p>
<div class="codehilite"><pre><span></span>Process 50041 stopped

* thread #1, queue = &#39;com.apple.main-thread&#39;, stop reason = breakpoint 1.1
    frame #0: 0x00000001042ca05d JIT(0x105000600)`check(i=1) at t.c:13:3
   10
   11   int check(size_t i) {
   12     struct Test *y = t + i;
-&gt; 13     y-&gt;i++;
   14     return y-&gt;j;
   15   }
   16
(lldb) p y
(WebAssemblyPtrWrapper&lt;Test&gt;) $0 = (__ptr = 1032)
(lldb) pp *y
(Test) $1 = (i = 3, j = 4)
(lldb) pp y-&gt;j
(int) $2 = 4
(lldb) fr v
(WasmtimeVMContext *) __vmctx = 0x0000000103503ba0
(size_t) i = 1
(WebAssemblyPtrWrapper&lt;Test&gt;) y = (__ptr = 1032)
</pre></div>


<p>TODO:</p>
<ul>
<li>[x] access to non-exported memory</li>
<li>[x] find better way to keep <code>_set_vmctx_memory</code> / <code>_resolve_vmctx_memory_ptr</code> exported (<a href="https://github.com/rust-lang/rust/issues/25057" title="https://github.com/rust-lang/rust/issues/25057">https://github.com/rust-lang/rust/issues/25057</a> ?)</li>
</ul>
</blockquote>



<a name="193585229"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231482%20Utility%20methods%20for%20artificial%20debug%20.../near/193585229" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231482.20Utility.20methods.20for.20artificial.20debug.20.2E.2E.2E.html#193585229">(Apr 10 2020 at 16:00)</a>:</h4>
<p>yurydelendik merged <a href="https://github.com/bytecodealliance/wasmtime/pull/1482" title="https://github.com/bytecodealliance/wasmtime/pull/1482">PR #1482</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>