<html>
<head><meta charset="utf-8"><title>wasmtime / issue #9909 c-api: JIT debugging of warm guest... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239909.20c-api.3A.20JIT.20debugging.20of.20warm.20guest.2E.2E.2E.html">wasmtime / issue #9909 c-api: JIT debugging of warm guest...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="491101061"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239909%20c-api%3A%20JIT%20debugging%20of%20warm%20guest.../near/491101061" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239909.20c-api.3A.20JIT.20debugging.20of.20warm.20guest.2E.2E.2E.html#491101061">(Dec 28 2024 at 15:46)</a>:</h4>
<p><a href="https://github.com/puremourning">puremourning</a> added the bug label to <a href="https://github.com/bytecodealliance/wasmtime/issues/9909">Issue #9909</a>.</p>



<a name="491101063"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239909%20c-api%3A%20JIT%20debugging%20of%20warm%20guest.../near/491101063" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239909.20c-api.3A.20JIT.20debugging.20of.20warm.20guest.2E.2E.2E.html#491101063">(Dec 28 2024 at 15:46)</a>:</h4>
<p>puremourning opened <a href="https://github.com/bytecodealliance/wasmtime/issues/9909">issue #9909</a>:</p>
<blockquote>
<p>According to the <a href="https://docs.wasmtime.dev/examples-c-debugging.html">documentation</a> it should be possible to use a source/line debugger with guest code running inside the wasmtime VM.</p>
<p>This works well for rust embeddings, but when using the <code>c-api</code> (or anything based on it, like <code>wasmtime-cpp</code>), the DWARF data is not exposed to the debugger.</p>
<p>After a little investigation and debugging, this is because the <code>debug-builtins</code> cargo feature is not enabled in builds of the C api crate.</p>
<h3>Test Case</h3>
<p><a href="https://docs.wasmtime.dev/examples-c-debugging.html">https://docs.wasmtime.dev/examples-c-debugging.html</a></p>
<h3>Steps to Reproduce</h3>
<ul>
<li>build the C api:</li>
</ul>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">cmake</span><span class="w"> </span><span class="o">-</span><span class="n">S</span><span class="w"> </span><span class="n">crates</span><span class="o">/</span><span class="n">c</span><span class="o">-</span><span class="n">api</span><span class="w"> </span><span class="o">-</span><span class="n">B</span><span class="w"> </span><span class="n">target</span><span class="o">/</span><span class="n">c</span><span class="o">-</span><span class="n">api</span><span class="w"> </span><span class="o">--</span><span class="n">install</span><span class="o">-</span><span class="n">prefix</span><span class="w"> </span><span class="s">"$(pwd)/artifacts"</span><span class="w"> </span><span class="err">\</span>
<span class="w">    </span><span class="o">-</span><span class="n">DCMAKE_BUILD_TYPE</span><span class="o">=</span><span class="n">Debug</span><span class="w"> </span><span class="err">\</span>
<span class="w">    </span><span class="o">-</span><span class="n">DCMAKE_EXPORT_COMPILE_COMMANDS</span><span class="o">=</span><span class="n">ON</span>
<span class="n">cmake</span><span class="w"> </span><span class="o">--</span><span class="n">build</span><span class="w"> </span><span class="n">target</span><span class="o">/</span><span class="n">c</span><span class="o">-</span><span class="n">api</span><span class="w"> </span><span class="o">--</span><span class="n">parallel</span><span class="w"> </span><span class="mi">16</span>
<span class="n">cmake</span><span class="w"> </span><span class="o">--</span><span class="n">install</span><span class="w"> </span><span class="n">target</span><span class="o">/</span><span class="n">c</span><span class="o">-</span><span class="n">api</span>
</code></pre></div>
<ul>
<li>Build the example fib wasm</li>
</ul>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">rustup</span><span class="w"> </span><span class="n">target</span><span class="w"> </span><span class="n">add</span><span class="w"> </span><span class="n">wasm32</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">unknown</span>
<span class="n">cargo</span><span class="w"> </span><span class="n">build</span><span class="w"> </span><span class="o">-</span><span class="n">p</span><span class="w"> </span><span class="n">example</span><span class="o">-</span><span class="n">fib</span><span class="o">-</span><span class="n">debug</span><span class="o">-</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span><span class="n">target</span><span class="w"> </span><span class="n">wasm32</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">unknown</span>
</code></pre></div>
<ul>
<li>Build the example <code>main.c</code> above:</li>
</ul>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">cd</span><span class="w"> </span><span class="n">examples</span><span class="o">/</span><span class="n">fib</span><span class="o">-</span><span class="n">debug</span>
<span class="n">gcc</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">c</span><span class="w"> </span><span class="o">-</span><span class="n">I</span><span class="o">../../</span><span class="n">artifacts</span><span class="o">/</span><span class="n">include</span><span class="w"> </span><span class="o">-</span><span class="n">L</span><span class="o">../../</span><span class="n">artifacts</span><span class="o">/</span><span class="n">lib</span><span class="w"> </span><span class="o">-</span><span class="n">Xlinker</span><span class="w"> </span><span class="o">-</span><span class="n">rpath</span><span class="w"> </span><span class="cp">$(</span><span class="n">pwd</span><span class="p">)</span><span class="o">/../../</span><span class="n">artifacts</span><span class="o">/</span><span class="n">lib</span><span class="w"> </span><span class="o">-</span><span class="n">Xlinker</span><span class="w"> </span><span class="o">-</span><span class="n">lwasmtime</span>
</code></pre></div>
<ul>
<li>Run the example in debugger (e.g. lldb)</li>
</ul>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">ben</span><span class="o">@</span><span class="n">BenMBP2021</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">lldb</span><span class="w"> </span><span class="n">examples</span><span class="o">/</span><span class="n">fib</span><span class="o">-</span><span class="n">debug</span><span class="o">/</span><span class="n">a</span><span class="p">.</span><span class="n">out</span>
<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">target</span><span class="w"> </span><span class="n">create</span><span class="w"> </span><span class="s">"examples/fib-debug/a.out"</span>
<span class="n">Current</span><span class="w"> </span><span class="n">executable</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="o">'/</span><span class="n">Users</span><span class="o">/</span><span class="n">ben</span><span class="o">/</span><span class="n">Development</span><span class="o">/</span><span class="n">wasm</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">examples</span><span class="o">/</span><span class="n">fib</span><span class="o">-</span><span class="n">debug</span><span class="o">/</span><span class="n">a</span><span class="p">.</span><span class="n">out</span><span class="o">'</span><span class="w"> </span><span class="p">(</span><span class="n">arm64</span><span class="p">).</span>
<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">settings</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">plugin</span><span class="p">.</span><span class="n">jit</span><span class="o">-</span><span class="n">loader</span><span class="p">.</span><span class="n">gdb</span><span class="p">.</span><span class="n">enable</span><span class="w"> </span><span class="n">on</span>

<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="k">break</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="o">-</span><span class="n">f</span><span class="w"> </span><span class="n">examples</span><span class="o">/</span><span class="n">fib</span><span class="o">-</span><span class="n">debug</span><span class="o">/</span><span class="n">wasm</span><span class="o">/</span><span class="n">fib</span><span class="p">.</span><span class="n">rs</span><span class="w"> </span><span class="o">-</span><span class="n">l</span><span class="w"> </span><span class="mi">3</span>
<span class="n">Breakpoint</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="nc">no</span><span class="w"> </span><span class="n">locations</span><span class="w"> </span><span class="p">(</span><span class="n">pending</span><span class="p">).</span>
<span class="n">WARNING</span><span class="p">:</span><span class="w">  </span><span class="nc">Unable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">resolve</span><span class="w"> </span><span class="n">breakpoint</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">any</span><span class="w"> </span><span class="n">actual</span><span class="w"> </span><span class="n">locations</span><span class="p">.</span>

<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">run</span>
<span class="n">Process</span><span class="w"> </span><span class="mi">55426</span><span class="w"> </span><span class="n">launched</span><span class="p">:</span><span class="w"> </span><span class="o">'/</span><span class="n">Users</span><span class="o">/</span><span class="n">ben</span><span class="o">/</span><span class="n">Development</span><span class="o">/</span><span class="n">wasm</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">examples</span><span class="o">/</span><span class="n">fib</span><span class="o">-</span><span class="n">debug</span><span class="o">/</span><span class="n">a</span><span class="p">.</span><span class="n">out</span><span class="o">'</span><span class="w"> </span><span class="p">(</span><span class="n">arm64</span><span class="p">)</span>
<span class="n">Initializing</span><span class="o">..</span><span class="p">.</span>
<span class="n">Loading</span><span class="w"> </span><span class="n">binary</span><span class="o">..</span><span class="p">.</span>
<span class="n">Compiling</span><span class="w"> </span><span class="n">module</span><span class="o">..</span><span class="p">.</span>
<span class="n">Instantiating</span><span class="w"> </span><span class="n">module</span><span class="o">..</span><span class="p">.</span>
<span class="n">Calling</span><span class="w"> </span><span class="n">fib</span><span class="o">..</span><span class="p">.</span>
<span class="o">&gt;</span><span class="w"> </span><span class="n">fib</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">21</span>
<span class="n">Shutting</span><span class="w"> </span><span class="n">down</span><span class="o">..</span><span class="p">.</span>
<span class="n">Done</span><span class="p">.</span>
<span class="n">Process</span><span class="w"> </span><span class="mi">55426</span><span class="w"> </span><span class="n">exited</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mh">0x00000000</span><span class="p">)</span>
</code></pre></div>
<h3>Expected Results</h3>
<ul>
<li>Breakpoint is hit in the <a href="http://fib.rs">fib.rs</a> file</li>
</ul>
<h3>Actual Results</h3>
<ul>
<li>No breakpoint is hit</li>
</ul>
<h3>Versions and Environment</h3>
<p>Wasmtime version or commit: 01a43ed65d00d92807c7a8ae075ba9a948814c83</p>
<p>Operating system: macOS</p>
<p>Architecture: arm64</p>
<h3>Extra Info</h3>
<p>I made a quick patch to enable the feature, repeated the test above and it works.</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">ben</span><span class="o">@</span><span class="n">BenMBP2021</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">lldb</span><span class="w"> </span><span class="n">examples</span><span class="o">/</span><span class="n">fib</span><span class="o">-</span><span class="n">debug</span><span class="o">/</span><span class="n">a</span><span class="p">.</span><span class="n">out</span>
<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">target</span><span class="w"> </span><span class="n">create</span><span class="w"> </span><span class="s">"examples/fib-debug/a.out"</span>
<span class="n">Current</span><span class="w"> </span><span class="n">executable</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="o">'/</span><span class="n">Users</span><span class="o">/</span><span class="n">ben</span><span class="o">/</span><span class="n">Development</span><span class="o">/</span><span class="n">wasm</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">examples</span><span class="o">/</span><span class="n">fib</span><span class="o">-</span><span class="n">debug</span><span class="o">/</span><span class="n">a</span><span class="p">.</span><span class="n">out</span><span class="o">'</span><span class="w"> </span><span class="p">(</span><span class="n">arm64</span><span class="p">).</span>
<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="k">break</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="o">-</span><span class="n">f</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">ben</span><span class="o">/</span><span class="n">Devel</span><span class="o">^</span><span class="n">Cment</span><span class="o">/</span><span class="n">wasm</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">examples</span><span class="o">/</span><span class="n">fib</span><span class="o">-</span><span class="n">debug</span><span class="o">/</span><span class="n">wasm</span><span class="o">/</span><span class="n">fib</span><span class="p">.</span><span class="n">rs</span><span class="w"> </span><span class="o">-</span><span class="n">l</span><span class="w"> </span><span class="mi">3</span><span class="w">                                                </span><span class="n">bck</span><span class="o">?</span><span class="n">options</span><span class="w">                                                                                                                                 </span><span class="n">b</span>
<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">settings</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">plugin</span><span class="p">.</span><span class="n">jit</span><span class="o">-</span><span class="n">loader</span><span class="p">.</span><span class="n">gdb</span><span class="p">.</span><span class="n">enable</span><span class="w"> </span><span class="n">on</span>
<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="k">break</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="o">-</span><span class="n">f</span><span class="w"> </span><span class="n">examples</span><span class="o">/</span><span class="n">fib</span><span class="o">-</span><span class="n">debug</span><span class="o">/</span><span class="n">wasm</span><span class="o">/</span><span class="n">fib</span><span class="p">.</span><span class="n">rs</span><span class="w"> </span><span class="o">-</span><span class="n">l</span><span class="w"> </span><span class="mi">3</span>
<span class="n">Breakpoint</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="nc">no</span><span class="w"> </span><span class="n">locations</span><span class="w"> </span><span class="p">(</span><span class="n">pending</span><span class="p">).</span>
<span class="n">WARNING</span><span class="p">:</span><span class="w">  </span><span class="nc">Unable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">resolve</span><span class="w"> </span><span class="n">breakpoint</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">any</span><span class="w"> </span><span class="n">actual</span><span class="w"> </span><span class="n">locations</span><span class="p">.</span>
<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">run</span>
<span class="n">Process</span><span class="w"> </span><span class="mi">55596</span><span class="w"> </span><span class="n">launched</span><span class="p">:</span><span class="w"> </span><span class="o">'/</span><span class="n">Users</span><span class="o">/</span><span class="n">ben</span><span class="o">/</span><span class="n">Development</span><span class="o">/</span><span class="n">wasm</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">examples</span><span class="o">/</span><span class="n">fib</span><span class="o">-</span><span class="n">debug</span><span class="o">/</span><span class="n">a</span><span class="p">.</span><span class="n">out</span><span class="o">'</span><span class="w"> </span><span class="p">(</span><span class="n">arm64</span><span class="p">)</span>
<span class="n">Initializing</span><span class="o">..</span><span class="p">.</span>
<span class="n">Loading</span><span class="w"> </span><span class="n">binary</span><span class="o">..</span><span class="p">.</span>
<span class="n">Compiling</span><span class="w"> </span><span class="n">module</span><span class="o">..</span><span class="p">.</span>
<span class="mi">1</span><span class="w"> </span><span class="n">location</span><span class="w"> </span><span class="n">added</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">breakpoint</span><span class="w"> </span><span class="mi">1</span>
<span class="n">Instantiating</span><span class="w"> </span><span class="n">module</span><span class="o">..</span><span class="p">.</span>
<span class="n">Calling</span><span class="w"> </span><span class="n">fib</span><span class="o">..</span><span class="p">.</span>
<span class="n">Process</span><span class="w"> </span><span class="mi">55596</span><span class="w"> </span><span class="n">stopped</span>

<span class="o">*</span><span class="w"> </span><span class="n">thread</span><span class="w"> </span><span class="p">#</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">queue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">'</span><span class="na">com</span><span class="p">.</span><span class="n">apple</span><span class="p">.</span><span class="n">main</span><span class="o">-</span><span class="n">thread</span><span class="o">'</span><span class="p">,</span><span class="w"> </span><span class="n">stop</span><span class="w"> </span><span class="n">reason</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">breakpoint</span><span class="w"> </span><span class="mf">1.1</span>
<span class="w">    </span><span class="n">frame</span><span class="w"> </span><span class="p">#</span><span class="mi">0</span><span class="p">:</span><span class="w"> </span><span class="mh">0x0000000100090040</span><span class="w"> </span><span class="n">JIT</span><span class="p">(</span><span class="mh">0x1402a8000</span><span class="p">)</span><span class="err">`</span><span class="n">fib</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">fib</span><span class="p">.</span><span class="n">rs</span><span class="p">:</span><span class="mi">3</span><span class="p">:</span><span class="mi">17</span>
<span class="w">   </span><span class="mi">1</span><span class="w">    </span><span class="cp">#[no_mangle]</span>
<span class="w">   </span><span class="mi">2</span><span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">extern</span><span class="w"> </span><span class="s">"C"</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">fib</span><span class="p">(</span><span class="n">n</span><span class="p">:</span><span class="w"> </span><span class="kt">u32</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="kt">u32</span><span class="w"> </span><span class="p">{</span>
<span class="p">-&gt;</span><span class="w"> </span><span class="mi">3</span><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">   </span><span class="mi">4</span><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">   </span><span class="mi">5</span><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">0</span><span class="o">..</span><span class="n">n</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="mi">6</span><span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">;</span>
<span class="w">   </span><span class="mi">7</span><span class="w">            </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">;</span>
<span class="n">JIT</span><span class="p">(</span><span class="mh">0x1402a8000</span><span class="p">)</span><span class="err">`</span><span class="n">fib</span><span class="p">:</span>
<span class="p">-&gt;</span><span class="w">  </span><span class="mh">0x100090040</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">64</span><span class="o">&gt;</span><span class="p">:</span><span class="w"> </span><span class="nc">mov</span><span class="w">    </span><span class="n">w0</span><span class="p">,</span><span class="w"> </span><span class="p">#</span><span class="mh">0x1</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="o">=</span><span class="mi">1</span>
<span class="w">    </span><span class="mh">0x100090044</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">68</span><span class="o">&gt;</span><span class="p">:</span><span class="w"> </span><span class="nc">ldr</span><span class="w">    </span><span class="n">x1</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">x2</span><span class="p">,</span><span class="w"> </span><span class="p">#</span><span class="mh">0x60</span><span class="p">]</span>
<span class="w">    </span><span class="mh">0x100090048</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">72</span><span class="o">&gt;</span><span class="p">:</span><span class="w"> </span><span class="nc">add</span><span class="w">    </span><span class="n">x1</span><span class="p">,</span><span class="w"> </span><span class="n">x1</span><span class="p">,</span><span class="w"> </span><span class="p">#</span><span class="mh">0x10</span>
<span class="w">    </span><span class="mh">0x10009004c</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">76</span><span class="o">&gt;</span><span class="p">:</span><span class="w"> </span><span class="kt">str</span><span class="w">    </span><span class="nc">w0</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">x1</span><span class="p">,</span><span class="w"> </span><span class="n">w22</span><span class="p">,</span><span class="w"> </span><span class="n">uxtw</span><span class="p">]</span>
<span class="n">Target</span><span class="w"> </span><span class="mi">0</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="n">stopped</span><span class="p">.</span>
<span class="n">warning</span><span class="p">:</span><span class="w"> </span><span class="nc">This</span><span class="w"> </span><span class="n">version</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">LLDB</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">no</span><span class="w"> </span><span class="n">plugin</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">language</span><span class="w"> </span><span class="s">"rust"</span><span class="p">.</span><span class="w"> </span><span class="n">Inspection</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">frame</span><span class="w"> </span><span class="n">variables</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">limited</span><span class="p">.</span>
<span class="p">(</span><span class="n">lldb</span><span class="p">)</span>
</code></pre></div>
<p>Here's the trivial patch:</p>
<div class="codehilite" data-code-language="Diff"><pre><span></span><code>commit 8f69c41d998ddb33b1d099b913f104cb93ba1b3d (HEAD -&gt; main)
Author: Ben Jackson &lt;puremourning@gmail.com&gt;
Date:   Sat Dec 28 15:31:54 2024 +0000

<span class="w"> </span>   Enable JIT DWARF info in c-api

<span class="gh">diff --git a/crates/c-api/Cargo.toml b/crates/c-api/Cargo.toml</span>
<span class="gh">index 84b7d45ed..d77312f42 100644</span>
<span class="gd">--- a/crates/c-api/Cargo.toml</span>
<span class="gi">+++ b/crates/c-api/Cargo.toml</span>
<span class="gu">@@ -56,5 +56,6 @@ gc-drc = ["wasmtime/gc-drc"]</span>
<span class="w"> </span>gc-null = ["wasmtime/gc-null"]
<span class="w"> </span>cranelift = ['wasmtime/cranelift']
<span class="w"> </span>winch = ['wasmtime/winch']
<span class="gi">+debug-builtins = ['wasmtime/debug-builtins']</span>
<span class="w"> </span># ... if you add a line above this be sure to change the other locations
<span class="w"> </span># marked WASMTIME_FEATURE_LIST
<span class="gh">diff --git a/crates/c-api/artifact/Cargo.toml b/crates/c-api/artifact/Cargo.toml</span>
<span class="gh">index 1eb6659ec..8aa846d23 100644</span>
<span class="gd">--- a/crates/c-api/artifact/Cargo.toml</span>
<span class="gi">+++ b/crates/c-api/artifact/Cargo.toml</span>
<span class="gu">@@ -38,6 +38,7 @@ default = [</span>
<span class="w"> </span>  'gc-null',
<span class="w"> </span>  'cranelift',
<span class="w"> </span>  'winch',
<span class="gi">+  'debug-builtins',</span>
<span class="w"> </span>  # ... if you add a line above this be sure to change the other locations
<span class="w"> </span>  # marked WASMTIME_FEATURE_LIST
<span class="w"> </span>]
<span class="gu">@@ -58,5 +59,6 @@ gc-drc = ["wasmtime-c-api/gc-drc"]</span>
<span class="w"> </span>gc-null = ["wasmtime-c-api/gc-null"]
<span class="w"> </span>cranelift = ["wasmtime-c-api/cranelift"]
<span class="w"> </span>winch = ["wasmtime-c-api/winch"]
<span class="gi">+debug-builtins = ["wasmtime-c-api/debug-builtins"]</span>
<span class="w"> </span># ... if you add a line above this be sure to read the comment at the end of
<span class="w"> </span># `default`
<span class="gh">diff --git a/crates/c-api/build.rs b/crates/c-api/build.rs</span>
<span class="gh">index b500fd1bf..12bc0b501 100644</span>
<span class="gd">--- a/crates/c-api/build.rs</span>
<span class="gi">+++ b/crates/c-api/build.rs</span>
<span class="gu">@@ -19,6 +19,7 @@ const FEATURES: &amp;[&amp;str] = &amp;[</span>
<span class="w"> </span>    "GC_NULL",
<span class="w"> </span>    "CRANELIFT",
<span class="w"> </span>    "WINCH",
<span class="gi">+    "DEBUG_BUILTINS",</span>
<span class="w"> </span>];
<span class="w"> </span>// ... if you add a line above this be sure to change the other locations
<span class="w"> </span>// marked WASMTIME_FEATURE_LIST
<span class="gh">diff --git a/crates/c-api/cmake/features.cmake b/crates/c-api/cmake/features.cmake</span>
<span class="gh">index 385c13965..727412a04 100644</span>
<span class="gd">--- a/crates/c-api/cmake/features.cmake</span>
<span class="gi">+++ b/crates/c-api/cmake/features.cmake</span>
<span class="gu">@@ -43,5 +43,6 @@ feature(gc-null ON)</span>
<span class="w"> </span>feature(async ON)
<span class="w"> </span>feature(cranelift ON)
<span class="w"> </span>feature(winch ON)
<span class="gi">+feature(debug-builtins ON)</span>
<span class="w"> </span># ... if you add a line above this be sure to change the other locations
<span class="w"> </span># marked WASMTIME_FEATURE_LIST
<span class="gh">diff --git a/crates/c-api/include/wasmtime/conf.h.in b/crates/c-api/include/wasmtime/conf.h.in</span>
<span class="gh">index 3dff987ac..03f4debf9 100644</span>
<span class="gd">--- a/crates/c-api/include/wasmtime/conf.h.in</span>
<span class="gi">+++ b/crates/c-api/include/wasmtime/conf.h.in</span>
<span class="gu">@@ -25,6 +25,7 @@</span>
<span class="w"> </span>#cmakedefine WASMTIME_FEATURE_ASYNC
<span class="w"> </span>#cmakedefine WASMTIME_FEATURE_CRANELIFT
<span class="w"> </span>#cmakedefine WASMTIME_FEATURE_WINCH
<span class="gi">+#cmakedefine WASMTIME_FEATURE_DEBUG_BUILTINS</span>
<span class="w"> </span>// ... if you add a line above this be sure to change the other locations
<span class="w"> </span>// marked WASMTIME_FEATURE_LIST
</code></pre></div>
<p>I'm not clear if the issue here is the feature _should_ be enabled, and the docs are right, or a decision was made to not enable it, and the docs are wrong, or if there is some other way to enable this feature in the C-api or other C embeddings.</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>