<html>
<head><meta charset="utf-8"><title>wasmtime / PR #5840 x64: Tidy up some handling of sinkabl... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235840.20x64.3A.20Tidy.20up.20some.20handling.20of.20sinkabl.2E.2E.2E.html">wasmtime / PR #5840 x64: Tidy up some handling of sinkabl...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="329019914"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235840%20x64%3A%20Tidy%20up%20some%20handling%20of%20sinkabl.../near/329019914" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235840.20x64.3A.20Tidy.20up.20some.20handling.20of.20sinkabl.2E.2E.2E.html#329019914">(Feb 20 2023 at 16:18)</a>:</h4>
<p>alexcrichton opened <a href="https://github.com/bytecodealliance/wasmtime/pull/5840">PR #5840</a> from <code>x64-sinking-loads</code> to <code>main</code>:</p>
<blockquote>
<p>This commit refactors a bit about how sinkable loads are handled in the x64 backend. The intention is to bring most handling around sinkable loads up to date with the current state of the backend since things have changed since these were originally introduced, namely automatic conversions between types in ISLE. For example the <code>Value</code> type can be automatically converted to <code>RegMem</code> to perform load sinking, but some rules are still explicitly doing matching themselves.</p>
<p>Here I've removed explicit handling of immediates and sinkable loads when they're the right-hand-side of an operation. These cases are already handle by the "base case" when converting a <code>Value</code> to a <code>RegMemImm</code>. Instead only rules explicitly for left-hand-side immediates and sinkable loads remain. This helps cut down on the number of explicit rules needed.</p>
<p>Additionally in the same manner that <code>Value</code> can be automatically converted to <code>RegMem</code> I've added automatic conversions from <code>SinkableLoad</code> to <code>RegMem</code> and the various other newtypes. This helps cut down a bit on rule verbosity where <code>sink_load_*</code> is largely no longer necessary.</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;<br>
</p>
</blockquote>



<a name="329258849"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235840%20x64%3A%20Tidy%20up%20some%20handling%20of%20sinkabl.../near/329258849" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235840.20x64.3A.20Tidy.20up.20some.20handling.20of.20sinkabl.2E.2E.2E.html#329258849">(Feb 21 2023 at 18:15)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5840#pullrequestreview-1307946740">PR review</a>.</p>



<a name="329271018"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235840%20x64%3A%20Tidy%20up%20some%20handling%20of%20sinkabl.../near/329271018" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235840.20x64.3A.20Tidy.20up.20some.20handling.20of.20sinkabl.2E.2E.2E.html#329271018">(Feb 21 2023 at 19:12)</a>:</h4>
<p>cfallin merged <a href="https://github.com/bytecodealliance/wasmtime/pull/5840">PR #5840</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>