<html>
<head><meta charset="utf-8"><title>wasmtime / PR #4105 Expose `TrapCode::Interrupt` on epoch... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234105.20Expose.20.60TrapCode.3A.3AInterrupt.60.20on.20epoch.2E.2E.2E.html">wasmtime / PR #4105 Expose `TrapCode::Interrupt` on epoch...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="281361790"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234105%20Expose%20%60TrapCode%3A%3AInterrupt%60%20on%20epoch.../near/281361790" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234105.20Expose.20.60TrapCode.3A.3AInterrupt.60.20on.20epoch.2E.2E.2E.html#281361790">(May 05 2022 at 21:30)</a>:</h4>
<p>saulecabrera opened <a href="https://github.com/bytecodealliance/wasmtime/pull/4105">PR #4105</a> from <code>expose-trap-code-on-epoch-interruption</code> to <code>main</code>:</p>
<blockquote>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
<p>I had a discussion via Zulip with @alexcrichton about this change. I decided to expose the <code>TrapCode</code> instead of the error (<code>EpochDeadlineError</code>) mainly to keep the same behaviour as the deprecated <a href="https://docs.rs/wasmtime/0.33.0/wasmtime/struct.InterruptHandle.html">InterruptHandle approach</a>.</p>
<p>I'm opening the PR as a draft, because I'm unsure if the usage of  <code>raise_lib_trap</code> is correct in this context. I'm assuming it is, and at the same time it seems to be the only way to set the trap code. Also, if there aren't any issues with the usage of <code>raise_lib_trap</code> it seems that the error (<code>EpochDeadlineError</code>) is not needed anymore, and it would be safe to remove the implementation (I'll do so upon confirmation).</p>
</blockquote>



<a name="281363198"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234105%20Expose%20%60TrapCode%3A%3AInterrupt%60%20on%20epoch.../near/281363198" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234105.20Expose.20.60TrapCode.3A.3AInterrupt.60.20on.20epoch.2E.2E.2E.html#281363198">(May 05 2022 at 21:42)</a>:</h4>
<p>saulecabrera edited <a href="https://github.com/bytecodealliance/wasmtime/pull/4105">PR #4105</a> from <code>expose-trap-code-on-epoch-interruption</code> to <code>main</code>:</p>
<blockquote>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
<p>I had a discussion via Zulip with @alexcrichton about this change. I decided to expose the <code>TrapCode</code> instead of the private error (<code>EpochDeadlineError</code>) mainly to keep the same behaviour as the deprecated <a href="https://docs.rs/wasmtime/0.33.0/wasmtime/struct.InterruptHandle.html">InterruptHandle approach</a>.</p>
<p>I'm opening the PR as a draft, because I'm unsure if the usage of  <code>raise_lib_trap</code> is correct in this context. I'm assuming it is, and at the same time it seems to be the only way to set the trap code. Also, if there aren't any issues with the usage of <code>raise_lib_trap</code> it seems that the error (<code>EpochDeadlineError</code>) is not needed anymore, and it would be safe to remove the implementation (I'll do so upon confirmation).</p>
</blockquote>



<a name="281364735"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234105%20Expose%20%60TrapCode%3A%3AInterrupt%60%20on%20epoch.../near/281364735" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234105.20Expose.20.60TrapCode.3A.3AInterrupt.60.20on.20epoch.2E.2E.2E.html#281364735">(May 05 2022 at 21:59)</a>:</h4>
<p>saulecabrera updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4105">PR #4105</a> from <code>expose-trap-code-on-epoch-interruption</code> to <code>main</code>.</p>



<a name="281754130"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234105%20Expose%20%60TrapCode%3A%3AInterrupt%60%20on%20epoch.../near/281754130" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234105.20Expose.20.60TrapCode.3A.3AInterrupt.60.20on.20epoch.2E.2E.2E.html#281754130">(May 09 2022 at 22:25)</a>:</h4>
<p>saulecabrera updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4105">PR #4105</a> from <code>expose-trap-code-on-epoch-interruption</code> to <code>main</code>.</p>



<a name="281756351"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234105%20Expose%20%60TrapCode%3A%3AInterrupt%60%20on%20epoch.../near/281756351" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234105.20Expose.20.60TrapCode.3A.3AInterrupt.60.20on.20epoch.2E.2E.2E.html#281756351">(May 09 2022 at 22:51)</a>:</h4>
<p><strong>saulecabrera</strong> has marked <a href="https://github.com/bytecodealliance/wasmtime/pull/4105">PR #4105</a> as ready for review.</p>



<a name="281756810"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234105%20Expose%20%60TrapCode%3A%3AInterrupt%60%20on%20epoch.../near/281756810" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234105.20Expose.20.60TrapCode.3A.3AInterrupt.60.20on.20epoch.2E.2E.2E.html#281756810">(May 09 2022 at 22:56)</a>:</h4>
<p>saulecabrera edited <a href="https://github.com/bytecodealliance/wasmtime/pull/4105">PR #4105</a> from <code>expose-trap-code-on-epoch-interruption</code> to <code>main</code>:</p>
<blockquote>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
<p>I had a discussion via Zulip with @alexcrichton about this change. I decided to expose the <code>TrapCode</code> instead of the private error (<code>EpochDeadlineError</code>) mainly to keep the same behaviour as the deprecated <a href="https://docs.rs/wasmtime/0.33.0/wasmtime/struct.InterruptHandle.html">InterruptHandle approach</a>.<br>
</p>
</blockquote>



<a name="281757391"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234105%20Expose%20%60TrapCode%3A%3AInterrupt%60%20on%20epoch.../near/281757391" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234105.20Expose.20.60TrapCode.3A.3AInterrupt.60.20on.20epoch.2E.2E.2E.html#281757391">(May 09 2022 at 23:02)</a>:</h4>
<p>saulecabrera submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4105#pullrequestreview-966914079">PR review</a>.</p>



<a name="281757392"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234105%20Expose%20%60TrapCode%3A%3AInterrupt%60%20on%20epoch.../near/281757392" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234105.20Expose.20.60TrapCode.3A.3AInterrupt.60.20on.20epoch.2E.2E.2E.html#281757392">(May 09 2022 at 23:02)</a>:</h4>
<p>saulecabrera created <a href="https://github.com/bytecodealliance/wasmtime/pull/4105#discussion_r868565787">PR review comment</a>:</p>
<blockquote>
<p>It seems that this call could be simplified in this case by exposing a <code>Trap::from_trap_code</code> function in the Trap implementation, which would take in the <code>TrapCode</code> and apply the corresponding defaults for the <code>pc</code> and <code>backtrace</code>.</p>
<p>Didn't introduce this change right away since this is the only use case but I can totally do it if you think it's worth it. </p>
</blockquote>



<a name="281840613"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234105%20Expose%20%60TrapCode%3A%3AInterrupt%60%20on%20epoch.../near/281840613" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234105.20Expose.20.60TrapCode.3A.3AInterrupt.60.20on.20epoch.2E.2E.2E.html#281840613">(May 10 2022 at 15:27)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4105#pullrequestreview-967998242">PR review</a>.</p>



<a name="281840614"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234105%20Expose%20%60TrapCode%3A%3AInterrupt%60%20on%20epoch.../near/281840614" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234105.20Expose.20.60TrapCode.3A.3AInterrupt.60.20on.20epoch.2E.2E.2E.html#281840614">(May 10 2022 at 15:27)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4105#pullrequestreview-967998242">PR review</a>.</p>



<a name="281840615"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234105%20Expose%20%60TrapCode%3A%3AInterrupt%60%20on%20epoch.../near/281840615" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234105.20Expose.20.60TrapCode.3A.3AInterrupt.60.20on.20epoch.2E.2E.2E.html#281840615">(May 10 2022 at 15:27)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4105#discussion_r869381841">PR review comment</a>:</p>
<blockquote>
<p>This seems reasonable enough to me for now, if this pops up more often we can make a helper for it</p>
</blockquote>



<a name="281840624"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234105%20Expose%20%60TrapCode%3A%3AInterrupt%60%20on%20epoch.../near/281840624" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234105.20Expose.20.60TrapCode.3A.3AInterrupt.60.20on.20epoch.2E.2E.2E.html#281840624">(May 10 2022 at 15:27)</a>:</h4>
<p>alexcrichton merged <a href="https://github.com/bytecodealliance/wasmtime/pull/4105">PR #4105</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>