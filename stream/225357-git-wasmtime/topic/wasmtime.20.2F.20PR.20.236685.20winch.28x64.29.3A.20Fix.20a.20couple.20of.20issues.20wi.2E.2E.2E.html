<html>
<head><meta charset="utf-8"><title>wasmtime / PR #6685 winch(x64): Fix a couple of issues wi... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236685.20winch.28x64.29.3A.20Fix.20a.20couple.20of.20issues.20wi.2E.2E.2E.html">wasmtime / PR #6685 winch(x64): Fix a couple of issues wi...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="372415791"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236685%20winch%28x64%29%3A%20Fix%20a%20couple%20of%20issues%20wi.../near/372415791" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236685.20winch.28x64.29.3A.20Fix.20a.20couple.20of.20issues.20wi.2E.2E.2E.html#372415791">(Jul 04 2023 at 21:09)</a>:</h4>
<p>saulecabrera opened <a href="https://github.com/bytecodealliance/wasmtime/pull/6685">PR #6685</a> from <code>saulecabrera:winch-control-flow-fixes</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>This change fixes two issues with the control flow implementation found when working on <a href="https://github.com/bytecodealliance/wasmtime/pull/6610">https://github.com/bytecodealliance/wasmtime/pull/6610</a></p>
<p>The two fixes included in this change are:</p>
<ol>
<li>
<p>Correctly handle the stack pointer at jump sites: when emitting an unconditional jump, the stack pointer might be left unbalanced due to register spilling, this could cause invalid memory accesses.</p>
</li>
<li>
<p>Explicitly track the exit label of the if block: previously the continuation label of the if block was implicitly treated as the exit label, which would cause undefined behaviour in programs that use unconditional branches in the <code>if</code> and <code>else</code> branches. This slight disadvantage of the approach in this change is that it involves special casing the emission of the end of an if block (without else) to account for the continuation label, since the continuation label is only naturally bound when there's an else branch.</p>
</li>
</ol>
<p>&lt;!--<br>
Please make sure you include the following information:</p>
<ul>
<li>
<p>If this work has been discussed elsewhere, please include a link to that<br>
  conversation. If it was discussed in an issue, just mention "issue #...".</p>
</li>
<li>
<p>Explain why this change is needed. If the details are in an issue already,<br>
  this can be brief.</p>
</li>
</ul>
<p>Our development process is documented in the Wasmtime book:<br>
<a href="https://docs.wasmtime.dev/contributing-development-process.html">https://docs.wasmtime.dev/contributing-development-process.html</a></p>
<p>Please ensure all communication follows the code of conduct:<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>
--&gt;</p>
</blockquote>



<a name="372415792"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236685%20winch%28x64%29%3A%20Fix%20a%20couple%20of%20issues%20wi.../near/372415792" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236685.20winch.28x64.29.3A.20Fix.20a.20couple.20of.20issues.20wi.2E.2E.2E.html#372415792">(Jul 04 2023 at 21:09)</a>:</h4>
<p><strong>saulecabrera</strong> requested <a href="https://github.com/cfallin">cfallin</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/6685">PR #6685</a>.</p>



<a name="372415793"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236685%20winch%28x64%29%3A%20Fix%20a%20couple%20of%20issues%20wi.../near/372415793" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236685.20winch.28x64.29.3A.20Fix.20a.20couple.20of.20issues.20wi.2E.2E.2E.html#372415793">(Jul 04 2023 at 21:09)</a>:</h4>
<p><strong>saulecabrera</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-compiler-reviewers">wasmtime-compiler-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/6685">PR #6685</a>.</p>



<a name="372415794"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236685%20winch%28x64%29%3A%20Fix%20a%20couple%20of%20issues%20wi.../near/372415794" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236685.20winch.28x64.29.3A.20Fix.20a.20couple.20of.20issues.20wi.2E.2E.2E.html#372415794">(Jul 04 2023 at 21:09)</a>:</h4>
<p><strong>saulecabrera</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/6685">PR #6685</a>.</p>



<a name="372415795"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236685%20winch%28x64%29%3A%20Fix%20a%20couple%20of%20issues%20wi.../near/372415795" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236685.20winch.28x64.29.3A.20Fix.20a.20couple.20of.20issues.20wi.2E.2E.2E.html#372415795">(Jul 04 2023 at 21:09)</a>:</h4>
<p><strong>saulecabrera</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/6685">PR #6685</a>.</p>



<a name="372415802"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236685%20winch%28x64%29%3A%20Fix%20a%20couple%20of%20issues%20wi.../near/372415802" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236685.20winch.28x64.29.3A.20Fix.20a.20couple.20of.20issues.20wi.2E.2E.2E.html#372415802">(Jul 04 2023 at 21:09)</a>:</h4>
<p><strong>saulecabrera</strong> requested <a href="https://github.com/fitzgen">fitzgen</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/6685">PR #6685</a>.</p>



<a name="372415803"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236685%20winch%28x64%29%3A%20Fix%20a%20couple%20of%20issues%20wi.../near/372415803" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236685.20winch.28x64.29.3A.20Fix.20a.20couple.20of.20issues.20wi.2E.2E.2E.html#372415803">(Jul 04 2023 at 21:09)</a>:</h4>
<p><strong>saulecabrera</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/6685">PR #6685</a>.</p>



<a name="372416065"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236685%20winch%28x64%29%3A%20Fix%20a%20couple%20of%20issues%20wi.../near/372416065" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236685.20winch.28x64.29.3A.20Fix.20a.20couple.20of.20issues.20wi.2E.2E.2E.html#372416065">(Jul 04 2023 at 21:12)</a>:</h4>
<p>saulecabrera updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6685">PR #6685</a>.</p>



<a name="372416976"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236685%20winch%28x64%29%3A%20Fix%20a%20couple%20of%20issues%20wi.../near/372416976" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236685.20winch.28x64.29.3A.20Fix.20a.20couple.20of.20issues.20wi.2E.2E.2E.html#372416976">(Jul 04 2023 at 21:21)</a>:</h4>
<p>saulecabrera updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6685">PR #6685</a>.</p>



<a name="372648794"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236685%20winch%28x64%29%3A%20Fix%20a%20couple%20of%20issues%20wi.../near/372648794" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236685.20winch.28x64.29.3A.20Fix.20a.20couple.20of.20issues.20wi.2E.2E.2E.html#372648794">(Jul 05 2023 at 16:19)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6685#pullrequestreview-1514900270">PR review</a>:</p>
<blockquote>
<p>Thanks!</p>
</blockquote>



<a name="372648795"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236685%20winch%28x64%29%3A%20Fix%20a%20couple%20of%20issues%20wi.../near/372648795" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236685.20winch.28x64.29.3A.20Fix.20a.20couple.20of.20issues.20wi.2E.2E.2E.html#372648795">(Jul 05 2023 at 16:19)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6685#pullrequestreview-1514900270">PR review</a>:</p>
<blockquote>
<p>Thanks!</p>
</blockquote>



<a name="372648796"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236685%20winch%28x64%29%3A%20Fix%20a%20couple%20of%20issues%20wi.../near/372648796" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236685.20winch.28x64.29.3A.20Fix.20a.20couple.20of.20issues.20wi.2E.2E.2E.html#372648796">(Jul 05 2023 at 16:19)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/6685#discussion_r1253346783">PR review comment</a>:</p>
<blockquote>
<p>Can we add an assert here that <code>current_sp_offset &gt;= original_sp_offset</code>? The invariant we want in the end is that the offsets are equal, and we handle the greater-than case above; I think we should never see the less-than case because we're going "up" the control-stack, is that right?</p>
</blockquote>



<a name="372677966"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236685%20winch%28x64%29%3A%20Fix%20a%20couple%20of%20issues%20wi.../near/372677966" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236685.20winch.28x64.29.3A.20Fix.20a.20couple.20of.20issues.20wi.2E.2E.2E.html#372677966">(Jul 05 2023 at 18:10)</a>:</h4>
<p>saulecabrera updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6685">PR #6685</a>.</p>



<a name="372678491"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236685%20winch%28x64%29%3A%20Fix%20a%20couple%20of%20issues%20wi.../near/372678491" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236685.20winch.28x64.29.3A.20Fix.20a.20couple.20of.20issues.20wi.2E.2E.2E.html#372678491">(Jul 05 2023 at 18:12)</a>:</h4>
<p>saulecabrera created <a href="https://github.com/bytecodealliance/wasmtime/pull/6685#discussion_r1253463968">PR review comment</a>:</p>
<blockquote>
<p>Good catch. Done, thanks!</p>
</blockquote>



<a name="372678641"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236685%20winch%28x64%29%3A%20Fix%20a%20couple%20of%20issues%20wi.../near/372678641" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236685.20winch.28x64.29.3A.20Fix.20a.20couple.20of.20issues.20wi.2E.2E.2E.html#372678641">(Jul 05 2023 at 18:13)</a>:</h4>
<p>saulecabrera has enabled auto merge for <a href="https://github.com/bytecodealliance/wasmtime/pull/6685">PR #6685</a>.</p>



<a name="372702463"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236685%20winch%28x64%29%3A%20Fix%20a%20couple%20of%20issues%20wi.../near/372702463" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236685.20winch.28x64.29.3A.20Fix.20a.20couple.20of.20issues.20wi.2E.2E.2E.html#372702463">(Jul 05 2023 at 20:03)</a>:</h4>
<p>saulecabrera created <a href="https://github.com/bytecodealliance/wasmtime/pull/6685#discussion_r1253590856">PR review comment</a>:</p>
<blockquote>
<p>CI disagrees, and after digging into it a bit I think that the invariant in question not always holds, legitimately:</p>
<div class="codehilite" data-code-language="WebAssembly"><pre><span></span><code><span class="p">(</span><span class="k">module</span>
  <span class="p">(</span><span class="k">func</span> <span class="p">(</span><span class="k">export</span> <span class="s2">"cont-inner"</span><span class="p">)</span> <span class="p">(</span><span class="k">result</span> <span class="kt">i32</span><span class="p">)</span>
    <span class="p">(</span><span class="k">local</span> <span class="kt">i32</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">local.set</span> <span class="mi">0</span> <span class="p">(</span><span class="nb">i32.const</span> <span class="mi">0</span><span class="p">))</span>
    <span class="p">(</span><span class="nb">local.set</span> <span class="mi">0</span> <span class="p">(</span><span class="nb">i32.add</span> <span class="p">(</span><span class="nb">local.get</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="k">loop</span> <span class="p">(</span><span class="k">result</span> <span class="kt">i32</span><span class="p">)</span> <span class="p">(</span><span class="k">loop</span> <span class="p">(</span><span class="k">result</span> <span class="kt">i32</span><span class="p">)</span> <span class="p">(</span><span class="nb">br</span> <span class="mi">1</span><span class="p">)))))</span> <span class="c1">;; &lt;====</span>
    <span class="p">(</span><span class="nb">local.set</span> <span class="mi">0</span> <span class="p">(</span><span class="nb">i32.add</span> <span class="p">(</span><span class="nb">local.get</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="k">loop</span> <span class="p">(</span><span class="k">result</span> <span class="kt">i32</span><span class="p">)</span> <span class="p">(</span><span class="nb">i32.ctz</span> <span class="p">(</span><span class="nb">br</span> <span class="mi">0</span><span class="p">)))))</span>
    <span class="p">(</span><span class="nb">local.set</span> <span class="mi">0</span> <span class="p">(</span><span class="nb">i32.add</span> <span class="p">(</span><span class="nb">local.get</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="k">loop</span> <span class="p">(</span><span class="k">result</span> <span class="kt">i32</span><span class="p">)</span> <span class="p">(</span><span class="nb">i32.ctz</span> <span class="p">(</span><span class="k">loop</span> <span class="p">(</span><span class="k">result</span> <span class="kt">i32</span><span class="p">)</span> <span class="p">(</span><span class="nb">br</span> <span class="mi">1</span><span class="p">))))))</span>
    <span class="p">(</span><span class="nb">local.get</span> <span class="mi">0</span><span class="p">)</span>
  <span class="p">)</span>
<span class="p">)</span>
</code></pre></div>
<p>When entering the second loop (in the second <code>local.set</code>), there are no values to spill so the current stack pointer offset is 24, same as the sp offset at the outer loop which spilled one local, then when reaching <code>br 1</code>, since the value stack only contains spilled values we need to pop that value to account for the return of the loop, which will leave the current sp at 16, effectively less than the original.</p>
<p>This makes sense to me, but do let me know if you see anything different. </p>
</blockquote>



<a name="372702591"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236685%20winch%28x64%29%3A%20Fix%20a%20couple%20of%20issues%20wi.../near/372702591" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236685.20winch.28x64.29.3A.20Fix.20a.20couple.20of.20issues.20wi.2E.2E.2E.html#372702591">(Jul 05 2023 at 20:04)</a>:</h4>
<p>saulecabrera updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6685">PR #6685</a>.</p>



<a name="372703243"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236685%20winch%28x64%29%3A%20Fix%20a%20couple%20of%20issues%20wi.../near/372703243" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236685.20winch.28x64.29.3A.20Fix.20a.20couple.20of.20issues.20wi.2E.2E.2E.html#372703243">(Jul 05 2023 at 20:07)</a>:</h4>
<p>saulecabrera has disabled auto merge for <a href="https://github.com/bytecodealliance/wasmtime/pull/6685">PR #6685</a>.</p>



<a name="372704564"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236685%20winch%28x64%29%3A%20Fix%20a%20couple%20of%20issues%20wi.../near/372704564" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236685.20winch.28x64.29.3A.20Fix.20a.20couple.20of.20issues.20wi.2E.2E.2E.html#372704564">(Jul 05 2023 at 20:14)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/6685#discussion_r1253599829">PR review comment</a>:</p>
<blockquote>
<p>Ah, hmm, OK. Can we leave a comment as to how this works then? It's not obvious to me at least how this local bit of code works -- why is it OK that we can branch to a place if we have a mismatched stack -- unless the needed values are pushed somewhere else?</p>
</blockquote>



<a name="372712290"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236685%20winch%28x64%29%3A%20Fix%20a%20couple%20of%20issues%20wi.../near/372712290" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236685.20winch.28x64.29.3A.20Fix.20a.20couple.20of.20issues.20wi.2E.2E.2E.html#372712290">(Jul 05 2023 at 20:56)</a>:</h4>
<p>saulecabrera updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6685">PR #6685</a>.</p>



<a name="372713420"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236685%20winch%28x64%29%3A%20Fix%20a%20couple%20of%20issues%20wi.../near/372713420" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236685.20winch.28x64.29.3A.20Fix.20a.20couple.20of.20issues.20wi.2E.2E.2E.html#372713420">(Jul 05 2023 at 21:03)</a>:</h4>
<p>saulecabrera updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6685">PR #6685</a>.</p>



<a name="372716654"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236685%20winch%28x64%29%3A%20Fix%20a%20couple%20of%20issues%20wi.../near/372716654" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236685.20winch.28x64.29.3A.20Fix.20a.20couple.20of.20issues.20wi.2E.2E.2E.html#372716654">(Jul 05 2023 at 21:25)</a>:</h4>
<p>saulecabrera created <a href="https://github.com/bytecodealliance/wasmtime/pull/6685#discussion_r1253666976">PR review comment</a>:</p>
<blockquote>
<p>Added a comment and put back an assert that goes along with the comment: in general the stack pointer can only be <code>word_bytes</code> less than stack pointer offset of destination frame, which accounts for the handling of the return values at the jump site. I hope this clarifies things!</p>
</blockquote>



<a name="372717072"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236685%20winch%28x64%29%3A%20Fix%20a%20couple%20of%20issues%20wi.../near/372717072" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236685.20winch.28x64.29.3A.20Fix.20a.20couple.20of.20issues.20wi.2E.2E.2E.html#372717072">(Jul 05 2023 at 21:28)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/6685#discussion_r1253671303">PR review comment</a>:</p>
<blockquote>
<p>Sounds good!</p>
</blockquote>



<a name="372723486"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236685%20winch%28x64%29%3A%20Fix%20a%20couple%20of%20issues%20wi.../near/372723486" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236685.20winch.28x64.29.3A.20Fix.20a.20couple.20of.20issues.20wi.2E.2E.2E.html#372723486">(Jul 05 2023 at 22:15)</a>:</h4>
<p>saulecabrera merged <a href="https://github.com/bytecodealliance/wasmtime/pull/6685">PR #6685</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>