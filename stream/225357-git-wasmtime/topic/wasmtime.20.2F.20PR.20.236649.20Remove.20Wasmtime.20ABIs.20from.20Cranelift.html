<html>
<head><meta charset="utf-8"><title>wasmtime / PR #6649 Remove Wasmtime ABIs from Cranelift · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236649.20Remove.20Wasmtime.20ABIs.20from.20Cranelift.html">wasmtime / PR #6649 Remove Wasmtime ABIs from Cranelift</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="370141308"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236649%20Remove%20Wasmtime%20ABIs%20from%20Cranelift/near/370141308" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236649.20Remove.20Wasmtime.20ABIs.20from.20Cranelift.html#370141308">(Jun 27 2023 at 17:03)</a>:</h4>
<p>alexcrichton opened <a href="https://github.com/bytecodealliance/wasmtime/pull/6649">PR #6649</a> from <code>alexcrichton:remove-wasmtime-abi</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>This commit removes the <code>Wasmtime*</code> family of ABIs from Cranelift. These were originally added to support multi-value in Wasmtime via the <code>TypedFunc</code> API, but they should now no longer be necessary. In general this is a higher-level Wasmtime concern than something all backends of Cranelift should have to deal with.</p>
<p>Today with recent refactorings it's possible to remove the reliance on ABI details for multi-value and instead codify it directly into the Cranelift IR generated. For example wasm calls are able to have a "purely internal" ABI which Wasmtime's Rust code doesn't see at all, and the Rust code only interacts with the native ABI. The native ABI is redefined to be what the previous Wasmtime ABIs were, which is to return the first of a 2+ value return through a register (native return value) and everything else through a return pointer.</p>
<p>&lt;!--<br>
Please make sure you include the following information:</p>
<ul>
<li>
<p>If this work has been discussed elsewhere, please include a link to that<br>
  conversation. If it was discussed in an issue, just mention "issue #...".</p>
</li>
<li>
<p>Explain why this change is needed. If the details are in an issue already,<br>
  this can be brief.</p>
</li>
</ul>
<p>Our development process is documented in the Wasmtime book:<br>
<a href="https://docs.wasmtime.dev/contributing-development-process.html">https://docs.wasmtime.dev/contributing-development-process.html</a></p>
<p>Please ensure all communication follows the code of conduct:<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>
--&gt;</p>
</blockquote>



<a name="370141311"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236649%20Remove%20Wasmtime%20ABIs%20from%20Cranelift/near/370141311" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236649.20Remove.20Wasmtime.20ABIs.20from.20Cranelift.html#370141311">(Jun 27 2023 at 17:03)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/fitzgen">fitzgen</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/6649">PR #6649</a>.</p>



<a name="370141313"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236649%20Remove%20Wasmtime%20ABIs%20from%20Cranelift/near/370141313" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236649.20Remove.20Wasmtime.20ABIs.20from.20Cranelift.html#370141313">(Jun 27 2023 at 17:03)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-compiler-reviewers">wasmtime-compiler-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/6649">PR #6649</a>.</p>



<a name="370141315"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236649%20Remove%20Wasmtime%20ABIs%20from%20Cranelift/near/370141315" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236649.20Remove.20Wasmtime.20ABIs.20from.20Cranelift.html#370141315">(Jun 27 2023 at 17:03)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/6649">PR #6649</a>.</p>



<a name="370166436"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236649%20Remove%20Wasmtime%20ABIs%20from%20Cranelift/near/370166436" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236649.20Remove.20Wasmtime.20ABIs.20from.20Cranelift.html#370166436">(Jun 27 2023 at 18:27)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6649">PR #6649</a>.</p>



<a name="370184636"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236649%20Remove%20Wasmtime%20ABIs%20from%20Cranelift/near/370184636" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236649.20Remove.20Wasmtime.20ABIs.20from.20Cranelift.html#370184636">(Jun 27 2023 at 19:34)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6649#pullrequestreview-1501706875">PR review</a>.</p>



<a name="370184638"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236649%20Remove%20Wasmtime%20ABIs%20from%20Cranelift/near/370184638" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236649.20Remove.20Wasmtime.20ABIs.20from.20Cranelift.html#370184638">(Jun 27 2023 at 19:34)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6649#pullrequestreview-1501706875">PR review</a>.</p>



<a name="370184639"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236649%20Remove%20Wasmtime%20ABIs%20from%20Cranelift/near/370184639" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236649.20Remove.20Wasmtime.20ABIs.20from.20Cranelift.html#370184639">(Jun 27 2023 at 19:34)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/6649#discussion_r1244248950">PR review comment</a>:</p>
<blockquote>
<p>Do we always need something special here? Because I'd like this function to unconditionally use <code>CallConv::Tail</code> soon, but I don't understand the details of this apple aarch64 stuff.</p>
</blockquote>



<a name="370489506"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236649%20Remove%20Wasmtime%20ABIs%20from%20Cranelift/near/370489506" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236649.20Remove.20Wasmtime.20ABIs.20from.20Cranelift.html#370489506">(Jun 28 2023 at 16:06)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/6649#discussion_r1245452887">PR review comment</a>:</p>
<blockquote>
<p>Hm so I'm not actually entirely sure what's going on here. This comment was added in <a href="https://github.com/bytecodealliance/wasmtime/pull/4195">https://github.com/bytecodealliance/wasmtime/pull/4195</a> with relation to pointer-authentication support on AArch64 I believe, but I'm not sure what ended up leading to the apple-aarch64 change here. I can confirm locally that if I change this to <code>Fast</code> that everything passes locally.</p>
<p>I'll file this as a follow-up to have it as a separate change.</p>
</blockquote>



<a name="370505728"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236649%20Remove%20Wasmtime%20ABIs%20from%20Cranelift/near/370505728" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236649.20Remove.20Wasmtime.20ABIs.20from.20Cranelift.html#370505728">(Jun 28 2023 at 16:56)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6649">PR #6649</a>.</p>



<a name="370505769"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236649%20Remove%20Wasmtime%20ABIs%20from%20Cranelift/near/370505769" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236649.20Remove.20Wasmtime.20ABIs.20from.20Cranelift.html#370505769">(Jun 28 2023 at 16:56)</a>:</h4>
<p>alexcrichton has enabled auto merge for <a href="https://github.com/bytecodealliance/wasmtime/pull/6649">PR #6649</a>.</p>



<a name="370527559"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236649%20Remove%20Wasmtime%20ABIs%20from%20Cranelift/near/370527559" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236649.20Remove.20Wasmtime.20ABIs.20from.20Cranelift.html#370527559">(Jun 28 2023 at 18:07)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6649">PR #6649</a>.</p>



<a name="370527600"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236649%20Remove%20Wasmtime%20ABIs%20from%20Cranelift/near/370527600" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236649.20Remove.20Wasmtime.20ABIs.20from.20Cranelift.html#370527600">(Jun 28 2023 at 18:07)</a>:</h4>
<p>alexcrichton has enabled auto merge for <a href="https://github.com/bytecodealliance/wasmtime/pull/6649">PR #6649</a>.</p>



<a name="370554107"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236649%20Remove%20Wasmtime%20ABIs%20from%20Cranelift/near/370554107" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236649.20Remove.20Wasmtime.20ABIs.20from.20Cranelift.html#370554107">(Jun 28 2023 at 19:33)</a>:</h4>
<p>alexcrichton merged <a href="https://github.com/bytecodealliance/wasmtime/pull/6649">PR #6649</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>