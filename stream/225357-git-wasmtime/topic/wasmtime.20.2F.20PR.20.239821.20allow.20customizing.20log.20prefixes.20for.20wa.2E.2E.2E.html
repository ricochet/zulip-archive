<html>
<head><meta charset="utf-8"><title>wasmtime / PR #9821 allow customizing log prefixes for wa... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239821.20allow.20customizing.20log.20prefixes.20for.20wa.2E.2E.2E.html">wasmtime / PR #9821 allow customizing log prefixes for wa...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="488948496"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239821%20allow%20customizing%20log%20prefixes%20for%20wa.../near/488948496" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239821.20allow.20customizing.20log.20prefixes.20for.20wa.2E.2E.2E.html#488948496">(Dec 14 2024 at 01:44)</a>:</h4>
<p>jzhn opened <a href="https://github.com/bytecodealliance/wasmtime/pull/9821">PR #9821</a> from <code>jzhn:main</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<h3>What</h3>
<p>As discussed in feature request: <a href="https://github.com/bytecodealliance/wasmtime/issues/9799">https://github.com/bytecodealliance/wasmtime/issues/9799</a>, <code>wasmtime serve</code> command always prefixes stdout and stderr logs of wasi-http handler with hardcoded format. This prevents user to implement consistent logging formats like json logging.</p>
<p>This PR adds two new optional flags, <code>--logging-prefix-stdout</code> and <code>--logging-prefix-stderr</code>, which allows users to customize the prefix, and possibly removing the prefix by providing empty strings. When the new flags are not provided, existing hehaviour is preserved (covered by existing test cases).</p>
<h3>Test</h3>
<ul>
<li>Added test case to cover new flags</li>
<li>Existing test case covers the existing behaviour when flags are absent.</li>
</ul>
<h3>Alternatives</h3>
<p>I know adding flags to CLI creates long term promise, so I'm trying to be careful here and have considered a few alternatives.</p>
<h4>boolean flags vs string</h4>
<p>we could simply provide new boolean flags like <code>--no-logging-prefix</code>, that works well for the original purpose of allowing users to disable log prefixes. However, in the future, we might want to allow users to specify log prefixes with templates, as the <code>{ req_id }</code> could be useful. Using string flags preserves the possibility of such feature.</p>
<h4>Debug options</h4>
<p>The existing <code>DebugOptions</code> already contains some customization about logging<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/da93f647974518e111561b3b451ef8c4a576bf20/crates/cli-flags/src/lib.rs#L241-L244">https://github.com/bytecodealliance/wasmtime/blob/da93f647974518e111561b3b451ef8c4a576bf20/crates/cli-flags/src/lib.rs#L241-L244</a></p>
<p>While we could add the flags there, I feel the new flags in this PR are specific to <code>wasmtime serve</code> command. So adding them to the common flags might confuse people for other commands.<br>
</p>
</blockquote>



<a name="488948498"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239821%20allow%20customizing%20log%20prefixes%20for%20wa.../near/488948498" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239821.20allow.20customizing.20log.20prefixes.20for.20wa.2E.2E.2E.html#488948498">(Dec 14 2024 at 01:44)</a>:</h4>
<p><strong>jzhn</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/9821">PR #9821</a>.</p>



<a name="488948499"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239821%20allow%20customizing%20log%20prefixes%20for%20wa.../near/488948499" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239821.20allow.20customizing.20log.20prefixes.20for.20wa.2E.2E.2E.html#488948499">(Dec 14 2024 at 01:44)</a>:</h4>
<p><strong>jzhn</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/9821">PR #9821</a>.</p>



<a name="488948581"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239821%20allow%20customizing%20log%20prefixes%20for%20wa.../near/488948581" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239821.20allow.20customizing.20log.20prefixes.20for.20wa.2E.2E.2E.html#488948581">(Dec 14 2024 at 01:45)</a>:</h4>
<p>jzhn edited <a href="https://github.com/bytecodealliance/wasmtime/pull/9821">PR #9821</a>:</p>
<blockquote>
<h3>What</h3>
<p>As discussed in feature request: <a href="https://github.com/bytecodealliance/wasmtime/issues/9799">https://github.com/bytecodealliance/wasmtime/issues/9799</a>, <code>wasmtime serve</code> command always prefixes stdout and stderr logs of wasi-http handler with hardcoded format. This prevents user to implement consistent logging formats like json logging.</p>
<p>This PR adds two new optional flags, <code>--logging-prefix-stdout</code> and <code>--logging-prefix-stderr</code>, which allows users to customize the prefix, and possibly removing the prefix by providing empty strings. When the new flags are not provided, existing hehaviour is preserved (covered by existing test cases).</p>
<h3>Test</h3>
<ul>
<li>Added test case to cover new flags</li>
<li><a href="https://github.com/bytecodealliance/wasmtime/blob/da93f647974518e111561b3b451ef8c4a576bf20/tests/all/cli_tests.rs#L1868">Existing test case</a> covers the existing behaviour when flags are absent.</li>
</ul>
<h3>Alternatives</h3>
<p>I know adding flags to CLI creates long term promise, so I'm trying to be careful here and have considered a few alternatives.</p>
<h4>boolean flags vs string</h4>
<p>we could simply provide new boolean flags like <code>--no-logging-prefix</code>, that works well for the original purpose of allowing users to disable log prefixes. However, in the future, we might want to allow users to specify log prefixes with templates, as the <code>{ req_id }</code> could be useful. Using string flags preserves the possibility of such feature.</p>
<h4>Debug options</h4>
<p>The existing <code>DebugOptions</code> already contains some customization about logging<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/da93f647974518e111561b3b451ef8c4a576bf20/crates/cli-flags/src/lib.rs#L241-L244">https://github.com/bytecodealliance/wasmtime/blob/da93f647974518e111561b3b451ef8c4a576bf20/crates/cli-flags/src/lib.rs#L241-L244</a></p>
<p>While we could add the flags there, I feel the new flags in this PR are specific to <code>wasmtime serve</code> command. So adding them to the common flags might confuse people for other commands.<br>
</p>
</blockquote>



<a name="488948800"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239821%20allow%20customizing%20log%20prefixes%20for%20wa.../near/488948800" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239821.20allow.20customizing.20log.20prefixes.20for.20wa.2E.2E.2E.html#488948800">(Dec 14 2024 at 01:49)</a>:</h4>
<p>jzhn updated <a href="https://github.com/bytecodealliance/wasmtime/pull/9821">PR #9821</a>.</p>



<a name="489271497"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239821%20allow%20customizing%20log%20prefixes%20for%20wa.../near/489271497" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239821.20allow.20customizing.20log.20prefixes.20for.20wa.2E.2E.2E.html#489271497">(Dec 16 2024 at 15:47)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9821#pullrequestreview-2506583477">PR review</a>:</p>
<blockquote>
<p>Thanks! I think the documentation may want to be updated though because using <code>{req_id}</code> could be confusing as the prefix here doesn't actually support interpolation of <code>req_id</code> or other variables. If there's no need to have acustom prefixes it might also be reasonable to have a single flag to disable prefixes perhaps?</p>
</blockquote>



<a name="489302299"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239821%20allow%20customizing%20log%20prefixes%20for%20wa.../near/489302299" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239821.20allow.20customizing.20log.20prefixes.20for.20wa.2E.2E.2E.html#489302299">(Dec 16 2024 at 18:01)</a>:</h4>
<p>jzhn <a href="https://github.com/bytecodealliance/wasmtime/pull/9821#issuecomment-2546294055">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/9821">PR #9821</a>:</p>
<blockquote>
<blockquote>
<p>Thanks! I think the documentation may want to be updated though because using <code>{req_id}</code> could be confusing as the prefix here doesn't actually support interpolation of <code>req_id</code> or other variables. If there's no need to have acustom prefixes it might also be reasonable to have a single flag to disable prefixes perhaps?</p>
</blockquote>
<p>Thanks for the review. I see that you are suggesting two directions, one to keep the custom prefix flags but update the documentation to remove mention of <code>{req_id}</code> to avoid confusion, the other to replace those custom prefix flags and use a simple boolean flag like <code>--no-logging-prefix</code> to disable the prefix.</p>
<p>I'm fine with either approach, so please just let me know which is your preference and I'll update accordingly. thanks :)</p>
</blockquote>



<a name="489303350"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239821%20allow%20customizing%20log%20prefixes%20for%20wa.../near/489303350" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239821.20allow.20customizing.20log.20prefixes.20for.20wa.2E.2E.2E.html#489303350">(Dec 16 2024 at 18:05)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/9821#issuecomment-2546304122">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/9821">PR #9821</a>:</p>
<blockquote>
<p>Ah yes sorry, I also don't have much of a preference. Since your goal is to just disable the prefix why don't we add that for now and consider adding customizable ones later.</p>
</blockquote>



<a name="489316065"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239821%20allow%20customizing%20log%20prefixes%20for%20wa.../near/489316065" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239821.20allow.20customizing.20log.20prefixes.20for.20wa.2E.2E.2E.html#489316065">(Dec 16 2024 at 18:47)</a>:</h4>
<p>jzhn updated <a href="https://github.com/bytecodealliance/wasmtime/pull/9821">PR #9821</a>.</p>



<a name="489317191"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239821%20allow%20customizing%20log%20prefixes%20for%20wa.../near/489317191" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239821.20allow.20customizing.20log.20prefixes.20for.20wa.2E.2E.2E.html#489317191">(Dec 16 2024 at 18:52)</a>:</h4>
<p>jzhn edited <a href="https://github.com/bytecodealliance/wasmtime/pull/9821">PR #9821</a>:</p>
<blockquote>
<h3>What</h3>
<p>As discussed in feature request: <a href="https://github.com/bytecodealliance/wasmtime/issues/9799">https://github.com/bytecodealliance/wasmtime/issues/9799</a>, <code>wasmtime serve</code> command always prefixes stdout and stderr logs of wasi-http handler with hardcoded format. This prevents user to implement consistent logging formats like json logging.</p>
<p>This PR adds an optional flags, <code>--no-logging-prefix</code>, to stop adding log prefixes. When the new flags are not provided, existing hehaviour is preserved.</p>
<h3>Test</h3>
<ul>
<li>Added test case to cover new flags</li>
<li><a href="https://github.com/bytecodealliance/wasmtime/blob/da93f647974518e111561b3b451ef8c4a576bf20/tests/all/cli_tests.rs#L1868">Existing test case</a> covers the existing behaviour when flags are absent.</li>
</ul>
<h3>Alternatives</h3>
<p>I know adding flags to CLI creates long term promise, so I'm trying to be careful here and have considered a few alternatives.</p>
<h4>boolean flags vs string</h4>
<p>(original implementation in this PR) To allow better flexibility and future proof, we could add two string flags, <code>--logging-prefix-stdout</code> and <code>--logging-prefix-stderr</code>, which allows users to customize the prefix, and possibly removing the prefix by providing empty strings. This enables future possibilities like allow users to specify log prefixes with templates, as the <code>{ req_id }</code> could be useful. __this is replaced with simple boolean flag of <code>--no-logging-prefix</code> to avoid over engineering.__</p>
<h4>Debug options</h4>
<p>The existing <code>DebugOptions</code> already contains some customization about logging<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/da93f647974518e111561b3b451ef8c4a576bf20/crates/cli-flags/src/lib.rs#L241-L244">https://github.com/bytecodealliance/wasmtime/blob/da93f647974518e111561b3b451ef8c4a576bf20/crates/cli-flags/src/lib.rs#L241-L244</a></p>
<p>While we could add the flags there, I feel the new flags in this PR are specific to <code>wasmtime serve</code> command. So adding them to the common flags might confuse people for other commands.<br>
</p>
</blockquote>



<a name="489319532"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239821%20allow%20customizing%20log%20prefixes%20for%20wa.../near/489319532" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239821.20allow.20customizing.20log.20prefixes.20for.20wa.2E.2E.2E.html#489319532">(Dec 16 2024 at 19:05)</a>:</h4>
<p><strong>jzhn</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/9821">PR #9821</a>.</p>



<a name="489347202"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239821%20allow%20customizing%20log%20prefixes%20for%20wa.../near/489347202" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239821.20allow.20customizing.20log.20prefixes.20for.20wa.2E.2E.2E.html#489347202">(Dec 16 2024 at 21:31)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9821#pullrequestreview-2507399271">PR review</a>.</p>



<a name="489350635"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239821%20allow%20customizing%20log%20prefixes%20for%20wa.../near/489350635" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239821.20allow.20customizing.20log.20prefixes.20for.20wa.2E.2E.2E.html#489350635">(Dec 16 2024 at 21:50)</a>:</h4>
<p>alexcrichton merged <a href="https://github.com/bytecodealliance/wasmtime/pull/9821">PR #9821</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>