<html>
<head><meta charset="utf-8"><title>wasmtime / Issue #2372 Cranelift: implement WindowsFastca... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232372.20Cranelift.3A.20implement.20WindowsFastca.2E.2E.2E.html">wasmtime / Issue #2372 Cranelift: implement WindowsFastca...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="215861741"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232372%20Cranelift%3A%20implement%20WindowsFastca.../near/215861741" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232372.20Cranelift.3A.20implement.20WindowsFastca.2E.2E.2E.html#215861741">(Nov 06 2020 at 15:32)</a>:</h4>
<p>yurydelendik opened <a href="https://github.com/bytecodealliance/wasmtime/issues/2372">Issue #2372</a>:</p>
<blockquote>
<p>The issue is a part of #2079 (and possibly #1642 ?). The issue needs to be extended to all new backends (x64 and aarch64). This will require implementing the win64 fastcall ABI support in cranelift/codegen/src/machinst/ to fix e.g. tests/all/traps.rs tests.</p>
</blockquote>



<a name="215875861"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232372%20Cranelift%3A%20implement%20WindowsFastca.../near/215875861" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232372.20Cranelift.3A.20implement.20WindowsFastca.2E.2E.2E.html#215875861">(Nov 06 2020 at 17:14)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/issues/2372#issuecomment-723196841">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2372">Issue #2372</a>:</p>
<blockquote>
<p>AFAIK, aarch64 doesn't have a separate fastcall ABI (at least according to <a href="https://docs.microsoft.com/en-us/cpp/build/arm64-windows-abi-conventions?view=msvc-160">this doc</a>) -- @peterhuene can you confirm?</p>
</blockquote>



<a name="215881495"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232372%20Cranelift%3A%20implement%20WindowsFastca.../near/215881495" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232372.20Cranelift.3A.20implement.20WindowsFastca.2E.2E.2E.html#215881495">(Nov 06 2020 at 17:58)</a>:</h4>
<p>yurydelendik <a href="https://github.com/bytecodealliance/wasmtime/issues/2372#issuecomment-723218076">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2372">Issue #2372</a>:</p>
<blockquote>
<blockquote>
<p>aarch64 doesn't have a separate fastcall ABI </p>
</blockquote>
<p>MS docs refer it as "mostly AArch64 EABI". Will we call it <code>CallConv::SystemV</code> or will add different values?</p>
</blockquote>



<a name="215885475"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232372%20Cranelift%3A%20implement%20WindowsFastca.../near/215885475" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232372.20Cranelift.3A.20implement.20WindowsFastca.2E.2E.2E.html#215885475">(Nov 06 2020 at 18:29)</a>:</h4>
<p>yurydelendik edited <a href="https://github.com/bytecodealliance/wasmtime/issues/2372">Issue #2372</a>:</p>
<blockquote>
<p>The issue is a part of #2079 (and possibly #1642 ?). The issue needs to be extended to all new backends (x64 and aarch64). This will require implementing the win64 fastcall ABI (or "mostly AArch64 EABI") support in cranelift/codegen/src/machinst/ to fix e.g. tests/all/traps.rs tests.</p>
</blockquote>



<a name="215886326"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232372%20Cranelift%3A%20implement%20WindowsFastca.../near/215886326" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232372.20Cranelift.3A.20implement.20WindowsFastca.2E.2E.2E.html#215886326">(Nov 06 2020 at 18:35)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/issues/2372#issuecomment-723235675">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2372">Issue #2372</a>:</p>
<blockquote>
<p>I read through the doc and compared it to the <a href="https://c9x.me/compile/bib/abi-arm64.pdf">standard AArch64 ABI</a>; it seems that all of the basic details are the same (register roles, stack requirements, etc.). The only differences I spotted were that the AArch64 ABI specifies FPCR (FPU control register) is undefined and must not be modified, while Windows specifies it is callee-save; and that Windows has its own exception unwind, of course. The FPCR difference shouldn't matter as we never modify the register.</p>
<p>So as far as I can tell, we can just use the <code>SystemV</code> ABI for Windows on AArch64, but others please do say something if that's wrong!</p>
</blockquote>



<a name="215889571"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232372%20Cranelift%3A%20implement%20WindowsFastca.../near/215889571" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232372.20Cranelift.3A.20implement.20WindowsFastca.2E.2E.2E.html#215889571">(Nov 06 2020 at 19:02)</a>:</h4>
<p>peterhuene <a href="https://github.com/bytecodealliance/wasmtime/issues/2372#issuecomment-723247713">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2372">Issue #2372</a>:</p>
<blockquote>
<p>I believe your assessment of the calling convention is correct, that being it won't differ from AArch64 ABI in ways that concern Cranelift.</p>
<p>However, I think we'll need a different <code>CallConv</code> value for Windows "ARM64" to differentiate the unwind information.</p>
<p>While we're there, I would <em>love</em> for us to stop calling it "Windows fastcall" instead of "Windows x64" in Cranelift, but that ship has probably sailed.</p>
</blockquote>



<a name="215889639"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232372%20Cranelift%3A%20implement%20WindowsFastca.../near/215889639" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232372.20Cranelift.3A.20implement.20WindowsFastca.2E.2E.2E.html#215889639">(Nov 06 2020 at 19:02)</a>:</h4>
<p>peterhuene edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/2372#issuecomment-723247713">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2372">Issue #2372</a>:</p>
<blockquote>
<p>I believe your assessment of the calling convention is correct: it won't differ from the AArch64 ABI in ways that concern Cranelift.</p>
<p>However, I think we'll need a different <code>CallConv</code> value for Windows "ARM64" to differentiate the unwind information.</p>
<p>While we're there, I would <em>love</em> for us to stop calling it "Windows fastcall" instead of "Windows x64" in Cranelift, but that ship has probably sailed.</p>
</blockquote>



<a name="215890995"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232372%20Cranelift%3A%20implement%20WindowsFastca.../near/215890995" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232372.20Cranelift.3A.20implement.20WindowsFastca.2E.2E.2E.html#215890995">(Nov 06 2020 at 19:14)</a>:</h4>
<p>peterhuene <a href="https://github.com/bytecodealliance/wasmtime/issues/2372#issuecomment-723252633">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2372">Issue #2372</a>:</p>
<blockquote>
<p>I guess we could also just rename <code>WindowsFastcall</code> to simply <code>Windows</code> and use the same value for both x64 and ARM backends for unwind information generation.  "Fastcall" just leaves a x86 taste in my mouth.</p>
</blockquote>



<a name="215891163"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232372%20Cranelift%3A%20implement%20WindowsFastca.../near/215891163" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232372.20Cranelift.3A.20implement.20WindowsFastca.2E.2E.2E.html#215891163">(Nov 06 2020 at 19:15)</a>:</h4>
<p>yurydelendik <a href="https://github.com/bytecodealliance/wasmtime/issues/2372#issuecomment-723253334">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2372">Issue #2372</a>:</p>
<blockquote>
<blockquote>
<p>I guess we could also just rename WindowsFastcall to simply Windows </p>
</blockquote>
<p>Yeah, I am counting we will do just that.</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>