<html>
<head><meta charset="utf-8"><title>wasmtime / issue #6009 [chaos mode] Choose a random e-nod... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236009.20.5Bchaos.20mode.5D.20Choose.20a.20random.20e-nod.2E.2E.2E.html">wasmtime / issue #6009 [chaos mode] Choose a random e-nod...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="341570425"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236009%20%5Bchaos%20mode%5D%20Choose%20a%20random%20e-nod.../near/341570425" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236009.20.5Bchaos.20mode.5D.20Choose.20a.20random.20e-nod.2E.2E.2E.html#341570425">(Mar 13 2023 at 20:48)</a>:</h4>
<p>fitzgen opened <a href="https://github.com/bytecodealliance/wasmtime/issues/6009">issue #6009</a>:</p>
<blockquote>
<p>This is what <code>wasm-mutate</code> does to generate pseudo-random semantics-preserving Wasm programs from an input Wasm module. We could also do it in our own mid end to exercise the back half of the compiler pipeline.</p>
<hr>
<div class="codehilite"><pre><span></span><code>          I was talking with @jacarte the other day as well and he had a similar idea: do the `wasm-mutate` e-graphs thing (select a random e-node from the e-class rather than the best e-node). I guess this would also fit in with the chaos mode work.
</code></pre></div>

<p>_Originally posted by @fitzgen in <a href="https://github.com/bytecodealliance/wasmtime/issues/5967#issuecomment-1464716718_">https://github.com/bytecodealliance/wasmtime/issues/5967#issuecomment-1464716718_</a></p>
</blockquote>



<a name="342081579"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236009%20%5Bchaos%20mode%5D%20Choose%20a%20random%20e-nod.../near/342081579" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236009.20.5Bchaos.20mode.5D.20Choose.20a.20random.20e-nod.2E.2E.2E.html#342081579">(Mar 15 2023 at 14:56)</a>:</h4>
<p>remlse <a href="https://github.com/bytecodealliance/wasmtime/issues/6009#issuecomment-1470158197">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/6009">issue #6009</a>:</p>
<blockquote>
<p>Related to #4134</p>
</blockquote>



<a name="342605717"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236009%20%5Bchaos%20mode%5D%20Choose%20a%20random%20e-nod.../near/342605717" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236009.20.5Bchaos.20mode.5D.20Choose.20a.20random.20e-nod.2E.2E.2E.html#342605717">(Mar 17 2023 at 16:06)</a>:</h4>
<p>Jacarte <a href="https://github.com/bytecodealliance/wasmtime/issues/6009#issuecomment-1474066363">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/6009">issue #6009</a>:</p>
<blockquote>
<p>(Commenting here the same I wrote in the issue)</p>
<p>The concept of "semantically equivalent" is actually subjective. The rewriting rule can be anything that changes the final code. In a potential real chaos mode, you can add whatever transformation rule, for example, <code>x =&gt; x + 1</code>.</p>
</blockquote>



<a name="342606559"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236009%20%5Bchaos%20mode%5D%20Choose%20a%20random%20e-nod.../near/342606559" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236009.20.5Bchaos.20mode.5D.20Choose.20a.20random.20e-nod.2E.2E.2E.html#342606559">(Mar 17 2023 at 16:09)</a>:</h4>
<p>Jacarte edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/6009#issuecomment-1474066363">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/6009">issue #6009</a>:</p>
<blockquote>
<p>(Commenting here the same I wrote in the issue)</p>
<p>The concept of "semantically equivalent" is actually subjective. The rewriting rule can be anything that changes the final code. In a potential real chaos mode, you can add whatever transformation rule, for example, <code>x =&gt; x + 1</code>. Applying that rule wil eventually stress the memory boundaries.</p>
<p>Yet, all of this are assumptions :), but, we have some of these "non-semantic" rules in wasm-mutate, <a href="https://github.com/bytecodealliance/wasm-tools/blob/458ff31e50249646eb89a23519de926be6732b65/crates/wasm-mutate/src/mutators/peephole/rules.rs#L394">https://github.com/bytecodealliance/wasm-tools/blob/458ff31e50249646eb89a23519de926be6732b65/crates/wasm-mutate/src/mutators/peephole/rules.rs#L394</a> </p>
</blockquote>



<a name="342618224"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236009%20%5Bchaos%20mode%5D%20Choose%20a%20random%20e-nod.../near/342618224" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236009.20.5Bchaos.20mode.5D.20Choose.20a.20random.20e-nod.2E.2E.2E.html#342618224">(Mar 17 2023 at 16:56)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/issues/6009#issuecomment-1474128955">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/6009">issue #6009</a>:</p>
<blockquote>
<p>@Jacarte I may be missing some context here to interpret your suggestion, but in the context we are imagining in the chaos-mode test infrastructure, we <em>do</em> actually need semantics-preserving transforms only. The idea is that every compilation with arbitrary chaos-mode choices is still a valid compilation. Unless we pair e.g. <code>x -&gt; x + 1</code> with equivalent updates of uses of <code>x</code> everywhere (<code>x' - 1</code>) then we've broken the input program. Perhaps you're thinking in a purely generative context (creating new, arbitrary programs) rather than a transforming/optimizing context?</p>
</blockquote>



<a name="342734656"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236009%20%5Bchaos%20mode%5D%20Choose%20a%20random%20e-nod.../near/342734656" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236009.20.5Bchaos.20mode.5D.20Choose.20a.20random.20e-nod.2E.2E.2E.html#342734656">(Mar 18 2023 at 08:54)</a>:</h4>
<p>Jacarte <a href="https://github.com/bytecodealliance/wasmtime/issues/6009#issuecomment-1474778409">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/6009">issue #6009</a>:</p>
<blockquote>
<blockquote>
<p>@Jacarte I may be missing some context here to interpret your suggestion, but in the context we are imagining in the chaos-mode test infrastructure, we _do_ actually need semantics-preserving transforms only. </p>
</blockquote>
<p>I agree, it was just a suggestion on disabling the semantic-aware restriction <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span> </p>
<blockquote>
<p>The idea is that every compilation with arbitrary chaos-mode choices is still a valid compilation. Unless we pair e.g. <code>x -&gt; x + 1</code> with equivalent updates of uses of <code>x</code> everywhere (<code>x' - 1</code>) then we've broken the input program. Perhaps you're thinking in a purely generative context (creating new, arbitrary programs) rather than a transforming/optimizing context?</p>
</blockquote>
<p>Yeah, that was the case, sorry for the missunderstanding.</p>
<p>Eitherway, here you can find a small (maybe not enough) explanation on what we did <a href="https://www.jacarte.me/assets/pdf/wasm_mutate.pdf">https://www.jacarte.me/assets/pdf/wasm_mutate.pdf</a> </p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>