<html>
<head><meta charset="utf-8"><title>wasmtime / PR #1494 Add new `MachInst` backend and ARM64 ... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html">wasmtime / PR #1494 Add new `MachInst` backend and ARM64 ...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="193513122"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193513122" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193513122">(Apr 09 2020 at 21:42)</a>:</h4>
<p>cfallin opened <a href="https://github.com/bytecodealliance/wasmtime/pull/1494" title="https://github.com/bytecodealliance/wasmtime/pull/1494">PR #1494</a> from <code>arm64-merge</code> to <code>master</code>:</p>
<blockquote>
<p>This PR contributes a new backend framework built around <code>MachInst</code>s (machine instructions) contained in <code>VCode</code> (virtual-registerized code) containers. Furthermore, it contains a working ARM64 backend built in this new framework. The new framework is properly connected into the main Cranelift compilation pipeline, and the appropriate integrations have been made so that <code>wasmtime</code> can run basic Wasm tests correctly on ARM64 hardware.</p>
<p>This patch sequence contains code written by Julian Seward &lt;<a href="mailto:jseward@acm.org" title="mailto:jseward@acm.org">jseward@acm.org</a>&gt; and Benjamin Bouvier &lt;<a href="mailto:public@benj.me" title="mailto:public@benj.me">public@benj.me</a>&gt;, originally developed on a side-branch before rebasing and condensing into this patch series. See the <code>arm64</code> branch at <code>https://github.com/cfallin/wasmtime</code> for original development history.</p>
<p>This patch also contains code written by Joey Gouly &lt;<a href="mailto:joey.gouly@arm.com" title="mailto:joey.gouly@arm.com">joey.gouly@arm.com</a>&gt; and contributed to the above branch. These contributions are "Copyright (c) 2020, Arm Limited."</p>
<p>Closes #1174 and #1075.</p>
</blockquote>



<a name="193513287"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193513287" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193513287">(Apr 09 2020 at 21:44)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1494" title="https://github.com/bytecodealliance/wasmtime/pull/1494">PR #1494</a> from <code>arm64-merge</code> to <code>master</code>:</p>
<blockquote>
<p>This PR contributes a new backend framework built around <code>MachInst</code>s (machine instructions) contained in <code>VCode</code> (virtual-registerized code) containers. Furthermore, it contains a working ARM64 backend built in this new framework. The new framework is properly connected into the main Cranelift compilation pipeline, and the appropriate integrations have been made so that <code>wasmtime</code> can run basic Wasm tests correctly on ARM64 hardware.</p>
<p>This patch sequence contains code written by Julian Seward &lt;<a href="mailto:jseward@acm.org" title="mailto:jseward@acm.org">jseward@acm.org</a>&gt; and Benjamin Bouvier &lt;<a href="mailto:public@benj.me" title="mailto:public@benj.me">public@benj.me</a>&gt;, originally developed on a side-branch before rebasing and condensing into this patch series. See the <code>arm64</code> branch at <code>https://github.com/cfallin/wasmtime</code> for original development history.</p>
<p>This patch also contains code written by Joey Gouly &lt;<a href="mailto:joey.gouly@arm.com" title="mailto:joey.gouly@arm.com">joey.gouly@arm.com</a>&gt; and contributed to the above branch. These contributions are "Copyright (c) 2020, Arm Limited."</p>
<p>Closes #1174 and #1075.</p>
</blockquote>



<a name="193519208"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193519208" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193519208">(Apr 09 2020 at 22:47)</a>:</h4>
<p>sunfishcode created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406509156" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406509156">PR Review Comment</a>:</p>
<blockquote>
<p>Is this a temporary workaround? If so, could you add a comment here explaining what the real fix is? If not, could you add a comment explaining why probing isn't needed? :-)</p>
</blockquote>



<a name="193519209"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193519209" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193519209">(Apr 09 2020 at 22:47)</a>:</h4>
<p>sunfishcode submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391167425" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391167425">PR Review</a>.</p>



<a name="193519210"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193519210" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193519210">(Apr 09 2020 at 22:47)</a>:</h4>
<p>sunfishcode submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391167425" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391167425">PR Review</a>.</p>



<a name="193519211"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193519211" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193519211">(Apr 09 2020 at 22:47)</a>:</h4>
<p>sunfishcode created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406508477" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406508477">PR Review Comment</a>:</p>
<blockquote>
<p>This suggests you're generating an <code>OutOfBounds</code> trap code rather than a <code>HeapOutOfBounds</code> trap code. Is that a temporary limitation, or something more fundamental? If it's temporary, could you add a TODO comment here or so?</p>
</blockquote>



<a name="193519212"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193519212" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193519212">(Apr 09 2020 at 22:47)</a>:</h4>
<p>sunfishcode created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406510393" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406510393">PR Review Comment</a>:</p>
<blockquote>
<p><code>pp</code> isn't something I can guess the meaning of without more context. What would you think about renaming it to <code>pretty-print.rs</code> or so?</p>
</blockquote>



<a name="193519213"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193519213" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193519213">(Apr 09 2020 at 22:47)</a>:</h4>
<p>sunfishcode created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406517410" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406517410">PR Review Comment</a>:</p>
<blockquote>
<p><code>all-arch</code> was deliberately removed from the default in <a href="https://github.com/bytecodealliance/cranelift/pull/853" title="https://github.com/bytecodealliance/cranelift/pull/853">https://github.com/bytecodealliance/cranelift/pull/853</a>. Is there a new need for it to be enabled here, or is this something that could be enabled by downstream users of cranelift?</p>
</blockquote>



<a name="193519214"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193519214" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193519214">(Apr 09 2020 at 22:47)</a>:</h4>
<p>sunfishcode created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406507417" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406507417">PR Review Comment</a>:</p>
<blockquote>
<p>Could you put this under a <code>cfg!(target_arch = "aarch64")</code> so that we don't register handlers for things we don't need to on x86?</p>
</blockquote>



<a name="193520024"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193520024" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193520024">(Apr 09 2020 at 22:57)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1494" title="https://github.com/bytecodealliance/wasmtime/pull/1494">PR #1494</a> from <code>arm64-merge</code> to <code>master</code>:</p>
<blockquote>
<p>This PR contributes a new backend framework built around <code>MachInst</code>s (machine instructions) contained in <code>VCode</code> (virtual-registerized code) containers. Furthermore, it contains a working ARM64 backend built in this new framework. The new framework is properly connected into the main Cranelift compilation pipeline, and the appropriate integrations have been made so that <code>wasmtime</code> can run basic Wasm tests correctly on ARM64 hardware.</p>
<p>This patch sequence contains code written by Julian Seward &lt;<a href="mailto:jseward@acm.org" title="mailto:jseward@acm.org">jseward@acm.org</a>&gt; and Benjamin Bouvier &lt;<a href="mailto:public@benj.me" title="mailto:public@benj.me">public@benj.me</a>&gt;, originally developed on a side-branch before rebasing and condensing into this patch series. See the <code>arm64</code> branch at <code>https://github.com/cfallin/wasmtime</code> for original development history.</p>
<p>This patch also contains code written by Joey Gouly &lt;<a href="mailto:joey.gouly@arm.com" title="mailto:joey.gouly@arm.com">joey.gouly@arm.com</a>&gt; and contributed to the above branch. These contributions are "Copyright (c) 2020, Arm Limited."</p>
<p>Closes #1174 and #1075.</p>
</blockquote>



<a name="193521879"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193521879" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193521879">(Apr 09 2020 at 23:17)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1494" title="https://github.com/bytecodealliance/wasmtime/pull/1494">PR #1494</a> from <code>arm64-merge</code> to <code>master</code>:</p>
<blockquote>
<p>This PR contributes a new backend framework built around <code>MachInst</code>s (machine instructions) contained in <code>VCode</code> (virtual-registerized code) containers. Furthermore, it contains a working ARM64 backend built in this new framework. The new framework is properly connected into the main Cranelift compilation pipeline, and the appropriate integrations have been made so that <code>wasmtime</code> can run basic Wasm tests correctly on ARM64 hardware.</p>
<p>This patch sequence contains code written by Julian Seward &lt;<a href="mailto:jseward@acm.org" title="mailto:jseward@acm.org">jseward@acm.org</a>&gt; and Benjamin Bouvier &lt;<a href="mailto:public@benj.me" title="mailto:public@benj.me">public@benj.me</a>&gt;, originally developed on a side-branch before rebasing and condensing into this patch series. See the <code>arm64</code> branch at <code>https://github.com/cfallin/wasmtime</code> for original development history.</p>
<p>This patch also contains code written by Joey Gouly &lt;<a href="mailto:joey.gouly@arm.com" title="mailto:joey.gouly@arm.com">joey.gouly@arm.com</a>&gt; and contributed to the above branch. These contributions are "Copyright (c) 2020, Arm Limited."</p>
<p>Closes #1174 and #1075.</p>
</blockquote>



<a name="193521939"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193521939" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193521939">(Apr 09 2020 at 23:18)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391189958" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391189958">PR Review</a>.</p>



<a name="193521940"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193521940" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193521940">(Apr 09 2020 at 23:18)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406527632" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406527632">PR Review Comment</a>:</p>
<blockquote>
<p>Actually, a few days ago we found an alternative opcode that does deliver <code>SIGILL</code> on arm64, and I hadn't updated this yet -- so we can just remove it.</p>
</blockquote>



<a name="193522067"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193522067" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193522067">(Apr 09 2020 at 23:20)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391190529" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391190529">PR Review</a>.</p>



<a name="193522068"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193522068" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193522068">(Apr 09 2020 at 23:20)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406528166" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406528166">PR Review Comment</a>:</p>
<blockquote>
<p>Hmm, I need to look into this one more. I remember making the edit thinking it was just a message change that a merge had missed, but I think you're correct that we're generating a different trap code now. We have some other failing tests on arm64 (i.e. only when running <code>cargo test</code> on arm64 hardware), so I'll revert and this just joins the club to be resolved later.</p>
</blockquote>



<a name="193522078"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193522078" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193522078">(Apr 09 2020 at 23:20)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391190569" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391190569">PR Review</a>.</p>



<a name="193522079"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193522079" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193522079">(Apr 09 2020 at 23:20)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406528196" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406528196">PR Review Comment</a>:</p>
<blockquote>
<p>Renamed!</p>
</blockquote>



<a name="193522099"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193522099" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193522099">(Apr 09 2020 at 23:20)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391190648" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391190648">PR Review</a>.</p>



<a name="193522100"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193522100" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193522100">(Apr 09 2020 at 23:20)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406528272" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406528272">PR Review Comment</a>:</p>
<blockquote>
<p>Sorry, that was added for development convenience only; reverted.</p>
</blockquote>



<a name="193522781"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193522781" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193522781">(Apr 09 2020 at 23:29)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1494" title="https://github.com/bytecodealliance/wasmtime/pull/1494">PR #1494</a> from <code>arm64-merge</code> to <code>master</code>:</p>
<blockquote>
<p>This PR contributes a new backend framework built around <code>MachInst</code>s (machine instructions) contained in <code>VCode</code> (virtual-registerized code) containers. Furthermore, it contains a working ARM64 backend built in this new framework. The new framework is properly connected into the main Cranelift compilation pipeline, and the appropriate integrations have been made so that <code>wasmtime</code> can run basic Wasm tests correctly on ARM64 hardware.</p>
<p>This patch sequence contains code written by Julian Seward &lt;<a href="mailto:jseward@acm.org" title="mailto:jseward@acm.org">jseward@acm.org</a>&gt; and Benjamin Bouvier &lt;<a href="mailto:public@benj.me" title="mailto:public@benj.me">public@benj.me</a>&gt;, originally developed on a side-branch before rebasing and condensing into this patch series. See the <code>arm64</code> branch at <code>https://github.com/cfallin/wasmtime</code> for original development history.</p>
<p>This patch also contains code written by Joey Gouly &lt;<a href="mailto:joey.gouly@arm.com" title="mailto:joey.gouly@arm.com">joey.gouly@arm.com</a>&gt; and contributed to the above branch. These contributions are "Copyright (c) 2020, Arm Limited."</p>
<p>Closes #1174 and #1075.</p>
</blockquote>



<a name="193522907"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193522907" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193522907">(Apr 09 2020 at 23:30)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391193736" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391193736">PR Review</a>.</p>



<a name="193522908"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193522908" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193522908">(Apr 09 2020 at 23:30)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406531202" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406531202">PR Review Comment</a>:</p>
<blockquote>
<p>Addressed -- it seems that stack probes are only supported on x86 / x86-64. I added a link to Rust's compiler-builtins impl of <code>__rust_probestack</code> where a comment describes the situation. Modified the code here to refer to <code>empty_probestack</code> only on non-x86, non-x86-64 architectures.</p>
</blockquote>



<a name="193526919"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193526919" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193526919">(Apr 10 2020 at 00:33)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391211358" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391211358">PR Review</a>.</p>



<a name="193526920"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193526920" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193526920">(Apr 10 2020 at 00:33)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406547472" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406547472">PR Review Comment</a>:</p>
<blockquote>
<p>FWIW with <a href="https://github.com/bytecodealliance/wasmtime/pull/1490" title="https://github.com/bytecodealliance/wasmtime/pull/1490">https://github.com/bytecodealliance/wasmtime/pull/1490</a> we won't need this anymore anyway.</p>
</blockquote>



<a name="193527434"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193527434" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193527434">(Apr 10 2020 at 00:40)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406549179" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406549179">PR Review Comment</a>:</p>
<blockquote>
<p>FWIW I'm adding the necessary Rust definitions here in <a href="https://github.com/rust-lang/libc/pull/1728" title="https://github.com/rust-lang/libc/pull/1728">https://github.com/rust-lang/libc/pull/1728</a>, but this I think is the way to go for now.</p>
</blockquote>



<a name="193527435"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193527435" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193527435">(Apr 10 2020 at 00:40)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391213065" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391213065">PR Review</a>.</p>



<a name="193552089"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193552089" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193552089">(Apr 10 2020 at 09:24)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391331128" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391331128">PR Review</a>.</p>



<a name="193552090"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193552090" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193552090">(Apr 10 2020 at 09:24)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391331128" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391331128">PR Review</a>.</p>



<a name="193552091"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193552091" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193552091">(Apr 10 2020 at 09:24)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406667813" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406667813">PR Review Comment</a>:</p>
<blockquote>
<p>This assertion fires when there are multiple <code>return</code> instructions, right?</p>
</blockquote>



<a name="193552092"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193552092" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193552092">(Apr 10 2020 at 09:24)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406669044" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406669044">PR Review Comment</a>:</p>
<blockquote>
<p>Wildcard patterns make it easy to forget updating a place when a new instruction format is added.</p>
</blockquote>



<a name="193552093"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193552093" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193552093">(Apr 10 2020 at 09:24)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406677651" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406677651">PR Review Comment</a>:</p>
<blockquote>
<p>Can this be stored in <code>cranelift_codegen::Context</code> or some other context to prevent continuous reallocation.</p>
</blockquote>



<a name="193552094"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193552094" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193552094">(Apr 10 2020 at 09:24)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406676898" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406676898">PR Review Comment</a>:</p>
<blockquote>
<p>Use accessors instead? This type has several invariants that are easily broken by modifying <code>insts</code>.</p>
</blockquote>



<a name="193552095"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193552095" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193552095">(Apr 10 2020 at 09:24)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406678612" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406678612">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>/// Pretty-printing with `RealRegUniverse` context.
</pre></div>


<p>Rustdoc supports doc comments on <code>impl</code>'s</p>
</blockquote>



<a name="193552096"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193552096" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193552096">(Apr 10 2020 at 09:24)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406679581" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406679581">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>                write!(s,
</pre></div>


<p>You may need to import <code>std::fmt::Write</code> though.</p>
</blockquote>



<a name="193552097"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193552097" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193552097">(Apr 10 2020 at 09:24)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406678901" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406678901">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>        s.push_str(&quot;VCode_ShowWithRRU {{&quot;);
</pre></div>


</blockquote>



<a name="193552098"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193552098" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193552098">(Apr 10 2020 at 09:25)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406679777" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406679777">PR Review Comment</a>:</p>
<blockquote>
<p>Why is this printing two <code>{</code> by the way.</p>
</blockquote>



<a name="193552099"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193552099" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193552099">(Apr 10 2020 at 09:25)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406675525" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406675525">PR Review Comment</a>:</p>
<blockquote>
<p>Maybe use something like</p>
<div class="codehilite"><pre><span></span>        let [a, b] = value.to_be_bytes();
        self.put1(a);
        self.put1(b);
</pre></div>


</blockquote>



<a name="193552573"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193552573" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193552573">(Apr 10 2020 at 09:31)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391355066" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391355066">PR Review</a>.</p>



<a name="193552574"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193552574" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193552574">(Apr 10 2020 at 09:31)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391355066" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391355066">PR Review</a>.</p>



<a name="193552575"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193552575" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193552575">(Apr 10 2020 at 09:31)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406682193" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406682193">PR Review Comment</a>:</p>
<blockquote>
<p>Same as above</p>
</blockquote>



<a name="193552576"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193552576" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193552576">(Apr 10 2020 at 09:31)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406681710" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406681710">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>            s.replace_range(0..1, &quot;w&quot;);
</pre></div>


</blockquote>



<a name="193552577"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193552577" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193552577">(Apr 10 2020 at 09:31)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406681839" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406681839">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>            s.push(&#39;w&#39;);
</pre></div>


</blockquote>



<a name="193552578"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193552578" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193552578">(Apr 10 2020 at 09:31)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406682156" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406682156">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>    s.replace_range(0..1, prefix);
    s
</pre></div>


</blockquote>



<a name="193552698"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193552698" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193552698">(Apr 10 2020 at 09:33)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391356576" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391356576">PR Review</a>.</p>



<a name="193552699"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193552699" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193552699">(Apr 10 2020 at 09:33)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406683025" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406683025">PR Review Comment</a>:</p>
<blockquote>
<p>This can take <code>self</code> by value.</p>
</blockquote>



<a name="193552714"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193552714" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193552714">(Apr 10 2020 at 09:33)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391356673" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391356673">PR Review</a>.</p>



<a name="193552715"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193552715" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193552715">(Apr 10 2020 at 09:33)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406683133" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406683133">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>    pub fn value(self) -&gt; u8 {
</pre></div>


</blockquote>



<a name="193553144"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193553144" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193553144">(Apr 10 2020 at 09:39)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391359147" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391359147">PR Review</a>.</p>



<a name="193553145"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193553145" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193553145">(Apr 10 2020 at 09:39)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406685231" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406685231">PR Review Comment</a>:</p>
<blockquote>
<p>The <code>aligned</code> memflag is never checked. Are stores always lowered to unaligned stores, or will it just emit a signal on unaligned stores?</p>
</blockquote>



<a name="193553565"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193553565" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193553565">(Apr 10 2020 at 09:45)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391361258" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391361258">PR Review</a>.</p>



<a name="193553566"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193553566" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193553566">(Apr 10 2020 at 09:45)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406686993" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406686993">PR Review Comment</a>:</p>
<blockquote>
<p>Assert that the triple has <code>aarch64</code> as isa?</p>
</blockquote>



<a name="193553702"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193553702" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193553702">(Apr 10 2020 at 09:46)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406687496" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406687496">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>        constructor: |_, shared_flags, _| {
            let backend = Arm64Backend::new_with_flags(shared_flags);
            Box::new(TargetIsaAdapter::new(backend))
        },
</pre></div>


<p>If a closure doesn't capture any variables, it can coerce to a function pointer.</p>
</blockquote>



<a name="193553703"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193553703" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193553703">(Apr 10 2020 at 09:46)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391361841" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391361841">PR Review</a>.</p>



<a name="193553852"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193553852" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193553852">(Apr 10 2020 at 09:49)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391362697" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391362697">PR Review</a>.</p>



<a name="193553853"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193553853" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193553853">(Apr 10 2020 at 09:49)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406688260" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406688260">PR Review Comment</a>:</p>
<blockquote>
<p>Previously you could just reuse the allocations inside <code>Function, but this will discard all allocations inside </code>Function`.</p>
</blockquote>



<a name="193553976"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193553976" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193553976">(Apr 10 2020 at 09:50)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391363137" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391363137">PR Review</a>.</p>



<a name="193553977"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193553977" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193553977">(Apr 10 2020 at 09:50)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406688652" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406688652">PR Review Comment</a>:</p>
<blockquote>
<p>Why are these clears no longer done for the new backend?</p>
</blockquote>



<a name="193554026"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193554026" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193554026">(Apr 10 2020 at 09:50)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391363340" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391363340">PR Review</a>.</p>



<a name="193554027"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193554027" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193554027">(Apr 10 2020 at 09:50)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406688823" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406688823">PR Review Comment</a>:</p>
<blockquote>
<p>Please keep this for the new backend.</p>
</blockquote>



<a name="193554063"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193554063" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193554063">(Apr 10 2020 at 09:51)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391363609" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391363609">PR Review</a>.</p>



<a name="193554064"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193554064" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193554064">(Apr 10 2020 at 09:51)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406689024" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406689024">PR Review Comment</a>:</p>
<blockquote>
<p>This doesn't seem to be used.</p>
</blockquote>



<a name="193554176"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193554176" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193554176">(Apr 10 2020 at 09:52)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391364106" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391364106">PR Review</a>.</p>



<a name="193554177"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193554177" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193554177">(Apr 10 2020 at 09:52)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406689448" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406689448">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>        use std::fmt::Write;
        let mut s = String::new();
        for b in &amp;self.bytes {
            write!(s, &quot;{:02X}, b);
        }
        s
</pre></div>


</blockquote>



<a name="193554197"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193554197" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193554197">(Apr 10 2020 at 09:52)</a>:</h4>
<p>bjorn3 edited <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406689448" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406689448">PR Review Comment</a>.</p>



<a name="193554319"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193554319" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193554319">(Apr 10 2020 at 09:54)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391364883" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391364883">PR Review</a>.</p>



<a name="193554320"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193554320" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193554320">(Apr 10 2020 at 09:54)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406690143" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406690143">PR Review Comment</a>:</p>
<blockquote>
<p>Why not use the existing <code>target aarch64</code> directive?</p>
</blockquote>



<a name="193556140"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193556140" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193556140">(Apr 10 2020 at 10:22)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391375040" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391375040">PR Review</a>.</p>



<a name="193556141"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193556141" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193556141">(Apr 10 2020 at 10:22)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406698893" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406698893">PR Review Comment</a>:</p>
<blockquote>
<p>The <code>probestack</code> has an ABI that is not compatible with <code>C</code>. This means that this will only work correctly if the compiler happened to decide that only a <code>ret</code> should be emitted. If it does anything else, like writing to a caller saved register that was used as argument for the caller of <code>probestack</code>, you will likely get a crash.</p>
</blockquote>



<a name="193573137"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193573137" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193573137">(Apr 10 2020 at 14:15)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391464729" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391464729">PR Review</a>.</p>



<a name="193573138"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193573138" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193573138">(Apr 10 2020 at 14:15)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406776678" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406776678">PR Review Comment</a>:</p>
<blockquote>
<p>Actually, I think it'd be even better to defer this choice to later; LSRA isn't properly working yet (I'll switch back when i'm done with the Spidermonkey integration), so we shouldn't give a false sentiment of safety to people by allowing them to use it. So I'd strongly recommend to just always select the backtracking allocator.</p>
</blockquote>



<a name="193574389"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193574389" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193574389">(Apr 10 2020 at 14:27)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391471035" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391471035">PR Review</a>.</p>



<a name="193574390"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193574390" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193574390">(Apr 10 2020 at 14:27)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406782020" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406782020">PR Review Comment</a>:</p>
<blockquote>
<p>Maybe name the LSRA option <code>experimental_lsra</code>?</p>
</blockquote>



<a name="193583184"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193583184" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193583184">(Apr 10 2020 at 15:42)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391510461" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391510461">PR Review</a>.</p>



<a name="193583185"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193583185" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193583185">(Apr 10 2020 at 15:42)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406814978" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406814978">PR Review Comment</a>:</p>
<blockquote>
<p>This should be the triple passed to <code>isa_builder</code>. This value will result in a binary format of unknown, which means that <code>cranelift_object</code> will not work.</p>
</blockquote>



<a name="193583416"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193583416" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193583416">(Apr 10 2020 at 15:44)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391511404" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391511404">PR Review</a>.</p>



<a name="193583418"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193583418" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193583418">(Apr 10 2020 at 15:44)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406815816" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406815816">PR Review Comment</a>:</p>
<blockquote>
<p>Also <code>target-lexicon</code> calls it <code>aarch64</code>.</p>
</blockquote>



<a name="193600439"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193600439" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193600439">(Apr 10 2020 at 18:16)</a>:</h4>
<p>sunfishcode submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391570607" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391570607">PR Review</a>.</p>



<a name="193600440"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193600440" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193600440">(Apr 10 2020 at 18:16)</a>:</h4>
<p>sunfishcode submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391570607" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391570607">PR Review</a>.</p>



<a name="193600441"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193600441" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193600441">(Apr 10 2020 at 18:16)</a>:</h4>
<p>sunfishcode created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406872505" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406872505">PR Review Comment</a>:</p>
<blockquote>
<p>Reusing this predicate logic is a good idea, but we should move it (and its dependencies) out of <a href="http://dce.rs" title="http://dce.rs">dce.rs</a> so that <a href="http://dce.rs" title="http://dce.rs">dce.rs</a> can focus on being a DCE pass. Perhaps we could start a new file, <a href="http://inst_predicates.rs" title="http://inst_predicates.rs">inst_predicates.rs</a> or so?</p>
</blockquote>



<a name="193600442"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193600442" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193600442">(Apr 10 2020 at 18:16)</a>:</h4>
<p>sunfishcode created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406873157" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406873157">PR Review Comment</a>:</p>
<blockquote>
<p>This may be an artifact of development, but we should avoid adding warning overrides like this in the main tree unless there's a practical reason we can't just fix the warning.</p>
</blockquote>



<a name="193600443"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193600443" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193600443">(Apr 10 2020 at 18:16)</a>:</h4>
<p>sunfishcode created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406865936" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406865936">PR Review Comment</a>:</p>
<blockquote>
<p>AArch64 is indeed the more official name for the architecture, and the name rustc uses, though target-lexicon and other tools do recognize "arm64" as an alias for "aarch64". I don't think it's necessary, but it would be kind of nice to rename the whole  "arm64" target to "aarch64" while we have the chance. Anyone have opinions?</p>
</blockquote>



<a name="193600444"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193600444" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193600444">(Apr 10 2020 at 18:16)</a>:</h4>
<p>sunfishcode created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406875930" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406875930">PR Review Comment</a>:</p>
<blockquote>
<p>The optimization here is converting a comparison opcode that produces an integer result and a branch that consumes an integer result into a comparison that produces a flags result and a branch that consumes the flags result. Currently it does this by rewriting the comparison in place, so there could be instructions between the compare and the branch. If they clobber the flags, the optimization isn't correct. So it isn't safe to disable this check. A possible alternative though would be to change the optimization to move the comparison just before the branch, to ensure that the flags value isn't clobbered.</p>
</blockquote>



<a name="193600445"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193600445" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193600445">(Apr 10 2020 at 18:16)</a>:</h4>
<p>sunfishcode created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406876697" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406876697">PR Review Comment</a>:</p>
<blockquote>
<p>Can you comment on why it makes sense to disable the FlagsVerifier with the mach backend?</p>
</blockquote>



<a name="193687833"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193687833" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193687833">(Apr 12 2020 at 01:08)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1494" title="https://github.com/bytecodealliance/wasmtime/pull/1494">PR #1494</a> from <code>arm64-merge</code> to <code>master</code>:</p>
<blockquote>
<p>This PR contributes a new backend framework built around <code>MachInst</code>s (machine instructions) contained in <code>VCode</code> (virtual-registerized code) containers. Furthermore, it contains a working ARM64 backend built in this new framework. The new framework is properly connected into the main Cranelift compilation pipeline, and the appropriate integrations have been made so that <code>wasmtime</code> can run basic Wasm tests correctly on ARM64 hardware.</p>
<p>This patch sequence contains code written by Julian Seward &lt;<a href="mailto:jseward@acm.org" title="mailto:jseward@acm.org">jseward@acm.org</a>&gt; and Benjamin Bouvier &lt;<a href="mailto:public@benj.me" title="mailto:public@benj.me">public@benj.me</a>&gt;, originally developed on a side-branch before rebasing and condensing into this patch series. See the <code>arm64</code> branch at <code>https://github.com/cfallin/wasmtime</code> for original development history.</p>
<p>This patch also contains code written by Joey Gouly &lt;<a href="mailto:joey.gouly@arm.com" title="mailto:joey.gouly@arm.com">joey.gouly@arm.com</a>&gt; and contributed to the above branch. These contributions are "Copyright (c) 2020, Arm Limited."</p>
<p>Closes #1174 and #1075.</p>
</blockquote>



<a name="193687835"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193687835" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193687835">(Apr 12 2020 at 01:08)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391812290" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391812290">PR Review</a>.</p>



<a name="193687836"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193687836" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193687836">(Apr 12 2020 at 01:08)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407129842" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407129842">PR Review Comment</a>:</p>
<blockquote>
<p>Added comment.</p>
</blockquote>



<a name="193687837"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193687837" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193687837">(Apr 12 2020 at 01:08)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391812295" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391812295">PR Review</a>.</p>



<a name="193687838"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193687838" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193687838">(Apr 12 2020 at 01:08)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407129855" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407129855">PR Review Comment</a>:</p>
<blockquote>
<p>Done, thanks!</p>
</blockquote>



<a name="193687848"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193687848" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193687848">(Apr 12 2020 at 01:09)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391812319" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391812319">PR Review</a>.</p>



<a name="193687849"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193687849" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193687849">(Apr 12 2020 at 01:09)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407129912" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407129912">PR Review Comment</a>:</p>
<blockquote>
<p>Eh, I think that's probably unnecessary complexity -- the <code>ABIBody</code> is specialized to, and only lives for the duration of, one function compilation anyway.</p>
</blockquote>



<a name="193687903"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193687903" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193687903">(Apr 12 2020 at 01:10)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391812360" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391812360">PR Review</a>.</p>



<a name="193687905"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193687905" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193687905">(Apr 12 2020 at 01:10)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407129985" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407129985">PR Review Comment</a>:</p>
<blockquote>
<p>Also unnecessary complexity IMHO; we'd then need to store it twice to allow the outer layer (VCode) to return information upward.</p>
</blockquote>



<a name="193687918"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193687918" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193687918">(Apr 12 2020 at 01:11)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391812412" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391812412">PR Review</a>.</p>



<a name="193687919"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193687919" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193687919">(Apr 12 2020 at 01:11)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407130057" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407130057">PR Review Comment</a>:</p>
<blockquote>
<p>Simply reverted to <code>RegAllocAlgorithm::Backtracking</code> for now; we can keep an env var backdoor as part of a local development-setup patch if needed, but for now the only stable/fast choice for mainline is BT, without checker, I think (Ben/Julian: correct me if wrong, if you think we should enable checker by default).</p>
</blockquote>



<a name="193687921"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193687921" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193687921">(Apr 12 2020 at 01:11)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391812421" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391812421">PR Review</a>.</p>



<a name="193687922"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193687922" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193687922">(Apr 12 2020 at 01:11)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407130075" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407130075">PR Review Comment</a>:</p>
<blockquote>
<p>Done.</p>
</blockquote>



<a name="193688041"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193688041" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193688041">(Apr 12 2020 at 01:14)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391812535" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391812535">PR Review</a>.</p>



<a name="193688042"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193688042" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193688042">(Apr 12 2020 at 01:14)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407130306" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407130306">PR Review Comment</a>:</p>
<blockquote>
<p>I'm not sure it's reasonable to list out all <code>InstructionData</code> variants here and in the other helpers, as there are (at present) 50 of them; that's quite a lot of verbosity. Ideally we would add new accessors to the generated code. I'm not as familiar with the DSL mechanisms for that; thoughts?</p>
</blockquote>



<a name="193688316"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193688316" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193688316">(Apr 12 2020 at 01:23)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391812932" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391812932">PR Review</a>.</p>



<a name="193688317"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193688317" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193688317">(Apr 12 2020 at 01:23)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407130959" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407130959">PR Review Comment</a>:</p>
<blockquote>
<p>In a subsequent commit on our dev branch, it becomes a function of the flags. I think this addresses both of your comments (for the former, we can't return a static instance because it might be dynamically computed per the settings).</p>
</blockquote>



<a name="193688360"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193688360" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193688360">(Apr 12 2020 at 01:24)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1494" title="https://github.com/bytecodealliance/wasmtime/pull/1494">PR #1494</a> from <code>arm64-merge</code> to <code>master</code>:</p>
<blockquote>
<p>This PR contributes a new backend framework built around <code>MachInst</code>s (machine instructions) contained in <code>VCode</code> (virtual-registerized code) containers. Furthermore, it contains a working ARM64 backend built in this new framework. The new framework is properly connected into the main Cranelift compilation pipeline, and the appropriate integrations have been made so that <code>wasmtime</code> can run basic Wasm tests correctly on ARM64 hardware.</p>
<p>This patch sequence contains code written by Julian Seward &lt;<a href="mailto:jseward@acm.org" title="mailto:jseward@acm.org">jseward@acm.org</a>&gt; and Benjamin Bouvier &lt;<a href="mailto:public@benj.me" title="mailto:public@benj.me">public@benj.me</a>&gt;, originally developed on a side-branch before rebasing and condensing into this patch series. See the <code>arm64</code> branch at <code>https://github.com/cfallin/wasmtime</code> for original development history.</p>
<p>This patch also contains code written by Joey Gouly &lt;<a href="mailto:joey.gouly@arm.com" title="mailto:joey.gouly@arm.com">joey.gouly@arm.com</a>&gt; and contributed to the above branch. These contributions are "Copyright (c) 2020, Arm Limited."</p>
<p>Closes #1174 and #1075.</p>
</blockquote>



<a name="193688415"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193688415" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193688415">(Apr 12 2020 at 01:26)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391813034" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391813034">PR Review</a>.</p>



<a name="193688416"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193688416" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193688416">(Apr 12 2020 at 01:26)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407131133" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407131133">PR Review Comment</a>:</p>
<blockquote>
<p>Instructions are lowered in reverse order, so I think this is actually correct (albeit counterintuitive!). I'll add a comment to explain this better.</p>
</blockquote>



<a name="193688427"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193688427" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193688427">(Apr 12 2020 at 01:27)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391813064" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391813064">PR Review</a>.</p>



<a name="193688428"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193688428" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193688428">(Apr 12 2020 at 01:27)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407131180" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407131180">PR Review Comment</a>:</p>
<blockquote>
<p>Perhaps, but <code>TargetIsa</code> requires the information to come from somewhere. If we eventually remove more vestigial code when all backends migrate to the new framework, I think we'll be able to remove this altogether.</p>
</blockquote>



<a name="193688490"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193688490" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193688490">(Apr 12 2020 at 01:28)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391813137" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391813137">PR Review</a>.</p>



<a name="193688491"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193688491" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193688491">(Apr 12 2020 at 01:28)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407131305" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407131305">PR Review Comment</a>:</p>
<blockquote>
<p>The intent is to allow multiple sections to be constructed simultaneously; this rules out a streaming approach. (We've currently folded the constants and jumptables in as inline data on ARM64, but we previously actually build the sections this way, and could change again when we have proper support for long-range PC-relative addressing.)</p>
</blockquote>



<a name="193688646"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193688646" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193688646">(Apr 12 2020 at 01:33)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391813317" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391813317">PR Review</a>.</p>



<a name="193688647"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193688647" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193688647">(Apr 12 2020 at 01:33)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407131647" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407131647">PR Review Comment</a>:</p>
<blockquote>
<p>Did one better and removed the <code>pub</code> qualifiers (only used for access by the <code>BlockRPO</code> computation).</p>
</blockquote>



<a name="193688718"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193688718" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193688718">(Apr 12 2020 at 01:35)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391813416" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391813416">PR Review</a>.</p>



<a name="193688719"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193688719" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193688719">(Apr 12 2020 at 01:35)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407131848" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407131848">PR Review Comment</a>:</p>
<blockquote>
<p>This is @julian-seward1's debug-printing format; I'm not entirely sure but I am sure there is a good reason for it :-) Perhaps it allows for easier log-grepping. I'll resolve this for now but we can always come back and refine the debug-printing format later if it needs to be more concise, or machine-readable, or whatever.</p>
</blockquote>



<a name="193688777"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193688777" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193688777">(Apr 12 2020 at 01:37)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391813501" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391813501">PR Review</a>.</p>



<a name="193688778"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193688778" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193688778">(Apr 12 2020 at 01:37)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407132024" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407132024">PR Review Comment</a>:</p>
<blockquote>
<p>I'm not sure what you mean by "continuous" -- this is one reallocation that happens per function compilation (<code>replace_insns_from_regalloc</code> is called once in the compilation pipeline). Holding a persistent vector to reuse in <code>Context</code> wouldn't really work with parallel compilation, if I understand your proposal correctly.</p>
</blockquote>



<a name="193688883"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193688883" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193688883">(Apr 12 2020 at 01:40)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391813599" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391813599">PR Review</a>.</p>



<a name="193688884"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193688884" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193688884">(Apr 12 2020 at 01:40)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407132204" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407132204">PR Review Comment</a>:</p>
<blockquote>
<p>I learn something new about the standard library every day -- thanks!</p>
</blockquote>



<a name="193688897"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193688897" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193688897">(Apr 12 2020 at 01:41)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391813639" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391813639">PR Review</a>.</p>



<a name="193688898"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193688898" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193688898">(Apr 12 2020 at 01:41)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407132282" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407132282">PR Review Comment</a>:</p>
<blockquote>
<p>OK, I haven't used rust-analyzer before; but for basic source-code readability, I'd prefer to keep the argument-name comment here.</p>
</blockquote>



<a name="193689017"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193689017" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193689017">(Apr 12 2020 at 01:44)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391813772" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391813772">PR Review</a>.</p>



<a name="193689018"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193689018" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193689018">(Apr 12 2020 at 01:44)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407132533" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407132533">PR Review Comment</a>:</p>
<blockquote>
<p>Yes, but this only happens when the "fallthrough return" mode is used (grep for <code>GenerateReturn::No</code> in <code>machinst/lower.rs</code>, <code>gen_retval_setup()</code>), which comes from SpiderMonkey (the Baldrdash ABI). In that case, a return in the middle of the function doesn't make sense anyway.</p>
</blockquote>



<a name="193689174"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193689174" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193689174">(Apr 12 2020 at 01:51)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391814067" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391814067">PR Review</a>.</p>



<a name="193689175"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193689175" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193689175">(Apr 12 2020 at 01:51)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407133023" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407133023">PR Review Comment</a>:</p>
<blockquote>
<p>I was going to make this change at first, but it's quite a refactor to a bunch of debug-printing code (and more in the x64 backend which is not included here) which I'm not inclined to think is worth the effort. The <code>show_rru()</code> impls are meant to help debug-logging and are never called in production, so I think it's probably OK to keep this interface as-is, unless Dan/Ben/Julian disagree?</p>
</blockquote>



<a name="193689246"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193689246" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193689246">(Apr 12 2020 at 01:53)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391814147" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391814147">PR Review</a>.</p>



<a name="193689247"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193689247" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193689247">(Apr 12 2020 at 01:53)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407133145" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407133145">PR Review Comment</a>:</p>
<blockquote>
<p>The comment here is wrong, on closer inspection -- removed. (If <code>final_block_order</code> is empty, that line of the output just shows an empty list.)</p>
</blockquote>



<a name="193689682"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193689682" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193689682">(Apr 12 2020 at 02:07)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391814705" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391814705">PR Review</a>.</p>



<a name="193689683"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193689683" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193689683">(Apr 12 2020 at 02:07)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407134166" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407134166">PR Review Comment</a>:</p>
<blockquote>
<p>Apparently, aarch64 supports unaligned accesses with the ordinary load/store instructions. I just tested this on real hardware and it seems to work; [1] also confirms.</p>
<p>[1] <a href="https://stackoverflow.com/questions/38535738/does-aarch64-support-unaligned-access" title="https://stackoverflow.com/questions/38535738/does-aarch64-support-unaligned-access">https://stackoverflow.com/questions/38535738/does-aarch64-support-unaligned-access</a></p>
</blockquote>



<a name="193689735"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193689735" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193689735">(Apr 12 2020 at 02:09)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1494" title="https://github.com/bytecodealliance/wasmtime/pull/1494">PR #1494</a> from <code>arm64-merge</code> to <code>master</code>:</p>
<blockquote>
<p>This PR contributes a new backend framework built around <code>MachInst</code>s (machine instructions) contained in <code>VCode</code> (virtual-registerized code) containers. Furthermore, it contains a working ARM64 backend built in this new framework. The new framework is properly connected into the main Cranelift compilation pipeline, and the appropriate integrations have been made so that <code>wasmtime</code> can run basic Wasm tests correctly on ARM64 hardware.</p>
<p>This patch sequence contains code written by Julian Seward &lt;<a href="mailto:jseward@acm.org" title="mailto:jseward@acm.org">jseward@acm.org</a>&gt; and Benjamin Bouvier &lt;<a href="mailto:public@benj.me" title="mailto:public@benj.me">public@benj.me</a>&gt;, originally developed on a side-branch before rebasing and condensing into this patch series. See the <code>arm64</code> branch at <code>https://github.com/cfallin/wasmtime</code> for original development history.</p>
<p>This patch also contains code written by Joey Gouly &lt;<a href="mailto:joey.gouly@arm.com" title="mailto:joey.gouly@arm.com">joey.gouly@arm.com</a>&gt; and contributed to the above branch. These contributions are "Copyright (c) 2020, Arm Limited."</p>
<p>Closes #1174 and #1075.</p>
</blockquote>



<a name="193690104"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193690104" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193690104">(Apr 12 2020 at 02:20)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391815319" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391815319">PR Review</a>.</p>



<a name="193690105"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193690105" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193690105">(Apr 12 2020 at 02:20)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407135155" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407135155">PR Review Comment</a>:</p>
<blockquote>
<p>Yes, that's a theoretical concern. In practice, the empty function <code>{}</code> compiles to just a <code>ret</code> in both debug and release mode on both x86-64 and aarch64 (just tested all four combinations). Do you have a suggestion for a better approach (compiler attributes, etc)?</p>
</blockquote>



<a name="193690458"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193690458" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193690458">(Apr 12 2020 at 02:32)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1494" title="https://github.com/bytecodealliance/wasmtime/pull/1494">PR #1494</a> from <code>arm64-merge</code> to <code>master</code>:</p>
<blockquote>
<p>This PR contributes a new backend framework built around <code>MachInst</code>s (machine instructions) contained in <code>VCode</code> (virtual-registerized code) containers. Furthermore, it contains a working ARM64 backend built in this new framework. The new framework is properly connected into the main Cranelift compilation pipeline, and the appropriate integrations have been made so that <code>wasmtime</code> can run basic Wasm tests correctly on ARM64 hardware.</p>
<p>This patch sequence contains code written by Julian Seward &lt;<a href="mailto:jseward@acm.org" title="mailto:jseward@acm.org">jseward@acm.org</a>&gt; and Benjamin Bouvier &lt;<a href="mailto:public@benj.me" title="mailto:public@benj.me">public@benj.me</a>&gt;, originally developed on a side-branch before rebasing and condensing into this patch series. See the <code>arm64</code> branch at <code>https://github.com/cfallin/wasmtime</code> for original development history.</p>
<p>This patch also contains code written by Joey Gouly &lt;<a href="mailto:joey.gouly@arm.com" title="mailto:joey.gouly@arm.com">joey.gouly@arm.com</a>&gt; and contributed to the above branch. These contributions are "Copyright (c) 2020, Arm Limited."</p>
<p>Closes #1174 and #1075.</p>
</blockquote>



<a name="193690533"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193690533" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193690533">(Apr 12 2020 at 02:35)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1494" title="https://github.com/bytecodealliance/wasmtime/pull/1494">PR #1494</a> from <code>arm64-merge</code> to <code>master</code>:</p>
<blockquote>
<p>This PR contributes a new backend framework built around <code>MachInst</code>s (machine instructions) contained in <code>VCode</code> (virtual-registerized code) containers. Furthermore, it contains a working ARM64 backend built in this new framework. The new framework is properly connected into the main Cranelift compilation pipeline, and the appropriate integrations have been made so that <code>wasmtime</code> can run basic Wasm tests correctly on ARM64 hardware.</p>
<p>This patch sequence contains code written by Julian Seward &lt;<a href="mailto:jseward@acm.org" title="mailto:jseward@acm.org">jseward@acm.org</a>&gt; and Benjamin Bouvier &lt;<a href="mailto:public@benj.me" title="mailto:public@benj.me">public@benj.me</a>&gt;, originally developed on a side-branch before rebasing and condensing into this patch series. See the <code>arm64</code> branch at <code>https://github.com/cfallin/wasmtime</code> for original development history.</p>
<p>This patch also contains code written by Joey Gouly &lt;<a href="mailto:joey.gouly@arm.com" title="mailto:joey.gouly@arm.com">joey.gouly@arm.com</a>&gt; and contributed to the above branch. These contributions are "Copyright (c) 2020, Arm Limited."</p>
<p>Closes #1174 and #1075.</p>
</blockquote>



<a name="193690790"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193690790" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193690790">(Apr 12 2020 at 02:44)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391816590" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391816590">PR Review</a>.</p>



<a name="193690791"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193690791" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193690791">(Apr 12 2020 at 02:44)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407136965" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407136965">PR Review Comment</a>:</p>
<blockquote>
<p>I agree, we might as well standardize on the official name. Renamed the backend to <code>aarch64</code>. There are still a few vestigial remnants of <code>Arm64</code> around, e.g. the <code>Arm64Call</code> reloc type which is exposed in the public API.</p>
</blockquote>



<a name="193690802"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193690802" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193690802">(Apr 12 2020 at 02:45)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1494" title="https://github.com/bytecodealliance/wasmtime/pull/1494">PR #1494</a> from <code>arm64-merge</code> to <code>master</code>:</p>
<blockquote>
<p>This PR contributes a new backend framework built around <code>MachInst</code>s (machine instructions) contained in <code>VCode</code> (virtual-registerized code) containers. Furthermore, it contains a working ARM64 backend built in this new framework. The new framework is properly connected into the main Cranelift compilation pipeline, and the appropriate integrations have been made so that <code>wasmtime</code> can run basic Wasm tests correctly on ARM64 hardware.</p>
<p>This patch sequence contains code written by Julian Seward &lt;<a href="mailto:jseward@acm.org" title="mailto:jseward@acm.org">jseward@acm.org</a>&gt; and Benjamin Bouvier &lt;<a href="mailto:public@benj.me" title="mailto:public@benj.me">public@benj.me</a>&gt;, originally developed on a side-branch before rebasing and condensing into this patch series. See the <code>arm64</code> branch at <code>https://github.com/cfallin/wasmtime</code> for original development history.</p>
<p>This patch also contains code written by Joey Gouly &lt;<a href="mailto:joey.gouly@arm.com" title="mailto:joey.gouly@arm.com">joey.gouly@arm.com</a>&gt; and contributed to the above branch. These contributions are "Copyright (c) 2020, Arm Limited."</p>
<p>Closes #1174 and #1075.</p>
</blockquote>



<a name="193690939"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193690939" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193690939">(Apr 12 2020 at 02:50)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391816843" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391816843">PR Review</a>.</p>



<a name="193690940"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193690940" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193690940">(Apr 12 2020 at 02:50)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407137389" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407137389">PR Review Comment</a>:</p>
<blockquote>
<p>Ah, OK -- the arm64 backend at least will correctly handle an <code>icmp</code> + <code>brz</code>/<code>brnz</code> sequence, so we don't need this optimization -- I've just altered it to skip this mutation entirely when a MachBackend is in use.</p>
</blockquote>



<a name="193691001"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193691001" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193691001">(Apr 12 2020 at 02:53)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1494" title="https://github.com/bytecodealliance/wasmtime/pull/1494">PR #1494</a> from <code>arm64-merge</code> to <code>master</code>:</p>
<blockquote>
<p>This PR contributes a new backend framework built around <code>MachInst</code>s (machine instructions) contained in <code>VCode</code> (virtual-registerized code) containers. Furthermore, it contains a working ARM64 backend built in this new framework. The new framework is properly connected into the main Cranelift compilation pipeline, and the appropriate integrations have been made so that <code>wasmtime</code> can run basic Wasm tests correctly on ARM64 hardware.</p>
<p>This patch sequence contains code written by Julian Seward &lt;<a href="mailto:jseward@acm.org" title="mailto:jseward@acm.org">jseward@acm.org</a>&gt; and Benjamin Bouvier &lt;<a href="mailto:public@benj.me" title="mailto:public@benj.me">public@benj.me</a>&gt;, originally developed on a side-branch before rebasing and condensing into this patch series. See the <code>arm64</code> branch at <code>https://github.com/cfallin/wasmtime</code> for original development history.</p>
<p>This patch also contains code written by Joey Gouly &lt;<a href="mailto:joey.gouly@arm.com" title="mailto:joey.gouly@arm.com">joey.gouly@arm.com</a>&gt; and contributed to the above branch. These contributions are "Copyright (c) 2020, Arm Limited."</p>
<p>Closes #1174 and #1075.</p>
</blockquote>



<a name="193691063"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193691063" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193691063">(Apr 12 2020 at 02:55)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391817048" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391817048">PR Review</a>.</p>



<a name="193691064"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193691064" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193691064">(Apr 12 2020 at 02:55)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407137732" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407137732">PR Review Comment</a>:</p>
<blockquote>
<p>The FlagsVerifier as written uses the encoding info to determine whether instructions clobber the flags. We could certainly build an equivalent with the new infrastructure, or else add a target-independent notion of "clobbers flags" to the CLIF opcodes themselves, but it would be some extra plumbing. What do you think?</p>
</blockquote>



<a name="193691436"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193691436" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193691436">(Apr 12 2020 at 03:09)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391817603" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391817603">PR Review</a>.</p>



<a name="193691437"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193691437" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193691437">(Apr 12 2020 at 03:09)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407138754" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407138754">PR Review Comment</a>:</p>
<blockquote>
<p>The simple answer is that I couldn't work out how to fetch it. It doesn't appear to be included in the <code>preamble_comments</code> of the <code>Context</code>. It doesn't seem too important to me; but I'm happy to change it if you can point out the proper plumbing to make use of here.</p>
</blockquote>



<a name="193691650"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193691650" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193691650">(Apr 12 2020 at 03:17)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1494" title="https://github.com/bytecodealliance/wasmtime/pull/1494">PR #1494</a> from <code>arm64-merge</code> to <code>master</code>:</p>
<blockquote>
<p>This PR contributes a new backend framework built around <code>MachInst</code>s (machine instructions) contained in <code>VCode</code> (virtual-registerized code) containers. Furthermore, it contains a working ARM64 backend built in this new framework. The new framework is properly connected into the main Cranelift compilation pipeline, and the appropriate integrations have been made so that <code>wasmtime</code> can run basic Wasm tests correctly on ARM64 hardware.</p>
<p>This patch sequence contains code written by Julian Seward &lt;<a href="mailto:jseward@acm.org" title="mailto:jseward@acm.org">jseward@acm.org</a>&gt; and Benjamin Bouvier &lt;<a href="mailto:public@benj.me" title="mailto:public@benj.me">public@benj.me</a>&gt;, originally developed on a side-branch before rebasing and condensing into this patch series. See the <code>arm64</code> branch at <code>https://github.com/cfallin/wasmtime</code> for original development history.</p>
<p>This patch also contains code written by Joey Gouly &lt;<a href="mailto:joey.gouly@arm.com" title="mailto:joey.gouly@arm.com">joey.gouly@arm.com</a>&gt; and contributed to the above branch. These contributions are "Copyright (c) 2020, Arm Limited."</p>
<p>Closes #1174 and #1075.</p>
</blockquote>



<a name="193691791"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193691791" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193691791">(Apr 12 2020 at 03:24)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1494" title="https://github.com/bytecodealliance/wasmtime/pull/1494">PR #1494</a> from <code>arm64-merge</code> to <code>master</code>:</p>
<blockquote>
<p>This PR contributes a new backend framework built around <code>MachInst</code>s (machine instructions) contained in <code>VCode</code> (virtual-registerized code) containers. Furthermore, it contains a working ARM64 backend built in this new framework. The new framework is properly connected into the main Cranelift compilation pipeline, and the appropriate integrations have been made so that <code>wasmtime</code> can run basic Wasm tests correctly on ARM64 hardware.</p>
<p>This patch sequence contains code written by Julian Seward &lt;<a href="mailto:jseward@acm.org" title="mailto:jseward@acm.org">jseward@acm.org</a>&gt; and Benjamin Bouvier &lt;<a href="mailto:public@benj.me" title="mailto:public@benj.me">public@benj.me</a>&gt;, originally developed on a side-branch before rebasing and condensing into this patch series. See the <code>arm64</code> branch at <code>https://github.com/cfallin/wasmtime</code> for original development history.</p>
<p>This patch also contains code written by Joey Gouly &lt;<a href="mailto:joey.gouly@arm.com" title="mailto:joey.gouly@arm.com">joey.gouly@arm.com</a>&gt; and contributed to the above branch. These contributions are "Copyright (c) 2020, Arm Limited."</p>
<p>Closes #1174 and #1075.</p>
</blockquote>



<a name="193691829"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193691829" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193691829">(Apr 12 2020 at 03:24)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391818214" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391818214">PR Review</a>.</p>



<a name="193691830"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193691830" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193691830">(Apr 12 2020 at 03:24)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407139801" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407139801">PR Review Comment</a>:</p>
<blockquote>
<p>Actually, upon second look, worked this out -- the tests now use the <code>target</code> directive. Resolving!</p>
</blockquote>



<a name="193691859"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193691859" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193691859">(Apr 12 2020 at 03:25)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1494" title="https://github.com/bytecodealliance/wasmtime/pull/1494">PR #1494</a> from <code>arm64-merge</code> to <code>master</code>:</p>
<blockquote>
<p>This PR contributes a new backend framework built around <code>MachInst</code>s (machine instructions) contained in <code>VCode</code> (virtual-registerized code) containers. Furthermore, it contains a working ARM64 backend built in this new framework. The new framework is properly connected into the main Cranelift compilation pipeline, and the appropriate integrations have been made so that <code>wasmtime</code> can run basic Wasm tests correctly on ARM64 hardware.</p>
<p>This patch sequence contains code written by Julian Seward &lt;<a href="mailto:jseward@acm.org" title="mailto:jseward@acm.org">jseward@acm.org</a>&gt; and Benjamin Bouvier &lt;<a href="mailto:public@benj.me" title="mailto:public@benj.me">public@benj.me</a>&gt;, originally developed on a side-branch before rebasing and condensing into this patch series. See the <code>arm64</code> branch at <code>https://github.com/cfallin/wasmtime</code> for original development history.</p>
<p>This patch also contains code written by Joey Gouly &lt;<a href="mailto:joey.gouly@arm.com" title="mailto:joey.gouly@arm.com">joey.gouly@arm.com</a>&gt; and contributed to the above branch. These contributions are "Copyright (c) 2020, Arm Limited."</p>
<p>Closes #1174 and #1075.</p>
</blockquote>



<a name="193697707"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193697707" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193697707">(Apr 12 2020 at 06:38)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391826605" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391826605">PR Review</a>.</p>



<a name="193697708"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193697708" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193697708">(Apr 12 2020 at 06:38)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407154469" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407154469">PR Review Comment</a>:</p>
<blockquote>
<p>With continuous I mean that it reallocates for every function, instead of once per <code>Context</code>. (Apart reallocations necessary resize the vec.) The <code>Context</code> holds allocations that are reused between compilations of different functions. It works fine with parallel compilation, as you can just allocate a single <code>Context</code> per thread.</p>
</blockquote>



<a name="193701860"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193701860" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193701860">(Apr 12 2020 at 08:46)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391835170" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391835170">PR Review</a>.</p>



<a name="193701861"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193701861" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193701861">(Apr 12 2020 at 08:46)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407167412" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407167412">PR Review Comment</a>:</p>
<blockquote>
<p>Maybe use Cranelift to create the function?</p>
</blockquote>



<a name="193702508"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193702508" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193702508">(Apr 12 2020 at 09:03)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391835603" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391835603">PR Review</a>.</p>



<a name="193702509"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193702509" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193702509">(Apr 12 2020 at 09:03)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391835603" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391835603">PR Review</a>.</p>



<a name="193702510"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193702510" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193702510">(Apr 12 2020 at 09:03)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407168029" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407168029">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>/// A location for an argument or return value.
</pre></div>


</blockquote>



<a name="193702511"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193702511" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193702511">(Apr 12 2020 at 09:03)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407168047" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407168047">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>    /// In a real register.
</pre></div>


</blockquote>



<a name="193702512"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193702512" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193702512">(Apr 12 2020 at 09:03)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407167992" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407167992">PR Review Comment</a>:</p>
<blockquote>
<p>Legalizations are only supposed to run when there is no encoding for an instruction. The generic legalization group contains a lot of legalizations for instructions that can be implemented more efficiently using native instructions. For example 8 and 16 bit operators are legalized using <code>ireduce</code>/<code>uextend</code>/<code>sextend</code>. Is it possible to only run legalizations during lowering when there is no encoding?</p>
</blockquote>



<a name="193702513"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193702513" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193702513">(Apr 12 2020 at 09:03)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407168060" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407168060">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>    /// Arguments only: on stack, at given offset from SP at entry.
</pre></div>


</blockquote>



<a name="193702514"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193702514" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193702514">(Apr 12 2020 at 09:03)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407168072" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407168072">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>    /// (first and only) return value only: in memory pointed to by x8 on entry.
</pre></div>


</blockquote>



<a name="193702515"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193702515" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193702515">(Apr 12 2020 at 09:03)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407168114" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407168114">PR Review Comment</a>:</p>
<blockquote>
<p>Should this be removed?</p>
</blockquote>



<a name="193702516"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193702516" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193702516">(Apr 12 2020 at 09:03)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407168222" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407168222">PR Review Comment</a>:</p>
<blockquote>
<p>It is allowed to use them as long as it restores them before returning, right?</p>
</blockquote>



<a name="193702517"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193702517" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193702517">(Apr 12 2020 at 09:03)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407168321" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407168321">PR Review Comment</a>:</p>
<blockquote>
<p>Please use doc comments.</p>
</blockquote>



<a name="193702518"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193702518" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193702518">(Apr 12 2020 at 09:03)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407168701" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407168701">PR Review Comment</a>:</p>
<blockquote>
<p>Maybe check that the call conv is either <code>Fast</code>, <code>Cold</code>, <code>SystemV</code> or <code>BaldrdashSystemV</code> and not <code>WindowsFastCall</code> or <code>Probestack</code>? The later two are not yet implemented.</p>
</blockquote>



<a name="193702519"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193702519" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193702519">(Apr 12 2020 at 09:03)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407168453" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407168453">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>        _ =&gt; unimplemented!(&quot;load_stack({})&quot;, ty),
</pre></div>


</blockquote>



<a name="193702520"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193702520" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193702520">(Apr 12 2020 at 09:03)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407168914" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407168914">PR Review Comment</a>:</p>
<blockquote>
<p>And check for call conv here too.</p>
</blockquote>



<a name="193702521"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193702521" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193702521">(Apr 12 2020 at 09:03)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407169020" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407169020">PR Review Comment</a>:</p>
<blockquote>
<p>If arg is <code>Copy</code> you can do:</p>
<div class="codehilite"><pre><span></span>        for &amp;arg in &amp;self.sig.args {
</pre></div>


</blockquote>



<a name="193702522"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193702522" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193702522">(Apr 12 2020 at 09:03)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407169169" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407169169">PR Review Comment</a>:</p>
<blockquote>
<p>Please take <code>u64</code> or <code>i64</code> instead. This is platform dependent, so won't work nice for cross-compilation.</p>
</blockquote>



<a name="193709886"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193709886" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193709886">(Apr 12 2020 at 11:51)</a>:</h4>
<p>bjorn3 edited <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407169169" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407169169">PR Review Comment</a>.</p>



<a name="193712508"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193712508" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193712508">(Apr 12 2020 at 13:07)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391837506" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391837506">PR Review</a>.</p>



<a name="193712509"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193712509" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193712509">(Apr 12 2020 at 13:07)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407187810" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407187810">PR Review Comment</a>:</p>
<blockquote>
<p>Is there an assertion that <code>MOV</code> doesn't have <code>x31</code> as register just in case?</p>
</blockquote>



<a name="193712510"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193712510" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193712510">(Apr 12 2020 at 13:07)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407170556" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407170556">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>        let fp_off: i64 = -(self.stackslots_size as i64) - (8 * islot) - i64::from(ty_size);
</pre></div>


</blockquote>



<a name="193712511"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193712511" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193712511">(Apr 12 2020 at 13:07)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391837506" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391837506">PR Review</a>.</p>



<a name="193712512"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193712512" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193712512">(Apr 12 2020 at 13:07)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407188403" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407188403">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>#[derive(Clone, Copy, Debug)]
#[repr(u8)]
pub enum ShiftOp {
    LSL = 0b00,
    LSR = 0b01,
    ASR = 0b10,
    ROR = 0b11,
}

impl ShiftOp {
    /// Get the encoding of this shift op.
    pub fn bits(self) -&gt; u8 {
        self as u8
    }
}
</pre></div>


</blockquote>



<a name="193712513"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193712513" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193712513">(Apr 12 2020 at 13:07)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407187925" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407187925">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>        u32::try_from(
            self.frame_size
                .expect(&quot;frame size not computed before prologue generation&quot;
        ).expect(&quot;overflow&quot;)
</pre></div>


</blockquote>



<a name="193712514"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193712514" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193712514">(Apr 12 2020 at 13:07)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407188550" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407188550">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>        self.op
</pre></div>


<p><code>ShiftOp</code> is <code>Copy</code></p>
</blockquote>



<a name="193712515"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193712515" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193712515">(Apr 12 2020 at 13:07)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407188704" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407188704">PR Review Comment</a>:</p>
<blockquote>
<p>Can you move this down to just above the impl block for this?</p>
</blockquote>



<a name="193712516"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193712516" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193712516">(Apr 12 2020 at 13:07)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407189007" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407189007">PR Review Comment</a>:</p>
<blockquote>
<p>This doc comment is attached to <code>SPOffset</code> not both.</p>
</blockquote>



<a name="193712517"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193712517" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193712517">(Apr 12 2020 at 13:07)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407189156" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407189156">PR Review Comment</a>:</p>
<blockquote>
<p>If <code>offset</code> is zero, this returns <code>Some(SImm9::zero())</code>, right?</p>
</blockquote>



<a name="193712518"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193712518" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193712518">(Apr 12 2020 at 13:07)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407189195" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407189195">PR Review Comment</a>:</p>
<blockquote>
<p><code>reg_plus_reg</code>?</p>
</blockquote>



<a name="193712519"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193712519" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193712519">(Apr 12 2020 at 13:07)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407189256" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407189256">PR Review Comment</a>:</p>
<blockquote>
<p>This doesn't mention <code>op</code>.</p>
</blockquote>



<a name="193712520"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193712520" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193712520">(Apr 12 2020 at 13:07)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407188876" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407188876">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>#[derive(Clone, Copy, Debug)]
#[repr(u8)]
pub enum ExtendOp {
    UXTB = 0b000,
    UXTH = 0b001,
    UXTW = 0b010,
    UXTX = 0b011,
    SXTB = 0b100,
    SXTH = 0b101,
    SXTW = 0b110,
    SXTX = 0b111,
}

impl ExtendOp {
    /// Encoding of this op.
    pub fn bits(self) -&gt; u8 {
        self as u8
    }
}
</pre></div>


</blockquote>



<a name="193712521"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193712521" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193712521">(Apr 12 2020 at 13:07)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407189333" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407189333">PR Review Comment</a>:</p>
<blockquote>
<p>Maybe put a empty line between every pair of conditions inverting each other?</p>
</blockquote>



<a name="193712522"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193712522" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193712522">(Apr 12 2020 at 13:07)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407188945" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407188945">PR Review Comment</a>:</p>
<blockquote>
<p>Can you add a doc comment describing what <code>PostIndexed</code> and <code>PreIndexed</code> mean?</p>
</blockquote>



<a name="193712523"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193712523" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193712523">(Apr 12 2020 at 13:07)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407190070" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407190070">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>    /// Get the offset as a 19-bit offset, or `None` if overflow.
</pre></div>


</blockquote>



<a name="193712524"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193712524" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193712524">(Apr 12 2020 at 13:07)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407190131" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407190131">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>                let n = block_index_map[usize::try_from(*bix).unwrap()];
</pre></div>


</blockquote>



<a name="193712525"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193712525" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193712525">(Apr 12 2020 at 13:07)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407190985" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407190985">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>                        //// RRR ops.
</pre></div>


<p>Typo?</p>
</blockquote>



<a name="193712526"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193712526" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193712526">(Apr 12 2020 at 13:07)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407190485" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407190485">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>    let data = bits.to_le_bytes();
</pre></div>


<p>This is little endian, right?</p>
</blockquote>



<a name="193712527"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193712527" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193712527">(Apr 12 2020 at 13:07)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407190232" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407190232">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>        _ =&gt; panic!(&quot;unknown type {}&quot;, ty),
</pre></div>


</blockquote>



<a name="193712528"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193712528" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193712528">(Apr 12 2020 at 13:07)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407190736" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407190736">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>    (u32::from(bits_31_21) &lt;&lt; 21)
        | (u32::from(bits_15_10) &lt;&lt; 10)
</pre></div>


</blockquote>



<a name="193712529"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193712529" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193712529">(Apr 12 2020 at 13:07)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407189657" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407189657">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>                let bix = usize::try_from(bix).unwrap();
</pre></div>


<p>The unwrap will never fire, as <code>bix</code> is a <code>u32</code> and Cranelift likely doesn't work on 16 bit machines.</p>
</blockquote>



<a name="193712530"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193712530" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193712530">(Apr 12 2020 at 13:07)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407190580" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407190580">PR Review Comment</a>:</p>
<blockquote>
<p>Does <code>to_real_reg()</code> contain the <code>is_real()</code> assertion?</p>
</blockquote>



<a name="193712531"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193712531" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193712531">(Apr 12 2020 at 13:07)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407193006" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407193006">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>    /// signed saturating add
    SQAddScalar,
    /// unsigned saturating add
    UQAddScalar,
    /// signed saturating subtract
    SQSubScalar,
    /// unsigned saturating subtract
    UQSubScalar,
</pre></div>


</blockquote>



<a name="193712532"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193712532" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193712532">(Apr 12 2020 at 13:07)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407190967" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407190967">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>                        panic!(&quot;Bad ALUOp {:?} in RRR form!&quot;, alu_op);
</pre></div>


</blockquote>



<a name="193712533"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193712533" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193712533">(Apr 12 2020 at 13:07)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407192710" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407192710">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>    /// Multiply add
    MAdd32,
    /// Multiply add
    MAdd64,
    /// Multiply sub
    MSub32,
    /// Multiply sub
    MSub64,
</pre></div>


</blockquote>



<a name="193712534"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193712534" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193712534">(Apr 12 2020 at 13:07)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407192413" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407192413">PR Review Comment</a>:</p>
<blockquote>
<p><code>value</code> is shifted to the right not left to form <code>bits</code>.</p>
</blockquote>



<a name="193712535"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193712535" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193712535">(Apr 12 2020 at 13:07)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407193595" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407193595">PR Review Comment</a>:</p>
<blockquote>
<p>This is attached only to <code>FpuLoad32</code>.</p>
</blockquote>



<a name="193712536"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193712536" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193712536">(Apr 12 2020 at 13:07)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407193663" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407193663">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>    Ret,
</pre></div>


</blockquote>



<a name="193712537"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193712537" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193712537">(Apr 12 2020 at 13:07)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407191873" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407191873">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>        ((self.N as u16) &lt;&lt; 12) | (u16::from(self.R) &lt;&lt; 6) | u16::from(self.S)
</pre></div>


</blockquote>



<a name="193712538"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193712538" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193712538">(Apr 12 2020 at 13:07)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407193611" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407193611">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>    /// Round to integer.
</pre></div>


</blockquote>



<a name="193712539"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193712539" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193712539">(Apr 12 2020 at 13:07)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407193242" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407193242">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>    /// Bit reverse
    RBit32,
    /// Bit reverse
    RBit64,
</pre></div>


</blockquote>



<a name="193712540"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193712540" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193712540">(Apr 12 2020 at 13:07)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407190654" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407190654">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>    u32::from(m.to_real_reg().get_hw_encoding())
</pre></div>


<p>I assume <code>get_hw_encoding</code> returns a integer type smaller than <code>u32</code>.</p>
</blockquote>



<a name="193712541"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193712541" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193712541">(Apr 12 2020 at 13:07)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407193768" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407193768">PR Review Comment</a>:</p>
<blockquote>
<p><code>count_zero_half_words</code>?</p>
</blockquote>



<a name="193712542"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193712542" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193712542">(Apr 12 2020 at 13:07)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407194920" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407194920">PR Review Comment</a>:</p>
<blockquote>
<p>Does AArch64 have native 128bit integer operations? Otherwise these should be legalized to 64bit integer operations and the <code>I128</code> and <code>B128</code> types should have no register class assigned to them.</p>
</blockquote>



<a name="193712543"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193712543" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193712543">(Apr 12 2020 at 13:07)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407192807" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407192807">PR Review Comment</a>:</p>
<blockquote>
<p>What does the <code>H</code> mean?</p>
</blockquote>



<a name="193712544"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193712544" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193712544">(Apr 12 2020 at 13:07)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407192753" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407192753">PR Review Comment</a>:</p>
<blockquote>
<p>Is this the arm name for XOR?</p>
</blockquote>



<a name="193712545"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193712545" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193712545">(Apr 12 2020 at 13:07)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407193694" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407193694">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>    EpiloguePlaceholder,
</pre></div>


</blockquote>



<a name="193712546"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193712546" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193712546">(Apr 12 2020 at 13:07)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407194479" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407194479">PR Review Comment</a>:</p>
<blockquote>
<p>Maybe do something like </p>
<div class="codehilite"><pre><span></span>    match inst {
        Inst::AluRRR { alu_op: _, rd, rn, rm } =&gt; {
            map_wr(d, rd);
            map(u, rn);
            map(u, rm);
        }
</pre></div>


<p>and let the map functions take the register by mutable reference?</p>
</blockquote>



<a name="193712547"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193712547" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193712547">(Apr 12 2020 at 13:07)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407195438" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407195438">PR Review Comment</a>:</p>
<blockquote>
<p>Who came up with this order? It is even worse than <code>eax</code>, <code>ecx</code>, <code>edx</code>, <code>ebx</code> on x86.</p>
</blockquote>



<a name="193712548"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193712548" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193712548">(Apr 12 2020 at 13:07)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407193363" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407193363">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>    Nop0,
</pre></div>


</blockquote>



<a name="193712549"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193712549" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193712549">(Apr 12 2020 at 13:07)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407193304" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407193304">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>            BitOp::RBit32 | BitOp::Clz32 | BitOp::Cls32 =&gt; true,
            BitOp::RBit64 | BitOp::Clz64 | BitOp::Cls64 =&gt; false,
</pre></div>


</blockquote>



<a name="193712550"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193712550" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193712550">(Apr 12 2020 at 13:07)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407191578" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407191578">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>        let scale = i64::from(scale);
</pre></div>


</blockquote>



<a name="193762318"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193762318" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193762318">(Apr 13 2020 at 11:09)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392086522" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392086522">PR Review</a>.</p>



<a name="193762319"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193762319" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193762319">(Apr 13 2020 at 11:09)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407430683" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407430683">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>                &amp;InstructionData::UnaryIeee32 { opcode: _, imm } =&gt; Some(u64::from(imm.bits())),
</pre></div>


</blockquote>



<a name="193770196"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193770196" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193770196">(Apr 13 2020 at 13:09)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392087287" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392087287">PR Review</a>.</p>



<a name="193770197"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193770197" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193770197">(Apr 13 2020 at 13:09)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392087287" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392087287">PR Review</a>.</p>



<a name="193770198"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193770198" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193770198">(Apr 13 2020 at 13:09)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407438118" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407438118">PR Review Comment</a>:</p>
<blockquote>
<p>This is only implemented for <code>Lower</code>. Why not just pass <code>Lower</code> everywhere?</p>
</blockquote>



<a name="193770199"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193770199" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193770199">(Apr 13 2020 at 13:09)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407431821" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407431821">PR Review Comment</a>:</p>
<blockquote>
<p>What about <code>narrow_mode == NarrowValueMode::None &amp;&amp; out_bits &lt; 64</code>?</p>
</blockquote>



<a name="193770200"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193770200" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193770200">(Apr 13 2020 at 13:09)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407439153" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407439153">PR Review Comment</a>:</p>
<blockquote>
<p>The domtree already knows this.</p>
</blockquote>



<a name="193770201"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193770201" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193770201">(Apr 13 2020 at 13:09)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407439320" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407439320">PR Review Comment</a>:</p>
<blockquote>
<p>A function without entry block is not allowed, right?</p>
</blockquote>



<a name="193770202"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193770202" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193770202">(Apr 13 2020 at 13:09)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407431300" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407431300">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>        (NarrowValueMode::ZeroExtend64, 64) | (NarrowValueMode::SignExtend64, 64) =&gt; in_reg,
</pre></div>


</blockquote>



<a name="193770203"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193770203" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193770203">(Apr 13 2020 at 13:09)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407431395" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407431395">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>        (NarrowValueMode::ZeroExtend32, 32) | (NarrowValueMode::SignExtend32, 32) =&gt; {
</pre></div>


</blockquote>



<a name="193770204"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193770204" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193770204">(Apr 13 2020 at 13:09)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407439690" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407439690">PR Review Comment</a>:</p>
<blockquote>
<p>You can use <code>bbs.iter().rev()</code> below instead to prevent moving everything around.</p>
</blockquote>



<a name="193770205"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193770205" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193770205">(Apr 13 2020 at 13:09)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407439820" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407439820">PR Review Comment</a>:</p>
<blockquote>
<p>What does cf-inst mean?</p>
</blockquote>



<a name="193770206"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193770206" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193770206">(Apr 13 2020 at 13:09)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407468251" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407468251">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>        for &amp;block in &amp;self.final_block_order {
</pre></div>


</blockquote>



<a name="193770207"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193770207" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193770207">(Apr 13 2020 at 13:09)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407466058" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407466058">PR Review Comment</a>:</p>
<blockquote>
<p>Maybe inline this at the two use sites to prevent a possible allocation of a temporary vec?</p>
</blockquote>



<a name="193770208"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193770208" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193770208">(Apr 13 2020 at 13:09)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407469277" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407469277">PR Review Comment</a>:</p>
<blockquote>
<p>What if nops are always say 4 bytes, but there needs to be a 3 byte offset to align to the required 4 bytes. That would mean <code>I::gen_nop</code> will always need to return a 0 byte nop, which means that the loop will never terminate.</p>
</blockquote>



<a name="193770209"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193770209" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193770209">(Apr 13 2020 at 13:09)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407466281" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407466281">PR Review Comment</a>:</p>
<blockquote>
<p>Also I think 16 elements is more than likely will be used most of the cases.</p>
</blockquote>



<a name="193770210"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193770210" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193770210">(Apr 13 2020 at 13:09)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407465531" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407465531">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>                for &amp;dest in f.jump_tables[table].as_slice() {
                    ret.push(dest);
</pre></div>


</blockquote>



<a name="193772909"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193772909" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193772909">(Apr 13 2020 at 13:44)</a>:</h4>
<p>sunfishcode submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391596985" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391596985">PR Review</a>.</p>



<a name="193772910"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193772910" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193772910">(Apr 13 2020 at 13:44)</a>:</h4>
<p>sunfishcode submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391596985" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-391596985">PR Review</a>.</p>



<a name="193772913"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193772913" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193772913">(Apr 13 2020 at 13:44)</a>:</h4>
<p>sunfishcode created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406888359" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406888359">PR Review Comment</a>:</p>
<blockquote>
<p>Is the logic to do DCE the fly required for correctness of the algorithm, or is it just an optimization? If the latter, can you comment on the tradeoffs of doing an eager num_uses pass and DCE on the fly vs just doing a separate DCE pass afterwards?</p>
</blockquote>



<a name="193772914"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193772914" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193772914">(Apr 13 2020 at 13:44)</a>:</h4>
<p>sunfishcode created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406889301" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r406889301">PR Review Comment</a>:</p>
<blockquote>
<p>Is this using reverse postorder (of a DFS)? Can you comment on the differences with <code>domtree.cfg_postorder()</code>?</p>
</blockquote>



<a name="193772915"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193772915" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193772915">(Apr 13 2020 at 13:44)</a>:</h4>
<p>sunfishcode created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407477693" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407477693">PR Review Comment</a>:</p>
<blockquote>
<p>Could you remove these few remaining <code>unused_imports</code> directives in a few files?</p>
</blockquote>



<a name="193772916"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193772916" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193772916">(Apr 13 2020 at 13:44)</a>:</h4>
<p>sunfishcode created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407481016" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407481016">PR Review Comment</a>:</p>
<blockquote>
<p>Minor nit: use a <code>//</code>-style comment here.</p>
</blockquote>



<a name="193772918"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193772918" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193772918">(Apr 13 2020 at 13:44)</a>:</h4>
<p>sunfishcode created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407480663" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407480663">PR Review Comment</a>:</p>
<blockquote>
<p>Several files have <code>allow(non_snake_case)</code> and <code>allow(non_camel_case_types)</code>. Could you either remove these and change the names to follow the regular Rust conventions, or add comments explaining why exceptions to the rules are justified in these files?</p>
</blockquote>



<a name="193772919"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193772919" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193772919">(Apr 13 2020 at 13:44)</a>:</h4>
<p>sunfishcode created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407483671" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407483671">PR Review Comment</a>:</p>
<blockquote>
<p>There are a lot of <code>is32</code> parameters being passed around in a lot of code. Would it be worth adding a dedicated enum type to use in place of bool, to catch errors and make the code more self-documenting?</p>
</blockquote>



<a name="193775438"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193775438" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193775438">(Apr 13 2020 at 14:10)</a>:</h4>
<p>sunfishcode submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392167704" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392167704">PR Review</a>.</p>



<a name="193775440"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193775440" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193775440">(Apr 13 2020 at 14:10)</a>:</h4>
<p>sunfishcode created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407497590" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407497590">PR Review Comment</a>:</p>
<blockquote>
<p>The flags verifier can still check target-independent properties -- the <code>encinfo</code> is an <code>Option</code> to allow it to run without this information, so I think we can still enable the verifier, just by passing <code>None</code> for the <code>encinfo</code> argument when the mach backend is enabled.</p>
</blockquote>



<a name="193818687"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193818687" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193818687">(Apr 13 2020 at 20:40)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392423191" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392423191">PR Review</a>.</p>



<a name="193818688"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193818688" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193818688">(Apr 13 2020 at 20:40)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407707688" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407707688">PR Review Comment</a>:</p>
<blockquote>
<p>That seems like quite a bit of overhead, and potentially fragile and complex code to maintain (a new "probestack" ABI to implement on ARM64, a codegen step at startup, a way to lazily initialize the <code>PROBESTACK</code> global, etc.) for a theoretical concern that does not actually occur in practice. I'll defer to @sunfishcode 's judgment here, but my inclination is to leave it as-is.</p>
</blockquote>



<a name="193820138"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193820138" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193820138">(Apr 13 2020 at 20:55)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1494" title="https://github.com/bytecodealliance/wasmtime/pull/1494">PR #1494</a> from <code>arm64-merge</code> to <code>master</code>:</p>
<blockquote>
<p>This PR contributes a new backend framework built around <code>MachInst</code>s (machine instructions) contained in <code>VCode</code> (virtual-registerized code) containers. Furthermore, it contains a working ARM64 backend built in this new framework. The new framework is properly connected into the main Cranelift compilation pipeline, and the appropriate integrations have been made so that <code>wasmtime</code> can run basic Wasm tests correctly on ARM64 hardware.</p>
<p>This patch sequence contains code written by Julian Seward &lt;<a href="mailto:jseward@acm.org" title="mailto:jseward@acm.org">jseward@acm.org</a>&gt; and Benjamin Bouvier &lt;<a href="mailto:public@benj.me" title="mailto:public@benj.me">public@benj.me</a>&gt;, originally developed on a side-branch before rebasing and condensing into this patch series. See the <code>arm64</code> branch at <code>https://github.com/cfallin/wasmtime</code> for original development history.</p>
<p>This patch also contains code written by Joey Gouly &lt;<a href="mailto:joey.gouly@arm.com" title="mailto:joey.gouly@arm.com">joey.gouly@arm.com</a>&gt; and contributed to the above branch. These contributions are "Copyright (c) 2020, Arm Limited."</p>
<p>Closes #1174 and #1075.</p>
</blockquote>



<a name="193820149"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193820149" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193820149">(Apr 13 2020 at 20:55)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392432544" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392432544">PR Review</a>.</p>



<a name="193820150"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193820150" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193820150">(Apr 13 2020 at 20:55)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407715549" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407715549">PR Review Comment</a>:</p>
<blockquote>
<p>Ah, yes, that makes sense -- done!</p>
</blockquote>



<a name="193820388"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193820388" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193820388">(Apr 13 2020 at 20:57)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392434128" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392434128">PR Review</a>.</p>



<a name="193820389"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193820389" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193820389">(Apr 13 2020 at 20:57)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407716766" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407716766">PR Review Comment</a>:</p>
<blockquote>
<p>The new backend takes a different approach. We want to get away from the DSL-based pattern/legalization/recipe world and write the backends in a more explicit way. This should lead to more simplicity and maintainability (one of the main motivations of the new backend design). E.g., in the ARM64 backend, we handle different operand widths explicitly. It still makes sense to do some expansions with the existing code, such as for <code>heap_addr</code> or <code>global_value</code>, which is where <code>simple_legalize()</code> comes in.</p>
</blockquote>



<a name="193820609"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193820609" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193820609">(Apr 13 2020 at 20:59)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392435606" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392435606">PR Review</a>.</p>



<a name="193820610"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193820610" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193820610">(Apr 13 2020 at 20:59)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407717997" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407717997">PR Review Comment</a>:</p>
<blockquote>
<p>Yeah, actually, probably better to remove the partial impl of <code>RetMem</code> until we actually need it. Thanks.</p>
</blockquote>



<a name="193820990"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193820990" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193820990">(Apr 13 2020 at 21:02)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392436975" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392436975">PR Review</a>.</p>



<a name="193820991"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193820991" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193820991">(Apr 13 2020 at 21:02)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407719163" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407719163">PR Review Comment</a>:</p>
<blockquote>
<p>@bnjbvr would be the person to answer this (this is his SpiderMonkey-integration code); Ben, comments?</p>
</blockquote>



<a name="193821384"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193821384" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193821384">(Apr 13 2020 at 21:05)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392439264" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392439264">PR Review</a>.</p>



<a name="193821385"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193821385" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193821385">(Apr 13 2020 at 21:05)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407721033" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407721033">PR Review Comment</a>:</p>
<blockquote>
<p>Done; added check to toplevel <code>new()</code> instead.</p>
</blockquote>



<a name="193821454"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193821454" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193821454">(Apr 13 2020 at 21:06)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392439436" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392439436">PR Review</a>.</p>



<a name="193821456"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193821456" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193821456">(Apr 13 2020 at 21:06)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407721165" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407721165">PR Review Comment</a>:</p>
<blockquote>
<p>Added check to toplevel <code>new()</code>.</p>
</blockquote>



<a name="193821467"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193821467" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193821467">(Apr 13 2020 at 21:06)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392439664" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392439664">PR Review</a>.</p>



<a name="193821468"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193821468" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193821468">(Apr 13 2020 at 21:06)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407721336" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407721336">PR Review Comment</a>:</p>
<blockquote>
<p>Many legalizations are shared between backends. Also legalizations may enable optimizations that would otherwise have to be rewritten for each backend.</p>
</blockquote>



<a name="193822203"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193822203" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193822203">(Apr 13 2020 at 21:13)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392444228" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392444228">PR Review</a>.</p>



<a name="193822204"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193822204" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193822204">(Apr 13 2020 at 21:13)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407725028" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407725028">PR Review Comment</a>:</p>
<blockquote>
<p>Will use <code>u32</code>, actually; we don't expect a stackframe to be larger than 4GB.</p>
</blockquote>



<a name="193822294"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193822294" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193822294">(Apr 13 2020 at 21:14)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1494" title="https://github.com/bytecodealliance/wasmtime/pull/1494">PR #1494</a> from <code>arm64-merge</code> to <code>master</code>:</p>
<blockquote>
<p>This PR contributes a new backend framework built around <code>MachInst</code>s (machine instructions) contained in <code>VCode</code> (virtual-registerized code) containers. Furthermore, it contains a working ARM64 backend built in this new framework. The new framework is properly connected into the main Cranelift compilation pipeline, and the appropriate integrations have been made so that <code>wasmtime</code> can run basic Wasm tests correctly on ARM64 hardware.</p>
<p>This patch sequence contains code written by Julian Seward &lt;<a href="mailto:jseward@acm.org" title="mailto:jseward@acm.org">jseward@acm.org</a>&gt; and Benjamin Bouvier &lt;<a href="mailto:public@benj.me" title="mailto:public@benj.me">public@benj.me</a>&gt;, originally developed on a side-branch before rebasing and condensing into this patch series. See the <code>arm64</code> branch at <code>https://github.com/cfallin/wasmtime</code> for original development history.</p>
<p>This patch also contains code written by Joey Gouly &lt;<a href="mailto:joey.gouly@arm.com" title="mailto:joey.gouly@arm.com">joey.gouly@arm.com</a>&gt; and contributed to the above branch. These contributions are "Copyright (c) 2020, Arm Limited."</p>
<p>Closes #1174 and #1075.</p>
</blockquote>



<a name="193822394"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193822394" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193822394">(Apr 13 2020 at 21:15)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392445447" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392445447">PR Review</a>.</p>



<a name="193822396"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193822396" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193822396">(Apr 13 2020 at 21:15)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407726061" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407726061">PR Review Comment</a>:</p>
<blockquote>
<p>Any particular reason (and if so, why not throughout the entire codebase for every <code>as</code> cast)?</p>
</blockquote>



<a name="193822711"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193822711" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193822711">(Apr 13 2020 at 21:18)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392447283" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392447283">PR Review</a>.</p>



<a name="193822712"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193822712" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193822712">(Apr 13 2020 at 21:18)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407727551" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407727551">PR Review Comment</a>:</p>
<blockquote>
<p>Just added to <code>emit.rs</code>, thanks.</p>
</blockquote>



<a name="193822896"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193822896" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193822896">(Apr 13 2020 at 21:20)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392448267" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392448267">PR Review</a>.</p>



<a name="193822897"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193822897" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193822897">(Apr 13 2020 at 21:20)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407728370" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407728370">PR Review Comment</a>:</p>
<blockquote>
<p>This prevents accidential truncation of integers.</p>
</blockquote>



<a name="193823071"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193823071" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193823071">(Apr 13 2020 at 21:22)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392449422" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392449422">PR Review</a>.</p>



<a name="193823073"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193823073" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193823073">(Apr 13 2020 at 21:22)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407729303" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407729303">PR Review Comment</a>:</p>
<blockquote>
<p>Using <code>u32</code> in stack-frame layout code instead; as above, we don't expect &gt;4GB frames.</p>
</blockquote>



<a name="193823862"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193823862" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193823862">(Apr 13 2020 at 21:30)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392454163" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392454163">PR Review</a>.</p>



<a name="193823863"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193823863" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193823863">(Apr 13 2020 at 21:30)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407733271" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407733271">PR Review Comment</a>:</p>
<blockquote>
<p>Ah, yes, this was left over from an earlier version that used a different mode; removed redundant case.</p>
</blockquote>



<a name="193824327"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193824327" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193824327">(Apr 13 2020 at 21:35)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392456677" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392456677">PR Review</a>.</p>



<a name="193824328"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193824328" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193824328">(Apr 13 2020 at 21:35)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407735348" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407735348">PR Review Comment</a>:</p>
<blockquote>
<p>Eh, perhaps it's just a style thing, but I don't like these casts that require trait imports and this <code>unwrap()</code>; it complexifies the code for no good reason, and makes it harder to audit the code for potentially panic'ing operations.</p>
<p>In fact, the <code>bix as usize</code> does one better if we do ever try to build on a 16-bit host: it will statically fail to compile, because <code>u32 as u16</code> is not a valid cast. I'd prefer that over an <code>unwrap()</code> that fires at runtime.</p>
</blockquote>



<a name="193824487"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193824487" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193824487">(Apr 13 2020 at 21:36)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392457374" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392457374">PR Review</a>.</p>



<a name="193824488"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193824488" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193824488">(Apr 13 2020 at 21:36)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407735922" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407735922">PR Review Comment</a>:</p>
<blockquote>
<p>Not making this change for same reason as above; would prefer a static compilation failure to a dynamic panic.</p>
</blockquote>



<a name="193824707"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193824707" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193824707">(Apr 13 2020 at 21:38)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392458472" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392458472">PR Review</a>.</p>



<a name="193824708"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193824708" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193824708">(Apr 13 2020 at 21:38)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407736881" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407736881">PR Review Comment</a>:</p>
<blockquote>
<p><code>u32 as u16</code> is actually valid. It truncates.</p>
</blockquote>



<a name="193825230"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193825230" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193825230">(Apr 13 2020 at 21:43)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392461201" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392461201">PR Review</a>.</p>



<a name="193825232"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193825232" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193825232">(Apr 13 2020 at 21:43)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407739162" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407739162">PR Review Comment</a>:</p>
<blockquote>
<p>No, this one is intentional; the RRRR ops are the 3-source, 1-dest ops.</p>
</blockquote>



<a name="193825388"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193825388" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193825388">(Apr 13 2020 at 21:45)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392461990" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392461990">PR Review</a>.</p>



<a name="193825389"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193825389" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193825389">(Apr 13 2020 at 21:45)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407739811" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407739811">PR Review Comment</a>:</p>
<blockquote>
<p>Holding off on this for now, as above. I'm curious if there's an idiomatic-Rust reason for this -- is there some downside to using the <code>x as T</code> operator built into the language?</p>
</blockquote>



<a name="193825525"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193825525" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193825525">(Apr 13 2020 at 21:46)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392462793" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392462793">PR Review</a>.</p>



<a name="193825526"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193825526" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193825526">(Apr 13 2020 at 21:46)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407740495" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407740495">PR Review Comment</a>:</p>
<blockquote>
<p>Ambiguous subject, I suppose; the result is <code>bits</code> shifted to the left. Edited to clarify.</p>
</blockquote>



<a name="193825789"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193825789" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193825789">(Apr 13 2020 at 21:49)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392464075" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392464075">PR Review</a>.</p>



<a name="193825790"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193825790" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193825790">(Apr 13 2020 at 21:49)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407741616" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407741616">PR Review Comment</a>:</p>
<blockquote>
<p>Yep, it's an ARM-ism. In general we tried to maintain consistent naming w.r.t. the instruction manual unless there was a good reason otherwise. Added a doc comment to clarify.</p>
</blockquote>



<a name="193825849"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193825849" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193825849">(Apr 13 2020 at 21:49)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392464455" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392464455">PR Review</a>.</p>



<a name="193825850"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193825850" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193825850">(Apr 13 2020 at 21:49)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407741835" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407741835">PR Review Comment</a>:</p>
<blockquote>
<p>High word result of multiply (e.g., bits 127-64 for the i64 case), either signed or unsigned variant. Added doc comment.</p>
</blockquote>



<a name="193826527"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193826527" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193826527">(Apr 13 2020 at 21:56)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1494" title="https://github.com/bytecodealliance/wasmtime/pull/1494">PR #1494</a> from <code>arm64-merge</code> to <code>master</code>:</p>
<blockquote>
<p>This PR contributes a new backend framework built around <code>MachInst</code>s (machine instructions) contained in <code>VCode</code> (virtual-registerized code) containers. Furthermore, it contains a working ARM64 backend built in this new framework. The new framework is properly connected into the main Cranelift compilation pipeline, and the appropriate integrations have been made so that <code>wasmtime</code> can run basic Wasm tests correctly on ARM64 hardware.</p>
<p>This patch sequence contains code written by Julian Seward &lt;<a href="mailto:jseward@acm.org" title="mailto:jseward@acm.org">jseward@acm.org</a>&gt; and Benjamin Bouvier &lt;<a href="mailto:public@benj.me" title="mailto:public@benj.me">public@benj.me</a>&gt;, originally developed on a side-branch before rebasing and condensing into this patch series. See the <code>arm64</code> branch at <code>https://github.com/cfallin/wasmtime</code> for original development history.</p>
<p>This patch also contains code written by Joey Gouly &lt;<a href="mailto:joey.gouly@arm.com" title="mailto:joey.gouly@arm.com">joey.gouly@arm.com</a>&gt; and contributed to the above branch. These contributions are "Copyright (c) 2020, Arm Limited."</p>
<p>Closes #1174 and #1075.</p>
</blockquote>



<a name="193827064"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193827064" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193827064">(Apr 13 2020 at 22:02)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392470911" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392470911">PR Review</a>.</p>



<a name="193827066"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193827066" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193827066">(Apr 13 2020 at 22:02)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407747069" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407747069">PR Review Comment</a>:</p>
<blockquote>
<p>Removed. I'm not sure if NEON has a plain 128-bit load or not, but we plan to handle vector ops after our initial merge and evaluation, so I'll defer the proper implementation of this to later.</p>
</blockquote>



<a name="193827084"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193827084" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193827084">(Apr 13 2020 at 22:02)</a>:</h4>
<p>cfallin edited <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407747069" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407747069">PR Review Comment</a>.</p>



<a name="193827158"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193827158" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193827158">(Apr 13 2020 at 22:03)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392471500" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392471500">PR Review</a>.</p>



<a name="193827159"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193827159" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193827159">(Apr 13 2020 at 22:03)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407747554" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407747554">PR Review Comment</a>:</p>
<blockquote>
<p>I am glad we could provide some entertainment :-) It's actually intentional: the register allocator library (<a href="http://regalloc.rs" title="http://regalloc.rs">regalloc.rs</a>) expects all allocatable registers in a contiguous index range. Because the ABI and codegen constraints poke random holes in this range, the mapping has to be a piecewise-linear thing. It's ugly, but it works...</p>
</blockquote>



<a name="193827352"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193827352" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193827352">(Apr 13 2020 at 22:05)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392472371" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392472371">PR Review</a>.</p>



<a name="193827353"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193827353" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193827353">(Apr 13 2020 at 22:05)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407748293" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407748293">PR Review Comment</a>:</p>
<blockquote>
<p>Ah! I had been under the impression that it was a type error to cast to narrower integers. I'll go back and audit these now.</p>
</blockquote>



<a name="193827903"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193827903" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193827903">(Apr 13 2020 at 22:11)</a>:</h4>
<p>sunfishcode submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392474870" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392474870">PR Review</a>.</p>



<a name="193827905"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193827905" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193827905">(Apr 13 2020 at 22:11)</a>:</h4>
<p>sunfishcode created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407750398" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407750398">PR Review Comment</a>:</p>
<blockquote>
<p>As it turns out, @alexcrichton's <a href="https://github.com/bytecodealliance/wasmtime/pull/1490" title="https://github.com/bytecodealliance/wasmtime/pull/1490">https://github.com/bytecodealliance/wasmtime/pull/1490</a> will eliminate the need for this call entirely, which avoids this question entirely.</p>
<p>Beyond that, if we want to reintroduce stack probes, we should add a <code>__rust_probestack</code> for AArch64 and any other platform we need it on <a href="https://github.com/rust-lang/compiler-builtins/blob/master/src/probestack.rs" title="https://github.com/rust-lang/compiler-builtins/blob/master/src/probestack.rs">here</a> rather than having our own version in Cranelift.</p>
</blockquote>



<a name="193828024"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193828024" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193828024">(Apr 13 2020 at 22:12)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392475267" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392475267">PR Review</a>.</p>



<a name="193828025"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193828025" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193828025">(Apr 13 2020 at 22:12)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407750722" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407750722">PR Review Comment</a>:</p>
<blockquote>
<p>OK -- we can incorporate legalizations as required, then, into the new pipeline, I think. The issue with the original request that I see is that "when there is no encoding" is no longer meaningful: we are no longer taking the approach of directly mapping CLIF instructions to hardware encodings and editing in place otherwise. Pulling in some of the existing legalizations here is meant to be an intermediate state, in place until we transition fully to the new backend and then can rewrite the expansions as a more straightforward pass. @sunfishcode and I have talked about various ways of having a "pattern-matching" approach to this.</p>
</blockquote>



<a name="193828254"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193828254" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193828254">(Apr 13 2020 at 22:14)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392476244" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392476244">PR Review</a>.</p>



<a name="193828255"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193828255" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193828255">(Apr 13 2020 at 22:14)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407751635" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407751635">PR Review Comment</a>:</p>
<blockquote>
<p>(But in this particular case, we're casting from <code>u32</code> to <code>i64</code>, so truncation should be an issue.)</p>
</blockquote>



<a name="193828463"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193828463" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193828463">(Apr 13 2020 at 22:16)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392477061" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392477061">PR Review</a>.</p>



<a name="193828464"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193828464" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193828464">(Apr 13 2020 at 22:16)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407752295" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407752295">PR Review Comment</a>:</p>
<blockquote>
<p>Yup, just realized this -- thanks!</p>
</blockquote>



<a name="193828540"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193828540" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193828540">(Apr 13 2020 at 22:17)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392477537" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392477537">PR Review</a>.</p>



<a name="193828541"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193828541" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193828541">(Apr 13 2020 at 22:17)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407752673" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407752673">PR Review Comment</a>:</p>
<blockquote>
<p>(Actually making this change now, as per realization above.)</p>
</blockquote>



<a name="193830188"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193830188" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193830188">(Apr 13 2020 at 22:34)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392484765" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392484765">PR Review</a>.</p>



<a name="193830189"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193830189" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193830189">(Apr 13 2020 at 22:34)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407758891" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407758891">PR Review Comment</a>:</p>
<blockquote>
<p>Updated now; thanks for the education on Rust casts!</p>
</blockquote>



<a name="193830261"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193830261" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193830261">(Apr 13 2020 at 22:35)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1494" title="https://github.com/bytecodealliance/wasmtime/pull/1494">PR #1494</a> from <code>arm64-merge</code> to <code>master</code>:</p>
<blockquote>
<p>This PR contributes a new backend framework built around <code>MachInst</code>s (machine instructions) contained in <code>VCode</code> (virtual-registerized code) containers. Furthermore, it contains a working ARM64 backend built in this new framework. The new framework is properly connected into the main Cranelift compilation pipeline, and the appropriate integrations have been made so that <code>wasmtime</code> can run basic Wasm tests correctly on ARM64 hardware.</p>
<p>This patch sequence contains code written by Julian Seward &lt;<a href="mailto:jseward@acm.org" title="mailto:jseward@acm.org">jseward@acm.org</a>&gt; and Benjamin Bouvier &lt;<a href="mailto:public@benj.me" title="mailto:public@benj.me">public@benj.me</a>&gt;, originally developed on a side-branch before rebasing and condensing into this patch series. See the <code>arm64</code> branch at <code>https://github.com/cfallin/wasmtime</code> for original development history.</p>
<p>This patch also contains code written by Joey Gouly &lt;<a href="mailto:joey.gouly@arm.com" title="mailto:joey.gouly@arm.com">joey.gouly@arm.com</a>&gt; and contributed to the above branch. These contributions are "Copyright (c) 2020, Arm Limited."</p>
<p>Closes #1174 and #1075.</p>
</blockquote>



<a name="193832753"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193832753" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193832753">(Apr 13 2020 at 23:05)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1494" title="https://github.com/bytecodealliance/wasmtime/pull/1494">PR #1494</a> from <code>arm64-merge</code> to <code>master</code>:</p>
<blockquote>
<p>This PR contributes a new backend framework built around <code>MachInst</code>s (machine instructions) contained in <code>VCode</code> (virtual-registerized code) containers. Furthermore, it contains a working ARM64 backend built in this new framework. The new framework is properly connected into the main Cranelift compilation pipeline, and the appropriate integrations have been made so that <code>wasmtime</code> can run basic Wasm tests correctly on ARM64 hardware.</p>
<p>This patch sequence contains code written by Julian Seward &lt;<a href="mailto:jseward@acm.org" title="mailto:jseward@acm.org">jseward@acm.org</a>&gt; and Benjamin Bouvier &lt;<a href="mailto:public@benj.me" title="mailto:public@benj.me">public@benj.me</a>&gt;, originally developed on a side-branch before rebasing and condensing into this patch series. See the <code>arm64</code> branch at <code>https://github.com/cfallin/wasmtime</code> for original development history.</p>
<p>This patch also contains code written by Joey Gouly &lt;<a href="mailto:joey.gouly@arm.com" title="mailto:joey.gouly@arm.com">joey.gouly@arm.com</a>&gt; and contributed to the above branch. These contributions are "Copyright (c) 2020, Arm Limited."</p>
<p>Closes #1174 and #1075.</p>
</blockquote>



<a name="193832944"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193832944" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193832944">(Apr 13 2020 at 23:07)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392497799" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392497799">PR Review</a>.</p>



<a name="193832945"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193832945" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193832945">(Apr 13 2020 at 23:07)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407770226" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407770226">PR Review Comment</a>:</p>
<blockquote>
<p>Unreachable because of surrounding conditional's <code>narrow_mode != NarrowValueMode::None</code>.</p>
</blockquote>



<a name="193833140"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193833140" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193833140">(Apr 13 2020 at 23:09)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392498417" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392498417">PR Review</a>.</p>



<a name="193833141"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193833141" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193833141">(Apr 13 2020 at 23:09)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407770799" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407770799">PR Review Comment</a>:</p>
<blockquote>
<p>The intention is to also eventually have other <code>Lower</code> impls. For one, there has been some conversation about verification efforts that plug in a different impl to get symbolic lowerings out (this is very handwavy now, but we want to leave the door open). For another, we might eventually want to drive the lowering logic with a different IR, and so we're trying to keep as much behind this API as possible (it's not perfect, e.g. <code>Opcode</code> type, but this will help with that goal). Everything is monomorphized, so the only cost now should be a little extra type verbosity.</p>
</blockquote>



<a name="193833318"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193833318" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193833318">(Apr 13 2020 at 23:11)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392499075" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392499075">PR Review</a>.</p>



<a name="193833319"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193833319" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193833319">(Apr 13 2020 at 23:11)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407771364" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407771364">PR Review Comment</a>:</p>
<blockquote>
<p>We didn't want to rely on the domtree here, for the same reason as above (portability); though perhaps a followup PR could plumb the domtree info through the <code>LowerCtx</code>.</p>
</blockquote>



<a name="193833492"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193833492" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193833492">(Apr 13 2020 at 23:12)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392499694" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392499694">PR Review</a>.</p>



<a name="193833493"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193833493" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193833493">(Apr 13 2020 at 23:12)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407771871" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407771871">PR Review Comment</a>:</p>
<blockquote>
<p>It might trigger errors elsewhere, but I had wanted to provide a robust impl here; the code should still do the right thing (i.e., nothing) when presented with an empty function body.</p>
</blockquote>



<a name="193833522"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193833522" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193833522">(Apr 13 2020 at 23:13)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392499852" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392499852">PR Review</a>.</p>



<a name="193833523"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193833523" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193833523">(Apr 13 2020 at 23:13)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407772013" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407772013">PR Review Comment</a>:</p>
<blockquote>
<p>Control-flow instruction; expanded.</p>
</blockquote>



<a name="193833706"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193833706" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193833706">(Apr 13 2020 at 23:15)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392500634" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392500634">PR Review</a>.</p>



<a name="193833707"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193833707" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193833707">(Apr 13 2020 at 23:15)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407772680" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407772680">PR Review Comment</a>:</p>
<blockquote>
<p>At first I had thought this wouldn't work, because we initialize the vcode BB map with <code>bbs</code> just below this; but it turns out that that code is invariant to the block order (we'll just get different <code>BlockIndex</code>es in the vcode, but this is arbitrary anyway). So, done!</p>
</blockquote>



<a name="193833963"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193833963" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193833963">(Apr 13 2020 at 23:19)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1494" title="https://github.com/bytecodealliance/wasmtime/pull/1494">PR #1494</a> from <code>arm64-merge</code> to <code>master</code>:</p>
<blockquote>
<p>This PR contributes a new backend framework built around <code>MachInst</code>s (machine instructions) contained in <code>VCode</code> (virtual-registerized code) containers. Furthermore, it contains a working ARM64 backend built in this new framework. The new framework is properly connected into the main Cranelift compilation pipeline, and the appropriate integrations have been made so that <code>wasmtime</code> can run basic Wasm tests correctly on ARM64 hardware.</p>
<p>This patch sequence contains code written by Julian Seward &lt;<a href="mailto:jseward@acm.org" title="mailto:jseward@acm.org">jseward@acm.org</a>&gt; and Benjamin Bouvier &lt;<a href="mailto:public@benj.me" title="mailto:public@benj.me">public@benj.me</a>&gt;, originally developed on a side-branch before rebasing and condensing into this patch series. See the <code>arm64</code> branch at <code>https://github.com/cfallin/wasmtime</code> for original development history.</p>
<p>This patch also contains code written by Joey Gouly &lt;<a href="mailto:joey.gouly@arm.com" title="mailto:joey.gouly@arm.com">joey.gouly@arm.com</a>&gt; and contributed to the above branch. These contributions are "Copyright (c) 2020, Arm Limited."</p>
<p>Closes #1174 and #1075.</p>
</blockquote>



<a name="193834154"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193834154" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193834154">(Apr 13 2020 at 23:21)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392503155" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392503155">PR Review</a>.</p>



<a name="193834156"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193834156" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193834156">(Apr 13 2020 at 23:21)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407774848" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407774848">PR Review Comment</a>:</p>
<blockquote>
<p>Done by reworking as <code>visit_branch_targets()</code> (internal iteration, accepts a closure, monomorphized at each call site).</p>
</blockquote>



<a name="193834401"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193834401" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193834401">(Apr 13 2020 at 23:24)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392504078" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392504078">PR Review</a>.</p>



<a name="193834402"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193834402" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193834402">(Apr 13 2020 at 23:24)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407775721" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407775721">PR Review Comment</a>:</p>
<blockquote>
<p>The invariant that the machine backend must satisfy is that <code>gen_nop</code> returns an instruction with nonzero size, and must be smaller than the requested size, so by that invariant, this loop will always terminate. Here's the doc comment from <code>gen_nop()</code> for reference:</p>
<div class="codehilite"><pre><span></span>/// Generate a NOP. The `preferred_size` parameter allows the caller to                                                                     
/// request a NOP of that size, or as close to it as possible. The machine                                                                  
/// backend may return a NOP whose binary encoding is smaller than the                                                                      
/// preferred size, but must not return a NOP that is larger. However,                                                                      
/// the instruction must have a nonzero size.
</pre></div>


</blockquote>



<a name="193835211"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193835211" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193835211">(Apr 13 2020 at 23:34)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392507766" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392507766">PR Review</a>.</p>



<a name="193835212"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193835212" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193835212">(Apr 13 2020 at 23:34)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407779016" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407779016">PR Review Comment</a>:</p>
<blockquote>
<p>Done!</p>
</blockquote>



<a name="193835229"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193835229" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193835229">(Apr 13 2020 at 23:35)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392507951" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392507951">PR Review</a>.</p>



<a name="193835230"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193835230" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193835230">(Apr 13 2020 at 23:35)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407779172" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407779172">PR Review Comment</a>:</p>
<blockquote>
<p>Removed! None of the names were actually unconventional; I think this was left over from an earlier prototype.</p>
</blockquote>



<a name="193835433"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193835433" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193835433">(Apr 13 2020 at 23:38)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392509212" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392509212">PR Review</a>.</p>



<a name="193835434"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193835434" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193835434">(Apr 13 2020 at 23:38)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407780286" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407780286">PR Review Comment</a>:</p>
<blockquote>
<p>Nope, not required; the reasoning behind including it here is that it is intertwined with the operand-matching/merging behavior. For example, an <code>iadd</code> can incorporate an <code>iconst</code> on an input; it then calls <code>ctx.merged(input)</code> which indicates that the use was incorporated directly, updating the refcounts (use counts). This could just as well be handled by a later inst-level DCE, but it seemed cheaper to avoid the lowering logic in the first place (Julian's measurement earlier today was ~4K host x86 instructions spent to lower one target instruction; that should improve but still). If you think we should factor these apart, I'm happy to do that, though!</p>
</blockquote>



<a name="193835691"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193835691" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193835691">(Apr 13 2020 at 23:43)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392510770" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392510770">PR Review</a>.</p>



<a name="193835692"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193835692" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193835692">(Apr 13 2020 at 23:43)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407781785" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407781785">PR Review Comment</a>:</p>
<blockquote>
<p>It's actually a BFS (<code>find_reachable_bbs()</code> further up in this file), but the order doesn't matter here, as we <em>also</em> compute RPO later in <a href="http://blockorder.rs" title="http://blockorder.rs">blockorder.rs</a> :-)</p>
<p>My thinking here was that I wanted to avoid creating a dependency on the <code>domtree</code> in order to remain as portable as possible, i.e., given later alternative implementations of the frontend driving the lowering logic, and that the <code>O(blocks)</code> cost would hopefully not be too bad. (I reserve the right to change my mind later in the week when I start looking at profiling results in detail!) But I can plumb this through if you'd prefer.</p>
</blockquote>



<a name="193835872"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193835872" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193835872">(Apr 13 2020 at 23:45)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1494" title="https://github.com/bytecodealliance/wasmtime/pull/1494">PR #1494</a> from <code>arm64-merge</code> to <code>master</code>:</p>
<blockquote>
<p>This PR contributes a new backend framework built around <code>MachInst</code>s (machine instructions) contained in <code>VCode</code> (virtual-registerized code) containers. Furthermore, it contains a working ARM64 backend built in this new framework. The new framework is properly connected into the main Cranelift compilation pipeline, and the appropriate integrations have been made so that <code>wasmtime</code> can run basic Wasm tests correctly on ARM64 hardware.</p>
<p>This patch sequence contains code written by Julian Seward &lt;<a href="mailto:jseward@acm.org" title="mailto:jseward@acm.org">jseward@acm.org</a>&gt; and Benjamin Bouvier &lt;<a href="mailto:public@benj.me" title="mailto:public@benj.me">public@benj.me</a>&gt;, originally developed on a side-branch before rebasing and condensing into this patch series. See the <code>arm64</code> branch at <code>https://github.com/cfallin/wasmtime</code> for original development history.</p>
<p>This patch also contains code written by Joey Gouly &lt;<a href="mailto:joey.gouly@arm.com" title="mailto:joey.gouly@arm.com">joey.gouly@arm.com</a>&gt; and contributed to the above branch. These contributions are "Copyright (c) 2020, Arm Limited."</p>
<p>Closes #1174 and #1075.</p>
</blockquote>



<a name="193838994"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193838994" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193838994">(Apr 14 2020 at 00:31)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1494" title="https://github.com/bytecodealliance/wasmtime/pull/1494">PR #1494</a> from <code>arm64-merge</code> to <code>master</code>:</p>
<blockquote>
<p>This PR contributes a new backend framework built around <code>MachInst</code>s (machine instructions) contained in <code>VCode</code> (virtual-registerized code) containers. Furthermore, it contains a working ARM64 backend built in this new framework. The new framework is properly connected into the main Cranelift compilation pipeline, and the appropriate integrations have been made so that <code>wasmtime</code> can run basic Wasm tests correctly on ARM64 hardware.</p>
<p>This patch sequence contains code written by Julian Seward &lt;<a href="mailto:jseward@acm.org" title="mailto:jseward@acm.org">jseward@acm.org</a>&gt; and Benjamin Bouvier &lt;<a href="mailto:public@benj.me" title="mailto:public@benj.me">public@benj.me</a>&gt;, originally developed on a side-branch before rebasing and condensing into this patch series. See the <code>arm64</code> branch at <code>https://github.com/cfallin/wasmtime</code> for original development history.</p>
<p>This patch also contains code written by Joey Gouly &lt;<a href="mailto:joey.gouly@arm.com" title="mailto:joey.gouly@arm.com">joey.gouly@arm.com</a>&gt; and contributed to the above branch. These contributions are "Copyright (c) 2020, Arm Limited."</p>
<p>Closes #1174 and #1075.</p>
</blockquote>



<a name="193840385"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193840385" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193840385">(Apr 14 2020 at 00:52)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1494" title="https://github.com/bytecodealliance/wasmtime/pull/1494">PR #1494</a> from <code>arm64-merge</code> to <code>master</code>:</p>
<blockquote>
<p>This PR contributes a new backend framework built around <code>MachInst</code>s (machine instructions) contained in <code>VCode</code> (virtual-registerized code) containers. Furthermore, it contains a working ARM64 backend built in this new framework. The new framework is properly connected into the main Cranelift compilation pipeline, and the appropriate integrations have been made so that <code>wasmtime</code> can run basic Wasm tests correctly on ARM64 hardware.</p>
<p>This patch sequence contains code written by Julian Seward &lt;<a href="mailto:jseward@acm.org" title="mailto:jseward@acm.org">jseward@acm.org</a>&gt; and Benjamin Bouvier &lt;<a href="mailto:public@benj.me" title="mailto:public@benj.me">public@benj.me</a>&gt;, originally developed on a side-branch before rebasing and condensing into this patch series. See the <code>arm64</code> branch at <code>https://github.com/cfallin/wasmtime</code> for original development history.</p>
<p>This patch also contains code written by Joey Gouly &lt;<a href="mailto:joey.gouly@arm.com" title="mailto:joey.gouly@arm.com">joey.gouly@arm.com</a>&gt; and contributed to the above branch. These contributions are "Copyright (c) 2020, Arm Limited."</p>
<p>Closes #1174 and #1075.</p>
</blockquote>



<a name="193840392"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193840392" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193840392">(Apr 14 2020 at 00:52)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392532822" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392532822">PR Review</a>.</p>



<a name="193840393"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193840393" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193840393">(Apr 14 2020 at 00:52)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407802217" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407802217">PR Review Comment</a>:</p>
<blockquote>
<p>Good idea -- done!</p>
</blockquote>



<a name="193840703"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193840703" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193840703">(Apr 14 2020 at 00:57)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1494" title="https://github.com/bytecodealliance/wasmtime/pull/1494">PR #1494</a> from <code>arm64-merge</code> to <code>master</code>:</p>
<blockquote>
<p>This PR contributes a new backend framework built around <code>MachInst</code>s (machine instructions) contained in <code>VCode</code> (virtual-registerized code) containers. Furthermore, it contains a working ARM64 backend built in this new framework. The new framework is properly connected into the main Cranelift compilation pipeline, and the appropriate integrations have been made so that <code>wasmtime</code> can run basic Wasm tests correctly on ARM64 hardware.</p>
<p>This patch sequence contains code written by Julian Seward &lt;<a href="mailto:jseward@acm.org" title="mailto:jseward@acm.org">jseward@acm.org</a>&gt; and Benjamin Bouvier &lt;<a href="mailto:public@benj.me" title="mailto:public@benj.me">public@benj.me</a>&gt;, originally developed on a side-branch before rebasing and condensing into this patch series. See the <code>arm64</code> branch at <code>https://github.com/cfallin/wasmtime</code> for original development history.</p>
<p>This patch also contains code written by Joey Gouly &lt;<a href="mailto:joey.gouly@arm.com" title="mailto:joey.gouly@arm.com">joey.gouly@arm.com</a>&gt; and contributed to the above branch. These contributions are "Copyright (c) 2020, Arm Limited."</p>
<p>Closes #1174 and #1075.</p>
</blockquote>



<a name="193840981"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193840981" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193840981">(Apr 14 2020 at 01:01)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392535666" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392535666">PR Review</a>.</p>



<a name="193840982"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193840982" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193840982">(Apr 14 2020 at 01:01)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407804889" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407804889">PR Review Comment</a>:</p>
<blockquote>
<p>@sunfishcode, that sounds perfect. Would you like us to wait for #1490 to land, or would it be acceptable to land this with the temporary "empty function" stack probe in the meantime (if the timing works out that way)?</p>
</blockquote>



<a name="193849995"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193849995" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193849995">(Apr 14 2020 at 04:43)</a>:</h4>
<p>julian-seward1 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392599503" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392599503">PR Review</a>.</p>



<a name="193849996"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193849996" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193849996">(Apr 14 2020 at 04:43)</a>:</h4>
<p>julian-seward1 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407863743" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407863743">PR Review Comment</a>:</p>
<blockquote>
<p>I would just leave it as it is.  CL will fail at run time the first time someone implementing a new instruction format tries to run any test case, so it'll be obvious it needs to be fixed.</p>
</blockquote>



<a name="193850067"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193850067" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193850067">(Apr 14 2020 at 04:45)</a>:</h4>
<p>julian-seward1 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392599982" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392599982">PR Review</a>.</p>



<a name="193850068"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193850068" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193850068">(Apr 14 2020 at 04:45)</a>:</h4>
<p>julian-seward1 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407864215" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407864215">PR Review Comment</a>:</p>
<blockquote>
<p>Leave it as is, I say; this will never be used in production.</p>
</blockquote>



<a name="193850212"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193850212" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193850212">(Apr 14 2020 at 04:49)</a>:</h4>
<p>julian-seward1 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392601090" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392601090">PR Review</a>.</p>



<a name="193850213"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193850213" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193850213">(Apr 14 2020 at 04:49)</a>:</h4>
<p>julian-seward1 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407865266" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407865266">PR Review Comment</a>:</p>
<blockquote>
<p>Is that really an improvement?  (1) It requires the reader to know (or look up) <code>to_be_bytes</code>; the original was quite clear.  (2) In order for it to not be a performance loss, it relies on <code>rustc</code> to inline away the call, the array construction and the array use, which is quite a big ask.</p>
</blockquote>



<a name="193850713"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193850713" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193850713">(Apr 14 2020 at 05:01)</a>:</h4>
<p>julian-seward1 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392604291" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392604291">PR Review</a>.</p>



<a name="193850714"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193850714" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193850714">(Apr 14 2020 at 05:01)</a>:</h4>
<p>julian-seward1 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407868218" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407868218">PR Review Comment</a>:</p>
<blockquote>
<p>As a general comment -- I have been profiling the new backend (Chris' stuff and the new regalloc) extensively with DHAT and plan to keep doing so.  That is very effective at finding pointless or low-value repeated reallocation -- in the week 6-13 Apr I reduced the number of allocation calls by a factor of 2 to 3, and there is much more to come.  Given that such allocation-avoiding restructurings potentially make code harder to understand, I'd prefer to restrict them to cases where the profile numbers show there's a clear benefit to be had, or that the change is very local and so doesn't impact readability -- eg, replacing a <code>Vec</code> with a <code>SmallVec</code>.</p>
</blockquote>



<a name="193850810"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193850810" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193850810">(Apr 14 2020 at 05:03)</a>:</h4>
<p>julian-seward1 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392604856" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392604856">PR Review</a>.</p>



<a name="193850811"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193850811" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193850811">(Apr 14 2020 at 05:03)</a>:</h4>
<p>julian-seward1 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407868704" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r407868704">PR Review Comment</a>:</p>
<blockquote>
<p>Just because I like these top level debug markers to be easy to spot in the thousands of lines of debug output.  No other reason.</p>
</blockquote>



<a name="193873882"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193873882" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193873882">(Apr 14 2020 at 09:56)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392777082" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392777082">PR Review</a>.</p>



<a name="193873883"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193873883" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193873883">(Apr 14 2020 at 09:56)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r408013059" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r408013059">PR Review Comment</a>:</p>
<blockquote>
<p>In cg_clif I write the clif ir before and after compilation to a file in debug mode. This makes debugging miscompilations much easier. It is unfortunately responsible for a nontrivial amount of compilation time, which means that I have to disable it in release mode. I would prefer if the new backend counter part to after compilation clif ir (vcode) could be printed as fast as possible.</p>
</blockquote>



<a name="193874958"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193874958" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193874958">(Apr 14 2020 at 10:05)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392784071" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392784071">PR Review</a>.</p>



<a name="193874961"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193874961" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193874961">(Apr 14 2020 at 10:05)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r408018869" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r408018869">PR Review Comment</a>:</p>
<blockquote>
<p>The code would fallthrough to the next function when there are no blocks, which shouldn't be allowed.</p>
</blockquote>



<a name="193876979"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193876979" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193876979">(Apr 14 2020 at 10:25)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392786937" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392786937">PR Review</a>.</p>



<a name="193876980"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193876980" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193876980">(Apr 14 2020 at 10:25)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392786937" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-392786937">PR Review</a>.</p>



<a name="193876981"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193876981" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193876981">(Apr 14 2020 at 10:25)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r408021337" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r408021337">PR Review Comment</a>:</p>
<blockquote>
<p>This applies only to the <code>use crate::binemit::CodeOffset;</code>.</p>
</blockquote>



<a name="193876982"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193876982" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193876982">(Apr 14 2020 at 10:25)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r408023251" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r408023251">PR Review Comment</a>:</p>
<blockquote>
<p>You could use the same <code>#[repr(u8)</code> + <code>Eq = 0</code> + <code>self as u8</code> here as <code>ShiftOp</code> and <code>ExtendOp</code>.</p>
</blockquote>



<a name="193876984"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193876984" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193876984">(Apr 14 2020 at 10:25)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r408027825" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r408027825">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>        f.debug_struct(&quot;MachBackend&quot;)
            .field(&quot;name&quot;, self.backend.name())
            .field(&quot;triple&quot;, self.backend.triple())
            .field(&quot;flags&quot;, self.backend.flags())
            .finish()
</pre></div>


</blockquote>



<a name="193876985"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193876985" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193876985">(Apr 14 2020 at 10:25)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r408026036" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r408026036">PR Review Comment</a>:</p>
<blockquote>
<p>This should be removed if you accept the suggestion above.</p>
</blockquote>



<a name="193876986"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193876986" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193876986">(Apr 14 2020 at 10:25)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r408029191" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r408029191">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>    let encinfo = if isa.is_none() || isa.unwrap().get_mach_backend().is_some() {
</pre></div>


</blockquote>



<a name="193876988"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193876988" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193876988">(Apr 14 2020 at 10:25)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r408025796" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r408025796">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>#[derive(Clone, Copy, Debug, Eq, PartialEq)]
pub enum Size {
    Size32,
    Size64,
}
</pre></div>


<p><code>Eq</code> can be used as replacement for <code>is32</code> and <code>is64</code> if you think that isn't worse.</p>
<p>If you have a better suggestion for the name of the variants, feel free to use that instead.</p>
</blockquote>



<a name="193876989"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193876989" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193876989">(Apr 14 2020 at 10:25)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r408030091" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r408030091">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>/// If `ireg` denotes an I64-classed reg, make a best-effort attempt to show
</pre></div>


</blockquote>



<a name="193876990"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/193876990" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#193876990">(Apr 14 2020 at 10:25)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r408029430" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r408029430">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>    // This is pretty lame, but whatever ..
</pre></div>


</blockquote>



<a name="194052568"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/194052568" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#194052568">(Apr 15 2020 at 15:57)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-393914251" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-393914251">PR Review</a>.</p>



<a name="194052570"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/194052570" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#194052570">(Apr 15 2020 at 15:57)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r408954437" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r408954437">PR Review Comment</a>:</p>
<blockquote>
<p>Please remove this.</p>
</blockquote>



<a name="194056000"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/194056000" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#194056000">(Apr 15 2020 at 16:22)</a>:</h4>
<p>sunfishcode submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-393934328" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-393934328">PR Review</a>.</p>



<a name="194056001"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/194056001" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#194056001">(Apr 15 2020 at 16:22)</a>:</h4>
<p>sunfishcode created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r408970643" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r408970643">PR Review Comment</a>:</p>
<blockquote>
<p><code>as</code> casts silently pick between widening, narrowing, and value-changing casts, while <code>::from</code> casts get a type error on any potentially value-changing cast, so it's nice to use <code>::from</code> when applicable.</p>
</blockquote>



<a name="194057425"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/194057425" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#194057425">(Apr 15 2020 at 16:32)</a>:</h4>
<p>sunfishcode submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-393939369" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-393939369">PR Review</a>.</p>



<a name="194057426"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/194057426" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#194057426">(Apr 15 2020 at 16:32)</a>:</h4>
<p>sunfishcode created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r408974755" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r408974755">PR Review Comment</a>:</p>
<blockquote>
<p>I think it's fine to land it with this temporary workaround.</p>
</blockquote>



<a name="194057427"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/194057427" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#194057427">(Apr 15 2020 at 16:32)</a>:</h4>
<p>sunfishcode submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-393939369" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-393939369">PR Review</a>.</p>



<a name="194065551"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/194065551" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#194065551">(Apr 15 2020 at 17:34)</a>:</h4>
<p>sunfishcode submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-393989876" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-393989876">PR Review</a>.</p>



<a name="194065552"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/194065552" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#194065552">(Apr 15 2020 at 17:34)</a>:</h4>
<p>sunfishcode created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r409015981" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r409015981">PR Review Comment</a>:</p>
<blockquote>
<p>Makes sense!</p>
</blockquote>



<a name="194240479"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/194240479" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#194240479">(Apr 15 2020 at 23:16)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-394198294" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-394198294">PR Review</a>.</p>



<a name="194240480"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/194240480" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#194240480">(Apr 15 2020 at 23:16)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r409188506" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r409188506">PR Review Comment</a>:</p>
<blockquote>
<p>That's a reasonable goal, but I suspect writing to the file will vastly outweigh allocation speeds here. In any case, the immediate costs are large -- a refactor, and a painful rebase of other work -- and the benefit is unclear and not driven by actual data. So let's leave this be for now, I think.</p>
</blockquote>



<a name="194240509"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/194240509" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#194240509">(Apr 15 2020 at 23:17)</a>:</h4>
<p>cfallin edited <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r409188506" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r409188506">PR Review Comment</a>.</p>



<a name="194240606"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/194240606" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#194240606">(Apr 15 2020 at 23:18)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-394199004" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-394199004">PR Review</a>.</p>



<a name="194240607"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/194240607" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#194240607">(Apr 15 2020 at 23:18)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r409189197" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r409189197">PR Review Comment</a>:</p>
<blockquote>
<p>Resolving this for now, as Ben is on top of ABI issues and has done further work on caller/callee-saves that will come in another PR.</p>
</blockquote>



<a name="194240987"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/194240987" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#194240987">(Apr 15 2020 at 23:24)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-394201170" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-394201170">PR Review</a>.</p>



<a name="194240988"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/194240988" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#194240988">(Apr 15 2020 at 23:24)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r409191186" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r409191186">PR Review Comment</a>:</p>
<blockquote>
<p>It seems that rustc actually does this; I just tested (with <code>-O</code>). Happy to do a little work to be idiomatic, as long as the complexity cost is not too high!</p>
</blockquote>



<a name="194241351"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/194241351" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#194241351">(Apr 15 2020 at 23:30)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-394203101" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-394203101">PR Review</a>.</p>



<a name="194241352"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/194241352" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#194241352">(Apr 15 2020 at 23:30)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r409192923" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r409192923">PR Review Comment</a>:</p>
<blockquote>
<p>Yes, perhaps, if the verifier allows this; but it seems that the old backend would have the same problem, no? (There would be no instruction to have an encoding, thus no return would be emitted.) It seems this would be good to follow up in a separate PR if it is indeed allowed, by updating the verifier instead. (As a general code-style thing I don't want to distribute implicit assumptions about data structure state throughout the code; if the entry is an <code>Option&lt;Block&gt;</code> then let's write code everywhere that supports that, and if it should always be a <code>Some</code>, then let's just make it a <code>Block</code> instead.)</p>
</blockquote>



<a name="194241414"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/194241414" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#194241414">(Apr 15 2020 at 23:31)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1494" title="https://github.com/bytecodealliance/wasmtime/pull/1494">PR #1494</a> from <code>arm64-merge</code> to <code>master</code>:</p>
<blockquote>
<p>This PR contributes a new backend framework built around <code>MachInst</code>s (machine instructions) contained in <code>VCode</code> (virtual-registerized code) containers. Furthermore, it contains a working ARM64 backend built in this new framework. The new framework is properly connected into the main Cranelift compilation pipeline, and the appropriate integrations have been made so that <code>wasmtime</code> can run basic Wasm tests correctly on ARM64 hardware.</p>
<p>This patch sequence contains code written by Julian Seward &lt;<a href="mailto:jseward@acm.org" title="mailto:jseward@acm.org">jseward@acm.org</a>&gt; and Benjamin Bouvier &lt;<a href="mailto:public@benj.me" title="mailto:public@benj.me">public@benj.me</a>&gt;, originally developed on a side-branch before rebasing and condensing into this patch series. See the <code>arm64</code> branch at <code>https://github.com/cfallin/wasmtime</code> for original development history.</p>
<p>This patch also contains code written by Joey Gouly &lt;<a href="mailto:joey.gouly@arm.com" title="mailto:joey.gouly@arm.com">joey.gouly@arm.com</a>&gt; and contributed to the above branch. These contributions are "Copyright (c) 2020, Arm Limited."</p>
<p>Closes #1174 and #1075.</p>
</blockquote>



<a name="194241974"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/194241974" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#194241974">(Apr 15 2020 at 23:40)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-394205616" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-394205616">PR Review</a>.</p>



<a name="194241975"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/194241975" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#194241975">(Apr 15 2020 at 23:40)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-394205616" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-394205616">PR Review</a>.</p>



<a name="194241976"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/194241976" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#194241976">(Apr 15 2020 at 23:40)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r409195217" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r409195217">PR Review Comment</a>:</p>
<blockquote>
<p>This can take &amp;Function I think.</p>
</blockquote>



<a name="194241977"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/194241977" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#194241977">(Apr 15 2020 at 23:40)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r409195333" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r409195333">PR Review Comment</a>:</p>
<blockquote>
<p>Same here</p>
</blockquote>



<a name="194241978"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/194241978" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#194241978">(Apr 15 2020 at 23:40)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r409195763" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r409195763">PR Review Comment</a>:</p>
<blockquote>
<p>Same here</p>
</blockquote>



<a name="194244956"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/194244956" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#194244956">(Apr 16 2020 at 00:22)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1494" title="https://github.com/bytecodealliance/wasmtime/pull/1494">PR #1494</a> from <code>arm64-merge</code> to <code>master</code>:</p>
<blockquote>
<p>This PR contributes a new backend framework built around <code>MachInst</code>s (machine instructions) contained in <code>VCode</code> (virtual-registerized code) containers. Furthermore, it contains a working ARM64 backend built in this new framework. The new framework is properly connected into the main Cranelift compilation pipeline, and the appropriate integrations have been made so that <code>wasmtime</code> can run basic Wasm tests correctly on ARM64 hardware.</p>
<p>This patch sequence contains code written by Julian Seward &lt;<a href="mailto:jseward@acm.org" title="mailto:jseward@acm.org">jseward@acm.org</a>&gt; and Benjamin Bouvier &lt;<a href="mailto:public@benj.me" title="mailto:public@benj.me">public@benj.me</a>&gt;, originally developed on a side-branch before rebasing and condensing into this patch series. See the <code>arm64</code> branch at <code>https://github.com/cfallin/wasmtime</code> for original development history.</p>
<p>This patch also contains code written by Joey Gouly &lt;<a href="mailto:joey.gouly@arm.com" title="mailto:joey.gouly@arm.com">joey.gouly@arm.com</a>&gt; and contributed to the above branch. These contributions are "Copyright (c) 2020, Arm Limited."</p>
<p>Closes #1174 and #1075.</p>
</blockquote>



<a name="194245000"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/194245000" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#194245000">(Apr 16 2020 at 00:23)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-394220560" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-394220560">PR Review</a>.</p>



<a name="194245001"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/194245001" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#194245001">(Apr 16 2020 at 00:23)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r409209300" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r409209300">PR Review Comment</a>:</p>
<blockquote>
<p>Yup, this was left over from an earlier version that did mutate the function; much nicer now to take an immutable input. Thanks!</p>
</blockquote>



<a name="194283231"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/194283231" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#194283231">(Apr 16 2020 at 10:25)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-394499895" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-394499895">PR Review</a>.</p>



<a name="194336006"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/194336006" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#194336006">(Apr 16 2020 at 17:02)</a>:</h4>
<p>cfallin merged <a href="https://github.com/bytecodealliance/wasmtime/pull/1494" title="https://github.com/bytecodealliance/wasmtime/pull/1494">PR #1494</a>.</p>



<a name="194345386"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/194345386" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#194345386">(Apr 16 2020 at 18:11)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-394881754" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-394881754">PR Review</a>.</p>



<a name="194345387"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/194345387" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#194345387">(Apr 16 2020 at 18:11)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-394881754" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-394881754">PR Review</a>.</p>



<a name="194345388"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/194345388" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#194345388">(Apr 16 2020 at 18:11)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r409753727" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r409753727">PR Review Comment</a>:</p>
<blockquote>
<p>Unfortunately I just caught this.  I  believe this accidentally moved the <code>#[cfg(feature = "unwind")]</code>.</p>
<p>I have a PR that this merged conflicted with, so I'll correct it there.</p>
</blockquote>



<a name="194345478"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/194345478" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#194345478">(Apr 16 2020 at 18:12)</a>:</h4>
<p>peterhuene edited <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r409753727" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r409753727">PR Review Comment</a>.</p>



<a name="194346846"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/194346846" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#194346846">(Apr 16 2020 at 18:22)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-394890117" title="https://github.com/bytecodealliance/wasmtime/pull/1494#pullrequestreview-394890117">PR Review</a>.</p>



<a name="194346847"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231494%20Add%20new%20%60MachInst%60%20backend%20and%20ARM64%20.../near/194346847" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231494.20Add.20new.20.60MachInst.60.20backend.20and.20ARM64.20.2E.2E.2E.html#194346847">(Apr 16 2020 at 18:22)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r409760605" title="https://github.com/bytecodealliance/wasmtime/pull/1494#discussion_r409760605">PR Review Comment</a>:</p>
<blockquote>
<p>Yikes, that was likely a rebase failure on my part. Sorry about that. (I suppose I got lucky as <code>unwind</code> is enabled by default.) Thanks for fixing!</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>