<html>
<head><meta charset="utf-8"><title>wasmtime / Issue #2730 Remove some dependencies · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232730.20Remove.20some.20dependencies.html">wasmtime / Issue #2730 Remove some dependencies</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="230786558"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232730%20Remove%20some%20dependencies/near/230786558" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232730.20Remove.20some.20dependencies.html#230786558">(Mar 17 2021 at 23:33)</a>:</h4>
<p>pchickey <a href="https://github.com/bytecodealliance/wasmtime/pull/2730#issuecomment-801509129">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/2730">Issue #2730</a>:</p>
<blockquote>
<p>I approve these changes in <code>cranelift-module</code>. I'm not a maintainer of <code>cranelift-codegen</code> so I will defer overall approval to someone else - @cfallin maybe?</p>
</blockquote>



<a name="230790373"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232730%20Remove%20some%20dependencies/near/230790373" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232730.20Remove.20some.20dependencies.html#230790373">(Mar 18 2021 at 00:16)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/2730#issuecomment-801523421">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/2730">Issue #2730</a>:</p>
<blockquote>
<p>It's somewhat surprising to me that changes in error-printing code would give such a large speedup in compile times. It's always welcome, of course, when speedups come -- but @bjorn3, do you have any sense of <em>why</em> this happens? I ask because it could be a symptom of something weirder going on behind the scenes -- for example, are we throwing a bunch of errors and doing work to capture backtraces but then silencing them somehow?</p>
<p>All other things being equal, the auto-derived error handling is kind of nice, but I won't fight too hard for it if we win by doing something lighter-weight.</p>
</blockquote>



<a name="230802408"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232730%20Remove%20some%20dependencies/near/230802408" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232730.20Remove.20some.20dependencies.html#230802408">(Mar 18 2021 at 01:45)</a>:</h4>
<p>pchickey <a href="https://github.com/bytecodealliance/wasmtime/pull/2730#issuecomment-801553668">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/2730">Issue #2730</a>:</p>
<blockquote>
<p>I believe, because <code>thiserror</code> is a proc macro that depends on the usual stack of <code>syn</code> and friends, that compiling those dependencies is the tentpole in embeddings which otherwise don't use proc macros.</p>
</blockquote>



<a name="230802478"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232730%20Remove%20some%20dependencies/near/230802478" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232730.20Remove.20some.20dependencies.html#230802478">(Mar 18 2021 at 01:46)</a>:</h4>
<p>pchickey edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/2730#issuecomment-801553668">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/2730">Issue #2730</a>:</p>
<blockquote>
<p>I believe, because <code>thiserror</code> is a proc macro that depends on the usual stack of <code>syn</code> and friends, that compiling those dependencies is the tentpole in embeddings which otherwise don't use proc macros. So, we don't see this in wasmtime or other big applications, but I imagine that cg_clif is very careful about deps.</p>
</blockquote>



<a name="230802512"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232730%20Remove%20some%20dependencies/near/230802512" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232730.20Remove.20some.20dependencies.html#230802512">(Mar 18 2021 at 01:46)</a>:</h4>
<p>pchickey edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/2730#issuecomment-801553668">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/2730">Issue #2730</a>:</p>
<blockquote>
<p>I believe, because <code>thiserror</code> is a proc macro that depends on the usual stack of <code>syn</code> and friends, that compiling those dependencies is the tentpole in embeddings which otherwise don't use proc macros. So, we don't see this in wasmtime or other big applications where we use that family or crates in several contexts, but I imagine that cg_clif is very careful about deps.</p>
</blockquote>



<a name="230803392"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232730%20Remove%20some%20dependencies/near/230803392" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232730.20Remove.20some.20dependencies.html#230803392">(Mar 18 2021 at 02:00)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/2730#issuecomment-801558640">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/2730">Issue #2730</a>:</p>
<blockquote>
<p>Ah -- to clarify, @bjorn3, you mean the compile time <em>of</em> cg_clif, not the time that cg_clif takes to compile code?</p>
<p>(I was assuming the latter, and thus was quite confused about the impact of error-path code on the happy path!)</p>
</blockquote>



<a name="230803489"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232730%20Remove%20some%20dependencies/near/230803489" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232730.20Remove.20some.20dependencies.html#230803489">(Mar 18 2021 at 02:01)</a>:</h4>
<p>pchickey edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/2730#issuecomment-801553668">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/2730">Issue #2730</a>:</p>
<blockquote>
<p>I believe, because <code>thiserror</code> is a proc macro that depends on the usual stack of <code>syn</code> and friends, that compiling those dependencies is the tentpole in embeddings which otherwise don't use proc macros. So, we don't see this in wasmtime or other big applications where we use that family of crates in several contexts, but I imagine that cg_clif is very careful about deps.</p>
</blockquote>



<a name="230820575"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232730%20Remove%20some%20dependencies/near/230820575" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232730.20Remove.20some.20dependencies.html#230820575">(Mar 18 2021 at 06:57)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/pull/2730#issuecomment-801680717">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/2730">Issue #2730</a>:</p>
<blockquote>
<blockquote>
<p>Ah -- to clarify, @bjorn3, you mean the compile time of cg_clif, not the time that cg_clif takes to compile code?</p>
</blockquote>
<p>Correct, I mean the time it takes to compile cg_clif itself. Sorry for the confusion.</p>
<blockquote>
<p>but I imagine that cg_clif is very careful about deps.</p>
</blockquote>
<p>Indeed. I try to avoid dependencies where possible and even use dependencies from the rustc-dev rustup component instead of <a href="http://crates.io">crates.io</a> where possible.</p>
</blockquote>



<a name="230918118"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232730%20Remove%20some%20dependencies/near/230918118" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232730.20Remove.20some.20dependencies.html#230918118">(Mar 18 2021 at 18:46)</a>:</h4>
<p>pchickey <a href="https://github.com/bytecodealliance/wasmtime/pull/2730#issuecomment-802201424">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/2730">Issue #2730</a>:</p>
<blockquote>
<p>Would you mind leaving a comment above the Display &amp; Error impls that these are written by hand to avoid pulling in the <code>thiserror</code> dep? That may help anyone who sees them and gets the clever idea that they can be replaced by a macro.</p>
</blockquote>



<a name="231043462"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232730%20Remove%20some%20dependencies/near/231043462" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232730.20Remove.20some.20dependencies.html#231043462">(Mar 19 2021 at 15:42)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/pull/2730#issuecomment-802925402">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/2730">Issue #2730</a>:</p>
<blockquote>
<p>Done</p>
</blockquote>



<a name="237315811"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232730%20Remove%20some%20dependencies/near/237315811" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232730.20Remove.20some.20dependencies.html#237315811">(May 04 2021 at 12:38)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/pull/2730#issuecomment-831909355">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/2730">Issue #2730</a>:</p>
<blockquote>
<p>Rebased</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>