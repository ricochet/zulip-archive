<html>
<head><meta charset="utf-8"><title>wasmtime / PR #4074 ISLE: add support for implicit `=x` v... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234074.20ISLE.3A.20add.20support.20for.20implicit.20.60.3Dx.60.20v.2E.2E.2E.html">wasmtime / PR #4074 ISLE: add support for implicit `=x` v...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="280285627"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234074%20ISLE%3A%20add%20support%20for%20implicit%20%60%3Dx%60%20v.../near/280285627" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234074.20ISLE.3A.20add.20support.20for.20implicit.20.60.3Dx.60.20v.2E.2E.2E.html#280285627">(Apr 26 2022 at 23:24)</a>:</h4>
<p>cfallin opened <a href="https://github.com/bytecodealliance/wasmtime/pull/4074">PR #4074</a> from <code>isle-var-bind-or-match</code> to <code>main</code>:</p>
<blockquote>
<p>Currently, a variable can be named in two different ways in an ISLE<br>
pattern. One can write a pattern like <code>(T x y)</code> that binds the two<br>
args of <code>T</code> with the subpatterns <code>x</code> and <code>y</code>, each of which match<br>
anything and capture the value as a bound variable. Or, one can write<br>
a pattern like <code>(T x =x)</code>, where the first arg pattern <code>x</code> captures<br>
the value in <code>x</code> and the second arg pattern <code>=x</code> matches only the same<br>
value that was already captured.</p>
<p>It turns out (thanks to @fitzgen for this insight here [1]) that this<br>
distinction can actually be inferred easily: if <code>x</code> isn't bound, then<br>
mentioning it binds it; otherwise, it matches only the already-bound<br>
variable. There's no concern about ordering (one mention binding<br>
vs. the other) because (i) the value is equal either way, and (ii) the<br>
types at both sites must be the same.</p>
<p>This language tweak seems like it should simplify things nicely! We<br>
can remove the <code>=x</code> syntax later if we want, but this PR doesn't do<br>
so.</p>
<p>[1] <a href="https://github.com/bytecodealliance/wasmtime/pull/4071#discussion_r859111513">https://github.com/bytecodealliance/wasmtime/pull/4071#discussion_r859111513</a></p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;<br>
</p>
</blockquote>



<a name="280285628"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234074%20ISLE%3A%20add%20support%20for%20implicit%20%60%3Dx%60%20v.../near/280285628" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234074.20ISLE.3A.20add.20support.20for.20implicit.20.60.3Dx.60.20v.2E.2E.2E.html#280285628">(Apr 26 2022 at 23:24)</a>:</h4>
<p><strong>cfallin</strong> requested <a href="https://github.com/fitzgen">fitzgen</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/4074">PR #4074</a>.</p>



<a name="280288926"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234074%20ISLE%3A%20add%20support%20for%20implicit%20%60%3Dx%60%20v.../near/280288926" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234074.20ISLE.3A.20add.20support.20for.20implicit.20.60.3Dx.60.20v.2E.2E.2E.html#280288926">(Apr 27 2022 at 00:12)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4074">PR #4074</a> from <code>isle-var-bind-or-match</code> to <code>main</code>.</p>



<a name="280404932"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234074%20ISLE%3A%20add%20support%20for%20implicit%20%60%3Dx%60%20v.../near/280404932" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234074.20ISLE.3A.20add.20support.20for.20implicit.20.60.3Dx.60.20v.2E.2E.2E.html#280404932">(Apr 27 2022 at 20:13)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4074#pullrequestreview-955483632">PR review</a>.</p>



<a name="280404934"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234074%20ISLE%3A%20add%20support%20for%20implicit%20%60%3Dx%60%20v.../near/280404934" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234074.20ISLE.3A.20add.20support.20for.20implicit.20.60.3Dx.60.20v.2E.2E.2E.html#280404934">(Apr 27 2022 at 20:13)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4074#pullrequestreview-955483632">PR review</a>.</p>



<a name="280404935"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234074%20ISLE%3A%20add%20support%20for%20implicit%20%60%3Dx%60%20v.../near/280404935" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234074.20ISLE.3A.20add.20support.20for.20implicit.20.60.3Dx.60.20v.2E.2E.2E.html#280404935">(Apr 27 2022 at 20:13)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/4074#discussion_r860206018">PR review comment</a>:</p>
<blockquote>
<p>Can we keep a set/map of already-bound variables? Doing a linear search here seems suboptimal.</p>
</blockquote>



<a name="280405231"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234074%20ISLE%3A%20add%20support%20for%20implicit%20%60%3Dx%60%20v.../near/280405231" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234074.20ISLE.3A.20add.20support.20for.20implicit.20.60.3Dx.60.20v.2E.2E.2E.html#280405231">(Apr 27 2022 at 20:16)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4074#pullrequestreview-955488007">PR review</a>.</p>



<a name="280405232"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234074%20ISLE%3A%20add%20support%20for%20implicit%20%60%3Dx%60%20v.../near/280405232" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234074.20ISLE.3A.20add.20support.20for.20implicit.20.60.3Dx.60.20v.2E.2E.2E.html#280405232">(Apr 27 2022 at 20:16)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/4074#discussion_r860209102">PR review comment</a>:</p>
<blockquote>
<p>Ah, I think I originally wrote it this way for two reasons:</p>
<ul>
<li>It allows us to push/pop bindings when we enter and leave a lexical sub-scope (a <code>let</code>) -- we need to record the nesting order somehow, so a map to accelerate this would have to be maintained using that linear order on the side;</li>
<li>It makes it easier to refactor to allow for shadowing later (which is a feature I think we might want).</li>
</ul>
<p>In practice with a handful of bindings it shouldn't really be a perf concern, I think...</p>
</blockquote>



<a name="280405679"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234074%20ISLE%3A%20add%20support%20for%20implicit%20%60%3Dx%60%20v.../near/280405679" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234074.20ISLE.3A.20add.20support.20for.20implicit.20.60.3Dx.60.20v.2E.2E.2E.html#280405679">(Apr 27 2022 at 20:20)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/4074#discussion_r860212048">PR review comment</a>:</p>
<blockquote>
<p>(If you still want us to do something better here I'm happy to think about it more, though!)</p>
</blockquote>



<a name="280405680"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234074%20ISLE%3A%20add%20support%20for%20implicit%20%60%3Dx%60%20v.../near/280405680" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234074.20ISLE.3A.20add.20support.20for.20implicit.20.60.3Dx.60.20v.2E.2E.2E.html#280405680">(Apr 27 2022 at 20:20)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4074#pullrequestreview-955492191">PR review</a>.</p>



<a name="280405901"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234074%20ISLE%3A%20add%20support%20for%20implicit%20%60%3Dx%60%20v.../near/280405901" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234074.20ISLE.3A.20add.20support.20for.20implicit.20.60.3Dx.60.20v.2E.2E.2E.html#280405901">(Apr 27 2022 at 20:22)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4074#pullrequestreview-955494251">PR review</a>.</p>



<a name="280405902"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234074%20ISLE%3A%20add%20support%20for%20implicit%20%60%3Dx%60%20v.../near/280405902" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234074.20ISLE.3A.20add.20support.20for.20implicit.20.60.3Dx.60.20v.2E.2E.2E.html#280405902">(Apr 27 2022 at 20:22)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/4074#discussion_r860213432">PR review comment</a>:</p>
<blockquote>
<p>Eh, if it isn't a quick fix then lets leave it and deal with it if/when it actually becomes a problem</p>
</blockquote>



<a name="280406206"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234074%20ISLE%3A%20add%20support%20for%20implicit%20%60%3Dx%60%20v.../near/280406206" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234074.20ISLE.3A.20add.20support.20for.20implicit.20.60.3Dx.60.20v.2E.2E.2E.html#280406206">(Apr 27 2022 at 20:25)</a>:</h4>
<p>cfallin merged <a href="https://github.com/bytecodealliance/wasmtime/pull/4074">PR #4074</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>