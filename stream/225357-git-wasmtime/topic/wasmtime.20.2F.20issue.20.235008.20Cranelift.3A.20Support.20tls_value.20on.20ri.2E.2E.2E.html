<html>
<head><meta charset="utf-8"><title>wasmtime / issue #5008 Cranelift: Support tls_value on ri... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235008.20Cranelift.3A.20Support.20tls_value.20on.20ri.2E.2E.2E.html">wasmtime / issue #5008 Cranelift: Support tls_value on ri...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="302322873"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235008%20Cranelift%3A%20Support%20tls_value%20on%20ri.../near/302322873" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235008.20Cranelift.3A.20Support.20tls_value.20on.20ri.2E.2E.2E.html#302322873">(Oct 04 2022 at 18:33)</a>:</h4>
<p>bjorn3 opened <a href="https://github.com/bytecodealliance/wasmtime/issues/5008">issue #5008</a>:</p>
<blockquote>
<h4>Feature</h4>
<p>Support the <code>tls_value</code> instruction on riscv64</p>
<h4>Benefit</h4>
<p>Necessary for cg_clif to implement thread local storage.</p>
<h4>Implementation</h4>
<p><a href="https://github.com/riscv-non-isa/riscv-elf-psabi-doc/blob/master/riscv-elf.adoc#global-dynamic">https://github.com/riscv-non-isa/riscv-elf-psabi-doc/blob/master/riscv-elf.adoc#global-dynamic</a> shows the instruction sequence with all relocation necessary for performing a tls access with the global dynamic tls model (the most general model). <code>__tls_get_addr</code> here is just a regular function following the riscv C abi. See <a href="https://github.com/bytecodealliance/wasmtime/blob/2986f6b0fffd576a2ba88a1fc6cb2db959a1f9e8/cranelift/codegen/src/isa/x64/inst/emit.rs#L3096-L3123">https://github.com/bytecodealliance/wasmtime/blob/2986f6b0fffd576a2ba88a1fc6cb2db959a1f9e8/cranelift/codegen/src/isa/x64/inst/emit.rs#L3096-L3123</a> as an example implementation for x86_64 (different instruction sequence, but same principle)</p>
<h4>Alternatives</h4>
<p>None</p>
<p>cc @yuyang-ok</p>
</blockquote>



<a name="319838869"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235008%20Cranelift%3A%20Support%20tls_value%20on%20ri.../near/319838869" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235008.20Cranelift.3A.20Support.20tls_value.20on.20ri.2E.2E.2E.html#319838869">(Jan 06 2023 at 18:37)</a>:</h4>
<p>elliottt labeled <a href="https://github.com/bytecodealliance/wasmtime/issues/5008">issue #5008</a>:</p>
<blockquote>
<h4>Feature</h4>
<p>Support the <code>tls_value</code> instruction on riscv64</p>
<h4>Benefit</h4>
<p>Necessary for cg_clif to implement thread local storage.</p>
<h4>Implementation</h4>
<p><a href="https://github.com/riscv-non-isa/riscv-elf-psabi-doc/blob/master/riscv-elf.adoc#global-dynamic">https://github.com/riscv-non-isa/riscv-elf-psabi-doc/blob/master/riscv-elf.adoc#global-dynamic</a> shows the instruction sequence with all relocation necessary for performing a tls access with the global dynamic tls model (the most general model). <code>__tls_get_addr</code> here is just a regular function following the riscv C abi. See <a href="https://github.com/bytecodealliance/wasmtime/blob/2986f6b0fffd576a2ba88a1fc6cb2db959a1f9e8/cranelift/codegen/src/isa/x64/inst/emit.rs#L3096-L3123">https://github.com/bytecodealliance/wasmtime/blob/2986f6b0fffd576a2ba88a1fc6cb2db959a1f9e8/cranelift/codegen/src/isa/x64/inst/emit.rs#L3096-L3123</a> as an example implementation for x86_64 (different instruction sequence, but same principle)</p>
<h4>Alternatives</h4>
<p>None</p>
<p>cc @yuyang-ok</p>
</blockquote>



<a name="395544662"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235008%20Cranelift%3A%20Support%20tls_value%20on%20ri.../near/395544662" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235008.20Cranelift.3A.20Support.20tls_value.20on.20ri.2E.2E.2E.html#395544662">(Oct 08 2023 at 13:54)</a>:</h4>
<p>afonso360 <a href="https://github.com/bytecodealliance/wasmtime/issues/5008#issuecomment-1752034287">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/5008">issue #5008</a>:</p>
<blockquote>
<p>This has been implemented as part of #7003</p>
</blockquote>



<a name="395544663"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235008%20Cranelift%3A%20Support%20tls_value%20on%20ri.../near/395544663" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235008.20Cranelift.3A.20Support.20tls_value.20on.20ri.2E.2E.2E.html#395544663">(Oct 08 2023 at 13:54)</a>:</h4>
<p>afonso360 closed <a href="https://github.com/bytecodealliance/wasmtime/issues/5008">issue #5008</a>:</p>
<blockquote>
<h4>Feature</h4>
<p>Support the <code>tls_value</code> instruction on riscv64</p>
<h4>Benefit</h4>
<p>Necessary for cg_clif to implement thread local storage.</p>
<h4>Implementation</h4>
<p><a href="https://github.com/riscv-non-isa/riscv-elf-psabi-doc/blob/master/riscv-elf.adoc#global-dynamic">https://github.com/riscv-non-isa/riscv-elf-psabi-doc/blob/master/riscv-elf.adoc#global-dynamic</a> shows the instruction sequence with all relocation necessary for performing a tls access with the global dynamic tls model (the most general model). <code>__tls_get_addr</code> here is just a regular function following the riscv C abi. See <a href="https://github.com/bytecodealliance/wasmtime/blob/2986f6b0fffd576a2ba88a1fc6cb2db959a1f9e8/cranelift/codegen/src/isa/x64/inst/emit.rs#L3096-L3123">https://github.com/bytecodealliance/wasmtime/blob/2986f6b0fffd576a2ba88a1fc6cb2db959a1f9e8/cranelift/codegen/src/isa/x64/inst/emit.rs#L3096-L3123</a> as an example implementation for x86_64 (different instruction sequence, but same principle)</p>
<h4>Alternatives</h4>
<p>None</p>
<p>cc @yuyang-ok</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>