<html>
<head><meta charset="utf-8"><title>wasmtime / PR #4782 cranelift: Add LibCalls to the interp... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234782.20cranelift.3A.20Add.20LibCalls.20to.20the.20interp.2E.2E.2E.html">wasmtime / PR #4782 cranelift: Add LibCalls to the interp...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="295237805"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234782%20cranelift%3A%20Add%20LibCalls%20to%20the%20interp.../near/295237805" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234782.20cranelift.3A.20Add.20LibCalls.20to.20the.20interp.2E.2E.2E.html#295237805">(Aug 25 2022 at 14:19)</a>:</h4>
<p>afonso360 opened <a href="https://github.com/bytecodealliance/wasmtime/pull/4782">PR #4782</a> from <code>interp-libcalls</code> to <code>main</code>:</p>
<blockquote>
<p><span aria-label="wave" class="emoji emoji-1f44b" role="img" title="wave">:wave:</span> Hey,</p>
<p>This does not fix any of the issues reported by the fuzzer so far, but I think that is just a coincidence, since at some point it will generate a libcall and we cannot handle those either.</p>
<p>This allows the interpreter to register libcall handlers and invoke them when called.</p>
<p>I switched the fuzzer generated libcall from Udiv to Ishl, reason being that we don't want libcalls that can trap. Both functions have identical signatures so we shouldn't have any input format changes to the fuzzer.</p>
</blockquote>



<a name="295238123"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234782%20cranelift%3A%20Add%20LibCalls%20to%20the%20interp.../near/295238123" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234782.20cranelift.3A.20Add.20LibCalls.20to.20the.20interp.2E.2E.2E.html#295238123">(Aug 25 2022 at 14:21)</a>:</h4>
<p>afonso360 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4782">PR #4782</a> from <code>interp-libcalls</code> to <code>main</code>.</p>



<a name="295239560"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234782%20cranelift%3A%20Add%20LibCalls%20to%20the%20interp.../near/295239560" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234782.20cranelift.3A.20Add.20LibCalls.20to.20the.20interp.2E.2E.2E.html#295239560">(Aug 25 2022 at 14:28)</a>:</h4>
<p>afonso360 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4782#pullrequestreview-1085557253">PR review</a>.</p>



<a name="295239561"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234782%20cranelift%3A%20Add%20LibCalls%20to%20the%20interp.../near/295239561" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234782.20cranelift.3A.20Add.20LibCalls.20to.20the.20interp.2E.2E.2E.html#295239561">(Aug 25 2022 at 14:28)</a>:</h4>
<p>afonso360 created <a href="https://github.com/bytecodealliance/wasmtime/pull/4782#discussion_r955040868">PR review comment</a>:</p>
<blockquote>
<p>I saw some sources online that point to this being the correct behaviour, but nothing definitive. Does anyone know if this is correct?</p>
</blockquote>



<a name="295239725"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234782%20cranelift%3A%20Add%20LibCalls%20to%20the%20interp.../near/295239725" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234782.20cranelift.3A.20Add.20LibCalls.20to.20the.20interp.2E.2E.2E.html#295239725">(Aug 25 2022 at 14:29)</a>:</h4>
<p>afonso360 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4782">PR #4782</a> from <code>interp-libcalls</code> to <code>main</code>.</p>



<a name="295239813"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234782%20cranelift%3A%20Add%20LibCalls%20to%20the%20interp.../near/295239813" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234782.20cranelift.3A.20Add.20LibCalls.20to.20the.20interp.2E.2E.2E.html#295239813">(Aug 25 2022 at 14:29)</a>:</h4>
<p>afonso360 deleted <a href="https://github.com/bytecodealliance/wasmtime/pull/4782#discussion_r955040868">PR review comment</a>.</p>



<a name="295239849"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234782%20cranelift%3A%20Add%20LibCalls%20to%20the%20interp.../near/295239849" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234782.20cranelift.3A.20Add.20LibCalls.20to.20the.20interp.2E.2E.2E.html#295239849">(Aug 25 2022 at 14:29)</a>:</h4>
<p>afonso360 created <a href="https://github.com/bytecodealliance/wasmtime/pull/4782#discussion_r955042619">PR review comment</a>:</p>
<blockquote>
<p>I saw some sources online that point to this being the correct behaviour, but nothing definitive. Does anyone know if this is correct?</p>
</blockquote>



<a name="295239850"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234782%20cranelift%3A%20Add%20LibCalls%20to%20the%20interp.../near/295239850" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234782.20cranelift.3A.20Add.20LibCalls.20to.20the.20interp.2E.2E.2E.html#295239850">(Aug 25 2022 at 14:29)</a>:</h4>
<p>afonso360 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4782#pullrequestreview-1085559887">PR review</a>.</p>



<a name="295240692"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234782%20cranelift%3A%20Add%20LibCalls%20to%20the%20interp.../near/295240692" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234782.20cranelift.3A.20Add.20LibCalls.20to.20the.20interp.2E.2E.2E.html#295240692">(Aug 25 2022 at 14:33)</a>:</h4>
<p>afonso360 edited <a href="https://github.com/bytecodealliance/wasmtime/pull/4782#discussion_r955042619">PR review comment</a>.</p>



<a name="295242100"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234782%20cranelift%3A%20Add%20LibCalls%20to%20the%20interp.../near/295242100" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234782.20cranelift.3A.20Add.20LibCalls.20to.20the.20interp.2E.2E.2E.html#295242100">(Aug 25 2022 at 14:40)</a>:</h4>
<p>afonso360 edited <a href="https://github.com/bytecodealliance/wasmtime/pull/4782">PR #4782</a> from <code>interp-libcalls</code> to <code>main</code>:</p>
<blockquote>
<p><span aria-label="wave" class="emoji emoji-1f44b" role="img" title="wave">:wave:</span> Hey,</p>
<p>This does not fix any of the issues reported by the fuzzer so far, but I think that is just a coincidence, since at some point it will generate a libcall and we cannot handle those either.</p>
<p>Edit: Actually this may have already been reported, but have returned the same error as  #4758 so it wasn't reported separately.</p>
<p>This allows the interpreter to register libcall handlers and invoke them when called.</p>
<p>I switched the fuzzer generated libcall from Udiv to Ishl, reason being that we don't want libcalls that can trap. Both functions have identical signatures so we shouldn't have any input format changes to the fuzzer.</p>
</blockquote>



<a name="295256057"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234782%20cranelift%3A%20Add%20LibCalls%20to%20the%20interp.../near/295256057" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234782.20cranelift.3A.20Add.20LibCalls.20to.20the.20interp.2E.2E.2E.html#295256057">(Aug 25 2022 at 15:34)</a>:</h4>
<p>afonso360 created <a href="https://github.com/bytecodealliance/wasmtime/pull/4782#discussion_r955124250">PR review comment</a>:</p>
<blockquote>
<p>I think it might also be a good idea to return <code>Result&lt;SmallVec&lt;[V; 1]&gt;, TrapCode&gt;</code> and allow these to trap controllably.</p>
</blockquote>



<a name="295256058"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234782%20cranelift%3A%20Add%20LibCalls%20to%20the%20interp.../near/295256058" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234782.20cranelift.3A.20Add.20LibCalls.20to.20the.20interp.2E.2E.2E.html#295256058">(Aug 25 2022 at 15:34)</a>:</h4>
<p>afonso360 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4782#pullrequestreview-1085678624">PR review</a>.</p>



<a name="295256088"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234782%20cranelift%3A%20Add%20LibCalls%20to%20the%20interp.../near/295256088" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234782.20cranelift.3A.20Add.20LibCalls.20to.20the.20interp.2E.2E.2E.html#295256088">(Aug 25 2022 at 15:34)</a>:</h4>
<p>afonso360 edited <a href="https://github.com/bytecodealliance/wasmtime/pull/4782#discussion_r955124250">PR review comment</a>.</p>



<a name="295256118"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234782%20cranelift%3A%20Add%20LibCalls%20to%20the%20interp.../near/295256118" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234782.20cranelift.3A.20Add.20LibCalls.20to.20the.20interp.2E.2E.2E.html#295256118">(Aug 25 2022 at 15:34)</a>:</h4>
<p>afonso360 edited <a href="https://github.com/bytecodealliance/wasmtime/pull/4782#discussion_r955124250">PR review comment</a>.</p>



<a name="295267024"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234782%20cranelift%3A%20Add%20LibCalls%20to%20the%20interp.../near/295267024" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234782.20cranelift.3A.20Add.20LibCalls.20to.20the.20interp.2E.2E.2E.html#295267024">(Aug 25 2022 at 16:34)</a>:</h4>
<p>afonso360 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4782#pullrequestreview-1085776078">PR review</a>.</p>



<a name="295267025"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234782%20cranelift%3A%20Add%20LibCalls%20to%20the%20interp.../near/295267025" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234782.20cranelift.3A.20Add.20LibCalls.20to.20the.20interp.2E.2E.2E.html#295267025">(Aug 25 2022 at 16:34)</a>:</h4>
<p>afonso360 created <a href="https://github.com/bytecodealliance/wasmtime/pull/4782#discussion_r955195022">PR review comment</a>:</p>
<blockquote>
<p>I think this is undefined behaviour, so I've added trap codes to the libcall handlers and reverted back to div</p>
</blockquote>



<a name="295267250"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234782%20cranelift%3A%20Add%20LibCalls%20to%20the%20interp.../near/295267250" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234782.20cranelift.3A.20Add.20LibCalls.20to.20the.20interp.2E.2E.2E.html#295267250">(Aug 25 2022 at 16:35)</a>:</h4>
<p>afonso360 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4782">PR #4782</a> from <code>interp-libcalls</code> to <code>main</code>.</p>



<a name="295267311"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234782%20cranelift%3A%20Add%20LibCalls%20to%20the%20interp.../near/295267311" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234782.20cranelift.3A.20Add.20LibCalls.20to.20the.20interp.2E.2E.2E.html#295267311">(Aug 25 2022 at 16:36)</a>:</h4>
<p>afonso360 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4782">PR #4782</a> from <code>interp-libcalls</code> to <code>main</code>.</p>



<a name="295268217"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234782%20cranelift%3A%20Add%20LibCalls%20to%20the%20interp.../near/295268217" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234782.20cranelift.3A.20Add.20LibCalls.20to.20the.20interp.2E.2E.2E.html#295268217">(Aug 25 2022 at 16:41)</a>:</h4>
<p>afonso360 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4782">PR #4782</a> from <code>interp-libcalls</code> to <code>main</code>.</p>



<a name="295281761"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234782%20cranelift%3A%20Add%20LibCalls%20to%20the%20interp.../near/295281761" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234782.20cranelift.3A.20Add.20LibCalls.20to.20the.20interp.2E.2E.2E.html#295281761">(Aug 25 2022 at 17:59)</a>:</h4>
<p>jameysharp submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4782#pullrequestreview-1085881703">PR review</a>.</p>



<a name="295281762"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234782%20cranelift%3A%20Add%20LibCalls%20to%20the%20interp.../near/295281762" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234782.20cranelift.3A.20Add.20LibCalls.20to.20the.20interp.2E.2E.2E.html#295281762">(Aug 25 2022 at 17:59)</a>:</h4>
<p>jameysharp created <a href="https://github.com/bytecodealliance/wasmtime/pull/4782#discussion_r955267355">PR review comment</a>:</p>
<blockquote>
<p>I'm not sure I understand. We've recently defined shifts to be computed modulo the bit width. So I think <code>Ishl64</code> is a fine choice, but it should evaluate to <code>a &lt;&lt; (b % 64)</code> for all values of <code>b</code>. That in turn means that we don't need to check the preconditions on Rust's implementation of left-shift: it would panic in debug builds if the shift amount is 64 or higher, but we'll never hit that case.</p>
</blockquote>



<a name="295283102"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234782%20cranelift%3A%20Add%20LibCalls%20to%20the%20interp.../near/295283102" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234782.20cranelift.3A.20Add.20LibCalls.20to.20the.20interp.2E.2E.2E.html#295283102">(Aug 25 2022 at 18:05)</a>:</h4>
<p>afonso360 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4782#pullrequestreview-1085890377">PR review</a>.</p>



<a name="295283103"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234782%20cranelift%3A%20Add%20LibCalls%20to%20the%20interp.../near/295283103" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234782.20cranelift.3A.20Add.20LibCalls.20to.20the.20interp.2E.2E.2E.html#295283103">(Aug 25 2022 at 18:05)</a>:</h4>
<p>afonso360 created <a href="https://github.com/bytecodealliance/wasmtime/pull/4782#discussion_r955273103">PR review comment</a>:</p>
<blockquote>
<p>These libcalls end up being linked to the platform's runtime library if the interpreted version succeeds, so we need to make sure that they match the behaviour agreed by the runtime libraries and not our own.</p>
<p>We also can't really panic here since it would cause a fuzz error.</p>
</blockquote>



<a name="295283433"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234782%20cranelift%3A%20Add%20LibCalls%20to%20the%20interp.../near/295283433" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234782.20cranelift.3A.20Add.20LibCalls.20to.20the.20interp.2E.2E.2E.html#295283433">(Aug 25 2022 at 18:07)</a>:</h4>
<p>afonso360 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4782#pullrequestreview-1085892949">PR review</a>.</p>



<a name="295283434"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234782%20cranelift%3A%20Add%20LibCalls%20to%20the%20interp.../near/295283434" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234782.20cranelift.3A.20Add.20LibCalls.20to.20the.20interp.2E.2E.2E.html#295283434">(Aug 25 2022 at 18:07)</a>:</h4>
<p>afonso360 created <a href="https://github.com/bytecodealliance/wasmtime/pull/4782#discussion_r955274716">PR review comment</a>:</p>
<blockquote>
<p>Another option would be to define our own symbol for the JIT as well, and then we control both sides, the interpreted version and the compiled version.</p>
</blockquote>



<a name="295283506"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234782%20cranelift%3A%20Add%20LibCalls%20to%20the%20interp.../near/295283506" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234782.20cranelift.3A.20Add.20LibCalls.20to.20the.20interp.2E.2E.2E.html#295283506">(Aug 25 2022 at 18:07)</a>:</h4>
<p>afonso360 edited <a href="https://github.com/bytecodealliance/wasmtime/pull/4782#discussion_r955274716">PR review comment</a>.</p>



<a name="295284159"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234782%20cranelift%3A%20Add%20LibCalls%20to%20the%20interp.../near/295284159" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234782.20cranelift.3A.20Add.20LibCalls.20to.20the.20interp.2E.2E.2E.html#295284159">(Aug 25 2022 at 18:11)</a>:</h4>
<p>afonso360 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4782">PR #4782</a> from <code>interp-libcalls</code> to <code>main</code>.</p>



<a name="295429818"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234782%20cranelift%3A%20Add%20LibCalls%20to%20the%20interp.../near/295429818" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234782.20cranelift.3A.20Add.20LibCalls.20to.20the.20interp.2E.2E.2E.html#295429818">(Aug 26 2022 at 14:03)</a>:</h4>
<p>afonso360 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4782">PR #4782</a> from <code>interp-libcalls</code> to <code>main</code>.</p>



<a name="295465558"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234782%20cranelift%3A%20Add%20LibCalls%20to%20the%20interp.../near/295465558" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234782.20cranelift.3A.20Add.20LibCalls.20to.20the.20interp.2E.2E.2E.html#295465558">(Aug 26 2022 at 16:36)</a>:</h4>
<p>jameysharp submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4782#pullrequestreview-1087197417">PR review</a>.</p>



<a name="295465559"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234782%20cranelift%3A%20Add%20LibCalls%20to%20the%20interp.../near/295465559" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234782.20cranelift.3A.20Add.20LibCalls.20to.20the.20interp.2E.2E.2E.html#295465559">(Aug 26 2022 at 16:36)</a>:</h4>
<p>jameysharp submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4782#pullrequestreview-1087197417">PR review</a>.</p>



<a name="295465561"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234782%20cranelift%3A%20Add%20LibCalls%20to%20the%20interp.../near/295465561" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234782.20cranelift.3A.20Add.20LibCalls.20to.20the.20interp.2E.2E.2E.html#295465561">(Aug 26 2022 at 16:36)</a>:</h4>
<p>jameysharp created <a href="https://github.com/bytecodealliance/wasmtime/pull/4782#discussion_r956212783">PR review comment</a>:</p>
<blockquote>
<p>Since this <code>SmallVec</code> type ends up appearing in other modules, I'd suggest introducing a type alias for it. That way it's easy later either to change it to a regular <code>Vec</code>, or to put more elements in the inline array.</p>
<p>Also, <code>&amp;dyn Fn</code> is probably more general than necessary. A closure that doesn't capture anything from its environment is compatible with a <code>fn</code> type, and I'd be surprised if interpreter libcall handlers ever needed context.</p>
<p><div class="codehilite" data-code-language="suggestion"><pre><span></span><code>pub type LibCallValues&lt;V&gt; = SmallVec&lt;[V; 1]&gt;;
pub type LibCallHandler&lt;V&gt; = fn(LibCall, LibCallValues&lt;V&gt;) -&gt; Result&lt;LibCallValues&lt;V&gt;, TrapCode&gt;;
</code></pre></div><br>
</p>
</blockquote>



<a name="295465563"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234782%20cranelift%3A%20Add%20LibCalls%20to%20the%20interp.../near/295465563" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234782.20cranelift.3A.20Add.20LibCalls.20to.20the.20interp.2E.2E.2E.html#295465563">(Aug 26 2022 at 16:36)</a>:</h4>
<p>jameysharp created <a href="https://github.com/bytecodealliance/wasmtime/pull/4782#discussion_r956204482">PR review comment</a>:</p>
<blockquote>
<p>What do you think of defining this function in <code>function_generator.rs</code> next to the array of allowed libcalls?</p>
</blockquote>



<a name="295556104"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234782%20cranelift%3A%20Add%20LibCalls%20to%20the%20interp.../near/295556104" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234782.20cranelift.3A.20Add.20LibCalls.20to.20the.20interp.2E.2E.2E.html#295556104">(Aug 27 2022 at 07:30)</a>:</h4>
<p>afonso360 created <a href="https://github.com/bytecodealliance/wasmtime/pull/4782#discussion_r956550826">PR review comment</a>:</p>
<blockquote>
<p>The only reason I'm hesitant to do this is that <code>fuzzgen</code> is supposed to be executor agnostic (i.e. icache needs none of this), so it feels kinda weird to have a interpreter specific function there.</p>
</blockquote>



<a name="295556105"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234782%20cranelift%3A%20Add%20LibCalls%20to%20the%20interp.../near/295556105" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234782.20cranelift.3A.20Add.20LibCalls.20to.20the.20interp.2E.2E.2E.html#295556105">(Aug 27 2022 at 07:30)</a>:</h4>
<p>afonso360 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4782#pullrequestreview-1087653815">PR review</a>.</p>



<a name="295556128"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234782%20cranelift%3A%20Add%20LibCalls%20to%20the%20interp.../near/295556128" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234782.20cranelift.3A.20Add.20LibCalls.20to.20the.20interp.2E.2E.2E.html#295556128">(Aug 27 2022 at 07:30)</a>:</h4>
<p>afonso360 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4782">PR #4782</a> from <code>interp-libcalls</code> to <code>main</code>.</p>



<a name="295716042"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234782%20cranelift%3A%20Add%20LibCalls%20to%20the%20interp.../near/295716042" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234782.20cranelift.3A.20Add.20LibCalls.20to.20the.20interp.2E.2E.2E.html#295716042">(Aug 28 2022 at 14:23)</a>:</h4>
<p><strong>afonso360</strong> has marked <a href="https://github.com/bytecodealliance/wasmtime/pull/4782">PR #4782</a> as ready for review.</p>



<a name="295983173"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234782%20cranelift%3A%20Add%20LibCalls%20to%20the%20interp.../near/295983173" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234782.20cranelift.3A.20Add.20LibCalls.20to.20the.20interp.2E.2E.2E.html#295983173">(Aug 29 2022 at 19:38)</a>:</h4>
<p>jameysharp submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4782#pullrequestreview-1089259376">PR review</a>.</p>



<a name="295983174"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234782%20cranelift%3A%20Add%20LibCalls%20to%20the%20interp.../near/295983174" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234782.20cranelift.3A.20Add.20LibCalls.20to.20the.20interp.2E.2E.2E.html#295983174">(Aug 29 2022 at 19:38)</a>:</h4>
<p>jameysharp created <a href="https://github.com/bytecodealliance/wasmtime/pull/4782#discussion_r957727172">PR review comment</a>:</p>
<blockquote>
<p>Ah, that makes sense. But this is weird for the same reason that the function references are: only outer fuzz target knows which functions and which libcalls are okay to call. So I think the set of allowed libcalls (and functions) should be provided by the fuzz target. But I also don't think that needs to block merging this PR, it's just something I think we should revisit soon.</p>
</blockquote>



<a name="295987275"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234782%20cranelift%3A%20Add%20LibCalls%20to%20the%20interp.../near/295987275" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234782.20cranelift.3A.20Add.20LibCalls.20to.20the.20interp.2E.2E.2E.html#295987275">(Aug 29 2022 at 19:53)</a>:</h4>
<p>afonso360 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4782#pullrequestreview-1089276340">PR review</a>.</p>



<a name="295987276"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234782%20cranelift%3A%20Add%20LibCalls%20to%20the%20interp.../near/295987276" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234782.20cranelift.3A.20Add.20LibCalls.20to.20the.20interp.2E.2E.2E.html#295987276">(Aug 29 2022 at 19:53)</a>:</h4>
<p>afonso360 created <a href="https://github.com/bytecodealliance/wasmtime/pull/4782#discussion_r957739093">PR review comment</a>:</p>
<blockquote>
<blockquote>
<p>So I think the set of allowed libcalls (and functions) should be provided by the fuzz target. </p>
</blockquote>
<p>I like that! </p>
<blockquote>
<p>But I also don't think that needs to block merging this PR, it's just something I think we should revisit soon.</p>
</blockquote>
<p><span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span> </p>
</blockquote>



<a name="295996885"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234782%20cranelift%3A%20Add%20LibCalls%20to%20the%20interp.../near/295996885" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234782.20cranelift.3A.20Add.20LibCalls.20to.20the.20interp.2E.2E.2E.html#295996885">(Aug 29 2022 at 20:36)</a>:</h4>
<p>jameysharp merged <a href="https://github.com/bytecodealliance/wasmtime/pull/4782">PR #4782</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>