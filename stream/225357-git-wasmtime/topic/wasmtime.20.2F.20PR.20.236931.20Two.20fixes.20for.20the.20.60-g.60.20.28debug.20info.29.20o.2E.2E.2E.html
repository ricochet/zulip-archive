<html>
<head><meta charset="utf-8"><title>wasmtime / PR #6931 Two fixes for the `-g` (debug info) o... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236931.20Two.20fixes.20for.20the.20.60-g.60.20.28debug.20info.29.20o.2E.2E.2E.html">wasmtime / PR #6931 Two fixes for the `-g` (debug info) o...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="388096495"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236931%20Two%20fixes%20for%20the%20%60-g%60%20%28debug%20info%29%20o.../near/388096495" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236931.20Two.20fixes.20for.20the.20.60-g.60.20.28debug.20info.29.20o.2E.2E.2E.html#388096495">(Aug 30 2023 at 12:36)</a>:</h4>
<p>SingleAccretion edited <a href="https://github.com/bytecodealliance/wasmtime/pull/6931">PR #6931</a>:</p>
<blockquote>
<p>Two changes:<br>
1) Fix a small bug where a constant DWARF "block" wasn't handled in transformation.<br>
2) Fix up instruction offsets after code emission to account for branch removal.</p>
<p>See also the commit messages for a bit more detail.</p>
<p>With these two changes, I am able to step through the code generated by the <a href="https://github.com/dotnet/runtimelab/tree/feature/NativeAOT-LLVM">compiler</a> we are working on.</p>
<p>Fixes #3999.<br>
</p>
</blockquote>



<a name="388100627"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236931%20Two%20fixes%20for%20the%20%60-g%60%20%28debug%20info%29%20o.../near/388100627" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236931.20Two.20fixes.20for.20the.20.60-g.60.20.28debug.20info.29.20o.2E.2E.2E.html#388100627">(Aug 30 2023 at 12:55)</a>:</h4>
<p>SingleAccretion updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6931">PR #6931</a>.</p>



<a name="388101057"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236931%20Two%20fixes%20for%20the%20%60-g%60%20%28debug%20info%29%20o.../near/388101057" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236931.20Two.20fixes.20for.20the.20.60-g.60.20.28debug.20info.29.20o.2E.2E.2E.html#388101057">(Aug 30 2023 at 12:57)</a>:</h4>
<p><strong>SingleAccretion</strong> has marked <a href="https://github.com/bytecodealliance/wasmtime/pull/6931">PR #6931</a> as ready for review.</p>



<a name="388101060"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236931%20Two%20fixes%20for%20the%20%60-g%60%20%28debug%20info%29%20o.../near/388101060" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236931.20Two.20fixes.20for.20the.20.60-g.60.20.28debug.20info.29.20o.2E.2E.2E.html#388101060">(Aug 30 2023 at 12:57)</a>:</h4>
<p><strong>SingleAccretion</strong> requested <a href="https://github.com/fitzgen">fitzgen</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/6931">PR #6931</a>.</p>



<a name="388101062"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236931%20Two%20fixes%20for%20the%20%60-g%60%20%28debug%20info%29%20o.../near/388101062" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236931.20Two.20fixes.20for.20the.20.60-g.60.20.28debug.20info.29.20o.2E.2E.2E.html#388101062">(Aug 30 2023 at 12:57)</a>:</h4>
<p><strong>SingleAccretion</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-compiler-reviewers">wasmtime-compiler-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/6931">PR #6931</a>.</p>



<a name="388101065"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236931%20Two%20fixes%20for%20the%20%60-g%60%20%28debug%20info%29%20o.../near/388101065" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236931.20Two.20fixes.20for.20the.20.60-g.60.20.28debug.20info.29.20o.2E.2E.2E.html#388101065">(Aug 30 2023 at 12:57)</a>:</h4>
<p><strong>SingleAccretion</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-default-reviewers">wasmtime-default-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/6931">PR #6931</a>.</p>



<a name="388101067"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236931%20Two%20fixes%20for%20the%20%60-g%60%20%28debug%20info%29%20o.../near/388101067" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236931.20Two.20fixes.20for.20the.20.60-g.60.20.28debug.20info.29.20o.2E.2E.2E.html#388101067">(Aug 30 2023 at 12:57)</a>:</h4>
<p><strong>SingleAccretion</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/6931">PR #6931</a>.</p>



<a name="388151067"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236931%20Two%20fixes%20for%20the%20%60-g%60%20%28debug%20info%29%20o.../near/388151067" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236931.20Two.20fixes.20for.20the.20.60-g.60.20.28debug.20info.29.20o.2E.2E.2E.html#388151067">(Aug 30 2023 at 16:20)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6931#pullrequestreview-1603065113">PR review</a>:</p>
<blockquote>
<p>Looks good to me!</p>
<p>Would it be possible to construct a somewhat minimal test case where the branch lowering messes up the offsets and we need to monotize them and add it to our debugging tests? Eg <a href="https://github.com/bytecodealliance/wasmtime/blob/main/tests/all/debug/lldb.rs#L62">https://github.com/bytecodealliance/wasmtime/blob/main/tests/all/debug/lldb.rs#L62</a></p>
</blockquote>



<a name="388152645"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236931%20Two%20fixes%20for%20the%20%60-g%60%20%28debug%20info%29%20o.../near/388152645" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236931.20Two.20fixes.20for.20the.20.60-g.60.20.28debug.20info.29.20o.2E.2E.2E.html#388152645">(Aug 30 2023 at 16:28)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6931#pullrequestreview-1603083045">PR review</a>.</p>



<a name="388152900"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236931%20Two%20fixes%20for%20the%20%60-g%60%20%28debug%20info%29%20o.../near/388152900" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236931.20Two.20fixes.20for.20the.20.60-g.60.20.28debug.20info.29.20o.2E.2E.2E.html#388152900">(Aug 30 2023 at 16:30)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6931#pullrequestreview-1603083045">PR review</a>.</p>



<a name="388153442"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236931%20Two%20fixes%20for%20the%20%60-g%60%20%28debug%20info%29%20o.../near/388153442" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236931.20Two.20fixes.20for.20the.20.60-g.60.20.28debug.20info.29.20o.2E.2E.2E.html#388153442">(Aug 30 2023 at 16:33)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/6931#discussion_r1310536263">PR review comment</a>:</p>
<blockquote>
<p>Hmm -- it's theoretically possible, if it were a block that had just a jump instruction, no fallthrough (previous block ended in an uncond branch), and we rewrote branches to this last block to go directly to the jump dest instead.</p>
<p>Perhaps you could pull out the result of <code>buffer.finish(...)</code> (which is where the last optimization call occurs) to before this line?</p>
</blockquote>



<a name="388156114"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236931%20Two%20fixes%20for%20the%20%60-g%60%20%28debug%20info%29%20o.../near/388156114" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236931.20Two.20fixes.20for.20the.20.60-g.60.20.28debug.20info.29.20o.2E.2E.2E.html#388156114">(Aug 30 2023 at 16:47)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/6931#discussion_r1310531586">PR review comment</a>:</p>
<blockquote>
<p>This does seem to leave an interesting corner case: if the very first instruction is a jump and is chomped (say because it's a jump to the fallthrough location, i.e. the next block), we artificially skip.</p>
<p>However I think it's OK for the following very subtle reason: we can only chomp back to an empty buffer (and hence have an offset of <code>0</code> on the non-first instruction) if we have one jump instruction (and nothing else) in the first block; MachBuffer will never chomp e.g. a cond+uncond pair to nothing. In the single-jump-inst case, that inst also has an offset of <code>0</code> so it's still monotonic.</p>
<p>Could we leave a comment to this effect?</p>
</blockquote>



<a name="388157846"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236931%20Two%20fixes%20for%20the%20%60-g%60%20%28debug%20info%29%20o.../near/388157846" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236931.20Two.20fixes.20for.20the.20.60-g.60.20.28debug.20info.29.20o.2E.2E.2E.html#388157846">(Aug 30 2023 at 16:57)</a>:</h4>
<p>SingleAccretion submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6931#pullrequestreview-1603137577">PR review</a>.</p>



<a name="388158126"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236931%20Two%20fixes%20for%20the%20%60-g%60%20%28debug%20info%29%20o.../near/388158126" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236931.20Two.20fixes.20for.20the.20.60-g.60.20.28debug.20info.29.20o.2E.2E.2E.html#388158126">(Aug 30 2023 at 16:59)</a>:</h4>
<p>SingleAccretion created <a href="https://github.com/bytecodealliance/wasmtime/pull/6931#discussion_r1310572384">PR review comment</a>:</p>
<blockquote>
<p>That is a great point you bring up.</p>
<blockquote>
<p>if we have one jump instruction (and nothing else) in the first block; MachBuffer will never chomp e.g. a cond+uncond pair to nothing. In the single-jump-inst case, that inst also has an offset of 0 so it's still monotonic.</p>
</blockquote>
<p>Am I right to understand that this is because of the VCode construction? I considered:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Block0</span>:
  <span class="nc">jmp</span><span class="w"> </span><span class="n">Block1</span>
<span class="w">  </span><span class="n">jmp</span><span class="w"> </span><span class="n">Block1</span>
<span class="n">Block1</span>:

<span class="p">;</span><span class="w"> </span><span class="n">Which</span><span class="w"> </span><span class="n">_can_</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">simplified</span><span class="w"> </span><span class="n">down</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">nothing</span><span class="p">.</span>
</code></pre></div>
<p>I was writing the comment as follows, does that match your expectation?</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="c1">// Not all instructions get their offsets recorded. As for the case where</span>
<span class="c1">// the offset is legitimately zero (first instruction), we are guaranteed</span>
<span class="c1">// that no more than one prior jump (which would also have been at a zero</span>
<span class="c1">// offset) could have been removed because the first block will not have</span>
<span class="c1">// multiple jumps.</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="388158443"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236931%20Two%20fixes%20for%20the%20%60-g%60%20%28debug%20info%29%20o.../near/388158443" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236931.20Two.20fixes.20for.20the.20.60-g.60.20.28debug.20info.29.20o.2E.2E.2E.html#388158443">(Aug 30 2023 at 17:00)</a>:</h4>
<p>SingleAccretion edited <a href="https://github.com/bytecodealliance/wasmtime/pull/6931#discussion_r1310572384">PR review comment</a>.</p>



<a name="388159204"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236931%20Two%20fixes%20for%20the%20%60-g%60%20%28debug%20info%29%20o.../near/388159204" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236931.20Two.20fixes.20for.20the.20.60-g.60.20.28debug.20info.29.20o.2E.2E.2E.html#388159204">(Aug 30 2023 at 17:04)</a>:</h4>
<p>SingleAccretion edited <a href="https://github.com/bytecodealliance/wasmtime/pull/6931#discussion_r1310572384">PR review comment</a>.</p>



<a name="388163392"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236931%20Two%20fixes%20for%20the%20%60-g%60%20%28debug%20info%29%20o.../near/388163392" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236931.20Two.20fixes.20for.20the.20.60-g.60.20.28debug.20info.29.20o.2E.2E.2E.html#388163392">(Aug 30 2023 at 17:31)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6931#pullrequestreview-1603189233">PR review</a>.</p>



<a name="388164054"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236931%20Two%20fixes%20for%20the%20%60-g%60%20%28debug%20info%29%20o.../near/388164054" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236931.20Two.20fixes.20for.20the.20.60-g.60.20.28debug.20info.29.20o.2E.2E.2E.html#388164054">(Aug 30 2023 at 17:35)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/6931#discussion_r1310608317">PR review comment</a>:</p>
<blockquote>
<p>I would replace the last bit with "... because either the first block will not have multiple branches, or else it would not have been completely elided."</p>
<p>This is related to your example: no block will have two unconditional branches; we emit only one "terminator" VCode instruction per block, and those are either one uncond, or a two-target form that is cond+uncond (or switch or ret, both of which are indirect).</p>
<p>(Additional subtlety just to allay any confusion: some pseudoinsts <em>do</em> emit branch insts internally, but those are completely invisible to the MachBuffer (i.e., not reported).)</p>
</blockquote>



<a name="388171422"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236931%20Two%20fixes%20for%20the%20%60-g%60%20%28debug%20info%29%20o.../near/388171422" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236931.20Two.20fixes.20for.20the.20.60-g.60.20.28debug.20info.29.20o.2E.2E.2E.html#388171422">(Aug 30 2023 at 18:22)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6931#pullrequestreview-1603269111">PR review</a>.</p>



<a name="388173012"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236931%20Two%20fixes%20for%20the%20%60-g%60%20%28debug%20info%29%20o.../near/388173012" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236931.20Two.20fixes.20for.20the.20.60-g.60.20.28debug.20info.29.20o.2E.2E.2E.html#388173012">(Aug 30 2023 at 18:32)</a>:</h4>
<p>SingleAccretion created <a href="https://github.com/bytecodealliance/wasmtime/pull/6931#discussion_r1310654029">PR review comment</a>:</p>
<blockquote>
<p>I've thought about this some more, and became less convinced it's a correct assumption. Consider:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Block0</span>:
  <span class="nc">jmp</span><span class="w"> </span><span class="n">Block2</span>
<span class="n">Block1</span>:
  <span class="nc">jmp</span><span class="w"> </span><span class="n">Block2</span>
<span class="n">Block2</span>:
</code></pre></div>
<p>(This can be fixed in a more obvious matter by using not-zero for the distinguished "invalid offset" value)</p>
</blockquote>



<a name="388174681"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236931%20Two%20fixes%20for%20the%20%60-g%60%20%28debug%20info%29%20o.../near/388174681" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236931.20Two.20fixes.20for.20the.20.60-g.60.20.28debug.20info.29.20o.2E.2E.2E.html#388174681">(Aug 30 2023 at 18:43)</a>:</h4>
<p>SingleAccretion edited <a href="https://github.com/bytecodealliance/wasmtime/pull/6931#discussion_r1310654029">PR review comment</a>.</p>



<a name="388180435"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236931%20Two%20fixes%20for%20the%20%60-g%60%20%28debug%20info%29%20o.../near/388180435" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236931.20Two.20fixes.20for.20the.20.60-g.60.20.28debug.20info.29.20o.2E.2E.2E.html#388180435">(Aug 30 2023 at 19:21)</a>:</h4>
<p>SingleAccretion created <a href="https://github.com/bytecodealliance/wasmtime/pull/6931#discussion_r1310717406">PR review comment</a>:</p>
<blockquote>
<p>These Unix exclusions are copy&amp;pasted with the assumption they're CI-induced. I verified the test passes on Windows.</p>
</blockquote>



<a name="388180504"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236931%20Two%20fixes%20for%20the%20%60-g%60%20%28debug%20info%29%20o.../near/388180504" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236931.20Two.20fixes.20for.20the.20.60-g.60.20.28debug.20info.29.20o.2E.2E.2E.html#388180504">(Aug 30 2023 at 19:21)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/6931#discussion_r1310719701">PR review comment</a>:</p>
<blockquote>
<p>Yeah it is a bit funky, but these tests are only force-enabled in some CI configurations.</p>
</blockquote>



<a name="388180508"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236931%20Two%20fixes%20for%20the%20%60-g%60%20%28debug%20info%29%20o.../near/388180508" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236931.20Two.20fixes.20for.20the.20.60-g.60.20.28debug.20info.29.20o.2E.2E.2E.html#388180508">(Aug 30 2023 at 19:21)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6931#pullrequestreview-1603353963">PR review</a>.</p>



<a name="388180836"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236931%20Two%20fixes%20for%20the%20%60-g%60%20%28debug%20info%29%20o.../near/388180836" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236931.20Two.20fixes.20for.20the.20.60-g.60.20.28debug.20info.29.20o.2E.2E.2E.html#388180836">(Aug 30 2023 at 19:23)</a>:</h4>
<p>SingleAccretion updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6931">PR #6931</a>.</p>



<a name="388182724"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236931%20Two%20fixes%20for%20the%20%60-g%60%20%28debug%20info%29%20o.../near/388182724" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236931.20Two.20fixes.20for.20the.20.60-g.60.20.28debug.20info.29.20o.2E.2E.2E.html#388182724">(Aug 30 2023 at 19:35)</a>:</h4>
<p>SingleAccretion submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6931#pullrequestreview-1603350900">PR review</a>.</p>



<a name="388184046"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236931%20Two%20fixes%20for%20the%20%60-g%60%20%28debug%20info%29%20o.../near/388184046" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236931.20Two.20fixes.20for.20the.20.60-g.60.20.28debug.20info.29.20o.2E.2E.2E.html#388184046">(Aug 30 2023 at 19:44)</a>:</h4>
<p>SingleAccretion submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6931#pullrequestreview-1603259960">PR review</a>.</p>



<a name="388184626"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236931%20Two%20fixes%20for%20the%20%60-g%60%20%28debug%20info%29%20o.../near/388184626" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236931.20Two.20fixes.20for.20the.20.60-g.60.20.28debug.20info.29.20o.2E.2E.2E.html#388184626">(Aug 30 2023 at 19:48)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/6931#discussion_r1310659506">PR review comment</a>:</p>
<blockquote>
<p>Ah! Yes, indeed, that's the far more sensible solution. (One might be tempted to make it a <code>Vec&lt;Option&lt;CodeOffset&gt;&gt;</code> but for memory-efficiency let's define a sentinel value e.g. <code>const NO_INST_OFFSET: CodeOffset = u32::MAX</code> maybe?)</p>
</blockquote>



<a name="388188458"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236931%20Two%20fixes%20for%20the%20%60-g%60%20%28debug%20info%29%20o.../near/388188458" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236931.20Two.20fixes.20for.20the.20.60-g.60.20.28debug.20info.29.20o.2E.2E.2E.html#388188458">(Aug 30 2023 at 20:14)</a>:</h4>
<p>SingleAccretion updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6931">PR #6931</a>.</p>



<a name="388560454"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236931%20Two%20fixes%20for%20the%20%60-g%60%20%28debug%20info%29%20o.../near/388560454" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236931.20Two.20fixes.20for.20the.20.60-g.60.20.28debug.20info.29.20o.2E.2E.2E.html#388560454">(Sep 01 2023 at 16:39)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6931#pullrequestreview-1607309884">PR review</a>:</p>
<blockquote>
<p>Latest changes LGTM to me -- thanks very much for this!</p>
</blockquote>



<a name="388571209"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236931%20Two%20fixes%20for%20the%20%60-g%60%20%28debug%20info%29%20o.../near/388571209" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236931.20Two.20fixes.20for.20the.20.60-g.60.20.28debug.20info.29.20o.2E.2E.2E.html#388571209">(Sep 01 2023 at 17:42)</a>:</h4>
<p>cfallin merged <a href="https://github.com/bytecodealliance/wasmtime/pull/6931">PR #6931</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>