<html>
<head><meta charset="utf-8"><title>wasmtime / issue #9823 Bindgen improvement: Remove the us... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239823.20Bindgen.20improvement.3A.20Remove.20the.20us.2E.2E.2E.html">wasmtime / issue #9823 Bindgen improvement: Remove the us...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="489004180"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239823%20Bindgen%20improvement%3A%20Remove%20the%20us.../near/489004180" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239823.20Bindgen.20improvement.3A.20Remove.20the.20us.2E.2E.2E.html#489004180">(Dec 14 2024 at 15:40)</a>:</h4>
<p>ifsheldon opened <a href="https://github.com/bytecodealliance/wasmtime/issues/9823">issue #9823</a>:</p>
<blockquote>
<h4>Feature</h4>
<p>Remove the use of <code>async_trait</code> in <code>bindgen!</code> as per <a href="https://github.com/bytecodealliance/wasmtime/issues/9776#issuecomment-2539971806">https://github.com/bytecodealliance/wasmtime/issues/9776#issuecomment-2539971806</a>. Use async fn in traits, RPITIT and <code>trait_variant</code> instead.</p>
<h4>Benefit</h4>
<p>Removing <code>async_trait</code> simplifies the generated code by <code>bindgen!</code> a lot. This can also drastically improve IDE experience as IDEs have better support for async fn in traits and RPITIT. Coding experience should be much better as well, as programmers can just use <code>async fn</code> when implementing autogenerated traits by <code>bindgen</code> in async mode.</p>
<h4>Implementation</h4>
<p>Note: I don't have time to dig into details now, so this issue is primary for tracking. Probably someone can tag this as "good first issue" :)</p>
<p>Just search for <code>::async_trait</code> in the source code of <code>wit-bindgen</code> crate:</p>
<p><a href="https://github.com/search?q=repo%3Abytecodealliance%2Fwasmtime+path%3A%2F%5Ecrates%5C%2Fwit-bindgen%5C%2F%2F+%3A%3Aasync_trait&amp;type=code">https://github.com/search?q=repo%3Abytecodealliance%2Fwasmtime+path%3A%2F%5Ecrates%5C%2Fwit-bindgen%5C%2F%2F+%3A%3Aasync_trait&amp;type=code</a></p>
<p>There are not many occurrences to my surprise.</p>
<p>&lt;img width="620" alt="image" src="<a href="https://github.com/user-attachments/assets/f940bf0b-3100-4069-9234-2f619394413a">https://github.com/user-attachments/assets/f940bf0b-3100-4069-9234-2f619394413a</a>" /&gt;</p>
<p>In theory, we need to generate something like:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#[trait_variant::make(HostX: Send)]</span>
<span class="k">pub</span><span class="w"> </span><span class="k">trait</span><span class="w"> </span><span class="n">LocalHostX</span><span class="w"> </span><span class="p">{</span>
<span class="c1">//...</span>
<span class="p">}</span>
</code></pre></div>
<p>instead of </p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#[async_trait]</span>
<span class="k">pub</span><span class="w"> </span><span class="k">trait</span><span class="w"> </span><span class="n">HostX</span><span class="w"> </span><span class="p">{</span>
<span class="c1">//...</span>
<span class="p">}</span>
</code></pre></div>
<p>cc @alexcrichton <br>
</p>
</blockquote>



<a name="490200985"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239823%20Bindgen%20improvement%3A%20Remove%20the%20us.../near/490200985" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239823.20Bindgen.20improvement.3A.20Remove.20the.20us.2E.2E.2E.html#490200985">(Dec 20 2024 at 17:12)</a>:</h4>
<p>alexcrichton closed <a href="https://github.com/bytecodealliance/wasmtime/issues/9823">issue #9823</a>:</p>
<blockquote>
<h4>Feature</h4>
<p>Remove the use of <code>async_trait</code> in <code>bindgen!</code> as per <a href="https://github.com/bytecodealliance/wasmtime/issues/9776#issuecomment-2539971806">https://github.com/bytecodealliance/wasmtime/issues/9776#issuecomment-2539971806</a>. Use async fn in traits, RPITIT and <code>trait_variant</code> instead.</p>
<h4>Benefit</h4>
<p>Removing <code>async_trait</code> simplifies the generated code by <code>bindgen!</code> a lot. This can also drastically improve IDE experience as IDEs have better support for async fn in traits and RPITIT. Coding experience should be much better as well, as programmers can just use <code>async fn</code> when implementing autogenerated traits by <code>bindgen</code> in async mode.</p>
<h4>Implementation</h4>
<p>Note: I don't have time to dig into details now, so this issue is primary for tracking. Probably someone can tag this as "good first issue" :)</p>
<p>Just search for <code>::async_trait</code> in the source code of <code>wit-bindgen</code> crate:</p>
<p><a href="https://github.com/search?q=repo%3Abytecodealliance%2Fwasmtime+path%3A%2F%5Ecrates%5C%2Fwit-bindgen%5C%2F%2F+%3A%3Aasync_trait&amp;type=code">https://github.com/search?q=repo%3Abytecodealliance%2Fwasmtime+path%3A%2F%5Ecrates%5C%2Fwit-bindgen%5C%2F%2F+%3A%3Aasync_trait&amp;type=code</a></p>
<p>There are not many occurrences to my surprise.</p>
<p>&lt;img width="620" alt="image" src="<a href="https://github.com/user-attachments/assets/f940bf0b-3100-4069-9234-2f619394413a">https://github.com/user-attachments/assets/f940bf0b-3100-4069-9234-2f619394413a</a>" /&gt;</p>
<p>In theory, we need to generate something like:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#[trait_variant::make(HostX: Send)]</span>
<span class="k">pub</span><span class="w"> </span><span class="k">trait</span><span class="w"> </span><span class="n">LocalHostX</span><span class="w"> </span><span class="p">{</span>
<span class="c1">//...</span>
<span class="p">}</span>
</code></pre></div>
<p>instead of </p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#[async_trait]</span>
<span class="k">pub</span><span class="w"> </span><span class="k">trait</span><span class="w"> </span><span class="n">HostX</span><span class="w"> </span><span class="p">{</span>
<span class="c1">//...</span>
<span class="p">}</span>
</code></pre></div>
<p>cc @alexcrichton <br>
</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>