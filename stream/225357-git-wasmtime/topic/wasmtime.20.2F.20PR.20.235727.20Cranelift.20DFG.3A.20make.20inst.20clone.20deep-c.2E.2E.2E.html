<html>
<head><meta charset="utf-8"><title>wasmtime / PR #5727 Cranelift DFG: make inst clone deep-c... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235727.20Cranelift.20DFG.3A.20make.20inst.20clone.20deep-c.2E.2E.2E.html">wasmtime / PR #5727 Cranelift DFG: make inst clone deep-c...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="326251625"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235727%20Cranelift%20DFG%3A%20make%20inst%20clone%20deep-c.../near/326251625" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235727.20Cranelift.20DFG.3A.20make.20inst.20clone.20deep-c.2E.2E.2E.html#326251625">(Feb 06 2023 at 22:36)</a>:</h4>
<p>cfallin opened <a href="https://github.com/bytecodealliance/wasmtime/pull/5727">PR #5727</a> from <code>fix-inst-clone</code> to <code>main</code>:</p>
<blockquote>
<p>When investigating #5716, I found that rematerialization of a <code>call</code>, in<br>
addition to blowing up for other reasons, caused aliasing of the varargs<br>
list (the <code>EntityList</code> in the <code>ListPool</code>), such that editing the args of<br>
the second copy of the call instruction inadvertently updated the first<br>
as well.</p>
<p>This PR modifies <code>DataFlowGraph::clone_inst</code> so that it always clones<br>
the varargs list if present. This shouldn't have any functional impact<br>
on Cranelift today, because we don't rematerialize any instructions with<br>
varargs; but it's important to get it right to avoid a bug later!</p>
<p>(Stacked on top of #5726.)</p>
</blockquote>



<a name="326251626"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235727%20Cranelift%20DFG%3A%20make%20inst%20clone%20deep-c.../near/326251626" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235727.20Cranelift.20DFG.3A.20make.20inst.20clone.20deep-c.2E.2E.2E.html#326251626">(Feb 06 2023 at 22:36)</a>:</h4>
<p><strong>cfallin</strong> requested <a href="https://github.com/elliottt">elliottt</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/5727">PR #5727</a>.</p>



<a name="326251628"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235727%20Cranelift%20DFG%3A%20make%20inst%20clone%20deep-c.../near/326251628" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235727.20Cranelift.20DFG.3A.20make.20inst.20clone.20deep-c.2E.2E.2E.html#326251628">(Feb 06 2023 at 22:36)</a>:</h4>
<p><strong>cfallin</strong> requested <a href="https://github.com/fitzgen">fitzgen</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/5727">PR #5727</a>.</p>



<a name="326251629"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235727%20Cranelift%20DFG%3A%20make%20inst%20clone%20deep-c.../near/326251629" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235727.20Cranelift.20DFG.3A.20make.20inst.20clone.20deep-c.2E.2E.2E.html#326251629">(Feb 06 2023 at 22:36)</a>:</h4>
<p><strong>cfallin</strong> requested <a href="https://github.com/jameysharp">jameysharp</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/5727">PR #5727</a>.</p>



<a name="326252954"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235727%20Cranelift%20DFG%3A%20make%20inst%20clone%20deep-c.../near/326252954" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235727.20Cranelift.20DFG.3A.20make.20inst.20clone.20deep-c.2E.2E.2E.html#326252954">(Feb 06 2023 at 22:45)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5727">PR #5727</a> from <code>fix-inst-clone</code> to <code>main</code>.</p>



<a name="326253020"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235727%20Cranelift%20DFG%3A%20make%20inst%20clone%20deep-c.../near/326253020" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235727.20Cranelift.20DFG.3A.20make.20inst.20clone.20deep-c.2E.2E.2E.html#326253020">(Feb 06 2023 at 22:46)</a>:</h4>
<p>cfallin edited <a href="https://github.com/bytecodealliance/wasmtime/pull/5727">PR #5727</a> from <code>fix-inst-clone</code> to <code>main</code>:</p>
<blockquote>
<p>When investigating #5716, I found that rematerialization of a <code>call</code>, in<br>
addition to blowing up for other reasons, caused aliasing of the varargs<br>
list (the <code>EntityList</code> in the <code>ListPool</code>), such that editing the args of<br>
the second copy of the call instruction inadvertently updated the first<br>
as well.</p>
<p>This PR modifies <code>DataFlowGraph::clone_inst</code> so that it always clones<br>
the varargs list if present. This shouldn't have any functional impact<br>
on Cranelift today, because we don't rematerialize any instructions with<br>
varargs; but it's important to get it right to avoid a bug later!</p>
</blockquote>



<a name="326264840"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235727%20Cranelift%20DFG%3A%20make%20inst%20clone%20deep-c.../near/326264840" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235727.20Cranelift.20DFG.3A.20make.20inst.20clone.20deep-c.2E.2E.2E.html#326264840">(Feb 07 2023 at 00:40)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5727">PR #5727</a> from <code>fix-inst-clone</code> to <code>main</code>.</p>



<a name="326265871"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235727%20Cranelift%20DFG%3A%20make%20inst%20clone%20deep-c.../near/326265871" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235727.20Cranelift.20DFG.3A.20make.20inst.20clone.20deep-c.2E.2E.2E.html#326265871">(Feb 07 2023 at 00:50)</a>:</h4>
<p>jameysharp submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5727#pullrequestreview-1286229397">PR review</a>.</p>



<a name="326266721"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235727%20Cranelift%20DFG%3A%20make%20inst%20clone%20deep-c.../near/326266721" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235727.20Cranelift.20DFG.3A.20make.20inst.20clone.20deep-c.2E.2E.2E.html#326266721">(Feb 07 2023 at 01:00)</a>:</h4>
<p>cfallin has enabled auto merge for <a href="https://github.com/bytecodealliance/wasmtime/pull/5727">PR #5727</a>.</p>



<a name="326268423"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235727%20Cranelift%20DFG%3A%20make%20inst%20clone%20deep-c.../near/326268423" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235727.20Cranelift.20DFG.3A.20make.20inst.20clone.20deep-c.2E.2E.2E.html#326268423">(Feb 07 2023 at 01:21)</a>:</h4>
<p>cfallin merged <a href="https://github.com/bytecodealliance/wasmtime/pull/5727">PR #5727</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>