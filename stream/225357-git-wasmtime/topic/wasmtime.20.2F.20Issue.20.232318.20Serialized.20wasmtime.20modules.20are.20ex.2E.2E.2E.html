<html>
<head><meta charset="utf-8"><title>wasmtime / Issue #2318 Serialized wasmtime modules are ex... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232318.20Serialized.20wasmtime.20modules.20are.20ex.2E.2E.2E.html">wasmtime / Issue #2318 Serialized wasmtime modules are ex...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="214513502"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232318%20Serialized%20wasmtime%20modules%20are%20ex.../near/214513502" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232318.20Serialized.20wasmtime.20modules.20are.20ex.2E.2E.2E.html#214513502">(Oct 25 2020 at 21:28)</a>:</h4>
<p>whitequark opened <a href="https://github.com/bytecodealliance/wasmtime/issues/2318">Issue #2318</a>:</p>
<blockquote>
<p>I'm using custom module serialization based caching in <a href="https://yowasp.org">YoWASP</a>, primarily to be able to show a message during cold startup (which can take many minutes on slow machines), but also to avoid applying zstd compression that noticeably increases startup latency. </p>
<p>The problem is that the cached modules are extremely large—so large that it causes a near-pathological amount of disk I/O. On Linux, <a href="https://github.com/bytecodealliance/wasmtime/files/5436001/yosys.wasm.zip">yosys.wasm</a><br>
 (21M wasm file) results in a 290M serialized module, an increase of ~14×. On Windows, for some reason, that very same file results in a ~580M serialized module, an increase of ~28×. The native Yosys binary for x86_64 is 17M; even once you account for libc and libstdc++, it really should not take over half a gigabyte of space.</p>
<p>I'm filing this issue on request of @alexcrichton <a href="https://github.com/bytecodealliance/wasmtime-py/pull/43#issuecomment-716211943">here</a>.</p>
</blockquote>



<a name="214513508"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232318%20Serialized%20wasmtime%20modules%20are%20ex.../near/214513508" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232318.20Serialized.20wasmtime.20modules.20are.20ex.2E.2E.2E.html#214513508">(Oct 25 2020 at 21:28)</a>:</h4>
<p>whitequark edited <a href="https://github.com/bytecodealliance/wasmtime/issues/2318">Issue #2318</a>:</p>
<blockquote>
<p>I'm using custom module serialization based caching in <a href="https://yowasp.org">YoWASP</a>, primarily to be able to show a message during cold startup (which can take many minutes on slow machines), but also to avoid applying zstd compression that noticeably increases startup latency. </p>
<p>The problem is that the cached modules are extremely large—so large that it causes a near-pathological amount of disk I/O. On Linux, <a href="https://github.com/bytecodealliance/wasmtime/files/5436001/yosys.wasm.zip">yosys.wasm</a> (21M wasm file) results in a 290M serialized module, an increase of ~14×. On Windows, for some reason, that very same file results in a ~580M serialized module, an increase of ~28×. The native Yosys binary for x86_64 is 17M; even once you account for libc and libstdc++, it really should not take over half a gigabyte of space.</p>
<p>I'm filing this issue on request of @alexcrichton <a href="https://github.com/bytecodealliance/wasmtime-py/pull/43#issuecomment-716211943">here</a>.</p>
</blockquote>



<a name="214513526"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232318%20Serialized%20wasmtime%20modules%20are%20ex.../near/214513526" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232318.20Serialized.20wasmtime.20modules.20are.20ex.2E.2E.2E.html#214513526">(Oct 25 2020 at 21:28)</a>:</h4>
<p>whitequark <a href="https://github.com/bytecodealliance/wasmtime/issues/2318#issuecomment-716214807">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2318">Issue #2318</a>:</p>
<blockquote>
<p>Oh and the script that runs it is <a href="https://github.com/YoWASP/yosys/blob/develop/pypi/yowasp_yosys/__init__.py">here</a>. It's extremely simple but maybe I forgot something important.</p>
</blockquote>



<a name="214513555"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232318%20Serialized%20wasmtime%20modules%20are%20ex.../near/214513555" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232318.20Serialized.20wasmtime.20modules.20are.20ex.2E.2E.2E.html#214513555">(Oct 25 2020 at 21:29)</a>:</h4>
<p>whitequark edited <a href="https://github.com/bytecodealliance/wasmtime/issues/2318">Issue #2318</a>:</p>
<blockquote>
<p>I'm using custom module serialization based caching in <a href="https://yowasp.org">YoWASP</a>, primarily to be able to show a message during cold startup (which can take many minutes on slow machines), but also to avoid applying zstd compression that noticeably increases warm startup latency. </p>
<p>The problem is that the cached modules are extremely large—so large that it causes a near-pathological amount of disk I/O. (On Windows VMs, due to the I/O, warm startup actually becomes slower. On bare metal Windows on SSDs it still gets faster.)</p>
<p>On Linux, <a href="https://github.com/bytecodealliance/wasmtime/files/5436001/yosys.wasm.zip">yosys.wasm</a> (21M wasm file) results in a 290M serialized module, an increase of ~14×. On Windows, for some reason, that very same file results in a ~580M serialized module, an increase of ~28×. The native Yosys binary for x86_64 is 17M; even once you account for libc and libstdc++, it really should not take over half a gigabyte of space.</p>
<p>I'm filing this issue on request of @alexcrichton <a href="https://github.com/bytecodealliance/wasmtime-py/pull/43#issuecomment-716211943">here</a>.</p>
</blockquote>



<a name="214513623"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232318%20Serialized%20wasmtime%20modules%20are%20ex.../near/214513623" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232318.20Serialized.20wasmtime.20modules.20are.20ex.2E.2E.2E.html#214513623">(Oct 25 2020 at 21:30)</a>:</h4>
<p>whitequark edited <a href="https://github.com/bytecodealliance/wasmtime/issues/2318">Issue #2318</a>:</p>
<blockquote>
<p>I'm using custom module serialization based caching in <a href="https://yowasp.org">YoWASP</a>, primarily to be able to show a message during cold startup (which can take many minutes on slow machines), but also to avoid applying zstd compression that noticeably increases warm startup latency. </p>
<p>The problem is that the cached modules are extremely large—so large that it causes a near-pathological amount of disk I/O. (On Windows VMs, due to the I/O, warm startup actually becomes slower compared to wasmtime's own caching. On bare metal Windows on SSDs it still gets faster.)</p>
<p>On Linux, <a href="https://github.com/bytecodealliance/wasmtime/files/5436001/yosys.wasm.zip">yosys.wasm</a> (21M wasm file) results in a 290M serialized module, an increase of ~14×. On Windows, for some reason, that very same file results in a ~580M serialized module, an increase of ~28×. The native Yosys binary for x86_64 is 17M; even once you account for libc and libstdc++, it really should not take over half a gigabyte of space.</p>
<p>I'm filing this issue on request of @alexcrichton <a href="https://github.com/bytecodealliance/wasmtime-py/pull/43#issuecomment-716211943">here</a>.</p>
</blockquote>



<a name="214520509"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232318%20Serialized%20wasmtime%20modules%20are%20ex.../near/214520509" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232318.20Serialized.20wasmtime.20modules.20are.20ex.2E.2E.2E.html#214520509">(Oct 26 2020 at 00:05)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/2318#issuecomment-716235921">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2318">Issue #2318</a>:</p>
<blockquote>
<p>The cache entry size is effectively the bincode-coded size of <a href="https://github.com/bytecodealliance/wasmtime/blob/fc1cedb2ff43e4b31bcc8f99ef069d5a2d189899/crates/jit/src/instantiate.rs#L53-L73">this structure</a>, which I believe is roughly analagous to the in-memory size of that structure. Adding some simple instrumentation I was able to get the encoded byte size of each of the fields:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">module</span>:                  <span class="mi">152817</span><span class="w"></span>
<span class="n">obj</span>:                   <span class="mi">56236896</span><span class="w"></span>
<span class="n">funcs</span>:                <span class="mi">242146780</span><span class="w"></span>
<span class="w">  </span><span class="n">funcs</span><span class="p">(</span><span class="n">traps</span><span class="p">)</span>:                <span class="mi">24182940</span><span class="w"></span>
<span class="w">  </span><span class="n">funcs</span><span class="p">(</span><span class="n">address_map</span><span class="p">)</span>:         <span class="mi">217774640</span><span class="w"></span>
<span class="w">  </span><span class="n">funcs</span><span class="p">(</span><span class="n">stack_maps</span><span class="p">)</span>:             <span class="mi">189216</span><span class="w"></span>
<span class="n">data_initializers</span>:      <span class="mi">2880584</span><span class="w"></span>
<span class="n">unwind_info</span>:            <span class="mi">4611040</span><span class="w"></span>
<span class="n">total</span>:                <span class="mi">306028126</span><span class="w"></span>
</code></pre></div>

<p>clearly <code>funcs</code> is the massive field (too much so), and the worst offenders are the <code>traps</code> and <code>address_maps</code> maps. Neither of these maps really justifies taking up so much space, and longer-term we need to have a more serious refactoring to probably encode these entirely different in a much more compact fashion. The consumer, however, relies on random-access right now (or at least the ability to do a binary search), so it won't be immediately trivial to restructure these data structures. In the meantime <a href="https://github.com/bytecodealliance/wasmtime/pull/2321">https://github.com/bytecodealliance/wasmtime/pull/2321</a> should be a band-aid for now to make it a bit more reasonable (although still pretty unreasonable).</p>
<p>I've yet to investigate the Windows discrepancy here, that's quite worrisome too!</p>
</blockquote>



<a name="214520557"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232318%20Serialized%20wasmtime%20modules%20are%20ex.../near/214520557" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232318.20Serialized.20wasmtime.20modules.20are.20ex.2E.2E.2E.html#214520557">(Oct 26 2020 at 00:06)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/2318#issuecomment-716236004">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2318">Issue #2318</a>:</p>
<blockquote>
<p>Oh and after that PR, the breakdown looks like:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">module</span>:                  <span class="mi">152817</span><span class="w"></span>
<span class="n">obj</span>:                   <span class="mi">56236896</span><span class="w"></span>
<span class="n">funcs</span>:                 <span class="mi">97596780</span><span class="w"></span>
<span class="w">  </span><span class="n">funcs</span><span class="p">(</span><span class="n">traps</span><span class="p">)</span>:                <span class="mi">24182940</span><span class="w"></span>
<span class="w">  </span><span class="n">funcs</span><span class="p">(</span><span class="n">address_map</span><span class="p">)</span>:          <span class="mi">73224640</span><span class="w"></span>
<span class="w">  </span><span class="n">funcs</span><span class="p">(</span><span class="n">stack_maps</span><span class="p">)</span>:             <span class="mi">189216</span><span class="w"></span>
<span class="n">data_initializers</span>:      <span class="mi">2880584</span><span class="w"></span>
<span class="n">unwind_info</span>:            <span class="mi">4611040</span><span class="w"></span>
<span class="n">total</span>:                <span class="mi">161478126</span><span class="w"></span>
</code></pre></div>

</blockquote>



<a name="214658747"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232318%20Serialized%20wasmtime%20modules%20are%20ex.../near/214658747" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232318.20Serialized.20wasmtime.20modules.20are.20ex.2E.2E.2E.html#214658747">(Oct 27 2020 at 03:43)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/2318#issuecomment-716960042">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2318">Issue #2318</a>:</p>
<blockquote>
<p>Ok I've got one more linked improvement as well as <a href="https://github.com/bytecodealliance/wasmtime/pull/2326">https://github.com/bytecodealliance/wasmtime/pull/2326</a> which should account for the discrepancy on Windows.</p>
</blockquote>



<a name="215018852"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232318%20Serialized%20wasmtime%20modules%20are%20ex.../near/215018852" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232318.20Serialized.20wasmtime.20modules.20are.20ex.2E.2E.2E.html#215018852">(Oct 29 2020 at 19:51)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/2318#issuecomment-718983138">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2318">Issue #2318</a>:</p>
<blockquote>
<p>With current master plus <a href="https://github.com/bytecodealliance/wasmtime/pull/2324">https://github.com/bytecodealliance/wasmtime/pull/2324</a> the cache entry size of the original wasm module is down to 97MB, and the cache entry sizes should be roughly the same on Linux and Windows. @whitequark  for your use cases is that still too large? It's still pretty large  having a &gt;4x size increase, but further changes may require more invasive tweaks than the low hanging fruit picked off so far.</p>
</blockquote>



<a name="215063033"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232318%20Serialized%20wasmtime%20modules%20are%20ex.../near/215063033" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232318.20Serialized.20wasmtime.20modules.20are.20ex.2E.2E.2E.html#215063033">(Oct 30 2020 at 07:30)</a>:</h4>
<p>whitequark <a href="https://github.com/bytecodealliance/wasmtime/issues/2318#issuecomment-719349711">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2318">Issue #2318</a>:</p>
<blockquote>
<blockquote>
<p>for your use cases is that still too large?</p>
</blockquote>
<p>Seems excellent to me. Any chance you can do a point release of wasmtime-py with the updated interpreter? I have to test on a fairly heterogenous set of machines so it'd be much easier if I didn't have to distribute patched wheels as well.</p>
</blockquote>



<a name="215138447"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232318%20Serialized%20wasmtime%20modules%20are%20ex.../near/215138447" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232318.20Serialized.20wasmtime.20modules.20are.20ex.2E.2E.2E.html#215138447">(Oct 30 2020 at 19:12)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/2318#issuecomment-719745008">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2318">Issue #2318</a>:</p>
<blockquote>
<p>Sure! I'll wait until #2324 is in and then I'll do a release of wasmtime</p>
</blockquote>



<a name="215157168"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232318%20Serialized%20wasmtime%20modules%20are%20ex.../near/215157168" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232318.20Serialized.20wasmtime.20modules.20are.20ex.2E.2E.2E.html#215157168">(Oct 30 2020 at 22:15)</a>:</h4>
<p>fitzgen <a href="https://github.com/bytecodealliance/wasmtime/issues/2318#issuecomment-719823892">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2318">Issue #2318</a>:</p>
<blockquote>
<p>I don't know how easy <code>bincode</code> is to extend, but all the address-keyed func data could probably compress really well if we used deltas instead of absolute values combined with a variable length integer encoding (e.g. LEB128).</p>
</blockquote>



<a name="215157189"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232318%20Serialized%20wasmtime%20modules%20are%20ex.../near/215157189" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232318.20Serialized.20wasmtime.20modules.20are.20ex.2E.2E.2E.html#215157189">(Oct 30 2020 at 22:15)</a>:</h4>
<p>fitzgen <a href="https://github.com/bytecodealliance/wasmtime/issues/2318#issuecomment-719824029">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2318">Issue #2318</a>:</p>
<blockquote>
<p>(and we ensured they were sorted)</p>
</blockquote>



<a name="215601947"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232318%20Serialized%20wasmtime%20modules%20are%20ex.../near/215601947" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232318.20Serialized.20wasmtime.20modules.20are.20ex.2E.2E.2E.html#215601947">(Nov 04 2020 at 16:03)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/2318#issuecomment-721820292">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2318">Issue #2318</a>:</p>
<blockquote>
<p>@fitzgen turns out bincode <a href="https://github.com/bytecodealliance/wasmtime/pull/2322">has an option for just that</a>!</p>
</blockquote>



<a name="215732088"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232318%20Serialized%20wasmtime%20modules%20are%20ex.../near/215732088" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232318.20Serialized.20wasmtime.20modules.20are.20ex.2E.2E.2E.html#215732088">(Nov 05 2020 at 16:00)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/2318#issuecomment-722469405">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2318">Issue #2318</a>:</p>
<blockquote>
<p>Ok wasmtime-py 0.21.0 is now published @whitequark if you'd be able to test it out</p>
</blockquote>



<a name="215732299"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232318%20Serialized%20wasmtime%20modules%20are%20ex.../near/215732299" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232318.20Serialized.20wasmtime.20modules.20are.20ex.2E.2E.2E.html#215732299">(Nov 05 2020 at 16:01)</a>:</h4>
<p>whitequark <a href="https://github.com/bytecodealliance/wasmtime/issues/2318#issuecomment-722470143">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2318">Issue #2318</a>:</p>
<blockquote>
<p>I'll take a look over the next few days!</p>
</blockquote>



<a name="215732723"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232318%20Serialized%20wasmtime%20modules%20are%20ex.../near/215732723" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232318.20Serialized.20wasmtime.20modules.20are.20ex.2E.2E.2E.html#215732723">(Nov 05 2020 at 16:04)</a>:</h4>
<p>whitequark <a href="https://github.com/bytecodealliance/wasmtime/issues/2318#issuecomment-722471632">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2318">Issue #2318</a>:</p>
<blockquote>
<p>Were there any breaking changes? It's a bit unfortunate that I'll have to rebuild all the packages as that makes it a bit harder to get other people to compare several different versions.</p>
</blockquote>



<a name="215735526"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232318%20Serialized%20wasmtime%20modules%20are%20ex.../near/215735526" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232318.20Serialized.20wasmtime.20modules.20are.20ex.2E.2E.2E.html#215735526">(Nov 05 2020 at 16:19)</a>:</h4>
<p>whitequark <a href="https://github.com/bytecodealliance/wasmtime/issues/2318#issuecomment-722481093">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2318">Issue #2318</a>:</p>
<blockquote>
<p>I've rebuilt yowasp-yosys and yowasp-nextpnr-ice40 with wasmtime 0.21.0 on my Linux machine.</p>
<p>* Yosys: 291M→94M cache file size improvement, ~2x warm startup latency improvement (wow!!);<br>
  * nextpnr-ice40: 23M→6.9M cache file size improvement, warm startup latency changes within noise threshold.</p>
</blockquote>



<a name="215737106"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232318%20Serialized%20wasmtime%20modules%20are%20ex.../near/215737106" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232318.20Serialized.20wasmtime.20modules.20are.20ex.2E.2E.2E.html#215737106">(Nov 05 2020 at 16:29)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/2318#issuecomment-722487183">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2318">Issue #2318</a>:</p>
<blockquote>
<p>Right now our release process for wasmtime is just "major bump everything", and we're then trying to keep the external packages like wasmtime-py and wasmtime-go in sync with the main repo. We should probably allocate space to have minor version bumps of everything as well though...</p>
<p>Glad to hear the results as well!</p>
</blockquote>



<a name="215737518"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232318%20Serialized%20wasmtime%20modules%20are%20ex.../near/215737518" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232318.20Serialized.20wasmtime.20modules.20are.20ex.2E.2E.2E.html#215737518">(Nov 05 2020 at 16:31)</a>:</h4>
<p>whitequark <a href="https://github.com/bytecodealliance/wasmtime/issues/2318#issuecomment-722488506">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2318">Issue #2318</a>:</p>
<blockquote>
<p>Ah ok if it's in sync with the main repo then it might actually be pretty handy. I wasn't sure exactly how it worked.</p>
</blockquote>



<a name="215784678"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232318%20Serialized%20wasmtime%20modules%20are%20ex.../near/215784678" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232318.20Serialized.20wasmtime.20modules.20are.20ex.2E.2E.2E.html#215784678">(Nov 05 2020 at 22:53)</a>:</h4>
<p>whitequark <a href="https://github.com/bytecodealliance/wasmtime/issues/2318#issuecomment-722691601">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2318">Issue #2318</a>:</p>
<blockquote>
<p>@alexcrichton I've tried running yowasp-yosys and yowasp-nextpnr-ice40 on the cheapest and slowest laptop I found nearby, and it's only something like 2× slower on both cold and warm startup than my XPS 13. I have no idea how you managed to achieve that, and I'm quite impressed. As far as I'm concerned this is enough performance.</p>
</blockquote>



<a name="215784679"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232318%20Serialized%20wasmtime%20modules%20are%20ex.../near/215784679" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232318.20Serialized.20wasmtime.20modules.20are.20ex.2E.2E.2E.html#215784679">(Nov 05 2020 at 22:53)</a>:</h4>
<p>whitequark closed <a href="https://github.com/bytecodealliance/wasmtime/issues/2318">Issue #2318</a>:</p>
<blockquote>
<p>I'm using custom module serialization based caching in <a href="https://yowasp.org">YoWASP</a>, primarily to be able to show a message during cold startup (which can take many minutes on slow machines), but also to avoid applying zstd compression that noticeably increases warm startup latency. </p>
<p>The problem is that the cached modules are extremely large—so large that it causes a near-pathological amount of disk I/O. (On Windows VMs, due to the I/O, warm startup actually becomes slower compared to wasmtime's own caching. On bare metal Windows on SSDs it still gets faster.)</p>
<p>On Linux, <a href="https://github.com/bytecodealliance/wasmtime/files/5436001/yosys.wasm.zip">yosys.wasm</a> (21M wasm file) results in a 290M serialized module, an increase of ~14×. On Windows, for some reason, that very same file results in a ~580M serialized module, an increase of ~28×. The native Yosys binary for x86_64 is 17M; even once you account for libc and libstdc++, it really should not take over half a gigabyte of space.</p>
<p>I'm filing this issue on request of @alexcrichton <a href="https://github.com/bytecodealliance/wasmtime-py/pull/43#issuecomment-716211943">here</a>.</p>
</blockquote>



<a name="215786096"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232318%20Serialized%20wasmtime%20modules%20are%20ex.../near/215786096" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232318.20Serialized.20wasmtime.20modules.20are.20ex.2E.2E.2E.html#215786096">(Nov 05 2020 at 23:10)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/2318#issuecomment-722697820">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2318">Issue #2318</a>:</p>
<blockquote>
<p>Nice! Thanks again for the report and helping to investigate!</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>