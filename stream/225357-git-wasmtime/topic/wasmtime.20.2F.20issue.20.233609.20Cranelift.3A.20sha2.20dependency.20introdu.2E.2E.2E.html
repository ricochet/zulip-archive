<html>
<head><meta charset="utf-8"><title>wasmtime / issue #3609 Cranelift: sha2 dependency introdu... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233609.20Cranelift.3A.20sha2.20dependency.20introdu.2E.2E.2E.html">wasmtime / issue #3609 Cranelift: sha2 dependency introdu...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="265189059"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233609%20Cranelift%3A%20sha2%20dependency%20introdu.../near/265189059" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233609.20Cranelift.3A.20sha2.20dependency.20introdu.2E.2E.2E.html#265189059">(Dec 16 2021 at 17:26)</a>:</h4>
<p>bjorn3 opened <a href="https://github.com/bytecodealliance/wasmtime/issues/3609">issue #3609</a>:</p>
<blockquote>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">   </span><span class="n">Compiling</span><span class="w"> </span><span class="n">version_check</span><span class="w"> </span><span class="n">v0</span><span class="p">.</span><span class="mf">9.3</span><span class="w"></span>
<span class="w">   </span><span class="n">Compiling</span><span class="w"> </span><span class="n">typenum</span><span class="w"> </span><span class="n">v1</span><span class="p">.</span><span class="mf">14.0</span><span class="w"></span>
<span class="w">   </span><span class="n">Compiling</span><span class="w"> </span><span class="n">opaque</span><span class="o">-</span><span class="n">debug</span><span class="w"> </span><span class="n">v0</span><span class="p">.</span><span class="mf">3.0</span><span class="w"></span>
<span class="w">   </span><span class="n">Compiling</span><span class="w"> </span><span class="n">cpufeatures</span><span class="w"> </span><span class="n">v0</span><span class="p">.</span><span class="mf">2.1</span><span class="w"></span>
<span class="w">   </span><span class="n">Compiling</span><span class="w"> </span><span class="n">generic</span><span class="o">-</span><span class="n">array</span><span class="w"> </span><span class="n">v0</span><span class="p">.</span><span class="mf">14.4</span><span class="w"></span>
<span class="w">   </span><span class="n">Compiling</span><span class="w"> </span><span class="n">block</span><span class="o">-</span><span class="n">buffer</span><span class="w"> </span><span class="n">v0</span><span class="p">.</span><span class="mf">9.0</span><span class="w"></span>
<span class="w">   </span><span class="n">Compiling</span><span class="w"> </span><span class="n">digest</span><span class="w"> </span><span class="n">v0</span><span class="p">.</span><span class="mf">9.0</span><span class="w"></span>
<span class="w">   </span><span class="n">Compiling</span><span class="w"> </span><span class="n">sha2</span><span class="w"> </span><span class="n">v0</span><span class="p">.</span><span class="mf">9.8</span><span class="w"></span>
</code></pre></div>
<p>This regresses compilation time by a couple of seconds and requires me to add them to the list of permitted dependencies in rustc at <a href="https://github.com/rust-lang/rust/blob/f8402169aaa12e7bbb9630796a8caec90a3055ca/src/tools/tidy/src/deps.rs#L236">https://github.com/rust-lang/rust/blob/f8402169aaa12e7bbb9630796a8caec90a3055ca/src/tools/tidy/src/deps.rs#L236</a></p>
</blockquote>



<a name="265237808"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233609%20Cranelift%3A%20sha2%20dependency%20introdu.../near/265237808" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233609.20Cranelift.3A.20sha2.20dependency.20introdu.2E.2E.2E.html#265237808">(Dec 17 2021 at 00:04)</a>:</h4>
<p>sunfishcode <a href="https://github.com/bytecodealliance/wasmtime/issues/3609#issuecomment-996288110">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3609">issue #3609</a>:</p>
<blockquote>
<p>sha2 and its dependencies already appear in the <code>PERMITTED_DEPENDENCIES</code> list. Is it valuable for cranelift to avoid dependencies that rustc itself already depends on?</p>
</blockquote>



<a name="265258850"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233609%20Cranelift%3A%20sha2%20dependency%20introdu.../near/265258850" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233609.20Cranelift.3A.20sha2.20dependency.20introdu.2E.2E.2E.html#265258850">(Dec 17 2021 at 06:32)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/issues/3609#issuecomment-996472549">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3609">issue #3609</a>:</p>
<blockquote>
<p>I'm trying to keep the dependency list as small as reasonably possible.</p>
</blockquote>



<a name="265259741"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233609%20Cranelift%3A%20sha2%20dependency%20introdu.../near/265259741" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233609.20Cranelift.3A.20sha2.20dependency.20introdu.2E.2E.2E.html#265259741">(Dec 17 2021 at 06:50)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/issues/3609#issuecomment-996479454">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3609">issue #3609</a>:</p>
<blockquote>
<p>That's definitely a good first-order principle and I share that instinct too -- but in this case I think it's worthwhile to see the context: computing a hash in the build script and checking against the manifest lets us avoid building the whole ISLE compiler, so it's replacing an even larger dependency tree.</p>
<p>The best option w.r.t. dependency-set size is to build without any up-to-date checks at all, but that's a huge developer-friction issue if it is the default when hacking away in a local checkout. (Forget <code>rebuild-isle</code>, spend time debugging mysterious issue, discover source was never updated, etc.)</p>
<p>One option that <em>may</em> be reasonable is to put the manifest check under an on-by-default feature (say <code>check-isle-up-to-date</code>) so that we have safety / least-surprising behavior by default, but dependents that care strongly about minimal dependencies can specify <code>default-features = false</code> and then turn back on the features they need. The crate as uploaded to <a href="http://crates.io">crates.io</a> or on <code>main</code> in the git repo should always have up-to-date generated source, so skipping the checks (and thus sha512-hashing) is safe. Thoughts?</p>
</blockquote>



<a name="265271589"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233609%20Cranelift%3A%20sha2%20dependency%20introdu.../near/265271589" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233609.20Cranelift.3A.20sha2.20dependency.20introdu.2E.2E.2E.html#265271589">(Dec 17 2021 at 09:24)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/issues/3609#issuecomment-996563755">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3609">issue #3609</a>:</p>
<blockquote>
<blockquote>
<p>One option that may be reasonable is to put the manifest check under an on-by-default feature (say check-isle-up-to-date)</p>
</blockquote>
<p>That sounds great!</p>
</blockquote>



<a name="265361495"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233609%20Cranelift%3A%20sha2%20dependency%20introdu.../near/265361495" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233609.20Cranelift.3A.20sha2.20dependency.20introdu.2E.2E.2E.html#265361495">(Dec 17 2021 at 21:15)</a>:</h4>
<p>cfallin closed <a href="https://github.com/bytecodealliance/wasmtime/issues/3609">issue #3609</a>:</p>
<blockquote>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">   </span><span class="n">Compiling</span><span class="w"> </span><span class="n">version_check</span><span class="w"> </span><span class="n">v0</span><span class="p">.</span><span class="mf">9.3</span><span class="w"></span>
<span class="w">   </span><span class="n">Compiling</span><span class="w"> </span><span class="n">typenum</span><span class="w"> </span><span class="n">v1</span><span class="p">.</span><span class="mf">14.0</span><span class="w"></span>
<span class="w">   </span><span class="n">Compiling</span><span class="w"> </span><span class="n">opaque</span><span class="o">-</span><span class="n">debug</span><span class="w"> </span><span class="n">v0</span><span class="p">.</span><span class="mf">3.0</span><span class="w"></span>
<span class="w">   </span><span class="n">Compiling</span><span class="w"> </span><span class="n">cpufeatures</span><span class="w"> </span><span class="n">v0</span><span class="p">.</span><span class="mf">2.1</span><span class="w"></span>
<span class="w">   </span><span class="n">Compiling</span><span class="w"> </span><span class="n">generic</span><span class="o">-</span><span class="n">array</span><span class="w"> </span><span class="n">v0</span><span class="p">.</span><span class="mf">14.4</span><span class="w"></span>
<span class="w">   </span><span class="n">Compiling</span><span class="w"> </span><span class="n">block</span><span class="o">-</span><span class="n">buffer</span><span class="w"> </span><span class="n">v0</span><span class="p">.</span><span class="mf">9.0</span><span class="w"></span>
<span class="w">   </span><span class="n">Compiling</span><span class="w"> </span><span class="n">digest</span><span class="w"> </span><span class="n">v0</span><span class="p">.</span><span class="mf">9.0</span><span class="w"></span>
<span class="w">   </span><span class="n">Compiling</span><span class="w"> </span><span class="n">sha2</span><span class="w"> </span><span class="n">v0</span><span class="p">.</span><span class="mf">9.8</span><span class="w"></span>
</code></pre></div>
<p>This regresses compilation time by a couple of seconds and requires me to add them to the list of permitted dependencies in rustc at <a href="https://github.com/rust-lang/rust/blob/f8402169aaa12e7bbb9630796a8caec90a3055ca/src/tools/tidy/src/deps.rs#L236">https://github.com/rust-lang/rust/blob/f8402169aaa12e7bbb9630796a8caec90a3055ca/src/tools/tidy/src/deps.rs#L236</a></p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>