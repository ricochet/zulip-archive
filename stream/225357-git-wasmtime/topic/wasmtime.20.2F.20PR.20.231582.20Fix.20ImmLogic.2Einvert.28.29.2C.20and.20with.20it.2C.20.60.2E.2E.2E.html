<html>
<head><meta charset="utf-8"><title>wasmtime / PR #1582 Fix ImmLogic.invert(), and with it, `... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231582.20Fix.20ImmLogic.2Einvert.28.29.2C.20and.20with.20it.2C.20.60.2E.2E.2E.html">wasmtime / PR #1582 Fix ImmLogic.invert(), and with it, `...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="195010946"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231582%20Fix%20ImmLogic.invert%28%29%2C%20and%20with%20it%2C%20%60.../near/195010946" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231582.20Fix.20ImmLogic.2Einvert.28.29.2C.20and.20with.20it.2C.20.60.2E.2E.2E.html#195010946">(Apr 23 2020 at 01:35)</a>:</h4>
<p>cfallin opened <a href="https://github.com/bytecodealliance/wasmtime/pull/1582" title="https://github.com/bytecodealliance/wasmtime/pull/1582">PR #1582</a> (assigned to bnjbvr) from <code>aarch64-fcopysign</code> to <code>master</code>:</p>
<blockquote>
<p>Previously, <code>fcopysign</code> was mysteriously failing to pass the<br>
<code>float_misc</code> spec test. This was tracked down to bad logical-immediate<br>
masks used to separate the sign and not-sign bits. In particular, the<br>
masks for the and-not operations were wrong. The <code>invert()</code> function on<br>
an <code>ImmLogic</code> immediate, it turns out, assumed every immediate would be<br>
used by a 64-bit instruction; <code>ImmLogic</code> immediates are subtly different<br>
for 32-bit instructions. This change tracks the instruction size (32 or<br>
64 bits) intended for use with each such immediate, and passes it back<br>
into <code>maybe_from_u64</code> when computing the inverted immediate.</p>
<p>Addresses one of the failures (<code>float_misc</code>) for #1521 (test failures)<br>
and presumably helps #1519 (SpiderMonkey integration).</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md" title="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
</blockquote>



<a name="195010947"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231582%20Fix%20ImmLogic.invert%28%29%2C%20and%20with%20it%2C%20%60.../near/195010947" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231582.20Fix.20ImmLogic.2Einvert.28.29.2C.20and.20with.20it.2C.20.60.2E.2E.2E.html#195010947">(Apr 23 2020 at 01:35)</a>:</h4>
<p>cfallin assigned <a href="https://github.com/bytecodealliance/wasmtime/pull/1582" title="https://github.com/bytecodealliance/wasmtime/pull/1582">PR #1582</a> to bnjbvr.</p>



<a name="195010948"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231582%20Fix%20ImmLogic.invert%28%29%2C%20and%20with%20it%2C%20%60.../near/195010948" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231582.20Fix.20ImmLogic.2Einvert.28.29.2C.20and.20with.20it.2C.20.60.2E.2E.2E.html#195010948">(Apr 23 2020 at 01:35)</a>:</h4>
<p>cfallin assigned <a href="https://github.com/bytecodealliance/wasmtime/pull/1582" title="https://github.com/bytecodealliance/wasmtime/pull/1582">PR #1582</a> to bnjbvr.</p>



<a name="195034398"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231582%20Fix%20ImmLogic.invert%28%29%2C%20and%20with%20it%2C%20%60.../near/195034398" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231582.20Fix.20ImmLogic.2Einvert.28.29.2C.20and.20with.20it.2C.20.60.2E.2E.2E.html#195034398">(Apr 23 2020 at 09:05)</a>:</h4>
<p>jgouly submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1582#pullrequestreview-398901635" title="https://github.com/bytecodealliance/wasmtime/pull/1582#pullrequestreview-398901635">PR Review</a>.</p>



<a name="195034399"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231582%20Fix%20ImmLogic.invert%28%29%2C%20and%20with%20it%2C%20%60.../near/195034399" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231582.20Fix.20ImmLogic.2Einvert.28.29.2C.20and.20with.20it.2C.20.60.2E.2E.2E.html#195034399">(Apr 23 2020 at 09:05)</a>:</h4>
<p>jgouly submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1582#pullrequestreview-398901635" title="https://github.com/bytecodealliance/wasmtime/pull/1582#pullrequestreview-398901635">PR Review</a>.</p>



<a name="195034400"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231582%20Fix%20ImmLogic.invert%28%29%2C%20and%20with%20it%2C%20%60.../near/195034400" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231582.20Fix.20ImmLogic.2Einvert.28.29.2C.20and.20with.20it.2C.20.60.2E.2E.2E.html#195034400">(Apr 23 2020 at 09:05)</a>:</h4>
<p>jgouly created <a href="https://github.com/bytecodealliance/wasmtime/pull/1582#discussion_r413642728" title="https://github.com/bytecodealliance/wasmtime/pull/1582#discussion_r413642728">PR Review Comment</a>:</p>
<blockquote>
<p>Can we just get rid of from_raw() and use maybe_from_u64().unwrap()?</p>
</blockquote>



<a name="195035438"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231582%20Fix%20ImmLogic.invert%28%29%2C%20and%20with%20it%2C%20%60.../near/195035438" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231582.20Fix.20ImmLogic.2Einvert.28.29.2C.20and.20with.20it.2C.20.60.2E.2E.2E.html#195035438">(Apr 23 2020 at 09:16)</a>:</h4>
<p>jgouly submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1582#pullrequestreview-398911816" title="https://github.com/bytecodealliance/wasmtime/pull/1582#pullrequestreview-398911816">PR Review</a>.</p>



<a name="195035439"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231582%20Fix%20ImmLogic.invert%28%29%2C%20and%20with%20it%2C%20%60.../near/195035439" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231582.20Fix.20ImmLogic.2Einvert.28.29.2C.20and.20with.20it.2C.20.60.2E.2E.2E.html#195035439">(Apr 23 2020 at 09:16)</a>:</h4>
<p>jgouly created <a href="https://github.com/bytecodealliance/wasmtime/pull/1582#discussion_r413651770" title="https://github.com/bytecodealliance/wasmtime/pull/1582#discussion_r413651770">PR Review Comment</a>:</p>
<blockquote>
<p>This fixes f32 and f64 _bitwise.</p>
</blockquote>



<a name="195037588"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231582%20Fix%20ImmLogic.invert%28%29%2C%20and%20with%20it%2C%20%60.../near/195037588" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231582.20Fix.20ImmLogic.2Einvert.28.29.2C.20and.20with.20it.2C.20.60.2E.2E.2E.html#195037588">(Apr 23 2020 at 09:39)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1582#pullrequestreview-398930287" title="https://github.com/bytecodealliance/wasmtime/pull/1582#pullrequestreview-398930287">PR Review</a>.</p>



<a name="195111345"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231582%20Fix%20ImmLogic.invert%28%29%2C%20and%20with%20it%2C%20%60.../near/195111345" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231582.20Fix.20ImmLogic.2Einvert.28.29.2C.20and.20with.20it.2C.20.60.2E.2E.2E.html#195111345">(Apr 23 2020 at 19:53)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1582" title="https://github.com/bytecodealliance/wasmtime/pull/1582">PR #1582</a> (assigned to bnjbvr) from <code>aarch64-fcopysign</code> to <code>master</code>:</p>
<blockquote>
<p>Previously, <code>fcopysign</code> was mysteriously failing to pass the<br>
<code>float_misc</code> spec test. This was tracked down to bad logical-immediate<br>
masks used to separate the sign and not-sign bits. In particular, the<br>
masks for the and-not operations were wrong. The <code>invert()</code> function on<br>
an <code>ImmLogic</code> immediate, it turns out, assumed every immediate would be<br>
used by a 64-bit instruction; <code>ImmLogic</code> immediates are subtly different<br>
for 32-bit instructions. This change tracks the instruction size (32 or<br>
64 bits) intended for use with each such immediate, and passes it back<br>
into <code>maybe_from_u64</code> when computing the inverted immediate.</p>
<p>Addresses one of the failures (<code>float_misc</code>) for #1521 (test failures)<br>
and presumably helps #1519 (SpiderMonkey integration).</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md" title="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
</blockquote>



<a name="195112827"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231582%20Fix%20ImmLogic.invert%28%29%2C%20and%20with%20it%2C%20%60.../near/195112827" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231582.20Fix.20ImmLogic.2Einvert.28.29.2C.20and.20with.20it.2C.20.60.2E.2E.2E.html#195112827">(Apr 23 2020 at 20:06)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1582" title="https://github.com/bytecodealliance/wasmtime/pull/1582">PR #1582</a> (assigned to bnjbvr) from <code>aarch64-fcopysign</code> to <code>master</code>:</p>
<blockquote>
<p>Previously, <code>fcopysign</code> was mysteriously failing to pass the<br>
<code>float_misc</code> spec test. This was tracked down to bad logical-immediate<br>
masks used to separate the sign and not-sign bits. In particular, the<br>
masks for the and-not operations were wrong. The <code>invert()</code> function on<br>
an <code>ImmLogic</code> immediate, it turns out, assumed every immediate would be<br>
used by a 64-bit instruction; <code>ImmLogic</code> immediates are subtly different<br>
for 32-bit instructions. This change tracks the instruction size (32 or<br>
64 bits) intended for use with each such immediate, and passes it back<br>
into <code>maybe_from_u64</code> when computing the inverted immediate.</p>
<p>Addresses one of the failures (<code>float_misc</code>) for #1521 (test failures)<br>
and presumably helps #1519 (SpiderMonkey integration).</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md" title="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
</blockquote>



<a name="195116887"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231582%20Fix%20ImmLogic.invert%28%29%2C%20and%20with%20it%2C%20%60.../near/195116887" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231582.20Fix.20ImmLogic.2Einvert.28.29.2C.20and.20with.20it.2C.20.60.2E.2E.2E.html#195116887">(Apr 23 2020 at 20:42)</a>:</h4>
<p>cfallin merged <a href="https://github.com/bytecodealliance/wasmtime/pull/1582" title="https://github.com/bytecodealliance/wasmtime/pull/1582">PR #1582</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>