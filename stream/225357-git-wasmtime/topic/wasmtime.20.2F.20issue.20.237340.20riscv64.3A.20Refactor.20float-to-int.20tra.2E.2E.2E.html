<html>
<head><meta charset="utf-8"><title>wasmtime / issue #7340 riscv64: Refactor float-to-int tra... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237340.20riscv64.3A.20Refactor.20float-to-int.20tra.2E.2E.2E.html">wasmtime / issue #7340 riscv64: Refactor float-to-int tra...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="398161082"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237340%20riscv64%3A%20Refactor%20float-to-int%20tra.../near/398161082" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237340.20riscv64.3A.20Refactor.20float-to-int.20tra.2E.2E.2E.html#398161082">(Oct 23 2023 at 21:53)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/7340#issuecomment-1776081568">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/7340">issue #7340</a>:</p>
<blockquote>
<p>@afonso360 this is what I was thinking in terms of frobbing <code>fflags</code> around float-to-int conversions that need to trap. I'm not sure whether this is actually beneficial though in terms of perf, although it does look like a bit of a code size win. I'd be curious to test this on hardware you have in terms of perf, and I can try to whip up something later to test that.</p>
</blockquote>



<a name="398239772"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237340%20riscv64%3A%20Refactor%20float-to-int%20tra.../near/398239772" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237340.20riscv64.3A.20Refactor.20float-to-int.20tra.2E.2E.2E.html#398239772">(Oct 24 2023 at 08:53)</a>:</h4>
<p>afonso360 <a href="https://github.com/bytecodealliance/wasmtime/pull/7340#issuecomment-1776794206">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/7340">issue #7340</a>:</p>
<blockquote>
<p>Super curious to see how this pans out! I'm going to run sightglass to check if we see any difference there, but we might need something more targeted. </p>
<blockquote>
<p>I'd be curious to test this on hardware you have in terms of perf, and I can try to whip up something later to test that.</p>
</blockquote>
<p>Yes, that'd be helpful, I'm not too familiar with writing these sorts of things. </p>
</blockquote>



<a name="398239795"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237340%20riscv64%3A%20Refactor%20float-to-int%20tra.../near/398239795" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237340.20riscv64.3A.20Refactor.20float-to-int.20tra.2E.2E.2E.html#398239795">(Oct 24 2023 at 08:53)</a>:</h4>
<p>afonso360 edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/7340#issuecomment-1776794206">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/7340">issue #7340</a>:</p>
<blockquote>
<p>Super curious to see how this pans out! I'm going to run sightglass to check if we see any difference there, but we might need something more targeted. </p>
<blockquote>
<p>I'd be curious to test this on hardware you have in terms of perf, and I can try to whip up something later to test that.</p>
</blockquote>
<p>That'd be helpful, I'm not too familiar with writing these sorts of things. </p>
</blockquote>



<a name="398300465"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237340%20riscv64%3A%20Refactor%20float-to-int%20tra.../near/398300465" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237340.20riscv64.3A.20Refactor.20float-to-int.20tra.2E.2E.2E.html#398300465">(Oct 24 2023 at 14:27)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/7340#issuecomment-1777335279">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/7340">issue #7340</a>:</p>
<blockquote>
<p>I'm not sure how representative it is, but another idea is <a href="https://github.com/bytecodealliance/wasmtime/files/13116643/bench.wasm.gz">bench.wasm.gz</a> which is:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">use</span><span class="w"> </span><span class="n">criterion</span>::<span class="p">{</span><span class="n">criterion_group</span><span class="p">,</span><span class="w"> </span><span class="n">criterion_main</span><span class="p">,</span><span class="w"> </span><span class="n">Criterion</span><span class="p">};</span>
<span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">hint</span>::<span class="n">black_box</span><span class="p">;</span>

<span class="k">fn</span> <span class="nf">fcvt_to_uint</span><span class="p">(</span><span class="n">c</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">Criterion</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">c</span><span class="p">.</span><span class="n">bench_function</span><span class="p">(</span><span class="s">"f32-&gt;u32"</span><span class="p">,</span><span class="w"> </span><span class="o">|</span><span class="n">b</span><span class="o">|</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">b</span><span class="p">.</span><span class="n">iter</span><span class="p">(</span><span class="o">||</span><span class="w"> </span><span class="n">black_box</span><span class="p">(</span><span class="n">black_box</span><span class="p">(</span><span class="mf">2.0</span><span class="k">f32</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">u32</span><span class="p">))</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">    </span><span class="n">c</span><span class="p">.</span><span class="n">bench_function</span><span class="p">(</span><span class="s">"f32-&gt;u64"</span><span class="p">,</span><span class="w"> </span><span class="o">|</span><span class="n">b</span><span class="o">|</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">b</span><span class="p">.</span><span class="n">iter</span><span class="p">(</span><span class="o">||</span><span class="w"> </span><span class="n">black_box</span><span class="p">(</span><span class="n">black_box</span><span class="p">(</span><span class="mf">2.0</span><span class="k">f32</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">u64</span><span class="p">))</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">    </span><span class="n">c</span><span class="p">.</span><span class="n">bench_function</span><span class="p">(</span><span class="s">"f64-&gt;u32"</span><span class="p">,</span><span class="w"> </span><span class="o">|</span><span class="n">b</span><span class="o">|</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">b</span><span class="p">.</span><span class="n">iter</span><span class="p">(</span><span class="o">||</span><span class="w"> </span><span class="n">black_box</span><span class="p">(</span><span class="n">black_box</span><span class="p">(</span><span class="mf">2.0</span><span class="k">f64</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">u32</span><span class="p">))</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">    </span><span class="n">c</span><span class="p">.</span><span class="n">bench_function</span><span class="p">(</span><span class="s">"f64-&gt;u64"</span><span class="p">,</span><span class="w"> </span><span class="o">|</span><span class="n">b</span><span class="o">|</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">b</span><span class="p">.</span><span class="n">iter</span><span class="p">(</span><span class="o">||</span><span class="w"> </span><span class="n">black_box</span><span class="p">(</span><span class="n">black_box</span><span class="p">(</span><span class="mf">2.0</span><span class="k">f64</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">u64</span><span class="p">))</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">}</span>

<span class="k">fn</span> <span class="nf">fcvt_to_sint</span><span class="p">(</span><span class="n">c</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">Criterion</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">c</span><span class="p">.</span><span class="n">bench_function</span><span class="p">(</span><span class="s">"f32-&gt;i32"</span><span class="p">,</span><span class="w"> </span><span class="o">|</span><span class="n">b</span><span class="o">|</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">b</span><span class="p">.</span><span class="n">iter</span><span class="p">(</span><span class="o">||</span><span class="w"> </span><span class="n">black_box</span><span class="p">(</span><span class="n">black_box</span><span class="p">(</span><span class="mf">2.0</span><span class="k">f32</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">i32</span><span class="p">))</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">    </span><span class="n">c</span><span class="p">.</span><span class="n">bench_function</span><span class="p">(</span><span class="s">"f32-&gt;i64"</span><span class="p">,</span><span class="w"> </span><span class="o">|</span><span class="n">b</span><span class="o">|</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">b</span><span class="p">.</span><span class="n">iter</span><span class="p">(</span><span class="o">||</span><span class="w"> </span><span class="n">black_box</span><span class="p">(</span><span class="n">black_box</span><span class="p">(</span><span class="mf">2.0</span><span class="k">f32</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">i64</span><span class="p">))</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">    </span><span class="n">c</span><span class="p">.</span><span class="n">bench_function</span><span class="p">(</span><span class="s">"f64-&gt;i32"</span><span class="p">,</span><span class="w"> </span><span class="o">|</span><span class="n">b</span><span class="o">|</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">b</span><span class="p">.</span><span class="n">iter</span><span class="p">(</span><span class="o">||</span><span class="w"> </span><span class="n">black_box</span><span class="p">(</span><span class="n">black_box</span><span class="p">(</span><span class="mf">2.0</span><span class="k">f64</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">i32</span><span class="p">))</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">    </span><span class="n">c</span><span class="p">.</span><span class="n">bench_function</span><span class="p">(</span><span class="s">"f64-&gt;i64"</span><span class="p">,</span><span class="w"> </span><span class="o">|</span><span class="n">b</span><span class="o">|</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">b</span><span class="p">.</span><span class="n">iter</span><span class="p">(</span><span class="o">||</span><span class="w"> </span><span class="n">black_box</span><span class="p">(</span><span class="n">black_box</span><span class="p">(</span><span class="mf">2.0</span><span class="k">f64</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">i64</span><span class="p">))</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">}</span>

<span class="n">criterion_group</span><span class="o">!</span><span class="p">(</span><span class="n">benches</span><span class="p">,</span><span class="w"> </span><span class="n">fcvt_to_uint</span><span class="p">,</span><span class="w"> </span><span class="n">fcvt_to_sint</span><span class="p">);</span>
<span class="n">criterion_main</span><span class="o">!</span><span class="p">(</span><span class="n">benches</span><span class="p">);</span>
</code></pre></div>
</blockquote>



<a name="398323945"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237340%20riscv64%3A%20Refactor%20float-to-int%20tra.../near/398323945" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237340.20riscv64.3A.20Refactor.20float-to-int.20tra.2E.2E.2E.html#398323945">(Oct 24 2023 at 16:29)</a>:</h4>
<p>afonso360 <a href="https://github.com/bytecodealliance/wasmtime/pull/7340#issuecomment-1777600834">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/7340">issue #7340</a>:</p>
<blockquote>
<p>I have some interesting results, and some confusing results.</p>
<p>I first ran sightglass with a smaller iteration count and got the results that <code>main</code> was faster than <code>fflags</code> by 3% in spidermonkey, which was surprising to me so I ran it again with the default iteration count and got the same result.</p>
<p>&lt;details&gt;<br>
 &lt;summary&gt;Sightglass Run 1&lt;/summary&gt;</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">afonso</span><span class="o">@</span><span class="n">starfive</span>:<span class="o">~/</span><span class="n">git</span><span class="o">/</span><span class="n">sightglass</span><span class="cp">$</span><span class="w"> </span><span class="n">cargo</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="n">benchmark</span><span class="w"> </span><span class="o">--</span><span class="n">processes</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="o">--</span><span class="n">iterations</span><span class="o">-</span><span class="n">per</span><span class="o">-</span><span class="n">process</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="o">--</span><span class="n">engine</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">engine</span><span class="o">-</span><span class="n">ffla</span>
<span class="n">gs</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="o">--</span><span class="n">engine</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">engine</span><span class="o">-</span><span class="n">main</span><span class="p">.</span><span class="n">so</span><span class="w">  </span><span class="o">--</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">benchmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">scalar</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span><span class="w">  </span><span class="n">benchmarks</span><span class="o">/</span><span class="n">bz2</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="n">benchmarks</span><span class="o">/</span>
<span class="n">regex</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="n">benchmarks</span><span class="o">/</span><span class="n">spidermonkey</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="n">execution</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">spidermonkey</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="err">Δ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">611139.96</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="mf">69194.06</span><span class="w"> </span><span class="p">(</span><span class="n">confidence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">99</span><span class="o">%</span><span class="p">)</span>

<span class="w">  </span><span class="n">main</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="mf">1.03</span><span class="n">x</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="mf">1.03</span><span class="n">x</span><span class="w"> </span><span class="n">faster</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span><span class="o">!</span>

<span class="w">  </span><span class="p">[</span><span class="mi">22003870</span><span class="w"> </span><span class="mf">22177803.84</span><span class="w"> </span><span class="mi">22296431</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">21400346</span><span class="w"> </span><span class="mf">21566663.88</span><span class="w"> </span><span class="mi">21700502</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">execution</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="p">.</span><span class="o">/</span><span class="n">benchmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">scalar</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">6516</span><span class="w"> </span><span class="mf">7450.52</span><span class="w"> </span><span class="mi">14467</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">6500</span><span class="w"> </span><span class="mf">6845.04</span><span class="w"> </span><span class="mi">13012</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">instantiation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="p">.</span><span class="o">/</span><span class="n">benchmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">scalar</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">950</span><span class="w"> </span><span class="mf">1073.44</span><span class="w"> </span><span class="mi">1500</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">939</span><span class="w"> </span><span class="mf">1039.24</span><span class="w"> </span><span class="mi">1814</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">instantiation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">bz2</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">991</span><span class="w"> </span><span class="mf">1109.80</span><span class="w"> </span><span class="mi">1603</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">1018</span><span class="w"> </span><span class="mf">1129.44</span><span class="w"> </span><span class="mi">1811</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">instantiation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">spidermonkey</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">3600</span><span class="w"> </span><span class="mf">4488.00</span><span class="w"> </span><span class="mi">8483</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">3660</span><span class="w"> </span><span class="mf">4418.44</span><span class="w"> </span><span class="mi">9216</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">execution</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">bz2</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">1025843</span><span class="w"> </span><span class="mf">1035182.96</span><span class="w"> </span><span class="mi">1079490</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">1026383</span><span class="w"> </span><span class="mf">1044678.80</span><span class="w"> </span><span class="mi">1099227</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">instantiation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">regex</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">2930</span><span class="w"> </span><span class="mf">3202.92</span><span class="w"> </span><span class="mi">3354</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">2983</span><span class="w"> </span><span class="mf">3231.48</span><span class="w"> </span><span class="mi">3832</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">compilation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">regex</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">10667840</span><span class="w"> </span><span class="mf">10819084.56</span><span class="w"> </span><span class="mi">10947259</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">10725380</span><span class="w"> </span><span class="mf">10845151.60</span><span class="w"> </span><span class="mi">10951025</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">compilation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">spidermonkey</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">111451448</span><span class="w"> </span><span class="mf">113120311.48</span><span class="w"> </span><span class="mi">115050440</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">111395436</span><span class="w"> </span><span class="mf">112890160.52</span><span class="w"> </span><span class="mi">115262339</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">compilation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">bz2</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">2033630</span><span class="w"> </span><span class="mf">2237015.88</span><span class="w"> </span><span class="mi">2365106</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">2032061</span><span class="w"> </span><span class="mf">2233455.48</span><span class="w"> </span><span class="mi">2332395</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">execution</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">regex</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">3845964</span><span class="w"> </span><span class="mf">3852698.64</span><span class="w"> </span><span class="mi">3870163</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">3845116</span><span class="w"> </span><span class="mf">3849177.08</span><span class="w"> </span><span class="mi">3880686</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">compilation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="p">.</span><span class="o">/</span><span class="n">benchmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">scalar</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">2641545</span><span class="w"> </span><span class="mf">2668781.48</span><span class="w"> </span><span class="mi">2727010</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">2621339</span><span class="w"> </span><span class="mf">2667785.92</span><span class="w"> </span><span class="mi">2797660</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>
</code></pre></div>
<p>&lt;/details&gt;</p>
<p>&lt;details&gt;<br>
 &lt;summary&gt;Sightglass Run 2&lt;/summary&gt;</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">afonso</span><span class="o">@</span><span class="n">starfive</span>:<span class="o">~/</span><span class="n">git</span><span class="o">/</span><span class="n">sightglass</span><span class="cp">$</span><span class="w"> </span><span class="n">cargo</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="n">benchmark</span><span class="w"> </span><span class="o">--</span><span class="n">engine</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">engine</span><span class="o">-</span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="o">--</span><span class="n">engine</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">engine</span><span class="o">-</span><span class="n">main</span><span class="p">.</span><span class="n">so</span><span class="w">  </span><span class="o">--</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">ben</span>
<span class="n">chmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">scalar</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span><span class="w">  </span><span class="n">benchmarks</span><span class="o">/</span><span class="n">bz2</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="n">benchmarks</span><span class="o">/</span><span class="n">regex</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="n">benchmarks</span><span class="o">/</span><span class="n">spidermon</span>
<span class="n">key</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>
<span class="n">execution</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">spidermonkey</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="err">Δ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">528886.85</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="mf">30356.42</span><span class="w"> </span><span class="p">(</span><span class="n">confidence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">99</span><span class="o">%</span><span class="p">)</span>

<span class="w">  </span><span class="n">main</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="mf">1.02</span><span class="n">x</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="mf">1.03</span><span class="n">x</span><span class="w"> </span><span class="n">faster</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span><span class="o">!</span>

<span class="w">  </span><span class="p">[</span><span class="mi">21985977</span><span class="w"> </span><span class="mf">22155294.58</span><span class="w"> </span><span class="mi">22282664</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">21399233</span><span class="w"> </span><span class="mf">21626407.73</span><span class="w"> </span><span class="mi">21778731</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">execution</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">regex</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="err">Δ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">4771.68</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="mf">2965.39</span><span class="w"> </span><span class="p">(</span><span class="n">confidence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">99</span><span class="o">%</span><span class="p">)</span>

<span class="w">  </span><span class="n">main</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="mf">1.00</span><span class="n">x</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="mf">1.00</span><span class="n">x</span><span class="w"> </span><span class="n">faster</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span><span class="o">!</span>

<span class="w">  </span><span class="p">[</span><span class="mi">3847607</span><span class="w"> </span><span class="mf">3856010.05</span><span class="w"> </span><span class="mi">3909326</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">3845022</span><span class="w"> </span><span class="mf">3851238.37</span><span class="w"> </span><span class="mi">3912075</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">execution</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="p">.</span><span class="o">/</span><span class="n">benchmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">scalar</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">6515</span><span class="w"> </span><span class="mf">6877.80</span><span class="w"> </span><span class="mi">14550</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">6489</span><span class="w"> </span><span class="mf">7310.42</span><span class="w"> </span><span class="mi">13787</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">instantiation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="p">.</span><span class="o">/</span><span class="n">benchmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">scalar</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">927</span><span class="w"> </span><span class="mf">1029.46</span><span class="w"> </span><span class="mi">1697</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">923</span><span class="w"> </span><span class="mf">1067.02</span><span class="w"> </span><span class="mi">2110</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">instantiation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">spidermonkey</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">3555</span><span class="w"> </span><span class="mf">4316.19</span><span class="w"> </span><span class="mi">8421</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">3588</span><span class="w"> </span><span class="mf">4375.00</span><span class="w"> </span><span class="mi">8089</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">instantiation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">regex</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">2981</span><span class="w"> </span><span class="mf">3225.85</span><span class="w"> </span><span class="mi">3511</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">2986</span><span class="w"> </span><span class="mf">3242.21</span><span class="w"> </span><span class="mi">3598</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">instantiation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">bz2</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">990</span><span class="w"> </span><span class="mf">1147.83</span><span class="w"> </span><span class="mi">1970</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">1000</span><span class="w"> </span><span class="mf">1153.04</span><span class="w"> </span><span class="mi">2124</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">compilation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="p">.</span><span class="o">/</span><span class="n">benchmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">scalar</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">2607381</span><span class="w"> </span><span class="mf">2665940.83</span><span class="w"> </span><span class="mi">2808423</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">2599335</span><span class="w"> </span><span class="mf">2655289.42</span><span class="w"> </span><span class="mi">2750262</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">compilation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">spidermonkey</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">111352544</span><span class="w"> </span><span class="mf">113374288.89</span><span class="w"> </span><span class="mi">115552774</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">111363591</span><span class="w"> </span><span class="mf">113073838.73</span><span class="w"> </span><span class="mi">115549133</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">execution</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">bz2</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">1024902</span><span class="w"> </span><span class="mf">1040201.83</span><span class="w"> </span><span class="mi">1092704</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">1025677</span><span class="w"> </span><span class="mf">1041126.17</span><span class="w"> </span><span class="mi">1101387</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">compilation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">bz2</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">2020133</span><span class="w"> </span><span class="mf">2223545.22</span><span class="w"> </span><span class="mi">2354573</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">2067731</span><span class="w"> </span><span class="mf">2224627.35</span><span class="w"> </span><span class="mi">2372602</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">compilation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">regex</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">10651375</span><span class="w"> </span><span class="mf">10816177.71</span><span class="w"> </span><span class="mi">10994312</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">10625726</span><span class="w"> </span><span class="mf">10814925.59</span><span class="w"> </span><span class="mi">11001537</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>
</code></pre></div>
<p>&lt;/details&gt;</p>
<hr>
<p>I also tried to run the above benchmark via sightglass but couldn't get it to execute, so I ran it using a precompiled module using the wasmtime cli, but the results don't seem very significant. Do you have any suggestions on how I can do this better?</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">afonso</span><span class="o">@</span><span class="n">starfive</span>:<span class="o">~</span><span class="cp">$</span><span class="w"> </span><span class="n">hyperfine</span><span class="w">     </span><span class="o">--</span><span class="n">warmup</span><span class="w"> </span><span class="mi">1000</span><span class="w">     </span><span class="o">--</span><span class="n">runs</span><span class="w"> </span><span class="mi">5000</span><span class="w">     </span><span class="o">'~/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">main</span><span class="w"> </span><span class="o">--</span><span class="n">allow</span><span class="o">-</span><span class="n">precompiled</span><span class="w"> </span><span class="o">~/</span><span class="n">bench</span><span class="o">-</span><span class="n">main</span><span class="p">.</span><span class="n">cwasm</span><span class="o">'</span><span class="w">     </span><span class="o">'~/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">fflags</span><span class="w"> </span><span class="o">--</span><span class="n">allow</span><span class="o">-</span><span class="n">precompiled</span><span class="w"> </span><span class="o">~/</span><span class="n">bench</span><span class="o">-</span><span class="n">fflags</span><span class="p">.</span><span class="n">cwasm</span><span class="o">'</span>
<span class="n">Benchmark</span><span class="w"> </span><span class="mi">1</span>: <span class="o">~/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">main</span><span class="w"> </span><span class="o">--</span><span class="n">allow</span><span class="o">-</span><span class="n">precompiled</span><span class="w"> </span><span class="o">~/</span><span class="n">bench</span><span class="o">-</span><span class="n">main</span><span class="p">.</span><span class="n">cwasm</span>
<span class="w">  </span><span class="n">Time</span><span class="w"> </span><span class="p">(</span><span class="n">mean</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="err">σ</span><span class="p">)</span>:      <span class="mf">24.5</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="err">±</span><span class="w">   </span><span class="mf">4.0</span><span class="w"> </span><span class="n">ms</span><span class="w">    </span><span class="p">[</span><span class="n">User</span>: <span class="mf">13.3</span><span class="w"> </span><span class="n">ms</span><span class="p">,</span><span class="w"> </span><span class="n">System</span>: <span class="mf">9.9</span><span class="w"> </span><span class="n">ms</span><span class="p">]</span>
<span class="w">  </span><span class="n">Range</span><span class="w"> </span><span class="p">(</span><span class="n">min</span><span class="w"> </span><span class="err">…</span><span class="w"> </span><span class="n">max</span><span class="p">)</span>:    <span class="mf">21.3</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="err">…</span><span class="w">  </span><span class="mf">37.0</span><span class="w"> </span><span class="n">ms</span><span class="w">    </span><span class="mi">5000</span><span class="w"> </span><span class="n">runs</span>

<span class="w">  </span><span class="n">Warning</span>: <span class="nc">Statistical</span><span class="w"> </span><span class="n">outliers</span><span class="w"> </span><span class="n">were</span><span class="w"> </span><span class="n">detected</span><span class="p">.</span><span class="w"> </span><span class="n">Consider</span><span class="w"> </span><span class="n">re</span><span class="o">-</span><span class="n">running</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">benchmark</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">quiet</span><span class="w"> </span><span class="n">system</span><span class="w"> </span><span class="n">without</span><span class="w"> </span><span class="n">any</span><span class="w"> </span><span class="n">interferences</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="n">programs</span><span class="p">.</span><span class="w"> </span><span class="n">It</span><span class="w"> </span><span class="n">might</span><span class="w"> </span><span class="n">help</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="o">'--</span><span class="n">warmup</span><span class="o">'</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="o">'--</span><span class="n">prepare</span><span class="o">'</span><span class="w"> </span><span class="n">options</span><span class="p">.</span>

<span class="n">Benchmark</span><span class="w"> </span><span class="mi">2</span>: <span class="o">~/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">fflags</span><span class="w"> </span><span class="o">--</span><span class="n">allow</span><span class="o">-</span><span class="n">precompiled</span><span class="w"> </span><span class="o">~/</span><span class="n">bench</span><span class="o">-</span><span class="n">fflags</span><span class="p">.</span><span class="n">cwasm</span>
<span class="w">  </span><span class="n">Time</span><span class="w"> </span><span class="p">(</span><span class="n">mean</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="err">σ</span><span class="p">)</span>:      <span class="mf">23.8</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="err">±</span><span class="w">   </span><span class="mf">3.6</span><span class="w"> </span><span class="n">ms</span><span class="w">    </span><span class="p">[</span><span class="n">User</span>: <span class="mf">13.3</span><span class="w"> </span><span class="n">ms</span><span class="p">,</span><span class="w"> </span><span class="n">System</span>: <span class="mf">9.2</span><span class="w"> </span><span class="n">ms</span><span class="p">]</span>
<span class="w">  </span><span class="n">Range</span><span class="w"> </span><span class="p">(</span><span class="n">min</span><span class="w"> </span><span class="err">…</span><span class="w"> </span><span class="n">max</span><span class="p">)</span>:    <span class="mf">20.7</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="err">…</span><span class="w">  </span><span class="mf">40.1</span><span class="w"> </span><span class="n">ms</span><span class="w">    </span><span class="mi">5000</span><span class="w"> </span><span class="n">runs</span>

<span class="w">  </span><span class="n">Warning</span>: <span class="nc">Statistical</span><span class="w"> </span><span class="n">outliers</span><span class="w"> </span><span class="n">were</span><span class="w"> </span><span class="n">detected</span><span class="p">.</span><span class="w"> </span><span class="n">Consider</span><span class="w"> </span><span class="n">re</span><span class="o">-</span><span class="n">running</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">benchmark</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">quiet</span><span class="w"> </span><span class="n">system</span><span class="w"> </span><span class="n">without</span><span class="w"> </span><span class="n">any</span><span class="w"> </span><span class="n">interferences</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="n">programs</span><span class="p">.</span><span class="w"> </span><span class="n">It</span><span class="w"> </span><span class="n">might</span><span class="w"> </span><span class="n">help</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="o">'--</span><span class="n">warmup</span><span class="o">'</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="o">'--</span><span class="n">prepare</span><span class="o">'</span><span class="w"> </span><span class="n">options</span><span class="p">.</span>

<span class="n">Summary</span>
<span class="w">  </span><span class="o">~/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">fflags</span><span class="w"> </span><span class="o">--</span><span class="n">allow</span><span class="o">-</span><span class="n">precompiled</span><span class="w"> </span><span class="o">~/</span><span class="n">bench</span><span class="o">-</span><span class="n">fflags</span><span class="p">.</span><span class="n">cwasm</span><span class="w"> </span><span class="n">ran</span>
<span class="w">    </span><span class="mf">1.03</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="mf">0.23</span><span class="w"> </span><span class="n">times</span><span class="w"> </span><span class="n">faster</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="o">~/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">main</span><span class="w"> </span><span class="o">--</span><span class="n">allow</span><span class="o">-</span><span class="n">precompiled</span><span class="w"> </span><span class="o">~/</span><span class="n">bench</span><span class="o">-</span><span class="n">main</span><span class="p">.</span><span class="n">cwasm</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="398324147"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237340%20riscv64%3A%20Refactor%20float-to-int%20tra.../near/398324147" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237340.20riscv64.3A.20Refactor.20float-to-int.20tra.2E.2E.2E.html#398324147">(Oct 24 2023 at 16:30)</a>:</h4>
<p>afonso360 edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/7340#issuecomment-1777600834">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/7340">issue #7340</a>:</p>
<blockquote>
<p>I have some interesting results, and some confusing results.</p>
<p>I first ran sightglass with a smaller iteration count and got the results that <code>main</code> was faster than <code>fflags</code> by 3% in spidermonkey, which was surprising to me so I ran it again with the default iteration count and got the same result.</p>
<p>&lt;details&gt;<br>
 &lt;summary&gt;Sightglass Run 1&lt;/summary&gt;</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">afonso</span><span class="o">@</span><span class="n">starfive</span>:<span class="o">~/</span><span class="n">git</span><span class="o">/</span><span class="n">sightglass</span><span class="cp">$</span><span class="w"> </span><span class="n">cargo</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="n">benchmark</span><span class="w"> </span><span class="o">--</span><span class="n">processes</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="o">--</span><span class="n">iterations</span><span class="o">-</span><span class="n">per</span><span class="o">-</span><span class="n">process</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="o">--</span><span class="n">engine</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">engine</span><span class="o">-</span><span class="n">ffla</span>
<span class="n">gs</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="o">--</span><span class="n">engine</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">engine</span><span class="o">-</span><span class="n">main</span><span class="p">.</span><span class="n">so</span><span class="w">  </span><span class="o">--</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">benchmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">scalar</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span><span class="w">  </span><span class="n">benchmarks</span><span class="o">/</span><span class="n">bz2</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="n">benchmarks</span><span class="o">/</span>
<span class="n">regex</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="n">benchmarks</span><span class="o">/</span><span class="n">spidermonkey</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="n">execution</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">spidermonkey</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="err">Δ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">611139.96</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="mf">69194.06</span><span class="w"> </span><span class="p">(</span><span class="n">confidence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">99</span><span class="o">%</span><span class="p">)</span>

<span class="w">  </span><span class="n">main</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="mf">1.03</span><span class="n">x</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="mf">1.03</span><span class="n">x</span><span class="w"> </span><span class="n">faster</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span><span class="o">!</span>

<span class="w">  </span><span class="p">[</span><span class="mi">22003870</span><span class="w"> </span><span class="mf">22177803.84</span><span class="w"> </span><span class="mi">22296431</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">21400346</span><span class="w"> </span><span class="mf">21566663.88</span><span class="w"> </span><span class="mi">21700502</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">execution</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="p">.</span><span class="o">/</span><span class="n">benchmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">scalar</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">6516</span><span class="w"> </span><span class="mf">7450.52</span><span class="w"> </span><span class="mi">14467</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">6500</span><span class="w"> </span><span class="mf">6845.04</span><span class="w"> </span><span class="mi">13012</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">instantiation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="p">.</span><span class="o">/</span><span class="n">benchmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">scalar</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">950</span><span class="w"> </span><span class="mf">1073.44</span><span class="w"> </span><span class="mi">1500</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">939</span><span class="w"> </span><span class="mf">1039.24</span><span class="w"> </span><span class="mi">1814</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">instantiation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">bz2</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">991</span><span class="w"> </span><span class="mf">1109.80</span><span class="w"> </span><span class="mi">1603</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">1018</span><span class="w"> </span><span class="mf">1129.44</span><span class="w"> </span><span class="mi">1811</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">instantiation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">spidermonkey</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">3600</span><span class="w"> </span><span class="mf">4488.00</span><span class="w"> </span><span class="mi">8483</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">3660</span><span class="w"> </span><span class="mf">4418.44</span><span class="w"> </span><span class="mi">9216</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">execution</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">bz2</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">1025843</span><span class="w"> </span><span class="mf">1035182.96</span><span class="w"> </span><span class="mi">1079490</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">1026383</span><span class="w"> </span><span class="mf">1044678.80</span><span class="w"> </span><span class="mi">1099227</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">instantiation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">regex</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">2930</span><span class="w"> </span><span class="mf">3202.92</span><span class="w"> </span><span class="mi">3354</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">2983</span><span class="w"> </span><span class="mf">3231.48</span><span class="w"> </span><span class="mi">3832</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">compilation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">regex</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">10667840</span><span class="w"> </span><span class="mf">10819084.56</span><span class="w"> </span><span class="mi">10947259</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">10725380</span><span class="w"> </span><span class="mf">10845151.60</span><span class="w"> </span><span class="mi">10951025</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">compilation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">spidermonkey</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">111451448</span><span class="w"> </span><span class="mf">113120311.48</span><span class="w"> </span><span class="mi">115050440</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">111395436</span><span class="w"> </span><span class="mf">112890160.52</span><span class="w"> </span><span class="mi">115262339</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">compilation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">bz2</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">2033630</span><span class="w"> </span><span class="mf">2237015.88</span><span class="w"> </span><span class="mi">2365106</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">2032061</span><span class="w"> </span><span class="mf">2233455.48</span><span class="w"> </span><span class="mi">2332395</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">execution</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">regex</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">3845964</span><span class="w"> </span><span class="mf">3852698.64</span><span class="w"> </span><span class="mi">3870163</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">3845116</span><span class="w"> </span><span class="mf">3849177.08</span><span class="w"> </span><span class="mi">3880686</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">compilation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="p">.</span><span class="o">/</span><span class="n">benchmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">scalar</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">2641545</span><span class="w"> </span><span class="mf">2668781.48</span><span class="w"> </span><span class="mi">2727010</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">2621339</span><span class="w"> </span><span class="mf">2667785.92</span><span class="w"> </span><span class="mi">2797660</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>
</code></pre></div>
<p>&lt;/details&gt;</p>
<p>&lt;details&gt;<br>
 &lt;summary&gt;Sightglass Run 2&lt;/summary&gt;</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">afonso</span><span class="o">@</span><span class="n">starfive</span>:<span class="o">~/</span><span class="n">git</span><span class="o">/</span><span class="n">sightglass</span><span class="cp">$</span><span class="w"> </span><span class="n">cargo</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="n">benchmark</span><span class="w"> </span><span class="o">--</span><span class="n">engine</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">engine</span><span class="o">-</span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="o">--</span><span class="n">engine</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">engine</span><span class="o">-</span><span class="n">main</span><span class="p">.</span><span class="n">so</span><span class="w">  </span><span class="o">--</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">ben</span>
<span class="n">chmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">scalar</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span><span class="w">  </span><span class="n">benchmarks</span><span class="o">/</span><span class="n">bz2</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="n">benchmarks</span><span class="o">/</span><span class="n">regex</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="n">benchmarks</span><span class="o">/</span><span class="n">spidermon</span>
<span class="n">key</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>
<span class="n">execution</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">spidermonkey</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="err">Δ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">528886.85</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="mf">30356.42</span><span class="w"> </span><span class="p">(</span><span class="n">confidence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">99</span><span class="o">%</span><span class="p">)</span>

<span class="w">  </span><span class="n">main</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="mf">1.02</span><span class="n">x</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="mf">1.03</span><span class="n">x</span><span class="w"> </span><span class="n">faster</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span><span class="o">!</span>

<span class="w">  </span><span class="p">[</span><span class="mi">21985977</span><span class="w"> </span><span class="mf">22155294.58</span><span class="w"> </span><span class="mi">22282664</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">21399233</span><span class="w"> </span><span class="mf">21626407.73</span><span class="w"> </span><span class="mi">21778731</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">execution</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">regex</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="err">Δ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">4771.68</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="mf">2965.39</span><span class="w"> </span><span class="p">(</span><span class="n">confidence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">99</span><span class="o">%</span><span class="p">)</span>

<span class="w">  </span><span class="n">main</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="mf">1.00</span><span class="n">x</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="mf">1.00</span><span class="n">x</span><span class="w"> </span><span class="n">faster</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span><span class="o">!</span>

<span class="w">  </span><span class="p">[</span><span class="mi">3847607</span><span class="w"> </span><span class="mf">3856010.05</span><span class="w"> </span><span class="mi">3909326</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">3845022</span><span class="w"> </span><span class="mf">3851238.37</span><span class="w"> </span><span class="mi">3912075</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">execution</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="p">.</span><span class="o">/</span><span class="n">benchmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">scalar</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">6515</span><span class="w"> </span><span class="mf">6877.80</span><span class="w"> </span><span class="mi">14550</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">6489</span><span class="w"> </span><span class="mf">7310.42</span><span class="w"> </span><span class="mi">13787</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">instantiation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="p">.</span><span class="o">/</span><span class="n">benchmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">scalar</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">927</span><span class="w"> </span><span class="mf">1029.46</span><span class="w"> </span><span class="mi">1697</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">923</span><span class="w"> </span><span class="mf">1067.02</span><span class="w"> </span><span class="mi">2110</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">instantiation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">spidermonkey</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">3555</span><span class="w"> </span><span class="mf">4316.19</span><span class="w"> </span><span class="mi">8421</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">3588</span><span class="w"> </span><span class="mf">4375.00</span><span class="w"> </span><span class="mi">8089</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">instantiation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">regex</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">2981</span><span class="w"> </span><span class="mf">3225.85</span><span class="w"> </span><span class="mi">3511</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">2986</span><span class="w"> </span><span class="mf">3242.21</span><span class="w"> </span><span class="mi">3598</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">instantiation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">bz2</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">990</span><span class="w"> </span><span class="mf">1147.83</span><span class="w"> </span><span class="mi">1970</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">1000</span><span class="w"> </span><span class="mf">1153.04</span><span class="w"> </span><span class="mi">2124</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">compilation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="p">.</span><span class="o">/</span><span class="n">benchmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">scalar</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">2607381</span><span class="w"> </span><span class="mf">2665940.83</span><span class="w"> </span><span class="mi">2808423</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">2599335</span><span class="w"> </span><span class="mf">2655289.42</span><span class="w"> </span><span class="mi">2750262</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">compilation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">spidermonkey</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">111352544</span><span class="w"> </span><span class="mf">113374288.89</span><span class="w"> </span><span class="mi">115552774</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">111363591</span><span class="w"> </span><span class="mf">113073838.73</span><span class="w"> </span><span class="mi">115549133</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">execution</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">bz2</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">1024902</span><span class="w"> </span><span class="mf">1040201.83</span><span class="w"> </span><span class="mi">1092704</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">1025677</span><span class="w"> </span><span class="mf">1041126.17</span><span class="w"> </span><span class="mi">1101387</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">compilation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">bz2</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">2020133</span><span class="w"> </span><span class="mf">2223545.22</span><span class="w"> </span><span class="mi">2354573</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">2067731</span><span class="w"> </span><span class="mf">2224627.35</span><span class="w"> </span><span class="mi">2372602</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">compilation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">regex</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">10651375</span><span class="w"> </span><span class="mf">10816177.71</span><span class="w"> </span><span class="mi">10994312</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">10625726</span><span class="w"> </span><span class="mf">10814925.59</span><span class="w"> </span><span class="mi">11001537</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>
</code></pre></div>
<p>&lt;/details&gt;</p>
<hr>
<p>I also tried to run the above benchmark via sightglass but couldn't get it to execute, so I ran it using a precompiled module using the wasmtime cli, but the results have quite a large uncertanty. Do you have any suggestions on how I can do this better?</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">afonso</span><span class="o">@</span><span class="n">starfive</span>:<span class="o">~</span><span class="cp">$</span><span class="w"> </span><span class="n">hyperfine</span><span class="w">     </span><span class="o">--</span><span class="n">warmup</span><span class="w"> </span><span class="mi">1000</span><span class="w">     </span><span class="o">--</span><span class="n">runs</span><span class="w"> </span><span class="mi">5000</span><span class="w">     </span><span class="o">'~/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">main</span><span class="w"> </span><span class="o">--</span><span class="n">allow</span><span class="o">-</span><span class="n">precompiled</span><span class="w"> </span><span class="o">~/</span><span class="n">bench</span><span class="o">-</span><span class="n">main</span><span class="p">.</span><span class="n">cwasm</span><span class="o">'</span><span class="w">     </span><span class="o">'~/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">fflags</span><span class="w"> </span><span class="o">--</span><span class="n">allow</span><span class="o">-</span><span class="n">precompiled</span><span class="w"> </span><span class="o">~/</span><span class="n">bench</span><span class="o">-</span><span class="n">fflags</span><span class="p">.</span><span class="n">cwasm</span><span class="o">'</span>
<span class="n">Benchmark</span><span class="w"> </span><span class="mi">1</span>: <span class="o">~/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">main</span><span class="w"> </span><span class="o">--</span><span class="n">allow</span><span class="o">-</span><span class="n">precompiled</span><span class="w"> </span><span class="o">~/</span><span class="n">bench</span><span class="o">-</span><span class="n">main</span><span class="p">.</span><span class="n">cwasm</span>
<span class="w">  </span><span class="n">Time</span><span class="w"> </span><span class="p">(</span><span class="n">mean</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="err">σ</span><span class="p">)</span>:      <span class="mf">24.5</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="err">±</span><span class="w">   </span><span class="mf">4.0</span><span class="w"> </span><span class="n">ms</span><span class="w">    </span><span class="p">[</span><span class="n">User</span>: <span class="mf">13.3</span><span class="w"> </span><span class="n">ms</span><span class="p">,</span><span class="w"> </span><span class="n">System</span>: <span class="mf">9.9</span><span class="w"> </span><span class="n">ms</span><span class="p">]</span>
<span class="w">  </span><span class="n">Range</span><span class="w"> </span><span class="p">(</span><span class="n">min</span><span class="w"> </span><span class="err">…</span><span class="w"> </span><span class="n">max</span><span class="p">)</span>:    <span class="mf">21.3</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="err">…</span><span class="w">  </span><span class="mf">37.0</span><span class="w"> </span><span class="n">ms</span><span class="w">    </span><span class="mi">5000</span><span class="w"> </span><span class="n">runs</span>

<span class="w">  </span><span class="n">Warning</span>: <span class="nc">Statistical</span><span class="w"> </span><span class="n">outliers</span><span class="w"> </span><span class="n">were</span><span class="w"> </span><span class="n">detected</span><span class="p">.</span><span class="w"> </span><span class="n">Consider</span><span class="w"> </span><span class="n">re</span><span class="o">-</span><span class="n">running</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">benchmark</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">quiet</span><span class="w"> </span><span class="n">system</span><span class="w"> </span><span class="n">without</span><span class="w"> </span><span class="n">any</span><span class="w"> </span><span class="n">interferences</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="n">programs</span><span class="p">.</span><span class="w"> </span><span class="n">It</span><span class="w"> </span><span class="n">might</span><span class="w"> </span><span class="n">help</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="o">'--</span><span class="n">warmup</span><span class="o">'</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="o">'--</span><span class="n">prepare</span><span class="o">'</span><span class="w"> </span><span class="n">options</span><span class="p">.</span>

<span class="n">Benchmark</span><span class="w"> </span><span class="mi">2</span>: <span class="o">~/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">fflags</span><span class="w"> </span><span class="o">--</span><span class="n">allow</span><span class="o">-</span><span class="n">precompiled</span><span class="w"> </span><span class="o">~/</span><span class="n">bench</span><span class="o">-</span><span class="n">fflags</span><span class="p">.</span><span class="n">cwasm</span>
<span class="w">  </span><span class="n">Time</span><span class="w"> </span><span class="p">(</span><span class="n">mean</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="err">σ</span><span class="p">)</span>:      <span class="mf">23.8</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="err">±</span><span class="w">   </span><span class="mf">3.6</span><span class="w"> </span><span class="n">ms</span><span class="w">    </span><span class="p">[</span><span class="n">User</span>: <span class="mf">13.3</span><span class="w"> </span><span class="n">ms</span><span class="p">,</span><span class="w"> </span><span class="n">System</span>: <span class="mf">9.2</span><span class="w"> </span><span class="n">ms</span><span class="p">]</span>
<span class="w">  </span><span class="n">Range</span><span class="w"> </span><span class="p">(</span><span class="n">min</span><span class="w"> </span><span class="err">…</span><span class="w"> </span><span class="n">max</span><span class="p">)</span>:    <span class="mf">20.7</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="err">…</span><span class="w">  </span><span class="mf">40.1</span><span class="w"> </span><span class="n">ms</span><span class="w">    </span><span class="mi">5000</span><span class="w"> </span><span class="n">runs</span>

<span class="w">  </span><span class="n">Warning</span>: <span class="nc">Statistical</span><span class="w"> </span><span class="n">outliers</span><span class="w"> </span><span class="n">were</span><span class="w"> </span><span class="n">detected</span><span class="p">.</span><span class="w"> </span><span class="n">Consider</span><span class="w"> </span><span class="n">re</span><span class="o">-</span><span class="n">running</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">benchmark</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">quiet</span><span class="w"> </span><span class="n">system</span><span class="w"> </span><span class="n">without</span><span class="w"> </span><span class="n">any</span><span class="w"> </span><span class="n">interferences</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="n">programs</span><span class="p">.</span><span class="w"> </span><span class="n">It</span><span class="w"> </span><span class="n">might</span><span class="w"> </span><span class="n">help</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="o">'--</span><span class="n">warmup</span><span class="o">'</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="o">'--</span><span class="n">prepare</span><span class="o">'</span><span class="w"> </span><span class="n">options</span><span class="p">.</span>

<span class="n">Summary</span>
<span class="w">  </span><span class="o">~/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">fflags</span><span class="w"> </span><span class="o">--</span><span class="n">allow</span><span class="o">-</span><span class="n">precompiled</span><span class="w"> </span><span class="o">~/</span><span class="n">bench</span><span class="o">-</span><span class="n">fflags</span><span class="p">.</span><span class="n">cwasm</span><span class="w"> </span><span class="n">ran</span>
<span class="w">    </span><span class="mf">1.03</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="mf">0.23</span><span class="w"> </span><span class="n">times</span><span class="w"> </span><span class="n">faster</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="o">~/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">main</span><span class="w"> </span><span class="o">--</span><span class="n">allow</span><span class="o">-</span><span class="n">precompiled</span><span class="w"> </span><span class="o">~/</span><span class="n">bench</span><span class="o">-</span><span class="n">main</span><span class="p">.</span><span class="n">cwasm</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="398324165"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237340%20riscv64%3A%20Refactor%20float-to-int%20tra.../near/398324165" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237340.20riscv64.3A.20Refactor.20float-to-int.20tra.2E.2E.2E.html#398324165">(Oct 24 2023 at 16:30)</a>:</h4>
<p>afonso360 edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/7340#issuecomment-1777600834">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/7340">issue #7340</a>:</p>
<blockquote>
<p>I have some interesting results, and some confusing results.</p>
<p>I first ran sightglass with a smaller iteration count and got the results that <code>main</code> was faster than <code>fflags</code> by 3% in spidermonkey, which was surprising to me so I ran it again with the default iteration count and got the same result.</p>
<p>&lt;details&gt;<br>
 &lt;summary&gt;Sightglass Run 1&lt;/summary&gt;</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">afonso</span><span class="o">@</span><span class="n">starfive</span>:<span class="o">~/</span><span class="n">git</span><span class="o">/</span><span class="n">sightglass</span><span class="cp">$</span><span class="w"> </span><span class="n">cargo</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="n">benchmark</span><span class="w"> </span><span class="o">--</span><span class="n">processes</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="o">--</span><span class="n">iterations</span><span class="o">-</span><span class="n">per</span><span class="o">-</span><span class="n">process</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="o">--</span><span class="n">engine</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">engine</span><span class="o">-</span><span class="n">ffla</span>
<span class="n">gs</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="o">--</span><span class="n">engine</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">engine</span><span class="o">-</span><span class="n">main</span><span class="p">.</span><span class="n">so</span><span class="w">  </span><span class="o">--</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">benchmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">scalar</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span><span class="w">  </span><span class="n">benchmarks</span><span class="o">/</span><span class="n">bz2</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="n">benchmarks</span><span class="o">/</span>
<span class="n">regex</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="n">benchmarks</span><span class="o">/</span><span class="n">spidermonkey</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="n">execution</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">spidermonkey</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="err">Δ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">611139.96</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="mf">69194.06</span><span class="w"> </span><span class="p">(</span><span class="n">confidence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">99</span><span class="o">%</span><span class="p">)</span>

<span class="w">  </span><span class="n">main</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="mf">1.03</span><span class="n">x</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="mf">1.03</span><span class="n">x</span><span class="w"> </span><span class="n">faster</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span><span class="o">!</span>

<span class="w">  </span><span class="p">[</span><span class="mi">22003870</span><span class="w"> </span><span class="mf">22177803.84</span><span class="w"> </span><span class="mi">22296431</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">21400346</span><span class="w"> </span><span class="mf">21566663.88</span><span class="w"> </span><span class="mi">21700502</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">execution</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="p">.</span><span class="o">/</span><span class="n">benchmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">scalar</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">6516</span><span class="w"> </span><span class="mf">7450.52</span><span class="w"> </span><span class="mi">14467</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">6500</span><span class="w"> </span><span class="mf">6845.04</span><span class="w"> </span><span class="mi">13012</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">instantiation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="p">.</span><span class="o">/</span><span class="n">benchmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">scalar</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">950</span><span class="w"> </span><span class="mf">1073.44</span><span class="w"> </span><span class="mi">1500</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">939</span><span class="w"> </span><span class="mf">1039.24</span><span class="w"> </span><span class="mi">1814</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">instantiation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">bz2</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">991</span><span class="w"> </span><span class="mf">1109.80</span><span class="w"> </span><span class="mi">1603</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">1018</span><span class="w"> </span><span class="mf">1129.44</span><span class="w"> </span><span class="mi">1811</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">instantiation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">spidermonkey</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">3600</span><span class="w"> </span><span class="mf">4488.00</span><span class="w"> </span><span class="mi">8483</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">3660</span><span class="w"> </span><span class="mf">4418.44</span><span class="w"> </span><span class="mi">9216</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">execution</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">bz2</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">1025843</span><span class="w"> </span><span class="mf">1035182.96</span><span class="w"> </span><span class="mi">1079490</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">1026383</span><span class="w"> </span><span class="mf">1044678.80</span><span class="w"> </span><span class="mi">1099227</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">instantiation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">regex</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">2930</span><span class="w"> </span><span class="mf">3202.92</span><span class="w"> </span><span class="mi">3354</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">2983</span><span class="w"> </span><span class="mf">3231.48</span><span class="w"> </span><span class="mi">3832</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">compilation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">regex</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">10667840</span><span class="w"> </span><span class="mf">10819084.56</span><span class="w"> </span><span class="mi">10947259</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">10725380</span><span class="w"> </span><span class="mf">10845151.60</span><span class="w"> </span><span class="mi">10951025</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">compilation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">spidermonkey</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">111451448</span><span class="w"> </span><span class="mf">113120311.48</span><span class="w"> </span><span class="mi">115050440</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">111395436</span><span class="w"> </span><span class="mf">112890160.52</span><span class="w"> </span><span class="mi">115262339</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">compilation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">bz2</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">2033630</span><span class="w"> </span><span class="mf">2237015.88</span><span class="w"> </span><span class="mi">2365106</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">2032061</span><span class="w"> </span><span class="mf">2233455.48</span><span class="w"> </span><span class="mi">2332395</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">execution</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">regex</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">3845964</span><span class="w"> </span><span class="mf">3852698.64</span><span class="w"> </span><span class="mi">3870163</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">3845116</span><span class="w"> </span><span class="mf">3849177.08</span><span class="w"> </span><span class="mi">3880686</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">compilation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="p">.</span><span class="o">/</span><span class="n">benchmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">scalar</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">2641545</span><span class="w"> </span><span class="mf">2668781.48</span><span class="w"> </span><span class="mi">2727010</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">2621339</span><span class="w"> </span><span class="mf">2667785.92</span><span class="w"> </span><span class="mi">2797660</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>
</code></pre></div>
<p>&lt;/details&gt;</p>
<p>&lt;details&gt;<br>
 &lt;summary&gt;Sightglass Run 2&lt;/summary&gt;</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">afonso</span><span class="o">@</span><span class="n">starfive</span>:<span class="o">~/</span><span class="n">git</span><span class="o">/</span><span class="n">sightglass</span><span class="cp">$</span><span class="w"> </span><span class="n">cargo</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="n">benchmark</span><span class="w"> </span><span class="o">--</span><span class="n">engine</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">engine</span><span class="o">-</span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="o">--</span><span class="n">engine</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">engine</span><span class="o">-</span><span class="n">main</span><span class="p">.</span><span class="n">so</span><span class="w">  </span><span class="o">--</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">ben</span>
<span class="n">chmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">scalar</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span><span class="w">  </span><span class="n">benchmarks</span><span class="o">/</span><span class="n">bz2</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="n">benchmarks</span><span class="o">/</span><span class="n">regex</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="n">benchmarks</span><span class="o">/</span><span class="n">spidermon</span>
<span class="n">key</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>
<span class="n">execution</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">spidermonkey</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="err">Δ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">528886.85</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="mf">30356.42</span><span class="w"> </span><span class="p">(</span><span class="n">confidence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">99</span><span class="o">%</span><span class="p">)</span>

<span class="w">  </span><span class="n">main</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="mf">1.02</span><span class="n">x</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="mf">1.03</span><span class="n">x</span><span class="w"> </span><span class="n">faster</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span><span class="o">!</span>

<span class="w">  </span><span class="p">[</span><span class="mi">21985977</span><span class="w"> </span><span class="mf">22155294.58</span><span class="w"> </span><span class="mi">22282664</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">21399233</span><span class="w"> </span><span class="mf">21626407.73</span><span class="w"> </span><span class="mi">21778731</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">execution</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">regex</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="err">Δ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">4771.68</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="mf">2965.39</span><span class="w"> </span><span class="p">(</span><span class="n">confidence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">99</span><span class="o">%</span><span class="p">)</span>

<span class="w">  </span><span class="n">main</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="mf">1.00</span><span class="n">x</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="mf">1.00</span><span class="n">x</span><span class="w"> </span><span class="n">faster</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span><span class="o">!</span>

<span class="w">  </span><span class="p">[</span><span class="mi">3847607</span><span class="w"> </span><span class="mf">3856010.05</span><span class="w"> </span><span class="mi">3909326</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">3845022</span><span class="w"> </span><span class="mf">3851238.37</span><span class="w"> </span><span class="mi">3912075</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">execution</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="p">.</span><span class="o">/</span><span class="n">benchmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">scalar</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">6515</span><span class="w"> </span><span class="mf">6877.80</span><span class="w"> </span><span class="mi">14550</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">6489</span><span class="w"> </span><span class="mf">7310.42</span><span class="w"> </span><span class="mi">13787</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">instantiation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="p">.</span><span class="o">/</span><span class="n">benchmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">scalar</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">927</span><span class="w"> </span><span class="mf">1029.46</span><span class="w"> </span><span class="mi">1697</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">923</span><span class="w"> </span><span class="mf">1067.02</span><span class="w"> </span><span class="mi">2110</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">instantiation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">spidermonkey</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">3555</span><span class="w"> </span><span class="mf">4316.19</span><span class="w"> </span><span class="mi">8421</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">3588</span><span class="w"> </span><span class="mf">4375.00</span><span class="w"> </span><span class="mi">8089</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">instantiation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">regex</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">2981</span><span class="w"> </span><span class="mf">3225.85</span><span class="w"> </span><span class="mi">3511</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">2986</span><span class="w"> </span><span class="mf">3242.21</span><span class="w"> </span><span class="mi">3598</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">instantiation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">bz2</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">990</span><span class="w"> </span><span class="mf">1147.83</span><span class="w"> </span><span class="mi">1970</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">1000</span><span class="w"> </span><span class="mf">1153.04</span><span class="w"> </span><span class="mi">2124</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">compilation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="p">.</span><span class="o">/</span><span class="n">benchmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">scalar</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">2607381</span><span class="w"> </span><span class="mf">2665940.83</span><span class="w"> </span><span class="mi">2808423</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">2599335</span><span class="w"> </span><span class="mf">2655289.42</span><span class="w"> </span><span class="mi">2750262</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">compilation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">spidermonkey</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">111352544</span><span class="w"> </span><span class="mf">113374288.89</span><span class="w"> </span><span class="mi">115552774</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">111363591</span><span class="w"> </span><span class="mf">113073838.73</span><span class="w"> </span><span class="mi">115549133</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">execution</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">bz2</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">1024902</span><span class="w"> </span><span class="mf">1040201.83</span><span class="w"> </span><span class="mi">1092704</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">1025677</span><span class="w"> </span><span class="mf">1041126.17</span><span class="w"> </span><span class="mi">1101387</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">compilation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">bz2</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">2020133</span><span class="w"> </span><span class="mf">2223545.22</span><span class="w"> </span><span class="mi">2354573</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">2067731</span><span class="w"> </span><span class="mf">2224627.35</span><span class="w"> </span><span class="mi">2372602</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">compilation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">regex</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">10651375</span><span class="w"> </span><span class="mf">10816177.71</span><span class="w"> </span><span class="mi">10994312</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">10625726</span><span class="w"> </span><span class="mf">10814925.59</span><span class="w"> </span><span class="mi">11001537</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>
</code></pre></div>
<p>&lt;/details&gt;</p>
<hr>
<p>I also tried to run the above benchmark via sightglass but couldn't get it to execute, so I ran it using a precompiled module using the wasmtime cli, but the results have quite a large uncertainty. Do you have any suggestions on how I can do this better?</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">afonso</span><span class="o">@</span><span class="n">starfive</span>:<span class="o">~</span><span class="cp">$</span><span class="w"> </span><span class="n">hyperfine</span><span class="w">     </span><span class="o">--</span><span class="n">warmup</span><span class="w"> </span><span class="mi">1000</span><span class="w">     </span><span class="o">--</span><span class="n">runs</span><span class="w"> </span><span class="mi">5000</span><span class="w">     </span><span class="o">'~/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">main</span><span class="w"> </span><span class="o">--</span><span class="n">allow</span><span class="o">-</span><span class="n">precompiled</span><span class="w"> </span><span class="o">~/</span><span class="n">bench</span><span class="o">-</span><span class="n">main</span><span class="p">.</span><span class="n">cwasm</span><span class="o">'</span><span class="w">     </span><span class="o">'~/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">fflags</span><span class="w"> </span><span class="o">--</span><span class="n">allow</span><span class="o">-</span><span class="n">precompiled</span><span class="w"> </span><span class="o">~/</span><span class="n">bench</span><span class="o">-</span><span class="n">fflags</span><span class="p">.</span><span class="n">cwasm</span><span class="o">'</span>
<span class="n">Benchmark</span><span class="w"> </span><span class="mi">1</span>: <span class="o">~/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">main</span><span class="w"> </span><span class="o">--</span><span class="n">allow</span><span class="o">-</span><span class="n">precompiled</span><span class="w"> </span><span class="o">~/</span><span class="n">bench</span><span class="o">-</span><span class="n">main</span><span class="p">.</span><span class="n">cwasm</span>
<span class="w">  </span><span class="n">Time</span><span class="w"> </span><span class="p">(</span><span class="n">mean</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="err">σ</span><span class="p">)</span>:      <span class="mf">24.5</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="err">±</span><span class="w">   </span><span class="mf">4.0</span><span class="w"> </span><span class="n">ms</span><span class="w">    </span><span class="p">[</span><span class="n">User</span>: <span class="mf">13.3</span><span class="w"> </span><span class="n">ms</span><span class="p">,</span><span class="w"> </span><span class="n">System</span>: <span class="mf">9.9</span><span class="w"> </span><span class="n">ms</span><span class="p">]</span>
<span class="w">  </span><span class="n">Range</span><span class="w"> </span><span class="p">(</span><span class="n">min</span><span class="w"> </span><span class="err">…</span><span class="w"> </span><span class="n">max</span><span class="p">)</span>:    <span class="mf">21.3</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="err">…</span><span class="w">  </span><span class="mf">37.0</span><span class="w"> </span><span class="n">ms</span><span class="w">    </span><span class="mi">5000</span><span class="w"> </span><span class="n">runs</span>

<span class="w">  </span><span class="n">Warning</span>: <span class="nc">Statistical</span><span class="w"> </span><span class="n">outliers</span><span class="w"> </span><span class="n">were</span><span class="w"> </span><span class="n">detected</span><span class="p">.</span><span class="w"> </span><span class="n">Consider</span><span class="w"> </span><span class="n">re</span><span class="o">-</span><span class="n">running</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">benchmark</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">quiet</span><span class="w"> </span><span class="n">system</span><span class="w"> </span><span class="n">without</span><span class="w"> </span><span class="n">any</span><span class="w"> </span><span class="n">interferences</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="n">programs</span><span class="p">.</span><span class="w"> </span><span class="n">It</span><span class="w"> </span><span class="n">might</span><span class="w"> </span><span class="n">help</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="o">'--</span><span class="n">warmup</span><span class="o">'</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="o">'--</span><span class="n">prepare</span><span class="o">'</span><span class="w"> </span><span class="n">options</span><span class="p">.</span>

<span class="n">Benchmark</span><span class="w"> </span><span class="mi">2</span>: <span class="o">~/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">fflags</span><span class="w"> </span><span class="o">--</span><span class="n">allow</span><span class="o">-</span><span class="n">precompiled</span><span class="w"> </span><span class="o">~/</span><span class="n">bench</span><span class="o">-</span><span class="n">fflags</span><span class="p">.</span><span class="n">cwasm</span>
<span class="w">  </span><span class="n">Time</span><span class="w"> </span><span class="p">(</span><span class="n">mean</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="err">σ</span><span class="p">)</span>:      <span class="mf">23.8</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="err">±</span><span class="w">   </span><span class="mf">3.6</span><span class="w"> </span><span class="n">ms</span><span class="w">    </span><span class="p">[</span><span class="n">User</span>: <span class="mf">13.3</span><span class="w"> </span><span class="n">ms</span><span class="p">,</span><span class="w"> </span><span class="n">System</span>: <span class="mf">9.2</span><span class="w"> </span><span class="n">ms</span><span class="p">]</span>
<span class="w">  </span><span class="n">Range</span><span class="w"> </span><span class="p">(</span><span class="n">min</span><span class="w"> </span><span class="err">…</span><span class="w"> </span><span class="n">max</span><span class="p">)</span>:    <span class="mf">20.7</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="err">…</span><span class="w">  </span><span class="mf">40.1</span><span class="w"> </span><span class="n">ms</span><span class="w">    </span><span class="mi">5000</span><span class="w"> </span><span class="n">runs</span>

<span class="w">  </span><span class="n">Warning</span>: <span class="nc">Statistical</span><span class="w"> </span><span class="n">outliers</span><span class="w"> </span><span class="n">were</span><span class="w"> </span><span class="n">detected</span><span class="p">.</span><span class="w"> </span><span class="n">Consider</span><span class="w"> </span><span class="n">re</span><span class="o">-</span><span class="n">running</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">benchmark</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">quiet</span><span class="w"> </span><span class="n">system</span><span class="w"> </span><span class="n">without</span><span class="w"> </span><span class="n">any</span><span class="w"> </span><span class="n">interferences</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="n">programs</span><span class="p">.</span><span class="w"> </span><span class="n">It</span><span class="w"> </span><span class="n">might</span><span class="w"> </span><span class="n">help</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="o">'--</span><span class="n">warmup</span><span class="o">'</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="o">'--</span><span class="n">prepare</span><span class="o">'</span><span class="w"> </span><span class="n">options</span><span class="p">.</span>

<span class="n">Summary</span>
<span class="w">  </span><span class="o">~/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">fflags</span><span class="w"> </span><span class="o">--</span><span class="n">allow</span><span class="o">-</span><span class="n">precompiled</span><span class="w"> </span><span class="o">~/</span><span class="n">bench</span><span class="o">-</span><span class="n">fflags</span><span class="p">.</span><span class="n">cwasm</span><span class="w"> </span><span class="n">ran</span>
<span class="w">    </span><span class="mf">1.03</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="mf">0.23</span><span class="w"> </span><span class="n">times</span><span class="w"> </span><span class="n">faster</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="o">~/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">main</span><span class="w"> </span><span class="o">--</span><span class="n">allow</span><span class="o">-</span><span class="n">precompiled</span><span class="w"> </span><span class="o">~/</span><span class="n">bench</span><span class="o">-</span><span class="n">main</span><span class="p">.</span><span class="n">cwasm</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="398324419"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237340%20riscv64%3A%20Refactor%20float-to-int%20tra.../near/398324419" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237340.20riscv64.3A.20Refactor.20float-to-int.20tra.2E.2E.2E.html#398324419">(Oct 24 2023 at 16:32)</a>:</h4>
<p>afonso360 edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/7340#issuecomment-1777600834">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/7340">issue #7340</a>:</p>
<blockquote>
<p>I have some interesting results, and some confusing results.</p>
<p>I first ran sightglass with a smaller iteration count and got the results that <code>main</code> was faster than <code>fflags</code> by 3% in spidermonkey, which was surprising to me so I ran it again with the default iteration count and got the same result.</p>
<p>&lt;details&gt;<br>
 &lt;summary&gt;Sightglass Run 1&lt;/summary&gt;</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">afonso</span><span class="o">@</span><span class="n">starfive</span>:<span class="o">~/</span><span class="n">git</span><span class="o">/</span><span class="n">sightglass</span><span class="cp">$</span><span class="w"> </span><span class="n">cargo</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="n">benchmark</span><span class="w"> </span><span class="o">--</span><span class="n">processes</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="o">--</span><span class="n">iterations</span><span class="o">-</span><span class="n">per</span><span class="o">-</span><span class="n">process</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="o">--</span><span class="n">engine</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">engine</span><span class="o">-</span><span class="n">ffla</span>
<span class="n">gs</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="o">--</span><span class="n">engine</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">engine</span><span class="o">-</span><span class="n">main</span><span class="p">.</span><span class="n">so</span><span class="w">  </span><span class="o">--</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">benchmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">scalar</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span><span class="w">  </span><span class="n">benchmarks</span><span class="o">/</span><span class="n">bz2</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="n">benchmarks</span><span class="o">/</span>
<span class="n">regex</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="n">benchmarks</span><span class="o">/</span><span class="n">spidermonkey</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="n">execution</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">spidermonkey</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="err">Δ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">611139.96</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="mf">69194.06</span><span class="w"> </span><span class="p">(</span><span class="n">confidence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">99</span><span class="o">%</span><span class="p">)</span>

<span class="w">  </span><span class="n">main</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="mf">1.03</span><span class="n">x</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="mf">1.03</span><span class="n">x</span><span class="w"> </span><span class="n">faster</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span><span class="o">!</span>

<span class="w">  </span><span class="p">[</span><span class="mi">22003870</span><span class="w"> </span><span class="mf">22177803.84</span><span class="w"> </span><span class="mi">22296431</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">21400346</span><span class="w"> </span><span class="mf">21566663.88</span><span class="w"> </span><span class="mi">21700502</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">execution</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="p">.</span><span class="o">/</span><span class="n">benchmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">scalar</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">6516</span><span class="w"> </span><span class="mf">7450.52</span><span class="w"> </span><span class="mi">14467</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">6500</span><span class="w"> </span><span class="mf">6845.04</span><span class="w"> </span><span class="mi">13012</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">instantiation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="p">.</span><span class="o">/</span><span class="n">benchmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">scalar</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">950</span><span class="w"> </span><span class="mf">1073.44</span><span class="w"> </span><span class="mi">1500</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">939</span><span class="w"> </span><span class="mf">1039.24</span><span class="w"> </span><span class="mi">1814</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">instantiation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">bz2</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">991</span><span class="w"> </span><span class="mf">1109.80</span><span class="w"> </span><span class="mi">1603</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">1018</span><span class="w"> </span><span class="mf">1129.44</span><span class="w"> </span><span class="mi">1811</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">instantiation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">spidermonkey</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">3600</span><span class="w"> </span><span class="mf">4488.00</span><span class="w"> </span><span class="mi">8483</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">3660</span><span class="w"> </span><span class="mf">4418.44</span><span class="w"> </span><span class="mi">9216</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">execution</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">bz2</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">1025843</span><span class="w"> </span><span class="mf">1035182.96</span><span class="w"> </span><span class="mi">1079490</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">1026383</span><span class="w"> </span><span class="mf">1044678.80</span><span class="w"> </span><span class="mi">1099227</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">instantiation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">regex</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">2930</span><span class="w"> </span><span class="mf">3202.92</span><span class="w"> </span><span class="mi">3354</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">2983</span><span class="w"> </span><span class="mf">3231.48</span><span class="w"> </span><span class="mi">3832</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">compilation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">regex</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">10667840</span><span class="w"> </span><span class="mf">10819084.56</span><span class="w"> </span><span class="mi">10947259</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">10725380</span><span class="w"> </span><span class="mf">10845151.60</span><span class="w"> </span><span class="mi">10951025</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">compilation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">spidermonkey</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">111451448</span><span class="w"> </span><span class="mf">113120311.48</span><span class="w"> </span><span class="mi">115050440</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">111395436</span><span class="w"> </span><span class="mf">112890160.52</span><span class="w"> </span><span class="mi">115262339</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">compilation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">bz2</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">2033630</span><span class="w"> </span><span class="mf">2237015.88</span><span class="w"> </span><span class="mi">2365106</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">2032061</span><span class="w"> </span><span class="mf">2233455.48</span><span class="w"> </span><span class="mi">2332395</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">execution</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">regex</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">3845964</span><span class="w"> </span><span class="mf">3852698.64</span><span class="w"> </span><span class="mi">3870163</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">3845116</span><span class="w"> </span><span class="mf">3849177.08</span><span class="w"> </span><span class="mi">3880686</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">compilation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="p">.</span><span class="o">/</span><span class="n">benchmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">scalar</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">2641545</span><span class="w"> </span><span class="mf">2668781.48</span><span class="w"> </span><span class="mi">2727010</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">2621339</span><span class="w"> </span><span class="mf">2667785.92</span><span class="w"> </span><span class="mi">2797660</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>
</code></pre></div>
<p>&lt;/details&gt;</p>
<p>&lt;details&gt;<br>
 &lt;summary&gt;Sightglass Run 2&lt;/summary&gt;</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">afonso</span><span class="o">@</span><span class="n">starfive</span>:<span class="o">~/</span><span class="n">git</span><span class="o">/</span><span class="n">sightglass</span><span class="cp">$</span><span class="w"> </span><span class="n">cargo</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="n">benchmark</span><span class="w"> </span><span class="o">--</span><span class="n">engine</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">engine</span><span class="o">-</span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="o">--</span><span class="n">engine</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">engine</span><span class="o">-</span><span class="n">main</span><span class="p">.</span><span class="n">so</span><span class="w">  </span><span class="o">--</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">ben</span>
<span class="n">chmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">scalar</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span><span class="w">  </span><span class="n">benchmarks</span><span class="o">/</span><span class="n">bz2</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="n">benchmarks</span><span class="o">/</span><span class="n">regex</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="n">benchmarks</span><span class="o">/</span><span class="n">spidermon</span>
<span class="n">key</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>
<span class="n">execution</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">spidermonkey</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="err">Δ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">528886.85</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="mf">30356.42</span><span class="w"> </span><span class="p">(</span><span class="n">confidence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">99</span><span class="o">%</span><span class="p">)</span>

<span class="w">  </span><span class="n">main</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="mf">1.02</span><span class="n">x</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="mf">1.03</span><span class="n">x</span><span class="w"> </span><span class="n">faster</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span><span class="o">!</span>

<span class="w">  </span><span class="p">[</span><span class="mi">21985977</span><span class="w"> </span><span class="mf">22155294.58</span><span class="w"> </span><span class="mi">22282664</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">21399233</span><span class="w"> </span><span class="mf">21626407.73</span><span class="w"> </span><span class="mi">21778731</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">execution</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">regex</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="err">Δ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">4771.68</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="mf">2965.39</span><span class="w"> </span><span class="p">(</span><span class="n">confidence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">99</span><span class="o">%</span><span class="p">)</span>

<span class="w">  </span><span class="n">main</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="mf">1.00</span><span class="n">x</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="mf">1.00</span><span class="n">x</span><span class="w"> </span><span class="n">faster</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span><span class="o">!</span>

<span class="w">  </span><span class="p">[</span><span class="mi">3847607</span><span class="w"> </span><span class="mf">3856010.05</span><span class="w"> </span><span class="mi">3909326</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">3845022</span><span class="w"> </span><span class="mf">3851238.37</span><span class="w"> </span><span class="mi">3912075</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">execution</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="p">.</span><span class="o">/</span><span class="n">benchmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">scalar</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">6515</span><span class="w"> </span><span class="mf">6877.80</span><span class="w"> </span><span class="mi">14550</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">6489</span><span class="w"> </span><span class="mf">7310.42</span><span class="w"> </span><span class="mi">13787</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">instantiation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="p">.</span><span class="o">/</span><span class="n">benchmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">scalar</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">927</span><span class="w"> </span><span class="mf">1029.46</span><span class="w"> </span><span class="mi">1697</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">923</span><span class="w"> </span><span class="mf">1067.02</span><span class="w"> </span><span class="mi">2110</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">instantiation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">spidermonkey</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">3555</span><span class="w"> </span><span class="mf">4316.19</span><span class="w"> </span><span class="mi">8421</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">3588</span><span class="w"> </span><span class="mf">4375.00</span><span class="w"> </span><span class="mi">8089</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">instantiation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">regex</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">2981</span><span class="w"> </span><span class="mf">3225.85</span><span class="w"> </span><span class="mi">3511</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">2986</span><span class="w"> </span><span class="mf">3242.21</span><span class="w"> </span><span class="mi">3598</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">instantiation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">bz2</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">990</span><span class="w"> </span><span class="mf">1147.83</span><span class="w"> </span><span class="mi">1970</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">1000</span><span class="w"> </span><span class="mf">1153.04</span><span class="w"> </span><span class="mi">2124</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">compilation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="p">.</span><span class="o">/</span><span class="n">benchmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">scalar</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">2607381</span><span class="w"> </span><span class="mf">2665940.83</span><span class="w"> </span><span class="mi">2808423</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">2599335</span><span class="w"> </span><span class="mf">2655289.42</span><span class="w"> </span><span class="mi">2750262</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">compilation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">spidermonkey</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">111352544</span><span class="w"> </span><span class="mf">113374288.89</span><span class="w"> </span><span class="mi">115552774</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">111363591</span><span class="w"> </span><span class="mf">113073838.73</span><span class="w"> </span><span class="mi">115549133</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">execution</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">bz2</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">1024902</span><span class="w"> </span><span class="mf">1040201.83</span><span class="w"> </span><span class="mi">1092704</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">1025677</span><span class="w"> </span><span class="mf">1041126.17</span><span class="w"> </span><span class="mi">1101387</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">compilation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">bz2</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">2020133</span><span class="w"> </span><span class="mf">2223545.22</span><span class="w"> </span><span class="mi">2354573</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">2067731</span><span class="w"> </span><span class="mf">2224627.35</span><span class="w"> </span><span class="mi">2372602</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">compilation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">regex</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">10651375</span><span class="w"> </span><span class="mf">10816177.71</span><span class="w"> </span><span class="mi">10994312</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">10625726</span><span class="w"> </span><span class="mf">10814925.59</span><span class="w"> </span><span class="mi">11001537</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>
</code></pre></div>
<p>&lt;/details&gt;</p>
<hr>
<p>I also tried to run the above benchmark via sightglass but couldn't get it to execute, so I ran it using a precompiled module and the wasmtime cli, but the results have quite a large uncertainty. Do you have any suggestions on how I can do this better?</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">afonso</span><span class="o">@</span><span class="n">starfive</span>:<span class="o">~</span><span class="cp">$</span><span class="w"> </span><span class="n">hyperfine</span><span class="w">     </span><span class="o">--</span><span class="n">warmup</span><span class="w"> </span><span class="mi">1000</span><span class="w">     </span><span class="o">--</span><span class="n">runs</span><span class="w"> </span><span class="mi">5000</span><span class="w">     </span><span class="o">'~/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">main</span><span class="w"> </span><span class="o">--</span><span class="n">allow</span><span class="o">-</span><span class="n">precompiled</span><span class="w"> </span><span class="o">~/</span><span class="n">bench</span><span class="o">-</span><span class="n">main</span><span class="p">.</span><span class="n">cwasm</span><span class="o">'</span><span class="w">     </span><span class="o">'~/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">fflags</span><span class="w"> </span><span class="o">--</span><span class="n">allow</span><span class="o">-</span><span class="n">precompiled</span><span class="w"> </span><span class="o">~/</span><span class="n">bench</span><span class="o">-</span><span class="n">fflags</span><span class="p">.</span><span class="n">cwasm</span><span class="o">'</span>
<span class="n">Benchmark</span><span class="w"> </span><span class="mi">1</span>: <span class="o">~/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">main</span><span class="w"> </span><span class="o">--</span><span class="n">allow</span><span class="o">-</span><span class="n">precompiled</span><span class="w"> </span><span class="o">~/</span><span class="n">bench</span><span class="o">-</span><span class="n">main</span><span class="p">.</span><span class="n">cwasm</span>
<span class="w">  </span><span class="n">Time</span><span class="w"> </span><span class="p">(</span><span class="n">mean</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="err">σ</span><span class="p">)</span>:      <span class="mf">24.5</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="err">±</span><span class="w">   </span><span class="mf">4.0</span><span class="w"> </span><span class="n">ms</span><span class="w">    </span><span class="p">[</span><span class="n">User</span>: <span class="mf">13.3</span><span class="w"> </span><span class="n">ms</span><span class="p">,</span><span class="w"> </span><span class="n">System</span>: <span class="mf">9.9</span><span class="w"> </span><span class="n">ms</span><span class="p">]</span>
<span class="w">  </span><span class="n">Range</span><span class="w"> </span><span class="p">(</span><span class="n">min</span><span class="w"> </span><span class="err">…</span><span class="w"> </span><span class="n">max</span><span class="p">)</span>:    <span class="mf">21.3</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="err">…</span><span class="w">  </span><span class="mf">37.0</span><span class="w"> </span><span class="n">ms</span><span class="w">    </span><span class="mi">5000</span><span class="w"> </span><span class="n">runs</span>

<span class="w">  </span><span class="n">Warning</span>: <span class="nc">Statistical</span><span class="w"> </span><span class="n">outliers</span><span class="w"> </span><span class="n">were</span><span class="w"> </span><span class="n">detected</span><span class="p">.</span><span class="w"> </span><span class="n">Consider</span><span class="w"> </span><span class="n">re</span><span class="o">-</span><span class="n">running</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">benchmark</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">quiet</span><span class="w"> </span><span class="n">system</span><span class="w"> </span><span class="n">without</span><span class="w"> </span><span class="n">any</span><span class="w"> </span><span class="n">interferences</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="n">programs</span><span class="p">.</span><span class="w"> </span><span class="n">It</span><span class="w"> </span><span class="n">might</span><span class="w"> </span><span class="n">help</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="o">'--</span><span class="n">warmup</span><span class="o">'</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="o">'--</span><span class="n">prepare</span><span class="o">'</span><span class="w"> </span><span class="n">options</span><span class="p">.</span>

<span class="n">Benchmark</span><span class="w"> </span><span class="mi">2</span>: <span class="o">~/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">fflags</span><span class="w"> </span><span class="o">--</span><span class="n">allow</span><span class="o">-</span><span class="n">precompiled</span><span class="w"> </span><span class="o">~/</span><span class="n">bench</span><span class="o">-</span><span class="n">fflags</span><span class="p">.</span><span class="n">cwasm</span>
<span class="w">  </span><span class="n">Time</span><span class="w"> </span><span class="p">(</span><span class="n">mean</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="err">σ</span><span class="p">)</span>:      <span class="mf">23.8</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="err">±</span><span class="w">   </span><span class="mf">3.6</span><span class="w"> </span><span class="n">ms</span><span class="w">    </span><span class="p">[</span><span class="n">User</span>: <span class="mf">13.3</span><span class="w"> </span><span class="n">ms</span><span class="p">,</span><span class="w"> </span><span class="n">System</span>: <span class="mf">9.2</span><span class="w"> </span><span class="n">ms</span><span class="p">]</span>
<span class="w">  </span><span class="n">Range</span><span class="w"> </span><span class="p">(</span><span class="n">min</span><span class="w"> </span><span class="err">…</span><span class="w"> </span><span class="n">max</span><span class="p">)</span>:    <span class="mf">20.7</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="err">…</span><span class="w">  </span><span class="mf">40.1</span><span class="w"> </span><span class="n">ms</span><span class="w">    </span><span class="mi">5000</span><span class="w"> </span><span class="n">runs</span>

<span class="w">  </span><span class="n">Warning</span>: <span class="nc">Statistical</span><span class="w"> </span><span class="n">outliers</span><span class="w"> </span><span class="n">were</span><span class="w"> </span><span class="n">detected</span><span class="p">.</span><span class="w"> </span><span class="n">Consider</span><span class="w"> </span><span class="n">re</span><span class="o">-</span><span class="n">running</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">benchmark</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">quiet</span><span class="w"> </span><span class="n">system</span><span class="w"> </span><span class="n">without</span><span class="w"> </span><span class="n">any</span><span class="w"> </span><span class="n">interferences</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="n">programs</span><span class="p">.</span><span class="w"> </span><span class="n">It</span><span class="w"> </span><span class="n">might</span><span class="w"> </span><span class="n">help</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="o">'--</span><span class="n">warmup</span><span class="o">'</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="o">'--</span><span class="n">prepare</span><span class="o">'</span><span class="w"> </span><span class="n">options</span><span class="p">.</span>

<span class="n">Summary</span>
<span class="w">  </span><span class="o">~/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">fflags</span><span class="w"> </span><span class="o">--</span><span class="n">allow</span><span class="o">-</span><span class="n">precompiled</span><span class="w"> </span><span class="o">~/</span><span class="n">bench</span><span class="o">-</span><span class="n">fflags</span><span class="p">.</span><span class="n">cwasm</span><span class="w"> </span><span class="n">ran</span>
<span class="w">    </span><span class="mf">1.03</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="mf">0.23</span><span class="w"> </span><span class="n">times</span><span class="w"> </span><span class="n">faster</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="o">~/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">main</span><span class="w"> </span><span class="o">--</span><span class="n">allow</span><span class="o">-</span><span class="n">precompiled</span><span class="w"> </span><span class="o">~/</span><span class="n">bench</span><span class="o">-</span><span class="n">main</span><span class="p">.</span><span class="n">cwasm</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="398324717"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237340%20riscv64%3A%20Refactor%20float-to-int%20tra.../near/398324717" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237340.20riscv64.3A.20Refactor.20float-to-int.20tra.2E.2E.2E.html#398324717">(Oct 24 2023 at 16:34)</a>:</h4>
<p>afonso360 edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/7340#issuecomment-1777600834">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/7340">issue #7340</a>:</p>
<blockquote>
<p>I have some interesting results, and some confusing results.</p>
<p>I first ran sightglass with a smaller iteration count and got the results that <code>main</code> was faster than <code>fflags</code> by 3% in spidermonkey, which was surprising to me so I ran it again with the default iteration count and got the same result.</p>
<p>&lt;details&gt;<br>
 &lt;summary&gt;Sightglass Run 1&lt;/summary&gt;</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">afonso</span><span class="o">@</span><span class="n">starfive</span>:<span class="o">~/</span><span class="n">git</span><span class="o">/</span><span class="n">sightglass</span><span class="cp">$</span><span class="w"> </span><span class="n">cargo</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="n">benchmark</span><span class="w"> </span><span class="o">--</span><span class="n">processes</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="o">--</span><span class="n">iterations</span><span class="o">-</span><span class="n">per</span><span class="o">-</span><span class="n">process</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="o">--</span><span class="n">engine</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">engine</span><span class="o">-</span><span class="n">ffla</span>
<span class="n">gs</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="o">--</span><span class="n">engine</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">engine</span><span class="o">-</span><span class="n">main</span><span class="p">.</span><span class="n">so</span><span class="w">  </span><span class="o">--</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">benchmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">scalar</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span><span class="w">  </span><span class="n">benchmarks</span><span class="o">/</span><span class="n">bz2</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="n">benchmarks</span><span class="o">/</span>
<span class="n">regex</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="n">benchmarks</span><span class="o">/</span><span class="n">spidermonkey</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="n">execution</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">spidermonkey</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="err">Δ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">611139.96</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="mf">69194.06</span><span class="w"> </span><span class="p">(</span><span class="n">confidence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">99</span><span class="o">%</span><span class="p">)</span>

<span class="w">  </span><span class="n">main</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="mf">1.03</span><span class="n">x</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="mf">1.03</span><span class="n">x</span><span class="w"> </span><span class="n">faster</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span><span class="o">!</span>

<span class="w">  </span><span class="p">[</span><span class="mi">22003870</span><span class="w"> </span><span class="mf">22177803.84</span><span class="w"> </span><span class="mi">22296431</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">21400346</span><span class="w"> </span><span class="mf">21566663.88</span><span class="w"> </span><span class="mi">21700502</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">execution</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="p">.</span><span class="o">/</span><span class="n">benchmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">scalar</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">6516</span><span class="w"> </span><span class="mf">7450.52</span><span class="w"> </span><span class="mi">14467</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">6500</span><span class="w"> </span><span class="mf">6845.04</span><span class="w"> </span><span class="mi">13012</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">instantiation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="p">.</span><span class="o">/</span><span class="n">benchmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">scalar</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">950</span><span class="w"> </span><span class="mf">1073.44</span><span class="w"> </span><span class="mi">1500</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">939</span><span class="w"> </span><span class="mf">1039.24</span><span class="w"> </span><span class="mi">1814</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">instantiation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">bz2</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">991</span><span class="w"> </span><span class="mf">1109.80</span><span class="w"> </span><span class="mi">1603</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">1018</span><span class="w"> </span><span class="mf">1129.44</span><span class="w"> </span><span class="mi">1811</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">instantiation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">spidermonkey</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">3600</span><span class="w"> </span><span class="mf">4488.00</span><span class="w"> </span><span class="mi">8483</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">3660</span><span class="w"> </span><span class="mf">4418.44</span><span class="w"> </span><span class="mi">9216</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">execution</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">bz2</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">1025843</span><span class="w"> </span><span class="mf">1035182.96</span><span class="w"> </span><span class="mi">1079490</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">1026383</span><span class="w"> </span><span class="mf">1044678.80</span><span class="w"> </span><span class="mi">1099227</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">instantiation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">regex</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">2930</span><span class="w"> </span><span class="mf">3202.92</span><span class="w"> </span><span class="mi">3354</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">2983</span><span class="w"> </span><span class="mf">3231.48</span><span class="w"> </span><span class="mi">3832</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">compilation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">regex</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">10667840</span><span class="w"> </span><span class="mf">10819084.56</span><span class="w"> </span><span class="mi">10947259</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">10725380</span><span class="w"> </span><span class="mf">10845151.60</span><span class="w"> </span><span class="mi">10951025</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">compilation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">spidermonkey</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">111451448</span><span class="w"> </span><span class="mf">113120311.48</span><span class="w"> </span><span class="mi">115050440</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">111395436</span><span class="w"> </span><span class="mf">112890160.52</span><span class="w"> </span><span class="mi">115262339</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">compilation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">bz2</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">2033630</span><span class="w"> </span><span class="mf">2237015.88</span><span class="w"> </span><span class="mi">2365106</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">2032061</span><span class="w"> </span><span class="mf">2233455.48</span><span class="w"> </span><span class="mi">2332395</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">execution</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">regex</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">3845964</span><span class="w"> </span><span class="mf">3852698.64</span><span class="w"> </span><span class="mi">3870163</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">3845116</span><span class="w"> </span><span class="mf">3849177.08</span><span class="w"> </span><span class="mi">3880686</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">compilation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="p">.</span><span class="o">/</span><span class="n">benchmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">scalar</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">2641545</span><span class="w"> </span><span class="mf">2668781.48</span><span class="w"> </span><span class="mi">2727010</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">2621339</span><span class="w"> </span><span class="mf">2667785.92</span><span class="w"> </span><span class="mi">2797660</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>
</code></pre></div>
<p>&lt;/details&gt;</p>
<p>&lt;details&gt;<br>
 &lt;summary&gt;Sightglass Run 2&lt;/summary&gt;</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">afonso</span><span class="o">@</span><span class="n">starfive</span>:<span class="o">~/</span><span class="n">git</span><span class="o">/</span><span class="n">sightglass</span><span class="cp">$</span><span class="w"> </span><span class="n">cargo</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="n">benchmark</span><span class="w"> </span><span class="o">--</span><span class="n">engine</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">engine</span><span class="o">-</span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="o">--</span><span class="n">engine</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">engine</span><span class="o">-</span><span class="n">main</span><span class="p">.</span><span class="n">so</span><span class="w">  </span><span class="o">--</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">ben</span>
<span class="n">chmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">scalar</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span><span class="w">  </span><span class="n">benchmarks</span><span class="o">/</span><span class="n">bz2</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="n">benchmarks</span><span class="o">/</span><span class="n">regex</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="n">benchmarks</span><span class="o">/</span><span class="n">spidermon</span>
<span class="n">key</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>
<span class="n">execution</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">spidermonkey</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="err">Δ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">528886.85</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="mf">30356.42</span><span class="w"> </span><span class="p">(</span><span class="n">confidence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">99</span><span class="o">%</span><span class="p">)</span>

<span class="w">  </span><span class="n">main</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="mf">1.02</span><span class="n">x</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="mf">1.03</span><span class="n">x</span><span class="w"> </span><span class="n">faster</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span><span class="o">!</span>

<span class="w">  </span><span class="p">[</span><span class="mi">21985977</span><span class="w"> </span><span class="mf">22155294.58</span><span class="w"> </span><span class="mi">22282664</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">21399233</span><span class="w"> </span><span class="mf">21626407.73</span><span class="w"> </span><span class="mi">21778731</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">execution</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">regex</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="err">Δ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">4771.68</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="mf">2965.39</span><span class="w"> </span><span class="p">(</span><span class="n">confidence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">99</span><span class="o">%</span><span class="p">)</span>

<span class="w">  </span><span class="n">main</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="mf">1.00</span><span class="n">x</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="mf">1.00</span><span class="n">x</span><span class="w"> </span><span class="n">faster</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span><span class="o">!</span>

<span class="w">  </span><span class="p">[</span><span class="mi">3847607</span><span class="w"> </span><span class="mf">3856010.05</span><span class="w"> </span><span class="mi">3909326</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">3845022</span><span class="w"> </span><span class="mf">3851238.37</span><span class="w"> </span><span class="mi">3912075</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">execution</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="p">.</span><span class="o">/</span><span class="n">benchmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">scalar</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">6515</span><span class="w"> </span><span class="mf">6877.80</span><span class="w"> </span><span class="mi">14550</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">6489</span><span class="w"> </span><span class="mf">7310.42</span><span class="w"> </span><span class="mi">13787</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">instantiation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="p">.</span><span class="o">/</span><span class="n">benchmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">scalar</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">927</span><span class="w"> </span><span class="mf">1029.46</span><span class="w"> </span><span class="mi">1697</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">923</span><span class="w"> </span><span class="mf">1067.02</span><span class="w"> </span><span class="mi">2110</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">instantiation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">spidermonkey</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">3555</span><span class="w"> </span><span class="mf">4316.19</span><span class="w"> </span><span class="mi">8421</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">3588</span><span class="w"> </span><span class="mf">4375.00</span><span class="w"> </span><span class="mi">8089</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">instantiation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">regex</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">2981</span><span class="w"> </span><span class="mf">3225.85</span><span class="w"> </span><span class="mi">3511</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">2986</span><span class="w"> </span><span class="mf">3242.21</span><span class="w"> </span><span class="mi">3598</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">instantiation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">bz2</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">990</span><span class="w"> </span><span class="mf">1147.83</span><span class="w"> </span><span class="mi">1970</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">1000</span><span class="w"> </span><span class="mf">1153.04</span><span class="w"> </span><span class="mi">2124</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">compilation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="p">.</span><span class="o">/</span><span class="n">benchmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">scalar</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">2607381</span><span class="w"> </span><span class="mf">2665940.83</span><span class="w"> </span><span class="mi">2808423</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">2599335</span><span class="w"> </span><span class="mf">2655289.42</span><span class="w"> </span><span class="mi">2750262</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">compilation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">spidermonkey</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">111352544</span><span class="w"> </span><span class="mf">113374288.89</span><span class="w"> </span><span class="mi">115552774</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">111363591</span><span class="w"> </span><span class="mf">113073838.73</span><span class="w"> </span><span class="mi">115549133</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">execution</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">bz2</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">1024902</span><span class="w"> </span><span class="mf">1040201.83</span><span class="w"> </span><span class="mi">1092704</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">1025677</span><span class="w"> </span><span class="mf">1041126.17</span><span class="w"> </span><span class="mi">1101387</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">compilation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">bz2</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">2020133</span><span class="w"> </span><span class="mf">2223545.22</span><span class="w"> </span><span class="mi">2354573</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">2067731</span><span class="w"> </span><span class="mf">2224627.35</span><span class="w"> </span><span class="mi">2372602</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">compilation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">regex</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">10651375</span><span class="w"> </span><span class="mf">10816177.71</span><span class="w"> </span><span class="mi">10994312</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">10625726</span><span class="w"> </span><span class="mf">10814925.59</span><span class="w"> </span><span class="mi">11001537</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>
</code></pre></div>
<p>&lt;/details&gt;</p>
<hr>
<p>I also tried to run the above benchmark via sightglass but couldn't get it to execute, so I ran it using a precompiled module and the wasmtime cli, but the results have quite a large uncertainty. Do you have any suggestions on how I can do this better?</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">afonso</span><span class="o">@</span><span class="n">starfive</span>:<span class="o">~</span><span class="cp">$</span><span class="w"> </span><span class="n">hyperfine</span><span class="w">     </span><span class="o">--</span><span class="n">warmup</span><span class="w"> </span><span class="mi">1000</span><span class="w">     </span><span class="o">--</span><span class="n">runs</span><span class="w"> </span><span class="mi">5000</span><span class="w">     </span><span class="o">'~/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">main</span><span class="w"> </span><span class="o">--</span><span class="n">allow</span><span class="o">-</span><span class="n">precompiled</span><span class="w"> </span><span class="o">~/</span><span class="n">bench</span><span class="o">-</span><span class="n">main</span><span class="p">.</span><span class="n">cwasm</span><span class="o">'</span><span class="w">     </span><span class="o">'~/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">fflags</span><span class="w"> </span><span class="o">--</span><span class="n">allow</span><span class="o">-</span><span class="n">precompiled</span><span class="w"> </span><span class="o">~/</span><span class="n">bench</span><span class="o">-</span><span class="n">fflags</span><span class="p">.</span><span class="n">cwasm</span><span class="o">'</span>
<span class="n">Benchmark</span><span class="w"> </span><span class="mi">1</span>: <span class="o">~/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">main</span><span class="w"> </span><span class="o">--</span><span class="n">allow</span><span class="o">-</span><span class="n">precompiled</span><span class="w"> </span><span class="o">~/</span><span class="n">bench</span><span class="o">-</span><span class="n">main</span><span class="p">.</span><span class="n">cwasm</span>
<span class="w">  </span><span class="n">Time</span><span class="w"> </span><span class="p">(</span><span class="n">mean</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="err">σ</span><span class="p">)</span>:      <span class="mf">24.5</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="err">±</span><span class="w">   </span><span class="mf">4.0</span><span class="w"> </span><span class="n">ms</span><span class="w">    </span><span class="p">[</span><span class="n">User</span>: <span class="mf">13.3</span><span class="w"> </span><span class="n">ms</span><span class="p">,</span><span class="w"> </span><span class="n">System</span>: <span class="mf">9.9</span><span class="w"> </span><span class="n">ms</span><span class="p">]</span>
<span class="w">  </span><span class="n">Range</span><span class="w"> </span><span class="p">(</span><span class="n">min</span><span class="w"> </span><span class="err">…</span><span class="w"> </span><span class="n">max</span><span class="p">)</span>:    <span class="mf">21.3</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="err">…</span><span class="w">  </span><span class="mf">37.0</span><span class="w"> </span><span class="n">ms</span><span class="w">    </span><span class="mi">5000</span><span class="w"> </span><span class="n">runs</span>

<span class="w">  </span><span class="n">Warning</span>: <span class="nc">Statistical</span><span class="w"> </span><span class="n">outliers</span><span class="w"> </span><span class="n">were</span><span class="w"> </span><span class="n">detected</span><span class="p">.</span><span class="w"> </span><span class="n">Consider</span><span class="w"> </span><span class="n">re</span><span class="o">-</span><span class="n">running</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">benchmark</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">quiet</span><span class="w"> </span><span class="n">system</span><span class="w"> </span><span class="n">without</span><span class="w"> </span><span class="n">any</span><span class="w"> </span><span class="n">interferences</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="n">programs</span><span class="p">.</span><span class="w"> </span><span class="n">It</span><span class="w"> </span><span class="n">might</span><span class="w"> </span><span class="n">help</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="o">'--</span><span class="n">warmup</span><span class="o">'</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="o">'--</span><span class="n">prepare</span><span class="o">'</span><span class="w"> </span><span class="n">options</span><span class="p">.</span>

<span class="n">Benchmark</span><span class="w"> </span><span class="mi">2</span>: <span class="o">~/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">fflags</span><span class="w"> </span><span class="o">--</span><span class="n">allow</span><span class="o">-</span><span class="n">precompiled</span><span class="w"> </span><span class="o">~/</span><span class="n">bench</span><span class="o">-</span><span class="n">fflags</span><span class="p">.</span><span class="n">cwasm</span>
<span class="w">  </span><span class="n">Time</span><span class="w"> </span><span class="p">(</span><span class="n">mean</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="err">σ</span><span class="p">)</span>:      <span class="mf">23.8</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="err">±</span><span class="w">   </span><span class="mf">3.6</span><span class="w"> </span><span class="n">ms</span><span class="w">    </span><span class="p">[</span><span class="n">User</span>: <span class="mf">13.3</span><span class="w"> </span><span class="n">ms</span><span class="p">,</span><span class="w"> </span><span class="n">System</span>: <span class="mf">9.2</span><span class="w"> </span><span class="n">ms</span><span class="p">]</span>
<span class="w">  </span><span class="n">Range</span><span class="w"> </span><span class="p">(</span><span class="n">min</span><span class="w"> </span><span class="err">…</span><span class="w"> </span><span class="n">max</span><span class="p">)</span>:    <span class="mf">20.7</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="err">…</span><span class="w">  </span><span class="mf">40.1</span><span class="w"> </span><span class="n">ms</span><span class="w">    </span><span class="mi">5000</span><span class="w"> </span><span class="n">runs</span>

<span class="w">  </span><span class="n">Warning</span>: <span class="nc">Statistical</span><span class="w"> </span><span class="n">outliers</span><span class="w"> </span><span class="n">were</span><span class="w"> </span><span class="n">detected</span><span class="p">.</span><span class="w"> </span><span class="n">Consider</span><span class="w"> </span><span class="n">re</span><span class="o">-</span><span class="n">running</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">benchmark</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">quiet</span><span class="w"> </span><span class="n">system</span><span class="w"> </span><span class="n">without</span><span class="w"> </span><span class="n">any</span><span class="w"> </span><span class="n">interferences</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="n">programs</span><span class="p">.</span><span class="w"> </span><span class="n">It</span><span class="w"> </span><span class="n">might</span><span class="w"> </span><span class="n">help</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="o">'--</span><span class="n">warmup</span><span class="o">'</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="o">'--</span><span class="n">prepare</span><span class="o">'</span><span class="w"> </span><span class="n">options</span><span class="p">.</span>

<span class="n">Summary</span>
<span class="w">  </span><span class="o">~/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">fflags</span><span class="w"> </span><span class="o">--</span><span class="n">allow</span><span class="o">-</span><span class="n">precompiled</span><span class="w"> </span><span class="o">~/</span><span class="n">bench</span><span class="o">-</span><span class="n">fflags</span><span class="p">.</span><span class="n">cwasm</span><span class="w"> </span><span class="n">ran</span>
<span class="w">    </span><span class="mf">1.03</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="mf">0.23</span><span class="w"> </span><span class="n">times</span><span class="w"> </span><span class="n">faster</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="o">~/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">main</span><span class="w"> </span><span class="o">--</span><span class="n">allow</span><span class="o">-</span><span class="n">precompiled</span><span class="w"> </span><span class="o">~/</span><span class="n">bench</span><span class="o">-</span><span class="n">main</span><span class="p">.</span><span class="n">cwasm</span>
</code></pre></div>
<hr>
<p>Edit: I should note, here <code>fflags</code> is this PR and <code>main</code> is 9d8ca828d1888013b45570a94267778962846ad6 which does include the previous FRM changes.</p>
</blockquote>



<a name="398324752"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237340%20riscv64%3A%20Refactor%20float-to-int%20tra.../near/398324752" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237340.20riscv64.3A.20Refactor.20float-to-int.20tra.2E.2E.2E.html#398324752">(Oct 24 2023 at 16:34)</a>:</h4>
<p>afonso360 edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/7340#issuecomment-1777600834">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/7340">issue #7340</a>:</p>
<blockquote>
<p>I have some interesting results, and some confusing results.</p>
<p>I first ran sightglass with a smaller iteration count and got the results that <code>main</code> was faster than <code>fflags</code> by 3% in spidermonkey, which was surprising to me so I ran it again with the default iteration count and got the same result.</p>
<p>&lt;details&gt;<br>
 &lt;summary&gt;Sightglass Run 1&lt;/summary&gt;</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">afonso</span><span class="o">@</span><span class="n">starfive</span>:<span class="o">~/</span><span class="n">git</span><span class="o">/</span><span class="n">sightglass</span><span class="cp">$</span><span class="w"> </span><span class="n">cargo</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="n">benchmark</span><span class="w"> </span><span class="o">--</span><span class="n">processes</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="o">--</span><span class="n">iterations</span><span class="o">-</span><span class="n">per</span><span class="o">-</span><span class="n">process</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="o">--</span><span class="n">engine</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">engine</span><span class="o">-</span><span class="n">ffla</span>
<span class="n">gs</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="o">--</span><span class="n">engine</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">engine</span><span class="o">-</span><span class="n">main</span><span class="p">.</span><span class="n">so</span><span class="w">  </span><span class="o">--</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">benchmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">scalar</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span><span class="w">  </span><span class="n">benchmarks</span><span class="o">/</span><span class="n">bz2</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="n">benchmarks</span><span class="o">/</span>
<span class="n">regex</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="n">benchmarks</span><span class="o">/</span><span class="n">spidermonkey</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="n">execution</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">spidermonkey</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="err">Δ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">611139.96</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="mf">69194.06</span><span class="w"> </span><span class="p">(</span><span class="n">confidence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">99</span><span class="o">%</span><span class="p">)</span>

<span class="w">  </span><span class="n">main</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="mf">1.03</span><span class="n">x</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="mf">1.03</span><span class="n">x</span><span class="w"> </span><span class="n">faster</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span><span class="o">!</span>

<span class="w">  </span><span class="p">[</span><span class="mi">22003870</span><span class="w"> </span><span class="mf">22177803.84</span><span class="w"> </span><span class="mi">22296431</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">21400346</span><span class="w"> </span><span class="mf">21566663.88</span><span class="w"> </span><span class="mi">21700502</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">execution</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="p">.</span><span class="o">/</span><span class="n">benchmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">scalar</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">6516</span><span class="w"> </span><span class="mf">7450.52</span><span class="w"> </span><span class="mi">14467</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">6500</span><span class="w"> </span><span class="mf">6845.04</span><span class="w"> </span><span class="mi">13012</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">instantiation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="p">.</span><span class="o">/</span><span class="n">benchmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">scalar</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">950</span><span class="w"> </span><span class="mf">1073.44</span><span class="w"> </span><span class="mi">1500</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">939</span><span class="w"> </span><span class="mf">1039.24</span><span class="w"> </span><span class="mi">1814</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">instantiation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">bz2</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">991</span><span class="w"> </span><span class="mf">1109.80</span><span class="w"> </span><span class="mi">1603</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">1018</span><span class="w"> </span><span class="mf">1129.44</span><span class="w"> </span><span class="mi">1811</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">instantiation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">spidermonkey</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">3600</span><span class="w"> </span><span class="mf">4488.00</span><span class="w"> </span><span class="mi">8483</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">3660</span><span class="w"> </span><span class="mf">4418.44</span><span class="w"> </span><span class="mi">9216</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">execution</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">bz2</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">1025843</span><span class="w"> </span><span class="mf">1035182.96</span><span class="w"> </span><span class="mi">1079490</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">1026383</span><span class="w"> </span><span class="mf">1044678.80</span><span class="w"> </span><span class="mi">1099227</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">instantiation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">regex</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">2930</span><span class="w"> </span><span class="mf">3202.92</span><span class="w"> </span><span class="mi">3354</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">2983</span><span class="w"> </span><span class="mf">3231.48</span><span class="w"> </span><span class="mi">3832</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">compilation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">regex</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">10667840</span><span class="w"> </span><span class="mf">10819084.56</span><span class="w"> </span><span class="mi">10947259</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">10725380</span><span class="w"> </span><span class="mf">10845151.60</span><span class="w"> </span><span class="mi">10951025</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">compilation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">spidermonkey</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">111451448</span><span class="w"> </span><span class="mf">113120311.48</span><span class="w"> </span><span class="mi">115050440</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">111395436</span><span class="w"> </span><span class="mf">112890160.52</span><span class="w"> </span><span class="mi">115262339</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">compilation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">bz2</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">2033630</span><span class="w"> </span><span class="mf">2237015.88</span><span class="w"> </span><span class="mi">2365106</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">2032061</span><span class="w"> </span><span class="mf">2233455.48</span><span class="w"> </span><span class="mi">2332395</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">execution</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">regex</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">3845964</span><span class="w"> </span><span class="mf">3852698.64</span><span class="w"> </span><span class="mi">3870163</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">3845116</span><span class="w"> </span><span class="mf">3849177.08</span><span class="w"> </span><span class="mi">3880686</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">compilation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="p">.</span><span class="o">/</span><span class="n">benchmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">scalar</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">2641545</span><span class="w"> </span><span class="mf">2668781.48</span><span class="w"> </span><span class="mi">2727010</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">2621339</span><span class="w"> </span><span class="mf">2667785.92</span><span class="w"> </span><span class="mi">2797660</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>
</code></pre></div>
<p>&lt;/details&gt;</p>
<p>&lt;details&gt;<br>
 &lt;summary&gt;Sightglass Run 2&lt;/summary&gt;</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">afonso</span><span class="o">@</span><span class="n">starfive</span>:<span class="o">~/</span><span class="n">git</span><span class="o">/</span><span class="n">sightglass</span><span class="cp">$</span><span class="w"> </span><span class="n">cargo</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="n">benchmark</span><span class="w"> </span><span class="o">--</span><span class="n">engine</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">engine</span><span class="o">-</span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="o">--</span><span class="n">engine</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">engine</span><span class="o">-</span><span class="n">main</span><span class="p">.</span><span class="n">so</span><span class="w">  </span><span class="o">--</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">ben</span>
<span class="n">chmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">scalar</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span><span class="w">  </span><span class="n">benchmarks</span><span class="o">/</span><span class="n">bz2</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="n">benchmarks</span><span class="o">/</span><span class="n">regex</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="n">benchmarks</span><span class="o">/</span><span class="n">spidermon</span>
<span class="n">key</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>
<span class="n">execution</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">spidermonkey</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="err">Δ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">528886.85</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="mf">30356.42</span><span class="w"> </span><span class="p">(</span><span class="n">confidence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">99</span><span class="o">%</span><span class="p">)</span>

<span class="w">  </span><span class="n">main</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="mf">1.02</span><span class="n">x</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="mf">1.03</span><span class="n">x</span><span class="w"> </span><span class="n">faster</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span><span class="o">!</span>

<span class="w">  </span><span class="p">[</span><span class="mi">21985977</span><span class="w"> </span><span class="mf">22155294.58</span><span class="w"> </span><span class="mi">22282664</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">21399233</span><span class="w"> </span><span class="mf">21626407.73</span><span class="w"> </span><span class="mi">21778731</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">execution</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">regex</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="err">Δ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">4771.68</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="mf">2965.39</span><span class="w"> </span><span class="p">(</span><span class="n">confidence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">99</span><span class="o">%</span><span class="p">)</span>

<span class="w">  </span><span class="n">main</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="mf">1.00</span><span class="n">x</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="mf">1.00</span><span class="n">x</span><span class="w"> </span><span class="n">faster</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span><span class="o">!</span>

<span class="w">  </span><span class="p">[</span><span class="mi">3847607</span><span class="w"> </span><span class="mf">3856010.05</span><span class="w"> </span><span class="mi">3909326</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">3845022</span><span class="w"> </span><span class="mf">3851238.37</span><span class="w"> </span><span class="mi">3912075</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">execution</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="p">.</span><span class="o">/</span><span class="n">benchmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">scalar</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">6515</span><span class="w"> </span><span class="mf">6877.80</span><span class="w"> </span><span class="mi">14550</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">6489</span><span class="w"> </span><span class="mf">7310.42</span><span class="w"> </span><span class="mi">13787</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">instantiation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="p">.</span><span class="o">/</span><span class="n">benchmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">scalar</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">927</span><span class="w"> </span><span class="mf">1029.46</span><span class="w"> </span><span class="mi">1697</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">923</span><span class="w"> </span><span class="mf">1067.02</span><span class="w"> </span><span class="mi">2110</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">instantiation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">spidermonkey</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">3555</span><span class="w"> </span><span class="mf">4316.19</span><span class="w"> </span><span class="mi">8421</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">3588</span><span class="w"> </span><span class="mf">4375.00</span><span class="w"> </span><span class="mi">8089</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">instantiation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">regex</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">2981</span><span class="w"> </span><span class="mf">3225.85</span><span class="w"> </span><span class="mi">3511</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">2986</span><span class="w"> </span><span class="mf">3242.21</span><span class="w"> </span><span class="mi">3598</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">instantiation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">bz2</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">990</span><span class="w"> </span><span class="mf">1147.83</span><span class="w"> </span><span class="mi">1970</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">1000</span><span class="w"> </span><span class="mf">1153.04</span><span class="w"> </span><span class="mi">2124</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">compilation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="p">.</span><span class="o">/</span><span class="n">benchmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">scalar</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">2607381</span><span class="w"> </span><span class="mf">2665940.83</span><span class="w"> </span><span class="mi">2808423</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">2599335</span><span class="w"> </span><span class="mf">2655289.42</span><span class="w"> </span><span class="mi">2750262</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">compilation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">spidermonkey</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">111352544</span><span class="w"> </span><span class="mf">113374288.89</span><span class="w"> </span><span class="mi">115552774</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">111363591</span><span class="w"> </span><span class="mf">113073838.73</span><span class="w"> </span><span class="mi">115549133</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">execution</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">bz2</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">1024902</span><span class="w"> </span><span class="mf">1040201.83</span><span class="w"> </span><span class="mi">1092704</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">1025677</span><span class="w"> </span><span class="mf">1041126.17</span><span class="w"> </span><span class="mi">1101387</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">compilation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">bz2</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">2020133</span><span class="w"> </span><span class="mf">2223545.22</span><span class="w"> </span><span class="mi">2354573</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">2067731</span><span class="w"> </span><span class="mf">2224627.35</span><span class="w"> </span><span class="mi">2372602</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">compilation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">regex</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">10651375</span><span class="w"> </span><span class="mf">10816177.71</span><span class="w"> </span><span class="mi">10994312</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">10625726</span><span class="w"> </span><span class="mf">10814925.59</span><span class="w"> </span><span class="mi">11001537</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>
</code></pre></div>
<p>&lt;/details&gt;</p>
<hr>
<p>I also tried to run the above benchmark via sightglass but couldn't get it to execute, so I ran it using a precompiled module and the wasmtime cli, but the results have quite a large uncertainty. Do you have any suggestions on how I can do this better?</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">afonso</span><span class="o">@</span><span class="n">starfive</span>:<span class="o">~</span><span class="cp">$</span><span class="w"> </span><span class="n">hyperfine</span><span class="w">     </span><span class="o">--</span><span class="n">warmup</span><span class="w"> </span><span class="mi">1000</span><span class="w">     </span><span class="o">--</span><span class="n">runs</span><span class="w"> </span><span class="mi">5000</span><span class="w">     </span><span class="o">'~/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">main</span><span class="w"> </span><span class="o">--</span><span class="n">allow</span><span class="o">-</span><span class="n">precompiled</span><span class="w"> </span><span class="o">~/</span><span class="n">bench</span><span class="o">-</span><span class="n">main</span><span class="p">.</span><span class="n">cwasm</span><span class="o">'</span><span class="w">     </span><span class="o">'~/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">fflags</span><span class="w"> </span><span class="o">--</span><span class="n">allow</span><span class="o">-</span><span class="n">precompiled</span><span class="w"> </span><span class="o">~/</span><span class="n">bench</span><span class="o">-</span><span class="n">fflags</span><span class="p">.</span><span class="n">cwasm</span><span class="o">'</span>
<span class="n">Benchmark</span><span class="w"> </span><span class="mi">1</span>: <span class="o">~/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">main</span><span class="w"> </span><span class="o">--</span><span class="n">allow</span><span class="o">-</span><span class="n">precompiled</span><span class="w"> </span><span class="o">~/</span><span class="n">bench</span><span class="o">-</span><span class="n">main</span><span class="p">.</span><span class="n">cwasm</span>
<span class="w">  </span><span class="n">Time</span><span class="w"> </span><span class="p">(</span><span class="n">mean</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="err">σ</span><span class="p">)</span>:      <span class="mf">24.5</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="err">±</span><span class="w">   </span><span class="mf">4.0</span><span class="w"> </span><span class="n">ms</span><span class="w">    </span><span class="p">[</span><span class="n">User</span>: <span class="mf">13.3</span><span class="w"> </span><span class="n">ms</span><span class="p">,</span><span class="w"> </span><span class="n">System</span>: <span class="mf">9.9</span><span class="w"> </span><span class="n">ms</span><span class="p">]</span>
<span class="w">  </span><span class="n">Range</span><span class="w"> </span><span class="p">(</span><span class="n">min</span><span class="w"> </span><span class="err">…</span><span class="w"> </span><span class="n">max</span><span class="p">)</span>:    <span class="mf">21.3</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="err">…</span><span class="w">  </span><span class="mf">37.0</span><span class="w"> </span><span class="n">ms</span><span class="w">    </span><span class="mi">5000</span><span class="w"> </span><span class="n">runs</span>

<span class="w">  </span><span class="n">Warning</span>: <span class="nc">Statistical</span><span class="w"> </span><span class="n">outliers</span><span class="w"> </span><span class="n">were</span><span class="w"> </span><span class="n">detected</span><span class="p">.</span><span class="w"> </span><span class="n">Consider</span><span class="w"> </span><span class="n">re</span><span class="o">-</span><span class="n">running</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">benchmark</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">quiet</span><span class="w"> </span><span class="n">system</span><span class="w"> </span><span class="n">without</span><span class="w"> </span><span class="n">any</span><span class="w"> </span><span class="n">interferences</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="n">programs</span><span class="p">.</span><span class="w"> </span><span class="n">It</span><span class="w"> </span><span class="n">might</span><span class="w"> </span><span class="n">help</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="o">'--</span><span class="n">warmup</span><span class="o">'</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="o">'--</span><span class="n">prepare</span><span class="o">'</span><span class="w"> </span><span class="n">options</span><span class="p">.</span>

<span class="n">Benchmark</span><span class="w"> </span><span class="mi">2</span>: <span class="o">~/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">fflags</span><span class="w"> </span><span class="o">--</span><span class="n">allow</span><span class="o">-</span><span class="n">precompiled</span><span class="w"> </span><span class="o">~/</span><span class="n">bench</span><span class="o">-</span><span class="n">fflags</span><span class="p">.</span><span class="n">cwasm</span>
<span class="w">  </span><span class="n">Time</span><span class="w"> </span><span class="p">(</span><span class="n">mean</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="err">σ</span><span class="p">)</span>:      <span class="mf">23.8</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="err">±</span><span class="w">   </span><span class="mf">3.6</span><span class="w"> </span><span class="n">ms</span><span class="w">    </span><span class="p">[</span><span class="n">User</span>: <span class="mf">13.3</span><span class="w"> </span><span class="n">ms</span><span class="p">,</span><span class="w"> </span><span class="n">System</span>: <span class="mf">9.2</span><span class="w"> </span><span class="n">ms</span><span class="p">]</span>
<span class="w">  </span><span class="n">Range</span><span class="w"> </span><span class="p">(</span><span class="n">min</span><span class="w"> </span><span class="err">…</span><span class="w"> </span><span class="n">max</span><span class="p">)</span>:    <span class="mf">20.7</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="err">…</span><span class="w">  </span><span class="mf">40.1</span><span class="w"> </span><span class="n">ms</span><span class="w">    </span><span class="mi">5000</span><span class="w"> </span><span class="n">runs</span>

<span class="w">  </span><span class="n">Warning</span>: <span class="nc">Statistical</span><span class="w"> </span><span class="n">outliers</span><span class="w"> </span><span class="n">were</span><span class="w"> </span><span class="n">detected</span><span class="p">.</span><span class="w"> </span><span class="n">Consider</span><span class="w"> </span><span class="n">re</span><span class="o">-</span><span class="n">running</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">benchmark</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">quiet</span><span class="w"> </span><span class="n">system</span><span class="w"> </span><span class="n">without</span><span class="w"> </span><span class="n">any</span><span class="w"> </span><span class="n">interferences</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="n">programs</span><span class="p">.</span><span class="w"> </span><span class="n">It</span><span class="w"> </span><span class="n">might</span><span class="w"> </span><span class="n">help</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="o">'--</span><span class="n">warmup</span><span class="o">'</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="o">'--</span><span class="n">prepare</span><span class="o">'</span><span class="w"> </span><span class="n">options</span><span class="p">.</span>

<span class="n">Summary</span>
<span class="w">  </span><span class="o">~/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">fflags</span><span class="w"> </span><span class="o">--</span><span class="n">allow</span><span class="o">-</span><span class="n">precompiled</span><span class="w"> </span><span class="o">~/</span><span class="n">bench</span><span class="o">-</span><span class="n">fflags</span><span class="p">.</span><span class="n">cwasm</span><span class="w"> </span><span class="n">ran</span>
<span class="w">    </span><span class="mf">1.03</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="mf">0.23</span><span class="w"> </span><span class="n">times</span><span class="w"> </span><span class="n">faster</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="o">~/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">main</span><span class="w"> </span><span class="o">--</span><span class="n">allow</span><span class="o">-</span><span class="n">precompiled</span><span class="w"> </span><span class="o">~/</span><span class="n">bench</span><span class="o">-</span><span class="n">main</span><span class="p">.</span><span class="n">cwasm</span>
</code></pre></div>
<hr>
<p>Edit: I should note, here <code>fflags</code> is this PR and <code>main</code> is 9d8ca828d1888013b45570a94267778962846ad6 which includes the previous FRM changes.</p>
</blockquote>



<a name="398325456"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237340%20riscv64%3A%20Refactor%20float-to-int%20tra.../near/398325456" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237340.20riscv64.3A.20Refactor.20float-to-int.20tra.2E.2E.2E.html#398325456">(Oct 24 2023 at 16:39)</a>:</h4>
<p>afonso360 edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/7340#issuecomment-1777600834">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/7340">issue #7340</a>:</p>
<blockquote>
<p>I have some interesting results, and some confusing results.</p>
<p>I first ran sightglass with a smaller iteration count and got the results that <code>main</code> was faster than <code>fflags</code> by 3% in spidermonkey, which was surprising to me so I ran it again with the default iteration count and got the same result.</p>
<p>&lt;details&gt;<br>
 &lt;summary&gt;Sightglass Run 1&lt;/summary&gt;</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">afonso</span><span class="o">@</span><span class="n">starfive</span>:<span class="o">~/</span><span class="n">git</span><span class="o">/</span><span class="n">sightglass</span><span class="cp">$</span><span class="w"> </span><span class="n">cargo</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="n">benchmark</span><span class="w"> </span><span class="o">--</span><span class="n">processes</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="o">--</span><span class="n">iterations</span><span class="o">-</span><span class="n">per</span><span class="o">-</span><span class="n">process</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="o">--</span><span class="n">engine</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">engine</span><span class="o">-</span><span class="n">ffla</span>
<span class="n">gs</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="o">--</span><span class="n">engine</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">engine</span><span class="o">-</span><span class="n">main</span><span class="p">.</span><span class="n">so</span><span class="w">  </span><span class="o">--</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">benchmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">scalar</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span><span class="w">  </span><span class="n">benchmarks</span><span class="o">/</span><span class="n">bz2</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="n">benchmarks</span><span class="o">/</span>
<span class="n">regex</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="n">benchmarks</span><span class="o">/</span><span class="n">spidermonkey</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="n">execution</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">spidermonkey</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="err">Δ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">611139.96</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="mf">69194.06</span><span class="w"> </span><span class="p">(</span><span class="n">confidence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">99</span><span class="o">%</span><span class="p">)</span>

<span class="w">  </span><span class="n">main</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="mf">1.03</span><span class="n">x</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="mf">1.03</span><span class="n">x</span><span class="w"> </span><span class="n">faster</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span><span class="o">!</span>

<span class="w">  </span><span class="p">[</span><span class="mi">22003870</span><span class="w"> </span><span class="mf">22177803.84</span><span class="w"> </span><span class="mi">22296431</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">21400346</span><span class="w"> </span><span class="mf">21566663.88</span><span class="w"> </span><span class="mi">21700502</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">execution</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="p">.</span><span class="o">/</span><span class="n">benchmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">scalar</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">6516</span><span class="w"> </span><span class="mf">7450.52</span><span class="w"> </span><span class="mi">14467</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">6500</span><span class="w"> </span><span class="mf">6845.04</span><span class="w"> </span><span class="mi">13012</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">instantiation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="p">.</span><span class="o">/</span><span class="n">benchmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">scalar</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">950</span><span class="w"> </span><span class="mf">1073.44</span><span class="w"> </span><span class="mi">1500</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">939</span><span class="w"> </span><span class="mf">1039.24</span><span class="w"> </span><span class="mi">1814</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">instantiation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">bz2</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">991</span><span class="w"> </span><span class="mf">1109.80</span><span class="w"> </span><span class="mi">1603</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">1018</span><span class="w"> </span><span class="mf">1129.44</span><span class="w"> </span><span class="mi">1811</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">instantiation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">spidermonkey</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">3600</span><span class="w"> </span><span class="mf">4488.00</span><span class="w"> </span><span class="mi">8483</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">3660</span><span class="w"> </span><span class="mf">4418.44</span><span class="w"> </span><span class="mi">9216</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">execution</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">bz2</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">1025843</span><span class="w"> </span><span class="mf">1035182.96</span><span class="w"> </span><span class="mi">1079490</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">1026383</span><span class="w"> </span><span class="mf">1044678.80</span><span class="w"> </span><span class="mi">1099227</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">instantiation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">regex</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">2930</span><span class="w"> </span><span class="mf">3202.92</span><span class="w"> </span><span class="mi">3354</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">2983</span><span class="w"> </span><span class="mf">3231.48</span><span class="w"> </span><span class="mi">3832</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">compilation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">regex</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">10667840</span><span class="w"> </span><span class="mf">10819084.56</span><span class="w"> </span><span class="mi">10947259</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">10725380</span><span class="w"> </span><span class="mf">10845151.60</span><span class="w"> </span><span class="mi">10951025</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">compilation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">spidermonkey</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">111451448</span><span class="w"> </span><span class="mf">113120311.48</span><span class="w"> </span><span class="mi">115050440</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">111395436</span><span class="w"> </span><span class="mf">112890160.52</span><span class="w"> </span><span class="mi">115262339</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">compilation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">bz2</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">2033630</span><span class="w"> </span><span class="mf">2237015.88</span><span class="w"> </span><span class="mi">2365106</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">2032061</span><span class="w"> </span><span class="mf">2233455.48</span><span class="w"> </span><span class="mi">2332395</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">execution</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">regex</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">3845964</span><span class="w"> </span><span class="mf">3852698.64</span><span class="w"> </span><span class="mi">3870163</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">3845116</span><span class="w"> </span><span class="mf">3849177.08</span><span class="w"> </span><span class="mi">3880686</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">compilation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="p">.</span><span class="o">/</span><span class="n">benchmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">scalar</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">2641545</span><span class="w"> </span><span class="mf">2668781.48</span><span class="w"> </span><span class="mi">2727010</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">2621339</span><span class="w"> </span><span class="mf">2667785.92</span><span class="w"> </span><span class="mi">2797660</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>
</code></pre></div>
<p>&lt;/details&gt;</p>
<p>&lt;details&gt;<br>
 &lt;summary&gt;Sightglass Run 2&lt;/summary&gt;</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">afonso</span><span class="o">@</span><span class="n">starfive</span>:<span class="o">~/</span><span class="n">git</span><span class="o">/</span><span class="n">sightglass</span><span class="cp">$</span><span class="w"> </span><span class="n">cargo</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="n">benchmark</span><span class="w"> </span><span class="o">--</span><span class="n">engine</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">engine</span><span class="o">-</span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="o">--</span><span class="n">engine</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">engine</span><span class="o">-</span><span class="n">main</span><span class="p">.</span><span class="n">so</span><span class="w">  </span><span class="o">--</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">ben</span>
<span class="n">chmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">scalar</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span><span class="w">  </span><span class="n">benchmarks</span><span class="o">/</span><span class="n">bz2</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="n">benchmarks</span><span class="o">/</span><span class="n">regex</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="n">benchmarks</span><span class="o">/</span><span class="n">spidermon</span>
<span class="n">key</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>
<span class="n">execution</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">spidermonkey</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="err">Δ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">528886.85</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="mf">30356.42</span><span class="w"> </span><span class="p">(</span><span class="n">confidence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">99</span><span class="o">%</span><span class="p">)</span>

<span class="w">  </span><span class="n">main</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="mf">1.02</span><span class="n">x</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="mf">1.03</span><span class="n">x</span><span class="w"> </span><span class="n">faster</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span><span class="o">!</span>

<span class="w">  </span><span class="p">[</span><span class="mi">21985977</span><span class="w"> </span><span class="mf">22155294.58</span><span class="w"> </span><span class="mi">22282664</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">21399233</span><span class="w"> </span><span class="mf">21626407.73</span><span class="w"> </span><span class="mi">21778731</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">execution</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">regex</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="err">Δ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">4771.68</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="mf">2965.39</span><span class="w"> </span><span class="p">(</span><span class="n">confidence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">99</span><span class="o">%</span><span class="p">)</span>

<span class="w">  </span><span class="n">main</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="mf">1.00</span><span class="n">x</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="mf">1.00</span><span class="n">x</span><span class="w"> </span><span class="n">faster</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span><span class="o">!</span>

<span class="w">  </span><span class="p">[</span><span class="mi">3847607</span><span class="w"> </span><span class="mf">3856010.05</span><span class="w"> </span><span class="mi">3909326</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">3845022</span><span class="w"> </span><span class="mf">3851238.37</span><span class="w"> </span><span class="mi">3912075</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">execution</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="p">.</span><span class="o">/</span><span class="n">benchmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">scalar</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">6515</span><span class="w"> </span><span class="mf">6877.80</span><span class="w"> </span><span class="mi">14550</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">6489</span><span class="w"> </span><span class="mf">7310.42</span><span class="w"> </span><span class="mi">13787</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">instantiation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="p">.</span><span class="o">/</span><span class="n">benchmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">scalar</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">927</span><span class="w"> </span><span class="mf">1029.46</span><span class="w"> </span><span class="mi">1697</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">923</span><span class="w"> </span><span class="mf">1067.02</span><span class="w"> </span><span class="mi">2110</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">instantiation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">spidermonkey</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">3555</span><span class="w"> </span><span class="mf">4316.19</span><span class="w"> </span><span class="mi">8421</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">3588</span><span class="w"> </span><span class="mf">4375.00</span><span class="w"> </span><span class="mi">8089</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">instantiation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">regex</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">2981</span><span class="w"> </span><span class="mf">3225.85</span><span class="w"> </span><span class="mi">3511</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">2986</span><span class="w"> </span><span class="mf">3242.21</span><span class="w"> </span><span class="mi">3598</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">instantiation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">bz2</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">990</span><span class="w"> </span><span class="mf">1147.83</span><span class="w"> </span><span class="mi">1970</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">1000</span><span class="w"> </span><span class="mf">1153.04</span><span class="w"> </span><span class="mi">2124</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">compilation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="p">.</span><span class="o">/</span><span class="n">benchmarks</span><span class="o">/</span><span class="n">blake3</span><span class="o">-</span><span class="n">scalar</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">2607381</span><span class="w"> </span><span class="mf">2665940.83</span><span class="w"> </span><span class="mi">2808423</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">2599335</span><span class="w"> </span><span class="mf">2655289.42</span><span class="w"> </span><span class="mi">2750262</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">compilation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">spidermonkey</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">111352544</span><span class="w"> </span><span class="mf">113374288.89</span><span class="w"> </span><span class="mi">115552774</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">111363591</span><span class="w"> </span><span class="mf">113073838.73</span><span class="w"> </span><span class="mi">115549133</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">execution</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">bz2</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">1024902</span><span class="w"> </span><span class="mf">1040201.83</span><span class="w"> </span><span class="mi">1092704</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">1025677</span><span class="w"> </span><span class="mf">1041126.17</span><span class="w"> </span><span class="mi">1101387</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">compilation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">bz2</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">2020133</span><span class="w"> </span><span class="mf">2223545.22</span><span class="w"> </span><span class="mi">2354573</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">2067731</span><span class="w"> </span><span class="mf">2224627.35</span><span class="w"> </span><span class="mi">2372602</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>

<span class="n">compilation</span><span class="w"> </span>:: <span class="nc">cycles</span><span class="w"> </span>:: <span class="nc">benchmarks</span><span class="o">/</span><span class="n">regex</span><span class="o">/</span><span class="n">benchmark</span><span class="p">.</span><span class="n">wasm</span>

<span class="w">  </span><span class="n">No</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span>

<span class="w">  </span><span class="p">[</span><span class="mi">10651375</span><span class="w"> </span><span class="mf">10816177.71</span><span class="w"> </span><span class="mi">10994312</span><span class="p">]</span><span class="w"> </span><span class="n">fflags</span><span class="p">.</span><span class="n">so</span>
<span class="w">  </span><span class="p">[</span><span class="mi">10625726</span><span class="w"> </span><span class="mf">10814925.59</span><span class="w"> </span><span class="mi">11001537</span><span class="p">]</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">so</span>
</code></pre></div>
<p>&lt;/details&gt;</p>
<hr>
<p>I also tried to run the above benchmark via sightglass but couldn't get it to execute, so I ran it using a precompiled module and the wasmtime cli, but the results have quite a large uncertainty. Do you have any suggestions on how I can do this better?</p>
<p>I think invoking via cli might be adding too much noise, I'm going to try to build a criterion benchmark that uses the wasmtime API and benchmark it that way.</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">afonso</span><span class="o">@</span><span class="n">starfive</span>:<span class="o">~</span><span class="cp">$</span><span class="w"> </span><span class="n">hyperfine</span><span class="w">     </span><span class="o">--</span><span class="n">warmup</span><span class="w"> </span><span class="mi">1000</span><span class="w">     </span><span class="o">--</span><span class="n">runs</span><span class="w"> </span><span class="mi">5000</span><span class="w">     </span><span class="o">'~/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">main</span><span class="w"> </span><span class="o">--</span><span class="n">allow</span><span class="o">-</span><span class="n">precompiled</span><span class="w"> </span><span class="o">~/</span><span class="n">bench</span><span class="o">-</span><span class="n">main</span><span class="p">.</span><span class="n">cwasm</span><span class="o">'</span><span class="w">     </span><span class="o">'~/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">fflags</span><span class="w"> </span><span class="o">--</span><span class="n">allow</span><span class="o">-</span><span class="n">precompiled</span><span class="w"> </span><span class="o">~/</span><span class="n">bench</span><span class="o">-</span><span class="n">fflags</span><span class="p">.</span><span class="n">cwasm</span><span class="o">'</span>
<span class="n">Benchmark</span><span class="w"> </span><span class="mi">1</span>: <span class="o">~/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">main</span><span class="w"> </span><span class="o">--</span><span class="n">allow</span><span class="o">-</span><span class="n">precompiled</span><span class="w"> </span><span class="o">~/</span><span class="n">bench</span><span class="o">-</span><span class="n">main</span><span class="p">.</span><span class="n">cwasm</span>
<span class="w">  </span><span class="n">Time</span><span class="w"> </span><span class="p">(</span><span class="n">mean</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="err">σ</span><span class="p">)</span>:      <span class="mf">24.5</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="err">±</span><span class="w">   </span><span class="mf">4.0</span><span class="w"> </span><span class="n">ms</span><span class="w">    </span><span class="p">[</span><span class="n">User</span>: <span class="mf">13.3</span><span class="w"> </span><span class="n">ms</span><span class="p">,</span><span class="w"> </span><span class="n">System</span>: <span class="mf">9.9</span><span class="w"> </span><span class="n">ms</span><span class="p">]</span>
<span class="w">  </span><span class="n">Range</span><span class="w"> </span><span class="p">(</span><span class="n">min</span><span class="w"> </span><span class="err">…</span><span class="w"> </span><span class="n">max</span><span class="p">)</span>:    <span class="mf">21.3</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="err">…</span><span class="w">  </span><span class="mf">37.0</span><span class="w"> </span><span class="n">ms</span><span class="w">    </span><span class="mi">5000</span><span class="w"> </span><span class="n">runs</span>

<span class="w">  </span><span class="n">Warning</span>: <span class="nc">Statistical</span><span class="w"> </span><span class="n">outliers</span><span class="w"> </span><span class="n">were</span><span class="w"> </span><span class="n">detected</span><span class="p">.</span><span class="w"> </span><span class="n">Consider</span><span class="w"> </span><span class="n">re</span><span class="o">-</span><span class="n">running</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">benchmark</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">quiet</span><span class="w"> </span><span class="n">system</span><span class="w"> </span><span class="n">without</span><span class="w"> </span><span class="n">any</span><span class="w"> </span><span class="n">interferences</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="n">programs</span><span class="p">.</span><span class="w"> </span><span class="n">It</span><span class="w"> </span><span class="n">might</span><span class="w"> </span><span class="n">help</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="o">'--</span><span class="n">warmup</span><span class="o">'</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="o">'--</span><span class="n">prepare</span><span class="o">'</span><span class="w"> </span><span class="n">options</span><span class="p">.</span>

<span class="n">Benchmark</span><span class="w"> </span><span class="mi">2</span>: <span class="o">~/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">fflags</span><span class="w"> </span><span class="o">--</span><span class="n">allow</span><span class="o">-</span><span class="n">precompiled</span><span class="w"> </span><span class="o">~/</span><span class="n">bench</span><span class="o">-</span><span class="n">fflags</span><span class="p">.</span><span class="n">cwasm</span>
<span class="w">  </span><span class="n">Time</span><span class="w"> </span><span class="p">(</span><span class="n">mean</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="err">σ</span><span class="p">)</span>:      <span class="mf">23.8</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="err">±</span><span class="w">   </span><span class="mf">3.6</span><span class="w"> </span><span class="n">ms</span><span class="w">    </span><span class="p">[</span><span class="n">User</span>: <span class="mf">13.3</span><span class="w"> </span><span class="n">ms</span><span class="p">,</span><span class="w"> </span><span class="n">System</span>: <span class="mf">9.2</span><span class="w"> </span><span class="n">ms</span><span class="p">]</span>
<span class="w">  </span><span class="n">Range</span><span class="w"> </span><span class="p">(</span><span class="n">min</span><span class="w"> </span><span class="err">…</span><span class="w"> </span><span class="n">max</span><span class="p">)</span>:    <span class="mf">20.7</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="err">…</span><span class="w">  </span><span class="mf">40.1</span><span class="w"> </span><span class="n">ms</span><span class="w">    </span><span class="mi">5000</span><span class="w"> </span><span class="n">runs</span>

<span class="w">  </span><span class="n">Warning</span>: <span class="nc">Statistical</span><span class="w"> </span><span class="n">outliers</span><span class="w"> </span><span class="n">were</span><span class="w"> </span><span class="n">detected</span><span class="p">.</span><span class="w"> </span><span class="n">Consider</span><span class="w"> </span><span class="n">re</span><span class="o">-</span><span class="n">running</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">benchmark</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">quiet</span><span class="w"> </span><span class="n">system</span><span class="w"> </span><span class="n">without</span><span class="w"> </span><span class="n">any</span><span class="w"> </span><span class="n">interferences</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="n">programs</span><span class="p">.</span><span class="w"> </span><span class="n">It</span><span class="w"> </span><span class="n">might</span><span class="w"> </span><span class="n">help</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="o">'--</span><span class="n">warmup</span><span class="o">'</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="o">'--</span><span class="n">prepare</span><span class="o">'</span><span class="w"> </span><span class="n">options</span><span class="p">.</span>

<span class="n">Summary</span>
<span class="w">  </span><span class="o">~/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">fflags</span><span class="w"> </span><span class="o">--</span><span class="n">allow</span><span class="o">-</span><span class="n">precompiled</span><span class="w"> </span><span class="o">~/</span><span class="n">bench</span><span class="o">-</span><span class="n">fflags</span><span class="p">.</span><span class="n">cwasm</span><span class="w"> </span><span class="n">ran</span>
<span class="w">    </span><span class="mf">1.03</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="mf">0.23</span><span class="w"> </span><span class="n">times</span><span class="w"> </span><span class="n">faster</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="o">~/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">main</span><span class="w"> </span><span class="o">--</span><span class="n">allow</span><span class="o">-</span><span class="n">precompiled</span><span class="w"> </span><span class="o">~/</span><span class="n">bench</span><span class="o">-</span><span class="n">main</span><span class="p">.</span><span class="n">cwasm</span>
</code></pre></div>
<hr>
<p>Edit: I should note, here <code>fflags</code> is this PR and <code>main</code> is 9d8ca828d1888013b45570a94267778962846ad6 which includes the previous FRM changes.</p>
</blockquote>



<a name="398327762"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237340%20riscv64%3A%20Refactor%20float-to-int%20tra.../near/398327762" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237340.20riscv64.3A.20Refactor.20float-to-int.20tra.2E.2E.2E.html#398327762">(Oct 24 2023 at 16:54)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/7340#issuecomment-1777647716">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/7340">issue #7340</a>:</p>
<blockquote>
<p>Oh for the criterion program you'll need to pass <code>--bench</code> as an argument to get it to actually run benchmarks. In theory you should be able to do <code>wasmtime --dir . ./foo.wasm --bench</code> with a before-and-after wasmtime and criterion should self-report regressions/improvements between the two.</p>
<p>The sightglass run seems a bit damning though in that maybe it's not too useful to inspect the exception flags!</p>
</blockquote>



<a name="398330306"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237340%20riscv64%3A%20Refactor%20float-to-int%20tra.../near/398330306" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237340.20riscv64.3A.20Refactor.20float-to-int.20tra.2E.2E.2E.html#398330306">(Oct 24 2023 at 17:11)</a>:</h4>
<p>afonso360 <a href="https://github.com/bytecodealliance/wasmtime/pull/7340#issuecomment-1777674261">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/7340">issue #7340</a>:</p>
<blockquote>
<p>Oh, that makes much more sense! Weirdly none of these had significant performance differences.</p>
<p>&lt;details&gt;<br>
&lt;summary&gt;Criterion output&lt;/summary&gt;</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">afonso</span><span class="o">@</span><span class="n">starfive</span>:<span class="o">~</span><span class="cp">$</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">fflags</span><span class="w"> </span><span class="o">--</span><span class="n">dir</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">bench</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span><span class="n">bench</span>
<span class="kt">f32</span>-&gt;<span class="kt">u32</span>                <span class="nc">time</span>:   <span class="p">[</span><span class="mf">23.730</span><span class="w"> </span><span class="n">ns</span><span class="w"> </span><span class="mf">23.732</span><span class="w"> </span><span class="n">ns</span><span class="w"> </span><span class="mf">23.734</span><span class="w"> </span><span class="n">ns</span><span class="p">]</span>
<span class="w">                        </span><span class="n">change</span>: <span class="p">[</span><span class="o">-</span><span class="mf">0.2177</span><span class="o">%</span><span class="w"> </span><span class="o">-</span><span class="mf">0.1872</span><span class="o">%</span><span class="w"> </span><span class="o">-</span><span class="mf">0.1582</span><span class="o">%</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.00</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.05</span><span class="p">)</span>
<span class="w">                        </span><span class="n">Change</span><span class="w"> </span><span class="n">within</span><span class="w"> </span><span class="n">noise</span><span class="w"> </span><span class="n">threshold</span><span class="p">.</span>
<span class="n">Found</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="n">outliers</span><span class="w"> </span><span class="n">among</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="n">measurements</span><span class="w"> </span><span class="p">(</span><span class="mf">10.00</span><span class="o">%</span><span class="p">)</span>
<span class="w">  </span><span class="mi">1</span><span class="w"> </span><span class="p">(</span><span class="mf">1.00</span><span class="o">%</span><span class="p">)</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="n">mild</span>
<span class="w">  </span><span class="mi">5</span><span class="w"> </span><span class="p">(</span><span class="mf">5.00</span><span class="o">%</span><span class="p">)</span><span class="w"> </span><span class="n">high</span><span class="w"> </span><span class="n">mild</span>
<span class="w">  </span><span class="mi">4</span><span class="w"> </span><span class="p">(</span><span class="mf">4.00</span><span class="o">%</span><span class="p">)</span><span class="w"> </span><span class="n">high</span><span class="w"> </span><span class="n">severe</span>

<span class="kt">f32</span>-&gt;<span class="kt">u64</span>                <span class="nc">time</span>:   <span class="p">[</span><span class="mf">23.731</span><span class="w"> </span><span class="n">ns</span><span class="w"> </span><span class="mf">23.732</span><span class="w"> </span><span class="n">ns</span><span class="w"> </span><span class="mf">23.734</span><span class="w"> </span><span class="n">ns</span><span class="p">]</span>
<span class="w">                        </span><span class="n">change</span>: <span class="p">[</span><span class="o">-</span><span class="mf">0.0650</span><span class="o">%</span><span class="w"> </span><span class="o">-</span><span class="mf">0.0122</span><span class="o">%</span><span class="w"> </span><span class="o">+</span><span class="mf">0.0275</span><span class="o">%</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.68</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.05</span><span class="p">)</span>
<span class="w">                        </span><span class="n">No</span><span class="w"> </span><span class="n">change</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="w"> </span><span class="n">detected</span><span class="p">.</span>
<span class="n">Found</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="n">outliers</span><span class="w"> </span><span class="n">among</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="n">measurements</span><span class="w"> </span><span class="p">(</span><span class="mf">8.00</span><span class="o">%</span><span class="p">)</span>
<span class="w">  </span><span class="mi">2</span><span class="w"> </span><span class="p">(</span><span class="mf">2.00</span><span class="o">%</span><span class="p">)</span><span class="w"> </span><span class="n">high</span><span class="w"> </span><span class="n">mild</span>
<span class="w">  </span><span class="mi">6</span><span class="w"> </span><span class="p">(</span><span class="mf">6.00</span><span class="o">%</span><span class="p">)</span><span class="w"> </span><span class="n">high</span><span class="w"> </span><span class="n">severe</span>

<span class="kt">f64</span>-&gt;<span class="kt">u32</span>                <span class="nc">time</span>:   <span class="p">[</span><span class="mf">25.399</span><span class="w"> </span><span class="n">ns</span><span class="w"> </span><span class="mf">25.401</span><span class="w"> </span><span class="n">ns</span><span class="w"> </span><span class="mf">25.403</span><span class="w"> </span><span class="n">ns</span><span class="p">]</span>
<span class="w">                        </span><span class="n">change</span>: <span class="p">[</span><span class="o">-</span><span class="mf">0.0281</span><span class="o">%</span><span class="w"> </span><span class="o">-</span><span class="mf">0.0043</span><span class="o">%</span><span class="w"> </span><span class="o">+</span><span class="mf">0.0162</span><span class="o">%</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.72</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.05</span><span class="p">)</span>
<span class="w">                        </span><span class="n">No</span><span class="w"> </span><span class="n">change</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="w"> </span><span class="n">detected</span><span class="p">.</span>
<span class="n">Found</span><span class="w"> </span><span class="mi">21</span><span class="w"> </span><span class="n">outliers</span><span class="w"> </span><span class="n">among</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="n">measurements</span><span class="w"> </span><span class="p">(</span><span class="mf">21.00</span><span class="o">%</span><span class="p">)</span>
<span class="w">  </span><span class="mi">4</span><span class="w"> </span><span class="p">(</span><span class="mf">4.00</span><span class="o">%</span><span class="p">)</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="n">mild</span>
<span class="w">  </span><span class="mi">9</span><span class="w"> </span><span class="p">(</span><span class="mf">9.00</span><span class="o">%</span><span class="p">)</span><span class="w"> </span><span class="n">high</span><span class="w"> </span><span class="n">mild</span>
<span class="w">  </span><span class="mi">8</span><span class="w"> </span><span class="p">(</span><span class="mf">8.00</span><span class="o">%</span><span class="p">)</span><span class="w"> </span><span class="n">high</span><span class="w"> </span><span class="n">severe</span>

<span class="kt">f64</span>-&gt;<span class="kt">u64</span>                <span class="nc">time</span>:   <span class="p">[</span><span class="mf">25.068</span><span class="w"> </span><span class="n">ns</span><span class="w"> </span><span class="mf">25.069</span><span class="w"> </span><span class="n">ns</span><span class="w"> </span><span class="mf">25.072</span><span class="w"> </span><span class="n">ns</span><span class="p">]</span>
<span class="w">                        </span><span class="n">change</span>: <span class="p">[</span><span class="o">-</span><span class="mf">0.0540</span><span class="o">%</span><span class="w"> </span><span class="o">-</span><span class="mf">0.0158</span><span class="o">%</span><span class="w"> </span><span class="o">+</span><span class="mf">0.0182</span><span class="o">%</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.41</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.05</span><span class="p">)</span>
<span class="w">                        </span><span class="n">No</span><span class="w"> </span><span class="n">change</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="w"> </span><span class="n">detected</span><span class="p">.</span>
<span class="n">Found</span><span class="w"> </span><span class="mi">13</span><span class="w"> </span><span class="n">outliers</span><span class="w"> </span><span class="n">among</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="n">measurements</span><span class="w"> </span><span class="p">(</span><span class="mf">13.00</span><span class="o">%</span><span class="p">)</span>
<span class="w">  </span><span class="mi">1</span><span class="w"> </span><span class="p">(</span><span class="mf">1.00</span><span class="o">%</span><span class="p">)</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="n">mild</span>
<span class="w">  </span><span class="mi">7</span><span class="w"> </span><span class="p">(</span><span class="mf">7.00</span><span class="o">%</span><span class="p">)</span><span class="w"> </span><span class="n">high</span><span class="w"> </span><span class="n">mild</span>
<span class="w">  </span><span class="mi">5</span><span class="w"> </span><span class="p">(</span><span class="mf">5.00</span><span class="o">%</span><span class="p">)</span><span class="w"> </span><span class="n">high</span><span class="w"> </span><span class="n">severe</span>

<span class="kt">f32</span>-&gt;<span class="kt">i32</span>                <span class="nc">time</span>:   <span class="p">[</span><span class="mf">30.727</span><span class="w"> </span><span class="n">ns</span><span class="w"> </span><span class="mf">30.729</span><span class="w"> </span><span class="n">ns</span><span class="w"> </span><span class="mf">30.732</span><span class="w"> </span><span class="n">ns</span><span class="p">]</span>
<span class="w">                        </span><span class="n">change</span>: <span class="p">[</span><span class="o">-</span><span class="mf">0.0390</span><span class="o">%</span><span class="w"> </span><span class="o">-</span><span class="mf">0.0081</span><span class="o">%</span><span class="w"> </span><span class="o">+</span><span class="mf">0.0170</span><span class="o">%</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.60</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.05</span><span class="p">)</span>
<span class="w">                        </span><span class="n">No</span><span class="w"> </span><span class="n">change</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="w"> </span><span class="n">detected</span><span class="p">.</span>
<span class="n">Found</span><span class="w"> </span><span class="mi">12</span><span class="w"> </span><span class="n">outliers</span><span class="w"> </span><span class="n">among</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="n">measurements</span><span class="w"> </span><span class="p">(</span><span class="mf">12.00</span><span class="o">%</span><span class="p">)</span>
<span class="w">  </span><span class="mi">2</span><span class="w"> </span><span class="p">(</span><span class="mf">2.00</span><span class="o">%</span><span class="p">)</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="n">mild</span>
<span class="w">  </span><span class="mi">4</span><span class="w"> </span><span class="p">(</span><span class="mf">4.00</span><span class="o">%</span><span class="p">)</span><span class="w"> </span><span class="n">high</span><span class="w"> </span><span class="n">mild</span>
<span class="w">  </span><span class="mi">6</span><span class="w"> </span><span class="p">(</span><span class="mf">6.00</span><span class="o">%</span><span class="p">)</span><span class="w"> </span><span class="n">high</span><span class="w"> </span><span class="n">severe</span>

<span class="kt">f32</span>-&gt;<span class="kt">i64</span>                <span class="nc">time</span>:   <span class="p">[</span><span class="mf">32.731</span><span class="w"> </span><span class="n">ns</span><span class="w"> </span><span class="mf">32.734</span><span class="w"> </span><span class="n">ns</span><span class="w"> </span><span class="mf">32.736</span><span class="w"> </span><span class="n">ns</span><span class="p">]</span>
<span class="w">                        </span><span class="n">change</span>: <span class="p">[</span><span class="o">-</span><span class="mf">0.0523</span><span class="o">%</span><span class="w"> </span><span class="o">-</span><span class="mf">0.0069</span><span class="o">%</span><span class="w"> </span><span class="o">+</span><span class="mf">0.0358</span><span class="o">%</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.78</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.05</span><span class="p">)</span>
<span class="w">                        </span><span class="n">No</span><span class="w"> </span><span class="n">change</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="w"> </span><span class="n">detected</span><span class="p">.</span>
<span class="n">Found</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="n">outliers</span><span class="w"> </span><span class="n">among</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="n">measurements</span><span class="w"> </span><span class="p">(</span><span class="mf">10.00</span><span class="o">%</span><span class="p">)</span>
<span class="w">  </span><span class="mi">1</span><span class="w"> </span><span class="p">(</span><span class="mf">1.00</span><span class="o">%</span><span class="p">)</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="n">mild</span>
<span class="w">  </span><span class="mi">3</span><span class="w"> </span><span class="p">(</span><span class="mf">3.00</span><span class="o">%</span><span class="p">)</span><span class="w"> </span><span class="n">high</span><span class="w"> </span><span class="n">mild</span>
<span class="w">  </span><span class="mi">6</span><span class="w"> </span><span class="p">(</span><span class="mf">6.00</span><span class="o">%</span><span class="p">)</span><span class="w"> </span><span class="n">high</span><span class="w"> </span><span class="n">severe</span>

<span class="kt">f64</span>-&gt;<span class="kt">i32</span>                <span class="nc">time</span>:   <span class="p">[</span><span class="mf">34.740</span><span class="w"> </span><span class="n">ns</span><span class="w"> </span><span class="mf">34.742</span><span class="w"> </span><span class="n">ns</span><span class="w"> </span><span class="mf">34.745</span><span class="w"> </span><span class="n">ns</span><span class="p">]</span>
<span class="w">                        </span><span class="n">change</span>: <span class="p">[</span><span class="o">-</span><span class="mf">0.0349</span><span class="o">%</span><span class="w"> </span><span class="o">-</span><span class="mf">0.0039</span><span class="o">%</span><span class="w"> </span><span class="o">+</span><span class="mf">0.0254</span><span class="o">%</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.81</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.05</span><span class="p">)</span>
<span class="w">                        </span><span class="n">No</span><span class="w"> </span><span class="n">change</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="w"> </span><span class="n">detected</span><span class="p">.</span>
<span class="n">Found</span><span class="w"> </span><span class="mi">15</span><span class="w"> </span><span class="n">outliers</span><span class="w"> </span><span class="n">among</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="n">measurements</span><span class="w"> </span><span class="p">(</span><span class="mf">15.00</span><span class="o">%</span><span class="p">)</span>
<span class="w">  </span><span class="mi">1</span><span class="w"> </span><span class="p">(</span><span class="mf">1.00</span><span class="o">%</span><span class="p">)</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="n">mild</span>
<span class="w">  </span><span class="mi">6</span><span class="w"> </span><span class="p">(</span><span class="mf">6.00</span><span class="o">%</span><span class="p">)</span><span class="w"> </span><span class="n">high</span><span class="w"> </span><span class="n">mild</span>
<span class="w">  </span><span class="mi">8</span><span class="w"> </span><span class="p">(</span><span class="mf">8.00</span><span class="o">%</span><span class="p">)</span><span class="w"> </span><span class="n">high</span><span class="w"> </span><span class="n">severe</span>

<span class="kt">f64</span>-&gt;<span class="kt">i64</span>                <span class="nc">time</span>:   <span class="p">[</span><span class="mf">34.067</span><span class="w"> </span><span class="n">ns</span><span class="w"> </span><span class="mf">34.070</span><span class="w"> </span><span class="n">ns</span><span class="w"> </span><span class="mf">34.073</span><span class="w"> </span><span class="n">ns</span><span class="p">]</span>
<span class="w">                        </span><span class="n">change</span>: <span class="p">[</span><span class="o">-</span><span class="mf">0.0274</span><span class="o">%</span><span class="w"> </span><span class="o">-</span><span class="mf">0.0002</span><span class="o">%</span><span class="w"> </span><span class="o">+</span><span class="mf">0.0312</span><span class="o">%</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.99</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.05</span><span class="p">)</span>
<span class="w">                        </span><span class="n">No</span><span class="w"> </span><span class="n">change</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="w"> </span><span class="n">detected</span><span class="p">.</span>
<span class="n">Found</span><span class="w"> </span><span class="mi">12</span><span class="w"> </span><span class="n">outliers</span><span class="w"> </span><span class="n">among</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="n">measurements</span><span class="w"> </span><span class="p">(</span><span class="mf">12.00</span><span class="o">%</span><span class="p">)</span>
<span class="w">  </span><span class="mi">1</span><span class="w"> </span><span class="p">(</span><span class="mf">1.00</span><span class="o">%</span><span class="p">)</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="n">mild</span>
<span class="w">  </span><span class="mi">6</span><span class="w"> </span><span class="p">(</span><span class="mf">6.00</span><span class="o">%</span><span class="p">)</span><span class="w"> </span><span class="n">high</span><span class="w"> </span><span class="n">mild</span>
<span class="w">  </span><span class="mi">5</span><span class="w"> </span><span class="p">(</span><span class="mf">5.00</span><span class="o">%</span><span class="p">)</span><span class="w"> </span><span class="n">high</span><span class="w"> </span><span class="n">severe</span>
</code></pre></div>
<p>&lt;/details&gt;</p>
</blockquote>



<a name="398330873"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237340%20riscv64%3A%20Refactor%20float-to-int%20tra.../near/398330873" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237340.20riscv64.3A.20Refactor.20float-to-int.20tra.2E.2E.2E.html#398330873">(Oct 24 2023 at 17:16)</a>:</h4>
<p>afonso360 edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/7340#issuecomment-1777674261">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/7340">issue #7340</a>:</p>
<blockquote>
<p>Oh, that makes much more sense! Weirdly none of these had significant performance differences.</p>
<p>&lt;details&gt;<br>
&lt;summary&gt;Criterion output&lt;/summary&gt;</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">afonso</span><span class="o">@</span><span class="n">starfive</span>:<span class="o">~</span><span class="cp">$</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">main</span><span class="w"> </span><span class="o">--</span><span class="n">dir</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">bench</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span><span class="n">bench</span>
<span class="o">..</span><span class="p">.</span>
<span class="n">afonso</span><span class="o">@</span><span class="n">starfive</span>:<span class="o">~</span><span class="cp">$</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">fflags</span><span class="w"> </span><span class="o">--</span><span class="n">dir</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">bench</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span><span class="n">bench</span>
<span class="kt">f32</span>-&gt;<span class="kt">u32</span>                <span class="nc">time</span>:   <span class="p">[</span><span class="mf">23.730</span><span class="w"> </span><span class="n">ns</span><span class="w"> </span><span class="mf">23.732</span><span class="w"> </span><span class="n">ns</span><span class="w"> </span><span class="mf">23.734</span><span class="w"> </span><span class="n">ns</span><span class="p">]</span>
<span class="w">                        </span><span class="n">change</span>: <span class="p">[</span><span class="o">-</span><span class="mf">0.2177</span><span class="o">%</span><span class="w"> </span><span class="o">-</span><span class="mf">0.1872</span><span class="o">%</span><span class="w"> </span><span class="o">-</span><span class="mf">0.1582</span><span class="o">%</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.00</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.05</span><span class="p">)</span>
<span class="w">                        </span><span class="n">Change</span><span class="w"> </span><span class="n">within</span><span class="w"> </span><span class="n">noise</span><span class="w"> </span><span class="n">threshold</span><span class="p">.</span>
<span class="n">Found</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="n">outliers</span><span class="w"> </span><span class="n">among</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="n">measurements</span><span class="w"> </span><span class="p">(</span><span class="mf">10.00</span><span class="o">%</span><span class="p">)</span>
<span class="w">  </span><span class="mi">1</span><span class="w"> </span><span class="p">(</span><span class="mf">1.00</span><span class="o">%</span><span class="p">)</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="n">mild</span>
<span class="w">  </span><span class="mi">5</span><span class="w"> </span><span class="p">(</span><span class="mf">5.00</span><span class="o">%</span><span class="p">)</span><span class="w"> </span><span class="n">high</span><span class="w"> </span><span class="n">mild</span>
<span class="w">  </span><span class="mi">4</span><span class="w"> </span><span class="p">(</span><span class="mf">4.00</span><span class="o">%</span><span class="p">)</span><span class="w"> </span><span class="n">high</span><span class="w"> </span><span class="n">severe</span>

<span class="kt">f32</span>-&gt;<span class="kt">u64</span>                <span class="nc">time</span>:   <span class="p">[</span><span class="mf">23.731</span><span class="w"> </span><span class="n">ns</span><span class="w"> </span><span class="mf">23.732</span><span class="w"> </span><span class="n">ns</span><span class="w"> </span><span class="mf">23.734</span><span class="w"> </span><span class="n">ns</span><span class="p">]</span>
<span class="w">                        </span><span class="n">change</span>: <span class="p">[</span><span class="o">-</span><span class="mf">0.0650</span><span class="o">%</span><span class="w"> </span><span class="o">-</span><span class="mf">0.0122</span><span class="o">%</span><span class="w"> </span><span class="o">+</span><span class="mf">0.0275</span><span class="o">%</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.68</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.05</span><span class="p">)</span>
<span class="w">                        </span><span class="n">No</span><span class="w"> </span><span class="n">change</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="w"> </span><span class="n">detected</span><span class="p">.</span>
<span class="n">Found</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="n">outliers</span><span class="w"> </span><span class="n">among</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="n">measurements</span><span class="w"> </span><span class="p">(</span><span class="mf">8.00</span><span class="o">%</span><span class="p">)</span>
<span class="w">  </span><span class="mi">2</span><span class="w"> </span><span class="p">(</span><span class="mf">2.00</span><span class="o">%</span><span class="p">)</span><span class="w"> </span><span class="n">high</span><span class="w"> </span><span class="n">mild</span>
<span class="w">  </span><span class="mi">6</span><span class="w"> </span><span class="p">(</span><span class="mf">6.00</span><span class="o">%</span><span class="p">)</span><span class="w"> </span><span class="n">high</span><span class="w"> </span><span class="n">severe</span>

<span class="kt">f64</span>-&gt;<span class="kt">u32</span>                <span class="nc">time</span>:   <span class="p">[</span><span class="mf">25.399</span><span class="w"> </span><span class="n">ns</span><span class="w"> </span><span class="mf">25.401</span><span class="w"> </span><span class="n">ns</span><span class="w"> </span><span class="mf">25.403</span><span class="w"> </span><span class="n">ns</span><span class="p">]</span>
<span class="w">                        </span><span class="n">change</span>: <span class="p">[</span><span class="o">-</span><span class="mf">0.0281</span><span class="o">%</span><span class="w"> </span><span class="o">-</span><span class="mf">0.0043</span><span class="o">%</span><span class="w"> </span><span class="o">+</span><span class="mf">0.0162</span><span class="o">%</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.72</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.05</span><span class="p">)</span>
<span class="w">                        </span><span class="n">No</span><span class="w"> </span><span class="n">change</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="w"> </span><span class="n">detected</span><span class="p">.</span>
<span class="n">Found</span><span class="w"> </span><span class="mi">21</span><span class="w"> </span><span class="n">outliers</span><span class="w"> </span><span class="n">among</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="n">measurements</span><span class="w"> </span><span class="p">(</span><span class="mf">21.00</span><span class="o">%</span><span class="p">)</span>
<span class="w">  </span><span class="mi">4</span><span class="w"> </span><span class="p">(</span><span class="mf">4.00</span><span class="o">%</span><span class="p">)</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="n">mild</span>
<span class="w">  </span><span class="mi">9</span><span class="w"> </span><span class="p">(</span><span class="mf">9.00</span><span class="o">%</span><span class="p">)</span><span class="w"> </span><span class="n">high</span><span class="w"> </span><span class="n">mild</span>
<span class="w">  </span><span class="mi">8</span><span class="w"> </span><span class="p">(</span><span class="mf">8.00</span><span class="o">%</span><span class="p">)</span><span class="w"> </span><span class="n">high</span><span class="w"> </span><span class="n">severe</span>

<span class="kt">f64</span>-&gt;<span class="kt">u64</span>                <span class="nc">time</span>:   <span class="p">[</span><span class="mf">25.068</span><span class="w"> </span><span class="n">ns</span><span class="w"> </span><span class="mf">25.069</span><span class="w"> </span><span class="n">ns</span><span class="w"> </span><span class="mf">25.072</span><span class="w"> </span><span class="n">ns</span><span class="p">]</span>
<span class="w">                        </span><span class="n">change</span>: <span class="p">[</span><span class="o">-</span><span class="mf">0.0540</span><span class="o">%</span><span class="w"> </span><span class="o">-</span><span class="mf">0.0158</span><span class="o">%</span><span class="w"> </span><span class="o">+</span><span class="mf">0.0182</span><span class="o">%</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.41</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.05</span><span class="p">)</span>
<span class="w">                        </span><span class="n">No</span><span class="w"> </span><span class="n">change</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="w"> </span><span class="n">detected</span><span class="p">.</span>
<span class="n">Found</span><span class="w"> </span><span class="mi">13</span><span class="w"> </span><span class="n">outliers</span><span class="w"> </span><span class="n">among</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="n">measurements</span><span class="w"> </span><span class="p">(</span><span class="mf">13.00</span><span class="o">%</span><span class="p">)</span>
<span class="w">  </span><span class="mi">1</span><span class="w"> </span><span class="p">(</span><span class="mf">1.00</span><span class="o">%</span><span class="p">)</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="n">mild</span>
<span class="w">  </span><span class="mi">7</span><span class="w"> </span><span class="p">(</span><span class="mf">7.00</span><span class="o">%</span><span class="p">)</span><span class="w"> </span><span class="n">high</span><span class="w"> </span><span class="n">mild</span>
<span class="w">  </span><span class="mi">5</span><span class="w"> </span><span class="p">(</span><span class="mf">5.00</span><span class="o">%</span><span class="p">)</span><span class="w"> </span><span class="n">high</span><span class="w"> </span><span class="n">severe</span>

<span class="kt">f32</span>-&gt;<span class="kt">i32</span>                <span class="nc">time</span>:   <span class="p">[</span><span class="mf">30.727</span><span class="w"> </span><span class="n">ns</span><span class="w"> </span><span class="mf">30.729</span><span class="w"> </span><span class="n">ns</span><span class="w"> </span><span class="mf">30.732</span><span class="w"> </span><span class="n">ns</span><span class="p">]</span>
<span class="w">                        </span><span class="n">change</span>: <span class="p">[</span><span class="o">-</span><span class="mf">0.0390</span><span class="o">%</span><span class="w"> </span><span class="o">-</span><span class="mf">0.0081</span><span class="o">%</span><span class="w"> </span><span class="o">+</span><span class="mf">0.0170</span><span class="o">%</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.60</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.05</span><span class="p">)</span>
<span class="w">                        </span><span class="n">No</span><span class="w"> </span><span class="n">change</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="w"> </span><span class="n">detected</span><span class="p">.</span>
<span class="n">Found</span><span class="w"> </span><span class="mi">12</span><span class="w"> </span><span class="n">outliers</span><span class="w"> </span><span class="n">among</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="n">measurements</span><span class="w"> </span><span class="p">(</span><span class="mf">12.00</span><span class="o">%</span><span class="p">)</span>
<span class="w">  </span><span class="mi">2</span><span class="w"> </span><span class="p">(</span><span class="mf">2.00</span><span class="o">%</span><span class="p">)</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="n">mild</span>
<span class="w">  </span><span class="mi">4</span><span class="w"> </span><span class="p">(</span><span class="mf">4.00</span><span class="o">%</span><span class="p">)</span><span class="w"> </span><span class="n">high</span><span class="w"> </span><span class="n">mild</span>
<span class="w">  </span><span class="mi">6</span><span class="w"> </span><span class="p">(</span><span class="mf">6.00</span><span class="o">%</span><span class="p">)</span><span class="w"> </span><span class="n">high</span><span class="w"> </span><span class="n">severe</span>

<span class="kt">f32</span>-&gt;<span class="kt">i64</span>                <span class="nc">time</span>:   <span class="p">[</span><span class="mf">32.731</span><span class="w"> </span><span class="n">ns</span><span class="w"> </span><span class="mf">32.734</span><span class="w"> </span><span class="n">ns</span><span class="w"> </span><span class="mf">32.736</span><span class="w"> </span><span class="n">ns</span><span class="p">]</span>
<span class="w">                        </span><span class="n">change</span>: <span class="p">[</span><span class="o">-</span><span class="mf">0.0523</span><span class="o">%</span><span class="w"> </span><span class="o">-</span><span class="mf">0.0069</span><span class="o">%</span><span class="w"> </span><span class="o">+</span><span class="mf">0.0358</span><span class="o">%</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.78</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.05</span><span class="p">)</span>
<span class="w">                        </span><span class="n">No</span><span class="w"> </span><span class="n">change</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="w"> </span><span class="n">detected</span><span class="p">.</span>
<span class="n">Found</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="n">outliers</span><span class="w"> </span><span class="n">among</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="n">measurements</span><span class="w"> </span><span class="p">(</span><span class="mf">10.00</span><span class="o">%</span><span class="p">)</span>
<span class="w">  </span><span class="mi">1</span><span class="w"> </span><span class="p">(</span><span class="mf">1.00</span><span class="o">%</span><span class="p">)</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="n">mild</span>
<span class="w">  </span><span class="mi">3</span><span class="w"> </span><span class="p">(</span><span class="mf">3.00</span><span class="o">%</span><span class="p">)</span><span class="w"> </span><span class="n">high</span><span class="w"> </span><span class="n">mild</span>
<span class="w">  </span><span class="mi">6</span><span class="w"> </span><span class="p">(</span><span class="mf">6.00</span><span class="o">%</span><span class="p">)</span><span class="w"> </span><span class="n">high</span><span class="w"> </span><span class="n">severe</span>

<span class="kt">f64</span>-&gt;<span class="kt">i32</span>                <span class="nc">time</span>:   <span class="p">[</span><span class="mf">34.740</span><span class="w"> </span><span class="n">ns</span><span class="w"> </span><span class="mf">34.742</span><span class="w"> </span><span class="n">ns</span><span class="w"> </span><span class="mf">34.745</span><span class="w"> </span><span class="n">ns</span><span class="p">]</span>
<span class="w">                        </span><span class="n">change</span>: <span class="p">[</span><span class="o">-</span><span class="mf">0.0349</span><span class="o">%</span><span class="w"> </span><span class="o">-</span><span class="mf">0.0039</span><span class="o">%</span><span class="w"> </span><span class="o">+</span><span class="mf">0.0254</span><span class="o">%</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.81</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.05</span><span class="p">)</span>
<span class="w">                        </span><span class="n">No</span><span class="w"> </span><span class="n">change</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="w"> </span><span class="n">detected</span><span class="p">.</span>
<span class="n">Found</span><span class="w"> </span><span class="mi">15</span><span class="w"> </span><span class="n">outliers</span><span class="w"> </span><span class="n">among</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="n">measurements</span><span class="w"> </span><span class="p">(</span><span class="mf">15.00</span><span class="o">%</span><span class="p">)</span>
<span class="w">  </span><span class="mi">1</span><span class="w"> </span><span class="p">(</span><span class="mf">1.00</span><span class="o">%</span><span class="p">)</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="n">mild</span>
<span class="w">  </span><span class="mi">6</span><span class="w"> </span><span class="p">(</span><span class="mf">6.00</span><span class="o">%</span><span class="p">)</span><span class="w"> </span><span class="n">high</span><span class="w"> </span><span class="n">mild</span>
<span class="w">  </span><span class="mi">8</span><span class="w"> </span><span class="p">(</span><span class="mf">8.00</span><span class="o">%</span><span class="p">)</span><span class="w"> </span><span class="n">high</span><span class="w"> </span><span class="n">severe</span>

<span class="kt">f64</span>-&gt;<span class="kt">i64</span>                <span class="nc">time</span>:   <span class="p">[</span><span class="mf">34.067</span><span class="w"> </span><span class="n">ns</span><span class="w"> </span><span class="mf">34.070</span><span class="w"> </span><span class="n">ns</span><span class="w"> </span><span class="mf">34.073</span><span class="w"> </span><span class="n">ns</span><span class="p">]</span>
<span class="w">                        </span><span class="n">change</span>: <span class="p">[</span><span class="o">-</span><span class="mf">0.0274</span><span class="o">%</span><span class="w"> </span><span class="o">-</span><span class="mf">0.0002</span><span class="o">%</span><span class="w"> </span><span class="o">+</span><span class="mf">0.0312</span><span class="o">%</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.99</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.05</span><span class="p">)</span>
<span class="w">                        </span><span class="n">No</span><span class="w"> </span><span class="n">change</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">performance</span><span class="w"> </span><span class="n">detected</span><span class="p">.</span>
<span class="n">Found</span><span class="w"> </span><span class="mi">12</span><span class="w"> </span><span class="n">outliers</span><span class="w"> </span><span class="n">among</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="n">measurements</span><span class="w"> </span><span class="p">(</span><span class="mf">12.00</span><span class="o">%</span><span class="p">)</span>
<span class="w">  </span><span class="mi">1</span><span class="w"> </span><span class="p">(</span><span class="mf">1.00</span><span class="o">%</span><span class="p">)</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="n">mild</span>
<span class="w">  </span><span class="mi">6</span><span class="w"> </span><span class="p">(</span><span class="mf">6.00</span><span class="o">%</span><span class="p">)</span><span class="w"> </span><span class="n">high</span><span class="w"> </span><span class="n">mild</span>
<span class="w">  </span><span class="mi">5</span><span class="w"> </span><span class="p">(</span><span class="mf">5.00</span><span class="o">%</span><span class="p">)</span><span class="w"> </span><span class="n">high</span><span class="w"> </span><span class="n">severe</span>
</code></pre></div>
<p>&lt;/details&gt;</p>
</blockquote>



<a name="398346162"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237340%20riscv64%3A%20Refactor%20float-to-int%20tra.../near/398346162" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237340.20riscv64.3A.20Refactor.20float-to-int.20tra.2E.2E.2E.html#398346162">(Oct 24 2023 at 19:10)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/7340#issuecomment-1777865034">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/7340">issue #7340</a>:</p>
<blockquote>
<p>Thanks for collecting those! Sounds like this isn't the best way to go at this time, so I'm going to close this.</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>