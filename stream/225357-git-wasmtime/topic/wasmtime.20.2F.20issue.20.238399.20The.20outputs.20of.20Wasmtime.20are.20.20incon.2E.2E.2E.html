<html>
<head><meta charset="utf-8"><title>wasmtime / issue #8399 The outputs of Wasmtime are  incon... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238399.20The.20outputs.20of.20Wasmtime.20are.20.20incon.2E.2E.2E.html">wasmtime / issue #8399 The outputs of Wasmtime are  incon...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="434032123"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238399%20The%20outputs%20of%20Wasmtime%20are%20%20incon.../near/434032123" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238399.20The.20outputs.20of.20Wasmtime.20are.20.20incon.2E.2E.2E.html#434032123">(Apr 18 2024 at 12:11)</a>:</h4>
<p>abc767234318 opened <a href="https://github.com/bytecodealliance/wasmtime/issues/8399">issue #8399</a>:</p>
<blockquote>
<p>I constructed a wasm binary with an exported function called "main". I compared the outputs of wasmtime and found they are inconsistent across different platforms.<br>
<a href="https://github.com/bytecodealliance/wasmtime/files/15024610/file86.zip">file86.zip</a></p>
<p>Wasmtime  v18.0.2 Ubuntu22.04 x86_64:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">wasmtime</span><span class="w"> </span><span class="o">--</span><span class="n">invoke</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="n">file86</span><span class="p">.</span><span class="n">wasm</span>
<span class="n">warning</span>: <span class="nc">using</span><span class="w"> </span><span class="err">`</span><span class="o">--</span><span class="n">invoke</span><span class="err">`</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">returns</span><span class="w"> </span><span class="n">values</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">experimental</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="k">break</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">future</span>
<span class="mi">667210185897120983469013534608098645</span>
<span class="mi">667210185897120983469013534608098645</span>
<span class="mi">667210185897120983469013534608098645</span>
<span class="mi">667210185897120983469013534608098645</span>
<span class="mi">667210185897120983469013534608098645</span>
<span class="mi">667210185897120983469013534608098645</span>
<span class="mi">667210185897120983469013534608098645</span>
</code></pre></div>
<p>Wasmtime  v18.0.2 MacOS arm64:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">wasmtime</span><span class="w"> </span><span class="o">--</span><span class="n">invoke</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="n">file86</span><span class="p">.</span><span class="n">wasm</span>
<span class="n">warning</span>: <span class="nc">using</span><span class="w"> </span><span class="err">`</span><span class="o">--</span><span class="n">invoke</span><span class="err">`</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">returns</span><span class="w"> </span><span class="n">values</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">experimental</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="k">break</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">future</span>
<span class="mi">667210185936411072606488982786049365</span>
<span class="mi">667210185936411072606488982786049365</span>
<span class="mi">667210185936411072606488982786049365</span>
<span class="mi">667210185936411072606488982786049365</span>
<span class="mi">667210185936411072606488982786049365</span>
<span class="mi">667210185936411072606488982786049365</span>
<span class="mi">667210185936411072606488982786049365</span>
</code></pre></div>
</blockquote>



<a name="434034492"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238399%20The%20outputs%20of%20Wasmtime%20are%20%20incon.../near/434034492" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238399.20The.20outputs.20of.20Wasmtime.20are.20.20incon.2E.2E.2E.html#434034492">(Apr 18 2024 at 12:24)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/issues/8399#issuecomment-2063744378">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/8399">issue #8399</a>:</p>
<blockquote>
<p>Does the wasm module look at the raw bits of floats? NaN values are allowed to be non-deterministic by the wasm specification. Different cpu architectures have different handling of NaN values. This may be the cause of the difference here if the answer to my question is true.</p>
</blockquote>



<a name="434063116"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238399%20The%20outputs%20of%20Wasmtime%20are%20%20incon.../near/434063116" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238399.20The.20outputs.20of.20Wasmtime.20are.20.20incon.2E.2E.2E.html#434063116">(Apr 18 2024 at 14:39)</a>:</h4>
<p>alexcrichton closed <a href="https://github.com/bytecodealliance/wasmtime/issues/8399">issue #8399</a>:</p>
<blockquote>
<p>I constructed a wasm binary with an exported function called "main". I compared the outputs of wasmtime and found they are inconsistent across different platforms.<br>
<a href="https://github.com/bytecodealliance/wasmtime/files/15024610/file86.zip">file86.zip</a></p>
<p>Wasmtime  v18.0.2 Ubuntu22.04 x86_64:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">wasmtime</span><span class="w"> </span><span class="o">--</span><span class="n">invoke</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="n">file86</span><span class="p">.</span><span class="n">wasm</span>
<span class="n">warning</span>: <span class="nc">using</span><span class="w"> </span><span class="err">`</span><span class="o">--</span><span class="n">invoke</span><span class="err">`</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">returns</span><span class="w"> </span><span class="n">values</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">experimental</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="k">break</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">future</span>
<span class="mi">667210185897120983469013534608098645</span>
<span class="mi">667210185897120983469013534608098645</span>
<span class="mi">667210185897120983469013534608098645</span>
<span class="mi">667210185897120983469013534608098645</span>
<span class="mi">667210185897120983469013534608098645</span>
<span class="mi">667210185897120983469013534608098645</span>
<span class="mi">667210185897120983469013534608098645</span>
</code></pre></div>
<p>Wasmtime  v18.0.2 MacOS arm64:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">wasmtime</span><span class="w"> </span><span class="o">--</span><span class="n">invoke</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="n">file86</span><span class="p">.</span><span class="n">wasm</span>
<span class="n">warning</span>: <span class="nc">using</span><span class="w"> </span><span class="err">`</span><span class="o">--</span><span class="n">invoke</span><span class="err">`</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">returns</span><span class="w"> </span><span class="n">values</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">experimental</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="k">break</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">future</span>
<span class="mi">667210185936411072606488982786049365</span>
<span class="mi">667210185936411072606488982786049365</span>
<span class="mi">667210185936411072606488982786049365</span>
<span class="mi">667210185936411072606488982786049365</span>
<span class="mi">667210185936411072606488982786049365</span>
<span class="mi">667210185936411072606488982786049365</span>
<span class="mi">667210185936411072606488982786049365</span>
</code></pre></div>
</blockquote>



<a name="434063119"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238399%20The%20outputs%20of%20Wasmtime%20are%20%20incon.../near/434063119" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238399.20The.20outputs.20of.20Wasmtime.20are.20.20incon.2E.2E.2E.html#434063119">(Apr 18 2024 at 14:39)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/8399#issuecomment-2064047466">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/8399">issue #8399</a>:</p>
<blockquote>
<p>I can confirm locally that <code>wasmtime run --invoke main -W nan-canonicalization file86.wasm</code> produces the same result on both systems, whereas without it different results are produced. Given that I don't believe that there's a bug here since NaN is allowed to be nondeterministic across platforms and is a known part of the wasm spec.</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>