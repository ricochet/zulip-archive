<html>
<head><meta charset="utf-8"><title>wasmtime / PR #2068 x64: finish implementing wasm MVP sup... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232068.20x64.3A.20finish.20implementing.20wasm.20MVP.20sup.2E.2E.2E.html">wasmtime / PR #2068 x64: finish implementing wasm MVP sup...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="204805817"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232068%20x64%3A%20finish%20implementing%20wasm%20MVP%20sup.../near/204805817" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232068.20x64.3A.20finish.20implementing.20wasm.20MVP.20sup.2E.2E.2E.html#204805817">(Jul 23 2020 at 14:38)</a>:</h4>
<p>bnjbvr opened <a href="https://github.com/bytecodealliance/wasmtime/pull/2068">PR #2068</a> from <code>x64</code> to <code>main</code>:</p>
<blockquote>
<p>This mixed bag of commits implements enough support so that Cranelift-in-Spidermonkey runs all the wasm test cases correctly, including multi-value, reference types, explicit bounds checks, etc. So with respect to Spidermonkey, this brings the x64 level support to the same as aarch64's (on Linux at least; Win64 fastcall support is still to be implemented); wasmtime might require additional work.</p>
<p>Next step is setting up CI so this is actually tested in automation.</p>
</blockquote>



<a name="204805819"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232068%20x64%3A%20finish%20implementing%20wasm%20MVP%20sup.../near/204805819" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232068.20x64.3A.20finish.20implementing.20wasm.20MVP.20sup.2E.2E.2E.html#204805819">(Jul 23 2020 at 14:38)</a>:</h4>
<p><strong>bnjbvr</strong> requested <a href="https://github.com/cfallin">cfallin</a>, <a href="https://github.com/julian-seward1">julian-seward1</a> and <a href="https://github.com/jlb6740">jlb6740</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/2068">PR #2068</a>.</p>



<a name="204805820"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232068%20x64%3A%20finish%20implementing%20wasm%20MVP%20sup.../near/204805820" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232068.20x64.3A.20finish.20implementing.20wasm.20MVP.20sup.2E.2E.2E.html#204805820">(Jul 23 2020 at 14:38)</a>:</h4>
<p><strong>bnjbvr</strong> requested <a href="https://github.com/cfallin">cfallin</a>, <a href="https://github.com/julian-seward1">julian-seward1</a> and <a href="https://github.com/jlb6740">jlb6740</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/2068">PR #2068</a>.</p>



<a name="204805822"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232068%20x64%3A%20finish%20implementing%20wasm%20MVP%20sup.../near/204805822" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232068.20x64.3A.20finish.20implementing.20wasm.20MVP.20sup.2E.2E.2E.html#204805822">(Jul 23 2020 at 14:38)</a>:</h4>
<p><strong>bnjbvr</strong> requested <a href="https://github.com/cfallin">cfallin</a>, <a href="https://github.com/julian-seward1">julian-seward1</a> and <a href="https://github.com/jlb6740">jlb6740</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/2068">PR #2068</a>.</p>



<a name="204843478"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232068%20x64%3A%20finish%20implementing%20wasm%20MVP%20sup.../near/204843478" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232068.20x64.3A.20finish.20implementing.20wasm.20MVP.20sup.2E.2E.2E.html#204843478">(Jul 23 2020 at 19:30)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2068#pullrequestreview-454382079">PR Review</a>.</p>



<a name="204843479"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232068%20x64%3A%20finish%20implementing%20wasm%20MVP%20sup.../near/204843479" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232068.20x64.3A.20finish.20implementing.20wasm.20MVP.20sup.2E.2E.2E.html#204843479">(Jul 23 2020 at 19:30)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2068#pullrequestreview-454382079">PR Review</a>.</p>



<a name="204843480"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232068%20x64%3A%20finish%20implementing%20wasm%20MVP%20sup.../near/204843480" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232068.20x64.3A.20finish.20implementing.20wasm.20MVP.20sup.2E.2E.2E.html#204843480">(Jul 23 2020 at 19:30)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/2068#discussion_r459638453">PR Review Comment</a>:</p>
<blockquote>
<p><code>{max,min}{ss,sd}</code>?</p>
</blockquote>



<a name="204843481"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232068%20x64%3A%20finish%20implementing%20wasm%20MVP%20sup.../near/204843481" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232068.20x64.3A.20finish.20implementing.20wasm.20MVP.20sup.2E.2E.2E.html#204843481">(Jul 23 2020 at 19:30)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/2068#discussion_r459640697">PR Review Comment</a>:</p>
<blockquote>
<p>This could use some explanatory comments (it's very clever though!). It looks like it's emulating a rounding mode by converting input/2, except rounding up by OR'ing in the original LSB?</p>
</blockquote>



<a name="204843482"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232068%20x64%3A%20finish%20implementing%20wasm%20MVP%20sup.../near/204843482" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232068.20x64.3A.20finish.20implementing.20wasm.20MVP.20sup.2E.2E.2E.html#204843482">(Jul 23 2020 at 19:30)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/2068#discussion_r459639216">PR Review Comment</a>:</p>
<blockquote>
<p>Can we pull this out as a top-level helper function?</p>
</blockquote>



<a name="204843483"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232068%20x64%3A%20finish%20implementing%20wasm%20MVP%20sup.../near/204843483" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232068.20x64.3A.20finish.20implementing.20wasm.20MVP.20sup.2E.2E.2E.html#204843483">(Jul 23 2020 at 19:30)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/2068#discussion_r459641673">PR Review Comment</a>:</p>
<blockquote>
<p>(Ah, I see comments now below for this. Perhaps just add a forward-reference here, as in "see below for explanation".)</p>
</blockquote>



<a name="204843484"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232068%20x64%3A%20finish%20implementing%20wasm%20MVP%20sup.../near/204843484" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232068.20x64.3A.20finish.20implementing.20wasm.20MVP.20sup.2E.2E.2E.html#204843484">(Jul 23 2020 at 19:30)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/2068#discussion_r459669803">PR Review Comment</a>:</p>
<blockquote>
<p>Would it make sense to merge <code>CvtFloatToSintSeq</code> and <code>CvtFloatToUintSeq</code> with a flag <code>is_signed: bool</code>?</p>
</blockquote>



<a name="204843485"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232068%20x64%3A%20finish%20implementing%20wasm%20MVP%20sup.../near/204843485" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232068.20x64.3A.20finish.20implementing.20wasm.20MVP.20sup.2E.2E.2E.html#204843485">(Jul 23 2020 at 19:30)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/2068#discussion_r459677526">PR Review Comment</a>:</p>
<blockquote>
<p>Perhaps instead change <code>add_stackmap</code> to take a parameter <code>StackmapExtent</code>, which is an enum with variants <code>StackmapExtent::UpcomingBytes(len)</code> and <code>StackmapExtent::PriorBytes(len)</code> or something like that?</p>
</blockquote>



<a name="204843486"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232068%20x64%3A%20finish%20implementing%20wasm%20MVP%20sup.../near/204843486" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232068.20x64.3A.20finish.20implementing.20wasm.20MVP.20sup.2E.2E.2E.html#204843486">(Jul 23 2020 at 19:30)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/2068#discussion_r459672806">PR Review Comment</a>:</p>
<blockquote>
<p>Should this be <code>0xffff_ffff_ffff_ffff</code> (i.e. <code>u64::MAX</code>)? Or is the <code>RegMemImm::imm</code> sign-extended? (Comment if so?)</p>
</blockquote>



<a name="204843487"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232068%20x64%3A%20finish%20implementing%20wasm%20MVP%20sup.../near/204843487" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232068.20x64.3A.20finish.20implementing.20wasm.20MVP.20sup.2E.2E.2E.html#204843487">(Jul 23 2020 at 19:30)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/2068#discussion_r459671782">PR Review Comment</a>:</p>
<blockquote>
<p>Looking at the sequences above for these conversions, it appears that <code>src</code> is sometimes accessed after the temps. A def is allowed to reuse the source's register if the source is dead after this instruction, so we might inadvertently overwrite the source when we initialize the temp. Could you verify that we copy the source out to a temp as the first action in each of the sequences above?</p>
</blockquote>



<a name="204843488"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232068%20x64%3A%20finish%20implementing%20wasm%20MVP%20sup.../near/204843488" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232068.20x64.3A.20finish.20implementing.20wasm.20MVP.20sup.2E.2E.2E.html#204843488">(Jul 23 2020 at 19:30)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/2068#discussion_r459674953">PR Review Comment</a>:</p>
<blockquote>
<p>Extract this sequence to a helper <code>emit_fcmp</code>, analogous to <code>emit_cmp</code> above?</p>
</blockquote>



<a name="204904988"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232068%20x64%3A%20finish%20implementing%20wasm%20MVP%20sup.../near/204904988" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232068.20x64.3A.20finish.20implementing.20wasm.20MVP.20sup.2E.2E.2E.html#204904988">(Jul 24 2020 at 11:29)</a>:</h4>
<p>julian-seward1 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2068#pullrequestreview-454814157">PR Review</a>.</p>



<a name="204904989"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232068%20x64%3A%20finish%20implementing%20wasm%20MVP%20sup.../near/204904989" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232068.20x64.3A.20finish.20implementing.20wasm.20MVP.20sup.2E.2E.2E.html#204904989">(Jul 24 2020 at 11:29)</a>:</h4>
<p>julian-seward1 created <a href="https://github.com/bytecodealliance/wasmtime/pull/2068#discussion_r459997216">PR Review Comment</a>:</p>
<blockquote>
<p>nit: could you add a comment here, explaining how the Movd/Movq cases are distinguished?  Presumably via REX.W ?  Because the two match- arms here are identical, and it's confusing to look at at first (kinda looks like a bug :)</p>
</blockquote>



<a name="204905013"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232068%20x64%3A%20finish%20implementing%20wasm%20MVP%20sup.../near/204905013" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232068.20x64.3A.20finish.20implementing.20wasm.20MVP.20sup.2E.2E.2E.html#204905013">(Jul 24 2020 at 11:29)</a>:</h4>
<p>julian-seward1 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2068#pullrequestreview-454814342">PR Review</a>.</p>



<a name="204905014"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232068%20x64%3A%20finish%20implementing%20wasm%20MVP%20sup.../near/204905014" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232068.20x64.3A.20finish.20implementing.20wasm.20MVP.20sup.2E.2E.2E.html#204905014">(Jul 24 2020 at 11:29)</a>:</h4>
<p>julian-seward1 created <a href="https://github.com/bytecodealliance/wasmtime/pull/2068#discussion_r459997387">PR Review Comment</a>:</p>
<blockquote>
<p>ditto</p>
</blockquote>



<a name="204905600"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232068%20x64%3A%20finish%20implementing%20wasm%20MVP%20sup.../near/204905600" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232068.20x64.3A.20finish.20implementing.20wasm.20MVP.20sup.2E.2E.2E.html#204905600">(Jul 24 2020 at 11:37)</a>:</h4>
<p>julian-seward1 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2068#pullrequestreview-454818495">PR Review</a>.</p>



<a name="204905601"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232068%20x64%3A%20finish%20implementing%20wasm%20MVP%20sup.../near/204905601" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232068.20x64.3A.20finish.20implementing.20wasm.20MVP.20sup.2E.2E.2E.html#204905601">(Jul 24 2020 at 11:37)</a>:</h4>
<p>julian-seward1 created <a href="https://github.com/bytecodealliance/wasmtime/pull/2068#discussion_r460000553">PR Review Comment</a>:</p>
<blockquote>
<p>This is (indeed as Chris says) very clever.  Just a note that it won't work unchanged if we ever come to support X86_32, since <code>cvtsi2s{d,s}</code> will only take a 32 bit input in that case.</p>
</blockquote>



<a name="204905717"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232068%20x64%3A%20finish%20implementing%20wasm%20MVP%20sup.../near/204905717" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232068.20x64.3A.20finish.20implementing.20wasm.20MVP.20sup.2E.2E.2E.html#204905717">(Jul 24 2020 at 11:38)</a>:</h4>
<p>julian-seward1 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2068#pullrequestreview-454819067">PR Review</a>.</p>



<a name="204905718"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232068%20x64%3A%20finish%20implementing%20wasm%20MVP%20sup.../near/204905718" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232068.20x64.3A.20finish.20implementing.20wasm.20MVP.20sup.2E.2E.2E.html#204905718">(Jul 24 2020 at 11:38)</a>:</h4>
<p>julian-seward1 created <a href="https://github.com/bytecodealliance/wasmtime/pull/2068#discussion_r460000981">PR Review Comment</a>:</p>
<blockquote>
<p>Please, for clarity, specify whether the said "unsigned int" is 32 or 64 bits.</p>
</blockquote>



<a name="204906170"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232068%20x64%3A%20finish%20implementing%20wasm%20MVP%20sup.../near/204906170" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232068.20x64.3A.20finish.20implementing.20wasm.20MVP.20sup.2E.2E.2E.html#204906170">(Jul 24 2020 at 11:44)</a>:</h4>
<p>julian-seward1 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2068#pullrequestreview-454822168">PR Review</a>.</p>



<a name="204906171"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232068%20x64%3A%20finish%20implementing%20wasm%20MVP%20sup.../near/204906171" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232068.20x64.3A.20finish.20implementing.20wasm.20MVP.20sup.2E.2E.2E.html#204906171">(Jul 24 2020 at 11:44)</a>:</h4>
<p>julian-seward1 created <a href="https://github.com/bytecodealliance/wasmtime/pull/2068#discussion_r460003322">PR Review Comment</a>:</p>
<blockquote>
<p>It seems like the two comments are inconsistent:</p>
<div class="codehilite"><pre><span></span><code>/// Converts an unsigned int64 to a float64.
/// Is the target a 64-bits or 32-bits register?
</code></pre></div>


</blockquote>



<a name="204906336"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232068%20x64%3A%20finish%20implementing%20wasm%20MVP%20sup.../near/204906336" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232068.20x64.3A.20finish.20implementing.20wasm.20MVP.20sup.2E.2E.2E.html#204906336">(Jul 24 2020 at 11:47)</a>:</h4>
<p>julian-seward1 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2068#pullrequestreview-454823687">PR Review</a>.</p>



<a name="204906337"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232068%20x64%3A%20finish%20implementing%20wasm%20MVP%20sup.../near/204906337" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232068.20x64.3A.20finish.20implementing.20wasm.20MVP.20sup.2E.2E.2E.html#204906337">(Jul 24 2020 at 11:47)</a>:</h4>
<p>julian-seward1 created <a href="https://github.com/bytecodealliance/wasmtime/pull/2068#discussion_r460004497">PR Review Comment</a>:</p>
<blockquote>
<p>We (collectively) should discuss register conventions, regarding <code>get_regs</code> and how it interacts with temp regs in these sequences, since I think we are in danger of falling into a nasty correctness hole otherwise.  Not just here; the in-progress aarch64 atomics work has the same problem.  Once we have a clear common understanding, we can go back and audit this stuff.  I'm just noting it here; doesn't need to block landing right now.</p>
</blockquote>



<a name="204906433"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232068%20x64%3A%20finish%20implementing%20wasm%20MVP%20sup.../near/204906433" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232068.20x64.3A.20finish.20implementing.20wasm.20MVP.20sup.2E.2E.2E.html#204906433">(Jul 24 2020 at 11:49)</a>:</h4>
<p>julian-seward1 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2068#pullrequestreview-454824542">PR Review</a>.</p>



<a name="204906434"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232068%20x64%3A%20finish%20implementing%20wasm%20MVP%20sup.../near/204906434" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232068.20x64.3A.20finish.20implementing.20wasm.20MVP.20sup.2E.2E.2E.html#204906434">(Jul 24 2020 at 11:49)</a>:</h4>
<p>julian-seward1 created <a href="https://github.com/bytecodealliance/wasmtime/pull/2068#discussion_r460005172">PR Review Comment</a>:</p>
<blockquote>
<p>See also my comment above about need for clear analysis/policy/audit of temp register uses.</p>
</blockquote>



<a name="204907460"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232068%20x64%3A%20finish%20implementing%20wasm%20MVP%20sup.../near/204907460" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232068.20x64.3A.20finish.20implementing.20wasm.20MVP.20sup.2E.2E.2E.html#204907460">(Jul 24 2020 at 12:05)</a>:</h4>
<p>julian-seward1 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2068#pullrequestreview-454832996">PR Review</a>.</p>



<a name="204907461"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232068%20x64%3A%20finish%20implementing%20wasm%20MVP%20sup.../near/204907461" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232068.20x64.3A.20finish.20implementing.20wasm.20MVP.20sup.2E.2E.2E.html#204907461">(Jul 24 2020 at 12:05)</a>:</h4>
<p>julian-seward1 created <a href="https://github.com/bytecodealliance/wasmtime/pull/2068#discussion_r460011710">PR Review Comment</a>:</p>
<blockquote>
<p>Since <code>Andps</code> already exists, is there any point in adding <code>Andpd</code>?  Similar question for <code>Orpd</code>.  They are functionally identical, so the only reason for doing this is if we believe we'll get some kind of domain-crossing penalty by applying (eg) <code>Andps</code> to the output of some insn that generates <code>F64x2</code> rather than <code>F32x4</code>.  Reading the opt guide sec 3.5.2.3 "Bypass between execution domains" leads me to believe that <code>Andpd/Andps/Orpd/Orps</code> would all "live" in the "integer domain".</p>
</blockquote>



<a name="204907502"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232068%20x64%3A%20finish%20implementing%20wasm%20MVP%20sup.../near/204907502" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232068.20x64.3A.20finish.20implementing.20wasm.20MVP.20sup.2E.2E.2E.html#204907502">(Jul 24 2020 at 12:06)</a>:</h4>
<p>julian-seward1 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2068#pullrequestreview-454833345">PR Review</a>.</p>



<a name="204907503"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232068%20x64%3A%20finish%20implementing%20wasm%20MVP%20sup.../near/204907503" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232068.20x64.3A.20finish.20implementing.20wasm.20MVP.20sup.2E.2E.2E.html#204907503">(Jul 24 2020 at 12:06)</a>:</h4>
<p>julian-seward1 created <a href="https://github.com/bytecodealliance/wasmtime/pull/2068#discussion_r460011970">PR Review Comment</a>:</p>
<blockquote>
<p>Or maybe all in the FP domain (who knows).  Point is, I can't see that the implied 32x4 vs 64x2 differentiation would make any difference.</p>
</blockquote>



<a name="204907965"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232068%20x64%3A%20finish%20implementing%20wasm%20MVP%20sup.../near/204907965" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232068.20x64.3A.20finish.20implementing.20wasm.20MVP.20sup.2E.2E.2E.html#204907965">(Jul 24 2020 at 12:12)</a>:</h4>
<p>julian-seward1 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2068#pullrequestreview-454837086">PR Review</a>.</p>



<a name="204907966"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232068%20x64%3A%20finish%20implementing%20wasm%20MVP%20sup.../near/204907966" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232068.20x64.3A.20finish.20implementing.20wasm.20MVP.20sup.2E.2E.2E.html#204907966">(Jul 24 2020 at 12:12)</a>:</h4>
<p>julian-seward1 created <a href="https://github.com/bytecodealliance/wasmtime/pull/2068#discussion_r460014753">PR Review Comment</a>:</p>
<blockquote>
<p>Similar comments to the <code>Andps/pd</code>/<code>Orps/pd</code> duality.</p>
</blockquote>



<a name="204908943"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232068%20x64%3A%20finish%20implementing%20wasm%20MVP%20sup.../near/204908943" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232068.20x64.3A.20finish.20implementing.20wasm.20MVP.20sup.2E.2E.2E.html#204908943">(Jul 24 2020 at 12:27)</a>:</h4>
<p>julian-seward1 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2068#pullrequestreview-454845659">PR Review</a>.</p>



<a name="204908944"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232068%20x64%3A%20finish%20implementing%20wasm%20MVP%20sup.../near/204908944" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232068.20x64.3A.20finish.20implementing.20wasm.20MVP.20sup.2E.2E.2E.html#204908944">(Jul 24 2020 at 12:27)</a>:</h4>
<p>julian-seward1 created <a href="https://github.com/bytecodealliance/wasmtime/pull/2068#discussion_r460021269">PR Review Comment</a>:</p>
<blockquote>
<p>Would it be safer to panic on any cases that we don't expect to ever get -- are there any?  Specifically, for equality, signfulness is meaningless, and for overflows -- aren't there both signed and unsigned overflows?  Certainly on x64 there are (<code>rflags.C</code> vs <code>rflags.O</code>).</p>
</blockquote>



<a name="204909000"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232068%20x64%3A%20finish%20implementing%20wasm%20MVP%20sup.../near/204909000" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232068.20x64.3A.20finish.20implementing.20wasm.20MVP.20sup.2E.2E.2E.html#204909000">(Jul 24 2020 at 12:28)</a>:</h4>
<p>julian-seward1 edited <a href="https://github.com/bytecodealliance/wasmtime/pull/2068#discussion_r460021269">PR Review Comment</a>.</p>



<a name="204909647"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232068%20x64%3A%20finish%20implementing%20wasm%20MVP%20sup.../near/204909647" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232068.20x64.3A.20finish.20implementing.20wasm.20MVP.20sup.2E.2E.2E.html#204909647">(Jul 24 2020 at 12:35)</a>:</h4>
<p>julian-seward1 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2068#pullrequestreview-454850348">PR Review</a>.</p>



<a name="204920024"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232068%20x64%3A%20finish%20implementing%20wasm%20MVP%20sup.../near/204920024" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232068.20x64.3A.20finish.20implementing.20wasm.20MVP.20sup.2E.2E.2E.html#204920024">(Jul 24 2020 at 14:12)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2068#discussion_r460078018">PR Review Comment</a>:</p>
<blockquote>
<p>@julian-seward1 Indeed, fixed the above comment for <code>CvtUint64ToFloatSeq</code> so it says <code>to a float32/float64</code>, thanks!</p>
<p>@cfallin I had thought of this; it just makes the emit code very long, and it was nice to have one axis to cut them. I hesitated between signed vs unsigned, or saturated vs not saturated, but the sat instructions emit very similar code, so splitting signed and unsigned made more sense. We could merge them back at some point, maybe using an enum to avoid manipulating the two booleans.</p>
</blockquote>



<a name="204920026"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232068%20x64%3A%20finish%20implementing%20wasm%20MVP%20sup.../near/204920026" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232068.20x64.3A.20finish.20implementing.20wasm.20MVP.20sup.2E.2E.2E.html#204920026">(Jul 24 2020 at 14:12)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2068#pullrequestreview-454919979">PR Review</a>.</p>



<a name="204921142"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232068%20x64%3A%20finish%20implementing%20wasm%20MVP%20sup.../near/204921142" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232068.20x64.3A.20finish.20implementing.20wasm.20MVP.20sup.2E.2E.2E.html#204921142">(Jul 24 2020 at 14:21)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2068#pullrequestreview-454927007">PR Review</a>.</p>



<a name="204921144"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232068%20x64%3A%20finish%20implementing%20wasm%20MVP%20sup.../near/204921144" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232068.20x64.3A.20finish.20implementing.20wasm.20MVP.20sup.2E.2E.2E.html#204921144">(Jul 24 2020 at 14:21)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2068#discussion_r460083518">PR Review Comment</a>:</p>
<blockquote>
<p>Good catch for <code>CvtUint64ToFloatSeq</code>, scary that testing didn't stumble upon it. Agreed we'll need a better policy in this kind of situation; in the meantime, I'll mark it as <code>mod</code> instead of <code>use</code>, and will make sure to add a copy of the real src to a temporary fed to this Inst's src; this is sufficient to ensure the src and tmps will get different registers (otherwise, they'd be conflicting writes). Thanks!</p>
<p>Other sequences use <code>mod</code> for the src operand for this same reason.</p>
<p>[and several minutes later] Even scarier, the checked div or rem sequence had the same potential bug. Changed it to mark the <code>divisor</code> operand as modified too.</p>
</blockquote>



<a name="204922144"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232068%20x64%3A%20finish%20implementing%20wasm%20MVP%20sup.../near/204922144" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232068.20x64.3A.20finish.20implementing.20wasm.20MVP.20sup.2E.2E.2E.html#204922144">(Jul 24 2020 at 14:28)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2068#discussion_r460088432">PR Review Comment</a>:</p>
<blockquote>
<p>It's sign-extended, i'll add a comment!</p>
</blockquote>



<a name="204922145"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232068%20x64%3A%20finish%20implementing%20wasm%20MVP%20sup.../near/204922145" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232068.20x64.3A.20finish.20implementing.20wasm.20MVP.20sup.2E.2E.2E.html#204922145">(Jul 24 2020 at 14:28)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2068#pullrequestreview-454933602">PR Review</a>.</p>



<a name="204922376"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232068%20x64%3A%20finish%20implementing%20wasm%20MVP%20sup.../near/204922376" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232068.20x64.3A.20finish.20implementing.20wasm.20MVP.20sup.2E.2E.2E.html#204922376">(Jul 24 2020 at 14:30)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2068#pullrequestreview-454935254">PR Review</a>.</p>



<a name="204922377"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232068%20x64%3A%20finish%20implementing%20wasm%20MVP%20sup.../near/204922377" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232068.20x64.3A.20finish.20implementing.20wasm.20MVP.20sup.2E.2E.2E.html#204922377">(Jul 24 2020 at 14:30)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2068#discussion_r460089724">PR Review Comment</a>:</p>
<blockquote>
<p>I wasn't sure about this, to be honest: there aren't many opportunities for reuse, since the actual Fcmp lowering does things quite differently. Ok on principle, though.</p>
</blockquote>



<a name="204924387"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232068%20x64%3A%20finish%20implementing%20wasm%20MVP%20sup.../near/204924387" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232068.20x64.3A.20finish.20implementing.20wasm.20MVP.20sup.2E.2E.2E.html#204924387">(Jul 24 2020 at 14:45)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2068#pullrequestreview-454946922">PR Review</a>.</p>



<a name="204924389"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232068%20x64%3A%20finish%20implementing%20wasm%20MVP%20sup.../near/204924389" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232068.20x64.3A.20finish.20implementing.20wasm.20MVP.20sup.2E.2E.2E.html#204924389">(Jul 24 2020 at 14:45)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2068#discussion_r460098598">PR Review Comment</a>:</p>
<blockquote>
<p>Ah, good catch! At first, when the cvt instructions were not handled here, this would also set the RexFlags. Now we could unify movd and movq into a single enum variant, since they effectively have the same effect here. Will consider for later; it's nice to have the proper name in the enum list...</p>
</blockquote>



<a name="204924534"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232068%20x64%3A%20finish%20implementing%20wasm%20MVP%20sup.../near/204924534" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232068.20x64.3A.20finish.20implementing.20wasm.20MVP.20sup.2E.2E.2E.html#204924534">(Jul 24 2020 at 14:46)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2068#pullrequestreview-454947753">PR Review</a>.</p>



<a name="204924536"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232068%20x64%3A%20finish%20implementing%20wasm%20MVP%20sup.../near/204924536" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232068.20x64.3A.20finish.20implementing.20wasm.20MVP.20sup.2E.2E.2E.html#204924536">(Jul 24 2020 at 14:46)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2068#discussion_r460099238">PR Review Comment</a>:</p>
<blockquote>
<p>Noted!</p>
</blockquote>



<a name="204925012"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232068%20x64%3A%20finish%20implementing%20wasm%20MVP%20sup.../near/204925012" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232068.20x64.3A.20finish.20implementing.20wasm.20MVP.20sup.2E.2E.2E.html#204925012">(Jul 24 2020 at 14:50)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2068#pullrequestreview-454950785">PR Review</a>.</p>



<a name="204925013"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232068%20x64%3A%20finish%20implementing%20wasm%20MVP%20sup.../near/204925013" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232068.20x64.3A.20finish.20implementing.20wasm.20MVP.20sup.2E.2E.2E.html#204925013">(Jul 24 2020 at 14:50)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2068#discussion_r460101656">PR Review Comment</a>:</p>
<blockquote>
<p>Good question, I like having the properly typed names, but since the F64 variants may be one byte longer (because of 66-prefix)... That's a question for our Intel experts :-)</p>
<p>@abrown @jlb6740 Is there a preference to use e.g. <code>andps</code> over <code>andpd</code>, if we know the inputs are actually doubles? (See above reference to Intel's manual that Julian quoted.)</p>
</blockquote>



<a name="204925078"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232068%20x64%3A%20finish%20implementing%20wasm%20MVP%20sup.../near/204925078" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232068.20x64.3A.20finish.20implementing.20wasm.20MVP.20sup.2E.2E.2E.html#204925078">(Jul 24 2020 at 14:50)</a>:</h4>
<p>bnjbvr edited <a href="https://github.com/bytecodealliance/wasmtime/pull/2068#discussion_r460101656">PR Review Comment</a>.</p>



<a name="204925956"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232068%20x64%3A%20finish%20implementing%20wasm%20MVP%20sup.../near/204925956" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232068.20x64.3A.20finish.20implementing.20wasm.20MVP.20sup.2E.2E.2E.html#204925956">(Jul 24 2020 at 14:56)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2068#pullrequestreview-454956208">PR Review</a>.</p>



<a name="204925957"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232068%20x64%3A%20finish%20implementing%20wasm%20MVP%20sup.../near/204925957" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232068.20x64.3A.20finish.20implementing.20wasm.20MVP.20sup.2E.2E.2E.html#204925957">(Jul 24 2020 at 14:56)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2068#discussion_r460105697">PR Review Comment</a>:</p>
<blockquote>
<p>Hmm, reverted this change; this was code motion from the aarch64 code, but your comment made me realize the returned values likely only apply to aarch64, and eventually x64 didn't use it.</p>
</blockquote>



<a name="204927116"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232068%20x64%3A%20finish%20implementing%20wasm%20MVP%20sup.../near/204927116" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232068.20x64.3A.20finish.20implementing.20wasm.20MVP.20sup.2E.2E.2E.html#204927116">(Jul 24 2020 at 15:04)</a>:</h4>
<p>bnjbvr updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2068">PR #2068</a> from <code>x64</code> to <code>main</code>:</p>
<blockquote>
<p>This mixed bag of commits implements enough support so that Cranelift-in-Spidermonkey runs all the wasm test cases correctly, including multi-value, reference types, explicit bounds checks, etc. So with respect to Spidermonkey, this brings the x64 level support to the same as aarch64's (on Linux at least; Win64 fastcall support is still to be implemented); wasmtime might require additional work.</p>
<p>Next step is setting up CI so this is actually tested in automation.</p>
</blockquote>



<a name="204938822"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232068%20x64%3A%20finish%20implementing%20wasm%20MVP%20sup.../near/204938822" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232068.20x64.3A.20finish.20implementing.20wasm.20MVP.20sup.2E.2E.2E.html#204938822">(Jul 24 2020 at 16:45)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/2068#discussion_r460168939">PR Review Comment</a>:</p>
<blockquote>
<blockquote>
<p>leads me to believe that Andpd/Andps/Orpd/Orps would all "live" in the "integer domain".</p>
</blockquote>
<p>@julian-seward1, reading that section, I would rather think that <code>Andpd/Andps/Orpd/Orps</code> all live in the FP domain, not in the SIMD (a.k.a. "integer") domain. The example there switches between <code>ADDPS</code> (FP) and <code>PAND</code> (SIMD) and back to <code>ADDPS</code> (FP). So I would expect that to keep everything in the same domain, to follow the manual's example, we would need <code>ADDPS; ANDPS; ADDPS</code>. Or am I missing something?</p>
<blockquote>
<p>Since Andps already exists, is there any point in adding Andpd?</p>
</blockquote>
<p>The question still stands, though, and since I don't know of any penalty like the one mentioned (and I believe packed single floats and packed double floats to be in the same FP domain), then the assembler could avoid knowing about another instruction. But what is the benefit of that? We can always choose <code>ANDPS</code> in the lowering if we are concerned about code size? I would leave it in so that lowering users have the option to use it if it feels more natural.</p>
<p>I think where I'm coming from (and I'm still developing this thought, so bear with me) is that at the assembler level, which is what we are talking about here, the best naming convention in the assembler code is one that matches the ISA naming convention 1:1. Instead of writing <code>Inst::XmmAbcDef(SseOpcode::Andps, ...)</code> (or its helper function) I am suggesting the abstraction should look more like <code>...::Andps(...)</code> so that we more directly think in the ISA namespace than in Cranelift's custom namespace. From that viewpoint, it makes sense to me to have more instruction variants available (e.g. <code>ANDPD</code>) to reduce friction during lowering. (I understand that's still not strongest argument for keeping <code>ANDPD</code> but I'm really thinking more about the ISA naming point... it was a bit frustrating to have to think in terms of an ad hoc convention instead when I was addding SIMD FP arithmetic support).</p>
</blockquote>



<a name="204938824"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232068%20x64%3A%20finish%20implementing%20wasm%20MVP%20sup.../near/204938824" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232068.20x64.3A.20finish.20implementing.20wasm.20MVP.20sup.2E.2E.2E.html#204938824">(Jul 24 2020 at 16:45)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2068#pullrequestreview-455035611">PR Review</a>.</p>



<a name="204938945"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232068%20x64%3A%20finish%20implementing%20wasm%20MVP%20sup.../near/204938945" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232068.20x64.3A.20finish.20implementing.20wasm.20MVP.20sup.2E.2E.2E.html#204938945">(Jul 24 2020 at 16:46)</a>:</h4>
<p>bnjbvr updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2068">PR #2068</a> from <code>x64</code> to <code>main</code>:</p>
<blockquote>
<p>This mixed bag of commits implements enough support so that Cranelift-in-Spidermonkey runs all the wasm test cases correctly, including multi-value, reference types, explicit bounds checks, etc. So with respect to Spidermonkey, this brings the x64 level support to the same as aarch64's (on Linux at least; Win64 fastcall support is still to be implemented); wasmtime might require additional work.</p>
<p>Next step is setting up CI so this is actually tested in automation.</p>
</blockquote>



<a name="204943634"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232068%20x64%3A%20finish%20implementing%20wasm%20MVP%20sup.../near/204943634" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232068.20x64.3A.20finish.20implementing.20wasm.20MVP.20sup.2E.2E.2E.html#204943634">(Jul 24 2020 at 17:29)</a>:</h4>
<p>bnjbvr merged <a href="https://github.com/bytecodealliance/wasmtime/pull/2068">PR #2068</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>