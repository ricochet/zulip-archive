<html>
<head><meta charset="utf-8"><title>wasmtime / PR #6846 stream wit definition eliminates stre... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236846.20stream.20wit.20definition.20eliminates.20stre.2E.2E.2E.html">wasmtime / PR #6846 stream wit definition eliminates stre...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="384926444"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236846%20stream%20wit%20definition%20eliminates%20stre.../near/384926444" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236846.20stream.20wit.20definition.20eliminates.20stre.2E.2E.2E.html#384926444">(Aug 14 2023 at 23:09)</a>:</h4>
<p>pchickey opened <a href="https://github.com/bytecodealliance/wasmtime/pull/6846">PR #6846</a> from <code>bytecodealliance:pch/no_more_stream_error</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>In <a href="https://github.com/WebAssembly/wasi-io/pull/38">https://github.com/WebAssembly/wasi-io/pull/38</a> we got review feedback<br>
to eliminate the stream-error in favor of the empty error in wit<br>
<code>result&lt;a&gt;</code>.</p>
<p>This means we cant use trappable error anymore, and therefore leads to<br>
all this other unsightly transformation of the streams trait definition<br>
and all its call sites.</p>
<p>We'll fix the wasmtime-wit-bindgen macro to support this case better in<br>
the future, but rn we gotta stay synchronized with upstream</p>
<p>On the upside this showed us that the host stream trait design doesnt<br>
differentiate between a runtime and a trapping error, so lets fix that<br>
next</p>
<p>&lt;!--<br>
Please make sure you include the following information:</p>
<ul>
<li>
<p>If this work has been discussed elsewhere, please include a link to that<br>
  conversation. If it was discussed in an issue, just mention "issue #...".</p>
</li>
<li>
<p>Explain why this change is needed. If the details are in an issue already,<br>
  this can be brief.</p>
</li>
</ul>
<p>Our development process is documented in the Wasmtime book:<br>
<a href="https://docs.wasmtime.dev/contributing-development-process.html">https://docs.wasmtime.dev/contributing-development-process.html</a></p>
<p>Please ensure all communication follows the code of conduct:<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>
--&gt;</p>
</blockquote>



<a name="384926445"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236846%20stream%20wit%20definition%20eliminates%20stre.../near/384926445" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236846.20stream.20wit.20definition.20eliminates.20stre.2E.2E.2E.html#384926445">(Aug 14 2023 at 23:09)</a>:</h4>
<p><strong>pchickey</strong> requested <a href="https://github.com/jameysharp">jameysharp</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/6846">PR #6846</a>.</p>



<a name="384926447"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236846%20stream%20wit%20definition%20eliminates%20stre.../near/384926447" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236846.20stream.20wit.20definition.20eliminates.20stre.2E.2E.2E.html#384926447">(Aug 14 2023 at 23:09)</a>:</h4>
<p><strong>pchickey</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/6846">PR #6846</a>.</p>



<a name="384926500"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236846%20stream%20wit%20definition%20eliminates%20stre.../near/384926500" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236846.20stream.20wit.20definition.20eliminates.20stre.2E.2E.2E.html#384926500">(Aug 14 2023 at 23:10)</a>:</h4>
<p><strong>pchickey</strong> requested <a href="https://github.com/elliottt">elliottt</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/6846">PR #6846</a>.</p>



<a name="384930421"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236846%20stream%20wit%20definition%20eliminates%20stre.../near/384930421" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236846.20stream.20wit.20definition.20eliminates.20stre.2E.2E.2E.html#384930421">(Aug 14 2023 at 23:47)</a>:</h4>
<p><strong>pchickey</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-default-reviewers">wasmtime-default-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/6846">PR #6846</a>.</p>



<a name="384930422"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236846%20stream%20wit%20definition%20eliminates%20stre.../near/384930422" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236846.20stream.20wit.20definition.20eliminates.20stre.2E.2E.2E.html#384930422">(Aug 14 2023 at 23:47)</a>:</h4>
<p>pchickey updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6846">PR #6846</a>.</p>



<a name="384934449"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236846%20stream%20wit%20definition%20eliminates%20stre.../near/384934449" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236846.20stream.20wit.20definition.20eliminates.20stre.2E.2E.2E.html#384934449">(Aug 15 2023 at 00:17)</a>:</h4>
<p>pchickey updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6846">PR #6846</a>.</p>



<a name="384935462"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236846%20stream%20wit%20definition%20eliminates%20stre.../near/384935462" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236846.20stream.20wit.20definition.20eliminates.20stre.2E.2E.2E.html#384935462">(Aug 15 2023 at 00:25)</a>:</h4>
<p>pchickey updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6846">PR #6846</a>.</p>



<a name="384935510"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236846%20stream%20wit%20definition%20eliminates%20stre.../near/384935510" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236846.20stream.20wit.20definition.20eliminates.20stre.2E.2E.2E.html#384935510">(Aug 15 2023 at 00:25)</a>:</h4>
<p>pchickey updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6846">PR #6846</a>.</p>



<a name="385282663"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236846%20stream%20wit%20definition%20eliminates%20stre.../near/385282663" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236846.20stream.20wit.20definition.20eliminates.20stre.2E.2E.2E.html#385282663">(Aug 15 2023 at 20:39)</a>:</h4>
<p>pchickey updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6846">PR #6846</a>.</p>



<a name="385290129"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236846%20stream%20wit%20definition%20eliminates%20stre.../near/385290129" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236846.20stream.20wit.20definition.20eliminates.20stre.2E.2E.2E.html#385290129">(Aug 15 2023 at 21:46)</a>:</h4>
<p>pchickey edited <a href="https://github.com/bytecodealliance/wasmtime/pull/6846">PR #6846</a>:</p>
<blockquote>
<p>In <a href="https://github.com/WebAssembly/wasi-io/pull/38">https://github.com/WebAssembly/wasi-io/pull/38</a> we got review feedback<br>
to eliminate the stream-error in favor of the empty error in wit<br>
<code>result&lt;a&gt;</code>.</p>
<p>This means we cant use trappable error anymore, and therefore leads to<br>
all this other unsightly transformation of the streams trait definition<br>
and all its call sites.</p>
<p>We'll fix the wasmtime-wit-bindgen macro to support this case better in<br>
the future.</p>
<p>As we made this change, it occurred to us that the host stream trait design doesn't<br>
distinguish between an error to be returned via a stream method at runtime, and an<br>
error that traps execution. We defined the <code>StreamRuntimeError</code> type for runtime<br>
errors, and all other errors trap.</p>
<p>&lt;!--<br>
Please make sure you include the following information:</p>
<ul>
<li>
<p>If this work has been discussed elsewhere, please include a link to that<br>
  conversation. If it was discussed in an issue, just mention "issue #...".</p>
</li>
<li>
<p>Explain why this change is needed. If the details are in an issue already,<br>
  this can be brief.</p>
</li>
</ul>
<p>Our development process is documented in the Wasmtime book:<br>
<a href="https://docs.wasmtime.dev/contributing-development-process.html">https://docs.wasmtime.dev/contributing-development-process.html</a></p>
<p>Please ensure all communication follows the code of conduct:<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>
--&gt;</p>
</blockquote>



<a name="385290335"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236846%20stream%20wit%20definition%20eliminates%20stre.../near/385290335" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236846.20stream.20wit.20definition.20eliminates.20stre.2E.2E.2E.html#385290335">(Aug 15 2023 at 21:48)</a>:</h4>
<p>pchickey edited <a href="https://github.com/bytecodealliance/wasmtime/pull/6846">PR #6846</a>:</p>
<blockquote>
<p>In <a href="https://github.com/WebAssembly/wasi-io/pull/38">https://github.com/WebAssembly/wasi-io/pull/38</a> we got review feedback<br>
to eliminate the stream-error in favor of the empty error in wit<br>
<code>result&lt;a&gt;</code>.</p>
<p>This means we cant use wasmtime-wit-bindgen's <code>trappable_error</code> functionality<br>
anymore, so the signature of the streams binding trait its call sites are much less<br>
idiomatic than before. We'll fix the wasmtime-wit-bindgen macro to support this<br>
case better in the future, but for now we can live with this code being a little ugly,<br>
since most users will be using the (much nicer) <code>HostInputStream</code> and<br>
<code>HostOutputStream</code> types.</p>
<p>As we made this change, it occurred to us that the host stream trait design doesn't<br>
distinguish between an error to be returned via a stream method at runtime, and an<br>
error that traps execution. We defined the <code>StreamRuntimeError</code> type for runtime<br>
errors, and all other errors trap.</p>
<p>&lt;!--<br>
Please make sure you include the following information:</p>
<ul>
<li>
<p>If this work has been discussed elsewhere, please include a link to that<br>
  conversation. If it was discussed in an issue, just mention "issue #...".</p>
</li>
<li>
<p>Explain why this change is needed. If the details are in an issue already,<br>
  this can be brief.</p>
</li>
</ul>
<p>Our development process is documented in the Wasmtime book:<br>
<a href="https://docs.wasmtime.dev/contributing-development-process.html">https://docs.wasmtime.dev/contributing-development-process.html</a></p>
<p>Please ensure all communication follows the code of conduct:<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>
--&gt;</p>
</blockquote>



<a name="385290461"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236846%20stream%20wit%20definition%20eliminates%20stre.../near/385290461" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236846.20stream.20wit.20definition.20eliminates.20stre.2E.2E.2E.html#385290461">(Aug 15 2023 at 21:49)</a>:</h4>
<p>pchickey edited <a href="https://github.com/bytecodealliance/wasmtime/pull/6846">PR #6846</a>:</p>
<blockquote>
<p>In <a href="https://github.com/WebAssembly/wasi-io/pull/38">https://github.com/WebAssembly/wasi-io/pull/38</a> we got review feedback to eliminate the stream-error in favor of the empty error (wit <code>result&lt;a&gt;</code>). Although upstream PR 38 is not merged yet, we are downstreaming this interface change now, expecting it will merge upstream soon.</p>
<p>The wit change means we cant use wasmtime-wit-bindgen's <code>trappable_error</code> functionality anymore, so the signature of the streams binding trait its call sites are much less idiomatic than before. We'll fix the wasmtime-wit-bindgen macro to support this case better in the future, but for now we can live with this code being a little ugly, since most users will be using the (much nicer) <code>HostInputStream</code> and <code>HostOutputStream</code> types.</p>
<p>As we made this change, it occurred to us that the host stream trait design doesn't distinguish between an error to be returned via a stream method at runtime, and an error that traps execution. We defined the <code>StreamRuntimeError</code> type for runtime errors, and all other errors trap.</p>
<p>&lt;!--<br>
Please make sure you include the following information:</p>
<ul>
<li>
<p>If this work has been discussed elsewhere, please include a link to that<br>
  conversation. If it was discussed in an issue, just mention "issue #...".</p>
</li>
<li>
<p>Explain why this change is needed. If the details are in an issue already,<br>
  this can be brief.</p>
</li>
</ul>
<p>Our development process is documented in the Wasmtime book:<br>
<a href="https://docs.wasmtime.dev/contributing-development-process.html">https://docs.wasmtime.dev/contributing-development-process.html</a></p>
<p>Please ensure all communication follows the code of conduct:<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>
--&gt;</p>
</blockquote>



<a name="385299494"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236846%20stream%20wit%20definition%20eliminates%20stre.../near/385299494" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236846.20stream.20wit.20definition.20eliminates.20stre.2E.2E.2E.html#385299494">(Aug 15 2023 at 23:15)</a>:</h4>
<p>elliottt submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6846#pullrequestreview-1579590637">PR review</a>:</p>
<blockquote>
<p>This looks great! I'm looking forward to the day that we can have custom impls for <code>Try</code>, as it would be great to remove the double-nesting of <code>Result</code> :)</p>
</blockquote>



<a name="385550857"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236846%20stream%20wit%20definition%20eliminates%20stre.../near/385550857" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236846.20stream.20wit.20definition.20eliminates.20stre.2E.2E.2E.html#385550857">(Aug 16 2023 at 22:16)</a>:</h4>
<p>pchickey updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6846">PR #6846</a>.</p>



<a name="385756841"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236846%20stream%20wit%20definition%20eliminates%20stre.../near/385756841" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236846.20stream.20wit.20definition.20eliminates.20stre.2E.2E.2E.html#385756841">(Aug 17 2023 at 21:37)</a>:</h4>
<p>pchickey merged <a href="https://github.com/bytecodealliance/wasmtime/pull/6846">PR #6846</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>