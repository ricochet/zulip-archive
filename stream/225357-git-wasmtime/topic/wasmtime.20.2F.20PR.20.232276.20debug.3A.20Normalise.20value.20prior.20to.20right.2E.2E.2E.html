<html>
<head><meta charset="utf-8"><title>wasmtime / PR #2276 debug: Normalise value prior to right... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232276.20debug.3A.20Normalise.20value.20prior.20to.20right.2E.2E.2E.html">wasmtime / PR #2276 debug: Normalise value prior to right...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="212563785"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232276%20debug%3A%20Normalise%20value%20prior%20to%20right.../near/212563785" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232276.20debug.3A.20Normalise.20value.20prior.20to.20right.2E.2E.2E.html#212563785">(Oct 07 2020 at 14:11)</a>:</h4>
<p>ggreif edited <a href="https://github.com/bytecodealliance/wasmtime/pull/2276">PR #2276</a> from <code>main</code> to <code>main</code>:</p>
<blockquote>
<p>Due to the 32-bit WASM/64-bit wasmtime VM schism the <code>DW_OP_shr*</code> operations end up with random bits frobbed from the upper portion of the 64-bit operand word. This fixes up to the location translator such that it inserts (something akin to) <code>DW_OP_lit32; DW_OP_shl; DW_OP_lit32; DW_OP_shrX</code> in front of <code>DW_OP_shrX</code>. The rationale is that this will clean out the upper portion, respecting 32-bit signedness. </p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
</blockquote>



<a name="212568342"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232276%20debug%3A%20Normalise%20value%20prior%20to%20right.../near/212568342" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232276.20debug.3A.20Normalise.20value.20prior.20to.20right.2E.2E.2E.html#212568342">(Oct 07 2020 at 14:44)</a>:</h4>
<p>ggreif edited <a href="https://github.com/bytecodealliance/wasmtime/pull/2276">PR #2276</a> from <code>main</code> to <code>main</code>:</p>
<blockquote>
<p>Due to the 32-bit WASM/64-bit wasmtime VM schism, the <code>DW_OP_shr*</code> operations end up with random bits frobbed from the upper portion of the 64-bit operand word. This fixes up to the location translator such that it inserts (something akin to) <code>DW_OP_lit32; DW_OP_shl; DW_OP_lit32; DW_OP_shrX</code> in front of <code>DW_OP_shrX</code>. The rationale is that this will clean out the upper portion, respecting 32-bit signedness. </p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
</blockquote>



<a name="212568912"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232276%20debug%3A%20Normalise%20value%20prior%20to%20right.../near/212568912" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232276.20debug.3A.20Normalise.20value.20prior.20to.20right.2E.2E.2E.html#212568912">(Oct 07 2020 at 14:47)</a>:</h4>
<p>ggreif edited <a href="https://github.com/bytecodealliance/wasmtime/pull/2276">PR #2276</a> from <code>main</code> to <code>main</code>:</p>
<blockquote>
<p>Due to the 32-bit WASM/64-bit wasmtime VM schism, the <code>DW_OP_shr*</code> operations end up with random bits frobbed from the upper portion of the 64-bit operand word. This PR fixes up the location translator such that it inserts (something akin to) <code>DW_OP_lit32; DW_OP_shl; DW_OP_lit32; DW_OP_shrX</code> in front of <code>DW_OP_shrX</code>. The rationale is that this will clean out the upper portion, respecting 32-bit signedness. </p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
</blockquote>



<a name="212576119"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232276%20debug%3A%20Normalise%20value%20prior%20to%20right.../near/212576119" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232276.20debug.3A.20Normalise.20value.20prior.20to.20right.2E.2E.2E.html#212576119">(Oct 07 2020 at 15:30)</a>:</h4>
<p>yurydelendik submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2276#pullrequestreview-504002835">PR Review</a>.</p>



<a name="212576120"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232276%20debug%3A%20Normalise%20value%20prior%20to%20right.../near/212576120" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232276.20debug.3A.20Normalise.20value.20prior.20to.20right.2E.2E.2E.html#212576120">(Oct 07 2020 at 15:30)</a>:</h4>
<p>yurydelendik created <a href="https://github.com/bytecodealliance/wasmtime/pull/2276#discussion_r501104354">PR Review Comment</a>:</p>
<blockquote>
<p>How about <code>DW_OP_swap DW_OP_plus_uconst 32</code> instead of <code>DW_OP_const1u 32 shr* DW_OP_swap</code>?</p>
</blockquote>



<a name="212576121"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232276%20debug%3A%20Normalise%20value%20prior%20to%20right.../near/212576121" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232276.20debug.3A.20Normalise.20value.20prior.20to.20right.2E.2E.2E.html#212576121">(Oct 07 2020 at 15:30)</a>:</h4>
<p>yurydelendik submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2276#pullrequestreview-504002835">PR Review</a>.</p>



<a name="212576122"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232276%20debug%3A%20Normalise%20value%20prior%20to%20right.../near/212576122" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232276.20debug.3A.20Normalise.20value.20prior.20to.20right.2E.2E.2E.html#212576122">(Oct 07 2020 at 15:30)</a>:</h4>
<p>yurydelendik created <a href="https://github.com/bytecodealliance/wasmtime/pull/2276#discussion_r501107042">PR Review Comment</a>:</p>
<blockquote>
<p>Can you expand on "normalisation" here? I recommend just include this PR description-like text here.</p>
</blockquote>



<a name="212576124"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232276%20debug%3A%20Normalise%20value%20prior%20to%20right.../near/212576124" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232276.20debug.3A.20Normalise.20value.20prior.20to.20right.2E.2E.2E.html#212576124">(Oct 07 2020 at 15:30)</a>:</h4>
<p>yurydelendik created <a href="https://github.com/bytecodealliance/wasmtime/pull/2276#discussion_r501104681">PR Review Comment</a>:</p>
<blockquote>
<p>Do we need to include <code>Shr</code> here?</p>
</blockquote>



<a name="212580832"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232276%20debug%3A%20Normalise%20value%20prior%20to%20right.../near/212580832" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232276.20debug.3A.20Normalise.20value.20prior.20to.20right.2E.2E.2E.html#212580832">(Oct 07 2020 at 16:03)</a>:</h4>
<p>ggreif submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2276#pullrequestreview-504038133">PR Review</a>.</p>



<a name="212580834"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232276%20debug%3A%20Normalise%20value%20prior%20to%20right.../near/212580834" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232276.20debug.3A.20Normalise.20value.20prior.20to.20right.2E.2E.2E.html#212580834">(Oct 07 2020 at 16:03)</a>:</h4>
<p>ggreif created <a href="https://github.com/bytecodealliance/wasmtime/pull/2276#discussion_r501131495">PR Review Comment</a>:</p>
<blockquote>
<p>I wanted to present it as clearly as possible in the first commit, for posterity :-)<br>
I am preparing a commit, that adds an optimisation.</p>
</blockquote>



<a name="212581214"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232276%20debug%3A%20Normalise%20value%20prior%20to%20right.../near/212581214" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232276.20debug.3A.20Normalise.20value.20prior.20to.20right.2E.2E.2E.html#212581214">(Oct 07 2020 at 16:05)</a>:</h4>
<p>ggreif submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2276#pullrequestreview-504040196">PR Review</a>.</p>



<a name="212581216"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232276%20debug%3A%20Normalise%20value%20prior%20to%20right.../near/212581216" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232276.20debug.3A.20Normalise.20value.20prior.20to.20right.2E.2E.2E.html#212581216">(Oct 07 2020 at 16:05)</a>:</h4>
<p>ggreif created <a href="https://github.com/bytecodealliance/wasmtime/pull/2276#discussion_r501133087">PR Review Comment</a>:</p>
<blockquote>
<p>Yes, I have seen dirt bits ending up in the semantic operand with <code>lldb</code>.</p>
</blockquote>



<a name="212582561"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232276%20debug%3A%20Normalise%20value%20prior%20to%20right.../near/212582561" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232276.20debug.3A.20Normalise.20value.20prior.20to.20right.2E.2E.2E.html#212582561">(Oct 07 2020 at 16:15)</a>:</h4>
<p>ggreif submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2276#pullrequestreview-504049389">PR Review</a>.</p>



<a name="212582562"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232276%20debug%3A%20Normalise%20value%20prior%20to%20right.../near/212582562" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232276.20debug.3A.20Normalise.20value.20prior.20to.20right.2E.2E.2E.html#212582562">(Oct 07 2020 at 16:15)</a>:</h4>
<p>ggreif created <a href="https://github.com/bytecodealliance/wasmtime/pull/2276#discussion_r501140106">PR Review Comment</a>:</p>
<blockquote>
<p>Well, that may be in fact an indication that reading of WASM arguments/locals is not hygienic. :-( can you check that?</p>
</blockquote>



<a name="212583088"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232276%20debug%3A%20Normalise%20value%20prior%20to%20right.../near/212583088" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232276.20debug.3A.20Normalise.20value.20prior.20to.20right.2E.2E.2E.html#212583088">(Oct 07 2020 at 16:18)</a>:</h4>
<p>ggreif updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2276">PR #2276</a> from <code>main</code> to <code>main</code>:</p>
<blockquote>
<p>Due to the 32-bit WASM/64-bit wasmtime VM schism, the <code>DW_OP_shr*</code> operations end up with random bits frobbed from the upper portion of the 64-bit operand word. This PR fixes up the location translator such that it inserts (something akin to) <code>DW_OP_lit32; DW_OP_shl; DW_OP_lit32; DW_OP_shrX</code> in front of <code>DW_OP_shrX</code>. The rationale is that this will clean out the upper portion, respecting 32-bit signedness. </p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
</blockquote>



<a name="212583228"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232276%20debug%3A%20Normalise%20value%20prior%20to%20right.../near/212583228" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232276.20debug.3A.20Normalise.20value.20prior.20to.20right.2E.2E.2E.html#212583228">(Oct 07 2020 at 16:19)</a>:</h4>
<p>ggreif updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2276">PR #2276</a> from <code>main</code> to <code>main</code>:</p>
<blockquote>
<p>Due to the 32-bit WASM/64-bit wasmtime VM schism, the <code>DW_OP_shr*</code> operations end up with random bits frobbed from the upper portion of the 64-bit operand word. This PR fixes up the location translator such that it inserts (something akin to) <code>DW_OP_lit32; DW_OP_shl; DW_OP_lit32; DW_OP_shrX</code> in front of <code>DW_OP_shrX</code>. The rationale is that this will clean out the upper portion, respecting 32-bit signedness. </p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
</blockquote>



<a name="212583390"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232276%20debug%3A%20Normalise%20value%20prior%20to%20right.../near/212583390" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232276.20debug.3A.20Normalise.20value.20prior.20to.20right.2E.2E.2E.html#212583390">(Oct 07 2020 at 16:20)</a>:</h4>
<p>ggreif submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2276#pullrequestreview-504053901">PR Review</a>.</p>



<a name="212583391"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232276%20debug%3A%20Normalise%20value%20prior%20to%20right.../near/212583391" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232276.20debug.3A.20Normalise.20value.20prior.20to.20right.2E.2E.2E.html#212583391">(Oct 07 2020 at 16:20)</a>:</h4>
<p>ggreif created <a href="https://github.com/bytecodealliance/wasmtime/pull/2276#discussion_r501143709">PR Review Comment</a>:</p>
<blockquote>
<p>Done: a806b96</p>
</blockquote>



<a name="212584687"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232276%20debug%3A%20Normalise%20value%20prior%20to%20right.../near/212584687" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232276.20debug.3A.20Normalise.20value.20prior.20to.20right.2E.2E.2E.html#212584687">(Oct 07 2020 at 16:31)</a>:</h4>
<p>ggreif submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2276#pullrequestreview-504063111">PR Review</a>.</p>



<a name="212584688"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232276%20debug%3A%20Normalise%20value%20prior%20to%20right.../near/212584688" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232276.20debug.3A.20Normalise.20value.20prior.20to.20right.2E.2E.2E.html#212584688">(Oct 07 2020 at 16:31)</a>:</h4>
<p>ggreif created <a href="https://github.com/bytecodealliance/wasmtime/pull/2276#discussion_r501150881">PR Review Comment</a>:</p>
<blockquote>
<p>Mostly because I was not sure whether two shifts can be collapsed to a single one by the DWARF spec. But I now assume this is the case.</p>
</blockquote>



<a name="212586508"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232276%20debug%3A%20Normalise%20value%20prior%20to%20right.../near/212586508" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232276.20debug.3A.20Normalise.20value.20prior.20to.20right.2E.2E.2E.html#212586508">(Oct 07 2020 at 16:46)</a>:</h4>
<p>yurydelendik submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2276#pullrequestreview-504075376">PR Review</a>.</p>



<a name="212586509"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232276%20debug%3A%20Normalise%20value%20prior%20to%20right.../near/212586509" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232276.20debug.3A.20Normalise.20value.20prior.20to.20right.2E.2E.2E.html#212586509">(Oct 07 2020 at 16:46)</a>:</h4>
<p>yurydelendik created <a href="https://github.com/bytecodealliance/wasmtime/pull/2276#discussion_r501160520">PR Review Comment</a>:</p>
<blockquote>
<p>it might be the case, though I expect DWARF expression not to know that, or the fact that register data is 16, 32 or 64 bit, and be proactive to mask only needed bits. We can keep Shr here for "symmetry".</p>
</blockquote>



<a name="212586740"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232276%20debug%3A%20Normalise%20value%20prior%20to%20right.../near/212586740" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232276.20debug.3A.20Normalise.20value.20prior.20to.20right.2E.2E.2E.html#212586740">(Oct 07 2020 at 16:48)</a>:</h4>
<p>ggreif updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2276">PR #2276</a> from <code>main</code> to <code>main</code>:</p>
<blockquote>
<p>Due to the 32-bit WASM/64-bit wasmtime VM schism, the <code>DW_OP_shr*</code> operations end up with random bits frobbed from the upper portion of the 64-bit operand word. This PR fixes up the location translator such that it inserts (something akin to) <code>DW_OP_lit32; DW_OP_shl; DW_OP_lit32; DW_OP_shrX</code> in front of <code>DW_OP_shrX</code>. The rationale is that this will clean out the upper portion, respecting 32-bit signedness. </p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
</blockquote>



<a name="212586882"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232276%20debug%3A%20Normalise%20value%20prior%20to%20right.../near/212586882" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232276.20debug.3A.20Normalise.20value.20prior.20to.20right.2E.2E.2E.html#212586882">(Oct 07 2020 at 16:49)</a>:</h4>
<p>ggreif submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2276#pullrequestreview-504077974">PR Review</a>.</p>



<a name="212586883"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232276%20debug%3A%20Normalise%20value%20prior%20to%20right.../near/212586883" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232276.20debug.3A.20Normalise.20value.20prior.20to.20right.2E.2E.2E.html#212586883">(Oct 07 2020 at 16:49)</a>:</h4>
<p>ggreif created <a href="https://github.com/bytecodealliance/wasmtime/pull/2276#discussion_r501162570">PR Review Comment</a>:</p>
<blockquote>
<p>This is now fe7f041.</p>
</blockquote>



<a name="212587065"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232276%20debug%3A%20Normalise%20value%20prior%20to%20right.../near/212587065" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232276.20debug.3A.20Normalise.20value.20prior.20to.20right.2E.2E.2E.html#212587065">(Oct 07 2020 at 16:50)</a>:</h4>
<p>ggreif submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2276#pullrequestreview-504079075">PR Review</a>.</p>



<a name="212587066"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232276%20debug%3A%20Normalise%20value%20prior%20to%20right.../near/212587066" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232276.20debug.3A.20Normalise.20value.20prior.20to.20right.2E.2E.2E.html#212587066">(Oct 07 2020 at 16:50)</a>:</h4>
<p>ggreif created <a href="https://github.com/bytecodealliance/wasmtime/pull/2276#discussion_r501163486">PR Review Comment</a>:</p>
<blockquote>
<p>Okay, I'll keep an eye on this. If the _dirt issue_ happens to pop up elsewhere, I'll file a bug. Then we can revisit here.</p>
</blockquote>



<a name="212587566"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232276%20debug%3A%20Normalise%20value%20prior%20to%20right.../near/212587566" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232276.20debug.3A.20Normalise.20value.20prior.20to.20right.2E.2E.2E.html#212587566">(Oct 07 2020 at 16:54)</a>:</h4>
<p>ggreif submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2276#pullrequestreview-504082212">PR Review</a>.</p>



<a name="212587567"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232276%20debug%3A%20Normalise%20value%20prior%20to%20right.../near/212587567" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232276.20debug.3A.20Normalise.20value.20prior.20to.20right.2E.2E.2E.html#212587567">(Oct 07 2020 at 16:54)</a>:</h4>
<p>ggreif created <a href="https://github.com/bytecodealliance/wasmtime/pull/2276#discussion_r501165884">PR Review Comment</a>:</p>
<blockquote>
<p>This normalisation is only needed for <code>wasm32</code>, it is not allowed for <code>wasm64</code>. Can we do it guardedly?</p>
</blockquote>



<a name="212587939"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232276%20debug%3A%20Normalise%20value%20prior%20to%20right.../near/212587939" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232276.20debug.3A.20Normalise.20value.20prior.20to.20right.2E.2E.2E.html#212587939">(Oct 07 2020 at 16:57)</a>:</h4>
<p><strong>ggreif</strong> requested <a href="https://github.com/yurydelendik">yurydelendik</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/2276">PR #2276</a>.</p>



<a name="212589830"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232276%20debug%3A%20Normalise%20value%20prior%20to%20right.../near/212589830" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232276.20debug.3A.20Normalise.20value.20prior.20to.20right.2E.2E.2E.html#212589830">(Oct 07 2020 at 17:11)</a>:</h4>
<p>yurydelendik submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2276#pullrequestreview-504096286">PR Review</a>.</p>



<a name="212589831"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232276%20debug%3A%20Normalise%20value%20prior%20to%20right.../near/212589831" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232276.20debug.3A.20Normalise.20value.20prior.20to.20right.2E.2E.2E.html#212589831">(Oct 07 2020 at 17:11)</a>:</h4>
<p>yurydelendik created <a href="https://github.com/bytecodealliance/wasmtime/pull/2276#discussion_r501176597">PR Review Comment</a>:</p>
<blockquote>
<p>good question, but I think we don't have to answer it right now. we probably need to: a) start tracking values types that are coming from DW_OP_WASM_location (which can be 32 or 64-bit), b) and try to be proactive and track types and implicit bit expansion.</p>
</blockquote>



<a name="212593886"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232276%20debug%3A%20Normalise%20value%20prior%20to%20right.../near/212593886" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232276.20debug.3A.20Normalise.20value.20prior.20to.20right.2E.2E.2E.html#212593886">(Oct 07 2020 at 17:42)</a>:</h4>
<p>yurydelendik submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2276#pullrequestreview-504120215">PR Review</a>.</p>



<a name="212593899"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232276%20debug%3A%20Normalise%20value%20prior%20to%20right.../near/212593899" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232276.20debug.3A.20Normalise.20value.20prior.20to.20right.2E.2E.2E.html#212593899">(Oct 07 2020 at 17:42)</a>:</h4>
<p>yurydelendik merged <a href="https://github.com/bytecodealliance/wasmtime/pull/2276">PR #2276</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>