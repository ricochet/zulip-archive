<html>
<head><meta charset="utf-8"><title>wasmtime / PR #9687 [draft] show how Arc&lt;Mmap&gt; would work · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239687.20.5Bdraft.5D.20show.20how.20Arc.3CMmap.3E.20would.20work.html">wasmtime / PR #9687 [draft] show how Arc&lt;Mmap&gt; would work</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="484589234"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239687%20%5Bdraft%5D%20show%20how%20Arc%3CMmap%3E%20would%20work/near/484589234" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239687.20.5Bdraft.5D.20show.20how.20Arc.3CMmap.3E.20would.20work.html#484589234">(Nov 26 2024 at 20:16)</a>:</h4>
<p>sunshowers opened <a href="https://github.com/bytecodealliance/wasmtime/pull/9687">PR #9687</a> from <code>sunshowers:map-at-mmap-2</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>Draft to show how <a href="https://github.com/bytecodealliance/wasmtime/pull/9682">https://github.com/bytecodealliance/wasmtime/pull/9682</a> would work. (Will clean this up before putting up.)</p>
</blockquote>



<a name="484590595"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239687%20%5Bdraft%5D%20show%20how%20Arc%3CMmap%3E%20would%20work/near/484590595" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239687.20.5Bdraft.5D.20show.20how.20Arc.3CMmap.3E.20would.20work.html#484590595">(Nov 26 2024 at 20:26)</a>:</h4>
<p>sunshowers submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9687#pullrequestreview-2462611733">PR review</a>.</p>



<a name="484590596"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239687%20%5Bdraft%5D%20show%20how%20Arc%3CMmap%3E%20would%20work/near/484590596" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239687.20.5Bdraft.5D.20show.20how.20Arc.3CMmap.3E.20would.20work.html#484590596">(Nov 26 2024 at 20:26)</a>:</h4>
<p>sunshowers created <a href="https://github.com/bytecodealliance/wasmtime/pull/9687#discussion_r1859185460">PR review comment</a>:</p>
<blockquote>
<p>This was a subtle dependency that took me a bit to understand.</p>
</blockquote>



<a name="484806344"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239687%20%5Bdraft%5D%20show%20how%20Arc%3CMmap%3E%20would%20work/near/484806344" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239687.20.5Bdraft.5D.20show.20how.20Arc.3CMmap.3E.20would.20work.html#484806344">(Nov 27 2024 at 22:07)</a>:</h4>
<p>sunshowers submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9687#pullrequestreview-2466014914">PR review</a>.</p>



<a name="484806345"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239687%20%5Bdraft%5D%20show%20how%20Arc%3CMmap%3E%20would%20work/near/484806345" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239687.20.5Bdraft.5D.20show.20how.20Arc.3CMmap.3E.20would.20work.html#484806345">(Nov 27 2024 at 22:07)</a>:</h4>
<p>sunshowers created <a href="https://github.com/bytecodealliance/wasmtime/pull/9687#discussion_r1861290492">PR review comment</a>:</p>
<blockquote>
<p>(And this is only dangerous when <code>alloc</code> represents an owned memory allocation. It's fine if <code>alloc</code> is borrowed. This is a subtle point.)</p>
</blockquote>



<a name="485887384"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239687%20%5Bdraft%5D%20show%20how%20Arc%3CMmap%3E%20would%20work/near/485887384" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239687.20.5Bdraft.5D.20show.20how.20Arc.3CMmap.3E.20would.20work.html#485887384">(Dec 03 2024 at 15:49)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9687#pullrequestreview-2476099055">PR review</a>:</p>
<blockquote>
<p><span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span> </p>
</blockquote>



<a name="485887386"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239687%20%5Bdraft%5D%20show%20how%20Arc%3CMmap%3E%20would%20work/near/485887386" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239687.20.5Bdraft.5D.20show.20how.20Arc.3CMmap.3E.20would.20work.html#485887386">(Dec 03 2024 at 15:49)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/9687#discussion_r1867977034">PR review comment</a>:</p>
<blockquote>
<p>Do you think it'd perhaps be better to remove this <code>no_clear_on_drop</code> and instead perform it in <code>Drop for LocalMemory</code>? (where that could <code>.take()</code> and explicitly do the image stuff before dropping the mmap)</p>
</blockquote>



<a name="486605071"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239687%20%5Bdraft%5D%20show%20how%20Arc%3CMmap%3E%20would%20work/near/486605071" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239687.20.5Bdraft.5D.20show.20how.20Arc.3CMmap.3E.20would.20work.html#486605071">(Dec 06 2024 at 22:36)</a>:</h4>
<p>sunshowers submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9687#pullrequestreview-2486037105">PR review</a>.</p>



<a name="486605072"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239687%20%5Bdraft%5D%20show%20how%20Arc%3CMmap%3E%20would%20work/near/486605072" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239687.20.5Bdraft.5D.20show.20how.20Arc.3CMmap.3E.20would.20work.html#486605072">(Dec 06 2024 at 22:36)</a>:</h4>
<p>sunshowers created <a href="https://github.com/bytecodealliance/wasmtime/pull/9687#discussion_r1874073298">PR review comment</a>:</p>
<blockquote>
<p>Oh that's a good idea, similar to <code>MemoryPool</code>. I think it's correct.</p>
</blockquote>



<a name="486605322"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239687%20%5Bdraft%5D%20show%20how%20Arc%3CMmap%3E%20would%20work/near/486605322" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239687.20.5Bdraft.5D.20show.20how.20Arc.3CMmap.3E.20would.20work.html#486605322">(Dec 06 2024 at 22:38)</a>:</h4>
<p>sunshowers submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9687#pullrequestreview-2486047705">PR review</a>.</p>



<a name="486605324"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239687%20%5Bdraft%5D%20show%20how%20Arc%3CMmap%3E%20would%20work/near/486605324" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239687.20.5Bdraft.5D.20show.20how.20Arc.3CMmap.3E.20would.20work.html#486605324">(Dec 06 2024 at 22:38)</a>:</h4>
<p>sunshowers created <a href="https://github.com/bytecodealliance/wasmtime/pull/9687#discussion_r1874078582">PR review comment</a>:</p>
<blockquote>
<p>Oh actually there's another subtle issue here, I think if <code>slot.instantiate</code> below fails, we should clear on drop (that's part of the point of clear-on-drop, right?) So I think it would be best to make this change in a followup since it's a behavior change, not a refactor.</p>
</blockquote>



<a name="486605685"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239687%20%5Bdraft%5D%20show%20how%20Arc%3CMmap%3E%20would%20work/near/486605685" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239687.20.5Bdraft.5D.20show.20how.20Arc.3CMmap.3E.20would.20work.html#486605685">(Dec 06 2024 at 22:42)</a>:</h4>
<p>sunshowers updated <a href="https://github.com/bytecodealliance/wasmtime/pull/9687">PR #9687</a>.</p>



<a name="486605693"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239687%20%5Bdraft%5D%20show%20how%20Arc%3CMmap%3E%20would%20work/near/486605693" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239687.20.5Bdraft.5D.20show.20how.20Arc.3CMmap.3E.20would.20work.html#486605693">(Dec 06 2024 at 22:42)</a>:</h4>
<p><strong>sunshowers</strong> has marked <a href="https://github.com/bytecodealliance/wasmtime/pull/9687">PR #9687</a> as ready for review.</p>



<a name="486605696"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239687%20%5Bdraft%5D%20show%20how%20Arc%3CMmap%3E%20would%20work/near/486605696" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239687.20.5Bdraft.5D.20show.20how.20Arc.3CMmap.3E.20would.20work.html#486605696">(Dec 06 2024 at 22:42)</a>:</h4>
<p><strong>sunshowers</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/9687">PR #9687</a>.</p>



<a name="486605697"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239687%20%5Bdraft%5D%20show%20how%20Arc%3CMmap%3E%20would%20work/near/486605697" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239687.20.5Bdraft.5D.20show.20how.20Arc.3CMmap.3E.20would.20work.html#486605697">(Dec 06 2024 at 22:42)</a>:</h4>
<p><strong>sunshowers</strong> requested <a href="https://github.com/fitzgen">fitzgen</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/9687">PR #9687</a>.</p>



<a name="486605782"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239687%20%5Bdraft%5D%20show%20how%20Arc%3CMmap%3E%20would%20work/near/486605782" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239687.20.5Bdraft.5D.20show.20how.20Arc.3CMmap.3E.20would.20work.html#486605782">(Dec 06 2024 at 22:43)</a>:</h4>
<p>sunshowers submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9687#pullrequestreview-2486061910">PR review</a>.</p>



<a name="486605783"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239687%20%5Bdraft%5D%20show%20how%20Arc%3CMmap%3E%20would%20work/near/486605783" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239687.20.5Bdraft.5D.20show.20how.20Arc.3CMmap.3E.20would.20work.html#486605783">(Dec 06 2024 at 22:43)</a>:</h4>
<p>sunshowers created <a href="https://github.com/bytecodealliance/wasmtime/pull/9687#discussion_r1874084665">PR review comment</a>:</p>
<blockquote>
<p>I've expanded this comment -- it would definitely be good to move this to the destructor, but it would be a behavior change so it should be a followup. This PR itself should not contain any behavior changes.</p>
</blockquote>



<a name="486605903"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239687%20%5Bdraft%5D%20show%20how%20Arc%3CMmap%3E%20would%20work/near/486605903" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239687.20.5Bdraft.5D.20show.20how.20Arc.3CMmap.3E.20would.20work.html#486605903">(Dec 06 2024 at 22:44)</a>:</h4>
<p>sunshowers updated <a href="https://github.com/bytecodealliance/wasmtime/pull/9687">PR #9687</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>