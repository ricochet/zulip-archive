<html>
<head><meta charset="utf-8"><title>wasmtime / Issue #1763 Unable to run AssemblyScript WASI · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231763.20Unable.20to.20run.20AssemblyScript.20WASI.html">wasmtime / Issue #1763 Unable to run AssemblyScript WASI</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="198828987"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231763%20Unable%20to%20run%20AssemblyScript%20WASI/near/198828987" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231763.20Unable.20to.20run.20AssemblyScript.20WASI.html#198828987">(May 26 2020 at 22:23)</a>:</h4>
<p>okalousek opened <a href="https://github.com/bytecodealliance/wasmtime/issues/1763">Issue #1763</a>:</p>
<blockquote>
<p>I have tried some assemblyscript projects with WASI, but no one worked with wasmtime. All od these are working fine on wasmer. <br>
It showes me error with <em>something</em> Is not a function</p>
<p><a href="https://github.com/torch2424/wasm-matrix">https://github.com/torch2424/wasm-matrix</a> </p>
<p><a href="https://github.com/shonenada/hash-wasm">https://github.com/shonenada/hash-wasm</a> </p>
</blockquote>



<a name="198896217"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231763%20Unable%20to%20run%20AssemblyScript%20WASI/near/198896217" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231763.20Unable.20to.20run.20AssemblyScript.20WASI.html#198896217">(May 27 2020 at 14:13)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/1763#issuecomment-634688579">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/1763">Issue #1763</a>:</p>
<blockquote>
<p>Thanks for the report! Would you be able to provide us with some reproduction steps? For example what wasm modules were you working with? How did you execute them? (etc)</p>
</blockquote>



<a name="198946654"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231763%20Unable%20to%20run%20AssemblyScript%20WASI/near/198946654" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231763.20Unable.20to.20run.20AssemblyScript.20WASI.html#198946654">(May 27 2020 at 20:14)</a>:</h4>
<p>okalousek <a href="https://github.com/bytecodealliance/wasmtime/issues/1763#issuecomment-634914991">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/1763">Issue #1763</a>:</p>
<blockquote>
<p>Just downloaded these from issue links. Wasm-matrix have prebuild WASMs and hash-wasm i had to compile myself. I did not do anything special with compilation. Only runned build.</p>
</blockquote>



<a name="198946674"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231763%20Unable%20to%20run%20AssemblyScript%20WASI/near/198946674" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231763.20Unable.20to.20run.20AssemblyScript.20WASI.html#198946674">(May 27 2020 at 20:14)</a>:</h4>
<p>okalousek edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/1763#issuecomment-634914991">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/1763">Issue #1763</a>:</p>
<blockquote>
<p>Just downloaded these from issue links. Wasm-matrix have prebuild WASMs and hash-wasm i had to compile myself. I did not do anything special with compilation. Only runned build.<br>
I have executed by: wasmtime buildedname.wasm</p>
</blockquote>



<a name="198947576"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231763%20Unable%20to%20run%20AssemblyScript%20WASI/near/198947576" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231763.20Unable.20to.20run.20AssemblyScript.20WASI.html#198947576">(May 27 2020 at 20:21)</a>:</h4>
<p>sunfishcode <a href="https://github.com/bytecodealliance/wasmtime/issues/1763#issuecomment-634918396">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/1763">Issue #1763</a>:</p>
<blockquote>
<p>The "matrix" example is known to use ANSI-style escape codes to draw character graphics, and Wasmtime doesn't currently support this, because unrestricted use of ANSI-style escape codes creates a variety of security concerns (eg. <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-1000523">http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-1000523</a>). We are currently working on a design which allows us to support escape sequences while ensuring security.</p>
<p>Could you post the error message you see when you run hash-wasm?</p>
</blockquote>



<a name="198947869"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231763%20Unable%20to%20run%20AssemblyScript%20WASI/near/198947869" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231763.20Unable.20to.20run.20AssemblyScript.20WASI.html#198947869">(May 27 2020 at 20:23)</a>:</h4>
<p>okalousek <a href="https://github.com/bytecodealliance/wasmtime/issues/1763#issuecomment-634919325">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/1763">Issue #1763</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span><code>$ wasmtime hash.wasm
</code></pre></div>


<div class="codehilite"><pre><span></span><code>Error: failed to run main module `hash.wasm`

Caused by:
    0: failed to instantiate &quot;hash.wasm&quot;
    1: command export &#39;__rtti_base&#39; is not a function
</code></pre></div>


</blockquote>



<a name="199007525"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231763%20Unable%20to%20run%20AssemblyScript%20WASI/near/199007525" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231763.20Unable.20to.20run.20AssemblyScript.20WASI.html#199007525">(May 28 2020 at 10:58)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/issues/1763#issuecomment-635269793">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/1763">Issue #1763</a>:</p>
<blockquote>
<p><code>__rtti_base</code> is part of the <code>AssemblyScript</code> runtime. Wasmtime doesn't allow any exported globals other than a few specific ones:</p>
</blockquote>



<a name="199007534"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231763%20Unable%20to%20run%20AssemblyScript%20WASI/near/199007534" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231763.20Unable.20to.20run.20AssemblyScript.20WASI.html#199007534">(May 28 2020 at 10:58)</a>:</h4>
<p>bjorn3 edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/1763#issuecomment-635269793">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/1763">Issue #1763</a>:</p>
<blockquote>
<p><code>__rtti_base</code> is part of the <code>AssemblyScript</code> runtime. Wasmtime doesn't allow any exported globals other than a few specific ones:</p>
<p><a href="https://github.com/bytecodealliance/wasmtime/blob/3715e19c67ab7e59fadf750a1de2ba48f1e6f4ce/crates/wasmtime/src/linker.rs#L448">https://github.com/bytecodealliance/wasmtime/blob/3715e19c67ab7e59fadf750a1de2ba48f1e6f4ce/crates/wasmtime/src/linker.rs#L448</a></p>
</blockquote>



<a name="199056260"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231763%20Unable%20to%20run%20AssemblyScript%20WASI/near/199056260" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231763.20Unable.20to.20run.20AssemblyScript.20WASI.html#199056260">(May 28 2020 at 17:46)</a>:</h4>
<p>torch2424 <a href="https://github.com/bytecodealliance/wasmtime/issues/1763#issuecomment-635498208">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/1763">Issue #1763</a>:</p>
<blockquote>
<p>Hello! @pchickey brought this to my attention <span aria-label="smile" class="emoji emoji-263a" role="img" title="smile">:smile:</span> </p>
<p>@bjorn3 is correct in that looks like an export from AS runtime <span aria-label="smile" class="emoji emoji-263a" role="img" title="smile">:smile:</span> Though, If I understand correctly, a WASI module can have multiple exports correct? Is that a Wasmtime issue than?</p>
<p>@okalousek in the meantime, you could compile your AssemblyScript with <code>--runtime half</code>, as that <a href="https://docs.assemblyscript.org/details/runtime#runtime-variants">won't export anything that is from the runtime</a>.</p>
<p>And wasm-matrix is a really old AS WASI example of mine (it doesn't use the runtime, it uses the old allocators directly). I've been working on some WASI examples for WasmByExample. As the AS WASI story is a lot better now, especially in very recently released <code>0.10.0</code> <span aria-label="smile" class="emoji emoji-263a" role="img" title="smile">:smile:</span> </p>
</blockquote>



<a name="199057734"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231763%20Unable%20to%20run%20AssemblyScript%20WASI/near/199057734" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231763.20Unable.20to.20run.20AssemblyScript.20WASI.html#199057734">(May 28 2020 at 17:57)</a>:</h4>
<p>torch2424 <a href="https://github.com/bytecodealliance/wasmtime/issues/1763#issuecomment-635503924">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/1763">Issue #1763</a>:</p>
<blockquote>
<p>And I went ahead and made a quick hello world example: <a href="https://github.com/torch2424/as-playground/tree/master/wasi-hello-world">https://github.com/torch2424/as-playground/tree/master/wasi-hello-world</a> . Take a look at the <code>package.json</code>, it shows how I am using <code>--runtime half</code> with the compiler, to work around this for now. Also, I provided a binary as well @okalousek if you want to test it quickly <span aria-label="smile" class="emoji emoji-263a" role="img" title="smile">:smile:</span> </p>
</blockquote>



<a name="199103667"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231763%20Unable%20to%20run%20AssemblyScript%20WASI/near/199103667" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231763.20Unable.20to.20run.20AssemblyScript.20WASI.html#199103667">(May 29 2020 at 01:02)</a>:</h4>
<p>sunfishcode <a href="https://github.com/bytecodealliance/wasmtime/issues/1763#issuecomment-635696812">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/1763">Issue #1763</a>:</p>
<blockquote>
<p>AssemblyScript programs are now fixed, as of #1773. Use of <code>--runtime half</code> is recommended for command-style programs like this, though not strictly required (for now). Thanks for your help everyone!</p>
<p>I've also now collected the information here into a document showing how to run AssemblyScript programs in Wasmtime:</p>
<p><a href="https://bytecodealliance.github.io/wasmtime/wasm-assemblyscript.html">https://bytecodealliance.github.io/wasmtime/wasm-assemblyscript.html</a></p>
</blockquote>



<a name="199103669"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231763%20Unable%20to%20run%20AssemblyScript%20WASI/near/199103669" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231763.20Unable.20to.20run.20AssemblyScript.20WASI.html#199103669">(May 29 2020 at 01:02)</a>:</h4>
<p>sunfishcode closed <a href="https://github.com/bytecodealliance/wasmtime/issues/1763">Issue #1763</a>:</p>
<blockquote>
<p>I have tried some assemblyscript projects with WASI, but no one worked with wasmtime. All od these are working fine on wasmer. <br>
It showes me error with <em>something</em> Is not a function</p>
<p><a href="https://github.com/torch2424/wasm-matrix">https://github.com/torch2424/wasm-matrix</a> </p>
<p><a href="https://github.com/shonenada/hash-wasm">https://github.com/shonenada/hash-wasm</a> </p>
</blockquote>



<a name="199225294"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231763%20Unable%20to%20run%20AssemblyScript%20WASI/near/199225294" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231763.20Unable.20to.20run.20AssemblyScript.20WASI.html#199225294">(May 29 2020 at 23:44)</a>:</h4>
<p>torch2424 <a href="https://github.com/bytecodealliance/wasmtime/issues/1763#issuecomment-636238255">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/1763">Issue #1763</a>:</p>
<blockquote>
<p>Yay! Thank you @sunfishcode ! <span aria-label="smile" class="emoji emoji-263a" role="img" title="smile">:smile:</span> </p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>