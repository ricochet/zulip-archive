<html>
<head><meta charset="utf-8"><title>wasmtime / PR #2505 Fix a memory reservation bug in `rese... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232505.20Fix.20a.20memory.20reservation.20bug.20in.20.60rese.2E.2E.2E.html">wasmtime / PR #2505 Fix a memory reservation bug in `rese...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="219861330"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232505%20Fix%20a%20memory%20reservation%20bug%20in%20%60rese.../near/219861330" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232505.20Fix.20a.20memory.20reservation.20bug.20in.20.60rese.2E.2E.2E.html#219861330">(Dec 14 2020 at 16:00)</a>:</h4>
<p>alexcrichton opened <a href="https://github.com/bytecodealliance/wasmtime/pull/2505">PR #2505</a> from <code>fix-reserve-bug</code> to <code>main</code>:</p>
<blockquote>
<p>This method attempted to reserve space in the <code>results</code> list of final<br>
modules. Unfortunately <code>results.reserve(nmodules)</code> isn't enough here<br>
because this can be called many times before a module is actually<br>
finished and pushed onto the vector. The attempted logic to work around<br>
this was buggy, however, and would simply trigger geometric growth on<br>
every single reservation because it erroneously assumed that a<br>
reservation would be exactly met.</p>
<p>This is fixed by avoiding looking at the vector's capacity and instead<br>
keeping track of modules-to-be in a side field. This is the incremented<br>
and passed to <code>reserve</code> as it represents the number of modules that will<br>
eventually make their way into the result vector.</p>
</blockquote>



<a name="219880200"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232505%20Fix%20a%20memory%20reservation%20bug%20in%20%60rese.../near/219880200" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232505.20Fix.20a.20memory.20reservation.20bug.20in.20.60rese.2E.2E.2E.html#219880200">(Dec 14 2020 at 18:12)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2505#pullrequestreview-551753981">PR Review</a>.</p>



<a name="219880201"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232505%20Fix%20a%20memory%20reservation%20bug%20in%20%60rese.../near/219880201" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232505.20Fix.20a.20memory.20reservation.20bug.20in.20.60rese.2E.2E.2E.html#219880201">(Dec 14 2020 at 18:12)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2505#pullrequestreview-551753981">PR Review</a>.</p>



<a name="219880202"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232505%20Fix%20a%20memory%20reservation%20bug%20in%20%60rese.../near/219880202" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232505.20Fix.20a.20memory.20reservation.20bug.20in.20.60rese.2E.2E.2E.html#219880202">(Dec 14 2020 at 18:12)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/2505#discussion_r542598264">PR Review Comment</a>:</p>
<blockquote>
<p>lol this field name cracks me up</p>
</blockquote>



<a name="219880217"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232505%20Fix%20a%20memory%20reservation%20bug%20in%20%60rese.../near/219880217" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232505.20Fix.20a.20memory.20reservation.20bug.20in.20.60rese.2E.2E.2E.html#219880217">(Dec 14 2020 at 18:12)</a>:</h4>
<p>fitzgen merged <a href="https://github.com/bytecodealliance/wasmtime/pull/2505">PR #2505</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>