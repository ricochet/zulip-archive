<html>
<head><meta charset="utf-8"><title>wasmtime / PR #1825 Three fixes to various SpiderMonkey-r... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231825.20Three.20fixes.20to.20various.20SpiderMonkey-r.2E.2E.2E.html">wasmtime / PR #1825 Three fixes to various SpiderMonkey-r...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="199830446"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231825%20Three%20fixes%20to%20various%20SpiderMonkey-r.../near/199830446" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231825.20Three.20fixes.20to.20various.20SpiderMonkey-r.2E.2E.2E.html#199830446">(Jun 05 2020 at 02:22)</a>:</h4>
<p>cfallin opened <a href="https://github.com/bytecodealliance/wasmtime/pull/1825">PR #1825</a> from <code>spidermonkey-fixes</code> to <code>master</code>:</p>
<blockquote>
<ul>
<li>
<p>Properly mask constant values down to appropriate width when<br>
  generating a constant value directly in aarch64 backend. This was a<br>
  miscompilation introduced in the new-isel refactor. In combination<br>
  with failure to respect NarrowValueMode, this resulted in a very<br>
  subtle bug when an <code>i32</code> constant was used in bit-twiddling logic.</p>
</li>
<li>
<p>Add support for <code>iadd_ifcout</code> in aarch64 backend as used in explicit<br>
  heap-check mode. With this change, we no longer fail heap-related<br>
  tests with the huge-heap-region mode disabled.</p>
</li>
<li>
<p>Remove a panic that was occurring in some tests that are currently<br>
  ignored on aarch64, by simply returning empty/default information in<br>
<code>value_label</code> functionality rather than touching unimplemented APIs.<br>
  This is not a bugfix per-se, but removes confusing panic messages from<br>
<code>cargo test</code> output that might otherwise mislead.</p>
</li>
</ul>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
</blockquote>



<a name="199830448"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231825%20Three%20fixes%20to%20various%20SpiderMonkey-r.../near/199830448" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231825.20Three.20fixes.20to.20various.20SpiderMonkey-r.2E.2E.2E.html#199830448">(Jun 05 2020 at 02:22)</a>:</h4>
<p><strong>cfallin</strong> requested <a href="https://github.com/bnjbvr">bnjbvr</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/1825">PR #1825</a>.</p>



<a name="199941383"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231825%20Three%20fixes%20to%20various%20SpiderMonkey-r.../near/199941383" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231825.20Three.20fixes.20to.20various.20SpiderMonkey-r.2E.2E.2E.html#199941383">(Jun 05 2020 at 22:34)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1825">PR #1825</a> from <code>spidermonkey-fixes</code> to <code>master</code>:</p>
<blockquote>
<ul>
<li>
<p>Properly mask constant values down to appropriate width when<br>
  generating a constant value directly in aarch64 backend. This was a<br>
  miscompilation introduced in the new-isel refactor. In combination<br>
  with failure to respect NarrowValueMode, this resulted in a very<br>
  subtle bug when an <code>i32</code> constant was used in bit-twiddling logic.</p>
</li>
<li>
<p>Add support for <code>iadd_ifcout</code> in aarch64 backend as used in explicit<br>
  heap-check mode. With this change, we no longer fail heap-related<br>
  tests with the huge-heap-region mode disabled.</p>
</li>
<li>
<p>Remove a panic that was occurring in some tests that are currently<br>
  ignored on aarch64, by simply returning empty/default information in<br>
<code>value_label</code> functionality rather than touching unimplemented APIs.<br>
  This is not a bugfix per-se, but removes confusing panic messages from<br>
<code>cargo test</code> output that might otherwise mislead.</p>
</li>
</ul>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
</blockquote>



<a name="199943928"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231825%20Three%20fixes%20to%20various%20SpiderMonkey-r.../near/199943928" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231825.20Three.20fixes.20to.20various.20SpiderMonkey-r.2E.2E.2E.html#199943928">(Jun 05 2020 at 23:12)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1825">PR #1825</a> from <code>spidermonkey-fixes</code> to <code>master</code>:</p>
<blockquote>
<ul>
<li>
<p>Properly mask constant values down to appropriate width when<br>
  generating a constant value directly in aarch64 backend. This was a<br>
  miscompilation introduced in the new-isel refactor. In combination<br>
  with failure to respect NarrowValueMode, this resulted in a very<br>
  subtle bug when an <code>i32</code> constant was used in bit-twiddling logic.</p>
</li>
<li>
<p>Add support for <code>iadd_ifcout</code> in aarch64 backend as used in explicit<br>
  heap-check mode. With this change, we no longer fail heap-related<br>
  tests with the huge-heap-region mode disabled.</p>
</li>
<li>
<p>Remove a panic that was occurring in some tests that are currently<br>
  ignored on aarch64, by simply returning empty/default information in<br>
<code>value_label</code> functionality rather than touching unimplemented APIs.<br>
  This is not a bugfix per-se, but removes confusing panic messages from<br>
<code>cargo test</code> output that might otherwise mislead.</p>
</li>
</ul>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
</blockquote>



<a name="199947934"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231825%20Three%20fixes%20to%20various%20SpiderMonkey-r.../near/199947934" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231825.20Three.20fixes.20to.20various.20SpiderMonkey-r.2E.2E.2E.html#199947934">(Jun 06 2020 at 00:30)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1825">PR #1825</a> from <code>spidermonkey-fixes</code> to <code>master</code>:</p>
<blockquote>
<ul>
<li>
<p>Properly mask constant values down to appropriate width when<br>
  generating a constant value directly in aarch64 backend. This was a<br>
  miscompilation introduced in the new-isel refactor. In combination<br>
  with failure to respect NarrowValueMode, this resulted in a very<br>
  subtle bug when an <code>i32</code> constant was used in bit-twiddling logic.</p>
</li>
<li>
<p>Add support for <code>iadd_ifcout</code> in aarch64 backend as used in explicit<br>
  heap-check mode. With this change, we no longer fail heap-related<br>
  tests with the huge-heap-region mode disabled.</p>
</li>
<li>
<p>Remove a panic that was occurring in some tests that are currently<br>
  ignored on aarch64, by simply returning empty/default information in<br>
<code>value_label</code> functionality rather than touching unimplemented APIs.<br>
  This is not a bugfix per-se, but removes confusing panic messages from<br>
<code>cargo test</code> output that might otherwise mislead.</p>
</li>
</ul>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
</blockquote>



<a name="200125212"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231825%20Three%20fixes%20to%20various%20SpiderMonkey-r.../near/200125212" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231825.20Three.20fixes.20to.20various.20SpiderMonkey-r.2E.2E.2E.html#200125212">(Jun 08 2020 at 16:47)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1825#pullrequestreview-426399120">PR Review</a>.</p>



<a name="200125213"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231825%20Three%20fixes%20to%20various%20SpiderMonkey-r.../near/200125213" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231825.20Three.20fixes.20to.20various.20SpiderMonkey-r.2E.2E.2E.html#200125213">(Jun 08 2020 at 16:47)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/1825#discussion_r436827556">PR Review Comment</a>:</p>
<blockquote>
<p>nit: corresponds</p>
</blockquote>



<a name="200125214"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231825%20Three%20fixes%20to%20various%20SpiderMonkey-r.../near/200125214" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231825.20Three.20fixes.20to.20various.20SpiderMonkey-r.2E.2E.2E.html#200125214">(Jun 08 2020 at 16:47)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1825#pullrequestreview-426399120">PR Review</a>.</p>



<a name="200125215"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231825%20Three%20fixes%20to%20various%20SpiderMonkey-r.../near/200125215" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231825.20Three.20fixes.20to.20various.20SpiderMonkey-r.2E.2E.2E.html#200125215">(Jun 08 2020 at 16:47)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/1825#discussion_r436829507">PR Review Comment</a>:</p>
<blockquote>
<p>nit: corresponds</p>
</blockquote>



<a name="200125216"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231825%20Three%20fixes%20to%20various%20SpiderMonkey-r.../near/200125216" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231825.20Three.20fixes.20to.20various.20SpiderMonkey-r.2E.2E.2E.html#200125216">(Jun 08 2020 at 16:47)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/1825#discussion_r436840513">PR Review Comment</a>:</p>
<blockquote>
<p>It was UnsignedLessThan in the old backend's code; was this a preexisting bug, or is this a bad copy-pasto? I'm not sure it's quite easy to test right now, because there's no support for x86-64 in Spidermonkey, and I'm convinced it's testable with Cranelift's old x86 backend in Spidermonkey.</p>
</blockquote>



<a name="200148817"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231825%20Three%20fixes%20to%20various%20SpiderMonkey-r.../near/200148817" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231825.20Three.20fixes.20to.20various.20SpiderMonkey-r.2E.2E.2E.html#200148817">(Jun 08 2020 at 20:02)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1825">PR #1825</a> from <code>spidermonkey-fixes</code> to <code>master</code>:</p>
<blockquote>
<ul>
<li>
<p>Properly mask constant values down to appropriate width when<br>
  generating a constant value directly in aarch64 backend. This was a<br>
  miscompilation introduced in the new-isel refactor. In combination<br>
  with failure to respect NarrowValueMode, this resulted in a very<br>
  subtle bug when an <code>i32</code> constant was used in bit-twiddling logic.</p>
</li>
<li>
<p>Add support for <code>iadd_ifcout</code> in aarch64 backend as used in explicit<br>
  heap-check mode. With this change, we no longer fail heap-related<br>
  tests with the huge-heap-region mode disabled.</p>
</li>
<li>
<p>Remove a panic that was occurring in some tests that are currently<br>
  ignored on aarch64, by simply returning empty/default information in<br>
<code>value_label</code> functionality rather than touching unimplemented APIs.<br>
  This is not a bugfix per-se, but removes confusing panic messages from<br>
<code>cargo test</code> output that might otherwise mislead.</p>
</li>
</ul>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
</blockquote>



<a name="200148966"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231825%20Three%20fixes%20to%20various%20SpiderMonkey-r.../near/200148966" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231825.20Three.20fixes.20to.20various.20SpiderMonkey-r.2E.2E.2E.html#200148966">(Jun 08 2020 at 20:03)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1825#pullrequestreview-426577952">PR Review</a>.</p>



<a name="200148967"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231825%20Three%20fixes%20to%20various%20SpiderMonkey-r.../near/200148967" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231825.20Three.20fixes.20to.20various.20SpiderMonkey-r.2E.2E.2E.html#200148967">(Jun 08 2020 at 20:03)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1825#discussion_r436967631">PR Review Comment</a>:</p>
<blockquote>
<p>It's unclear to me why it was the way it was; but with the way that things are lowered now, it should be <code>&gt;=</code>, as far as I can tell. The documentation for the underlying trait method this fulfills (on <code>TargetIsa</code>) says that it is the condition that should be triggered when an add overflows; and that's definitely carry-flag-set on x86 (and aarch64). In any case we will want to carefully check this when we build out the new x86-64 backend.</p>
</blockquote>



<a name="200154730"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231825%20Three%20fixes%20to%20various%20SpiderMonkey-r.../near/200154730" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231825.20Three.20fixes.20to.20various.20SpiderMonkey-r.2E.2E.2E.html#200154730">(Jun 08 2020 at 20:54)</a>:</h4>
<p>cfallin merged <a href="https://github.com/bytecodealliance/wasmtime/pull/1825">PR #1825</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>