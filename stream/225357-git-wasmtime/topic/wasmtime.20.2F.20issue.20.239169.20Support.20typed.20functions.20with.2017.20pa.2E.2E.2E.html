<html>
<head><meta charset="utf-8"><title>wasmtime / issue #9169 Support typed functions with 17 pa... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239169.20Support.20typed.20functions.20with.2017.20pa.2E.2E.2E.html">wasmtime / issue #9169 Support typed functions with 17 pa...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="464715136"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239169%20Support%20typed%20functions%20with%2017%20pa.../near/464715136" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239169.20Support.20typed.20functions.20with.2017.20pa.2E.2E.2E.html#464715136">(Aug 23 2024 at 18:23)</a>:</h4>
<p>jvff opened <a href="https://github.com/bytecodealliance/wasmtime/issues/9169">issue #9169</a>:</p>
<blockquote>
<h4>Feature</h4>
<p><a href="https://docs.rs/wasmtime/24.0.0/wasmtime/trait.WasmParams.html"><code>WasmParams</code> currently supports tuples with up to 16 elements</a>. However, <code>wit-bindgen</code> may generate imports for functions with up to 17 parameters, in scenarios where there are 16 flat types used for parameters plus an extra pointer for the return heap area. This is (AFAICT) according to the <a href="https://github.com/WebAssembly/component-model/blob/main/design/mvp/CanonicalABI.md#flattening">Canonical ABI</a>.</p>
<h4>Benefit</h4>
<p>This would allow using proper typing when exporting functions to Wasm modules following the WIT interface.</p>
<h4>Implementation</h4>
<p>I tested adding another line here:</p>
<p><a href="https://github.com/bytecodealliance/wasmtime/blob/main/crates/wasmtime/src/runtime/func.rs#L356">https://github.com/bytecodealliance/wasmtime/blob/main/crates/wasmtime/src/runtime/func.rs#L356</a></p>
<p>and it seemed to work for my use case. I'm not sure if there are tests that need to be updated or if there's a better approach before opening a PR.</p>
<h4>Alternatives</h4>
<p>I think this could be worked around by not using typed parameters.<br>
</p>
</blockquote>



<a name="464729127"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239169%20Support%20typed%20functions%20with%2017%20pa.../near/464729127" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239169.20Support.20typed.20functions.20with.2017.20pa.2E.2E.2E.html#464729127">(Aug 23 2024 at 19:35)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/9169#issuecomment-2307700413">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9169">issue #9169</a>:</p>
<blockquote>
<p>Makes sense to me to add, feel free to send a PR!</p>
</blockquote>



<a name="464734143"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239169%20Support%20typed%20functions%20with%2017%20pa.../near/464734143" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239169.20Support.20typed.20functions.20with.2017.20pa.2E.2E.2E.html#464734143">(Aug 23 2024 at 20:02)</a>:</h4>
<p>alexcrichton closed <a href="https://github.com/bytecodealliance/wasmtime/issues/9169">issue #9169</a>:</p>
<blockquote>
<h4>Feature</h4>
<p><a href="https://docs.rs/wasmtime/24.0.0/wasmtime/trait.WasmParams.html"><code>WasmParams</code> currently supports tuples with up to 16 elements</a>. However, <code>wit-bindgen</code> may generate imports for functions with up to 17 parameters, in scenarios where there are 16 flat types used for parameters plus an extra pointer for the return heap area. This is (AFAICT) according to the <a href="https://github.com/WebAssembly/component-model/blob/main/design/mvp/CanonicalABI.md#flattening">Canonical ABI</a>.</p>
<h4>Benefit</h4>
<p>This would allow using proper typing when exporting functions to Wasm modules following the WIT interface.</p>
<h4>Implementation</h4>
<p>I tested adding another line here:</p>
<p><a href="https://github.com/bytecodealliance/wasmtime/blob/main/crates/wasmtime/src/runtime/func.rs#L356">https://github.com/bytecodealliance/wasmtime/blob/main/crates/wasmtime/src/runtime/func.rs#L356</a></p>
<p>and it seemed to work for my use case. I'm not sure if there are tests that need to be updated or if there's a better approach before opening a PR.</p>
<h4>Alternatives</h4>
<p>I think this could be worked around by not using typed parameters.<br>
</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>