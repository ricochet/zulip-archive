<html>
<head><meta charset="utf-8"><title>wasmtime / PR #9356 Allow alignments that eat the remaini... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239356.20Allow.20alignments.20that.20eat.20the.20remaini.2E.2E.2E.html">wasmtime / PR #9356 Allow alignments that eat the remaini...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="474128560"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239356%20Allow%20alignments%20that%20eat%20the%20remaini.../near/474128560" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239356.20Allow.20alignments.20that.20eat.20the.20remaini.2E.2E.2E.html#474128560">(Oct 01 2024 at 21:10)</a>:</h4>
<p>elliottt opened <a href="https://github.com/bytecodealliance/wasmtime/pull/9356">PR #9356</a> from <code>elliottt:trevor/null-allocation-adapter</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>The preview1 adapter has an implementation of cabi_realloc that facilitates calling component imports that return dynamically allocated results, like lists and strings. However, when returning a zero-length value to a buffer that's been allocated with zero bytes available, a trap will occur. This is because the alignment check requires that there is space left over after alignment has been added to the base pointer, which in the case of an empty buffer, will not be possible.</p>
<p>This PR fixes the issue by relaxing the alignment check to require that the amount required to align the base does not exceed the length of the buffer, but may consume the entire allocation.<br>
</p>
</blockquote>



<a name="474128561"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239356%20Allow%20alignments%20that%20eat%20the%20remaini.../near/474128561" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239356.20Allow.20alignments.20that.20eat.20the.20remaini.2E.2E.2E.html#474128561">(Oct 01 2024 at 21:10)</a>:</h4>
<p><strong>elliottt</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/9356">PR #9356</a>.</p>



<a name="474128562"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239356%20Allow%20alignments%20that%20eat%20the%20remaini.../near/474128562" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239356.20Allow.20alignments.20that.20eat.20the.20remaini.2E.2E.2E.html#474128562">(Oct 01 2024 at 21:10)</a>:</h4>
<p><strong>elliottt</strong> requested <a href="https://github.com/fitzgen">fitzgen</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/9356">PR #9356</a>.</p>



<a name="474128578"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239356%20Allow%20alignments%20that%20eat%20the%20remaini.../near/474128578" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239356.20Allow.20alignments.20that.20eat.20the.20remaini.2E.2E.2E.html#474128578">(Oct 01 2024 at 21:10)</a>:</h4>
<p><strong>elliottt</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/9356">PR #9356</a>.</p>



<a name="474130160"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239356%20Allow%20alignments%20that%20eat%20the%20remaini.../near/474130160" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239356.20Allow.20alignments.20that.20eat.20the.20remaini.2E.2E.2E.html#474130160">(Oct 01 2024 at 21:24)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/9356#issuecomment-2387102018">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/9356">PR #9356</a>:</p>
<blockquote>
<p>Would it be possible to add a test for this as well? Or is that out-of-scope in the WASI APIs we have bound?</p>
</blockquote>



<a name="474139075"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239356%20Allow%20alignments%20that%20eat%20the%20remaini.../near/474139075" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239356.20Allow.20alignments.20that.20eat.20the.20remaini.2E.2E.2E.html#474139075">(Oct 01 2024 at 22:34)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9356#pullrequestreview-2341577704">PR review</a>.</p>



<a name="474147261"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239356%20Allow%20alignments%20that%20eat%20the%20remaini.../near/474147261" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239356.20Allow.20alignments.20that.20eat.20the.20remaini.2E.2E.2E.html#474147261">(Oct 01 2024 at 23:47)</a>:</h4>
<p>elliottt updated <a href="https://github.com/bytecodealliance/wasmtime/pull/9356">PR #9356</a>.</p>



<a name="474147318"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239356%20Allow%20alignments%20that%20eat%20the%20remaini.../near/474147318" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239356.20Allow.20alignments.20that.20eat.20the.20remaini.2E.2E.2E.html#474147318">(Oct 01 2024 at 23:48)</a>:</h4>
<p>elliottt updated <a href="https://github.com/bytecodealliance/wasmtime/pull/9356">PR #9356</a>.</p>



<a name="474148852"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239356%20Allow%20alignments%20that%20eat%20the%20remaini.../near/474148852" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239356.20Allow.20alignments.20that.20eat.20the.20remaini.2E.2E.2E.html#474148852">(Oct 01 2024 at 23:56)</a>:</h4>
<p>elliottt <a href="https://github.com/bytecodealliance/wasmtime/pull/9356#issuecomment-2387283724">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/9356">PR #9356</a>:</p>
<blockquote>
<blockquote>
<p>Would it be possible to add a test for this as well? Or is that out-of-scope in the WASI APIs we have bound?</p>
</blockquote>
<p>The test added fails when the change to the <code>align_to</code> function is reverted, triggering the original issue in the adapter.</p>
</blockquote>



<a name="474150457"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239356%20Allow%20alignments%20that%20eat%20the%20remaini.../near/474150457" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239356.20Allow.20alignments.20that.20eat.20the.20remaini.2E.2E.2E.html#474150457">(Oct 02 2024 at 00:13)</a>:</h4>
<p>elliottt merged <a href="https://github.com/bytecodealliance/wasmtime/pull/9356">PR #9356</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>