<html>
<head><meta charset="utf-8"><title>wasmtime / PR #5535 Treat `wasmtime::component::Val::Floa... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235535.20Treat.20.60wasmtime.3A.3Acomponent.3A.3AVal.3A.3AFloa.2E.2E.2E.html">wasmtime / PR #5535 Treat `wasmtime::component::Val::Floa...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="319679678"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235535%20Treat%20%60wasmtime%3A%3Acomponent%3A%3AVal%3A%3AFloa.../near/319679678" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235535.20Treat.20.60wasmtime.3A.3Acomponent.3A.3AVal.3A.3AFloa.2E.2E.2E.html#319679678">(Jan 05 2023 at 21:56)</a>:</h4>
<p>lann opened <a href="https://github.com/bytecodealliance/wasmtime/pull/5535">PR #5535</a> from <code>val-float-nan-equality</code> to <code>main</code>:</p>
<blockquote>
<p>In #5510 we changed the value types of these variants from u{32,64} to f{32,64}. One side effect of this change was that two NaN values would no longer compare equal. While this is behavior complies with IEEE-754 floating point operations, it broke equality assumptions in fuzzing.</p>
<p>This commit changes equality for Val to make NaNs compare equal. Since the component model requires NaN canonicalization, all NaN bit representations compare equal, which is different from the original behavior.</p>
<p>This also gives Vals the semantics of Eq again, so that trait impl has been reintroduced to related types as well.</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;<br>
</p>
</blockquote>



<a name="319680386"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235535%20Treat%20%60wasmtime%3A%3Acomponent%3A%3AVal%3A%3AFloa.../near/319680386" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235535.20Treat.20.60wasmtime.3A.3Acomponent.3A.3AVal.3A.3AFloa.2E.2E.2E.html#319680386">(Jan 05 2023 at 22:00)</a>:</h4>
<p>lann updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5535">PR #5535</a> from <code>val-float-nan-equality</code> to <code>main</code>.</p>



<a name="319680396"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235535%20Treat%20%60wasmtime%3A%3Acomponent%3A%3AVal%3A%3AFloa.../near/319680396" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235535.20Treat.20.60wasmtime.3A.3Acomponent.3A.3AVal.3A.3AFloa.2E.2E.2E.html#319680396">(Jan 05 2023 at 22:01)</a>:</h4>
<p>lann edited <a href="https://github.com/bytecodealliance/wasmtime/pull/5535">PR #5535</a> from <code>val-float-nan-equality</code> to <code>main</code>:</p>
<blockquote>
<p>In #5510 we changed the value types of these variants from u{32,64} to f{32,64}. One side effect of this change was that two NaN values would no longer compare equal. While this is behavior complies with IEEE-754 floating point operations, it broke equality assumptions in fuzzing.</p>
<p>This commit changes equality for Val to make NaNs compare equal. Since the component model requires NaN canonicalization, all NaN bit representations compare equal, which is different from the original behavior.</p>
<p>This also gives Vals the semantics of Eq again, so that trait impl has been reintroduced to related types as well.</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;<br>
</p>
</blockquote>



<a name="319788493"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235535%20Treat%20%60wasmtime%3A%3Acomponent%3A%3AVal%3A%3AFloa.../near/319788493" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235535.20Treat.20.60wasmtime.3A.3Acomponent.3A.3AVal.3A.3AFloa.2E.2E.2E.html#319788493">(Jan 06 2023 at 14:11)</a>:</h4>
<p>lann updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5535">PR #5535</a> from <code>val-float-nan-equality</code> to <code>main</code>.</p>



<a name="319817269"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235535%20Treat%20%60wasmtime%3A%3Acomponent%3A%3AVal%3A%3AFloa.../near/319817269" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235535.20Treat.20.60wasmtime.3A.3Acomponent.3A.3AVal.3A.3AFloa.2E.2E.2E.html#319817269">(Jan 06 2023 at 16:40)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5535#pullrequestreview-1239091496">PR review</a>.</p>



<a name="319817286"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235535%20Treat%20%60wasmtime%3A%3Acomponent%3A%3AVal%3A%3AFloa.../near/319817286" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235535.20Treat.20.60wasmtime.3A.3Acomponent.3A.3AVal.3A.3AFloa.2E.2E.2E.html#319817286">(Jan 06 2023 at 16:40)</a>:</h4>
<p>alexcrichton merged <a href="https://github.com/bytecodealliance/wasmtime/pull/5535">PR #5535</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>