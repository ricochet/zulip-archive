<html>
<head><meta charset="utf-8"><title>wasmtime / issue #5815 fuzzgen: Fuzz different calling co... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235815.20fuzzgen.3A.20Fuzz.20different.20calling.20co.2E.2E.2E.html">wasmtime / issue #5815 fuzzgen: Fuzz different calling co...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="328466392"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235815%20fuzzgen%3A%20Fuzz%20different%20calling%20co.../near/328466392" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235815.20fuzzgen.3A.20Fuzz.20different.20calling.20co.2E.2E.2E.html#328466392">(Feb 17 2023 at 13:11)</a>:</h4>
<p>afonso360 opened <a href="https://github.com/bytecodealliance/wasmtime/issues/5815">issue #5815</a>:</p>
<blockquote>
<p><span aria-label="wave" class="emoji emoji-1f44b" role="img" title="wave">:wave:</span> Hey</p>
<h4>Feature</h4>
<p>Our <a href="https://github.com/bytecodealliance/wasmtime/tree/main/cranelift/fuzzgen"><code>cranelift-fuzzgen</code></a> fuzzer currently <a href="https://github.com/bytecodealliance/wasmtime/blob/db9efcb099e07dbb3b433668a5404deefc0eb709/cranelift/fuzzgen/src/function_generator.rs#L1376-L1379">always uses the <code>system_v</code> calling convention</a> on all functions.</p>
<p>We should change this so that we can explore other calling conventions!</p>
<h4>Benefit</h4>
<p>This increases coverage for the cranelift fuzzers. The cranelift fuzzer can reach a bit further into the ABI code since it generates a broader number of types (i.e. I8/I16/I128).</p>
<h4>Implementation</h4>
<p>We now have a <code>Target</code> in the <code>FunctionGenerator</code> so we can make decisions based on that. </p>
<p>We have a number of calling conventions that are applicable to <em>all</em> <code>Targets</code> such as <code>SystemV</code>/<code>Cold</code>/<code>Fast</code>, those are always available to be selected. But there are some that should be somewhat restricted such as <code>AppleAarch64</code> which we should only select on <code>aarch64</code> and <code>macosx</code>.</p>
<h4>Alternatives</h4>
<p>Some of these calling conventions are already fuzzed via the wasmtime fuzzers, so we could keep relying on that.<br>
</p>
</blockquote>



<a name="328466393"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235815%20fuzzgen%3A%20Fuzz%20different%20calling%20co.../near/328466393" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235815.20fuzzgen.3A.20Fuzz.20different.20calling.20co.2E.2E.2E.html#328466393">(Feb 17 2023 at 13:11)</a>:</h4>
<p>afonso360 labeled <a href="https://github.com/bytecodealliance/wasmtime/issues/5815">issue #5815</a>:</p>
<blockquote>
<p><span aria-label="wave" class="emoji emoji-1f44b" role="img" title="wave">:wave:</span> Hey</p>
<h4>Feature</h4>
<p>Our <a href="https://github.com/bytecodealliance/wasmtime/tree/main/cranelift/fuzzgen"><code>cranelift-fuzzgen</code></a> fuzzer currently <a href="https://github.com/bytecodealliance/wasmtime/blob/db9efcb099e07dbb3b433668a5404deefc0eb709/cranelift/fuzzgen/src/function_generator.rs#L1376-L1379">always uses the <code>system_v</code> calling convention</a> on all functions.</p>
<p>We should change this so that we can explore other calling conventions!</p>
<h4>Benefit</h4>
<p>This increases coverage for the cranelift fuzzers. The cranelift fuzzer can reach a bit further into the ABI code since it generates a broader number of types (i.e. I8/I16/I128).</p>
<h4>Implementation</h4>
<p>We now have a <code>Target</code> in the <code>FunctionGenerator</code> so we can make decisions based on that. </p>
<p>We have a number of calling conventions that are applicable to <em>all</em> <code>Targets</code> such as <code>SystemV</code>/<code>Cold</code>/<code>Fast</code>, those are always available to be selected. But there are some that should be somewhat restricted such as <code>AppleAarch64</code> which we should only select on <code>aarch64</code> and <code>macosx</code>.</p>
<h4>Alternatives</h4>
<p>Some of these calling conventions are already fuzzed via the wasmtime fuzzers, so we could keep relying on that.<br>
</p>
</blockquote>



<a name="328466394"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235815%20fuzzgen%3A%20Fuzz%20different%20calling%20co.../near/328466394" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235815.20fuzzgen.3A.20Fuzz.20different.20calling.20co.2E.2E.2E.html#328466394">(Feb 17 2023 at 13:11)</a>:</h4>
<p>afonso360 labeled <a href="https://github.com/bytecodealliance/wasmtime/issues/5815">issue #5815</a>:</p>
<blockquote>
<p><span aria-label="wave" class="emoji emoji-1f44b" role="img" title="wave">:wave:</span> Hey</p>
<h4>Feature</h4>
<p>Our <a href="https://github.com/bytecodealliance/wasmtime/tree/main/cranelift/fuzzgen"><code>cranelift-fuzzgen</code></a> fuzzer currently <a href="https://github.com/bytecodealliance/wasmtime/blob/db9efcb099e07dbb3b433668a5404deefc0eb709/cranelift/fuzzgen/src/function_generator.rs#L1376-L1379">always uses the <code>system_v</code> calling convention</a> on all functions.</p>
<p>We should change this so that we can explore other calling conventions!</p>
<h4>Benefit</h4>
<p>This increases coverage for the cranelift fuzzers. The cranelift fuzzer can reach a bit further into the ABI code since it generates a broader number of types (i.e. I8/I16/I128).</p>
<h4>Implementation</h4>
<p>We now have a <code>Target</code> in the <code>FunctionGenerator</code> so we can make decisions based on that. </p>
<p>We have a number of calling conventions that are applicable to <em>all</em> <code>Targets</code> such as <code>SystemV</code>/<code>Cold</code>/<code>Fast</code>, those are always available to be selected. But there are some that should be somewhat restricted such as <code>AppleAarch64</code> which we should only select on <code>aarch64</code> and <code>macosx</code>.</p>
<h4>Alternatives</h4>
<p>Some of these calling conventions are already fuzzed via the wasmtime fuzzers, so we could keep relying on that.<br>
</p>
</blockquote>



<a name="328466537"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235815%20fuzzgen%3A%20Fuzz%20different%20calling%20co.../near/328466537" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235815.20fuzzgen.3A.20Fuzz.20different.20calling.20co.2E.2E.2E.html#328466537">(Feb 17 2023 at 13:12)</a>:</h4>
<p>afonso360 edited <a href="https://github.com/bytecodealliance/wasmtime/issues/5815">issue #5815</a>:</p>
<blockquote>
<p><span aria-label="wave" class="emoji emoji-1f44b" role="img" title="wave">:wave:</span> Hey</p>
<h4>Feature</h4>
<p>Our <a href="https://github.com/bytecodealliance/wasmtime/tree/main/cranelift/fuzzgen"><code>cranelift-fuzzgen</code></a> fuzzer currently <a href="https://github.com/bytecodealliance/wasmtime/blob/db9efcb099e07dbb3b433668a5404deefc0eb709/cranelift/fuzzgen/src/function_generator.rs#L1376-L1379">always uses the <code>system_v</code> calling convention</a> on all functions.</p>
<p>We should change this so that we can explore other calling conventions!</p>
<h4>Benefit</h4>
<p>This increases coverage for the cranelift fuzzers. The cranelift fuzzer can reach a bit further into the ABI code since it generates a broader number of types (i.e. I8/I16/I128).</p>
<h4>Implementation</h4>
<p>We now have a <code>Target</code> in the <code>FunctionGenerator</code> so we can make decisions based on that. </p>
<p>We have a number of calling conventions that are applicable to <em>all</em> <code>Targets</code> such as <code>SystemV</code>/<code>Cold</code>/<code>Fast</code>, those are always available to be selected. But there are some that should be somewhat restricted such as <code>AppleAarch64</code> which we should only select on <code>aarch64</code> and <code>macosx</code>.</p>
<p>If anyone would like to take this on and needs some further help/clarification let me know!</p>
<h4>Alternatives</h4>
<p>Some of these calling conventions are already fuzzed via the wasmtime fuzzers, so we could keep relying on that.<br>
</p>
</blockquote>



<a name="328556310"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235815%20fuzzgen%3A%20Fuzz%20different%20calling%20co.../near/328556310" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235815.20fuzzgen.3A.20Fuzz.20different.20calling.20co.2E.2E.2E.html#328556310">(Feb 17 2023 at 20:20)</a>:</h4>
<p>jameysharp labeled <a href="https://github.com/bytecodealliance/wasmtime/issues/5815">issue #5815</a>:</p>
<blockquote>
<p><span aria-label="wave" class="emoji emoji-1f44b" role="img" title="wave">:wave:</span> Hey</p>
<h4>Feature</h4>
<p>Our <a href="https://github.com/bytecodealliance/wasmtime/tree/main/cranelift/fuzzgen"><code>cranelift-fuzzgen</code></a> fuzzer currently <a href="https://github.com/bytecodealliance/wasmtime/blob/db9efcb099e07dbb3b433668a5404deefc0eb709/cranelift/fuzzgen/src/function_generator.rs#L1376-L1379">always uses the <code>system_v</code> calling convention</a> on all functions.</p>
<p>We should change this so that we can explore other calling conventions!</p>
<h4>Benefit</h4>
<p>This increases coverage for the cranelift fuzzers. The cranelift fuzzer can reach a bit further into the ABI code since it generates a broader number of types (i.e. I8/I16/I128).</p>
<h4>Implementation</h4>
<p>We now have a <code>Target</code> in the <code>FunctionGenerator</code> so we can make decisions based on that. </p>
<p>We have a number of calling conventions that are applicable to <em>all</em> <code>Targets</code> such as <code>SystemV</code>/<code>Cold</code>/<code>Fast</code>, those are always available to be selected. But there are some that should be somewhat restricted such as <code>AppleAarch64</code> which we should only select on <code>aarch64</code> and <code>macosx</code>.</p>
<p>If anyone would like to take this on and needs some further help/clarification let me know!</p>
<h4>Alternatives</h4>
<p>Some of these calling conventions are already fuzzed via the wasmtime fuzzers, so we could keep relying on that.<br>
</p>
</blockquote>



<a name="366941531"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235815%20fuzzgen%3A%20Fuzz%20different%20calling%20co.../near/366941531" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235815.20fuzzgen.3A.20Fuzz.20different.20calling.20co.2E.2E.2E.html#366941531">(Jun 16 2023 at 20:35)</a>:</h4>
<p>littlebenlittle <a href="https://github.com/bytecodealliance/wasmtime/issues/5815#issuecomment-1595279831">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/5815">issue #5815</a>:</p>
<blockquote>
<p>Started a PR for this. Are there any calling conventions other than <code>AppleAarch64</code> that should be contextually supported based on target triple?</p>
<p>Also I'm not sure if generators should be zero-allocation for efficiency.</p>
</blockquote>



<a name="367020721"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235815%20fuzzgen%3A%20Fuzz%20different%20calling%20co.../near/367020721" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235815.20fuzzgen.3A.20Fuzz.20different.20calling.20co.2E.2E.2E.html#367020721">(Jun 16 2023 at 23:21)</a>:</h4>
<p>jameysharp <a href="https://github.com/bytecodealliance/wasmtime/issues/5815#issuecomment-1595462715">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/5815">issue #5815</a>:</p>
<blockquote>
<p>I think this might have actually been fixed already, by #6579, which just merged a couple of days ago.</p>
<p>I'm a little confused about the state of this issue though. There are two places we pick calling conventions in fuzzgen right now. #6579 only changed one of them, and your PR #6594 changes the other. But I think maybe we can't actually change the latter place without breaking things.</p>
<p>Specifically, your PR extends <code>FunctionGenerator::system_callconv</code>, which is only used to decide how to call libcalls. If I'm not mistaken, these libcalls are provided by libc, so they use the system's native C calling convention. If I have that right then we only have one choice for calling convention there, but that choice depends on the target OS.</p>
<p>@afonso360, could you clarify whether there's more to do in this issue or whether it should be closed?</p>
</blockquote>



<a name="367114647"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235815%20fuzzgen%3A%20Fuzz%20different%20calling%20co.../near/367114647" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235815.20fuzzgen.3A.20Fuzz.20different.20calling.20co.2E.2E.2E.html#367114647">(Jun 17 2023 at 09:55)</a>:</h4>
<p>afonso360 <a href="https://github.com/bytecodealliance/wasmtime/issues/5815#issuecomment-1595696527">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/5815">issue #5815</a>:</p>
<blockquote>
<p>Oh, I forgot to close this issue, I'm sorry!</p>
<p>Yeah, that's pretty much right, we have to choose the right calling convention according to the platform we are currently executing. I think <code>cargo-fuzz</code> supports MacOS, however I'm not sure anyone is currently running it there, so we haven't had the need to add any other system calling conventions.</p>
<p>I don't think there is anything else missing here, but thanks for looking into this @littlebenlittle! </p>
</blockquote>



<a name="367114649"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235815%20fuzzgen%3A%20Fuzz%20different%20calling%20co.../near/367114649" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235815.20fuzzgen.3A.20Fuzz.20different.20calling.20co.2E.2E.2E.html#367114649">(Jun 17 2023 at 09:55)</a>:</h4>
<p>afonso360 closed <a href="https://github.com/bytecodealliance/wasmtime/issues/5815">issue #5815</a>:</p>
<blockquote>
<p><span aria-label="wave" class="emoji emoji-1f44b" role="img" title="wave">:wave:</span> Hey</p>
<h4>Feature</h4>
<p>Our <a href="https://github.com/bytecodealliance/wasmtime/tree/main/cranelift/fuzzgen"><code>cranelift-fuzzgen</code></a> fuzzer currently <a href="https://github.com/bytecodealliance/wasmtime/blob/db9efcb099e07dbb3b433668a5404deefc0eb709/cranelift/fuzzgen/src/function_generator.rs#L1376-L1379">always uses the <code>system_v</code> calling convention</a> on all functions.</p>
<p>We should change this so that we can explore other calling conventions!</p>
<h4>Benefit</h4>
<p>This increases coverage for the cranelift fuzzers. The cranelift fuzzer can reach a bit further into the ABI code since it generates a broader number of types (i.e. I8/I16/I128).</p>
<h4>Implementation</h4>
<p>We now have a <code>Target</code> in the <code>FunctionGenerator</code> so we can make decisions based on that. </p>
<p>We have a number of calling conventions that are applicable to <em>all</em> <code>Targets</code> such as <code>SystemV</code>/<code>Cold</code>/<code>Fast</code>, those are always available to be selected. But there are some that should be somewhat restricted such as <code>AppleAarch64</code> which we should only select on <code>aarch64</code> and <code>macosx</code>.</p>
<p>If anyone would like to take this on and needs some further help/clarification let me know!</p>
<h4>Alternatives</h4>
<p>Some of these calling conventions are already fuzzed via the wasmtime fuzzers, so we could keep relying on that.<br>
</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>