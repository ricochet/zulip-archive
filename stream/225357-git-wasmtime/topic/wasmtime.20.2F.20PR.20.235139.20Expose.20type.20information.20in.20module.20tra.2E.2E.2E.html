<html>
<head><meta charset="utf-8"><title>wasmtime / PR #5139 Expose type information in module tra... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235139.20Expose.20type.20information.20in.20module.20tra.2E.2E.2E.html">wasmtime / PR #5139 Expose type information in module tra...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="306439963"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235139%20Expose%20type%20information%20in%20module%20tra.../near/306439963" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235139.20Expose.20type.20information.20in.20module.20tra.2E.2E.2E.html#306439963">(Oct 27 2022 at 12:42)</a>:</h4>
<p>saulecabrera opened <a href="https://github.com/bytecodealliance/wasmtime/pull/5139">PR #5139</a> from <code>expose-type-info-in-translation</code> to <code>main</code>:</p>
<blockquote>
<p>@alexcrichton following up from our Zulip discussion last week. </p>
<p>This adds a new field <code>types</code> to <code>ModuleTranslation</code>, so that consumers can have access to the module type information known after validation has finished. This change is useful when consumers want to have access to the type information in wasmparser's terms rather than in wasmtime_environ's equivalent types (e.g. <code>WasmFuncType</code>).</p>
<p>I went with the simplest approach, wrapping the <code>Types</code> with <code>Option</code>, and introducing a method to get the types to preserve the invariant that after a successful translation, types should always be available. But I also considered some alternatives, so I'm happy to change this if any of the other alternatives are preferred.</p>
<p>Other alternatives considered:</p>
<ol>
<li>Making <code>wasmparser::types::Types</code> derive <code>Default</code>.  To achieve this, <code>wasmparser::validator::types::TypesKind</code>, should also need to derive <code>Default</code>, and the question that pops up here is, which is a good default for <code>TypesKind</code>? We could go with either or, but I'm not convinced that semantically it makes sense, IMO if we're going this route, it probably makes more sense to have an extra entry to represent the "untyped" state. </li>
<li>Introduce a module translation builder of some sort, and use that instead of <code>ModuleTranslation</code> for the translation/validation process. This would allow avoiding the <code>Option</code>, but seems a lot of duplication for a single field. </li>
</ol>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;<br>
</p>
</blockquote>



<a name="306463645"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235139%20Expose%20type%20information%20in%20module%20tra.../near/306463645" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235139.20Expose.20type.20information.20in.20module.20tra.2E.2E.2E.html#306463645">(Oct 27 2022 at 14:38)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5139#pullrequestreview-1158417670">PR review</a>.</p>



<a name="306463656"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235139%20Expose%20type%20information%20in%20module%20tra.../near/306463656" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235139.20Expose.20type.20information.20in.20module.20tra.2E.2E.2E.html#306463656">(Oct 27 2022 at 14:38)</a>:</h4>
<p>alexcrichton merged <a href="https://github.com/bytecodealliance/wasmtime/pull/5139">PR #5139</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>