<html>
<head><meta charset="utf-8"><title>wasmtime / issue #4561 Optionally add `log::trace!` calls... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234561.20Optionally.20add.20.60log.3A.3Atrace.21.60.20calls.2E.2E.2E.html">wasmtime / issue #4561 Optionally add `log::trace!` calls...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="291390482"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234561%20Optionally%20add%20%60log%3A%3Atrace%21%60%20calls.../near/291390482" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234561.20Optionally.20add.20.60log.3A.3Atrace.21.60.20calls.2E.2E.2E.html#291390482">(Jul 29 2022 at 22:50)</a>:</h4>
<p>github-actions[bot] <a href="https://github.com/bytecodealliance/wasmtime/pull/4561#issuecomment-1200009364">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4561">issue #4561</a>:</p>
<blockquote>
<h4>Subscribe to Label Action</h4>
<p>cc @cfallin, @fitzgen</p>
<p>&lt;details&gt;<br>
This issue or pull request has been labeled: "cranelift", "isle"</p>
<p>Thus the following users have been cc'd because of the following labels:</p>
<ul>
<li>cfallin: isle</li>
<li>fitzgen: isle</li>
</ul>
<p>To subscribe or unsubscribe from this label, edit the &lt;code&gt;.github/subscribe-to-label.json&lt;/code&gt; configuration file.</p>
<p><a href="https://github.com/bytecodealliance/subscribe-to-label-action">Learn more.</a><br>
&lt;/details&gt;</p>
</blockquote>



<a name="291394736"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234561%20Optionally%20add%20%60log%3A%3Atrace%21%60%20calls.../near/291394736" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234561.20Optionally.20add.20.60log.3A.3Atrace.21.60.20calls.2E.2E.2E.html#291394736">(Jul 30 2022 at 00:00)</a>:</h4>
<p>elliottt <a href="https://github.com/bytecodealliance/wasmtime/pull/4561#issuecomment-1200040842">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4561">issue #4561</a>:</p>
<blockquote>
<blockquote>
<p>I realized that #4484 hadn't merged yet and I had forgotten to do a review (and now it needs a rebase to merge) but once it merges, we should update this PR to use that <code>trace!</code> macro (which can be conditionally compiled out) rather than explicitly use <code>log::trace!</code>. (I realize you were trying to do something similar earlier but I think it makes sense to have both: the ISLE-level option to exclude from codegen completely, and the Cranelift-level custom trace macro. Probably we should make the codegen option a string option naming the trace macro...)</p>
</blockquote>
<p>I like that idea a lot! Being able to control the name of the macro called would also make it easier to use this to instrument the generated rust, which we might be able to take advantage of during testing.</p>
</blockquote>



<a name="297845086"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234561%20Optionally%20add%20%60log%3A%3Atrace%21%60%20calls.../near/297845086" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234561.20Optionally.20add.20.60log.3A.3Atrace.21.60.20calls.2E.2E.2E.html#297845086">(Sep 08 2022 at 18:48)</a>:</h4>
<p>jameysharp <a href="https://github.com/bytecodealliance/wasmtime/pull/4561#issuecomment-1241098182">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4561">issue #4561</a>:</p>
<blockquote>
<p>Is it important to have a build-time flag for whether to generate this code? Or would it be okay to just always generate the <code>trace!</code> call? I assume this is a code path that's not supposed to happen, because we're supposed to have ISLE rules covering all of CLIF. If that's true then there shouldn't be any runtime cost to including the logging calls, and actually I wonder if it should be a "warn" level log message or something. Anyway, is the flag just to avoid clutter in the generated code or something?</p>
</blockquote>



<a name="297845674"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234561%20Optionally%20add%20%60log%3A%3Atrace%21%60%20calls.../near/297845674" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234561.20Optionally.20add.20.60log.3A.3Atrace.21.60.20calls.2E.2E.2E.html#297845674">(Sep 08 2022 at 18:52)</a>:</h4>
<p>elliottt <a href="https://github.com/bytecodealliance/wasmtime/pull/4561#issuecomment-1241101689">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4561">issue #4561</a>:</p>
<blockquote>
<blockquote>
<p>Is it important to have a build-time flag for whether to generate this code? Or would it be okay to just always generate the <code>trace!</code> call? I assume this is a code path that's not supposed to happen, because we're supposed to have ISLE rules covering all of CLIF. If that's true then there shouldn't be any runtime cost to including the logging calls, and actually I wonder if it should be a "warn" level log message or something. Anyway, is the flag just to avoid clutter in the generated code or something?</p>
</blockquote>
<p>The reason for the flag was mostly that the tests aren't compiled in a context that has access to the <code>trace!</code> macro. </p>
</blockquote>



<a name="297847111"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234561%20Optionally%20add%20%60log%3A%3Atrace%21%60%20calls.../near/297847111" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234561.20Optionally.20add.20.60log.3A.3Atrace.21.60.20calls.2E.2E.2E.html#297847111">(Sep 08 2022 at 19:00)</a>:</h4>
<p>jameysharp <a href="https://github.com/bytecodealliance/wasmtime/pull/4561#issuecomment-1241110262">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4561">issue #4561</a>:</p>
<blockquote>
<blockquote>
<p>The reason for the flag was mostly that the tests aren't compiled in a context that has access to the <code>trace!</code> macro.</p>
</blockquote>
<p>Huh, I don't understand that answer. It's okay to call <code>log::trace</code> and the like without having any logging backend initialized; they just don't do anything in that case. What do you mean by "has access to" here?</p>
</blockquote>



<a name="297851468"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234561%20Optionally%20add%20%60log%3A%3Atrace%21%60%20calls.../near/297851468" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234561.20Optionally.20add.20.60log.3A.3Atrace.21.60.20calls.2E.2E.2E.html#297851468">(Sep 08 2022 at 19:31)</a>:</h4>
<p>elliottt <a href="https://github.com/bytecodealliance/wasmtime/pull/4561#issuecomment-1241138871">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4561">issue #4561</a>:</p>
<blockquote>
<blockquote>
<blockquote>
<p>The reason for the flag was mostly that the tests aren't compiled in a context that has access to the <code>trace!</code> macro.</p>
</blockquote>
<p>Huh, I don't understand that answer. It's okay to call <code>log::trace</code> and the like without having any logging backend initialized; they just don't do anything in that case. What do you mean by "has access to" here?</p>
</blockquote>
<p>The tests compile the output of islec with <code>rustc</code> directly, and it's difficult to get the appropriate crate dependencies resolved to run the compiler without <code>cargo</code>.</p>
</blockquote>



<a name="297877342"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234561%20Optionally%20add%20%60log%3A%3Atrace%21%60%20calls.../near/297877342" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234561.20Optionally.20add.20.60log.3A.3Atrace.21.60.20calls.2E.2E.2E.html#297877342">(Sep 08 2022 at 22:57)</a>:</h4>
<p>jameysharp <a href="https://github.com/bytecodealliance/wasmtime/pull/4561#issuecomment-1241317001">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4561">issue #4561</a>:</p>
<blockquote>
<p>Ahhh, that's what I was missing (<code>cranelift/isle/isle/tests/run_tests.rs</code> in particular).</p>
<p>I'm not sure I like relying on the enclosing crate having a <code>trace</code> macro at top-level. From offline discussion with you, I like your idea of making the config option be the name of the macro, if any, so ISLE's caller can use <code>println</code> or <code>log::warn</code> or whatever they want.</p>
<p>Instead of threading the config options through all the method calls, I think you should put them in <code>self</code> (the <code>Codegen</code> struct) so they're available everywhere without all that noise. I'd have a much easier time reviewing this PR then.</p>
</blockquote>



<a name="299860437"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234561%20Optionally%20add%20%60log%3A%3Atrace%21%60%20calls.../near/299860437" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234561.20Optionally.20add.20.60log.3A.3Atrace.21.60.20calls.2E.2E.2E.html#299860437">(Sep 20 2022 at 23:01)</a>:</h4>
<p>elliottt <a href="https://github.com/bytecodealliance/wasmtime/pull/4561#issuecomment-1253000501">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4561">issue #4561</a>:</p>
<blockquote>
<p>After playing around with this a bit, it's not actually that useful: the log message printed tells you that the top-level function you applied failed, which you already knew :)</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>