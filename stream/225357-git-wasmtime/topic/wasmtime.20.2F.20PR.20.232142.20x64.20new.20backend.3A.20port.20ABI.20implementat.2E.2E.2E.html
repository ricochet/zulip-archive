<html>
<head><meta charset="utf-8"><title>wasmtime / PR #2142 x64 new backend: port ABI implementat... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232142.20x64.20new.20backend.3A.20port.20ABI.20implementat.2E.2E.2E.html">wasmtime / PR #2142 x64 new backend: port ABI implementat...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="207352682"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232142%20x64%20new%20backend%3A%20port%20ABI%20implementat.../near/207352682" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232142.20x64.20new.20backend.3A.20port.20ABI.20implementat.2E.2E.2E.html#207352682">(Aug 18 2020 at 23:01)</a>:</h4>
<p>cfallin opened <a href="https://github.com/bytecodealliance/wasmtime/pull/2142">PR #2142</a> from <code>machinst-abi-x64</code> to <code>main</code>:</p>
<blockquote>
<p>Previously, in #2128, we factored out a common "vanilla 64-bit ABI"<br>
implementation from the AArch64 ABI code, with the idea that this should<br>
be largely compatible with x64. This PR alters the new x64 backend to<br>
make use of the shared infrastructure, removing the duplication that<br>
existed previously. The generated code is nearly (not exactly) the same;<br>
the only difference relates to how the clobber-save region is padded in<br>
the prologue.</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
</blockquote>



<a name="207352684"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232142%20x64%20new%20backend%3A%20port%20ABI%20implementat.../near/207352684" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232142.20x64.20new.20backend.3A.20port.20ABI.20implementat.2E.2E.2E.html#207352684">(Aug 18 2020 at 23:01)</a>:</h4>
<p><strong>cfallin</strong> requested <a href="https://github.com/bnjbvr">bnjbvr</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/2142">PR #2142</a>.</p>



<a name="207354513"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232142%20x64%20new%20backend%3A%20port%20ABI%20implementat.../near/207354513" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232142.20x64.20new.20backend.3A.20port.20ABI.20implementat.2E.2E.2E.html#207354513">(Aug 18 2020 at 23:23)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2142">PR #2142</a> from <code>machinst-abi-x64</code> to <code>main</code>:</p>
<blockquote>
<p>Previously, in #2128, we factored out a common "vanilla 64-bit ABI"<br>
implementation from the AArch64 ABI code, with the idea that this should<br>
be largely compatible with x64. This PR alters the new x64 backend to<br>
make use of the shared infrastructure, removing the duplication that<br>
existed previously. The generated code is nearly (not exactly) the same;<br>
the only difference relates to how the clobber-save region is padded in<br>
the prologue.</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
</blockquote>



<a name="207375542"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232142%20x64%20new%20backend%3A%20port%20ABI%20implementat.../near/207375542" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232142.20x64.20new.20backend.3A.20port.20ABI.20implementat.2E.2E.2E.html#207375542">(Aug 19 2020 at 06:54)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2142#pullrequestreview-470171223">PR Review</a>.</p>



<a name="207375543"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232142%20x64%20new%20backend%3A%20port%20ABI%20implementat.../near/207375543" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232142.20x64.20new.20backend.3A.20port.20ABI.20implementat.2E.2E.2E.html#207375543">(Aug 19 2020 at 06:54)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2142#pullrequestreview-470171223">PR Review</a>.</p>



<a name="207375544"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232142%20x64%20new%20backend%3A%20port%20ABI%20implementat.../near/207375544" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232142.20x64.20new.20backend.3A.20port.20ABI.20implementat.2E.2E.2E.html#207375544">(Aug 19 2020 at 06:54)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/2142#discussion_r472775106">PR Review Comment</a>:</p>
<blockquote>
<p>*for the</p>
</blockquote>



<a name="207476886"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232142%20x64%20new%20backend%3A%20port%20ABI%20implementat.../near/207476886" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232142.20x64.20new.20backend.3A.20port.20ABI.20implementat.2E.2E.2E.html#207476886">(Aug 20 2020 at 00:18)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2142">PR #2142</a> from <code>machinst-abi-x64</code> to <code>main</code>:</p>
<blockquote>
<p>Previously, in #2128, we factored out a common "vanilla 64-bit ABI"<br>
implementation from the AArch64 ABI code, with the idea that this should<br>
be largely compatible with x64. This PR alters the new x64 backend to<br>
make use of the shared infrastructure, removing the duplication that<br>
existed previously. The generated code is nearly (not exactly) the same;<br>
the only difference relates to how the clobber-save region is padded in<br>
the prologue.</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
</blockquote>



<a name="207476894"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232142%20x64%20new%20backend%3A%20port%20ABI%20implementat.../near/207476894" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232142.20x64.20new.20backend.3A.20port.20ABI.20implementat.2E.2E.2E.html#207476894">(Aug 20 2020 at 00:18)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2142#pullrequestreview-471046788">PR Review</a>.</p>



<a name="207476895"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232142%20x64%20new%20backend%3A%20port%20ABI%20implementat.../near/207476895" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232142.20x64.20new.20backend.3A.20port.20ABI.20implementat.2E.2E.2E.html#207476895">(Aug 20 2020 at 00:18)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/2142#discussion_r473465817">PR Review Comment</a>:</p>
<blockquote>
<p>Thanks!</p>
</blockquote>



<a name="207478827"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232142%20x64%20new%20backend%3A%20port%20ABI%20implementat.../near/207478827" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232142.20x64.20new.20backend.3A.20port.20ABI.20implementat.2E.2E.2E.html#207478827">(Aug 20 2020 at 00:54)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2142">PR #2142</a> from <code>machinst-abi-x64</code> to <code>main</code>:</p>
<blockquote>
<p>Previously, in #2128, we factored out a common "vanilla 64-bit ABI"<br>
implementation from the AArch64 ABI code, with the idea that this should<br>
be largely compatible with x64. This PR alters the new x64 backend to<br>
make use of the shared infrastructure, removing the duplication that<br>
existed previously. The generated code is nearly (not exactly) the same;<br>
the only difference relates to how the clobber-save region is padded in<br>
the prologue.</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
</blockquote>



<a name="207532743"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232142%20x64%20new%20backend%3A%20port%20ABI%20implementat.../near/207532743" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232142.20x64.20new.20backend.3A.20port.20ABI.20implementat.2E.2E.2E.html#207532743">(Aug 20 2020 at 15:06)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2142#pullrequestreview-471665630">PR Review</a>.</p>



<a name="207532744"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232142%20x64%20new%20backend%3A%20port%20ABI%20implementat.../near/207532744" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232142.20x64.20new.20backend.3A.20port.20ABI.20implementat.2E.2E.2E.html#207532744">(Aug 20 2020 at 15:06)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2142#pullrequestreview-471665630">PR Review</a>.</p>



<a name="207532745"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232142%20x64%20new%20backend%3A%20port%20ABI%20implementat.../near/207532745" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232142.20x64.20new.20backend.3A.20port.20ABI.20implementat.2E.2E.2E.html#207532745">(Aug 20 2020 at 15:06)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2142#discussion_r474027602">PR Review Comment</a>:</p>
<blockquote>
<p>I wasn't there when the trait was designed, but: would it make sense to pass a context, or the consumer of these insts directly here? (I remember some cases where it wasn't possible to do so, because it was used in both the lowering and code emission contexts, so maybe that's irrelevant.)<br>
This would avoid the smallvec allocation entirely here.</p>
</blockquote>



<a name="207532746"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232142%20x64%20new%20backend%3A%20port%20ABI%20implementat.../near/207532746" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232142.20x64.20new.20backend.3A.20port.20ABI.20implementat.2E.2E.2E.html#207532746">(Aug 20 2020 at 15:06)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2142#discussion_r474021878">PR Review Comment</a>:</p>
<blockquote>
<p>nit (here and below many times): can you use <code>pub(crate)</code> instead?</p>
</blockquote>



<a name="207532747"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232142%20x64%20new%20backend%3A%20port%20ABI%20implementat.../near/207532747" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232142.20x64.20new.20backend.3A.20port.20ABI.20implementat.2E.2E.2E.html#207532747">(Aug 20 2020 at 15:06)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2142#discussion_r474029741">PR Review Comment</a>:</p>
<blockquote>
<p>Please expand GV here.</p>
</blockquote>



<a name="207532748"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232142%20x64%20new%20backend%3A%20port%20ABI%20implementat.../near/207532748" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232142.20x64.20new.20backend.3A.20port.20ABI.20implementat.2E.2E.2E.html#207532748">(Aug 20 2020 at 15:06)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2142#discussion_r474031029">PR Review Comment</a>:</p>
<blockquote>
<p>Same question above wrt i32 vs i64.</p>
</blockquote>



<a name="207532749"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232142%20x64%20new%20backend%3A%20port%20ABI%20implementat.../near/207532749" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232142.20x64.20new.20backend.3A.20port.20ABI.20implementat.2E.2E.2E.html#207532749">(Aug 20 2020 at 15:06)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2142#discussion_r474028794">PR Review Comment</a>:</p>
<blockquote>
<p>Is it possible that the imm is actually large enough to trigger this? If so, would it make sense to materialize the immediate into a temp register, and use a reg/reg add below? If the imm can't be this large, could the trait function accept an <code>u32</code> instead of an <code>u64</code>?</p>
</blockquote>



<a name="207532750"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232142%20x64%20new%20backend%3A%20port%20ABI%20implementat.../near/207532750" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232142.20x64.20new.20backend.3A.20port.20ABI.20implementat.2E.2E.2E.html#207532750">(Aug 20 2020 at 15:06)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2142#discussion_r474032387">PR Review Comment</a>:</p>
<blockquote>
<p>same question for i32 vs i64 in signature</p>
</blockquote>



<a name="207532751"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232142%20x64%20new%20backend%3A%20port%20ABI%20implementat.../near/207532751" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232142.20x64.20new.20backend.3A.20port.20ABI.20implementat.2E.2E.2E.html#207532751">(Aug 20 2020 at 15:06)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2142#discussion_r474030672">PR Review Comment</a>:</p>
<blockquote>
<p>Just reading this doesn't help understanding why it's fine to do so, which makes me think the trait functions should be redesigned so the temp reg is also returned from <code>gen_add_imm</code>, or something like this.</p>
</blockquote>



<a name="207532752"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232142%20x64%20new%20backend%3A%20port%20ABI%20implementat.../near/207532752" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232142.20x64.20new.20backend.3A.20port.20ABI.20implementat.2E.2E.2E.html#207532752">(Aug 20 2020 at 15:06)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2142#discussion_r474032503">PR Review Comment</a>:</p>
<blockquote>
<p>same remark about smallvec</p>
</blockquote>



<a name="207532753"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232142%20x64%20new%20backend%3A%20port%20ABI%20implementat.../near/207532753" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232142.20x64.20new.20backend.3A.20port.20ABI.20implementat.2E.2E.2E.html#207532753">(Aug 20 2020 at 15:06)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2142#discussion_r474036576">PR Review Comment</a>:</p>
<blockquote>
<p>nit: this comment can be removed, i think</p>
</blockquote>



<a name="207532754"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232142%20x64%20new%20backend%3A%20port%20ABI%20implementat.../near/207532754" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232142.20x64.20new.20backend.3A.20port.20ABI.20implementat.2E.2E.2E.html#207532754">(Aug 20 2020 at 15:06)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2142#discussion_r474038994">PR Review Comment</a>:</p>
<blockquote>
<p>This is a bit feeble to use a bool in this case, could it be its own enum, to enhance readability?</p>
</blockquote>



<a name="207532756"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232142%20x64%20new%20backend%3A%20port%20ABI%20implementat.../near/207532756" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232142.20x64.20new.20backend.3A.20port.20ABI.20implementat.2E.2E.2E.html#207532756">(Aug 20 2020 at 15:06)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2142#discussion_r474047509">PR Review Comment</a>:</p>
<blockquote>
<p>ditto</p>
</blockquote>



<a name="207532757"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232142%20x64%20new%20backend%3A%20port%20ABI%20implementat.../near/207532757" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232142.20x64.20new.20backend.3A.20port.20ABI.20implementat.2E.2E.2E.html#207532757">(Aug 20 2020 at 15:06)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2142#discussion_r474052152">PR Review Comment</a>:</p>
<blockquote>
<p>nit: could you use <code>expect</code> instead of <code>unwrap</code>, here and below? it likely adds cases where we have a very big offset, and it just wouldn't be implemented here.</p>
</blockquote>



<a name="207532758"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232142%20x64%20new%20backend%3A%20port%20ABI%20implementat.../near/207532758" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232142.20x64.20new.20backend.3A.20port.20ABI.20implementat.2E.2E.2E.html#207532758">(Aug 20 2020 at 15:06)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2142#discussion_r474040280">PR Review Comment</a>:</p>
<blockquote>
<p>Something I've meaning to change here, just to avoid dummy memory reallocations: can you use a <code>vec!</code> declaration here, instead of multiple pushes? This method could even return a plain <code>&amp;[]</code>, since in both cases (baldrdash/not baldrdash), these arrays are statically known.</p>
</blockquote>



<a name="207532759"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232142%20x64%20new%20backend%3A%20port%20ABI%20implementat.../near/207532759" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232142.20x64.20new.20backend.3A.20port.20ABI.20implementat.2E.2E.2E.html#207532759">(Aug 20 2020 at 15:06)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2142#discussion_r474051066">PR Review Comment</a>:</p>
<blockquote>
<p>We can use an unstable sort here, not that it matters...</p>
</blockquote>



<a name="207532760"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232142%20x64%20new%20backend%3A%20port%20ABI%20implementat.../near/207532760" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232142.20x64.20new.20backend.3A.20port.20ABI.20implementat.2E.2E.2E.html#207532760">(Aug 20 2020 at 15:06)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2142#discussion_r474039471">PR Review Comment</a>:</p>
<blockquote>
<p>Maybe we could rename this method <code>get_spillslot_byte_size</code>, then?</p>
</blockquote>



<a name="207532762"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232142%20x64%20new%20backend%3A%20port%20ABI%20implementat.../near/207532762" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232142.20x64.20new.20backend.3A.20port.20ABI.20implementat.2E.2E.2E.html#207532762">(Aug 20 2020 at 15:06)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2142#discussion_r474049135">PR Review Comment</a>:</p>
<blockquote>
<p>I don't know if this has an importance in terms of speed of gen'd code, but Spidermonkey does do a single sp+imm operation here, then use stores to sp+offset for each saved register. It would also avoid the weird <code>push 0</code> to keep the stack 16-bytes aligned.</p>
</blockquote>



<a name="207572437"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232142%20x64%20new%20backend%3A%20port%20ABI%20implementat.../near/207572437" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232142.20x64.20new.20backend.3A.20port.20ABI.20implementat.2E.2E.2E.html#207572437">(Aug 20 2020 at 20:46)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2142#pullrequestreview-471973000">PR Review</a>.</p>



<a name="207572438"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232142%20x64%20new%20backend%3A%20port%20ABI%20implementat.../near/207572438" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232142.20x64.20new.20backend.3A.20port.20ABI.20implementat.2E.2E.2E.html#207572438">(Aug 20 2020 at 20:46)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/2142#discussion_r474262466">PR Review Comment</a>:</p>
<blockquote>
<p>I thought about this, but (as you suspected) this is called in contexts where we have no <code>LowerCtx</code> or other direct consumer of callbacks. We could statically monomorphize on a closure argument that receives instructions, but that seems unnecessarily complex and would duplicate code in the binary; I made sure to size the <code>SmallVec</code>s so they should fit x64 and aarch64 cases in their inline storage, so the cost is (just) copying a few <code>Inst</code>s instead. Happy to go the other way though if you'd prefer!</p>
</blockquote>



<a name="207572494"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232142%20x64%20new%20backend%3A%20port%20ABI%20implementat.../near/207572494" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232142.20x64.20new.20backend.3A.20port.20ABI.20implementat.2E.2E.2E.html#207572494">(Aug 20 2020 at 20:46)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2142#pullrequestreview-471973205">PR Review</a>.</p>



<a name="207572495"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232142%20x64%20new%20backend%3A%20port%20ABI%20implementat.../near/207572495" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232142.20x64.20new.20backend.3A.20port.20ABI.20implementat.2E.2E.2E.html#207572495">(Aug 20 2020 at 20:46)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/2142#discussion_r474262625">PR Review Comment</a>:</p>
<blockquote>
<p><code>u32</code> instead is much cleaner, thanks!</p>
</blockquote>



<a name="207573782"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232142%20x64%20new%20backend%3A%20port%20ABI%20implementat.../near/207573782" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232142.20x64.20new.20backend.3A.20port.20ABI.20implementat.2E.2E.2E.html#207573782">(Aug 20 2020 at 20:58)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2142#pullrequestreview-471981194">PR Review</a>.</p>



<a name="207573783"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232142%20x64%20new%20backend%3A%20port%20ABI%20implementat.../near/207573783" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232142.20x64.20new.20backend.3A.20port.20ABI.20implementat.2E.2E.2E.html#207573783">(Aug 20 2020 at 20:58)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/2142#discussion_r474268961">PR Review Comment</a>:</p>
<blockquote>
<p>Thanks for pointing this out; yeah, it is a bit convoluted. I've updated the documentation on the trait definition to clearly describe the requirements placed on the machine backend's implementation and register choices, and I've renamed <code>get_fixed_tmp_reg()</code> to <code>get_stacklimit_reg()</code> to make its purpose more explicit.</p>
<p>I thought for a bit if there might be a better way to do this, but I haven't managed to find one, unless we push the whole "compute this <code>GlobalValue</code> using only caller-saves" logic into each machine backend. <code>gen_add_imm()</code> could return info about what it clobbers, but that still doesn't help the machine-independent implementation choose another register on its own. Really the machine-backend author has to choose fixed scratch registers and a corresponding add-with-large-immediate lowering (on RISCs at least) and just provide them to the machine-independent part.</p>
<p>On x64, anyway, we can always have a full 32-bit immediate on an add, so the more tricky requirements are moot; all we need is some arbitrary caller-save register here. Hopefully simple enough but I'm open to other ideas :-)</p>
</blockquote>



<a name="207574446"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232142%20x64%20new%20backend%3A%20port%20ABI%20implementat.../near/207574446" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232142.20x64.20new.20backend.3A.20port.20ABI.20implementat.2E.2E.2E.html#207574446">(Aug 20 2020 at 21:05)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2142#pullrequestreview-471985208">PR Review</a>.</p>



<a name="207574447"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232142%20x64%20new%20backend%3A%20port%20ABI%20implementat.../near/207574447" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232142.20x64.20new.20backend.3A.20port.20ABI.20implementat.2E.2E.2E.html#207574447">(Aug 20 2020 at 21:05)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/2142#discussion_r474272100">PR Review Comment</a>:</p>
<blockquote>
<p>Changed all of these to <code>i32</code>.</p>
</blockquote>



<a name="207574762"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232142%20x64%20new%20backend%3A%20port%20ABI%20implementat.../near/207574762" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232142.20x64.20new.20backend.3A.20port.20ABI.20implementat.2E.2E.2E.html#207574762">(Aug 20 2020 at 21:08)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2142#pullrequestreview-471987280">PR Review</a>.</p>



<a name="207574764"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232142%20x64%20new%20backend%3A%20port%20ABI%20implementat.../near/207574764" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232142.20x64.20new.20backend.3A.20port.20ABI.20implementat.2E.2E.2E.html#207574764">(Aug 20 2020 at 21:08)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/2142#discussion_r474273652">PR Review Comment</a>:</p>
<blockquote>
<p>Good idea!</p>
</blockquote>



<a name="207574967"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232142%20x64%20new%20backend%3A%20port%20ABI%20implementat.../near/207574967" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232142.20x64.20new.20backend.3A.20port.20ABI.20implementat.2E.2E.2E.html#207574967">(Aug 20 2020 at 21:10)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2142#pullrequestreview-471988612">PR Review</a>.</p>



<a name="207574968"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232142%20x64%20new%20backend%3A%20port%20ABI%20implementat.../near/207574968" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232142.20x64.20new.20backend.3A.20port.20ABI.20implementat.2E.2E.2E.html#207574968">(Aug 20 2020 at 21:10)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/2142#discussion_r474274672">PR Review Comment</a>:</p>
<blockquote>
<p>The interface back to the lowering code reasons in terms of number of spillslots, so I'd rather not convert to/from bytes internally; but I renamed this to <code>get_number_of_spillslots_for_value()</code>, which is hopefully more clear!</p>
</blockquote>



<a name="207575512"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232142%20x64%20new%20backend%3A%20port%20ABI%20implementat.../near/207575512" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232142.20x64.20new.20backend.3A.20port.20ABI.20implementat.2E.2E.2E.html#207575512">(Aug 20 2020 at 21:15)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2142#pullrequestreview-471991452">PR Review</a>.</p>



<a name="207575513"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232142%20x64%20new%20backend%3A%20port%20ABI%20implementat.../near/207575513" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232142.20x64.20new.20backend.3A.20port.20ABI.20implementat.2E.2E.2E.html#207575513">(Aug 20 2020 at 21:15)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/2142#discussion_r474276998">PR Review Comment</a>:</p>
<blockquote>
<p>Done! Returning a <code>'static</code> slice would require refactoring some other things to be const functions, I think, including in <a href="http://regalloc.rs">regalloc.rs</a> (<code>Writable::from_reg</code>), or else adding lazy-inits, so I'm not sure if that's completely feasible at the moment, but perhaps we could think about this more...</p>
</blockquote>



<a name="207575701"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232142%20x64%20new%20backend%3A%20port%20ABI%20implementat.../near/207575701" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232142.20x64.20new.20backend.3A.20port.20ABI.20implementat.2E.2E.2E.html#207575701">(Aug 20 2020 at 21:17)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2142#pullrequestreview-471992746">PR Review</a>.</p>



<a name="207575702"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232142%20x64%20new%20backend%3A%20port%20ABI%20implementat.../near/207575702" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232142.20x64.20new.20backend.3A.20port.20ABI.20implementat.2E.2E.2E.html#207575702">(Aug 20 2020 at 21:17)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/2142#discussion_r474277999">PR Review Comment</a>:</p>
<blockquote>
<p>Good point! (I had initially thought we wanted a stable sort to ensure deterministic code output, but of course the registers will be unique, so it doesn't matter...)</p>
</blockquote>



<a name="207575842"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232142%20x64%20new%20backend%3A%20port%20ABI%20implementat.../near/207575842" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232142.20x64.20new.20backend.3A.20port.20ABI.20implementat.2E.2E.2E.html#207575842">(Aug 20 2020 at 21:18)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2142#pullrequestreview-471993382">PR Review</a>.</p>



<a name="207575843"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232142%20x64%20new%20backend%3A%20port%20ABI%20implementat.../near/207575843" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232142.20x64.20new.20backend.3A.20port.20ABI.20implementat.2E.2E.2E.html#207575843">(Aug 20 2020 at 21:18)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/2142#discussion_r474278509">PR Review Comment</a>:</p>
<blockquote>
<p>Done!</p>
</blockquote>



<a name="207578271"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232142%20x64%20new%20backend%3A%20port%20ABI%20implementat.../near/207578271" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232142.20x64.20new.20backend.3A.20port.20ABI.20implementat.2E.2E.2E.html#207578271">(Aug 20 2020 at 21:47)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2142#pullrequestreview-472008673">PR Review</a>.</p>



<a name="207578273"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232142%20x64%20new%20backend%3A%20port%20ABI%20implementat.../near/207578273" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232142.20x64.20new.20backend.3A.20port.20ABI.20implementat.2E.2E.2E.html#207578273">(Aug 20 2020 at 21:47)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/2142#discussion_r474291024">PR Review Comment</a>:</p>
<blockquote>
<p>Good point! Done.</p>
</blockquote>



<a name="207579142"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232142%20x64%20new%20backend%3A%20port%20ABI%20implementat.../near/207579142" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232142.20x64.20new.20backend.3A.20port.20ABI.20implementat.2E.2E.2E.html#207579142">(Aug 20 2020 at 21:58)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2142">PR #2142</a> from <code>machinst-abi-x64</code> to <code>main</code>:</p>
<blockquote>
<p>Previously, in #2128, we factored out a common "vanilla 64-bit ABI"<br>
implementation from the AArch64 ABI code, with the idea that this should<br>
be largely compatible with x64. This PR alters the new x64 backend to<br>
make use of the shared infrastructure, removing the duplication that<br>
existed previously. The generated code is nearly (not exactly) the same;<br>
the only difference relates to how the clobber-save region is padded in<br>
the prologue.</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
</blockquote>



<a name="207582491"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232142%20x64%20new%20backend%3A%20port%20ABI%20implementat.../near/207582491" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232142.20x64.20new.20backend.3A.20port.20ABI.20implementat.2E.2E.2E.html#207582491">(Aug 20 2020 at 22:35)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2142">PR #2142</a> from <code>machinst-abi-x64</code> to <code>main</code>:</p>
<blockquote>
<p>Previously, in #2128, we factored out a common "vanilla 64-bit ABI"<br>
implementation from the AArch64 ABI code, with the idea that this should<br>
be largely compatible with x64. This PR alters the new x64 backend to<br>
make use of the shared infrastructure, removing the duplication that<br>
existed previously. The generated code is nearly (not exactly) the same;<br>
the only difference relates to how the clobber-save region is padded in<br>
the prologue.</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
</blockquote>



<a name="207642759"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232142%20x64%20new%20backend%3A%20port%20ABI%20implementat.../near/207642759" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232142.20x64.20new.20backend.3A.20port.20ABI.20implementat.2E.2E.2E.html#207642759">(Aug 21 2020 at 14:47)</a>:</h4>
<p><strong>bnjbvr</strong> requested <a href="https://github.com/bnjbvr">bnjbvr</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/2142">PR #2142</a>.</p>



<a name="209312114"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232142%20x64%20new%20backend%3A%20port%20ABI%20implementat.../near/209312114" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232142.20x64.20new.20backend.3A.20port.20ABI.20implementat.2E.2E.2E.html#209312114">(Sep 07 2020 at 16:31)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2142#pullrequestreview-483653116">PR Review</a>.</p>



<a name="209312115"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232142%20x64%20new%20backend%3A%20port%20ABI%20implementat.../near/209312115" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232142.20x64.20new.20backend.3A.20port.20ABI.20implementat.2E.2E.2E.html#209312115">(Sep 07 2020 at 16:31)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2142#pullrequestreview-483653116">PR Review</a>.</p>



<a name="209312116"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232142%20x64%20new%20backend%3A%20port%20ABI%20implementat.../near/209312116" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232142.20x64.20new.20backend.3A.20port.20ABI.20implementat.2E.2E.2E.html#209312116">(Sep 07 2020 at 16:31)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2142#discussion_r484510207">PR Review Comment</a>:</p>
<blockquote>
<p>Should we add "not yet implemented" to this error message? This may happen in real-world programs. Alternatively, should we report an <code>Err</code> <code>Result</code> here, with an impl limit exceeded error?</p>
</blockquote>



<a name="209312117"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232142%20x64%20new%20backend%3A%20port%20ABI%20implementat.../near/209312117" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232142.20x64.20new.20backend.3A.20port.20ABI.20implementat.2E.2E.2E.html#209312117">(Sep 07 2020 at 16:31)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2142#discussion_r484513438">PR Review Comment</a>:</p>
<blockquote>
<p>Can we add an assertion that this is caller-save? (This depends on the calling convention, not sure if it's available from here.)</p>
</blockquote>



<a name="209312118"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232142%20x64%20new%20backend%3A%20port%20ABI%20implementat.../near/209312118" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232142.20x64.20new.20backend.3A.20port.20ABI.20implementat.2E.2E.2E.html#209312118">(Sep 07 2020 at 16:31)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2142#discussion_r484511095">PR Review Comment</a>:</p>
<blockquote>
<p>Sorry if this is not the right place/time for this suggestion, but: I am a bit confused when it comes to distinguish <code>Body</code> from <code>Call</code>, by just looking at the names. The comments really help, for that matter. Alternatively, what do you think of renaming <code>ABIBodyImpl</code> to <code>CalleeABIImpl</code>, and <code>ABICallImpl</code> to <code>CallerABIImpl</code>? (I just realize the consecutive <code>i</code> make it a bit hard to decipher, with any casing... so maybe not such a great idea.)</p>
</blockquote>



<a name="209312119"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232142%20x64%20new%20backend%3A%20port%20ABI%20implementat.../near/209312119" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232142.20x64.20new.20backend.3A.20port.20ABI.20implementat.2E.2E.2E.html#209312119">(Sep 07 2020 at 16:31)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2142#discussion_r484511556">PR Review Comment</a>:</p>
<blockquote>
<p>(Another belated suggestion) <code>Impl</code> in a name (here, in <code>ABIMachineImpl</code>) makes me think that we have a concrete type, while it's actually a trait. Is there any other name that could avoid this confusion? <code>ABIMachineSpec</code> for instance?</p>
</blockquote>



<a name="209312120"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232142%20x64%20new%20backend%3A%20port%20ABI%20implementat.../near/209312120" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232142.20x64.20new.20backend.3A.20port.20ABI.20implementat.2E.2E.2E.html#209312120">(Sep 07 2020 at 16:31)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2142#discussion_r484514932">PR Review Comment</a>:</p>
<blockquote>
<p>Real world programs could have large offsets (here and below) right? Should this message also contain "not implemented yet", or should the function return a <code>Result</code>, and here it'd be an <code>Err</code> with impl limit exceeded?</p>
</blockquote>



<a name="209459983"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232142%20x64%20new%20backend%3A%20port%20ABI%20implementat.../near/209459983" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232142.20x64.20new.20backend.3A.20port.20ABI.20implementat.2E.2E.2E.html#209459983">(Sep 09 2020 at 00:27)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2142#pullrequestreview-484578584">PR Review</a>.</p>



<a name="209459984"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232142%20x64%20new%20backend%3A%20port%20ABI%20implementat.../near/209459984" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232142.20x64.20new.20backend.3A.20port.20ABI.20implementat.2E.2E.2E.html#209459984">(Sep 09 2020 at 00:27)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/2142#discussion_r485266859">PR Review Comment</a>:</p>
<blockquote>
<p>The stack offset here is limited by the stack-frame size, which we clamp to 128 MB in <code>compute_arg_locs()</code>, so I don't think we need to bubble up a <code>Result</code> (since it should not be reachable code for any input); but I've clarified the error message. Thanks!</p>
</blockquote>



<a name="209460002"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232142%20x64%20new%20backend%3A%20port%20ABI%20implementat.../near/209460002" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232142.20x64.20new.20backend.3A.20port.20ABI.20implementat.2E.2E.2E.html#209460002">(Sep 09 2020 at 00:27)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2142#pullrequestreview-484578675">PR Review</a>.</p>



<a name="209460003"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232142%20x64%20new%20backend%3A%20port%20ABI%20implementat.../near/209460003" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232142.20x64.20new.20backend.3A.20port.20ABI.20implementat.2E.2E.2E.html#209460003">(Sep 09 2020 at 00:27)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/2142#discussion_r485266939">PR Review Comment</a>:</p>
<blockquote>
<p>Done; just asserting that it's a caller-save in systemv and baldrdash.</p>
</blockquote>



<a name="209460024"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232142%20x64%20new%20backend%3A%20port%20ABI%20implementat.../near/209460024" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232142.20x64.20new.20backend.3A.20port.20ABI.20implementat.2E.2E.2E.html#209460024">(Sep 09 2020 at 00:27)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2142#pullrequestreview-484578806">PR Review</a>.</p>



<a name="209460025"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232142%20x64%20new%20backend%3A%20port%20ABI%20implementat.../near/209460025" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232142.20x64.20new.20backend.3A.20port.20ABI.20implementat.2E.2E.2E.html#209460025">(Sep 09 2020 at 00:27)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/2142#discussion_r485267054">PR Review Comment</a>:</p>
<blockquote>
<p>Analogous to above, shouldn't happen due to stack-frame size limit; clarified messages.</p>
</blockquote>



<a name="209460660"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232142%20x64%20new%20backend%3A%20port%20ABI%20implementat.../near/209460660" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232142.20x64.20new.20backend.3A.20port.20ABI.20implementat.2E.2E.2E.html#209460660">(Sep 09 2020 at 00:36)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2142#pullrequestreview-484581106">PR Review</a>.</p>



<a name="209460661"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232142%20x64%20new%20backend%3A%20port%20ABI%20implementat.../near/209460661" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232142.20x64.20new.20backend.3A.20port.20ABI.20implementat.2E.2E.2E.html#209460661">(Sep 09 2020 at 00:36)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/2142#discussion_r485269212">PR Review Comment</a>:</p>
<blockquote>
<p>Good idea!</p>
</blockquote>



<a name="209460672"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232142%20x64%20new%20backend%3A%20port%20ABI%20implementat.../near/209460672" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232142.20x64.20new.20backend.3A.20port.20ABI.20implementat.2E.2E.2E.html#209460672">(Sep 09 2020 at 00:36)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2142#pullrequestreview-484581349">PR Review</a>.</p>



<a name="209460689"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232142%20x64%20new%20backend%3A%20port%20ABI%20implementat.../near/209460689" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232142.20x64.20new.20backend.3A.20port.20ABI.20implementat.2E.2E.2E.html#209460689">(Sep 09 2020 at 00:37)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2142">PR #2142</a> from <code>machinst-abi-x64</code> to <code>main</code>:</p>
<blockquote>
<p>Previously, in #2128, we factored out a common "vanilla 64-bit ABI"<br>
implementation from the AArch64 ABI code, with the idea that this should<br>
be largely compatible with x64. This PR alters the new x64 backend to<br>
make use of the shared infrastructure, removing the duplication that<br>
existed previously. The generated code is nearly (not exactly) the same;<br>
the only difference relates to how the clobber-save region is padded in<br>
the prologue.</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
</blockquote>



<a name="209460705"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232142%20x64%20new%20backend%3A%20port%20ABI%20implementat.../near/209460705" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232142.20x64.20new.20backend.3A.20port.20ABI.20implementat.2E.2E.2E.html#209460705">(Sep 09 2020 at 00:37)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/2142#discussion_r485269455">PR Review Comment</a>:</p>
<blockquote>
<p>Ah, yes, I like the callee/caller distinction better than "body" / "call"; it's much more intuitive. I've gone ahead with these names (I think the <code>...ABIImpl</code> is fine IMHO.) Thanks!</p>
</blockquote>



<a name="209461985"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232142%20x64%20new%20backend%3A%20port%20ABI%20implementat.../near/209461985" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232142.20x64.20new.20backend.3A.20port.20ABI.20implementat.2E.2E.2E.html#209461985">(Sep 09 2020 at 00:59)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2142">PR #2142</a> from <code>machinst-abi-x64</code> to <code>main</code>:</p>
<blockquote>
<p>Previously, in #2128, we factored out a common "vanilla 64-bit ABI"<br>
implementation from the AArch64 ABI code, with the idea that this should<br>
be largely compatible with x64. This PR alters the new x64 backend to<br>
make use of the shared infrastructure, removing the duplication that<br>
existed previously. The generated code is nearly (not exactly) the same;<br>
the only difference relates to how the clobber-save region is padded in<br>
the prologue.</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
</blockquote>



<a name="209463737"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232142%20x64%20new%20backend%3A%20port%20ABI%20implementat.../near/209463737" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232142.20x64.20new.20backend.3A.20port.20ABI.20implementat.2E.2E.2E.html#209463737">(Sep 09 2020 at 01:35)</a>:</h4>
<p>cfallin merged <a href="https://github.com/bytecodealliance/wasmtime/pull/2142">PR #2142</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>