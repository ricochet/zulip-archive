<html>
<head><meta charset="utf-8"><title>wasmtime / PR #6262 wasmtime: Overhaul trampolines · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236262.20wasmtime.3A.20Overhaul.20trampolines.html">wasmtime / PR #6262 wasmtime: Overhaul trampolines</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="351703132"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236262%20wasmtime%3A%20Overhaul%20trampolines/near/351703132" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236262.20wasmtime.3A.20Overhaul.20trampolines.html#351703132">(Apr 21 2023 at 18:21)</a>:</h4>
<p>fitzgen opened <a href="https://github.com/bytecodealliance/wasmtime/pull/6262">PR #6262</a> from <code>fitzgen:trampoline-overhaul</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>This commit splits <code>VMCallerCheckedFuncRef::func_ptr</code> into three new function pointers: <code>VMCallerCheckedFuncRef::{wasm,array,native}_call</code>. Each one has a dedicated calling convention, so callers just choose the version that works for them. This is as opposed to the previous behavior where we would chain together many trampolines that converted between calling conventions, sometimes up to four on the way into Wasm and four more on the way back out. See [0] for details.</p>
<p>[0] <a href="https://github.com/bytecodealliance/rfcs/blob/main/accepted/tail-calls.md#a-review-of-our-existing-trampolines-calling-conventions-and-call-paths">https://github.com/bytecodealliance/rfcs/blob/main/accepted/tail-calls.md#a-review-of-our-existing-trampolines-calling-conventions-and-call-paths</a></p>
<p>Thanks to @bjorn3 for the initial idea of having multiple function pointers for different calling conventions.</p>
<p>This is generally a nice ~5-10% speed up to our call benchmarks across the board: both Wasm-to-host and host-to-Wasm. The one exception is typed calls from Wasm to the host, which have a minor regression. We hypothesize that this is because the old hand-written assembly trampolines did not maintain a call frame and do a tail call, but the new Cranelift-generated trampolines do maintain a call frame and do a regular call. The regression is only a couple nanoseconds, which seems well-explained by these differences explain, and ultimately is not a big deal.</p>
<p>However, this does lead to a ~5% code size regression for compiled modules. Before, we compiled a trampoline per escaping function's signature and we deduplicated these trampolines by signature. Now we compile two trampolines per escaping function: one for if the host calls via the array calling convention and one for it the host calls via the native calling convention. Additionally, we compile a trampoline for every type in the module, in case there is a native calling convention function from the host that we <code>call_indirect</code> of that type. Much of this is in the <code>.eh_frame</code> section in the compiled module, because each of our trampolines needs an entry there. Note that the <code>.eh_frame</code> section is not required for Wasmtime's correctness, and you can disable its generation to shrink compiled module code size; we just emit it to play nice with external unwinders and profilers. We believe there are code size gains available for follow up work to offset this code size regression in the future.</p>
<p>Backing up a bit: the reason each Wasm module needs to provide these Wasm-to-native trampolines is because <code>wasmtime::Func::wrap</code> and friends allow embedders to create functions even when there is no compiler available, so they cannot bring their own trampoline. Instead the Wasm module has to supply it. This in turn means that we need to look up and patch in these Wasm-to-native trampolines during roughly instantiation time. But instantiation is super hot, and we don't want to add more passes over imports or any extra work on this path. So we integrate with <code>wasmtime::InstancePre</code> to patch these trampolines in ahead of time.</p>
<p>&lt;!--<br>
Please make sure you include the following information:</p>
<ul>
<li>
<p>If this work has been discussed elsewhere, please include a link to that<br>
  conversation. If it was discussed in an issue, just mention "issue #...".</p>
</li>
<li>
<p>Explain why this change is needed. If the details are in an issue already,<br>
  this can be brief.</p>
</li>
</ul>
<p>Our development process is documented in the Wasmtime book:<br>
<a href="https://docs.wasmtime.dev/contributing-development-process.html">https://docs.wasmtime.dev/contributing-development-process.html</a></p>
<p>Please ensure all communication follows the code of conduct:<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>
--&gt;</p>
</blockquote>



<a name="351703133"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236262%20wasmtime%3A%20Overhaul%20trampolines/near/351703133" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236262.20wasmtime.3A.20Overhaul.20trampolines.html#351703133">(Apr 21 2023 at 18:21)</a>:</h4>
<p><strong>fitzgen</strong> requested <a href="https://github.com/abrown">abrown</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/6262">PR #6262</a>.</p>



<a name="351703134"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236262%20wasmtime%3A%20Overhaul%20trampolines/near/351703134" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236262.20wasmtime.3A.20Overhaul.20trampolines.html#351703134">(Apr 21 2023 at 18:21)</a>:</h4>
<p><strong>fitzgen</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-compiler-reviewers">wasmtime-compiler-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/6262">PR #6262</a>.</p>



<a name="351703137"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236262%20wasmtime%3A%20Overhaul%20trampolines/near/351703137" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236262.20wasmtime.3A.20Overhaul.20trampolines.html#351703137">(Apr 21 2023 at 18:21)</a>:</h4>
<p><strong>fitzgen</strong> requested <a href="https://github.com/pchickey">pchickey</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/6262">PR #6262</a>.</p>



<a name="351703139"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236262%20wasmtime%3A%20Overhaul%20trampolines/near/351703139" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236262.20wasmtime.3A.20Overhaul.20trampolines.html#351703139">(Apr 21 2023 at 18:21)</a>:</h4>
<p><strong>fitzgen</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/6262">PR #6262</a>.</p>



<a name="351703142"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236262%20wasmtime%3A%20Overhaul%20trampolines/near/351703142" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236262.20wasmtime.3A.20Overhaul.20trampolines.html#351703142">(Apr 21 2023 at 18:21)</a>:</h4>
<p><strong>fitzgen</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-default-reviewers">wasmtime-default-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/6262">PR #6262</a>.</p>



<a name="351703247"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236262%20wasmtime%3A%20Overhaul%20trampolines/near/351703247" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236262.20wasmtime.3A.20Overhaul.20trampolines.html#351703247">(Apr 21 2023 at 18:21)</a>:</h4>
<p><strong>fitzgen</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/6262">PR #6262</a>.</p>



<a name="351703563"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236262%20wasmtime%3A%20Overhaul%20trampolines/near/351703563" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236262.20wasmtime.3A.20Overhaul.20trampolines.html#351703563">(Apr 21 2023 at 18:23)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6262">PR #6262</a>.</p>



<a name="351705245"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236262%20wasmtime%3A%20Overhaul%20trampolines/near/351705245" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236262.20wasmtime.3A.20Overhaul.20trampolines.html#351705245">(Apr 21 2023 at 18:31)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6262">PR #6262</a>.</p>



<a name="351711880"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236262%20wasmtime%3A%20Overhaul%20trampolines/near/351711880" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236262.20wasmtime.3A.20Overhaul.20trampolines.html#351711880">(Apr 21 2023 at 19:04)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6262">PR #6262</a>.</p>



<a name="351716662"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236262%20wasmtime%3A%20Overhaul%20trampolines/near/351716662" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236262.20wasmtime.3A.20Overhaul.20trampolines.html#351716662">(Apr 21 2023 at 19:30)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6262">PR #6262</a>.</p>



<a name="351722402"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236262%20wasmtime%3A%20Overhaul%20trampolines/near/351722402" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236262.20wasmtime.3A.20Overhaul.20trampolines.html#351722402">(Apr 21 2023 at 20:03)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6262">PR #6262</a>.</p>



<a name="351745891"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236262%20wasmtime%3A%20Overhaul%20trampolines/near/351745891" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236262.20wasmtime.3A.20Overhaul.20trampolines.html#351745891">(Apr 21 2023 at 22:46)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6262#pullrequestreview-1396429044">PR review</a>.</p>



<a name="351745892"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236262%20wasmtime%3A%20Overhaul%20trampolines/near/351745892" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236262.20wasmtime.3A.20Overhaul.20trampolines.html#351745892">(Apr 21 2023 at 22:46)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6262#pullrequestreview-1396429044">PR review</a>.</p>



<a name="351745893"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236262%20wasmtime%3A%20Overhaul%20trampolines/near/351745893" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236262.20wasmtime.3A.20Overhaul.20trampolines.html#351745893">(Apr 21 2023 at 22:46)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/6262#discussion_r1174184961">PR review comment</a>:</p>
<blockquote>
<p>I feel like I'm surely going to forget to write this down, so could you update <code>RELEASES.md</code> in this PR with the various changes made? I'm imagining the <code>## Changed</code> section for this for example.</p>
</blockquote>



<a name="351745894"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236262%20wasmtime%3A%20Overhaul%20trampolines/near/351745894" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236262.20wasmtime.3A.20Overhaul.20trampolines.html#351745894">(Apr 21 2023 at 22:46)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/6262#discussion_r1174186335">PR review comment</a>:</p>
<blockquote>
<p>Could this construction of the callee be deduplicated with the above? (and perhaps with <code>call</code> too)</p>
</blockquote>



<a name="351745895"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236262%20wasmtime%3A%20Overhaul%20trampolines/near/351745895" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236262.20wasmtime.3A.20Overhaul.20trampolines.html#351745895">(Apr 21 2023 at 22:46)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/6262#discussion_r1174184407">PR review comment</a>:</p>
<blockquote>
<p>Mind adding a comment why these are added? Or otherwise leaving them out of this PR?</p>
</blockquote>



<a name="351745896"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236262%20wasmtime%3A%20Overhaul%20trampolines/near/351745896" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236262.20wasmtime.3A.20Overhaul.20trampolines.html#351745896">(Apr 21 2023 at 22:46)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/6262#discussion_r1174188778">PR review comment</a>:</p>
<blockquote>
<p>Should this perhaps be <code>#[doc(hidden)]</code>? (this'll end up in the <code>wasmtime</code> crate)</p>
</blockquote>



<a name="351745897"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236262%20wasmtime%3A%20Overhaul%20trampolines/near/351745897" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236262.20wasmtime.3A.20Overhaul.20trampolines.html#351745897">(Apr 21 2023 at 22:46)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/6262#discussion_r1174185657">PR review comment</a>:</p>
<blockquote>
<p>Could this be preemptively extracted to a helper function?</p>
</blockquote>



<a name="351745898"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236262%20wasmtime%3A%20Overhaul%20trampolines/near/351745898" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236262.20wasmtime.3A.20Overhaul.20trampolines.html#351745898">(Apr 21 2023 at 22:46)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/6262#discussion_r1174187636">PR review comment</a>:</p>
<blockquote>
<p>I think this may be the s390x issue as this'll want to be a native-endian load</p>
</blockquote>



<a name="351745899"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236262%20wasmtime%3A%20Overhaul%20trampolines/near/351745899" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236262.20wasmtime.3A.20Overhaul.20trampolines.html#351745899">(Apr 21 2023 at 22:46)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/6262#discussion_r1174189830">PR review comment</a>:</p>
<blockquote>
<p>Mind adding a note here about this being sorted as well?</p>
</blockquote>



<a name="351745900"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236262%20wasmtime%3A%20Overhaul%20trampolines/near/351745900" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236262.20wasmtime.3A.20Overhaul.20trampolines.html#351745900">(Apr 21 2023 at 22:46)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/6262#discussion_r1174195937">PR review comment</a>:</p>
<blockquote>
<p>TODO</p>
</blockquote>



<a name="351745901"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236262%20wasmtime%3A%20Overhaul%20trampolines/near/351745901" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236262.20wasmtime.3A.20Overhaul.20trampolines.html#351745901">(Apr 21 2023 at 22:46)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/6262#discussion_r1174189748">PR review comment</a>:</p>
<blockquote>
<p>To cut down on the encoding space necessary for this, could these two arrays get fused? And to go a bit further could this perhaps be stored in the <code>funcs</code> array directly?</p>
</blockquote>



<a name="351745902"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236262%20wasmtime%3A%20Overhaul%20trampolines/near/351745902" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236262.20wasmtime.3A.20Overhaul.20trampolines.html#351745902">(Apr 21 2023 at 22:46)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/6262#discussion_r1174196959">PR review comment</a>:</p>
<blockquote>
<p>It's probably ok to jettison this now</p>
</blockquote>



<a name="351745903"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236262%20wasmtime%3A%20Overhaul%20trampolines/near/351745903" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236262.20wasmtime.3A.20Overhaul.20trampolines.html#351745903">(Apr 21 2023 at 22:46)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/6262#discussion_r1174198759">PR review comment</a>:</p>
<blockquote>
<p>Could this and the two types below have some more documentation about the ABI? E.g. for the structs below a definition of the ABI and for this function pointer a definition of what each of the arguments are?</p>
</blockquote>



<a name="351745904"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236262%20wasmtime%3A%20Overhaul%20trampolines/near/351745904" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236262.20wasmtime.3A.20Overhaul.20trampolines.html#351745904">(Apr 21 2023 at 22:46)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/6262#discussion_r1174198402">PR review comment</a>:</p>
<blockquote>
<p>Could the inner field here be made private?</p>
</blockquote>



<a name="351745905"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236262%20wasmtime%3A%20Overhaul%20trampolines/near/351745905" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236262.20wasmtime.3A.20Overhaul.20trampolines.html#351745905">(Apr 21 2023 at 22:46)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/6262#discussion_r1174199735">PR review comment</a>:</p>
<blockquote>
<p>Looks like this file became executable?</p>
</blockquote>



<a name="351745906"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236262%20wasmtime%3A%20Overhaul%20trampolines/near/351745906" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236262.20wasmtime.3A.20Overhaul.20trampolines.html#351745906">(Apr 21 2023 at 22:46)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/6262#discussion_r1174199416">PR review comment</a>:</p>
<blockquote>
<p>The large doc block above about why this can be <code>None</code> I think might be good to insert here instead?</p>
</blockquote>



<a name="351745907"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236262%20wasmtime%3A%20Overhaul%20trampolines/near/351745907" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236262.20wasmtime.3A.20Overhaul.20trampolines.html#351745907">(Apr 21 2023 at 22:46)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/6262#discussion_r1174199669">PR review comment</a>:</p>
<blockquote>
<p>Could the reformatting here and below be undone?</p>
</blockquote>



<a name="351745908"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236262%20wasmtime%3A%20Overhaul%20trampolines/near/351745908" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236262.20wasmtime.3A.20Overhaul.20trampolines.html#351745908">(Apr 21 2023 at 22:46)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/6262#discussion_r1174199007">PR review comment</a>:</p>
<blockquote>
<p>Shouldn't this always be <code>Some(...)</code> by the time it reaches the <code>VMFunctionImport</code> phase? </p>
</blockquote>



<a name="351745909"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236262%20wasmtime%3A%20Overhaul%20trampolines/near/351745909" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236262.20wasmtime.3A.20Overhaul.20trampolines.html#351745909">(Apr 21 2023 at 22:46)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/6262#discussion_r1174201423">PR review comment</a>:</p>
<blockquote>
<p>I worry about this because it can accidentally paper over non-send/sync in <code>kind: FuncKind</code> and <code>ty: Option&lt;Box&lt;FuncType&gt;&gt;</code>. The latter is probably tested elsewhere but there's not a ton of protection here against <code>FuncKind</code>.</p>
<p>I don't have a great way to solve this other than unergonomic wrappers, but I'd probably still prefer that to the impl here on the whole struct.</p>
</blockquote>



<a name="351745910"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236262%20wasmtime%3A%20Overhaul%20trampolines/near/351745910" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236262.20wasmtime.3A.20Overhaul.20trampolines.html#351745910">(Apr 21 2023 at 22:46)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/6262#discussion_r1174202052">PR review comment</a>:</p>
<blockquote>
<p>I know we split this into a two-phase operation, but given that the push/fill is always back-to-back it may be better to just remove this <code>fill_func_refs</code> perhaps? (folding it into the push operation that is)</p>
</blockquote>



<a name="351745911"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236262%20wasmtime%3A%20Overhaul%20trampolines/near/351745911" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236262.20wasmtime.3A.20Overhaul.20trampolines.html#351745911">(Apr 21 2023 at 22:46)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/6262#discussion_r1174206371">PR review comment</a>:</p>
<blockquote>
<p>In retrospect given that this isn't really perf critical or used all that often, perhaps this would be better as a simple <code>Vec&lt;Box&lt;....&gt;&gt;</code>?</p>
</blockquote>



<a name="351745912"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236262%20wasmtime%3A%20Overhaul%20trampolines/near/351745912" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236262.20wasmtime.3A.20Overhaul.20trampolines.html#351745912">(Apr 21 2023 at 22:46)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/6262#discussion_r1174195186">PR review comment</a>:</p>
<blockquote>
<p>I think the only use case for this is the profilers, and they don't have a great use for this. The profilers already have a lot of duplication of looking at all of these trampolines which isn't great, too.</p>
<p>This is fine to defer to another PR, but I wanted to write this down: these should all get removed and all the profilers should switch to using <a href="https://github.com/bytecodealliance/wasmtime/blob/43ec4816f1280086987a6743d06368a606406bea/crates/wasmtime/src/trampoline/func.rs#L74-L103">this logic</a> which generically reads an ELF file and registers everything. There's specific support for DWARF in the jitdump profiler but I think that's all best removed at this point.</p>
<p>Again, future PR, just want to leave a reminder to myself to do this or open an issue later.</p>
</blockquote>



<a name="351745913"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236262%20wasmtime%3A%20Overhaul%20trampolines/near/351745913" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236262.20wasmtime.3A.20Overhaul.20trampolines.html#351745913">(Apr 21 2023 at 22:46)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/6262#discussion_r1174204495">PR review comment</a>:</p>
<blockquote>
<p>Like with <code>FuncData</code>, this feels a bit too broad to me. Could these impls be placed on <code>VMCallerCheckedFuncRef</code> instead?</p>
</blockquote>



<a name="351745915"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236262%20wasmtime%3A%20Overhaul%20trampolines/near/351745915" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236262.20wasmtime.3A.20Overhaul.20trampolines.html#351745915">(Apr 21 2023 at 22:46)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/6262#discussion_r1174208998">PR review comment</a>:</p>
<blockquote>
<p>cc @saulecabrera we opted to leave these as <code>todo!()</code> in winch, but this effectively breaks compilation with winch in Wasmtime (and tests are additionally disabled lower in this PR).</p>
<p>Is that ok with you though?</p>
</blockquote>



<a name="351745916"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236262%20wasmtime%3A%20Overhaul%20trampolines/near/351745916" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236262.20wasmtime.3A.20Overhaul.20trampolines.html#351745916">(Apr 21 2023 at 22:46)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/6262#discussion_r1174206814">PR review comment</a>:</p>
<blockquote>
<p>Like the above comments, I think this should be removed in favor of something more targeted ideally.</p>
</blockquote>



<a name="351745917"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236262%20wasmtime%3A%20Overhaul%20trampolines/near/351745917" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236262.20wasmtime.3A.20Overhaul.20trampolines.html#351745917">(Apr 21 2023 at 22:46)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/6262#discussion_r1174202988">PR review comment</a>:</p>
<blockquote>
<p>Also, could you add documentation about this parameter? Mostly that this isn't "number of arguments" but rather "capacity of the <code>args_and_results</code> area" which I realize is perhaps obvious given the name but is not necessarily obvious given that this is generally a "call a function" function where one typically expects to pass a list of arguments.</p>
</blockquote>



<a name="351745918"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236262%20wasmtime%3A%20Overhaul%20trampolines/near/351745918" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236262.20wasmtime.3A.20Overhaul.20trampolines.html#351745918">(Apr 21 2023 at 22:46)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/6262#discussion_r1174188889">PR review comment</a>:</p>
<blockquote>
<p>Or should we perhaps <code>abort()</code> if this ever gets seen?</p>
</blockquote>



<a name="351747871"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236262%20wasmtime%3A%20Overhaul%20trampolines/near/351747871" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236262.20wasmtime.3A.20Overhaul.20trampolines.html#351747871">(Apr 21 2023 at 23:02)</a>:</h4>
<p>saulecabrera created <a href="https://github.com/bytecodealliance/wasmtime/pull/6262#discussion_r1174215478">PR review comment</a>:</p>
<blockquote>
<p>That's ok with me, thanks for the heads up. I'll work on the new version of the trampolines for winch once this PR lands. </p>
</blockquote>



<a name="352364360"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236262%20wasmtime%3A%20Overhaul%20trampolines/near/352364360" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236262.20wasmtime.3A.20Overhaul.20trampolines.html#352364360">(Apr 24 2023 at 19:28)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/6262#discussion_r1175699605">PR review comment</a>:</p>
<blockquote>
<p>Because we don't have a trampoline for every function, these have to become <code>Option</code>s in the <code>funcs</code> array, and while it is a code size win, it is only 0.0160605% savings on <code>spidermonkey.wasm</code>. Nonetheless I kind of like the rearranged structure anyways, since looking up a trampoline is an O(1) operation now.</p>
</blockquote>



<a name="352364535"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236262%20wasmtime%3A%20Overhaul%20trampolines/near/352364535" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236262.20wasmtime.3A.20Overhaul.20trampolines.html#352364535">(Apr 24 2023 at 19:29)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/6262#discussion_r1175700726">PR review comment</a>:</p>
<blockquote>
<p>I'll do this in a follow up.</p>
</blockquote>



<a name="352364760"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236262%20wasmtime%3A%20Overhaul%20trampolines/near/352364760" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236262.20wasmtime.3A.20Overhaul.20trampolines.html#352364760">(Apr 24 2023 at 19:31)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/6262#discussion_r1175702061">PR review comment</a>:</p>
<blockquote>
<p>Eh, I'd rather just keep it around until we completely remove the asm trampolines.</p>
</blockquote>



<a name="352367255"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236262%20wasmtime%3A%20Overhaul%20trampolines/near/352367255" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236262.20wasmtime.3A.20Overhaul.20trampolines.html#352367255">(Apr 24 2023 at 19:46)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/6262#discussion_r1175714919">PR review comment</a>:</p>
<blockquote>
<p>Oh good call, because the case that the above comment is talking about can't happen with function imports, only <code>funcref</code>s.</p>
</blockquote>



<a name="352373023"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236262%20wasmtime%3A%20Overhaul%20trampolines/near/352373023" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236262.20wasmtime.3A.20Overhaul.20trampolines.html#352373023">(Apr 24 2023 at 20:24)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/6262#discussion_r1175748548">PR review comment</a>:</p>
<blockquote>
<p>Ah unfortunately the borrows don't really work out becuase <code>store</code> is already borrowed immutably for the <code>func_refs()</code> method and so we can't also get and pass in the store's module registry.</p>
</blockquote>



<a name="352380580"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236262%20wasmtime%3A%20Overhaul%20trampolines/near/352380580" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236262.20wasmtime.3A.20Overhaul.20trampolines.html#352380580">(Apr 24 2023 at 21:15)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/6262#discussion_r1175788822">PR review comment</a>:</p>
<blockquote>
<p>Eh, it is still used whenever passing <code>funcref</code>s into Wasm via any method other than function imports that are pre-resolved in <code>InstancePre</code>. That is a lot of paths, even if it isn't the hottest path. Since we've already got it, I'm inclined to leave it.</p>
</blockquote>



<a name="352384630"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236262%20wasmtime%3A%20Overhaul%20trampolines/near/352384630" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236262.20wasmtime.3A.20Overhaul.20trampolines.html#352384630">(Apr 24 2023 at 21:46)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/6262#discussion_r1175811101">PR review comment</a>:</p>
<blockquote>
<p>Ah yes, sorry I meant to tag you @saulecabrera but I forgot. Thanks for your help getting this PR landed, and willingness to work on follow ups!</p>
</blockquote>



<a name="352389269"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236262%20wasmtime%3A%20Overhaul%20trampolines/near/352389269" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236262.20wasmtime.3A.20Overhaul.20trampolines.html#352389269">(Apr 24 2023 at 22:25)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6262">PR #6262</a>.</p>



<a name="352635048"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236262%20wasmtime%3A%20Overhaul%20trampolines/near/352635048" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236262.20wasmtime.3A.20Overhaul.20trampolines.html#352635048">(Apr 25 2023 at 20:35)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6262">PR #6262</a>.</p>



<a name="352635102"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236262%20wasmtime%3A%20Overhaul%20trampolines/near/352635102" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236262.20wasmtime.3A.20Overhaul.20trampolines.html#352635102">(Apr 25 2023 at 20:35)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6262#pullrequestreview-1400711109">PR review</a>.</p>



<a name="352635146"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236262%20wasmtime%3A%20Overhaul%20trampolines/near/352635146" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236262.20wasmtime.3A.20Overhaul.20trampolines.html#352635146">(Apr 25 2023 at 20:35)</a>:</h4>
<p>fitzgen has enabled auto merge for <a href="https://github.com/bytecodealliance/wasmtime/pull/6262">PR #6262</a>.</p>



<a name="353410939"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236262%20wasmtime%3A%20Overhaul%20trampolines/near/353410939" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236262.20wasmtime.3A.20Overhaul.20trampolines.html#353410939">(Apr 27 2023 at 17:32)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6262">PR #6262</a>.</p>



<a name="353441382"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236262%20wasmtime%3A%20Overhaul%20trampolines/near/353441382" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236262.20wasmtime.3A.20Overhaul.20trampolines.html#353441382">(Apr 27 2023 at 18:45)</a>:</h4>
<p>fitzgen merged <a href="https://github.com/bytecodealliance/wasmtime/pull/6262">PR #6262</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>