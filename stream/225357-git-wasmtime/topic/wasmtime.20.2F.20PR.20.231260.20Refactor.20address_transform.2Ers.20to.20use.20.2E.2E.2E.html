<html>
<head><meta charset="utf-8"><title>wasmtime / PR #1260 Refactor address_transform.rs to use ... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231260.20Refactor.20address_transform.2Ers.20to.20use.20.2E.2E.2E.html">wasmtime / PR #1260 Refactor address_transform.rs to use ...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="190071474"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231260%20Refactor%20address_transform.rs%20to%20use%20.../near/190071474" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231260.20Refactor.20address_transform.2Ers.20to.20use.20.2E.2E.2E.html#190071474">(Mar 09 2020 at 14:03)</a>:</h4>
<p>yurydelendik opened <a href="https://github.com/bytecodealliance/wasmtime/pull/1260" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1260">PR #1260</a> from <code>refactor-addr-transform</code> to <code>master</code>:</p>
<blockquote>
<p>The crates/debug/src/transform/address_transform.rs is unoptimized in terms of data structures. This PR refactors this file to remove creation of intermediate in-heap structures, thus improves overall performance of the DWARF transformation.</p>
</blockquote>



<a name="190328454"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231260%20Refactor%20address_transform.rs%20to%20use%20.../near/190328454" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231260.20Refactor.20address_transform.2Ers.20to.20use.20.2E.2E.2E.html#190328454">(Mar 11 2020 at 20:35)</a>:</h4>
<p>yurydelendik updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1260" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1260">PR #1260</a> from <code>refactor-addr-transform</code> to <code>master</code>:</p>
<blockquote>
<p>The crates/debug/src/transform/address_transform.rs is unoptimized in terms of data structures. This PR refactors this file to remove creation of intermediate in-heap structures, thus improves overall performance of the DWARF transformation.</p>
</blockquote>



<a name="190598744"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231260%20Refactor%20address_transform.rs%20to%20use%20.../near/190598744" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231260.20Refactor.20address_transform.2Ers.20to.20use.20.2E.2E.2E.html#190598744">(Mar 14 2020 at 14:07)</a>:</h4>
<p>yurydelendik updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1260" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1260">PR #1260</a> from <code>refactor-addr-transform</code> to <code>master</code>:</p>
<blockquote>
<p>The crates/debug/src/transform/address_transform.rs is unoptimized in terms of data structures. This PR refactors this file to remove creation of intermediate in-heap structures, thus improves overall performance of the DWARF transformation.</p>
</blockquote>



<a name="190598786"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231260%20Refactor%20address_transform.rs%20to%20use%20.../near/190598786" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231260.20Refactor.20address_transform.2Ers.20to.20use.20.2E.2E.2E.html#190598786">(Mar 14 2020 at 14:08)</a>:</h4>
<p><strong>yurydelendik</strong> requested <a href="https://github.com/fitzgen" target="_blank" title="https://github.com/fitzgen">fitzgen</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/1260" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1260">PR #1260</a>.</p>



<a name="190757193"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231260%20Refactor%20address_transform.rs%20to%20use%20.../near/190757193" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231260.20Refactor.20address_transform.2Ers.20to.20use.20.2E.2E.2E.html#190757193">(Mar 16 2020 at 17:42)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1260#pullrequestreview-375429191" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1260#pullrequestreview-375429191">PR Review</a>.</p>



<a name="190757194"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231260%20Refactor%20address_transform.rs%20to%20use%20.../near/190757194" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231260.20Refactor.20address_transform.2Ers.20to.20use.20.2E.2E.2E.html#190757194">(Mar 16 2020 at 17:42)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/1260#discussion_r393189567" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1260#discussion_r393189567">PR Review Comment</a>:</p>
<blockquote>
<p>I wonder if we could make this a <code>u32</code> in practice? Do we ever have to process Wasm files larger than 4GiB?</p>
<p>This would let us shave off half the overhead on 64-bit platforms.</p>
</blockquote>



<a name="190757195"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231260%20Refactor%20address_transform.rs%20to%20use%20.../near/190757195" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231260.20Refactor.20address_transform.2Ers.20to.20use.20.2E.2E.2E.html#190757195">(Mar 16 2020 at 17:42)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/1260#discussion_r393196988" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1260#discussion_r393196988">PR Review Comment</a>:</p>
<blockquote>
<p>Rather than having our index be a <code>BTreeMap&lt;WasmAddress, Box&lt;[RangeIndex]&gt;</code>, which implies a bunch of allocated boxed slices that are all relatively small and potentially contribute to internal and/or external memory fragmentation, we should be able to save some memory by doing:</p>
<div class="codehilite"><pre><span></span><span class="n">index_ranges</span>: <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">RangeIndex</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
<span class="c1">// A map from the wasm address to the range within `index_ranges` for the associated wasm address.</span>
<span class="n">index</span>: <span class="nc">BTreeMap</span><span class="o">&lt;</span><span class="n">WasmAddress</span><span class="p">,</span><span class="w"> </span><span class="n">std</span>::<span class="n">ops</span>::<span class="n">Range</span><span class="o">&lt;</span><span class="kt">usize</span><span class="o">&gt;&gt;</span><span class="p">,</span><span class="w"></span>
</pre></div>


<p>Also if we can get away with it, we could make it a <code>Range&lt;u32&gt;</code> for extra savings.</p>
<p>To do this, rather than inserting <code>sorted_ranges</code> into the <code>index</code> here, we would do something like:</p>
<div class="codehilite"><pre><span></span><span class="kd">let</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all_ranges</span><span class="p">.</span><span class="n">len</span><span class="p">();</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sorted_ranges</span><span class="p">.</span><span class="n">len</span><span class="p">();</span><span class="w"></span>
<span class="n">index_ranges</span><span class="p">.</span><span class="n">extend</span><span class="p">(</span><span class="n">sorted_ranges</span><span class="p">);</span><span class="w"></span>
<span class="n">index</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">position</span><span class="p">,</span><span class="w"> </span><span class="n">start</span><span class="p">..</span><span class="n">end</span><span class="p">);</span><span class="w"></span>
</pre></div>


</blockquote>



<a name="190757196"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231260%20Refactor%20address_transform.rs%20to%20use%20.../near/190757196" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231260.20Refactor.20address_transform.2Ers.20to.20use.20.2E.2E.2E.html#190757196">(Mar 16 2020 at 17:42)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/1260#discussion_r393198589" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1260#discussion_r393198589">PR Review Comment</a>:</p>
<blockquote>
<p>And the same here?</p>
</blockquote>



<a name="190757197"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231260%20Refactor%20address_transform.rs%20to%20use%20.../near/190757197" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231260.20Refactor.20address_transform.2Ers.20to.20use.20.2E.2E.2E.html#190757197">(Mar 16 2020 at 17:42)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/1260#discussion_r393198421" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1260#discussion_r393198421">PR Review Comment</a>:</p>
<blockquote>
<p>Should this be <code>(WasmAddress, RangeIndex)</code>?</p>
</blockquote>



<a name="190757198"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231260%20Refactor%20address_transform.rs%20to%20use%20.../near/190757198" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231260.20Refactor.20address_transform.2Ers.20to.20use.20.2E.2E.2E.html#190757198">(Mar 16 2020 at 17:42)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1260#pullrequestreview-375429191" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1260#pullrequestreview-375429191">PR Review</a>.</p>



<a name="191493488"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231260%20Refactor%20address_transform.rs%20to%20use%20.../near/191493488" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231260.20Refactor.20address_transform.2Ers.20to.20use.20.2E.2E.2E.html#191493488">(Mar 23 2020 at 15:51)</a>:</h4>
<p>yurydelendik updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1260" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1260">PR #1260</a> from <code>refactor-addr-transform</code> to <code>master</code>:</p>
<blockquote>
<p>The crates/debug/src/transform/address_transform.rs is unoptimized in terms of data structures. This PR refactors this file to remove creation of intermediate in-heap structures, thus improves overall performance of the DWARF transformation.</p>
</blockquote>



<a name="191511337"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231260%20Refactor%20address_transform.rs%20to%20use%20.../near/191511337" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231260.20Refactor.20address_transform.2Ers.20to.20use.20.2E.2E.2E.html#191511337">(Mar 23 2020 at 17:51)</a>:</h4>
<p>yurydelendik updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1260" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1260">PR #1260</a> from <code>refactor-addr-transform</code> to <code>master</code>:</p>
<blockquote>
<p>The crates/debug/src/transform/address_transform.rs is unoptimized in terms of data structures. This PR refactors this file to remove creation of intermediate in-heap structures, thus improves overall performance of the DWARF transformation.</p>
</blockquote>



<a name="191532431"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231260%20Refactor%20address_transform.rs%20to%20use%20.../near/191532431" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231260.20Refactor.20address_transform.2Ers.20to.20use.20.2E.2E.2E.html#191532431">(Mar 23 2020 at 20:34)</a>:</h4>
<p>yurydelendik updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1260" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1260">PR #1260</a> from <code>refactor-addr-transform</code> to <code>master</code>:</p>
<blockquote>
<p>The crates/debug/src/transform/address_transform.rs is unoptimized in terms of data structures. This PR refactors this file to remove creation of intermediate in-heap structures, thus improves overall performance of the DWARF transformation.</p>
</blockquote>



<a name="191532819"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231260%20Refactor%20address_transform.rs%20to%20use%20.../near/191532819" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231260.20Refactor.20address_transform.2Ers.20to.20use.20.2E.2E.2E.html#191532819">(Mar 23 2020 at 20:37)</a>:</h4>
<p>yurydelendik updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1260" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1260">PR #1260</a> from <code>refactor-addr-transform</code> to <code>master</code>:</p>
<blockquote>
<p>The crates/debug/src/transform/address_transform.rs is unoptimized in terms of data structures. This PR refactors this file to remove creation of intermediate in-heap structures, thus improves overall performance of the DWARF transformation.</p>
</blockquote>



<a name="191540105"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231260%20Refactor%20address_transform.rs%20to%20use%20.../near/191540105" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231260.20Refactor.20address_transform.2Ers.20to.20use.20.2E.2E.2E.html#191540105">(Mar 23 2020 at 21:36)</a>:</h4>
<p>yurydelendik merged <a href="https://github.com/bytecodealliance/wasmtime/pull/1260" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1260">PR #1260</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>