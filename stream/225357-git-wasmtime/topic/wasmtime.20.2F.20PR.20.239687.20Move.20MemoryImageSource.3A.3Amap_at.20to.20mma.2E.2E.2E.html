<html>
<head><meta charset="utf-8"><title>wasmtime / PR #9687 Move MemoryImageSource::map_at to mma... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239687.20Move.20MemoryImageSource.3A.3Amap_at.20to.20mma.2E.2E.2E.html">wasmtime / PR #9687 Move MemoryImageSource::map_at to mma...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="486606051"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239687%20Move%20MemoryImageSource%3A%3Amap_at%20to%20mma.../near/486606051" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239687.20Move.20MemoryImageSource.3A.3Amap_at.20to.20mma.2E.2E.2E.html#486606051">(Dec 06 2024 at 22:45)</a>:</h4>
<p>sunshowers edited <a href="https://github.com/bytecodealliance/wasmtime/pull/9687">PR #9687</a>.</p>



<a name="486606203"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239687%20Move%20MemoryImageSource%3A%3Amap_at%20to%20mma.../near/486606203" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239687.20Move.20MemoryImageSource.3A.3Amap_at.20to.20mma.2E.2E.2E.html#486606203">(Dec 06 2024 at 22:47)</a>:</h4>
<p>sunshowers updated <a href="https://github.com/bytecodealliance/wasmtime/pull/9687">PR #9687</a>.</p>



<a name="486606239"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239687%20Move%20MemoryImageSource%3A%3Amap_at%20to%20mma.../near/486606239" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239687.20Move.20MemoryImageSource.3A.3Amap_at.20to.20mma.2E.2E.2E.html#486606239">(Dec 06 2024 at 22:47)</a>:</h4>
<p>sunshowers edited <a href="https://github.com/bytecodealliance/wasmtime/pull/9687">PR #9687</a>:</p>
<blockquote>
<p>This is part of the work to centralize memory management into the <code>mmap</code><br>
module. This commit introduces a few structures which aid in that process, and<br>
starts converting one of the functions (<code>MemoryImageSource::map_at</code>) into this<br>
module.</p>
<p>The structures introduced are:</p>
<ul>
<li>
<p><code>MemoryBase</code>: <code>RuntimeLinearMemory::base_ptr</code> is now<br>
<code>RuntimeLinearMemory::base</code>, which returns a <code>MemoryBase</code>. This is either a<br>
  raw pointer or an <code>MmapOffset</code> as described below.</p>
</li>
<li>
<p><code>MmapOffset</code>: A combination of a reference to an mmap and an offset into it.<br>
  Logically represents a pointer into a mapped section of memory.</p>
</li>
</ul>
<p>In future work, we'll move more image-mapping code over to <code>Mmap</code> instances.</p>
</blockquote>



<a name="486606956"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239687%20Move%20MemoryImageSource%3A%3Amap_at%20to%20mma.../near/486606956" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239687.20Move.20MemoryImageSource.3A.3Amap_at.20to.20mma.2E.2E.2E.html#486606956">(Dec 06 2024 at 22:54)</a>:</h4>
<p>sunshowers submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9687#pullrequestreview-2486091302">PR review</a>.</p>



<a name="486606957"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239687%20Move%20MemoryImageSource%3A%3Amap_at%20to%20mma.../near/486606957" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239687.20Move.20MemoryImageSource.3A.3Amap_at.20to.20mma.2E.2E.2E.html#486606957">(Dec 06 2024 at 22:54)</a>:</h4>
<p>sunshowers created <a href="https://github.com/bytecodealliance/wasmtime/pull/9687#discussion_r1874099153">PR review comment</a>:</p>
<blockquote>
<p>Oh, and adding a <code>Drop</code> impl identified the problem with <code>unwrap_static_image</code>, haha, since you can't move out of a type when there's a <code>Drop</code> impl.</p>
</blockquote>



<a name="486608100"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239687%20Move%20MemoryImageSource%3A%3Amap_at%20to%20mma.../near/486608100" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239687.20Move.20MemoryImageSource.3A.3Amap_at.20to.20mma.2E.2E.2E.html#486608100">(Dec 06 2024 at 23:06)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9687#pullrequestreview-2486101354">PR review</a>.</p>



<a name="486608102"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239687%20Move%20MemoryImageSource%3A%3Amap_at%20to%20mma.../near/486608102" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239687.20Move.20MemoryImageSource.3A.3Amap_at.20to.20mma.2E.2E.2E.html#486608102">(Dec 06 2024 at 23:06)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/9687#discussion_r1874106031">PR review comment</a>:</p>
<blockquote>
<p>Ah ok that all makes sense to me yeah, thanks for checking!</p>
</blockquote>



<a name="486610237"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239687%20Move%20MemoryImageSource%3A%3Amap_at%20to%20mma.../near/486610237" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239687.20Move.20MemoryImageSource.3A.3Amap_at.20to.20mma.2E.2E.2E.html#486610237">(Dec 06 2024 at 23:30)</a>:</h4>
<p>sunshowers <a href="https://github.com/bytecodealliance/wasmtime/pull/9687#issuecomment-2524618684">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/9687">PR #9687</a>:</p>
<blockquote>
<p>Fixing the issues</p>
</blockquote>



<a name="486610589"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239687%20Move%20MemoryImageSource%3A%3Amap_at%20to%20mma.../near/486610589" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239687.20Move.20MemoryImageSource.3A.3Amap_at.20to.20mma.2E.2E.2E.html#486610589">(Dec 06 2024 at 23:34)</a>:</h4>
<p>sunshowers updated <a href="https://github.com/bytecodealliance/wasmtime/pull/9687">PR #9687</a>.</p>



<a name="486610729"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239687%20Move%20MemoryImageSource%3A%3Amap_at%20to%20mma.../near/486610729" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239687.20Move.20MemoryImageSource.3A.3Amap_at.20to.20mma.2E.2E.2E.html#486610729">(Dec 06 2024 at 23:36)</a>:</h4>
<p>sunshowers <a href="https://github.com/bytecodealliance/wasmtime/pull/9687#issuecomment-2524629618">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/9687">PR #9687</a>:</p>
<blockquote>
<p>Hmm, actually I want to rename the os-specific Mmap <code>as_ptr</code> instances.</p>
</blockquote>



<a name="486611075"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239687%20Move%20MemoryImageSource%3A%3Amap_at%20to%20mma.../near/486611075" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239687.20Move.20MemoryImageSource.3A.3Amap_at.20to.20mma.2E.2E.2E.html#486611075">(Dec 06 2024 at 23:40)</a>:</h4>
<p>sunshowers updated <a href="https://github.com/bytecodealliance/wasmtime/pull/9687">PR #9687</a>.</p>



<a name="486611145"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239687%20Move%20MemoryImageSource%3A%3Amap_at%20to%20mma.../near/486611145" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239687.20Move.20MemoryImageSource.3A.3Amap_at.20to.20mma.2E.2E.2E.html#486611145">(Dec 06 2024 at 23:41)</a>:</h4>
<p>sunshowers submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9687#pullrequestreview-2486147550">PR review</a>.</p>



<a name="486611146"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239687%20Move%20MemoryImageSource%3A%3Amap_at%20to%20mma.../near/486611146" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239687.20Move.20MemoryImageSource.3A.3Amap_at.20to.20mma.2E.2E.2E.html#486611146">(Dec 06 2024 at 23:41)</a>:</h4>
<p>sunshowers created <a href="https://github.com/bytecodealliance/wasmtime/pull/9687#discussion_r1874135614">PR review comment</a>:</p>
<blockquote>
<p>Changed some of this code's pointer typology (though not the arithmetic) -- would be worth a look.</p>
</blockquote>



<a name="486613452"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239687%20Move%20MemoryImageSource%3A%3Amap_at%20to%20mma.../near/486613452" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239687.20Move.20MemoryImageSource.3A.3Amap_at.20to.20mma.2E.2E.2E.html#486613452">(Dec 07 2024 at 00:07)</a>:</h4>
<p>alexcrichton merged <a href="https://github.com/bytecodealliance/wasmtime/pull/9687">PR #9687</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>