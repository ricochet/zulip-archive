<html>
<head><meta charset="utf-8"><title>wasmtime / PR #6343 test: fix some `wasi_testsuite` cases · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236343.20test.3A.20fix.20some.20.60wasi_testsuite.60.20cases.html">wasmtime / PR #6343 test: fix some `wasi_testsuite` cases</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="355888464"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236343%20test%3A%20fix%20some%20%60wasi_testsuite%60%20cases/near/355888464" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236343.20test.3A.20fix.20some.20.60wasi_testsuite.60.20cases.html#355888464">(May 04 2023 at 21:28)</a>:</h4>
<p>abrown opened <a href="https://github.com/bytecodealliance/wasmtime/pull/6343">PR #6343</a> from <code>abrown:fix-some-wasi-tests</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>After thinking about this some more, I took another look at fixing some issues with the test cases. By doing the following, many more test cases now pass:</p>
<ul>
<li>this change cleans up garbage files created by the test</li>
<li>this change also fixes how directories are mapped, using <code>--mapdir</code> instead of <code>--dir</code><br>
See the commit messages for more detail.</li>
</ul>
</blockquote>



<a name="355888466"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236343%20test%3A%20fix%20some%20%60wasi_testsuite%60%20cases/near/355888466" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236343.20test.3A.20fix.20some.20.60wasi_testsuite.60.20cases.html#355888466">(May 04 2023 at 21:28)</a>:</h4>
<p><strong>abrown</strong> requested <a href="https://github.com/fitzgen">fitzgen</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/6343">PR #6343</a>.</p>



<a name="355888468"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236343%20test%3A%20fix%20some%20%60wasi_testsuite%60%20cases/near/355888468" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236343.20test.3A.20fix.20some.20.60wasi_testsuite.60.20cases.html#355888468">(May 04 2023 at 21:28)</a>:</h4>
<p><strong>abrown</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/6343">PR #6343</a>.</p>



<a name="355888509"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236343%20test%3A%20fix%20some%20%60wasi_testsuite%60%20cases/near/355888509" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236343.20test.3A.20fix.20some.20.60wasi_testsuite.60.20cases.html#355888509">(May 04 2023 at 21:29)</a>:</h4>
<p>abrown edited <a href="https://github.com/bytecodealliance/wasmtime/pull/6343">PR #6343</a>:</p>
<blockquote>
<p>After thinking about this some more, I took another look at fixing some issues with the test cases. By doing the following, many more test cases now pass:</p>
<ul>
<li>this change cleans up garbage files created by the test</li>
<li>this change also fixes how directories are mapped, using <code>--mapdir</code> instead of <code>--dir</code></li>
</ul>
<p>See the commit messages for more detail.</p>
</blockquote>



<a name="355889424"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236343%20test%3A%20fix%20some%20%60wasi_testsuite%60%20cases/near/355889424" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236343.20test.3A.20fix.20some.20.60wasi_testsuite.60.20cases.html#355889424">(May 04 2023 at 21:36)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6343#pullrequestreview-1413957339">PR review</a>.</p>



<a name="355889426"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236343%20test%3A%20fix%20some%20%60wasi_testsuite%60%20cases/near/355889426" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236343.20test.3A.20fix.20some.20.60wasi_testsuite.60.20cases.html#355889426">(May 04 2023 at 21:36)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6343#pullrequestreview-1413957339">PR review</a>.</p>



<a name="355889427"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236343%20test%3A%20fix%20some%20%60wasi_testsuite%60%20cases/near/355889427" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236343.20test.3A.20fix.20some.20.60wasi_testsuite.60.20cases.html#355889427">(May 04 2023 at 21:36)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/6343#discussion_r1185541513">PR review comment</a>:</p>
<blockquote>
<p>Instead of passing the raw directory in the spec test suite to each test, could the directory perhaps be copied to a temporary location and have the test run against that? That way the temporary directory clean up would removing any extra files and the <code>clean_garbage</code> filtering may not be necessary?</p>
<p>Alternatively though explicitly cleaning out files I think is ok, and if this is how the test suite runs upstream I think it's fine to mirror that as well.</p>
</blockquote>



<a name="355891543"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236343%20test%3A%20fix%20some%20%60wasi_testsuite%60%20cases/near/355891543" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236343.20test.3A.20fix.20some.20.60wasi_testsuite.60.20cases.html#355891543">(May 04 2023 at 21:51)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/6343#discussion_r1185551006">PR review comment</a>:</p>
<blockquote>
<p>Well, right now I believe the other <code>wasi-testsuite</code> test runner (the Python one) expects to clean up any <code>*.cleanup</code> files so I propose we stick with that for now. I opened <a href="https://github.com/WebAssembly/wasi-testsuite/pull/74">https://github.com/WebAssembly/wasi-testsuite/pull/74</a> to actually right down what a test runner should do and I added a comment there about this. How about we change this logic once we decide what to do there?</p>
</blockquote>



<a name="355891571"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236343%20test%3A%20fix%20some%20%60wasi_testsuite%60%20cases/near/355891571" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236343.20test.3A.20fix.20some.20.60wasi_testsuite.60.20cases.html#355891571">(May 04 2023 at 21:51)</a>:</h4>
<p>abrown edited <a href="https://github.com/bytecodealliance/wasmtime/pull/6343#discussion_r1185551006">PR review comment</a>.</p>



<a name="355903581"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236343%20test%3A%20fix%20some%20%60wasi_testsuite%60%20cases/near/355903581" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236343.20test.3A.20fix.20some.20.60wasi_testsuite.60.20cases.html#355903581">(May 04 2023 at 23:33)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/6343#discussion_r1185600459">PR review comment</a>:</p>
<blockquote>
<p>Sounds good to me <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span> </p>
</blockquote>



<a name="355917128"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236343%20test%3A%20fix%20some%20%60wasi_testsuite%60%20cases/near/355917128" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236343.20test.3A.20fix.20some.20.60wasi_testsuite.60.20cases.html#355917128">(May 05 2023 at 01:41)</a>:</h4>
<p>abrown merged <a href="https://github.com/bytecodealliance/wasmtime/pull/6343">PR #6343</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>