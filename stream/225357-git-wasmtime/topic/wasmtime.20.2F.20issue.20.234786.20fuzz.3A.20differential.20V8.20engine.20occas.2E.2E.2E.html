<html>
<head><meta charset="utf-8"><title>wasmtime / issue #4786 fuzz: differential V8 engine occas... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234786.20fuzz.3A.20differential.20V8.20engine.20occas.2E.2E.2E.html">wasmtime / issue #4786 fuzz: differential V8 engine occas...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="295299873"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234786%20fuzz%3A%20differential%20V8%20engine%20occas.../near/295299873" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234786.20fuzz.3A.20differential.20V8.20engine.20occas.2E.2E.2E.html#295299873">(Aug 25 2022 at 19:47)</a>:</h4>
<p>abrown labeled <a href="https://github.com/bytecodealliance/wasmtime/issues/4786">issue #4786</a>:</p>
<blockquote>
<h3>Test Case</h3>
<p>No test case produced.</p>
<h3>Steps to Reproduce</h3>
<div class="codehilite" data-code-language="Bash Session"><pre><span></span><code><span class="gp">$ </span><span class="nv">ALLOWED_ENGINES</span><span class="o">=</span>-spec,-wasmi cargo +nightly fuzz run differential -s none
</code></pre></div>
<p>Run for enough time to crash.</p>
<h3>Expected Results</h3>
<p>Not to crash.</p>
<h3>Actual Results</h3>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="o">..</span><span class="p">.</span><span class="w"></span>
<span class="o">===</span><span class="w"> </span><span class="n">Execution</span><span class="w"> </span><span class="n">rate</span><span class="w"> </span><span class="p">(</span><span class="mi">1023</span><span class="w"> </span><span class="n">successes</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">6000</span><span class="w"> </span><span class="n">attempted</span><span class="w"> </span><span class="n">modules</span><span class="p">)</span>: <span class="mf">17.05</span><span class="o">%</span><span class="w"> </span><span class="o">===</span><span class="w"></span>
<span class="w">        </span><span class="n">wasmi</span>: <span class="mf">0.00</span><span class="o">%</span><span class="p">,</span><span class="w"> </span><span class="n">spec</span>: <span class="mf">0.00</span><span class="o">%</span><span class="p">,</span><span class="w"> </span><span class="n">wasmtime</span>: <span class="mf">87.70</span><span class="o">%</span><span class="p">,</span><span class="w"> </span><span class="n">v8</span>: <span class="mf">12.30</span><span class="o">%</span><span class="w"></span>
<span class="w">        </span><span class="n">wasm</span><span class="o">-</span><span class="n">smith</span>: <span class="mf">44.81</span><span class="o">%</span><span class="p">,</span><span class="w"> </span><span class="n">single</span><span class="o">-</span><span class="n">inst</span>: <span class="mf">55.19</span><span class="o">%</span><span class="w"></span>
<span class="o">..</span><span class="p">.</span><span class="w"></span>
#<span class="mi">6851</span><span class="w">   </span><span class="n">NEW</span><span class="w">    </span><span class="n">cov</span>: <span class="mi">20559</span><span class="w"> </span><span class="n">ft</span>: <span class="mi">63794</span><span class="w"> </span><span class="n">corp</span>: <span class="mi">1188</span><span class="o">/</span><span class="mi">146</span><span class="n">Kb</span><span class="w"> </span><span class="n">lim</span>: <span class="mi">170</span><span class="w"> </span><span class="n">exec</span><span class="o">/</span><span class="n">s</span>: <span class="mi">360</span><span class="w"> </span><span class="n">rss</span>: <span class="mi">106</span><span class="n">Mb</span><span class="w"> </span><span class="n">L</span>: <span class="mi">138</span><span class="o">/</span><span class="mi">170</span><span class="w"> </span><span class="n">MS</span>: <span class="mi">2</span><span class="w"> </span><span class="n">CopyPart</span><span class="o">-</span><span class="n">CopyPart</span><span class="o">-</span><span class="w"></span>
#<span class="mi">6862</span><span class="w">   </span><span class="n">NEW</span><span class="w">    </span><span class="n">cov</span>: <span class="mi">20559</span><span class="w"> </span><span class="n">ft</span>: <span class="mi">63795</span><span class="w"> </span><span class="n">corp</span>: <span class="mi">1189</span><span class="o">/</span><span class="mi">146</span><span class="n">Kb</span><span class="w"> </span><span class="n">lim</span>: <span class="mi">170</span><span class="w"> </span><span class="n">exec</span><span class="o">/</span><span class="n">s</span>: <span class="mi">361</span><span class="w"> </span><span class="n">rss</span>: <span class="mi">106</span><span class="n">Mb</span><span class="w"> </span><span class="n">L</span>: <span class="mi">132</span><span class="o">/</span><span class="mi">170</span><span class="w"> </span><span class="n">MS</span>: <span class="mi">1</span><span class="w"> </span><span class="n">CopyPart</span><span class="o">-</span><span class="w"></span>
#<span class="mi">6864</span><span class="w">   </span><span class="n">NEW</span><span class="w">    </span><span class="n">cov</span>: <span class="mi">20560</span><span class="w"> </span><span class="n">ft</span>: <span class="mi">63796</span><span class="w"> </span><span class="n">corp</span>: <span class="mi">1190</span><span class="o">/</span><span class="mi">146</span><span class="n">Kb</span><span class="w"> </span><span class="n">lim</span>: <span class="mi">170</span><span class="w"> </span><span class="n">exec</span><span class="o">/</span><span class="n">s</span>: <span class="mi">361</span><span class="w"> </span><span class="n">rss</span>: <span class="mi">106</span><span class="n">Mb</span><span class="w"> </span><span class="n">L</span>: <span class="mi">103</span><span class="o">/</span><span class="mi">170</span><span class="w"> </span><span class="n">MS</span>: <span class="mi">2</span><span class="w"> </span><span class="n">EraseBytes</span><span class="o">-</span><span class="n">ChangeBit</span><span class="o">-</span><span class="w"></span>
#<span class="mi">6869</span><span class="w">   </span><span class="n">NEW</span><span class="w">    </span><span class="n">cov</span>: <span class="mi">20563</span><span class="w"> </span><span class="n">ft</span>: <span class="mi">63809</span><span class="w"> </span><span class="n">corp</span>: <span class="mi">1191</span><span class="o">/</span><span class="mi">146</span><span class="n">Kb</span><span class="w"> </span><span class="n">lim</span>: <span class="mi">170</span><span class="w"> </span><span class="n">exec</span><span class="o">/</span><span class="n">s</span>: <span class="mi">361</span><span class="w"> </span><span class="n">rss</span>: <span class="mi">106</span><span class="n">Mb</span><span class="w"> </span><span class="n">L</span>: <span class="mi">169</span><span class="o">/</span><span class="mi">170</span><span class="w"> </span><span class="n">MS</span>: <span class="mi">5</span><span class="w"> </span><span class="n">ShuffleBytes</span><span class="o">-</span><span class="n">InsertRepeatedBytes</span><span class="o">-</span><span class="n">InsertRepeatedBytes</span><span class="o">-</span><span class="n">ShuffleBytes</span><span class="o">-</span><span class="n">PersAutoDict</span><span class="o">-</span><span class="w"> </span><span class="n">DE</span>: <span class="s">"\xff\xff\xff</span><span class="se">\x07</span><span class="s">"</span><span class="o">-</span><span class="w"></span>
#<span class="mi">6988</span><span class="w">   </span><span class="n">NEW</span><span class="w">    </span><span class="n">cov</span>: <span class="mi">20563</span><span class="w"> </span><span class="n">ft</span>: <span class="mi">63838</span><span class="w"> </span><span class="n">corp</span>: <span class="mi">1192</span><span class="o">/</span><span class="mi">146</span><span class="n">Kb</span><span class="w"> </span><span class="n">lim</span>: <span class="mi">170</span><span class="w"> </span><span class="n">exec</span><span class="o">/</span><span class="n">s</span>: <span class="mi">349</span><span class="w"> </span><span class="n">rss</span>: <span class="mi">106</span><span class="n">Mb</span><span class="w"> </span><span class="n">L</span>: <span class="mi">129</span><span class="o">/</span><span class="mi">170</span><span class="w"> </span><span class="n">MS</span>: <span class="mi">4</span><span class="w"> </span><span class="n">InsertRepeatedBytes</span><span class="o">-</span><span class="n">ChangeBit</span><span class="o">-</span><span class="n">EraseBytes</span><span class="o">-</span><span class="n">InsertRepeatedBytes</span><span class="o">-</span><span class="w"></span>
<span class="err">────────────────────────────────────────────────────────────────────────────────</span><span class="w"></span>

<span class="n">Error</span>: <span class="nc">Fuzz</span><span class="w"> </span><span class="n">target</span><span class="w"> </span><span class="n">exited</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">signal</span>: <span class="mi">11</span><span class="w"> </span><span class="p">(</span><span class="n">core</span><span class="w"> </span><span class="n">dumped</span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<h3>Versions and Environment</h3>
<p>Wasmtime version or commit: <code>main</code></p>
<p>Operating system: Fedora 35</p>
<p>Architecture: x86_64</p>
</blockquote>



<a name="295299874"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234786%20fuzz%3A%20differential%20V8%20engine%20occas.../near/295299874" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234786.20fuzz.3A.20differential.20V8.20engine.20occas.2E.2E.2E.html#295299874">(Aug 25 2022 at 19:47)</a>:</h4>
<p>abrown opened <a href="https://github.com/bytecodealliance/wasmtime/issues/4786">issue #4786</a>:</p>
<blockquote>
<h3>Test Case</h3>
<p>No test case produced.</p>
<h3>Steps to Reproduce</h3>
<div class="codehilite" data-code-language="Bash Session"><pre><span></span><code><span class="gp">$ </span><span class="nv">ALLOWED_ENGINES</span><span class="o">=</span>-spec,-wasmi cargo +nightly fuzz run differential -s none
</code></pre></div>
<p>Run for enough time to crash.</p>
<h3>Expected Results</h3>
<p>Not to crash.</p>
<h3>Actual Results</h3>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="o">..</span><span class="p">.</span><span class="w"></span>
<span class="o">===</span><span class="w"> </span><span class="n">Execution</span><span class="w"> </span><span class="n">rate</span><span class="w"> </span><span class="p">(</span><span class="mi">1023</span><span class="w"> </span><span class="n">successes</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">6000</span><span class="w"> </span><span class="n">attempted</span><span class="w"> </span><span class="n">modules</span><span class="p">)</span>: <span class="mf">17.05</span><span class="o">%</span><span class="w"> </span><span class="o">===</span><span class="w"></span>
<span class="w">        </span><span class="n">wasmi</span>: <span class="mf">0.00</span><span class="o">%</span><span class="p">,</span><span class="w"> </span><span class="n">spec</span>: <span class="mf">0.00</span><span class="o">%</span><span class="p">,</span><span class="w"> </span><span class="n">wasmtime</span>: <span class="mf">87.70</span><span class="o">%</span><span class="p">,</span><span class="w"> </span><span class="n">v8</span>: <span class="mf">12.30</span><span class="o">%</span><span class="w"></span>
<span class="w">        </span><span class="n">wasm</span><span class="o">-</span><span class="n">smith</span>: <span class="mf">44.81</span><span class="o">%</span><span class="p">,</span><span class="w"> </span><span class="n">single</span><span class="o">-</span><span class="n">inst</span>: <span class="mf">55.19</span><span class="o">%</span><span class="w"></span>
<span class="o">..</span><span class="p">.</span><span class="w"></span>
#<span class="mi">6851</span><span class="w">   </span><span class="n">NEW</span><span class="w">    </span><span class="n">cov</span>: <span class="mi">20559</span><span class="w"> </span><span class="n">ft</span>: <span class="mi">63794</span><span class="w"> </span><span class="n">corp</span>: <span class="mi">1188</span><span class="o">/</span><span class="mi">146</span><span class="n">Kb</span><span class="w"> </span><span class="n">lim</span>: <span class="mi">170</span><span class="w"> </span><span class="n">exec</span><span class="o">/</span><span class="n">s</span>: <span class="mi">360</span><span class="w"> </span><span class="n">rss</span>: <span class="mi">106</span><span class="n">Mb</span><span class="w"> </span><span class="n">L</span>: <span class="mi">138</span><span class="o">/</span><span class="mi">170</span><span class="w"> </span><span class="n">MS</span>: <span class="mi">2</span><span class="w"> </span><span class="n">CopyPart</span><span class="o">-</span><span class="n">CopyPart</span><span class="o">-</span><span class="w"></span>
#<span class="mi">6862</span><span class="w">   </span><span class="n">NEW</span><span class="w">    </span><span class="n">cov</span>: <span class="mi">20559</span><span class="w"> </span><span class="n">ft</span>: <span class="mi">63795</span><span class="w"> </span><span class="n">corp</span>: <span class="mi">1189</span><span class="o">/</span><span class="mi">146</span><span class="n">Kb</span><span class="w"> </span><span class="n">lim</span>: <span class="mi">170</span><span class="w"> </span><span class="n">exec</span><span class="o">/</span><span class="n">s</span>: <span class="mi">361</span><span class="w"> </span><span class="n">rss</span>: <span class="mi">106</span><span class="n">Mb</span><span class="w"> </span><span class="n">L</span>: <span class="mi">132</span><span class="o">/</span><span class="mi">170</span><span class="w"> </span><span class="n">MS</span>: <span class="mi">1</span><span class="w"> </span><span class="n">CopyPart</span><span class="o">-</span><span class="w"></span>
#<span class="mi">6864</span><span class="w">   </span><span class="n">NEW</span><span class="w">    </span><span class="n">cov</span>: <span class="mi">20560</span><span class="w"> </span><span class="n">ft</span>: <span class="mi">63796</span><span class="w"> </span><span class="n">corp</span>: <span class="mi">1190</span><span class="o">/</span><span class="mi">146</span><span class="n">Kb</span><span class="w"> </span><span class="n">lim</span>: <span class="mi">170</span><span class="w"> </span><span class="n">exec</span><span class="o">/</span><span class="n">s</span>: <span class="mi">361</span><span class="w"> </span><span class="n">rss</span>: <span class="mi">106</span><span class="n">Mb</span><span class="w"> </span><span class="n">L</span>: <span class="mi">103</span><span class="o">/</span><span class="mi">170</span><span class="w"> </span><span class="n">MS</span>: <span class="mi">2</span><span class="w"> </span><span class="n">EraseBytes</span><span class="o">-</span><span class="n">ChangeBit</span><span class="o">-</span><span class="w"></span>
#<span class="mi">6869</span><span class="w">   </span><span class="n">NEW</span><span class="w">    </span><span class="n">cov</span>: <span class="mi">20563</span><span class="w"> </span><span class="n">ft</span>: <span class="mi">63809</span><span class="w"> </span><span class="n">corp</span>: <span class="mi">1191</span><span class="o">/</span><span class="mi">146</span><span class="n">Kb</span><span class="w"> </span><span class="n">lim</span>: <span class="mi">170</span><span class="w"> </span><span class="n">exec</span><span class="o">/</span><span class="n">s</span>: <span class="mi">361</span><span class="w"> </span><span class="n">rss</span>: <span class="mi">106</span><span class="n">Mb</span><span class="w"> </span><span class="n">L</span>: <span class="mi">169</span><span class="o">/</span><span class="mi">170</span><span class="w"> </span><span class="n">MS</span>: <span class="mi">5</span><span class="w"> </span><span class="n">ShuffleBytes</span><span class="o">-</span><span class="n">InsertRepeatedBytes</span><span class="o">-</span><span class="n">InsertRepeatedBytes</span><span class="o">-</span><span class="n">ShuffleBytes</span><span class="o">-</span><span class="n">PersAutoDict</span><span class="o">-</span><span class="w"> </span><span class="n">DE</span>: <span class="s">"\xff\xff\xff</span><span class="se">\x07</span><span class="s">"</span><span class="o">-</span><span class="w"></span>
#<span class="mi">6988</span><span class="w">   </span><span class="n">NEW</span><span class="w">    </span><span class="n">cov</span>: <span class="mi">20563</span><span class="w"> </span><span class="n">ft</span>: <span class="mi">63838</span><span class="w"> </span><span class="n">corp</span>: <span class="mi">1192</span><span class="o">/</span><span class="mi">146</span><span class="n">Kb</span><span class="w"> </span><span class="n">lim</span>: <span class="mi">170</span><span class="w"> </span><span class="n">exec</span><span class="o">/</span><span class="n">s</span>: <span class="mi">349</span><span class="w"> </span><span class="n">rss</span>: <span class="mi">106</span><span class="n">Mb</span><span class="w"> </span><span class="n">L</span>: <span class="mi">129</span><span class="o">/</span><span class="mi">170</span><span class="w"> </span><span class="n">MS</span>: <span class="mi">4</span><span class="w"> </span><span class="n">InsertRepeatedBytes</span><span class="o">-</span><span class="n">ChangeBit</span><span class="o">-</span><span class="n">EraseBytes</span><span class="o">-</span><span class="n">InsertRepeatedBytes</span><span class="o">-</span><span class="w"></span>
<span class="err">────────────────────────────────────────────────────────────────────────────────</span><span class="w"></span>

<span class="n">Error</span>: <span class="nc">Fuzz</span><span class="w"> </span><span class="n">target</span><span class="w"> </span><span class="n">exited</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">signal</span>: <span class="mi">11</span><span class="w"> </span><span class="p">(</span><span class="n">core</span><span class="w"> </span><span class="n">dumped</span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<h3>Versions and Environment</h3>
<p>Wasmtime version or commit: <code>main</code></p>
<p>Operating system: Fedora 35</p>
<p>Architecture: x86_64</p>
</blockquote>



<a name="295299997"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234786%20fuzz%3A%20differential%20V8%20engine%20occas.../near/295299997" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234786.20fuzz.3A.20differential.20V8.20engine.20occas.2E.2E.2E.html#295299997">(Aug 25 2022 at 19:48)</a>:</h4>
<p>abrown <a href="https://github.com/bytecodealliance/wasmtime/issues/4786#issuecomment-1227691776">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/4786">issue #4786</a>:</p>
<blockquote>
<p>cc: @alexcrichton, guess that crash we saw wasn't the <code>spec</code> interpreter after all.</p>
</blockquote>



<a name="295300029"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234786%20fuzz%3A%20differential%20V8%20engine%20occas.../near/295300029" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234786.20fuzz.3A.20differential.20V8.20engine.20occas.2E.2E.2E.html#295300029">(Aug 25 2022 at 19:48)</a>:</h4>
<p>abrown labeled <a href="https://github.com/bytecodealliance/wasmtime/issues/4786">issue #4786</a>:</p>
<blockquote>
<h3>Test Case</h3>
<p>No test case produced.</p>
<h3>Steps to Reproduce</h3>
<div class="codehilite" data-code-language="Bash Session"><pre><span></span><code><span class="gp">$ </span><span class="nv">ALLOWED_ENGINES</span><span class="o">=</span>-spec,-wasmi cargo +nightly fuzz run differential -s none
</code></pre></div>
<p>Run for enough time to crash.</p>
<h3>Expected Results</h3>
<p>Not to crash.</p>
<h3>Actual Results</h3>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="o">..</span><span class="p">.</span><span class="w"></span>
<span class="o">===</span><span class="w"> </span><span class="n">Execution</span><span class="w"> </span><span class="n">rate</span><span class="w"> </span><span class="p">(</span><span class="mi">1023</span><span class="w"> </span><span class="n">successes</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">6000</span><span class="w"> </span><span class="n">attempted</span><span class="w"> </span><span class="n">modules</span><span class="p">)</span>: <span class="mf">17.05</span><span class="o">%</span><span class="w"> </span><span class="o">===</span><span class="w"></span>
<span class="w">        </span><span class="n">wasmi</span>: <span class="mf">0.00</span><span class="o">%</span><span class="p">,</span><span class="w"> </span><span class="n">spec</span>: <span class="mf">0.00</span><span class="o">%</span><span class="p">,</span><span class="w"> </span><span class="n">wasmtime</span>: <span class="mf">87.70</span><span class="o">%</span><span class="p">,</span><span class="w"> </span><span class="n">v8</span>: <span class="mf">12.30</span><span class="o">%</span><span class="w"></span>
<span class="w">        </span><span class="n">wasm</span><span class="o">-</span><span class="n">smith</span>: <span class="mf">44.81</span><span class="o">%</span><span class="p">,</span><span class="w"> </span><span class="n">single</span><span class="o">-</span><span class="n">inst</span>: <span class="mf">55.19</span><span class="o">%</span><span class="w"></span>
<span class="o">..</span><span class="p">.</span><span class="w"></span>
#<span class="mi">6851</span><span class="w">   </span><span class="n">NEW</span><span class="w">    </span><span class="n">cov</span>: <span class="mi">20559</span><span class="w"> </span><span class="n">ft</span>: <span class="mi">63794</span><span class="w"> </span><span class="n">corp</span>: <span class="mi">1188</span><span class="o">/</span><span class="mi">146</span><span class="n">Kb</span><span class="w"> </span><span class="n">lim</span>: <span class="mi">170</span><span class="w"> </span><span class="n">exec</span><span class="o">/</span><span class="n">s</span>: <span class="mi">360</span><span class="w"> </span><span class="n">rss</span>: <span class="mi">106</span><span class="n">Mb</span><span class="w"> </span><span class="n">L</span>: <span class="mi">138</span><span class="o">/</span><span class="mi">170</span><span class="w"> </span><span class="n">MS</span>: <span class="mi">2</span><span class="w"> </span><span class="n">CopyPart</span><span class="o">-</span><span class="n">CopyPart</span><span class="o">-</span><span class="w"></span>
#<span class="mi">6862</span><span class="w">   </span><span class="n">NEW</span><span class="w">    </span><span class="n">cov</span>: <span class="mi">20559</span><span class="w"> </span><span class="n">ft</span>: <span class="mi">63795</span><span class="w"> </span><span class="n">corp</span>: <span class="mi">1189</span><span class="o">/</span><span class="mi">146</span><span class="n">Kb</span><span class="w"> </span><span class="n">lim</span>: <span class="mi">170</span><span class="w"> </span><span class="n">exec</span><span class="o">/</span><span class="n">s</span>: <span class="mi">361</span><span class="w"> </span><span class="n">rss</span>: <span class="mi">106</span><span class="n">Mb</span><span class="w"> </span><span class="n">L</span>: <span class="mi">132</span><span class="o">/</span><span class="mi">170</span><span class="w"> </span><span class="n">MS</span>: <span class="mi">1</span><span class="w"> </span><span class="n">CopyPart</span><span class="o">-</span><span class="w"></span>
#<span class="mi">6864</span><span class="w">   </span><span class="n">NEW</span><span class="w">    </span><span class="n">cov</span>: <span class="mi">20560</span><span class="w"> </span><span class="n">ft</span>: <span class="mi">63796</span><span class="w"> </span><span class="n">corp</span>: <span class="mi">1190</span><span class="o">/</span><span class="mi">146</span><span class="n">Kb</span><span class="w"> </span><span class="n">lim</span>: <span class="mi">170</span><span class="w"> </span><span class="n">exec</span><span class="o">/</span><span class="n">s</span>: <span class="mi">361</span><span class="w"> </span><span class="n">rss</span>: <span class="mi">106</span><span class="n">Mb</span><span class="w"> </span><span class="n">L</span>: <span class="mi">103</span><span class="o">/</span><span class="mi">170</span><span class="w"> </span><span class="n">MS</span>: <span class="mi">2</span><span class="w"> </span><span class="n">EraseBytes</span><span class="o">-</span><span class="n">ChangeBit</span><span class="o">-</span><span class="w"></span>
#<span class="mi">6869</span><span class="w">   </span><span class="n">NEW</span><span class="w">    </span><span class="n">cov</span>: <span class="mi">20563</span><span class="w"> </span><span class="n">ft</span>: <span class="mi">63809</span><span class="w"> </span><span class="n">corp</span>: <span class="mi">1191</span><span class="o">/</span><span class="mi">146</span><span class="n">Kb</span><span class="w"> </span><span class="n">lim</span>: <span class="mi">170</span><span class="w"> </span><span class="n">exec</span><span class="o">/</span><span class="n">s</span>: <span class="mi">361</span><span class="w"> </span><span class="n">rss</span>: <span class="mi">106</span><span class="n">Mb</span><span class="w"> </span><span class="n">L</span>: <span class="mi">169</span><span class="o">/</span><span class="mi">170</span><span class="w"> </span><span class="n">MS</span>: <span class="mi">5</span><span class="w"> </span><span class="n">ShuffleBytes</span><span class="o">-</span><span class="n">InsertRepeatedBytes</span><span class="o">-</span><span class="n">InsertRepeatedBytes</span><span class="o">-</span><span class="n">ShuffleBytes</span><span class="o">-</span><span class="n">PersAutoDict</span><span class="o">-</span><span class="w"> </span><span class="n">DE</span>: <span class="s">"\xff\xff\xff</span><span class="se">\x07</span><span class="s">"</span><span class="o">-</span><span class="w"></span>
#<span class="mi">6988</span><span class="w">   </span><span class="n">NEW</span><span class="w">    </span><span class="n">cov</span>: <span class="mi">20563</span><span class="w"> </span><span class="n">ft</span>: <span class="mi">63838</span><span class="w"> </span><span class="n">corp</span>: <span class="mi">1192</span><span class="o">/</span><span class="mi">146</span><span class="n">Kb</span><span class="w"> </span><span class="n">lim</span>: <span class="mi">170</span><span class="w"> </span><span class="n">exec</span><span class="o">/</span><span class="n">s</span>: <span class="mi">349</span><span class="w"> </span><span class="n">rss</span>: <span class="mi">106</span><span class="n">Mb</span><span class="w"> </span><span class="n">L</span>: <span class="mi">129</span><span class="o">/</span><span class="mi">170</span><span class="w"> </span><span class="n">MS</span>: <span class="mi">4</span><span class="w"> </span><span class="n">InsertRepeatedBytes</span><span class="o">-</span><span class="n">ChangeBit</span><span class="o">-</span><span class="n">EraseBytes</span><span class="o">-</span><span class="n">InsertRepeatedBytes</span><span class="o">-</span><span class="w"></span>
<span class="err">────────────────────────────────────────────────────────────────────────────────</span><span class="w"></span>

<span class="n">Error</span>: <span class="nc">Fuzz</span><span class="w"> </span><span class="n">target</span><span class="w"> </span><span class="n">exited</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">signal</span>: <span class="mi">11</span><span class="w"> </span><span class="p">(</span><span class="n">core</span><span class="w"> </span><span class="n">dumped</span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<h3>Versions and Environment</h3>
<p>Wasmtime version or commit: <code>main</code></p>
<p>Operating system: Fedora 35</p>
<p>Architecture: x86_64</p>
</blockquote>



<a name="296032816"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234786%20fuzz%3A%20differential%20V8%20engine%20occas.../near/296032816" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234786.20fuzz.3A.20differential.20V8.20engine.20occas.2E.2E.2E.html#296032816">(Aug 30 2022 at 04:12)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/4786#issuecomment-1231118682">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/4786">issue #4786</a>:</p>
<blockquote>
<p>I haven't been able to reproduce this locally unfortunately. When I let the fuzzer run long enough it hit <a href="https://github.com/bytecodealliance/wasmtime/issues/4812">https://github.com/bytecodealliance/wasmtime/issues/4812</a> before hitting this fault. </p>
<p>Can you try running the fuzzer in <code>gdb</code> to see if you can grab a stack trace of the fault? (presuming it doesn't take too long to fault). When using <code>gdb</code> though it's difficult b/c segfaults can normally happen for wasm and there's no great way to handle this. I was able to do <code>handle SIGILL nostop</code> locally in gdb but if you do <code>handle SIGSEGV nostop</code> I think that when it actually hits the crashing failure it lets the process exit which is no good, so you may have to babysit it a bit and double-check that <code>SIGSEGV</code> doesn't look like a normal wasm SIGSEGV (<code>rr</code> might be super helpful here in this regard)</p>
</blockquote>



<a name="296050724"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234786%20fuzz%3A%20differential%20V8%20engine%20occas.../near/296050724" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234786.20fuzz.3A.20differential.20V8.20engine.20occas.2E.2E.2E.html#296050724">(Aug 30 2022 at 07:38)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/issues/4786#issuecomment-1231269890">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/4786">issue #4786</a>:</p>
<blockquote>
<p>Maybe you can do <code>handle SIGSEGV nostop</code> but also add a breakpoint where the signal handler propagates the SIGSEGV if it didn't originate from the wasm module?</p>
</blockquote>



<a name="476467157"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234786%20fuzz%3A%20differential%20V8%20engine%20occas.../near/476467157" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234786.20fuzz.3A.20differential.20V8.20engine.20occas.2E.2E.2E.html#476467157">(Oct 11 2024 at 22:21)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/4786#issuecomment-2408191300">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/4786">issue #4786</a>:</p>
<blockquote>
<p>I've been unable to fuzz with v8 locally for the longest time so I tried to dig into this today. Turns out it's an issue with memory protection keys so this'll only affect new enough x64 hardware with new enough glibc. That I think would explain why Andrew initially ran into this and I couldn't reproduce. I think that would also help explain why it hasn't showed up on oss-fuzz at all despite being trivial to reproduce locally.</p>
<p>My best read of the situation is that if you run with v8 and differential fuzzing long enough locally it will eventually crash. This crash, when I've inspected it, always looks like this:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Thread</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="s">"differential"</span><span class="w"> </span><span class="n">received</span><span class="w"> </span><span class="n">signal</span><span class="w"> </span><span class="n">SIGSEGV</span><span class="p">,</span><span class="w"> </span><span class="n">Segmentation</span><span class="w"> </span><span class="n">fault</span><span class="p">.</span>
<span class="mh">0x00002061775c8170</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="p">()</span>
<span class="p">(</span><span class="n">gdb</span><span class="p">)</span><span class="w"> </span><span class="n">disas</span><span class="w"> </span><span class="cp">$rip</span><span class="p">,</span><span class="cp">$rip</span><span class="o">+</span><span class="mi">20</span>
<span class="n">Dump</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">assembler</span><span class="w"> </span><span class="n">code</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="mh">0x2061775c8170</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="mh">0x2061775c8184</span><span class="p">:</span>
<span class="o">=&gt;</span><span class="w"> </span><span class="mh">0x00002061775c8170</span><span class="p">:</span><span class="w">  </span><span class="nc">jmp</span><span class="w">    </span><span class="o">*</span><span class="mh">0x2</span><span class="p">(</span><span class="o">%</span><span class="n">rip</span><span class="p">)</span><span class="w">        </span><span class="p">#</span><span class="w"> </span><span class="mh">0x2061775c8178</span>
</code></pre></div>
<p>The memory being accessed is just below <code>%rip</code> itself, and the memory address of 0x00002061775c8178 is indeed readable in gdb. This is in fact an indirect jump to <code>Builtins_WasmLiftoffFrameSetup</code> all the time. The problem is that if you print <code>$_siginfo.si_code</code> in gdb it yields 4 which corresponds to <code>SEGV_PKUERR</code>.</p>
<p>So the problem here is that JIT code isn't allowed to read this code due to MPK and the status of the PKRU. The corruption here seems to be:</p>
<ul>
<li>V8 looks like it uses a single pkey at most.</li>
<li>This is entirely unrelated to Wasmtime's PKRU support, if that's disabled the issue still happens.</li>
<li>V8 assumes that JIT code executes with pkey 1.</li>
<li>V8 uses pkeys to disallow writes to JIT code with pkey 1.</li>
<li>V8 assumes a steady-state of pkey 1 is accessible (executable/readable) but not writable</li>
<li>V8, when it modifies JIT code, frobs the PKRU to teporarily allow writes</li>
</ul>
<p>This is all fine and dandy and Wasmtime shouldn't interfere with it, except it does. The problem is apparently signal handlers (it's always signal handlers). V8 assumes a steady-state PKRU register of 0x5...58. That means no access to keys &gt;=2, readonly/executable access to pkey 1, and all access to pkey 0. When a signal is received, however, it resets the PKRU register to 0x5..54. This notably disables access to all keys &gt;=1, disagreeing with V8's steady state.</p>
<p>The problem here is that when Wasmtime executes, hits a signal, recovers, and goes back into V8, now V8 is in a corrupt state. V8 thinks JIT code can access pkey 1, but it in fact cannot. A reproduction of this problem can be found in <a href="https://gist.github.com/alexcrichton/7cecadbefa938a4f53b6aaf166fe68ec">this gist</a> which uses the <code>v8</code> crate to run some code, then a segfault is generated and caught, then code is run again. This second execution crashes.</p>
<hr>
<p>Ok so what to do about this. I found that <code>v8::V8::set_flags_from_string("--no-memory_protection_keys")</code> looks promising. That fixes the standalone test case here but it causes V8 to segfault in a different location when passed during fuzzing. According to the <a href="https://www.man7.org/linux/man-pages/man7/pkeys.7.html">man page</a> about pkeys signal handlers need to manually restore the state after they're received. Looks like <code>sig{set,long}jmp</code> don't solve this automatically.</p>
<p>I have run out of ideas of how to fix this. If OSS-Fuzz picks up hardware with MPK we'll probably have to disable differential execution with v8 if nothing else changes. </p>
</blockquote>



<a name="476467535"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234786%20fuzz%3A%20differential%20V8%20engine%20occas.../near/476467535" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234786.20fuzz.3A.20differential.20V8.20engine.20occas.2E.2E.2E.html#476467535">(Oct 11 2024 at 22:26)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/4786#issuecomment-2408195016">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/4786">issue #4786</a>:</p>
<blockquote>
<blockquote>
<p>That fixes the standalone test case here but it causes V8 to segfault in a different location when passed during fuzzing.</p>
</blockquote>
<p>Looks like this flag doesn't fully disable MPK. The crash is in V8 with <code>si_code = 4</code> which shows pkey misconfiguration again. So looks like that flag only partially disables MPK.</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>