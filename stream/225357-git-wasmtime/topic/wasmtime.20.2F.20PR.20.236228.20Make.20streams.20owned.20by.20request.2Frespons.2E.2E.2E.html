<html>
<head><meta charset="utf-8"><title>wasmtime / PR #6228 Make streams owned by request/respons... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236228.20Make.20streams.20owned.20by.20request.2Frespons.2E.2E.2E.html">wasmtime / PR #6228 Make streams owned by request/respons...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="350666691"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236228%20Make%20streams%20owned%20by%20request/respons.../near/350666691" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236228.20Make.20streams.20owned.20by.20request.2Frespons.2E.2E.2E.html#350666691">(Apr 18 2023 at 04:15)</a>:</h4>
<p>brendandburns opened <a href="https://github.com/bytecodealliance/wasmtime/pull/6228">PR #6228</a> from <code>brendandburns:ptr</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>This is related to the discussion here: <a href="https://github.com/WebAssembly/wasi-http/issues/24">https://github.com/WebAssembly/wasi-http/issues/24</a></p>
<p>Where we decided that streams should be <code>child-own</code> properties of the request or response that they are tied to.</p>
<p>This adds clarity to when it is valid to drop an input or output stream and in what order relative to the response.</p>
</blockquote>



<a name="350666692"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236228%20Make%20streams%20owned%20by%20request/respons.../near/350666692" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236228.20Make.20streams.20owned.20by.20request.2Frespons.2E.2E.2E.html#350666692">(Apr 18 2023 at 04:15)</a>:</h4>
<p><strong>brendandburns</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/6228">PR #6228</a>.</p>



<a name="350666693"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236228%20Make%20streams%20owned%20by%20request/respons.../near/350666693" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236228.20Make.20streams.20owned.20by.20request.2Frespons.2E.2E.2E.html#350666693">(Apr 18 2023 at 04:15)</a>:</h4>
<p><strong>brendandburns</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/6228">PR #6228</a>.</p>



<a name="350857656"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236228%20Make%20streams%20owned%20by%20request/respons.../near/350857656" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236228.20Make.20streams.20owned.20by.20request.2Frespons.2E.2E.2E.html#350857656">(Apr 18 2023 at 18:29)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/pchickey">pchickey</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/6228">PR #6228</a>.</p>



<a name="350952882"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236228%20Make%20streams%20owned%20by%20request/respons.../near/350952882" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236228.20Make.20streams.20owned.20by.20request.2Frespons.2E.2E.2E.html#350952882">(Apr 19 2023 at 06:39)</a>:</h4>
<p>rvolosatovs submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6228#pullrequestreview-1391329249">PR review</a>.</p>



<a name="350952883"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236228%20Make%20streams%20owned%20by%20request/respons.../near/350952883" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236228.20Make.20streams.20owned.20by.20request.2Frespons.2E.2E.2E.html#350952883">(Apr 19 2023 at 06:39)</a>:</h4>
<p>rvolosatovs submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6228#pullrequestreview-1391329249">PR review</a>.</p>



<a name="350952884"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236228%20Make%20streams%20owned%20by%20request/respons.../near/350952884" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236228.20Make.20streams.20owned.20by.20request.2Frespons.2E.2E.2E.html#350952884">(Apr 19 2023 at 06:39)</a>:</h4>
<p>rvolosatovs created <a href="https://github.com/bytecodealliance/wasmtime/pull/6228#discussion_r1170865812">PR review comment</a>:</p>
<blockquote>
<p>Doesn't <code>with_context</code> work here?</p>
</blockquote>



<a name="350952886"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236228%20Make%20streams%20owned%20by%20request/respons.../near/350952886" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236228.20Make.20streams.20owned.20by.20request.2Frespons.2E.2E.2E.html#350952886">(Apr 19 2023 at 06:39)</a>:</h4>
<p>rvolosatovs created <a href="https://github.com/bytecodealliance/wasmtime/pull/6228#discussion_r1170855948">PR review comment</a>:</p>
<blockquote>
<p>nit; since we only care about the <code>Some</code> case, how about an <code>if let Some(r) = self.requests.get(&amp;request)</code> instead?</p>
<p>Or even</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="n">Entry</span>::<span class="n">Occupied</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">requests</span><span class="p">.</span><span class="n">entry</span><span class="p">(</span><span class="n">request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="kd">let</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">remove</span><span class="p">();</span>
</code></pre></div>
<p><a href="https://doc.rust-lang.org/std/collections/hash_map/struct.OccupiedEntry.html#method.remove">https://doc.rust-lang.org/std/collections/hash_map/struct.OccupiedEntry.html#method.remove</a></p>
</blockquote>



<a name="350952887"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236228%20Make%20streams%20owned%20by%20request/respons.../near/350952887" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236228.20Make.20streams.20owned.20by.20request.2Frespons.2E.2E.2E.html#350952887">(Apr 19 2023 at 06:39)</a>:</h4>
<p>rvolosatovs created <a href="https://github.com/bytecodealliance/wasmtime/pull/6228#discussion_r1170864915">PR review comment</a>:</p>
<blockquote>
<p>If we had a <code>Default</code> trait impl, this could have just called <code>Self::default()</code></p>
</blockquote>



<a name="350952889"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236228%20Make%20streams%20owned%20by%20request/respons.../near/350952889" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236228.20Make.20streams.20owned.20by.20request.2Frespons.2E.2E.2E.html#350952889">(Apr 19 2023 at 06:39)</a>:</h4>
<p>rvolosatovs created <a href="https://github.com/bytecodealliance/wasmtime/pull/6228#discussion_r1170864063">PR review comment</a>:</p>
<blockquote>
<p>How about a <code>derive(Default)</code>?</p>
</blockquote>



<a name="350952891"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236228%20Make%20streams%20owned%20by%20request/respons.../near/350952891" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236228.20Make.20streams.20owned.20by.20request.2Frespons.2E.2E.2E.html#350952891">(Apr 19 2023 at 06:39)</a>:</h4>
<p>rvolosatovs created <a href="https://github.com/bytecodealliance/wasmtime/pull/6228#discussion_r1170867919">PR review comment</a>:</p>
<blockquote>
<p>You wouldn't need this clone if the call to <code>buf.len</code> below was moved higher, before the match.</p>
</blockquote>



<a name="350952892"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236228%20Make%20streams%20owned%20by%20request/respons.../near/350952892" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236228.20Make.20streams.20owned.20by.20request.2Frespons.2E.2E.2E.html#350952892">(Apr 19 2023 at 06:39)</a>:</h4>
<p>rvolosatovs created <a href="https://github.com/bytecodealliance/wasmtime/pull/6228#discussion_r1170869028">PR review comment</a>:</p>
<blockquote>
<p>If we had <code>Default</code> implemented, this could have been <code>unwrap_or_default</code></p>
</blockquote>



<a name="350952894"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236228%20Make%20streams%20owned%20by%20request/respons.../near/350952894" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236228.20Make.20streams.20owned.20by.20request.2Frespons.2E.2E.2E.html#350952894">(Apr 19 2023 at 06:39)</a>:</h4>
<p>rvolosatovs created <a href="https://github.com/bytecodealliance/wasmtime/pull/6228#discussion_r1170869979">PR review comment</a>:</p>
<blockquote>
<p>Looking at the usages of this struct, it seems that a <code>From&lt;Bytes&gt;</code> implementation could really clear this up</p>
</blockquote>



<a name="350952895"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236228%20Make%20streams%20owned%20by%20request/respons.../near/350952895" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236228.20Make.20streams.20owned.20by.20request.2Frespons.2E.2E.2E.html#350952895">(Apr 19 2023 at 06:39)</a>:</h4>
<p>rvolosatovs created <a href="https://github.com/bytecodealliance/wasmtime/pull/6228#discussion_r1170870723">PR review comment</a>:</p>
<blockquote>
<p>If there was a <code>From</code> implementation, this could have been <code>Stream::from(new.freeze())</code></p>
</blockquote>



<a name="351159144"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236228%20Make%20streams%20owned%20by%20request/respons.../near/351159144" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236228.20Make.20streams.20owned.20by.20request.2Frespons.2E.2E.2E.html#351159144">(Apr 19 2023 at 21:52)</a>:</h4>
<p>brendandburns created <a href="https://github.com/bytecodealliance/wasmtime/pull/6228#discussion_r1171888926">PR review comment</a>:</p>
<blockquote>
<p>Unfortunately, <code>HashMap::get(...)</code> returns a reference rather than a value, and there's no default for a reference. I could implement the <code>Default</code> trait for <code>&amp;Stream</code> references, but I'm not sure if that's what is best. Let me know.</p>
</blockquote>



<a name="351159175"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236228%20Make%20streams%20owned%20by%20request/respons.../near/351159175" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236228.20Make.20streams.20owned.20by.20request.2Frespons.2E.2E.2E.html#351159175">(Apr 19 2023 at 21:52)</a>:</h4>
<p>brendandburns created <a href="https://github.com/bytecodealliance/wasmtime/pull/6228#discussion_r1171889069">PR review comment</a>:</p>
<blockquote>
<p>done.</p>
</blockquote>



<a name="351159193"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236228%20Make%20streams%20owned%20by%20request/respons.../near/351159193" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236228.20Make.20streams.20owned.20by.20request.2Frespons.2E.2E.2E.html#351159193">(Apr 19 2023 at 21:52)</a>:</h4>
<p>brendandburns created <a href="https://github.com/bytecodealliance/wasmtime/pull/6228#discussion_r1171889135">PR review comment</a>:</p>
<blockquote>
<p>done.</p>
</blockquote>



<a name="351159308"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236228%20Make%20streams%20owned%20by%20request/respons.../near/351159308" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236228.20Make.20streams.20owned.20by.20request.2Frespons.2E.2E.2E.html#351159308">(Apr 19 2023 at 21:53)</a>:</h4>
<p>brendandburns created <a href="https://github.com/bytecodealliance/wasmtime/pull/6228#discussion_r1171889736">PR review comment</a>:</p>
<blockquote>
<p>I'm not sure I'm following your suggestion, can you clarify?</p>
</blockquote>



<a name="351159320"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236228%20Make%20streams%20owned%20by%20request/respons.../near/351159320" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236228.20Make.20streams.20owned.20by.20request.2Frespons.2E.2E.2E.html#351159320">(Apr 19 2023 at 21:53)</a>:</h4>
<p>brendandburns created <a href="https://github.com/bytecodealliance/wasmtime/pull/6228#discussion_r1171889775">PR review comment</a>:</p>
<blockquote>
<p>done.</p>
</blockquote>



<a name="351159327"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236228%20Make%20streams%20owned%20by%20request/respons.../near/351159327" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236228.20Make.20streams.20owned.20by.20request.2Frespons.2E.2E.2E.html#351159327">(Apr 19 2023 at 21:53)</a>:</h4>
<p>brendandburns created <a href="https://github.com/bytecodealliance/wasmtime/pull/6228#discussion_r1171889837">PR review comment</a>:</p>
<blockquote>
<p>added.</p>
</blockquote>



<a name="351159333"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236228%20Make%20streams%20owned%20by%20request/respons.../near/351159333" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236228.20Make.20streams.20owned.20by.20request.2Frespons.2E.2E.2E.html#351159333">(Apr 19 2023 at 21:53)</a>:</h4>
<p>brendandburns created <a href="https://github.com/bytecodealliance/wasmtime/pull/6228#discussion_r1171889911">PR review comment</a>:</p>
<blockquote>
<p>done.</p>
</blockquote>



<a name="351159420"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236228%20Make%20streams%20owned%20by%20request/respons.../near/351159420" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236228.20Make.20streams.20owned.20by.20request.2Frespons.2E.2E.2E.html#351159420">(Apr 19 2023 at 21:54)</a>:</h4>
<p>brendandburns created <a href="https://github.com/bytecodealliance/wasmtime/pull/6228#discussion_r1171890194">PR review comment</a>:</p>
<blockquote>
<p>Done.</p>
<p>Thanks for the suggestion, I'm still learning idiomatic rust)</p>
</blockquote>



<a name="351161612"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236228%20Make%20streams%20owned%20by%20request/respons.../near/351161612" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236228.20Make.20streams.20owned.20by.20request.2Frespons.2E.2E.2E.html#351161612">(Apr 19 2023 at 22:11)</a>:</h4>
<p>brendandburns updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6228">PR #6228</a>.</p>



<a name="351161766"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236228%20Make%20streams%20owned%20by%20request/respons.../near/351161766" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236228.20Make.20streams.20owned.20by.20request.2Frespons.2E.2E.2E.html#351161766">(Apr 19 2023 at 22:12)</a>:</h4>
<p>brendandburns updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6228">PR #6228</a>.</p>



<a name="351162843"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236228%20Make%20streams%20owned%20by%20request/respons.../near/351162843" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236228.20Make.20streams.20owned.20by.20request.2Frespons.2E.2E.2E.html#351162843">(Apr 19 2023 at 22:22)</a>:</h4>
<p>rvolosatovs created <a href="https://github.com/bytecodealliance/wasmtime/pull/6228#discussion_r1171907619">PR review comment</a>:</p>
<blockquote>
<p>Sure, I'm referring to this method on the <code>anyhow::Context</code> trait <a href="https://docs.rs/anyhow/latest/anyhow/trait.Context.html#tymethod.with_context">https://docs.rs/anyhow/latest/anyhow/trait.Context.html#tymethod.with_context</a></p>
<p>If it's in scope, you should be able to call <code>context</code> or <code>with_context</code> (usually used with <code>format!</code> and similar) on most <code>Result</code> and all <code>Option</code> types directly, thus eliminating the need for <code>ok_or_else</code> and explicit <code>anyhow!</code> invocation</p>
</blockquote>



<a name="351164322"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236228%20Make%20streams%20owned%20by%20request/respons.../near/351164322" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236228.20Make.20streams.20owned.20by.20request.2Frespons.2E.2E.2E.html#351164322">(Apr 19 2023 at 22:35)</a>:</h4>
<p>rvolosatovs created <a href="https://github.com/bytecodealliance/wasmtime/pull/6228#discussion_r1171914396">PR review comment</a>:</p>
<blockquote>
<p>That makes sense, I think this is fine.<br>
I am making a few changes here to allow for the host to provide a custom connect implementation, so I'll take a deeper look at this as well next week</p>
</blockquote>



<a name="351164948"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236228%20Make%20streams%20owned%20by%20request/respons.../near/351164948" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236228.20Make.20streams.20owned.20by.20request.2Frespons.2E.2E.2E.html#351164948">(Apr 19 2023 at 22:40)</a>:</h4>
<p>rvolosatovs submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6228#pullrequestreview-1392972754">PR review</a>:</p>
<blockquote>
<p>Just a general question, why are we not modifying the stream data buffer, but rather cloning it? In other words, why would we ever want to read the same bytes more than once?</p>
</blockquote>



<a name="351164949"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236228%20Make%20streams%20owned%20by%20request/respons.../near/351164949" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236228.20Make.20streams.20owned.20by.20request.2Frespons.2E.2E.2E.html#351164949">(Apr 19 2023 at 22:40)</a>:</h4>
<p>rvolosatovs submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6228#pullrequestreview-1392972754">PR review</a>:</p>
<blockquote>
<p>Just a general question, why are we not modifying the stream data buffer, but rather cloning it? In other words, why would we ever want to read the same bytes more than once?</p>
</blockquote>



<a name="351164950"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236228%20Make%20streams%20owned%20by%20request/respons.../near/351164950" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236228.20Make.20streams.20owned.20by.20request.2Frespons.2E.2E.2E.html#351164950">(Apr 19 2023 at 22:40)</a>:</h4>
<p>rvolosatovs created <a href="https://github.com/bytecodealliance/wasmtime/pull/6228#discussion_r1171915741">PR review comment</a>:</p>
<blockquote>
<p>This should probably also use the <code>From</code> trait</p>
</blockquote>



<a name="351381852"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236228%20Make%20streams%20owned%20by%20request/respons.../near/351381852" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236228.20Make.20streams.20owned.20by.20request.2Frespons.2E.2E.2E.html#351381852">(Apr 20 2023 at 16:57)</a>:</h4>
<p>brendandburns created <a href="https://github.com/bytecodealliance/wasmtime/pull/6228#discussion_r1172867237">PR review comment</a>:</p>
<blockquote>
<p>done.</p>
</blockquote>



<a name="351394546"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236228%20Make%20streams%20owned%20by%20request/respons.../near/351394546" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236228.20Make.20streams.20owned.20by.20request.2Frespons.2E.2E.2E.html#351394546">(Apr 20 2023 at 17:57)</a>:</h4>
<p>pchickey created <a href="https://github.com/bytecodealliance/wasmtime/pull/6228#discussion_r1172924825">PR review comment</a>:</p>
<blockquote>
<p>I made those ok_or_else(|| anyhow!(...)) suggestions in a prior PR and wasn't aware that Context could do that for me. Thank you.</p>
<p>@brendandburns The suggested change here is <code>let st = self.streams.get_mut(&amp;stream).with_context(|| format!("stream not found: {stream}"))?;</code>, or maybe even <code>....get_mut(&amp;stream).context("stream not found")?</code> if leaving out the stream number is ok - and it probably is, because (at least when using the component linker, I'm not sure if it works in module mode) bindgen is inserting <code>tracing</code> statements which someone debugging can recover the values of the arguments from.</p>
</blockquote>



<a name="351394683"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236228%20Make%20streams%20owned%20by%20request/respons.../near/351394683" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236228.20Make.20streams.20owned.20by.20request.2Frespons.2E.2E.2E.html#351394683">(Apr 20 2023 at 17:58)</a>:</h4>
<p>pchickey edited <a href="https://github.com/bytecodealliance/wasmtime/pull/6228#discussion_r1172924825">PR review comment</a>.</p>



<a name="351395405"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236228%20Make%20streams%20owned%20by%20request/respons.../near/351395405" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236228.20Make.20streams.20owned.20by.20request.2Frespons.2E.2E.2E.html#351395405">(Apr 20 2023 at 18:01)</a>:</h4>
<p>pchickey submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6228#pullrequestreview-1394513739">PR review</a>.</p>



<a name="351395406"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236228%20Make%20streams%20owned%20by%20request/respons.../near/351395406" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236228.20Make.20streams.20owned.20by.20request.2Frespons.2E.2E.2E.html#351395406">(Apr 20 2023 at 18:01)</a>:</h4>
<p>pchickey submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6228#pullrequestreview-1394513739">PR review</a>.</p>



<a name="351395407"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236228%20Make%20streams%20owned%20by%20request/respons.../near/351395407" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236228.20Make.20streams.20owned.20by.20request.2Frespons.2E.2E.2E.html#351395407">(Apr 20 2023 at 18:01)</a>:</h4>
<p>pchickey created <a href="https://github.com/bytecodealliance/wasmtime/pull/6228#discussion_r1172927702">PR review comment</a>:</p>
<blockquote>
<p><div class="codehilite" data-code-language="suggestion"><pre><span></span><code>                    bail!("cannot write to closed stream");
</code></pre></div><br>
</p>
</blockquote>



<a name="351397041"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236228%20Make%20streams%20owned%20by%20request/respons.../near/351397041" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236228.20Make.20streams.20owned.20by.20request.2Frespons.2E.2E.2E.html#351397041">(Apr 20 2023 at 18:09)</a>:</h4>
<p>rvolosatovs submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6228#pullrequestreview-1394525961">PR review</a>.</p>



<a name="351397042"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236228%20Make%20streams%20owned%20by%20request/respons.../near/351397042" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236228.20Make.20streams.20owned.20by.20request.2Frespons.2E.2E.2E.html#351397042">(Apr 20 2023 at 18:09)</a>:</h4>
<p>rvolosatovs submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6228#pullrequestreview-1394525961">PR review</a>.</p>



<a name="351397044"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236228%20Make%20streams%20owned%20by%20request/respons.../near/351397044" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236228.20Make.20streams.20owned.20by.20request.2Frespons.2E.2E.2E.html#351397044">(Apr 20 2023 at 18:09)</a>:</h4>
<p>rvolosatovs created <a href="https://github.com/bytecodealliance/wasmtime/pull/6228#discussion_r1172935039">PR review comment</a>:</p>
<blockquote>
<p>From <a href="https://github.com/bytecodealliance/wasmtime/pull/6228#issuecomment-1516661764">https://github.com/bytecodealliance/wasmtime/pull/6228#issuecomment-1516661764</a>, as you said, I think I'd just use <code>BytesMut</code> and <a href="https://docs.rs/bytes/latest/bytes/struct.BytesMut.html#method.extend_from_slice">https://docs.rs/bytes/latest/bytes/struct.BytesMut.html#method.extend_from_slice</a> here</p>
<p>This that would be quite a bit shorter, it could probably also make sense to remove the match altogether and instead rely on <a href="https://doc.rust-lang.org/std/collections/hash_map/enum.Entry.html#method.and_modify">https://doc.rust-lang.org/std/collections/hash_map/enum.Entry.html#method.and_modify</a> (see example there with <code>or_insert</code>)</p>
</blockquote>



<a name="351397202"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236228%20Make%20streams%20owned%20by%20request/respons.../near/351397202" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236228.20Make.20streams.20owned.20by.20request.2Frespons.2E.2E.2E.html#351397202">(Apr 20 2023 at 18:10)</a>:</h4>
<p>rvolosatovs edited <a href="https://github.com/bytecodealliance/wasmtime/pull/6228#discussion_r1172935039">PR review comment</a>.</p>



<a name="351416313"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236228%20Make%20streams%20owned%20by%20request/respons.../near/351416313" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236228.20Make.20streams.20owned.20by.20request.2Frespons.2E.2E.2E.html#351416313">(Apr 20 2023 at 19:53)</a>:</h4>
<p>brendandburns updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6228">PR #6228</a>.</p>



<a name="351473910"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236228%20Make%20streams%20owned%20by%20request/respons.../near/351473910" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236228.20Make.20streams.20owned.20by.20request.2Frespons.2E.2E.2E.html#351473910">(Apr 20 2023 at 22:59)</a>:</h4>
<p>brendandburns updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6228">PR #6228</a>.</p>



<a name="351473969"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236228%20Make%20streams%20owned%20by%20request/respons.../near/351473969" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236228.20Make.20streams.20owned.20by.20request.2Frespons.2E.2E.2E.html#351473969">(Apr 20 2023 at 22:59)</a>:</h4>
<p>brendandburns created <a href="https://github.com/bytecodealliance/wasmtime/pull/6228#discussion_r1173160553">PR review comment</a>:</p>
<blockquote>
<p>Done. I needed to use <code>.or_default().extend_from_slice(...)</code> but I think it achieves the same goal (and thanks for the suggestion of implementing <code>Default</code> that made it possible :)</p>
</blockquote>



<a name="351710378"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236228%20Make%20streams%20owned%20by%20request/respons.../near/351710378" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236228.20Make.20streams.20owned.20by.20request.2Frespons.2E.2E.2E.html#351710378">(Apr 21 2023 at 18:57)</a>:</h4>
<p>pchickey merged <a href="https://github.com/bytecodealliance/wasmtime/pull/6228">PR #6228</a>.</p>



<a name="352298634"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236228%20Make%20streams%20owned%20by%20request/respons.../near/352298634" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236228.20Make.20streams.20owned.20by.20request.2Frespons.2E.2E.2E.html#352298634">(Apr 24 2023 at 14:44)</a>:</h4>
<p>rvolosatovs created <a href="https://github.com/bytecodealliance/wasmtime/pull/6228#discussion_r1175396247">PR review comment</a>:</p>
<blockquote>
<p><a href="https://github.com/bytecodealliance/wasmtime/pull/6272">https://github.com/bytecodealliance/wasmtime/pull/6272</a></p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>