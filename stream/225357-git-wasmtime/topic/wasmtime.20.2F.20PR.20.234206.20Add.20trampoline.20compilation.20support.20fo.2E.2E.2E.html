<html>
<head><meta charset="utf-8"><title>wasmtime / PR #4206 Add trampoline compilation support fo... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234206.20Add.20trampoline.20compilation.20support.20fo.2E.2E.2E.html">wasmtime / PR #4206 Add trampoline compilation support fo...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="284674837"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234206%20Add%20trampoline%20compilation%20support%20fo.../near/284674837" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234206.20Add.20trampoline.20compilation.20support.20fo.2E.2E.2E.html#284674837">(Jun 01 2022 at 21:58)</a>:</h4>
<p>alexcrichton opened <a href="https://github.com/bytecodealliance/wasmtime/pull/4206">PR #4206</a> from <code>component-trampolines</code> to <code>main</code>:</p>
<blockquote>
<p>This commit adds support to the component model implementation for<br>
compiling trampolines suitable for calling host imports. Currently this<br>
is purely just the compilation side of things, modifying the<br>
wasmtime-cranelift crate and additionally filling out a new<br>
<code>VMComponentOffsets</code> type (similar to <code>VMOffsets</code>). The actual creation<br>
of a <code>VMComponentContext</code> is still not performed and will be a<br>
subsequent PR.</p>
<p>Internally though some tests are actually possible with this where we at<br>
least assert that compilation of a component and creation of everything<br>
in-memory doesn't panic or trip any assertions, so some tests are added<br>
here for that as well.</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;<br>
</p>
</blockquote>



<a name="284674838"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234206%20Add%20trampoline%20compilation%20support%20fo.../near/284674838" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234206.20Add.20trampoline.20compilation.20support.20fo.2E.2E.2E.html#284674838">(Jun 01 2022 at 21:58)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/fitzgen">fitzgen</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/4206">PR #4206</a>.</p>



<a name="284739102"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234206%20Add%20trampoline%20compilation%20support%20fo.../near/284739102" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234206.20Add.20trampoline.20compilation.20support.20fo.2E.2E.2E.html#284739102">(Jun 02 2022 at 12:51)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4206">PR #4206</a> from <code>component-trampolines</code> to <code>main</code>.</p>



<a name="284805429"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234206%20Add%20trampoline%20compilation%20support%20fo.../near/284805429" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234206.20Add.20trampoline.20compilation.20support.20fo.2E.2E.2E.html#284805429">(Jun 02 2022 at 21:12)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4206#pullrequestreview-993968941">PR review</a>.</p>



<a name="284805431"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234206%20Add%20trampoline%20compilation%20support%20fo.../near/284805431" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234206.20Add.20trampoline.20compilation.20support.20fo.2E.2E.2E.html#284805431">(Jun 02 2022 at 21:12)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4206#pullrequestreview-993968941">PR review</a>.</p>



<a name="284805433"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234206%20Add%20trampoline%20compilation%20support%20fo.../near/284805433" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234206.20Add.20trampoline.20compilation.20support.20fo.2E.2E.2E.html#284805433">(Jun 02 2022 at 21:12)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/4206#discussion_r888253173">PR review comment</a>:</p>
<blockquote>
<p>Aside: should this be <code>VMStringEncoding</code> since we pass it to JIT code?</p>
</blockquote>



<a name="284805434"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234206%20Add%20trampoline%20compilation%20support%20fo.../near/284805434" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234206.20Add.20trampoline.20compilation.20support.20fo.2E.2E.2E.html#284805434">(Jun 02 2022 at 21:12)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/4206#discussion_r888255014">PR review comment</a>:</p>
<blockquote>
<p>I guess the same goes for <code>ValRaw</code>, although this is relatively long-standing at this point.</p>
</blockquote>



<a name="284890291"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234206%20Add%20trampoline%20compilation%20support%20fo.../near/284890291" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234206.20Add.20trampoline.20compilation.20support.20fo.2E.2E.2E.html#284890291">(Jun 03 2022 at 15:00)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4206#pullrequestreview-995034893">PR review</a>.</p>



<a name="284890293"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234206%20Add%20trampoline%20compilation%20support%20fo.../near/284890293" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234206.20Add.20trampoline.20compilation.20support.20fo.2E.2E.2E.html#284890293">(Jun 03 2022 at 15:00)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4206#discussion_r889027117">PR review comment</a>:</p>
<blockquote>
<p>Hm perhaps yeah, although this is defined in <code>wasmtime-environ</code> which doesn't have <code>VM*</code> things in general. I did leave documentation there explaining the <code>repr(u8)</code> as well, so I think I'll leave this as-is to avoid too many definitions of the same thing, but we can always tweak in the future of course.</p>
</blockquote>



<a name="284890408"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234206%20Add%20trampoline%20compilation%20support%20fo.../near/284890408" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234206.20Add.20trampoline.20compilation.20support.20fo.2E.2E.2E.html#284890408">(Jun 03 2022 at 15:01)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4206#pullrequestreview-995036033">PR review</a>.</p>



<a name="284890410"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234206%20Add%20trampoline%20compilation%20support%20fo.../near/284890410" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234206.20Add.20trampoline.20compilation.20support.20fo.2E.2E.2E.html#284890410">(Jun 03 2022 at 15:01)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4206#discussion_r889027870">PR review comment</a>:</p>
<blockquote>
<p>True yeah, although I sort of just invented the <code>ValRaw</code> name as it was the raw version of <code>wasmtime::Val</code>. We don't otherwise export <code>VM*</code> types to the outside world which <code>wasmtime::ValRaw</code> is, though. One way to solve this perhaps would be a <code>struct ValRaw(VMValRaw)</code> or similar, but I'm not sure if it's worth it per se.</p>
</blockquote>



<a name="284890418"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234206%20Add%20trampoline%20compilation%20support%20fo.../near/284890418" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234206.20Add.20trampoline.20compilation.20support.20fo.2E.2E.2E.html#284890418">(Jun 03 2022 at 15:01)</a>:</h4>
<p>alexcrichton merged <a href="https://github.com/bytecodealliance/wasmtime/pull/4206">PR #4206</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>