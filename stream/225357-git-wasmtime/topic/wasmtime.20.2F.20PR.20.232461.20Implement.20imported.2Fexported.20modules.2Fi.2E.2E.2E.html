<html>
<head><meta charset="utf-8"><title>wasmtime / PR #2461 Implement imported/exported modules/i... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232461.20Implement.20imported.2Fexported.20modules.2Fi.2E.2E.2E.html">wasmtime / PR #2461 Implement imported/exported modules/i...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="218494017"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232461%20Implement%20imported/exported%20modules/i.../near/218494017" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232461.20Implement.20imported.2Fexported.20modules.2Fi.2E.2E.2E.html#218494017">(Dec 01 2020 at 22:57)</a>:</h4>
<p>alexcrichton opened <a href="https://github.com/bytecodealliance/wasmtime/pull/2461">PR #2461</a> from <code>import-export-instances-modules</code> to <code>main</code>:</p>
<blockquote>
<p>This commit implements the final piece of the module linking proposal<br>
which is to flesh out the support for importing/exporting instances and<br>
modules. This ended up having a few changes:</p>
<ul>
<li>
<p>Two more <code>PrimaryMap</code> instances are now stored in an <code>Instance</code>. The value<br>
  for instances is <code>InstanceHandle</code> (pretty easy) and for modules it's<br>
<code>Box&lt;dyn Any&gt;</code> (less easy).</p>
</li>
<li>
<p>The custom host state for <code>InstanceHandle</code> for <code>wasmtime</code> is now<br>
<code>Arc&lt;TypeTables</code> to be able to fully reconstruct an instance's types<br>
  just from its instance.</p>
</li>
<li>
<p>Type matching for imports now has been updated to take<br>
  instances/modules into account.</p>
</li>
</ul>
<p>One of the main downsides of this implementation is that type matching<br>
of imports is duplicated between wasmparser and wasmtime, leading to<br>
posssible bugs especially in the subtelties of module linking. I'm not<br>
sure how best to unify these two pieces of validation, however, and it<br>
may be more trouble than it's worth.</p>
<p>cc #2094</p>
<p>Note that this is built on <a href="https://github.com/bytecodealliance/wasmtime/pull/2451">https://github.com/bytecodealliance/wasmtime/pull/2451</a> so only the last commit is relevant.</p>
</blockquote>



<a name="218632482"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232461%20Implement%20imported/exported%20modules/i.../near/218632482" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232461.20Implement.20imported.2Fexported.20modules.2Fi.2E.2E.2E.html#218632482">(Dec 02 2020 at 22:58)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2461">PR #2461</a> from <code>import-export-instances-modules</code> to <code>main</code>:</p>
<blockquote>
<p>This commit implements the final piece of the module linking proposal<br>
which is to flesh out the support for importing/exporting instances and<br>
modules. This ended up having a few changes:</p>
<ul>
<li>
<p>Two more <code>PrimaryMap</code> instances are now stored in an <code>Instance</code>. The value<br>
  for instances is <code>InstanceHandle</code> (pretty easy) and for modules it's<br>
<code>Box&lt;dyn Any&gt;</code> (less easy).</p>
</li>
<li>
<p>The custom host state for <code>InstanceHandle</code> for <code>wasmtime</code> is now<br>
<code>Arc&lt;TypeTables</code> to be able to fully reconstruct an instance's types<br>
  just from its instance.</p>
</li>
<li>
<p>Type matching for imports now has been updated to take<br>
  instances/modules into account.</p>
</li>
</ul>
<p>One of the main downsides of this implementation is that type matching<br>
of imports is duplicated between wasmparser and wasmtime, leading to<br>
posssible bugs especially in the subtelties of module linking. I'm not<br>
sure how best to unify these two pieces of validation, however, and it<br>
may be more trouble than it's worth.</p>
<p>cc #2094</p>
<p>Note that this is built on <a href="https://github.com/bytecodealliance/wasmtime/pull/2451">https://github.com/bytecodealliance/wasmtime/pull/2451</a> so only the last commit is relevant.</p>
</blockquote>



<a name="218634813"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232461%20Implement%20imported/exported%20modules/i.../near/218634813" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232461.20Implement.20imported.2Fexported.20modules.2Fi.2E.2E.2E.html#218634813">(Dec 02 2020 at 23:24)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2461">PR #2461</a> from <code>import-export-instances-modules</code> to <code>main</code>:</p>
<blockquote>
<p>This commit implements the final piece of the module linking proposal<br>
which is to flesh out the support for importing/exporting instances and<br>
modules. This ended up having a few changes:</p>
<ul>
<li>
<p>Two more <code>PrimaryMap</code> instances are now stored in an <code>Instance</code>. The value<br>
  for instances is <code>InstanceHandle</code> (pretty easy) and for modules it's<br>
<code>Box&lt;dyn Any&gt;</code> (less easy).</p>
</li>
<li>
<p>The custom host state for <code>InstanceHandle</code> for <code>wasmtime</code> is now<br>
<code>Arc&lt;TypeTables</code> to be able to fully reconstruct an instance's types<br>
  just from its instance.</p>
</li>
<li>
<p>Type matching for imports now has been updated to take<br>
  instances/modules into account.</p>
</li>
</ul>
<p>One of the main downsides of this implementation is that type matching<br>
of imports is duplicated between wasmparser and wasmtime, leading to<br>
posssible bugs especially in the subtelties of module linking. I'm not<br>
sure how best to unify these two pieces of validation, however, and it<br>
may be more trouble than it's worth.</p>
<p>cc #2094</p>
<p>Note that this is built on <a href="https://github.com/bytecodealliance/wasmtime/pull/2451">https://github.com/bytecodealliance/wasmtime/pull/2451</a> so only the last commit is relevant.</p>
</blockquote>



<a name="218634815"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232461%20Implement%20imported/exported%20modules/i.../near/218634815" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232461.20Implement.20imported.2Fexported.20modules.2Fi.2E.2E.2E.html#218634815">(Dec 02 2020 at 23:24)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/peterhuene">peterhuene</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/2461">PR #2461</a>.</p>



<a name="218645391"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232461%20Implement%20imported/exported%20modules/i.../near/218645391" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232461.20Implement.20imported.2Fexported.20modules.2Fi.2E.2E.2E.html#218645391">(Dec 03 2020 at 01:54)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2461#pullrequestreview-543350687">PR Review</a>.</p>



<a name="218645392"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232461%20Implement%20imported/exported%20modules/i.../near/218645392" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232461.20Implement.20imported.2Fexported.20modules.2Fi.2E.2E.2E.html#218645392">(Dec 03 2020 at 01:54)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2461#pullrequestreview-543350687">PR Review</a>.</p>



<a name="218645393"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232461%20Implement%20imported/exported%20modules/i.../near/218645393" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232461.20Implement.20imported.2Fexported.20modules.2Fi.2E.2E.2E.html#218645393">(Dec 03 2020 at 01:54)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/2461#discussion_r534595346">PR Review Comment</a>:</p>
<blockquote>
<p>Clippy nit:</p>
<p><div class="codehilite" data-code-language="suggestion"><pre><span></span><code>        ty
</code></pre></div><br>
</p>
</blockquote>



<a name="218645394"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232461%20Implement%20imported/exported%20modules/i.../near/218645394" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232461.20Implement.20imported.2Fexported.20modules.2Fi.2E.2E.2E.html#218645394">(Dec 03 2020 at 01:54)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/2461#discussion_r534595085">PR Review Comment</a>:</p>
<blockquote>
<p>Clippy nit:</p>
<p><div class="codehilite" data-code-language="suggestion"><pre><span></span><code>        sig
</code></pre></div><br>
</p>
</blockquote>



<a name="218645395"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232461%20Implement%20imported/exported%20modules/i.../near/218645395" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232461.20Implement.20imported.2Fexported.20modules.2Fi.2E.2E.2E.html#218645395">(Dec 03 2020 at 01:54)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/2461#discussion_r534603237">PR Review Comment</a>:</p>
<blockquote>
<p><span aria-label="bike" class="emoji emoji-1f6b2" role="img" title="bike">:bike:</span>shed: perhaps this method should be renamed to <code>build</code> now given the mutation and "builder" name?</p>
</blockquote>



<a name="218645396"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232461%20Implement%20imported/exported%20modules/i.../near/218645396" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232461.20Implement.20imported.2Fexported.20modules.2Fi.2E.2E.2E.html#218645396">(Dec 03 2020 at 01:54)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/2461#discussion_r534577443">PR Review Comment</a>:</p>
<blockquote>
<p>This comment seems incongruent with the method.</p>
</blockquote>



<a name="218645397"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232461%20Implement%20imported/exported%20modules/i.../near/218645397" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232461.20Implement.20imported.2Fexported.20modules.2Fi.2E.2E.2E.html#218645397">(Dec 03 2020 at 01:54)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/2461#discussion_r534606057">PR Review Comment</a>:</p>
<blockquote>
<p><div class="codehilite" data-code-language="suggestion"><pre><span></span><code>            // we acquired the handle from an instance in the store.
</code></pre></div><br>
</p>
</blockquote>



<a name="218645398"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232461%20Implement%20imported/exported%20modules/i.../near/218645398" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232461.20Implement.20imported.2Fexported.20modules.2Fi.2E.2E.2E.html#218645398">(Dec 03 2020 at 01:54)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/2461#discussion_r534598966">PR Review Comment</a>:</p>
<blockquote>
<p><div class="codehilite" data-code-language="suggestion"><pre><span></span><code>    /// Validates that the `actual_imports` list of module imports matches the
</code></pre></div><br>
</p>
</blockquote>



<a name="218707044"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232461%20Implement%20imported/exported%20modules/i.../near/218707044" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232461.20Implement.20imported.2Fexported.20modules.2Fi.2E.2E.2E.html#218707044">(Dec 03 2020 at 15:17)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2461">PR #2461</a> from <code>import-export-instances-modules</code> to <code>main</code>:</p>
<blockquote>
<p>This commit implements the final piece of the module linking proposal<br>
which is to flesh out the support for importing/exporting instances and<br>
modules. This ended up having a few changes:</p>
<ul>
<li>
<p>Two more <code>PrimaryMap</code> instances are now stored in an <code>Instance</code>. The value<br>
  for instances is <code>InstanceHandle</code> (pretty easy) and for modules it's<br>
<code>Box&lt;dyn Any&gt;</code> (less easy).</p>
</li>
<li>
<p>The custom host state for <code>InstanceHandle</code> for <code>wasmtime</code> is now<br>
<code>Arc&lt;TypeTables</code> to be able to fully reconstruct an instance's types<br>
  just from its instance.</p>
</li>
<li>
<p>Type matching for imports now has been updated to take<br>
  instances/modules into account.</p>
</li>
</ul>
<p>One of the main downsides of this implementation is that type matching<br>
of imports is duplicated between wasmparser and wasmtime, leading to<br>
posssible bugs especially in the subtelties of module linking. I'm not<br>
sure how best to unify these two pieces of validation, however, and it<br>
may be more trouble than it's worth.</p>
<p>cc #2094</p>
<p>Note that this is built on <a href="https://github.com/bytecodealliance/wasmtime/pull/2451">https://github.com/bytecodealliance/wasmtime/pull/2451</a> so only the last commit is relevant.</p>
</blockquote>



<a name="218709722"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232461%20Implement%20imported/exported%20modules/i.../near/218709722" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232461.20Implement.20imported.2Fexported.20modules.2Fi.2E.2E.2E.html#218709722">(Dec 03 2020 at 15:33)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2461">PR #2461</a> from <code>import-export-instances-modules</code> to <code>main</code>:</p>
<blockquote>
<p>This commit implements the final piece of the module linking proposal<br>
which is to flesh out the support for importing/exporting instances and<br>
modules. This ended up having a few changes:</p>
<ul>
<li>
<p>Two more <code>PrimaryMap</code> instances are now stored in an <code>Instance</code>. The value<br>
  for instances is <code>InstanceHandle</code> (pretty easy) and for modules it's<br>
<code>Box&lt;dyn Any&gt;</code> (less easy).</p>
</li>
<li>
<p>The custom host state for <code>InstanceHandle</code> for <code>wasmtime</code> is now<br>
<code>Arc&lt;TypeTables</code> to be able to fully reconstruct an instance's types<br>
  just from its instance.</p>
</li>
<li>
<p>Type matching for imports now has been updated to take<br>
  instances/modules into account.</p>
</li>
</ul>
<p>One of the main downsides of this implementation is that type matching<br>
of imports is duplicated between wasmparser and wasmtime, leading to<br>
posssible bugs especially in the subtelties of module linking. I'm not<br>
sure how best to unify these two pieces of validation, however, and it<br>
may be more trouble than it's worth.</p>
<p>cc #2094</p>
<p>Note that this is built on <a href="https://github.com/bytecodealliance/wasmtime/pull/2451">https://github.com/bytecodealliance/wasmtime/pull/2451</a> so only the last commit is relevant.</p>
</blockquote>



<a name="218716565"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232461%20Implement%20imported/exported%20modules/i.../near/218716565" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232461.20Implement.20imported.2Fexported.20modules.2Fi.2E.2E.2E.html#218716565">(Dec 03 2020 at 16:15)</a>:</h4>
<p>alexcrichton merged <a href="https://github.com/bytecodealliance/wasmtime/pull/2461">PR #2461</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>