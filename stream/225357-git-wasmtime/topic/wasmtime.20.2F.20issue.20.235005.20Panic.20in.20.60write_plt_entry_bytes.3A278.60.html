<html>
<head><meta charset="utf-8"><title>wasmtime / issue #5005 Panic in `write_plt_entry_bytes:278` · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235005.20Panic.20in.20.60write_plt_entry_bytes.3A278.60.html">wasmtime / issue #5005 Panic in `write_plt_entry_bytes:278`</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="302233502"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235005%20Panic%20in%20%60write_plt_entry_bytes%3A278%60/near/302233502" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235005.20Panic.20in.20.60write_plt_entry_bytes.3A278.60.html#302233502">(Oct 04 2022 at 10:46)</a>:</h4>
<p>mokhaled2992 edited <a href="https://github.com/bytecodealliance/wasmtime/issues/5005">issue #5005</a>:</p>
<blockquote>
<p>I'm getting a panic and the stacktrace points at the following line. This happens at the very early stages when I initialize my JIT and try to declare some functions. Any hints on how to solve this?</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">    </span><span class="k">unsafe</span><span class="w"> </span><span class="k">fn</span> <span class="nf">write_plt_entry_bytes</span><span class="p">(</span><span class="n">plt_ptr</span>: <span class="o">*</span><span class="k">mut</span><span class="w"> </span><span class="p">[</span><span class="kt">u8</span><span class="p">;</span><span class="w"> </span><span class="mi">16</span><span class="p">],</span><span class="w"> </span><span class="n">got_ptr</span>: <span class="nc">NonNull</span><span class="o">&lt;</span><span class="n">AtomicPtr</span><span class="o">&lt;</span><span class="kt">u8</span><span class="o">&gt;&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="o">..................</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="n">plt_val</span><span class="p">[</span><span class="mi">2</span><span class="o">..</span><span class="mi">6</span><span class="p">].</span><span class="n">copy_from_slice</span><span class="p">(</span><span class="o">&amp;</span><span class="kt">i32</span>::<span class="n">to_ne_bytes</span><span class="p">(</span><span class="kt">i32</span>::<span class="n">try_from</span><span class="p">(</span><span class="n">what</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">at</span><span class="p">).</span><span class="n">unwrap</span><span class="p">()));</span><span class="w"></span>
<span class="w">        </span><span class="o">..................</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
</code></pre></div>
</blockquote>



<a name="302234086"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235005%20Panic%20in%20%60write_plt_entry_bytes%3A278%60/near/302234086" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235005.20Panic.20in.20.60write_plt_entry_bytes.3A278.60.html#302234086">(Oct 04 2022 at 10:50)</a>:</h4>
<p>mokhaled2992 edited <a href="https://github.com/bytecodealliance/wasmtime/issues/5005">issue #5005</a>:</p>
<blockquote>
<p>I'm getting a panic and the stacktrace points at the following line. This happens at the very early stages when I initialize my JIT and try to declare some functions. Any hints on how to solve this?</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">    </span><span class="k">unsafe</span><span class="w"> </span><span class="k">fn</span> <span class="nf">write_plt_entry_bytes</span><span class="p">(</span><span class="n">plt_ptr</span>: <span class="o">*</span><span class="k">mut</span><span class="w"> </span><span class="p">[</span><span class="kt">u8</span><span class="p">;</span><span class="w"> </span><span class="mi">16</span><span class="p">],</span><span class="w"> </span><span class="n">got_ptr</span>: <span class="nc">NonNull</span><span class="o">&lt;</span><span class="n">AtomicPtr</span><span class="o">&lt;</span><span class="kt">u8</span><span class="o">&gt;&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="o">..................</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="n">plt_val</span><span class="p">[</span><span class="mi">2</span><span class="o">..</span><span class="mi">6</span><span class="p">].</span><span class="n">copy_from_slice</span><span class="p">(</span><span class="o">&amp;</span><span class="kt">i32</span>::<span class="n">to_ne_bytes</span><span class="p">(</span><span class="kt">i32</span>::<span class="n">try_from</span><span class="p">(</span><span class="n">what</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">at</span><span class="p">).</span><span class="n">unwrap</span><span class="p">()));</span><span class="w"></span>
<span class="w">        </span><span class="o">..................</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>More info:</p>
<h1>I'm running on <code>x86_64</code> and <code>Ubuntu 20</code>.</h1>
<h1>My JIT only declares some external rust functions and creates a wrapper function that calls those.</h1>
<h1>I ran into another memory permissions problem and was pointed to use the feature flag <code>selinux-fix</code> which solved that problem (see <a href="https://github.com/bytecodealliance/wasmtime/issues/4980#issue-1391090347">https://github.com/bytecodealliance/wasmtime/issues/4980#issue-1391090347</a>).</h1>
</blockquote>



<a name="302234111"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235005%20Panic%20in%20%60write_plt_entry_bytes%3A278%60/near/302234111" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235005.20Panic.20in.20.60write_plt_entry_bytes.3A278.60.html#302234111">(Oct 04 2022 at 10:51)</a>:</h4>
<p>mokhaled2992 edited <a href="https://github.com/bytecodealliance/wasmtime/issues/5005">issue #5005</a>:</p>
<blockquote>
<p>I'm getting a panic and the stacktrace points at the following line. This happens at the very early stages when I initialize my JIT and try to declare some functions. Any hints on how to solve this?</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">    </span><span class="k">unsafe</span><span class="w"> </span><span class="k">fn</span> <span class="nf">write_plt_entry_bytes</span><span class="p">(</span><span class="n">plt_ptr</span>: <span class="o">*</span><span class="k">mut</span><span class="w"> </span><span class="p">[</span><span class="kt">u8</span><span class="p">;</span><span class="w"> </span><span class="mi">16</span><span class="p">],</span><span class="w"> </span><span class="n">got_ptr</span>: <span class="nc">NonNull</span><span class="o">&lt;</span><span class="n">AtomicPtr</span><span class="o">&lt;</span><span class="kt">u8</span><span class="o">&gt;&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="o">..................</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="n">plt_val</span><span class="p">[</span><span class="mi">2</span><span class="o">..</span><span class="mi">6</span><span class="p">].</span><span class="n">copy_from_slice</span><span class="p">(</span><span class="o">&amp;</span><span class="kt">i32</span>::<span class="n">to_ne_bytes</span><span class="p">(</span><span class="kt">i32</span>::<span class="n">try_from</span><span class="p">(</span><span class="n">what</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">at</span><span class="p">).</span><span class="n">unwrap</span><span class="p">()));</span><span class="w"></span>
<span class="w">        </span><span class="o">..................</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>More info:</p>
<ul>
<li>I'm running on <code>x86_64</code> and <code>Ubuntu 20</code>.</li>
<li>My JIT only declares some external rust functions and creates a wrapper function that calls those.</li>
<li>I ran into another memory permissions problem and was pointed to use the feature flag <code>selinux-fix</code> which solved that problem (see <a href="https://github.com/bytecodealliance/wasmtime/issues/4980#issue-1391090347">https://github.com/bytecodealliance/wasmtime/issues/4980#issue-1391090347</a>).</li>
</ul>
</blockquote>



<a name="302234189"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235005%20Panic%20in%20%60write_plt_entry_bytes%3A278%60/near/302234189" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235005.20Panic.20in.20.60write_plt_entry_bytes.3A278.60.html#302234189">(Oct 04 2022 at 10:51)</a>:</h4>
<p>mokhaled2992 edited <a href="https://github.com/bytecodealliance/wasmtime/issues/5005">issue #5005</a>:</p>
<blockquote>
<p>I'm getting a panic and the stacktrace points at the following line. This happens at the very early stages when I initialize my JIT and try to declare some functions. Any hints on how to solve this?</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">    </span><span class="k">unsafe</span><span class="w"> </span><span class="k">fn</span> <span class="nf">write_plt_entry_bytes</span><span class="p">(</span><span class="n">plt_ptr</span>: <span class="o">*</span><span class="k">mut</span><span class="w"> </span><span class="p">[</span><span class="kt">u8</span><span class="p">;</span><span class="w"> </span><span class="mi">16</span><span class="p">],</span><span class="w"> </span><span class="n">got_ptr</span>: <span class="nc">NonNull</span><span class="o">&lt;</span><span class="n">AtomicPtr</span><span class="o">&lt;</span><span class="kt">u8</span><span class="o">&gt;&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="o">..................</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="n">plt_val</span><span class="p">[</span><span class="mi">2</span><span class="o">..</span><span class="mi">6</span><span class="p">].</span><span class="n">copy_from_slice</span><span class="p">(</span><span class="o">&amp;</span><span class="kt">i32</span>::<span class="n">to_ne_bytes</span><span class="p">(</span><span class="kt">i32</span>::<span class="n">try_from</span><span class="p">(</span><span class="n">what</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">at</span><span class="p">).</span><span class="n">unwrap</span><span class="p">()));</span><span class="w"></span>
<span class="w">        </span><span class="o">..................</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>More info:</p>
<ul>
<li>I'm running on <code>x86_64</code> and <code>Ubuntu 20</code>.</li>
<li>My JIT only declares some external rust functions and creates a wrapper function that calls those.</li>
<li>I ran into another memory permissions problem and was pointed to use the feature flag <code>selinux-fix</code> which solved that problem (see <a href="https://github.com/bytecodealliance/wasmtime/issues/4980#issue-1391090347">https://github.com/bytecodealliance/wasmtime/issues/4980#issue-1391090347</a>).</li>
<li>Disabling <code>is_pic</code> solves this panic, is that a bug?</li>
</ul>
</blockquote>



<a name="302235765"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235005%20Panic%20in%20%60write_plt_entry_bytes%3A278%60/near/302235765" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235005.20Panic.20in.20.60write_plt_entry_bytes.3A278.60.html#302235765">(Oct 04 2022 at 11:01)</a>:</h4>
<p>mokhaled2992 edited <a href="https://github.com/bytecodealliance/wasmtime/issues/5005">issue #5005</a>:</p>
<blockquote>
<p>I'm getting a panic and the stacktrace points at the following line. This happens at the very early stages when I initialize my JIT and try to declare some functions. Any hints on how to solve this?</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">    </span><span class="k">unsafe</span><span class="w"> </span><span class="k">fn</span> <span class="nf">write_plt_entry_bytes</span><span class="p">(</span><span class="n">plt_ptr</span>: <span class="o">*</span><span class="k">mut</span><span class="w"> </span><span class="p">[</span><span class="kt">u8</span><span class="p">;</span><span class="w"> </span><span class="mi">16</span><span class="p">],</span><span class="w"> </span><span class="n">got_ptr</span>: <span class="nc">NonNull</span><span class="o">&lt;</span><span class="n">AtomicPtr</span><span class="o">&lt;</span><span class="kt">u8</span><span class="o">&gt;&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="o">..................</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="n">plt_val</span><span class="p">[</span><span class="mi">2</span><span class="o">..</span><span class="mi">6</span><span class="p">].</span><span class="n">copy_from_slice</span><span class="p">(</span><span class="o">&amp;</span><span class="kt">i32</span>::<span class="n">to_ne_bytes</span><span class="p">(</span><span class="kt">i32</span>::<span class="n">try_from</span><span class="p">(</span><span class="n">what</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">at</span><span class="p">).</span><span class="n">unwrap</span><span class="p">()));</span><span class="w"></span>
<span class="w">        </span><span class="o">..................</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>More info:</p>
<ul>
<li>I'm running on <code>x86_64</code> and <code>Ubuntu 20</code>.</li>
<li>My JIT only declares some external rust functions and creates a wrapper function that calls those.</li>
<li>I previously ran into another memory execution permissions problem and was pointed to use the feature flag <code>selinux-fix</code> which solved that problem (see <a href="https://github.com/bytecodealliance/wasmtime/issues/4980#issue-1391090347">https://github.com/bytecodealliance/wasmtime/issues/4980#issue-1391090347</a>).</li>
<li>Disabling <code>is_pic</code> obviously solves this panic, is that a bug?</li>
</ul>
</blockquote>



<a name="302236597"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235005%20Panic%20in%20%60write_plt_entry_bytes%3A278%60/near/302236597" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235005.20Panic.20in.20.60write_plt_entry_bytes.3A278.60.html#302236597">(Oct 04 2022 at 11:06)</a>:</h4>
<p>mokhaled2992 edited <a href="https://github.com/bytecodealliance/wasmtime/issues/5005">issue #5005</a>:</p>
<blockquote>
<p>I'm getting a panic and the stacktrace points at the line shown below. This happens at the very early stages when I initialize my JIT and try to declare some functions. Any hints on how to solve this?</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">    </span><span class="k">unsafe</span><span class="w"> </span><span class="k">fn</span> <span class="nf">write_plt_entry_bytes</span><span class="p">(</span><span class="n">plt_ptr</span>: <span class="o">*</span><span class="k">mut</span><span class="w"> </span><span class="p">[</span><span class="kt">u8</span><span class="p">;</span><span class="w"> </span><span class="mi">16</span><span class="p">],</span><span class="w"> </span><span class="n">got_ptr</span>: <span class="nc">NonNull</span><span class="o">&lt;</span><span class="n">AtomicPtr</span><span class="o">&lt;</span><span class="kt">u8</span><span class="o">&gt;&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="o">..................</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="n">plt_val</span><span class="p">[</span><span class="mi">2</span><span class="o">..</span><span class="mi">6</span><span class="p">].</span><span class="n">copy_from_slice</span><span class="p">(</span><span class="o">&amp;</span><span class="kt">i32</span>::<span class="n">to_ne_bytes</span><span class="p">(</span><span class="kt">i32</span>::<span class="n">try_from</span><span class="p">(</span><span class="n">what</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">at</span><span class="p">).</span><span class="n">unwrap</span><span class="p">()));</span><span class="w"></span>
<span class="w">        </span><span class="o">..................</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>More info:</p>
<ul>
<li>I'm running on <code>x86_64</code> and <code>Ubuntu 20</code>.</li>
<li>My JIT only declares some external rust functions and creates a wrapper function that calls those.</li>
<li>I previously ran into another memory execution permissions problem and was pointed to use the feature flag <code>selinux-fix</code> which solved that problem (see <a href="https://github.com/bytecodealliance/wasmtime/issues/4980#issue-1391090347">https://github.com/bytecodealliance/wasmtime/issues/4980#issue-1391090347</a>).</li>
<li>Disabling <code>is_pic</code> obviously solves this panic, is that a bug?</li>
</ul>
</blockquote>



<a name="302236647"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235005%20Panic%20in%20%60write_plt_entry_bytes%3A278%60/near/302236647" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235005.20Panic.20in.20.60write_plt_entry_bytes.3A278.60.html#302236647">(Oct 04 2022 at 11:06)</a>:</h4>
<p>mokhaled2992 edited <a href="https://github.com/bytecodealliance/wasmtime/issues/5005">issue #5005</a>:</p>
<blockquote>
<p>I'm getting a panic and the stacktrace points at the line shown below. This happens at the very early stages when I initialize my JIT and try to declare some functions. Any hints on how to solve this?</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">    </span><span class="k">unsafe</span><span class="w"> </span><span class="k">fn</span> <span class="nf">write_plt_entry_bytes</span><span class="p">(</span><span class="n">plt_ptr</span>: <span class="o">*</span><span class="k">mut</span><span class="w"> </span><span class="p">[</span><span class="kt">u8</span><span class="p">;</span><span class="w"> </span><span class="mi">16</span><span class="p">],</span><span class="w"> </span><span class="n">got_ptr</span>: <span class="nc">NonNull</span><span class="o">&lt;</span><span class="n">AtomicPtr</span><span class="o">&lt;</span><span class="kt">u8</span><span class="o">&gt;&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="o">..................</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="n">plt_val</span><span class="p">[</span><span class="mi">2</span><span class="o">..</span><span class="mi">6</span><span class="p">].</span><span class="n">copy_from_slice</span><span class="p">(</span><span class="o">&amp;</span><span class="kt">i32</span>::<span class="n">to_ne_bytes</span><span class="p">(</span><span class="kt">i32</span>::<span class="n">try_from</span><span class="p">(</span><span class="n">what</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">at</span><span class="p">).</span><span class="n">unwrap</span><span class="p">()));</span><span class="w"></span>
<span class="w">        </span><span class="o">..................</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
</code></pre></div>
<h3>More info</h3>
<ul>
<li>I'm running on <code>x86_64</code> and <code>Ubuntu 20</code>.</li>
<li>My JIT only declares some external rust functions and creates a wrapper function that calls those.</li>
<li>I previously ran into another memory execution permissions problem and was pointed to use the feature flag <code>selinux-fix</code> which solved that problem (see <a href="https://github.com/bytecodealliance/wasmtime/issues/4980#issue-1391090347">https://github.com/bytecodealliance/wasmtime/issues/4980#issue-1391090347</a>).</li>
<li>Disabling <code>is_pic</code> obviously solves this panic, is that a bug?</li>
</ul>
</blockquote>



<a name="302239151"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235005%20Panic%20in%20%60write_plt_entry_bytes%3A278%60/near/302239151" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235005.20Panic.20in.20.60write_plt_entry_bytes.3A278.60.html#302239151">(Oct 04 2022 at 11:24)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/issues/5005#issuecomment-1266808528">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/5005">issue #5005</a>:</p>
<blockquote>
<p>When is_pic is enabled, it requires all code to be within 2GB of each other as a 32bit signed pc-relative offset is used for getting the address of called local functions. There is no code to guarantee this, thus leading to panics like this. I've known about this issue for a long time, but haven't had the time to think of a good solution.</p>
</blockquote>



<a name="302493098"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235005%20Panic%20in%20%60write_plt_entry_bytes%3A278%60/near/302493098" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235005.20Panic.20in.20.60write_plt_entry_bytes.3A278.60.html#302493098">(Oct 05 2022 at 16:15)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/issues/5005#issuecomment-1268627750">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/5005">issue #5005</a>:</p>
<blockquote>
<p>Pretty much.</p>
</blockquote>



<a name="302493221"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235005%20Panic%20in%20%60write_plt_entry_bytes%3A278%60/near/302493221" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235005.20Panic.20in.20.60write_plt_entry_bytes.3A278.60.html#302493221">(Oct 05 2022 at 16:15)</a>:</h4>
<p>mokhaled2992 <a href="https://github.com/bytecodealliance/wasmtime/issues/5005#issuecomment-1268626959">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/5005">issue #5005</a>:</p>
<blockquote>
<p>@bjorn3 I have been trying to wrap my head around this for a while now. So this is happening because the got and plt entries for a given function get allocated addresses too far from each other or?</p>
</blockquote>



<a name="302591454"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235005%20Panic%20in%20%60write_plt_entry_bytes%3A278%60/near/302591454" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235005.20Panic.20in.20.60write_plt_entry_bytes.3A278.60.html#302591454">(Oct 06 2022 at 06:46)</a>:</h4>
<p>mokhaled2992 <a href="https://github.com/bytecodealliance/wasmtime/issues/5005#issuecomment-1269427862">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/5005">issue #5005</a>:</p>
<blockquote>
<p>@bjorn3 I'm trying to understand why a PLT entry is always created for each function declaration in the module in pic mode. I have some questions:</p>
<ul>
<li>Where exactly in the code does the <a href="https://docs.rs/cranelift/latest/cranelift/prelude/trait.InstBuilder.html#method.call">call instruction</a> get translated to the target's call instruction/sequence?</li>
<li>Are there any external/local function calls that go through the PLT? I saw that <code>X86CallPLTRel4</code> is only generated for this special instruction <code>ElfTlsGetAddr</code>.<br>
</li>
</ul>
</blockquote>



<a name="302591482"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235005%20Panic%20in%20%60write_plt_entry_bytes%3A278%60/near/302591482" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235005.20Panic.20in.20.60write_plt_entry_bytes.3A278.60.html#302591482">(Oct 06 2022 at 06:47)</a>:</h4>
<p>mokhaled2992 edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/5005#issuecomment-1269427862">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/5005">issue #5005</a>:</p>
<blockquote>
<p>@bjorn3 I'm trying to understand why a PLT entry is always created for each function declaration in the module in pic mode. I have some questions:</p>
<ul>
<li>Where exactly in the code does the <a href="https://docs.rs/cranelift/latest/cranelift/prelude/trait.InstBuilder.html#method.call">call instruction</a> get translated to the target's call instruction/sequence?</li>
<li>Are there any external/local function calls that go through the PLT? I saw that <code>X86CallPLTRel4</code> is only generated for this special instruction <code>ElfTlsGetAddr</code>?<br>
</li>
</ul>
</blockquote>



<a name="302591507"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235005%20Panic%20in%20%60write_plt_entry_bytes%3A278%60/near/302591507" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235005.20Panic.20in.20.60write_plt_entry_bytes.3A278.60.html#302591507">(Oct 06 2022 at 06:47)</a>:</h4>
<p>mokhaled2992 edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/5005#issuecomment-1269427862">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/5005">issue #5005</a>:</p>
<blockquote>
<p>@bjorn3 I'm trying to understand why a PLT entry is always created for each function declaration in the module in pic mode. I have some questions:</p>
<ul>
<li>Where exactly in the code does the <a href="https://docs.rs/cranelift/latest/cranelift/prelude/trait.InstBuilder.html#method.call">call instruction</a> get translated to the target's call instruction/sequence?</li>
<li>Are there any external or even local function calls that go through the PLT? I saw that <code>X86CallPLTRel4</code> is only generated for this special instruction <code>ElfTlsGetAddr</code>?<br>
</li>
</ul>
</blockquote>



<a name="302591556"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235005%20Panic%20in%20%60write_plt_entry_bytes%3A278%60/near/302591556" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235005.20Panic.20in.20.60write_plt_entry_bytes.3A278.60.html#302591556">(Oct 06 2022 at 06:48)</a>:</h4>
<p>mokhaled2992 edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/5005#issuecomment-1269427862">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/5005">issue #5005</a>:</p>
<blockquote>
<p>@bjorn3 I'm trying to understand why a PLT entry is always created for each function declaration in the module in pic mode. I have some questions:</p>
<ul>
<li>Where exactly in the code does the <a href="https://docs.rs/cranelift/latest/cranelift/prelude/trait.InstBuilder.html#method.call">call instruction</a> get translated to the target's call instruction/sequence?</li>
<li>Are there any external or even local function calls that emit PLT relocations and go through the PLT at call sites? I saw that <code>X86CallPLTRel4</code> is only generated for this special instruction <code>ElfTlsGetAddr</code>?<br>
</li>
</ul>
</blockquote>



<a name="302591850"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235005%20Panic%20in%20%60write_plt_entry_bytes%3A278%60/near/302591850" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235005.20Panic.20in.20.60write_plt_entry_bytes.3A278.60.html#302591850">(Oct 06 2022 at 06:50)</a>:</h4>
<p>mokhaled2992 edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/5005#issuecomment-1269427862">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/5005">issue #5005</a>:</p>
<blockquote>
<p>@bjorn3 I'm trying to understand why a PLT entry is always created for each function declaration in the module in pic mode. I have some questions:</p>
<ul>
<li>Where exactly in the code does the <a href="https://docs.rs/cranelift/latest/cranelift/prelude/trait.InstBuilder.html#method.call">call instruction</a> get translated to the target's call instruction/sequence? I saw in the <code>isa/x64/inst/emit.rs</code> file entries for <code>Inst::CallKnown</code> and <code>Inst::CallUnknown</code> but I ca't connect the dots back to the IR call instructions.</li>
<li>Are there any external or even local function calls that emit PLT relocations and go through the PLT at call sites? I saw that <code>X86CallPLTRel4</code> is only generated for this special instruction <code>ElfTlsGetAddr</code>?<br>
</li>
</ul>
</blockquote>



<a name="302591868"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235005%20Panic%20in%20%60write_plt_entry_bytes%3A278%60/near/302591868" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235005.20Panic.20in.20.60write_plt_entry_bytes.3A278.60.html#302591868">(Oct 06 2022 at 06:51)</a>:</h4>
<p>mokhaled2992 edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/5005#issuecomment-1269427862">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/5005">issue #5005</a>:</p>
<blockquote>
<p>@bjorn3 I'm trying to understand why a PLT entry is always created for each function declaration in the module in pic mode. I have some questions:</p>
<ul>
<li>Where exactly in the code does the <a href="https://docs.rs/cranelift/latest/cranelift/prelude/trait.InstBuilder.html#method.call">call instruction</a> get translated to the target's call instruction/sequence? I saw in the <code>isa/x64/inst/emit.rs</code> file entries for <code>Inst::CallKnown</code> and <code>Inst::CallUnknown</code> but I can't connect the dots back to the IR call instructions.</li>
<li>Are there any external or even local function calls that emit PLT relocations and go through the PLT at call sites? I saw that <code>X86CallPLTRel4</code> is only generated for this special instruction <code>ElfTlsGetAddr</code>?<br>
</li>
</ul>
</blockquote>



<a name="302594120"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235005%20Panic%20in%20%60write_plt_entry_bytes%3A278%60/near/302594120" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235005.20Panic.20in.20.60write_plt_entry_bytes.3A278.60.html#302594120">(Oct 06 2022 at 07:10)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/issues/5005#issuecomment-1269458258">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/5005">issue #5005</a>:</p>
<blockquote>
<p>call lowers to CallKnown. call_indirect to CallUnknown.</p>
<blockquote>
<p>Are there any external or even local function calls that emit PLT relocations and go through the PLT at call sites? I saw that X86CallPLTRel4 is only generated for this special instruction ElfTlsGetAddr?</p>
</blockquote>
<p>For PLT, no unless hotswapping is enabled. For GOT, yes CallKnown turns into GOT lookup followed by an indirect call. It would likely be possible to stop maintaining the PLT when hotswapping is disabled, but the GOT has the same issue.</p>
</blockquote>



<a name="302594157"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235005%20Panic%20in%20%60write_plt_entry_bytes%3A278%60/near/302594157" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235005.20Panic.20in.20.60write_plt_entry_bytes.3A278.60.html#302594157">(Oct 06 2022 at 07:10)</a>:</h4>
<p>bjorn3 edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/5005#issuecomment-1269458258">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/5005">issue #5005</a>:</p>
<blockquote>
<p>call lowers to CallKnown. call_indirect to CallUnknown.</p>
<blockquote>
<p>Are there any external or even local function calls that emit PLT relocations and go through the PLT at call sites? I saw that X86CallPLTRel4 is only generated for this special instruction ElfTlsGetAddr?</p>
</blockquote>
<p>For PLT, no unless hotswapping is enabled. For GOT, yes CallKnown turns into GOT lookup followed by an indirect call in some cases. It would likely be possible to stop maintaining the PLT when hotswapping is disabled, but the GOT has the same issue.</p>
</blockquote>



<a name="302600132"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235005%20Panic%20in%20%60write_plt_entry_bytes%3A278%60/near/302600132" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235005.20Panic.20in.20.60write_plt_entry_bytes.3A278.60.html#302600132">(Oct 06 2022 at 07:58)</a>:</h4>
<p>mokhaled2992 <a href="https://github.com/bytecodealliance/wasmtime/issues/5005#issuecomment-1269529371">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/5005">issue #5005</a>:</p>
<blockquote>
<p>If I got it right, for the hotswapping we <code>declare_function</code> once and then we can (re)define that function through this sequence: <code>define_function</code> + <code>finalize_definitions</code> + <code>get_finalized_function</code> which compiles/loads the (new) definition in a new piece of memory and returns the address to it, i think it does not use or clean the memory of the old definition. My question is why do we need the PLT indirection if we already get the address to the newly created definition?</p>
</blockquote>



<a name="302600169"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235005%20Panic%20in%20%60write_plt_entry_bytes%3A278%60/near/302600169" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235005.20Panic.20in.20.60write_plt_entry_bytes.3A278.60.html#302600169">(Oct 06 2022 at 07:59)</a>:</h4>
<p>mokhaled2992 edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/5005#issuecomment-1269529371">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/5005">issue #5005</a>:</p>
<blockquote>
<p>If I got it right, for the hotswapping we <code>declare_function</code> once and then we can (re)define that function through this sequence: (<code>prepare_for_function_redefine</code>) + <code>define_function</code> + <code>finalize_definitions</code> + <code>get_finalized_function</code> which compiles/loads the (new) definition in a new piece of memory and returns the address to it, i think it does not use or clean the memory of the old definition. My question is why do we need the PLT indirection if we already get the address to the newly created definition?</p>
</blockquote>



<a name="302605291"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235005%20Panic%20in%20%60write_plt_entry_bytes%3A278%60/near/302605291" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235005.20Panic.20in.20.60write_plt_entry_bytes.3A278.60.html#302605291">(Oct 06 2022 at 08:36)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/issues/5005#issuecomment-1269589638">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/5005">issue #5005</a>:</p>
<blockquote>
<p>The <code>define_function</code> replaces the entry in the GOT, causing all calls from the old function to be redirected to the new definition, even when done by other compiled code. If the GOT didn't exist, we would have to change all executable memory back to read+write, relocate it again and change it back. This is much slower and isn't thread safe. The PLT indirection is for cases where a direct GOT access is not possible, like for function pointers. The PLT is basically a trampoline jumping to the address in the corresponding GOT entry.</p>
<blockquote>
<p>i think it does not use or clean the memory of the old definition.</p>
</blockquote>
<p>Indeed. That it doesn't deallocate the old definition is something I would like to see fixed, but that will require a more complex scheme for allocating memory to put the executable code in and a way to check that the function is no longer in use by any thread.</p>
</blockquote>



<a name="302612763"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235005%20Panic%20in%20%60write_plt_entry_bytes%3A278%60/near/302612763" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235005.20Panic.20in.20.60write_plt_entry_bytes.3A278.60.html#302612763">(Oct 06 2022 at 09:24)</a>:</h4>
<p>mokhaled2992 <a href="https://github.com/bytecodealliance/wasmtime/issues/5005#issuecomment-1269667569">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/5005">issue #5005</a>:</p>
<blockquote>
<p>Oh I believe I got it now, this is done through <code>get_address</code> that returns the PLT entry for hotswapped mode instead of the actual function pointer. This hotswapping is probably meant for the non top level functions, so If you have X calling Y, you can get a finalized definition to X you can hotswap Y, but you can't get PLT entries to top level functions right?</p>
</blockquote>



<a name="302615464"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235005%20Panic%20in%20%60write_plt_entry_bytes%3A278%60/near/302615464" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235005.20Panic.20in.20.60write_plt_entry_bytes.3A278.60.html#302615464">(Oct 06 2022 at 09:40)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/issues/5005#issuecomment-1269695464">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/5005">issue #5005</a>:</p>
<blockquote>
<blockquote>
<p>Oh I believe I got it now, this is done through get_address that returns the PLT entry for hotswapped mode instead of the actual function pointer</p>
</blockquote>
<p>Indeed.</p>
<blockquote>
<p>This hotswapping is probably meant for the non top level functions, so If you have X calling Y, you can get a finalized definition to X you can hotswap Y, but you can't get PLT entries to top level functions right?</p>
</blockquote>
<p><code>get_finalized_function</code> returns a PLT entry too in hotswap mode I believe.</p>
</blockquote>



<a name="302615888"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235005%20Panic%20in%20%60write_plt_entry_bytes%3A278%60/near/302615888" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235005.20Panic.20in.20.60write_plt_entry_bytes.3A278.60.html#302615888">(Oct 06 2022 at 09:43)</a>:</h4>
<p>mokhaled2992 <a href="https://github.com/bytecodealliance/wasmtime/issues/5005#issuecomment-1269699573">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/5005">issue #5005</a>:</p>
<blockquote>
<p>I think it just returns the pointer to the allocated memory where the function was loaded unless I missed some other indirection :) </p>
<p><a href="https://github.com/bytecodealliance/wasmtime/blob/main/cranelift/jit/src/backend.rs#L379">https://github.com/bytecodealliance/wasmtime/blob/main/cranelift/jit/src/backend.rs#L379</a></p>
</blockquote>



<a name="302616374"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235005%20Panic%20in%20%60write_plt_entry_bytes%3A278%60/near/302616374" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235005.20Panic.20in.20.60write_plt_entry_bytes.3A278.60.html#302616374">(Oct 06 2022 at 09:46)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/issues/5005#issuecomment-1269703859">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/5005">issue #5005</a>:</p>
<blockquote>
<p>Indeed.</p>
</blockquote>



<a name="302617244"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235005%20Panic%20in%20%60write_plt_entry_bytes%3A278%60/near/302617244" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235005.20Panic.20in.20.60write_plt_entry_bytes.3A278.60.html#302617244">(Oct 06 2022 at 09:52)</a>:</h4>
<p>mokhaled2992 <a href="https://github.com/bytecodealliance/wasmtime/issues/5005#issuecomment-1269713665">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/5005">issue #5005</a>:</p>
<blockquote>
<p>Thanks alot @bjorn3 for all the support <span aria-label="heart" class="emoji emoji-2764" role="img" title="heart">:heart:</span>.</p>
<p>Feel free to close the issue if you have something that duplicates the original problem. I saw your suggestion in <a href="https://github.com/bytecodealliance/wasmtime/issues/4986">https://github.com/bytecodealliance/wasmtime/issues/4986</a> which can hit two birds with one stone as far as I understood.</p>
</blockquote>



<a name="302619083"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235005%20Panic%20in%20%60write_plt_entry_bytes%3A278%60/near/302619083" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235005.20Panic.20in.20.60write_plt_entry_bytes.3A278.60.html#302619083">(Oct 06 2022 at 10:04)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/issues/5005#issuecomment-1269732584">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/5005">issue #5005</a>:</p>
<blockquote>
<p>I don't believe I had opened an issue for this already, so keeping it open is fine I think.</p>
</blockquote>



<a name="448096513"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235005%20Panic%20in%20%60write_plt_entry_bytes%3A278%60/near/448096513" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235005.20Panic.20in.20.60write_plt_entry_bytes.3A278.60.html#448096513">(Jun 30 2024 at 09:50)</a>:</h4>
<p>Dimchikkk <a href="https://github.com/bytecodealliance/wasmtime/issues/5005#issuecomment-2198501580">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/5005">issue #5005</a>:</p>
<blockquote>
<blockquote>
<p>Indeed. That it doesn't deallocate the old definition is something I would like to see fixed, but that will require a more complex scheme for allocating memory to put the executable code in and a way to check that the function is no longer in use by any thread.</p>
</blockquote>
<p>Hi @bjorn3 , sorry for hijacking the thread but just wondering if you could share mode details on how would you start implementing swapped function deallocation... is it sort of garbage collector that tracks all definitions... if it was swapped with new definition and old definition is not used by any thread - deallocate memory?<br>
</p>
</blockquote>



<a name="448101566"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235005%20Panic%20in%20%60write_plt_entry_bytes%3A278%60/near/448101566" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235005.20Panic.20in.20.60write_plt_entry_bytes.3A278.60.html#448101566">(Jun 30 2024 at 10:32)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/issues/5005#issuecomment-2198512336">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/5005">issue #5005</a>:</p>
<blockquote>
<p>My idea has been for the user of cranelift-jit to tell which functions are no longer necessary. Then cranelift-jit needs to store which parts of each page are still used by necessary functions and when no used function is still part of the page, the page can be deallocated. Or alternatively at the cost of memory usage each function can be stored in separate pages which would allow immediately deallocating all pages when a function is marked as unused..</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>