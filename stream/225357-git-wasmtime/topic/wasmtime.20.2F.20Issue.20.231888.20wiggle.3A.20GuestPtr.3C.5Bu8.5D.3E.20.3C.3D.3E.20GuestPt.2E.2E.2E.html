<html>
<head><meta charset="utf-8"><title>wasmtime / Issue #1888 wiggle: GuestPtr&lt;[u8]&gt; &lt;=&gt; GuestPt... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231888.20wiggle.3A.20GuestPtr.3C.5Bu8.5D.3E.20.3C.3D.3E.20GuestPt.2E.2E.2E.html">wasmtime / Issue #1888 wiggle: GuestPtr&lt;[u8]&gt; &lt;=&gt; GuestPt...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="201056940"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231888%20wiggle%3A%20GuestPtr%3C%5Bu8%5D%3E%20%3C%3D%3E%20GuestPt.../near/201056940" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231888.20wiggle.3A.20GuestPtr.3C.5Bu8.5D.3E.20.3C.3D.3E.20GuestPt.2E.2E.2E.html#201056940">(Jun 16 2020 at 18:38)</a>:</h4>
<p>pchickey labeled <a href="https://github.com/bytecodealliance/wasmtime/issues/1888">Issue #1888</a>:</p>
<blockquote>
<p>This issue is specific to the Wiggle crate. It is a good beginner issue.</p>
<h4>Feature</h4>
<p>We don't have a way to convert between GuestPtr&lt;[u8]&gt; and GuestPtr&lt;str&gt;. I just came across a case where it would be useful - I have a <code>GuestPtr&lt;str&gt;</code> and I need to pass the underlying data as <code>&amp;[u8]</code> to a function that will perform its own utf8 validation - and the opposite is probably useful as well. #### Benefit</p>
<h4>Implementation</h4>
<p>Add methods to <code>impl GuestPtr&lt;[T]&gt;</code> and impl <code>GuestPtr&lt;str&gt;</code> that return the other type.</p>
</blockquote>



<a name="201056941"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231888%20wiggle%3A%20GuestPtr%3C%5Bu8%5D%3E%20%3C%3D%3E%20GuestPt.../near/201056941" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231888.20wiggle.3A.20GuestPtr.3C.5Bu8.5D.3E.20.3C.3D.3E.20GuestPt.2E.2E.2E.html#201056941">(Jun 16 2020 at 18:38)</a>:</h4>
<p>pchickey opened <a href="https://github.com/bytecodealliance/wasmtime/issues/1888">Issue #1888</a>:</p>
<blockquote>
<p>This issue is specific to the Wiggle crate. It is a good beginner issue.</p>
<h4>Feature</h4>
<p>We don't have a way to convert between GuestPtr&lt;[u8]&gt; and GuestPtr&lt;str&gt;. I just came across a case where it would be useful - I have a <code>GuestPtr&lt;str&gt;</code> and I need to pass the underlying data as <code>&amp;[u8]</code> to a function that will perform its own utf8 validation - and the opposite is probably useful as well. #### Benefit</p>
<h4>Implementation</h4>
<p>Add methods to <code>impl GuestPtr&lt;[T]&gt;</code> and impl <code>GuestPtr&lt;str&gt;</code> that return the other type.</p>
</blockquote>



<a name="201056964"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231888%20wiggle%3A%20GuestPtr%3C%5Bu8%5D%3E%20%3C%3D%3E%20GuestPt.../near/201056964" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231888.20wiggle.3A.20GuestPtr.3C.5Bu8.5D.3E.20.3C.3D.3E.20GuestPt.2E.2E.2E.html#201056964">(Jun 16 2020 at 18:38)</a>:</h4>
<p>pchickey edited <a href="https://github.com/bytecodealliance/wasmtime/issues/1888">Issue #1888</a>:</p>
<blockquote>
<p>This issue is specific to the Wiggle crate. It is a good beginner issue.</p>
<h4>Feature</h4>
<p>We don't have a way to convert between GuestPtr&lt;[u8]&gt; and GuestPtr&lt;str&gt;. I just came across a case where it would be useful - I have a <code>GuestPtr&lt;str&gt;</code> and I need to pass the underlying data as <code>&amp;[u8]</code> to a function that will perform its own utf8 validation - and the opposite is probably useful as well.</p>
<h4>Implementation</h4>
<p>Add methods to <code>impl GuestPtr&lt;[T]&gt;</code> and impl <code>GuestPtr&lt;str&gt;</code> that return the other type.</p>
</blockquote>



<a name="201253349"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231888%20wiggle%3A%20GuestPtr%3C%5Bu8%5D%3E%20%3C%3D%3E%20GuestPt.../near/201253349" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231888.20wiggle.3A.20GuestPtr.3C.5Bu8.5D.3E.20.3C.3D.3E.20GuestPt.2E.2E.2E.html#201253349">(Jun 18 2020 at 11:04)</a>:</h4>
<p>siyopao <a href="https://github.com/bytecodealliance/wasmtime/issues/1888#issuecomment-645946238">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/1888">Issue #1888</a>:</p>
<blockquote>
<p>Hi! Would it be okay if I took a shot at this? Although I may require a bit more explanation... </p>
</blockquote>



<a name="201292689"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231888%20wiggle%3A%20GuestPtr%3C%5Bu8%5D%3E%20%3C%3D%3E%20GuestPt.../near/201292689" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231888.20wiggle.3A.20GuestPtr.3C.5Bu8.5D.3E.20.3C.3D.3E.20GuestPt.2E.2E.2E.html#201292689">(Jun 18 2020 at 16:30)</a>:</h4>
<p>pchickey <a href="https://github.com/bytecodealliance/wasmtime/issues/1888#issuecomment-646147040">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/1888">Issue #1888</a>:</p>
<blockquote>
<p>Welcome @siyopao, thank you for volunteering!</p>
<p>In the wiggle crate, we have three impls of the <code>Pointee</code> trait that describe how we keep track of pointers to atomic values <code>T</code>, slices <code>[T]</code>, and strings <code>str</code>. A string is just a <code>[u8]</code> which contains valid utf-8 codepoints.</p>
<p>One mechanic of <code>GuestPtr</code> is we check for validity of the contents not when the <code>GuestPtr</code> is constructed but when it is "dereferenced" - via <code>read</code>, <code>as_slice</code>, or <code>as_str</code>. So, the check for whether the contents of a <code>GuestPtr&lt;str&gt;</code> are valid utf-8 doesn't occur until <code>GuestPtr::as_str</code> is invoked.</p>
<p>If the user wishes to skip the utf-8 validity check, there is currently no way to take a <code>GuestPtr&lt;str&gt;</code> and treat it as a <code>GuestPtr&lt;[u8]&gt;</code>, these are kept separate in the type system even though they have the same <code>type Pointer = (u32, u32);</code> indicating the start of, and length of, the linear memory region.</p>
<p>So, I propose adding a method to <code>impl GuestPtr&lt;str&gt;</code> that has the signature <code>pub fn as_byte_ptr(&amp;self) -&gt; GuestPtr&lt;[u8]&gt;</code>, and a new <code>impl GuestPtr&lt;[u8]&gt;</code> that has a function with signature <code>pub fn as_str_ptr(&amp;self) -&gt; GuestPtr&lt;str&gt;</code>.</p>
</blockquote>



<a name="201292720"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231888%20wiggle%3A%20GuestPtr%3C%5Bu8%5D%3E%20%3C%3D%3E%20GuestPt.../near/201292720" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231888.20wiggle.3A.20GuestPtr.3C.5Bu8.5D.3E.20.3C.3D.3E.20GuestPt.2E.2E.2E.html#201292720">(Jun 18 2020 at 16:30)</a>:</h4>
<p>pchickey edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/1888#issuecomment-646147040">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/1888">Issue #1888</a>:</p>
<blockquote>
<p>Welcome @siyopao, thank you for volunteering!</p>
<p>In the wiggle crate, we have three impls of the <code>Pointee</code> trait that describe how we keep track of pointers to atomic values <code>T</code>, slices <code>[T]</code>, and strings <code>str</code>. A string is just a <code>[u8]</code> which contains valid utf-8 codepoints.</p>
<p>One mechanic of <code>GuestPtr</code> is we check for validity of the contents not when the <code>GuestPtr</code> is constructed but when it is "dereferenced" - via <code>read</code>, <code>as_slice</code>, or <code>as_str</code>. So, the check for whether the contents of a <code>GuestPtr&lt;str&gt;</code> are valid utf-8 doesn't occur until <code>GuestPtr::as_str</code> is invoked.</p>
<p>If the user wishes to skip the utf-8 validity check, there is currently no way to take a <code>GuestPtr&lt;str&gt;</code> and treat it as a <code>GuestPtr&lt;[u8]&gt;</code>, these are kept separate in the type system even though they have the same <code>type Pointer = (u32, u32);</code> indicating the start of, and length of, the linear memory region.</p>
<p>So, I propose adding a method to <code>impl GuestPtr&lt;str&gt;</code> that has the signature <code>pub fn as_byte_ptr(&amp;self) -&gt; GuestPtr&lt;[u8]&gt;</code>, and a new <code>impl GuestPtr&lt;[u8]&gt;</code> that has a method with signature <code>pub fn as_str_ptr(&amp;self) -&gt; GuestPtr&lt;str&gt;</code>.</p>
</blockquote>



<a name="201293437"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231888%20wiggle%3A%20GuestPtr%3C%5Bu8%5D%3E%20%3C%3D%3E%20GuestPt.../near/201293437" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231888.20wiggle.3A.20GuestPtr.3C.5Bu8.5D.3E.20.3C.3D.3E.20GuestPt.2E.2E.2E.html#201293437">(Jun 18 2020 at 16:36)</a>:</h4>
<p>pchickey edited <a href="https://github.com/bytecodealliance/wasmtime/issues/1888">Issue #1888</a>:</p>
<blockquote>
<p>This issue is specific to the Wiggle crate. It is a good beginner issue.</p>
<h4>Feature</h4>
<p>We don't have a way to convert between <code>GuestPtr&lt;[u8]&gt;</code> and <code>GuestPtr&lt;str&gt;</code>. I just came across a case where it would be useful - I have a <code>GuestPtr&lt;str&gt;</code> and I need to pass the underlying data as <code>&amp;[u8]</code> to a function that will perform its own utf8 validation - and the opposite is probably useful as well.</p>
<h4>Implementation</h4>
<p>Add methods to <code>impl GuestPtr&lt;[u8]&gt;</code> and impl <code>GuestPtr&lt;str&gt;</code> that return the other type.</p>
</blockquote>



<a name="201296273"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231888%20wiggle%3A%20GuestPtr%3C%5Bu8%5D%3E%20%3C%3D%3E%20GuestPt.../near/201296273" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231888.20wiggle.3A.20GuestPtr.3C.5Bu8.5D.3E.20.3C.3D.3E.20GuestPt.2E.2E.2E.html#201296273">(Jun 18 2020 at 16:55)</a>:</h4>
<p>pchickey edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/1888#issuecomment-646147040">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/1888">Issue #1888</a>:</p>
<blockquote>
<p>Welcome @siyopao, thank you for volunteering!</p>
<p>In the wiggle crate, we have three impls of the <code>Pointee</code> trait that describe how we keep track of pointers to atomic values <code>T</code>, slices <code>[T]</code>, and strings <code>str</code>. A string is just a <code>[u8]</code> which contains valid utf-8 codepoints.</p>
<p>One mechanic of <code>GuestPtr</code> is we check for validity of the contents not when the <code>GuestPtr</code> is constructed but when it is "dereferenced" - via <code>read</code>, <code>as_slice</code>, or <code>as_str</code>. So, the check for whether the contents of a <code>GuestPtr&lt;str&gt;</code> are valid utf-8 doesn't occur until <code>GuestPtr::as_str</code> is invoked.</p>
<p>If the user wishes to skip the utf-8 validity check, there is currently no way to take a <code>GuestPtr&lt;str&gt;</code> and treat it as a <code>GuestPtr&lt;[u8]&gt;</code>, these are kept separate in the type system even though they have the same <code>type Pointer = (u32, u32);</code> indicating the start of, and length of, the linear memory region they point to.</p>
<p>So, I propose adding a method to <code>impl GuestPtr&lt;str&gt;</code> that has the signature <code>pub fn as_byte_ptr(&amp;self) -&gt; GuestPtr&lt;[u8]&gt;</code>, and a new <code>impl GuestPtr&lt;[u8]&gt;</code> that has a method with signature <code>pub fn as_str_ptr(&amp;self) -&gt; GuestPtr&lt;str&gt;</code>.</p>
</blockquote>



<a name="201344451"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231888%20wiggle%3A%20GuestPtr%3C%5Bu8%5D%3E%20%3C%3D%3E%20GuestPt.../near/201344451" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231888.20wiggle.3A.20GuestPtr.3C.5Bu8.5D.3E.20.3C.3D.3E.20GuestPt.2E.2E.2E.html#201344451">(Jun 19 2020 at 01:31)</a>:</h4>
<p>siyopao <a href="https://github.com/bytecodealliance/wasmtime/issues/1888#issuecomment-646385895">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/1888">Issue #1888</a>:</p>
<blockquote>
<p>Hello @pchickey! Wow, thank you for the in-depth explanation. Let me see what I can do <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span> </p>
</blockquote>



<a name="201456835"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231888%20wiggle%3A%20GuestPtr%3C%5Bu8%5D%3E%20%3C%3D%3E%20GuestPt.../near/201456835" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231888.20wiggle.3A.20GuestPtr.3C.5Bu8.5D.3E.20.3C.3D.3E.20GuestPt.2E.2E.2E.html#201456835">(Jun 20 2020 at 01:59)</a>:</h4>
<p>siyopao <a href="https://github.com/bytecodealliance/wasmtime/issues/1888#issuecomment-646920151">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/1888">Issue #1888</a>:</p>
<blockquote>
<p>Hi @pchickey. Again, thank you the the explanation. So I have started to take a look, and noticed that the implementation of <code>GuestPtr&lt;str&gt;</code> has a method</p>
<div class="codehilite"><pre><span></span><code>pub fn as_bytes(&amp;self) -&gt; GuestPtr&lt;&#39;a, [u8]&gt; {
    GuestPtr::new(self.mem, self.pointer)
}
</code></pre></div>


<p>Is this basically what your proposed <code>pub fn as_byte_ptr(&amp;self) -&gt; GuestPtr&lt;[u8]&gt;</code> would look like, or am I totally off base? Thank you!</p>
</blockquote>



<a name="201636668"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231888%20wiggle%3A%20GuestPtr%3C%5Bu8%5D%3E%20%3C%3D%3E%20GuestPt.../near/201636668" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231888.20wiggle.3A.20GuestPtr.3C.5Bu8.5D.3E.20.3C.3D.3E.20GuestPt.2E.2E.2E.html#201636668">(Jun 22 2020 at 17:33)</a>:</h4>
<p>pchickey <a href="https://github.com/bytecodealliance/wasmtime/issues/1888#issuecomment-647672366">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/1888">Issue #1888</a>:</p>
<blockquote>
<p>If that typechecks then it looks correct to me.</p>
</blockquote>



<a name="201809888"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231888%20wiggle%3A%20GuestPtr%3C%5Bu8%5D%3E%20%3C%3D%3E%20GuestPt.../near/201809888" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231888.20wiggle.3A.20GuestPtr.3C.5Bu8.5D.3E.20.3C.3D.3E.20GuestPt.2E.2E.2E.html#201809888">(Jun 24 2020 at 04:08)</a>:</h4>
<p>pchickey closed <a href="https://github.com/bytecodealliance/wasmtime/issues/1888">Issue #1888</a>:</p>
<blockquote>
<p>This issue is specific to the Wiggle crate. It is a good beginner issue.</p>
<h4>Feature</h4>
<p>We don't have a way to convert between <code>GuestPtr&lt;[u8]&gt;</code> and <code>GuestPtr&lt;str&gt;</code>. I just came across a case where it would be useful - I have a <code>GuestPtr&lt;str&gt;</code> and I need to pass the underlying data as <code>&amp;[u8]</code> to a function that will perform its own utf8 validation - and the opposite is probably useful as well.</p>
<h4>Implementation</h4>
<p>Add methods to <code>impl GuestPtr&lt;[u8]&gt;</code> and impl <code>GuestPtr&lt;str&gt;</code> that return the other type.</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>