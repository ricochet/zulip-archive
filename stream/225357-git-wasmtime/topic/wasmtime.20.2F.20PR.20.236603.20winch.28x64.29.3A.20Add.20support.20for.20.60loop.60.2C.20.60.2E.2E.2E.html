<html>
<head><meta charset="utf-8"><title>wasmtime / PR #6603 winch(x64): Add support for `loop`, `... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236603.20winch.28x64.29.3A.20Add.20support.20for.20.60loop.60.2C.20.60.2E.2E.2E.html">wasmtime / PR #6603 winch(x64): Add support for `loop`, `...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="367590900"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236603%20winch%28x64%29%3A%20Add%20support%20for%20%60loop%60%2C%20%60.../near/367590900" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236603.20winch.28x64.29.3A.20Add.20support.20for.20.60loop.60.2C.20.60.2E.2E.2E.html#367590900">(Jun 19 2023 at 10:49)</a>:</h4>
<p>saulecabrera opened <a href="https://github.com/bytecodealliance/wasmtime/pull/6603">PR #6603</a> from <code>saulecabrera:winch-control-flow-loop</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>Part of <a href="https://github.com/bytecodealliance/wasmtime/issues/6528">https://github.com/bytecodealliance/wasmtime/issues/6528</a></p>
<p>This change adds support for the <code>loop</code>, <code>br</code> and <code>br_if</code> instructions as well as unreachable code handling. Whenever an instruction that affects reachability is emitted (<code>br</code> in the case of this PR), the compiler will enter into an unreachable code state, essentially ignoring most of the subsequent instructions. When handling the unreachable code state some instructions are still observed, in order to determine if reachability should be restored.</p>
<p>This change, particulary the handling of unreachable code, adds all the necessary building blocks to the compiler to emit other instructions that affect reachability (e.g <code>unreachable</code>, <code>return</code>).</p>
<p>I decided to bundle these instructions together to be able to test more complex scenarios with <code>loop</code>, but I'm happy to split this change into two (or more). </p>
<p>&lt;!--<br>
Please make sure you include the following information:</p>
<ul>
<li>
<p>If this work has been discussed elsewhere, please include a link to that<br>
  conversation. If it was discussed in an issue, just mention "issue #...".</p>
</li>
<li>
<p>Explain why this change is needed. If the details are in an issue already,<br>
  this can be brief.</p>
</li>
</ul>
<p>Our development process is documented in the Wasmtime book:<br>
<a href="https://docs.wasmtime.dev/contributing-development-process.html">https://docs.wasmtime.dev/contributing-development-process.html</a></p>
<p>Please ensure all communication follows the code of conduct:<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>
--&gt;</p>
</blockquote>



<a name="367590904"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236603%20winch%28x64%29%3A%20Add%20support%20for%20%60loop%60%2C%20%60.../near/367590904" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236603.20winch.28x64.29.3A.20Add.20support.20for.20.60loop.60.2C.20.60.2E.2E.2E.html#367590904">(Jun 19 2023 at 10:49)</a>:</h4>
<p><strong>saulecabrera</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/6603">PR #6603</a>.</p>



<a name="367590905"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236603%20winch%28x64%29%3A%20Add%20support%20for%20%60loop%60%2C%20%60.../near/367590905" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236603.20winch.28x64.29.3A.20Add.20support.20for.20.60loop.60.2C.20.60.2E.2E.2E.html#367590905">(Jun 19 2023 at 10:49)</a>:</h4>
<p><strong>saulecabrera</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-fuzz-reviewers">wasmtime-fuzz-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/6603">PR #6603</a>.</p>



<a name="367590912"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236603%20winch%28x64%29%3A%20Add%20support%20for%20%60loop%60%2C%20%60.../near/367590912" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236603.20winch.28x64.29.3A.20Add.20support.20for.20.60loop.60.2C.20.60.2E.2E.2E.html#367590912">(Jun 19 2023 at 10:49)</a>:</h4>
<p><strong>saulecabrera</strong> requested <a href="https://github.com/jameysharp">jameysharp</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/6603">PR #6603</a>.</p>



<a name="367590914"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236603%20winch%28x64%29%3A%20Add%20support%20for%20%60loop%60%2C%20%60.../near/367590914" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236603.20winch.28x64.29.3A.20Add.20support.20for.20.60loop.60.2C.20.60.2E.2E.2E.html#367590914">(Jun 19 2023 at 10:49)</a>:</h4>
<p><strong>saulecabrera</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-compiler-reviewers">wasmtime-compiler-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/6603">PR #6603</a>.</p>



<a name="367590952"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236603%20winch%28x64%29%3A%20Add%20support%20for%20%60loop%60%2C%20%60.../near/367590952" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236603.20winch.28x64.29.3A.20Add.20support.20for.20.60loop.60.2C.20.60.2E.2E.2E.html#367590952">(Jun 19 2023 at 10:49)</a>:</h4>
<p><strong>saulecabrera</strong> requested <a href="https://github.com/cfallin">cfallin</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/6603">PR #6603</a>.</p>



<a name="367956558"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236603%20winch%28x64%29%3A%20Add%20support%20for%20%60loop%60%2C%20%60.../near/367956558" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236603.20winch.28x64.29.3A.20Add.20support.20for.20.60loop.60.2C.20.60.2E.2E.2E.html#367956558">(Jun 20 2023 at 14:53)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/6603#discussion_r1235392958">PR review comment</a>:</p>
<blockquote>
<p>Bit of a drive-by comment, but altering the core loop here felt a bit unfortunate mainly along the lines of the translation of <code>If</code> for example was spread across <code>handle_unreachable_state</code> as well as the typical visitor.</p>
<p>One option though might be to use macro-magic to get <code>ValidateThenVisit</code> to skip all instructions except the allow-listed control flow instructions when the state is <code>unreachable</code>, sort of like how the visitor today fails on all instructions except for an allow-listed set that's implemented?</p>
</blockquote>



<a name="367988676"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236603%20winch%28x64%29%3A%20Add%20support%20for%20%60loop%60%2C%20%60.../near/367988676" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236603.20winch.28x64.29.3A.20Add.20support.20for.20.60loop.60.2C.20.60.2E.2E.2E.html#367988676">(Jun 20 2023 at 16:30)</a>:</h4>
<p>saulecabrera created <a href="https://github.com/bytecodealliance/wasmtime/pull/6603#discussion_r1235517703">PR review comment</a>:</p>
<blockquote>
<p>Actually this is something that I meant to revisit after getting everything working as I didn't want to get into macro-magic at beginning, while getting all the pieces working together, but it fell through the cracks! I'll give the macro approach a try!</p>
</blockquote>



<a name="367989251"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236603%20winch%28x64%29%3A%20Add%20support%20for%20%60loop%60%2C%20%60.../near/367989251" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236603.20winch.28x64.29.3A.20Add.20support.20for.20.60loop.60.2C.20.60.2E.2E.2E.html#367989251">(Jun 20 2023 at 16:32)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6603#pullrequestreview-1488487936">PR review</a>:</p>
<blockquote>
<p>A few thoughts but overall I like how this is turning out -- the abstractions around the <code>ControlStackFrame</code> are very clean!</p>
</blockquote>



<a name="367989252"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236603%20winch%28x64%29%3A%20Add%20support%20for%20%60loop%60%2C%20%60.../near/367989252" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236603.20winch.28x64.29.3A.20Add.20support.20for.20.60loop.60.2C.20.60.2E.2E.2E.html#367989252">(Jun 20 2023 at 16:32)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6603#pullrequestreview-1488487936">PR review</a>:</p>
<blockquote>
<p>A few thoughts but overall I like how this is turning out -- the abstractions around the <code>ControlStackFrame</code> are very clean!</p>
</blockquote>



<a name="367989254"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236603%20winch%28x64%29%3A%20Add%20support%20for%20%60loop%60%2C%20%60.../near/367989254" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236603.20winch.28x64.29.3A.20Add.20support.20for.20.60loop.60.2C.20.60.2E.2E.2E.html#367989254">(Jun 20 2023 at 16:32)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/6603#discussion_r1235476770">PR review comment</a>:</p>
<blockquote>
<p>Can we call this <code>handle_unreachable_operator</code> instead? The current name <code>handle_unreachable_state</code> implies to me maybe that it's invoked when we enter an unreachable region, or something like that; it's still a per-operator handler, just for unreachable operators.</p>
</blockquote>



<a name="367989255"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236603%20winch%28x64%29%3A%20Add%20support%20for%20%60loop%60%2C%20%60.../near/367989255" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236603.20winch.28x64.29.3A.20Add.20support.20for.20.60loop.60.2C.20.60.2E.2E.2E.html#367989255">(Jun 20 2023 at 16:32)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/6603#discussion_r1235476780">PR review comment</a>:</p>
<blockquote>
<p>Can we call this <code>handle_unreachable_operator</code> instead? The current name <code>handle_unreachable_state</code> implies to me maybe that it's invoked when we enter an unreachable region, or something like that; it's still a per-operator handler, just for unreachable operators.</p>
</blockquote>



<a name="367989256"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236603%20winch%28x64%29%3A%20Add%20support%20for%20%60loop%60%2C%20%60.../near/367989256" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236603.20winch.28x64.29.3A.20Add.20support.20for.20.60loop.60.2C.20.60.2E.2E.2E.html#367989256">(Jun 20 2023 at 16:32)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/6603#discussion_r1235506003">PR review comment</a>:</p>
<blockquote>
<p>Can we call this field something more like <code>exit_reachable</code>? <code>branch_target</code> makes me think this is a label; really this is a reachability flag for some other program point than the current one.</p>
</blockquote>



<a name="367989258"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236603%20winch%28x64%29%3A%20Add%20support%20for%20%60loop%60%2C%20%60.../near/367989258" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236603.20winch.28x64.29.3A.20Add.20support.20for.20.60loop.60.2C.20.60.2E.2E.2E.html#367989258">(Jun 20 2023 at 16:32)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/6603#discussion_r1235519095">PR review comment</a>:</p>
<blockquote>
<p>Does this need to handle <code>implicit</code> frames? Or is there an invariant here that only the outer body frame is implicit? If so, maybe we could remove the <code>implicit</code> flag (since it allows representing state that violates invariants) and instead handle the body-block case another way (e.g. at end/pop, recognize that it's the outermost block)?</p>
</blockquote>



<a name="367989259"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236603%20winch%28x64%29%3A%20Add%20support%20for%20%60loop%60%2C%20%60.../near/367989259" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236603.20winch.28x64.29.3A.20Add.20support.20for.20.60loop.60.2C.20.60.2E.2E.2E.html#367989259">(Jun 20 2023 at 16:32)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/6603#discussion_r1235479572">PR review comment</a>:</p>
<blockquote>
<p>It's unfortunately not quite as simple as skipping ops, as the logic itself differs too... <code>cranelift-wasm</code> also separates out the "unreachable case" to a wholly separate handler.</p>
<p>I do agree that the asymmetry between ordinary visitors (which are quite nice) and an explicit match-on-op is not great. We <em>could</em> put the logic back into <code>visit_*</code> for cases where both reachable and unreachable have handlers (e.g. control-flow and <code>end</code>) and, at the top of every "irrelevant in unreachable code" op, do a <code>if self.context.unreachable { return Ok(()); }</code> or wrap that in a <code>skip_if_unreachable!();</code> macro or something. @saulecabrera what do you think?</p>
</blockquote>



<a name="367989260"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236603%20winch%28x64%29%3A%20Add%20support%20for%20%60loop%60%2C%20%60.../near/367989260" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236603.20winch.28x64.29.3A.20Add.20support.20for.20.60loop.60.2C.20.60.2E.2E.2E.html#367989260">(Jun 20 2023 at 16:32)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/6603#discussion_r1235508618">PR review comment</a>:</p>
<blockquote>
<p>Actually, after reading further: I was struggling to understand how this got set when the block "falls through"; it turns out it it isn't, and rather that case is implicitly handled because if we reach an <code>End</code> for a block while in reachable code, we'll remain reachable. So maybe something like <code>is_branch_target</code> makes it clear it's a predicate.</p>
</blockquote>



<a name="367992655"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236603%20winch%28x64%29%3A%20Add%20support%20for%20%60loop%60%2C%20%60.../near/367992655" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236603.20winch.28x64.29.3A.20Add.20support.20for.20.60loop.60.2C.20.60.2E.2E.2E.html#367992655">(Jun 20 2023 at 16:44)</a>:</h4>
<p>saulecabrera created <a href="https://github.com/bytecodealliance/wasmtime/pull/6603#discussion_r1235533471">PR review comment</a>:</p>
<blockquote>
<p>If the macro approach doesn't work and if there's a strong preference to avoid mixing the visitors with match-on-op, @cfallin's suggestion is what I had in mind as a fallback. One thing that I like of the current approach, is that the handling of unreachable code is isolated and should only be updated if there's a need to deal with such state while handling the unreachable code state in each visitor function is a bit more manual and error prone, but in the spirit of more explicit code I think that's fine. </p>
</blockquote>



<a name="367999605"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236603%20winch%28x64%29%3A%20Add%20support%20for%20%60loop%60%2C%20%60.../near/367999605" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236603.20winch.28x64.29.3A.20Add.20support.20for.20.60loop.60.2C.20.60.2E.2E.2E.html#367999605">(Jun 20 2023 at 17:10)</a>:</h4>
<p>saulecabrera created <a href="https://github.com/bytecodealliance/wasmtime/pull/6603#discussion_r1235564258">PR review comment</a>:</p>
<blockquote>
<p>Yeah, really the only implicit frame that should exist should be the outermost. So this flag can be removed I believe and instead use the "outermost" frame as the invariant here. </p>
</blockquote>



<a name="368041902"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236603%20winch%28x64%29%3A%20Add%20support%20for%20%60loop%60%2C%20%60.../near/368041902" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236603.20winch.28x64.29.3A.20Add.20support.20for.20.60loop.60.2C.20.60.2E.2E.2E.html#368041902">(Jun 20 2023 at 20:02)</a>:</h4>
<p>saulecabrera updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6603">PR #6603</a>.</p>



<a name="368044890"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236603%20winch%28x64%29%3A%20Add%20support%20for%20%60loop%60%2C%20%60.../near/368044890" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236603.20winch.28x64.29.3A.20Add.20support.20for.20.60loop.60.2C.20.60.2E.2E.2E.html#368044890">(Jun 20 2023 at 20:17)</a>:</h4>
<p>saulecabrera updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6603">PR #6603</a>.</p>



<a name="368045376"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236603%20winch%28x64%29%3A%20Add%20support%20for%20%60loop%60%2C%20%60.../near/368045376" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236603.20winch.28x64.29.3A.20Add.20support.20for.20.60loop.60.2C.20.60.2E.2E.2E.html#368045376">(Jun 20 2023 at 20:19)</a>:</h4>
<p>saulecabrera created <a href="https://github.com/bytecodealliance/wasmtime/pull/6603#discussion_r1235785988">PR review comment</a>:</p>
<blockquote>
<p>Updated!</p>
</blockquote>



<a name="368045420"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236603%20winch%28x64%29%3A%20Add%20support%20for%20%60loop%60%2C%20%60.../near/368045420" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236603.20winch.28x64.29.3A.20Add.20support.20for.20.60loop.60.2C.20.60.2E.2E.2E.html#368045420">(Jun 20 2023 at 20:19)</a>:</h4>
<p>saulecabrera created <a href="https://github.com/bytecodealliance/wasmtime/pull/6603#discussion_r1235786143">PR review comment</a>:</p>
<blockquote>
<p>Updated!</p>
</blockquote>



<a name="368045947"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236603%20winch%28x64%29%3A%20Add%20support%20for%20%60loop%60%2C%20%60.../near/368045947" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236603.20winch.28x64.29.3A.20Add.20support.20for.20.60loop.60.2C.20.60.2E.2E.2E.html#368045947">(Jun 20 2023 at 20:22)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/6603#discussion_r1235788897">PR review comment</a>:</p>
<blockquote>
<p>Also to be clear I don't feel strongly about this at all, so whatever feels like it works best I think is fine</p>
</blockquote>



<a name="368046251"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236603%20winch%28x64%29%3A%20Add%20support%20for%20%60loop%60%2C%20%60.../near/368046251" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236603.20winch.28x64.29.3A.20Add.20support.20for.20.60loop.60.2C.20.60.2E.2E.2E.html#368046251">(Jun 20 2023 at 20:24)</a>:</h4>
<p>saulecabrera created <a href="https://github.com/bytecodealliance/wasmtime/pull/6603#discussion_r1235790279">PR review comment</a>:</p>
<blockquote>
<p>Updated to a new name according to the new approach for handling unreachable operators.</p>
</blockquote>



<a name="368046306"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236603%20winch%28x64%29%3A%20Add%20support%20for%20%60loop%60%2C%20%60.../near/368046306" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236603.20winch.28x64.29.3A.20Add.20support.20for.20.60loop.60.2C.20.60.2E.2E.2E.html#368046306">(Jun 20 2023 at 20:24)</a>:</h4>
<p><strong>saulecabrera</strong> requested <a href="https://github.com/cfallin">cfallin</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/6603">PR #6603</a>.</p>



<a name="368065051"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236603%20winch%28x64%29%3A%20Add%20support%20for%20%60loop%60%2C%20%60.../near/368065051" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236603.20winch.28x64.29.3A.20Add.20support.20for.20.60loop.60.2C.20.60.2E.2E.2E.html#368065051">(Jun 20 2023 at 22:23)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6603#pullrequestreview-1489193214">PR review</a>:</p>
<blockquote>
<p>Nice! Seems good to me but I'd defer to @cfallin still for other technical review bits</p>
</blockquote>



<a name="368065054"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236603%20winch%28x64%29%3A%20Add%20support%20for%20%60loop%60%2C%20%60.../near/368065054" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236603.20winch.28x64.29.3A.20Add.20support.20for.20.60loop.60.2C.20.60.2E.2E.2E.html#368065054">(Jun 20 2023 at 22:23)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6603#pullrequestreview-1489193214">PR review</a>:</p>
<blockquote>
<p>Nice! Seems good to me but I'd defer to @cfallin still for other technical review bits</p>
</blockquote>



<a name="368065058"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236603%20winch%28x64%29%3A%20Add%20support%20for%20%60loop%60%2C%20%60.../near/368065058" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236603.20winch.28x64.29.3A.20Add.20support.20for.20.60loop.60.2C.20.60.2E.2E.2E.html#368065058">(Jun 20 2023 at 22:23)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/6603#discussion_r1235957224">PR review comment</a>:</p>
<blockquote>
<p>If this is only ever used for <code>End</code> and <code>Else</code> and never anything else, then it may be worth splitting this into two functions?</p>
</blockquote>



<a name="368066313"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236603%20winch%28x64%29%3A%20Add%20support%20for%20%60loop%60%2C%20%60.../near/368066313" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236603.20winch.28x64.29.3A.20Add.20support.20for.20.60loop.60.2C.20.60.2E.2E.2E.html#368066313">(Jun 20 2023 at 22:32)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6603#pullrequestreview-1489199360">PR review</a>:</p>
<blockquote>
<p>Generally LGTM, thanks! A few comments below but feel free to merge when addressed.</p>
</blockquote>



<a name="368066314"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236603%20winch%28x64%29%3A%20Add%20support%20for%20%60loop%60%2C%20%60.../near/368066314" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236603.20winch.28x64.29.3A.20Add.20support.20for.20.60loop.60.2C.20.60.2E.2E.2E.html#368066314">(Jun 20 2023 at 22:32)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6603#pullrequestreview-1489199360">PR review</a>:</p>
<blockquote>
<p>Generally LGTM, thanks! A few comments below but feel free to merge when addressed.</p>
</blockquote>



<a name="368066315"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236603%20winch%28x64%29%3A%20Add%20support%20for%20%60loop%60%2C%20%60.../near/368066315" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236603.20winch.28x64.29.3A.20Add.20support.20for.20.60loop.60.2C.20.60.2E.2E.2E.html#368066315">(Jun 20 2023 at 22:32)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/6603#discussion_r1235962224">PR review comment</a>:</p>
<blockquote>
<p>s/unrechable/unreachable/</p>
</blockquote>



<a name="368066316"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236603%20winch%28x64%29%3A%20Add%20support%20for%20%60loop%60%2C%20%60.../near/368066316" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236603.20winch.28x64.29.3A.20Add.20support.20for.20.60loop.60.2C.20.60.2E.2E.2E.html#368066316">(Jun 20 2023 at 22:32)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/6603#discussion_r1235963491">PR review comment</a>:</p>
<blockquote>
<p>Agreed, let's split these cases out, like the other helpers.</p>
</blockquote>



<a name="368066317"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236603%20winch%28x64%29%3A%20Add%20support%20for%20%60loop%60%2C%20%60.../near/368066317" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236603.20winch.28x64.29.3A.20Add.20support.20for.20.60loop.60.2C.20.60.2E.2E.2E.html#368066317">(Jun 20 2023 at 22:32)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/6603#discussion_r1235962743">PR review comment</a>:</p>
<blockquote>
<p>Will this do a string-compare at runtime? I think it would be better to have a predicate on the opcode (actual enum value) that returns a bool -- call it something like <code>visit_op_when_unreachable</code> -- and use it here.</p>
</blockquote>



<a name="368081914"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236603%20winch%28x64%29%3A%20Add%20support%20for%20%60loop%60%2C%20%60.../near/368081914" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236603.20winch.28x64.29.3A.20Add.20support.20for.20.60loop.60.2C.20.60.2E.2E.2E.html#368081914">(Jun 21 2023 at 00:53)</a>:</h4>
<p>saulecabrera updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6603">PR #6603</a>.</p>



<a name="368081934"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236603%20winch%28x64%29%3A%20Add%20support%20for%20%60loop%60%2C%20%60.../near/368081934" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236603.20winch.28x64.29.3A.20Add.20support.20for.20.60loop.60.2C.20.60.2E.2E.2E.html#368081934">(Jun 21 2023 at 00:53)</a>:</h4>
<p>saulecabrera created <a href="https://github.com/bytecodealliance/wasmtime/pull/6603#discussion_r1236088032">PR review comment</a>:</p>
<blockquote>
<p>Good call, updated!</p>
</blockquote>



<a name="368083843"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236603%20winch%28x64%29%3A%20Add%20support%20for%20%60loop%60%2C%20%60.../near/368083843" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236603.20winch.28x64.29.3A.20Add.20support.20for.20.60loop.60.2C.20.60.2E.2E.2E.html#368083843">(Jun 21 2023 at 01:08)</a>:</h4>
<p>saulecabrera updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6603">PR #6603</a>.</p>



<a name="368195558"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236603%20winch%28x64%29%3A%20Add%20support%20for%20%60loop%60%2C%20%60.../near/368195558" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236603.20winch.28x64.29.3A.20Add.20support.20for.20.60loop.60.2C.20.60.2E.2E.2E.html#368195558">(Jun 21 2023 at 11:02)</a>:</h4>
<p>saulecabrera merged <a href="https://github.com/bytecodealliance/wasmtime/pull/6603">PR #6603</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>