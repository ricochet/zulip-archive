<html>
<head><meta charset="utf-8"><title>wasmtime / issue #8411 run component in docker · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238411.20run.20component.20in.20docker.html">wasmtime / issue #8411 run component in docker</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="434278887"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238411%20run%20component%20in%20docker/near/434278887" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238411.20run.20component.20in.20docker.html#434278887">(Apr 19 2024 at 04:11)</a>:</h4>
<p>erkules opened <a href="https://github.com/bytecodealliance/wasmtime/issues/8411">issue #8411</a>:</p>
<blockquote>
<p>I bulid <a href="https://github.com/sunfishcode/hello-wasi-http">https://github.com/sunfishcode/hello-wasi-http</a></p>
<p>wasmtime serve works<br>
</p>
</blockquote>
<p>$ wasmtime serve target/wasm32-wasi/debug/hello_wasi_http.wasm<br>
Serving HTTP on <a href="http://0.0.0.0:8080/">http://0.0.0.0:8080/</a></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">I</span><span class="w"> </span><span class="n">got</span><span class="w"> </span><span class="n">docker</span><span class="w"> </span><span class="n">configured</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">runtime</span><span class="p">.</span><span class="w"> </span><span class="n">works</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">non</span><span class="o">-</span><span class="n">proxy</span><span class="w"> </span><span class="n">wasm</span>:
</code></pre></div>
<p>$ docker container run --platform=wasi/wasm --runtime wasmtime  erkules/mywasm:v1<br>
12</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">But</span><span class="w"> </span><span class="n">I</span><span class="w"> </span><span class="n">didn</span><span class="o">'</span><span class="na">t</span><span class="w"> </span><span class="n">found</span><span class="w"> </span><span class="n">how</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">configure</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">image</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">tell</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">runtime</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">subcommand</span><span class="p">.</span>
</code></pre></div>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code>
</code></pre></div>



<a name="434389252"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238411%20run%20component%20in%20docker/near/434389252" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238411.20run.20component.20in.20docker.html#434389252">(Apr 19 2024 at 15:45)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/8411#issuecomment-2066840812">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/8411">issue #8411</a>:</p>
<blockquote>
<p>Sorry but can you expand the problem you're having a bit more? I think that most of us working on Wasmtime aren't familiar with <code>docker container run</code> or the arguments you're passing. It may be best to report this issue to the maintainers of the wasm/wasmtime support in Docker as they might be able to help more?</p>
</blockquote>



<a name="434540133"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238411%20run%20component%20in%20docker/near/434540133" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238411.20run.20component.20in.20docker.html#434540133">(Apr 20 2024 at 22:57)</a>:</h4>
<p>erkules <a href="https://github.com/bytecodealliance/wasmtime/issues/8411#issuecomment-2067808299">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/8411">issue #8411</a>:</p>
<blockquote>
<p>Sorry for being so bad.<br>
The basic problem is imho WIT.<br>
</p>
</blockquote>
<p>wasmtime serve target/wasm32-wasi/debug/hello_wasi_http.wasm</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">is</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">prove</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">gitexample</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">working</span><span class="p">.</span>

<span class="n">When</span><span class="w"> </span><span class="n">I</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="n">docker</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">similar</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="n">configure</span><span class="w"> </span><span class="n">containerd</span><span class="o">/</span><span class="n">runwasi</span><span class="p">.</span>

<span class="n">But</span><span class="w"> </span><span class="n">I</span><span class="w"> </span><span class="n">got</span><span class="w"> </span><span class="n">no</span><span class="w"> </span><span class="n">way</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">tell</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">shim</span><span class="w"> </span><span class="p">(</span><span class="n">or</span><span class="w"> </span><span class="n">runwasi</span><span class="p">)</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">server</span><span class="w"> </span><span class="n">subcommand</span><span class="p">.</span>

<span class="n">like</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">runwasi</span><span class="o">/</span><span class="n">containnerd</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">executing</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">entrypoint</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">container</span><span class="o">/</span><span class="n">image</span><span class="p">.</span>
<span class="n">But</span><span class="w"> </span><span class="n">I</span><span class="w"> </span><span class="n">need</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">convince</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">server</span><span class="w"> </span><span class="n">subcommand</span><span class="p">.</span>

<span class="n">Rephrased</span>: <span class="nc">How</span><span class="w"> </span><span class="n">does</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">docker</span><span class="o">/</span><span class="n">runwasi</span><span class="w"> </span><span class="n">etc</span><span class="p">.</span><span class="w"> </span><span class="n">knows</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">the</span><span class="o">/</span><span class="n">a</span><span class="w"> </span><span class="n">component</span><span class="p">.</span>
</code></pre></div>



<a name="434770424"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238411%20run%20component%20in%20docker/near/434770424" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238411.20run.20component.20in.20docker.html#434770424">(Apr 22 2024 at 14:50)</a>:</h4>
<p>hone <a href="https://github.com/bytecodealliance/wasmtime/issues/8411#issuecomment-2069744768">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/8411">issue #8411</a>:</p>
<blockquote>
<p>@erkules looking at your <code>Dockerfile</code> on <a href="https://hub.docker.com/layers/erkules/mywasm/v1/images/sha256-d197cfb42060401023014da25f8e3e5f8ad29aafd367b309858778640c11d3ab?context=explore">dockerhub</a>, you have this set as the <code>CMD</code> which will be executed:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">CMD</span><span class="w"> </span><span class="p">[</span><span class="s">"wasmedge"</span><span class="w"> </span><span class="s">"/main.wasm"</span><span class="p">]</span>
</code></pre></div>
<p>I'm not sure what you have <code>ENTRYPOINT</code> set to, but I think you want to set <code>CMD</code> to <code>wasmtime serve &lt;path to WASM module&gt;</code>.</p>
</blockquote>



<a name="434784051"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238411%20run%20component%20in%20docker/near/434784051" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238411.20run.20component.20in.20docker.html#434784051">(Apr 22 2024 at 15:42)</a>:</h4>
<p>erkules <a href="https://github.com/bytecodealliance/wasmtime/issues/8411#issuecomment-2069949769">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/8411">issue #8411</a>:</p>
<blockquote>
<p>Hi @hone, thx for checking.<br>
You looked up the image  erkules/wasm-http:imcontainer <br>
This is a ordinary working docker container </p>
</blockquote>
<div class="codehilite"><pre><span></span><code>        &quot;Cmd&quot;: [
            &quot;serve&quot;,
            &quot;/http.wasm&quot;
</code></pre></div>

<p>..<br>
            "Entrypoint": [<br>
                "/usr/bin/wasmtime"<br>
        "Architecture": "amd64",</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Using</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="p">(</span><span class="n">containerd</span><span class="o">-</span><span class="n">shim</span><span class="p">)</span><span class="w"> </span><span class="n">I</span><span class="w"> </span><span class="n">need</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="p">(</span><span class="n">wasm</span><span class="p">)</span><span class="w"> </span><span class="n">container</span><span class="p">.</span>
<span class="n">So</span><span class="w"> </span><span class="n">I</span><span class="w"> </span><span class="n">build</span><span class="w">  </span><span class="n">erkules</span><span class="o">/</span><span class="n">wasm</span><span class="o">-</span><span class="n">http</span>:<span class="nc">v1</span><span class="w"> </span><span class="p">(</span><span class="n">don</span><span class="o">'</span><span class="na">t</span><span class="w"> </span><span class="n">look</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">actual</span><span class="w"> </span><span class="n">image</span><span class="w"> </span><span class="n">up</span>:<span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>    &quot;Architecture&quot;: &quot;wasm&quot;,
</code></pre></div>

<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">This</span><span class="w"> </span><span class="n">kind</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">images</span><span class="w"> </span><span class="n">expect</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">wasm</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">ENTRYPOINT</span><span class="p">.</span>
<span class="n">i</span><span class="p">.</span><span class="n">e</span><span class="p">.</span>
<span class="p">[</span><span class="s">"serve"</span><span class="p">,</span><span class="s">"/http.wasm"</span><span class="p">]</span><span class="w"> </span><span class="n">only</span><span class="w"> </span><span class="p">[</span><span class="s">"/http.wasm"</span><span class="p">]</span><span class="w"> </span><span class="n">nothing</span><span class="w"> </span><span class="n">worked</span><span class="p">.</span>
<span class="n">Having</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">core</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">ENTRYPOINT</span><span class="w"> </span><span class="n">pointing</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="n">everything</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">working</span><span class="p">.</span>

<span class="n">So</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">there</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">way</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">tell</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">shim</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">special</span><span class="w"> </span><span class="n">subcommand</span><span class="p">.</span>
<span class="n">How</span><span class="w"> </span><span class="n">does</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">shim</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">e</span><span class="p">.</span><span class="w"> </span><span class="n">knows</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">hast</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">spin</span><span class="w"> </span><span class="n">up</span><span class="o">?</span>
</code></pre></div>



<a name="434821345"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238411%20run%20component%20in%20docker/near/434821345" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238411.20run.20component.20in.20docker.html#434821345">(Apr 22 2024 at 18:41)</a>:</h4>
<p>matsbror <a href="https://github.com/bytecodealliance/wasmtime/issues/8411#issuecomment-2070604444">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/8411">issue #8411</a>:</p>
<blockquote>
<p>@erkules did you resolve this? I am looking to do exactly this right now as well.</p>
</blockquote>



<a name="434821457"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238411%20run%20component%20in%20docker/near/434821457" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238411.20run.20component.20in.20docker.html#434821457">(Apr 22 2024 at 18:42)</a>:</h4>
<p>matsbror edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/8411#issuecomment-2070604444">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/8411">issue #8411</a>:</p>
<blockquote>
<p>@erkules did you resolve this? I am looking to do exactly this right now as well. But I think like @alexcrichton this is not a wasmtime issue, it's a docker issue.</p>
</blockquote>



<a name="434866921"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238411%20run%20component%20in%20docker/near/434866921" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238411.20run.20component.20in.20docker.html#434866921">(Apr 22 2024 at 23:20)</a>:</h4>
<p>erkules <a href="https://github.com/bytecodealliance/wasmtime/issues/8411#issuecomment-2071110047">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/8411">issue #8411</a>:</p>
<blockquote>
<p>@matsbror haven't solved it. <br>
I don't think it is an docker issue. At least Ive got problems with ctr and containerd also. <br>
</p>
</blockquote>
<p>ctr run --rm --runtime=io.containerd.wasmtime.v1 <a href="http://docker.io/erkules/wasm-http:v1">docker.io/erkules/wasm-http:v1</a> a </p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">containerd</span><span class="o">-</span><span class="n">logs</span>:
</code></pre></div>
<p>Apr 22 23:19:47 perl3 containerd[3423363]: time="2024-04-22T23:19:47.957073021Z" level=info msg="server listen started"<br>
Apr 22 23:19:47 perl3 containerd[3423363]: time="2024-04-22T23:19:47.957281712Z" level=info msg="server started"<br>
Apr 22 23:19:47 perl3 containerd[3423363]: time="2024-04-22T23:19:47.957314698Z" level=info msg="Shim successfully started, waiting for exit signal..."<br>
Apr 22 23:19:47 perl3 containerd[3423363]: time="2024-04-22T23:19:47.977023213Z" level=info msg="found manifest with WASM OCI image format"<br>
Apr 22 23:19:47 perl3 containerd[3423363]: time="2024-04-22T23:19:47.977646223Z" level=info msg="no WASM layers found in OCI image"<br>
Apr 22 23:19:47 perl3 containerd[3423363]: time="2024-04-22T23:19:47.978939323Z" level=info msg="close_range; preserve_fds=0"<br>
Apr 22 23:19:47 perl3 containerd[3423363]: time="2024-04-22T23:19:47.979583692Z" level=info msg="cgroup manager V2 will be used"<br>
Apr 22 23:19:47 perl3 containerd[3423363]: time="2024-04-22T23:19:47.980169131Z" level=warn msg="Controller rdma is not yet implemented."<br>
Apr 22 23:19:47 perl3 containerd[3423363]: time="2024-04-22T23:19:47.980636981Z" level=warn msg="Controller misc is not yet implemented."<br>
Apr 22 23:19:47 perl3 containerd[3423363]: time="2024-04-22T23:19:47.982457118Z" level=warn msg="Controller rdma is not yet implemented."<br>
Apr 22 23:19:47 perl3 containerd[3423363]: time="2024-04-22T23:19:47.982478878Z" level=warn msg="Controller misc is not yet implemented."<br>
Apr 22 23:19:47 perl3 containerd[3423363]: time="2024-04-22T23:19:47.99490045Z" level=info msg="close_range; preserve_fds=0"<br>
Apr 22 23:19:47 perl3 containerd[3423363]: time="2024-04-22T23:19:47.995551693Z" level=warn msg="intermediate process already reaped"<br>
Apr 22 23:19:48 perl3 containerd[3423363]: time="2024-04-22T23:19:48.001191379Z" level=info msg="starting instance: a"<br>
Apr 22 23:19:48 perl3 containerd[3423363]: time="2024-04-22T23:19:48.002387964Z" level=info msg="calling start function"<br>
Apr 22 23:19:48 perl3 containerd[3423363]: time="2024-04-22T23:19:48.002425554Z" level=info msg="setting up wasi"<br>
Apr 22 23:19:48 perl3 containerd[3423363]: time="2024-04-22T23:19:48.002488088Z" level=info msg="building wasi context"<br>
Apr 22 23:19:48 perl3 containerd[3423363]: time="2024-04-22T23:19:48.314272152Z" level=info msg="instantiating component"<br>
Apr 22 23:19:48 perl3 containerd[3423363]: time="2024-04-22T23:19:48.315334175Z" level=info msg="error running start function: import <code>wasi:http/types@0.2.0</code> has the wrong type"<br>
Apr 22 23:19:48 perl3 containerd[3423363]: time="2024-04-22T23:19:48.3210106Z" level=info msg="deleting instance: a"<br>
Apr 22 23:19:48 perl3 containerd[3423363]: time="2024-04-22T23:19:48.32122991Z" level=info msg="cgroup manager V2 will be used"<br>
Apr 22 23:19:48 perl3 containerd[3423363]: time="2024-04-22T23:19:48.322184447Z" level=info msg="Shutting down shim instance"<br>
Apr 22 23:19:48 perl3 containerd[3423363]: time="2024-04-22T23:19:48.322215203Z" level=info msg="close monitor"<br>
Apr 22 23:19:48 perl3 containerd[3423363]: time="2024-04-22T23:19:48.322241327Z" level=error msg="listener accept got Custom { kind: Other, error: "listener shutdown for quit flag" }"<br>
Apr 22 23:19:48 perl3 containerd[3423363]: time="2024-04-22T23:19:48.32229698Z" level=info msg="ttrpc server listener stopped"<br>
Apr 22 23:19:48 perl3 containerd[3423363]: time="2024-04-22T23:19:48.322362134Z" level=info msg="listener thread stopped"<br>
Apr 22 23:19:48 perl3 containerd[3423363]: time="2024-04-22T23:19:48.322389062Z" level=info msg="begin to shutdown connection"<br>
Apr 22 23:19:48 perl3 containerd[3423363]: time="2024-04-22T23:19:48.322412009Z" level=info msg="connections closed"<br>
Apr 22 23:19:48 perl3 containerd[3423363]: time="2024-04-22T23:19:48.323181034Z" level=info msg="reaper thread exited"<br>
Apr 22 23:19:48 perl3 containerd[3423363]: time="2024-04-22T23:19:48.323274325Z" level=info msg="reaper thread stopped"<br>
Apr 22 23:19:48 perl3 containerd[3423363]: time="2024-04-22T23:19:48.323239141Z" level=info msg="shim disconnected" id=a<br>
Apr 22 23:19:48 perl3 containerd[3423363]: time="2024-04-22T23:19:48.324789933Z" level=warning msg="cleaning up after shim disconnected" id=a namespace=default<br>
Apr 22 23:19:48 perl3 containerd[3423363]: time="2024-04-22T23:19:48.324921527Z" level=info msg="cleaning up dead shim"</p>



<a name="435950459"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238411%20run%20component%20in%20docker/near/435950459" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238411.20run.20component.20in.20docker.html#435950459">(Apr 29 2024 at 04:21)</a>:</h4>
<p>matsbror <a href="https://github.com/bytecodealliance/wasmtime/issues/8411#issuecomment-2081865462">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/8411">issue #8411</a>:</p>
<blockquote>
<p>I did some research on this and the issue lies in <code>runwasi</code> which is used by <code>containerd</code> to implement the wasm shims. It does not yet support http-wasi. There is a github issue about it: <a href="https://github.com/containerd/runwasi/issues/416">https://github.com/containerd/runwasi/issues/416</a></p>
</blockquote>



<a name="435950508"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238411%20run%20component%20in%20docker/near/435950508" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238411.20run.20component.20in.20docker.html#435950508">(Apr 29 2024 at 04:21)</a>:</h4>
<p>matsbror edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/8411#issuecomment-2081865462">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/8411">issue #8411</a>:</p>
<blockquote>
<p>I did some research on this and the problem lies in <code>runwasi</code> which is used by <code>containerd</code> to implement the wasm shims. It does not yet support http-wasi. There is a github issue about it: <a href="https://github.com/containerd/runwasi/issues/416">https://github.com/containerd/runwasi/issues/416</a></p>
</blockquote>



<a name="436378134"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238411%20run%20component%20in%20docker/near/436378134" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238411.20run.20component.20in.20docker.html#436378134">(May 01 2024 at 01:14)</a>:</h4>
<p>Mossaka <a href="https://github.com/bytecodealliance/wasmtime/issues/8411#issuecomment-2087803154">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/8411">issue #8411</a>:</p>
<blockquote>
<p>Hey runwasi maintainer here. Yes I agree that this is an <a href="https://github.com/containerd/runwasi/issues/416">runwasi issue</a>, probably not related to wasmtime. As @matsbror mentioned, there is no support for <code>wasi:http</code> at the moment. The only supported world is <code>wasi:cli/run</code>. </p>
<blockquote>
<p>I got no way to tell the shim (or runwasi) to use the server subcommand.</p>
</blockquote>
<p>You assessment is right. The wasmtime shim in Docker is using the wasmtime SDK directly, and thus there is no subcommand for serving HTTP requests. </p>
<blockquote>
<p>How does the wasmtime shim i.e. knows it is a component it hast to spin up?</p>
</blockquote>
<p>The shim will parse the first few bytes of the binary and determine whether it's a wasm module, a wasm component, or something else. If it's a wasm component, it assumes the component implmenets the <code>wasi:cli</code> world. And this is why you are seeing the error <code>"import </code>wasi:http/types@0.2.0<code> has the wrong type"</code> in the containerd log. </p>
<hr>
<p>In the meantime, if you just want to run <code>hello_wasi_http.wasm</code> component in Docker / Kubernetes, you may want to try the <a href="https://github.com/spinkube/containerd-shim-spin">spinkube/containerd-spin-shim</a> which uses the Spin runtime and it does support serving <code>wasi:http</code> requests. </p>
</blockquote>



<a name="437195299"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238411%20run%20component%20in%20docker/near/437195299" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238411.20run.20component.20in.20docker.html#437195299">(May 06 2024 at 05:03)</a>:</h4>
<p>erkules <a href="https://github.com/bytecodealliance/wasmtime/issues/8411#issuecomment-2095203038">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/8411">issue #8411</a>:</p>
<blockquote>
<p>thx @Mossaka  and @matsbror </p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>