<html>
<head><meta charset="utf-8"><title>wasmtime / issue #5510 Use floats for `wasmtime::componen... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235510.20Use.20floats.20for.20.60wasmtime.3A.3Acomponen.2E.2E.2E.html">wasmtime / issue #5510 Use floats for `wasmtime::componen...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="319264521"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235510%20Use%20floats%20for%20%60wasmtime%3A%3Acomponen.../near/319264521" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235510.20Use.20floats.20for.20.60wasmtime.3A.3Acomponen.2E.2E.2E.html#319264521">(Jan 03 2023 at 19:23)</a>:</h4>
<p>lann <a href="https://github.com/bytecodealliance/wasmtime/pull/5510#issuecomment-1370140897">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5510">issue #5510</a>:</p>
<blockquote>
<p>I failed to mention: this removes the <code>#[derive(Eq)]</code> from <code>Val</code> and some related structs because <code>f{32,64}</code> aren't <code>Eq</code>. I think this makes sense in this context but its technically a breaking change.</p>
</blockquote>



<a name="319264900"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235510%20Use%20floats%20for%20%60wasmtime%3A%3Acomponen.../near/319264900" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235510.20Use.20floats.20for.20.60wasmtime.3A.3Acomponen.2E.2E.2E.html#319264900">(Jan 03 2023 at 19:25)</a>:</h4>
<p>lann edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/5510#issuecomment-1370140897">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5510">issue #5510</a>:</p>
<blockquote>
<p>I failed to mention: this removes the <code>#[derive(Eq)]</code> from <code>Val</code> and some related structs because <code>f{32,64}</code> aren't <code>Eq</code>. I think this makes sense in this context but it's technically a breaking change.</p>
</blockquote>



<a name="319264917"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235510%20Use%20floats%20for%20%60wasmtime%3A%3Acomponen.../near/319264917" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235510.20Use.20floats.20for.20.60wasmtime.3A.3Acomponen.2E.2E.2E.html#319264917">(Jan 03 2023 at 19:25)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/5510#issuecomment-1370143273">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5510">issue #5510</a>:</p>
<blockquote>
<p>Yeah that's ok and I think it makes sense as well due to the usage of floats it shouldn't be applicable for <code>Val</code> anyway.</p>
</blockquote>



<a name="319269568"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235510%20Use%20floats%20for%20%60wasmtime%3A%3Acomponen.../near/319269568" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235510.20Use.20floats.20for.20.60wasmtime.3A.3Acomponen.2E.2E.2E.html#319269568">(Jan 03 2023 at 19:56)</a>:</h4>
<p>github-actions[bot] <a href="https://github.com/bytecodealliance/wasmtime/pull/5510#issuecomment-1370168206">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5510">issue #5510</a>:</p>
<blockquote>
<h4>Subscribe to Label Action</h4>
<p>cc @fitzgen, @peterhuene</p>
<p>&lt;details&gt;<br>
This issue or pull request has been labeled: "fuzzing", "wasmtime:api"</p>
<p>Thus the following users have been cc'd because of the following labels:</p>
<ul>
<li>fitzgen: fuzzing</li>
<li>peterhuene: wasmtime:api</li>
</ul>
<p>To subscribe or unsubscribe from this label, edit the &lt;code&gt;.github/subscribe-to-label.json&lt;/code&gt; configuration file.</p>
<p><a href="https://github.com/bytecodealliance/subscribe-to-label-action">Learn more.</a><br>
&lt;/details&gt;</p>
</blockquote>



<a name="319668845"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235510%20Use%20floats%20for%20%60wasmtime%3A%3Acomponen.../near/319668845" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235510.20Use.20floats.20for.20.60wasmtime.3A.3Acomponen.2E.2E.2E.html#319668845">(Jan 05 2023 at 20:40)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/5510#issuecomment-1372719177">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5510">issue #5510</a>:</p>
<blockquote>
<p>It looks like this <a href="https://github.com/bytecodealliance/wasmtime/blob/36e5bdfd0ec207bbfb1da79725ac37c7cbc331d0/crates/fuzzing/src/oracles.rs#L829">broke fuzzing here</a> because nan is no longer equal to nan. @lann would you be up for helping to fix this? I think the way to fix it would be to write a custom equality function which considers two NaN values to be equal.</p>
</blockquote>



<a name="319674327"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235510%20Use%20floats%20for%20%60wasmtime%3A%3Acomponen.../near/319674327" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235510.20Use.20floats.20for.20.60wasmtime.3A.3Acomponen.2E.2E.2E.html#319674327">(Jan 05 2023 at 21:18)</a>:</h4>
<p>lann <a href="https://github.com/bytecodealliance/wasmtime/pull/5510#issuecomment-1372784586">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5510">issue #5510</a>:</p>
<blockquote>
<p>Would it make sense to change the test code? e.g. </p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">match</span><span class="w"> </span><span class="p">(</span><span class="n">expected</span><span class="p">,</span><span class="w"> </span><span class="n">actual</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// NaNs never compare equal</span>
<span class="w">    </span><span class="p">(</span><span class="n">Val</span>::<span class="n">Float32</span><span class="p">(</span><span class="n">expected</span><span class="p">),</span><span class="w"> </span><span class="n">Val</span>::<span class="n">Float32</span><span class="p">(</span><span class="n">actual</span><span class="p">))</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">expected</span><span class="p">.</span><span class="n">is_nan</span><span class="p">()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="fm">assert!</span><span class="p">(</span><span class="n">actual</span><span class="p">.</span><span class="n">is_nan</span><span class="p">()),</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="n">Val</span>::<span class="n">Float64</span><span class="p">(</span><span class="n">expected</span><span class="p">),</span><span class="w"> </span><span class="n">Val</span>::<span class="n">Float64</span><span class="p">(</span><span class="n">actual</span><span class="p">))</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">expected</span><span class="p">.</span><span class="n">is_nan</span><span class="p">()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="fm">assert!</span><span class="p">(</span><span class="n">actual</span><span class="p">.</span><span class="n">is_nan</span><span class="p">()),</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="n">expected</span><span class="p">,</span><span class="w"> </span><span class="n">actual</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">expected</span><span class="p">,</span><span class="w"> </span><span class="n">actual</span><span class="p">),</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>
</code></pre></div>
</blockquote>



<a name="319674887"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235510%20Use%20floats%20for%20%60wasmtime%3A%3Acomponen.../near/319674887" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235510.20Use.20floats.20for.20.60wasmtime.3A.3Acomponen.2E.2E.2E.html#319674887">(Jan 05 2023 at 21:22)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/5510#issuecomment-1372793525">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5510">issue #5510</a>:</p>
<blockquote>
<p>More-or-less that's what needs to happen, but floats can appear recursively as well so the equality change there would need to be applied deeply through types like lists and recors too</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>