<html>
<head><meta charset="utf-8"><title>announcing `wasm-smith`, a WebAssembly test case generator · wasm · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/index.html">wasm</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/announcing.20.60wasm-smith.60.2C.20a.20WebAssembly.20test.20case.20generator.html">announcing `wasm-smith`, a WebAssembly test case generator</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="207692746"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/announcing%20%60wasm-smith%60%2C%20a%20WebAssembly%20test%20case%20generator/near/207692746" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> fitzgen (he/him) <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/announcing.20.60wasm-smith.60.2C.20a.20WebAssembly.20test.20case.20generator.html#207692746">(Aug 21 2020 at 22:44)</a>:</h4>
<p><a href="https://github.com/fitzgen/wasm-smith">https://github.com/fitzgen/wasm-smith</a></p>
<p>The README has the sales pitch. I've already used this to find a bunch of bugs in <code>wasmparser</code>. Isn't published on <a href="http://crates.io">crates.io</a> yet, because I need to upstream some changes to the <code>arbitrary</code> crate first.</p>
<p>cc <span class="user-mention" data-user-id="253991">@Yury Delendik</span> <span class="user-mention" data-user-id="253994">@Alex Crichton</span> <span class="user-mention" data-user-id="254051">@Jonathan Foote</span></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/fitzgen/wasm-smith" style="background-image: url(https://avatars2.githubusercontent.com/u/74571?s=400&amp;v=4)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/fitzgen/wasm-smith" title="fitzgen/wasm-smith">fitzgen/wasm-smith</a></div><div class="message_embed_description">A WebAssembly test case generator. Contribute to fitzgen/wasm-smith development by creating an account on GitHub.</div></div></div>



<a name="207697950"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/announcing%20%60wasm-smith%60%2C%20a%20WebAssembly%20test%20case%20generator/near/207697950" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/announcing.20.60wasm-smith.60.2C.20a.20WebAssembly.20test.20case.20generator.html#207697950">(Aug 22 2020 at 00:06)</a>:</h4>
<p>Nice! Definitely looking forward to seeing this hooked up to wasmtime</p>



<a name="207698570"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/announcing%20%60wasm-smith%60%2C%20a%20WebAssembly%20test%20case%20generator/near/207698570" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/announcing.20.60wasm-smith.60.2C.20a.20WebAssembly.20test.20case.20generator.html#207698570">(Aug 22 2020 at 00:20)</a>:</h4>
<p><span class="user-mention" data-user-id="253990">@fitzgen (he/him)</span> this might be good to include in the wasm tools repo?</p>



<a name="207700844"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/announcing%20%60wasm-smith%60%2C%20a%20WebAssembly%20test%20case%20generator/near/207700844" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> fitzgen (he/him) <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/announcing.20.60wasm-smith.60.2C.20a.20WebAssembly.20test.20case.20generator.html#207700844">(Aug 22 2020 at 01:25)</a>:</h4>
<p>Perhaps!</p>



<a name="207741234"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/announcing%20%60wasm-smith%60%2C%20a%20WebAssembly%20test%20case%20generator/near/207741234" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> fitzgen (he/him) <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/announcing.20.60wasm-smith.60.2C.20a.20WebAssembly.20test.20case.20generator.html#207741234">(Aug 22 2020 at 20:39)</a>:</h4>
<p>Now up on <a href="http://crates.io">crates.io</a>: <a href="https://crates.io/crates/wasm-smith">https://crates.io/crates/wasm-smith</a></p>



<a name="207859022"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/announcing%20%60wasm-smith%60%2C%20a%20WebAssembly%20test%20case%20generator/near/207859022" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> fitzgen (he/him) <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/announcing.20.60wasm-smith.60.2C.20a.20WebAssembly.20test.20case.20generator.html#207859022">(Aug 24 2020 at 15:38)</a>:</h4>
<p>blog post describing its implementation, if anyone is interested: <a href="https://fitzgeraldnick.com/2020/08/24/writing-a-test-case-generator.html">https://fitzgeraldnick.com/2020/08/24/writing-a-test-case-generator.html</a></p>



<a name="208054346"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/announcing%20%60wasm-smith%60%2C%20a%20WebAssembly%20test%20case%20generator/near/208054346" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/announcing.20.60wasm-smith.60.2C.20a.20WebAssembly.20test.20case.20generator.html#208054346">(Aug 26 2020 at 05:34)</a>:</h4>
<p>and let the fuzz bugs begin...</p>



<a name="208126673"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/announcing%20%60wasm-smith%60%2C%20a%20WebAssembly%20test%20case%20generator/near/208126673" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/announcing.20.60wasm-smith.60.2C.20a.20WebAssembly.20test.20case.20generator.html#208126673">(Aug 26 2020 at 18:06)</a>:</h4>
<p><span class="user-mention" data-user-id="253990">@fitzgen (he/him)</span> btw the auto-reduction oss-fuzz does is <em>really</em> good with wasm-smith</p>



<a name="208126688"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/announcing%20%60wasm-smith%60%2C%20a%20WebAssembly%20test%20case%20generator/near/208126688" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/announcing.20.60wasm-smith.60.2C.20a.20WebAssembly.20test.20case.20generator.html#208126688">(Aug 26 2020 at 18:07)</a>:</h4>
<p>it reduced a 30kb input to 4kb which generated a module with just one type in it</p>



<a name="208126726"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/announcing%20%60wasm-smith%60%2C%20a%20WebAssembly%20test%20case%20generator/near/208126726" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/announcing.20.60wasm-smith.60.2C.20a.20WebAssembly.20test.20case.20generator.html#208126726">(Aug 26 2020 at 18:07)</a>:</h4>
<p>so the pattern you're using for generating a wasm module I think is really amenable to auto-reduction</p>



<a name="208126739"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/announcing%20%60wasm-smith%60%2C%20a%20WebAssembly%20test%20case%20generator/near/208126739" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/announcing.20.60wasm-smith.60.2C.20a.20WebAssembly.20test.20case.20generator.html#208126739">(Aug 26 2020 at 18:07)</a>:</h4>
<p>although you probably knew this already heh</p>



<a name="208127370"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/announcing%20%60wasm-smith%60%2C%20a%20WebAssembly%20test%20case%20generator/near/208127370" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> fitzgen (he/him) <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/announcing.20.60wasm-smith.60.2C.20a.20WebAssembly.20test.20case.20generator.html#208127370">(Aug 26 2020 at 18:12)</a>:</h4>
<p>yeah, I think it is a combo of two things:</p>
<ol>
<li>
<p><code>wasm-opt -ttf</code> was cycling back over the raw input and doing funky stuff like xoring it with a counter, rather than simply padding the end of the input with zeroes. this meant that in order to reproduce a bug that involves something generated after it has cycled back around the input, you <em>have</em> to have the whole prefix. there is a lot of unintentional stuff entrained in the test case.</p>
</li>
<li>
<p>I switched a few things in the arbitrary crate to be more fuzzing friendly. we are more lax about errors (eg a string that isn't perfectly utf-8 or when we need more input than the fuzzer provided us) and I also made it so that collections are built up via a "continuation byte" rather than by reading a length and then reading that many elements. This latter one was inspired by a paper about test case reduction from the python hypothesis testing framework. See <a href="https://github.com/rust-fuzz/arbitrary/issues/52">https://github.com/rust-fuzz/arbitrary/issues/52</a> for details</p>
</li>
</ol>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/rust-fuzz/arbitrary/issues/52" style="background-image: url(https://avatars1.githubusercontent.com/u/25854843?s=400&amp;v=4)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/rust-fuzz/arbitrary/issues/52" title="Generate collections via a &quot;continuation byte&quot; rather than reading a length · Issue #52 · rust-fuzz/arbitrary">Generate collections via a "continuation byte" rather than reading a length · Issue #52 · rust-fuzz/arbitrary</a></div><div class="message_embed_description">Rather than doing let mut collection = Collection::new(); let n = u.arbitrary_len()?; for _ in 0..n { collection.insert(u.arbitrary()?); } to create a collection, we should consider doing let mut c...</div></div></div>



<a name="208127541"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/announcing%20%60wasm-smith%60%2C%20a%20WebAssembly%20test%20case%20generator/near/208127541" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/announcing.20.60wasm-smith.60.2C.20a.20WebAssembly.20test.20case.20generator.html#208127541">(Aug 26 2020 at 18:14)</a>:</h4>
<p>yeah I saw that about the <code>keep_going</code> bool which I thought was pretty clever</p>



<a name="208127579"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/announcing%20%60wasm-smith%60%2C%20a%20WebAssembly%20test%20case%20generator/near/208127579" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/announcing.20.60wasm-smith.60.2C.20a.20WebAssembly.20test.20case.20generator.html#208127579">(Aug 26 2020 at 18:14)</a>:</h4>
<p>I do think though that one part about wasm-smith is that it's difficult to have a stable corpus, because as we tweak wasm-smith a previous input could be reinterpreted totally differently (e.g. with the patch I just sent)</p>



<a name="208127588"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/announcing%20%60wasm-smith%60%2C%20a%20WebAssembly%20test%20case%20generator/near/208127588" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/announcing.20.60wasm-smith.60.2C.20a.20WebAssembly.20test.20case.20generator.html#208127588">(Aug 26 2020 at 18:14)</a>:</h4>
<p>not really a huge issue, but also not sure how we'd fix it</p>



<a name="208127790"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/announcing%20%60wasm-smith%60%2C%20a%20WebAssembly%20test%20case%20generator/near/208127790" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> fitzgen (he/him) <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/announcing.20.60wasm-smith.60.2C.20a.20WebAssembly.20test.20case.20generator.html#208127790">(Aug 26 2020 at 18:16)</a>:</h4>
<p>agreed. I don't think it is a huge deal and I'm also not sure how to fix it where the fix wouldn't be worse than just rediscovering some coverage</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>