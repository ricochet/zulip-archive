<html>
<head><meta charset="utf-8"><title>list of trapping instructions? · wasm · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/index.html">wasm</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/list.20of.20trapping.20instructions.3F.html">list of trapping instructions?</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="274725926"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/list%20of%20trapping%20instructions%3F/near/274725926" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> fitzgen (he/him) <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/list.20of.20trapping.20instructions.3F.html#274725926">(Mar 09 2022 at 17:50)</a>:</h4>
<p>specifically, looking for which numeric instructions can trap. the spec makes figuring this out way harder than I feel it should be <span aria-label="pensive" class="emoji emoji-1f614" role="img" title="pensive">:pensive:</span> </p>
<p>I know some of the float&lt;--&gt;int conversions can trap, but can't find the set of them all listed in one place</p>



<a name="274727346"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/list%20of%20trapping%20instructions%3F/near/274727346" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> fitzgen (he/him) <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/list.20of.20trapping.20instructions.3F.html#274727346">(Mar 09 2022 at 17:59)</a>:</h4>
<p>I guess all the truncating conversions?</p>



<a name="274727385"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/list%20of%20trapping%20instructions%3F/near/274727385" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/list.20of.20trapping.20instructions.3F.html#274727385">(Mar 09 2022 at 17:59)</a>:</h4>
<p>IIRC yeah it's like <code>i32.trunc_f32</code> or those</p>



<a name="274727466"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/list%20of%20trapping%20instructions%3F/near/274727466" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/list.20of.20trapping.20instructions.3F.html#274727466">(Mar 09 2022 at 17:59)</a>:</h4>
<p>The <code>trunc_sat_*</code> things explicitly don't trap though</p>



<a name="274727798"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/list%20of%20trapping%20instructions%3F/near/274727798" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> fitzgen (he/him) <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/list.20of.20trapping.20instructions.3F.html#274727798">(Mar 09 2022 at 18:01)</a>:</h4>
<p>right</p>



<a name="274728117"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/list%20of%20trapping%20instructions%3F/near/274728117" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> fitzgen (he/him) <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/list.20of.20trapping.20instructions.3F.html#274728117">(Mar 09 2022 at 18:03)</a>:</h4>
<p>do you know if there are anything in the simd instructions that trap other than loads and stores?</p>



<a name="274728203"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/list%20of%20trapping%20instructions%3F/near/274728203" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/list.20of.20trapping.20instructions.3F.html#274728203">(Mar 09 2022 at 18:03)</a>:</h4>
<p>I don't believe so, let me double-check</p>



<a name="274728357"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/list%20of%20trapping%20instructions%3F/near/274728357" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/list.20of.20trapping.20instructions.3F.html#274728357">(Mar 09 2022 at 18:04)</a>:</h4>
<p>ok no I don't think so but fuzzing will probably confirm that one way or another</p>



<a name="274728400"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/list%20of%20trapping%20instructions%3F/near/274728400" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> fitzgen (he/him) <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/list.20of.20trapping.20instructions.3F.html#274728400">(Mar 09 2022 at 18:04)</a>:</h4>
<p>ah there are a bunch more truncating conversions there</p>



<a name="274728961"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/list%20of%20trapping%20instructions%3F/near/274728961" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> fitzgen (he/him) <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/list.20of.20trapping.20instructions.3F.html#274728961">(Mar 09 2022 at 18:08)</a>:</h4>
<p>but they all seem to use the saturating logic, okay</p>



<a name="277345800"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/list%20of%20trapping%20instructions%3F/near/277345800" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Conrad Watt <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/list.20of.20trapping.20instructions.3F.html#277345800">(Mar 31 2022 at 22:01)</a>:</h4>
<p>of the SIMD instructions, (only) the binops seem to be <a href="https://webassembly.github.io/spec/core/exec/instructions.html#xref-syntax-instructions-syntax-shape-mathit-shape-mathsf-xref-syntax-instructions-syntax-vbinop-mathit-vbinop">spec'd to allow the possiblity of trapping</a></p>
<p>which suggests that at least one of them traps, although it's hard to work out which one(s) from the spec</p>
<p>(or the spec might just be written defensively because there's a feeling that binops might be particularly likely to trap in future?)</p>



<a name="277346332"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/list%20of%20trapping%20instructions%3F/near/277346332" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/list.20of.20trapping.20instructions.3F.html#277346332">(Mar 31 2022 at 22:06)</a>:</h4>
<p>I don't recall any of the SIMD lowerings having a trap but I could be wrong... <span class="user-mention" data-user-id="254110">@Andrew Brown</span> might be able to say for sure?</p>



<a name="277349247"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/list%20of%20trapping%20instructions%3F/near/277349247" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Brown <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/list.20of.20trapping.20instructions.3F.html#277349247">(Mar 31 2022 at 22:38)</a>:</h4>
<p>I was going to say the conversion instructions but they aren't binop (and don't really trap either); looking again at the spec I think you may be right that that is a defensive move</p>



<a name="277349497"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/list%20of%20trapping%20instructions%3F/near/277349497" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/list.20of.20trapping.20instructions.3F.html#277349497">(Mar 31 2022 at 22:40)</a>:</h4>
<p>The SIMD load/store instructions can trap.</p>



<a name="277349552"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/list%20of%20trapping%20instructions%3F/near/277349552" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/list.20of.20trapping.20instructions.3F.html#277349552">(Mar 31 2022 at 22:41)</a>:</h4>
<p>But otherwise yes, there was a concerted effort to minimize trapping in the SIMD proposal.</p>



<a name="277349834"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/list%20of%20trapping%20instructions%3F/near/277349834" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/list.20of.20trapping.20instructions.3F.html#277349834">(Mar 31 2022 at 22:44)</a>:</h4>
<p>There was a moment I like to call "the great divide coincidence": it would be really awkward if we had to make divide non-trapping, because what else should it do, but then it turns out that a lot of SIMD units don't have integer divide anyway, so we could just leave it out of the spec altogether.</p>



<a name="277350034"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/list%20of%20trapping%20instructions%3F/near/277350034" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/list.20of.20trapping.20instructions.3F.html#277350034">(Mar 31 2022 at 22:46)</a>:</h4>
<p>huh, that is indeed convenient</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>