<html>
<head><meta charset="utf-8"><title>modules types binary format · wasm · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/index.html">wasm</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html">modules types binary format</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="197957086"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/197957086" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#197957086">(May 18 2020 at 16:08)</a>:</h4>
<p><span class="user-mention" data-user-id="253998">@Luke Wagner</span> hey some questions about the module-types explainer</p>



<a name="197957120"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/197957120" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#197957120">(May 18 2020 at 16:09)</a>:</h4>
<p>I think we'll probably want a separate index space for each kind of type, right?</p>



<a name="197957149"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/197957149" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#197957149">(May 18 2020 at 16:09)</a>:</h4>
<p>like right now we only have the "type index space", but that's more realistically the "function type index space"</p>



<a name="197957170"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/197957170" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#197957170">(May 18 2020 at 16:09)</a>:</h4>
<p>and module types are adding 2 more index spaces, the module types and instance types index space</p>



<a name="197957183"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/197957183" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#197957183">(May 18 2020 at 16:09)</a>:</h4>
<p>does that sound right?</p>



<a name="197957971"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/197957971" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#197957971">(May 18 2020 at 16:14)</a>:</h4>
<p>Yup, index space per type.  In MVP wasm we have have 5 index spaces (type, function, table, memory, global), and Module Linking would add 2 more (module and instance)</p>



<a name="197958040"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/197958040" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#197958040">(May 18 2020 at 16:15)</a>:</h4>
<p>technically it's 4 more?</p>



<a name="197958041"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/197958041" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#197958041">(May 18 2020 at 16:15)</a>:</h4>
<p>the "type" index space will grow to contain not just function typedefs, but also module typedefs, instance typedefs, and later GC typedefs</p>



<a name="197958044"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/197958044" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#197958044">(May 18 2020 at 16:15)</a>:</h4>
<p>er</p>



<a name="197958068"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/197958068" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#197958068">(May 18 2020 at 16:15)</a>:</h4>
<p>yeah so I may be confused about this type index space</p>



<a name="197958157"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/197958157" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#197958157">(May 18 2020 at 16:16)</a>:</h4>
<p>if I define one function, one module, and one instance type, all three indices are zero?</p>



<a name="197958173"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/197958173" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#197958173">(May 18 2020 at 16:16)</a>:</h4>
<p>or indices are 0, 1, 2?</p>



<a name="197958193"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/197958193" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#197958193">(May 18 2020 at 16:16)</a>:</h4>
<p>the indices for the type that is</p>



<a name="197958229"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/197958229" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#197958229">(May 18 2020 at 16:16)</a>:</h4>
<p>(I thought this was adding 4 index spaces, {module, instance} x {type, def})</p>



<a name="197958280"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/197958280" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#197958280">(May 18 2020 at 16:16)</a>:</h4>
<p>and I thought the existing "type" index space was going to be basically renamed to "function type" index space</p>



<a name="197958296"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/197958296" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#197958296">(May 18 2020 at 16:17)</a>:</h4>
<p>in that situation you have 4 index spaces at play: a type index space with 3 types (0,1,2), and then single-element module index space (which <em>defines</em> the module, but also refers to the module's type in the type index space), and similarly a single-element instance and function index space</p>



<a name="197958360"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/197958360" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#197958360">(May 18 2020 at 16:17)</a>:</h4>
<p>hm so the I can declare a module with a function type (erroneously)</p>



<a name="197958370"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/197958370" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#197958370">(May 18 2020 at 16:17)</a>:</h4>
<p>and that'd have to be caught in validation?</p>



<a name="197958389"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/197958389" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#197958389">(May 18 2020 at 16:17)</a>:</h4>
<p>where the type of a module is indeed a module type?</p>



<a name="197958395"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/197958395" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#197958395">(May 18 2020 at 16:17)</a>:</h4>
<p>correct</p>



<a name="197958417"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/197958417" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#197958417">(May 18 2020 at 16:17)</a>:</h4>
<p>why not have separate index spaces though?</p>



<a name="197958466"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/197958466" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#197958466">(May 18 2020 at 16:18)</a>:</h4>
<p>like one index space per type</p>



<a name="197958475"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/197958475" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#197958475">(May 18 2020 at 16:18)</a>:</h4>
<p>fwiw, this "type" vs. "declaration of a function's type" distinction is already started in the MVP: <a href="https://webassembly.github.io/spec/core/syntax/modules.html#indices">https://webassembly.github.io/spec/core/syntax/modules.html#indices</a></p>



<a name="197958529"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/197958529" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#197958529">(May 18 2020 at 16:18)</a>:</h4>
<p>well, the type section is all incestuously circular</p>



<a name="197958584"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/197958584" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#197958584">(May 18 2020 at 16:19)</a>:</h4>
<p>(in the limit, once we have first-class references to all the things)</p>



<a name="197958586"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/197958586" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#197958586">(May 18 2020 at 16:19)</a>:</h4>
<p>but that's still allowed with multiple index spaces?</p>



<a name="197958609"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/197958609" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#197958609">(May 18 2020 at 16:19)</a>:</h4>
<p>so you have this one index space of "type definitions" where all the types can refer to each other</p>



<a name="197958617"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/197958617" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#197958617">(May 18 2020 at 16:19)</a>:</h4>
<p>oh you're thinking like "here's the N types of this module", and you verify all sub-indices are less than N ?</p>



<a name="197958631"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/197958631" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#197958631">(May 18 2020 at 16:19)</a>:</h4>
<p>and then all the other definitions can point into it</p>



<a name="197958693"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/197958693" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#197958693">(May 18 2020 at 16:19)</a>:</h4>
<p>I was imagining we'd still have just one type section, but it'd add to each respective index space depending on what's defined</p>



<a name="197958706"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/197958706" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#197958706">(May 18 2020 at 16:19)</a>:</h4>
<p>sort of like the import section</p>



<a name="197958767"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/197958767" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#197958767">(May 18 2020 at 16:20)</a>:</h4>
<p>but because types refer to each other we can't validate until everything is parsed</p>



<a name="197958777"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/197958777" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#197958777">(May 18 2020 at 16:20)</a>:</h4>
<p>and we'd rather validate in a streaming fashion?</p>



<a name="197958819"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/197958819" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#197958819">(May 18 2020 at 16:20)</a>:</h4>
<p>well, "everything is parsed" as in "the type section is fully parsed"</p>



<a name="197958871"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/197958871" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#197958871">(May 18 2020 at 16:20)</a>:</h4>
<p>yeah, in general, the type section will have to be validated all-at-once</p>



<a name="197958903"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/197958903" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#197958903">(May 18 2020 at 16:20)</a>:</h4>
<p>b/c, eventually at least, it'll be circular</p>



<a name="197958950"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/197958950" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#197958950">(May 18 2020 at 16:21)</a>:</h4>
<p>hm wait then I still don't understand why we wouldn't have a separate index space for each class of types</p>



<a name="197958987"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/197958987" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#197958987">(May 18 2020 at 16:21)</a>:</h4>
<p>if we assume you parse the whole type section, then you validate the whole thing</p>



<a name="197959312"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/197959312" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#197959312">(May 18 2020 at 16:23)</a>:</h4>
<p>incidentally, i'm polishing up a change to the "Binary Format Considerations" section of the Module Linking PR which explains that we actually need to loosen up the section rules a bit so that you can split up and interleave the Type, Import, Module, Function and Alias Sections.  The reason being that there is no longer a simple ordering of sections that prevents forward references.  So rather, you can just have "some types" then "some modules" then ....  and the index spaces grow monotonically, and validation is just relative to the current index space contents</p>



<a name="197959478"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/197959478" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#197959478">(May 18 2020 at 16:24)</a>:</h4>
<p>(answering why not a separate index space per class of type:) i think that could be an isomorphic alternative; you'd basically have to put the "what class of type is this" next to the index.  with the current design (already in the MVP), the "what class of type is this" enum is part of the typedef itself</p>



<a name="197959591"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/197959591" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#197959591">(May 18 2020 at 16:25)</a>:</h4>
<p>Isn't the index space of the index specified always implicit though?</p>



<a name="197959610"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/197959610" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#197959610">(May 18 2020 at 16:25)</a>:</h4>
<p>e.g. <code>call_indirect</code> always looks up in the function type index space, not the module type index space</p>



<a name="197959638"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/197959638" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#197959638">(May 18 2020 at 16:25)</a>:</h4>
<p>and module declarations would be relative to the module type index space</p>



<a name="197959642"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/197959642" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#197959642">(May 18 2020 at 16:25)</a>:</h4>
<p>right, but if you have a (ref $typeindex)...</p>



<a name="197959653"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/197959653" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#197959653">(May 18 2020 at 16:25)</a>:</h4>
<p>that's an index in <em>the</em> type section</p>



<a name="197959688"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/197959688" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#197959688">(May 18 2020 at 16:26)</a>:</h4>
<p>wouldn't that be relative to the "w/e the reference types index space" is?</p>



<a name="197959706"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/197959706" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#197959706">(May 18 2020 at 16:26)</a>:</h4>
<p>could be to a function or module or instance ...</p>



<a name="197959765"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/197959765" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#197959765">(May 18 2020 at 16:26)</a>:</h4>
<p>hm ok, I basically know no context about gc</p>



<a name="197959858"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/197959858" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#197959858">(May 18 2020 at 16:27)</a>:</h4>
<p>so $typeindex is (eventually) one of {function, struct, array, module, instance, ...}, which isn't a reference to the thing, but the thing itself</p>



<a name="197959881"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/197959881" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#197959881">(May 18 2020 at 16:27)</a>:</h4>
<p>and (ref $typeindex) is building a <em>new</em> type, which is a reference to the thing</p>



<a name="197959960"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/197959960" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#197959960">(May 18 2020 at 16:27)</a>:</h4>
<p>not sure I fully understand but "wave hands gc changes things" is good enough for me for now</p>



<a name="197960030"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/197960030" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#197960030">(May 18 2020 at 16:28)</a>:</h4>
<p>a different example, in interface types-land is when you have (record (field "x" $sometype))</p>



<a name="197960061"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/197960061" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#197960061">(May 18 2020 at 16:28)</a>:</h4>
<p>$sometype could be one of several different "classes" of type</p>



<a name="197960100"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/197960100" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#197960100">(May 18 2020 at 16:28)</a>:</h4>
<p>(in this case there's no reference, it's just a record value embedding some other value as a field)</p>



<a name="197960294"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/197960294" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#197960294">(May 18 2020 at 16:29)</a>:</h4>
<p>it's ok, I'll just take this as a given for now :)</p>



<a name="197960378"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/197960378" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#197960378">(May 18 2020 at 16:30)</a>:</h4>
<p>FWIW, if you look at the binary encoding of function types (<a href="https://webassembly.github.io/spec/core/binary/types.html#function-types">https://webassembly.github.io/spec/core/binary/types.html#function-types</a>), the first byte, 0x60, is the "what class of typedef is this" byte</p>



<a name="197960417"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/197960417" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#197960417">(May 18 2020 at 16:30)</a>:</h4>
<p>it's just explicitly called out b/c there is currently only one class of typedef</p>



<a name="197960507"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/197960507" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#197960507">(May 18 2020 at 16:30)</a>:</h4>
<p>right yeah, so more types fits well</p>



<a name="197960513"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/197960513" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#197960513">(May 18 2020 at 16:30)</a>:</h4>
<p>but it is carefully chosen to be distinct from every other type code: <a href="https://searchfox.org/mozilla-central/source/js/src/wasm/WasmConstants.h#63">https://searchfox.org/mozilla-central/source/js/src/wasm/WasmConstants.h#63</a></p>



<a name="197960546"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/197960546" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#197960546">(May 18 2020 at 16:31)</a>:</h4>
<p>I just don't fully understand how gc changes things to require one index space as opposed to multiple type index spaces</p>



<a name="197960570"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/197960570" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#197960570">(May 18 2020 at 16:31)</a>:</h4>
<p>well even now we only have 1 type index space</p>



<a name="197960589"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/197960589" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#197960589">(May 18 2020 at 16:31)</a>:</h4>
<p>I know yeah, but I don't know why we wouldn't want more with this proposal</p>



<a name="197960590"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/197960590" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#197960590">(May 18 2020 at 16:31)</a>:</h4>
<p>the "function" index space isn't a space of types, it's a space of function definitions</p>



<a name="197960648"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/197960648" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#197960648">(May 18 2020 at 16:32)</a>:</h4>
<p>right yeah, but with module types I don't know why we don't rename the type index space to "function type" index space</p>



<a name="197960717"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/197960717" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#197960717">(May 18 2020 at 16:32)</a>:</h4>
<p>you're mentioning because of gc <code>(ref $ty)</code> things, but I don't fully get that, but that's also ok I don't really need to at this point</p>



<a name="197960732"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/197960732" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#197960732">(May 18 2020 at 16:32)</a>:</h4>
<p>i guess b/c we've already planned to have a single index space, discriminating with the 0x60 prefix code</p>



<a name="197960743"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/197960743" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#197960743">(May 18 2020 at 16:32)</a>:</h4>
<p>it just means extra validation rules for type references</p>



<a name="197960757"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/197960757" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#197960757">(May 18 2020 at 16:32)</a>:</h4>
<p>which technically avoids needing to put that discriminator on every use</p>



<a name="197960800"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/197960800" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#197960800">(May 18 2020 at 16:32)</a>:</h4>
<p>in some cases, yes, but in other cases, i think you need the discriminant in one place or the other</p>



<a name="197960831"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/197960831" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#197960831">(May 18 2020 at 16:33)</a>:</h4>
<p>e.g., function definitions can only refer to function types, so yeah, there it's extra checking</p>



<a name="197960898"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/197960898" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#197960898">(May 18 2020 at 16:33)</a>:</h4>
<p>but other cases can reference any type</p>



<a name="197960981"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/197960981" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#197960981">(May 18 2020 at 16:34)</a>:</h4>
<p>it's mostly poTAYto poTAHto though :)</p>



<a name="197961004"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/197961004" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#197961004">(May 18 2020 at 16:34)</a>:</h4>
<p>we've just have established a precedent in one direction</p>



<a name="197961031"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/197961031" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#197961031">(May 18 2020 at 16:34)</a>:</h4>
<p><em>shrug</em></p>



<a name="197961317"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/197961317" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#197961317">(May 18 2020 at 16:36)</a>:</h4>
<p><span class="user-mention" data-user-id="253998">@Luke Wagner</span> can you also explain a bit more this <code>alias</code> thing?</p>



<a name="197961363"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/197961363" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#197961363">(May 18 2020 at 16:36)</a>:</h4>
<p>I don't really understand much about it other than "it can refer to parent stuff"</p>



<a name="197964573"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/197964573" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#197964573">(May 18 2020 at 17:00)</a>:</h4>
<p>(sorry meetings)  yeah, <code>alias</code> lets you inject a definition in either (1) your parent, (2) the export of an imported or nested instance</p>



<a name="197964608"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/197964608" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#197964608">(May 18 2020 at 17:00)</a>:</h4>
<p>I'll post an update to the PR later today</p>



<a name="197964871"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/197964871" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#197964871">(May 18 2020 at 17:02)</a>:</h4>
<p>mk I'll wait for that</p>



<a name="198005684"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198005684" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198005684">(May 18 2020 at 22:57)</a>:</h4>
<p><span class="user-mention" data-user-id="253994">@Alex Crichton</span> <a href="https://github.com/WebAssembly/module-types/pull/3/commits/73950e7f977fc601107b4bdc5058389772cd8d45">https://github.com/WebAssembly/module-types/pull/3/commits/73950e7f977fc601107b4bdc5058389772cd8d45</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/WebAssembly/module-types/pull/3/commits/73950e7f977fc601107b4bdc5058389772cd8d45" style="background-image: url(https://avatars1.githubusercontent.com/u/9660325?s=400&amp;v=4)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/WebAssembly/module-types/pull/3/commits/73950e7f977fc601107b4bdc5058389772cd8d45" title="Generalize Module Types to Module Linking by lukewagner · Pull Request #3 · WebAssembly/module-types">Generalize Module Types to Module Linking by lukewagner · Pull Request #3 · WebAssembly/module-types</a></div><div class="message_embed_description">As is, the Module Types proposal tweaks the spec-internal definition of module/instance types and gives them a text format so that module/instance types can be used in toolchains, but there are no ...</div></div></div>



<a name="198008372"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198008372" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198008372">(May 18 2020 at 23:41)</a>:</h4>
<p><span class="user-mention" data-user-id="253998">@Luke Wagner</span> can you give an example of what you're thinking with an <code>alias</code> referring to something in the enclosing module?</p>



<a name="198008573"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198008573" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198008573">(May 18 2020 at 23:44)</a>:</h4>
<p>It also feels a bit odd to have so many alias/instance sections, do you think it'd be possible to fold alias definitions into the instance section? The same idea just a different binary structure where the instance section would be a bit more "meaty". Each element in the instance section would either instantiate a module or create an alias for a previous instance.</p>



<a name="198008593"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198008593" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198008593">(May 18 2020 at 23:44)</a>:</h4>
<p>eh maybe not, you have to alias imports as well... anyway</p>



<a name="198008702"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198008702" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198008702">(May 18 2020 at 23:46)</a>:</h4>
<p>So the intention is that <code>(alias $name (func $instance $fname))</code> -- <code>$name</code> is the name of the function we're creating (optional), <code>$instance</code> is an instance index, and <code>$fname</code>, is that encoded as <code>"fname"</code> the string or an index where it's the nth exported function (or nth export?) of <code>$instance</code>?</p>



<a name="198010283"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198010283" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198010283">(May 19 2020 at 00:15)</a>:</h4>
<p>For the first question: the reason for aliases referring to the outer module is just to remove redundancy; in package linking scenarios, the same module/instance types get repeated a ton.</p>



<a name="198010640"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198010640" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198010640">(May 19 2020 at 00:21)</a>:</h4>
<p>For the second: yeah, that was the alternative I liked for a while.  The thing that's a bit odd about it is that an alias in the instance section doesn't add a new kind of instance, so it's not really the "instance" section but the "instance and alias of instance exports" section.  Aliases are a bit like Imports, so it seems vaguely symmetric to give them their own section.  But it's not like that's the only way to do it.</p>



<a name="198010653"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198010653" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198010653">(May 19 2020 at 00:21)</a>:</h4>
<p>For the third: yes, that's right.  $fname is an index into the exports array of $instance's type definition (which is local tot he module)</p>



<a name="198016799"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198016799" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198016799">(May 19 2020 at 02:30)</a>:</h4>
<p><span class="user-mention" data-user-id="253998">@Luke Wagner</span> oh referring to the parent makes sense, I was wondering if you had thoughts on the binary format? If aliases can only refer to exports you can't define exports before instantiating right? I'm just murky on how the specifics of semantics and binary encoding would work</p>



<a name="198018739"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198018739" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198018739">(May 19 2020 at 03:26)</a>:</h4>
<p><span class="user-mention" data-user-id="253994">@Alex Crichton</span>   Aliases can refer to any type/module defs in the parents' index spaces, not just exports.  It's only aliases to nested instances that can only refer to exports</p>



<a name="198090841"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198090841" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198090841">(May 19 2020 at 16:22)</a>:</h4>
<p><span class="user-mention" data-user-id="253998">@Luke Wagner</span> ok so here's what I've got so far, mind skimming it over and see if I misinterpreted or am missing anything? -- <a href="https://gist.github.com/alexcrichton/506ac6d2f7d505d556d68fb969489183">https://gist.github.com/alexcrichton/506ac6d2f7d505d556d68fb969489183</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://gist.github.com/alexcrichton/506ac6d2f7d505d556d68fb969489183" style="background-image: url(https://github.githubassets.com/images/modules/gists/gist-og-image.png)"></a><div class="data-container"><div class="message_embed_title"><a href="https://gist.github.com/alexcrichton/506ac6d2f7d505d556d68fb969489183" title="new-binary-2.md">new-binary-2.md</a></div><div class="message_embed_description">GitHub Gist: instantly share code, notes, and snippets.</div></div></div>



<a name="198092293"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198092293" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198092293">(May 19 2020 at 16:32)</a>:</h4>
<p>Looking at importdesc, one could reconsider the existing 0x00 case from always being a func to instead being "whatever the indexed type is", so that as soon as you add module/instance types, the 0x00 can refer to them just as well as func.  E.g., that's what (ref $typeIndex) will do</p>



<a name="198092423"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198092423" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198092423">(May 19 2020 at 16:33)</a>:</h4>
<p>But actually, that's super-bikeshed-y, so n/m</p>



<a name="198093141"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198093141" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198093141">(May 19 2020 at 16:38)</a>:</h4>
<p>Different, but perhaps-more-justifiable bikeshed: in the Alias section, for the <code>parent</code> aliases, could the second byte of module be 0x04 (to match import and export)?</p>



<a name="198093341"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198093341" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198093341">(May 19 2020 at 16:40)</a>:</h4>
<p>oh sure</p>



<a name="198093352"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198093352" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198093352">(May 19 2020 at 16:40)</a>:</h4>
<p>although you may be able to help me clarify that</p>



<a name="198093363"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198093363" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198093363">(May 19 2020 at 16:40)</a>:</h4>
<p>when you refer toy your parent's index</p>



<a name="198093390"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198093390" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198093390">(May 19 2020 at 16:40)</a>:</h4>
<p>that's indexing within your parent's module index space, right? not your parent's export index space?</p>



<a name="198093446"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198093446" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198093446">(May 19 2020 at 16:41)</a>:</h4>
<p>correctamundo</p>



<a name="198093476"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198093476" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198093476">(May 19 2020 at 16:41)</a>:</h4>
<p>ok yeah I can change the alignment</p>



<a name="198093499"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198093499" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198093499">(May 19 2020 at 16:41)</a>:</h4>
<p>also great idea with using <code>(parent $x)</code> as the text format, i'm going to update the Explainer to match</p>



<a name="198093650"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198093650" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198093650">(May 19 2020 at 16:42)</a>:</h4>
<p>I do want to document the text form at as well, but I'll probably do that in tandem with writing the text parser</p>



<a name="198093679"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198093679" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198093679">(May 19 2020 at 16:42)</a>:</h4>
<p>One other tweak: in components, I think there aren't any Table, Memory or Global sections allowed, so perhaps you can explicitly say these are disallowed</p>



<a name="198093751"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198093751" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198093751">(May 19 2020 at 16:43)</a>:</h4>
<p>table/global makes sense, but for memory, do you mean no defined memory, but you can still import memory, right?</p>



<a name="198093783"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198093783" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198093783">(May 19 2020 at 16:43)</a>:</h4>
<p>(e.g. <code>string.lift</code> needs an index space to operate on)</p>



<a name="198093913"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198093913" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198093913">(May 19 2020 at 16:44)</a>:</h4>
<p>yes, you can still <em>alias</em> all of the memories/tables/globals of nested instances</p>



<a name="198093950"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198093950" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198093950">(May 19 2020 at 16:44)</a>:</h4>
<p>ah ok, so you still have an index space, just no local definitions</p>



<a name="198093962"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198093962" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198093962">(May 19 2020 at 16:44)</a>:</h4>
<p>makes sense</p>



<a name="198094098"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198094098" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198094098">(May 19 2020 at 16:45)</a>:</h4>
<p>one last change: i think, unlike the core section rules, we can allow the Function section to be intermingled with the Instance/Module/Type sections</p>



<a name="198094174"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198094174" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198094174">(May 19 2020 at 16:46)</a>:</h4>
<p>so that adapter functions can be imported by nested instances</p>



<a name="198094227"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198094227" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198094227">(May 19 2020 at 16:46)</a>:</h4>
<p>only for components, though?</p>



<a name="198094248"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198094248" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198094248">(May 19 2020 at 16:46)</a>:</h4>
<p>correct</p>



<a name="198094281"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198094281" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198094281">(May 19 2020 at 16:46)</a>:</h4>
<p>i thought about it a lot for core modules and i think it needs the stricter separation</p>



<a name="198094326"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198094326" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198094326">(May 19 2020 at 16:47)</a>:</h4>
<p>part of what makes it make sense for adapter functions is that component instances are (mostly, get to that in a sec) stateless</p>



<a name="198094341"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198094341" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198094341">(May 19 2020 at 16:47)</a>:</h4>
<p>so we can say that the component instance is created <em>before</em> its nested instances</p>



<a name="198094381"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198094381" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198094381">(May 19 2020 at 16:47)</a>:</h4>
<p>the one bit of state a component instance has is: which of my nested instances have been created</p>



<a name="198094394"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198094394" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198094394">(May 19 2020 at 16:47)</a>:</h4>
<p>but we'd still have the trap-if-you-call-too-early semantics?</p>



<a name="198094414"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198094414" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198094414">(May 19 2020 at 16:47)</a>:</h4>
<p>so what we can say is that it is a dynamic error to call an export of an instance that hasn't been created</p>



<a name="198094463"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198094463" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198094463">(May 19 2020 at 16:48)</a>:</h4>
<p>and so if a component has nested instances A B and C</p>



<a name="198094466"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198094466" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198094466">(May 19 2020 at 16:48)</a>:</h4>
<p>heh yeah that works too</p>



<a name="198094507"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198094507" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198094507">(May 19 2020 at 16:48)</a>:</h4>
<p>then A can call adapter functions which call component imports,</p>



<a name="198094587"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198094587" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198094587">(May 19 2020 at 16:49)</a>:</h4>
<p>but if it tries to call into B or C, that'll trap</p>



<a name="198094633"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198094633" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198094633">(May 19 2020 at 16:49)</a>:</h4>
<p>there is that subtle detail of are A's exports visible if A's start function calls the adapter function</p>



<a name="198094704"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198094704" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198094704">(May 19 2020 at 16:50)</a>:</h4>
<p>"meh"</p>



<a name="198094751"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198094751" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198094751">(May 19 2020 at 16:50)</a>:</h4>
<p>i think for now we can say "yes", and then later talk about the "after start" function thing later</p>



<a name="198094800"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198094800" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198094800">(May 19 2020 at 16:50)</a>:</h4>
<p>b/c import adapters definitely need to be able to reenter the core module caller, to call malloc()</p>



<a name="198094814"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198094814" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198094814">(May 19 2020 at 16:51)</a>:</h4>
<p>ok updated the gist with this</p>



<a name="198094884"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198094884" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198094884">(May 19 2020 at 16:51)</a>:</h4>
<p><a href="https://gist.github.com/alexcrichton/506ac6d2f7d505d556d68fb969489183/revisions#diff-592762304f59428e5070ae1c46ce9859">https://gist.github.com/alexcrichton/506ac6d2f7d505d556d68fb969489183/revisions#diff-592762304f59428e5070ae1c46ce9859</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://gist.github.com/alexcrichton/506ac6d2f7d505d556d68fb969489183/revisions#diff-592762304f59428e5070ae1c46ce9859" style="background-image: url(https://github.githubassets.com/images/modules/open_graph/github-octocat.png)"></a><div class="data-container"><div class="message_embed_title"><a href="https://gist.github.com/alexcrichton/506ac6d2f7d505d556d68fb969489183/revisions#diff-592762304f59428e5070ae1c46ce9859" title="Build software better, together">Build software better, together</a></div><div class="message_embed_description">GitHub is where people build software. More than 50 million people use GitHub to discover, fork, and contribute to over 100 million projects.</div></div></div>



<a name="198094957"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198094957" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198094957">(May 19 2020 at 16:52)</a>:</h4>
<p>ah, i see you're writing to cover <em>both</em> the module and component cases</p>



<a name="198095030"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198095030" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198095030">(May 19 2020 at 16:52)</a>:</h4>
<p>in that case, you might want to add a caveat to the version word noting that the 0x1 is only for components</p>



<a name="198095065"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198095065" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198095065">(May 19 2020 at 16:52)</a>:</h4>
<p>oh sorry yeah this is sort of like a diff of what we expect to land in wasmparser</p>



<a name="198095071"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198095071" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198095071">(May 19 2020 at 16:52)</a>:</h4>
<p>which would parse both</p>



<a name="198095144"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198095144" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198095144">(May 19 2020 at 16:53)</a>:</h4>
<p>anyhow, just wanted to say great job on this!</p>



<a name="198096634"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198096634" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198096634">(May 19 2020 at 17:02)</a>:</h4>
<p>do you mind if i resolve your open conversations in the Module Linking PR?  or happy for you to comment on them</p>



<a name="198096882"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198096882" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198096882">(May 19 2020 at 17:04)</a>:</h4>
<p>oh sorry of course</p>



<a name="198096902"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198096902" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198096902">(May 19 2020 at 17:04)</a>:</h4>
<p>were you waiting on me to do that?</p>



<a name="198096912"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198096912" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198096912">(May 19 2020 at 17:04)</a>:</h4>
<p>or is it expected that I do that?</p>



<a name="198096940"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198096940" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198096940">(May 19 2020 at 17:04)</a>:</h4>
<p>they were resolved like the second you replied weeks ago lol</p>



<a name="198102984"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198102984" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198102984">(May 19 2020 at 17:50)</a>:</h4>
<p>haha, no worries, i was making progress on other discussions in the PR, so no waiting.  i was just tidying up since it's looking like we're almost done.  i'm still going to present at the next CG meeting before merging, i think</p>



<a name="198102992"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198102992" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198102992">(May 19 2020 at 17:50)</a>:</h4>
<p>well, i dunno</p>



<a name="198105322"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198105322" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198105322">(May 19 2020 at 18:07)</a>:</h4>
<p>btw, i was working through an example with transitive dependencies to see how the link step would work.  my main interest was finding a scheme whereby the generated Linked Module simply imports unmodified Packaged Modules and avoiding the module type of a given Packaged Module needing to capture all of its transitive dependencies in its module type.  i ended up finding a wrapping scheme that uses nested modules and parent aliases to essentially "curry" module imports:  <a href="https://gist.github.com/lukewagner/d662cbe7b58281672053dab4118d25b7">https://gist.github.com/lukewagner/d662cbe7b58281672053dab4118d25b7</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://gist.github.com/lukewagner/d662cbe7b58281672053dab4118d25b7" style="background-image: url(https://github.githubassets.com/images/modules/gists/gist-og-image.png)"></a><div class="data-container"><div class="message_embed_title"><a href="https://gist.github.com/lukewagner/d662cbe7b58281672053dab4118d25b7" title="linked-modules.wat">linked-modules.wat</a></div><div class="message_embed_description">GitHub Gist: instantly share code, notes, and snippets.</div></div></div>



<a name="198105479"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198105479" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198105479">(May 19 2020 at 18:08)</a>:</h4>
<p>might be an interesting test case ;)</p>



<a name="198269004"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198269004" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198269004">(May 20 2020 at 23:13)</a>:</h4>
<p><span class="user-mention" data-user-id="253998">@Luke Wagner</span> here's something to think about:</p>
<div class="codehilite"><pre><span></span><code>(type $t (instance (export &quot;x&quot; (instance (type $t)))))
</code></pre></div>



<a name="198269017"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198269017" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198269017">(May 20 2020 at 23:13)</a>:</h4>
<p>I think that needs to be an error of some kind</p>



<a name="198269087"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198269087" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198269087">(May 20 2020 at 23:14)</a>:</h4>
<p>or something like for the text format we have to figure out a DAG of how to visit type definitions</p>



<a name="198269233"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198269233" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198269233">(May 20 2020 at 23:17)</a>:</h4>
<p>I'm assuming we're doing the same thing for instances as we do for functions, which is when you declare the type you can specify both the <code>(type xx)</code> reference as well as the type inline (e.g. <code>(func (type 0) (param i32))</code>)</p>



<a name="198269242"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198269242" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198269242">(May 20 2020 at 23:17)</a>:</h4>
<p>but when both are specified, we need to validate they're equal</p>



<a name="198269251"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198269251" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198269251">(May 20 2020 at 23:17)</a>:</h4>
<p>(e.g. <code>type 0</code> is indeed <code>(func (param i32))</code>)</p>



<a name="198269344"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198269344" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198269344">(May 20 2020 at 23:18)</a>:</h4>
<p>so like I think this is technically valid:</p>
<div class="codehilite"><pre><span></span><code>(type $t (instance
  (export &quot;x&quot; (instance (type $t)
    (export &quot;x&quot; (instance (type $t)
      (export &quot;x&quot; (instance (type $t)
        (export &quot;x&quot; (instance (type $t)
          (export &quot;x&quot; (instance (type $t)
            (export &quot;x&quot; (instance (type $t)
            (export &quot;x&quot; (instance (type $t)))
            ))
          ))
        ))
      ))
    ))
  ))
))
</code></pre></div>



<a name="198269381"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198269381" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198269381">(May 20 2020 at 23:19)</a>:</h4>
<p>but validating that at the text level isn't really easy to do because as we're determining the canonical value for <code>$t</code> we need to know what <code>$t</code> is to compare it to <code>$t</code></p>



<a name="198269397"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198269397" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198269397">(May 20 2020 at 23:19)</a>:</h4>
<p>we can perhaps solve this by saying "don't do the function thing, you say the index or you say the inline, not both"</p>



<a name="198269487"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198269487" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198269487">(May 20 2020 at 23:20)</a>:</h4>
<p>well so let me rephrase, this seems like it could either be a binary error or a text error</p>



<a name="198269517"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198269517" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198269517">(May 20 2020 at 23:21)</a>:</h4>
<p>I feel like we want it to be a text error</p>



<a name="198269526"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198269526" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198269526">(May 20 2020 at 23:21)</a>:</h4>
<p>I'm getting tripped up in how circularly recursive this is</p>



<a name="198272081"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198272081" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198272081">(May 20 2020 at 23:59)</a>:</h4>
<p>Haha, yes, I think no recursive types for now.  Perhaps just by requiring all type indices refer to earlier typedefs</p>



<a name="198272364"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198272364" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198272364">(May 21 2020 at 00:02)</a>:</h4>
<p>Also, agreed that if you write (instance (type $T)) you shouldn't need to be able to re-state all the exports/imports</p>



<a name="198272393"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198272393" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198272393">(May 21 2020 at 00:03)</a>:</h4>
<p>That's really just a goofy special case for functions so they can assign identifiers to parameters</p>



<a name="198272454"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198272454" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198272454">(May 21 2020 at 00:04)</a>:</h4>
<p>Actually, for directly-embedded type definitions like you're showing, I think no circularity forever; the only exception is circularity via (ref $T)</p>



<a name="198273839"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198273839" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198273839">(May 21 2020 at 00:24)</a>:</h4>
<p><span class="user-mention" data-user-id="253998">@Luke Wagner</span> ok sounds good, I'll need to write some sort of sorting pass in the text parser then too to do a topological sort</p>



<a name="198273911"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198273911" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198273911">(May 21 2020 at 00:25)</a>:</h4>
<p>ah, bummer, yes.  for starters you could require text to be in order too ;)</p>



<a name="198275331"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198275331" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198275331">(May 21 2020 at 00:49)</a>:</h4>
<p>thinking more on it, you're right, I think the text format should impose the restriction itself</p>



<a name="198385555"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198385555" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198385555">(May 21 2020 at 22:30)</a>:</h4>
<p><span class="user-mention" data-user-id="253998">@Luke Wagner</span> here's another interesting thing to think about, so right now you can specify imports/exports inline in the text format, e.g. these are all the same</p>
<div class="codehilite"><pre><span></span><code>(func $f)
(export &quot;&quot; (func $f))
(func $f (export &quot;&quot;))

(import &quot;&quot; &quot;&quot; (func $f))
(func $f (import &quot;&quot; &quot;&quot;))
</code></pre></div>



<a name="198385575"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198385575" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198385575">(May 21 2020 at 22:30)</a>:</h4>
<p>for nested modules, however, the proposed syntax you've got so far doesn't support this</p>



<a name="198385610"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198385610" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198385610">(May 21 2020 at 22:30)</a>:</h4>
<p>b/c <code>(module ...)</code> the imports/exports would be ambiguous</p>



<a name="198385624"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198385624" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198385624">(May 21 2020 at 22:30)</a>:</h4>
<p>or I guess it'd be ambiguous without more lookahead</p>



<a name="198385660"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198385660" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198385660">(May 21 2020 at 22:30)</a>:</h4>
<p>I'm wondering if it makes sense to do something like:</p>



<a name="198385662"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198385662" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198385662">(May 21 2020 at 22:31)</a>:</h4>
<div class="codehilite"><pre><span></span><code>
</code></pre></div>



<a name="198385704"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198385704" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198385704">(May 21 2020 at 22:31)</a>:</h4>
<div class="codehilite"><pre><span></span><code>(nested-module (type $ty) (module ...))
</code></pre></div>



<a name="198385714"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198385714" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198385714">(May 21 2020 at 22:31)</a>:</h4>
<p>where you can specify inline imports/exports if you want</p>



<a name="198385734"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198385734" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198385734">(May 21 2020 at 22:31)</a>:</h4>
<p>and <code>(module ...)</code> bare is sugar for auto-calculating the type, inserting it into the type index space, and not having any implicit imports/exports</p>



<a name="198385826"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198385826" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198385826">(May 21 2020 at 22:32)</a>:</h4>
<p>I was also wondering how you'd do something like <code>(module (type $module_type) ...)</code> b/c that's also ambiguous</p>



<a name="198385858"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198385858" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198385858">(May 21 2020 at 22:32)</a>:</h4>
<p>but at least for printing the binary format we'll need a way to say "the module type was specified at this index, don't inject anything else"</p>



<a name="198386374"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198386374" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198386374">(May 21 2020 at 22:37)</a>:</h4>
<p><span class="user-mention" data-user-id="253994">@Alex Crichton</span> sorry, which part was ambiguous?</p>



<a name="198386486"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198386486" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198386486">(May 21 2020 at 22:38)</a>:</h4>
<p>i would think (module ...) would be mostly symmetric to (func ...) in the ways you mentioned (import, export, explicit type index)</p>



<a name="198386550"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198386550" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198386550">(May 21 2020 at 22:39)</a>:</h4>
<p>i see your point that it'd be necessary to scan the whole body of (module ...) to determine the module type, unlike (func ...) which tells you that basically up-front</p>



<a name="198386705"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198386705" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198386705">(May 21 2020 at 22:40)</a>:</h4>
<p>but i think there's still symmetry with func in that, to validate the body of a (func ...), you have to have parsed all the types of all the other functions first (so that you know all the funcs' types)</p>



<a name="198387375"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198387375" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198387375">(May 21 2020 at 22:47)</a>:</h4>
<p>hm ok so I've got two concerns here</p>



<a name="198387395"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198387395" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198387395">(May 21 2020 at 22:47)</a>:</h4>
<p>one is how to parse this:</p>
<div class="codehilite"><pre><span></span><code>(module
  (module (export &quot;x&quot;))
)
</code></pre></div>



<a name="198387420"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198387420" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198387420">(May 21 2020 at 22:47)</a>:</h4>
<p>another is how to parse this:</p>
<div class="codehilite"><pre><span></span><code>(module
  (type (module))
  (module (type 0))
)
</code></pre></div>



<a name="198387428"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198387428" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198387428">(May 21 2020 at 22:47)</a>:</h4>
<p>which are sort of the same concern</p>



<a name="198387498"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198387498" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198387498">(May 21 2020 at 22:48)</a>:</h4>
<p>basically everything in parsing only requires 1 lookahead right now, but those would otherwise require multiple tokens of lookahead</p>



<a name="198387519"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198387519" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198387519">(May 21 2020 at 22:48)</a>:</h4>
<p>it's not necessarily ambiguous but it is pretty weird</p>



<a name="198464696"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198464696" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198464696">(May 22 2020 at 16:44)</a>:</h4>
<p>Ohhhhh, I finally get your meaning; you're saying: when I see the tokens <code>(</code> <code>module</code> <code>(</code> <code>export</code>, I don't know if I'm parsing an export of the module definition, or declaring that this module definition is exported.  I was thinking of it as an already-parsed AST which is after this question has been sorted :)</p>



<a name="198465153"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198465153" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198465153">(May 22 2020 at 16:47)</a>:</h4>
<p><span class="user-mention" data-user-id="253998">@Luke Wagner</span> oh sorry, but yes</p>



<a name="198465247"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198465247" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198465247">(May 22 2020 at 16:48)</a>:</h4>
<p>So I suppose in both cases, the (export "x") and (type 0) require a constant amount of lookahead to see what they are</p>



<a name="198465263"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198465263" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198465263">(May 22 2020 at 16:48)</a>:</h4>
<p>that's why I was thinking of <code>(nested-module ...)</code> because that would put you in a parsing context where you clearly know what's what</p>



<a name="198465268"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198465268" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198465268">(May 22 2020 at 16:48)</a>:</h4>
<p>that's true yeah</p>



<a name="198465280"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198465280" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198465280">(May 22 2020 at 16:48)</a>:</h4>
<p>the constant is just bigger than 1 heh</p>



<a name="198465314"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198465314" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198465314">(May 22 2020 at 16:49)</a>:</h4>
<p>are you using an LR(1) parser generator?</p>



<a name="198465329"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198465329" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198465329">(May 22 2020 at 16:49)</a>:</h4>
<p>nah it's all hand-coded so it's easy enough to do</p>



<a name="198465345"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198465345" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198465345">(May 22 2020 at 16:49)</a>:</h4>
<p>but it also just looks funky</p>



<a name="198465355"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198465355" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198465355">(May 22 2020 at 16:49)</a>:</h4>
<p>from a readability point of view</p>



<a name="198465364"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198465364" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198465364">(May 22 2020 at 16:49)</a>:</h4>
<p>not that inline exports/imports are used all that often</p>



<a name="198465404"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198465404" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198465404">(May 22 2020 at 16:49)</a>:</h4>
<p>well it's a good question, i'll file an issue on the repo after we merge the linking PR (i'm thinking mid next week)</p>



<a name="198465470"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198465470" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198465470">(May 22 2020 at 16:50)</a>:</h4>
<p>I'll stick to "just do more lookahead" for now</p>



<a name="198465496"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198465496" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198465496">(May 22 2020 at 16:50)</a>:</h4>
<p><span aria-label="thumbs up" class="emoji emoji-1f44d" role="img" title="thumbs up">:thumbs_up:</span></p>



<a name="198493950"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198493950" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198493950">(May 22 2020 at 20:56)</a>:</h4>
<p>Hm ok so I'm getting really tripped up how to implement <code>alias</code> statements in text parsing</p>



<a name="198493955"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198493955" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198493955">(May 22 2020 at 20:56)</a>:</h4>
<p>everything is so circular and I don't know how to untangle things</p>



<a name="198493972"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198493972" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198493972">(May 22 2020 at 20:56)</a>:</h4>
<p>so right now "elaboration" is a pretty simple 3-phase process</p>



<a name="198493977"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198493977" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198493977">(May 22 2020 at 20:56)</a>:</h4>
<p>er, 4 I guess</p>



<a name="198494024"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198494024" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198494024">(May 22 2020 at 20:57)</a>:</h4>
<p>1) expand inline imports/exports<br>
2) expand inline type annotations to actual type declarations<br>
3) record what index each name is at<br>
4) fill in all names with their indexes</p>



<a name="198494053"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198494053" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198494053">(May 22 2020 at 20:57)</a>:</h4>
<p>during step (4) we also have this extra "validate the inline function type matches the referenced type" if you do something like <code>(func (type 0) (param i32))</code></p>



<a name="198494062"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198494062" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198494062">(May 22 2020 at 20:57)</a>:</h4>
<p>but I don't know how to do this for modules</p>



<a name="198494078"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198494078" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198494078">(May 22 2020 at 20:57)</a>:</h4>
<p>so if you have a nested module like <code>(module (module))</code></p>



<a name="198494105"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198494105" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198494105">(May 22 2020 at 20:58)</a>:</h4>
<p>then that needs to be elaborated to </p>
<div class="codehilite"><pre><span></span><code>(module
  (type (module))
  (module (type 0))
)
</code></pre></div>



<a name="198494166"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198494166" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198494166">(May 22 2020 at 20:58)</a>:</h4>
<p>so when the module type isn't listed, we need to calculate it an inject it as a module type</p>



<a name="198494188"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198494188" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198494188">(May 22 2020 at 20:58)</a>:</h4>
<p>but I'm not sure how we can calculate it in the face of <code>(alias (parent ...))</code></p>



<a name="198494204"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198494204" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198494204">(May 22 2020 at 20:58)</a>:</h4>
<p>because that needs information from the parent, which if we're only in step (2) we don't even have symbolic names yet</p>



<a name="198494226"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198494226" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198494226">(May 22 2020 at 20:58)</a>:</h4>
<p>much less stable indexes because we're still injecting new type annotations depending on what we're seeing</p>



<a name="198494298"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198494298" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198494298">(May 22 2020 at 20:59)</a>:</h4>
<p>so like for example</p>
<div class="codehilite"><pre><span></span><code>(module
  (module
    (alias (parent (type 0)))
    (func (type 0) (param i32))
  )
)
</code></pre></div>



<a name="198494324"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198494324" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198494324">(May 22 2020 at 20:59)</a>:</h4>
<p>the definition of the parent module's type 0 is going to be the type of the inlined module</p>



<a name="198494373"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198494373" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198494373">(May 22 2020 at 21:00)</a>:</h4>
<p>but the inlined module references that</p>



<a name="198494489"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198494489" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198494489">(May 22 2020 at 21:01)</a>:</h4>
<p>Some of this is just complexity I think, but I'm just stuck at what to do</p>



<a name="198494505"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198494505" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198494505">(May 22 2020 at 21:01)</a>:</h4>
<p>I don't know if I should just throw everything out and start from scratch with a complicated resolver</p>



<a name="198494515"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198494515" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198494515">(May 22 2020 at 21:01)</a>:</h4>
<p>or try to fit things cleanly into what already exists</p>



<a name="198494597"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198494597" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198494597">(May 22 2020 at 21:02)</a>:</h4>
<p>I can't tell if all this elaboration/name resolution has to happen in cycles till it reaches some sort of fixed point or otherwise what the precise order of passes is to figure everything out correctly</p>



<a name="198494911"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198494911" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198494911">(May 22 2020 at 21:05)</a>:</h4>
<p>Another example would be</p>
<div class="codehilite"><pre><span></span><code>(module
  (module
    (alias (parent (type $foo)))
    (func (type 0))
  )
  (type $foo (func))
)
</code></pre></div>


<p>I don't know what order to do things. The index of <code>$foo</code> is 1, but we don't know that until the type of the nested module is elaborated. We can't do that though until we figure out what it's <code>parent</code> reference is pointing to</p>



<a name="198496055"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198496055" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198496055">(May 22 2020 at 21:17)</a>:</h4>
<p><span class="user-mention" data-user-id="253994">@Alex Crichton</span> So for the text format parsing, my inclination would be to say that, when you see an explicit type declaration, you simply bake in that index, no questions asked; if the module fails to validate, it's the author's fault</p>



<a name="198496094"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198496094" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198496094">(May 22 2020 at 21:17)</a>:</h4>
<p>oh sure yeah wat does extremely little validation</p>



<a name="198496148"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198496148" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198496148">(May 22 2020 at 21:18)</a>:</h4>
<p>this is more just about trying to do name resolution where we're figuring out what indexes are assigned to everything</p>



<a name="198496317"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198496317" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198496317">(May 22 2020 at 21:20)</a>:</h4>
<p>like is this supposed to work?</p>
<div class="codehilite"><pre><span></span><code>(module
  (type $foo (instance
    (export &quot;&quot; (func $bar))
  ))
  (module
    (alias (parent (type $foo)))
    (import &quot;&quot; (instance $i (type 0)))
    (alias ($i (func $bar)))
    (func
      call 0)
  )
)
</code></pre></div>



<a name="198496528"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198496528" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198496528">(May 22 2020 at 21:23)</a>:</h4>
<p>So one thing we can do for now (and perhaps forever) is to say that aliases can only refer to preceding definitions</p>



<a name="198496598"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198496598" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198496598">(May 22 2020 at 21:24)</a>:</h4>
<p>but even in the above case</p>



<a name="198496602"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198496602" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198496602">(May 22 2020 at 21:24)</a>:</h4>
<p>we're doing name resolution across modules</p>



<a name="198496612"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198496612" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198496612">(May 22 2020 at 21:24)</a>:</h4>
<p>and everything is in preceding order and everything</p>



<a name="198496650"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198496650" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198496650">(May 22 2020 at 21:25)</a>:</h4>
<p><code>(alias ($i (func $bar)))</code> realizes that <code>$i</code> resolves to local instance 0, which is imported, which has a type defined locally, but that type was aliased from a parent module</p>



<a name="198496687"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198496687" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198496687">(May 22 2020 at 21:25)</a>:</h4>
<p>like these are kind of "dumb concerns" in that they're only really applicable to the implementation of a text parser and don't really have many implications on the binary format</p>



<a name="198496759"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198496759" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198496759">(May 22 2020 at 21:26)</a>:</h4>
<p>I'm tripping myself up so much because the text format is so simple today and I can't figure out how to make the addition of modules as simple as it is right now</p>



<a name="198496776"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198496776" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198496776">(May 22 2020 at 21:26)</a>:</h4>
<p>without having things like global name resolution and tombstones for "this'll get resolved later" and things like that</p>



<a name="198496796"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198496796" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198496796">(May 22 2020 at 21:26)</a>:</h4>
<p>Yeah, I think the text parser has to maintain a stack of identifier scopes (one per nested module) that it updates in a linear pass over the AST</p>



<a name="198496862"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198496862" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198496862">(May 22 2020 at 21:27)</a>:</h4>
<p>I suppose what this means is that <em>some</em> identifiers (e.g., calls to $functions in function bodies) get resolved at the end (b/c they are allowed to be circular), while some get filled in as part of a linear pass</p>



<a name="198496888"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198496888" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198496888">(May 22 2020 at 21:27)</a>:</h4>
<p>yeah that's also the weird part for me</p>



<a name="198496945"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198496945" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198496945">(May 22 2020 at 21:28)</a>:</h4>
<p>the text format is super loose today in that you just throw things in a soup and a valid module almost always pops out</p>



<a name="198496961"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198496961" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198496961">(May 22 2020 at 21:28)</a>:</h4>
<p>but this is starting to place lots of restrictions of "no everything has to be very strictly ordered"</p>



<a name="198497003"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198497003" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198497003">(May 22 2020 at 21:28)</a>:</h4>
<p>well, i think every identifier that exists today would be in this "fill in at the end when all identifiers are known" category,</p>



<a name="198497067"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198497067" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198497067">(May 22 2020 at 21:30)</a>:</h4>
<p>and we're just introducing a new "kind" of identifier that gets resolved in a new, earlier, linear pass</p>



<a name="198497157"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198497157" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198497157">(May 22 2020 at 21:30)</a>:</h4>
<p>that makes sense, yeah, and I'm getting tripped up trying to not do that</p>



<a name="198497172"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198497172" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198497172">(May 22 2020 at 21:30)</a>:</h4>
<p>it feels wrong to have "oh these identifiers work only linearly" and "oh but those identifiers can work anywhere"</p>



<a name="198497190"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198497190" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198497190">(May 22 2020 at 21:31)</a>:</h4>
<p>and I can't figure out how to prove "yes the linear stuff is required due to this design constraint"</p>



<a name="198497255"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198497255" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198497255">(May 22 2020 at 21:32)</a>:</h4>
<p>heh, i guess that's sortof the case with C++; in <code>struct C { typedef int X; X foo() { bar(); } X bar() { foo(); }</code>, the names bar() and foo() can be cyclic whereas the reference to X has to be in order</p>



<a name="198497413"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198497413" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198497413">(May 22 2020 at 21:33)</a>:</h4>
<p>I'll just try to work something out</p>



<a name="198497489"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198497489" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198497489">(May 22 2020 at 21:34)</a>:</h4>
<p>But yeah, I see what you mean, the current parse rules simply parse every field in isolation and then do name resolution as a wholly separate, order-independent pass</p>



<a name="198498519"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198498519" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198498519">(May 22 2020 at 21:46)</a>:</h4>
<p>Trying to think a bit more about what the general rule is, I think it's this: you do most name resolution in a linear pass, and any time a name is un-resolved:</p>
<ul>
<li>if it's an identifier that is part of an alias or instance definition (the two new kinds), fail</li>
<li>otherwise, put in a placeholder</li>
</ul>
<p>Then, in a second pass, go over the placeholders and check that they resolve to a name <em>and</em> that name is <em>not</em> an alias or instance definition</p>
<p>Thus, only name cycles involving aliases or instance definitions would be disallowed; everything else should get resolved as it is today</p>



<a name="198504819"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198504819" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198504819">(May 22 2020 at 23:05)</a>:</h4>
<p>I think that sounds reasonable, yeah, I got further today in implementing all this, I think this is the last step for the text format</p>



<a name="198504841"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198504841" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198504841">(May 22 2020 at 23:05)</a>:</h4>
<p>I'll work on getting this implemented next week to see if it all works</p>



<a name="198822310"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198822310" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198822310">(May 26 2020 at 21:12)</a>:</h4>
<p>I'm still trying to wrap my head around the set of changes here</p>



<a name="198822377"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198822377" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198822377">(May 26 2020 at 21:12)</a>:</h4>
<p>I'm definitely getting from the point that <code>wat</code> was previously a pretty simple parser with a single pass to resolve names, but now it's becoming more of a compiler almost where it's got a type resolutoin pass and such</p>



<a name="198822480"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198822480" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198822480">(May 26 2020 at 21:13)</a>:</h4>
<p>but to confirm, <span class="user-mention" data-user-id="253998">@Luke Wagner</span> the encoding of this module:</p>
<div class="codehilite"><pre><span></span><code>(module $outer
  (module $inner
    (module $child (export &quot;a&quot;))
  )
)
</code></pre></div>


<p>would look like this?</p>
<div class="codehilite"><pre><span></span><code>(module $outer
  (type $child_type (module))
  (type $inner_type (module
    (export &quot;a&quot; (module (type $child_type)))
  ))

  (module $inner (type $inner_type)
    (alias $child_type_inner (parent (type $child_type)))
    (module $child (type $child_type_inner))
    (export &quot;a&quot; (module $child))
  )
)
</code></pre></div>



<a name="198823482"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/198823482" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#198823482">(May 26 2020 at 21:23)</a>:</h4>
<p>Yeah, that looks right, and yes, I can see how this makes the text-to-binary a lot more complicated</p>



<a name="199410046"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/199410046" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#199410046">(Jun 01 2020 at 19:09)</a>:</h4>
<p><span class="user-mention" data-user-id="253998">@Luke Wagner</span> <code>(export $some_instance)</code> is only intended to be sugar for the text format, right? not reflected in the binary format?</p>



<a name="199412476"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/199412476" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#199412476">(Jun 01 2020 at 19:29)</a>:</h4>
<p>Good question!  For now: yes.  At some point in the future, when one can import instances of imported instance types (O_O), they may need to become first-class things b/c it won't be possible to desugar them at text-to-binary time</p>



<a name="199434942"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/199434942" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#199434942">(Jun 01 2020 at 23:14)</a>:</h4>
<p><span class="user-mention" data-user-id="253998">@Luke Wagner</span> The'</p>



<a name="199434959"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/199434959" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#199434959">(Jun 01 2020 at 23:15)</a>:</h4>
<p>There's no way to use interface types with a global, right?</p>



<a name="199435090"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/199435090" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#199435090">(Jun 01 2020 at 23:17)</a>:</h4>
<p>And as a related question, in theory commands could have immutable global exports, which could be a way for commands to export metadata, however without the ability to export strings or other higher-level types, that may not be very valuable.</p>



<a name="199435622"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/199435622" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#199435622">(Jun 01 2020 at 23:26)</a>:</h4>
<p>Good question!  Coincidentally I was just thinking about this and how it might work for stuff like metadata.  It seems like one could have, as a component import/export an interface value (not const global, just a pure value) and this could be lowered into a core const global import, and this could allow one to import compound JSONesque values</p>



<a name="199435681"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/199435681" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#199435681">(Jun 01 2020 at 23:27)</a>:</h4>
<p><span class="user-mention" data-user-id="254083">@Dan Gohman</span></p>



<a name="199435962"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/199435962" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#199435962">(Jun 01 2020 at 23:32)</a>:</h4>
<p>Ah, and by being a value export, rather than a global export, you'd read it with an adapter function, and not with global.get</p>



<a name="199436122"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/199436122" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#199436122">(Jun 01 2020 at 23:34)</a>:</h4>
<p>Yup!  And it lets you perform a one-time conversion (performing malloc etc)</p>



<a name="199436136"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/199436136" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#199436136">(Jun 01 2020 at 23:34)</a>:</h4>
<p>Without thinking about global.set</p>



<a name="200484411"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/200484411" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#200484411">(Jun 10 2020 at 22:15)</a>:</h4>
<p><span class="user-mention" data-user-id="253998">@Luke Wagner</span> here's an interesting question, how should this be encoded?</p>
<div class="codehilite"><pre><span></span><code>(module
  (import &quot;&quot; (module))
  (type (module)))
</code></pre></div>



<a name="200484440"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/200484440" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#200484440">(Jun 10 2020 at 22:15)</a>:</h4>
<p>the <code>import</code> annotation has an "inline" type annotation</p>



<a name="200484451"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/200484451" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#200484451">(Jun 10 2020 at 22:15)</a>:</h4>
<p>but this inline type annotation is listed later</p>



<a name="200484472"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/200484472" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#200484472">(Jun 10 2020 at 22:15)</a>:</h4>
<p>with functions this works today because you just encode all types first</p>



<a name="200484537"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/200484537" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#200484537">(Jun 10 2020 at 22:16)</a>:</h4>
<p>but with the first 5 sections in any order, it's unclear what the text format is supposed to do here in that regard</p>



<a name="200484582"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/200484582" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#200484582">(Jun 10 2020 at 22:16)</a>:</h4>
<p>e.g. does this encode as:</p>
<div class="codehilite"><pre><span></span><code>(module
  (type (module)) ;; injected
  (import &quot;&quot; (module (type 0)))
  (type (module)) ;; original type annotation
)
</code></pre></div>



<a name="200484614"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/200484614" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#200484614">(Jun 10 2020 at 22:16)</a>:</h4>
<p>or like this:</p>
<div class="codehilite"><pre><span></span><code>(module
  (type (module)) ;; original annotation reordered first
  (import &quot;&quot; (module (type 0)))
</code></pre></div>



<a name="200484635"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/200484635" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#200484635">(Jun 10 2020 at 22:17)</a>:</h4>
<p>I suppose I'm answering my question as I'm writing this down, it basically has to be the former</p>



<a name="200484653"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/200484653" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#200484653">(Jun 10 2020 at 22:17)</a>:</h4>
<p>this is just weird because now this doesn't behave as functions do</p>



<a name="200489149"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/200489149" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#200489149">(Jun 10 2020 at 23:04)</a>:</h4>
<p>Yeah, good question.  So in the analogous function situation, when the inline type def goes before the explicit type def... do you get two type defs or 1?</p>



<a name="200489192"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/200489192" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#200489192">(Jun 10 2020 at 23:04)</a>:</h4>
<p>/me goes to look at spec</p>



<a name="200489816"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/200489816" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#200489816">(Jun 10 2020 at 23:12)</a>:</h4>
<p>By my reading, an inline func type followed by explicit func type def will produce two type defs: only inline funcs "reach back"; type defs don't</p>



<a name="200489828"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/200489828" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#200489828">(Jun 10 2020 at 23:13)</a>:</h4>
<p>Thus, I think the your former module case would be symmetric to funcs</p>



<a name="200489969"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/200489969" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#200489969">(Jun 10 2020 at 23:14)</a>:</h4>
<p>... and yet, wabt's wat2wasm seems to merge them</p>



<a name="200489998"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/200489998" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#200489998">(Jun 10 2020 at 23:15)</a>:</h4>
<p>I think technically that's a bug in wabt</p>



<a name="200490000"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/200490000" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#200490000">(Jun 10 2020 at 23:15)</a>:</h4>
<p>ah yeah I've mostly gone by wabt's behavior which may be a bug</p>



<a name="200490041"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/200490041" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#200490041">(Jun 10 2020 at 23:15)</a>:</h4>
<p>well, practically speaking, i'd do whatever was easiest for now, but if it's the former, i wouldn't feel bad about it</p>



<a name="200490213"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/200490213" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#200490213">(Jun 10 2020 at 23:17)</a>:</h4>
<p>order of items previously in the text format have largely been irrelevant, but with the 5 sections at the front that can be all interleaved I think it's a lot more imporatnt now</p>



<a name="200490224"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/200490224" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#200490224">(Jun 10 2020 at 23:17)</a>:</h4>
<p>so I don't think there's actually any opiton other than the first, injecting a duplicate annotation</p>



<a name="200490282"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/200490282" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#200490282">(Jun 10 2020 at 23:18)</a>:</h4>
<p>it's a relatively niche concern anyway though, it generally needs to just work</p>



<a name="200715145"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/200715145" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#200715145">(Jun 12 2020 at 19:35)</a>:</h4>
<p><span class="user-mention" data-user-id="253991">@Yury Delendik</span> did you want to join a video chat about <a href="https://github.com/bytecodealliance/wasm-tools/pull/26">https://github.com/bytecodealliance/wasm-tools/pull/26</a> ?</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wasm-tools/pull/26" style="background-image: url(https://avatars0.githubusercontent.com/u/54038801?s=400&amp;v=4)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wasm-tools/pull/26" title="Initial implementation of module linking by alexcrichton · Pull Request #26 · bytecodealliance/wasm-tools">Initial implementation of module linking by alexcrichton · Pull Request #26 · bytecodealliance/wasm-tools</a></div><div class="message_embed_description">This commit is the initial implementation of the module linking proposal
in the three tooling crates of this repository. Unfortunately this is
just one massive commit which isn&#39;t really able to...</div></div></div>



<a name="200715255"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/200715255" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yury Delendik <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#200715255">(Jun 12 2020 at 19:36)</a>:</h4>
<p>sure</p>



<a name="200715629"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/200715629" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#200715629">(Jun 12 2020 at 19:40)</a>:</h4>
<p>k cool, <span class="user-mention" data-user-id="253990">@fitzgen (he/him)</span> would you/yury be free this afternon?</p>



<a name="200715688"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/200715688" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yury Delendik <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#200715688">(Jun 12 2020 at 19:40)</a>:</h4>
<p>/me is</p>



<a name="200715706"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/200715706" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> fitzgen (he/him) <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#200715706">(Jun 12 2020 at 19:40)</a>:</h4>
<p>Yeah, free in roughly an hour and then for the rest of the day</p>



<a name="200715816"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/modules%20types%20binary%20format/near/200715816" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/modules.20types.20binary.20format.html#200715816">(Jun 12 2020 at 19:41)</a>:</h4>
<p>k cool I'll send an invite</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>