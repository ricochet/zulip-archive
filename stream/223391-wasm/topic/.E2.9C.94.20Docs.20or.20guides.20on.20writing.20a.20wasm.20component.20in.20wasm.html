<html>
<head><meta charset="utf-8"><title>✔ Docs or guides on writing a wasm component in wasm · wasm · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/index.html">wasm</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/.E2.9C.94.20Docs.20or.20guides.20on.20writing.20a.20wasm.20component.20in.20wasm.html">✔ Docs or guides on writing a wasm component in wasm</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="452863316"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/%E2%9C%94%20Docs%20or%20guides%20on%20writing%20a%20wasm%20component%20in%20wasm/near/452863316" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Gåsemyr Magnus <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/.E2.9C.94.20Docs.20or.20guides.20on.20writing.20a.20wasm.20component.20in.20wasm.html#452863316">(Jul 20 2024 at 16:50)</a>:</h4>
<p>Hey,</p>
<p>I'm trying to get comfortable with wasm components by writing them by hand in wat, so far I've gotten a few experiments to work, but I struggle with things like getting a function with a record type to work.</p>
<p>For example: </p>
<div class="codehilite" data-code-language="WebAssembly"><pre><span></span><code><span class="p">(</span><span class="err">component</span>
  <span class="p">(</span><span class="k">type</span> <span class="nv">$vec2</span> <span class="p">(</span><span class="err">record</span> <span class="p">(</span><span class="err">field</span> <span class="s2">"x"</span> <span class="kt">f64</span><span class="p">)</span> <span class="p">(</span><span class="err">field</span> <span class="s2">"y"</span> <span class="kt">f64</span><span class="p">)))</span>
  <span class="p">(</span><span class="k">type</span> <span class="nv">$add_t</span> <span class="p">(</span><span class="k">func</span> <span class="p">(</span><span class="k">param</span> <span class="s2">"a"</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="k">param</span> <span class="s2">"b"</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="k">result</span> <span class="s2">"res"</span> <span class="mi">0</span><span class="p">)))</span>
  <span class="p">(</span><span class="err">core</span> <span class="k">module</span> <span class="nv">$module</span>
    <span class="p">(</span><span class="k">func</span> <span class="nv">$add</span> <span class="p">(</span><span class="k">export</span> <span class="s2">"add"</span><span class="p">)</span> <span class="p">(</span><span class="k">param</span> <span class="nv">$a</span> <span class="p">(</span><span class="err">ref</span> <span class="nv">$vec2</span><span class="p">))</span> <span class="p">(</span><span class="k">param</span> <span class="nv">$b</span> <span class="p">(</span><span class="err">ref</span> <span class="nv">$vec2</span><span class="p">))</span> <span class="p">(</span><span class="k">result</span> <span class="p">(</span><span class="err">ref</span> <span class="nv">$vec2</span><span class="p">))</span>
      <span class="p">(</span><span class="err">...</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="p">(</span><span class="k">memory</span> <span class="p">(</span><span class="k">export</span> <span class="s2">"mem"</span><span class="p">)</span> <span class="mi">1</span><span class="p">)</span>
  <span class="p">)</span>
  <span class="p">(</span><span class="err">core</span> <span class="err">instance</span> <span class="nv">$instance</span> <span class="p">(</span><span class="err">instantiate</span> <span class="mi">0</span><span class="p">))</span>
  <span class="p">(</span><span class="k">func</span> <span class="nv">$add</span> <span class="p">(</span><span class="k">type</span> <span class="nv">$add_t</span><span class="p">)</span>
    <span class="p">(</span><span class="err">canon</span> <span class="err">l</span><span class="nb">if</span><span class="err">t</span>
        <span class="p">(</span><span class="err">core</span> <span class="k">func</span> <span class="nv">$instance</span> <span class="s2">"add"</span><span class="p">)</span>
        <span class="p">(</span><span class="k">memory</span> <span class="nv">$instance</span> <span class="s2">"mem"</span><span class="p">)</span>
        <span class="err">string-encoding=utf</span><span class="mi">8</span>
        <span class="p">)</span>
    <span class="p">)</span>
<span class="p">)</span>
</code></pre></div>
<p>I can't figure out how to use the types from the component.<br>
Another question I have is that I've noticed that components created in rust and wasm-tools include package names and interfaces. This is something I'd also like to figure out</p>
<p>Jens</p>



<a name="452914458"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/%E2%9C%94%20Docs%20or%20guides%20on%20writing%20a%20wasm%20component%20in%20wasm/near/452914458" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/.E2.9C.94.20Docs.20or.20guides.20on.20writing.20a.20wasm.20component.20in.20wasm.html#452914458">(Jul 21 2024 at 00:15)</a>:</h4>
<p>Types in the component type index space cannot be used as core module types in the core module type index space. Furthermore core modules don't have the ability to alias types from outside within a component itself, right now the component model is a pure wrapper around teh core wasm spec so there are no modifications to core wasm to enable such aliasing at this time. </p>
<p>What you probably want here is to review the CanonicalABI.md to understand how the component model type <code>$vec2</code> is lowered into wasm. For example your wasm signature here will be <code>(func (param i32 i32 i32 i32 i32))</code> and the canonical abi will explain what each of those fields are. </p>
<p>You can also try playing around with <code>wasm-tools component embed --dummy</code> which will generate a dummy <code>*.wat</code> file for a particular WIT world</p>



<a name="453009874"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/%E2%9C%94%20Docs%20or%20guides%20on%20writing%20a%20wasm%20component%20in%20wasm/near/453009874" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Gåsemyr Magnus <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/.E2.9C.94.20Docs.20or.20guides.20on.20writing.20a.20wasm.20component.20in.20wasm.html#453009874">(Jul 21 2024 at 16:50)</a>:</h4>
<p>Thanks! <code>wasm-tools component embed --dummy</code> was very helpful <span aria-label="grinning face with smiling eyes" class="emoji emoji-1f601" role="img" title="grinning face with smiling eyes">:grinning_face_with_smiling_eyes:</span></p>



<a name="453023572"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/223391-wasm/topic/%E2%9C%94%20Docs%20or%20guides%20on%20writing%20a%20wasm%20component%20in%20wasm/near/453023572" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/223391-wasm/topic/.E2.9C.94.20Docs.20or.20guides.20on.20writing.20a.20wasm.20component.20in.20wasm.html#453023572">(Jul 21 2024 at 18:32)</a>:</h4>
<p><span class="user-mention silent" data-user-id="512924">Jens Gåsemyr Magnus</span> has marked this topic as resolved.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>