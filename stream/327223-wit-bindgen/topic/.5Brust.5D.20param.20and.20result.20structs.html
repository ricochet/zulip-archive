<html>
<head><meta charset="utf-8"><title>[rust] param and result structs · wit-bindgen · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/index.html">wit-bindgen</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/topic/.5Brust.5D.20param.20and.20result.20structs.html">[rust] param and result structs</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="339720924"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/327223-wit-bindgen/topic/%5Brust%5D%20param%20and%20result%20structs/near/339720924" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bachrc <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/topic/.5Brust.5D.20param.20and.20result.20structs.html#339720924">(Mar 05 2023 at 16:42)</a>:</h4>
<p>Hello, I am a little lost with param and result structs generated by wit-bindgen.<br>
Actually, function take in parameters Param structs. Those param struct does not have any ownership on their data, but I don't know how I can construct those param structs before sending them.</p>



<a name="339722580"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/327223-wit-bindgen/topic/%5Brust%5D%20param%20and%20result%20structs/near/339722580" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bachrc <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/topic/.5Brust.5D.20param.20and.20result.20structs.html#339722580">(Mar 05 2023 at 16:59)</a>:</h4>
<p>with param objects i only have those</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">error</span><span class="p">[</span><span class="n">E0515</span><span class="p">]</span>: <span class="nc">cannot</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="n">referencing</span><span class="w"> </span><span class="n">temporary</span><span class="w"> </span><span class="n">value</span>
<span class="w">  </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">file_document</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">25</span>:<span class="mi">9</span>
<span class="w">   </span><span class="o">|</span>
<span class="mi">25</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">/</span><span class="w">         </span><span class="n">Document</span><span class="w"> </span><span class="p">{</span>
<span class="mi">26</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">             </span><span class="n">identifier</span>: <span class="nc">self</span><span class="p">.</span><span class="n">id</span><span class="p">.</span><span class="n">to_string</span><span class="p">().</span><span class="n">as_str</span><span class="p">(),</span>
<span class="mi">27</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">             </span><span class="n">fields</span>: <span class="kp">&amp;</span><span class="p">[</span>
<span class="mi">28</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">                 </span><span class="n">Field</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">name</span>: <span class="s">"filename"</span><span class="p">,</span><span class="w"> </span><span class="n">value</span>: <span class="nc">Text</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">filename</span><span class="p">.</span><span class="n">to_string</span><span class="p">().</span><span class="n">as_str</span><span class="p">())</span><span class="w"> </span><span class="p">},</span>
<span class="mi">29</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">                 </span><span class="n">Field</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">name</span>: <span class="s">"path"</span><span class="p">,</span><span class="w"> </span><span class="n">value</span>: <span class="nc">Text</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">to_string_lossy</span><span class="p">().</span><span class="n">as_ref</span><span class="p">())</span><span class="w"> </span><span class="p">},</span>
</code></pre></div>



<a name="339722680"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/327223-wit-bindgen/topic/%5Brust%5D%20param%20and%20result%20structs/near/339722680" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bachrc <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/topic/.5Brust.5D.20param.20and.20result.20structs.html#339722680">(Mar 05 2023 at 17:00)</a>:</h4>
<p>I cannot construct my param object. Do you have any idea? I am totally stuck</p>



<a name="339764150"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/327223-wit-bindgen/topic/%5Brust%5D%20param%20and%20result%20structs/near/339764150" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bachrc <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/topic/.5Brust.5D.20param.20and.20result.20structs.html#339764150">(Mar 06 2023 at 01:42)</a>:</h4>
<p>I'm sorry to ask such a "Rust-ish" question, but I really tried everything to do these commands</p>



<a name="339764242"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/327223-wit-bindgen/topic/%5Brust%5D%20param%20and%20result%20structs/near/339764242" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bachrc <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/topic/.5Brust.5D.20param.20and.20result.20structs.html#339764242">(Mar 06 2023 at 01:44)</a>:</h4>
<p>If I inline the param struct in the function call it's okay, but I cannot inline everytime</p>



<a name="339890801"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/327223-wit-bindgen/topic/%5Brust%5D%20param%20and%20result%20structs/near/339890801" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/topic/.5Brust.5D.20param.20and.20result.20structs.html#339890801">(Mar 06 2023 at 14:58)</a>:</h4>
<p>More context would help in answering your question (a full example source file)</p>



<a name="340588770"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/327223-wit-bindgen/topic/%5Brust%5D%20param%20and%20result%20structs/near/340588770" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bachrc <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/topic/.5Brust.5D.20param.20and.20result.20structs.html#340588770">(Mar 09 2023 at 12:08)</a>:</h4>
<p>Sorry for the delay, I've been busy at work.<br>
This is as simple as this code :</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">push_file_to_index</span><span class="p">(</span><span class="n">file</span>: <span class="nc">FileDocument</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="p">()</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">michel_api</span>::<span class="n">new_document_for_index</span><span class="p">(</span><span class="s">"files"</span><span class="p">,</span><span class="w"> </span><span class="n">DocumentParam</span>::<span class="n">from</span><span class="p">(</span><span class="n">file</span><span class="p">));</span>

<span class="w">    </span><span class="nb">Ok</span><span class="p">(())</span>
<span class="p">}</span>
</code></pre></div>
<p>In another file, I wanted to implement the From trait to the wit generated DocumentParam :</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">impl</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="w"> </span><span class="nb">From</span><span class="o">&lt;</span><span class="n">FileDocument</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">DocumentParam</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">from</span><span class="p">(</span><span class="n">value</span>: <span class="nc">FileDocument</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Self</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">DocumentParam</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">identifier</span>: <span class="kp">&amp;</span><span class="nc">value</span><span class="p">.</span><span class="n">filename</span><span class="p">,</span>
<span class="w">            </span><span class="n">fields</span>: <span class="nc">vec</span><span class="o">!</span><span class="p">[</span>
<span class="w">                </span><span class="n">FieldParam</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">name</span>: <span class="s">"filename"</span><span class="p">,</span><span class="w"> </span><span class="n">value</span>: <span class="nc">Text</span><span class="p">(</span><span class="o">&amp;</span><span class="n">value</span><span class="p">.</span><span class="n">filename</span><span class="p">.</span><span class="n">to_string</span><span class="p">().</span><span class="n">as_ref</span><span class="p">())</span><span class="w"> </span><span class="p">},</span>
<span class="w">                </span><span class="n">FieldParam</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">name</span>: <span class="s">"path"</span><span class="p">,</span><span class="w"> </span><span class="n">value</span>: <span class="nc">Text</span><span class="p">(</span><span class="o">&amp;</span><span class="n">value</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">to_string_lossy</span><span class="p">().</span><span class="n">as_ref</span><span class="p">())</span><span class="w"> </span><span class="p">},</span>
<span class="w">            </span><span class="p">].</span><span class="n">deref</span><span class="p">(),</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>This is one of the things I tried, but I failed everywhere.</p>
<p>My FileDocument is a basic struct like this : </p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">struct</span> <span class="nc">FileDocument</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">id</span>: <span class="nc">Uuid</span><span class="p">,</span>
<span class="w">    </span><span class="n">filename</span>: <span class="nb">String</span><span class="p">,</span>
<span class="w">    </span><span class="n">path</span>: <span class="nc">PathBuf</span>
<span class="p">}</span>
</code></pre></div>



<a name="340700348"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/327223-wit-bindgen/topic/%5Brust%5D%20param%20and%20result%20structs/near/340700348" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/topic/.5Brust.5D.20param.20and.20result.20structs.html#340700348">(Mar 09 2023 at 19:56)</a>:</h4>
<p>There isn't a simple way to do exactly what you want. wit-bindgen param structs borrow their strings which in this case means you have to turn e.g. <code>Uuid</code> into a String that lives long enough to pass to the function call</p>



<a name="340700922"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/327223-wit-bindgen/topic/%5Brust%5D%20param%20and%20result%20structs/near/340700922" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/topic/.5Brust.5D.20param.20and.20result.20structs.html#340700922">(Mar 09 2023 at 19:59)</a>:</h4>
<p>As a couple of options:</p>
<ul>
<li>convert <code>FileDocument</code> to a e.g. <code>Document</code> type which owns its fields (which wit-bindgen might already have created for you as <code>DocumentResult</code>, depending on the rest of the wit) and then borrow <code>DocumentParam</code> from _that_</li>
<li>wrap <code>new_document_for_index</code> in a function that borrows directly from <code>FileDocument</code></li>
</ul>
<p>As you say this is more of a general Rust problem and there are lots of ways to accomplish this</p>



<a name="340807538"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/327223-wit-bindgen/topic/%5Brust%5D%20param%20and%20result%20structs/near/340807538" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bachrc <a href="https://bytecodealliance.github.io/zulip-archive/stream/327223-wit-bindgen/topic/.5Brust.5D.20param.20and.20result.20structs.html#340807538">(Mar 10 2023 at 09:44)</a>:</h4>
<p>Thank you for your kind answer, I'm gonna work on this</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>