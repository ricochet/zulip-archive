<html>
<head><meta charset="utf-8"><title>`@since` gates on variant and enum members? · wasi · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/index.html">wasi</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/.60.40since.60.20gates.20on.20variant.20and.20enum.20members.3F.html">`@since` gates on variant and enum members?</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="440880604"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/%60%40since%60%20gates%20on%20variant%20and%20enum%20members%3F/near/440880604" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/.60.40since.60.20gates.20on.20variant.20and.20enum.20members.3F.html#440880604">(May 27 2024 at 15:49)</a>:</h4>
<p><span class="user-mention" data-user-id="253998">@Luke Wagner</span> <span class="user-mention" data-user-id="253994">@Alex Crichton</span> question: should individual members on variants/enums be tagged with a <code>@since</code> gate? - If this was Rust I'd say: "yes", since we have the <code>#[non_exhaustive]</code> attribute which sets enums up to be forward-compatible. But I'm not sure what the thinking is for WIT around this. I don't think we have an equivalent attribute right now?</p>



<a name="440880815"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/%60%40since%60%20gates%20on%20variant%20and%20enum%20members%3F/near/440880815" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/.60.40since.60.20gates.20on.20variant.20and.20enum.20members.3F.html#440880815">(May 27 2024 at 15:50)</a>:</h4>
<p>I can see this being relevant for things like error cases which we may want to extend later. Or for example in the case of HTTP there have been a number of new verbs added via RFCs over the years.</p>



<a name="440880964"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/%60%40since%60%20gates%20on%20variant%20and%20enum%20members%3F/near/440880964" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/.60.40since.60.20gates.20on.20variant.20and.20enum.20members.3F.html#440880964">(May 27 2024 at 15:51)</a>:</h4>
<p>Right now the <code>wit-tools</code> patch adding the <code>@since</code> gates does not seem to support it, so I guess I was wondering what our thinking here was.</p>



<a name="440885431"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/%60%40since%60%20gates%20on%20variant%20and%20enum%20members%3F/near/440885431" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/.60.40since.60.20gates.20on.20variant.20and.20enum.20members.3F.html#440885431">(May 27 2024 at 16:18)</a>:</h4>
<p>Oh I guess <code>@since</code> also can't be added to individual struct fields right now either</p>



<a name="440885535"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/%60%40since%60%20gates%20on%20variant%20and%20enum%20members%3F/near/440885535" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/.60.40since.60.20gates.20on.20variant.20and.20enum.20members.3F.html#440885535">(May 27 2024 at 16:19)</a>:</h4>
<p>Yep, that's right</p>



<a name="440885682"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/%60%40since%60%20gates%20on%20variant%20and%20enum%20members%3F/near/440885682" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/.60.40since.60.20gates.20on.20variant.20and.20enum.20members.3F.html#440885682">(May 27 2024 at 16:20)</a>:</h4>
<p>Uh oh, I should have re-read the doc you wrote, shouldn't I?</p>



<a name="440885696"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/%60%40since%60%20gates%20on%20variant%20and%20enum%20members%3F/near/440885696" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/.60.40since.60.20gates.20on.20variant.20and.20enum.20members.3F.html#440885696">(May 27 2024 at 16:20)</a>:</h4>
<p>(I'll go do that now haha)</p>



<a name="441073091"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/%60%40since%60%20gates%20on%20variant%20and%20enum%20members%3F/near/441073091" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/.60.40since.60.20gates.20on.20variant.20and.20enum.20members.3F.html#441073091">(May 28 2024 at 16:16)</a>:</h4>
<p>I think the difference between Rust and WIT types here means that it doesn't make sense to put individual annotations on variants/fields because subtyping in the component model considers two structurally-the-same types equivalent, meaning that you don't have the same level of privacy in WIT that you can get in Rust</p>



<a name="441073798"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/%60%40since%60%20gates%20on%20variant%20and%20enum%20members%3F/near/441073798" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/.60.40since.60.20gates.20on.20variant.20and.20enum.20members.3F.html#441073798">(May 28 2024 at 16:20)</a>:</h4>
<p>In other words, adding a variant is never backward compatible today, right?</p>



<a name="441073829"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/%60%40since%60%20gates%20on%20variant%20and%20enum%20members%3F/near/441073829" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/.60.40since.60.20gates.20on.20variant.20and.20enum.20members.3F.html#441073829">(May 28 2024 at 16:20)</a>:</h4>
<p>correct, yeah</p>



<a name="441077897"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/%60%40since%60%20gates%20on%20variant%20and%20enum%20members%3F/near/441077897" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/.60.40since.60.20gates.20on.20variant.20and.20enum.20members.3F.html#441077897">(May 28 2024 at 16:45)</a>:</h4>
<p>okk, I see! ty</p>



<a name="441078368"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/%60%40since%60%20gates%20on%20variant%20and%20enum%20members%3F/near/441078368" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/.60.40since.60.20gates.20on.20variant.20and.20enum.20members.3F.html#441078368">(May 28 2024 at 16:49)</a>:</h4>
<p>that does seem tough though - If I'm understanding it correctly, that would then mean that post-WASI 1.0, if a new HTTP verb would be published, we wouldn't have a way to add it to <code>wasi:http</code> without breaking the interface. I guess I was expecting at least some form of forward-compatibility?</p>



<a name="441078445"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/%60%40since%60%20gates%20on%20variant%20and%20enum%20members%3F/near/441078445" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/.60.40since.60.20gates.20on.20variant.20and.20enum.20members.3F.html#441078445">(May 28 2024 at 16:49)</a>:</h4>
<p>that's correct, and that's more-or-less just how the component model works</p>



<a name="441078493"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/%60%40since%60%20gates%20on%20variant%20and%20enum%20members%3F/near/441078493" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/.60.40since.60.20gates.20on.20variant.20and.20enum.20members.3F.html#441078493">(May 28 2024 at 16:50)</a>:</h4>
<p>we'd have to add new types for extenable-enums or extenable-structs to the component model to allow for such a use case</p>



<a name="441078541"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/%60%40since%60%20gates%20on%20variant%20and%20enum%20members%3F/near/441078541" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/.60.40since.60.20gates.20on.20variant.20and.20enum.20members.3F.html#441078541">(May 28 2024 at 16:50)</a>:</h4>
<p>and/or a different versioning story</p>



<a name="441078959"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/%60%40since%60%20gates%20on%20variant%20and%20enum%20members%3F/near/441078959" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/.60.40since.60.20gates.20on.20variant.20and.20enum.20members.3F.html#441078959">(May 28 2024 at 16:53)</a>:</h4>
<p><span class="user-mention silent" data-user-id="253994">Alex Crichton</span> <a href="#narrow/stream/219900-wasi/topic/.60.40since.60.20gates.20on.20variant.20and.20enum.20members.3F/near/441078541">said</a>:</p>
<blockquote>
<p>and/or a different versioning story</p>
</blockquote>
<p>by that you mean: "WASI 1.0 doesn't mean no breaking changes forever after"? - e.g. folks would expect to work with potentially a 2.0, 3.0, etc.</p>



<a name="441079236"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/%60%40since%60%20gates%20on%20variant%20and%20enum%20members%3F/near/441079236" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/.60.40since.60.20gates.20on.20variant.20and.20enum.20members.3F.html#441079236">(May 28 2024 at 16:55)</a>:</h4>
<p>IMO we're not far enough along to really answer that</p>



<a name="441079262"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/%60%40since%60%20gates%20on%20variant%20and%20enum%20members%3F/near/441079262" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/.60.40since.60.20gates.20on.20variant.20and.20enum.20members.3F.html#441079262">(May 28 2024 at 16:55)</a>:</h4>
<p>no one wants continual breaking changes after a "one dot oh" no matter what</p>



<a name="441079277"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/%60%40since%60%20gates%20on%20variant%20and%20enum%20members%3F/near/441079277" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/.60.40since.60.20gates.20on.20variant.20and.20enum.20members.3F.html#441079277">(May 28 2024 at 16:55)</a>:</h4>
<p>so that's at least the guiding light to me</p>



<a name="441079293"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/%60%40since%60%20gates%20on%20variant%20and%20enum%20members%3F/near/441079293" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/.60.40since.60.20gates.20on.20variant.20and.20enum.20members.3F.html#441079293">(May 28 2024 at 16:55)</a>:</h4>
<p>yeah yeah yeah, that was my expectation too - I'm glad we're on the same page ^^</p>



<a name="441079437"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/%60%40since%60%20gates%20on%20variant%20and%20enum%20members%3F/near/441079437" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/.60.40since.60.20gates.20on.20variant.20and.20enum.20members.3F.html#441079437">(May 28 2024 at 16:56)</a>:</h4>
<p>I was mostly trying to understand what you were saying - when you said: "different versioning story" my mind immediately went to: "oh, so.. breaking changes?"</p>



<a name="441079460"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/%60%40since%60%20gates%20on%20variant%20and%20enum%20members%3F/near/441079460" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dave Bakker (badeend) <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/.60.40since.60.20gates.20on.20variant.20and.20enum.20members.3F.html#441079460">(May 28 2024 at 16:56)</a>:</h4>
<p>The component-model repo used to have a "subtyping" section. The idea is/was that new fields (structs), cases (variants) and parameters (functions) could be added in a backwards-compatible way. I don't know where that section went, though.</p>



<a name="441079721"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/%60%40since%60%20gates%20on%20variant%20and%20enum%20members%3F/near/441079721" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/.60.40since.60.20gates.20on.20variant.20and.20enum.20members.3F.html#441079721">(May 28 2024 at 16:58)</a>:</h4>
<p>oh interesting!</p>



<a name="441079812"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/%60%40since%60%20gates%20on%20variant%20and%20enum%20members%3F/near/441079812" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dave Bakker (badeend) <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/.60.40since.60.20gates.20on.20variant.20and.20enum.20members.3F.html#441079812">(May 28 2024 at 16:58)</a>:</h4>
<p>Found it. It was removed in <a href="https://github.com/WebAssembly/component-model/pull/255">Clarify what's in Preview 2</a>. So I don't know if it was just temporarily removed for the preview 2 launch, or if it is a permanent change.</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/WebAssembly/component-model/pull/255" style="background-image: url(&quot;https://uploads.zulipusercontent.net/fc77a7df7068b87049e8f7df30417993c59fcbd2/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f363462386334396165343365316237313466366333326464656463373462306130316564303430633636393461333861653464643237626237346531346238302f576562417373656d626c792f636f6d706f6e656e742d6d6f64656c2f70756c6c2f323535&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/WebAssembly/component-model/pull/255" title="Clarify what's in Preview 2 by lukewagner · Pull Request #255 · WebAssembly/component-model">Clarify what's in Preview 2 by lukewagner · Pull Request #255 · WebAssembly/component-model</a></div><div class="message_embed_description">This PR implements the idea in #229 of qualifying the parts of the current proposal that are not included in the upcoming 'Preview 2' stability milestone.  Subtyping wasn't really written, so I sim...</div></div></div>



<a name="441079909"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/%60%40since%60%20gates%20on%20variant%20and%20enum%20members%3F/near/441079909" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/.60.40since.60.20gates.20on.20variant.20and.20enum.20members.3F.html#441079909">(May 28 2024 at 16:59)</a>:</h4>
<blockquote>
<p>a new HTTP verb</p>
</blockquote>
<p>There is a solution for this <em>specific</em> problem in place (along with any nonstandard verbs): <a href="https://github.com/WebAssembly/wasi-http/blob/a81c61fc584278f801393b22289840a439e51f50/wit/types.wit#L21">https://github.com/WebAssembly/wasi-http/blob/a81c61fc584278f801393b22289840a439e51f50/wit/types.wit#L21</a></p>
<blockquote>
<p><code>other(string)</code></p>
</blockquote>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/WebAssembly/wasi-http/blob/a81c61fc584278f801393b22289840a439e51f50/wit/types.wit#L21" style="background-image: url(&quot;https://uploads.zulipusercontent.net/e195fce7a24aabab813b2d7b69d1aae4499baeb9/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f313965336465616663653164313965346362343564656531666335376438366233393736373461356235316535343635623761653133313965356464623364652f576562417373656d626c792f776173692d68747470&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/WebAssembly/wasi-http/blob/a81c61fc584278f801393b22289840a439e51f50/wit/types.wit#L21" title="wasi-http/wit/types.wit at a81c61fc584278f801393b22289840a439e51f50 · WebAssembly/wasi-http">wasi-http/wit/types.wit at a81c61fc584278f801393b22289840a439e51f50 · WebAssembly/wasi-http</a></div><div class="message_embed_description">Contribute to WebAssembly/wasi-http development by creating an account on GitHub.</div></div></div>



<a name="441080601"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/%60%40since%60%20gates%20on%20variant%20and%20enum%20members%3F/near/441080601" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/.60.40since.60.20gates.20on.20variant.20and.20enum.20members.3F.html#441080601">(May 28 2024 at 17:04)</a>:</h4>
<p>yeah I can expand by saying that there's a few different ways we could go about making things extensible</p>



<a name="441080632"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/%60%40since%60%20gates%20on%20variant%20and%20enum%20members%3F/near/441080632" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/.60.40since.60.20gates.20on.20variant.20and.20enum.20members.3F.html#441080632">(May 28 2024 at 17:04)</a>:</h4>
<p>e.g. a different way to update versions, a subtyping story, something more general like <code>other(string)</code>, all of these are possible in theory</p>



<a name="441080696"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/%60%40since%60%20gates%20on%20variant%20and%20enum%20members%3F/near/441080696" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/.60.40since.60.20gates.20on.20variant.20and.20enum.20members.3F.html#441080696">(May 28 2024 at 17:05)</a>:</h4>
<p>it's moreso that right now no such story exists and one needs to be created to enable a story for backwards-compatibly adding variants/fields</p>



<a name="441080938"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/%60%40since%60%20gates%20on%20variant%20and%20enum%20members%3F/near/441080938" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/.60.40since.60.20gates.20on.20variant.20and.20enum.20members.3F.html#441080938">(May 28 2024 at 17:06)</a>:</h4>
<p>ok, yeah that makes sense to me</p>



<a name="441080966"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/%60%40since%60%20gates%20on%20variant%20and%20enum%20members%3F/near/441080966" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/.60.40since.60.20gates.20on.20variant.20and.20enum.20members.3F.html#441080966">(May 28 2024 at 17:07)</a>:</h4>
<p>knowing that we've got options we can explore in the future is probably the higher-order bit in my question</p>



<a name="441081000"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/%60%40since%60%20gates%20on%20variant%20and%20enum%20members%3F/near/441081000" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/.60.40since.60.20gates.20on.20variant.20and.20enum.20members.3F.html#441081000">(May 28 2024 at 17:07)</a>:</h4>
<p>ty for elaborating ^^</p>



<a name="441081505"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/%60%40since%60%20gates%20on%20variant%20and%20enum%20members%3F/near/441081505" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/.60.40since.60.20gates.20on.20variant.20and.20enum.20members.3F.html#441081505">(May 28 2024 at 17:10)</a>:</h4>
<p>I still very much want to re-add subtyping so that it's possible to, in particular, add cases to variants in a non-breaking fashion.  I initially added the Subtyping section because it seemed easy enough at the component-type level.  But the problem is that just because a component-function-type <code>f1</code> is a subtype of <code>f2</code>, that doesn't mean that the source-level bindings are a subtype (or the Canonical ABI which sometimes shows through directly in the source-leve bindings), and thus if we say that a WIT-level change is semver-compatible, it may actually produce source-incompatible, and thus breaking, changes.  So in the short-term we just disabled subtyping so we could sort it out more carefully later.</p>



<a name="441081817"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/%60%40since%60%20gates%20on%20variant%20and%20enum%20members%3F/near/441081817" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ralph <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/.60.40since.60.20gates.20on.20variant.20and.20enum.20members.3F.html#441081817">(May 28 2024 at 17:13)</a>:</h4>
<p>what's the upshot of the current situation? right now, we just need to define a new type?</p>



<a name="441082120"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/%60%40since%60%20gates%20on%20variant%20and%20enum%20members%3F/near/441082120" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/.60.40since.60.20gates.20on.20variant.20and.20enum.20members.3F.html#441082120">(May 28 2024 at 17:15)</a>:</h4>
<p>Yeah, new type used by new function (or make a breaking version change and change the type/function in-place)</p>



<a name="441084602"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/%60%40since%60%20gates%20on%20variant%20and%20enum%20members%3F/near/441084602" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/.60.40since.60.20gates.20on.20variant.20and.20enum.20members.3F.html#441084602">(May 28 2024 at 17:33)</a>:</h4>
<p>Part of the reason to take some time to figure out the right solution is that there are a couple of different paths:</p>
<p>There's one path where we try to support maximal subtyping (and thus API Evolution flexibility) by doing magic in the toolchain to capture the version you compiled against so that from "inside" the component, your bindings stay with a fixed type (even if the interface itself changes) until you intentionally bump it (and then opt into any source-level breaking changes).  This seems like a cool sci-fi thing we could do, but it adds a new dimension of versioning and complexity to think about and so perhaps is too magic.</p>
<p>There's a more conservative path of only allowing subtyping when we have a reasonably-thought-out answer for how this form of subtyping can be implemented source-compatibly in all the languages we can think of, so that if source bindings always use the latest minor version, client source code never breaks.  But this is a pretty stringent requirement when you consider, e.g., C, which is going to pretty much lay bare the whole Canonical ABI and thus the size of variants/records is an observable part of the interface; in the limit this rules out almost all subtyping.  But perhaps there's some smart things we can do here to carve out just enough wiggle room for the cases we need.</p>
<p>Also, a built-in <code>error</code> type (which might be a necessary part of the overall <code>stream</code> feature) that supports a more dynamically-typed form of error case analysis (like <code>anyhow::Error</code>) could subsume a bunch (but definitely not all all) use cases for extensibility in the 0.3 timeframe.</p>



<a name="441085116"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/%60%40since%60%20gates%20on%20variant%20and%20enum%20members%3F/near/441085116" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/.60.40since.60.20gates.20on.20variant.20and.20enum.20members.3F.html#441085116">(May 28 2024 at 17:36)</a>:</h4>
<blockquote>
<p>But this is a pretty stringent requirement when you consider, e.g., C, which is going to pretty much lay bare the whole Canonical ABI and thus the size of variants/records is an observable part of the interface</p>
</blockquote>
<p>If a function returns a struct with 3 fields and you are subtyping this function to one that returns only two fields, as far as the canonical ABI is concerned on the callee side only those two fields really exist and thus contribute to the observable size, right? Both the caller and callee can have a different view of what fields exist. The glue code between components is responsible for adding/removing fields as necessary when translating.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>