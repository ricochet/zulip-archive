<html>
<head><meta charset="utf-8"><title>socket connect WITX proposal · wasi · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/index.html">wasi</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html">socket connect WITX proposal</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="198607394"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/198607394" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Emiliano Lesende <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#198607394">(May 25 2020 at 00:43)</a>:</h4>
<p>Hello everybody. I'm new to the community, although I've been following WebAssembly for quite some time. I just started a new project that is going to be using WebAssembly. One of the requirements I have is to be able to use sockets. I know the support for sockets is not yet there so I thought I could help with that.</p>
<p>This is the initial WASI additions, this only covers connect for the moment. I just wanted to get a feeling as to if this is the right direction or not before I continue and do the implementation on wasi-common.</p>
<p>typenames.witx</p>
<div class="codehilite"><pre><span></span><code>;;; Socket type
(typename $socktype
  (enum
    ;;; The file descriptor or file refers to a datagram socket.
    $socket_dgram
    ;;; The file descriptor or file refers to a byte-stream socket.
    $socket_stream
  )
)

;;; IP port number
(typename $ipport u16)

;;; An IPv4 address is a 32-bit number that uniquely identifies a network interface on a machine.
(typename $ipaddr4
  (struct
    (field $n0 u8)
    (field $n1 u8)
    (field $h0 u8)
    (field $h1 u8)
  )
)
(typename $ipaddr4_array (array $ipaddr4))

;;; An IPv6 address is a 128-bit number that uniquely identifies a network interface on a machine.
(typename $ipaddr6
  (struct
    (field $n0 u16)
    (field $n1 u16)
    (field $n2 u16)
    (field $n3 u16)
    (field $h0 u16)
    (field $h1 u16)
    (field $h2 u16)
    (field $h3 u16)
  )
)
(typename $ipaddr6_array (array $ipaddr6))
</code></pre></div>


<p>wasi_snapshot_preview1.witx</p>
<div class="codehilite"><pre><span></span><code>;;; Resolves a hostname to one or more IPv4 addresses
  ;;; Note: This is similar to `getaddrinfo` in POSIX
  (@interface func (export &quot;addr_resolve_ip4&quot;)
    ;;; Host to resolve
    (param $host string)
    (result $ipaddr4 $ipaddr4_array)
    (result $error $errno)
  )

  ;;; Resolves a hostname to one or more IPv6 addresses
  ;;; Note: This is similar to `getaddrinfo` in POSIX
  (@interface func (export &quot;addr_resolve_ip6&quot;)
    ;;; Host to resolve
    (param $host string)
    (result $ipaddr6 $ipaddr6_array)
    (result $error $errno)
  )

  ;;; Open a local socket
  ;;; Note: This is similar to `socket` in POSIX using PF_UNIX
  (@interface func (export &quot;sock_open&quot;)
    ;;; Socket type, either datagram or stream
    (param $type $socktype)
    ;;; The opened socket
    (result $fd $fd)
    (result $error $errno)
  )

  ;;; Open a IPv4 socket
  ;;; Note: This is similar to `socket` in POSIX using PF_INET
  (@interface func (export &quot;sock_open_ip4&quot;)
    ;;; Socket type, either datagram or stream
    (param $type $socktype)
    ;;; The opened socket
    (result $fd $fd)
    (result $error $errno)
  )

  ;;; Open a IPv4 socket
  ;;; Note: This is similar to `socket` in POSIX using PF_INET6
  (@interface func (export &quot;sock_open_ip6&quot;)
    ;;; Socket type, either datagram or stream
    (param $type $socktype)
    ;;; The opened socket
    (result $fd $fd)
    (result $error $errno)
  )

  ;;; Initiate a connection on a local socket
  ;;; Note: This is similar to `connect` in POSIX, though rather than receiving a sockaddr
  ;;; we splitted it into separate functions with different arguments.
  (@interface func (export &quot;sock_connect&quot;)
    ;;; Socket descriptor
    (param $fd $fd)
    ;;; Address of the local socket (ex &#39;/dev/tmp&#39;)
    (param $addr string)
    (result $error $errno)
  )

  ;;; Initiate a connection on a network socket using IPv4
  ;;; Note: This is similar to `connect` in POSIX when the sockaddr uses AF_INET
  (@interface func (export &quot;sock_connect_ip4&quot;)
    ;;; Socket descriptor
    (param $fd $fd)
    ;;; Address of the network socket
    (param $addr $ip4)
    ;;; Port number to connect to
    (param $port $ipport)
    (result $error $errno)
  )

  ;;; Initiate a connection on a network socket using IPv4
  ;;; Note: This is similar to `connect` in POSIX when the sockaddr uses AF_INET6
  (@interface func (export &quot;sock_connect_ip6&quot;)
    ;;; Socket descriptor
    (param $fd $fd)
    ;;; Address of the network socket
    (param $addr $ip6)
    ;;; Port number to connect to
    (param $port $ipport)
    (result $error $errno)
  )
</code></pre></div>


<p>I tried to keep the spirit of other parts of WASI such as file functions, not sure that I got it right.</p>



<a name="198627349"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/198627349" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Emiliano Lesende <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#198627349">(May 25 2020 at 01:34)</a>:</h4>
<p>I just realized that wiggle doesn't support array result elements. So I copy the approach taken for fd_readdir. </p>
<p>Here is the revised witx.</p>
<div class="codehilite"><pre><span></span><code>  ;;; Resolves a hostname to one or more IPv4 addresses.
  ;;; Note: This is similar to `getaddrinfo` in POSIX
  ;;;
  ;;; When successful, the contents of the output buffer consist of a sequence of
  ;;; IPv4 addresses. Each address entry consists of a ipaddr4_t object.
  ;;
  ;;; This function fills the output buffer as much as possible, potentially
  ;;; truncating the last address entry. It is advisable that the buffer is
  ;;; always multiple of ipaddr4_t size.
  (@interface func (export &quot;addr_resolve_ip4&quot;)
    ;;; Host to resolve
    (param $host string)
    ;;; The buffer where IP address are stored
    (param $buf (@witx pointer u8))
    (param $buf_len $size)
    (result $error $errno)
    ;;; The number of bytes stored in the buffer. If less than the size of the buffer, no more IP addresses are available.
    (result $bufused $size)
  )

  ;;; Resolves a hostname to one or more IPv6 addresses.
  ;;; Note: This is similar to `getaddrinfo` in POSIX
  ;;;
  ;;; When successful, the contents of the output buffer consist of a sequence of
  ;;; IPv4 addresses. Each address entry consists of a ipaddr6_t object.
  ;;
  ;;; This function fills the output buffer as much as possible, potentially
  ;;; truncating the last address entry. It is advisable that the buffer is
  ;;; always multiple of ipaddr5_t size.
  (@interface func (export &quot;addr_resolve_ip6&quot;)
    ;;; Host to resolve
    (param $host string)
    ;;; The buffer where IP address are stored
    (param $buf (@witx pointer u8))
    (param $buf_len $size)
    (result $error $errno)
    ;;; The number of bytes stored in the buffer. If less than the size of the buffer, no more IP addresses are available.
    (result $bufused $size)
  )

  ;;; Open a local socket
  ;;; Note: This is similar to `socket` in POSIX using PF_UNIX
  (@interface func (export &quot;sock_open&quot;)
    ;;; Socket type, either datagram or stream
    (param $type $socktype)
    ;;; The opened socket
    (result $fd $fd)
    (result $error $errno)
  )

  ;;; Open a IPv4 socket
  ;;; Note: This is similar to `socket` in POSIX using PF_INET
  (@interface func (export &quot;sock_open_ip4&quot;)
    ;;; Socket type, either datagram or stream
    (param $type $socktype)
    ;;; The opened socket
    (result $fd $fd)
    (result $error $errno)
  )

  ;;; Open a IPv4 socket
  ;;; Note: This is similar to `socket` in POSIX using PF_INET6
  (@interface func (export &quot;sock_open_ip6&quot;)
    ;;; Socket type, either datagram or stream
    (param $type $socktype)
    ;;; The opened socket
    (result $fd $fd)
    (result $error $errno)
  )

  ;;; Initiate a connection on a local socket
  ;;; Note: This is similar to `connect` in POSIX, though rather than receiving a sockaddr
  ;;; we splitted it into separate functions with different arguments.
  (@interface func (export &quot;sock_connect&quot;)
    ;;; Socket descriptor
    (param $fd $fd)
    ;;; Address of the local socket (ex &#39;/dev/tmp&#39;)
    (param $addr string)
    (result $error $errno)
  )

  ;;; Initiate a connection on a network socket using IPv4
  ;;; Note: This is similar to `connect` in POSIX when the sockaddr uses AF_INET
  (@interface func (export &quot;sock_connect_ip4&quot;)
    ;;; Socket descriptor
    (param $fd $fd)
    ;;; Address of the network socket
    (param $addr $ipaddr4)
    ;;; Port number to connect to
    (param $port $ipport)
    (result $error $errno)
  )

  ;;; Initiate a connection on a network socket using IPv4
  ;;; Note: This is similar to `connect` in POSIX when the sockaddr uses AF_INET6
  (@interface func (export &quot;sock_connect_ip6&quot;)
    ;;; Socket descriptor
    (param $fd $fd)
    ;;; Address of the network socket
    (param $addr $ipaddr6)
    ;;; Port number to connect to
    (param $port $ipport)
    (result $error $errno)
  )
</code></pre></div>



<a name="198627401"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/198627401" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Emiliano Lesende <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#198627401">(May 25 2020 at 01:36)</a>:</h4>
<p>I would like to also add timeout for <code>connect</code> somehow, altho I am not sure as what would be the best approach for that except to make it always mandatory to provide a timeout. I guess the most natural approach would be to add a u16 there with zero being wait forever. Another note, still missing setsockopt equivalent too.</p>



<a name="198627574"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/198627574" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#198627574">(May 25 2020 at 01:42)</a>:</h4>
<p>Hi! This is cool! I don't have a lot of time today or tomorrow to dig into this, but I wanted to quickly pop in here and say this is something we're interested in, and to feel free to ask questions and post ideas like this</p>



<a name="198627644"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/198627644" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#198627644">(May 25 2020 at 01:44)</a>:</h4>
<p>at a quick glance, one idea: instead of having separate _ip4, _ip6, etc. variants of the functions, another option is to define <code>union</code> type with fields for each address type, so that applications wanting to support multiple address families don't need to have as many code paths</p>



<a name="198627699"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/198627699" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Emiliano Lesende <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#198627699">(May 25 2020 at 01:46)</a>:</h4>
<p>Yeah, I wasn't sure about splitting them up which is why I ask for feedback. I definitely didn't want to bring addrinfo, sockaddr, etc complexity. Didn't knew we had unions. I'll look into it.</p>



<a name="198627703"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/198627703" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#198627703">(May 25 2020 at 01:46)</a>:</h4>
<p>Also as a heads up, I'll want to talk about how to fit this into WASI's capability-based security model, and I'll be happy to help figure that out when we're ready.</p>



<a name="198627749"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/198627749" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#198627749">(May 25 2020 at 01:48)</a>:</h4>
<p>I have to head out now, but feel free to ask questions here, and I or others will answer them when we can!</p>



<a name="198628375"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/198628375" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Emiliano Lesende <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#198628375">(May 25 2020 at 02:10)</a>:</h4>
<p><span class="user-mention" data-user-id="254083">@Dan Gohman</span> Thank you. I'll be happy to chat some more. Of course we need security features. My current line of thought is a basic feature gate, either you can connect or can't. After which we need some sort of whitelisting "what" you can connect to.  That one is more trickier. I mean is easy to whitelist and bunch of IP addresses, or even ranges but the problem lies on host address resolution, how can we avoid DNS spoofing I am not sure.</p>



<a name="198671079"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/198671079" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Emiliano Lesende <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#198671079">(May 25 2020 at 13:53)</a>:</h4>
<p>Ok. I've been working on this some more. Here is the revised WITX.</p>
<p>typenames.witx</p>
<div class="codehilite"><pre><span></span><code>;;; Socket type
(typename $sock_type
  (enum u8
    ;;; The file descriptor or file refers to a datagram socket.
    $socket_dgram
    ;;; The file descriptor or file refers to a byte-stream socket.
    $socket_stream
  )
)

;;; IP port number
(typename $ip_port u16)

;;; Address type
(typename $addr_type
  (enum u8
    ;;; Unix local address
    $local
    ;;; IPv4 address
    $ip4
    ;;; IPv6 address
    $ip6
  )
)

;;; A local socket address such as /dev/sock
(typename $addr_local
  (struct
    ;;; Pointer to the name of the socket
    (field $path (@witx pointer u8))
    ;;; The length of the name of the socket
    (field $path_len $size)
  )
)

;;; An IPv4 address is a 32-bit number that uniquely identifies a network interface on a machine.
(typename $addr_ip4
  (struct
    (field $n0 u8)
    (field $n1 u8)
    (field $h0 u8)
    (field $h1 u8)
  )
)

;;; An IPv6 address is a 128-bit number that uniquely identifies a network interface on a machine.
(typename $addr_ip6
  (struct
    (field $n0 u16)
    (field $n1 u16)
    (field $n2 u16)
    (field $n3 u16)
    (field $h0 u16)
    (field $h1 u16)
    (field $h2 u16)
    (field $h3 u16)
  )
)

;;; Union of all possible addresses type
(typename $addr
  (union $addr_type
    (field $local $addr_local)
    (field $ip4 $addr_ip4)
    (field $ip6 $addr_ip6)
  )
)
</code></pre></div>


<p>wasi_snapshot_preview1.witx</p>
<div class="codehilite"><pre><span></span><code>  ;;; Resolves a hostname to one or more IP addresses.
  ;;; Note: This is similar to `getaddrinfo` in POSIX
  ;;;
  ;;; When successful, the contents of the output buffer consist of a sequence of
  ;;; IPv4 and/or IPv6 addresses. Each address entry consists of a addr_t object.
  ;;
  ;;; This function fills the output buffer as much as possible, potentially
  ;;; truncating the last address entry. It is advisable that the buffer is
  ;;; always multiple of addr_t size.
  (@interface func (export &quot;addr_resolve&quot;)
    ;;; Host to resolve
    (param $host string)
    ;;; The buffer where IP address are stored
    (param $buf (@witx pointer u8))
    (param $buf_len $size)
    (result $error $errno)
    ;;; The number of bytes stored in the buffer. If less than the size of the buffer, no more IP addresses are available.
    (result $bufused $size)
  )
  ;;; Open a socket
  ;;; Note: This is similar to `socket` in POSIX using PF_INET
  (@interface func (export &quot;sock_open&quot;)
    ;;; Address type
    (param $addrtype $addr_type)
    ;;; Socket type, either datagram or stream
    (param $socktype $sock_type)
    (result $error $errno)
    ;;; The opened socket
    (result $fd $fd)
  )

  ;;; Initiate a connection on a socket to the specified address
  ;;; Note: This is similar to `connect` in POSIX
  (@interface func (export &quot;sock_connect&quot;)
    ;;; Socket descriptor
    (param $fd $fd)
    ;;; Address of the local socket (ex &#39;/dev/tmp&#39;)
    (param $addr $addr)
    (result $error $errno)
  )
</code></pre></div>



<a name="198802839"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/198802839" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Emiliano Lesende <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#198802839">(May 26 2020 at 18:35)</a>:</h4>
<p><span class="user-mention" data-user-id="254083">@Dan Gohman</span> Given our discussion about passing unions. You still think that the union is the better choice vs having individual calls per protocol? I am even not sure that we should support local sockets vs just TCP/UDP. I'm intrigued about what others think on that subject.</p>



<a name="198802936"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/198802936" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#198802936">(May 26 2020 at 18:36)</a>:</h4>
<p>I'm curious, what would a just-TCP/UDP API look like?</p>



<a name="198803122"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/198803122" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#198803122">(May 26 2020 at 18:37)</a>:</h4>
<p>Berkeley sockets API is so pervasive, I myself don't know what an alternative would look like.</p>



<a name="198803246"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/198803246" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#198803246">(May 26 2020 at 18:38)</a>:</h4>
<p>If we do go with sockets, then yes, I still think pointer to union (or union, if the witx tooling adds support for it) is the way to go.</p>



<a name="198803309"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/198803309" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Emiliano Lesende <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#198803309">(May 26 2020 at 18:39)</a>:</h4>
<p><span class="user-mention" data-user-id="254083">@Dan Gohman</span> I meant higher level, akin to TcpStream in Rust. I agree with you about Sockets API, and I worry about C/C++ folks targeting WebAssembly that depend on that kind of API.</p>



<a name="198803519"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/198803519" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#198803519">(May 26 2020 at 18:40)</a>:</h4>
<p>Even Rust's <code>TcpStream</code> is just a thin abstraction around Berkeley sockets.</p>



<a name="198803544"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/198803544" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#198803544">(May 26 2020 at 18:41)</a>:</h4>
<p>Eg. <code>SocketAddr</code> is a Rust enum, which is just a more type-safe version of union :-)</p>



<a name="198804245"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/198804245" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Emiliano Lesende <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#198804245">(May 26 2020 at 18:46)</a>:</h4>
<p><span class="user-mention" data-user-id="254083">@Dan Gohman</span> I know it is thanks to trait magic, but you can do <code>TcpStream::connect("rust-lang.org")</code>. That looks high level, in the sense I don't have to go fetch addresses, open the socket, then connect, etc etc. That is what I mean by higher level. I'll keep on the current path don't worry.</p>



<a name="198804417"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/198804417" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#198804417">(May 26 2020 at 18:47)</a>:</h4>
<p>Rust's API may be valuable to look at, because native socket APIs have accumulated a lot of flags and options, and Rust has done a lot of work to figure out which things are important</p>



<a name="198804821"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/198804821" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Emiliano Lesende <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#198804821">(May 26 2020 at 18:50)</a>:</h4>
<p><span class="user-mention" data-user-id="254083">@Dan Gohman</span> Understood. Once I have something decent and tested. What would be my next step? Should I construct a PR? What is the process?</p>



<a name="198804840"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/198804840" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#198804840">(May 26 2020 at 18:50)</a>:</h4>
<p>Ah, I see. I think what we can say there is, even Rust retains the ability to do each of the steps separately if you want to, so we should focus on enabling that, and then we can talk about how to provide convenience functions that combine multiple steps into one</p>



<a name="198804880"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/198804880" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#198804880">(May 26 2020 at 18:51)</a>:</h4>
<p>as a followup</p>



<a name="198804926"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/198804926" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#198804926">(May 26 2020 at 18:51)</a>:</h4>
<p>Yeah, I think a PR would be a good next step</p>



<a name="202196722"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/202196722" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#202196722">(Jun 27 2020 at 17:38)</a>:</h4>
<p>I don't know how well witx supports this yet, but I feel like it would be possible to use an object that "remembers" the type of the socket.</p>



<a name="202196738"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/202196738" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#202196738">(Jun 27 2020 at 17:38)</a>:</h4>
<p>As in, you can't mismatch the socket family and the address you use.</p>



<a name="202196743"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/202196743" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#202196743">(Jun 27 2020 at 17:39)</a>:</h4>
<p>I think that makes more sense than a union.</p>



<a name="202196907"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/202196907" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#202196907">(Jun 27 2020 at 17:43)</a>:</h4>
<p>The C API lets you do things like pass a sockaddr_un to a TCP socket or vice versa. That seems likely to provoke unsafe bugs in implementations, to the point that we will have to make sure callers can't do that via validation before calling the underlying socket library.</p>



<a name="202196920"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/202196920" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#202196920">(Jun 27 2020 at 17:43)</a>:</h4>
<p>And if we have to remember that anyway, let's encode it in the type system.</p>



<a name="202197051"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/202197051" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#202197051">(Jun 27 2020 at 17:46)</a>:</h4>
<p>I can <em>very easily</em> imagine ways that the interface allowing mismatched calls to connect vs socket could bypass capability security.</p>



<a name="202702296"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/202702296" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Emiliano Lesende <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#202702296">(Jul 02 2020 at 15:17)</a>:</h4>
<p><span class="user-mention" data-user-id="254083">@Dan Gohman</span> I finally managed to complete the implementation. I would appreciate if you can give it a quick review before I start assembling the PR.</p>
<p>The repo for the WASI spec changes is here:<br>
<a href="https://github.com/Kong/WASI/tree/feat/wasi-sockets">https://github.com/Kong/WASI/tree/feat/wasi-sockets</a></p>
<p>And the reference implementation for it, is here:<br>
<a href="https://github.com/Kong/wasmtime/tree/feat/wasi-sockets">https://github.com/Kong/wasmtime/tree/feat/wasi-sockets</a></p>
<p><code>sock_open</code> and <code>addr_resolve</code> now receive an address pool as we discussed.</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/Kong/WASI/tree/feat/wasi-sockets" style="background-image: url(https://avatars3.githubusercontent.com/u/962416?s=400&amp;v=4)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/Kong/WASI/tree/feat/wasi-sockets" title="Kong/WASI">Kong/WASI</a></div><div class="message_embed_description">WebAssembly System Interface. Contribute to Kong/WASI development by creating an account on GitHub.</div></div></div><div class="message_embed"><a class="message_embed_image" href="https://github.com/Kong/wasmtime/tree/feat/wasi-sockets" style="background-image: url(https://avatars3.githubusercontent.com/u/962416?s=400&amp;v=4)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/Kong/wasmtime/tree/feat/wasi-sockets" title="Kong/wasmtime">Kong/wasmtime</a></div><div class="message_embed_description">Standalone JIT-style runtime for WebAssembly, using Cranelift - Kong/wasmtime</div></div></div>



<a name="202702410"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/202702410" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#202702410">(Jul 02 2020 at 15:18)</a>:</h4>
<p>Sure. I'm in meeting atm, but I can take a look a little later today</p>



<a name="202824007"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/202824007" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#202824007">(Jul 03 2020 at 17:22)</a>:</h4>
<p>Finally taking a look here; the wasmtime changes look like a good start!</p>



<a name="202824023"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/202824023" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#202824023">(Jul 03 2020 at 17:22)</a>:</h4>
<p>Before submitting a PR, it's worth rebasing on main to avoid the testsuite diffs</p>



<a name="202824363"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/202824363" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Emiliano Lesende <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#202824363">(Jul 03 2020 at 17:27)</a>:</h4>
<p>Yeah, of course. All the changes are on snapshot. Should I move them to ephemeral? Or should I leave them in snapshot? Also, this would need to be split into two PRs. One for WASI spec, and the other for wasmtime.</p>



<a name="202826187"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/202826187" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#202826187">(Jul 03 2020 at 17:54)</a>:</h4>
<p>Yeah, the WASI changes should be in ephemeral</p>



<a name="203026080"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/203026080" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Emiliano Lesende <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#203026080">(Jul 06 2020 at 18:45)</a>:</h4>
<p><span class="user-mention" data-user-id="254083">@Dan Gohman</span> So, the procedure would be:</p>
<ol>
<li>Send PR for WASI spec into ephemeral</li>
<li>Wait for merge, and then wait for snapshot</li>
<li>Wait for release of WASI binding for Rust</li>
<li>Send PR for wasi-common and test-programs<br>
Correct?</li>
</ol>



<a name="203218496"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/203218496" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#203218496">(Jul 08 2020 at 00:10)</a>:</h4>
<p><span class="user-mention" data-user-id="305220">@Emiliano Lesende</span> Yes</p>



<a name="203218529"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/203218529" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#203218529">(Jul 08 2020 at 00:11)</a>:</h4>
<p>One thing to be aware of is that ephemeral is currently blocked on some big modularization changes, so the timeline for the next snapshot is unclear.</p>



<a name="203218621"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/203218621" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#203218621">(Jul 08 2020 at 00:13)</a>:</h4>
<p>However, I think we can go ahead and put experimental APIs in wasi-common without waiting for a snapshot. We can use different names for now, to avoid conflicts if there are changes during the standardization process.</p>



<a name="203218644"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/203218644" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#203218644">(Jul 08 2020 at 00:13)</a>:</h4>
<p>I think we can put experimental APIs in the WASI bindings too, again without waiting for a snapshot. Possibly by putting them behind a feature flag.</p>



<a name="203627467"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/203627467" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#203627467">(Jul 12 2020 at 04:34)</a>:</h4>
<p><span class="user-mention" data-user-id="305220">@Emiliano Lesende</span> What is the "address pool" fd? I don't think I understand that.</p>



<a name="204449542"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/204449542" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Emiliano Lesende <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#204449542">(Jul 20 2020 at 17:16)</a>:</h4>
<p><span class="user-mention" data-user-id="254178">@Josh Triplett</span> The address pool fd is a pool of IP addresses and ports. You need to configure that at WASI for you to be able to use the socket calls. When you create the WASI ctx you can pass in address pools which the program can then use to issue socket calls. Is a way to have some security control to know who you can connect to/listen to, without overblowing the whole system into a fully featured firewall.</p>



<a name="204449575"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/204449575" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#204449575">(Jul 20 2020 at 17:16)</a>:</h4>
<p>Ah, that makes sense.</p>



<a name="204449701"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/204449701" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Emiliano Lesende <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#204449701">(Jul 20 2020 at 17:17)</a>:</h4>
<p><span class="user-mention" data-user-id="254083">@Dan Gohman</span> Ok. I'll see if I can make the change this week.</p>



<a name="204449848"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/204449848" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#204449848">(Jul 20 2020 at 17:18)</a>:</h4>
<p>Following up on a question from earlier in this thread, what happens if you attempt to pass a mismatched address family and address?</p>



<a name="204449985"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/204449985" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#204449985">(Jul 20 2020 at 17:19)</a>:</h4>
<p>(deleted)</p>



<a name="204450230"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/204450230" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Emiliano Lesende <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#204450230">(Jul 20 2020 at 17:21)</a>:</h4>
<p>Mismatched as in? What you mean?</p>



<a name="204450435"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/204450435" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#204450435">(Jul 20 2020 at 17:23)</a>:</h4>
<p>Wrong branch of the union.</p>



<a name="204450568"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/204450568" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#204450568">(Jul 20 2020 at 17:24)</a>:</h4>
<p>What happens if you pass an IPv6 address and a UNIX socket family, or vice versa?</p>



<a name="204450697"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/204450697" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#204450697">(Jul 20 2020 at 17:25)</a>:</h4>
<p>With the interface posted much earlier in this thread, it seems like that would not get caught, and would get as far as the underlying library/system call.</p>



<a name="204450933"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/204450933" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Emiliano Lesende <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#204450933">(Jul 20 2020 at 17:27)</a>:</h4>
<p>At the moment there is no UNIX socket support, but having said that if you pass an IPv6 pool and you try to use an IPv4 address you will get a not capable response.</p>



<a name="204451017"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/204451017" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Emiliano Lesende <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#204451017">(Jul 20 2020 at 17:28)</a>:</h4>
<p>Is that what you where asking about?</p>



<a name="204451253"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/204451253" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Emiliano Lesende <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#204451253">(Jul 20 2020 at 17:31)</a>:</h4>
<p>Or you mean if I sock_open to an IPv6 address family and then sock_connect to an IPv4? In that case we will pass is along to the OS which in turn it will return you a EAFNOSUPPORT.</p>



<a name="204451428"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/204451428" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#204451428">(Jul 20 2020 at 17:32)</a>:</h4>
<p>That's one possibility, and probably a more innocuous one.</p>



<a name="204451508"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/204451508" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#204451508">(Jul 20 2020 at 17:33)</a>:</h4>
<p>I'm thinking of things like trying to create a UNIX socket but passing an IPv4 or IPv6 address.</p>



<a name="204451720"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/204451720" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#204451720">(Jul 20 2020 at 17:35)</a>:</h4>
<p>A Unix socket address is a string-like buffer with some really strange semantics.</p>



<a name="204451859"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/204451859" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#204451859">(Jul 20 2020 at 17:36)</a>:</h4>
<p>We likely need to do some extra validation there, but if someone can just pass an IPv6 address and have the octets interpreted as the bytes of a UNIX socket address...</p>



<a name="204452037"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/204452037" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#204452037">(Jul 20 2020 at 17:38)</a>:</h4>
<p>I had been wondering if we could enforce a match between the address family used at <code>sock_open</code> and the address passed to things like connect or bind.</p>



<a name="204452139"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/204452139" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#204452139">(Jul 20 2020 at 17:39)</a>:</h4>
<p>So that it never gets to the OS call if you try to play games like that, which means a much smaller attack surface.</p>



<a name="204452420"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/204452420" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Emiliano Lesende <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#204452420">(Jul 20 2020 at 17:41)</a>:</h4>
<p>Oh, not sure that can happen thou. Unions at WASI are tagged, which means that sock_connect knows what that address is for and when it converts it to <code>sockaddr</code> it will set the correct address family. Yeah granted, it will set the correct address family at the <code>sockaddr</code> struct level but not at the <code>sock_open</code>.</p>



<a name="204452545"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/204452545" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#204452545">(Jul 20 2020 at 17:42)</a>:</h4>
<p>I missed that it was using a tagged union. I thought WITX had both tagged and untagged.</p>



<a name="204452625"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/204452625" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#204452625">(Jul 20 2020 at 17:43)</a>:</h4>
<p>But yes, I also mean a mismatch between open and later calls like connect.</p>



<a name="204452649"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/204452649" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Emiliano Lesende <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#204452649">(Jul 20 2020 at 17:43)</a>:</h4>
<p>I don't particularly like the Berkeley socket interface either, and we could delay opening the socket until we know the address family. The reason I didn't go this route is because I was worried what it could mean when we try to implement the C calls in WASI.</p>



<a name="204452747"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/204452747" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#204452747">(Jul 20 2020 at 17:44)</a>:</h4>
<p>I could easily imagine an OS socket implementation ignoring the mismatch between the two calls and just interpreting the buffer passed into the later call using the address family from the open call.</p>



<a name="204452846"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/204452846" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#204452846">(Jul 20 2020 at 17:45)</a>:</h4>
<p>No, I don't think that we should delay opening the socket.</p>



<a name="204452868"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/204452868" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#204452868">(Jul 20 2020 at 17:45)</a>:</h4>
<p>I'm more wondering if we can remember the address family that was given when opening the socket, and enforce a match ourselves, rather than relying on the operating system to do so.</p>



<a name="204452873"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/204452873" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Emiliano Lesende <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#204452873">(Jul 20 2020 at 17:45)</a>:</h4>
<p>I see. Good point. We could add that extra check, is there an OS API call to retrieve the AF? if not we could store it ourselves in the handle.</p>



<a name="204452917"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/204452917" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#204452917">(Jul 20 2020 at 17:46)</a>:</h4>
<p>I think we should store it ourselves, perhaps by using different types of handle.</p>



<a name="204452971"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/204452971" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Emiliano Lesende <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#204452971">(Jul 20 2020 at 17:46)</a>:</h4>
<p>Agreed.</p>



<a name="204452988"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/204452988" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#204452988">(Jul 20 2020 at 17:46)</a>:</h4>
<p>That would avoid making an extra OS call. We don't want to slow down the common case of programs behaving correctly.</p>



<a name="204453016"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/204453016" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Emiliano Lesende <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#204453016">(Jul 20 2020 at 17:47)</a>:</h4>
<p>Makes sense</p>



<a name="204453061"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/204453061" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#204453061">(Jul 20 2020 at 17:47)</a>:</h4>
<p>Thank you. I appreciate you hearing out the concern. :)</p>



<a name="204453088"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/204453088" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Emiliano Lesende <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#204453088">(Jul 20 2020 at 17:47)</a>:</h4>
<p>Of course. Always.</p>



<a name="204453221"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/204453221" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#204453221">(Jul 20 2020 at 17:48)</a>:</h4>
<p>Because the Berkeley sockets interface is so very C-oriented, and the sockaddr structure in particular is one of the most horrible things that people need to deal with on a regular basis in common programs, I didn't want to just trust the underlying OS to do the right thing for security.</p>



<a name="204453476"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/204453476" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#204453476">(Jul 20 2020 at 17:51)</a>:</h4>
<p>I would be happy to review the updated patch series as soon as you have it available. Send me a link?</p>



<a name="204453944"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/204453944" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Emiliano Lesende <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#204453944">(Jul 20 2020 at 17:55)</a>:</h4>
<p>You can find the link the repos above. I'll repost it here.</p>



<a name="204453968"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/204453968" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Emiliano Lesende <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#204453968">(Jul 20 2020 at 17:55)</a>:</h4>
<p>The repo for the WASI spec changes is here:<br>
<a href="https://github.com/Kong/WASI/tree/feat/wasi-sockets">https://github.com/Kong/WASI/tree/feat/wasi-sockets</a></p>
<p>And the reference implementation for it, is here:<br>
<a href="https://github.com/Kong/wasmtime/tree/feat/wasi-sockets">https://github.com/Kong/wasmtime/tree/feat/wasi-sockets</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/Kong/WASI/tree/feat/wasi-sockets" style="background-image: url(https://avatars3.githubusercontent.com/u/962416?s=400&amp;v=4)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/Kong/WASI/tree/feat/wasi-sockets" title="Kong/WASI">Kong/WASI</a></div><div class="message_embed_description">WebAssembly System Interface. Contribute to Kong/WASI development by creating an account on GitHub.</div></div></div><div class="message_embed"><a class="message_embed_image" href="https://github.com/Kong/wasmtime/tree/feat/wasi-sockets" style="background-image: url(https://avatars3.githubusercontent.com/u/962416?s=400&amp;v=4)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/Kong/wasmtime/tree/feat/wasi-sockets" title="Kong/wasmtime">Kong/wasmtime</a></div><div class="message_embed_description">Standalone JIT-style runtime for WebAssembly, using Cranelift - Kong/wasmtime</div></div></div>



<a name="204457876"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/204457876" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#204457876">(Jul 20 2020 at 18:27)</a>:</h4>
<p>I meant a link when you have a new patch that enforces the match, and I'd be happy to review that. :)</p>



<a name="204457881"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/204457881" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#204457881">(Jul 20 2020 at 18:27)</a>:</h4>
<p>I already read the patches so far.</p>



<a name="204458090"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/204458090" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Emiliano Lesende <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#204458090">(Jul 20 2020 at 18:29)</a>:</h4>
<p>Oh sure.</p>



<a name="206058891"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/206058891" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Emiliano Lesende <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#206058891">(Aug 05 2020 at 18:16)</a>:</h4>
<p><span class="user-mention" data-user-id="254083">@Dan Gohman</span> <span class="user-mention" data-user-id="254178">@Josh Triplett</span> I noticed that there is a main branch now, should I switch to main for rebasing or keep it on master?</p>



<a name="206058968"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/206058968" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#206058968">(Aug 05 2020 at 18:17)</a>:</h4>
<p>for all Bytecode Alliance repos use <code>main</code></p>



<a name="206058991"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/206058991" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Emiliano Lesende <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#206058991">(Aug 05 2020 at 18:17)</a>:</h4>
<p>ok</p>



<a name="206063111"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/206063111" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Emiliano Lesende <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#206063111">(Aug 05 2020 at 18:50)</a>:</h4>
<p><span class="user-mention" data-user-id="254083">@Dan Gohman</span> it looks that main points to 0.11.0 of wasi, but the most recent published version of it is still 0.10.0+wasi-snapshot-preview1</p>



<a name="206071653"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/206071653" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#206071653">(Aug 05 2020 at 20:05)</a>:</h4>
<p>Ah, it looks like we should publish a new version then</p>



<a name="206283424"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/206283424" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Emiliano Lesende <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#206283424">(Aug 07 2020 at 17:10)</a>:</h4>
<p><span class="user-mention" data-user-id="254178">@Josh Triplett</span> the changes you requested are in :)</p>



<a name="206291903"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/206291903" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#206291903">(Aug 07 2020 at 18:18)</a>:</h4>
<p><span class="user-mention" data-user-id="305220">@Emiliano Lesende</span> Awesome, thanks!</p>



<a name="207285306"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/207285306" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Emiliano Lesende <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#207285306">(Aug 18 2020 at 16:58)</a>:</h4>
<p><span class="user-mention" data-user-id="254178">@Josh Triplett</span> <span class="user-mention" data-user-id="254083">@Dan Gohman</span> The PR for the socket API is in. I cannot send the PR for the implementation yet. I tried to put it behind a feature flag, but there is some work which is complicated as I cannot put feature flags inside match expressions in Rust. I cannot wall everything up properly. Any idea how long it will take to make the sock API into snapshot?</p>



<a name="207285327"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/207285327" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Emiliano Lesende <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#207285327">(Aug 18 2020 at 16:58)</a>:</h4>
<p><a href="https://github.com/WebAssembly/WASI/pull/312">https://github.com/WebAssembly/WASI/pull/312</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/WebAssembly/WASI/pull/312" style="background-image: url(https://avatars3.githubusercontent.com/u/11578470?s=400&amp;v=4)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/WebAssembly/WASI/pull/312" title="feat(socket): berkeley socket API by 3miliano · Pull Request #312 · WebAssembly/WASI">feat(socket): berkeley socket API by 3miliano · Pull Request #312 · WebAssembly/WASI</a></div><div class="message_embed_description">This PR adds new functions for socket operations such as sock_listen, sock_bind, sock_connect, etc. It also includes a new addr_resolve function for performing DNS resolution. The PR introduces a n...</div></div></div>



<a name="207291277"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/207291277" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Till Schneidereit <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#207291277">(Aug 18 2020 at 17:45)</a>:</h4>
<p>That sounds like great progress! \o/</p>
<p>Would it make sense to open a PR for the implementation in its current state and then have people weigh in on how best to do the feature flag?</p>



<a name="207300316"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/207300316" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Emiliano Lesende <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#207300316">(Aug 18 2020 at 18:58)</a>:</h4>
<p><span class="user-mention" data-user-id="234973">@Till Schneidereit</span> I could do that. I guess you can also take a look here: <a href="https://github.com/Kong/wasmtime/tree/feat/wasi-sockets">https://github.com/Kong/wasmtime/tree/feat/wasi-sockets</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/Kong/wasmtime/tree/feat/wasi-sockets" style="background-image: url(https://avatars3.githubusercontent.com/u/962416?s=400&amp;v=4)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/Kong/wasmtime/tree/feat/wasi-sockets" title="Kong/wasmtime">Kong/wasmtime</a></div><div class="message_embed_description">Standalone JIT-style runtime for WebAssembly, using Cranelift - Kong/wasmtime</div></div></div>



<a name="207300568"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/socket%20connect%20WITX%20proposal/near/207300568" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Emiliano Lesende <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/socket.20connect.20WITX.20proposal.html#207300568">(Aug 18 2020 at 19:00)</a>:</h4>
<p>My issue right now, is on this match:<br>
<a href="https://github.com/Kong/wasmtime/blob/feat/wasi-sockets/crates/wasi-common/src/sys/unix/mod.rs#L117">https://github.com/Kong/wasmtime/blob/feat/wasi-sockets/crates/wasi-common/src/sys/unix/mod.rs#L117</a><br>
I need to gate that case expression since AddressPool ain't available yet until ephemeral gets merged.</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/Kong/wasmtime/blob/feat/wasi-sockets/crates/wasi-common/src/sys/unix/mod.rs#L117" style="background-image: url(https://avatars3.githubusercontent.com/u/962416?s=400&amp;v=4)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/Kong/wasmtime/blob/feat/wasi-sockets/crates/wasi-common/src/sys/unix/mod.rs#L117" title="Kong/wasmtime">Kong/wasmtime</a></div><div class="message_embed_description">Standalone JIT-style runtime for WebAssembly, using Cranelift - Kong/wasmtime</div></div></div>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>