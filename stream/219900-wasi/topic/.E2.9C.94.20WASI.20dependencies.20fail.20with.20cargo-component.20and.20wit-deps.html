<html>
<head><meta charset="utf-8"><title>✔ WASI dependencies fail with cargo-component and wit-deps · wasi · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/index.html">wasi</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/.E2.9C.94.20WASI.20dependencies.20fail.20with.20cargo-component.20and.20wit-deps.html">✔ WASI dependencies fail with cargo-component and wit-deps</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="377395948"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/%E2%9C%94%20WASI%20dependencies%20fail%20with%20cargo-component%20and%20wit-deps/near/377395948" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eduardo Rodrigues <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/.E2.9C.94.20WASI.20dependencies.20fail.20with.20cargo-component.20and.20wit-deps.html#377395948">(Jul 21 2023 at 18:38)</a>:</h4>
<p>The code <a href="https://github.com/eduardomourar/wasm-web-shell/tree/wasm-component">here</a> works with wasm-tools directly with wit-deps. When trying to use cargo-component, I am getting the following error:</p>
<blockquote>
<p>error: failed to merge local target <code>/wasm-web-shell/packages/wasi-cli/wit</code><br>
Caused by:<br>
  package not found</p>
</blockquote>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/eduardomourar/wasm-web-shell/tree/wasm-component" style="background-image: url(https\:\/\/uploads\.zulipusercontent\.net\/cf67a65b8499feca4ab7172934d8dce34c0d65ab\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f373039306331323636376562646335336430393932623062666638306361303633653534663438346536333763393939313334343033313532646639373837342f6564756172646f6d6f757261722f7761736d2d7765622d7368656c6c)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/eduardomourar/wasm-web-shell/tree/wasm-component" title="GitHub - eduardomourar/wasm-web-shell at wasm-component">GitHub - eduardomourar/wasm-web-shell at wasm-component</a></div><div class="message_embed_description">Contribute to eduardomourar/wasm-web-shell development by creating an account on GitHub.</div></div></div>



<a name="377396746"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/%E2%9C%94%20WASI%20dependencies%20fail%20with%20cargo-component%20and%20wit-deps/near/377396746" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eduardo Rodrigues <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/.E2.9C.94.20WASI.20dependencies.20fail.20with.20cargo-component.20and.20wit-deps.html#377396746">(Jul 21 2023 at 18:41)</a>:</h4>
<p>I would appreciate any pointer on how to have a reference to any of WASI's definition locally in cargo-component. Even better if there is a public registry with those definitions compatible with wasmtime v10.</p>



<a name="377590360"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/%E2%9C%94%20WASI%20dependencies%20fail%20with%20cargo-component%20and%20wit-deps/near/377590360" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eduardo Rodrigues <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/.E2.9C.94.20WASI.20dependencies.20fail.20with.20cargo-component.20and.20wit-deps.html#377590360">(Jul 22 2023 at 12:54)</a>:</h4>
<p>It was a typo in the Cargo.toml file: <code>[package.metadata.component.target.dependencies]</code></p>



<a name="377590383"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/%E2%9C%94%20WASI%20dependencies%20fail%20with%20cargo-component%20and%20wit-deps/near/377590383" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/.E2.9C.94.20WASI.20dependencies.20fail.20with.20cargo-component.20and.20wit-deps.html#377590383">(Jul 22 2023 at 12:54)</a>:</h4>
<p><span class="user-mention silent" data-user-id="506572">Eduardo Rodrigues</span> has marked this topic as resolved.</p>



<a name="409236036"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/%E2%9C%94%20WASI%20dependencies%20fail%20with%20cargo-component%20and%20wit-deps/near/409236036" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> DougAnderson444 | PeerPiper.io <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/.E2.9C.94.20WASI.20dependencies.20fail.20with.20cargo-component.20and.20wit-deps.html#409236036">(Dec 20 2023 at 17:58)</a>:</h4>
<p>Is this <code>wit/deps/...</code> naming hardwired into <code>wasmtime</code> somewhere?</p>
<p>Because when I tried to use a relative directory for my wit package elsewhere on my system, <code>wasmtime</code> didn't react well to it:</p>
<div class="codehilite" data-code-language="TOML"><pre><span></span><code><span class="k">[package.metadata.component.target.dependencies]</span>
<span class="s2">"seed-keeper:wallet"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">"../../crates/seed-keeper-wit/wit"</span><span class="w"> </span><span class="p">}</span>
</code></pre></div>
<p>Although I am able to <code>cargo component build</code> with the above config, when I try to use the component from a Rust host it breaks with error log:</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>error:<span class="w"> </span>failed<span class="w"> </span>to<span class="w"> </span>find<span class="w"> </span>package<span class="w"> </span><span class="sb">`</span>seed-keeper:wallet@0.1.0<span class="sb">`</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="sb">`</span>deps<span class="sb">`</span><span class="w"> </span>directory
<span class="w">            </span>--&gt;<span class="w"> </span>/home/doug/code/rust/seed-keeper/examples/edwards-wit/wit/world.wit:11:12
<span class="w">             </span><span class="p">|</span>
<span class="w">          </span><span class="m">11</span><span class="w"> </span><span class="p">|</span><span class="w">     </span>import<span class="w"> </span>seed-keeper:wallet/seed-getter@0.1.0<span class="p">;</span>
<span class="w">             </span><span class="p">|</span><span class="w">            </span>^-----------------
</code></pre></div>
<p>I spotted the "deps directory"<br>
<strong>SO</strong> I copied-and-pasted the <code>.wit</code> to <code>wit/deps/seed-keeper/wallet.wit</code>, it  worked, even with no config</p>
<div class="codehilite" data-code-language="TOML"><pre><span></span><code><span class="k">[package.metadata.component.target.dependencies]</span>
<span class="c1"># removed</span>
</code></pre></div>
<p>That's cool, but involves copy-pasta. I'm expecting to be able to import relative wits, based on the docs here:</p>
<p><a href="https://component-model.bytecodealliance.org/language-support/rust.html#importing-an-interface-into-a-command-component">https://component-model.bytecodealliance.org/language-support/rust.html#importing-an-interface-into-a-command-component</a></p>
<p>Not exactly sure where to raise this issue (or maybe I'm expecting behaviour that I shouldn't be)?</p>
<p>Insights are most welcome!</p>



<a name="409236418"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/%E2%9C%94%20WASI%20dependencies%20fail%20with%20cargo-component%20and%20wit-deps/near/409236418" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/.E2.9C.94.20WASI.20dependencies.20fail.20with.20cargo-component.20and.20wit-deps.html#409236418">(Dec 20 2023 at 18:01)</a>:</h4>
<p>Wasmtime itself isn't really WIT-aware, but the <code>wit-parser</code> library that <code>cargo-component</code> uses <em>does</em> hard-code <code>"deps"</code></p>



<a name="409237086"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/%E2%9C%94%20WASI%20dependencies%20fail%20with%20cargo-component%20and%20wit-deps/near/409237086" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/.E2.9C.94.20WASI.20dependencies.20fail.20with.20cargo-component.20and.20wit-deps.html#409237086">(Dec 20 2023 at 18:04)</a>:</h4>
<p>Ohh you are using <code>wasmtime::component::bindgen</code>, which does depend on <code>wit-parser</code> as well.</p>



<a name="409237137"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/%E2%9C%94%20WASI%20dependencies%20fail%20with%20cargo-component%20and%20wit-deps/near/409237137" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/.E2.9C.94.20WASI.20dependencies.20fail.20with.20cargo-component.20and.20wit-deps.html#409237137">(Dec 20 2023 at 18:05)</a>:</h4>
<p>I was thinking of the wasmtime <em>runtime</em>, which doesn't know anything about WIT.</p>



<a name="409237217"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/%E2%9C%94%20WASI%20dependencies%20fail%20with%20cargo-component%20and%20wit-deps/near/409237217" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> DougAnderson444 | PeerPiper.io <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/.E2.9C.94.20WASI.20dependencies.20fail.20with.20cargo-component.20and.20wit-deps.html#409237217">(Dec 20 2023 at 18:05)</a>:</h4>
<p>Yes, correct using  <code>wasmtime::component::bindgen!</code></p>



<a name="409237255"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/%E2%9C%94%20WASI%20dependencies%20fail%20with%20cargo-component%20and%20wit-deps/near/409237255" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/.E2.9C.94.20WASI.20dependencies.20fail.20with.20cargo-component.20and.20wit-deps.html#409237255">(Dec 20 2023 at 18:05)</a>:</h4>
<p>I imagine it is the host build that is breaking then, not the component.</p>



<a name="409237360"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/%E2%9C%94%20WASI%20dependencies%20fail%20with%20cargo-component%20and%20wit-deps/near/409237360" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> DougAnderson444 | PeerPiper.io <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/.E2.9C.94.20WASI.20dependencies.20fail.20with.20cargo-component.20and.20wit-deps.html#409237360">(Dec 20 2023 at 18:06)</a>:</h4>
<p>Yes that sounds right. I can <code>cargo component build</code> just fine. But running breaks</p>



<a name="409237442"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/%E2%9C%94%20WASI%20dependencies%20fail%20with%20cargo-component%20and%20wit-deps/near/409237442" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> DougAnderson444 | PeerPiper.io <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/.E2.9C.94.20WASI.20dependencies.20fail.20with.20cargo-component.20and.20wit-deps.html#409237442">(Dec 20 2023 at 18:07)</a>:</h4>
<p>So I suppose my question becomes is there a Host mechanism to use relative <code>wit</code> directories?</p>



<a name="409237532"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/%E2%9C%94%20WASI%20dependencies%20fail%20with%20cargo-component%20and%20wit-deps/near/409237532" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/.E2.9C.94.20WASI.20dependencies.20fail.20with.20cargo-component.20and.20wit-deps.html#409237532">(Dec 20 2023 at 18:08)</a>:</h4>
<p>I'm more surprised that cargo-component doesn't break; it should be calling roughly the same code as wasmtime bindgen.</p>



<a name="409237616"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/%E2%9C%94%20WASI%20dependencies%20fail%20with%20cargo-component%20and%20wit-deps/near/409237616" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Huene <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/.E2.9C.94.20WASI.20dependencies.20fail.20with.20cargo-component.20and.20wit-deps.html#409237616">(Dec 20 2023 at 18:08)</a>:</h4>
<p>It doesn't; deps are explicitly listed in the target dependency table and it doesn't look at <code>deps</code></p>



<a name="409237721"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/%E2%9C%94%20WASI%20dependencies%20fail%20with%20cargo-component%20and%20wit-deps/near/409237721" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> DougAnderson444 | PeerPiper.io <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/.E2.9C.94.20WASI.20dependencies.20fail.20with.20cargo-component.20and.20wit-deps.html#409237721">(Dec 20 2023 at 18:09)</a>:</h4>
<p>So I wonder why I'm getting the error that states the missing  wit from the <code>deps</code> directory</p>



<a name="409237732"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/%E2%9C%94%20WASI%20dependencies%20fail%20with%20cargo-component%20and%20wit-deps/near/409237732" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Huene <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/.E2.9C.94.20WASI.20dependencies.20fail.20with.20cargo-component.20and.20wit-deps.html#409237732">(Dec 20 2023 at 18:09)</a>:</h4>
<p>if you want to "share" a deps directory between a standard <code>wit-parser</code> impl (i.e. <code>wit-bindgen</code> and the macro from wasmtime) and <code>cargo-component</code>, it's best to keep the dependency in <code>deps</code> and specify the path to <code>cargo-component</code> such that it points to that directory inside the deps dir</p>



<a name="409237874"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/%E2%9C%94%20WASI%20dependencies%20fail%20with%20cargo-component%20and%20wit-deps/near/409237874" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> DougAnderson444 | PeerPiper.io <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/.E2.9C.94.20WASI.20dependencies.20fail.20with.20cargo-component.20and.20wit-deps.html#409237874">(Dec 20 2023 at 18:10)</a>:</h4>
<p>Could you show me an example of what you mean? It's a bit mind bending</p>



<a name="409237938"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/%E2%9C%94%20WASI%20dependencies%20fail%20with%20cargo-component%20and%20wit-deps/near/409237938" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Huene <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/.E2.9C.94.20WASI.20dependencies.20fail.20with.20cargo-component.20and.20wit-deps.html#409237938">(Dec 20 2023 at 18:11)</a>:</h4>
<p><code>"seed-keeper:wallet" = { path = "../../crates/seed-keeper-wit/wit/deps/wallet" }</code> (or whatever it was before you moved it)</p>



<a name="409237981"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/%E2%9C%94%20WASI%20dependencies%20fail%20with%20cargo-component%20and%20wit-deps/near/409237981" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> DougAnderson444 | PeerPiper.io <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/.E2.9C.94.20WASI.20dependencies.20fail.20with.20cargo-component.20and.20wit-deps.html#409237981">(Dec 20 2023 at 18:11)</a>:</h4>
<p>Ahh I see what you mean, I can give that a try</p>



<a name="409245688"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/%E2%9C%94%20WASI%20dependencies%20fail%20with%20cargo-component%20and%20wit-deps/near/409245688" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> DougAnderson444 | PeerPiper.io <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/.E2.9C.94.20WASI.20dependencies.20fail.20with.20cargo-component.20and.20wit-deps.html#409245688">(Dec 20 2023 at 19:15)</a>:</h4>
<p>I can't quite get that to work Peter, but I get the idea. I'll re-try when I've got a bit more time. </p>
<p>I need to correct my previous statement though -- I <strong>do</strong> need the <code>[target.dependencies]</code> for <code>cargo component build</code> to work.</p>



<a name="409278560"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/%E2%9C%94%20WASI%20dependencies%20fail%20with%20cargo-component%20and%20wit-deps/near/409278560" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> DougAnderson444 | PeerPiper.io <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/.E2.9C.94.20WASI.20dependencies.20fail.20with.20cargo-component.20and.20wit-deps.html#409278560">(Dec 20 2023 at 23:38)</a>:</h4>
<p>Ok, I think I figured out how to use this <code>"wit/deps/package-name"</code> concept. It seems to help to break up wit into separate files for interfaces and worlds, to sort of logically separate things.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>