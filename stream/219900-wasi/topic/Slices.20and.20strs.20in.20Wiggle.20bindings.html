<html>
<head><meta charset="utf-8"><title>Slices and strs in Wiggle bindings · wasi · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/index.html">wasi</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html">Slices and strs in Wiggle bindings</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="196830860"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196830860" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> acfoltzer <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196830860">(May 07 2020 at 21:12)</a>:</h4>
<p><strong>tl;dr</strong> We're hoping to find safer ways to access slices and strs in Wiggle trait implementations, particularly in the presence of invalidating operations like yielding. But we don't want to mess up what's already working well for wasi-common.</p>
<p>Hey folks, this week I've been looking at how to start rolling out Wiggle-generated code to more hostcall implementations in our Wasm execution daemon. I've run into a couple points of additional friction vs writing hostcall implementations manually. I'm hoping y'all might have some ideas for how we might be able to reduce this friction?</p>
<p>The first problem is one that I've actually managed to sidestep for now: Lucet supports a <a href="https://docs.rs/lucet-runtime/0.6.1/lucet_runtime/vmctx/struct.Vmctx.html#method.yield_" title="https://docs.rs/lucet-runtime/0.6.1/lucet_runtime/vmctx/struct.Vmctx.html#method.yield_">family of yield functions</a> on its VM context object which are quite useful for integrating Lucet execution with async Rust runtimes. For safety, these require an exclusive <code>&amp;mut</code> reference to the VM context, but Wiggle only provides a shared <code>&amp;</code> reference to the user-provided context type. I've sidestepped this issue for the moment by converting async calls within hostcalls to blocking calls using <code>futures::executor::block_on</code>. This works for now, but is not ideal because it prevents those blocked threads from handling other async work.</p>
<p>The bigger problem at the moment is that it's currently quite painstaking to get access to slices and strs in Wiggle implementations. It requires using the honor system with <a href="https://docs.rs/wiggle/0.16.0/wiggle/struct.GuestBorrows.html" title="https://docs.rs/wiggle/0.16.0/wiggle/struct.GuestBorrows.html">GuestBorrows</a>, plus explicit unsafe to dereference a raw pointer. My understanding is that this is pretty uncommon in wasi-common compared to dealing with [pointers to] scalars, enums, and structs, but in our Wasm daemon the situation is practically the reverse: we're dealing with slices and strings in almost all of our hostcalls. If it was just a few functions in special situations, I would feel better about rolling this out with appropriate signposting and warnings, but right now we're holding off until the common case no longer requires this manually-checked reasoning.</p>
<p>In Lucet, we address this with <a href="https://docs.rs/lucet-runtime/0.6.1/lucet_runtime/vmctx/struct.Vmctx.html#method.heap" title="https://docs.rs/lucet-runtime/0.6.1/lucet_runtime/vmctx/struct.Vmctx.html#method.heap">dynamic borrow checking on heap accessors</a>. This works out nicely, because any operations on the VM context that might invalidate the view of the heap such as yielding or growing the heap (a safe callback interface is still a TODO for us; we don't use callbacks in our daemon) require exclusive <code>&amp;mut</code> access, and thus the borrow checker prevents the <code>Ref</code>s and <code>RefMut</code>s from staying live during these operations. The hostcall implementor is then free to reacquire updated views of these resources on the other side of the invalidating operation.</p>
<p>I tried noodling around a bit adding <code>RefCell</code>s to my Wiggle context, and to my Wiggle <code>GuestMemory</code> implementation, in order to achieve a similar effect, but I'm running into a couple problems:</p>
<ol>
<li>
<p><code>GuestPtr</code>s contain shared references to the <code>GuestMemory</code>, and are provided to the implementation as function arguments. This means that even if we change the shared <code>&amp;</code> reference to a dynamically-checked <code>Ref</code>, we have no way of re-acquiring that borrow after relinquishing it for an invalidating operation that requires an exclusive <code>&amp;mut</code> or <code>RefMut</code> reference.</p>
</li>
<li>
<p>I haven't found a workable solution for having the <code>GuestMemory</code> and the user-provided Wiggle context share borrow state. Having a <em>single object</em> produce both our views into memory, and mediate access to invalidating operations is how we get machine-checked assurance that we're not changing the world out from under ourselves. So naturally, I tried to make these values share a borrow state through <code>RefCell</code> in order to recover these semantics.</p>
<p>What I found was that it's very difficult to nest <code>RefCell</code>s in a way that allows functions to return a <code>Ref</code> or <code>RefMut</code> from the inner cell. While you <em>can</em> <a href="https://doc.rust-lang.org/std/cell/struct.Ref.html#method.map" title="https://doc.rust-lang.org/std/cell/struct.Ref.html#method.map">map over a <code>Ref</code></a>, the closure you map with must return a <code>&amp;U</code>, it can't return <code>Ref&lt;'_, U&gt;</code>. This makes sense because of the ownership logic of the dynamic borrows involved here, and I'm guessing could be worked around with a custom variant of <code>RefCell</code>, but <span aria-label="grimacing" class="emoji emoji-1f62c" role="img" title="grimacing">:grimacing:</span></p>
</li>
</ol>
<p>So I'm stuck wishing for three things, and realizing they're probably incompatible with the current Wiggle API: </p>
<ol>
<li>I want to have my <code>GuestMemory</code> and user-provided context be the same object, with no indirection through <code>RefCell</code>, <code>RwLock</code>, etc.</li>
<li>I want to have exclusive <code>&amp;mut</code> access to that object in the body of my Wiggle trait implementations.</li>
<li>I want to be able to either get fresh <code>GuestPtr</code>s on the other side of an invalidating operation, or have them be safe to hold across such an operation.</li>
</ol>
<p>Do y'all have ideas for how we might be able to accommodate these wishes without having to tear down what we've already built and what works well for wasi-common?</p>



<a name="196831616"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196831616" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196831616">(May 07 2020 at 21:19)</a>:</h4>
<p><span class="user-mention" data-user-id="253993">@acfoltzer</span> FWIW I believe I'm "at fault" for most of the current restrictions in wiggle, but that was mostly just me rationalizing Rust's memory model with executing arbitrary wasm code. Given that there's not a huge amount of wiggle (hah) room without larger changes.</p>



<a name="196831705"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196831705" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196831705">(May 07 2020 at 21:20)</a>:</h4>
<p>For example if you've got a <code>&amp;mut T</code> that points into wasm memory, then it's memory unsafe to just call back into the wasm. Nothing about <code>GuestBorrows</code> will help fix that unsoundness. This could be fixable, however, if you've got a larger system which dynamically prevents reentering the wasm once you have a <code>&amp;mut T</code></p>



<a name="196831726"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196831726" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196831726">(May 07 2020 at 21:20)</a>:</h4>
<p>(and then you'd also dynamic-borrow-check to make sure the <code>&amp;mut T</code> didn't overlap with anything)</p>



<a name="196831785"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196831785" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> acfoltzer <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196831785">(May 07 2020 at 21:21)</a>:</h4>
<p>Yep, and that's exactly what we have in our daemon</p>



<a name="196831903"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196831903" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> acfoltzer <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196831903">(May 07 2020 at 21:21)</a>:</h4>
<p>it seems like a fundamentally different approach to what Wiggle is currently doing, though, which led to this wall of text <span aria-label="upside down" class="emoji emoji-1f643" role="img" title="upside down">:upside_down:</span></p>



<a name="196831954"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196831954" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196831954">(May 07 2020 at 21:22)</a>:</h4>
<p>It sounds like some of these may be solvable with codegen tweaks? My intention was that wiggle would generate 100% safe things, but if y'all have extra checking in place that wiggle isn't aware of then it would be pushing the unsafe boundary outwards</p>



<a name="196831973"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196831973" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196831973">(May 07 2020 at 21:22)</a>:</h4>
<p>but yeah if y'all are statically preventing reentering wasm then that changes a whole lot about wiggle</p>



<a name="196831995"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196831995" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> acfoltzer <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196831995">(May 07 2020 at 21:22)</a>:</h4>
<p>yeah, it's a bit of a hack but it works pretty nicely in practice</p>



<a name="196832050"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196832050" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196832050">(May 07 2020 at 21:23)</a>:</h4>
<p>from a bindings-generator point of view which is purely consuming <code>wasmtime</code> APIs, it's impossible to provide that guarantee statically though</p>



<a name="196832059"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196832059" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196832059">(May 07 2020 at 21:23)</a>:</h4>
<p>e.g. if other users of wiggle come along</p>



<a name="196832073"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196832073" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> acfoltzer <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196832073">(May 07 2020 at 21:23)</a>:</h4>
<p>it does require some pretty gross stuff under the hood though, most notoriously <a href="https://github.com/bytecodealliance/lucet/blob/master/lucet-runtime/lucet-runtime-internals/src/vmctx.rs#L177" title="https://github.com/bytecodealliance/lucet/blob/master/lucet-runtime/lucet-runtime-internals/src/vmctx.rs#L177">https://github.com/bytecodealliance/lucet/blob/master/lucet-runtime/lucet-runtime-internals/src/vmctx.rs#L177</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/lucet/blob/master/lucet-runtime/lucet-runtime-internals/src/vmctx.rs#L177" style="background-image: url(https://avatars0.githubusercontent.com/u/54038801?s=400&amp;v=4)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/lucet/blob/master/lucet-runtime/lucet-runtime-internals/src/vmctx.rs#L177" title="bytecodealliance/lucet">bytecodealliance/lucet</a></div><div class="message_embed_description">Lucet, the Sandboxing WebAssembly Compiler. Contribute to bytecodealliance/lucet development by creating an account on GitHub.</div></div></div>



<a name="196832271"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196832271" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> acfoltzer <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196832271">(May 07 2020 at 21:25)</a>:</h4>
<p>we might have to wait for Pat to come back from vacation to really get to the point of making any decisions, because he's much more familiar with the API constraints you have on the <code>wasmtime</code> side</p>



<a name="196832369"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196832369" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196832369">(May 07 2020 at 21:26)</a>:</h4>
<p>I may have also just mistaken the purpose of wiggle somewhat</p>



<a name="196832378"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196832378" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> acfoltzer <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196832378">(May 07 2020 at 21:26)</a>:</h4>
<p>one of my fallback ideas though is to see about factoring the witx consumption and reasoning about Rust host-side types into a common module, and just doing different codegen for Lucet</p>



<a name="196832393"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196832393" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196832393">(May 07 2020 at 21:26)</a>:</h4>
<p>I was viewing it from a lens of "anyone who's binding <code>*.witx</code> will want to use this to bind host functions"</p>



<a name="196832426"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196832426" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196832426">(May 07 2020 at 21:26)</a>:</h4>
<p>but if it's instead "fastly is binding <code>*.witx</code> with these extra assumptions" then wiggle should look very different</p>



<a name="196832460"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196832460" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196832460">(May 07 2020 at 21:27)</a>:</h4>
<p>it sounds like y'all are making assumptions about the wasm execution which other projects may not always be able to make</p>



<a name="196832487"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196832487" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> acfoltzer <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196832487">(May 07 2020 at 21:27)</a>:</h4>
<p>hmm, do you have an example of that?</p>



<a name="196832490"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196832490" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196832490">(May 07 2020 at 21:27)</a>:</h4>
<p>which changes quite a bit how nice a bindings library can be</p>



<a name="196832533"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196832533" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196832533">(May 07 2020 at 21:27)</a>:</h4>
<p>oh so I don't think we have any other examples of wiggle in use, but I'm imagining a use case which allows reentrancy</p>



<a name="196832553"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196832553" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196832553">(May 07 2020 at 21:27)</a>:</h4>
<p>e.g. you call into the host and then it calls you back during that host call</p>



<a name="196832639"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196832639" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196832639">(May 07 2020 at 21:28)</a>:</h4>
<p>the possibility of that happening is a fundamental assumption of wiggle right now, but it sounds like y'all prevent that via other means</p>



<a name="196832683"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196832683" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196832683">(May 07 2020 at 21:28)</a>:</h4>
<p>but no one's getting too too much use out of wiggle right now, so we can also just document how it's safely used</p>



<a name="196832692"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196832692" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196832692">(May 07 2020 at 21:29)</a>:</h4>
<p>and change it to assume no reentrancy</p>



<a name="196832702"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196832702" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> acfoltzer <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196832702">(May 07 2020 at 21:29)</a>:</h4>
<p><em>oh</em>, you mean that some other thread in the host calls into the same Wasm module?</p>



<a name="196832726"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196832726" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> acfoltzer <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196832726">(May 07 2020 at 21:29)</a>:</h4>
<p>rather than the hostcall implementation doing the callback on the same thread?</p>



<a name="196832728"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196832728" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196832728">(May 07 2020 at 21:29)</a>:</h4>
<p>nah not another thread, but the same thread itself</p>



<a name="196832763"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196832763" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196832763">(May 07 2020 at 21:29)</a>:</h4>
<p>like some funky syscall where you call <code>host.call_me_back(my_fn_pointer)</code> and then the host, during that function call, calls <code>my_fn_pointer</code></p>



<a name="196832819"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196832819" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196832819">(May 07 2020 at 21:30)</a>:</h4>
<p>so the native stack looks like <code>[top] -&gt; wasm code -&gt; [hostcall] -&gt; wasm code -&gt; ...</code></p>



<a name="196832832"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196832832" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196832832">(May 07 2020 at 21:30)</a>:</h4>
<p>where any borrows that <code>[hostcall]</code> has active are immediately invalidated by executing wasm code</p>



<a name="196832843"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196832843" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> acfoltzer <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196832843">(May 07 2020 at 21:30)</a>:</h4>
<p>right. our assumption is that you <em>can</em> do that, but only through a function that takes <code>&amp;mut Vmctx</code> so that outstanding heap references must be dropped</p>



<a name="196832877"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196832877" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> acfoltzer <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196832877">(May 07 2020 at 21:31)</a>:</h4>
<p>(that function doesn't exist yet in our <code>Vmctx</code> interface though; <code>yield</code> is a better example right now)</p>



<a name="196832943"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196832943" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196832943">(May 07 2020 at 21:31)</a>:</h4>
<p>ah ok, that's sort of the same thing though, the risk of allowing reentering wasm during a hostcall is active borrows</p>



<a name="196832952"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196832952" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> acfoltzer <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196832952">(May 07 2020 at 21:31)</a>:</h4>
<p>exactly</p>



<a name="196832955"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196832955" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196832955">(May 07 2020 at 21:31)</a>:</h4>
<p>but y'all are dynamically guaranteeing there are no active borrows with Rust's lifetime system (I think?)</p>



<a name="196833005"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196833005" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196833005">(May 07 2020 at 21:32)</a>:</h4>
<p>that assumption wasn't baked into wiggle b/c that's an application-specific restriction you have</p>



<a name="196833021"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196833021" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196833021">(May 07 2020 at 21:32)</a>:</h4>
<p>but wiggle could of course be rewritten or updated with that restriction</p>



<a name="196833028"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196833028" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196833028">(May 07 2020 at 21:32)</a>:</h4>
<p>and simply say "applications gotta have something like this"</p>



<a name="196833029"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196833029" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> acfoltzer <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196833029">(May 07 2020 at 21:32)</a>:</h4>
<p>that's right. Rust will complain if the heap view <code>Ref&lt;'_, [u8]&gt;</code> is live when you try to use <code>&amp;mut Vmctx</code></p>



<a name="196833050"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196833050" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Konka <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196833050">(May 07 2020 at 21:32)</a>:</h4>
<p>@acfoltzer Would it be possible to build around <code>wiggle</code>, here <code>wiggle</code> staying largely the same and you providing something more specific like <span class="user-mention" data-user-id="253994">@Alex Crichton</span> is pointing out?</p>



<a name="196833077"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196833077" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> acfoltzer <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196833077">(May 07 2020 at 21:33)</a>:</h4>
<p>that is what I was trying to do with the <code>RefCell</code> experiments I describe above</p>



<a name="196833097"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196833097" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> acfoltzer <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196833097">(May 07 2020 at 21:33)</a>:</h4>
<p>maybe I just got myself backed into a corner with it, but I couldn't figure out how to make it work out</p>



<a name="196833103"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196833103" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Konka <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196833103">(May 07 2020 at 21:33)</a>:</h4>
<p>Oh and for the record, although perhaps I misunderstood you, we do quite a few calls to get a string out of guest in <code>wasi-common</code></p>



<a name="196833174"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196833174" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> acfoltzer <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196833174">(May 07 2020 at 21:34)</a>:</h4>
<p>ah, Pat was describing it as a less common case in wasi-common than it is in our daemon</p>



<a name="196833194"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196833194" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Konka <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196833194">(May 07 2020 at 21:34)</a>:</h4>
<p>oh it may be so</p>



<a name="196833204"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196833204" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196833204">(May 07 2020 at 21:34)</a>:</h4>
<p>(also to clarify I didn't really understand what you were mentioning about RefCell and things above)</p>



<a name="196833225"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196833225" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Konka <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196833225">(May 07 2020 at 21:34)</a>:</h4>
<p>in <code>wasi-common</code> any syscall that includes "path" requires fetching a string</p>



<a name="196833357"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196833357" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> acfoltzer <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196833357">(May 07 2020 at 21:36)</a>:</h4>
<p><span class="user-mention silent" data-user-id="253994">Alex Crichton</span> <a href="#narrow/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings/near/196833204" title="#narrow/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings/near/196833204">said</a>:</p>
<blockquote>
<p>(also to clarify I didn't really understand what you were mentioning about RefCell and things above)</p>
</blockquote>
<p>hah sorry. that was a bit more of a brain dump than I had intended. I was basically trying to recover the connection between the lifetimes of the active borrows with the lifetime of the user-provided context type</p>



<a name="196833361"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196833361" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Konka <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196833361">(May 07 2020 at 21:36)</a>:</h4>
<p>and as far <code>&amp;</code> vs <code>&amp;mut</code> I thought that was the desired requirement so that we can easily stick any context object in an <code>Rc</code>/<code>Arc</code></p>



<a name="196833557"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196833557" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> acfoltzer <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196833557">(May 07 2020 at 21:38)</a>:</h4>
<p>ahh, that's good to know. we do not have that as a restriction in Lucet, so we've always had the hostcall context as a <code>&amp;mut</code></p>



<a name="196833664"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196833664" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196833664">(May 07 2020 at 21:39)</a>:</h4>
<p>But also to be clear, this is again sort of just shaping wiggle as a library that makes minimal assumptions</p>



<a name="196833675"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196833675" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> acfoltzer <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196833675">(May 07 2020 at 21:39)</a>:</h4>
<p>yeah, that makes sense</p>



<a name="196833679"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196833679" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196833679">(May 07 2020 at 21:40)</a>:</h4>
<p>Wiggle right now is designed to assume a maximally malicious host which wants to stress everything</p>



<a name="196833743"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196833743" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196833743">(May 07 2020 at 21:40)</a>:</h4>
<p>but it still wants to provide a 100% safe interface</p>



<a name="196833761"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196833761" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196833761">(May 07 2020 at 21:40)</a>:</h4>
<p>so the trivial reason for requiring <code>&amp;</code> for user contexts is that wasm can call the host twice on the stack</p>



<a name="196833774"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196833774" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196833774">(May 07 2020 at 21:40)</a>:</h4>
<p>which makes it sort of like TLS, so you can only get a shared reference</p>



<a name="196833790"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196833790" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196833790">(May 07 2020 at 21:40)</a>:</h4>
<p>once you start making other assumptions though these requirements go away</p>



<a name="196833802"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196833802" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196833802">(May 07 2020 at 21:41)</a>:</h4>
<p>it sounds like y'all are making enough assumptions that wiggle is just getting in the way</p>



<a name="196833859"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196833859" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196833859">(May 07 2020 at 21:41)</a>:</h4>
<p>I think the assumptions you're making though might be quite difficult for other applications to make as well, so I'm not sure if there's a nice reusable binding layer to share unfortunately</p>



<a name="196833894"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196833894" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Konka <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196833894">(May 07 2020 at 21:42)</a>:</h4>
<p>I think I agree with <span class="user-mention" data-user-id="253994">@Alex Crichton</span> on this</p>



<a name="196833961"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196833961" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Konka <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196833961">(May 07 2020 at 21:42)</a>:</h4>
<p>Perhaps we could figure out if we could make <code>wiggle</code>-like interface pluggable into <code>wasi-common</code> rather than specifically requiring it?</p>



<a name="196833964"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196833964" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> acfoltzer <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196833964">(May 07 2020 at 21:42)</a>:</h4>
<p>yeah, and it's possible this may just come down to us having faulty assumptions about the safety of our system. for example if you have a stack with [Rust] -&gt; [Wasm] -&gt; [Hostcall] -&gt; [Wasm] -&gt; [Hostcall] then you have two <code>&amp;mut Vmctx</code> on the stack pointing to the same place. our argument has been this is okay because the second is entirely contained within the first, but maybe that's naïve</p>



<a name="196834003"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196834003" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Konka <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196834003">(May 07 2020 at 21:42)</a>:</h4>
<p>Not sure if that makes sense but then you guys could have a more specialised version of it and everything would be fine</p>



<a name="196834046"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196834046" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> acfoltzer <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196834046">(May 07 2020 at 21:43)</a>:</h4>
<p>yeah, I'm leaning toward something like that</p>



<a name="196834201"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196834201" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196834201">(May 07 2020 at 21:44)</a>:</h4>
<p><span class="user-mention" data-user-id="253993">@acfoltzer</span> I think that's a really fine line to walk there</p>



<a name="196834218"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196834218" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196834218">(May 07 2020 at 21:45)</a>:</h4>
<p>I wouldn't say with certainty that it's safe or unsafe</p>



<a name="196834237"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196834237" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> acfoltzer <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196834237">(May 07 2020 at 21:45)</a>:</h4>
<p>I'm glad we agree <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span></p>



<a name="196834262"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196834262" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196834262">(May 07 2020 at 21:45)</a>:</h4>
<p>You can have two <code>&amp;mut T</code> pointers on the stack that point to the same thing, but in safe rust rustc/llvm can see the pointers getting passed around</p>



<a name="196834296"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196834296" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196834296">(May 07 2020 at 21:45)</a>:</h4>
<p>the unsafety would happen I believe if they can't see the pointers passed around</p>



<a name="196834378"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196834378" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196834378">(May 07 2020 at 21:46)</a>:</h4>
<p>like:</p>
<div class="codehilite"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">x</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">Context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">..</span><span class="p">.;</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">field1</span><span class="p">;</span><span class="w"></span>
<span class="n">foobar</span><span class="p">();</span><span class="w"> </span><span class="c1">// may read/mutate `x`</span>
<span class="n">assert_eq</span><span class="o">!</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">field1</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">);</span><span class="w"></span>
</code></pre></div>



<a name="196834392"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196834392" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196834392">(May 07 2020 at 21:46)</a>:</h4>
<p>if rustc sees you pass <code>x</code> to <code>foobar</code>, then it knows it has to reload <code>x.field1</code> after the call</p>



<a name="196834410"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196834410" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196834410">(May 07 2020 at 21:46)</a>:</h4>
<p>if it doesn't see you pass <code>x</code> to <code>foobar</code> then it could assume it's impossible to change, so there's no need to reload <code>x.field1</code></p>



<a name="196834421"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196834421" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196834421">(May 07 2020 at 21:46)</a>:</h4>
<p>but if <code>x.field1</code> was mutated in <code>foobar</code> then that's an issue</p>



<a name="196834449"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196834449" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196834449">(May 07 2020 at 21:47)</a>:</h4>
<p>clearly if you do <code>foobar(x)</code> rustc/llvm will see through all that, but if it's actually <code>some_wasm_call()</code> it's not clear if LLVM/rustc can see enough to assume that pointers might change</p>



<a name="196834481"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196834481" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> acfoltzer <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196834481">(May 07 2020 at 21:47)</a>:</h4>
<p>that makes sense, and certainly makes our current interface unsafe. but a callback interface that requires a <code>&amp;mut Vmctx</code> would let Rust see the pointer being used</p>



<a name="196834523"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196834523" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196834523">(May 07 2020 at 21:48)</a>:</h4>
<p>these are also sort of just vague thoughts though, I'm definitely not like on the unsafe guidelines wg or anything like that</p>



<a name="196834683"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196834683" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> acfoltzer <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196834683">(May 07 2020 at 21:49)</a>:</h4>
<p>yeah, I'm glad to see that your thinking resembles mine quite a bit, though</p>



<a name="196834776"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196834776" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> acfoltzer <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196834776">(May 07 2020 at 21:50)</a>:</h4>
<p>fine line indeed</p>



<a name="196834858"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196834858" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> acfoltzer <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196834858">(May 07 2020 at 21:51)</a>:</h4>
<p>okay, well thank you for the extra context about the whys of the current interface. I think I'll have to wait for Pat to get back and chat with him about what our strategy should be. right now I'm leaning toward doing additional Lucet-specific codegen (we already do a bit in <code>lucet-wiggle</code>), but this is probably worth talking about more at the meeting next week</p>



<a name="196834937"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196834937" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> acfoltzer <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196834937">(May 07 2020 at 21:51)</a>:</h4>
<p>given that wasmtime/lucet integration is on our roadmap, it'd be good to understand exactly what the assumptions are in each system, and know how we can reconcile them</p>



<a name="196834989"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196834989" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Konka <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196834989">(May 07 2020 at 21:52)</a>:</h4>
<p><span class="user-mention silent" data-user-id="253993">acfoltzer</span> <a href="#narrow/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings/near/196834858" title="#narrow/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings/near/196834858">said</a>:</p>
<blockquote>
<p>okay, well thank you for the extra context about the whys of the current interface. I think I'll have to wait for Pat to get back and chat with him about what our strategy should be. right now I'm leaning toward doing additional Lucet-specific codegen (we already do a bit in <code>lucet-wiggle</code>), but this is probably worth talking about more at the meeting next week</p>
</blockquote>
<p>Sounds good! Oh and would you mind pinging a couple of links in my direction where this problem space appears in lucet? I used to keep track of you changes guys but sadly not for a while now...</p>



<a name="196835037"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196835037" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> acfoltzer <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196835037">(May 07 2020 at 21:52)</a>:</h4>
<p>or if they can't be reconciled, how to turn the difference into one of the "knobs" we've discussed before for modularizing the systems</p>



<a name="196835113"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196835113" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> acfoltzer <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196835113">(May 07 2020 at 21:53)</a>:</h4>
<p><span class="user-mention" data-user-id="263195">@Jakub Konka</span> I unfortunately can't share the daemon code where we're doing this hostcall implementation, if that's what you mean</p>



<a name="196835237"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196835237" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> acfoltzer <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196835237">(May 07 2020 at 21:54)</a>:</h4>
<p>the <code>lucet-wiggle</code> stuff though is just a thin wrapper around <code>wiggle</code> crates. you can see the core idea here: <a href="https://github.com/bytecodealliance/lucet/blob/master/lucet-wiggle/generate/src/lib.rs" title="https://github.com/bytecodealliance/lucet/blob/master/lucet-wiggle/generate/src/lib.rs">https://github.com/bytecodealliance/lucet/blob/master/lucet-wiggle/generate/src/lib.rs</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/lucet/blob/master/lucet-wiggle/generate/src/lib.rs" style="background-image: url(https://avatars0.githubusercontent.com/u/54038801?s=400&amp;v=4)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/lucet/blob/master/lucet-wiggle/generate/src/lib.rs" title="bytecodealliance/lucet">bytecodealliance/lucet</a></div><div class="message_embed_description">Lucet, the Sandboxing WebAssembly Compiler. Contribute to bytecodealliance/lucet development by creating an account on GitHub.</div></div></div>



<a name="196835293"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196835293" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> acfoltzer <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196835293">(May 07 2020 at 21:55)</a>:</h4>
<p>sorry, meant to link to this line: <a href="https://github.com/bytecodealliance/lucet/blob/master/lucet-wiggle/generate/src/lib.rs#L64" title="https://github.com/bytecodealliance/lucet/blob/master/lucet-wiggle/generate/src/lib.rs#L64">https://github.com/bytecodealliance/lucet/blob/master/lucet-wiggle/generate/src/lib.rs#L64</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/lucet/blob/master/lucet-wiggle/generate/src/lib.rs#L64" style="background-image: url(https://avatars0.githubusercontent.com/u/54038801?s=400&amp;v=4)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/lucet/blob/master/lucet-wiggle/generate/src/lib.rs#L64" title="bytecodealliance/lucet">bytecodealliance/lucet</a></div><div class="message_embed_description">Lucet, the Sandboxing WebAssembly Compiler. Contribute to bytecodealliance/lucet development by creating an account on GitHub.</div></div></div>



<a name="196835639"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196835639" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Konka <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196835639">(May 07 2020 at 21:59)</a>:</h4>
<p><span class="user-mention silent" data-user-id="253993">acfoltzer</span> <a href="#narrow/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings/near/196835113" title="#narrow/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings/near/196835113">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="263195">Jakub Konka</span> I unfortunately can't share the daemon code where we're doing this hostcall implementation, if that's what you mean</p>
</blockquote>
<p>Oh, sure thing, I actually meant the lucet stuff mainly and lucet-wiggle in particular :-)</p>



<a name="196835675"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196835675" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jakub Konka <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196835675">(May 07 2020 at 21:59)</a>:</h4>
<p><span class="user-mention silent" data-user-id="253993">acfoltzer</span> <a href="#narrow/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings/near/196835293" title="#narrow/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings/near/196835293">said</a>:</p>
<blockquote>
<p>sorry, meant to link to this line: <a href="https://github.com/bytecodealliance/lucet/blob/master/lucet-wiggle/generate/src/lib.rs#L64" title="https://github.com/bytecodealliance/lucet/blob/master/lucet-wiggle/generate/src/lib.rs#L64">https://github.com/bytecodealliance/lucet/blob/master/lucet-wiggle/generate/src/lib.rs#L64</a></p>
</blockquote>
<p>Awesome, thanks!</p>



<a name="196836101"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Slices%20and%20strs%20in%20Wiggle%20bindings/near/196836101" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> acfoltzer <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Slices.20and.20strs.20in.20Wiggle.20bindings.html#196836101">(May 07 2020 at 22:03)</a>:</h4>
<p>thank you all for taking a look <span aria-label="heart" class="emoji emoji-2764" role="img" title="heart">:heart:</span></p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>