<html>
<head><meta charset="utf-8"><title>Using the preview2 shim JS code · wasi · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/index.html">wasi</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Using.20the.20preview2.20shim.20JS.20code.html">Using the preview2 shim JS code</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="376072499"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Using%20the%20preview2%20shim%20JS%20code/near/376072499" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Karel Hrkal (kajacx) <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Using.20the.20preview2.20shim.20JS.20code.html#376072499">(Jul 17 2023 at 15:38)</a>:</h4>
<p>Hello, I wanted to ask if I can use the <a href="https://github.com/bytecodealliance/jco/tree/main/packages/preview2-shim/lib">JS preview 2 shim</a> javascript code in my project, <a href="https://github.com/kajacx/wasm-bridge">wasm-bridge</a>.</p>
<p>The idea is to have an <code>instantiate</code> function in Rust that would load those files into js with <code>js_sys::eval</code>, something similar to what is done <a href="https://github.com/kajacx/wasm-playground/tree/wit-bindgen-wasi-MVP/runtime-web-generate-jco">here</a>, but it would be fully automated.</p>
<p>I would need to add these js files to the source of wasm-bridge and distribute them as part of the wasm-bridge crate. I can add a notice to the source code specifying where those files come from, or add the Apache 2.0 license to those files, kind of like I have done with <a href="https://crates.io/crates/wasm-bridge-macros">wasm-bridge-macros</a>.</p>
<p>You can also read <a href="https://github.com/bytecodealliance/jco/issues/42#issuecomment-1638177648">this</a> response for a more complete picture of the story.</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/kajacx/wasm-bridge" style="background-image: url(https\:\/\/uploads\.zulipusercontent\.net\/58ce2924dce6902d9f7870f47c343ad31dfd6835\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f366333363631623965383063336361323663356262353738386165626261393236393530336130333830313632663532343262356237356563646531303966392f6b616a6163782f7761736d2d627269646765)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/kajacx/wasm-bridge" title="GitHub - kajacx/wasm-bridge: Provides a single unified API to run WASM modules on the desktop using wasmtime, or on the web using js-sys.">GitHub - kajacx/wasm-bridge: Provides a single unified API to run WASM modules on the desktop using wasmtime, or on the web using js-sys.</a></div><div class="message_embed_description">Provides a single unified API to run WASM modules on the desktop using wasmtime, or on the web using js-sys. - GitHub - kajacx/wasm-bridge: Provides a single unified API to run WASM modules on the ...</div></div></div><div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/jco/issues/42#issuecomment-1638177648" style="background-image: url(https\:\/\/uploads\.zulipusercontent\.net\/a93ab4dd52f42036086d905dbbb76eaae8df95b2\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f616162633666353936376132613030346561653631386138666664383334316331353234386264666164663534316162376336623832336435646538653531362f62797465636f6465616c6c69616e63652f6a636f2f6973737565732f3432)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/jco/issues/42#issuecomment-1638177648" title="Browser support · Issue #42 · bytecodealliance/jco">Browser support · Issue #42 · bytecodealliance/jco</a></div><div class="message_embed_description">I did like to use jco for handling wasi preview2 in browser_wasi_shim. Is it possible to use jco directly in the browser to take a wasm component, run the transpilation step and directly run it as ...</div></div></div>



<a name="376112322"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Using%20the%20preview2%20shim%20JS%20code/near/376112322" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Guy Bedford <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Using.20the.20preview2.20shim.20JS.20code.html#376112322">(Jul 17 2023 at 17:24)</a>:</h4>
<p><span class="user-mention" data-user-id="621586">@Karel Hrkal (kajacx)</span> you are welcome to use the code if you include the license. I would encourage contributing back any changes you make as opposed to forking where possible, as we are very much in need to contributors to the code as well.</p>



<a name="376292901"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Using%20the%20preview2%20shim%20JS%20code/near/376292901" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Karel Hrkal (kajacx) <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Using.20the.20preview2.20shim.20JS.20code.html#376292901">(Jul 18 2023 at 10:17)</a>:</h4>
<p>Thanks. I am not sure if the changes I want to make can be merged into the original source. For example, I will need to "massage" the JS code so that it can be loaded with <code>js_sys::eval</code> as opposed to with <code>import</code>. I assume that's not really what you want in the main project.</p>
<p>Anyway, my project is open source too, so anyone can look at the changes.</p>



<a name="376424661"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Using%20the%20preview2%20shim%20JS%20code/near/376424661" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Guy Bedford <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Using.20the.20preview2.20shim.20JS.20code.html#376424661">(Jul 18 2023 at 17:24)</a>:</h4>
<p>You should be able to pipe the code into a JS build tool to massage it into any output you need. For example esbuild can flatten the imports and just output a global script. While not only better from a code structure perspective, it would also create a path for upstreaming and downstreaming changes which I would highly encourage. WASI will be continuing to evolve and it would set up the process for keeping it updated without a huge amount of manual merging effort to get on that.</p>



<a name="376575005"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/Using%20the%20preview2%20shim%20JS%20code/near/376575005" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Karel Hrkal (kajacx) <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/Using.20the.20preview2.20shim.20JS.20code.html#376575005">(Jul 19 2023 at 08:32)</a>:</h4>
<p>Thanks. I intended to have two folders: "original" and "modified", both checked into version control, with a script that re-fetches the original from a git url and another script that "massages" the original. So any changes upstream could be propagated to my project with "a push of a button" and I would see what actually changed in the git diff.</p>
<p>ES build looks interesting, I will try using that. Also, if there will be any changes "fit" to be merged back upstream, I will  create a pull request.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>