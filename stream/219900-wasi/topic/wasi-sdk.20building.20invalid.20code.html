<html>
<head><meta charset="utf-8"><title>wasi-sdk building invalid code · wasi · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/index.html">wasi</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-sdk.20building.20invalid.20code.html">wasi-sdk building invalid code</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="474046661"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-sdk%20building%20invalid%20code/near/474046661" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-sdk.20building.20invalid.20code.html#474046661">(Oct 01 2024 at 14:04)</a>:</h4>
<p>I tried compiling one of the zlib-rs examples which also compiles zlib-ng for wasm32-wasip1. It compiled, but when I then try to run it in Wasmtime, I get "Invalid input WebAssembly code at offset 109435: type mismatch: values remaining on stack at end of block". What would be an appropriate place to report this bug?</p>



<a name="474062281"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-sdk%20building%20invalid%20code/near/474062281" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> fitzgen (he/him) <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-sdk.20building.20invalid.20code.html#474062281">(Oct 01 2024 at 15:12)</a>:</h4>
<p>maybe start with wasi-sdk and then subsequent investigation can find the right home</p>
<p>do other engines (say browsers) also report the wasm as invalid?</p>



<a name="474062942"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-sdk%20building%20invalid%20code/near/474062942" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-sdk.20building.20invalid.20code.html#474062942">(Oct 01 2024 at 15:15)</a>:</h4>
<p>Node 20.17 reports "CompileError: WebAssembly.compile(): Compiling function #191:"adler32_stub" failed: expected 1 elements on the stack for fallthru, found 3 @+104593"</p>



<a name="474066226"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/wasi-sdk%20building%20invalid%20code/near/474066226" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/wasi-sdk.20building.20invalid.20code.html#474066226">(Oct 01 2024 at 15:31)</a>:</h4>
<p><a href="https://github.com/WebAssembly/wasi-sdk/issues/492">https://github.com/WebAssembly/wasi-sdk/issues/492</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/WebAssembly/wasi-sdk/issues/492" style="background-image: url(&quot;https://uploads.zulipusercontent.net/74eefdd5ab3780f3ae11a9036e89c8a59b724c1c/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f623963666436373236353235356234383862373234643037643937303565306566653039346363653666343561303631343763663566313232626137663164612f576562417373656d626c792f776173692d73646b2f6973737565732f343932&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/WebAssembly/wasi-sdk/issues/492" title="Compiling libz-ng using wasi-sdk produces an invalid binary · Issue #492 · WebAssembly/wasi-sdk">Compiling libz-ng using wasi-sdk produces an invalid binary · Issue #492 · WebAssembly/wasi-sdk</a></div><div class="message_embed_description">The blogpost-uncompress example of zlib-rs includes the C libz-ng library. Without libz-ng, zlib-rs compiles fine for wasm. Reproduction $ git clone https://github.com/trifectatechfoundation/zlib-r...</div></div></div>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>