<html>
<head><meta charset="utf-8"><title>✔ string buffer soundness · wasi · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/index.html">wasi</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/.E2.9C.94.20string.20buffer.20soundness.html">✔ string buffer soundness</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="455750000"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/%E2%9C%94%20string%20buffer%20soundness/near/455750000" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pavel Šavara <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/.E2.9C.94.20string.20buffer.20soundness.html#455750000">(Aug 01 2024 at 20:22)</a>:</h4>
<p>I would like to know if the guest component could rely on the soundness/validity of provided buffer being valid UTF-16/UTF-8.</p>
<p>When 2 components send each other string and the host could "do fused adapter"<br>
Is the host (wasmtime, jco) responsible for validating the buffer ?<br>
Or should the guest component (in our case dotnet) be responsible to validate strings ?</p>
<p>Is that defined in the spec ?</p>
<p>I found soundness discussion here, but I'm not sure what's the latest.<br>
<a href="https://github.com/WebAssembly/interface-types/issues/128">https://github.com/WebAssembly/interface-types/issues/128</a></p>
<p>Consider that if the host would do it, it could be implemented possibly in more optimized way than the guest could do it.</p>
<p>On the other hand, if it's guest's responsibility I'm not sure that declaring my component to be UTF-16 makes significant perf benefit (because I need to scan/parse the bytes again anyway).</p>
<p>This question is in context of code generated by wit-bindgen for C#</p>
<p>cc <span class="user-mention" data-user-id="509936">@Joel Dice</span></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/WebAssembly/interface-types/issues/128" style="background-image: url(&quot;https://uploads.zulipusercontent.net/0d121f2adb1ae2be83f2552777af504aafc70ee5/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f333135363861623333313761326335336235663265386436366330616463303238316137306565633037366139643739616636343464393530333136613663652f576562417373656d626c792f696e746572666163652d74797065732f6973737565732f313238&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/WebAssembly/interface-types/issues/128" title="Guaranteeing additional soundness properties · Issue #128 · WebAssembly/interface-types">Guaranteeing additional soundness properties · Issue #128 · WebAssembly/interface-types</a></div><div class="message_embed_description">After a few recent conversations with @RossTate and @fgmccabe where this came up, I wanted to share my thoughts about how I see the relationship between Interface Types and core WebAssembly and see...</div></div></div>



<a name="455750675"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/%E2%9C%94%20string%20buffer%20soundness/near/455750675" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/.E2.9C.94.20string.20buffer.20soundness.html#455750675">(Aug 01 2024 at 20:24)</a>:</h4>
<p>Tracing through the Wasmtime code, I can see that fused adapters call into the host to perform both validation and copying, so <span class="user-mention" data-user-id="471788">@Pavel Šavara</span> and I are wondering if it's <em>required</em> by the spec to do that validation, i.e. can the guest rely on it?</p>



<a name="455754566"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/%E2%9C%94%20string%20buffer%20soundness/near/455754566" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/.E2.9C.94.20string.20buffer.20soundness.html#455754566">(Aug 01 2024 at 20:48)</a>:</h4>
<p>Yes a guest is guaranteed that all bytes it receives are a valid encoding</p>



<a name="455754663"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/%E2%9C%94%20string%20buffer%20soundness/near/455754663" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/.E2.9C.94.20string.20buffer.20soundness.html#455754663">(Aug 01 2024 at 20:49)</a>:</h4>
<p>Wasmtime doesn't validate strings going into a guest from the host but that's only because Rust provides the guarantee invalid utf8</p>



<a name="455754761"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/%E2%9C%94%20string%20buffer%20soundness/near/455754761" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/.E2.9C.94.20string.20buffer.20soundness.html#455754761">(Aug 01 2024 at 20:50)</a>:</h4>
<p>Thanks.  Is the guarantee made explicit in e.g. <a href="https://github.com/WebAssembly/component-model/blob/main/design/mvp/CanonicalABI.md">https://github.com/WebAssembly/component-model/blob/main/design/mvp/CanonicalABI.md</a>?  I couldn't find it.</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/WebAssembly/component-model/blob/main/design/mvp/CanonicalABI.md" style="background-image: url(&quot;https://uploads.zulipusercontent.net/7340543fe460b46da7487c546e5f239e5f98b4f0/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f633765366361643033393538643162346562383264663433623335653833336631633261653930386230316437626632383832633639373337656466313363332f576562417373656d626c792f636f6d706f6e656e742d6d6f64656c&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/WebAssembly/component-model/blob/main/design/mvp/CanonicalABI.md" title="component-model/design/mvp/CanonicalABI.md at main · WebAssembly/component-model">component-model/design/mvp/CanonicalABI.md at main · WebAssembly/component-model</a></div><div class="message_embed_description">Repository for design and specification of the Component Model - WebAssembly/component-model</div></div></div>



<a name="455755005"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/%E2%9C%94%20string%20buffer%20soundness/near/455755005" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/.E2.9C.94.20string.20buffer.20soundness.html#455755005">(Aug 01 2024 at 20:52)</a>:</h4>
<p>In load_string_from_range the UnicodeError and trap() handle this</p>



<a name="455755041"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/%E2%9C%94%20string%20buffer%20soundness/near/455755041" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/.E2.9C.94.20string.20buffer.20soundness.html#455755041">(Aug 01 2024 at 20:52)</a>:</h4>
<p>Where all strings are always valid and the only constructor in the abi is a lift operation</p>



<a name="455755090"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/%E2%9C%94%20string%20buffer%20soundness/near/455755090" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/.E2.9C.94.20string.20buffer.20soundness.html#455755090">(Aug 01 2024 at 20:53)</a>:</h4>
<p>We really need a "canonical abi intro" document</p>



<a name="455929288"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/%E2%9C%94%20string%20buffer%20soundness/near/455929288" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Milan <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/.E2.9C.94.20string.20buffer.20soundness.html#455929288">(Aug 02 2024 at 13:05)</a>:</h4>
<p>FWIW this issue goes into the same question: <a href="https://github.com/WebAssembly/component-model/issues/224">https://github.com/WebAssembly/component-model/issues/224</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/WebAssembly/component-model/issues/224" style="background-image: url(&quot;https://uploads.zulipusercontent.net/55a679ea256744f1182da086c25c401e08634f64/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f636531393235326232336232653839623437633361373335643136323836643137306462643332316666396337373333376437633865396634623963383937322f576562417373656d626c792f636f6d706f6e656e742d6d6f64656c2f6973737565732f323234&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/WebAssembly/component-model/issues/224" title="UTF-8 Invalid sequences for component model strings · Issue #224 · WebAssembly/component-model">UTF-8 Invalid sequences for component model strings · Issue #224 · WebAssembly/component-model</a></div><div class="message_embed_description">Forgive me if I'm missing it, but is there a discussion of how the Unicode UTR 36: UTF-8 Exploits are addressed by the component model strings? From what I can tell looking at the CanonicalABI it l...</div></div></div>



<a name="455932694"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/219900-wasi/topic/%E2%9C%94%20string%20buffer%20soundness/near/455932694" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/219900-wasi/topic/.E2.9C.94.20string.20buffer.20soundness.html#455932694">(Aug 02 2024 at 13:27)</a>:</h4>
<p><span class="user-mention silent" data-user-id="471788">Pavel Šavara</span> has marked this topic as resolved.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>