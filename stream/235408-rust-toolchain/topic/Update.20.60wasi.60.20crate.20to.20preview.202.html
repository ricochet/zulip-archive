<html>
<head><meta charset="utf-8"><title>Update `wasi` crate to preview 2 · rust-toolchain · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/235408-rust-toolchain/index.html">rust-toolchain</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/235408-rust-toolchain/topic/Update.20.60wasi.60.20crate.20to.20preview.202.html">Update `wasi` crate to preview 2</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="418800154"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/235408-rust-toolchain/topic/Update%20%60wasi%60%20crate%20to%20preview%202/near/418800154" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts <a href="https://bytecodealliance.github.io/zulip-archive/stream/235408-rust-toolchain/topic/Update.20.60wasi.60.20crate.20to.20preview.202.html#418800154">(Jan 30 2024 at 09:47)</a>:</h4>
<p>Heya, just wanted to highlight I've <a href="https://github.com/bytecodealliance/wasi/issues/71">opened an issue</a> on the <code>wasi</code> crate to update the published bindings to preview 2. I believe now that Preview 2 is launched, we should be able to do this? Mostly sharing it here to ask whether there are any other blockers / things we need to do to unblock this?</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wasi/issues/71" style="background-image: url(https\:\/\/uploads\.zulipusercontent\.net\/3cc5e5b4653ff25623321b928ea311133a53a455\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f653763346661616665373037313534316338306139626632386562613263353433323634323832393133373465303933663433363936626166663265663563362f62797465636f6465616c6c69616e63652f776173692f6973737565732f3731)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wasi/issues/71" title="Update published bindings to Preview 2 · Issue #71 · bytecodealliance/wasi">Update published bindings to Preview 2 · Issue #71 · bytecodealliance/wasi</a></div><div class="message_embed_description">Now that Preview 2 has been ratified, we should publish a checked-in version of the generated Preview 2 bindings. I'm not sure what the full range of dependencies for this are, but presumably we'll...</div></div></div>



<a name="418802327"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/235408-rust-toolchain/topic/Update%20%60wasi%60%20crate%20to%20preview%202/near/418802327" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts <a href="https://bytecodealliance.github.io/zulip-archive/stream/235408-rust-toolchain/topic/Update.20.60wasi.60.20crate.20to.20preview.202.html#418802327">(Jan 30 2024 at 10:00)</a>:</h4>
<p>Oh, I didn't realize we also have a <a class="stream" data-stream-id="327223" href="/#narrow/stream/327223-wit-bindgen">#wit-bindgen</a> channel. Maybe I should have opened that there instead.</p>



<a name="423088871"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/235408-rust-toolchain/topic/Update%20%60wasi%60%20crate%20to%20preview%202/near/423088871" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/235408-rust-toolchain/topic/Update.20.60wasi.60.20crate.20to.20preview.202.html#423088871">(Feb 23 2024 at 20:23)</a>:</h4>
<p>Sounds great to me.  One thing to consider: <code>wit-bindgen</code> will generate a custom section for the component type with a name derived from the world the bindings were generated from.  If an application developer happens to use the same world name in their application and also link with the new <code>wasi</code> crate, <code>wasmld</code> will try to combine the custom sections, generating output that <code>wit-component</code> can't understand.  We ran into this while updating <code>wasi-libc</code>, hence <a href="https://github.com/bytecodealliance/wit-bindgen/issues/788">https://github.com/bytecodealliance/wit-bindgen/issues/788</a> and <a href="https://github.com/bytecodealliance/wit-bindgen/pull/805">https://github.com/bytecodealliance/wit-bindgen/pull/805</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wit-bindgen/issues/788" style="background-image: url(https\:\/\/uploads\.zulipusercontent\.net\/3c8d75a7a0835d3601ffdd5dc5c6f62bebb7675d\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f306361306261396363393963633438613830313465316261643639383633623861386533643734613666393864613662356237613039346536386331356235392f62797465636f6465616c6c69616e63652f7769742d62696e6467656e2f6973737565732f373838)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wit-bindgen/issues/788" title="Allow user to override component type custom section name (or else generate a random name) · Issue #788 · bytecodealliance/wit-bindgen">Allow user to override component type custom section name (or else generate a random name) · Issue #788 · bytecodealliance/wit-bindgen</a></div><div class="message_embed_description">Currently, wit-bindgen generates the custom section name using the format "component-type:{world_name}". This can lead to issues when linking separately-compiled code together, each containing code...</div></div></div><div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wit-bindgen/pull/805" style="background-image: url(https\:\/\/uploads\.zulipusercontent\.net\/d6a78a651e2e085101e78b9088a109ad3bf8fe97\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f313038353631346166316534383637373938333234336163306536313635646639336162373666666238363263313235626439666438333464613232643864632f62797465636f6465616c6c69616e63652f7769742d62696e6467656e2f70756c6c2f383035)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wit-bindgen/pull/805" title="add `--rename-world` and `--type-section-suffix` options to C generator by dicej · Pull Request #805 · bytecodealliance/wit-bindgen">add `--rename-world` and `--type-section-suffix` options to C generator by dicej · Pull Request #805 · bytecodealliance/wit-bindgen</a></div><div class="message_embed_description">These are both useful for supporting the wasm32-wasi-preview2 target in wasi-libc.

--rename-world lets us give the files more meaningful names than e.g. "imports.h" when generating bindings for wa...</div></div></div>



<a name="423095528"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/235408-rust-toolchain/topic/Update%20%60wasi%60%20crate%20to%20preview%202/near/423095528" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/235408-rust-toolchain/topic/Update.20.60wasi.60.20crate.20to.20preview.202.html#423095528">(Feb 23 2024 at 21:11)</a>:</h4>
<p><a href="https://github.com/bytecodealliance/wasi/pull/75">good point</a>!</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wasi/pull/75" style="background-image: url(https\:\/\/uploads\.zulipusercontent\.net\/c821fbd79ae62ee6a575c633472ed958c5bdc284\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f323936353931376231383262663633303430643366313437613064303830373763326562323366313262366132316564623161626465666233623039353736362f62797465636f6465616c6c69616e63652f776173692f70756c6c2f3735)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wasi/pull/75" title="Add a suffix to the metadata section for component types by alexcrichton · Pull Request #75 · bytecodealliance/wasi">Add a suffix to the metadata section for component types by alexcrichton · Pull Request #75 · bytecodealliance/wasi</a></div><div class="message_embed_description">This will help prevent clashes with any other world called "bindings" by ensuring that wasm-ld doesn't concatenate sections and corrupt the internal contents.</div></div></div>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>