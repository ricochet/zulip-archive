<html>
<head><meta charset="utf-8"><title>WASI, wit-component, and wasmtime · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/index.html">general</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/WASI.2C.20wit-component.2C.20and.20wasmtime.html">WASI, wit-component, and wasmtime</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="307834047"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/WASI%2C%20wit-component%2C%20and%20wasmtime/near/307834047" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/WASI.2C.20wit-component.2C.20and.20wasmtime.html#307834047">(Nov 03 2022 at 20:36)</a>:</h4>
<p>Excited about all the recent progress in <code>wit-bindgen</code>, <code>wit-component</code>, and <code>wasmtime</code>, I've been experimenting with building and hosting components recently.  The only hitch so far has been WASI support for components, and I'd like to check on the status of that.</p>
<p>I found <a href="https://github.com/bytecodealliance/wit-bindgen/commit/fc35377b64a66d3c58280ccf36e74085dff15ad5">https://github.com/bytecodealliance/wit-bindgen/commit/fc35377b64a66d3c58280ccf36e74085dff15ad5</a>, and I've seen Dan and Alex collaborating on shims from Preview1 to Preview2 and vice-versa, but AFAICT <code>wasmtime-wasi</code> does not yet have Preview2 support, so while it might be (almost?) possible to create a component that uses WASI, it's not yet possible to host one.  Is that correct?  If so, I'd be interested in helping fill in the missing pieces there.</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wit-bindgen/commit/fc35377b64a66d3c58280ccf36e74085dff15ad5" style="background-image: url(https\:\/\/uploads\.zulipusercontent\.net\/895b22d46fad4fa48fe8e565b26fc539d55c16eb\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f336564363439356265353934373630303732393530323665346663383433643666366364393030633733303635623239336639653737343831303131333164392f62797465636f6465616c6c69616e63652f7769742d62696e6467656e2f636f6d6d69742f66633335333737623634613636643363353832383063636633366537343038356466663135616435)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wit-bindgen/commit/fc35377b64a66d3c58280ccf36e74085dff15ad5" title="Add support to wit-component to polyfill WASI  (#338) · bytecodealliance/wit-bindgen@fc35377">Add support to wit-component to polyfill WASI  (#338) · bytecodealliance/wit-bindgen@fc35377</a></div><div class="message_embed_description">* Add support to `wit-component` to polyfill WASI

This commit is an addition to the `wit-component` tool to be able to
polyfill WASI imports today using `wasi_snapshot_preview1` with a
compone...</div></div></div>



<a name="307836454"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/WASI%2C%20wit-component%2C%20and%20wasmtime/near/307836454" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/WASI.2C.20wit-component.2C.20and.20wasmtime.html#307836454">(Nov 03 2022 at 20:50)</a>:</h4>
<p>Hi! so, i'm working right now on some foundational stuff for supporting preview 2</p>



<a name="307836753"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/WASI%2C%20wit-component%2C%20and%20wasmtime/near/307836753" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/WASI.2C.20wit-component.2C.20and.20wasmtime.html#307836753">(Nov 03 2022 at 20:52)</a>:</h4>
<p>I don't really have a complete plan figured out and I'm working on some transformations to wasi-common as it exists today to get things in the right direction, but id be up for collaborating if you want to figure out how to divide and conquer with me.</p>



<a name="307838875"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/WASI%2C%20wit-component%2C%20and%20wasmtime/near/307838875" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/WASI.2C.20wit-component.2C.20and.20wasmtime.html#307838875">(Nov 03 2022 at 21:03)</a>:</h4>
<p>Sounds great.  Would you by chance have time to chat about it after tomorrow's component model meeting?  If not, we can figure out another time.</p>



<a name="309116307"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/WASI%2C%20wit-component%2C%20and%20wasmtime/near/309116307" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philpax <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/WASI.2C.20wit-component.2C.20and.20wasmtime.html#309116307">(Nov 11 2022 at 01:45)</a>:</h4>
<p>Apologies for bumping this, but I'm looking at updating our <code>wasmtime</code>/<code>wit-bindgen</code> (which looks like it'll require us to use the component model for our modules), but the lack of WASI is currently a blocker. This is not a major issue for us as our existing solution works, but it does mean that we can't update and enjoy some of the newer changes (I'm personally keen for the <code>anyhow::Result</code> return types in the generated traits!)</p>
<p>Is there a rough timeframe for when a componentized <code>wasmtime-wasi</code> might be available? No rush or high precision required, just a finger in the air estimate if possible!</p>



<a name="309123578"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/WASI%2C%20wit-component%2C%20and%20wasmtime/near/309123578" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ari Seyhun <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/WASI.2C.20wit-component.2C.20and.20wasmtime.html#309123578">(Nov 11 2022 at 03:30)</a>:</h4>
<p>I haven't contributed to the project, but I just wanted to let you know that I got it all working yesterday with webassembly components, but there was no documentation and I was figuring out each step one by one.<br>
I had to compile some things with some specific Rust flags that I found when digging through the build files</p>



<a name="309124436"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/WASI%2C%20wit-component%2C%20and%20wasmtime/near/309124436" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/WASI.2C.20wit-component.2C.20and.20wasmtime.html#309124436">(Nov 11 2022 at 03:42)</a>:</h4>
<p>There isn't a specific timeline, but we are working on it. For example, <a href="https://github.com/sunfishcode/preview1.wasm/tree/no-handles">this</a> is a work-in-progress polyfill which implements the preview1 API in terms of wit-based APIs, which is helping us push forward the overall implementation.</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/sunfishcode/preview1.wasm/tree/no-handles" style="background-image: url(https\:\/\/uploads\.zulipusercontent\.net\/fed35a3b3693d8a17ba8deb97a8f655a830cca0d\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f663234646664383936376561363836336435363864393462323364383732386661306630666531303365666132336135633063653331316136303333316262322f73756e66697368636f64652f70726576696577312e7761736d)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/sunfishcode/preview1.wasm/tree/no-handles" title="GitHub - sunfishcode/preview1.wasm at no-handles">GitHub - sunfishcode/preview1.wasm at no-handles</a></div><div class="message_embed_description">Experimental experiments. Contribute to sunfishcode/preview1.wasm development by creating an account on GitHub.</div></div></div>



<a name="309199068"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/WASI%2C%20wit-component%2C%20and%20wasmtime/near/309199068" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philpax <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/WASI.2C.20wit-component.2C.20and.20wasmtime.html#309199068">(Nov 11 2022 at 14:07)</a>:</h4>
<p><span class="user-mention silent" data-user-id="474928">Ari Seyhun</span> <a href="#narrow/stream/206238-general/topic/WASI.2C.20wit-component.2C.20and.20wasmtime/near/309123578">said</a>:</p>
<blockquote>
<p>I haven't contributed to the project, but I just wanted to let you know that I got it all working yesterday with webassembly components, but there was no documentation and I was figuring out each step one by one.<br>
I had to compile some things with some specific Rust flags that I found when digging through the build files</p>
</blockquote>
<p>Yeah, I was able to get components working, but couldn't progress any further due to our dependency on WASI (or at least specific features of it.) Is that something you were able to overcome?</p>
<p><span class="user-mention silent" data-user-id="254083">Dan Gohman</span> <a href="#narrow/stream/206238-general/topic/WASI.2C.20wit-component.2C.20and.20wasmtime/near/309124436">said</a>:</p>
<blockquote>
<p>There isn't a specific timeline, but we are working on it. For example, <a href="https://github.com/sunfishcode/preview1.wasm/tree/no-handles">this</a> is a work-in-progress polyfill which implements the preview1 API in terms of wit-based APIs, which is helping us push forward the overall implementation.</p>
</blockquote>
<p>Understandable - looks like you're doing great work! What's the easiest way to stay subscribed to updates on this? I've been checking the repos and the Zulip, but I'm not sure if there's a specific place for announcements or such.</p>



<a name="309229537"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/WASI%2C%20wit-component%2C%20and%20wasmtime/near/309229537" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/WASI.2C.20wit-component.2C.20and.20wasmtime.html#309229537">(Nov 11 2022 at 17:00)</a>:</h4>
<p>What we have there is very experimental, we have a rough plan for what it will take to land all of that in the wasmtime repo as part of wasi-common</p>



<a name="309229615"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/WASI%2C%20wit-component%2C%20and%20wasmtime/near/309229615" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/WASI.2C.20wit-component.2C.20and.20wasmtime.html#309229615">(Nov 11 2022 at 17:01)</a>:</h4>
<p>like dan says, we don't have any estimate for when that will be  production quality. hopefully Q1 but no promises.</p>



<a name="309229676"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/WASI%2C%20wit-component%2C%20and%20wasmtime/near/309229676" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/WASI.2C.20wit-component.2C.20and.20wasmtime.html#309229676">(Nov 11 2022 at 17:01)</a>:</h4>
<p>it will definitely make it into the wasmtime release notes once it lands, and hopefully we will blog about it and stuff too</p>



<a name="309243949"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/WASI%2C%20wit-component%2C%20and%20wasmtime/near/309243949" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philpax <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/WASI.2C.20wit-component.2C.20and.20wasmtime.html#309243949">(Nov 11 2022 at 18:38)</a>:</h4>
<p>Makes sense - thanks for the answer! I'll keep an eye out until then.</p>
<p>If I only need a subset of functionality from WASI, is it possible to stub out the interface and still compile/run against <code>wasm32-wasi</code>?</p>



<a name="309249591"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/WASI%2C%20wit-component%2C%20and%20wasmtime/near/309249591" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/WASI.2C.20wit-component.2C.20and.20wasmtime.html#309249591">(Nov 11 2022 at 19:23)</a>:</h4>
<p>there is a really small adapter in the wit-bindgen repo at crates/wasi_snapshot_preview1/ that adapts the bare minimum set of wasi preview 1 import functions used by the tests in that repo to just some basic print-debugging functions</p>



<a name="309249631"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/WASI%2C%20wit-component%2C%20and%20wasmtime/near/309249631" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/WASI.2C.20wit-component.2C.20and.20wasmtime.html#309249631">(Nov 11 2022 at 19:23)</a>:</h4>
<p>its not designed to be used outside of that repo, its really just there to make sure we can run tests and debug them with println</p>



<a name="309249763"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/WASI%2C%20wit-component%2C%20and%20wasmtime/near/309249763" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/WASI.2C.20wit-component.2C.20and.20wasmtime.html#309249763">(Nov 11 2022 at 19:24)</a>:</h4>
<p>but if you just want to satisfy the wasi preview1 imports required by std or wasi-libc with something, its in a more usable state than the sunfishcode/preview1.wasm repo</p>



<a name="309394585"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/WASI%2C%20wit-component%2C%20and%20wasmtime/near/309394585" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Amit Prasad <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/WASI.2C.20wit-component.2C.20and.20wasmtime.html#309394585">(Nov 12 2022 at 22:36)</a>:</h4>
<p>Hi all,<br>
I've been trying to figure out how to instantiate and run a simple component, but feel like I'm going in circles. Are there any examples / example repositories out there that show a minimum example of using wit-component / wasmtime::Component in Rust.</p>
<p>Specifically, I'm having trouble with the bindings generated using wit_bindgen_host_wasmtime_rust::generate -- I'm not exactly sure how to take these bindings and actually run the module. Any pointers would be helpful:)</p>



<a name="309413195"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/WASI%2C%20wit-component%2C%20and%20wasmtime/near/309413195" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/WASI.2C.20wit-component.2C.20and.20wasmtime.html#309413195">(Nov 13 2022 at 03:50)</a>:</h4>
<p>There are tests in that repo but they lean on a fair amount of macros to work. That the best we have right now, there is some similar stuff going on in the preview1.wasm repo as well. We haven’t spent much time working on docs or examples yet because it’s still actively changing</p>



<a name="309425709"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/WASI%2C%20wit-component%2C%20and%20wasmtime/near/309425709" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Amit Prasad <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/WASI.2C.20wit-component.2C.20and.20wasmtime.html#309425709">(Nov 13 2022 at 07:44)</a>:</h4>
<p><span class="user-mention silent" data-user-id="253992">Pat Hickey</span> <a href="#narrow/stream/206238-general/topic/WASI.2C.20wit-component.2C.20and.20wasmtime/near/309413195">said</a>:</p>
<blockquote>
<p>There are tests in that repo but they lean on a fair amount of macros to work. That the best we have right now, there is some similar stuff going on in the preview1.wasm repo as well. We haven’t spent much time working on docs or examples yet because it’s still actively changing</p>
</blockquote>
<p>Gotcha. I actually <em>did</em> end up getting it working using cargo-expand to figure out what was going on :).</p>
<p>For anyone in the future -- I found this example very helpful: <a href="https://github.com/bytecodealliance/wasm-tools/tree/main/crates/wasm-compose/example">https://github.com/bytecodealliance/wasm-tools/tree/main/crates/wasm-compose/example</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wasm-tools/tree/main/crates/wasm-compose/example" style="background-image: url(https\:\/\/uploads\.zulipusercontent\.net\/0e8dfeab8b848d1223b207598e484bbfb28f7020\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f323130656439373563386131373761313564306465333739306232666462336564363761623732363839656661313331323739363438333231666537316461342f62797465636f6465616c6c69616e63652f7761736d2d746f6f6c73)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wasm-tools/tree/main/crates/wasm-compose/example" title="wasm-tools/crates/wasm-compose/example at main · bytecodealliance/wasm-tools">wasm-tools/crates/wasm-compose/example at main · bytecodealliance/wasm-tools</a></div><div class="message_embed_description">Low level tooling for WebAssembly in Rust. Contribute to bytecodealliance/wasm-tools development by creating an account on GitHub.</div></div></div>



<a name="309426065"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/WASI%2C%20wit-component%2C%20and%20wasmtime/near/309426065" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Amit Prasad <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/WASI.2C.20wit-component.2C.20and.20wasmtime.html#309426065">(Nov 13 2022 at 07:49)</a>:</h4>
<p>just a quick question -- does <code>wasmtime-wasi</code> support adding to a <code>wasmtime::component::Linker</code>? Or is this something I would need to do manually?</p>



<a name="309902087"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/WASI%2C%20wit-component%2C%20and%20wasmtime/near/309902087" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/WASI.2C.20wit-component.2C.20and.20wasmtime.html#309902087">(Nov 14 2022 at 16:41)</a>:</h4>
<p>There’s no component code in wasmtime-wasi yet, all of this is very experimental still, but when it lands as production ready code there will be a way to add it to a component Linker just like preview 1 / witx based wasi adds to a core Linker</p>



<a name="310328718"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/WASI%2C%20wit-component%2C%20and%20wasmtime/near/310328718" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Amit Prasad <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/WASI.2C.20wit-component.2C.20and.20wasmtime.html#310328718">(Nov 16 2022 at 02:29)</a>:</h4>
<p>Sorry to keep bothering you about this, but I had a question about using the wasi_snapshot_preview1 stub (<a href="https://github.com/bytecodealliance/wit-bindgen/tree/main/crates/wasi_snapshot_preview1">https://github.com/bytecodealliance/wit-bindgen/tree/main/crates/wasi_snapshot_preview1</a>)</p>
<p>I see in a doc comment for <code>wit-component</code> that there's meant to be some special way to compile adapter modules. Do you have any examples of doing this?</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wit-bindgen/tree/main/crates/wasi_snapshot_preview1" style="background-image: url(https\:\/\/uploads\.zulipusercontent\.net\/87baf8046e0a353d2121b21c73831e2e6b8ed410\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f396637306166366338616239366138633963393036646163396261303430653739393961383138333962663235643964393130303036633937396533323434312f62797465636f6465616c6c69616e63652f7769742d62696e6467656e)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wit-bindgen/tree/main/crates/wasi_snapshot_preview1" title="wit-bindgen/crates/wasi_snapshot_preview1 at main · bytecodealliance/wit-bindgen">wit-bindgen/crates/wasi_snapshot_preview1 at main · bytecodealliance/wit-bindgen</a></div><div class="message_embed_description">A language binding generator for WebAssembly interface types - wit-bindgen/crates/wasi_snapshot_preview1 at main · bytecodealliance/wit-bindgen</div></div></div>



<a name="310334966"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/WASI%2C%20wit-component%2C%20and%20wasmtime/near/310334966" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Amit Prasad <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/WASI.2C.20wit-component.2C.20and.20wasmtime.html#310334966">(Nov 16 2022 at 04:04)</a>:</h4>
<p>Ah, I see that I should have <code>RUSTFLAGS="-Clink-args=--import-memory -Clink-args=-zstack-size=0"</code>, but no dice on trying to pass that into <code>wit-component</code> hmm...</p>



<a name="310338476"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/WASI%2C%20wit-component%2C%20and%20wasmtime/near/310338476" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ari Seyhun <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/WASI.2C.20wit-component.2C.20and.20wasmtime.html#310338476">(Nov 16 2022 at 04:49)</a>:</h4>
<p><span class="user-mention" data-user-id="559153">@Amit Prasad</span> I managed to do this a few days ago, and I wrote some docs for myself. Here's what I wrote down:</p>
<p>After building this module to wasm32-wasi, you need to use the <a href="https://github.com/bytecodealliance/wit-bindgen/tree/main/crates/wit-component">wit-component</a> cli to convert the wasm to a component.</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>wit-component ./target/wasm32-wasi/release/counter.wasm --adapt ../../../../bytecodealliance/wit-bindgen/target/wasm32-unknown-unknown/release/wasi_snapshot_preview1.wasm -o ./counter.component.wasm
</code></pre></div>
<p>wasi_snapshot_preview1.wasm comes from the <a href="https://github.com/bytecodealliance/wit-bindgen/tree/main/crates/wasi_snapshot_preview1"><code>wasi_snapshot_preview1</code></a> crate, and should be built with the following command:</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code><span class="nv">RUSTFLAGS</span><span class="o">=</span><span class="s2">"-Clink-args=--import-memory -Clink-args=-zstack-size=0"</span> cargo build --release --target<span class="o">=</span>wasm32-unknown-unknown -p wasi_snapshot_preview1
</code></pre></div>
<p>Note, wasi_snapshot_preview1 might need to be modified to have the testwasi.wit import removed, since its not needed.</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wit-bindgen/tree/main/crates/wit-component" style="background-image: url(https\:\/\/uploads\.zulipusercontent\.net\/87baf8046e0a353d2121b21c73831e2e6b8ed410\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f396637306166366338616239366138633963393036646163396261303430653739393961383138333962663235643964393130303036633937396533323434312f62797465636f6465616c6c69616e63652f7769742d62696e6467656e)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wit-bindgen/tree/main/crates/wit-component" title="wit-bindgen/crates/wit-component at main · bytecodealliance/wit-bindgen">wit-bindgen/crates/wit-component at main · bytecodealliance/wit-bindgen</a></div><div class="message_embed_description">A language binding generator for WebAssembly interface types - wit-bindgen/crates/wit-component at main · bytecodealliance/wit-bindgen</div></div></div><div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wit-bindgen/tree/main/crates/wasi_snapshot_preview1" style="background-image: url(https\:\/\/uploads\.zulipusercontent\.net\/87baf8046e0a353d2121b21c73831e2e6b8ed410\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f396637306166366338616239366138633963393036646163396261303430653739393961383138333962663235643964393130303036633937396533323434312f62797465636f6465616c6c69616e63652f7769742d62696e6467656e)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wit-bindgen/tree/main/crates/wasi_snapshot_preview1" title="wit-bindgen/crates/wasi_snapshot_preview1 at main · bytecodealliance/wit-bindgen">wit-bindgen/crates/wasi_snapshot_preview1 at main · bytecodealliance/wit-bindgen</a></div><div class="message_embed_description">A language binding generator for WebAssembly interface types - wit-bindgen/crates/wasi_snapshot_preview1 at main · bytecodealliance/wit-bindgen</div></div></div>



<a name="310497799"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/WASI%2C%20wit-component%2C%20and%20wasmtime/near/310497799" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Amit Prasad <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/WASI.2C.20wit-component.2C.20and.20wasmtime.html#310497799">(Nov 16 2022 at 20:41)</a>:</h4>
<p>Hmm. Whenever I try to do as you said, Ari, I get a </p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">encode</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="err">`</span><span class="p">.</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">wasm32</span><span class="o">-</span><span class="n">wasi</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">guest</span><span class="p">.</span><span class="n">wasm</span><span class="err">`</span><span class="w"></span>

<span class="w">    </span><span class="n">Caused</span><span class="w"> </span><span class="n">by</span>:
        <span class="mi">0</span>: <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">reduce</span><span class="w"> </span><span class="n">input</span><span class="w"> </span><span class="n">adapter</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">its</span><span class="w"> </span><span class="n">minimal</span><span class="w"> </span><span class="n">size</span><span class="w"></span>
<span class="w">        </span><span class="mi">1</span>: <span class="nc">unsupported</span><span class="w"> </span><span class="n">section</span><span class="w"> </span><span class="n">found</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">adapter</span><span class="w"> </span><span class="n">module</span><span class="w"></span>
</code></pre></div>
<p>Looking at the WebAssembly text for <code>guest.wasm</code> (which has been compiled to wasm32-wasi), and <code>wasi_snapshot_preview.wasm</code> (wasm32-unknown-unknown), I see:<br>
<code>guest.wasm</code>:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">(</span><span class="n">import</span><span class="w"> </span><span class="s">"wasi_snapshot_preview1"</span><span class="w"> </span><span class="s">"fd_write"</span><span class="w"> </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="cp">$A_VERY_LONG_SIGNATURE</span><span class="p">))</span><span class="w"></span>
<span class="p">(</span><span class="n">import</span><span class="w"> </span><span class="s">"wasi_snapshot_preview1"</span><span class="w"> </span><span class="s">"environ_get"</span><span class="w"> </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="cp">$A_VERY_LONG_SIGNATURE</span><span class="p">))</span><span class="w"></span>
<span class="p">(</span><span class="n">import</span><span class="w"> </span><span class="s">"wasi_snapshot_preview1"</span><span class="w"> </span><span class="s">"environ_sizes_get"</span><span class="w"> </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="cp">$A_VERY_LONG_SIGNATURE</span><span class="p">))</span><span class="w"></span>
<span class="p">(</span><span class="n">import</span><span class="w"> </span><span class="s">"wasi_snapshot_preview1"</span><span class="w"> </span><span class="s">"proc_exit"</span><span class="w"> </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="cp">$A_VERY_LONG_SIGNATURE</span><span class="p">))</span><span class="w"></span>
<span class="o">..</span><span class="p">.</span><span class="w"></span>
<span class="p">(</span><span class="nb">Some</span><span class="w"> </span><span class="n">exports</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">I</span><span class="o">'</span><span class="na">ve</span><span class="w"> </span><span class="n">defined</span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<p><code>wasi_snapshot_preview1.wasm</code></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">(</span><span class="n">import</span><span class="w"> </span><span class="s">"testwasi"</span><span class="w"> </span><span class="s">"log"</span><span class="w"> </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="cp">$A_VERY_LONG_SIGNATURE</span><span class="p">))</span><span class="w"></span>
<span class="p">(</span><span class="n">import</span><span class="w"> </span><span class="s">"testwasi"</span><span class="w"> </span><span class="s">"log-err"</span><span class="w"> </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="cp">$A_VERY_LONG_SIGNATURE</span><span class="p">))</span><span class="w"></span>
<span class="o">..</span><span class="p">.</span><span class="w"></span>
<span class="p">(</span><span class="n">export</span><span class="w"> </span><span class="s">"args_get"</span><span class="w"> </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="cp">$args_get</span><span class="p">))</span><span class="w"></span>
<span class="p">(</span><span class="n">export</span><span class="w"> </span><span class="s">"args_sizes_get"</span><span class="w"> </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="cp">$args_sizes_get</span><span class="p">))</span><span class="w"></span>
<span class="p">(</span><span class="n">export</span><span class="w"> </span><span class="s">"clock_time_get"</span><span class="w"> </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="cp">$clock_time_get</span><span class="p">))</span><span class="w"></span>
<span class="p">(</span><span class="n">export</span><span class="w"> </span><span class="s">"fd_write"</span><span class="w"> </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="cp">$fd_write</span><span class="p">))</span><span class="w"></span>
<span class="p">(</span><span class="n">export</span><span class="w"> </span><span class="s">"fd_seek"</span><span class="w"> </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="cp">$fd_seek</span><span class="p">))</span><span class="w"></span>
<span class="p">(</span><span class="n">export</span><span class="w"> </span><span class="s">"fd_close"</span><span class="w"> </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="cp">$fd_close</span><span class="p">))</span><span class="w"></span>
<span class="p">(</span><span class="n">export</span><span class="w"> </span><span class="s">"proc_exit"</span><span class="w"> </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="cp">$proc_exit</span><span class="p">))</span><span class="w"></span>
<span class="p">(</span><span class="n">export</span><span class="w"> </span><span class="s">"fd_fdstat_get"</span><span class="w"> </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="cp">$fd_fdstat_get</span><span class="p">))</span><span class="w"></span>
<span class="p">(</span><span class="n">export</span><span class="w"> </span><span class="s">"environ_sizes_get"</span><span class="w"> </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="cp">$args_sizes_get</span><span class="p">))</span><span class="w"></span>
<span class="p">(</span><span class="n">export</span><span class="w"> </span><span class="s">"environ_get"</span><span class="w"> </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="cp">$args_get</span><span class="p">))</span><span class="w"></span>
<span class="p">(</span><span class="n">export</span><span class="w"> </span><span class="s">"cabi_realloc"</span><span class="w"> </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="cp">$cabi_realloc</span><span class="p">))</span><span class="w"></span>
<span class="p">(</span><span class="n">export</span><span class="w"> </span><span class="s">"__data_end"</span><span class="w"> </span><span class="p">(</span><span class="n">global</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span><span class="w"></span>
<span class="p">(</span><span class="n">export</span><span class="w"> </span><span class="s">"__heap_base"</span><span class="w"> </span><span class="p">(</span><span class="n">global</span><span class="w"> </span><span class="mi">2</span><span class="p">))</span><span class="w"></span>
</code></pre></div>
<p>The only "unsatisfied imports" I can see are the <code>testwasi::{log, log-err}</code> ones, which are provided by the runtime. I've tried running <code>wit-component</code> with <code>--import</code> to the <code>testwasi.wit</code>, but no luck on that front either.</p>
<p>The "unsupported section in adapter module" error leads me to believe I'm compiling the <code>wasi_snapshot_preview1</code> wrong somehow. Any ideas?</p>



<a name="310499958"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/WASI%2C%20wit-component%2C%20and%20wasmtime/near/310499958" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Amit Prasad <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/WASI.2C.20wit-component.2C.20and.20wasmtime.html#310499958">(Nov 16 2022 at 20:54)</a>:</h4>
<p>Further inspection: adding the <code>RUSTFLAGS</code> env  to my cargo command doesn't seem to affect the output wasm <em>at all</em>.  However, <code>cargo build --verbose</code> shows me that the <code>rustc</code> commands include: <code> -Clink-args=--import-memory -Clink-args=-zstack-size=0</code></p>



<a name="310500590"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/WASI%2C%20wit-component%2C%20and%20wasmtime/near/310500590" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/WASI.2C.20wit-component.2C.20and.20wasmtime.html#310500590">(Nov 16 2022 at 20:58)</a>:</h4>
<p>the issue here is the adapter module has an unsupported section, probably either a memory or a data section, since adapters right now can't have locally defined memories or data</p>



<a name="310500638"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/WASI%2C%20wit-component%2C%20and%20wasmtime/near/310500638" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/WASI.2C.20wit-component.2C.20and.20wasmtime.html#310500638">(Nov 16 2022 at 20:59)</a>:</h4>
<p>if you're writing your own adapter you'll need to update the source to where it only uses an imported memory and it doesn't have any of its own data segments</p>



<a name="310502679"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/WASI%2C%20wit-component%2C%20and%20wasmtime/near/310502679" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Amit Prasad <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/WASI.2C.20wit-component.2C.20and.20wasmtime.html#310502679">(Nov 16 2022 at 21:12)</a>:</h4>
<p><span class="user-mention silent" data-user-id="253994">Alex Crichton</span> <a href="#narrow/stream/206238-general/topic/WASI.2C.20wit-component.2C.20and.20wasmtime/near/310500638">said</a>:</p>
<blockquote>
<p>if you're writing your own adapter you'll need to update the source to where it only uses an imported memory and it doesn't have any of its own data segments</p>
</blockquote>
<p>I'm using the <code>wasi_snapshot_preview1</code> crate from the <code>wit-bindgen</code> repo. I see two <code>(data)</code> sections in the compiled WASM, and I also see that it imports <code>(import "env" "memory"</code> but proceeds to grow that in a function that seems to be labelled <code>malloc..Allocator</code></p>
<p>Does this mean I need to manually edit my WASM file to remove these data sections?</p>



<a name="310502891"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/WASI%2C%20wit-component%2C%20and%20wasmtime/near/310502891" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/WASI.2C.20wit-component.2C.20and.20wasmtime.html#310502891">(Nov 16 2022 at 21:14)</a>:</h4>
<p>You shouldn't need to edit the wasm, are you compiling with release mode?</p>



<a name="310503138"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/WASI%2C%20wit-component%2C%20and%20wasmtime/near/310503138" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Amit Prasad <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/WASI.2C.20wit-component.2C.20and.20wasmtime.html#310503138">(Nov 16 2022 at 21:16)</a>:</h4>
<p><span class="user-mention silent" data-user-id="253994">Alex Crichton</span> <a href="#narrow/stream/206238-general/topic/WASI.2C.20wit-component.2C.20and.20wasmtime/near/310502891">said</a>:</p>
<blockquote>
<p>You shouldn't need to edit the wasm, are you compiling with release mode?</p>
</blockquote>
<p>Yep:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">RUSTFLAGS</span><span class="o">=</span><span class="s">"-Clink-args=--import-memory -Clink-args=-zstack-size=0"</span><span class="w"> </span><span class="n">cargo</span><span class="w"> </span><span class="n">build</span><span class="w"> </span><span class="o">--</span><span class="n">release</span><span class="w"> </span><span class="o">--</span><span class="n">target</span><span class="o">=</span><span class="n">wasm32</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">unknown</span><span class="w"> </span><span class="o">--</span><span class="n">verbose</span><span class="w"></span>
</code></pre></div>



<a name="310505327"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/WASI%2C%20wit-component%2C%20and%20wasmtime/near/310505327" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/WASI.2C.20wit-component.2C.20and.20wasmtime.html#310505327">(Nov 16 2022 at 21:32)</a>:</h4>
<p>can you inspect the wasm and see what the errant section is?</p>



<a name="310505699"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/WASI%2C%20wit-component%2C%20and%20wasmtime/near/310505699" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Amit Prasad <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/WASI.2C.20wit-component.2C.20and.20wasmtime.html#310505699">(Nov 16 2022 at 21:34)</a>:</h4>
<p><span class="user-mention silent" data-user-id="253994">Alex Crichton</span> <a href="#narrow/stream/206238-general/topic/WASI.2C.20wit-component.2C.20and.20wasmtime/near/310505327">said</a>:</p>
<blockquote>
<p>can you inspect the wasm and see what the errant section is?</p>
</blockquote>
<p>There's 3 sections that are suspect at the bottom of the file, but I'm not familiar enough with the restrictions to be sure:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">(</span><span class="n">elem</span><span class="w"> </span><span class="cp">$e0</span><span class="w"> </span><span class="p">(</span><span class="kt">i32</span><span class="p">.</span><span class="k">const</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="cp">$_ZN4core3fmt3num3imp52_$LT$impl$u20$core</span><span class="o">..</span><span class="n">fmt</span><span class="o">..</span><span class="n">Display</span><span class="cp">$u20$for$u20$u32$GT$</span><span class="mi">3</span><span class="n">fmt17h88dfc9d9c4113c02E</span><span class="w"> </span><span class="cp">$_ZN3std5alloc24default_alloc_error_hook17hc8ab192ba9aa1aafE</span><span class="w"> </span><span class="cp">$_ZN4core3ptr100drop_in_place$LT$$RF$mut$u20$std</span><span class="o">..</span><span class="n">io</span><span class="o">..</span><span class="n">Write</span><span class="o">..</span><span class="n">write_fmt</span><span class="o">..</span><span class="n">Adapter</span><span class="cp">$LT$alloc</span><span class="o">..</span><span class="n">vec</span><span class="o">..</span><span class="nb">Vec</span><span class="cp">$LT$u8$GT$$GT$$GT$</span><span class="mi">17</span><span class="n">h78793134c92f917cE</span><span class="w"> </span><span class="cp">$_ZN50_$LT$$RF$mut$u20$W$u20$as$u20$core</span><span class="o">..</span><span class="n">fmt</span><span class="o">..</span><span class="n">Write</span><span class="cp">$GT$</span><span class="mi">9</span><span class="n">write_str17hd5c4483eeaa72ff3E</span><span class="w"> </span><span class="cp">$_ZN50_$LT$$RF$mut$u20$W$u20$as$u20$core</span><span class="o">..</span><span class="n">fmt</span><span class="o">..</span><span class="n">Write</span><span class="cp">$GT$</span><span class="mi">10</span><span class="n">write_char17h1c5b4e9434b25fcfE</span><span class="w"> </span><span class="cp">$_ZN50_$LT$$RF$mut$u20$W$u20$as$u20$core</span><span class="o">..</span><span class="n">fmt</span><span class="o">..</span><span class="n">Write</span><span class="cp">$GT$</span><span class="mi">9</span><span class="n">write_fmt17h3222e8521d113317E</span><span class="w"> </span><span class="cp">$_ZN4core3ptr226drop_in_place$LT$std</span><span class="o">..</span><span class="n">error</span><span class="o">..</span><span class="cp">$LT$impl$u20$core</span><span class="o">..</span><span class="n">convert</span><span class="o">..</span><span class="nb">From</span><span class="cp">$LT$alloc</span><span class="o">..</span><span class="n">string</span><span class="o">..</span><span class="nb">String</span><span class="cp">$GT$$u20$for$u20$alloc</span><span class="o">..</span><span class="n">boxed</span><span class="o">..</span><span class="nb">Box</span><span class="cp">$LT$dyn$u20$std</span><span class="o">..</span><span class="n">error</span><span class="o">..</span><span class="n">Error</span><span class="cp">$u2b$core</span><span class="o">..</span><span class="n">marker</span><span class="o">..</span><span class="nb">Send</span><span class="cp">$u2b$core</span><span class="o">..</span><span class="n">marker</span><span class="o">..</span><span class="nb">Sync</span><span class="cp">$GT$$GT$</span><span class="o">..</span><span class="n">from</span><span class="o">..</span><span class="n">StringError</span><span class="cp">$GT$</span><span class="mi">17</span><span class="n">h994e3ac4e313ea83E</span><span class="w"> </span><span class="cp">$_ZN36_$LT$T$u20$as$u20$core</span><span class="o">..</span><span class="n">any</span><span class="o">..</span><span class="n">Any</span><span class="cp">$GT$</span><span class="mi">7</span><span class="n">type_id17hc9db988414a5dba8E</span><span class="w"> </span><span class="cp">$_ZN36_$LT$T$u20$as$u20$core</span><span class="o">..</span><span class="n">any</span><span class="o">..</span><span class="n">Any</span><span class="cp">$GT$</span><span class="mi">7</span><span class="n">type_id17h4500e4d02ebf2b65E</span><span class="w"> </span><span class="cp">$_ZN4core3ptr70drop_in_place$LT$std</span><span class="o">..</span><span class="n">panicking</span><span class="o">..</span><span class="n">begin_panic_handler</span><span class="o">..</span><span class="n">PanicPayload</span><span class="cp">$GT$</span><span class="mi">17</span><span class="n">h2e7bd6e17b28fee8E</span><span class="w"> </span><span class="cp">$_ZN90_$LT$std</span><span class="o">..</span><span class="n">panicking</span><span class="o">..</span><span class="n">begin_panic_handler</span><span class="o">..</span><span class="n">PanicPayload</span><span class="cp">$u20$as$u20$core</span><span class="o">..</span><span class="n">panic</span><span class="o">..</span><span class="n">BoxMeUp</span><span class="cp">$GT$</span><span class="mi">8</span><span class="n">take_box17h5b55a07cbffecc39E</span><span class="w"> </span><span class="cp">$_ZN90_$LT$std</span><span class="o">..</span><span class="n">panicking</span><span class="o">..</span><span class="n">begin_panic_handler</span><span class="o">..</span><span class="n">PanicPayload</span><span class="cp">$u20$as$u20$core</span><span class="o">..</span><span class="n">panic</span><span class="o">..</span><span class="n">BoxMeUp</span><span class="cp">$GT$</span><span class="mi">3</span><span class="n">get17h9c66d8b85c21797fE</span><span class="w"> </span><span class="cp">$_ZN93_$LT$std</span><span class="o">..</span><span class="n">panicking</span><span class="o">..</span><span class="n">begin_panic_handler</span><span class="o">..</span><span class="n">StrPanicPayload</span><span class="cp">$u20$as$u20$core</span><span class="o">..</span><span class="n">panic</span><span class="o">..</span><span class="n">BoxMeUp</span><span class="cp">$GT$</span><span class="mi">8</span><span class="n">take_box17h35a36835c420c8e2E</span><span class="w"> </span><span class="cp">$_ZN93_$LT$std</span><span class="o">..</span><span class="n">panicking</span><span class="o">..</span><span class="n">begin_panic_handler</span><span class="o">..</span><span class="n">StrPanicPayload</span><span class="cp">$u20$as$u20$core</span><span class="o">..</span><span class="n">panic</span><span class="o">..</span><span class="n">BoxMeUp</span><span class="cp">$GT$</span><span class="mi">3</span><span class="n">get17h9bbdbf24fa06448aE</span><span class="w"> </span><span class="cp">$_ZN4core3ops8function6FnOnce9call_once17h2f0f4071af505877E</span><span class="w"> </span><span class="cp">$_ZN4core3ptr102drop_in_place$LT$$RF$core</span><span class="o">..</span><span class="n">iter</span><span class="o">..</span><span class="n">adapters</span><span class="o">..</span><span class="n">copied</span><span class="o">..</span><span class="n">Copied</span><span class="cp">$LT$core</span><span class="o">..</span><span class="n">slice</span><span class="o">..</span><span class="n">iter</span><span class="o">..</span><span class="n">Iter</span><span class="cp">$LT$u8$GT$$GT$$GT$</span><span class="mi">17</span><span class="n">ha30bd7eefcc06f5fE</span><span class="w"> </span><span class="cp">$_ZN36_$LT$T$u20$as$u20$core</span><span class="o">..</span><span class="n">any</span><span class="o">..</span><span class="n">Any</span><span class="cp">$GT$</span><span class="mi">7</span><span class="n">type_id17h892b8673ce75b752E</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="cp">$d0</span><span class="w"> </span><span class="p">(</span><span class="kt">i32</span><span class="p">.</span><span class="k">const</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="s">"</span><span class="se">\0</span><span class="s">3</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">4</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">4</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">4</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">5</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">6</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0called `Option::unwrap()` on a `None` valuememory allocation of  bytes failed</span><span class="se">\0</span><span class="s">a</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0C</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0\15</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0X</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">e</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0library/std/src/alloc.rsx</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0\18</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0R</span><span class="se">\0</span><span class="s">1</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">9</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0library/std/src/panicking.rs\a0</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0\1c</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0F</span><span class="se">\0</span><span class="s">2</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0\1f</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0\a0</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0\1c</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0G</span><span class="se">\0</span><span class="s">2</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0\1e</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">7</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">c</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">4</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">8</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">3</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">8</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">4</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">9</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">a</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0\10</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">4</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">b</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">c</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">3</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">8</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">4</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">d</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">e</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0library/alloc/src/raw_vec.rscapacity overflow</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0@</span><span class="se">\0</span><span class="s">1</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0\11</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0$</span><span class="se">\0</span><span class="s">1</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0\1c</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">6</span><span class="se">\0</span><span class="s">2</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">5</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0\10</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">1</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0\11</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">0</span><span class="se">\0</span><span class="s">000010203040506070809101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899"</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="cp">$d1</span><span class="w"> </span><span class="p">(</span><span class="kt">i32</span><span class="p">.</span><span class="k">const</span><span class="w"> </span><span class="mi">580</span><span class="p">)</span><span class="w"> </span><span class="s">"ONLY REPEATED </span><span class="se">\0</span><span class="s">0"</span><span class="p">))</span><span class="w"></span>
</code></pre></div>



<a name="310505777"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/WASI%2C%20wit-component%2C%20and%20wasmtime/near/310505777" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Amit Prasad <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/WASI.2C.20wit-component.2C.20and.20wasmtime.html#310505777">(Nov 16 2022 at 21:35)</a>:</h4>
<p>No other data / memory sections that I can see</p>



<a name="310506069"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/WASI%2C%20wit-component%2C%20and%20wasmtime/near/310506069" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Amit Prasad <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/WASI.2C.20wit-component.2C.20and.20wasmtime.html#310506069">(Nov 16 2022 at 21:37)</a>:</h4>
<p>Oh hmm.... something seems to have fixed itself. Let me see if this works</p>



<a name="310507826"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/WASI%2C%20wit-component%2C%20and%20wasmtime/near/310507826" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Amit Prasad <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/WASI.2C.20wit-component.2C.20and.20wasmtime.html#310507826">(Nov 16 2022 at 21:49)</a>:</h4>
<p>Ok.. Seems like something to do with my cargo cache and/or some features in the <code>wit-bindgen-guest-rust</code> being enabled was screwing up the compilation process</p>
<p>Now, just have to figure out why it says that the module doesn't export a <code>cabi_realloc</code> function and we're golden</p>



<a name="310508257"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/WASI%2C%20wit-component%2C%20and%20wasmtime/near/310508257" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Amit Prasad <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/WASI.2C.20wit-component.2C.20and.20wasmtime.html#310508257">(Nov 16 2022 at 21:52)</a>:</h4>
<p>Ah, it was gated behind a feature.</p>



<a name="310508389"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/WASI%2C%20wit-component%2C%20and%20wasmtime/near/310508389" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Amit Prasad <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/WASI.2C.20wit-component.2C.20and.20wasmtime.html#310508389">(Nov 16 2022 at 21:53)</a>:</h4>
<p>Whoo! everything seems to work. Thanks all.</p>



<a name="339686586"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/WASI%2C%20wit-component%2C%20and%20wasmtime/near/339686586" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elia Bieri <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/WASI.2C.20wit-component.2C.20and.20wasmtime.html#339686586">(Mar 05 2023 at 12:21)</a>:</h4>
<p><span class="user-mention silent" data-user-id="253992">Pat Hickey</span> <a href="#narrow/stream/206238-general/topic/WASI.2C.20wit-component.2C.20and.20wasmtime/near/309902087">said</a>:</p>
<blockquote>
<p>There’s no component code in wasmtime-wasi yet, all of this is very experimental still, but when it lands as production ready code there will be a way to add it to a component Linker just like preview 1 / witx based wasi adds to a core Linker</p>
</blockquote>
<p>Are there any updates on this?</p>



<a name="339762697"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/WASI%2C%20wit-component%2C%20and%20wasmtime/near/339762697" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/WASI.2C.20wit-component.2C.20and.20wasmtime.html#339762697">(Mar 06 2023 at 01:18)</a>:</h4>
<p>Still a little ways from landing. I hope we can get it in by the end of March?</p>



<a name="339762818"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/WASI%2C%20wit-component%2C%20and%20wasmtime/near/339762818" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/WASI.2C.20wit-component.2C.20and.20wasmtime.html#339762818">(Mar 06 2023 at 01:20)</a>:</h4>
<p>Last month we ran into a handful of fun problems we never saw coming. The remaining todo list is pretty reasonable but hard to say what’s lurking</p>



<a name="339833970"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/WASI%2C%20wit-component%2C%20and%20wasmtime/near/339833970" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elia Bieri <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/WASI.2C.20wit-component.2C.20and.20wasmtime.html#339833970">(Mar 06 2023 at 10:47)</a>:</h4>
<p>Thanks for taking the time for answering.<br>
Do you have any GitHub Issue of sorts that you could point me to track the progress?<br>
I've got to make some decisions for an upcoming project and I would like to stay in the loop.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>