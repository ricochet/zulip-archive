<html>
<head><meta charset="utf-8"><title>Can WASM be compiled to a standalone binary? · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/index.html">general</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html">Can WASM be compiled to a standalone binary?</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="393495888"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393495888" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ondřej Čertík <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393495888">(Sep 27 2023 at 13:59)</a>:</h4>
<p>I know I can use <code>wasmtime compile -o expr2.cwasm expr2.wasm</code>, which will generate native machine code, however it is not a standalone binary that I can just run, it seems it still requires some kind of a runtime or other infrastructure to actually run.</p>
<p>How can I create a standalone native binary?</p>
<p>We use WASM as one of the backends in the LFortran/LPython compilers. And we wrote our own WASM-&gt;x64 binary generator that generates standalone binaries, here it is: <a href="https://github.com/lcompilers/lpython/blob/5b51c3cf8879bdd8f3c567ed38262e6b9ea55126/src/libasr/codegen/wasm_to_x64.cpp">https://github.com/lcompilers/lpython/blob/5b51c3cf8879bdd8f3c567ed38262e6b9ea55126/src/libasr/codegen/wasm_to_x64.cpp</a>. It works great, for the subset that we currently support, and it generates a native binary that you just run.</p>
<p>However, instead of us maintaining such a WASM to binary compiler, is there some tool that can do this that we could just use and collaborate on?</p>



<a name="393504323"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393504323" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393504323">(Sep 27 2023 at 14:24)</a>:</h4>
<p>I can at least confirm that Wasmtime doesn't support this feature. (it'd be neat to add though!) I'll let others chime in though if they know of tools to do this.</p>



<a name="393506488"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393506488" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393506488">(Sep 27 2023 at 14:32)</a>:</h4>
<p>It would be nice if you could deserialize a module/component by mmaping from a text section.</p>



<a name="393506886"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393506886" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393506886">(Sep 27 2023 at 14:34)</a>:</h4>
<p>Yeah, I was just going to suggest using <code>include_bytes!("path/to/cwasm")</code> in a Rust program that embeds Wasmtime.  You could do that today, but an mmap capability would make it more efficient.</p>



<a name="393508236"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393508236" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393508236">(Sep 27 2023 at 14:40)</a>:</h4>
<p>Ideally, there would be a way to do it without requiring a Rust compiler or linker to be installed, but I don't know of any such tool.  Certainly would be a fun thing to build, though.</p>



<a name="393508867"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393508867" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393508867">(Sep 27 2023 at 14:42)</a>:</h4>
<p>if you want to take this to the limit I think it would be possible to create a very stripped down Wasmtime build which support purely a single instance being created. We could probably use ELF sections to reserve space for linear memory and everything. In that sense it'd be theoretically possible to have a tiny <code>libwasmtime-exe.a</code> (or whatever) which is linked with a native linker to the <code>*.cwasm</code> we produce and then there's a whole bunch of static calls between everything.</p>
<p>That all being said it would still require a native linker and support like wasmtime-wasi so there's still a mess of runtime bits involved, and producing this artifact would be somewhat nontrivial, so probably much better to instead have a program with <code>wasmtime</code>-the-crate and the cwasm already mapped in in theory</p>



<a name="393512396"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393512396" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ondřej Čertík <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393512396">(Sep 27 2023 at 14:59)</a>:</h4>
<p>For our compiler, we need to create native binaries. We are happy to create a standalone library out of our WASM-&gt;x64 backend, I think it doesn't depend on anything, which would allow us to collaborate on it with you. We still need to add Apple M1 support, right now we only support 64bit x86.</p>
<p>In the meantime, to get started, is there some example in Rust that uses the <code>include_bytes!("path/to/cwasm")</code> trick? My understanding is that it would include the native code (<code>cwasm</code>) and then somehow run it via the wasmtime rust library? So if I compile it with cargo/rust, it will create a standalone binary? That would indeed be a big step forward to what we need, and we might be able to take it and iterate further on it.</p>



<a name="393514100"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393514100" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393514100">(Sep 27 2023 at 15:06)</a>:</h4>
<p>If you have a Rust compiler on-hand it's possible to construct a project that includes the <code>*.cwasm</code>, excludes Cranelift, and includes Wasmtime, and runs the wasm binary. My guess though is what you're looking for is probably a precompiled <code>*.a</code> which is linked with the <code>*.cwasm</code> or similar to create an executable, and that hasn't been done yet.</p>



<a name="393524277"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393524277" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ondřej Čertík <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393524277">(Sep 27 2023 at 15:58)</a>:</h4>
<blockquote>
<p>My guess though is what you're looking for is probably a precompiled *.a which is linked with the *.cwasm or similar to create an executable, and that hasn't been done yet.</p>
</blockquote>
<p>Yes, that's what I am looking for ultimately, but because it has not been done yet, the first approach is a good start:</p>
<blockquote>
<p>If you have a Rust compiler on-hand it's possible to construct a project that includes the *.cwasm, excludes Cranelift, and includes Wasmtime, and runs the wasm binary.</p>
</blockquote>
<p>Is there some example that does this?</p>



<a name="393524787"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393524787" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393524787">(Sep 27 2023 at 16:01)</a>:</h4>
<p>I just started putting an example together.  I have a meeting now, but I should be able to post a GitHub link in a couple of hours.</p>



<a name="393531764"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393531764" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ondřej Čertík <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393531764">(Sep 27 2023 at 16:40)</a>:</h4>
<p><span class="user-mention" data-user-id="509936">@Joel Dice</span> awesome, thank you, much appreciated!</p>



<a name="393532360"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393532360" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393532360">(Sep 27 2023 at 16:44)</a>:</h4>
<p>A thought: ELF allows for the concept of an "interpreter"; in the usual Linux use-case, a dynamically-linked binary names <code>/lib64/ld-linux.so</code> or whatever (the dynamic linker) as its interpreter, and the kernel leaves all the processing of the actual program ELF to that. (One can actually do <code>/lib64/ld-linux.so my-program</code>, i.e. invoke the dynamic linker as a command, and this will work.) Could we make the interpreter field in the <code>.cwasm</code> (which is actually an ELF) be wasmtime itself, and make that work somehow?</p>



<a name="393532591"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393532591" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393532591">(Sep 27 2023 at 16:46)</a>:</h4>
<p>Another variant of the idea could be to have a "CLI stub" that we prepend to the cwasm, and depend on a <a href="http://libwasmtime.so">libwasmtime.so</a></p>



<a name="393533127"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393533127" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393533127">(Sep 27 2023 at 16:49)</a>:</h4>
<p>oh man that'd be slick if you could <code>./foo.cwasm</code></p>



<a name="393535948"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393535948" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393535948">(Sep 27 2023 at 17:06)</a>:</h4>
<p>I don't think you can use a binary as its own <code>.interp</code>... <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="393536906"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393536906" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393536906">(Sep 27 2023 at 17:12)</a>:</h4>
<p>You could point at a system e.g. <code>/lib/wasmtime-ld.so</code>, but if you have that control you're probably better off using <code>binfmt_misc</code> (on linux anyway)</p>



<a name="393536991"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393536991" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393536991">(Sep 27 2023 at 17:13)</a>:</h4>
<p>ah, no, "binary as its own interpreter" isn't the suggestion, rather the .interp section in the .cwasm file</p>



<a name="393537069"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393537069" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393537069">(Sep 27 2023 at 17:13)</a>:</h4>
<p><span class="user-mention" data-user-id="654165">@Ondřej Čertík</span> here's the example I threw together: <a href="https://github.com/dicej/cwasm-standalone">https://github.com/dicej/cwasm-standalone</a>.  It uses Wasmtime 13's snapshot of WASI Preview 2, based on the component model.  You could alternatively do the same thing using WASI Preview 1 with a cwasm based on a core module if you preferred.  Happy to answer any questions about it.</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/dicej/cwasm-standalone" style="background-image: url(https\:\/\/uploads\.zulipusercontent\.net\/6bbfc8cde89dd03f4396906fddd3b01359105e40\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f316630363564313138353162356461663738643534303937383339343063666361306430643865376435313038626635653338663264386566626132623234632f646963656a2f637761736d2d7374616e64616c6f6e65)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/dicej/cwasm-standalone" title="GitHub - dicej/cwasm-standalone">GitHub - dicej/cwasm-standalone</a></div><div class="message_embed_description">Contribute to dicej/cwasm-standalone development by creating an account on GitHub.</div></div></div>



<a name="393537222"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393537222" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393537222">(Sep 27 2023 at 17:14)</a>:</h4>
<p>Right but what would you put in the .cwasm's <code>.interp</code> for wasmtime?</p>



<a name="393541236"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393541236" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393541236">(Sep 27 2023 at 17:42)</a>:</h4>
<p><span class="user-mention" data-user-id="480579">@Lann Martin</span> the interp field in the .cwasm would be <code>/usr/bin/wasmtime</code> or similar (perhaps <code>libwasmtime.so</code> if it has to be a shared object, though I think PIE executables are also technically shared objects these days)</p>



<a name="393548609"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393548609" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393548609">(Sep 27 2023 at 18:28)</a>:</h4>
<p>One annoying thing about using <code>.interp</code> is that that would mean you don't get to use the usual ld-linux*.so, which means you can't easily dynamically link to any other libraries.</p>



<a name="393548713"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393548713" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393548713">(Sep 27 2023 at 18:28)</a>:</h4>
<p>An alternative would be to just make .cwasm files depend on <code>libwasmtime.so</code> as a normal dynamic library.</p>



<a name="393555956"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393555956" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393555956">(Sep 27 2023 at 19:17)</a>:</h4>
<p>It sounds like the two major things we'd need to do that are (i) have a main() stub that we prepend, basically <span class="user-mention" data-user-id="509936">@Joel Dice</span> 's thing above; and (ii) emit PLT relocs for libcalls?</p>



<a name="393572581"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393572581" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ondřej Čertík <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393572581">(Sep 27 2023 at 21:23)</a>:</h4>
<p><span class="user-mention" data-user-id="509936">@Joel Dice</span> beautiful, thank you! That's exactly what I wanted. I tried it, it works. I then tried my own WASM file, so far I didn't succeed, here is exactly what I tried: <a href="https://github.com/dicej/cwasm-standalone/issues/1">https://github.com/dicej/cwasm-standalone/issues/1</a>, if you see what I am doing wrong, let me know.</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/dicej/cwasm-standalone/issues/1" style="background-image: url(https\:\/\/uploads\.zulipusercontent\.net\/7ce31a9ff89f66de38a9f3a12ef221f3c71eadb6\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f303662616439383939653137353235633039626236353763383333643561623230303938646139653338343264633430643433663533373061313866333435622f646963656a2f637761736d2d7374616e64616c6f6e652f6973737565732f31)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/dicej/cwasm-standalone/issues/1" title="Using a custom wasm program · Issue #1 · dicej/cwasm-standalone">Using a custom wasm program · Issue #1 · dicej/cwasm-standalone</a></div><div class="message_embed_description">Here is what I tried: diff --git a/src/main.rs b/src/main.rs index 9f17a93..e4c0ec4 100644 --- a/src/main.rs +++ b/src/main.rs @@ -97,7 +97,8 @@ fn main() -&gt; Result&lt;()&gt; { &amp;unsafe { Component::deser...</div></div></div>



<a name="393573196"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393573196" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393573196">(Sep 27 2023 at 21:28)</a>:</h4>
<p>I assume the g2.wasm in your example is a core module rather than a component (i.e. a file conforming to <a href="https://github.com/WebAssembly/component-model">https://github.com/WebAssembly/component-model</a>)?  They both use the .wasm file extension, but the latter is a superset of the former.  My example involves pre-compiling a component at build time, and the runtime code expects a cwasm file containing a pre-compiled component.  If it gets a core module, it won't accept it.  If you change the runtime code to use the Wasmtime module API instead of the component API, you can make it run a core module instead.</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/WebAssembly/component-model" style="background-image: url(https\:\/\/uploads\.zulipusercontent\.net\/4242dad949c379ea56878049272ce424aad15ebc\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f656666323132363238623237393530313963663432356639396635396664353662643139653730616130303138376535326161653962333262383863366337622f576562417373656d626c792f636f6d706f6e656e742d6d6f64656c)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/WebAssembly/component-model" title="GitHub - WebAssembly/component-model: Repository for design and specification of the Component Model">GitHub - WebAssembly/component-model: Repository for design and specification of the Component Model</a></div><div class="message_embed_description">Repository for design and specification of the Component Model - GitHub - WebAssembly/component-model: Repository for design and specification of the Component Model</div></div></div>



<a name="393573448"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393573448" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393573448">(Sep 27 2023 at 21:30)</a>:</h4>
<p>When I get a chance, I can create a branch that uses WASI Preview 1 and a core module instead of a component.</p>



<a name="393573457"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393573457" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ondřej Čertík <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393573457">(Sep 27 2023 at 21:30)</a>:</h4>
<p><span class="user-mention" data-user-id="509936">@Joel Dice</span> here is our code: <a href="https://github.com/dicej/cwasm-standalone/issues/1#issuecomment-1738103929">https://github.com/dicej/cwasm-standalone/issues/1#issuecomment-1738103929</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/dicej/cwasm-standalone/issues/1#issuecomment-1738103929" style="background-image: url(https\:\/\/uploads\.zulipusercontent\.net\/3ad698a35a765fe487c0e5736bc58708c84c9fdd\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f366437393265633161326365623530633335396334373130643563616164366262356234346230633239666561336136336431383932336238353465623133632f646963656a2f637761736d2d7374616e64616c6f6e652f6973737565732f31)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/dicej/cwasm-standalone/issues/1#issuecomment-1738103929" title="Using a custom wasm program · Issue #1 · dicej/cwasm-standalone">Using a custom wasm program · Issue #1 · dicej/cwasm-standalone</a></div><div class="message_embed_description">Here is what I tried: diff --git a/src/main.rs b/src/main.rs index 9f17a93..e4c0ec4 100644 --- a/src/main.rs +++ b/src/main.rs @@ -97,7 +97,8 @@ fn main() -&gt; Result&lt;()&gt; { &amp;unsafe { Component::deser...</div></div></div>



<a name="393573540"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393573540" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393573540">(Sep 27 2023 at 21:30)</a>:</h4>
<p>yeah, that's a core module</p>



<a name="393573602"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393573602" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ondřej Čertík <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393573602">(Sep 27 2023 at 21:31)</a>:</h4>
<p>I am not well-versed in WASM, we just read the spec, produced the binary ourselves and then used wasmtime and nodejs in our tests, and we use WASI preview1. So we are using "core module" it seems. What should we be using?</p>



<a name="393573744"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393573744" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393573744">(Sep 27 2023 at 21:32)</a>:</h4>
<p>Core module is fine -- it's just that I've been working on WASI Preview 2 and the component model lately, so that's what I defaulted to.  I'll post a link to a version that uses core modules.</p>



<a name="393573784"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393573784" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ondřej Čertík <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393573784">(Sep 27 2023 at 21:32)</a>:</h4>
<p>Very good, thank you.</p>



<a name="393573861"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393573861" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ondřej Čertík <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393573861">(Sep 27 2023 at 21:33)</a>:</h4>
<p><span class="user-mention" data-user-id="509936">@Joel Dice</span> we use our custom WASM backend in order to have quick compilation and runtime at <a href="https://dev.lfortran.org/">https://dev.lfortran.org/</a> and <a href="https://dev.lpython.org/">https://dev.lpython.org/</a>. That would not be possible with using LLVM (too big and slow).</p>



<a name="393574035"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393574035" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ondřej Čertík <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393574035">(Sep 27 2023 at 21:34)</a>:</h4>
<p>Separately we also want a direct x86 (and arm) binary generation, not using LLVM, for Debug builds which require very fast compilation. So we thought why not use our WASM backend and just write the WASM-&gt;binary part? So we did exactly that, so far it seems very simple and maintainable.</p>



<a name="393574697"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393574697" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ondřej Čertík <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393574697">(Sep 27 2023 at 21:40)</a>:</h4>
<p>Are you saying that the "component" is a subset of the "core module"? So it seems we should be using a "component"? For our use case (see my last comment), our main goal is to piggyback (and be compatible) with the state-of-the-art and all the WASM tooling, that way we only have to maintain what is specific to our compilers, the rest we can maintain collaboratively with the WASM community, which seems like a win-win.</p>



<a name="393575276"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393575276" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393575276">(Sep 27 2023 at 21:46)</a>:</h4>
<p>Components are a <em>superset</em> of core modules. Some relatively easy reading here: <a href="https://github.com/WebAssembly/component-model/tree/main/design/high-level">https://github.com/WebAssembly/component-model/tree/main/design/high-level</a></p>



<a name="393575292"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393575292" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393575292">(Sep 27 2023 at 21:46)</a>:</h4>
<p>(less-easy reading elsewhere in that repo <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span>)</p>



<a name="393575327"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393575327" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393575327">(Sep 27 2023 at 21:47)</a>:</h4>
<p>First: yes, I've read about LFortran and LPython and I think they're super exciting projects.  I'm especially eager to see SciPy, OpenBLAS, etc. supported.</p>
<p>The component model can be considered a superset of the core WebAssembly specification.  There's a tool called <code>wit-component</code> (part of <code>wasm-tools</code>) that will automatically convert from a WASI Preview 1 core module to a WASI Preview 2 component.  For the time being, it's totally fine if your toolchain only targets WASI Preview 1, since you (or your users) can always use <code>wit-component</code> to turn that Preview 1 module into a Preview 2 component.  Eventually, you'll want to consider targetting Preview 2 and the component model directly, but it's not released yet, so no hurry :)</p>



<a name="393575402"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393575402" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ondřej Čertík <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393575402">(Sep 27 2023 at 21:47)</a>:</h4>
<p>Ah, so let me install wit-component, and try it!</p>



<a name="393575485"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393575485" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393575485">(Sep 27 2023 at 21:48)</a>:</h4>
<p>If you have Rust, you can <code>cargo install wasm-tools</code></p>



<a name="393575604"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393575604" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393575604">(Sep 27 2023 at 21:49)</a>:</h4>
<p>When using <code>wit-component</code>, you'll need to specify which WASI adapter to use.  You'll want to use <a href="https://github.com/bytecodealliance/wasmtime/releases/download/v13.0.0/wasi_snapshot_preview1.command.wasm">https://github.com/bytecodealliance/wasmtime/releases/download/v13.0.0/wasi_snapshot_preview1.command.wasm</a> in order to make the component compatible with Wasmtime 13, which is what my example above uses.</p>



<a name="393575719"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393575719" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393575719">(Sep 27 2023 at 21:50)</a>:</h4>
<p>Since Preview 2 hasn't stabilized yet, it's still changing from one release to the next, so the adapter needs to match the host implementation in Wasmtime.</p>



<a name="393575795"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393575795" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393575795">(Sep 27 2023 at 21:51)</a>:</h4>
<p>More introductory docs, for reference: <a href="https://component-model.bytecodealliance.org/">https://component-model.bytecodealliance.org/</a></p>



<a name="393576336"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393576336" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ondřej Čertík <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393576336">(Sep 27 2023 at 21:57)</a>:</h4>
<p>On it!</p>



<a name="393576378"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393576378" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ondřej Čertík <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393576378">(Sep 27 2023 at 21:57)</a>:</h4>
<p>(Yes, we are making excellent progress with compiling SciPy, can now fully compile several of the Fortran modules via our LLVM backend, and all SciPy tests pass.)</p>



<a name="393576505"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393576505" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ondřej Čertík <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393576505">(Sep 27 2023 at 21:58)</a>:</h4>
<p>Ok, I have <code>.cargo/bin/wasm-tools</code> but not <code>.cargo/bin/wit-component</code></p>



<a name="393577312"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393577312" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ondřej Čertík <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393577312">(Sep 27 2023 at 22:07)</a>:</h4>
<p>ok, figured it out: <a href="https://crates.io/crates/wit-component">https://crates.io/crates/wit-component</a>, <code>wasm-tools component new core.wasm -o component.wasm</code></p>



<a name="393577727"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393577727" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ondřej Čertík <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393577727">(Sep 27 2023 at 22:11)</a>:</h4>
<p>The <code>wit-component</code> gives me an error message: <a href="https://github.com/dicej/cwasm-standalone/issues/1#issuecomment-1738151203">https://github.com/dicej/cwasm-standalone/issues/1#issuecomment-1738151203</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/dicej/cwasm-standalone/issues/1#issuecomment-1738151203" style="background-image: url(https\:\/\/uploads\.zulipusercontent\.net\/20434c631ea31de586224c1453d5e9d6e09eef1b\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f356436613031316661386230313762393263626164343336643866613837313464636238623030303734633832373835303661303438373734326530623836312f646963656a2f637761736d2d7374616e64616c6f6e652f6973737565732f31)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/dicej/cwasm-standalone/issues/1#issuecomment-1738151203" title="Using a custom wasm program · Issue #1 · dicej/cwasm-standalone">Using a custom wasm program · Issue #1 · dicej/cwasm-standalone</a></div><div class="message_embed_description">Here is what I tried: diff --git a/src/main.rs b/src/main.rs index 9f17a93..e4c0ec4 100644 --- a/src/main.rs +++ b/src/main.rs @@ -97,7 +97,8 @@ fn main() -&gt; Result&lt;()&gt; { &amp;unsafe { Component::deser...</div></div></div>



<a name="393578114"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393578114" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393578114">(Sep 27 2023 at 22:15)</a>:</h4>
<p>That's what I was saying about the adapter above.  Download that wasi_snapshot_preview1.command.wasm file I linked to and pass it as an <code>--adapter</code> argument to <code>wasm-tools component new</code>.<br>
I'm almost finished with the module version of <code>cwasm-standalone</code>, BTW.</p>



<a name="393578394"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393578394" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ondřej Čertík <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393578394">(Sep 27 2023 at 22:18)</a>:</h4>
<p>The conversion worked, thanks!</p>



<a name="393579297"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393579297" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393579297">(Sep 27 2023 at 22:27)</a>:</h4>
<p>The modules branch uses WASI Preview 1 modules: <a href="https://github.com/dicej/cwasm-standalone/tree/modules">https://github.com/dicej/cwasm-standalone/tree/modules</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/dicej/cwasm-standalone/tree/modules" style="background-image: url(https\:\/\/uploads\.zulipusercontent\.net\/da659ffd2136a09b8196e894539c8c64aa425b1f\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f633664613365343631396161323335653632373635373038393533623133393738653163386363343339393234383633616239323863383230376166616138662f646963656a2f637761736d2d7374616e64616c6f6e65)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/dicej/cwasm-standalone/tree/modules" title="GitHub - dicej/cwasm-standalone at modules">GitHub - dicej/cwasm-standalone at modules</a></div><div class="message_embed_description">Contribute to dicej/cwasm-standalone development by creating an account on GitHub.</div></div></div>



<a name="393579796"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393579796" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ondřej Čertík <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393579796">(Sep 27 2023 at 22:32)</a>:</h4>
<p>Let me try it. I can't figure out how to compile the component to cwasm: <a href="https://github.com/dicej/cwasm-standalone/issues/1#issuecomment-1738177031">https://github.com/dicej/cwasm-standalone/issues/1#issuecomment-1738177031</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/dicej/cwasm-standalone/issues/1#issuecomment-1738177031" style="background-image: url(https\:\/\/uploads\.zulipusercontent\.net\/05d778469e6787d517db4759b55dec6830e87a03\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f356566613666386261343665626430373232376565633762626163633432306135666334393336343137393163323731643961313165616637356634396130622f646963656a2f637761736d2d7374616e64616c6f6e652f6973737565732f31)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/dicej/cwasm-standalone/issues/1#issuecomment-1738177031" title="Using a custom wasm program · Issue #1 · dicej/cwasm-standalone">Using a custom wasm program · Issue #1 · dicej/cwasm-standalone</a></div><div class="message_embed_description">Here is what I tried: diff --git a/src/main.rs b/src/main.rs index 9f17a93..e4c0ec4 100644 --- a/src/main.rs +++ b/src/main.rs @@ -97,7 +97,8 @@ fn main() -&gt; Result&lt;()&gt; { &amp;unsafe { Component::deser...</div></div></div>



<a name="393580194"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393580194" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393580194">(Sep 27 2023 at 22:36)</a>:</h4>
<p>You'll probably need a build of Wasmtime with the "component-model" feature enabled (e.g. <code>cargo install wasmtime-cli --features component-model</code>) in order to compile components to cwasm files.</p>



<a name="393580239"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393580239" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ondřej Čertík <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393580239">(Sep 27 2023 at 22:37)</a>:</h4>
<p>I did.</p>



<a name="393580262"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393580262" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393580262">(Sep 27 2023 at 22:37)</a>:</h4>
<p>hmm, maybe the CLI doesn't support it yet</p>



<a name="393580267"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393580267" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ondřej Čertík <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393580267">(Sep 27 2023 at 22:37)</a>:</h4>
<p>Regarding your <code>modules</code> branch, here are my results: <a href="https://github.com/dicej/cwasm-standalone/issues/2">https://github.com/dicej/cwasm-standalone/issues/2</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/dicej/cwasm-standalone/issues/2" style="background-image: url(https\:\/\/uploads\.zulipusercontent\.net\/e55a2ebb496b7afb995e811ed7b53889aaa49fd6\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f373133393263376635373233353839333534613839623337356361313230383965613533653062326433306638623561313937626231383966313032386662612f646963656a2f637761736d2d7374616e64616c6f6e652f6973737565732f32)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/dicej/cwasm-standalone/issues/2" title="Using preview1 core module · Issue #2 · dicej/cwasm-standalone">Using preview1 core module · Issue #2 · dicej/cwasm-standalone</a></div><div class="message_embed_description">Using the modules branch, commit 59c1481. diff --git a/src/main.rs b/src/main.rs index 9f17a93..e4c0ec4 100644 --- a/src/main.rs +++ b/src/main.rs @@ -97,7 +97,8 @@ fn main() -&gt; Result&lt;()&gt; { &amp;unsaf...</div></div></div>



<a name="393580383"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393580383" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393580383">(Sep 27 2023 at 22:39)</a>:</h4>
<p>ah, that should be easy to address.  An exit status of zero should just be ignored.  I'll take a look</p>



<a name="393580412"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393580412" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ondřej Čertík <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393580412">(Sep 27 2023 at 22:39)</a>:</h4>
<p>The wasm module works in wasmtime, so it should be good.</p>



<a name="393580561"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393580561" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393580561">(Sep 27 2023 at 22:41)</a>:</h4>
<p>Yeah, I just pushed a change.  Please try the latest on the <code>modules</code> branch.</p>



<a name="393580601"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393580601" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ondřej Čertík <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393580601">(Sep 27 2023 at 22:41)</a>:</h4>
<p>checking...</p>



<a name="393580665"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393580665" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ondřej Čertík <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393580665">(Sep 27 2023 at 22:42)</a>:</h4>
<p>It works!!</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">cargo</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">--</span><span class="n">release</span>
<span class="w">   </span><span class="n">Compiling</span><span class="w"> </span><span class="n">cwasm</span><span class="o">-</span><span class="n">standalone</span><span class="w"> </span><span class="n">v0</span><span class="p">.</span><span class="mf">1.0</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">ondrej</span><span class="o">/</span><span class="n">repos</span><span class="o">/</span><span class="n">cwasm</span><span class="o">-</span><span class="n">standalone</span><span class="p">)</span>
<span class="w">    </span><span class="n">Finished</span><span class="w"> </span><span class="n">release</span><span class="w"> </span><span class="p">[</span><span class="n">optimized</span><span class="p">]</span><span class="w"> </span><span class="n">target</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mf">4.27</span><span class="n">s</span>
<span class="w">     </span><span class="n">Running</span><span class="w"> </span><span class="err">`</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">ondrej</span><span class="o">/</span><span class="n">repos</span><span class="o">/</span><span class="n">cwasm</span><span class="o">-</span><span class="n">standalone</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">cwasm</span><span class="o">-</span><span class="n">standalone</span><span class="err">`</span>
<span class="mi">25</span>
</code></pre></div>



<a name="393580719"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393580719" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ondřej Čertík <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393580719">(Sep 27 2023 at 22:43)</a>:</h4>
<p>Thank you so much for this <span class="user-mention" data-user-id="509936">@Joel Dice</span> ! I think this is solid:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">otool</span><span class="w"> </span><span class="o">-</span><span class="n">L</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">ondrej</span><span class="o">/</span><span class="n">repos</span><span class="o">/</span><span class="n">cwasm</span><span class="o">-</span><span class="n">standalone</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">cwasm</span><span class="o">-</span><span class="n">standalone</span>
<span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">ondrej</span><span class="o">/</span><span class="n">repos</span><span class="o">/</span><span class="n">cwasm</span><span class="o">-</span><span class="n">standalone</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">cwasm</span><span class="o">-</span><span class="n">standalone</span>:
    <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">libiconv</span><span class="p">.</span><span class="mf">2.</span><span class="n">dylib</span><span class="w"> </span><span class="p">(</span><span class="n">compatibility</span><span class="w"> </span><span class="n">version</span><span class="w"> </span><span class="mf">7.0.0</span><span class="p">,</span><span class="w"> </span><span class="n">current</span><span class="w"> </span><span class="n">version</span><span class="w"> </span><span class="mf">7.0.0</span><span class="p">)</span>
<span class="w">    </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">libSystem</span><span class="p">.</span><span class="n">B</span><span class="p">.</span><span class="n">dylib</span><span class="w"> </span><span class="p">(</span><span class="n">compatibility</span><span class="w"> </span><span class="n">version</span><span class="w"> </span><span class="mf">1.0.0</span><span class="p">,</span><span class="w"> </span><span class="n">current</span><span class="w"> </span><span class="n">version</span><span class="w"> </span><span class="mf">1311.0.0</span><span class="p">)</span>
</code></pre></div>
<p>and</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">ll</span><span class="w"> </span><span class="o">-</span><span class="n">h</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">ondrej</span><span class="o">/</span><span class="n">repos</span><span class="o">/</span><span class="n">cwasm</span><span class="o">-</span><span class="n">standalone</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">cwasm</span><span class="o">-</span><span class="n">standalone</span>
<span class="o">-</span><span class="n">rwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="w">  </span><span class="mi">1</span><span class="w"> </span><span class="n">ondrej</span><span class="w">  </span><span class="n">staff</span><span class="w">   </span><span class="mf">4.6</span><span class="n">M</span><span class="w"> </span><span class="n">Sep</span><span class="w"> </span><span class="mi">27</span><span class="w"> </span><span class="mi">16</span>:<span class="mi">42</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">ondrej</span><span class="o">/</span><span class="n">repos</span><span class="o">/</span><span class="n">cwasm</span><span class="o">-</span><span class="n">standalone</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">cwasm</span><span class="o">-</span><span class="n">standalone</span>
</code></pre></div>



<a name="393580748"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393580748" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ondřej Čertík <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393580748">(Sep 27 2023 at 22:43)</a>:</h4>
<p>I am on Apple M1 Max.</p>



<a name="393580774"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393580774" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393580774">(Sep 27 2023 at 22:44)</a>:</h4>
<p>could try using <code>strip</code> to get it a bit smaller, maybe</p>



<a name="393580816"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393580816" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ondřej Čertík <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393580816">(Sep 27 2023 at 22:44)</a>:</h4>
<p>I think this is the first time that we created a binary out of LFortran on M1 without LLVM.</p>



<a name="393580823"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393580823" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ondřej Čertík <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393580823">(Sep 27 2023 at 22:44)</a>:</h4>
<p>And without our C backend.</p>



<a name="393580891"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393580891" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ondřej Čertík <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393580891">(Sep 27 2023 at 22:45)</a>:</h4>
<p>After <code>strip</code>:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">ll</span><span class="w"> </span><span class="o">-</span><span class="n">h</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">ondrej</span><span class="o">/</span><span class="n">repos</span><span class="o">/</span><span class="n">cwasm</span><span class="o">-</span><span class="n">standalone</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">cwasm</span><span class="o">-</span><span class="n">standalone</span>
<span class="o">-</span><span class="n">rwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="w">  </span><span class="mi">1</span><span class="w"> </span><span class="n">ondrej</span><span class="w">  </span><span class="n">staff</span><span class="w">   </span><span class="mf">3.3</span><span class="n">M</span><span class="w"> </span><span class="n">Sep</span><span class="w"> </span><span class="mi">27</span><span class="w"> </span><span class="mi">16</span>:<span class="mi">45</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">ondrej</span><span class="o">/</span><span class="n">repos</span><span class="o">/</span><span class="n">cwasm</span><span class="o">-</span><span class="n">standalone</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">cwasm</span><span class="o">-</span><span class="n">standalone</span>
</code></pre></div>



<a name="393581022"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393581022" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ondřej Čertík <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393581022">(Sep 27 2023 at 22:46)</a>:</h4>
<p><span class="user-mention" data-user-id="509936">@Joel Dice</span> one more question --- for Debug builds that I just want as fast as possible to compile (but it's ok if it runs slower), this technology seems perfect. But for Release builds, where I want maximum performance at runtime --- can WASM, once the tooling is fully developed, match the performance of LLVM?</p>



<a name="393581179"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393581179" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393581179">(Sep 27 2023 at 22:48)</a>:</h4>
<p>Someone on the Cranelift team, e.g. <span class="user-mention" data-user-id="254389">@Chris Fallin</span> would be a better person to ask.  I imagine "it depends" <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="393581209"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393581209" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ondřej Čertík <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393581209">(Sep 27 2023 at 22:49)</a>:</h4>
<p>(I guess this cwasm-standalone is being compiled via rust, so it uses LLVM. However, the main code itself is just an ARM binary that wasmtime compiled from WASM, without any LLVM involved.)</p>



<a name="393581243"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393581243" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393581243">(Sep 27 2023 at 22:49)</a>:</h4>
<p>right, it's the cwasm performance you care about, presumably</p>



<a name="393581334"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393581334" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ondřej Čertík <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393581334">(Sep 27 2023 at 22:50)</a>:</h4>
<p>For Debug build I care about the performance of generating this small <code>/Users/ondrej/repos/cwasm-standalone/target/release/cwasm-standalone</code> binary.</p>



<a name="393581355"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393581355" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ondřej Čertík <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393581355">(Sep 27 2023 at 22:50)</a>:</h4>
<p>Right now it's slow, since rustc is involved, but that's only the first step (the initial prototype).</p>



<a name="393581408"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393581408" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ondřej Čertík <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393581408">(Sep 27 2023 at 22:51)</a>:</h4>
<p>This is nice, I think we can start testing with this at our CI.</p>



<a name="393581454"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393581454" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ondřej Čertík <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393581454">(Sep 27 2023 at 22:51)</a>:</h4>
<p>What is wasmtime doing in this cwasm "driver"? Is it just just supplying the WASI imports?</p>



<a name="393581470"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393581470" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ondřej Čertík <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393581470">(Sep 27 2023 at 22:52)</a>:</h4>
<p>And providing some "main" stub?</p>



<a name="393581506"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393581506" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393581506">(Sep 27 2023 at 22:52)</a>:</h4>
<p>Cranelift won't perform optimizatuons at this time such as loop unrolling, vectorization, or inlining, so it's expected that llvm binaries will generally be faster.</p>
<p>Currently a lot of wasms are such that they are produced by llvm and cranelift takes optimized wasm and generates good code, and there we aim to be on the same level as llvm (somewhat). Definitely cranelift aims to match the optimizing tiers of peer jits like spidermonkey and v8</p>



<a name="393581550"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393581550" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ondřej Čertík <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393581550">(Sep 27 2023 at 22:52)</a>:</h4>
<p><span class="user-mention" data-user-id="253994">@Alex Crichton</span> awesome. LFortran will eventually be able to produce optimized WASM binary. We are implementing unrolling, vectorization and inlining right now.</p>



<a name="393581571"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393581571" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ondřej Čertík <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393581571">(Sep 27 2023 at 22:53)</a>:</h4>
<p>So I think with cranelift this might be quite competitive!</p>



<a name="393581604"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393581604" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393581604">(Sep 27 2023 at 22:53)</a>:</h4>
<blockquote>
<p>can WASM, once the tooling is fully developed, match the performance of LLVM?</p>
</blockquote>
<p>Within some margin, yeah -- there are two separate sources of the perf gap:</p>
<ul>
<li>Fundamental sandboxing overhead -- this is due to the need to bounds-check memory accesses (either with explicit compare-and-branch, or by adding a base pointer to access offsets in a 4GiB region; both have costs, the latter much less), to ensure control-flow integrity (check every 'switch'; there are no indirect branches), to check for stack overflow</li>
<li>Compiler quality: as Alex mentions, Cranelift is targeting a different point. Eventually we could have better optimizations, with enough effort, under an optional setting; but keep in mind that LLVM is thousands of person-years of work at this point and Cranelift is like... three to seven engineers in a trenchcoat with a faded Firefox logo</li>
</ul>



<a name="393581715"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393581715" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ondřej Čertík <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393581715">(Sep 27 2023 at 22:54)</a>:</h4>
<p><span class="user-mention" data-user-id="254389">@Chris Fallin</span> thanks! Why not optionally turn off sandboxing when performance is required?</p>



<a name="393581716"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393581716" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393581716">(Sep 27 2023 at 22:54)</a>:</h4>
<p>The latter can be improved, the former will always be there as "the cost of sandboxing"; I've seen it estimated that the fundamental cost of that is something like 10-30%, as a ceiling to perf</p>



<a name="393581755"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393581755" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393581755">(Sep 27 2023 at 22:55)</a>:</h4>
<blockquote>
<p>What is wasmtime doing in this cwasm "driver"? Is it just just supplying the WASI imports?</p>
</blockquote>
<p>Wasmtime is setting up the WASI environment and doing (hopefully minimal) preparation of the cwasm bytes for execution, setting up linear memory, and calling into the guest.  It's doing more work than a normal executable since it's sandboxing the guest, limiting its access to the host.</p>



<a name="393581756"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393581756" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ondřej Čertík <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393581756">(Sep 27 2023 at 22:55)</a>:</h4>
<p>We are planning to have two Release modes. One ReleaseSafe, which would correspond to WASM+sandboxing. And then ReleaseFast, where all bounds checking are turned off.</p>



<a name="393581765"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393581765" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393581765">(Sep 27 2023 at 22:55)</a>:</h4>
<p><span class="user-mention" data-user-id="654165">@Ondřej Čertík</span> because that... wouldn't be Wasm anymore. It's not that there are separate checks we can turn off, it's that the basic building blocks require it: for example, Wasm provides a separate heap, with offsets starting at 0, and the cost we pay is adding the base pointer. Once we do that, the bounds-checking is "free" (virtual memory)</p>



<a name="393581785"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393581785" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ondřej Čertík <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393581785">(Sep 27 2023 at 22:55)</a>:</h4>
<p>I see, right.</p>



<a name="393581848"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393581848" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ondřej Čertík <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393581848">(Sep 27 2023 at 22:56)</a>:</h4>
<p>So sandboxing is in some sense fundamental to WASM.</p>



<a name="393581870"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393581870" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393581870">(Sep 27 2023 at 22:56)</a>:</h4>
<p>yes, exactly</p>



<a name="393581891"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393581891" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ondřej Čertík <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393581891">(Sep 27 2023 at 22:56)</a>:</h4>
<p>So WASM is ideal for our ReleaseSafe mode.</p>



<a name="393582016"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393582016" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ondřej Čertík <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393582016">(Sep 27 2023 at 22:58)</a>:</h4>
<p><span class="user-mention silent" data-user-id="509936">Joel Dice</span> <a href="#narrow/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F/near/393581755">said</a>:</p>
<blockquote>
<blockquote>
<p>What is wasmtime doing in this cwasm "driver"? Is it just just supplying the WASI imports?</p>
</blockquote>
<p>Wasmtime is setting up the WASI environment and doing (hopefully minimal) preparation of the cwasm bytes for execution, setting up linear memory, and calling into the guest.  It's doing more work than a normal executable since it's sandboxing the guest, limiting its access to the host.</p>
</blockquote>
<p>How hard would it be to do exactly this work, but without having to call rustc all the time? So that LFortran can do this quickly?</p>



<a name="393582096"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393582096" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393582096">(Sep 27 2023 at 22:59)</a>:</h4>
<p>I think that's what Alex and Chris were talking about above, e.g. adding stuff to the cwasm to make it a position-independent executable.  Again, I'm probably not the one to ask, since they know more about that stuff than I.</p>



<a name="393582112"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393582112" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ondřej Čertík <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393582112">(Sep 27 2023 at 22:59)</a>:</h4>
<p>We do that in fact today, via our custom WASM-&gt;x64 backend. But I am hoping to find some solution that we can be compatible with the current WASM tooling.</p>



<a name="393582200"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393582200" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ondřej Čertík <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393582200">(Sep 27 2023 at 23:00)</a>:</h4>
<p>For example, I like that cwasm that wasmtime produces --- for example LFortran could produce it directly (for speed reasons), but we can still use wasmtime to check our work.</p>



<a name="393582341"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393582341" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ondřej Čertík <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393582341">(Sep 27 2023 at 23:01)</a>:</h4>
<p>Then we can collaborate on the final stub, the current cwasm-standalone that you just created, but in some ways that doesn't require constant rustc recompilation.</p>



<a name="393582387"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393582387" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393582387">(Sep 27 2023 at 23:01)</a>:</h4>
<p>If you're able to accept a precompiled *.a source file with source you control it should be not too hard to whip up an equivalent to what Joel has</p>



<a name="393582468"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393582468" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ondřej Čertík <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393582468">(Sep 27 2023 at 23:02)</a>:</h4>
<p>We currently can't accept .a yet, but we will eventually.</p>



<a name="393582469"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393582469" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393582469">(Sep 27 2023 at 23:02)</a>:</h4>
<p>Where your build process would create a cwasm, postprocess it slightly, and then invoke the native linker</p>



<a name="393582488"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393582488" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ondřej Čertík <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393582488">(Sep 27 2023 at 23:02)</a>:</h4>
<p>For the fast compilation mode we use our own linker.</p>



<a name="393582502"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393582502" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ondřej Čertík <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393582502">(Sep 27 2023 at 23:03)</a>:</h4>
<p>But I think this can be all solved.</p>



<a name="393582513"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393582513" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ondřej Čertík <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393582513">(Sep 27 2023 at 23:03)</a>:</h4>
<p>Step by step. :)</p>



<a name="393582538"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393582538" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ondřej Čertík <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393582538">(Sep 27 2023 at 23:03)</a>:</h4>
<p>As long as we are compatible at each step.</p>



<a name="393582633"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393582633" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ondřej Čertík <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393582633">(Sep 27 2023 at 23:04)</a>:</h4>
<p>I think we will focus on cwasm and see if we can be compatible with wasmtime, and for now we can use the rustc workaround to produce the final executable.</p>



<a name="393582638"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393582638" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393582638">(Sep 27 2023 at 23:04)</a>:</h4>
<p>I'm imagining that the easiest thing would basically be to precompile what Joel already wrote where the final step is taking the <code>*.cwasm</code> and shoving it in at link-time somehow. Unsure how well that could fit into your linking process</p>



<a name="393582660"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393582660" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ondřej Čertík <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393582660">(Sep 27 2023 at 23:04)</a>:</h4>
<p>Yes, exactly.</p>



<a name="393582711"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393582711" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ondřej Čertík <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393582711">(Sep 27 2023 at 23:05)</a>:</h4>
<p>Essentially doing the linking of Joel's code and our generated binary ourselves.</p>



<a name="393582778"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393582778" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ondřej Čertík <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393582778">(Sep 27 2023 at 23:06)</a>:</h4>
<p>Effectively we just need to control the <code>include_bytes</code> macro ourselves, without invoking rustc. At the binary level once everything is compiled.</p>



<a name="393582803"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393582803" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ondřej Čertík <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393582803">(Sep 27 2023 at 23:06)</a>:</h4>
<p>I am imagining that the wasmtime rust library just needs a pointer to it, loaded in memory?</p>



<a name="393582867"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393582867" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ondřej Čertík <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393582867">(Sep 27 2023 at 23:07)</a>:</h4>
<p>So if we can create some C interface that accepts this pointer, that might be all that is needed. We'll use rustc to create such a "C" library and then LFortran just links everything together, no rustc involved.</p>



<a name="393582890"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393582890" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ondřej Čertík <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393582890">(Sep 27 2023 at 23:07)</a>:</h4>
<p>Do you think that's possible?</p>



<a name="393583013"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393583013" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393583013">(Sep 27 2023 at 23:09)</a>:</h4>
<p>What format would this C library have?  A .a file?  A .so file?  Something else?</p>



<a name="393583038"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393583038" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393583038">(Sep 27 2023 at 23:09)</a>:</h4>
<p>i.e. what format would LFortran expect?</p>



<a name="393609296"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393609296" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ondřej Čertík <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393609296">(Sep 28 2023 at 03:43)</a>:</h4>
<p>I think .a would be the best for static linking, .so would also work. Right now we generate a static binary out of WASM, but I think we have to extend it anyway to be able to link .a and .so libraries.</p>



<a name="393681127"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393681127" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Till Schneidereit <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393681127">(Sep 28 2023 at 11:00)</a>:</h4>
<blockquote>
<p>I've seen it estimated that the fundamental cost of that is something like 10-30%, as a ceiling to perf</p>
</blockquote>
<p>FWIW I think that might be too high an estimate. While I can't find a source for it rioght now, IIRC RLBox as used in Firefox has a single-digit % overhead</p>



<a name="393690377"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393690377" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ralph <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393690377">(Sep 28 2023 at 11:37)</a>:</h4>
<p><span class="user-mention silent" data-user-id="654165">Ondřej Čertík</span> <a href="#narrow/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F/near/393581848">said</a>:</p>
<blockquote>
<p>So sandboxing is in some sense fundamental to WASM.</p>
</blockquote>
<p>Yeah, I'd emphasize this a bit. It simply isn't WebAssembly if it doesn't have the sandbox (though there are other requirements). So you can do this! And it could use the bytecode and the tooling you've discussed. It's possible. But you couldn't portray that as being "webassembly" -- no sandbox. It's really just native code processed through the spec in some sense, or it sure seems that way.... Still might be what you want to do technically, can't be sure.</p>



<a name="393723829"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393723829" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393723829">(Sep 28 2023 at 13:47)</a>:</h4>
<p><span class="user-mention silent" data-user-id="654165">Ondřej Čertík</span> <a href="#narrow/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F/near/393609296">said</a>:</p>
<blockquote>
<p>I think .a would be the best for static linking, .so would also work. Right now we generate a static binary out of WASM, but I think we have to extend it anyway to be able to link .a and .so libraries.</p>
</blockquote>
<p>Sure, if a .a works then we could definitely produce a <code>libcwasm-standalone.a</code> that provides a C function which accepts a pointer to a cwasm (plus any environment variables, directory mounts, etc.) and runs it.  Should be quite easy.  Does LFortran have the ability to link .a files into a final executable now, or is that something you're planning to add eventually?</p>



<a name="393738198"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393738198" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ondřej Čertík <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393738198">(Sep 28 2023 at 14:34)</a>:</h4>
<p><span class="user-mention" data-user-id="509936">@Joel Dice</span> perfect, let's go the <code>.a</code> route. We use the system linker with our default LLVM backend, and we allow linking 3rd party libraries. Our WASM backend just produces the core module, and our WASM-&gt;x64 backend currently creates the executable directly, no linking. However, we need the ability to link 3rd party code anyway, so we'll have to implement it.</p>



<a name="393740121"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393740121" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ondřej Čertík <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393740121">(Sep 28 2023 at 14:40)</a>:</h4>
<p><span class="user-mention" data-user-id="268586">@Ralph</span> we are considering at least three modes:</p>
<ul>
<li>Debug: fast compilation, slower runtime, and no segfaults, all checking on (bounds checking, stack, pointers etc.), nice stack traces</li>
<li>ReleaseSafe: all checks on, but otherwise as fast code as possible, slower compilation</li>
<li>ReleaseFast: no runtime checks, maximum runtime speed, slow compilation (this is not safe to run in a browser obviously, but for computational code that you run yourself this is perfect)</li>
</ul>
<p>Right now we only have two modes, Debug and ReleaseFast, and we use LLVM for both.</p>
<p>WASM, with sandboxing, seems like a great fit for both Debug and ReleaseSafe modes. Based on the discussion above, it might do ok for ReleaseFast as well, but LLVM might end up being a better fit there.</p>



<a name="393825825"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393825825" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ondřej Čertík <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393825825">(Sep 29 2023 at 00:41)</a>:</h4>
<p><span class="user-mention" data-user-id="509936">@Joel Dice</span> here I created a proof of concept how to create the <code>.a</code> library: <a href="https://github.com/dicej/cwasm-standalone/pull/3">https://github.com/dicej/cwasm-standalone/pull/3</a>, it works!! If you have suggestions how to improve it, please let me know.</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/dicej/cwasm-standalone/pull/3" style="background-image: url(https\:\/\/uploads\.zulipusercontent\.net\/08fb89fd7eb8d043d3417cb3ad0fc6c5ec2f9555\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f353134633632393539653434306161383737343733383664643066326239396439303437346132616564313731306534613765366239373333333139646265642f646963656a2f637761736d2d7374616e64616c6f6e652f70756c6c2f33)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/dicej/cwasm-standalone/pull/3" title="A proof of concept to create standalone C library by certik · Pull Request #3 · dicej/cwasm-standalone">A proof of concept to create standalone C library by certik · Pull Request #3 · dicej/cwasm-standalone</a></div><div class="message_embed_description">This contains all kinds of hardwired details, but it creates a standalone .a library, that I then link with a C code in a clean manner. It creates a 9MB binary and it works:
$ ll -h driver
-rwxr-xr...</div></div></div>



<a name="393838756"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393838756" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ondřej Čertík <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393838756">(Sep 29 2023 at 02:39)</a>:</h4>
<p>Question: does it make sense for LFortran to generate <code>.cwasm</code> directly? Is the interface API (conventions) how to call this binary relatively stable, or does it change with every wasmtime release? Is it documented somewhere? </p>
<p>If it changes too much, then perhaps we should collaborate at the <code>.wasm</code> level, and we'll maintain our own binary generation, and we can check against the <code>cwasm-standalone</code> above to ensure correctness, as well as against just <code>wasmtime guest.wasm</code>.</p>



<a name="393937382"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393937382" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393937382">(Sep 29 2023 at 14:04)</a>:</h4>
<p><code>.cwasm</code> only works with a single wasmtime version. It has a header with tge wasmtime version and the exact abi between compiled wasm modules and the runtime changes all the time.</p>



<a name="393937618"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393937618" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393937618">(Sep 29 2023 at 14:05)</a>:</h4>
<p>Yes it would not make sense for LFortran to generate <code>*.cwasm</code> directly, you'll want to generate <code>*.wasm</code> if you can</p>



<a name="393956061"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/393956061" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ondřej Čertík <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#393956061">(Sep 29 2023 at 15:40)</a>:</h4>
<p><span class="user-mention" data-user-id="264278">@bjorn3</span>, <span class="user-mention" data-user-id="253994">@Alex Crichton</span> thank you. In that case, it seems the best way forward for us is to keep producing the <code>.wasm</code> files as we do today, and then we'll maintain three paths forward:</p>
<ul>
<li>Our own WASM-&gt;x64/arm backends that produce a binary; quick compilation, small binary, but possibly not all WASM safety guarantees</li>
<li>cwasm-standalone (see above) way of creating binaries, which produces a reasonably small binary (currently 100x bigger) in a reasonable time (currently 10x - 100x slower), but it keeps all WASM guarantees, which is nice, and it can act as a "reference implementation", to ensure our generated <code>.wasm</code> binary (and native binary) + all dependencies all work together well with regards to the standard WASM ecosystem.</li>
<li>It works with <code>wasmtime a.wasm</code>; this is the most common/standard usage in WASM, ensuring that it works well</li>
</ul>
<p>We also provide a JS file that makes exactly the same wasm binary run in a browser, which we also want.</p>



<a name="394725836"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/394725836" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Petr Penzin <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#394725836">(Oct 03 2023 at 23:39)</a>:</h4>
<p><code>wasm2c</code> (WABT) can produce files that can be built standalone-ish, at least you will get a native object file, it has a runtime which you'd need to link against.</p>



<a name="410834839"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Can%20WASM%20be%20compiled%20to%20a%20standalone%20binary%3F/near/410834839" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Karel Hrkal (kajacx) <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Can.20WASM.20be.20compiled.20to.20a.20standalone.20binary.3F.html#410834839">(Jan 02 2024 at 11:53)</a>:</h4>
<p>I saw a video showing that wasmer can take a wasm file and make a "native" executable out of it (like an .exe) by bundling the wasmer runtime into the executable, so that you don't need to have wasmer installed to run it.</p>
<p>Unfortunatelly, I cannot seem to find the video anymore or find any documentation on this.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>