<html>
<head><meta charset="utf-8"><title>✔ Guest missing imports · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/index.html">general</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20Guest.20missing.20imports.html">✔ Guest missing imports</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="329245851"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20Guest%20missing%20imports/near/329245851" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bachrc <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20Guest.20missing.20imports.html#329245851">(Feb 21 2023 at 17:16)</a>:</h4>
<p>Hi here, I just converted my wasm to a component, and I indeed see that in the wit that wasm-tools told be, it is now asking multiple imports. Like wasi-stderr, wasi-stdio... </p>
<p>And when trying to instantiate with wasmtime, well it panics because apparently, the WASM misses some imports.<br>
<a href="https://github.com/bytecodealliance/wasmtime/issues/5830">https://github.com/bytecodealliance/wasmtime/issues/5830</a><br>
This is a very similar problem to this issue, but I didn't understand the answer given by pchickey. How can I do the bindings? Thanks in advance</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wasmtime/issues/5830" style="background-image: url(https\:\/\/uploads\.zulipusercontent\.net\/c3e1e3aa25907a611426069a4cb94f6793341825\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f353166326434376135613363643633613165303536353566613139323237353264636661303134363539303266336335353864646531373563343463643835352f62797465636f6465616c6c69616e63652f7761736d74696d652f6973737565732f35383330)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wasmtime/issues/5830" title="Error loading component - Error: import wasi-stderr has the wrong type · Issue #5830 · bytecodealliance/wasmtime">Error loading component - Error: import wasi-stderr has the wrong type · Issue #5830 · bytecodealliance/wasmtime</a></div><div class="message_embed_description">Hello I am currently experimenting with the component model and encounter the following problem. I know that the component model is not stable but maybe someone can help me. To reproduce the error ...</div></div></div>



<a name="329245967"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20Guest%20missing%20imports/near/329245967" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20Guest.20missing.20imports.html#329245967">(Feb 21 2023 at 17:17)</a>:</h4>
<p>A host implementation of those imports is provided over in the preview2-prototyping repo under <code>host/</code></p>



<a name="329245992"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20Guest%20missing%20imports/near/329245992" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20Guest.20missing.20imports.html#329245992">(Feb 21 2023 at 17:17)</a>:</h4>
<p>it uses a fork of wasi-common, and its very incomplete and buggy</p>



<a name="329246005"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20Guest%20missing%20imports/near/329246005" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20Guest.20missing.20imports.html#329246005">(Feb 21 2023 at 17:17)</a>:</h4>
<p>and its rapidly changing</p>



<a name="329246227"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20Guest%20missing%20imports/near/329246227" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bachrc <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20Guest.20missing.20imports.html#329246227">(Feb 21 2023 at 17:19)</a>:</h4>
<p>Oh I see, so I cannot make the bindings for now? Am I forced to use this?</p>



<a name="329246378"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20Guest%20missing%20imports/near/329246378" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20Guest.20missing.20imports.html#329246378">(Feb 21 2023 at 17:19)</a>:</h4>
<p>so, you need to depend on that crate, and use its <code>add_to_linker</code> and <code>WasiCommand</code> export like here: <a href="https://github.com/bytecodealliance/preview2-prototyping/blob/main/host/src/main.rs">https://github.com/bytecodealliance/preview2-prototyping/blob/main/host/src/main.rs</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/preview2-prototyping/blob/main/host/src/main.rs" style="background-image: url(https\:\/\/uploads\.zulipusercontent\.net\/3e02534907adfe141338b2b91709bf65cd279dd7\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f383864363433643832303063336638393232303837363231366361613961386262613534643536303237623838333135343337373964633864656163373738642f62797465636f6465616c6c69616e63652f70726576696577322d70726f746f747970696e67)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/preview2-prototyping/blob/main/host/src/main.rs" title="preview2-prototyping/main.rs at main · bytecodealliance/preview2-prototyping">preview2-prototyping/main.rs at main · bytecodealliance/preview2-prototyping</a></div><div class="message_embed_description">Polyfill adapter for preview1-using wasm modules to call preview2 functions. - preview2-prototyping/main.rs at main · bytecodealliance/preview2-prototyping</div></div></div>



<a name="329246534"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20Guest%20missing%20imports/near/329246534" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20Guest.20missing.20imports.html#329246534">(Feb 21 2023 at 17:20)</a>:</h4>
<p>but note that you need to depend on the previee2-prototyping wasi-common, not the <a href="http://crates.io">crates.io</a> wasi-common, so please use a git dependency</p>
<div class="message_embed"><a class="message_embed_image" href="http://crates.io" style="background-image: url(https\:\/\/uploads\.zulipusercontent\.net\/75f8c66509c680a2345cca9b6adaf7e2cdb6f41b\/68747470733a2f2f6372617465732e696f2f6173736574732f6f672d696d6167652e706e67)"></a><div class="data-container"><div class="message_embed_title"><a href="http://crates.io" title="crates.io: Rust Package Registry">crates.io: Rust Package Registry</a></div></div></div>



<a name="329246726"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20Guest%20missing%20imports/near/329246726" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20Guest.20missing.20imports.html#329246726">(Feb 21 2023 at 17:21)</a>:</h4>
<p>you can either use the implementation in prototyping's host, or you can write your own using wasmtime's wit bindgen. i dont recommend writing your own because its quite hard</p>



<a name="329246742"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20Guest%20missing%20imports/near/329246742" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20Guest.20missing.20imports.html#329246742">(Feb 21 2023 at 17:21)</a>:</h4>
<p>but if you need to, it is possible</p>



<a name="329246804"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20Guest%20missing%20imports/near/329246804" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20Guest.20missing.20imports.html#329246804">(Feb 21 2023 at 17:21)</a>:</h4>
<p>you'll have to follow the general pattern we used in that repo of invoking wasmtime::component::bindgen!() to do so, and then impl all of the traits.</p>



<a name="329247052"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20Guest%20missing%20imports/near/329247052" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bachrc <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20Guest.20missing.20imports.html#329247052">(Feb 21 2023 at 17:22)</a>:</h4>
<p>Yup, I tried to pull your host project : </p>
<div class="codehilite" data-code-language="TOML"><pre><span></span><code><span class="k">[dependencies]</span>
<span class="p">.......</span>
<span class="n">wasmtime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"^6.0.0"</span><span class="p">,</span><span class="w"> </span><span class="n">features</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s">"component-model"</span><span class="p">,</span><span class="w"> </span><span class="s">"async"</span><span class="p">]</span><span class="w"> </span><span class="p">}</span>
<span class="n">host</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">git</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"https://github.com/bytecodealliance/preview2-prototyping"</span><span class="w"> </span><span class="p">}</span>
</code></pre></div>
<p>But when trying to build, I have a version conflict that I... don't understand o.o</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">wasmtime_host_test</span><span class="w"> </span><span class="n">git</span>:<span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="w"> </span><span class="err">✗</span><span class="w"> </span><span class="n">cargo</span><span class="w"> </span><span class="n">check</span>
<span class="w">    </span><span class="n">Updating</span><span class="w"> </span><span class="n">crates</span><span class="p">.</span><span class="n">io</span><span class="w"> </span><span class="n">index</span>
<span class="w">    </span><span class="n">Updating</span><span class="w"> </span><span class="n">git</span><span class="w"> </span><span class="n">repository</span><span class="w"> </span><span class="err">`</span><span class="n">https</span>:<span class="c1">//github.com/bytecodealliance/preview2-prototyping`</span>
<span class="w">    </span><span class="n">Updating</span><span class="w"> </span><span class="n">git</span><span class="w"> </span><span class="n">repository</span><span class="w"> </span><span class="err">`</span><span class="n">https</span>:<span class="c1">//github.com/bytecodealliance/wasmtime`</span>
<span class="n">error</span>: <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">select</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">version</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="err">`</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">fiber</span><span class="err">`</span><span class="p">.</span>
<span class="w">    </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="n">required</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">package</span><span class="w"> </span><span class="err">`</span><span class="n">wasmtime</span><span class="w"> </span><span class="n">v6</span><span class="p">.</span><span class="mf">0.0</span><span class="w"> </span><span class="p">(</span><span class="n">https</span>:<span class="c1">//github.com/bytecodealliance/wasmtime?branch=release-6.0.0#c00d3f05)`</span>
<span class="w">    </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="n">which</span><span class="w"> </span><span class="n">satisfies</span><span class="w"> </span><span class="n">git</span><span class="w"> </span><span class="n">dependency</span><span class="w"> </span><span class="err">`</span><span class="n">wasmtime</span><span class="err">`</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">package</span><span class="w"> </span><span class="err">`</span><span class="n">host</span><span class="w"> </span><span class="n">v0</span><span class="p">.</span><span class="mf">0.0</span><span class="w"> </span><span class="p">(</span><span class="n">https</span>:<span class="c1">//github.com/bytecodealliance/preview2-prototyping#7736fd0c)`</span>
<span class="w">    </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="n">which</span><span class="w"> </span><span class="n">satisfies</span><span class="w"> </span><span class="n">git</span><span class="w"> </span><span class="n">dependency</span><span class="w"> </span><span class="err">`</span><span class="n">host</span><span class="err">`</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">package</span><span class="w"> </span><span class="err">`</span><span class="n">wasmtime_host_test</span><span class="w"> </span><span class="n">v0</span><span class="p">.</span><span class="mf">1.0</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">yohann</span><span class="o">/</span><span class="n">devs</span><span class="o">/</span><span class="n">neo</span><span class="o">-</span><span class="n">michel</span><span class="o">/</span><span class="n">wasmtime_host_test</span><span class="p">)</span><span class="err">`</span>
<span class="n">versions</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">meet</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">requirements</span><span class="w"> </span><span class="err">`</span><span class="o">=</span><span class="mf">6.0.0</span><span class="err">`</span><span class="w"> </span><span class="n">are</span>: <span class="mf">6.0.0</span>

<span class="n">the</span><span class="w"> </span><span class="n">package</span><span class="w"> </span><span class="err">`</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">fiber</span><span class="err">`</span><span class="w"> </span><span class="n">links</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">native</span><span class="w"> </span><span class="n">library</span><span class="w"> </span><span class="err">`</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">fiber</span><span class="o">-</span><span class="n">shims</span><span class="err">`</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">conflicts</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">previous</span><span class="w"> </span><span class="n">package</span><span class="w"> </span><span class="n">which</span><span class="w"> </span><span class="n">links</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="err">`</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">fiber</span><span class="o">-</span><span class="n">shims</span><span class="err">`</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">well</span>:
<span class="nc">package</span><span class="w"> </span><span class="err">`</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">fiber</span><span class="w"> </span><span class="n">v6</span><span class="p">.</span><span class="mf">0.0</span><span class="err">`</span>
<span class="w">    </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="n">which</span><span class="w"> </span><span class="n">satisfies</span><span class="w"> </span><span class="n">dependency</span><span class="w"> </span><span class="err">`</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">fiber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"=6.0.0"</span><span class="err">`</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">package</span><span class="w"> </span><span class="err">`</span><span class="n">wasmtime</span><span class="w"> </span><span class="n">v6</span><span class="p">.</span><span class="mf">0.0</span><span class="err">`</span>
<span class="w">    </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="n">which</span><span class="w"> </span><span class="n">satisfies</span><span class="w"> </span><span class="n">dependency</span><span class="w"> </span><span class="err">`</span><span class="n">wasmtime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"^6.0.0"</span><span class="err">`</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">package</span><span class="w"> </span><span class="err">`</span><span class="n">wasmtime_host_test</span><span class="w"> </span><span class="n">v0</span><span class="p">.</span><span class="mf">1.0</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">yohann</span><span class="o">/</span><span class="n">devs</span><span class="o">/</span><span class="n">neo</span><span class="o">-</span><span class="n">michel</span><span class="o">/</span><span class="n">wasmtime_host_test</span><span class="p">)</span><span class="err">`</span>
<span class="n">Only</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="n">package</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">dependency</span><span class="w"> </span><span class="n">graph</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="n">specify</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">same</span><span class="w"> </span><span class="n">links</span><span class="w"> </span><span class="n">value</span><span class="p">.</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">helps</span><span class="w"> </span><span class="n">ensure</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">only</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="n">copy</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">native</span><span class="w"> </span><span class="n">library</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">linked</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="kr">final</span><span class="w"> </span><span class="n">binary</span><span class="p">.</span><span class="w"> </span><span class="n">Try</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">adjust</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="n">dependencies</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">only</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="n">package</span><span class="w"> </span><span class="n">uses</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">links</span><span class="w"> </span><span class="o">='</span><span class="na">wasmtime</span><span class="o">-</span><span class="n">fiber</span><span class="o">'</span><span class="w"> </span><span class="n">value</span><span class="p">.</span><span class="w"> </span><span class="n">For</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">information</span><span class="p">,</span><span class="w"> </span><span class="n">see</span><span class="w"> </span><span class="n">https</span>:<span class="c1">//doc.rust-lang.org/cargo/reference/resolver.html#links.</span>

<span class="n">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">select</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">version</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="err">`</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">fiber</span><span class="err">`</span><span class="w"> </span><span class="n">which</span><span class="w"> </span><span class="n">could</span><span class="w"> </span><span class="n">resolve</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">conflict</span>
</code></pre></div>



<a name="329247206"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20Guest%20missing%20imports/near/329247206" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20Guest.20missing.20imports.html#329247206">(Feb 21 2023 at 17:23)</a>:</h4>
<p>thats crgo's way of showing you there are multiple versions of wasmtime pulled in</p>



<a name="329247215"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20Guest%20missing%20imports/near/329247215" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20Guest.20missing.20imports.html#329247215">(Feb 21 2023 at 17:23)</a>:</h4>
<p>(not ideal)</p>



<a name="329247277"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20Guest%20missing%20imports/near/329247277" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20Guest.20missing.20imports.html#329247277">(Feb 21 2023 at 17:23)</a>:</h4>
<p>You need to use</p>
<div class="codehilite" data-code-language="TOML"><pre><span></span><code><span class="n">wasmtime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">git</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"https://github.com/bytecodealliance/wasmtime"</span><span class="p">,</span><span class="w"> </span><span class="n">features</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s">"component-model"</span><span class="p">],</span><span class="w"> </span><span class="n">branch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">'release-6.0.0'</span><span class="w"> </span><span class="p">}</span>
</code></pre></div>
<p>as that is what preview2-prototyping used too.</p>



<a name="329247318"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20Guest%20missing%20imports/near/329247318" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bachrc <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20Guest.20missing.20imports.html#329247318">(Feb 21 2023 at 17:24)</a>:</h4>
<p>Yeah, but all I see are version 6.0.0, so there should be no problem haha</p>



<a name="329247376"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20Guest%20missing%20imports/near/329247376" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bachrc <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20Guest.20missing.20imports.html#329247376">(Feb 21 2023 at 17:24)</a>:</h4>
<p>Thank to both of you, I'm gonna try this :)</p>



<a name="329247391"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20Guest%20missing%20imports/near/329247391" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20Guest.20missing.20imports.html#329247391">(Feb 21 2023 at 17:24)</a>:</h4>
<p>git versions and <a href="http://crates.io">crates.io</a> versions are not compatible, even if they say the same string</p>
<div class="message_embed"><a class="message_embed_image" href="http://crates.io" style="background-image: url(https\:\/\/uploads\.zulipusercontent\.net\/75f8c66509c680a2345cca9b6adaf7e2cdb6f41b\/68747470733a2f2f6372617465732e696f2f6173736574732f6f672d696d6167652e706e67)"></a><div class="data-container"><div class="message_embed_title"><a href="http://crates.io" title="crates.io: Rust Package Registry">crates.io: Rust Package Registry</a></div></div></div>



<a name="329247512"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20Guest%20missing%20imports/near/329247512" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20Guest.20missing.20imports.html#329247512">(Feb 21 2023 at 17:24)</a>:</h4>
<p>we can update preview2-prototyping to point at the <a href="http://crates.io">crates.io</a> release, it landed this morning, but all of the people who hack on that are in a meeting today so we havent gotten to it yet</p>
<div class="message_embed"><a class="message_embed_image" href="http://crates.io" style="background-image: url(https\:\/\/uploads\.zulipusercontent\.net\/75f8c66509c680a2345cca9b6adaf7e2cdb6f41b\/68747470733a2f2f6372617465732e696f2f6173736574732f6f672d696d6167652e706e67)"></a><div class="data-container"><div class="message_embed_title"><a href="http://crates.io" title="crates.io: Rust Package Registry">crates.io: Rust Package Registry</a></div></div></div>



<a name="329247962"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20Guest%20missing%20imports/near/329247962" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bachrc <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20Guest.20missing.20imports.html#329247962">(Feb 21 2023 at 17:27)</a>:</h4>
<p>Okay, I understand better now :) And this is working like this! Thank you for your kind and quick answers and your hard work :)</p>



<a name="329247992"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20Guest%20missing%20imports/near/329247992" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20Guest.20missing.20imports.html#329247992">(Feb 21 2023 at 17:27)</a>:</h4>
<p><span class="user-mention silent" data-user-id="541537">bachrc</span> has marked this topic as resolved.</p>



<a name="329250218"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20Guest%20missing%20imports/near/329250218" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20Guest.20missing.20imports.html#329250218">(Feb 21 2023 at 17:36)</a>:</h4>
<p><span class="user-mention silent" data-user-id="541537">bachrc</span> has marked this topic as unresolved.</p>



<a name="329250543"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20Guest%20missing%20imports/near/329250543" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bachrc <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20Guest.20missing.20imports.html#329250543">(Feb 21 2023 at 17:38)</a>:</h4>
<p>Well, I guess using the <code>add_to_linker</code> is incompatible with the one given by my bindgen! macro? :(</p>



<a name="329250650"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20Guest%20missing%20imports/near/329250650" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bachrc <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20Guest.20missing.20imports.html#329250650">(Feb 21 2023 at 17:38)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">linker</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Linker</span>::<span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">engine</span><span class="p">);</span>
<span class="n">host</span>::<span class="n">add_to_linker</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">linker</span><span class="p">,</span><span class="w"> </span><span class="o">|</span><span class="n">x</span><span class="o">|</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="n">Michel</span>::<span class="n">add_to_linker</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">linker</span><span class="p">,</span><span class="w"> </span><span class="o">|</span><span class="n">state</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">MichelApiForPlugins</span><span class="o">|</span><span class="w"> </span><span class="n">state</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
</code></pre></div>



<a name="329251273"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20Guest%20missing%20imports/near/329251273" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20Guest.20missing.20imports.html#329251273">(Feb 21 2023 at 17:41)</a>:</h4>
<p>can you share the error message?</p>



<a name="329251346"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20Guest%20missing%20imports/near/329251346" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bachrc <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20Guest.20missing.20imports.html#329251346">(Feb 21 2023 at 17:41)</a>:</h4>
<p>Here the compiler isn't happy because there is two types or states given to the linker : WasiCtx (by the host), and MichelApiForPlugins (which is my state)</p>



<a name="329251453"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20Guest%20missing%20imports/near/329251453" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bachrc <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20Guest.20missing.20imports.html#329251453">(Feb 21 2023 at 17:42)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">error</span><span class="p">[</span><span class="n">E0631</span><span class="p">]</span>: <span class="nc">type</span><span class="w"> </span><span class="n">mismatch</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">closure</span><span class="w"> </span><span class="n">arguments</span>
<span class="w">  </span><span class="o">-</span>-&gt; <span class="nc">wasmtime_host_test</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">34</span>:<span class="mi">5</span>
<span class="w">   </span><span class="o">|</span>
<span class="mi">34</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="n">Michel</span>::<span class="n">add_to_linker</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">linker</span><span class="p">,</span><span class="w"> </span><span class="o">|</span><span class="n">state</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">MichelApiForPlugins</span><span class="o">|</span><span class="w"> </span><span class="n">state</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="w">   </span><span class="o">|</span><span class="w">     </span><span class="o">^^^^^^^^^^^^^^^^^^^^^</span><span class="w">              </span><span class="o">---------------------------------</span><span class="w"> </span><span class="n">found</span><span class="w"> </span><span class="n">signature</span><span class="w"> </span><span class="n">defined</span><span class="w"> </span><span class="n">here</span>
<span class="w">   </span><span class="o">|</span><span class="w">     </span><span class="o">|</span>
<span class="w">   </span><span class="o">|</span><span class="w">     </span><span class="n">expected</span><span class="w"> </span><span class="n">due</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">this</span>
<span class="w">   </span><span class="o">|</span>
<span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">expected</span><span class="w"> </span><span class="n">closure</span><span class="w"> </span><span class="n">signature</span><span class="w"> </span><span class="err">`</span><span class="k">for</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="w"> </span><span class="k">fn</span><span class="p">(</span><span class="o">&amp;'</span><span class="na">a</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">WasiCtx</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">_</span><span class="err">`</span>
<span class="w">              </span><span class="n">found</span><span class="w"> </span><span class="n">closure</span><span class="w"> </span><span class="n">signature</span><span class="w"> </span><span class="err">`</span><span class="k">for</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="w"> </span><span class="k">fn</span><span class="p">(</span><span class="o">&amp;'</span><span class="na">a</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">MichelApiForPlugins</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">_</span><span class="err">`</span>
</code></pre></div>



<a name="329251494"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20Guest%20missing%20imports/near/329251494" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20Guest.20missing.20imports.html#329251494">(Feb 21 2023 at 17:42)</a>:</h4>
<p>right, so you want to make some <code>struct Ctx { wasi: WasiCtx, michel: MichaelApiForPlugins }</code>, and in the linker you use <code>|ctx| &amp;mut ctx.wasi</code> for wasi, <code>|ctx| &amp;mut ctx.michel</code> for michel</p>



<a name="329251560"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20Guest%20missing%20imports/near/329251560" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20Guest.20missing.20imports.html#329251560">(Feb 21 2023 at 17:42)</a>:</h4>
<p>thats how the linker is designed to deal with compositions of state</p>



<a name="329251721"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20Guest%20missing%20imports/near/329251721" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bachrc <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20Guest.20missing.20imports.html#329251721">(Feb 21 2023 at 17:43)</a>:</h4>
<p>Oh okay I see! I hope my struggles will help people searching here :) Thanks again for your answer!</p>



<a name="329255611"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20Guest%20missing%20imports/near/329255611" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bachrc <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20Guest.20missing.20imports.html#329255611">(Feb 21 2023 at 18:00)</a>:</h4>
<p>Yup, but making the Linker contain our new <code>Ctx</code> is incompatible with the <code>instantiate_async</code> generated by the bindgen!. </p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">bindings</span><span class="p">,</span><span class="n">_</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Michel</span>::<span class="n">instantiate_async</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">component</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">linker</span><span class="p">).</span><span class="k">await</span><span class="o">?</span><span class="p">;</span>
</code></pre></div>
<p>Here it waits for the same generic type for store and linker. Well I guess my Store should not be <code>MichelPluginForApi</code> anymore, but <code>Ctx</code> ? But for creating a Ctx object, I need to create a WasiCtx. You know how I could do this? :(</p>



<a name="329255849"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20Guest%20missing%20imports/near/329255849" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bachrc <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20Guest.20missing.20imports.html#329255849">(Feb 21 2023 at 18:00)</a>:</h4>
<p>Oh yes, the WasiCtxBuilder !</p>



<a name="329255872"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20Guest%20missing%20imports/near/329255872" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bachrc <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20Guest.20missing.20imports.html#329255872">(Feb 21 2023 at 18:01)</a>:</h4>
<p>I'm trying this now.</p>



<a name="329255877"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20Guest%20missing%20imports/near/329255877" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20Guest.20missing.20imports.html#329255877">(Feb 21 2023 at 18:01)</a>:</h4>
<p>yes</p>



<a name="329255915"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20Guest%20missing%20imports/near/329255915" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20Guest.20missing.20imports.html#329255915">(Feb 21 2023 at 18:01)</a>:</h4>
<p>and your store will need to be a <code>Store&lt;Ctx&gt;</code></p>



<a name="329293226"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20Guest%20missing%20imports/near/329293226" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bachrc <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20Guest.20missing.20imports.html#329293226">(Feb 21 2023 at 21:14)</a>:</h4>
<p>Sorry to bother again, but trying to get the WasiCtsBuilder with the wasmtime-wasi dependency :</p>
<div class="codehilite" data-code-language="TOML"><pre><span></span><code><span class="n">wasmtime-wasi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">git</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"https://github.com/bytecodealliance/wasmtime"</span><span class="p">,</span><span class="w"> </span><span class="n">branch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">'release-6.0.0'</span><span class="w"> </span><span class="p">}</span>
</code></pre></div>
<p>But again, a version conflict. I don't see what's wrong here :(</p>
<div class="codehilite" data-code-language="Bash Session"><pre><span></span><code><span class="go">stdout :     Updating crates.io index</span>
<span class="go">    Updating git repository `https://github.com/bytecodealliance/wasmtime`</span>
<span class="go">error: failed to select a version for `wasi-common`.</span>
<span class="go">    ... required by package `wasmtime-wasi v6.0.0 (https://github.com/bytecodealliance/wasmtime?branch=release-6.0.0#c00d3f05)`</span>
<span class="go">    ... which satisfies git dependency `wasmtime-wasi` of package `wasmtime_host_test v0.1.0 (/home/yohann/devs/neo-michel/wasmtime_host_test)`</span>
<span class="go">versions that meet the requirements `=6.0.0` are: 6.0.0</span>

<span class="go">the package `wasi-common` links to the native library `wasi-common-19`, but it conflicts with a previous package which links to `wasi-common-19` as well:</span>
<span class="go">package `wasi-common v0.0.0 (https://github.com/bytecodealliance/preview2-prototyping#7736fd0c)`</span>
<span class="go">    ... which satisfies git dependency `wasi-common` (locked to 0.0.0) of package `host v0.0.0 (https://github.com/bytecodealliance/preview2-prototyping#7736fd0c)`</span>
<span class="go">    ... which satisfies git dependency `host` (locked to 0.0.0) of package `wasmtime_host_test v0.1.0 (/home/yohann/devs/neo-michel/wasmtime_host_test)`</span>
<span class="go">Only one package in the dependency graph may specify the same links value. This helps ensure that only one copy of a native library is linked in the final binary. Try to adjust your dependencies so that only one package uses the links ='wasi-common' value. For more information, see https://doc.rust-lang.org/cargo/reference/resolver.html#links.</span>

<span class="go">failed to select a version for `wasi-common` which could resolve this conflict</span>
</code></pre></div>



<a name="329299307"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20Guest%20missing%20imports/near/329299307" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20Guest.20missing.20imports.html#329299307">(Feb 21 2023 at 21:52)</a>:</h4>
<p>You can’t use wasi-common from the prototype repo and the one upstream in Wasmtime in the same project right now.</p>



<a name="329299378"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20Guest%20missing%20imports/near/329299378" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20Guest.20missing.20imports.html#329299378">(Feb 21 2023 at 21:53)</a>:</h4>
<p>We will merge all that functionality back in upstream at some point, but right now they can’t coexist</p>



<a name="329299414"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20Guest%20missing%20imports/near/329299414" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20Guest.20missing.20imports.html#329299414">(Feb 21 2023 at 21:53)</a>:</h4>
<p>If you delete the links section in the prototype cargo.toml it might work</p>



<a name="329301753"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20Guest%20missing%20imports/near/329301753" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bachrc <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20Guest.20missing.20imports.html#329301753">(Feb 21 2023 at 22:08)</a>:</h4>
<p>Ah. So I can't use WasiCtxBuilder, and so using wit-bindgen</p>



<a name="329301905"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20Guest%20missing%20imports/near/329301905" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bachrc <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20Guest.20missing.20imports.html#329301905">(Feb 21 2023 at 22:09)</a>:</h4>
<p>I can't modify the prototype Cargo.toml without doing a fork</p>



<a name="329302688"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20Guest%20missing%20imports/near/329302688" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bachrc <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20Guest.20missing.20imports.html#329302688">(Feb 21 2023 at 22:14)</a>:</h4>
<p>And i don't see any links section in <a href="https://github.com/bytecodealliance/preview2-prototyping/blob/main/Cargo.toml">https://github.com/bytecodealliance/preview2-prototyping/blob/main/Cargo.toml</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/preview2-prototyping/blob/main/Cargo.toml" style="background-image: url(https\:\/\/uploads\.zulipusercontent\.net\/3e02534907adfe141338b2b91709bf65cd279dd7\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f383864363433643832303063336638393232303837363231366361613961386262613534643536303237623838333135343337373964633864656163373738642f62797465636f6465616c6c69616e63652f70726576696577322d70726f746f747970696e67)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/preview2-prototyping/blob/main/Cargo.toml" title="preview2-prototyping/Cargo.toml at main · bytecodealliance/preview2-prototyping">preview2-prototyping/Cargo.toml at main · bytecodealliance/preview2-prototyping</a></div><div class="message_embed_description">Polyfill adapter for preview1-using wasm modules to call preview2 functions. - preview2-prototyping/Cargo.toml at main · bytecodealliance/preview2-prototyping</div></div></div>



<a name="329322567"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20Guest%20missing%20imports/near/329322567" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bachrc <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20Guest.20missing.20imports.html#329322567">(Feb 22 2023 at 00:55)</a>:</h4>
<p>Well I see here (<a href="#narrow/stream/327223-wit-bindgen/topic/.5Brust.5D.20wasmtime.20.26.20custom.20wit.20type.20.28record.29">https://bytecodealliance.zulipchat.com/#narrow/stream/327223-wit-bindgen/topic/.5Brust.5D.20wasmtime.20.26.20custom.20wit.20type.20.28record.29</a>) that i should maybe import wasi_cap_sync from the std!</p>



<a name="329465216"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20Guest%20missing%20imports/near/329465216" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Giom <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20Guest.20missing.20imports.html#329465216">(Feb 22 2023 at 15:58)</a>:</h4>
<p>Hey i managed to get it working by adding the following line to my cargo.toml of the host project:<br>
<code>wasi-cap-std-sync = { git = "https://github.com/bytecodealliance/preview2-prototyping", rev = "7736fd0" }</code></p>
<p>Then i was able to use the WasiCtxBuilder.</p>



<a name="335045246"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20Guest%20missing%20imports/near/335045246" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bachrc <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20Guest.20missing.20imports.html#335045246">(Feb 23 2023 at 21:56)</a>:</h4>
<p>Yeah, to make this work, I was forced to clone locally the preview2-prototyping, and remove the [links] section.</p>



<a name="335045379"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20Guest%20missing%20imports/near/335045379" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20Guest.20missing.20imports.html#335045379">(Feb 23 2023 at 21:57)</a>:</h4>
<p><span class="user-mention silent" data-user-id="541537">bachrc</span> has marked this topic as resolved.</p>



<a name="339690577"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20Guest%20missing%20imports/near/339690577" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elia Bieri <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20Guest.20missing.20imports.html#339690577">(Mar 05 2023 at 12:50)</a>:</h4>
<p>Could you send me the example you used to get it working?</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>