<html>
<head><meta charset="utf-8"><title>✔ A bit of help ? · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/index.html">general</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20A.20bit.20of.20help.20.3F.html">✔ A bit of help ?</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="279988117"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20A%20bit%20of%20help%20%3F/near/279988117" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> infrandomness <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20A.20bit.20of.20help.20.3F.html#279988117">(Apr 24 2022 at 16:21)</a>:</h4>
<p>Hi, new member here,<br>
I wanted to know if here was the right place, being a total beginner in compiler development, to ask for help</p>



<a name="279988667"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20A%20bit%20of%20help%20%3F/near/279988667" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> infrandomness <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20A.20bit.20of.20help.20.3F.html#279988667">(Apr 24 2022 at 16:36)</a>:</h4>
<p><span class="user-mention silent" data-user-id="496398">infrandomness</span> <a href="#narrow/stream/206238-general/topic/A.20bit.20of.20help.20.3F/near/279988117">said</a>:</p>
<blockquote>
<p>Hi, new member here,<br>
I wanted to know if here was the right place, being a total beginner in compiler development, to ask for help</p>
</blockquote>
<p>if I can ask for help here : </p>
<p>Hello guys, I'm in the process of creating a compiler  for my programming language in rust with cranelift<br>
I had questions about cranelift-module and cranelift-object <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span><br>
I currently use both cranelift-module and cranelift-object to put together an ELF file. (I helped myself of <a href="https://github.com/bytecodealliance/wasmtime/blob/main/cranelift/object/tests/basic.rs#L149">https://github.com/bytecodealliance/wasmtime/blob/main/cranelift/object/tests/basic.rs#L149</a> to put something together)<br>
The ELF file looks fine except for a thing, the file headers of the ELF file indicate </p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">object</span>:     <span class="nc">file</span><span class="w"> </span><span class="n">format</span><span class="w"> </span><span class="n">elf64</span><span class="o">-</span><span class="n">x86</span><span class="o">-</span><span class="mi">64</span><span class="w"></span>
<span class="n">architecture</span>: <span class="nc">i386</span>:<span class="nc">x86</span><span class="o">-</span><span class="mi">64</span><span class="p">,</span><span class="w"> </span><span class="n">flags</span><span class="w"> </span><span class="mh">0x00000011</span>:
<span class="nc">HAS_RELOC</span><span class="p">,</span><span class="w"> </span><span class="n">HAS_SYMS</span><span class="w"></span>
<span class="n">start</span><span class="w"> </span><span class="n">address</span><span class="w"> </span><span class="mh">0x0000000000000000</span><span class="w"></span>
</code></pre></div>
<p>the start_address variable is set to 0, which means that the ELF file will never be able to know where to start execution at if the kernel executes the ELF<br>
Does anyone know how to fix that ? What am I missing ? <br>
and last question : in the code, there is usage of malloc and <a href="https://docs.rs/cranelift-frontend/latest/cranelift_frontend/struct.FunctionBuilder.html#method.call_memset">https://docs.rs/cranelift-frontend/latest/cranelift_frontend/struct.FunctionBuilder.html#method.call_memset</a>,<br>
but ldd states my ELF is not dynamically linked against anything (I can't tell if it is statically linked and if so, where is memset and memcpy)</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wasmtime/blob/main/cranelift/object/tests/basic.rs#L149" style="background-image: url(https\:\/\/uploads\.zulipusercontent\.net\/73089191c495420cc7c8fd6956b6fe824d2cd03e\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f383334376231326164633930366434363263653362316432633532396131316335663639356538333230613339626464303132666264366332373064653635302f62797465636f6465616c6c69616e63652f7761736d74696d65)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wasmtime/blob/main/cranelift/object/tests/basic.rs#L149" title="wasmtime/basic.rs at main · bytecodealliance/wasmtime">wasmtime/basic.rs at main · bytecodealliance/wasmtime</a></div><div class="message_embed_description">Standalone JIT-style runtime for WebAssembly, using Cranelift - wasmtime/basic.rs at main · bytecodealliance/wasmtime</div></div></div>



<a name="279990404"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20A%20bit%20of%20help%20%3F/near/279990404" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20A.20bit.20of.20help.20.3F.html#279990404">(Apr 24 2022 at 17:22)</a>:</h4>
<p><span class="user-mention silent" data-user-id="496398">infrandomness</span> has marked this topic as resolved.</p>



<a name="280046197"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20A%20bit%20of%20help%20%3F/near/280046197" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> infrandomness <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20A.20bit.20of.20help.20.3F.html#280046197">(Apr 25 2022 at 09:51)</a>:</h4>
<p>I was also wondering if anyone knows what part of the cranelift code determines what IR function should be considered global symbols ?<br>
I’m having troubles having a function seen as main to my linker because it is not global</p>



<a name="280116255"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20A%20bit%20of%20help%20%3F/near/280116255" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20A.20bit.20of.20help.20.3F.html#280116255">(Apr 25 2022 at 19:20)</a>:</h4>
<p><span class="user-mention" data-user-id="496398">@infrandomness</span> You should use call declare_function with Linkage::Export instead of Linkage::Local of you want to export a function.</p>



<a name="280125315"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20A%20bit%20of%20help%20%3F/near/280125315" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> infrandomness <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20A.20bit.20of.20help.20.3F.html#280125315">(Apr 25 2022 at 20:36)</a>:</h4>
<p><span class="user-mention silent" data-user-id="264278">bjorn3</span> <a href="#narrow/stream/206238-general/topic/.E2.9C.94.20A.20bit.20of.20help.20.3F/near/280116255">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="496398">infrandomness</span> You should use call declare_function with Linkage::Export instead of Linkage::Local of you want to export a function.</p>
</blockquote>
<p>I am not willing to export a function, but I am willing to have GNU ld detect my main function, and I think the reason as to why it does not is because the main symbol is not global</p>



<a name="280138462"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20A%20bit%20of%20help%20%3F/near/280138462" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> infrandomness <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20A.20bit.20of.20help.20.3F.html#280138462">(Apr 25 2022 at 22:34)</a>:</h4>
<p>EDIT: your suggestion seems to have fixed it <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span></p>



<a name="280166004"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20A%20bit%20of%20help%20%3F/near/280166004" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20A.20bit.20of.20help.20.3F.html#280166004">(Apr 26 2022 at 06:23)</a>:</h4>
<p>The linker doesn't export symbols from am executable by default. You need to export <code>main</code> from the local object file for the linker to resolve it in the crt object which uses it.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>