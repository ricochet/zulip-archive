<html>
<head><meta charset="utf-8"><title>✔ noobie witx question · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/index.html">general</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20noobie.20witx.20question.html">✔ noobie witx question</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="247826473"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20noobie%20witx%20question/near/247826473" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Scott Waye <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20noobie.20witx.20question.html#247826473">(Jul 31 2021 at 22:18)</a>:</h4>
<p>Is it possible today, do you think, to call say a Rust Wasm module from a dotnet (c#) module using witx-bindgen?  I know witx-bindgen does not support dotnet, but maybe for a simple  "getAnswer(i) =&gt; i" type function I could handcraft the binding.  Just for fun.</p>



<a name="247826723"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20noobie%20witx%20question/near/247826723" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Scott Waye <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20noobie.20witx.20question.html#247826723">(Jul 31 2021 at 22:27)</a>:</h4>
<p>I can create the c# side, changing the c#-&gt;llvm-&gt;wasm compilation as necessary</p>



<a name="247942914"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20noobie%20witx%20question/near/247942914" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> fitzgen (he/him) <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20noobie.20witx.20question.html#247942914">(Aug 02 2021 at 17:05)</a>:</h4>
<p><code>witx-bindgen</code> doesn't have access to anything embedders don't otherwise have access to, so you can always write the bindings code by hand, but it will quickly get painful as more advanced types are used.</p>



<a name="247944089"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20noobie%20witx%20question/near/247944089" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> fitzgen (he/him) <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20noobie.20witx.20question.html#247944089">(Aug 02 2021 at 17:11)</a>:</h4>
<p><span class="user-mention" data-user-id="253994">@Alex Crichton</span> do we have a witx-bindgen tool that takes a witx module, whether you're importing/exporting it, and then dumps the corresponding canonical ABI? that seems like something you'd really want if attempting to bind to canonical ABI things by hand like this</p>



<a name="247944162"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20noobie%20witx%20question/near/247944162" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20noobie.20witx.20question.html#247944162">(Aug 02 2021 at 17:12)</a>:</h4>
<p>not currently, no, but it wouldn't be too hard to implement!</p>



<a name="247949969"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20noobie%20witx%20question/near/247949969" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Brown <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20noobie.20witx.20question.html#247949969">(Aug 02 2021 at 18:02)</a>:</h4>
<p>yeah, I would find that feature useful too</p>



<a name="248248628"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20noobie%20witx%20question/near/248248628" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Scott Waye <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20noobie.20witx.20question.html#248248628">(Aug 03 2021 at 16:57)</a>:</h4>
<p>Thanks, I need to play more to understand what problems I'm going to hit.  First though, this is my first day with rust....</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">use</span><span class="w">  </span><span class="n">witx_bindgen_rust</span>::<span class="n">export</span><span class="p">;</span><span class="w"></span>

<span class="cp">#[no_mangle]</span><span class="w"></span>
<span class="k">pub</span><span class="w"> </span><span class="k">extern</span><span class="w"> </span><span class="s">"C"</span><span class="w"> </span><span class="k">fn</span> <span class="nf">doubles</span><span class="p">(</span><span class="n">i</span><span class="w"> </span>: <span class="kt">i32</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">i32</span> <span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="n">export</span><span class="o">!</span><span class="w"> </span><span class="p">(</span><span class="n">doubles</span><span class="p">);</span><span class="w"></span>
</code></pre></div>
<p>Is this close?  export! wants a string literal or TokenStream, so I've got that syntax wrong, but is it close?</p>
<p>Edit: sorry, ignore me, found some examples in the repo.</p>



<a name="248281639"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20noobie%20witx%20question/near/248281639" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Scott Waye <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20noobie.20witx.20question.html#248281639">(Aug 03 2021 at 21:11)</a>:</h4>
<p>but with witx</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">doubles</span>: <span class="nc">function</span><span class="p">(</span><span class="n">i</span>: <span class="nc">s32</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">s32</span><span class="w"></span>
</code></pre></div>
<p>the macro seems to produce an error</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">witx_bindgen_rust</span>::<span class="n">export</span><span class="o">!</span><span class="p">(</span><span class="s">"w1.witx"</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span><span class="w"> </span><span class="err">`</span><span class="n">w1</span>::<span class="n">W1</span><span class="err">`</span><span class="w"> </span><span class="n">cannot</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">made</span><span class="w"> </span><span class="n">into</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">object</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"></span>
<span class="n">note</span>: <span class="nc">for</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">trait</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="s">"object safe"</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">needs</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">allow</span><span class="w"> </span><span class="n">building</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">vtable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">allow</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">call</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">resolvable</span><span class="w"> </span><span class="n">dynamically</span><span class="p">;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">information</span><span class="w"> </span><span class="n">visit</span><span class="w"> </span><span class="o">&lt;</span><span class="n">https</span>:<span class="c1">//doc.rust-lang.org/reference/items/traits.html#object-safety&gt;</span>
</code></pre></div>



<a name="248283468"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20noobie%20witx%20question/near/248283468" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Scott Waye <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20noobie.20witx.20question.html#248283468">(Aug 03 2021 at 21:27)</a>:</h4>
<p>I replaced the macro with the code from <a href="https://bytecodealliance.github.io/witx-bindgen/">https://bytecodealliance.github.io/witx-bindgen/</a> and that worked, so I guess I messed up type/trait/impl names somewere</p>



<a name="248288772"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20noobie%20witx%20question/near/248288772" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20noobie.20witx.20question.html#248288772">(Aug 03 2021 at 22:26)</a>:</h4>
<p>ah yes as you've found the input to the macro is a <code>*.witx</code> file path, but the error you got there seems like a bug in witx-bindgen itself, do you know how I can reproduce it?</p>



<a name="248289528"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20noobie%20witx%20question/near/248289528" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Scott Waye <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20noobie.20witx.20question.html#248289528">(Aug 03 2021 at 22:36)</a>:</h4>
<p>I dont know if you want to waste time on this, as it was just me trying to get my rust right, but starting with this which works:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">witx_bindgen_rust</span>::<span class="n">export</span><span class="o">!</span><span class="p">(</span><span class="s">"w1.witx"</span><span class="p">);</span><span class="w"></span>

<span class="k">struct</span> <span class="nc">W1</span><span class="p">;</span><span class="w"></span>

<span class="k">impl</span><span class="w"> </span><span class="n">w1</span>::<span class="n">W1</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">W1</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">    </span><span class="k">fn</span> <span class="nf">doubles</span><span class="p">(</span><span class="n">i</span><span class="w"> </span>: <span class="kt">i32</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">i32</span> <span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>Change it to the bogus</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">witx_bindgen_rust</span>::<span class="n">export</span><span class="o">!</span><span class="p">(</span><span class="s">"w1.witx"</span><span class="p">);</span><span class="w"></span>

<span class="k">use</span><span class="w"> </span><span class="n">w1</span>::<span class="o">*</span><span class="p">;</span><span class="w"></span>

<span class="k">struct</span> <span class="nc">Wasm</span><span class="p">;</span><span class="w"></span>

<span class="k">impl</span><span class="w"> </span><span class="n">w1</span>::<span class="n">W1</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Wasm</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">    </span><span class="k">fn</span> <span class="nf">doubles</span><span class="p">(</span><span class="n">i</span><span class="w"> </span>: <span class="kt">i32</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">i32</span> <span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>and that should do it.</p>



<a name="248289692"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20noobie%20witx%20question/near/248289692" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20noobie.20witx.20question.html#248289692">(Aug 03 2021 at 22:38)</a>:</h4>
<p>nah no worries, I'll dig in soon to see if I can make that error better</p>



<a name="248289698"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20noobie%20witx%20question/near/248289698" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20noobie.20witx.20question.html#248289698">(Aug 03 2021 at 22:38)</a>:</h4>
<p>that's a pretty bad error to get when you're just starting ;_;</p>



<a name="248344466"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20noobie%20witx%20question/near/248344466" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20noobie.20witx.20question.html#248344466">(Aug 04 2021 at 12:45)</a>:</h4>
<p><span class="user-mention silent" data-user-id="395878">Scott Waye</span> has marked this topic as resolved.</p>



<a name="248353768"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20noobie%20witx%20question/near/248353768" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Scott Waye <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20noobie.20witx.20question.html#248353768">(Aug 04 2021 at 14:03)</a>:</h4>
<p><span class="user-mention" data-user-id="253994">@Alex Crichton</span> Cool it works.  I cheated with this i32-&gt;i32 example by skipping the c# side as it would just be a straight passthrough, but the c# wasm calling out to the rust wasm worked.  I couldn't get the Chrome Canary debugger to step into the rust source code.  It loaded the rust source, but I couldn't set breakpoints nor step into it.  The debugger just showed the wasm/wat.<br>
<a href="/user_uploads/15107/s0hyoDykr9fJnLy5JD_F3cse/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/15107/s0hyoDykr9fJnLy5JD_F3cse/image.png" title="image.png"><img src="/user_uploads/15107/s0hyoDykr9fJnLy5JD_F3cse/image.png"></a></div>



<a name="248354926"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20noobie%20witx%20question/near/248354926" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Scott Waye <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20noobie.20witx.20question.html#248354926">(Aug 04 2021 at 14:11)</a>:</h4>
<p>strings next....</p>



<a name="248357144"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20noobie%20witx%20question/near/248357144" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20noobie.20witx.20question.html#248357144">(Aug 04 2021 at 14:27)</a>:</h4>
<p>seems like a good start at least though1</p>



<a name="253904085"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20noobie%20witx%20question/near/253904085" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rom Grk <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20noobie.20witx.20question.html#253904085">(Sep 19 2021 at 00:26)</a>:</h4>
<p>I need to jit stuff in a portable way, so I though about using wasm instead of generating x86/arm directly. Is wasmtime good for this use-case? Does wasmtime have stuff to help write wasm on the fly, or is that outside the scope?</p>



<a name="254081427"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20noobie%20witx%20question/near/254081427" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> fitzgen (he/him) <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20noobie.20witx.20question.html#254081427">(Sep 20 2021 at 16:52)</a>:</h4>
<p>wasmtime just runs wasm</p>
<p>you can use <code>wasm-encoder</code> to write wasm binaries</p>



<a name="254081744"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20noobie%20witx%20question/near/254081744" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20noobie.20witx.20question.html#254081744">(Sep 20 2021 at 16:54)</a>:</h4>
<p><span class="user-mention" data-user-id="441813">@Rom Grk</span> if you need a JIT backend, then Cranelift (the default compiler backend used by Wasmtime) could be used directly; there is some infrastructure to support a relatively simple JIT scenario (the <code>cranelift-jit</code> crate) and e.g. <span class="user-mention" data-user-id="264278">@bjorn3</span> uses this in the Rust cg_clif backend if I'm not mistaken</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>