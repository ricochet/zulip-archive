<html>
<head><meta charset="utf-8"><title>Build wasmtime for Android · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/index.html">general</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Build.20wasmtime.20for.20Android.html">Build wasmtime for Android</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="198090789"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Build%20wasmtime%20for%20Android/near/198090789" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Denis <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Build.20wasmtime.20for.20Android.html#198090789">(May 19 2020 at 16:21)</a>:</h4>
<p>Hi all, is there an instruction for building wasmtime for Android and iOS ?</p>



<a name="198091544"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Build%20wasmtime%20for%20Android/near/198091544" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Build.20wasmtime.20for.20Android.html#198091544">(May 19 2020 at 16:27)</a>:</h4>
<p>Wasmtime hasn't been tested on these platforms and likely won't compile there today. The porting work necessary to get this working, though, is likely pretty small!</p>



<a name="198092832"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Build%20wasmtime%20for%20Android/near/198092832" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Denis <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Build.20wasmtime.20for.20Android.html#198092832">(May 19 2020 at 16:36)</a>:</h4>
<p>Thanks !! In free time I will try to port it ...</p>



<a name="198093513"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Build%20wasmtime%20for%20Android/near/198093513" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Denis <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Build.20wasmtime.20for.20Android.html#198093513">(May 19 2020 at 16:41)</a>:</h4>
<p>Seems like there are only some modules not compiled:<br>
error: failed to run custom build command for <code>backtrace-sys v0.1.36</code></p>
<p>Caused by:<br>
  process didn't exit successfully: <code>G:\Projects\Programing\wasmtime\target\release\build\backtrace-sys-f5d9903e1591a6a7\build-script-build</code> (exit code: 1)<br>
--- stdout<br>
OPT_LEVEL = Some("3")<br>
TARGET = Some("i686-linux-android")<br>
HOST = Some("x86_64-pc-windows-msvc")<br>
CC_i686-linux-android = None<br>
CC_i686_linux_android = None<br>
TARGET_CC = None<br>
CC = None<br>
CFLAGS_i686-linux-android = None<br>
CFLAGS_i686_linux_android = None<br>
TARGET_CFLAGS = None<br>
CFLAGS = None<br>
CRATE_CC_NO_DEFAULTS = None<br>
DEBUG = Some("false")<br>
running: "i686-linux-android-clang" "-O3" "-ffunction-sections" "-fdata-sections" "-fPIC" "--target=i686-linux-android" "-Wall" "-Wextra" "-E" "src/android-api.c"</p>
<p>--- stderr</p>
<p>error occurred: Failed to find tool. Is <code>i686-linux-android-clang</code> installed? (see <a href="https://github.com/alexcrichton/cc-rs#compile-time-requirements">https://github.com/alexcrichton/cc-rs#compile-time-requirements</a> for help)</p>
<p>warning: build failed, waiting for other jobs to finish...<br>
error: failed to run custom build command for <code>wasmtime-runtime v0.16.0 (G:\Projects\Programing\wasmtime\crates\runtime)</code></p>
<p>Caused by:<br>
  process didn't exit successfully: <code>G:\Projects\Programing\wasmtime\target\release\build\wasmtime-runtime-9ffa91a42426fedc\build-script-build</code> (exit code: 1)<br>
--- stdout<br>
cargo:rerun-if-changed=src/helpers.c<br>
TARGET = Some("i686-linux-android")<br>
OPT_LEVEL = Some("3")<br>
HOST = Some("x86_64-pc-windows-msvc")<br>
CC_i686-linux-android = None<br>
CC_i686_linux_android = None<br>
TARGET_CC = None<br>
CC = None<br>
CFLAGS_i686-linux-android = None<br>
CFLAGS_i686_linux_android = None<br>
TARGET_CFLAGS = None<br>
CFLAGS = None<br>
CRATE_CC_NO_DEFAULTS = None<br>
DEBUG = Some("false")<br>
running: "i686-linux-android-clang" "-O3" "-ffunction-sections" "-fdata-sections" "-fPIC" "--target=i686-linux-android" "-Wall" "-Wextra" "-o" "G:\\Projects\\Programing\\wasmtime\\target\\i686-linux-android\\release\\build\\wasmtime-runtime-5cf986442753146a\\out\\src/helpers.o" "-c" "src/helpers.c"</p>
<p>--- stderr</p>
<p>error occurred: Failed to find tool. Is <code>i686-linux-android-clang</code> installed? (see <a href="https://github.com/alexcrichton/cc-rs#compile-time-requirements">https://github.com/alexcrichton/cc-rs#compile-time-requirements</a> for help)</p>
<p>warning: build failed, waiting for other jobs to finish...<br>
error: failed to run custom build command for <code>zstd-sys v1.4.15+zstd.1.4.4</code></p>
<p>Caused by:<br>
  process didn't exit successfully: <code>G:\Projects\Programing\wasmtime\target\release\build\zstd-sys-1eeff73c0cda7a4c\build-script-build</code> (exit code: 1)<br>
--- stdout<br>
TARGET = Some("i686-linux-android")<br>
HOST = Some("x86_64-pc-windows-msvc")<br>
CC_i686-linux-android = None<br>
CC_i686_linux_android = None<br>
TARGET_CC = None<br>
CC = None<br>
CFLAGS_i686-linux-android = None<br>
CFLAGS_i686_linux_android = None<br>
TARGET_CFLAGS = None<br>
CFLAGS = None<br>
CRATE_CC_NO_DEFAULTS = None<br>
DEBUG = Some("false")<br>
running: "i686-linux-android-clang" "-O3" "-ffunction-sections" "-fdata-sections" "-fPIC" "--target=i686-linux-android" "-I" "zstd/lib/" "-I" "zstd/lib/common" "-I" "zstd/lib/legacy" "-fvisibility=hidden" "-DZSTD_LIB_DEPRECATED=0" "-DZSTDLIB_VISIBILITY=" "-DZDICTLIB_VISIBILITY=" "-DZSTDERRORLIB_VISIBILITY=" "-DZSTD_LEGACY_SUPPORT=1" "-o" "G:\\Projects\\Programing\\wasmtime\\target\\i686-linux-android\\release\\build\\zstd-sys-f793a83e8009b4cf\\out\\zstd\\lib\\common\\debug.o" "-c" "zstd\\lib\\common\\debug.c"<br>
running: "i686-linux-android-clang" "-O3" "-ffunction-sections" "-fdata-sections" "-fPIC" "--target=i686-linux-android" "-I" "zstd/lib/" "-I" "zstd/lib/common" "-I" "zstd/lib/legacy" "-fvisibility=hidden" "-DZSTD_LIB_DEPRECATED=0" "-DZSTDLIB_VISIBILITY=" "-DZDICTLIB_VISIBILITY=" "-DZSTDERRORLIB_VISIBILITY=" "-DZSTD_LEGACY_SUPPORT=1" "-o" "G:\\Projects\\Programing\\wasmtime\\target\\i686-linux-android\\release\\build\\zstd-sys-f793a83e8009b4cf\\out\\zstd\\lib\\common\\entropy_common.o" "-c" "zstd\\lib\\common\\entropy_common.c"</p>
<p>--- stderr</p>
<p>error occurred: Failed to find tool. Is <code>i686-linux-android-clang</code> installed? (see <a href="https://github.com/alexcrichton/cc-rs#compile-time-requirements">https://github.com/alexcrichton/cc-rs#compile-time-requirements</a> for help)</p>
<p>warning: build failed, waiting for other jobs to finish...<br>
error: build failed</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/alexcrichton/cc-rs#compile-time-requirements" style="background-image: url(https://avatars0.githubusercontent.com/u/64996?s=400&amp;v=4)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/alexcrichton/cc-rs#compile-time-requirements" title="alexcrichton/cc-rs">alexcrichton/cc-rs</a></div><div class="message_embed_description">Rust library for build scripts to compile C/C++ code into a Rust library - alexcrichton/cc-rs</div></div></div>



<a name="202698434"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Build%20wasmtime%20for%20Android/near/202698434" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Max de Danschutter <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Build.20wasmtime.20for.20Android.html#202698434">(Jul 02 2020 at 14:48)</a>:</h4>
<p>For a project that I'm working on, we are considering switching to wasmtime for our WebAssembly runtime. If I understand correctly, wasmtime currently only supports the x86_64 architecture. For the project that I'm working on, we would love to see support for Android and AArch64 in general. The wasmtime guide, section "Platform Support - JIT compiler support", states "Support for ARM, AArch64, and x86 is planned at this time".  I've done some research myself but couldn't find any more info regarding those architectures. Could I have an update on the jit compiler progress for those architectures, if any.</p>



<a name="202698679"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Build%20wasmtime%20for%20Android/near/202698679" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joey Gouly <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Build.20wasmtime.20for.20Android.html#202698679">(Jul 02 2020 at 14:50)</a>:</h4>
<p>Aarch64 support works pretty well now</p>



<a name="202698870"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Build%20wasmtime%20for%20Android/near/202698870" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joey Gouly <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Build.20wasmtime.20for.20Android.html#202698870">(Jul 02 2020 at 14:51)</a>:</h4>
<p>(I don't know about support on Android though)</p>



<a name="202699054"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Build%20wasmtime%20for%20Android/near/202699054" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Build.20wasmtime.20for.20Android.html#202699054">(Jul 02 2020 at 14:53)</a>:</h4>
<p><span class="user-mention" data-user-id="315493">@Max de Danschutter</span> as Joey says, aarch64 is coming along nicely, and our plan ("we" being the SpiderMonkey/Wasm team at Mozilla) is to use this as our optimizing backend for Wasm in Firefox/aarch64 -- so we're aiming for production quality</p>



<a name="202705645"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Build%20wasmtime%20for%20Android/near/202705645" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Max de Danschutter <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Build.20wasmtime.20for.20Android.html#202705645">(Jul 02 2020 at 15:41)</a>:</h4>
<p>That's great to hear, especially the production quality! Could I also ask what WebAssembly features aarch64 support currently and what is still missing in general?  This would greatly help us out making the decision of moving to wasmtime!</p>



<a name="202705996"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Build%20wasmtime%20for%20Android/near/202705996" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Benjamin Bouvier <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Build.20wasmtime.20for.20Android.html#202705996">(Jul 02 2020 at 15:43)</a>:</h4>
<p>We currently have support for everything in the wasm MVP + some lightweight shipped features (bulk memory ops, etc.), and multi-value. Ongoing work is happening for reference types, SIMD and atomics. Ref types are pretty much done, they require more thorough testing + reviews, etc. SIMD and atomics have started relatively recently, in comparison.</p>



<a name="202706594"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Build%20wasmtime%20for%20Android/near/202706594" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Max de Danschutter <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Build.20wasmtime.20for.20Android.html#202706594">(Jul 02 2020 at 15:48)</a>:</h4>
<p>That is quite a lot already. It is indeed coming along nicely. Thanks for the help everyone this should be enough information!</p>



<a name="202706616"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Build%20wasmtime%20for%20Android/near/202706616" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Till Schneidereit <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Build.20wasmtime.20for.20Android.html#202706616">(Jul 02 2020 at 15:48)</a>:</h4>
<p><span class="user-mention" data-user-id="315493">@Max de Danschutter</span> the plan is to get to feature parity for Aarch64 quickly, and then keep it that way. We'll eventually expand that, but for now it'd be safe to view x86_64 and Aarch64 as the two platforms with the highest level of support.</p>
<p>A note on Android: we don't currently run CI tests on Android, or produce builds, but we know anecdotally that Wasmtime works on Android. We'd love to hear about issues and work together on fixing them if you run into any, though!</p>



<a name="202706986"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Build%20wasmtime%20for%20Android/near/202706986" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Max de Danschutter <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Build.20wasmtime.20for.20Android.html#202706986">(Jul 02 2020 at 15:51)</a>:</h4>
<p>When we switch to wasmtime there will be issues reported for sure as we intend to run it on as many platforms as possible. However, we will gladly help out as well!</p>



<a name="202707059"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Build%20wasmtime%20for%20Android/near/202707059" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Till Schneidereit <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Build.20wasmtime.20for.20Android.html#202707059">(Jul 02 2020 at 15:51)</a>:</h4>
<p>Sounds great — don't hesitate to reach out!</p>



<a name="203924020"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Build%20wasmtime%20for%20Android/near/203924020" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Max de Danschutter <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Build.20wasmtime.20for.20Android.html#203924020">(Jul 15 2020 at 07:33)</a>:</h4>
<p>Might be a bit off-topic but I've started my work on converting Wasmer to Wasmtime. <a href="https://docs.rs/wasmer-runtime/0.17.1/wasmer_runtime/struct.Ctx.html#structfield.data">In Wasmer,</a> the context of the currently running WebAssemly instance, which is implicitly passed to every WebAssembly function, can have user-supplied contextual data. This is a feature we use quite a lot and I couldn't find a good alternative in Wasmtime. Since I'm no expert at Wasmtime 'yet' could someone tell me what a good alternative is in Wasmtime.</p>



<a name="203938964"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Build%20wasmtime%20for%20Android/near/203938964" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Till Schneidereit <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Build.20wasmtime.20for.20Android.html#203938964">(Jul 15 2020 at 10:44)</a>:</h4>
<p><span class="user-mention" data-user-id="253994">@Alex Crichton</span> can you weigh in on how best to do this? ^</p>



<a name="203957119"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Build%20wasmtime%20for%20Android/near/203957119" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Build.20wasmtime.20for.20Android.html#203957119">(Jul 15 2020 at 13:47)</a>:</h4>
<p><span class="user-mention" data-user-id="315493">@Max de Danschutter</span> could you describe a bit how it's used for you? Is this something like data associated with callbacks?</p>



<a name="203958684"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Build%20wasmtime%20for%20Android/near/203958684" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Max de Danschutter <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Build.20wasmtime.20for.20Android.html#203958684">(Jul 15 2020 at 14:00)</a>:</h4>
<p><span class="user-mention" data-user-id="253994">@Alex Crichton</span> We have a ModuleContext struct, which is the host state associated with a particular module instance. We use this to map calls from modules into appropriate host side calls and to interact with memory exposed by the instance. If a more detailed explanation is needed let me know!</p>



<a name="203958961"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Build%20wasmtime%20for%20Android/near/203958961" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Build.20wasmtime.20for.20Android.html#203958961">(Jul 15 2020 at 14:02)</a>:</h4>
<p>ah ok, so you're mainly implementing host functions that interpret arguments as pointers into wasm memory?</p>



<a name="203959384"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Build%20wasmtime%20for%20Android/near/203959384" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yury Delendik <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Build.20wasmtime.20for.20Android.html#203959384">(Jul 15 2020 at 14:05)</a>:</h4>
<p>maybe it is something like <code>wasm_func_new_with_env</code>/<code>wasm_func_callback_with_env_t</code> ?</p>



<a name="203959445"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Build%20wasmtime%20for%20Android/near/203959445" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Till Schneidereit <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Build.20wasmtime.20for.20Android.html#203959445">(Jul 15 2020 at 14:06)</a>:</h4>
<p><span class="user-mention" data-user-id="315493">@Max de Danschutter</span> if you mainly want to get the memory, there's direct support for that, too. See the third example here: <a href="https://bytecodealliance.github.io/wasmtime/api/wasmtime/struct.Func.html#examples-1">https://bytecodealliance.github.io/wasmtime/api/wasmtime/struct.Func.html#examples-1</a></p>



<a name="203959479"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Build%20wasmtime%20for%20Android/near/203959479" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Till Schneidereit <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Build.20wasmtime.20for.20Android.html#203959479">(Jul 15 2020 at 14:06)</a>:</h4>
<p>err, the fourth example</p>



<a name="203959718"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Build%20wasmtime%20for%20Android/near/203959718" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Max de Danschutter <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Build.20wasmtime.20for.20Android.html#203959718">(Jul 15 2020 at 14:08)</a>:</h4>
<p>Besides accessing wasm memory in host functions we also update our host state that is associated with that particular module instance.</p>



<a name="203959812"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Build%20wasmtime%20for%20Android/near/203959812" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Build.20wasmtime.20for.20Android.html#203959812">(Jul 15 2020 at 14:09)</a>:</h4>
<p>Ah ok, so accessing memory is easily done through <code>Caller</code> which can access the memory of the caller so long as it's exported. Otherwise there's no native equivalent to this in Wasmtime, but you can create a <code>Func</code>-per-instance (it should be very cheap with <code>Func::wrap</code>)</p>



<a name="203959832"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Build%20wasmtime%20for%20Android/near/203959832" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Build.20wasmtime.20for.20Android.html#203959832">(Jul 15 2020 at 14:09)</a>:</h4>
<p>with a <code>Func</code>-per-instance you can then close over instance-specific state to update it, would that work for your use case?</p>



<a name="203961706"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Build%20wasmtime%20for%20Android/near/203961706" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Till Schneidereit <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Build.20wasmtime.20for.20Android.html#203961706">(Jul 15 2020 at 14:23)</a>:</h4>
<p>I could easily see quite a few use cases needing to associate data with an instance, so I wonder if we should add support for that? Instances are heavy enough that adding an additional pointer-sized members should not matter at all, I'd hope</p>



<a name="203961810"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Build%20wasmtime%20for%20Android/near/203961810" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Build.20wasmtime.20for.20Android.html#203961810">(Jul 15 2020 at 14:24)</a>:</h4>
<p>Oh for sure yeah, but callbacks, for example, don't have access to their <code>Instance</code></p>



<a name="203961829"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Build%20wasmtime%20for%20Android/near/203961829" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Build.20wasmtime.20for.20Android.html#203961829">(Jul 15 2020 at 14:24)</a>:</h4>
<p>we can certainly add the APIs but I'm not sure if it'd solve the use case here</p>



<a name="203961858"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Build%20wasmtime%20for%20Android/near/203961858" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yury Delendik <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Build.20wasmtime.20for.20Android.html#203961858">(Jul 15 2020 at 14:24)</a>:</h4>
<p>yes, that's what <code>wasm_func_new_with_env</code> for, and Rust API can do it via closure</p>



<a name="203962057"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Build%20wasmtime%20for%20Android/near/203962057" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Till Schneidereit <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Build.20wasmtime.20for.20Android.html#203962057">(Jul 15 2020 at 14:26)</a>:</h4>
<p><span class="user-mention silent" data-user-id="253994">Alex Crichton</span> <a href="#narrow/stream/206238-general/topic/Build.20wasmtime.20for.20Android/near/203961810">said</a>:</p>
<blockquote>
<p>Oh for sure yeah, but callbacks, for example, don't have access to their <code>Instance</code></p>
</blockquote>
<p>Ah, I see—good point! In that case closures are probably needed, yes. And certainly better than adding overhead to all callbacks</p>



<a name="203968129"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Build%20wasmtime%20for%20Android/near/203968129" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Max de Danschutter <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Build.20wasmtime.20for.20Android.html#203968129">(Jul 15 2020 at 15:13)</a>:</h4>
<p>Ah, capturing my <code>ModuleContext</code>could work but then how should I access that within an import?</p>



<a name="203968496"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Build%20wasmtime%20for%20Android/near/203968496" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Build.20wasmtime.20for.20Android.html#203968496">(Jul 15 2020 at 15:15)</a>:</h4>
<p><span class="user-mention" data-user-id="315493">@Max de Danschutter</span> the thinking is that you'd make a <code>Func</code>-per-import, and each <code>Func</code> is a Rust closure which can close over outer state</p>



<a name="203968783"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Build%20wasmtime%20for%20Android/near/203968783" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Max de Danschutter <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Build.20wasmtime.20for.20Android.html#203968783">(Jul 15 2020 at 15:17)</a>:</h4>
<p>Ah, of course, now I see. Quite new to Rust so closures sometimes confuse me a bit <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span> <br>
That looks like the most straight forward way to do it in wasmtime so I'll try that out!</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>