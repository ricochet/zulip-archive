<html>
<head><meta charset="utf-8"><title>Java JNI bindings to Wasmtime · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/index.html">general</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html">Java JNI bindings to Wasmtime</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="212244883"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/212244883" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Benjamin Fry <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#212244883">(Oct 04 2020 at 22:40)</a>:</h4>
<p>I've been playing with this for the past week or so, i.e. Java JNI bindings to Wasmtime. Thought I'd share here, if there are other folks interested. It's very early stages, but I've at least gotten up to calling Java methods from WASM via the Java Wasmtime bindings. There's still a lot to do. But it's really exciting to see this working. Nice work all on all the interfaces, Wasmtime has been a pleasure to work with. <a href="https://github.com/bluejekyll/wasmtime-java">https://github.com/bluejekyll/wasmtime-java</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bluejekyll/wasmtime-java" style="background-image: url(https://avatars3.githubusercontent.com/u/986845?s=400&amp;v=4)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bluejekyll/wasmtime-java" title="bluejekyll/wasmtime-java">bluejekyll/wasmtime-java</a></div><div class="message_embed_description">Wasmtime bindings for Java. Contribute to bluejekyll/wasmtime-java development by creating an account on GitHub.</div></div></div>



<a name="212250906"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/212250906" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#212250906">(Oct 05 2020 at 01:29)</a>:</h4>
<p>Nice! Would love to add this to the readme when it's ready and we may want to move into the org if you'd like as well</p>



<a name="212254490"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/212254490" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Benjamin Fry <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#212254490">(Oct 05 2020 at 03:12)</a>:</h4>
<p>Yes. I’d definitely love to do that. I’m doing my best to do things correctly. I’m a little nervous about the threading model right now, but am happy with the memory management.</p>



<a name="212255604"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/212255604" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#212255604">(Oct 05 2020 at 03:44)</a>:</h4>
<p>I'd be happy to help out with any questions in the wasmtime arena if need be!</p>



<a name="212255605"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/212255605" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#212255605">(Oct 05 2020 at 03:44)</a>:</h4>
<p>Although I'm much less knowledgeable in the JNI arena...</p>



<a name="212313919"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/212313919" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Benjamin Fry <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#212313919">(Oct 05 2020 at 15:15)</a>:</h4>
<p>Right now I have some concerns about dropping across threads. Java has a new Cleaner facility (deprecates finalize methods), and I think it will potentially cleanup objects on a separate thread. This could mean that !Send and !Sync types (e.g. Store) might get dropped by a different thread. Given that the wasmtime types don’t implement Drop, I think this is ok, but I wonder if there are other concerns there?</p>



<a name="212319292"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/212319292" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#212319292">(Oct 05 2020 at 15:54)</a>:</h4>
<p><span class="user-mention" data-user-id="350398">@Benjamin Fry</span> nah that'll be the cause of many segfaults, they all need to be dropped on the same thread. I had to deal with this with the Go bindings as well, which specifically queued up items for destruction into a shared structure and then the "main item" occasionally gc'd it. That's not a great solution in Go though and I'd ideally like to do better, but I wasn't able to find a way in Go to force things to deallocate on the same thread.</p>



<a name="212320229"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/212320229" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Benjamin Fry <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#212320229">(Oct 05 2020 at 16:00)</a>:</h4>
<p>Thanks, <span class="user-mention" data-user-id="253994">@Alex Crichton</span>, that is exactly the type of thing I was worried about.</p>



<a name="212321435"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/212321435" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Benjamin Fry <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#212321435">(Oct 05 2020 at 16:09)</a>:</h4>
<p>I'm a little tempted to spawn a thread in Rust to manage all of the Wasmtime components, but that would add a substantial amount of state to manage between threads...</p>



<a name="212592007"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/212592007" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Benjamin Fry <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#212592007">(Oct 07 2020 at 17:28)</a>:</h4>
<p>I got end-to-end tests working! Still need to figure up the threading and cleanup, but this is in pretty decent shape for POC and outline.</p>



<a name="212870753"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/212870753" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Benjamin Fry <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#212870753">(Oct 09 2020 at 20:15)</a>:</h4>
<p><span class="user-mention" data-user-id="253994">@Alex Crichton</span> taking you up on your offer, is there a standard for array and string conversion into WASM that I can follow? It's not 100% clear to me right now how to pass byte arrays and strings into wasmtime. I'm assuming this is mostly standardized because wasm-bindgen does something on the WASM interface level. Maybe you could point me at where this happens in the Go bindings?</p>



<a name="212870871"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/212870871" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#212870871">(Oct 09 2020 at 20:16)</a>:</h4>
<p><span class="user-mention" data-user-id="350398">@Benjamin Fry</span> do you mean at the</p>



<a name="212870879"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/212870879" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#212870879">(Oct 09 2020 at 20:16)</a>:</h4>
<p>C API layer?</p>



<a name="212870883"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/212870883" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#212870883">(Oct 09 2020 at 20:16)</a>:</h4>
<p>or in wasm itself?</p>



<a name="212870972"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/212870972" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Benjamin Fry <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#212870972">(Oct 09 2020 at 20:17)</a>:</h4>
<p>The "C" api layer, though I'm not using the C api, I'm going straight from Java -&gt; JNI -&gt; Rust -&gt; Wasmtime... it's easier I think than using the C API.</p>



<a name="212871130"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/212871130" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#212871130">(Oct 09 2020 at 20:19)</a>:</h4>
<p>ah ok, so wasm-bindgen is not really related to wasmtime in that it's all meant for the web</p>



<a name="212871147"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/212871147" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#212871147">(Oct 09 2020 at 20:19)</a>:</h4>
<p>otherwise do you mean like passing wasm bytes to <code>wasm_module_new</code>?</p>



<a name="212871148"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/212871148" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#212871148">(Oct 09 2020 at 20:19)</a>:</h4>
<p>or</p>



<a name="212871176"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/212871176" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#212871176">(Oct 09 2020 at 20:19)</a>:</h4>
<p>getting the name from <code>wasm_importtype_module</code> or something like that?</p>



<a name="212871242"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/212871242" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Benjamin Fry <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#212871242">(Oct 09 2020 at 20:20)</a>:</h4>
<p>No, the <code>Func</code> interface.</p>



<a name="212871259"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/212871259" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#212871259">(Oct 09 2020 at 20:20)</a>:</h4>
<p>so like you want to call a wasm program and give it a string?</p>



<a name="212871332"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/212871332" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Benjamin Fry <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#212871332">(Oct 09 2020 at 20:21)</a>:</h4>
<p>Or a byte array, yes. I understand this needs to be done with a Memory or Table?</p>



<a name="212871360"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/212871360" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#212871360">(Oct 09 2020 at 20:21)</a>:</h4>
<p>ah</p>



<a name="212871362"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/212871362" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#212871362">(Oct 09 2020 at 20:21)</a>:</h4>
<p>ok</p>



<a name="212871371"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/212871371" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#212871371">(Oct 09 2020 at 20:21)</a>:</h4>
<p>er</p>



<a name="212871387"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/212871387" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#212871387">(Oct 09 2020 at 20:21)</a>:</h4>
<p>er  sry learning  a new keyboard layout...</p>



<a name="212871407"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/212871407" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#212871407">(Oct 09 2020 at 20:21)</a>:</h4>
<p>but anyway you'll be using <code>Memory</code></p>



<a name="212871459"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/212871459" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#212871459">(Oct 09 2020 at 20:22)</a>:</h4>
<p>you'll at this point basically need to do what wasm-bindgen does by hand</p>



<a name="212871467"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/212871467" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Benjamin Fry <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#212871467">(Oct 09 2020 at 20:22)</a>:</h4>
<p>right... that's what I figured.</p>



<a name="212871470"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/212871470" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#212871470">(Oct 09 2020 at 20:22)</a>:</h4>
<p>which means you need to manually copy the bytes into <code>Memory</code> and then call the wasm function with the pointer</p>



<a name="212871487"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/212871487" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#212871487">(Oct 09 2020 at 20:22)</a>:</h4>
<p>currently wasmtime doesn't do anything to help you</p>



<a name="212871499"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/212871499" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#212871499">(Oct 09 2020 at 20:23)</a>:</h4>
<p>although this is the whole schtick of interface types</p>



<a name="212871523"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/212871523" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Benjamin Fry <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#212871523">(Oct 09 2020 at 20:23)</a>:</h4>
<p>What are "interface" types?</p>



<a name="212871550"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/212871550" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#212871550">(Oct 09 2020 at 20:23)</a>:</h4>
<p><a href="https://github.com/webassembly/interface-types">https://github.com/webassembly/interface-types</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/webassembly/interface-types" style="background-image: url(https://avatars3.githubusercontent.com/u/11578470?s=400&amp;v=4)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/webassembly/interface-types" title="WebAssembly/interface-types">WebAssembly/interface-types</a></div><div class="message_embed_description">Contribute to WebAssembly/interface-types development by creating an account on GitHub.</div></div></div>



<a name="212871614"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/212871614" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#212871614">(Oct 09 2020 at 20:24)</a>:</h4>
<p>still a wasm proposal, but basically makes strings and such first-class types</p>



<a name="212871674"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/212871674" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Benjamin Fry <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#212871674">(Oct 09 2020 at 20:24)</a>:</h4>
<p>Ah, that looks nice.</p>



<a name="212871746"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/212871746" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#212871746">(Oct 09 2020 at 20:25)</a>:</h4>
<p>you can think of that proposal sort of like wasm-bindgen standardized</p>



<a name="212871827"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/212871827" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Benjamin Fry <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#212871827">(Oct 09 2020 at 20:26)</a>:</h4>
<p>In the mean time, is there a common pattern for laying out the function parameters that are associated with the Memory being passed in?</p>



<a name="212871886"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/212871886" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Benjamin Fry <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#212871886">(Oct 09 2020 at 20:27)</a>:</h4>
<p>That is, I believe I have to use a Linker to associate the memory, and then pass in the length of the Memory?</p>



<a name="212872478"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/212872478" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Benjamin Fry <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#212872478">(Oct 09 2020 at 20:33)</a>:</h4>
<p>I guess I'm looking for naming conventions and parameter ordering/placement.</p>



<a name="212872853"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/212872853" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#212872853">(Oct 09 2020 at 20:37)</a>:</h4>
<p><span class="user-mention" data-user-id="350398">@Benjamin Fry</span> hm I'm not</p>



<a name="212872861"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/212872861" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#212872861">(Oct 09 2020 at 20:37)</a>:</h4>
<p>sure that I understand</p>



<a name="212872877"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/212872877" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#212872877">(Oct 09 2020 at 20:37)</a>:</h4>
<p>what do you mean by <code>Memory</code> as a parameter?</p>



<a name="212872963"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/212872963" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#212872963">(Oct 09 2020 at 20:38)</a>:</h4>
<p>b/c that should largely be handled during instantiation, not while you're calling functions</p>



<a name="212873016"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/212873016" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Benjamin Fry <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#212873016">(Oct 09 2020 at 20:39)</a>:</h4>
<p>yes. but the function definitions need to take offset and length right?</p>



<a name="212873044"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/212873044" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#212873044">(Oct 09 2020 at 20:39)</a>:</h4>
<p>they</p>



<a name="212873045"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/212873045" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Benjamin Fry <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#212873045">(Oct 09 2020 at 20:39)</a>:</h4>
<p>and they might be mixed with other parameters?</p>



<a name="212873068"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/212873068" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#212873068">(Oct 09 2020 at 20:39)</a>:</h4>
<p>true, yeah, but there's no real convention about that since it's more</p>



<a name="212873135"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/212873135" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#212873135">(Oct 09 2020 at 20:40)</a>:</h4>
<p>of an ABI thing with the wasm blob</p>



<a name="212873177"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/212873177" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#212873177">(Oct 09 2020 at 20:40)</a>:</h4>
<p>any ordering of arguments is basically as easy as all the others, so I think s-to answer your question there's no real conventions or anything like that</p>



<a name="212873347"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/212873347" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Benjamin Fry <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#212873347">(Oct 09 2020 at 20:42)</a>:</h4>
<p>I see. Do you forsee wasm-bindgen as ever being used for non-js areas?</p>



<a name="212873412"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/212873412" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Benjamin Fry <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#212873412">(Oct 09 2020 at 20:43)</a>:</h4>
<p>because I would expect it expects the orders and naming of the memory to be done in some consistent way?</p>



<a name="212873655"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/212873655" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#212873655">(Oct 09 2020 at 20:45)</a>:</h4>
<p>wasm-bindgen literally as is probably not, but spiritually yes (that's interface types effectively)</p>



<a name="212873693"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/212873693" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#212873693">(Oct 09 2020 at 20:45)</a>:</h4>
<p>wasm-bindgen doesn't really deal with naming or ordering conventions, it just reflects what you wrote in the source</p>



<a name="212873776"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/212873776" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#212873776">(Oct 09 2020 at 20:46)</a>:</h4>
<p>so if the first argument is a string then the first two abi arguments are the pointer and the length, but that moves around if you move  the argument</p>



<a name="212874191"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/212874191" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Benjamin Fry <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#212874191">(Oct 09 2020 at 20:50)</a>:</h4>
<p>That's exactly what i was looking for... {pointer, length} in that order, based on where the String/byte array appear as arguments in the original language.</p>



<a name="212874294"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/212874294" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Benjamin Fry <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#212874294">(Oct 09 2020 at 20:52)</a>:</h4>
<p>Thank you!</p>



<a name="212874347"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/212874347" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#212874347">(Oct 09 2020 at 20:52)</a>:</h4>
<p>oh</p>



<a name="212874363"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/212874363" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#212874363">(Oct 09 2020 at 20:52)</a>:</h4>
<p>oh lol sorry if that was a roundabout way to answer your question</p>



<a name="212874402"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/212874402" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Benjamin Fry <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#212874402">(Oct 09 2020 at 20:53)</a>:</h4>
<p>I'm sure mostly from my lack of familiarity with this space.</p>



<a name="212874440"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/212874440" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Benjamin Fry <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#212874440">(Oct 09 2020 at 20:53)</a>:</h4>
<p>Thanks for helping me grok it.</p>



<a name="213207288"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/213207288" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Benjamin Fry <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#213207288">(Oct 13 2020 at 19:42)</a>:</h4>
<p><span class="user-mention" data-user-id="253994">@Alex Crichton</span> I think, unless I'm doing something wrong, I need to have access to a dynamic version of Func::wrap, that would allow for a list of WasmTy parameters. Is there a reason that implementation doesn't exist? I think I need it to be able to build more complex types for passing via memory regions with Caller, but the compile time bindings of the existing Func::wrap impl is very restrictive.</p>



<a name="213207370"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/213207370" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#213207370">(Oct 13 2020 at 19:43)</a>:</h4>
<p><span class="user-mention" data-user-id="350398">@Benjamin Fry</span> I think that's <code>Func::new</code>?</p>



<a name="213207560"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/213207560" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Benjamin Fry <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#213207560">(Oct 13 2020 at 19:44)</a>:</h4>
<p>I'm using that now, but it feels like I don't have access to some of the dynamic type conversion options that we get with the WasmTy implementations (I want a custom version of that for Slices, like what wasm-bindgen has).</p>



<a name="213207691"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/213207691" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Benjamin Fry <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#213207691">(Oct 13 2020 at 19:46)</a>:</h4>
<p>Maybe I'm over-thinking this.</p>



<a name="213208593"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/213208593" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#213208593">(Oct 13 2020 at 19:53)</a>:</h4>
<p>hm that's true</p>



<a name="213208606"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/213208606" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#213208606">(Oct 13 2020 at 19:53)</a>:</h4>
<p>although the conversions are in theory relatively trivial</p>



<a name="213208617"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/213208617" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#213208617">(Oct 13 2020 at 19:54)</a>:</h4>
<p>we may need to implement a few more things though</p>



<a name="213209129"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/213209129" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Benjamin Fry <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#213209129">(Oct 13 2020 at 19:58)</a>:</h4>
<p>So I'm hoping to use wasm_bindgen for the wasm bindings. It appears that wasm_bindgen only produces 32bit arguments (which makes sense for wasm32 target), but wasmtime appears to directly support 64bit values? This implies that I have to detect if the module is wasm_bindgen generated and then only use 32bit arguments? Am I misunderstanding the lay of the land?</p>



<a name="213209712"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/213209712" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Benjamin Fry <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#213209712">(Oct 13 2020 at 20:02)</a>:</h4>
<p>I'll share what I have when I get it working, then if you have time maybe you could review what I've done?</p>



<a name="213210847"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/213210847" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#213210847">(Oct 13 2020 at 20:12)</a>:</h4>
<p>yeah</p>



<a name="213210866"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/213210866" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#213210866">(Oct 13 2020 at 20:13)</a>:</h4>
<p>yeah this is where wasm-bindgen is very web focused</p>



<a name="213210889"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/213210889" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#213210889">(Oct 13 2020 at 20:13)</a>:</h4>
<p>which only some browsers implementin the 64 bit integers in js for now</p>



<a name="213210899"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/213210899" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#213210899">(Oct 13 2020 at 20:13)</a>:</h4>
<p>but yeah can help with review!</p>



<a name="213211022"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/213211022" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Benjamin Fry <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#213211022">(Oct 13 2020 at 20:14)</a>:</h4>
<p>Ok, do you think it's worth "detecting" if the module is wasm_bindgen, and if so, only drop to 32bit impls in that case? or is there another more general purpose way to detect that?</p>



<a name="213211433"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/213211433" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#213211433">(Oct 13 2020 at 20:19)</a>:</h4>
<p>hm maybe? tbh fusing wasm-bindgen and wasmtime is gonna be painful no matter what you do</p>



<a name="213211450"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/213211450" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#213211450">(Oct 13 2020 at 20:19)</a>:</h4>
<p>it's just not really built for it</p>



<a name="213211498"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/213211498" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Benjamin Fry <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#213211498">(Oct 13 2020 at 20:19)</a>:</h4>
<p>Yeah, I'm starting to get that... ok</p>



<a name="213211565"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/213211565" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Benjamin Fry <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#213211565">(Oct 13 2020 at 20:20)</a>:</h4>
<p>different question then, is there a different macro tool like wasm-bindgen that is better to use in this case?</p>



<a name="213211817"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/213211817" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#213211817">(Oct 13 2020 at 20:22)</a>:</h4>
<p>unfortunately not currently, no</p>



<a name="213211824"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/213211824" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#213211824">(Oct 13 2020 at 20:23)</a>:</h4>
<p>or not that I know of</p>



<a name="213211892"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/213211892" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Benjamin Fry <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#213211892">(Oct 13 2020 at 20:23)</a>:</h4>
<p>got it. I did notice some discussion on the wasm-bindgen repo in this area, so i can follow that.</p>



<a name="213367152"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/213367152" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Benjamin Fry <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#213367152">(Oct 15 2020 at 00:26)</a>:</h4>
<p>Ugh, I'm so close on this, at least of passing Strings from WASM-&gt;Rust-&gt;Java, but I have an exception, so need to take a detour to unwrap the chain of exceptions.</p>



<a name="213449031"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/213449031" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Benjamin Fry <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#213449031">(Oct 15 2020 at 16:08)</a>:</h4>
<p>Now I have full Java exception stack traces being reported back from the WASM calls to Java Funcs. That's really helpful.</p>



<a name="213449523"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/213449523" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Benjamin Fry <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#213449523">(Oct 15 2020 at 16:12)</a>:</h4>
<p><span class="user-mention" data-user-id="253994">@Alex Crichton</span> Hopefully this is my last pestering question. I have byte array's being passed from WASM to Java now. I'm going to work on the inverse next. I'm curious about something related to Memory usage. Is the general best practice to export allocation methods in the WASM module, and get pointers back from those functions? Or is there another best practice for finding an offset into Memory for that call? I've been reading a lot of the documentation and looking at implementations, and I'm quite confused.</p>



<a name="213453970"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/213453970" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> fitzgen (he/him) <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#213453970">(Oct 15 2020 at 16:47)</a>:</h4>
<p>for now, exposing allocation functions is probably best.</p>
<p>eventually interface types will handle all of this for you</p>



<a name="213455706"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/213455706" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Benjamin Fry <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#213455706">(Oct 15 2020 at 16:59)</a>:</h4>
<p>Thanks, <span class="user-mention" data-user-id="253990">@fitzgen (he/him)</span>, that confirms what I was thinking would be needed.</p>



<a name="213583930"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/213583930" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Till Schneidereit <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#213583930">(Oct 16 2020 at 16:37)</a>:</h4>
<p><span class="user-mention" data-user-id="350398">@Benjamin Fry</span> the witx tooling might work for your use case, depending on the details. See <a href="https://radu-matei.com/blog/wasm-api-witx/">this excellent blog post</a> by <span class="user-mention" data-user-id="269505">@Radu M</span> for an overview</p>
<div class="message_embed"><a class="message_embed_image" href="https://radu-matei.com/blog/wasm-api-witx/" style="background-image: url(https://www.gravatar.com/avatar/031fa2ff2832edcb6b30c8ffb61da4d4?s=256)"></a><div class="data-container"><div class="message_embed_title"><a href="https://radu-matei.com/blog/wasm-api-witx/" title="Writing a simple WASM API layer using interface types and Wasmtime - radu's blog">Writing a simple WASM API layer using interface types and Wasmtime - radu's blog</a></div><div class="message_embed_description">In this short article we explore how to get started with WebAssembly interface types by defining a simple API layer, then implementing that using Wiggle and Wasmtime</div></div></div>



<a name="213584212"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/213584212" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Benjamin Fry <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#213584212">(Oct 16 2020 at 16:40)</a>:</h4>
<p>Yeah, I'm considering that for generating bindings and having a common API that's defined... right now I'm just trying to support Rust in WASM, but the witx stuff looks really useful for when we expand to other languages...</p>



<a name="213584329"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/213584329" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Till Schneidereit <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#213584329">(Oct 16 2020 at 16:41)</a>:</h4>
<p>Even for just Rust it might be a good approach, because it's intended to approximate Interface Types, and will evolve in that direction more and more</p>



<a name="213585372"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/213585372" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Benjamin Fry <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#213585372">(Oct 16 2020 at 16:51)</a>:</h4>
<p>True... I haven't looked at using it yet. Do you have an opinion on the ease of adoption and usage of witx?</p>



<a name="213585472"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/213585472" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Benjamin Fry <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#213585472">(Oct 16 2020 at 16:52)</a>:</h4>
<p>I'm guessing that differs across different languages and their support for witx</p>



<a name="213587733"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/213587733" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Till Schneidereit <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#213587733">(Oct 16 2020 at 17:10)</a>:</h4>
<p>yeah, I doubt there's a general answer to be had here — though I'd like to have one, too! <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="213885279"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/213885279" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Benjamin Fry <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#213885279">(Oct 20 2020 at 07:56)</a>:</h4>
<p>Thanks for all your help <span class="user-mention" data-user-id="253990">@fitzgen (he/him)</span> and <span class="user-mention" data-user-id="253994">@Alex Crichton</span>. I just got byte arrays as both parameters into WASM and returns working all the way back to Java (using ByteBuffer for the Java type). There's some deallocations that I need to insert as everything is just allocating right now, but it's all working. Now just need to do some cleanup.</p>



<a name="214903134"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/214903134" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Benjamin Fry <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#214903134">(Oct 28 2020 at 22:01)</a>:</h4>
<p>FYI, I have this in fairly decent shape at least for POC work. Not sure what the rest of the group thinks about where it lives. I have test automation in place for Linux and macOS, but Windows not yet due to a lack of desire on my part at the moment. In terms of work left, I have something in place at least for guaranteeing that Store's aren't shared across threads on the Java side, but it might need to be better for some of the other types. In terms of GC, all the Java types are auto-closeable, and memory is freed in the close of the Java object, so this should help ensure that all cleanup in the Rust impls happens on the same thread, but since I haven't used this in anger yet, I'm sure there are issues with that model.</p>



<a name="299865900"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Java%20JNI%20bindings%20to%20Wasmtime/near/299865900" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrés Margalef <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Java.20JNI.20bindings.20to.20Wasmtime.html#299865900">(Sep 21 2022 at 00:08)</a>:</h4>
<p>Is there any mature binding in Java for wasmtime? I'm trying to build some proof of concept to replace statics sdks with something more dynamic using webassembly from Java, python, go, node and rust</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>