<html>
<head><meta charset="utf-8"><title>composing components · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/index.html">general</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/composing.20components.html">composing components</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="310525429"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/composing%20components/near/310525429" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Huene <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/composing.20components.html#310525429">(Nov 17 2022 at 00:16)</a>:</h4>
<p>For those of you that are experimenting with building  wasm components, there's the <code>wasm-tools compose</code> command for stitching components together into a new component based off what's on your local file system. I've also put up <a href="https://wasmbuilder.app">https://wasmbuilder.app</a> as a simple GUI for wiring up component instances explicitly using a graph representation (see the linked repo for instructions) . Hopefully they'll prove useful for someone</p>



<a name="310525758"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/composing%20components/near/310525758" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Huene <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/composing.20components.html#310525758">(Nov 17 2022 at 00:20)</a>:</h4>
<p>The cool thing about the GUI is that itself is implemented using a wasm component (via wit-bindgen's js host bindings); <span aria-label="turtle" class="emoji emoji-1f422" role="img" title="turtle">:turtle:</span> s all the way down</p>



<a name="347508321"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/composing%20components/near/347508321" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christoph Brewing <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/composing.20components.html#347508321">(Apr 06 2023 at 20:05)</a>:</h4>
<p><span class="user-mention" data-user-id="253989">@Peter Huene</span>  Do you expect any difficulties when generating Python bindings of a composed component?<br>
I ask because when creating Python bindings for a simple (not composed) component, I do not face any problems. When I compose two components to one and do</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>python<span class="w"> </span>-m<span class="w"> </span>wasmtime.bindgen<span class="w"> </span>composed.wasm<span class="w"> </span>--out-dir<span class="w"> </span>python
</code></pre></div>
<p>I get an </p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code><span class="o">[</span>..<span class="o">]</span>
<span class="w"> </span>wasm<span class="w"> </span>trap:<span class="w"> </span>wasm<span class="w"> </span><span class="sb">`</span>unreachable<span class="sb">`</span><span class="w"> </span>instruction<span class="w"> </span>executed
<span class="o">[</span>..<span class="o">]</span>
</code></pre></div>
<p>I tried to break it down to a minimal example but still I am not completely sure if I have a mistake in the way I use <code>wasm-tools compose</code> (or sth. else)</p>



<a name="347512152"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/composing%20components/near/347512152" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Huene <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/composing.20components.html#347512152">(Apr 06 2023 at 20:29)</a>:</h4>
<p>i'm not familiar with the wasmtime python host bindings, so i  can't say where the problem might lie from just this information</p>



<a name="347512620"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/composing%20components/near/347512620" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Huene <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/composing.20components.html#347512620">(Apr 06 2023 at 20:32)</a>:</h4>
<p>i'd test first on a single component that exports a single simple function, maybe returning an easily verifiable string value; then I would compose that component (as the import) with a component that imports an interface with the same simple function and exports the same function, implementing the export in terms of calling the import; to the host, it should return the same expected value</p>



<a name="347512749"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/composing%20components/near/347512749" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Huene <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/composing.20components.html#347512749">(Apr 06 2023 at 20:33)</a>:</h4>
<p>the bindings should actually be the same in both cases since the world would just contain the same exported function and no imports</p>



<a name="347512785"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/composing%20components/near/347512785" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Huene <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/composing.20components.html#347512785">(Apr 06 2023 at 20:33)</a>:</h4>
<p>so if it doesn't work, i'd expect a bug in wasmtime</p>



<a name="347513134"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/composing%20components/near/347513134" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Huene <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/composing.20components.html#347513134">(Apr 06 2023 at 20:35)</a>:</h4>
<p>if that simple case doesn't reproduce, then it's something specific to your component and we'd need to figure out what that trap represents</p>



<a name="347513305"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/composing%20components/near/347513305" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christoph Brewing <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/composing.20components.html#347513305">(Apr 06 2023 at 20:36)</a>:</h4>
<p>Agreed, I will do so.</p>



<a name="347751365"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/composing%20components/near/347751365" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christoph Brewing <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/composing.20components.html#347751365">(Apr 07 2023 at 21:56)</a>:</h4>
<p>I tried to follow your description. The result I get is the same as in my 'real world' project. I assembled this minimal example in <a href="https://github.com/Finfalter/wasm-compositions">this respository</a>. Can you recommend any next steps? Should I open an issue at wasmtime?<br>
Before I do so: in case you or anyone recognizes any mistakes in the example, please do not hesitate to leave me a note.</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/Finfalter/wasm-compositions" style="background-image: url(https\:\/\/uploads\.zulipusercontent\.net\/e05e568a74c347e5034d5573c168ae9d4a6a60ca\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f336637636139353535336539303831373637356634363764613236616465373035363466633836336437353038356262623365383234333331316335663333322f46696e66616c7465722f7761736d2d636f6d706f736974696f6e73)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/Finfalter/wasm-compositions" title="GitHub - Finfalter/wasm-compositions">GitHub - Finfalter/wasm-compositions</a></div><div class="message_embed_description">Contribute to Finfalter/wasm-compositions development by creating an account on GitHub.</div></div></div>



<a name="347757394"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/composing%20components/near/347757394" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Huene <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/composing.20components.html#347757394">(Apr 07 2023 at 22:50)</a>:</h4>
<p>The issue probably belongs on the wasmtime-py repo; I can take a look on Monday to see what's going on</p>



<a name="348281319"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/composing%20components/near/348281319" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Huene <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/composing.20components.html#348281319">(Apr 10 2023 at 18:39)</a>:</h4>
<p><span class="user-mention" data-user-id="595146">@Christoph Brewing</span>  so the trap is coming from <a href="https://github.com/bytecodealliance/wasmtime-py/blob/main/rust/bindgen/src/bindgen.rs#L452">this line</a>, which indicates that wasmtime-py doesn't yet support handing a composed component that exchanges strings. <span class="user-mention" data-user-id="253994">@Alex Crichton</span> will likely have more context than I regarding implementation status of wasmtime-py</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wasmtime-py/blob/main/rust/bindgen/src/bindgen.rs#L452" style="background-image: url(https\:\/\/uploads\.zulipusercontent\.net\/f62b581fd5ef2b2aa75cdef3b5cfc239bed0647b\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f633162376435666637363833373137383736643235613662383262353934376333646433393666616666383730663736653439666133366637663861356331392f62797465636f6465616c6c69616e63652f7761736d74696d652d7079)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wasmtime-py/blob/main/rust/bindgen/src/bindgen.rs#L452" title="wasmtime-py/bindgen.rs at main · bytecodealliance/wasmtime-py">wasmtime-py/bindgen.rs at main · bytecodealliance/wasmtime-py</a></div><div class="message_embed_description">Python WebAssembly runtime powered by Wasmtime. Contribute to bytecodealliance/wasmtime-py development by creating an account on GitHub.</div></div></div>



<a name="348281492"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/composing%20components/near/348281492" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Huene <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/composing.20components.html#348281492">(Apr 10 2023 at 18:40)</a>:</h4>
<p>Probably the best bet is to file an issue on the wasmtime-py repo linking to your repro repo</p>



<a name="348281649"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/composing%20components/near/348281649" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/composing.20components.html#348281649">(Apr 10 2023 at 18:40)</a>:</h4>
<p>oh wow I didn't expect that <code>unimplemented!</code> to get hit for a much longer time!</p>
<p>That shouldn't be the hardest thing in the world to implement but also not trivial. An issue would be much appreciated!</p>



<a name="348281795"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/composing%20components/near/348281795" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/composing.20components.html#348281795">(Apr 10 2023 at 18:41)</a>:</h4>
<p>also if you're only getting <code>unreachable</code> and no actual error message printed out then that's also a bug I need to fix</p>



<a name="348281867"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/composing%20components/near/348281867" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Huene <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/composing.20components.html#348281867">(Apr 10 2023 at 18:42)</a>:</h4>
<p>debug backtrace: </p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">wasmtime</span><span class="p">.</span><span class="n">_trap</span><span class="p">.</span><span class="n">Trap</span>: <span class="nc">error</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="n">executing</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">wasm</span><span class="w"> </span><span class="n">backtrace</span>:
    <span class="mi">0</span>: <span class="mh">0x713c7d</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">panic_abort</span>::<span class="n">__rust_start_panic</span>::<span class="n">abort</span>::<span class="n">hce48e00841fe5fb9</span>
<span class="w">                    </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">8460</span><span class="n">ca823e8367a30dda430efda790588b8c84d3</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">panic_abort</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">lib</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">83</span>:<span class="mi">17</span><span class="w">              </span><span class="o">-</span><span class="w"> </span><span class="n">__rust_start_panic</span>
<span class="w">                    </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">8460</span><span class="n">ca823e8367a30dda430efda790588b8c84d3</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">panic_abort</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">lib</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">37</span>:<span class="mi">5</span>
<span class="w">    </span><span class="mi">1</span>: <span class="mh">0x7139bb</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">rust_panic</span>
<span class="w">                    </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">8460</span><span class="n">ca823e8367a30dda430efda790588b8c84d3</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">740</span>:<span class="mi">9</span>
<span class="w">    </span><span class="mi">2</span>: <span class="mh">0x713982</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">panicking</span>::<span class="n">rust_panic_with_hook</span>::<span class="n">h582baf536187e93d</span>
<span class="w">                    </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">8460</span><span class="n">ca823e8367a30dda430efda790588b8c84d3</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">710</span>:<span class="mi">5</span>
<span class="w">    </span><span class="mi">3</span>: <span class="mh">0x7129fa</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">panicking</span>::<span class="n">begin_panic_handler</span>::<span class="p">{{</span><span class="n">closure</span><span class="p">}}</span>::<span class="n">h10886906d9416d04</span>
<span class="w">                    </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">8460</span><span class="n">ca823e8367a30dda430efda790588b8c84d3</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">577</span>:<span class="mi">13</span>
<span class="w">    </span><span class="mi">4</span>: <span class="mh">0x71295c</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">sys_common</span>::<span class="n">backtrace</span>::<span class="n">__rust_end_short_backtrace</span>::<span class="n">hd12587e8e9c19331</span>
<span class="w">                    </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">8460</span><span class="n">ca823e8367a30dda430efda790588b8c84d3</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">sys_common</span><span class="o">/</span><span class="n">backtrace</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">137</span>:<span class="mi">18</span>
<span class="w">    </span><span class="mi">5</span>: <span class="mh">0x712ff0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">rust_begin_unwind</span>
<span class="w">                    </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">8460</span><span class="n">ca823e8367a30dda430efda790588b8c84d3</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">575</span>:<span class="mi">5</span>
<span class="w">    </span><span class="mi">6</span>: <span class="mh">0x71939c</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">core</span>::<span class="n">panicking</span>::<span class="n">panic_fmt</span>::<span class="n">hb0157e5eb5d13797</span>
<span class="w">                    </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">8460</span><span class="n">ca823e8367a30dda430efda790588b8c84d3</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">64</span>:<span class="mi">14</span>
<span class="w">    </span><span class="mi">7</span>: <span class="mh">0x719905</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">core</span>::<span class="n">panicking</span>::<span class="n">panic</span>::<span class="n">hd3974465c50a40c4</span>
<span class="w">                    </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">8460</span><span class="n">ca823e8367a30dda430efda790588b8c84d3</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">114</span>:<span class="mi">5</span>
<span class="w">    </span><span class="mi">8</span>: <span class="mh">0xbfa99</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">bindgen</span>::<span class="n">bindgen</span>::<span class="n">Instantiator</span>::<span class="n">global_initializer</span>::<span class="n">ha042365cb24e1e89</span>
<span class="w">                    </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">peterhuene</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">bytecodealliance</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">py</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">bindgen</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">bindgen</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">452</span>:<span class="mi">49</span>
<span class="w">    </span><span class="mi">9</span>: <span class="mh">0xbd94d</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">bindgen</span>::<span class="n">bindgen</span>::<span class="n">WasmtimePy</span>::<span class="n">instantiate</span>::<span class="n">h9843581d0d938b8c</span>
<span class="w">                    </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">peterhuene</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">bytecodealliance</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">py</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">bindgen</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">bindgen</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">232</span>:<span class="mi">13</span>
<span class="w">   </span><span class="mi">10</span>: <span class="mh">0xbbdc2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">bindgen</span>::<span class="n">bindgen</span>::<span class="n">WasmtimePy</span>::<span class="n">generate</span>::<span class="n">h18c37b18ad175b4f</span>
<span class="w">                    </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">peterhuene</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">bytecodealliance</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">py</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">bindgen</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">bindgen</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">150</span>:<span class="mi">9</span>
<span class="w">   </span><span class="mi">11</span>: <span class="mh">0x5bcc5</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">bindgen</span>::<span class="n">bindings</span>::<span class="n">PythonBindings</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">bindgen</span>::<span class="n">bindings</span>::<span class="n">WasmtimePy</span><span class="o">&gt;</span>::<span class="n">generate</span>::<span class="n">h741c41ef729d8851</span>
<span class="w">                    </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">peterhuene</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">bytecodealliance</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">py</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">bindgen</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">lib</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">48</span>:<span class="mi">13</span>
<span class="w">   </span><span class="mi">12</span>: <span class="mh">0x6673b</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">bindgen</span>::<span class="n">bindings</span>::<span class="n">call_generate</span>::<span class="n">h1e265052a1f06de3</span>
<span class="w">                    </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">peterhuene</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">bytecodealliance</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">py</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">bindgen</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">lib</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">38</span>:<span class="mi">5</span>
<span class="w">   </span><span class="mi">13</span>: <span class="mh">0x5bf94</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">generate</span>
<span class="w">                    </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">peterhuene</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">bytecodealliance</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">py</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">bindgen</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">lib</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">38</span>:<span class="mi">5</span>
<span class="w">   </span><span class="mi">14</span>: <span class="mh">0x7261ec</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;!</span><span class="n">generate</span><span class="p">.</span><span class="n">command_export</span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span>:
    <span class="nc">wasm</span><span class="w"> </span><span class="n">trap</span>: <span class="nc">wasm</span><span class="w"> </span><span class="err">`</span><span class="n">unreachable</span><span class="err">`</span><span class="w"> </span><span class="n">instruction</span><span class="w"> </span><span class="n">executed</span>
</code></pre></div>



<a name="348282001"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/composing%20components/near/348282001" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/composing.20components.html#348282001">(Apr 10 2023 at 18:43)</a>:</h4>
<p>in theory the standard Rust <code>unimplemented!()</code> panic message should be printed somewhere, but I may have forgotten to wire that up</p>



<a name="348282100"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/composing%20components/near/348282100" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Huene <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/composing.20components.html#348282100">(Apr 10 2023 at 18:43)</a>:</h4>
<p>it does: <code>thread '&lt;unnamed&gt;' panicked at 'not implemented', bindgen/src/bindgen.rs:452:49</code></p>



<a name="348282892"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/composing%20components/near/348282892" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/composing.20components.html#348282892">(Apr 10 2023 at 18:48)</a>:</h4>
<p>ah ok phew just making sure!</p>



<a name="348282931"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/composing%20components/near/348282931" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/composing.20components.html#348282931">(Apr 10 2023 at 18:48)</a>:</h4>
<p>not that that's an "official" error mesage of course, just wanted to make sure that was printed</p>



<a name="348459607"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/composing%20components/near/348459607" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christoph Brewing <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/composing.20components.html#348459607">(Apr 11 2023 at 13:18)</a>:</h4>
<p><span aria-label="heart" class="emoji emoji-2764" role="img" title="heart">:heart:</span> Thank you very much for your investigations! I created <a href="https://github.com/bytecodealliance/wasmtime-py/issues/143">issue no. 143</a>.</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wasmtime-py/issues/143" style="background-image: url(https\:\/\/uploads\.zulipusercontent\.net\/8b96e0196b16d3602dc2df02a818403f82bb9c62\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f303565356332636636663835326239323065663634353065316131613666646532636165366630353866653463303863616166363231393839633736353736302f62797465636f6465616c6c69616e63652f7761736d74696d652d70792f6973737565732f313433)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wasmtime-py/issues/143" title="Handling a composed component that exchanges strings · Issue #143 · bytecodealliance/wasmtime-py">Handling a composed component that exchanges strings · Issue #143 · bytecodealliance/wasmtime-py</a></div><div class="message_embed_description">As discussed in Zulip &gt; general &gt; composing components, wasmtime-py doesn't yet support handling a composed component that exchanges strings. Since I really would like to use this feature in one of...</div></div></div>



<a name="348478826"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/composing%20components/near/348478826" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/composing.20components.html#348478826">(Apr 11 2023 at 14:30)</a>:</h4>
<p>Thanks! I'll write up some more notes on the issue of what to do</p>



<a name="349334463"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/composing%20components/near/349334463" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christoph Brewing <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/composing.20components.html#349334463">(Apr 14 2023 at 10:51)</a>:</h4>
<p>I am about to compose an application comprising two components but the <strong>dependencies are not found</strong>.</p>
<p>The <em>lower layer</em>, called <strong>exporter</strong>, provides functionality in terms of <strong>multiple exported interfaces</strong>. The <em>upper layer</em>, called <strong>importer</strong>, is supposed to import lower layer's interfaces, do sth. with them and export another interface. I think of it as a facade like pattern. However, I do not arrive to compose the importer and exporter components:</p>
<p><strong>[exporter component]</strong></p>
<div class="codehilite" data-code-language="wit"><pre><span></span><code>$ wasm-tools component wit exporter_component.wasm
interface ione {
  greet: func(s: string) -&gt; string
}

interface itwo {
  greet: func(s: string) -&gt; string
}

default world exporter {
  export first: self.ione
  export second: self.itwo
}
</code></pre></div>
<p><strong>[importer component]</strong></p>
<div class="codehilite" data-code-language="wit"><pre><span></span><code>$ wasm-tools component wit importer_component.wasm
interface ione {
  greet: func(s: string) -&gt; string
}

interface itwo {
  greet: func(s: string) -&gt; string
}

default world importer {
  import first: self.ione
  import second: self.itwo
  export something_else
}
</code></pre></div>
<p>When I try to compose</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>$<span class="w"> </span>wasm-tools<span class="w"> </span>compose<span class="w"> </span>-o<span class="w"> </span>composed.wasm<span class="w"> </span>importer_component.wasm<span class="w"> </span>-p<span class="w"> </span>.
instance<span class="w"> </span><span class="sb">`</span>first<span class="sb">`</span><span class="w"> </span>will<span class="w"> </span>be<span class="w"> </span>imported<span class="w"> </span>because<span class="w"> </span>a<span class="w"> </span>dependency<span class="w"> </span>named<span class="w"> </span><span class="sb">`</span>first<span class="sb">`</span><span class="w"> </span>could<span class="w"> </span>not<span class="w"> </span>be<span class="w"> </span>found
instance<span class="w"> </span><span class="sb">`</span>second<span class="sb">`</span><span class="w"> </span>will<span class="w"> </span>be<span class="w"> </span>imported<span class="w"> </span>because<span class="w"> </span>a<span class="w"> </span>dependency<span class="w"> </span>named<span class="w"> </span><span class="sb">`</span>second<span class="sb">`</span><span class="w"> </span>could<span class="w"> </span>not<span class="w"> </span>be<span class="w"> </span>found
Error:<span class="w"> </span>no<span class="w"> </span>dependencies<span class="w"> </span>of<span class="w"> </span>component<span class="w"> </span><span class="sb">`</span>importer_component.wasm<span class="sb">`</span><span class="w"> </span>were<span class="w"> </span>found
</code></pre></div>
<p>In the past, I only had a single interface to be imported. I got around the <code>no dependencies .. where found</code> error by naming the exporter according to the exported artefact, e.g. <code>first</code>.</p>
<p>What do I have to do that the command <code>wasm-tools compose</code> recognizes <strong>multiple</strong> exports?</p>



<a name="350015835"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/composing%20components/near/350015835" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Huene <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/composing.20components.html#350015835">(Apr 14 2023 at 17:58)</a>:</h4>
<p>By default, <code>wasm-compose</code> looks for components with a filename matching the import name to satisfy an individual import; with this more complicated linking, you'll need to author a config file to feed the tool, which explicitly wires up the <code>first</code> and <code>second</code> exports from <code>exporter_component</code> to the instantiation arguments of <code>importer_component</code>. The config file syntax is documented <a href="https://github.com/bytecodealliance/wasm-tools/blob/main/crates/wasm-compose/CONFIG.md">here</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wasm-tools/blob/main/crates/wasm-compose/CONFIG.md" style="background-image: url(https\:\/\/uploads\.zulipusercontent\.net\/4ed259d3d03d6ed0f623b46485bd72dc20b610c4\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f643930353830366634326665613961663864376530373330393434663263313436356564373063393331653062316365653863323061363933643835643134352f62797465636f6465616c6c69616e63652f7761736d2d746f6f6c73)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wasm-tools/blob/main/crates/wasm-compose/CONFIG.md" title="wasm-tools/CONFIG.md at main · bytecodealliance/wasm-tools">wasm-tools/CONFIG.md at main · bytecodealliance/wasm-tools</a></div><div class="message_embed_description">Low level tooling for WebAssembly in Rust. Contribute to bytecodealliance/wasm-tools development by creating an account on GitHub.</div></div></div>



<a name="350015945"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/composing%20components/near/350015945" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Huene <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/composing.20components.html#350015945">(Apr 14 2023 at 17:59)</a>:</h4>
<p>you can also use <a href="https://wasmbuilder.app">https://wasmbuilder.app</a> to quickly wire these things up manually in a composition</p>



<a name="350036912"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/composing%20components/near/350036912" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christoph Brewing <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/composing.20components.html#350036912">(Apr 14 2023 at 20:03)</a>:</h4>
<p>Excellent, that works! The following config file seems to do the trick:</p>
<div class="codehilite" data-code-language="YAML"><pre><span></span><code><span class="nt">dependencies</span><span class="p">:</span>
<span class="w">  </span><span class="nt">a</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">importer_component.wasm</span>
<span class="w">  </span><span class="nt">first</span><span class="p">:</span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">exporter_component.wasm</span>
<span class="w">  </span><span class="nt">second</span><span class="p">:</span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">exporter_component.wasm</span>
</code></pre></div>
<p>Right, I have tried your super convenient service .. was just thinking about an integration pipeline and so I am pretty glad to have checked this path as well.</p>



<a name="350048050"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/composing%20components/near/350048050" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Huene <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/composing.20components.html#350048050">(Apr 14 2023 at 21:16)</a>:</h4>
<p>I believe that config will create two different instances of the exporter component, though. there's a way to create a single instance of it and explicitly tell the composer to use an export from that instance as an instantiation argument for the root instance</p>



<a name="350048321"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/composing%20components/near/350048321" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Huene <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/composing.20components.html#350048321">(Apr 14 2023 at 21:18)</a>:</h4>
<p>Something  like:</p>
<div class="codehilite" data-code-language="YAML"><pre><span></span><code><span class="nt">dependencies</span><span class="p">:</span>
<span class="w">  </span><span class="nt">exporter</span><span class="p">:</span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">exporter_component.wasm</span>

<span class="nt">instantiations</span><span class="p">:</span>
<span class="w">  </span><span class="nt">$input</span><span class="p">:</span>
<span class="w">    </span><span class="nt">arguments</span><span class="p">:</span>
<span class="w">      </span><span class="nt">first</span><span class="p">:</span>
<span class="w">        </span><span class="nt">instance</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">exporter</span>
<span class="w">        </span><span class="nt">export</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">first</span>
<span class="w">      </span><span class="nt">second</span><span class="p">:</span>
<span class="w">        </span><span class="nt">instance</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">exporter</span>
<span class="w">        </span><span class="nt">export</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">second</span>
</code></pre></div>



<a name="350048389"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/composing%20components/near/350048389" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Huene <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/composing.20components.html#350048389">(Apr 14 2023 at 21:19)</a>:</h4>
<p>i believe that will create a single instance of the exporter component, if that's desired</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>