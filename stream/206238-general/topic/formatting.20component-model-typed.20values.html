<html>
<head><meta charset="utf-8"><title>formatting component-model-typed values · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/index.html">general</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/formatting.20component-model-typed.20values.html">formatting component-model-typed values</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="385737284"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/formatting%20component-model-typed%20values/near/385737284" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/formatting.20component-model-typed.20values.html#385737284">(Aug 17 2023 at 19:22)</a>:</h4>
<p>Are there any conventions yet for formatting component-model-typed values to text? Like, a common way of rendering variant/result/flags/etc. to JSON, or some other format?</p>



<a name="385745044"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/formatting%20component-model-typed%20values/near/385745044" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/formatting.20component-model-typed.20values.html#385745044">(Aug 17 2023 at 20:20)</a>:</h4>
<p>I've been working on this JSON repr: <a href="https://hackmd.io/@lann/rJFNJ2Mhn">https://hackmd.io/@lann/rJFNJ2Mhn</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://hackmd.io/@lann/rJFNJ2Mhn" style="background-image: url(https\:\/\/uploads\.zulipusercontent\.net\/be5883ebc78216e6d97b1f14ef5fbbb5049814a8\/68747470733a2f2f7777772e67726176617461722e636f6d2f6176617461722f35386537303761353133356136613738313666373336386266643564396134663f733d343030)"></a><div class="data-container"><div class="message_embed_title"><a href="https://hackmd.io/@lann/rJFNJ2Mhn" title="Component JSON - HackMD">Component JSON - HackMD</a></div><div class="message_embed_description">For the best language interoperability, numbers &gt; (2^53 – 1) or &lt; -(2^53 - 1) should be serialized as base-10 strings.</div></div></div>



<a name="385745178"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/formatting%20component-model-typed%20values/near/385745178" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/formatting.20component-model-typed.20values.html#385745178">(Aug 17 2023 at 20:21)</a>:</h4>
<p>I tried to follow web api conventions wrt e.g. <code>result</code>s, which may make it a little odd-looking to some</p>



<a name="386391608"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/formatting%20component-model-typed%20values/near/386391608" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Robin Brown <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/formatting.20component-model-typed.20values.html#386391608">(Aug 21 2023 at 13:31)</a>:</h4>
<p>How well do the representation of specialized types map to their despecialized equivalents as defined in e.g. the Canonical ABI doc?</p>



<a name="386395221"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/formatting%20component-model-typed%20values/near/386395221" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/formatting.20component-model-typed.20values.html#386395221">(Aug 21 2023 at 13:47)</a>:</h4>
<p>Not well; I prioritized concision and some broad "JSON conventionality"</p>



<a name="386395538"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/formatting%20component-model-typed%20values/near/386395538" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/formatting.20component-model-typed.20values.html#386395538">(Aug 21 2023 at 13:49)</a>:</h4>
<p>Note though that WIT itself can't represent all of the despecialized equivalents since several of them use numeric field/variant labels.</p>



<a name="390589852"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/formatting%20component-model-typed%20values/near/390589852" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/formatting.20component-model-typed.20values.html#390589852">(Sep 12 2023 at 20:17)</a>:</h4>
<p>I have an initial implementation of the above serialization format: <a href="https://github.com/lann/wasmtime-component-serde">https://github.com/lann/wasmtime-component-serde</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/lann/wasmtime-component-serde" style="background-image: url(https\:\/\/uploads\.zulipusercontent\.net\/9d831747726854ea024be63179f5576497fb053f\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f363231356233633230373163633730626362303439393564616332373966363765323830373238336631363439343834393263613138366164306363393538362f6c616e6e2f7761736d74696d652d636f6d706f6e656e742d7365726465)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/lann/wasmtime-component-serde" title="GitHub - lann/wasmtime-component-serde">GitHub - lann/wasmtime-component-serde</a></div><div class="message_embed_description">Contribute to lann/wasmtime-component-serde development by creating an account on GitHub.</div></div></div>



<a name="390592262"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/formatting%20component-model-typed%20values/near/390592262" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/formatting.20component-model-typed.20values.html#390592262">(Sep 12 2023 at 20:34)</a>:</h4>
<p>Cool!</p>



<a name="390592342"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/formatting%20component-model-typed%20values/near/390592342" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/formatting.20component-model-typed.20values.html#390592342">(Sep 12 2023 at 20:34)</a>:</h4>
<p>Perhaps at some point we should move <code>wasmtime::component::{Type, Val}</code> out into a separate crate so that tools like this can use them without pulling in all of wasmtime</p>



<a name="390592669"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/formatting%20component-model-typed%20values/near/390592669" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/formatting.20component-model-typed.20values.html#390592669">(Sep 12 2023 at 20:37)</a>:</h4>
<p>You currently can't construct recursively-defined <code>Type</code>s without instantiating a (dummy) component either.</p>



<a name="390592726"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/formatting%20component-model-typed%20values/near/390592726" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/formatting.20component-model-typed.20values.html#390592726">(Sep 12 2023 at 20:37)</a>:</h4>
<p>At least not via publicly documented interfaces that I've seen.</p>



<a name="390592952"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/formatting%20component-model-typed%20values/near/390592952" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/formatting.20component-model-typed.20values.html#390592952">(Sep 12 2023 at 20:39)</a>:</h4>
<p>I had to resort to <a href="https://github.com/lann/wasmtime-component-serde/blob/main/tests/types.wit#L2">this</a> and <a href="https://github.com/lann/wasmtime-component-serde/blob/854fa1fafd0735cb94ee6319859f65b07ce5f56f/tests/round_trip.rs#L60-L79">this</a> to test complex types.</p>



<a name="390594312"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/formatting%20component-model-typed%20values/near/390594312" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/formatting.20component-model-typed.20values.html#390594312">(Sep 12 2023 at 20:49)</a>:</h4>
<p>I'm a little surprised serde-json doesn't handle things like serializing big numbers or Infinity into strings automatically. I think that means that the comment is right; we may eventually need different serde serializations for different backends.</p>



<a name="390598009"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/formatting%20component-model-typed%20values/near/390598009" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/formatting.20component-model-typed.20values.html#390598009">(Sep 12 2023 at 21:14)</a>:</h4>
<p>wrt moving component::{Type, Val} out to a separate crate, it would also be really cool if we could move the <code>Lift, Lower, ComponentVal</code> traits as well, so that wasmtime-wit-bindgen wouldnt actually imply a dependency on wasmtime unless the user wants it. that would let us make wasmtime-wasi work across runtimes again</p>



<a name="390598090"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/formatting%20component-model-typed%20values/near/390598090" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/formatting.20component-model-typed.20values.html#390598090">(Sep 12 2023 at 21:15)</a>:</h4>
<p>well, again as in, like wasi-common did before i got rid of lucet compatibility in wiggle.</p>



<a name="390598212"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/formatting%20component-model-typed%20values/near/390598212" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/formatting.20component-model-typed.20values.html#390598212">(Sep 12 2023 at 21:16)</a>:</h4>
<p>i believe the story was that wasm3 was using wasi-common somewhere? tbh i cant remember who reported they were sad that i broke it</p>



<a name="390598520"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/formatting%20component-model-typed%20values/near/390598520" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/formatting.20component-model-typed.20values.html#390598520">(Sep 12 2023 at 21:18)</a>:</h4>
<p>but idk, maybe the counter-argument is that ComponentVal is a huge chunk of the component runtime's complexity and it cant be extracted. i havent tried to do it.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>