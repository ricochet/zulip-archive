<html>
<head><meta charset="utf-8"><title>Big wasm files Â· general Â· Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/index.html">general</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Big.20wasm.20files.html">Big wasm files</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="190622881"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Big%20wasm%20files/near/190622881" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Akshat Agarwal <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Big.20wasm.20files.html#190622881">(Mar 15 2020 at 01:03)</a>:</h4>
<p>Why is the .wasm files generated by wasmtime for just a simple print Hello World of about 2 MB</p>



<a name="190625243"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Big%20wasm%20files/near/190625243" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Akshat Agarwal <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Big.20wasm.20files.html#190625243">(Mar 15 2020 at 02:16)</a>:</h4>
<p>I guess it's not "generated" by wasmtime (sorry about that). But even then. I am asking here because I don't know where else to ask this question.</p>



<a name="190629424"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Big%20wasm%20files/near/190629424" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Big.20wasm.20files.html#190629424">(Mar 15 2020 at 04:43)</a>:</h4>
<p>Are you looking at binaries built with Rust? I noticed this too, at first; it seems by default the .wasm files include debug info, and <code>wasm-strip</code>(part of the WABT, WebAssembly Binary Toolkit) can remove it. I see (using a hello-world built with <code>rustc --target=wasm32-wasi -O ...</code>):</p>
<div class="codehilite"><pre><span></span>$ wc -c *.wasm
1925510 helloworld-rs.wasm
  71138 helloworld-rs-stripped.wasm
</pre></div>


<p>I used Bloaty McBloatface (<a href="https://github.com/google/bloaty/" target="_blank" title="https://github.com/google/bloaty/">https://github.com/google/bloaty/</a>), which supports WebAssembly, to look at where the space is spent in the original (non-stripped) file:</p>
<div class="codehilite"><pre><span></span>$ bloaty helloworld-rs.wasm
    FILE SIZE        VM SIZE
 --------------  --------------
  32.0%   602Ki   NAN%       0    .debug_str
  25.6%   481Ki   NAN%       0    .debug_info
  15.8%   296Ki   NAN%       0    .debug_line
  10.0%   188Ki   NAN%       0    .debug_ranges
   8.0%   149Ki   NAN%       0    .debug_pubnames
   3.0%  57.1Ki   NAN%       0    Code
   2.8%  53.6Ki   NAN%       0    .debug_pubtypes
   1.0%  17.9Ki   NAN%       0    .debug_aranges
   0.8%  16.0Ki   NAN%       0    name
   0.6%  11.6Ki   NAN%       0    Data
   0.2%  4.39Ki   NAN%       0    .debug_abbrev
   0.0%     251   NAN%       0    Function
   0.0%     238   NAN%       0    Import
   0.0%     131   NAN%       0    Element
   0.0%     116   NAN%       0    producers
   0.0%     108   NAN%       0    Type
   0.0%      73   NAN%       0    Export
   0.0%      27   NAN%       0    Global
   0.0%      25   NAN%       0    .debug_macinfo
   0.0%      12   NAN%       0    [2 Others]
   0.0%       8   NAN%       0    [WASM Header]
 100.0%  1.84Mi 100.0%       0    TOTAL
</pre></div>


<p>So, as seen above, most of the data is debug info that can be removed.</p>
<p>FWIW, I also built a hello-world in C with the WASI SDK (<a href="https://github.com/WebAssembly/wasi-sdk/" target="_blank" title="https://github.com/WebAssembly/wasi-sdk/">https://github.com/WebAssembly/wasi-sdk/</a>), and the resulting file is 16306 bytes, so it does seem the bits of the Rust stdlib pulled in by <code>println!</code> are a bit larger than the libc slice for <code>printf</code>...</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/google/bloaty/" style="background-image: url(https://avatars0.githubusercontent.com/u/1342004?s=400&amp;v=4)" target="_blank"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/google/bloaty/" target="_blank" title="google/bloaty">google/bloaty</a></div><div class="message_embed_description">Bloaty McBloatface: a size profiler for binaries. Contribute to google/bloaty development by creating an account on GitHub.</div></div></div><div class="message_embed"><a class="message_embed_image" href="https://github.com/WebAssembly/wasi-sdk/" style="background-image: url(https://avatars3.githubusercontent.com/u/11578470?s=400&amp;v=4)" target="_blank"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/WebAssembly/wasi-sdk/" target="_blank" title="WebAssembly/wasi-sdk">WebAssembly/wasi-sdk</a></div><div class="message_embed_description">WASI-enabled WebAssembly C/C++ toolchain. Contribute to WebAssembly/wasi-sdk development by creating an account on GitHub.</div></div></div>



<a name="190640210"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Big%20wasm%20files/near/190640210" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Till Schneidereit <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Big.20wasm.20files.html#190640210">(Mar 15 2020 at 10:11)</a>:</h4>
<p>Yeah, it's almost certainly debug info. It'd be nice if we could move that to outside the Wasm file, but I don't think that works yet.</p>
<p>The Rust and WebAssembly book has a lot more information: <a href="https://rustwasm.github.io/docs/book/reference/code-size.html" target="_blank" title="https://rustwasm.github.io/docs/book/reference/code-size.html">https://rustwasm.github.io/docs/book/reference/code-size.html</a></p>



<a name="190653989"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Big%20wasm%20files/near/190653989" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Big.20wasm.20files.html#190653989">(Mar 15 2020 at 16:16)</a>:</h4>
<p>Two additional things I can add here: One is that we use static linking right now, so executables include the pieces of libc they need, rather than dynamic linking them.</p>



<a name="190654092"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Big%20wasm%20files/near/190654092" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Big.20wasm.20files.html#190654092">(Mar 15 2020 at 16:18)</a>:</h4>
<p>Another is that we've made some major improvements in the tools recently which aren't yet in a release. With a trunk build of wasi-sdk and friends, a C hello world <em>with debug info</em> is 29K.</p>



<a name="190654198"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Big%20wasm%20files/near/190654198" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Big.20wasm.20files.html#190654198">(Mar 15 2020 at 16:21)</a>:</h4>
<p>Ah, and one other detail: C++ hello worlds using &lt;iostream&gt; are significantly bigger than C hello worlds using printf. This is because  &lt;iostream&gt; ends up causing us to link in all kinds of locale support (that hello world itself doesn't need).</p>



<a name="190746742"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Big%20wasm%20files/near/190746742" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> fitzgen (he/him) <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Big.20wasm.20files.html#190746742">(Mar 16 2020 at 16:29)</a>:</h4>
<p>There is also <code>twiggy</code>, which I wrote to better understand why some function was called and why the linker didn't gc it from the final binary: <a href="https://github.com/rustwasm/twiggy" target="_blank" title="https://github.com/rustwasm/twiggy">https://github.com/rustwasm/twiggy</a></p>
<p>Also, not wasm specific, but probably answers a lot of these same questions: <a href="https://lifthrasiir.github.io/rustlog/why-is-a-rust-executable-large.html" target="_blank" title="https://lifthrasiir.github.io/rustlog/why-is-a-rust-executable-large.html">https://lifthrasiir.github.io/rustlog/why-is-a-rust-executable-large.html</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/rustwasm/twiggy" style="background-image: url(https://avatars3.githubusercontent.com/u/37272798?s=400&amp;v=4)" target="_blank"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/rustwasm/twiggy" target="_blank" title="rustwasm/twiggy">rustwasm/twiggy</a></div><div class="message_embed_description">TwiggyðŸŒ± is a code size profiler. Contribute to rustwasm/twiggy development by creating an account on GitHub.</div></div></div>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>