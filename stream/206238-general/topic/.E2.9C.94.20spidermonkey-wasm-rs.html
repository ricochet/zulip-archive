<html>
<head><meta charset="utf-8"><title>✔ spidermonkey-wasm-rs · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/index.html">general</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20spidermonkey-wasm-rs.html">✔ spidermonkey-wasm-rs</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="309604553"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20spidermonkey-wasm-rs/near/309604553" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jerome Gravel-Niquet <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20spidermonkey-wasm-rs.html#309604553">(Nov 14 2022 at 14:06)</a>:</h4>
<p>I'm trying to compile the <code>repl-example</code> from <a href="https://github.com/bytecodealliance/spidermonkey-wasm-rs">https://github.com/bytecodealliance/spidermonkey-wasm-rs</a> and running into a few issues. I solved a bunch of them by pinning the dependencies, but I think there have been too many changes to Rust since then and I can't seem to compile it. I'm stuck at <code>rust-lld</code> errors like:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">rust</span><span class="o">-</span><span class="n">lld</span>: <span class="nc">error</span>: <span class="nc">duplicate</span><span class="w"> </span><span class="n">symbol</span>: <span class="nc">rust_oom</span><span class="w"></span>
<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="n">defined</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">jerome</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">jeromegn</span><span class="o">/</span><span class="n">spidermonkey</span><span class="o">-</span><span class="n">wasm</span><span class="o">-</span><span class="n">rs</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">wasm32</span><span class="o">-</span><span class="n">wasi</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">deps</span><span class="o">/</span><span class="n">libspidermonkey_wasm_sys</span><span class="o">-</span><span class="mi">14</span><span class="n">bbb70c973c749d</span><span class="p">.</span><span class="n">rlib</span><span class="p">(</span><span class="n">std</span><span class="o">-</span><span class="n">b2d023322055224f</span><span class="p">.</span><span class="n">std</span><span class="p">.</span><span class="mf">79e0684</span><span class="n">a</span><span class="o">-</span><span class="n">cgu</span><span class="p">.</span><span class="mf">0.</span><span class="n">rcgu</span><span class="p">.</span><span class="n">o</span><span class="p">)</span><span class="w"></span>
<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="n">defined</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">jerome</span><span class="o">/</span><span class="p">.</span><span class="n">rustup</span><span class="o">/</span><span class="n">toolchains</span><span class="o">/</span><span class="n">stable</span><span class="o">-</span><span class="n">aarch64</span><span class="o">-</span><span class="n">apple</span><span class="o">-</span><span class="n">darwin</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">rustlib</span><span class="o">/</span><span class="n">wasm32</span><span class="o">-</span><span class="n">wasi</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">libstd</span><span class="o">-</span><span class="mi">865</span><span class="n">c3399b8bb5e0b</span><span class="p">.</span><span class="n">rlib</span><span class="p">(</span><span class="n">std</span><span class="o">-</span><span class="mi">865</span><span class="n">c3399b8bb5e0b</span><span class="p">.</span><span class="n">std</span><span class="p">.</span><span class="mi">24</span><span class="n">c1e981</span><span class="o">-</span><span class="n">cgu</span><span class="p">.</span><span class="mf">0.</span><span class="n">rcgu</span><span class="p">.</span><span class="n">o</span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/spidermonkey-wasm-rs" style="background-image: url(https\:\/\/uploads\.zulipusercontent\.net\/eb88ec5c2505d7336a62194ae985cb32d743919f\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f323831373236386335353038646439373366653036333330356636336362376631666465633562373838613638303032663137666536333737313536653164652f62797465636f6465616c6c69616e63652f7370696465726d6f6e6b65792d7761736d2d7273)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/spidermonkey-wasm-rs" title="GitHub - bytecodealliance/spidermonkey-wasm-rs">GitHub - bytecodealliance/spidermonkey-wasm-rs</a></div><div class="message_embed_description">Contribute to bytecodealliance/spidermonkey-wasm-rs development by creating an account on GitHub.</div></div></div>



<a name="309618930"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20spidermonkey-wasm-rs/near/309618930" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jerome Gravel-Niquet <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20spidermonkey-wasm-rs.html#309618930">(Nov 14 2022 at 14:44)</a>:</h4>
<p>It looks like the same symbols are defined in both spidermonkey-wasm-sys and libstd provided by rust for the wasm32-wasi target.</p>



<a name="309632279"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20spidermonkey-wasm-rs/near/309632279" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20spidermonkey-wasm-rs.html#309632279">(Nov 14 2022 at 15:47)</a>:</h4>
<p>Looks like spidermonkey now uses rust which causes it to embed a copy of the rust standard library. This copy then ends up in libspidermonkey_wasm_sys.rlib when it statically links to spidermonkey. When linking libspidermonkey_wasm_sys.rlib this then causes a conflict with the libstd.rlib of the current rust toolchain.</p>



<a name="309632992"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20spidermonkey-wasm-rs/near/309632992" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20spidermonkey-wasm-rs.html#309632992">(Nov 14 2022 at 15:51)</a>:</h4>
<p>In your specific case it also looks like both libstd are coming from different rustc versions, which is pretty much guaranteed to give issues even if you somehow were able to make the linker prefer one symbol over the other.</p>



<a name="309633703"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20spidermonkey-wasm-rs/near/309633703" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jerome Gravel-Niquet <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20spidermonkey-wasm-rs.html#309633703">(Nov 14 2022 at 15:54)</a>:</h4>
<p>Interesting! That makes sense. Would using the same Rust version help at all? I assume it would since the last commit pushed to the spidermonkey-wasm-rs repo had its build pass</p>



<a name="309633747"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20spidermonkey-wasm-rs/near/309633747" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jerome Gravel-Niquet <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20spidermonkey-wasm-rs.html#309633747">(Nov 14 2022 at 15:54)</a>:</h4>
<p>and it must've been using the same Rust version as the checked-out spidermonkey source</p>



<a name="309634288"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20spidermonkey-wasm-rs/near/309634288" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jerome Gravel-Niquet <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20spidermonkey-wasm-rs.html#309634288">(Nov 14 2022 at 15:57)</a>:</h4>
<p><a href="/user_uploads/15107/uXVD0uLonuxruT78cK9V8b3u/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/15107/uXVD0uLonuxruT78cK9V8b3u/image.png" title="image.png"><img src="/user_uploads/15107/uXVD0uLonuxruT78cK9V8b3u/image.png"></a></div>



<a name="309897807"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20spidermonkey-wasm-rs/near/309897807" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20spidermonkey-wasm-rs.html#309897807">(Nov 14 2022 at 16:21)</a>:</h4>
<p>Using the same rust version may help, but only by accident. There is no guarantee that even for the same rustc version linking a rust staticlib into a crate will work. In fact it likely won't if you use for example <code>#[global_allocator]</code>.</p>



<a name="310117724"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20spidermonkey-wasm-rs/near/310117724" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Saúl Cabrera <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20spidermonkey-wasm-rs.html#310117724">(Nov 15 2022 at 02:20)</a>:</h4>
<p>Every FireFox release supports a <a href="https://firefox-source-docs.mozilla.org/writing-rust-code/update-policy.html#schedule">specific Rust version</a> the bindings are still using SpiderMonkey v 96, so it should work if you use Rust 1.57.</p>



<a name="310197994"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20spidermonkey-wasm-rs/near/310197994" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jerome Gravel-Niquet <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20spidermonkey-wasm-rs.html#310197994">(Nov 15 2022 at 13:16)</a>:</h4>
<p><span class="user-mention silent" data-user-id="411395">Saúl Cabrera</span> <a href="#narrow/stream/206238-general/topic/spidermonkey-wasm-rs/near/310117724">said</a>:</p>
<blockquote>
<p>Every FireFox release supports a <a href="https://firefox-source-docs.mozilla.org/writing-rust-code/update-policy.html#schedule">specific Rust version</a> the bindings are still using SpiderMonkey v 96, so it should work if you use Rust 1.57.</p>
</blockquote>
<p>That's likely going to be easier than compiling spidermonkey from the latest HEAD :) I'll give that a try!</p>



<a name="310203654"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20spidermonkey-wasm-rs/near/310203654" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jerome Gravel-Niquet <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20spidermonkey-wasm-rs.html#310203654">(Nov 15 2022 at 13:44)</a>:</h4>
<p>Yes, that did it.</p>



<a name="310203681"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20spidermonkey-wasm-rs/near/310203681" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20spidermonkey-wasm-rs.html#310203681">(Nov 15 2022 at 13:44)</a>:</h4>
<p><span class="user-mention silent" data-user-id="563548">Jerome Gravel-Niquet</span> has marked this topic as resolved.</p>



<a name="310210482"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20spidermonkey-wasm-rs/near/310210482" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jerome Gravel-Niquet <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20spidermonkey-wasm-rs.html#310210482">(Nov 15 2022 at 14:17)</a>:</h4>
<p><span class="user-mention" data-user-id="411395">@Saúl Cabrera</span> any idea if compiling a more recent spidermonkey from the gecko-dev repo would still work if i used the same Rust version they used? I assume this is because the pre-built spidermonkey-wasm was built with rust 1.57. I'm slightly concerned (but not much, I'm just playing with this project at this point) by <span class="user-mention" data-user-id="264278">@bjorn3</span> 's comments regarding compiling duplicate symbols.</p>



<a name="310221654"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/%E2%9C%94%20spidermonkey-wasm-rs/near/310221654" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Saúl Cabrera <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/.E2.9C.94.20spidermonkey-wasm-rs.html#310221654">(Nov 15 2022 at 15:11)</a>:</h4>
<p>Yeah, that should work. The process of updating SpiderMonkey for the bindings entails ensuring that they are built using the supported Rust version by a given SpiderMonkey version, that's generally the best workaround I know for the duplicate symbols issue.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>