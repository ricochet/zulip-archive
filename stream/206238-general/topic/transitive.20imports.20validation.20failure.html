<html>
<head><meta charset="utf-8"><title>transitive imports validation failure · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/index.html">general</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/transitive.20imports.20validation.20failure.html">transitive imports validation failure</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="471034769"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/transitive%20imports%20validation%20failure/near/471034769" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Evan Simmons <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/transitive.20imports.20validation.20failure.html#471034769">(Sep 17 2024 at 16:37)</a>:</h4>
<p>Hi bytecode alliance,<br>
I'm having trouble composing two components where one world's interface is 'use'ing a dependent interface. The specific error is as follows. <br>
Notes</p>
<ul>
<li>I get the same error with <code>wac</code> as well.</li>
<li>wasm-tools validate succeeds for both components</li>
<li>considering the spec it seems to me like it should work: <a href="https://github.com/WebAssembly/component-model/blob/main/design/mvp/WIT.md#transitive-imports-and-worlds">https://github.com/WebAssembly/component-model/blob/main/design/mvp/WIT.md#transitive-imports-and-worlds</a></li>
</ul>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="o">&gt;</span><span class="w"> </span><span class="n">wasm</span><span class="o">-</span><span class="n">tools</span><span class="w"> </span><span class="n">compose</span><span class="w"> </span><span class="n">salutation</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">-</span><span class="n">d</span><span class="w"> </span><span class="n">types</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">-</span><span class="n">o</span><span class="w"> </span><span class="n">sal_ty</span><span class="p">.</span><span class="n">wasm</span>
<span class="n">error</span><span class="p">:</span><span class="w"> </span><span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">validate</span><span class="w"> </span><span class="n">output</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="err">`</span><span class="n">sal_ty</span><span class="p">.</span><span class="n">wasm</span><span class="err">`</span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span><span class="p">:</span>
<span class="w">    </span><span class="mi">0</span><span class="p">:</span><span class="w"> </span><span class="nc">instance</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">valid</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">export</span><span class="w"> </span><span class="p">(</span><span class="n">at</span><span class="w"> </span><span class="n">offset</span><span class="w"> </span><span class="mh">0x10a56</span><span class="p">)</span>
</code></pre></div>
<p>salutation/types.wit</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">package</span><span class="w"> </span><span class="n">hotswap</span><span class="p">:</span><span class="nc">salutation</span><span class="o">@</span><span class="mf">0.1.0</span><span class="p">;</span>

<span class="n">interface</span><span class="w"> </span><span class="n">user</span><span class="o">-</span><span class="n">interface</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">type</span><span class="w"> </span><span class="nc">tag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">u64</span><span class="p">;</span>
<span class="w">    </span><span class="k">enum</span><span class="w"> </span><span class="nc">gender</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">male</span><span class="p">,</span>
<span class="w">        </span><span class="n">female</span><span class="p">,</span>
<span class="w">        </span><span class="n">other</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">record</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="nc">string</span><span class="p">,</span>
<span class="w">        </span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="kt">u64</span><span class="p">,</span>
<span class="w">        </span><span class="n">tenant</span><span class="o">-</span><span class="n">tags</span><span class="p">:</span><span class="w"> </span><span class="nc">list</span><span class="o">&lt;</span><span class="n">tag</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">        </span><span class="n">gender</span><span class="p">:</span><span class="w"> </span><span class="nc">gender</span><span class="p">,</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">record</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">seconds</span><span class="p">:</span><span class="w"> </span><span class="kt">u64</span><span class="p">,</span>
<span class="w">        </span><span class="n">nanos</span><span class="p">:</span><span class="w"> </span><span class="kt">u64</span><span class="p">,</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">age</span><span class="o">-</span><span class="k">in</span><span class="o">-</span><span class="n">weeks</span><span class="p">:</span><span class="w"> </span><span class="nc">func</span><span class="p">(</span><span class="n">u</span><span class="p">:</span><span class="w"> </span><span class="nc">user</span><span class="p">,</span><span class="w"> </span><span class="n">now</span><span class="p">:</span><span class="w"> </span><span class="nc">time</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="kt">u32</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">world</span><span class="w"> </span><span class="n">types</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">export</span><span class="w"> </span><span class="n">user</span><span class="o">-</span><span class="n">interface</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>salutation/salutation.wit</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">package</span><span class="w"> </span><span class="n">hotswap</span><span class="p">:</span><span class="nc">salutation</span><span class="o">@</span><span class="mf">0.1.0</span><span class="p">;</span>

<span class="n">interface</span><span class="w"> </span><span class="n">salutation</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">use</span><span class="w"> </span><span class="n">user</span><span class="o">-</span><span class="n">interface</span><span class="p">.{</span><span class="n">user</span><span class="p">};</span>

<span class="w">    </span><span class="n">variant</span><span class="w"> </span><span class="n">formal</span><span class="o">-</span><span class="n">honorific</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">sir</span><span class="p">,</span>
<span class="w">        </span><span class="n">maam</span><span class="p">,</span>
<span class="w">        </span><span class="n">sir</span><span class="o">-</span><span class="n">maam</span><span class="p">,</span>
<span class="w">        </span><span class="n">custom</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">get</span><span class="o">-</span><span class="n">formal</span><span class="o">-</span><span class="n">honorific</span><span class="p">:</span><span class="w"> </span><span class="nc">func</span><span class="p">(</span><span class="n">u</span><span class="p">:</span><span class="w"> </span><span class="nc">user</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">formal</span><span class="o">-</span><span class="n">honorific</span><span class="p">;</span>
<span class="w">    </span><span class="n">greet</span><span class="p">:</span><span class="w"> </span><span class="nc">func</span><span class="p">(</span><span class="n">u</span><span class="p">:</span><span class="w"> </span><span class="nc">user</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">string</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">world</span><span class="w"> </span><span class="n">app</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">export</span><span class="w"> </span><span class="n">salutation</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>Thanks for your help!</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/WebAssembly/component-model/blob/main/design/mvp/WIT.md#transitive-imports-and-worlds" style="background-image: url(&quot;https://uploads.zulipusercontent.net/badd4c7e4a0400095e260ef4f122f65d61583a99/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f383832333534316666626631616566643163313066363730616630373636643332663166323831393163303533366639323165333130386230626338373836342f576562417373656d626c792f636f6d706f6e656e742d6d6f64656c&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/WebAssembly/component-model/blob/main/design/mvp/WIT.md#transitive-imports-and-worlds" title="component-model/design/mvp/WIT.md at main · WebAssembly/component-model">component-model/design/mvp/WIT.md at main · WebAssembly/component-model</a></div><div class="message_embed_description">Repository for design and specification of the Component Model - WebAssembly/component-model</div></div></div>



<a name="471049967"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/transitive%20imports%20validation%20failure/near/471049967" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/transitive.20imports.20validation.20failure.html#471049967">(Sep 17 2024 at 17:50)</a>:</h4>
<p>Can you provide more steps of how to reproduce? As-is I'm not sure what the various components in play are here. It's also worth mentioning that <code>wac</code> should generally be used instead of <code>wasm-tools compose</code> nowadays. I know you say it's the same error message, but figured I'd reiterate anyway</p>



<a name="471111570"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/transitive%20imports%20validation%20failure/near/471111570" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Evan Simmons <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/transitive.20imports.20validation.20failure.html#471111570">(Sep 17 2024 at 22:38)</a>:</h4>
<p>Hi Alex, thanks so much for your suggestion. I've created a repo for repro (lol) here: <a href="https://github.com/estk/hotswap-example">https://github.com/estk/hotswap-example</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/estk/hotswap-example" style="background-image: url(&quot;https://uploads.zulipusercontent.net/bc9ff87c96006ddc1ce81a9e0b530e3b7f6f0984/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f306664373836616438316232303632653162616339376663376161393564363533376437383035623762313961316565653233613039373639646532336263382f6573746b2f686f74737761702d6578616d706c65&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/estk/hotswap-example" title="GitHub - estk/hotswap-example">GitHub - estk/hotswap-example</a></div><div class="message_embed_description">Contribute to estk/hotswap-example development by creating an account on GitHub.</div></div></div>



<a name="471112049"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/transitive%20imports%20validation%20failure/near/471112049" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Evan Simmons <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/transitive.20imports.20validation.20failure.html#471112049">(Sep 17 2024 at 22:42)</a>:</h4>
<p>After having the same issue with wac, i enabled logging and backtracing:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="o">..</span><span class="p">.</span>
<span class="w"> </span><span class="n">DEBUG</span><span class="w"> </span><span class="n">wac_graph</span><span class="p">::</span><span class="n">encoding</span><span class="w">     </span><span class="o">&gt;</span><span class="w"> </span><span class="n">popping</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="nc">scope</span>
<span class="w"> </span><span class="n">DEBUG</span><span class="w"> </span><span class="n">wac_graph</span><span class="p">::</span><span class="n">encoding</span><span class="w">     </span><span class="o">&gt;</span><span class="w"> </span><span class="n">instance</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="nc">encoded</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="nc">index</span><span class="w"> </span><span class="mi">17</span>
<span class="w"> </span><span class="n">DEBUG</span><span class="w"> </span><span class="n">wac_graph</span><span class="p">::</span><span class="n">graph</span><span class="w">        </span><span class="o">&gt;</span><span class="w"> </span><span class="n">import</span><span class="w"> </span><span class="err">`</span><span class="n">wasi</span><span class="p">:</span><span class="nc">filesystem</span><span class="o">/</span><span class="n">preopens</span><span class="o">@</span><span class="mf">0.2.0</span><span class="err">`</span><span class="w"> </span><span class="n">encoded</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">instance</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="mi">9</span>
<span class="w"> </span><span class="n">DEBUG</span><span class="w"> </span><span class="n">wac_graph</span><span class="p">::</span><span class="n">graph</span><span class="w">        </span><span class="o">&gt;</span><span class="w"> </span><span class="n">interface</span><span class="w"> </span><span class="err">`</span><span class="n">wasi</span><span class="p">:</span><span class="nc">filesystem</span><span class="o">/</span><span class="n">preopens</span><span class="o">@</span><span class="mf">0.2.0</span><span class="err">`</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">available</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">aliasing</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">instance</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="mi">9</span>
<span class="w"> </span><span class="n">DEBUG</span><span class="w"> </span><span class="n">wac_graph</span><span class="p">::</span><span class="n">graph</span><span class="w">        </span><span class="o">&gt;</span><span class="w"> </span><span class="n">instantiating</span><span class="w"> </span><span class="n">package</span><span class="w"> </span><span class="err">`</span><span class="n">plug</span><span class="p">:</span><span class="nc">types</span><span class="err">`</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">arguments</span><span class="p">:</span><span class="w"> </span><span class="p">[(</span><span class="s">"wasi:cli/environment@0.2.0"</span><span class="p">,</span><span class="w"> </span><span class="n">Instance</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="s">"wasi:cli/exit@0.2.0"</span><span class="p">,</span><span class="w"> </span><span class="n">Instance</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="s">"wasi:io/error@0.2.0"</span><span class="p">,</span><span class="w"> </span><span class="n">Instance</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="s">"wasi:io/streams@0.2.0"</span><span class="p">,</span><span class="w"> </span><span class="n">Instance</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="s">"wasi:cli/stdin@0.2.0"</span><span class="p">,</span><span class="w"> </span><span class="n">Instance</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="s">"wasi:cli/stdout@0.2.0"</span><span class="p">,</span><span class="w"> </span><span class="n">Instance</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="s">"wasi:cli/stderr@0.2.0"</span><span class="p">,</span><span class="w"> </span><span class="n">Instance</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="s">"wasi:clocks/wall-clock@0.2.0"</span><span class="p">,</span><span class="w"> </span><span class="n">Instance</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="s">"wasi:filesystem/types@0.2.0"</span><span class="p">,</span><span class="w"> </span><span class="n">Instance</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="s">"wasi:filesystem/preopens@0.2.0"</span><span class="p">,</span><span class="w"> </span><span class="n">Instance</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">)]</span>
<span class="w"> </span><span class="n">DEBUG</span><span class="w"> </span><span class="n">wac_graph</span><span class="p">::</span><span class="n">graph</span><span class="w">        </span><span class="o">&gt;</span><span class="w"> </span><span class="n">instantiation</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">package</span><span class="w"> </span><span class="err">`</span><span class="n">plug</span><span class="p">:</span><span class="nc">types</span><span class="err">`</span><span class="w"> </span><span class="n">encoded</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">instance</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="mi">10</span>
<span class="w"> </span><span class="n">DEBUG</span><span class="w"> </span><span class="n">wac_graph</span><span class="p">::</span><span class="n">graph</span><span class="w">        </span><span class="o">&gt;</span><span class="w"> </span><span class="n">encoding</span><span class="w"> </span><span class="n">alias</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">instance</span><span class="w"> </span><span class="n">export</span><span class="w"> </span><span class="err">`</span><span class="n">hotswap</span><span class="p">:</span><span class="nc">salutation</span><span class="o">/</span><span class="n">user</span><span class="o">-</span><span class="n">interface</span><span class="o">@</span><span class="mf">0.1.0</span><span class="err">`</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">instance</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="mi">10</span>
<span class="w"> </span><span class="n">DEBUG</span><span class="w"> </span><span class="n">wac_graph</span><span class="p">::</span><span class="n">graph</span><span class="w">        </span><span class="o">&gt;</span><span class="w"> </span><span class="n">alias</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">export</span><span class="w"> </span><span class="err">`</span><span class="n">hotswap</span><span class="p">:</span><span class="nc">salutation</span><span class="o">/</span><span class="n">user</span><span class="o">-</span><span class="n">interface</span><span class="o">@</span><span class="mf">0.1.0</span><span class="err">`</span><span class="w"> </span><span class="n">encoded</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">instance</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="mi">11</span>
<span class="w"> </span><span class="n">DEBUG</span><span class="w"> </span><span class="n">wac_graph</span><span class="p">::</span><span class="n">graph</span><span class="w">        </span><span class="o">&gt;</span><span class="w"> </span><span class="n">instantiating</span><span class="w"> </span><span class="n">package</span><span class="w"> </span><span class="err">`</span><span class="n">socket</span><span class="err">`</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">arguments</span><span class="p">:</span><span class="w"> </span><span class="p">[(</span><span class="s">"hotswap:salutation/user-interface@0.1.0"</span><span class="p">,</span><span class="w"> </span><span class="n">Instance</span><span class="p">,</span><span class="w"> </span><span class="mi">11</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="s">"wasi:cli/environment@0.2.0"</span><span class="p">,</span><span class="w"> </span><span class="n">Instance</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="s">"wasi:cli/exit@0.2.0"</span><span class="p">,</span><span class="w"> </span><span class="n">Instance</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="s">"wasi:io/error@0.2.0"</span><span class="p">,</span><span class="w"> </span><span class="n">Instance</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="s">"wasi:io/streams@0.2.0"</span><span class="p">,</span><span class="w"> </span><span class="n">Instance</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="s">"wasi:cli/stdin@0.2.0"</span><span class="p">,</span><span class="w"> </span><span class="n">Instance</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="s">"wasi:cli/stdout@0.2.0"</span><span class="p">,</span><span class="w"> </span><span class="n">Instance</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="s">"wasi:cli/stderr@0.2.0"</span><span class="p">,</span><span class="w"> </span><span class="n">Instance</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="s">"wasi:clocks/wall-clock@0.2.0"</span><span class="p">,</span><span class="w"> </span><span class="n">Instance</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="s">"wasi:filesystem/types@0.2.0"</span><span class="p">,</span><span class="w"> </span><span class="n">Instance</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="s">"wasi:filesystem/preopens@0.2.0"</span><span class="p">,</span><span class="w"> </span><span class="n">Instance</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">)]</span>
<span class="w"> </span><span class="n">DEBUG</span><span class="w"> </span><span class="n">wac_graph</span><span class="p">::</span><span class="n">graph</span><span class="w">        </span><span class="o">&gt;</span><span class="w"> </span><span class="n">instantiation</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">package</span><span class="w"> </span><span class="err">`</span><span class="n">socket</span><span class="err">`</span><span class="w"> </span><span class="n">encoded</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">instance</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="mi">12</span>
<span class="w"> </span><span class="n">DEBUG</span><span class="w"> </span><span class="n">wac_graph</span><span class="p">::</span><span class="n">graph</span><span class="w">        </span><span class="o">&gt;</span><span class="w"> </span><span class="n">encoding</span><span class="w"> </span><span class="n">alias</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">instance</span><span class="w"> </span><span class="n">export</span><span class="w"> </span><span class="err">`</span><span class="n">hotswap</span><span class="p">:</span><span class="nc">salutation</span><span class="o">/</span><span class="n">salutation</span><span class="o">@</span><span class="mf">0.1.0</span><span class="err">`</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">instance</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="mi">12</span>
<span class="w"> </span><span class="n">DEBUG</span><span class="w"> </span><span class="n">wac_graph</span><span class="p">::</span><span class="n">graph</span><span class="w">        </span><span class="o">&gt;</span><span class="w"> </span><span class="n">alias</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">export</span><span class="w"> </span><span class="err">`</span><span class="n">hotswap</span><span class="p">:</span><span class="nc">salutation</span><span class="o">/</span><span class="n">salutation</span><span class="o">@</span><span class="mf">0.1.0</span><span class="err">`</span><span class="w"> </span><span class="n">encoded</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">instance</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="mi">13</span>
<span class="n">error</span><span class="p">:</span><span class="w"> </span><span class="nc">encoding</span><span class="w"> </span><span class="n">produced</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">failed</span><span class="w"> </span><span class="n">validation</span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span><span class="p">:</span>
<span class="w">    </span><span class="nc">instance</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">valid</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">export</span><span class="w"> </span><span class="p">(</span><span class="n">at</span><span class="w"> </span><span class="n">offset</span><span class="w"> </span><span class="mh">0x36d3bf</span><span class="p">)</span>

<span class="n">Stack</span><span class="w"> </span><span class="n">backtrace</span><span class="p">:</span>
<span class="w">   </span><span class="mi">0</span><span class="p">:</span><span class="w"> </span><span class="nc">std</span><span class="p">::</span><span class="n">backtrace_rs</span><span class="p">::</span><span class="n">backtrace</span><span class="p">::</span><span class="n">libunwind</span><span class="p">::</span><span class="n">trace</span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="n">eeb90cda1969383f56a2637cbd3037bdf598841c</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/../../</span><span class="n">backtrace</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">backtrace</span><span class="o">/</span><span class="n">libunwind</span><span class="p">.</span><span class="n">rs</span><span class="p">:</span><span class="mi">116</span><span class="p">:</span><span class="mi">5</span>
<span class="w">   </span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="nc">std</span><span class="p">::</span><span class="n">backtrace_rs</span><span class="p">::</span><span class="n">backtrace</span><span class="p">::</span><span class="n">trace_unsynchronized</span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="n">eeb90cda1969383f56a2637cbd3037bdf598841c</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/../../</span><span class="n">backtrace</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">backtrace</span><span class="o">/</span><span class="k">mod</span><span class="p">.</span><span class="n">rs</span><span class="p">:</span><span class="mi">66</span><span class="p">:</span><span class="mi">5</span>
<span class="w">   </span><span class="mi">2</span><span class="p">:</span><span class="w"> </span><span class="nc">std</span><span class="p">::</span><span class="n">backtrace</span><span class="p">::</span><span class="n">Backtrace</span><span class="p">::</span><span class="n">create</span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="n">eeb90cda1969383f56a2637cbd3037bdf598841c</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">backtrace</span><span class="p">.</span><span class="n">rs</span><span class="p">:</span><span class="mi">331</span><span class="p">:</span><span class="mi">13</span>
<span class="w">   </span><span class="mi">3</span><span class="p">:</span><span class="w"> </span><span class="nc">anyhow</span><span class="p">::</span><span class="n">error</span><span class="p">::</span><span class="o">&lt;</span><span class="k">impl</span><span class="w"> </span><span class="n">core</span><span class="p">::</span><span class="n">convert</span><span class="p">::</span><span class="nb">From</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">anyhow</span><span class="p">::</span><span class="n">Error</span><span class="o">&gt;</span><span class="p">::</span><span class="n">from</span>
<span class="w">   </span><span class="mi">4</span><span class="p">:</span><span class="w"> </span><span class="o">&lt;</span><span class="n">core</span><span class="p">::</span><span class="n">result</span><span class="p">::</span><span class="nb">Result</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="n">F</span><span class="o">&gt;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">core</span><span class="p">::</span><span class="n">ops</span><span class="p">::</span><span class="n">try_trait</span><span class="p">::</span><span class="n">FromResidual</span><span class="o">&lt;</span><span class="n">core</span><span class="p">::</span><span class="n">result</span><span class="p">::</span><span class="nb">Result</span><span class="o">&lt;</span><span class="n">core</span><span class="p">::</span><span class="n">convert</span><span class="p">::</span><span class="n">Infallible</span><span class="p">,</span><span class="n">E</span><span class="o">&gt;&gt;&gt;</span><span class="p">::</span><span class="n">from_residual</span>
<span class="w">   </span><span class="mi">5</span><span class="p">:</span><span class="w"> </span><span class="nc">wac_cli</span><span class="p">::</span><span class="n">commands</span><span class="p">::</span><span class="n">plug</span><span class="p">::</span><span class="n">PlugCommand</span><span class="p">::</span><span class="n">exec</span><span class="p">::{{</span><span class="n">closure</span><span class="p">}}</span>
<span class="w">   </span><span class="mi">6</span><span class="p">:</span><span class="w"> </span><span class="nc">wac</span><span class="p">::</span><span class="n">main</span><span class="p">::{{</span><span class="n">closure</span><span class="p">}}</span>
<span class="o">..</span><span class="p">.</span>
</code></pre></div>



<a name="471282061"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/transitive%20imports%20validation%20failure/near/471282061" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/transitive.20imports.20validation.20failure.html#471282061">(Sep 18 2024 at 15:07)</a>:</h4>
<p>thanks! I'll try to take a look at this in the near future. If you'd like as well in the meantime I think it'd be reasonable to file an issue too</p>



<a name="471367705"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/transitive%20imports%20validation%20failure/near/471367705" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Evan Simmons <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/transitive.20imports.20validation.20failure.html#471367705">(Sep 18 2024 at 23:47)</a>:</h4>
<p>Cool, ya i think this might be the same issue: <a href="https://github.com/bytecodealliance/wasm-tools/issues/1798">https://github.com/bytecodealliance/wasm-tools/issues/1798</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wasm-tools/issues/1798" style="background-image: url(&quot;https://uploads.zulipusercontent.net/415b4943b56f4ffb05cc4af064eb69abb28e9ca4/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f323662633236333438666438643439613038656331383633613664323531393533386434663135353064623530396334393535383130616566396333326463662f62797465636f6465616c6c69616e63652f7761736d2d746f6f6c732f6973737565732f31373938&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wasm-tools/issues/1798" title="failed to validate output component · Issue #1798 · bytecodealliance/wasm-tools">failed to validate output component · Issue #1798 · bytecodealliance/wasm-tools</a></div><div class="message_embed_description">Component has been built successfully but failed the invalidation. This repo https://github.com/sammyne/wasm-component-broken-compose is made to reproduce the problem. Requirement Rust 1.80.1 (3762...</div></div></div>



<a name="471808343"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/transitive%20imports%20validation%20failure/near/471808343" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/transitive.20imports.20validation.20failure.html#471808343">(Sep 20 2024 at 18:53)</a>:</h4>
<p>A bit delayed getting to this but I left a comment on the issue there about what's going wrong, let me know if the workaround of "move the types around" doesn't work for you though</p>



<a name="471819495"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/transitive%20imports%20validation%20failure/near/471819495" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Evan Simmons <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/transitive.20imports.20validation.20failure.html#471819495">(Sep 20 2024 at 19:51)</a>:</h4>
<p>That was a super helpful explanation. I just tried the suggestion, and it seems the consequences of moving the type up is that the top level component then needs to implement that interface.</p>



<a name="471819814"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/transitive%20imports%20validation%20failure/near/471819814" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Evan Simmons <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/transitive.20imports.20validation.20failure.html#471819814">(Sep 20 2024 at 19:52)</a>:</h4>
<p>My use case is roughly, team A owns the raw data and type definitions, team B, C, ... imports those and uses them in their business logic. Maybe there is some other way to accomplish this?</p>



<a name="471820870"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/transitive%20imports%20validation%20failure/near/471820870" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Evan Simmons <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/transitive.20imports.20validation.20failure.html#471820870">(Sep 20 2024 at 19:55)</a>:</h4>
<p>Ive created an issue in the wac repo here: <a href="https://github.com/bytecodealliance/wac/issues/141">https://github.com/bytecodealliance/wac/issues/141</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wac/issues/141" style="background-image: url(&quot;https://uploads.zulipusercontent.net/0010187f47680491e9720dfa40dbeedeaeb63eb0/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f303165396536613535353134623432656639363363346532363738333865336434613265363837616363656334626666333065393835353630333531383138612f62797465636f6465616c6c69616e63652f7761632f6973737565732f313431&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wac/issues/141" title="wac plug error: &quot;error: encoding produced a component that failed validation&quot; · Issue #141 · bytecodealliance/wac">wac plug error: "error: encoding produced a component that failed validation" · Issue #141 · bytecodealliance/wac</a></div><div class="message_embed_description">Repro https://github.com/estk/hotswap-example The error wac plug --plug types.wasm salutation.wasm -o tysal.wasm error: encoding produced a component that failed validation Caused by: instance not ...</div></div></div>



<a name="471824282"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/transitive%20imports%20validation%20failure/near/471824282" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/transitive.20imports.20validation.20failure.html#471824282">(Sep 20 2024 at 20:07)</a>:</h4>
<p>Another possibility is to split <code>interface salutation</code> into <code>interface salutation</code> and <code>interface salutation-types</code>, and I think that should work?</p>



<a name="471824766"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/transitive%20imports%20validation%20failure/near/471824766" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Evan Simmons <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/transitive.20imports.20validation.20failure.html#471824766">(Sep 20 2024 at 20:11)</a>:</h4>
<p>standby let me try that</p>



<a name="471826551"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/transitive%20imports%20validation%20failure/near/471826551" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Evan Simmons <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/transitive.20imports.20validation.20failure.html#471826551">(Sep 20 2024 at 20:20)</a>:</h4>
<p>i pushed the changes to my main branch, one sec and ill try to fix the compile err</p>



<a name="471827845"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/transitive%20imports%20validation%20failure/near/471827845" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Evan Simmons <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/transitive.20imports.20validation.20failure.html#471827845">(Sep 20 2024 at 20:28)</a>:</h4>
<p>ok, its typechecking now, but same error</p>



<a name="471827953"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/transitive%20imports%20validation%20failure/near/471827953" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Evan Simmons <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/transitive.20imports.20validation.20failure.html#471827953">(Sep 20 2024 at 20:28)</a>:</h4>
<p><a href="http://types.rs">types.rs</a></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">interface</span><span class="w"> </span><span class="n">user</span><span class="o">-</span><span class="n">types</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">type</span><span class="w"> </span><span class="nc">tag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">u64</span><span class="p">;</span>
<span class="w">    </span><span class="k">enum</span><span class="w"> </span><span class="nc">gender</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">male</span><span class="p">,</span>
<span class="w">        </span><span class="n">female</span><span class="p">,</span>
<span class="w">        </span><span class="n">other</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">record</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="nc">string</span><span class="p">,</span>
<span class="w">        </span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="kt">u64</span><span class="p">,</span>
<span class="w">        </span><span class="n">tenant</span><span class="o">-</span><span class="n">tags</span><span class="p">:</span><span class="w"> </span><span class="nc">list</span><span class="o">&lt;</span><span class="n">tag</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">        </span><span class="n">gender</span><span class="p">:</span><span class="w"> </span><span class="nc">gender</span><span class="p">,</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">record</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">seconds</span><span class="p">:</span><span class="w"> </span><span class="kt">u64</span><span class="p">,</span>
<span class="w">        </span><span class="n">nanos</span><span class="p">:</span><span class="w"> </span><span class="kt">u64</span><span class="p">,</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="n">interface</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">use</span><span class="w"> </span><span class="n">user</span><span class="o">-</span><span class="n">types</span><span class="p">.{</span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="n">time</span><span class="p">};</span>
<span class="w">    </span><span class="n">age</span><span class="o">-</span><span class="k">in</span><span class="o">-</span><span class="n">weeks</span><span class="p">:</span><span class="w"> </span><span class="nc">func</span><span class="p">(</span><span class="n">u</span><span class="p">:</span><span class="w"> </span><span class="nc">user</span><span class="p">,</span><span class="w"> </span><span class="n">now</span><span class="p">:</span><span class="w"> </span><span class="nc">time</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="kt">u32</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">world</span><span class="w"> </span><span class="n">types</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">export</span><span class="w"> </span><span class="n">user</span><span class="p">;</span>
<span class="w">    </span><span class="n">export</span><span class="w"> </span><span class="n">user</span><span class="o">-</span><span class="n">types</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>



<a name="471828003"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/transitive%20imports%20validation%20failure/near/471828003" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Evan Simmons <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/transitive.20imports.20validation.20failure.html#471828003">(Sep 20 2024 at 20:29)</a>:</h4>
<p><a href="http://salutation.rs">salutation.rs</a></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">interface</span><span class="w"> </span><span class="n">salutation</span><span class="o">-</span><span class="n">types</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">variant</span><span class="w"> </span><span class="n">formal</span><span class="o">-</span><span class="n">honorific</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">sir</span><span class="p">,</span>
<span class="w">        </span><span class="n">maam</span><span class="p">,</span>
<span class="w">        </span><span class="n">sir</span><span class="o">-</span><span class="n">maam</span><span class="p">,</span>
<span class="w">        </span><span class="n">custom</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="n">interface</span><span class="w"> </span><span class="n">salutation</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">use</span><span class="w"> </span><span class="n">user</span><span class="o">-</span><span class="n">types</span><span class="p">.{</span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="n">time</span><span class="p">};</span>
<span class="w">    </span><span class="k">use</span><span class="w"> </span><span class="n">salutation</span><span class="o">-</span><span class="n">types</span><span class="p">.{</span><span class="n">formal</span><span class="o">-</span><span class="n">honorific</span><span class="p">};</span>

<span class="w">    </span><span class="n">get</span><span class="o">-</span><span class="n">formal</span><span class="o">-</span><span class="n">honorific</span><span class="p">:</span><span class="w"> </span><span class="nc">func</span><span class="p">(</span><span class="n">u</span><span class="p">:</span><span class="w"> </span><span class="nc">user</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">formal</span><span class="o">-</span><span class="n">honorific</span><span class="p">;</span>
<span class="w">    </span><span class="n">greet</span><span class="p">:</span><span class="w"> </span><span class="nc">func</span><span class="p">(</span><span class="n">u</span><span class="p">:</span><span class="w"> </span><span class="nc">user</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">string</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">world</span><span class="w"> </span><span class="n">app</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">import</span><span class="w"> </span><span class="n">user</span><span class="p">;</span>
<span class="w">    </span><span class="n">import</span><span class="w"> </span><span class="n">user</span><span class="o">-</span><span class="n">types</span><span class="p">;</span>
<span class="w">    </span><span class="n">export</span><span class="w"> </span><span class="n">salutation</span><span class="o">-</span><span class="n">types</span><span class="p">;</span>
<span class="w">    </span><span class="n">export</span><span class="w"> </span><span class="n">salutation</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>



<a name="471829925"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/transitive%20imports%20validation%20failure/near/471829925" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/transitive.20imports.20validation.20failure.html#471829925">(Sep 20 2024 at 20:43)</a>:</h4>
<p>if you remove <code>export salutation-types</code> does it work?</p>



<a name="471829949"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/transitive%20imports%20validation%20failure/near/471829949" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/transitive.20imports.20validation.20failure.html#471829949">(Sep 20 2024 at 20:43)</a>:</h4>
<p>(maybe <code>export user-types</code> too?)</p>



<a name="471830731"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/transitive%20imports%20validation%20failure/near/471830731" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Evan Simmons <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/transitive.20imports.20validation.20failure.html#471830731">(Sep 20 2024 at 20:49)</a>:</h4>
<p>standby</p>



<a name="471830932"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/transitive%20imports%20validation%20failure/near/471830932" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Evan Simmons <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/transitive.20imports.20validation.20failure.html#471830932">(Sep 20 2024 at 20:50)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">world</span><span class="w"> </span><span class="n">app</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">import</span><span class="w"> </span><span class="n">user</span><span class="p">;</span>
<span class="w">    </span><span class="n">export</span><span class="w"> </span><span class="n">salutation</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">cargo</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="n">build</span><span class="w"> </span><span class="o">-</span><span class="n">p</span><span class="w"> </span><span class="n">types</span>
<span class="n">cargo</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="n">build</span><span class="w"> </span><span class="o">-</span><span class="n">p</span><span class="w"> </span><span class="n">salutation</span>
<span class="w">    </span><span class="n">Finished</span><span class="w"> </span><span class="err">`</span><span class="n">dev</span><span class="err">`</span><span class="w"> </span><span class="n">profile</span><span class="w"> </span><span class="p">[</span><span class="n">unoptimized</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">debuginfo</span><span class="p">]</span><span class="w"> </span><span class="n">target</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mf">0.02</span><span class="n">s</span>
<span class="w">    </span><span class="n">Finished</span><span class="w"> </span><span class="err">`</span><span class="n">dev</span><span class="err">`</span><span class="w"> </span><span class="n">profile</span><span class="w"> </span><span class="p">[</span><span class="n">unoptimized</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">debuginfo</span><span class="p">]</span><span class="w"> </span><span class="n">target</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mf">0.00</span><span class="n">s</span>

<span class="n">wac</span><span class="w"> </span><span class="n">plug</span><span class="w"> </span><span class="o">--</span><span class="n">plug</span><span class="w"> </span><span class="n">types</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="n">salutation</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">-</span><span class="n">o</span><span class="w"> </span><span class="n">tysal</span><span class="p">.</span><span class="n">wasm</span>
<span class="n">error</span><span class="p">:</span><span class="w"> </span><span class="nc">encoding</span><span class="w"> </span><span class="n">produced</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">failed</span><span class="w"> </span><span class="n">validation</span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span><span class="p">:</span>
<span class="w">    </span><span class="nc">instance</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">valid</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">export</span><span class="w"> </span><span class="p">(</span><span class="n">at</span><span class="w"> </span><span class="n">offset</span><span class="w"> </span><span class="mh">0x36dcea</span><span class="p">)</span>
</code></pre></div>



<a name="471831047"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/transitive%20imports%20validation%20failure/near/471831047" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Evan Simmons <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/transitive.20imports.20validation.20failure.html#471831047">(Sep 20 2024 at 20:51)</a>:</h4>
<p>(same deal with user-types still imported)</p>



<a name="471832471"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/transitive%20imports%20validation%20failure/near/471832471" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/transitive.20imports.20validation.20failure.html#471832471">(Sep 20 2024 at 21:02)</a>:</h4>
<p>hm so locally if I take the WITs you just mentioned above and delete <code>export user-types;</code>, <code>import user-types;</code>, and <code>export salutation-types;</code> I can get a composition to work locally</p>



<a name="471832506"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/transitive%20imports%20validation%20failure/near/471832506" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/transitive.20imports.20validation.20failure.html#471832506">(Sep 20 2024 at 21:03)</a>:</h4>
<p>did you update <code>world types { ... }</code> as well to not have the <code>export user-types</code>?</p>



<a name="471832533"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/transitive%20imports%20validation%20failure/near/471832533" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/transitive.20imports.20validation.20failure.html#471832533">(Sep 20 2024 at 21:03)</a>:</h4>
<p>(and to be clear this is all still a bug in wac/wasm-compose, in the meantime I'm curious if a workaround is possible)</p>



<a name="471851673"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/transitive%20imports%20validation%20failure/near/471851673" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Evan Simmons <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/transitive.20imports.20validation.20failure.html#471851673">(Sep 20 2024 at 23:37)</a>:</h4>
<p>Sorry for the delay, was in mtgs. Ok, so yes with those changes it does work!</p>



<a name="471851810"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/transitive%20imports%20validation%20failure/near/471851810" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Evan Simmons <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/transitive.20imports.20validation.20failure.html#471851810">(Sep 20 2024 at 23:39)</a>:</h4>
<p>I've pushed a commit to the main branch with those fixes. Super interesting that that worked.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>