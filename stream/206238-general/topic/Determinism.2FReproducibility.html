<html>
<head><meta charset="utf-8"><title>Determinism/Reproducibility · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/index.html">general</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html">Determinism/Reproducibility</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="214394910"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214394910" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214394910">(Oct 23 2020 at 22:53)</a>:</h4>
<p>So Dan and I were discussing deterministic/reproducible behavior in WASI.</p>



<a name="214394957"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214394957" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214394957">(Oct 23 2020 at 22:54)</a>:</h4>
<p>One thing that came up is sort order, which is a cause of non-determinism in a lot of languages.</p>



<a name="214395107"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214395107" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214395107">(Oct 23 2020 at 22:57)</a>:</h4>
<p>I don't know of a any prior art in this space, so all I have right now are ideas off the top of my head</p>



<a name="214395115"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214395115" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214395115">(Oct 23 2020 at 22:57)</a>:</h4>
<p>I had suggested earlier that some sort of way to control deterministic/reproducible behavior, such as defining the sorting of files based on name (as opposed to timestamps).  This would be slow, especially without the help of the underlying filesystem/b-tree structure.</p>



<a name="214395120"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214395120" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214395120">(Oct 23 2020 at 22:57)</a>:</h4>
<p>One option would be to have the implementation maintain its own index, that it'd update every time it creates or renames a file.</p>



<a name="214395168"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214395168" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214395168">(Oct 23 2020 at 22:58)</a>:</h4>
<p>But have that be configurable, so you can turn that one but it will be slow and not all runtimes will support it.</p>



<a name="214395172"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214395172" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214395172">(Oct 23 2020 at 22:58)</a>:</h4>
<p>Then, <code>fd_readdir</code> etc. would iterate over that index, rather than over thee host directory.</p>



<a name="214395184"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214395184" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214395184">(Oct 23 2020 at 22:58)</a>:</h4>
<p>Right, slow, and it'd get out of date if other processes can access the dir.</p>



<a name="214395238"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214395238" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214395238">(Oct 23 2020 at 22:59)</a>:</h4>
<p>So yeah, we'd want it to be optional</p>



<a name="214395433"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214395433" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214395433">(Oct 23 2020 at 23:02)</a>:</h4>
<p>There are FUSE filesystems, Android used wrapfs to enable case-folded file lookup.</p>



<a name="214395448"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214395448" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214395448">(Oct 23 2020 at 23:02)</a>:</h4>
<p>I wonder if the problem of other processes could be solved, or at least mitigated, by having the implementation compare the timestamp of the index to the timestamp of the directory. If the directory is more recently modified, re-scan the directory and regenerate the index.</p>



<a name="214395452"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214395452" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214395452">(Oct 23 2020 at 23:02)</a>:</h4>
<p>And disorderfs, which can actually list directories in a specified sort order.</p>



<a name="214395480"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214395480" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214395480">(Oct 23 2020 at 23:03)</a>:</h4>
<p>Ah, FUSE etc. is a good idea too. If we can make the host FS do what we need, that'd avoid the need for an external index</p>



<a name="214395496"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214395496" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214395496">(Oct 23 2020 at 23:03)</a>:</h4>
<p>In my research on case-folded lookups on case-sensitive file systems, all of the solutions were racy.</p>



<a name="214395597"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214395597" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214395597">(Oct 23 2020 at 23:05)</a>:</h4>
<p>Maybe that's the first question then. Are there any non-racy solutions?</p>



<a name="214395668"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214395668" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214395668">(Oct 23 2020 at 23:06)</a>:</h4>
<p>I don't know.</p>



<a name="214395683"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214395683" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214395683">(Oct 23 2020 at 23:06)</a>:</h4>
<p>Or  perhaps we just need to say, don't enable this option if anyone can access the FS concurrently?</p>



<a name="214395715"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214395715" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214395715">(Oct 23 2020 at 23:07)</a>:</h4>
<p>I mean, SQLITE can be as fast as filesystem access.  So a virtual filesystem could work.</p>



<a name="214395824"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214395824" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214395824">(Oct 23 2020 at 23:09)</a>:</h4>
<p>If that meets your needs, it sounds like a reasonable thing to do to me</p>



<a name="214395832"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214395832" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214395832">(Oct 23 2020 at 23:09)</a>:</h4>
<p>BeFS allowed arbitrary metadata, but no one seems eager to emulate that FS.</p>



<a name="214395858"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214395858" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214395858">(Oct 23 2020 at 23:09)</a>:</h4>
<p>OS X, Windows, etc all just maintain a file-based search index.</p>



<a name="214395934"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214395934" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214395934">(Oct 23 2020 at 23:10)</a>:</h4>
<p>But again, I think it would be possible to define a well specified standard but allow non-deterministic access that relies on the underlying FS.</p>



<a name="214396022"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214396022" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214396022">(Oct 23 2020 at 23:12)</a>:</h4>
<p>Could you describe your goal here in more detail?</p>



<a name="214396024"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214396024" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214396024">(Oct 23 2020 at 23:12)</a>:</h4>
<p>If you can assume an exclusive lock on the directory, then you should be able to enable case-folded lookups on that directory in Linux.  This is currently only working on EXT4 and F2FS but those efforts are very much intended to spread to the other Linux filesystems.</p>



<a name="214396046"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214396046" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214396046">(Oct 23 2020 at 23:13)</a>:</h4>
<p>The filesystem is a global shared state, it helps if you can nail down its behavior as finely as possible.</p>



<a name="214396104"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214396104" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214396104">(Oct 23 2020 at 23:14)</a>:</h4>
<p>My other big concern from earlier to preventing a standard which adopts case-sensitivity by default, as it's very hard to undo that choice later.</p>



<a name="214396111"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214396111" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214396111">(Oct 23 2020 at 23:14)</a>:</h4>
<p>Does Linux have a way to lock directories?</p>



<a name="214396117"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214396117" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214396117">(Oct 23 2020 at 23:14)</a>:</h4>
<p>As a usability engineer, we are often brought in waaaaay to late to make any changes.</p>



<a name="214396149"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214396149" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214396149">(Oct 23 2020 at 23:15)</a>:</h4>
<p>I mean, through permissions.  But ~/.wine essentially assumes exclusive access and enables case-insensitivity on that directory.</p>



<a name="214396264"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214396264" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214396264">(Oct 23 2020 at 23:17)</a>:</h4>
<p>If you have an implementation in mind, could you write up some pseudo-code for how, eg. creating a file, and listing the contents of a directory, would work?</p>



<a name="214396368"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214396368" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214396368">(Oct 23 2020 at 23:19)</a>:</h4>
<p>I don't, the simplest would be to create a sort order based on unicode codepoints.  But that is a basic sort.</p>



<a name="214396436"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214396436" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214396436">(Oct 23 2020 at 23:20)</a>:</h4>
<p>AFAICT, EXT4, BTRFS, and F2FS all maintain a hashed filename index.  So it won't be sorted according to anything close to Unicode sort order, but still sorted.</p>



<a name="214396449"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214396449" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214396449">(Oct 23 2020 at 23:20)</a>:</h4>
<p>So picking a specific ordering is one thing, yes, but I'm still trying to get a picture for what problem you're looking to solve, or which specific context you're looking to solve it in.</p>



<a name="214396499"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214396499" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214396499">(Oct 23 2020 at 23:22)</a>:</h4>
<p>The specific problem I'm looking to solve is serving up files from the FS in an order based on the filename, as opposed to insertion order in the b-tree.</p>



<a name="214396572"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214396572" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214396572">(Oct 23 2020 at 23:23)</a>:</h4>
<p>Cool, and are you hoping to enable this for general-purpose use, or only within virtual filesystems and perhaps private-directory filesystems where we have exclusive access?</p>



<a name="214396586"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214396586" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214396586">(Oct 23 2020 at 23:23)</a>:</h4>
<p>Disorderfs is actually used by the reproducible build community to debug builds where the FS ordering of files creeps into build scripts.</p>



<a name="214396593"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214396593" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214396593">(Oct 23 2020 at 23:23)</a>:</h4>
<p>The last two.</p>



<a name="214396648"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214396648" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214396648">(Oct 23 2020 at 23:24)</a>:</h4>
<p>We could do general purpose, but I would just stub that code out and document how you would like it done.</p>



<a name="214396660"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214396660" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214396660">(Oct 23 2020 at 23:24)</a>:</h4>
<p>Listing directories specific directories based on filename in a deterministic fashion is totally doable.</p>



<a name="214396716"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214396716" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214396716">(Oct 23 2020 at 23:25)</a>:</h4>
<p>Emulating case-insensitivity on a case-sensitive filesystem can work well enough in 80</p>



<a name="214396720"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214396720" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214396720">(Oct 23 2020 at 23:25)</a>:</h4>
<p>% of cases.</p>



<a name="214396815"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214396815" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214396815">(Oct 23 2020 at 23:27)</a>:</h4>
<p>But it's always going to be slower, racy, and blow up in your face if you do something dumb like "/foo/BAR/readme.txt" and "/foo/bar/readme.txt"</p>



<a name="214396896"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214396896" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214396896">(Oct 23 2020 at 23:28)</a>:</h4>
<p>I imagine for virtual-fs and private-directory cases we can case-fold the host files, so it'd work</p>



<a name="214396901"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214396901" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214396901">(Oct 23 2020 at 23:28)</a>:</h4>
<p>Perhaps we should discuss filename, encoding, and case-sensitivity and to what degree the API should enforce its opinions on everyone?</p>



<a name="214396909"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214396909" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214396909">(Oct 23 2020 at 23:28)</a>:</h4>
<p>Are you venturing into the general-purpose side of things now?</p>



<a name="214396917"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214396917" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214396917">(Oct 23 2020 at 23:28)</a>:</h4>
<p>Yeah.</p>



<a name="214397006"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214397006" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214397006">(Oct 23 2020 at 23:30)</a>:</h4>
<p>My working assumption is that case-insensitivity is just "whether and how it's done is nondeterministic"</p>



<a name="214397014"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214397014" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214397014">(Oct 23 2020 at 23:30)</a>:</h4>
<p>in the general-purpose case</p>



<a name="214397023"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214397023" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214397023">(Oct 23 2020 at 23:30)</a>:</h4>
<p>and we just let whatever the host FS does shine through</p>



<a name="214397044"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214397044" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214397044">(Oct 23 2020 at 23:31)</a>:</h4>
<p>I don't think we can impose our invariants on the underlying filesystem without things breaking.</p>



<a name="214397050"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214397050" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214397050">(Oct 23 2020 at 23:31)</a>:</h4>
<p>So agree there.</p>



<a name="214397069"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214397069" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214397069">(Oct 23 2020 at 23:31)</a>:</h4>
<p>But I strongly disagree that we should fail if (as was suggested) the case differs from what was looked up.</p>



<a name="214397120"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214397120" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214397120">(Oct 23 2020 at 23:32)</a>:</h4>
<p>Ah, interesting.</p>



<a name="214397145"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214397145" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214397145">(Oct 23 2020 at 23:32)</a>:</h4>
<p>You are basically making the API opinionated in favor of case-sensitivity, which is not what end-users/consumers want.</p>



<a name="214397150"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214397150" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214397150">(Oct 23 2020 at 23:33)</a>:</h4>
<p>And it's a nightmare to try and fix that choice later.</p>



<a name="214397166"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214397166" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214397166">(Oct 23 2020 at 23:33)</a>:</h4>
<p>Have you seen sandboxfs?</p>



<a name="214397170"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214397170" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214397170">(Oct 23 2020 at 23:33)</a>:</h4>
<p>Actually, let's shelf that for a minute.</p>



<a name="214397172"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214397172" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214397172">(Oct 23 2020 at 23:33)</a>:</h4>
<p>shelve*</p>



<a name="214397358"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214397358" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214397358">(Oct 23 2020 at 23:36)</a>:</h4>
<p>That "check to see if the case differs" is meant to avoid programs which accidentally depend on running on case-insensitive filesystems</p>



<a name="214397392"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214397392" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214397392">(Oct 23 2020 at 23:37)</a>:</h4>
<p>Your point seems to be "case insensitive filesystems are The Path Forward", so we should embrace them and not risk locking ourselves out of an all-case-insensitive future</p>



<a name="214397451"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214397451" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214397451">(Oct 23 2020 at 23:38)</a>:</h4>
<p>primarily-case-insensitive future.</p>



<a name="214397452"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214397452" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214397452">(Oct 23 2020 at 23:38)</a>:</h4>
<p>I hadn't though of it like that</p>



<a name="214397454"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214397454" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214397454">(Oct 23 2020 at 23:38)</a>:</h4>
<p>But yeah, mostly.</p>



<a name="214397477"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214397477" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214397477">(Oct 23 2020 at 23:38)</a>:</h4>
<p>I mean, people have scripts that work on OS X but fail on Linux because case suddenly matters.</p>



<a name="214397578"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214397578" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214397578">(Oct 23 2020 at 23:40)</a>:</h4>
<p>What we might do, is have that check, but don't make it part of the WASI spec. Just make it a debugging feature that engines can optionally provide.</p>



<a name="214397589"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214397589" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214397589">(Oct 23 2020 at 23:40)</a>:</h4>
<p>What confuses me is that you are proposing normalizing all names to UTF-8, which is similar to case-folding in that the string used to lookup a file in a UCS-2 the language won't match the string returned as the filename.</p>



<a name="214397631"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214397631" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214397631">(Oct 23 2020 at 23:41)</a>:</h4>
<p>assuming we do something like ARF strings or modified UTF8-C8, the differences is that the translation is reversible</p>



<a name="214397632"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214397632" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214397632">(Oct 23 2020 at 23:41)</a>:</h4>
<p>case-folding is lossy</p>



<a name="214397634"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214397634" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214397634">(Oct 23 2020 at 23:41)</a>:</h4>
<p>That's still pushing people to use case, which shouldn't matter.</p>



<a name="214397682"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214397682" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214397682">(Oct 23 2020 at 23:42)</a>:</h4>
<p>For sure, but it will still require manual refactoring.</p>



<a name="214397702"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214397702" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214397702">(Oct 23 2020 at 23:42)</a>:</h4>
<p>The theory with ARF strings is that <del>non-Unicode</del>ill-formed filenames are so rare that many programs wouldn't need to bother</p>



<a name="214397712"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214397712" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214397712">(Oct 23 2020 at 23:43)</a>:</h4>
<p>Also, if you are going to convert to UTF-8, are you also going to normalize to NFC?</p>



<a name="214397718"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214397718" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214397718">(Oct 23 2020 at 23:43)</a>:</h4>
<p>Agreed.</p>



<a name="214397731"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214397731" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214397731">(Oct 23 2020 at 23:43)</a>:</h4>
<p>No, I expect NFC/NFD is just "whatever the host does"</p>



<a name="214397854"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214397854" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214397854">(Oct 23 2020 at 23:45)</a>:</h4>
<p>Hrm.</p>



<a name="214397906"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214397906" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214397906">(Oct 23 2020 at 23:46)</a>:</h4>
<p>This is a tad above my paygrade: my understanding is that <em>if you are going to mess with encoding, then you should probably do NFC too</em>.  &lt;- might be wrong.</p>



<a name="214397914"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214397914" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214397914">(Oct 23 2020 at 23:46)</a>:</h4>
<p>arbitrary codepoint sequence -&gt; NFC or NFD is also lossy</p>



<a name="214397937"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214397937" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214397937">(Oct 23 2020 at 23:47)</a>:</h4>
<p>Basically, you have to do NFC or NFD if you want deterministic sort order.</p>



<a name="214397999"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214397999" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214397999">(Oct 23 2020 at 23:48)</a>:</h4>
<p>NFD is faster, but doesn't match what most keyboards and applications do, so it makes it hard to find the file in the filesystem.  But since you don't care about re-encoding the file name....</p>



<a name="214398026"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214398026" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214398026">(Oct 23 2020 at 23:49)</a>:</h4>
<p>in the general-purpose case, we can't prevent other processes from creating non-NFC or non-NFD names on hosts which don't enforce those</p>



<a name="214398029"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214398029" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214398029">(Oct 23 2020 at 23:49)</a>:</h4>
<p>Linus hates this, it was seen as a mistake for HFS+ to do this, and that all filesystems should preserve encoding/case as the filename returned but store an NFD/NFC normalized filename in the metadata.</p>



<a name="214398094"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214398094" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214398094">(Oct 23 2020 at 23:50)</a>:</h4>
<p>Okay, I actually agree we should go that way.</p>



<a name="214398123"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214398123" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214398123">(Oct 23 2020 at 23:51)</a>:</h4>
<p>Alright, so I will post my concerns about blowing up when there is a case mismatch in that filename thread.</p>



<a name="214398131"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214398131" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214398131">(Oct 23 2020 at 23:51)</a>:</h4>
<p>And post info about performance in the Gist I made.</p>



<a name="214398145"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214398145" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214398145">(Oct 23 2020 at 23:51)</a>:</h4>
<p>Uhh, last thing I wanted to discuss: using FUSE/encryption to enforce access control and determinism.</p>



<a name="214398219"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214398219" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214398219">(Oct 23 2020 at 23:52)</a>:</h4>
<p>Bazel created sandboxfs too speedup access-control permissions in builds.</p>



<a name="214398242"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214398242" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214398242">(Oct 23 2020 at 23:53)</a>:</h4>
<p>I believe Apple uses encryption to enforce access control too, IIRC it gets as finely grained as append only writes.</p>



<a name="214398294"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214398294" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214398294">(Oct 23 2020 at 23:54)</a>:</h4>
<p>That would also help with determinism.</p>



<a name="214398346"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214398346" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214398346">(Oct 23 2020 at 23:54)</a>:</h4>
<p>Do you know of any literature that defines the limits of what encryption based ocap can do?</p>



<a name="214398422"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214398422" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214398422">(Oct 23 2020 at 23:56)</a>:</h4>
<p>(to address your comment above, normalizing to NFC is worth considering, but in the general-purpose case we similarly run into O(2^N) situations where you have to check for all possible variations of non-normalized filenames created by other processes)</p>



<a name="214398437"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214398437" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214398437">(Oct 23 2020 at 23:56)</a>:</h4>
<p>At the level we're operating at right now, all encryption is "the next level down"</p>



<a name="214398450"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214398450" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214398450">(Oct 23 2020 at 23:57)</a>:</h4>
<p>Bits on disk are encrypted by the host's filesystem code, but that's all transparent outside of the kernel</p>



<a name="214398571"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214398571" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214398571">(Oct 23 2020 at 23:59)</a>:</h4>
<p>userspace never sees the encrypted bits, and the only security function the encryption serves is to foil attackers that can access the underlying storage media directly, which userspace can't do under normal circumstances</p>



<a name="214398662"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214398662" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214398662">(Oct 24 2020 at 00:01)</a>:</h4>
<p>capability-based security is about controlling what things you can ask for. The basic idea is that you're given handles, which are program values that you can pass around as arguments and return values and so on, that represent resources you have access to, instead of naming things with strings</p>



<a name="214398762"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214398762" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214398762">(Oct 24 2020 at 00:03)</a>:</h4>
<p><code>open("foo", O_RDONLY)</code> plucks the name <code>foo</code> from thin air and requests access to it. This implies a global namespace in which the request can be resolved, which might have ACLs to govern access, but ACLs are awkward to manage in a bunch of ways.</p>



<a name="214398848"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214398848" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214398848">(Oct 24 2020 at 00:05)</a>:</h4>
<p>Yeah, I get that.  But I believe the original E language had some crypto capabilities built into it.</p>



<a name="214398916"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214398916" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214398916">(Oct 24 2020 at 00:06)</a>:</h4>
<p>There is some research into using handles across networks.</p>



<a name="214398918"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214398918" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214398918">(Oct 24 2020 at 00:06)</a>:</h4>
<p>And there are some researchers who would like to reduce the security of a lot of systems down to cryptographic primitives.</p>



<a name="214398922"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214398922" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214398922">(Oct 24 2020 at 00:06)</a>:</h4>
<p>But out of scope, clearly.</p>



<a name="214399030"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214399030" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214399030">(Oct 24 2020 at 00:09)</a>:</h4>
<p>The key property of handles is that you can't "forge" them, or obtain them without being explicitly given them. Within a single host, that's straightforward, but if you want to pass a handle to another host on the network, and they might pass it on to someone else, how do you ensure that noone can forge such a handle?</p>



<a name="214399180"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214399180" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214399180">(Oct 24 2020 at 00:12)</a>:</h4>
<p>I don't have links handy, but there has been research along those lines</p>



<a name="214399200"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214399200" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214399200">(Oct 24 2020 at 00:13)</a>:</h4>
<p>Yeah.</p>



<a name="214399257"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214399257" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214399257">(Oct 24 2020 at 00:14)</a>:</h4>
<p>The only comprehensive survey of capabilities I've seen are by the CHERI people, and they have formal models tying their capabilities to memory tagged hardware.  I'll go ask them about alternative modes of enforcement.</p>



<a name="214399260"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214399260" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214399260">(Oct 24 2020 at 00:14)</a>:</h4>
<p>Okay, thanks dan!</p>



<a name="214399268"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214399268" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214399268">(Oct 24 2020 at 00:15)</a>:</h4>
<p>yw!</p>



<a name="214399958"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214399958" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214399958">(Oct 24 2020 at 00:30)</a>:</h4>
<p>Oh, Dan, it's not O(N^filename) runtime.</p>



<a name="214399959"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214399959" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214399959">(Oct 24 2020 at 00:30)</a>:</h4>
<p>It's O(log files)</p>



<a name="214399974"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214399974" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214399974">(Oct 24 2020 at 00:31)</a>:</h4>
<p>As you just get a list of all files in a directory and convert their names to the canonical casefolded name.</p>



<a name="214399978"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214399978" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214399978">(Oct 24 2020 at 00:31)</a>:</h4>
<p>And do a compare.</p>



<a name="214400168"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214400168" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214400168">(Oct 24 2020 at 00:34)</a>:</h4>
<p>You would only get exponential behavior if someone created a lot of directories with lots of cases, such as /foo/bar/baz/..., /Foo/bar/baz/..., /FOo/bar/baz.</p>



<a name="214400260"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214400260" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214400260">(Oct 24 2020 at 00:36)</a>:</h4>
<p>Even then, if your goal is to create a lint, you would could just error when there are no exact case-sensitive matches but multiple case insensitive matches.</p>



<a name="214794957"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214794957" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214794957">(Oct 28 2020 at 04:16)</a>:</h4>
<p>I am mildly perplexed by "primarily case insensitive future" because Mac and Windows both introduced the ability to make their file systems case sensitive, and I don't think it's any less troublesome going from case insensitive to case sensitive here.</p>



<a name="214902513"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214902513" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214902513">(Oct 28 2020 at 21:54)</a>:</h4>
<p><span class="user-mention" data-user-id="357097">@indolering</span> If I need to create N files (suppose I'm unpacking an archive, compiling lots of source files to object files, etc.), and each time I create a file I have to scan the directory to see if there's a file with a case-folding-equivalent name, it goes O(N^2) in the number of files I'm creating</p>



<a name="214904700"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214904700" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214904700">(Oct 28 2020 at 22:19)</a>:</h4>
<p><span class="user-mention" data-user-id="356464">@Jubilee</span> My working ssumption is that WASI will end up saying that host fileystem directories can be either case-sensitive or insensitive, and we just expose that to applications as-is.</p>



<a name="214904743"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214904743" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214904743">(Oct 28 2020 at 22:19)</a>:</h4>
<p>Applications will just need to avoid depending on either case sensitivity or case insensitivity if they want to be portable.</p>



<a name="214905007"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/214905007" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#214905007">(Oct 28 2020 at 22:22)</a>:</h4>
<p>There may be some debugging facilities we can add to help applications catch mistakes, and I think the observation above is, we shouldn't make those features mandatory, because if filesystems do end up converging on case-insensitive, we don't want to be stuck with those debugging features forever.</p>



<a name="215156755"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/215156755" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#215156755">(Oct 30 2020 at 22:11)</a>:</h4>
<p>Mmm, that's reasonable I guess?! I will concede I myself genuinely don't see a reason that file systems should <em>be</em> case insensitive from a data perspective, as it makes it possible to trust an address that is not bit-equal to another address is in fact not the same address (modulo some canonicalization), and user-space can support case-insensitive comparisons where it makes sense just fine. But here I am extending more of a "would-write-an-FS perspective" than a "would-like-to-solve-platform-compatibility-issues" perspective, and so venturing a bit further afield from The Point. Aside from "everyone should clearly adopt my perspective and then there would be no more compatibility issues" which I recognize is in actuality a non-starter. :^)</p>



<a name="215265399"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/215265399" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#215265399">(Nov 01 2020 at 22:21)</a>:</h4>
<p><span class="user-mention" data-user-id="356464">@Jubilee</span> 99% of users on an OS with a filesystem that is case-insensitive by default.</p>



<a name="215265781"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/215265781" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#215265781">(Nov 01 2020 at 22:31)</a>:</h4>
<p><span class="user-mention" data-user-id="254083">@Dan Gohman</span>  I think there is a miscommunication WRT operating modes and error handling.</p>



<a name="215265838"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/215265838" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#215265838">(Nov 01 2020 at 22:32)</a>:</h4>
<p>I heard somewhere that, among developers, it's much more evenly split between Linux, Windows, and macOS (about 1/3 for each). Nearly all Linux OSes are case-sensitive by default.</p>



<a name="215265996"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/215265996" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#215265996">(Nov 01 2020 at 22:36)</a>:</h4>
<p><span class="user-mention" data-user-id="315881">@Jacob Lifshay</span> True, lots of server-side stuff is going to run on case-sensitive filesystems by default.  That being said, at least on Stack Overflow, Linux devs are out-numbered 3:1.</p>



<a name="215265998"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/215265998" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#215265998">(Nov 01 2020 at 22:36)</a>:</h4>
<p><a href="https://insights.stackoverflow.com/survey/2020#technology-developers-primary-operating-systems">https://insights.stackoverflow.com/survey/2020#technology-developers-primary-operating-systems</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://insights.stackoverflow.com/survey/2020#technology-developers-primary-operating-systems" style="background-image: url(https://cdn.sstatic.net/insights/Img/Survey/2020/devsurvey2020-og.png?v=b8ce57e10a52)"></a><div class="data-container"><div class="message_embed_title"><a href="https://insights.stackoverflow.com/survey/2020#technology-developers-primary-operating-systems" title="Stack Overflow Developer Survey 2020">Stack Overflow Developer Survey 2020</a></div><div class="message_embed_description">Nearly 65,000 took this comprehensive, annual survey of people who code. Demographics. Most loved, dreaded and wanted technologies. Salary and careers.</div></div></div>



<a name="215266016"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/215266016" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#215266016">(Nov 01 2020 at 22:37)</a>:</h4>
<p>I also think that for all of the wailing and gnashing of teeth, distros will eventually switch to case-insensitive by default.  At least for home directories.</p>



<a name="215266029"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/215266029" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#215266029">(Nov 01 2020 at 22:38)</a>:</h4>
<p>That being said, I believe that virtually every filesystem allows for setting this behavior on a per-directory basis.</p>



<a name="215266205"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/215266205" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#215266205">(Nov 01 2020 at 22:41)</a>:</h4>
<p>My main concern was that the tickets I read were suggesting fail fast on case-insensitive filesystems.  That's a mistake.</p>



<a name="215266376"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/215266376" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#215266376">(Nov 01 2020 at 22:45)</a>:</h4>
<p><span class="user-mention" data-user-id="356464">@Jubilee</span> The web is case-insensitive: a domain name is basically a pointer to a server and paths are basically case-insensitive lookups on a filesystem.</p>



<a name="215266436"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/215266436" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#215266436">(Nov 01 2020 at 22:47)</a>:</h4>
<p>From a security and reproducibility perspective, you want to minimize the impedance mismatch between the client and the host.</p>



<a name="215266624"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/215266624" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#215266624">(Nov 01 2020 at 22:51)</a>:</h4>
<p>From a data-perspective, we definitely want valid UTF-8 right?</p>



<a name="215266691"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/215266691" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#215266691">(Nov 01 2020 at 22:52)</a>:</h4>
<p><span class="user-mention" data-user-id="356464">@Jubilee</span> Sorry, I'll stop hammering you.  I'm writing another ticket right now and my thought streams are crossing :P</p>



<a name="215266703"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/215266703" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#215266703">(Nov 01 2020 at 22:53)</a>:</h4>
<p><a href="/user_uploads/15107/WDm1QElom5K-QBWA0qwateZZ/image.png">image.png</a> &lt;img src="<a href="http://alinken.people.ua.edu/uploads/8/7/9/2/87929690/published/ghostbusters.jpg?1501582414">http://alinken.people.ua.edu/uploads/8/7/9/2/87929690/published/ghostbusters.jpg?1501582414</a>" alt="Picture"/&gt;</p>
<div class="message_inline_image"><a href="/user_uploads/15107/WDm1QElom5K-QBWA0qwateZZ/image.png" title="image.png"><img src="/user_uploads/15107/WDm1QElom5K-QBWA0qwateZZ/image.png"></a></div><div class="message_inline_image"><a href="http://alinken.people.ua.edu/uploads/8/7/9/2/87929690/published/ghostbusters.jpg?1501582414"><img src="https://uploads.zulipusercontent.net/3d237d71806971dabb0a7c62a683b9a1bd5d2941/687474703a2f2f616c696e6b656e2e70656f706c652e75612e6564752f75706c6f6164732f382f372f392f322f38373932393639302f7075626c69736865642f67686f7374627573746572732e6a70673f31353031353832343134"></a></div>



<a name="215266991"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/215266991" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#215266991">(Nov 01 2020 at 23:01)</a>:</h4>
<p><span class="user-mention" data-user-id="357097">@indolering</span> That is not true anymore, and has not been for a long time.<br>
iOS and Android OS use primarily case sensitive FS while supporting operations on case-insensitive FS for back-compat and with many applications exposing case-insensitive functionality.<br>
i.e. my preferred scheme.<br>
As far as the web goes, not all servers implement those accesses as case insensitive, and of those which do, they commonly involve a redirect to a canonical version. It took... 3 tries? to find a case-sensitive access that fails without a redirect.</p>



<a name="215267057"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/215267057" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#215267057">(Nov 01 2020 at 23:02)</a>:</h4>
<p>( the first hardly counts, since I was just doublechecking against my memory of domain names being case insensitive. )</p>



<a name="215267228"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/215267228" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#215267228">(Nov 01 2020 at 23:07)</a>:</h4>
<p><span class="user-mention silent" data-user-id="357097">indolering</span> <a href="#narrow/stream/206238-general/topic/Determinism.2FReproducibility/near/215266376">said</a>:</p>
<blockquote>
<p>The web is case-insensitive: a domain name is basically a pointer to a server and paths are basically case-insensitive lookups on a filesystem.</p>
</blockquote>
<p>DNS is case insensitive (but only for ASCII I think -- IIRC punycode doesn't do any case folding before encoding). Most servers run Linux with case-sensitive filesystems, so I'd expect the other parts of a url to be usually case sensitive.</p>



<a name="215267619"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/215267619" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#215267619">(Nov 01 2020 at 23:16)</a>:</h4>
<p>From a security perspective, the fact that I can write the link <a href="https://googIe.com">https://googIe.com</a> and it does not go to the same place as <a href="https://google.com">https://google.com</a> is a source of endless phishing tech, so no, you may consider me suitably skeptical that even exposing case insensitivity to a user serves their security that much.</p>
<p>And from a data perspective an address can be raw bytes for all I care (and still must, because not all OS enforce UTF-8 path validity!). File systems should cast their eye to living a life longer than an encoding scheme. It's, again, userspace's job to make it intelligible in my opinion. Sometimes an impedance mismatch is simply why we have software.</p>



<a name="215270468"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/215270468" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#215270468">(Nov 02 2020 at 00:36)</a>:</h4>
<p><span class="user-mention" data-user-id="356464">@Jubilee</span> FWIW, WASI-filesystem is expected to use UTF-8 paths. The "filenames are just bytes" strategy was practical in its day, but with UTF-8 the practicalities line up very differently.</p>



<a name="215270472"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/215270472" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#215270472">(Nov 02 2020 at 00:36)</a>:</h4>
<p>I stand corrected: path handling is case preserving and server/filesystem dependent, but Linux of course defaults to case sensitive matching.  I guess I was in DNS land for too long!</p>
<ul>
<li>DNS labels are case-insensitive, even i18n ones (punycode case-folds everything).</li>
<li>Android sdcard access has historically provided case-insensitive lookups, but case-insensitive FS semantics are now enforced using F2FS.  The stock file manager on my Pixel defaults to case-insensitive behavior, even for internal storage.</li>
<li>Google Drive is case sensitive.</li>
<li>iOS is case sensitive, but both iCloud and APFS on OS X default to case insensitive semantics.  I do not have an iOS device to test whether the filesystem manager attempts to enforce case-insensitive behavior (as I suspect my Files app is doing).</li>
</ul>



<a name="215270889"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/215270889" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#215270889">(Nov 02 2020 at 00:48)</a>:</h4>
<p>I mean, from the perspective of usability (carrying out end-user intent) and enforcing a single namespace in the filesystem, you want the lowest common denominator normalization (NFKD casefold) so that an attacker can't do something like store a ligature ℀ which some server or client could NFKD into a filename path.</p>



<a name="215270972"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/215270972" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#215270972">(Nov 02 2020 at 00:50)</a>:</h4>
<p>And the only way to be <em>sure</em> you don't accidentally allow two unicode strings that normalize into some other unicode string is at the filesystem level.</p>



<a name="215270998"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/215270998" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#215270998">(Nov 02 2020 at 00:51)</a>:</h4>
<p>But yeah, I also don't want some firewall allowlist filter to be bypassed because filename lookups are case/normalization insensitive.</p>



<a name="215272395"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/215272395" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#215272395">(Nov 02 2020 at 01:29)</a>:</h4>
<p>Oh yes, I expect WASI to use UTF-8 because that is more sensible for WASI's purposes than letting someone decide the next UTF-16 is a good idea.</p>



<a name="215272993"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/215272993" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#215272993">(Nov 02 2020 at 01:46)</a>:</h4>
<p>But that already involves hitting a translation layer between existing systems and WASI, from my perspective, and at that point where the translation layer exists is subject to some negotiation (since it is, as it were, already a negotiation). But it's slightly more audacious to reformat a user's hard drive than to replace the user's kernel, which is what drives my sentiments regarding where such canonicalization "belongs".</p>



<a name="215274126"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/215274126" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#215274126">(Nov 02 2020 at 02:19)</a>:</h4>
<p>I like how you put it -- a "negotiation" describes it well.</p>



<a name="215275123"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/215275123" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#215275123">(Nov 02 2020 at 02:49)</a>:</h4>
<p>Agreed!  Determinism can only be enforced if WASI can assume exclusive control at the FS level (akin to WINE setting case-insensitive behavior on <code>~/.wine/</code>).</p>



<a name="215275412"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/215275412" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#215275412">(Nov 02 2020 at 02:57)</a>:</h4>
<p>And a runtime can chose a fast/sloppy implementation that relies on whatever the filesystem does, which should work with 95% of real-world filenames.  If you want a truly deterministic filesystem, then you probably want to do something with FUSE or VFS (I suspect some Unicode compression/transliteration scheme could fit 99% of real-world filenames into the Posix portable filename subset, which is available on virtually every platform).</p>



<a name="215515134"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/215515134" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#215515134">(Nov 03 2020 at 22:00)</a>:</h4>
<p>Just checked a iPod touch and the filesystem UI won't let me create two folders that differ in case.  So <em>for users</em> iOS is case-insensitive.  As iCloud enforces case-insensitivity, I would be surprised if Apple doesn't switch iOS to case-insensitive behavior as well.</p>



<a name="215517485"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/215517485" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#215517485">(Nov 03 2020 at 22:26)</a>:</h4>
<p>But maybe the API should error out by default if the filename isn't an exact match, just as long as WASI can adapt to the underlying filestore in an ergonomic fashion.</p>



<a name="215521679"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/215521679" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#215521679">(Nov 03 2020 at 22:58)</a>:</h4>
<p>If we have exclusive access to a directory (akin to Android, iOS, Flatpak, etc) then I would default to the lowest-common-denominator, so that everything "just works" regardless of the case or normalization conventions of the FS.  But I need to do a review of all the issues with IDNA, Stringprep, and the i18n filesystem RFCs first.</p>



<a name="215635234"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/215635234" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#215635234">(Nov 04 2020 at 20:12)</a>:</h4>
<p>Does anyone have experience with/thoughts on <a href="https://tools.ietf.org/html/rfc8264#section-5.2.4">PRECIS</a>?  It's the IETF followup to the Stringprep algorithm.</p>



<a name="215657491"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/215657491" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#215657491">(Nov 05 2020 at 00:11)</a>:</h4>
<p>Do you know if there are any filesystems which do case-sensitive lookups, but still prevent creating files that differ only in case?</p>



<a name="215663334"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/215663334" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#215663334">(Nov 05 2020 at 01:49)</a>:</h4>
<p>Not off the top of my head.  However, if a file has a non-normalized name, Linux falls back to using the bytestring as an opaque identifier.</p>



<a name="215663446"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/215663446" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#215663446">(Nov 05 2020 at 01:51)</a>:</h4>
<p>FWIW, I am planning on documenting this behavior (with functional testing) in a git repo at some point.</p>



<a name="215922109"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/Determinism/Reproducibility/near/215922109" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> indolering <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/Determinism.2FReproducibility.html#215922109">(Nov 07 2020 at 00:45)</a>:</h4>
<p>I need to nail down the behavior of how filenames are handled across platforms and  I'm at the point where I need to start testing.  I don't know if this work will be upstreamed, but is there an infrastructure preference WRT functional testing and virtual machines?</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>