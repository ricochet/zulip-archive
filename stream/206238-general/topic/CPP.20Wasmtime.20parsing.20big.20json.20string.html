<html>
<head><meta charset="utf-8"><title>CPP Wasmtime parsing big json string · general · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/index.html">general</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/CPP.20Wasmtime.20parsing.20big.20json.20string.html">CPP Wasmtime parsing big json string</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="386419843"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/CPP%20Wasmtime%20parsing%20big%20json%20string/near/386419843" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cdvl <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/CPP.20Wasmtime.20parsing.20big.20json.20string.html#386419843">(Aug 21 2023 at 15:26)</a>:</h4>
<p>Hi,</p>
<p>I have a cpp wasmtime that parse a jsonstring. My problem is that my cpp code runs well on both small and large json string input but fails with wasm on large string only. No error is printed. I suppose a memory limitation but I don't know how to change it. Could you help me please?</p>



<a name="386426487"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/CPP%20Wasmtime%20parsing%20big%20json%20string/near/386426487" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/CPP.20Wasmtime.20parsing.20big.20json.20string.html#386426487">(Aug 21 2023 at 15:52)</a>:</h4>
<p>Is it possible to share a wasm module that reproduces this behavior? For example are you running the <code>wasmtime</code> CLI? Are you using the Rust embedding API? Is the guest wasm module in C++? (e.g. details like this can help folks dig in, but a reproduction would be most useful)</p>



<a name="386546429"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/CPP%20Wasmtime%20parsing%20big%20json%20string/near/386546429" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cdvl <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/CPP.20Wasmtime.20parsing.20big.20json.20string.html#386546429">(Aug 22 2023 at 07:26)</a>:</h4>
<p>I'm running the .wasm file with Rust API but I tried with wasmtime CLI first. Both work on small json but fail on large inputs. It's neither due to my C++ code nor the big json file, because when I build and run the C++ code, everything is fine. The problem appears when I switch to wasm.  </p>
<p>I will ask if it possible to share a wasm module.</p>



<a name="386555235"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/CPP%20Wasmtime%20parsing%20big%20json%20string/near/386555235" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cdvl <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/CPP.20Wasmtime.20parsing.20big.20json.20string.html#386555235">(Aug 22 2023 at 08:24)</a>:</h4>
<p>Here the example :<br>
<a href="/user_uploads/15107/7yEe2LUJxRFbCdNXTXh0FO3f/json-parsing.zip">json-parsing.zip</a></p>
<p>You can run the cpp code on big json file via "make cpp".<br>
I tried two different json lib in c++ (nlohmann and simdjson). You can test them with:</p>
<ul>
<li>make nlohmann-small</li>
<li>make nlohmann-big</li>
<li>make  simdjson-small</li>
<li>make simdjson-big</li>
</ul>



<a name="386600315"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/CPP%20Wasmtime%20parsing%20big%20json%20string/near/386600315" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cdvl <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/CPP.20Wasmtime.20parsing.20big.20json.20string.html#386600315">(Aug 22 2023 at 12:47)</a>:</h4>
<p>It's well a memory limitation. I just write a c++ code with a vector growing  over iterations and the same thing occurred. What are wasm memory limitation? How to increase these limitations?</p>



<a name="386619166"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/CPP%20Wasmtime%20parsing%20big%20json%20string/near/386619166" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/CPP.20Wasmtime.20parsing.20big.20json.20string.html#386619166">(Aug 22 2023 at 14:12)</a>:</h4>
<p>Can you share the actual wasm module you're running? I don't have emscripten installed myself so I compiled the example with wasi-sdk after some modifications and it works fine for the small/big examples you provided. One thing you can try is passing <code>---trap-on-grow-failure</code> to the CLI which will cause a trap to happen on OOM rather than returning -1 which can turn a failure that may be ignored into a loud failure</p>



<a name="386623928"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/CPP%20Wasmtime%20parsing%20big%20json%20string/near/386623928" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cdvl <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/CPP.20Wasmtime.20parsing.20big.20json.20string.html#386623928">(Aug 22 2023 at 14:33)</a>:</h4>
<p><a href="/user_uploads/15107/FsK0kWWK8ZShUaxYmAJrt-A-/test.wasm">test.wasm</a></p>
<p>--trap-on-grow-failure does not change anything. I will try with wasi-sdk! What modification did you make?</p>



<a name="386631976"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/CPP%20Wasmtime%20parsing%20big%20json%20string/near/386631976" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/CPP.20Wasmtime.20parsing.20big.20json.20string.html#386631976">(Aug 22 2023 at 15:07)</a>:</h4>
<p>I changed a few things like removing usage of <code>&lt;filesystem&gt;</code> in <code>json.hpp</code> and removing some <code>try</code>/<code>catch</code> and otherwise just fixing a few compile errors, mostly differences in runtimes I think between emscripten/wasi-sdk</p>



<a name="386632785"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/CPP%20Wasmtime%20parsing%20big%20json%20string/near/386632785" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/CPP.20Wasmtime.20parsing.20big.20json.20string.html#386632785">(Aug 22 2023 at 15:10)</a>:</h4>
<p>Hm running <code>wasmtime run ./test.wasm &lt; input</code> doesn't seem to do anything with any input with the module you gave me. Could you perhaps open an issue on Wasmtime with detailed steps/reproduction/outputs/etc to help further debug this?</p>



<a name="386633155"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/CPP%20Wasmtime%20parsing%20big%20json%20string/near/386633155" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cdvl <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/CPP.20Wasmtime.20parsing.20big.20json.20string.html#386633155">(Aug 22 2023 at 15:12)</a>:</h4>
<p>I tried to use wasi-sdk but it fails to compile.</p>
<p>export WASI_SDK_PATH=/home/celine/Téléchargements/wasi-sdk-20.0<br>
${WASI_SDK_PATH}/bin/clang++ --sysroot=wasi-sdk-20.0/share/wasi-sysroot -o test.wasm -Wl,--export-all -Wl,--no-entry -Iinclude/ -isystem /usr/include/ -Wl,--export=test_nlohmann src/main.cpp -v</p>
<p>I get the "fatal error: 'iostream' file not found". I don't understand because I include the system headers too.</p>



<a name="386633395"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/CPP%20Wasmtime%20parsing%20big%20json%20string/near/386633395" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/CPP.20Wasmtime.20parsing.20big.20json.20string.html#386633395">(Aug 22 2023 at 15:13)</a>:</h4>
<p><code>iostream</code> is a C++ header; it's in $sysroot/include/c++/v1</p>



<a name="386633875"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/CPP%20Wasmtime%20parsing%20big%20json%20string/near/386633875" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cdvl <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/CPP.20Wasmtime.20parsing.20big.20json.20string.html#386633875">(Aug 22 2023 at 15:15)</a>:</h4>
<p>You need to specify the function name to invoke <br>
wasmtime test.wasm --invoke test_simdjson &lt; input_small.json</p>



<a name="386634611"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/CPP%20Wasmtime%20parsing%20big%20json%20string/near/386634611" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/CPP.20Wasmtime.20parsing.20big.20json.20string.html#386634611">(Aug 22 2023 at 15:18)</a>:</h4>
<p>ok I can reproduce the failure, I see that something is calling an exit explicitly with a 1 argument, so something is explicitly exiting</p>



<a name="386634710"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/CPP%20Wasmtime%20parsing%20big%20json%20string/near/386634710" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/CPP.20Wasmtime.20parsing.20big.20json.20string.html#386634710">(Aug 22 2023 at 15:19)</a>:</h4>
<p>I didn't pass <code>--sysroot</code> to wasi-sdk myself, I let it find it itself</p>



<a name="386635194"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/CPP%20Wasmtime%20parsing%20big%20json%20string/near/386635194" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/CPP.20Wasmtime.20parsing.20big.20json.20string.html#386635194">(Aug 22 2023 at 15:21)</a>:</h4>
<p>can you build the original wasm file with debug information with emscripten?</p>



<a name="386635240"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/CPP%20Wasmtime%20parsing%20big%20json%20string/near/386635240" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/CPP.20Wasmtime.20parsing.20big.20json.20string.html#386635240">(Aug 22 2023 at 15:21)</a>:</h4>
<p>modifying Wasmtime I can get:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Caused</span><span class="w"> </span><span class="n">by</span>:
    <span class="mi">0</span>: <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">invoke</span><span class="w"> </span><span class="err">`</span><span class="n">test_simdjson</span><span class="err">`</span>
<span class="w">    </span><span class="mi">1</span>: <span class="nc">error</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="n">executing</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">wasm</span><span class="w"> </span><span class="n">backtrace</span>:
           <span class="mi">0</span>: <span class="mh">0x5acee</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;!&lt;</span><span class="n">wasm</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="mi">2012</span><span class="o">&gt;</span>
<span class="w">           </span><span class="mi">1</span>: <span class="mh">0x5acbb</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;!&lt;</span><span class="n">wasm</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="mi">2005</span><span class="o">&gt;</span>
<span class="w">           </span><span class="mi">2</span>: <span class="mh">0x7af39</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;!&lt;</span><span class="n">wasm</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="mi">3327</span><span class="o">&gt;</span>
<span class="w">           </span><span class="mi">3</span>: <span class="mh">0x7af4d</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;!&lt;</span><span class="n">wasm</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="mi">3329</span><span class="o">&gt;</span>
<span class="w">           </span><span class="mi">4</span>: <span class="mh">0x7af55</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;!&lt;</span><span class="n">wasm</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="mi">3330</span><span class="o">&gt;</span>
<span class="w">           </span><span class="mi">5</span>: <span class="mh">0x1591e</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;!&lt;</span><span class="n">wasm</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="mi">295</span><span class="o">&gt;</span>
<span class="w">           </span><span class="mi">6</span>: <span class="mh">0x152d9</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;!&lt;</span><span class="n">wasm</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="mi">284</span><span class="o">&gt;</span>
<span class="w">           </span><span class="mi">7</span>: <span class="mh">0x14f5b</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;!&lt;</span><span class="n">wasm</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="mi">283</span><span class="o">&gt;</span>
<span class="w">           </span><span class="mi">8</span>: <span class="mh">0x14e98</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;!&lt;</span><span class="n">wasm</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="mi">281</span><span class="o">&gt;</span>
<span class="w">           </span><span class="mi">9</span>: <span class="mh">0x11722</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;!&lt;</span><span class="n">wasm</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="mi">166</span><span class="o">&gt;</span>
<span class="w">          </span><span class="mi">10</span>: <span class="mh">0x11213</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;!&lt;</span><span class="n">wasm</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="mi">154</span><span class="o">&gt;</span>
<span class="w">          </span><span class="mi">11</span>: <span class="mh">0x10f02</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;!&lt;</span><span class="n">wasm</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="mi">151</span><span class="o">&gt;</span>
<span class="w">    </span><span class="mi">2</span>: <span class="nc">Exited</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="n">exit</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="mi">1</span>
</code></pre></div>



<a name="386635260"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/CPP%20Wasmtime%20parsing%20big%20json%20string/near/386635260" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/CPP.20Wasmtime.20parsing.20big.20json.20string.html#386635260">(Aug 22 2023 at 15:21)</a>:</h4>
<p>but that's not too helpful without debug information</p>



<a name="386636502"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/CPP%20Wasmtime%20parsing%20big%20json%20string/near/386636502" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cdvl <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/CPP.20Wasmtime.20parsing.20big.20json.20string.html#386636502">(Aug 22 2023 at 15:27)</a>:</h4>
<p><a href="/user_uploads/15107/V7LcALzMYyfjLxFBbRcSijxj/test.wasm">test.wasm</a> Here the wasm compiled with the -g option</p>



<a name="386638232"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/CPP%20Wasmtime%20parsing%20big%20json%20string/near/386638232" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cdvl <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/CPP.20Wasmtime.20parsing.20big.20json.20string.html#386638232">(Aug 22 2023 at 15:37)</a>:</h4>
<p>I recompiled the example keeping only the simdjson lib (removing nlohmann one) with wasi-sdk. Same problem: when I run it with wasmtime it works on small json file but failed on big file.</p>



<a name="386639689"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/CPP%20Wasmtime%20parsing%20big%20json%20string/near/386639689" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/CPP.20Wasmtime.20parsing.20big.20json.20string.html#386639689">(Aug 22 2023 at 15:45)</a>:</h4>
<p>ah yeah this looks like OOM?</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">stdin</span><span class="w"> </span><span class="n">length</span>: <span class="mi">3544203</span>
<span class="n">Try</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">parse3544203</span>
<span class="n">Error</span>: <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="err">`</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">alex</span><span class="o">/</span><span class="n">Downloads</span><span class="o">/</span><span class="n">test</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">wasm</span><span class="err">`</span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span>:
    <span class="mi">0</span>: <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">invoke</span><span class="w"> </span><span class="err">`</span><span class="n">test_simdjson</span><span class="err">`</span>
<span class="w">    </span><span class="mi">1</span>: <span class="nc">error</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="n">executing</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">wasm</span><span class="w"> </span><span class="n">backtrace</span>:
           <span class="mi">0</span>: <span class="mh">0x6dfb2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">_Exit</span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">emscripten</span><span class="o">-</span><span class="n">buVz5q</span><span class="o">/</span><span class="n">emscripten</span><span class="o">-</span><span class="mf">3.1.5</span><span class="o">~</span><span class="n">dfsg</span><span class="o">/</span><span class="n">system</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">libc</span><span class="o">/</span><span class="n">musl</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">exit</span><span class="o">/</span><span class="n">_Exit</span><span class="p">.</span><span class="n">c</span>:<span class="mi">7</span>:<span class="mi">2</span>
<span class="w">           </span><span class="mi">1</span>: <span class="mh">0x6df7f</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">abort</span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">emscripten</span><span class="o">-</span><span class="n">buVz5q</span><span class="o">/</span><span class="n">emscripten</span><span class="o">-</span><span class="mf">3.1.5</span><span class="o">~</span><span class="n">dfsg</span><span class="o">/</span><span class="n">system</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">standalone</span><span class="o">/</span><span class="n">standalone</span><span class="p">.</span><span class="n">c</span>:<span class="mi">33</span>:<span class="mi">3</span>
<span class="w">           </span><span class="mi">2</span>: <span class="mh">0x8e789</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">operator</span><span class="w"> </span><span class="n">new</span><span class="p">(</span><span class="n">unsigned</span><span class="w"> </span><span class="n">long</span><span class="p">)</span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">emscripten</span><span class="o">-</span><span class="n">buVz5q</span><span class="o">/</span><span class="n">emscripten</span><span class="o">-</span><span class="mf">3.1.5</span><span class="o">~</span><span class="n">dfsg</span><span class="o">/</span><span class="n">system</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">libcxx</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">new</span><span class="p">.</span><span class="n">cpp</span>:<span class="mi">84</span>:<span class="mi">13</span>
<span class="w">           </span><span class="mi">3</span>: <span class="mh">0x8e79d</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">operator</span><span class="w"> </span><span class="n">new</span><span class="p">[](</span><span class="n">unsigned</span><span class="w"> </span><span class="n">long</span><span class="p">)</span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">emscripten</span><span class="o">-</span><span class="n">buVz5q</span><span class="o">/</span><span class="n">emscripten</span><span class="o">-</span><span class="mf">3.1.5</span><span class="o">~</span><span class="n">dfsg</span><span class="o">/</span><span class="n">system</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">libcxx</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">new</span><span class="p">.</span><span class="n">cpp</span>:<span class="mi">116</span>:<span class="mi">12</span>
<span class="w">           </span><span class="mi">4</span>: <span class="mh">0x8e7a5</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">operator</span><span class="w"> </span><span class="n">new</span><span class="p">[](</span><span class="n">unsigned</span><span class="w"> </span><span class="n">long</span><span class="p">,</span><span class="w"> </span><span class="n">std</span>::<span class="n">nothrow_t</span><span class="w"> </span><span class="k">const</span><span class="o">&amp;</span><span class="p">)</span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">emscripten</span><span class="o">-</span><span class="n">buVz5q</span><span class="o">/</span><span class="n">emscripten</span><span class="o">-</span><span class="mf">3.1.5</span><span class="o">~</span><span class="n">dfsg</span><span class="o">/</span><span class="n">system</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">libcxx</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">new</span><span class="p">.</span><span class="n">cpp</span>:<span class="mi">128</span>:<span class="mi">13</span>
<span class="w">           </span><span class="mi">5</span>: <span class="mh">0x1a134</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">simdjson</span>::<span class="n">dom</span>::<span class="n">document</span>::<span class="n">allocate</span><span class="p">(</span><span class="n">unsigned</span><span class="w"> </span><span class="n">long</span><span class="p">)</span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">celine</span><span class="o">/</span><span class="n">Téléchargements</span><span class="o">/</span><span class="n">json</span><span class="o">-</span><span class="n">parsing</span><span class="o">/</span><span class="n">include</span><span class="o">/</span><span class="n">simdjson</span><span class="p">.</span><span class="n">h</span>:<span class="mi">8430</span>:<span class="mi">21</span>
<span class="w">           </span><span class="mi">6</span>: <span class="mh">0x19988</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">simdjson</span>::<span class="n">dom</span>::<span class="n">parser</span>::<span class="n">ensure_capacity</span><span class="p">(</span><span class="n">simdjson</span>::<span class="n">dom</span>::<span class="n">document</span><span class="o">&amp;</span><span class="p">,</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="n">long</span><span class="p">)</span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">celine</span><span class="o">/</span><span class="n">Téléchargements</span><span class="o">/</span><span class="n">json</span><span class="o">-</span><span class="n">parsing</span><span class="o">/</span><span class="n">include</span><span class="o">/</span><span class="n">simdjson</span><span class="p">.</span><span class="n">h</span>:<span class="mi">7627</span>:<span class="mi">87</span>
<span class="w">           </span><span class="mi">7</span>: <span class="mh">0x19570</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">simdjson</span>::<span class="n">dom</span>::<span class="n">parser</span>::<span class="n">parse_into_document</span><span class="p">(</span><span class="n">simdjson</span>::<span class="n">dom</span>::<span class="n">document</span><span class="o">&amp;</span><span class="p">,</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="n">long</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">celine</span><span class="o">/</span><span class="n">Téléchargements</span><span class="o">/</span><span class="n">json</span><span class="o">-</span><span class="n">parsing</span><span class="o">/</span><span class="n">include</span><span class="o">/</span><span class="n">simdjson</span><span class="p">.</span><span class="n">h</span>:<span class="mi">7514</span>:<span class="mi">23</span>
<span class="w">           </span><span class="mi">8</span>: <span class="mh">0x1941f</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">simdjson</span>::<span class="n">dom</span>::<span class="n">parser</span>::<span class="n">parse</span><span class="p">(</span><span class="n">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="n">long</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">celine</span><span class="o">/</span><span class="n">Téléchargements</span><span class="o">/</span><span class="n">json</span><span class="o">-</span><span class="n">parsing</span><span class="o">/</span><span class="n">include</span><span class="o">/</span><span class="n">simdjson</span><span class="p">.</span><span class="n">h</span>:<span class="mi">7546</span>:<span class="mi">10</span>
<span class="w">           </span><span class="mi">9</span>: <span class="mh">0x150df</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">simdjson</span>::<span class="n">dom</span>::<span class="n">parser</span>::<span class="n">parse</span><span class="p">(</span><span class="kt">char</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="n">long</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">celine</span><span class="o">/</span><span class="n">Téléchargements</span><span class="o">/</span><span class="n">json</span><span class="o">-</span><span class="n">parsing</span><span class="o">/</span><span class="n">include</span><span class="o">/</span><span class="n">simdjson</span><span class="p">.</span><span class="n">h</span>:<span class="mi">7550</span>:<span class="mi">10</span>
<span class="w">          </span><span class="mi">10</span>: <span class="mh">0x14ad4</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">simdjson</span>::<span class="n">dom</span>::<span class="n">parser</span>::<span class="n">parse</span><span class="p">(</span><span class="n">std</span>::<span class="n">__2</span>::<span class="n">basic_string</span><span class="o">&lt;</span><span class="kt">char</span><span class="p">,</span><span class="w"> </span><span class="n">std</span>::<span class="n">__2</span>::<span class="n">char_traits</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">std</span>::<span class="n">__2</span>::<span class="n">allocator</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="k">const</span><span class="o">&amp;</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">celine</span><span class="o">/</span><span class="n">Téléchargements</span><span class="o">/</span><span class="n">json</span><span class="o">-</span><span class="n">parsing</span><span class="o">/</span><span class="n">include</span><span class="o">/</span><span class="n">simdjson</span><span class="p">.</span><span class="n">h</span>:<span class="mi">7553</span>:<span class="mi">10</span>
<span class="w">          </span><span class="mi">11</span>: <span class="mh">0x1476f</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">test_simdjson</span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">celine</span><span class="o">/</span><span class="n">Téléchargements</span><span class="o">/</span><span class="n">json</span><span class="o">-</span><span class="n">parsing</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">cpp</span>:<span class="mi">46</span>:<span class="mi">45</span>
<span class="w">    </span><span class="mi">2</span>: <span class="nc">Exited</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="n">exit</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="mi">1</span>
</code></pre></div>



<a name="386639721"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/CPP%20Wasmtime%20parsing%20big%20json%20string/near/386639721" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cdvl <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/CPP.20Wasmtime.20parsing.20big.20json.20string.html#386639721">(Aug 22 2023 at 15:45)</a>:</h4>
<p>I think that is a memory limitation from wasm. I added this c++ function:<br>
void stress(){<br>
        std::string jsonString;<br>
        std::getline(std::cin, jsonString);</p>
<div class="codehilite"><pre><span></span><code>    // create a vector growing over iteration
    std::vector&lt;std::string&gt; dynamicVector;
    for (size_t i = 0; i &lt; 100; i++){
        dynamicVector.push_back(jsonString);
        std::cout &lt;&lt; &quot;i &quot; &lt;&lt; i &lt;&lt; &quot; - length: &quot; &lt;&lt; jsonString.length()*(i+1) &lt;&lt; std::endl;
    }
}
</code></pre></div>

<p>The wasm exit with an error 1 after some iteration while cpp program continu.</p>



<a name="386640042"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/CPP%20Wasmtime%20parsing%20big%20json%20string/near/386640042" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cdvl <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/CPP.20Wasmtime.20parsing.20big.20json.20string.html#386640042">(Aug 22 2023 at 15:47)</a>:</h4>
<p><span class="user-mention silent" data-user-id="253994">Alex Crichton</span> <a href="#narrow/stream/206238-general/topic/CPP.20Wasmtime.20parsing.20big.20json.20string/near/386639689">said</a>:</p>
<blockquote>
<p>ah yeah this looks like OOM?</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">stdin</span><span class="w"> </span><span class="n">length</span>: <span class="mi">3544203</span>
<span class="n">Try</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">parse3544203</span>
<span class="n">Error</span>: <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="err">`</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">alex</span><span class="o">/</span><span class="n">Downloads</span><span class="o">/</span><span class="n">test</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">wasm</span><span class="err">`</span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span>:
    <span class="mi">0</span>: <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">invoke</span><span class="w"> </span><span class="err">`</span><span class="n">test_simdjson</span><span class="err">`</span>
<span class="w">    </span><span class="mi">1</span>: <span class="nc">error</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="n">executing</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">wasm</span><span class="w"> </span><span class="n">backtrace</span>:
           <span class="mi">0</span>: <span class="mh">0x6dfb2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">_Exit</span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">emscripten</span><span class="o">-</span><span class="n">buVz5q</span><span class="o">/</span><span class="n">emscripten</span><span class="o">-</span><span class="mf">3.1.5</span><span class="o">~</span><span class="n">dfsg</span><span class="o">/</span><span class="n">system</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">libc</span><span class="o">/</span><span class="n">musl</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">exit</span><span class="o">/</span><span class="n">_Exit</span><span class="p">.</span><span class="n">c</span>:<span class="mi">7</span>:<span class="mi">2</span>
<span class="w">           </span><span class="mi">1</span>: <span class="mh">0x6df7f</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">abort</span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">emscripten</span><span class="o">-</span><span class="n">buVz5q</span><span class="o">/</span><span class="n">emscripten</span><span class="o">-</span><span class="mf">3.1.5</span><span class="o">~</span><span class="n">dfsg</span><span class="o">/</span><span class="n">system</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">standalone</span><span class="o">/</span><span class="n">standalone</span><span class="p">.</span><span class="n">c</span>:<span class="mi">33</span>:<span class="mi">3</span>
<span class="w">           </span><span class="mi">2</span>: <span class="mh">0x8e789</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">operator</span><span class="w"> </span><span class="n">new</span><span class="p">(</span><span class="n">unsigned</span><span class="w"> </span><span class="n">long</span><span class="p">)</span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">emscripten</span><span class="o">-</span><span class="n">buVz5q</span><span class="o">/</span><span class="n">emscripten</span><span class="o">-</span><span class="mf">3.1.5</span><span class="o">~</span><span class="n">dfsg</span><span class="o">/</span><span class="n">system</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">libcxx</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">new</span><span class="p">.</span><span class="n">cpp</span>:<span class="mi">84</span>:<span class="mi">13</span>
<span class="w">           </span><span class="mi">3</span>: <span class="mh">0x8e79d</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">operator</span><span class="w"> </span><span class="n">new</span><span class="p">[](</span><span class="n">unsigned</span><span class="w"> </span><span class="n">long</span><span class="p">)</span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">emscripten</span><span class="o">-</span><span class="n">buVz5q</span><span class="o">/</span><span class="n">emscripten</span><span class="o">-</span><span class="mf">3.1.5</span><span class="o">~</span><span class="n">dfsg</span><span class="o">/</span><span class="n">system</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">libcxx</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">new</span><span class="p">.</span><span class="n">cpp</span>:<span class="mi">116</span>:<span class="mi">12</span>
<span class="w">           </span><span class="mi">4</span>: <span class="mh">0x8e7a5</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">operator</span><span class="w"> </span><span class="n">new</span><span class="p">[](</span><span class="n">unsigned</span><span class="w"> </span><span class="n">long</span><span class="p">,</span><span class="w"> </span><span class="n">std</span>::<span class="n">nothrow_t</span><span class="w"> </span><span class="k">const</span><span class="o">&amp;</span><span class="p">)</span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">emscripten</span><span class="o">-</span><span class="n">buVz5q</span><span class="o">/</span><span class="n">emscripten</span><span class="o">-</span><span class="mf">3.1.5</span><span class="o">~</span><span class="n">dfsg</span><span class="o">/</span><span class="n">system</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">libcxx</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">new</span><span class="p">.</span><span class="n">cpp</span>:<span class="mi">128</span>:<span class="mi">13</span>
<span class="w">           </span><span class="mi">5</span>: <span class="mh">0x1a134</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">simdjson</span>::<span class="n">dom</span>::<span class="n">document</span>::<span class="n">allocate</span><span class="p">(</span><span class="n">unsigned</span><span class="w"> </span><span class="n">long</span><span class="p">)</span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">celine</span><span class="o">/</span><span class="n">Téléchargements</span><span class="o">/</span><span class="n">json</span><span class="o">-</span><span class="n">parsing</span><span class="o">/</span><span class="n">include</span><span class="o">/</span><span class="n">simdjson</span><span class="p">.</span><span class="n">h</span>:<span class="mi">8430</span>:<span class="mi">21</span>
<span class="w">           </span><span class="mi">6</span>: <span class="mh">0x19988</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">simdjson</span>::<span class="n">dom</span>::<span class="n">parser</span>::<span class="n">ensure_capacity</span><span class="p">(</span><span class="n">simdjson</span>::<span class="n">dom</span>::<span class="n">document</span><span class="o">&amp;</span><span class="p">,</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="n">long</span><span class="p">)</span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">celine</span><span class="o">/</span><span class="n">Téléchargements</span><span class="o">/</span><span class="n">json</span><span class="o">-</span><span class="n">parsing</span><span class="o">/</span><span class="n">include</span><span class="o">/</span><span class="n">simdjson</span><span class="p">.</span><span class="n">h</span>:<span class="mi">7627</span>:<span class="mi">87</span>
<span class="w">           </span><span class="mi">7</span>: <span class="mh">0x19570</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">simdjson</span>::<span class="n">dom</span>::<span class="n">parser</span>::<span class="n">parse_into_document</span><span class="p">(</span><span class="n">simdjson</span>::<span class="n">dom</span>::<span class="n">document</span><span class="o">&amp;</span><span class="p">,</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="n">long</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">celine</span><span class="o">/</span><span class="n">Téléchargements</span><span class="o">/</span><span class="n">json</span><span class="o">-</span><span class="n">parsing</span><span class="o">/</span><span class="n">include</span><span class="o">/</span><span class="n">simdjson</span><span class="p">.</span><span class="n">h</span>:<span class="mi">7514</span>:<span class="mi">23</span>
<span class="w">           </span><span class="mi">8</span>: <span class="mh">0x1941f</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">simdjson</span>::<span class="n">dom</span>::<span class="n">parser</span>::<span class="n">parse</span><span class="p">(</span><span class="n">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="n">long</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">celine</span><span class="o">/</span><span class="n">Téléchargements</span><span class="o">/</span><span class="n">json</span><span class="o">-</span><span class="n">parsing</span><span class="o">/</span><span class="n">include</span><span class="o">/</span><span class="n">simdjson</span><span class="p">.</span><span class="n">h</span>:<span class="mi">7546</span>:<span class="mi">10</span>
<span class="w">           </span><span class="mi">9</span>: <span class="mh">0x150df</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">simdjson</span>::<span class="n">dom</span>::<span class="n">parser</span>::<span class="n">parse</span><span class="p">(</span><span class="kt">char</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="n">long</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">celine</span><span class="o">/</span><span class="n">Téléchargements</span><span class="o">/</span><span class="n">json</span><span class="o">-</span><span class="n">parsing</span><span class="o">/</span><span class="n">include</span><span class="o">/</span><span class="n">simdjson</span><span class="p">.</span><span class="n">h</span>:<span class="mi">7550</span>:<span class="mi">10</span>
<span class="w">          </span><span class="mi">10</span>: <span class="mh">0x14ad4</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">simdjson</span>::<span class="n">dom</span>::<span class="n">parser</span>::<span class="n">parse</span><span class="p">(</span><span class="n">std</span>::<span class="n">__2</span>::<span class="n">basic_string</span><span class="o">&lt;</span><span class="kt">char</span><span class="p">,</span><span class="w"> </span><span class="n">std</span>::<span class="n">__2</span>::<span class="n">char_traits</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">std</span>::<span class="n">__2</span>::<span class="n">allocator</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="k">const</span><span class="o">&amp;</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">celine</span><span class="o">/</span><span class="n">Téléchargements</span><span class="o">/</span><span class="n">json</span><span class="o">-</span><span class="n">parsing</span><span class="o">/</span><span class="n">include</span><span class="o">/</span><span class="n">simdjson</span><span class="p">.</span><span class="n">h</span>:<span class="mi">7553</span>:<span class="mi">10</span>
<span class="w">          </span><span class="mi">11</span>: <span class="mh">0x1476f</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">test_simdjson</span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">celine</span><span class="o">/</span><span class="n">Téléchargements</span><span class="o">/</span><span class="n">json</span><span class="o">-</span><span class="n">parsing</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">cpp</span>:<span class="mi">46</span>:<span class="mi">45</span>
<span class="w">    </span><span class="mi">2</span>: <span class="nc">Exited</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="n">exit</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="mi">1</span>
</code></pre></div><br>
</p>
</blockquote>
<p>Yes! But I don't know how to allow more memory as explained above :)</p>



<a name="386640058"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/CPP%20Wasmtime%20parsing%20big%20json%20string/near/386640058" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/CPP.20Wasmtime.20parsing.20big.20json.20string.html#386640058">(Aug 22 2023 at 15:47)</a>:</h4>
<p>the memory emscripten is generating is 256 pages large initially and additionally cannot grow beyond the 256 page limit, so my guess is that you're exceeding 256 wasm pages here and then it's hitting OOM</p>



<a name="386640093"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/CPP%20Wasmtime%20parsing%20big%20json%20string/near/386640093" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/CPP.20Wasmtime.20parsing.20big.20json.20string.html#386640093">(Aug 22 2023 at 15:47)</a>:</h4>
<p>you'll need to see how to remove emscripten's upper bound on the memory, and I don't know how to do that</p>



<a name="386640112"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/CPP%20Wasmtime%20parsing%20big%20json%20string/near/386640112" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/CPP.20Wasmtime.20parsing.20big.20json.20string.html#386640112">(Aug 22 2023 at 15:47)</a>:</h4>
<p>(I also don't know why <code>--trap-on-grow-failure</code> didn't work)</p>



<a name="386640509"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/CPP%20Wasmtime%20parsing%20big%20json%20string/near/386640509" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cdvl <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/CPP.20Wasmtime.20parsing.20big.20json.20string.html#386640509">(Aug 22 2023 at 15:49)</a>:</h4>
<p>Memory settings are set at the compile step? Does it depend on the compiler?</p>



<a name="386641981"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/CPP%20Wasmtime%20parsing%20big%20json%20string/near/386641981" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/CPP.20Wasmtime.20parsing.20big.20json.20string.html#386641981">(Aug 22 2023 at 15:56)</a>:</h4>
<p>yes</p>



<a name="386788007"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/CPP%20Wasmtime%20parsing%20big%20json%20string/near/386788007" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cdvl <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/CPP.20Wasmtime.20parsing.20big.20json.20string.html#386788007">(Aug 23 2023 at 08:13)</a>:</h4>
<p>Ok and do you know how to do that with wasi-sdk?</p>



<a name="386871308"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/206238-general/topic/CPP%20Wasmtime%20parsing%20big%20json%20string/near/386871308" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/206238-general/topic/CPP.20Wasmtime.20parsing.20big.20json.20string.html#386871308">(Aug 23 2023 at 13:39)</a>:</h4>
<p><code>wasm-ld</code> has a <code>--max-memory</code> option, so maybe something like <code>clang -Wl,--max-memory=1073741824 ...</code>?</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>