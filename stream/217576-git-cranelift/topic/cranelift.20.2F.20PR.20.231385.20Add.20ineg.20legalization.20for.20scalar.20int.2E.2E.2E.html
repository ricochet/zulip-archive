<html>
<head><meta charset="utf-8"><title>cranelift / PR #1385 Add ineg legalization for scalar int... · git-cranelift · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/index.html">git-cranelift</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231385.20Add.20ineg.20legalization.20for.20scalar.20int.2E.2E.2E.html">cranelift / PR #1385 Add ineg legalization for scalar int...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="187898977"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231385%20Add%20ineg%20legalization%20for%20scalar%20int.../near/187898977" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231385.20Add.20ineg.20legalization.20for.20scalar.20int.2E.2E.2E.html#187898977">(Feb 11 2020 at 10:19)</a>:</h4>
<p>peterdelevoryas opened <a href="https://github.com/bytecodealliance/cranelift/pull/1385" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1385">PR #1385</a> from <code>master</code> to <code>master</code>:</p>
<blockquote>
<ul>
<li>Closes #1383 </li>
<li>Cranelift already has custom legalization for ineg on vector integer types, might as well add it for scalar integer types!</li>
<li>This PR includes one new test case, it's relatively meager, maybe I could add cases for all the integer type variants? (i8, i16, i32, i64). Not sure if that's too much or not!</li>
<li>I don't know who could review this, maybe <code>bnjbvr</code> or <code>bjorn3</code>?</li>
</ul>
<p>I added some comments in the diff that refer to concerns I had</p>
</blockquote>



<a name="187903688"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231385%20Add%20ineg%20legalization%20for%20scalar%20int.../near/187903688" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231385.20Add.20ineg.20legalization.20for.20scalar.20int.2E.2E.2E.html#187903688">(Feb 11 2020 at 11:30)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/cranelift/pull/1385#pullrequestreview-356583775" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1385#pullrequestreview-356583775">PR Review</a>.</p>



<a name="187903689"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231385%20Add%20ineg%20legalization%20for%20scalar%20int.../near/187903689" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231385.20Add.20ineg.20legalization.20for.20scalar.20int.2E.2E.2E.html#187903689">(Feb 11 2020 at 11:30)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/cranelift/pull/1385#discussion_r377578763" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1385#discussion_r377578763">PR Review Comment</a>:</p>
<blockquote>
<p>This will need to be added to widen too to legalize i8 and i16.</p>
</blockquote>



<a name="187903690"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231385%20Add%20ineg%20legalization%20for%20scalar%20int.../near/187903690" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231385.20Add.20ineg.20legalization.20for.20scalar.20int.2E.2E.2E.html#187903690">(Feb 11 2020 at 11:30)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/cranelift/pull/1385#discussion_r377579300" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1385#discussion_r377579300">PR Review Comment</a>:</p>
<blockquote>
<p>This is necessary to get the arg passes to ineg. Adding an <code>unreachable!()</code> as else would be nice though.</p>
</blockquote>



<a name="187903691"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231385%20Add%20ineg%20legalization%20for%20scalar%20int.../near/187903691" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231385.20Add.20ineg.20legalization.20for.20scalar.20int.2E.2E.2E.html#187903691">(Feb 11 2020 at 11:30)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/cranelift/pull/1385#pullrequestreview-356583775" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1385#pullrequestreview-356583775">PR Review</a>.</p>



<a name="187904022"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231385%20Add%20ineg%20legalization%20for%20scalar%20int.../near/187904022" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231385.20Add.20ineg.20legalization.20for.20scalar.20int.2E.2E.2E.html#187904022">(Feb 11 2020 at 11:35)</a>:</h4>
<p>peterdelevoryas submitted <a href="https://github.com/bytecodealliance/cranelift/pull/1385#pullrequestreview-356587297" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1385#pullrequestreview-356587297">PR Review</a>.</p>



<a name="187904023"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231385%20Add%20ineg%20legalization%20for%20scalar%20int.../near/187904023" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231385.20Add.20ineg.20legalization.20for.20scalar.20int.2E.2E.2E.html#187904023">(Feb 11 2020 at 11:35)</a>:</h4>
<p>peterdelevoryas created <a href="https://github.com/bytecodealliance/cranelift/pull/1385#discussion_r377581614" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1385#discussion_r377581614">PR Review Comment</a>:</p>
<blockquote>
<p>Ohhhh ok, I was trying to find widen and couldn't find it, let me check again</p>
</blockquote>



<a name="187904340"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231385%20Add%20ineg%20legalization%20for%20scalar%20int.../near/187904340" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231385.20Add.20ineg.20legalization.20for.20scalar.20int.2E.2E.2E.html#187904340">(Feb 11 2020 at 11:40)</a>:</h4>
<p>peterdelevoryas submitted <a href="https://github.com/bytecodealliance/cranelift/pull/1385#pullrequestreview-356589851" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1385#pullrequestreview-356589851">PR Review</a>.</p>



<a name="187904341"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231385%20Add%20ineg%20legalization%20for%20scalar%20int.../near/187904341" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231385.20Add.20ineg.20legalization.20for.20scalar.20int.2E.2E.2E.html#187904341">(Feb 11 2020 at 11:40)</a>:</h4>
<p>peterdelevoryas created <a href="https://github.com/bytecodealliance/cranelift/pull/1385#discussion_r377583589" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1385#discussion_r377583589">PR Review Comment</a>:</p>
<blockquote>
<p>ohhh I get it now, ok I'll make a widen group and add the custom legalization there just for x86, now in the shared-common one, since all this ineg stuff is in x86 right now.</p>
</blockquote>



<a name="187904347"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231385%20Add%20ineg%20legalization%20for%20scalar%20int.../near/187904347" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231385.20Add.20ineg.20legalization.20for.20scalar.20int.2E.2E.2E.html#187904347">(Feb 11 2020 at 11:40)</a>:</h4>
<p>peterdelevoryas edited <a href="https://github.com/bytecodealliance/cranelift/pull/1385#discussion_r377583589" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1385#discussion_r377583589">PR Review Comment</a>.</p>



<a name="187939565"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231385%20Add%20ineg%20legalization%20for%20scalar%20int.../near/187939565" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231385.20Add.20ineg.20legalization.20for.20scalar.20int.2E.2E.2E.html#187939565">(Feb 11 2020 at 18:30)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/cranelift/pull/1385#pullrequestreview-356892874" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1385#pullrequestreview-356892874">PR Review</a>.</p>



<a name="187939566"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231385%20Add%20ineg%20legalization%20for%20scalar%20int.../near/187939566" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231385.20Add.20ineg.20legalization.20for.20scalar.20int.2E.2E.2E.html#187939566">(Feb 11 2020 at 18:30)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/cranelift/pull/1385#discussion_r377818587" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1385#discussion_r377818587">PR Review Comment</a>:</p>
<blockquote>
<p>I think so; I see that type of thing up above. Something like the following would be good to get both the type and the legalization that failed: <code>panic!("Can't convert ineg of {}", valuetype)</code>.</p>
</blockquote>



<a name="187949525"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231385%20Add%20ineg%20legalization%20for%20scalar%20int.../near/187949525" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231385.20Add.20ineg.20legalization.20for.20scalar.20int.2E.2E.2E.html#187949525">(Feb 11 2020 at 20:09)</a>:</h4>
<p>peterdelevoryas submitted <a href="https://github.com/bytecodealliance/cranelift/pull/1385#pullrequestreview-356959323" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1385#pullrequestreview-356959323">PR Review</a>.</p>



<a name="187949526"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231385%20Add%20ineg%20legalization%20for%20scalar%20int.../near/187949526" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231385.20Add.20ineg.20legalization.20for.20scalar.20int.2E.2E.2E.html#187949526">(Feb 11 2020 at 20:09)</a>:</h4>
<p>peterdelevoryas created <a href="https://github.com/bytecodealliance/cranelift/pull/1385#discussion_r377871046" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1385#discussion_r377871046">PR Review Comment</a>:</p>
<blockquote>
<p>Hey, I tried adding this to the widen TransformGroup, but that didn't seem to work. I saw a comment in another file about ordering being significant: maybe I need to add the widen group legalizations before or after the narrow/expand additions?</p>
</blockquote>



<a name="187956186"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231385%20Add%20ineg%20legalization%20for%20scalar%20int.../near/187956186" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231385.20Add.20ineg.20legalization.20for.20scalar.20int.2E.2E.2E.html#187956186">(Feb 11 2020 at 21:14)</a>:</h4>
<p>peterdelevoryas updated <a href="https://github.com/bytecodealliance/cranelift/pull/1385" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1385">PR #1385</a> from <code>master</code> to <code>master</code>:</p>
<blockquote>
<ul>
<li>Closes #1383 </li>
<li>Cranelift already has custom legalization for ineg on vector integer types, might as well add it for scalar integer types!</li>
<li>This PR includes one new test case, it's relatively meager, maybe I could add cases for all the integer type variants? (i8, i16, i32, i64). Not sure if that's too much or not!</li>
<li>I don't know who could review this, maybe <code>bnjbvr</code> or <code>bjorn3</code>?</li>
</ul>
<p>I added some comments in the diff that refer to concerns I had</p>
</blockquote>



<a name="187956583"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231385%20Add%20ineg%20legalization%20for%20scalar%20int.../near/187956583" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231385.20Add.20ineg.20legalization.20for.20scalar.20int.2E.2E.2E.html#187956583">(Feb 11 2020 at 21:18)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/cranelift/pull/1385#pullrequestreview-357002785" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1385#pullrequestreview-357002785">PR Review</a>.</p>



<a name="187956584"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231385%20Add%20ineg%20legalization%20for%20scalar%20int.../near/187956584" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231385.20Add.20ineg.20legalization.20for.20scalar.20int.2E.2E.2E.html#187956584">(Feb 11 2020 at 21:18)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/cranelift/pull/1385#discussion_r377904568" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1385#discussion_r377904568">PR Review Comment</a>:</p>
<blockquote>
<p>I think using x86_widen instead of widen at <a href="https://github.com/bytecodealliance/cranelift/blob/23e9bdb2d99fb8f554793cb87f1578cc543c355f/cranelift-codegen/meta/src/isa/x86/mod.rs#L36" target="_blank" title="https://github.com/bytecodealliance/cranelift/blob/23e9bdb2d99fb8f554793cb87f1578cc543c355f/cranelift-codegen/meta/src/isa/x86/mod.rs#L36">https://github.com/bytecodealliance/cranelift/blob/23e9bdb2d99fb8f554793cb87f1578cc543c355f/cranelift-codegen/meta/src/isa/x86/mod.rs#L36</a> should fix it.</p>
</blockquote>



<a name="187964996"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231385%20Add%20ineg%20legalization%20for%20scalar%20int.../near/187964996" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231385.20Add.20ineg.20legalization.20for.20scalar.20int.2E.2E.2E.html#187964996">(Feb 11 2020 at 22:57)</a>:</h4>
<p>abrown assigned <a href="https://github.com/bytecodealliance/cranelift/pull/1385" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1385">PR #1385</a>.</p>



<a name="187973858"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231385%20Add%20ineg%20legalization%20for%20scalar%20int.../near/187973858" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231385.20Add.20ineg.20legalization.20for.20scalar.20int.2E.2E.2E.html#187973858">(Feb 12 2020 at 01:16)</a>:</h4>
<p>peterdelevoryas submitted <a href="https://github.com/bytecodealliance/cranelift/pull/1385#pullrequestreview-357131646" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1385#pullrequestreview-357131646">PR Review</a>.</p>



<a name="187973859"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231385%20Add%20ineg%20legalization%20for%20scalar%20int.../near/187973859" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231385.20Add.20ineg.20legalization.20for.20scalar.20int.2E.2E.2E.html#187973859">(Feb 12 2020 at 01:16)</a>:</h4>
<p>peterdelevoryas created <a href="https://github.com/bytecodealliance/cranelift/pull/1385#discussion_r377992612" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1385#discussion_r377992612">PR Review Comment</a>:</p>
<blockquote>
<p>I thought this would be sufficient to get the transformation to apply to i8/i16, but it doesn't seem to be working? I'm getting stuck debugging this because I can't seem to find the place where we apply the transformations. Maybe this is in the generated Rust file?</p>
</blockquote>



<a name="187974068"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231385%20Add%20ineg%20legalization%20for%20scalar%20int.../near/187974068" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231385.20Add.20ineg.20legalization.20for.20scalar.20int.2E.2E.2E.html#187974068">(Feb 12 2020 at 01:22)</a>:</h4>
<p>peterdelevoryas created <a href="https://github.com/bytecodealliance/cranelift/pull/1385#discussion_r377994044" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1385#discussion_r377994044">PR Review Comment</a>:</p>
<blockquote>
<p>nvm, I think I see the spot where x86_narrow/etc gets tied to the x86 legalization, maybe I can fix this</p>
</blockquote>



<a name="187974069"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231385%20Add%20ineg%20legalization%20for%20scalar%20int.../near/187974069" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231385.20Add.20ineg.20legalization.20for.20scalar.20int.2E.2E.2E.html#187974069">(Feb 12 2020 at 01:22)</a>:</h4>
<p>peterdelevoryas submitted <a href="https://github.com/bytecodealliance/cranelift/pull/1385#pullrequestreview-357133381" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1385#pullrequestreview-357133381">PR Review</a>.</p>



<a name="187979092"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231385%20Add%20ineg%20legalization%20for%20scalar%20int.../near/187979092" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231385.20Add.20ineg.20legalization.20for.20scalar.20int.2E.2E.2E.html#187979092">(Feb 12 2020 at 03:37)</a>:</h4>
<p>peterdelevoryas submitted <a href="https://github.com/bytecodealliance/cranelift/pull/1385#pullrequestreview-357170590" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1385#pullrequestreview-357170590">PR Review</a>.</p>



<a name="187979093"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231385%20Add%20ineg%20legalization%20for%20scalar%20int.../near/187979093" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231385.20Add.20ineg.20legalization.20for.20scalar.20int.2E.2E.2E.html#187979093">(Feb 12 2020 at 03:37)</a>:</h4>
<p>peterdelevoryas created <a href="https://github.com/bytecodealliance/cranelift/pull/1385#discussion_r378025496" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1385#discussion_r378025496">PR Review Comment</a>:</p>
<blockquote>
<p>That did fix it! And I added a test for i16 and that worked too. So, i8, i16, and i32 work. But, i64 doesn't: I think these changes made sure <code>convert_ineg</code> is added to widen, narrow, and expand, is there something missing still?</p>
<div class="codehilite"><pre><span></span>---- filetests stdout ----
FAIL filetests/isa/x86/legalize-custom.clif: legalizer(%ineg_legalized_i):
filecheck failed:
#0 regex: V=v\d+
#1 regex: BB=block\d+
#2 check: v2 = iconst.i32 1
#3 check: v3 = iconst.i32 0
#4 check: v0 = iconcat v2, v3
#5 nextln: v1 = isub v2, v0
&gt; function %ineg_legalized_i() fast {
&gt;                                 block0:
&gt; [Op1pu_id#b8]                       v2 = iconst.i32 1
                                      ^~~~~~~~~~~~~~~~~
Matched #2: \bv2 = iconst\.i32 1\b
&gt; [Op1pu_id#b8]                       v3 = iconst.i32 0
                                      ^~~~~~~~~~~~~~~~~
Matched #3: \bv3 = iconst\.i32 0\b
&gt; [-]                                 v0 = iconcat v2, v3
                                      ^~~~~~~~~~~~~~~~~~~
Matched #4: \bv0 = iconcat v2, v3\b
&gt; [-]                                 v1 = ineg v0
Missed #5: \bv1 = isub v2, v0\b
&gt; [Op1ret#c3]                         return
&gt; }
</pre></div>


</blockquote>



<a name="187979154"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231385%20Add%20ineg%20legalization%20for%20scalar%20int.../near/187979154" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231385.20Add.20ineg.20legalization.20for.20scalar.20int.2E.2E.2E.html#187979154">(Feb 12 2020 at 03:39)</a>:</h4>
<p>peterdelevoryas updated <a href="https://github.com/bytecodealliance/cranelift/pull/1385" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1385">PR #1385</a> (assigned to abrown) from <code>master</code> to <code>master</code>:</p>
<blockquote>
<ul>
<li>Closes #1383 </li>
<li>Cranelift already has custom legalization for ineg on vector integer types, might as well add it for scalar integer types!</li>
<li>This PR includes one new test case, it's relatively meager, maybe I could add cases for all the integer type variants? (i8, i16, i32, i64). Not sure if that's too much or not!</li>
<li>I don't know who could review this, maybe <code>bnjbvr</code> or <code>bjorn3</code>?</li>
</ul>
<p>I added some comments in the diff that refer to concerns I had</p>
</blockquote>



<a name="187979215"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231385%20Add%20ineg%20legalization%20for%20scalar%20int.../near/187979215" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231385.20Add.20ineg.20legalization.20for.20scalar.20int.2E.2E.2E.html#187979215">(Feb 12 2020 at 03:40)</a>:</h4>
<p>peterdelevoryas updated <a href="https://github.com/bytecodealliance/cranelift/pull/1385" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1385">PR #1385</a> (assigned to abrown) from <code>master</code> to <code>master</code>:</p>
<blockquote>
<ul>
<li>Closes #1383 </li>
<li>Cranelift already has custom legalization for ineg on vector integer types, might as well add it for scalar integer types!</li>
<li>This PR includes one new test case, it's relatively meager, maybe I could add cases for all the integer type variants? (i8, i16, i32, i64). Not sure if that's too much or not!</li>
<li>I don't know who could review this, maybe <code>bnjbvr</code> or <code>bjorn3</code>?</li>
</ul>
<p>I added some comments in the diff that refer to concerns I had</p>
</blockquote>



<a name="187979634"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231385%20Add%20ineg%20legalization%20for%20scalar%20int.../near/187979634" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231385.20Add.20ineg.20legalization.20for.20scalar.20int.2E.2E.2E.html#187979634">(Feb 12 2020 at 03:52)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/cranelift/pull/1385#pullrequestreview-357173965" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1385#pullrequestreview-357173965">PR Review</a>.</p>



<a name="187979635"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231385%20Add%20ineg%20legalization%20for%20scalar%20int.../near/187979635" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231385.20Add.20ineg.20legalization.20for.20scalar.20int.2E.2E.2E.html#187979635">(Feb 12 2020 at 03:52)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/cranelift/pull/1385#discussion_r378028565" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1385#discussion_r378028565">PR Review Comment</a>:</p>
<blockquote>
<p>"Legalize instructions by widening"?</p>
</blockquote>



<a name="187979829"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231385%20Add%20ineg%20legalization%20for%20scalar%20int.../near/187979829" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231385.20Add.20ineg.20legalization.20for.20scalar.20int.2E.2E.2E.html#187979829">(Feb 12 2020 at 03:58)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/cranelift/pull/1385#pullrequestreview-357175654" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1385#pullrequestreview-357175654">PR Review</a>.</p>



<a name="187979830"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231385%20Add%20ineg%20legalization%20for%20scalar%20int.../near/187979830" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231385.20Add.20ineg.20legalization.20for.20scalar.20int.2E.2E.2E.html#187979830">(Feb 12 2020 at 03:58)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/cranelift/pull/1385#discussion_r378029925" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1385#discussion_r378029925">PR Review Comment</a>:</p>
<blockquote>
<p>Not sure I get why v2 and v3 have different types initially: shouldn't they both start out as <code>i8</code>s and be extended? And we have to extend and then reduce because we don't have an encoding for <code>isub.i8</code>? (@peterdelevoryas, no need to answer; this is more for @bjorn3 as he is more familiar with this than I am)</p>
</blockquote>



<a name="187979846"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231385%20Add%20ineg%20legalization%20for%20scalar%20int.../near/187979846" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231385.20Add.20ineg.20legalization.20for.20scalar.20int.2E.2E.2E.html#187979846">(Feb 12 2020 at 03:59)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/cranelift/pull/1385#discussion_r378030083" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1385#discussion_r378030083">PR Review Comment</a>:</p>
<blockquote>
<p>@bjorn3, I would not expect this <code>iconcat</code>; can't we directly encode an <code>iconst.i64</code>?</p>
</blockquote>



<a name="187979847"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231385%20Add%20ineg%20legalization%20for%20scalar%20int.../near/187979847" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231385.20Add.20ineg.20legalization.20for.20scalar.20int.2E.2E.2E.html#187979847">(Feb 12 2020 at 03:59)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/cranelift/pull/1385#pullrequestreview-357175873" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1385#pullrequestreview-357175873">PR Review</a>.</p>



<a name="187984303"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231385%20Add%20ineg%20legalization%20for%20scalar%20int.../near/187984303" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231385.20Add.20ineg.20legalization.20for.20scalar.20int.2E.2E.2E.html#187984303">(Feb 12 2020 at 06:08)</a>:</h4>
<p>peterdelevoryas submitted <a href="https://github.com/bytecodealliance/cranelift/pull/1385#pullrequestreview-357207689" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1385#pullrequestreview-357207689">PR Review</a>.</p>



<a name="187984304"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231385%20Add%20ineg%20legalization%20for%20scalar%20int.../near/187984304" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231385.20Add.20ineg.20legalization.20for.20scalar.20int.2E.2E.2E.html#187984304">(Feb 12 2020 at 06:08)</a>:</h4>
<p>peterdelevoryas created <a href="https://github.com/bytecodealliance/cranelift/pull/1385#discussion_r378055670" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1385#discussion_r378055670">PR Review Comment</a>:</p>
<blockquote>
<p>Ah woops thanks for catching that!</p>
</blockquote>



<a name="187986111"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231385%20Add%20ineg%20legalization%20for%20scalar%20int.../near/187986111" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231385.20Add.20ineg.20legalization.20for.20scalar.20int.2E.2E.2E.html#187986111">(Feb 12 2020 at 06:57)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/cranelift/pull/1385#pullrequestreview-357222826" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1385#pullrequestreview-357222826">PR Review</a>.</p>



<a name="187986112"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231385%20Add%20ineg%20legalization%20for%20scalar%20int.../near/187986112" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231385.20Add.20ineg.20legalization.20for.20scalar.20int.2E.2E.2E.html#187986112">(Feb 12 2020 at 06:57)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/cranelift/pull/1385#discussion_r378068246" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1385#discussion_r378068246">PR Review Comment</a>:</p>
<blockquote>
<p>This file has <code>target i686</code> before <code>target x86_64</code>. How is that handled? Does it test both or only the first?</p>
</blockquote>



<a name="187986273"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231385%20Add%20ineg%20legalization%20for%20scalar%20int.../near/187986273" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231385.20Add.20ineg.20legalization.20for.20scalar.20int.2E.2E.2E.html#187986273">(Feb 12 2020 at 07:01)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/cranelift/pull/1385#pullrequestreview-357224480" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1385#pullrequestreview-357224480">PR Review</a>.</p>



<a name="187986274"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231385%20Add%20ineg%20legalization%20for%20scalar%20int.../near/187986274" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231385.20Add.20ineg.20legalization.20for.20scalar.20int.2E.2E.2E.html#187986274">(Feb 12 2020 at 07:01)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/cranelift/pull/1385#discussion_r378069557" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1385#discussion_r378069557">PR Review Comment</a>:</p>
<blockquote>
<p>iconst.i8 is legalized as iconst.i32 + ireduce.i8. isub.i8 is legalized as uextend.i32 + isub.i32 + ireduce.i8.</p>
</blockquote>



<a name="188033640"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231385%20Add%20ineg%20legalization%20for%20scalar%20int.../near/188033640" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231385.20Add.20ineg.20legalization.20for.20scalar.20int.2E.2E.2E.html#188033640">(Feb 12 2020 at 17:37)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/cranelift/pull/1385#pullrequestreview-357652208" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1385#pullrequestreview-357652208">PR Review</a>.</p>



<a name="188033642"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231385%20Add%20ineg%20legalization%20for%20scalar%20int.../near/188033642" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231385.20Add.20ineg.20legalization.20for.20scalar.20int.2E.2E.2E.html#188033642">(Feb 12 2020 at 17:37)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/cranelift/pull/1385#discussion_r378406801" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1385#discussion_r378406801">PR Review Comment</a>:</p>
<blockquote>
<p>Learn something new every day: apparently parsing tests <a href="https://github.com/bytecodealliance/cranelift/blob/master/cranelift-reader/src/parser.rs#L992-L1025" target="_blank" title="https://github.com/bytecodealliance/cranelift/blob/master/cranelift-reader/src/parser.rs#L992-L1025">accumulates the targets</a> and <code>test_tuples</code> will expand the different targets (in this case since the legalizer <code>needs_isa</code> we should have a test tuple for each <code>target</code> from <a href="https://github.com/bytecodealliance/cranelift/blob/master/cranelift-filetests/src/runone.rs#L121-L125" target="_blank" title="https://github.com/bytecodealliance/cranelift/blob/master/cranelift-filetests/src/runone.rs#L121-L125">here</a>). </p>
<p>But then this doesn't make sense: how could these checks pass when <code>target x86_64</code> is set? Is that the build failure? No, it looks like the current build failure happens because <code>ineg</code> isn't getting legalized at all for <code>i64</code>?</p>
</blockquote>



<a name="188044994"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231385%20Add%20ineg%20legalization%20for%20scalar%20int.../near/188044994" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231385.20Add.20ineg.20legalization.20for.20scalar.20int.2E.2E.2E.html#188044994">(Feb 12 2020 at 19:28)</a>:</h4>
<p>peterdelevoryas submitted <a href="https://github.com/bytecodealliance/cranelift/pull/1385#pullrequestreview-357726121" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1385#pullrequestreview-357726121">PR Review</a>.</p>



<a name="188044995"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231385%20Add%20ineg%20legalization%20for%20scalar%20int.../near/188044995" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231385.20Add.20ineg.20legalization.20for.20scalar.20int.2E.2E.2E.html#188044995">(Feb 12 2020 at 19:28)</a>:</h4>
<p>peterdelevoryas created <a href="https://github.com/bytecodealliance/cranelift/pull/1385#discussion_r378464857" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1385#discussion_r378464857">PR Review Comment</a>:</p>
<blockquote>
<p>Yeah the build failure is happening because <code>ineg</code> still isn't getting legalized for <code>i64</code>, I still haven't figured out why that is. This must be because I need to extend another transform group right? That was the reason for <code>i8</code> and <code>i16</code> not getting legalized initially (I think)</p>
</blockquote>



<a name="188046037"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231385%20Add%20ineg%20legalization%20for%20scalar%20int.../near/188046037" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231385.20Add.20ineg.20legalization.20for.20scalar.20int.2E.2E.2E.html#188046037">(Feb 12 2020 at 19:38)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/cranelift/pull/1385#pullrequestreview-357733092" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1385#pullrequestreview-357733092">PR Review</a>.</p>



<a name="188046040"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231385%20Add%20ineg%20legalization%20for%20scalar%20int.../near/188046040" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231385.20Add.20ineg.20legalization.20for.20scalar.20int.2E.2E.2E.html#188046040">(Feb 12 2020 at 19:38)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/cranelift/pull/1385#discussion_r378470299" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1385#discussion_r378470299">PR Review Comment</a>:</p>
<blockquote>
<p>There is also the <code>narrow</code> group for ints &gt; pointer size.</p>
</blockquote>



<a name="188220212"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231385%20Add%20ineg%20legalization%20for%20scalar%20int.../near/188220212" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231385.20Add.20ineg.20legalization.20for.20scalar.20int.2E.2E.2E.html#188220212">(Feb 14 2020 at 16:10)</a>:</h4>
<p>peterdelevoryas updated <a href="https://github.com/bytecodealliance/cranelift/pull/1385" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1385">PR #1385</a> (assigned to abrown) from <code>master</code> to <code>master</code>:</p>
<blockquote>
<ul>
<li>Closes #1383 </li>
<li>Cranelift already has custom legalization for ineg on vector integer types, might as well add it for scalar integer types!</li>
<li>This PR includes one new test case, it's relatively meager, maybe I could add cases for all the integer type variants? (i8, i16, i32, i64). Not sure if that's too much or not!</li>
<li>I don't know who could review this, maybe <code>bnjbvr</code> or <code>bjorn3</code>?</li>
</ul>
<p>I added some comments in the diff that refer to concerns I had</p>
</blockquote>



<a name="188220717"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231385%20Add%20ineg%20legalization%20for%20scalar%20int.../near/188220717" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231385.20Add.20ineg.20legalization.20for.20scalar.20int.2E.2E.2E.html#188220717">(Feb 14 2020 at 16:15)</a>:</h4>
<p>peterdelevoryas updated <a href="https://github.com/bytecodealliance/cranelift/pull/1385" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1385">PR #1385</a> (assigned to abrown) from <code>master</code> to <code>master</code>:</p>
<blockquote>
<ul>
<li>Closes #1383 </li>
<li>Cranelift already has custom legalization for ineg on vector integer types, might as well add it for scalar integer types!</li>
<li>This PR includes one new test case, it's relatively meager, maybe I could add cases for all the integer type variants? (i8, i16, i32, i64). Not sure if that's too much or not!</li>
<li>I don't know who could review this, maybe <code>bnjbvr</code> or <code>bjorn3</code>?</li>
</ul>
<p>I added some comments in the diff that refer to concerns I had</p>
</blockquote>



<a name="188220828"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231385%20Add%20ineg%20legalization%20for%20scalar%20int.../near/188220828" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231385.20Add.20ineg.20legalization.20for.20scalar.20int.2E.2E.2E.html#188220828">(Feb 14 2020 at 16:16)</a>:</h4>
<p>peterdelevoryas submitted <a href="https://github.com/bytecodealliance/cranelift/pull/1385#pullrequestreview-359055670" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1385#pullrequestreview-359055670">PR Review</a>.</p>



<a name="188220829"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231385%20Add%20ineg%20legalization%20for%20scalar%20int.../near/188220829" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231385.20Add.20ineg.20legalization.20for.20scalar.20int.2E.2E.2E.html#188220829">(Feb 14 2020 at 16:16)</a>:</h4>
<p>peterdelevoryas created <a href="https://github.com/bytecodealliance/cranelift/pull/1385#discussion_r379518854" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1385#discussion_r379518854">PR Review Comment</a>:</p>
<blockquote>
<p>Ok, this should be fixed now</p>
</blockquote>



<a name="188220866"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231385%20Add%20ineg%20legalization%20for%20scalar%20int.../near/188220866" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231385.20Add.20ineg.20legalization.20for.20scalar.20int.2E.2E.2E.html#188220866">(Feb 14 2020 at 16:17)</a>:</h4>
<p>peterdelevoryas submitted <a href="https://github.com/bytecodealliance/cranelift/pull/1385#pullrequestreview-359055946" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1385#pullrequestreview-359055946">PR Review</a>.</p>



<a name="188220869"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231385%20Add%20ineg%20legalization%20for%20scalar%20int.../near/188220869" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231385.20Add.20ineg.20legalization.20for.20scalar.20int.2E.2E.2E.html#188220869">(Feb 14 2020 at 16:17)</a>:</h4>
<p>peterdelevoryas created <a href="https://github.com/bytecodealliance/cranelift/pull/1385#discussion_r379519069" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1385#discussion_r379519069">PR Review Comment</a>:</p>
<blockquote>
<p>I added this panic message</p>
</blockquote>



<a name="188220891"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231385%20Add%20ineg%20legalization%20for%20scalar%20int.../near/188220891" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231385.20Add.20ineg.20legalization.20for.20scalar.20int.2E.2E.2E.html#188220891">(Feb 14 2020 at 16:17)</a>:</h4>
<p>peterdelevoryas submitted <a href="https://github.com/bytecodealliance/cranelift/pull/1385#pullrequestreview-359056194" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1385#pullrequestreview-359056194">PR Review</a>.</p>



<a name="188220893"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231385%20Add%20ineg%20legalization%20for%20scalar%20int.../near/188220893" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231385.20Add.20ineg.20legalization.20for.20scalar.20int.2E.2E.2E.html#188220893">(Feb 14 2020 at 16:17)</a>:</h4>
<p>peterdelevoryas created <a href="https://github.com/bytecodealliance/cranelift/pull/1385#discussion_r379519265" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1385#discussion_r379519265">PR Review Comment</a>:</p>
<blockquote>
<p>Added an <code>else { unreachable!() }</code> clause</p>
</blockquote>



<a name="188223230"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231385%20Add%20ineg%20legalization%20for%20scalar%20int.../near/188223230" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231385.20Add.20ineg.20legalization.20for.20scalar.20int.2E.2E.2E.html#188223230">(Feb 14 2020 at 16:43)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/cranelift/pull/1385#pullrequestreview-359074781" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1385#pullrequestreview-359074781">PR Review</a>.</p>



<a name="188232233"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231385%20Add%20ineg%20legalization%20for%20scalar%20int.../near/188232233" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231385.20Add.20ineg.20legalization.20for.20scalar.20int.2E.2E.2E.html#188232233">(Feb 14 2020 at 18:29)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/cranelift/pull/1385#pullrequestreview-359135797" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1385#pullrequestreview-359135797">PR Review</a>.</p>



<a name="188232234"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231385%20Add%20ineg%20legalization%20for%20scalar%20int.../near/188232234" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231385.20Add.20ineg.20legalization.20for.20scalar.20int.2E.2E.2E.html#188232234">(Feb 14 2020 at 18:29)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/cranelift/pull/1385#discussion_r379580262" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1385#discussion_r379580262">PR Review Comment</a>:</p>
<blockquote>
<p>I want to make sure I understand this: x86_narrow is chained with narrow_flags so this just makes <code>x86_32</code> consistent with <code>x86_64</code>--i.e. was this necessary to get this patch to work?</p>
</blockquote>



<a name="188232332"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231385%20Add%20ineg%20legalization%20for%20scalar%20int.../near/188232332" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231385.20Add.20ineg.20legalization.20for.20scalar.20int.2E.2E.2E.html#188232332">(Feb 14 2020 at 18:30)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/cranelift/pull/1385#pullrequestreview-359136268" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1385#pullrequestreview-359136268">PR Review</a>.</p>



<a name="188232333"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231385%20Add%20ineg%20legalization%20for%20scalar%20int.../near/188232333" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231385.20Add.20ineg.20legalization.20for.20scalar.20int.2E.2E.2E.html#188232333">(Feb 14 2020 at 18:30)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/cranelift/pull/1385#discussion_r379580620" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1385#discussion_r379580620">PR Review Comment</a>:</p>
<blockquote>
<p>Perhaps we should rename this to <code>x86_widen</code> (here and where used) to be very clear what is going on.</p>
</blockquote>



<a name="188232348"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231385%20Add%20ineg%20legalization%20for%20scalar%20int.../near/188232348" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231385.20Add.20ineg.20legalization.20for.20scalar.20int.2E.2E.2E.html#188232348">(Feb 14 2020 at 18:30)</a>:</h4>
<p>abrown edited <a href="https://github.com/bytecodealliance/cranelift/pull/1385#discussion_r379580620" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1385#discussion_r379580620">PR Review Comment</a>.</p>



<a name="188232417"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231385%20Add%20ineg%20legalization%20for%20scalar%20int.../near/188232417" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231385.20Add.20ineg.20legalization.20for.20scalar.20int.2E.2E.2E.html#188232417">(Feb 14 2020 at 18:31)</a>:</h4>
<p>peterdelevoryas created <a href="https://github.com/bytecodealliance/cranelift/pull/1385#discussion_r379581194" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1385#discussion_r379581194">PR Review Comment</a>:</p>
<blockquote>
<p>That's correct, I think before this, the legalization of <code>ineg.i64</code> was not being applied on i686. I'll double check really quickly though and show the error here</p>
</blockquote>



<a name="188232418"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231385%20Add%20ineg%20legalization%20for%20scalar%20int.../near/188232418" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231385.20Add.20ineg.20legalization.20for.20scalar.20int.2E.2E.2E.html#188232418">(Feb 14 2020 at 18:31)</a>:</h4>
<p>peterdelevoryas submitted <a href="https://github.com/bytecodealliance/cranelift/pull/1385#pullrequestreview-359137003" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1385#pullrequestreview-359137003">PR Review</a>.</p>



<a name="188232431"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231385%20Add%20ineg%20legalization%20for%20scalar%20int.../near/188232431" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231385.20Add.20ineg.20legalization.20for.20scalar.20int.2E.2E.2E.html#188232431">(Feb 14 2020 at 18:31)</a>:</h4>
<p>peterdelevoryas submitted <a href="https://github.com/bytecodealliance/cranelift/pull/1385#pullrequestreview-359137137" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1385#pullrequestreview-359137137">PR Review</a>.</p>



<a name="188232432"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231385%20Add%20ineg%20legalization%20for%20scalar%20int.../near/188232432" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231385.20Add.20ineg.20legalization.20for.20scalar.20int.2E.2E.2E.html#188232432">(Feb 14 2020 at 18:31)</a>:</h4>
<p>peterdelevoryas created <a href="https://github.com/bytecodealliance/cranelift/pull/1385#discussion_r379581286" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1385#discussion_r379581286">PR Review Comment</a>:</p>
<blockquote>
<p>Oh yeah I can definitely do that!</p>
</blockquote>



<a name="188232767"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231385%20Add%20ineg%20legalization%20for%20scalar%20int.../near/188232767" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231385.20Add.20ineg.20legalization.20for.20scalar.20int.2E.2E.2E.html#188232767">(Feb 14 2020 at 18:35)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/cranelift/pull/1385#pullrequestreview-359139275" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1385#pullrequestreview-359139275">PR Review</a>.</p>



<a name="188232768"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231385%20Add%20ineg%20legalization%20for%20scalar%20int.../near/188232768" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231385.20Add.20ineg.20legalization.20for.20scalar.20int.2E.2E.2E.html#188232768">(Feb 14 2020 at 18:35)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/cranelift/pull/1385#discussion_r379582923" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1385#discussion_r379582923">PR Review Comment</a>:</p>
<blockquote>
<p>Sounds good, I'll merge this after your push.</p>
</blockquote>



<a name="188240444"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231385%20Add%20ineg%20legalization%20for%20scalar%20int.../near/188240444" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231385.20Add.20ineg.20legalization.20for.20scalar.20int.2E.2E.2E.html#188240444">(Feb 14 2020 at 19:53)</a>:</h4>
<p>peterdelevoryas created <a href="https://github.com/bytecodealliance/cranelift/pull/1385#discussion_r379616247" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1385#discussion_r379616247">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>running 1 test
test filetests ... FAILED

failures:

---- filetests stdout ----
FAIL filetests/isa/x86/legalize-i64.clif: legalizer(%ineg_legalized_i):
filecheck failed:
#0 regex: V=v\d+
#1 check: v2 = iconst.i32 1
#2 nextln: v3 = iconst.i32 0
#3 nextln: v0 = iconcat v2, v3
#4 nextln: v5 = iconst.i32 0
#5 nextln: v6 = iconst.i32 0
#6 nextln: v4 = iconcat v5, v6
#7 nextln: v7, v8 = isub_ifbout v5, v2
#8 nextln: v9 = isub_ifbin v6, v3, v8
#9 nextln: v1 = iconcat v7, v9
&gt; function %ineg_legalized_i() fast {
&gt;                                 block0:
&gt; [Op1pu_id#b8]                       v2 = iconst.i32 1
                                      ^~~~~~~~~~~~~~~~~
Matched #1: \bv2 = iconst\.i32 1\b
&gt; [Op1pu_id#b8]                       v3 = iconst.i32 0
                                      ^~~~~~~~~~~~~~~~~
Matched #2: \bv3 = iconst\.i32 0\b
&gt; [-]                                 v0 = iconcat v2, v3
                                      ^~~~~~~~~~~~~~~~~~~
Matched #3: \bv0 = iconcat v2, v3\b
&gt; [-]                                 v1 = ineg v0
Missed #4: \bv5 = iconst\.i32 0\b
&gt; [Op1ret#c3]                         return
&gt; }
</pre></div>


<p>(with this diff from the current stuff)</p>
<div class="codehilite"><pre><span></span>diff --git a/cranelift-codegen/meta/src/isa/x86/mod.rs b/cranelift-codegen/meta/src/isa/x86/mod.rs
index 52d03f54..3fbd78b7 100644
--- a/cranelift-codegen/meta/src/isa/x86/mod.rs
+++ b/cranelift-codegen/meta/src/isa/x86/mod.rs
@@ -32,12 +32,13 @@ pub(crate) fn define(shared_defs: &amp;mut SharedDefinitions) -&gt; TargetIsa {
     let mut x86_32 = CpuMode::new(&quot;I32&quot;);

     let expand_flags = shared_defs.transform_groups.by_name(&quot;expand_flags&quot;);

+    let narrow_flags = shared_defs.transform_groups.by_name(&quot;narrow_flags&quot;);
     let widen = shared_defs.transform_groups.by_name(&quot;x86_widen&quot;);
     let x86_narrow = shared_defs.transform_groups.by_name(&quot;x86_narrow&quot;);
     let x86_expand = shared_defs.transform_groups.by_name(&quot;x86_expand&quot;);

     x86_32.legalize_monomorphic(expand_flags);

-    x86_32.legalize_default(x86_narrow);
+    x86_32.legalize_default(narrow_flags);
     x86_32.legalize_type(B1, expand_flags);
     x86_32.legalize_type(I8, widen);
     x86_32.legalize_type(I16, widen);
</pre></div>


</blockquote>



<a name="188240445"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231385%20Add%20ineg%20legalization%20for%20scalar%20int.../near/188240445" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231385.20Add.20ineg.20legalization.20for.20scalar.20int.2E.2E.2E.html#188240445">(Feb 14 2020 at 19:53)</a>:</h4>
<p>peterdelevoryas submitted <a href="https://github.com/bytecodealliance/cranelift/pull/1385#pullrequestreview-359183045" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1385#pullrequestreview-359183045">PR Review</a>.</p>



<a name="188240767"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231385%20Add%20ineg%20legalization%20for%20scalar%20int.../near/188240767" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231385.20Add.20ineg.20legalization.20for.20scalar.20int.2E.2E.2E.html#188240767">(Feb 14 2020 at 19:57)</a>:</h4>
<p>peterdelevoryas updated <a href="https://github.com/bytecodealliance/cranelift/pull/1385" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1385">PR #1385</a> (assigned to abrown) from <code>master</code> to <code>master</code>:</p>
<blockquote>
<ul>
<li>Closes #1383 </li>
<li>Cranelift already has custom legalization for ineg on vector integer types, might as well add it for scalar integer types!</li>
<li>This PR includes one new test case, it's relatively meager, maybe I could add cases for all the integer type variants? (i8, i16, i32, i64). Not sure if that's too much or not!</li>
<li>I don't know who could review this, maybe <code>bnjbvr</code> or <code>bjorn3</code>?</li>
</ul>
<p>I added some comments in the diff that refer to concerns I had</p>
</blockquote>



<a name="188247646"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231385%20Add%20ineg%20legalization%20for%20scalar%20int.../near/188247646" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231385.20Add.20ineg.20legalization.20for.20scalar.20int.2E.2E.2E.html#188247646">(Feb 14 2020 at 21:15)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/cranelift/pull/1385#pullrequestreview-359223200" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1385#pullrequestreview-359223200">PR Review</a>.</p>



<a name="188247701"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231385%20Add%20ineg%20legalization%20for%20scalar%20int.../near/188247701" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231385.20Add.20ineg.20legalization.20for.20scalar.20int.2E.2E.2E.html#188247701">(Feb 14 2020 at 21:16)</a>:</h4>
<p>abrown merged <a href="https://github.com/bytecodealliance/cranelift/pull/1385" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1385">PR #1385</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>