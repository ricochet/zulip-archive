<html>
<head><meta charset="utf-8"><title>cranelift / PR #1335 Allow &#x27;clif-util run&#x27; to read stdin ... · git-cranelift · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/index.html">git-cranelift</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231335.20Allow.20.27clif-util.20run.27.20to.20read.20stdin.20.2E.2E.2E.html">cranelift / PR #1335 Allow &#x27;clif-util run&#x27; to read stdin ...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="185357916"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231335%20Allow%20%27clif-util%20run%27%20to%20read%20stdin%20.../near/185357916" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231335.20Allow.20.27clif-util.20run.27.20to.20read.20stdin.20.2E.2E.2E.html#185357916">(Jan 10 2020 at 22:31)</a>:</h4>
<p>zummenix opened <a href="https://github.com/bytecodealliance/cranelift/pull/1335" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1335">PR #1335</a> from <code>clif-util-stdin</code> to <code>master</code>:</p>
<blockquote>
<p>This enables <code>clif-util run -</code> to work with stdin (seems it was intended initially).</p>
<p>Now errors in <code>iterate_files</code> are propagated further.</p>
<p>Closes #1004 </p>
</blockquote>



<a name="185359356"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231335%20Allow%20%27clif-util%20run%27%20to%20read%20stdin%20.../near/185359356" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231335.20Allow.20.27clif-util.20run.27.20to.20read.20stdin.20.2E.2E.2E.html#185359356">(Jan 10 2020 at 22:54)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/cranelift/pull/1335#pullrequestreview-341464442" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1335#pullrequestreview-341464442">PR Review</a>.</p>



<a name="185359358"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231335%20Allow%20%27clif-util%20run%27%20to%20read%20stdin%20.../near/185359358" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231335.20Allow.20.27clif-util.20run.27.20to.20read.20stdin.20.2E.2E.2E.html#185359358">(Jan 10 2020 at 22:54)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/cranelift/pull/1335#discussion_r365462352" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1335#discussion_r365462352">PR Review Comment</a>:</p>
<blockquote>
<p>I was a bit confused reading this but tell me if I understand this correctly: if we pass <code>"-"</code> inside <code>files</code> then <code>WalkDir</code> will give us an error; however, we _can_ turn <code>"-"</code> into a valid <code>PathBuf</code> by doing <code>e.path().into()</code>?</p>
</blockquote>



<a name="185374659"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231335%20Allow%20%27clif-util%20run%27%20to%20read%20stdin%20.../near/185374659" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231335.20Allow.20.27clif-util.20run.27.20to.20read.20stdin.20.2E.2E.2E.html#185374659">(Jan 11 2020 at 05:03)</a>:</h4>
<p>zummenix submitted <a href="https://github.com/bytecodealliance/cranelift/pull/1335#pullrequestreview-341504732" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1335#pullrequestreview-341504732">PR Review</a>.</p>



<a name="185374660"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231335%20Allow%20%27clif-util%20run%27%20to%20read%20stdin%20.../near/185374660" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231335.20Allow.20.27clif-util.20run.27.20to.20read.20stdin.20.2E.2E.2E.html#185374660">(Jan 11 2020 at 05:03)</a>:</h4>
<p>zummenix created <a href="https://github.com/bytecodealliance/cranelift/pull/1335#discussion_r365500243" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1335#discussion_r365500243">PR Review Comment</a>:</p>
<blockquote>
<p>Yes, that's correct. We propagate all paths that <code>WalkDir</code> wasn't able to deal with to <code>read_single_file</code> function. I agree this is a bit clever and confusing but I wasn't able to find a better way.</p>
</blockquote>



<a name="185525937"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231335%20Allow%20%27clif-util%20run%27%20to%20read%20stdin%20.../near/185525937" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231335.20Allow.20.27clif-util.20run.27.20to.20read.20stdin.20.2E.2E.2E.html#185525937">(Jan 13 2020 at 19:10)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/cranelift/pull/1335#pullrequestreview-342072437" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1335#pullrequestreview-342072437">PR Review</a>.</p>



<a name="185525938"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231335%20Allow%20%27clif-util%20run%27%20to%20read%20stdin%20.../near/185525938" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231335.20Allow.20.27clif-util.20run.27.20to.20read.20stdin.20.2E.2E.2E.html#185525938">(Jan 13 2020 at 19:10)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/cranelift/pull/1335#discussion_r365976758" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1335#discussion_r365976758">PR Review Comment</a>:</p>
<blockquote>
<p>What about the following approach: why don't we separate out any strings that we know to have special semantics and chain them on the end of the iterated files? E.g.:</p>
<div class="codehilite"><pre><span></span>let (normal_files, special_files) = drain_specials(files);
for file in iterate_files(normal_files).chain(special_files)
</pre></div>


<p>Where <code>drain_specials</code> could be something like (there's surely a better way):</p>
<div class="codehilite"><pre><span></span>/// This could use `drain_filter` instead but it is a nightly-only experimental API.
fn drain_specials(mut files: Vec&lt;String&gt;) -&gt; (Vec&lt;String&gt;, Vec&lt;String&gt;) {
    let mut normals = vec![];
    let mut specials = vec![];
    for s in files.drain(..) {
        match s.as_str() {
            &quot;-&quot; =&gt; specials.push(s),
            _ =&gt; normals.push(s),
        }
    }
    (normals, specials)
}
</pre></div>


<p>The reason I propose something like this is to avoid the catch-and-then-use of <code>e.path().into()</code> which feels hard to debug (and to read too, as you mention).</p>
</blockquote>



<a name="185526040"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231335%20Allow%20%27clif-util%20run%27%20to%20read%20stdin%20.../near/185526040" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231335.20Allow.20.27clif-util.20run.27.20to.20read.20stdin.20.2E.2E.2E.html#185526040">(Jan 13 2020 at 19:11)</a>:</h4>
<p>abrown edited <a href="https://github.com/bytecodealliance/cranelift/pull/1335#discussion_r365976758" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1335#discussion_r365976758">PR Review Comment</a>.</p>



<a name="185712791"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231335%20Allow%20%27clif-util%20run%27%20to%20read%20stdin%20.../near/185712791" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231335.20Allow.20.27clif-util.20run.27.20to.20read.20stdin.20.2E.2E.2E.html#185712791">(Jan 15 2020 at 16:10)</a>:</h4>
<p>zummenix created <a href="https://github.com/bytecodealliance/cranelift/pull/1335#discussion_r366965151" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1335#discussion_r366965151">PR Review Comment</a>:</p>
<blockquote>
<p>Does it make sense to have multiple stdin inputs? For example with <code>clif-util run - -</code> user fills in first input and then second. If not, then we can check if stdin arg exist, filter out all the <code>-</code> from <code>files</code> and <code>chain</code> the <code>-</code> at the end as you have proposed.</p>
</blockquote>



<a name="185712792"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231335%20Allow%20%27clif-util%20run%27%20to%20read%20stdin%20.../near/185712792" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231335.20Allow.20.27clif-util.20run.27.20to.20read.20stdin.20.2E.2E.2E.html#185712792">(Jan 15 2020 at 16:10)</a>:</h4>
<p>zummenix submitted <a href="https://github.com/bytecodealliance/cranelift/pull/1335#pullrequestreview-343337291" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1335#pullrequestreview-343337291">PR Review</a>.</p>



<a name="185716681"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231335%20Allow%20%27clif-util%20run%27%20to%20read%20stdin%20.../near/185716681" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231335.20Allow.20.27clif-util.20run.27.20to.20read.20stdin.20.2E.2E.2E.html#185716681">(Jan 15 2020 at 16:46)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/cranelift/pull/1335#pullrequestreview-343364656" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1335#pullrequestreview-343364656">PR Review</a>.</p>



<a name="185716682"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231335%20Allow%20%27clif-util%20run%27%20to%20read%20stdin%20.../near/185716682" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231335.20Allow.20.27clif-util.20run.27.20to.20read.20stdin.20.2E.2E.2E.html#185716682">(Jan 15 2020 at 16:46)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/cranelift/pull/1335#discussion_r366986117" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1335#discussion_r366986117">PR Review Comment</a>:</p>
<blockquote>
<p>Yeah, to me deduplicating special things like <code>-</code> makes sense.</p>
</blockquote>



<a name="185887435"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231335%20Allow%20%27clif-util%20run%27%20to%20read%20stdin%20.../near/185887435" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231335.20Allow.20.27clif-util.20run.27.20to.20read.20stdin.20.2E.2E.2E.html#185887435">(Jan 17 2020 at 04:38)</a>:</h4>
<p>zummenix updated <a href="https://github.com/bytecodealliance/cranelift/pull/1335" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1335">PR #1335</a> from <code>clif-util-stdin</code> to <code>master</code>:</p>
<blockquote>
<p>This enables <code>clif-util run -</code> to work with stdin (seems it was intended initially).</p>
<p>Now errors in <code>iterate_files</code> are propagated further.</p>
<p>Closes #1004 </p>
</blockquote>



<a name="185938976"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231335%20Allow%20%27clif-util%20run%27%20to%20read%20stdin%20.../near/185938976" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231335.20Allow.20.27clif-util.20run.27.20to.20read.20stdin.20.2E.2E.2E.html#185938976">(Jan 17 2020 at 17:36)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/cranelift/pull/1335#pullrequestreview-344734564" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1335#pullrequestreview-344734564">PR Review</a>.</p>



<a name="185939394"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231335%20Allow%20%27clif-util%20run%27%20to%20read%20stdin%20.../near/185939394" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231335.20Allow.20.27clif-util.20run.27.20to.20read.20stdin.20.2E.2E.2E.html#185939394">(Jan 17 2020 at 17:40)</a>:</h4>
<p>abrown merged <a href="https://github.com/bytecodealliance/cranelift/pull/1335" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1335">PR #1335</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>