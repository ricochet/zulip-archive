<html>
<head><meta charset="utf-8"><title>cranelift / Issue #1113 cranelift-module allows func decl... · git-cranelift · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/index.html">git-cranelift</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20Issue.20.231113.20cranelift-module.20allows.20func.20decl.2E.2E.2E.html">cranelift / Issue #1113 cranelift-module allows func decl...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="189361608"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20Issue%20%231113%20cranelift-module%20allows%20func%20decl.../near/189361608" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20Issue.20.231113.20cranelift-module.20allows.20func.20decl.2E.2E.2E.html#189361608">(Feb 28 2020 at 23:27)</a>:</h4>
<p>alexcrichton transferred <a href="https://github.com/bytecodealliance/cranelift/issues/1113" target="_blank" title="https://github.com/bytecodealliance/cranelift/issues/1113">Issue #1113</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>thread &#39;rustc&#39; panicked at &#39;inconsistent declarations: IncompatibleDeclaration { old: Defined(Function(FunctionDecl { scope: Local, visibility: Default, align: None })), new: Defined(Function(FunctionDecl { scope: Global, visibility: Default, align: None })) }&#39;, src/libcore/result.rs:1165:5
stack backtrace:
[...]
  15: core::result::unwrap_failed
             at src/libcore/result.rs:1165
  16: core::result::Result&lt;T,E&gt;::expect
             at /rustc/032a53a06ce293571e51bbe621a5c480e8a28e95/src/libcore/result.rs:960
  17: &lt;cranelift_faerie::backend::FaerieBackend as cranelift_module::backend::Backend&gt;::declare_function
             at /home/bjorn/.cargo/git/checkouts/cranelift-af8713b52459e6cd/ee6fe21/cranelift-faerie/src/backend.rs:127
  18: cranelift_module::module::Module&lt;B&gt;::declare_function
             at /home/bjorn/.cargo/git/checkouts/cranelift-af8713b52459e6cd/ee6fe21/cranelift-module/src/module.rs:426
[...]
</pre></div>


<div class="codehilite"><pre><span></span><span class="n">module</span><span class="p">.</span><span class="n">declare_function</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">Linkage</span>::<span class="n">Local</span><span class="p">,</span><span class="w"> </span><span class="n">sig</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span><span class="w"></span>
<span class="n">module</span><span class="p">.</span><span class="n">declare_function</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">Linkage</span>::<span class="n">Export</span><span class="p">,</span><span class="w"> </span><span class="n">sig</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span><span class="w"></span>
</pre></div>


<p>Either cranelift-module should forbid this, or faerie should allow this. Preferably the later.</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>