<html>
<head><meta charset="utf-8"><title>cranelift / Issue #1146 Figure out a better type during `... · git-cranelift · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/index.html">git-cranelift</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20Issue.20.231146.20Figure.20out.20a.20better.20type.20during.20.60.2E.2E.2E.html">cranelift / Issue #1146 Figure out a better type during `...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="189361624"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20Issue%20%231146%20Figure%20out%20a%20better%20type%20during%20%60.../near/189361624" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20Issue.20.231146.20Figure.20out.20a.20better.20type.20during.20.60.2E.2E.2E.html#189361624">(Feb 28 2020 at 23:27)</a>:</h4>
<p>alexcrichton transferred <a href="https://github.com/bytecodealliance/cranelift/issues/1146" target="_blank" title="https://github.com/bytecodealliance/cranelift/issues/1146">Issue #1146</a>:</p>
<blockquote>
<p>As noted in <a href="https://github.com/CraneStation/cranelift/pull/1120#discussion_r335156013" target="_blank" title="https://github.com/CraneStation/cranelift/pull/1120#discussion_r335156013">https://github.com/CraneStation/cranelift/pull/1120#discussion_r335156013</a>, when moving a scalar value (<code>I32</code> or <code>I64</code>) to a vector register in x86, the destination must be a a <code>I64x2</code> due to typing restrictions that ensure vectors have more than one lane. This may be rather confusing when looking at CLIF IR because the intent of that move (using the <code>bitcast</code> instruction) is to zero out the upper bits and only load the lower bits using the scalar value--it's more a <code>I128x1</code> than anything else.</p>
<p>There are several options here, some of which are:</p>
<ul>
<li>leave as-is with <code>I64x2</code> and remove the TODO comment</li>
<li>change the typing restrictions to allow <code>I128x1</code></li>
<li>use a different CLIF instruction altogether</li>
<li>etc.</li>
</ul>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>