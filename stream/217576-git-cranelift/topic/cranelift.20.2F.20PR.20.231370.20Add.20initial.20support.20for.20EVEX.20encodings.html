<html>
<head><meta charset="utf-8"><title>cranelift / PR #1370 Add initial support for EVEX encodings · git-cranelift · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/index.html">git-cranelift</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231370.20Add.20initial.20support.20for.20EVEX.20encodings.html">cranelift / PR #1370 Add initial support for EVEX encodings</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="186923209"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231370%20Add%20initial%20support%20for%20EVEX%20encodings/near/186923209" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231370.20Add.20initial.20support.20for.20EVEX.20encodings.html#186923209">(Jan 29 2020 at 20:02)</a>:</h4>
<p>abrown opened <a href="https://github.com/bytecodealliance/cranelift/pull/1370" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1370">PR #1370</a> from <code>evex</code> to <code>master</code>:</p>
<blockquote>
<ul>
<li>[x] This has been discussed in issue #1244.</li>
<li>[x] A short description of what this does, why it is needed: since the Wasm SIMD spec has re-added instructions (e.g. <code>i64x2.mul</code>) that are optimally encoded in VEX/EVEX, it seems like we should support these encoding formats. For this PR, only EVEX was added (and not every addressing form) in order to implement i64x2 multiplication. I haven't yet test-run this on an AVX512DQ-compatible CPU but will soon; while implementing this, I discovered that there is no good way to indicate an encoding that is predicated on either of two settings flags (see TODO in <code>encodings.rs</code>).</li>
<li>[x] This PR contains test cases, if meaningful.</li>
<li>[x] A reviewer from the core maintainer team has been assigned for this PR (I'm tagging people that might be interested in this).</li>
</ul>
</blockquote>



<a name="186923210"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231370%20Add%20initial%20support%20for%20EVEX%20encodings/near/186923210" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231370.20Add.20initial.20support.20for.20EVEX.20encodings.html#186923210">(Jan 29 2020 at 20:02)</a>:</h4>
<p><strong>abrown</strong> requested <a href="https://github.com/bnjbvr" target="_blank" title="https://github.com/bnjbvr">bnjbvr</a>, <a href="https://github.com/sunfishcode" target="_blank" title="https://github.com/sunfishcode">sunfishcode</a>, and <a href="https://github.com/julian-seward1" target="_blank" title="https://github.com/julian-seward1">julian-seward1</a> for a review on <a href="https://github.com/bytecodealliance/cranelift/pull/1370" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1370">PR #1370</a>.</p>



<a name="186923212"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231370%20Add%20initial%20support%20for%20EVEX%20encodings/near/186923212" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231370.20Add.20initial.20support.20for.20EVEX.20encodings.html#186923212">(Jan 29 2020 at 20:02)</a>:</h4>
<p><strong>abrown</strong> requested <a href="https://github.com/bnjbvr" target="_blank" title="https://github.com/bnjbvr">bnjbvr</a>, <a href="https://github.com/sunfishcode" target="_blank" title="https://github.com/sunfishcode">sunfishcode</a>, and <a href="https://github.com/julian-seward1" target="_blank" title="https://github.com/julian-seward1">julian-seward1</a> for a review on <a href="https://github.com/bytecodealliance/cranelift/pull/1370" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1370">PR #1370</a>.</p>



<a name="186923213"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231370%20Add%20initial%20support%20for%20EVEX%20encodings/near/186923213" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231370.20Add.20initial.20support.20for.20EVEX.20encodings.html#186923213">(Jan 29 2020 at 20:02)</a>:</h4>
<p><strong>abrown</strong> requested <a href="https://github.com/bnjbvr" target="_blank" title="https://github.com/bnjbvr">bnjbvr</a>, <a href="https://github.com/sunfishcode" target="_blank" title="https://github.com/sunfishcode">sunfishcode</a>, and <a href="https://github.com/julian-seward1" target="_blank" title="https://github.com/julian-seward1">julian-seward1</a> for a review on <a href="https://github.com/bytecodealliance/cranelift/pull/1370" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1370">PR #1370</a>.</p>



<a name="186923520"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231370%20Add%20initial%20support%20for%20EVEX%20encodings/near/186923520" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231370.20Add.20initial.20support.20for.20EVEX.20encodings.html#186923520">(Jan 29 2020 at 20:05)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/cranelift/pull/1370#discussion_r372603323" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1370#discussion_r372603323">PR Review Comment</a>:</p>
<blockquote>
<p>I don't think I understand how <code>RegUnit</code> is being packed, I'm afraid. EVEX (and VEX) support larger numbers of registers so I attempted to extract the next bit to use in the bits that EVEX uses to extend the set of possible registers (e.g. <code>XRBR'V'</code>)--this seems to give the wrong answer. How would I tell Cranelift that EVEX has more registers available?</p>
</blockquote>



<a name="186923521"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231370%20Add%20initial%20support%20for%20EVEX%20encodings/near/186923521" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231370.20Add.20initial.20support.20for.20EVEX.20encodings.html#186923521">(Jan 29 2020 at 20:05)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/cranelift/pull/1370#pullrequestreview-350389398" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1370#pullrequestreview-350389398">PR Review</a>.</p>



<a name="186923667"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231370%20Add%20initial%20support%20for%20EVEX%20encodings/near/186923667" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231370.20Add.20initial.20support.20for.20EVEX.20encodings.html#186923667">(Jan 29 2020 at 20:07)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/cranelift/pull/1370#pullrequestreview-350390341" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1370#pullrequestreview-350390341">PR Review</a>.</p>



<a name="186923668"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231370%20Add%20initial%20support%20for%20EVEX%20encodings/near/186923668" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231370.20Add.20initial.20support.20for.20EVEX.20encodings.html#186923668">(Jan 29 2020 at 20:07)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/cranelift/pull/1370#discussion_r372604031" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1370#discussion_r372604031">PR Review Comment</a>:</p>
<blockquote>
<p>The [wikipedia article] is also helpful if you don't want to crack open the Intel manual; maybe I will link to it in the documentation.</p>
<p>[wikipedia article]: <a href="https://en.wikipedia.org/wiki/EVEX_prefix" target="_blank" title="https://en.wikipedia.org/wiki/EVEX_prefix">https://en.wikipedia.org/wiki/EVEX_prefix</a></p>
</blockquote>



<a name="187476619"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231370%20Add%20initial%20support%20for%20EVEX%20encodings/near/187476619" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231370.20Add.20initial.20support.20for.20EVEX.20encodings.html#187476619">(Feb 05 2020 at 17:44)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/cranelift/pull/1370" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1370">PR #1370</a> from <code>evex</code> to <code>master</code>:</p>
<blockquote>
<ul>
<li>[x] This has been discussed in issue #1244.</li>
<li>[x] A short description of what this does, why it is needed: since the Wasm SIMD spec has re-added instructions (e.g. <code>i64x2.mul</code>) that are optimally encoded in VEX/EVEX, it seems like we should support these encoding formats. For this PR, only EVEX was added (and not every addressing form) in order to implement i64x2 multiplication. I haven't yet test-run this on an AVX512DQ-compatible CPU but will soon; while implementing this, I discovered that there is no good way to indicate an encoding that is predicated on either of two settings flags (see TODO in <code>encodings.rs</code>).</li>
<li>[x] This PR contains test cases, if meaningful.</li>
<li>[x] A reviewer from the core maintainer team has been assigned for this PR (I'm tagging people that might be interested in this).</li>
</ul>
</blockquote>



<a name="188069772"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231370%20Add%20initial%20support%20for%20EVEX%20encodings/near/188069772" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231370.20Add.20initial.20support.20for.20EVEX.20encodings.html#188069772">(Feb 13 2020 at 01:05)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/cranelift/pull/1370" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1370">PR #1370</a> from <code>evex</code> to <code>master</code>:</p>
<blockquote>
<ul>
<li>[x] This has been discussed in issue #1244.</li>
<li>[x] A short description of what this does, why it is needed: since the Wasm SIMD spec has re-added instructions (e.g. <code>i64x2.mul</code>) that are optimally encoded in VEX/EVEX, it seems like we should support these encoding formats. For this PR, only EVEX was added (and not every addressing form) in order to implement i64x2 multiplication. I haven't yet test-run this on an AVX512DQ-compatible CPU but will soon; while implementing this, I discovered that there is no good way to indicate an encoding that is predicated on either of two settings flags (see TODO in <code>encodings.rs</code>).</li>
<li>[x] This PR contains test cases, if meaningful.</li>
<li>[x] A reviewer from the core maintainer team has been assigned for this PR (I'm tagging people that might be interested in this).</li>
</ul>
</blockquote>



<a name="188070036"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231370%20Add%20initial%20support%20for%20EVEX%20encodings/near/188070036" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231370.20Add.20initial.20support.20for.20EVEX.20encodings.html#188070036">(Feb 13 2020 at 01:11)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/cranelift/pull/1370#pullrequestreview-357897136" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1370#pullrequestreview-357897136">PR Review</a>.</p>



<a name="188070038"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231370%20Add%20initial%20support%20for%20EVEX%20encodings/near/188070038" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231370.20Add.20initial.20support.20for.20EVEX.20encodings.html#188070038">(Feb 13 2020 at 01:11)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/cranelift/pull/1370#discussion_r378601997" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1370#discussion_r378601997">PR Review Comment</a>:</p>
<blockquote>
<p>@bnjbvr, this (and the <code>.units(32)</code> above) is causing test failures that I don't understand:</p>
<ul>
<li><a href="https://github.com/bytecodealliance/cranelift/blob/21516e5e988e70d1ff453de7c0b22ad58fe464a0/cranelift-codegen/src/isa/x86/registers.rs#L27" target="_blank" title="https://github.com/bytecodealliance/cranelift/blob/21516e5e988e70d1ff453de7c0b22ad58fe464a0/cranelift-codegen/src/isa/x86/registers.rs#L27"><code>isa::x86::registers::tests::unit_encodings</code></a> is failing because now the GPRs miraculously have more units so <code>%xmm0</code> starts at <code>Some(32)</code></li>
<li>similarly the <a href="https://github.com/bytecodealliance/cranelift/blob/21516e5e988e70d1ff453de7c0b22ad58fe464a0/cranelift-codegen/src/isa/x86/registers.rs#L47" target="_blank" title="https://github.com/bytecodealliance/cranelift/blob/21516e5e988e70d1ff453de7c0b22ad58fe464a0/cranelift-codegen/src/isa/x86/registers.rs#L47"><code>unit_names</code></a> test thinks the reg index <code>16</code> is invalid</li>
</ul>
<p>What is going on?</p>
</blockquote>



<a name="188072409"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231370%20Add%20initial%20support%20for%20EVEX%20encodings/near/188072409" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231370.20Add.20initial.20support.20for.20EVEX.20encodings.html#188072409">(Feb 13 2020 at 02:14)</a>:</h4>
<p>iximeow submitted <a href="https://github.com/bytecodealliance/cranelift/pull/1370#pullrequestreview-357915401" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1370#pullrequestreview-357915401">PR Review</a>.</p>



<a name="188072410"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231370%20Add%20initial%20support%20for%20EVEX%20encodings/near/188072410" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231370.20Add.20initial.20support.20for.20EVEX.20encodings.html#188072410">(Feb 13 2020 at 02:14)</a>:</h4>
<p>iximeow created <a href="https://github.com/bytecodealliance/cranelift/pull/1370#discussion_r378617654" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1370#discussion_r378617654">PR Review Comment</a>:</p>
<blockquote>
<p>I think you're running afoul of <a href="https://github.com/bytecodealliance/cranelift/blob/5602d1564c4121e4703843f23cc083dfb29c5592/cranelift-codegen/meta/src/cdsl/regs.rs#L240-L247" target="_blank" title="https://github.com/bytecodealliance/cranelift/blob/5602d1564c4121e4703843f23cc083dfb29c5592/cranelift-codegen/meta/src/cdsl/regs.rs#L240-L247">https://github.com/bytecodealliance/cranelift/blob/5602d1564c4121e4703843f23cc083dfb29c5592/cranelift-codegen/meta/src/cdsl/regs.rs#L240-L247</a> which bumps the start of <code>FPR</code> to be aligned with its size. In theory you could add the expanded FPR first, then GPR, and everything should be okay?</p>
</blockquote>



<a name="188072989"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231370%20Add%20initial%20support%20for%20EVEX%20encodings/near/188072989" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231370.20Add.20initial.20support.20for.20EVEX.20encodings.html#188072989">(Feb 13 2020 at 02:31)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/cranelift/pull/1370#pullrequestreview-357920053" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1370#pullrequestreview-357920053">PR Review</a>.</p>



<a name="188072990"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231370%20Add%20initial%20support%20for%20EVEX%20encodings/near/188072990" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231370.20Add.20initial.20support.20for.20EVEX.20encodings.html#188072990">(Feb 13 2020 at 02:31)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/cranelift/pull/1370#discussion_r378621612" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1370#discussion_r378621612">PR Review Comment</a>:</p>
<blockquote>
<p>Aha!</p>
</blockquote>



<a name="188133615"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231370%20Add%20initial%20support%20for%20EVEX%20encodings/near/188133615" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231370.20Add.20initial.20support.20for.20EVEX.20encodings.html#188133615">(Feb 13 2020 at 18:13)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/cranelift/pull/1370#pullrequestreview-358441342" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1370#pullrequestreview-358441342">PR Review</a>.</p>



<a name="188133616"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231370%20Add%20initial%20support%20for%20EVEX%20encodings/near/188133616" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231370.20Add.20initial.20support.20for.20EVEX.20encodings.html#188133616">(Feb 13 2020 at 18:13)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/cranelift/pull/1370#discussion_r379032571" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1370#discussion_r379032571">PR Review Comment</a>:</p>
<blockquote>
<p>Hm, too quick to celebrate: I tried moving the <code>RegBankBuilder::new("FloatRegs"...</code> with the newly-expanded 32 units up above the <code>RegBankBuilder::new("IntRegs"...</code> but now the meta build crashes <a href="https://github.com/bytecodealliance/cranelift/blob/5602d1564c4121e4703843f23cc083dfb29c5592/cranelift-codegen/meta/src/isa/x86/recipes.rs#L430" target="_blank" title="https://github.com/bytecodealliance/cranelift/blob/5602d1564c4121e4703843f23cc083dfb29c5592/cranelift-codegen/meta/src/isa/x86/recipes.rs#L430">due to r15</a> with a backtrace of:</p>
<div class="codehilite"><pre><span></span>thread &#39;main&#39; panicked at &#39;attempt to subtract with overflow&#39;, cranelift-codegen/meta/src/cdsl/regs.rs:60:25
stack backtrace:
...
  15: cranelift_codegen_meta::cdsl::regs::RegBank::unit_by_name
             at cranelift-codegen/meta/src/cdsl/regs.rs:60
  16: cranelift_codegen_meta::cdsl::regs::IsaRegs::regunit_by_name
             at cranelift-codegen/meta/src/cdsl/regs.rs:410
  17: cranelift_codegen_meta::isa::x86::recipes::define
             at cranelift-codegen/meta/src/isa/x86/recipes.rs:430
  18: cranelift_codegen_meta::isa::x86::define
             at cranelift-codegen/meta/src/isa/x86/mod.rs:61
  19: cranelift_codegen_meta::isa::define::{{closure}}
             at cranelift-codegen/meta/src/isa/mod.rs:62
...
</pre></div>


</blockquote>



<a name="188136237"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231370%20Add%20initial%20support%20for%20EVEX%20encodings/near/188136237" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231370.20Add.20initial.20support.20for.20EVEX.20encodings.html#188136237">(Feb 13 2020 at 18:40)</a>:</h4>
<p>iximeow submitted <a href="https://github.com/bytecodealliance/cranelift/pull/1370#pullrequestreview-358459354" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1370#pullrequestreview-358459354">PR Review</a>.</p>



<a name="188136238"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231370%20Add%20initial%20support%20for%20EVEX%20encodings/near/188136238" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231370.20Add.20initial.20support.20for.20EVEX.20encodings.html#188136238">(Feb 13 2020 at 18:40)</a>:</h4>
<p>iximeow created <a href="https://github.com/bytecodealliance/cranelift/pull/1370#discussion_r379046928" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1370#discussion_r379046928">PR Review Comment</a>:</p>
<blockquote>
<p>I think the failing assert is in error, f.ex <code>let reg_xmm1 = Register::new(fpr, regs.regunit_by_name(fpr, "xmm1"));</code> currently asserts for the same reason on master. It looks like <code>unit_by_name</code> shouldn't even trying to subtract from the register number (<code>15</code> in <code>r15</code>), and happens to work out so long as the specified reg class starts at 0 - subtract by 0 won't underflow.</p>
<p>I think instead <code>unit_by_name</code> ought to be checking just that <code>as_num &lt; self.units</code>, and return <code>self.first_unit + as_num</code> like it would below?</p>
</blockquote>



<a name="188166519"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231370%20Add%20initial%20support%20for%20EVEX%20encodings/near/188166519" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231370.20Add.20initial.20support.20for.20EVEX.20encodings.html#188166519">(Feb 14 2020 at 00:12)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/cranelift/pull/1370" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1370">PR #1370</a> from <code>evex</code> to <code>master</code>:</p>
<blockquote>
<ul>
<li>[x] This has been discussed in issue #1244.</li>
<li>[x] A short description of what this does, why it is needed: since the Wasm SIMD spec has re-added instructions (e.g. <code>i64x2.mul</code>) that are optimally encoded in VEX/EVEX, it seems like we should support these encoding formats. For this PR, only EVEX was added (and not every addressing form) in order to implement i64x2 multiplication. I haven't yet test-run this on an AVX512DQ-compatible CPU but will soon; while implementing this, I discovered that there is no good way to indicate an encoding that is predicated on either of two settings flags (see TODO in <code>encodings.rs</code>).</li>
<li>[x] This PR contains test cases, if meaningful.</li>
<li>[x] A reviewer from the core maintainer team has been assigned for this PR (I'm tagging people that might be interested in this).</li>
</ul>
</blockquote>



<a name="188166850"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231370%20Add%20initial%20support%20for%20EVEX%20encodings/near/188166850" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231370.20Add.20initial.20support.20for.20EVEX.20encodings.html#188166850">(Feb 14 2020 at 00:18)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/cranelift/pull/1370#pullrequestreview-358642208" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1370#pullrequestreview-358642208">PR Review</a>.</p>



<a name="188166851"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231370%20Add%20initial%20support%20for%20EVEX%20encodings/near/188166851" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231370.20Add.20initial.20support.20for.20EVEX.20encodings.html#188166851">(Feb 14 2020 at 00:18)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/cranelift/pull/1370#discussion_r379191482" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1370#discussion_r379191482">PR Review Comment</a>:</p>
<blockquote>
<p>You're right. I pushed b0ee482 to fix that and b52fbdd to show what happens when I move the XMM registers first:</p>
<ul>
<li>failures in <code>unit_names</code> and <code>unit_encodings</code> because, e.g., rax is no longer the first register; these can be fixed and are not a real problem</li>
<li>failures with unwinding (<code>test_*_alloc</code> and <code>windows_fastcall_x64_unwind.clif</code>): @peterhuene, it looks like the unwind info uses the register index directly; if I change a bunch of register indexes, does this completely break unwinding?</li>
<li>a failure in <code>simd-arithmetic-binemit.clif</code> is expected; that's what I'm currently working on</li>
<li>a failure in <code>pinned-reg.clif</code> like <code>panicked in worker #1: Couldn't clear fixed output interference for v1</code>; @bnjbvr, do you have any comment on this? Will changing the register indexes break regalloc?</li>
</ul>
</blockquote>



<a name="188170297"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231370%20Add%20initial%20support%20for%20EVEX%20encodings/near/188170297" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231370.20Add.20initial.20support.20for.20EVEX.20encodings.html#188170297">(Feb 14 2020 at 01:20)</a>:</h4>
<p>iximeow submitted <a href="https://github.com/bytecodealliance/cranelift/pull/1370#pullrequestreview-358661585" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1370#pullrequestreview-358661585">PR Review</a>.</p>



<a name="188170298"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231370%20Add%20initial%20support%20for%20EVEX%20encodings/near/188170298" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231370.20Add.20initial.20support.20for.20EVEX.20encodings.html#188170298">(Feb 14 2020 at 01:20)</a>:</h4>
<p>iximeow created <a href="https://github.com/bytecodealliance/cranelift/pull/1370#discussion_r379208119" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1370#discussion_r379208119">PR Review Comment</a>:</p>
<blockquote>
<p>I was afraid there'd be some breakages like that :(</p>
<p>I noticed Windows unwinding using the regunit as an integer directly when fixing XMM preservation. Changing indices around will break it, but straightforward to fix: something like <a href="https://github.com/bytecodealliance/cranelift/pull/1378/files#diff-c720e722fabb16edd5e9ce3554ee7f5dR85" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1378/files#diff-c720e722fabb16edd5e9ce3554ee7f5dR85">this</a> but using <code>GPR.first</code>?</p>
<p>To the regalloc point, <code>pinned_reg</code> also accidentally depends on GPRs being first: <a href="https://github.com/bytecodealliance/cranelift/blob/master/cranelift-codegen/src/isa/registers.rs#L204-L209" target="_blank" title="https://github.com/bytecodealliance/cranelift/blob/master/cranelift-codegen/src/isa/registers.rs#L204-L209"><code>is_pinned_reg</code></a> tests against <code>pinned_reg</code> directly, where the ISA builder stores the provided <code>pinned_reg</code> <a href="https://github.com/bytecodealliance/cranelift/blob/master/cranelift-codegen/meta/src/cdsl/regs.rs#L216-L220" target="_blank" title="https://github.com/bytecodealliance/cranelift/blob/master/cranelift-codegen/meta/src/cdsl/regs.rs#L216-L220">without translation</a> and when building the x86 ISA description it's passed <a href="https://github.com/bytecodealliance/cranelift/blob/master/cranelift-codegen/meta/src/isa/x86/registers.rs#L10" target="_blank" title="https://github.com/bytecodealliance/cranelift/blob/master/cranelift-codegen/meta/src/isa/x86/registers.rs#L10">the literal 15</a>. <code>pinned_reg</code> in the generated ISA should probably be offset from the start of its RegClass, so <a href="https://github.com/bytecodealliance/cranelift/blob/master/cranelift-codegen/meta/src/gen_registers.rs#L60" target="_blank" title="https://github.com/bytecodealliance/cranelift/blob/master/cranelift-codegen/meta/src/gen_registers.rs#L60"><code>reg_bank.pinned_reg</code></a> ought to be <code>reg_bank.pinned_reg + reg_bank.first_unit + reg_class.start</code>.</p>
<p>I think fixing dependence on <code>GPR.first == 0</code> would be a good PR independent of EVEX encoding, though I dunno how much of this will be replaced with New Backend Plans. (this is where stop talking and wait for Benjamin :D)</p>
</blockquote>



<a name="188171882"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231370%20Add%20initial%20support%20for%20EVEX%20encodings/near/188171882" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231370.20Add.20initial.20support.20for.20EVEX.20encodings.html#188171882">(Feb 14 2020 at 01:55)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/cranelift/pull/1370#discussion_r379216301" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1370#discussion_r379216301">PR Review Comment</a>:</p>
<blockquote>
<p>@iximeow I think your proposed fix for the GPRs in the Windows unwind information makes sense.</p>
</blockquote>



<a name="188171883"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231370%20Add%20initial%20support%20for%20EVEX%20encodings/near/188171883" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231370.20Add.20initial.20support.20for.20EVEX.20encodings.html#188171883">(Feb 14 2020 at 01:55)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/cranelift/pull/1370#pullrequestreview-358671186" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1370#pullrequestreview-358671186">PR Review</a>.</p>



<a name="188239850"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231370%20Add%20initial%20support%20for%20EVEX%20encodings/near/188239850" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231370.20Add.20initial.20support.20for.20EVEX.20encodings.html#188239850">(Feb 14 2020 at 19:46)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/cranelift/pull/1370" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1370">PR #1370</a> from <code>evex</code> to <code>master</code>:</p>
<blockquote>
<ul>
<li>[x] This has been discussed in issue #1244.</li>
<li>[x] A short description of what this does, why it is needed: since the Wasm SIMD spec has re-added instructions (e.g. <code>i64x2.mul</code>) that are optimally encoded in VEX/EVEX, it seems like we should support these encoding formats. For this PR, only EVEX was added (and not every addressing form) in order to implement i64x2 multiplication. I haven't yet test-run this on an AVX512DQ-compatible CPU but will soon; while implementing this, I discovered that there is no good way to indicate an encoding that is predicated on either of two settings flags (see TODO in <code>encodings.rs</code>).</li>
<li>[x] This PR contains test cases, if meaningful.</li>
<li>[x] A reviewer from the core maintainer team has been assigned for this PR (I'm tagging people that might be interested in this).</li>
</ul>
</blockquote>



<a name="188248363"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231370%20Add%20initial%20support%20for%20EVEX%20encodings/near/188248363" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231370.20Add.20initial.20support.20for.20EVEX.20encodings.html#188248363">(Feb 14 2020 at 21:24)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/cranelift/pull/1370" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1370">PR #1370</a> from <code>evex</code> to <code>master</code>:</p>
<blockquote>
<ul>
<li>[x] This has been discussed in issue #1244.</li>
<li>[x] A short description of what this does, why it is needed: since the Wasm SIMD spec has re-added instructions (e.g. <code>i64x2.mul</code>) that are optimally encoded in VEX/EVEX, it seems like we should support these encoding formats. For this PR, only EVEX was added (and not every addressing form) in order to implement i64x2 multiplication. I haven't yet test-run this on an AVX512DQ-compatible CPU but will soon; while implementing this, I discovered that there is no good way to indicate an encoding that is predicated on either of two settings flags (see TODO in <code>encodings.rs</code>).</li>
<li>[x] This PR contains test cases, if meaningful.</li>
<li>[x] A reviewer from the core maintainer team has been assigned for this PR (I'm tagging people that might be interested in this).</li>
</ul>
</blockquote>



<a name="188248410"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231370%20Add%20initial%20support%20for%20EVEX%20encodings/near/188248410" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231370.20Add.20initial.20support.20for.20EVEX.20encodings.html#188248410">(Feb 14 2020 at 21:24)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/cranelift/pull/1370" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1370">PR #1370</a> from <code>evex</code> to <code>master</code>:</p>
<blockquote>
<ul>
<li>[x] This has been discussed in issue #1244.</li>
<li>[x] A short description of what this does, why it is needed: since the Wasm SIMD spec has re-added instructions (e.g. <code>i64x2.mul</code>) that are optimally encoded in VEX/EVEX, it seems like we should support these encoding formats. For this PR, only EVEX was added (and not every addressing form) in order to implement i64x2 multiplication. I haven't yet test-run this on an AVX512DQ-compatible CPU but will soon; while implementing this, I discovered that there is no good way to indicate an encoding that is predicated on either of two settings flags (see TODO in <code>encodings.rs</code>).</li>
<li>[x] This PR contains test cases, if meaningful.</li>
<li>[x] A reviewer from the core maintainer team has been assigned for this PR (I'm tagging people that might be interested in this).</li>
</ul>
</blockquote>



<a name="188248504"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231370%20Add%20initial%20support%20for%20EVEX%20encodings/near/188248504" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231370.20Add.20initial.20support.20for.20EVEX.20encodings.html#188248504">(Feb 14 2020 at 21:25)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/cranelift/pull/1370#pullrequestreview-359227729" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1370#pullrequestreview-359227729">PR Review</a>.</p>



<a name="188248505"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231370%20Add%20initial%20support%20for%20EVEX%20encodings/near/188248505" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231370.20Add.20initial.20support.20for.20EVEX.20encodings.html#188248505">(Feb 14 2020 at 21:25)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/cranelift/pull/1370#discussion_r379651320" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1370#discussion_r379651320">PR Review Comment</a>:</p>
<blockquote>
<p>I've figured this out... finally <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span>.</p>
</blockquote>



<a name="188249670"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231370%20Add%20initial%20support%20for%20EVEX%20encodings/near/188249670" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231370.20Add.20initial.20support.20for.20EVEX.20encodings.html#188249670">(Feb 14 2020 at 21:40)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/cranelift/pull/1370" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1370">PR #1370</a> from <code>evex</code> to <code>master</code>:</p>
<blockquote>
<ul>
<li>[x] This has been discussed in issue #1244.</li>
<li>[x] A short description of what this does, why it is needed: since the Wasm SIMD spec has re-added instructions (e.g. <code>i64x2.mul</code>) that are optimally encoded in VEX/EVEX, it seems like we should support these encoding formats. For this PR, only EVEX was added (and not every addressing form) in order to implement i64x2 multiplication. I haven't yet test-run this on an AVX512DQ-compatible CPU but will soon; while implementing this, I discovered that there is no good way to indicate an encoding that is predicated on either of two settings flags (see TODO in <code>encodings.rs</code>).</li>
<li>[x] This PR contains test cases, if meaningful.</li>
<li>[x] A reviewer from the core maintainer team has been assigned for this PR (I'm tagging people that might be interested in this).</li>
</ul>
</blockquote>



<a name="188473082"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231370%20Add%20initial%20support%20for%20EVEX%20encodings/near/188473082" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231370.20Add.20initial.20support.20for.20EVEX.20encodings.html#188473082">(Feb 18 2020 at 17:41)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/cranelift/pull/1370" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1370">PR #1370</a> from <code>evex</code> to <code>master</code>:</p>
<blockquote>
<ul>
<li>[x] This has been discussed in issue #1244.</li>
<li>[x] A short description of what this does, why it is needed: since the Wasm SIMD spec has re-added instructions (e.g. <code>i64x2.mul</code>) that are optimally encoded in VEX/EVEX, it seems like we should support these encoding formats. For this PR, only EVEX was added (and not every addressing form) in order to implement i64x2 multiplication. I haven't yet test-run this on an AVX512DQ-compatible CPU but will soon; while implementing this, I discovered that there is no good way to indicate an encoding that is predicated on either of two settings flags (see TODO in <code>encodings.rs</code>).</li>
<li>[x] This PR contains test cases, if meaningful.</li>
<li>[x] A reviewer from the core maintainer team has been assigned for this PR (I'm tagging people that might be interested in this).</li>
</ul>
</blockquote>



<a name="189800982"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231370%20Add%20initial%20support%20for%20EVEX%20encodings/near/189800982" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231370.20Add.20initial.20support.20for.20EVEX.20encodings.html#189800982">(Mar 05 2020 at 15:13)</a>:</h4>
<p>bnjbvr closed without merge <a href="https://github.com/bytecodealliance/cranelift/pull/1370" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1370">PR #1370</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>