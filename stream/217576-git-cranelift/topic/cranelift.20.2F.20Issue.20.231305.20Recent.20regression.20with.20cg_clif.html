<html>
<head><meta charset="utf-8"><title>cranelift / Issue #1305 Recent regression with cg_clif · git-cranelift · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/index.html">git-cranelift</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20Issue.20.231305.20Recent.20regression.20with.20cg_clif.html">cranelift / Issue #1305 Recent regression with cg_clif</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="183972431"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20Issue%20%231305%20Recent%20regression%20with%20cg_clif/near/183972431" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20Issue.20.231305.20Recent.20regression.20with.20cg_clif.html#183972431">(Dec 20 2019 at 20:58)</a>:</h4>
<p>bjorn3 opened <a href="https://github.com/bytecodealliance/cranelift/issues/1305" target="_blank" title="https://github.com/bytecodealliance/cranelift/issues/1305">Issue #1305</a>:</p>
<blockquote>
<ul>
<li>
<p>What are the steps to reproduce the issue? Can you include a CLIF test case,<br>
  ideally reduced with the <code>bugpoint</code> clif-util command? <a href="https://travis-ci.org/bjorn3/rustc_codegen_cranelift/jobs/627882870" target="_blank" title="https://travis-ci.org/bjorn3/rustc_codegen_cranelift/jobs/627882870">https://travis-ci.org/bjorn3/rustc_codegen_cranelift/jobs/627882870</a></p>
</li>
<li>
<p>What do you expect to happen? What does actually happen? Does it panic, and<br>
  if so, with which assertion? SIGSEGV in coretests test.</p>
</li>
<li>
<p>Which Cranelift version / commit hash / branch are you using? e0d317249194f51a80c97a856f96eea1560c5435</p>
</li>
</ul>
<p>Regression range: <a href="https://github.com/bytecodealliance/cranelift/compare/ec787eb281bb2e18e191508c17abe694e91f0677...e0d317249194f51a80c97a856f96eea1560c5435" target="_blank" title="https://github.com/bytecodealliance/cranelift/compare/ec787eb281bb2e18e191508c17abe694e91f0677...e0d317249194f51a80c97a856f96eea1560c5435">https://github.com/bytecodealliance/cranelift/compare/ec787eb281bb2e18e191508c17abe694e91f0677...e0d317249194f51a80c97a856f96eea1560c5435</a></p>
<p>Likely caused by #1298 (cc @sstangl)</p>
</blockquote>



<a name="183972433"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20Issue%20%231305%20Recent%20regression%20with%20cg_clif/near/183972433" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20Issue.20.231305.20Recent.20regression.20with.20cg_clif.html#183972433">(Dec 20 2019 at 20:58)</a>:</h4>
<p>bjorn3 labeled <a href="https://github.com/bytecodealliance/cranelift/issues/1305" target="_blank" title="https://github.com/bytecodealliance/cranelift/issues/1305">Issue #1305</a>:</p>
<blockquote>
<ul>
<li>
<p>What are the steps to reproduce the issue? Can you include a CLIF test case,<br>
  ideally reduced with the <code>bugpoint</code> clif-util command? <a href="https://travis-ci.org/bjorn3/rustc_codegen_cranelift/jobs/627882870" target="_blank" title="https://travis-ci.org/bjorn3/rustc_codegen_cranelift/jobs/627882870">https://travis-ci.org/bjorn3/rustc_codegen_cranelift/jobs/627882870</a></p>
</li>
<li>
<p>What do you expect to happen? What does actually happen? Does it panic, and<br>
  if so, with which assertion? SIGSEGV in coretests test.</p>
</li>
<li>
<p>Which Cranelift version / commit hash / branch are you using? e0d317249194f51a80c97a856f96eea1560c5435</p>
</li>
</ul>
<p>Regression range: <a href="https://github.com/bytecodealliance/cranelift/compare/ec787eb281bb2e18e191508c17abe694e91f0677...e0d317249194f51a80c97a856f96eea1560c5435" target="_blank" title="https://github.com/bytecodealliance/cranelift/compare/ec787eb281bb2e18e191508c17abe694e91f0677...e0d317249194f51a80c97a856f96eea1560c5435">https://github.com/bytecodealliance/cranelift/compare/ec787eb281bb2e18e191508c17abe694e91f0677...e0d317249194f51a80c97a856f96eea1560c5435</a></p>
<p>Likely caused by #1298 (cc @sstangl)</p>
</blockquote>



<a name="183972793"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20Issue%20%231305%20Recent%20regression%20with%20cg_clif/near/183972793" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20Issue.20.231305.20Recent.20regression.20with.20cg_clif.html#183972793">(Dec 20 2019 at 21:02)</a>:</h4>
<p>sstangl <a href="https://github.com/bytecodealliance/cranelift/issues/1305#issuecomment-568086497" target="_blank" title="https://github.com/bytecodealliance/cranelift/issues/1305#issuecomment-568086497">commented</a> on <a href="https://github.com/bytecodealliance/cranelift/issues/1305" target="_blank" title="https://github.com/bytecodealliance/cranelift/issues/1305">Issue #1305</a>:</p>
<blockquote>
<p>Is there a way this can be reproduced? Even without a CLIF file, the change could be reversed piecewise by changing the <code>i32_i64</code> function to <code>i32_i64_explicit_rex</code>, at least narrowing down which recipe is likely responsible.</p>
</blockquote>



<a name="183973515"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20Issue%20%231305%20Recent%20regression%20with%20cg_clif/near/183973515" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20Issue.20.231305.20Recent.20regression.20with.20cg_clif.html#183973515">(Dec 20 2019 at 21:10)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/cranelift/issues/1305#issuecomment-568088910" target="_blank" title="https://github.com/bytecodealliance/cranelift/issues/1305#issuecomment-568088910">commented</a> on <a href="https://github.com/bytecodealliance/cranelift/issues/1305" target="_blank" title="https://github.com/bytecodealliance/cranelift/issues/1305">Issue #1305</a>:</p>
<blockquote>
<p>Just follow the build instructions of <a href="https://github.com/bjorn3/rustc_codegen_cranelift" target="_blank" title="https://github.com/bjorn3/rustc_codegen_cranelift">https://github.com/bjorn3/rustc_codegen_cranelift</a>. If you remove <a href="https://github.com/bjorn3/rustc_codegen_cranelift/blob/master/test.sh#L69-L78" target="_blank" title="https://github.com/bjorn3/rustc_codegen_cranelift/blob/master/test.sh#L69-L78">https://github.com/bjorn3/rustc_codegen_cranelift/blob/master/test.sh#L69-L78</a>, it will be quite a bit faster to test.</p>
<blockquote>
<p>Even without a CLIF file, the change could be reversed piecewise by changing the i32_i64 function to i32_i64_explicit_rex, at least narrowing down which recipe is likely responsible.</p>
</blockquote>
<p>Will try tomorrow.</p>
</blockquote>



<a name="183974618"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20Issue%20%231305%20Recent%20regression%20with%20cg_clif/near/183974618" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20Issue.20.231305.20Recent.20regression.20with.20cg_clif.html#183974618">(Dec 20 2019 at 21:22)</a>:</h4>
<p>sstangl <a href="https://github.com/bytecodealliance/cranelift/issues/1305#issuecomment-568092484" target="_blank" title="https://github.com/bytecodealliance/cranelift/issues/1305#issuecomment-568092484">commented</a> on <a href="https://github.com/bytecodealliance/cranelift/issues/1305" target="_blank" title="https://github.com/bytecodealliance/cranelift/issues/1305">Issue #1305</a>:</p>
<blockquote>
<p>Hum, I get this:</p>
<blockquote>
<p>[codegen mono items] end time: 483.21918ms<br>
error: could not compile <code>core</code>.</p>
<p>Caused by:<br>
  process didn't exit successfully: <code>rustc --edition=2018 --crate-name core sysroot_src/src/libcore/lib.rs --error-format=json --json=diagnostic-rendered-ansi,artifacts --crate-type lib --emit=dep-info,metadata,link -C debuginfo=2 -C metadata=53bf39f7e0485e6c -C extra-filename=-53bf39f7e0485e6c --out-dir /home/sstangl/dev/rustc_codegen_cranelift/build_sysroot/target/x86_64-unknown-linux-gnu/debug/deps --target x86_64-unknown-linux-gnu -C incremental=/home/sstangl/dev/rustc_codegen_cranelift/build_sysroot/target/x86_64-unknown-linux-gnu/debug/incremental -L dependency=/home/sstangl/dev/rustc_codegen_cranelift/build_sysroot/target/x86_64-unknown-linux-gnu/debug/deps -L dependency=/home/sstangl/dev/rustc_codegen_cranelift/build_sysroot/target/debug/deps -Cpanic=abort -Cdebuginfo=2 -Zpanic-abort-tests -Zcodegen-backend=/home/sstangl/dev/rustc_codegen_cranelift/target/debug/librustc_codegen_cranelift.so --sysroot /home/sstangl/dev/rustc_codegen_cranelift/build_sysroot/sysroot -Z force-unstable-if-unmarked</code> (signal: 4, SIGILL: illegal instruction)</p>
</blockquote>
<p>Which, if I'm reading that right, is <em>rustc</em> crashing?</p>
</blockquote>



<a name="183974688"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20Issue%20%231305%20Recent%20regression%20with%20cg_clif/near/183974688" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20Issue.20.231305.20Recent.20regression.20with.20cg_clif.html#183974688">(Dec 20 2019 at 21:23)</a>:</h4>
<p>sstangl <a href="https://github.com/bytecodealliance/cranelift/issues/1305#issuecomment-568092814" target="_blank" title="https://github.com/bytecodealliance/cranelift/issues/1305#issuecomment-568092814">commented</a> on <a href="https://github.com/bytecodealliance/cranelift/issues/1305" target="_blank" title="https://github.com/bytecodealliance/cranelift/issues/1305">Issue #1305</a>:</p>
<blockquote>
<p>Do I need to be on a specific version of rustc to compile this? The build instructions didn't mention it.</p>
</blockquote>



<a name="183976819"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20Issue%20%231305%20Recent%20regression%20with%20cg_clif/near/183976819" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20Issue.20.231305.20Recent.20regression.20with.20cg_clif.html#183976819">(Dec 20 2019 at 21:50)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/cranelift/issues/1305#issuecomment-568100835" target="_blank" title="https://github.com/bytecodealliance/cranelift/issues/1305#issuecomment-568100835">commented</a> on <a href="https://github.com/bytecodealliance/cranelift/issues/1305" target="_blank" title="https://github.com/bytecodealliance/cranelift/issues/1305">Issue #1305</a>:</p>
<blockquote>
<p>The travis build is using latest nightly.</p>
<blockquote>
<p>Which, if I'm reading that right, is rustc crashing?</p>
</blockquote>
<p>Seems so, the travis build fails with:</p>
<blockquote>
<p>error: test failed, to rerun pass '--lib'</p>
<p>Caused by:</p>
<p>process didn't exit successfully: <code>/Users/travis/build/bjorn3/rustc_codegen_cranelift/build_sysroot/sysroot_src/src/libcore/tests/target/x86_64-apple-darwin/debug/deps/coretests-a2d3b493e4d8f1a3</code> (signal: 11, SIGSEGV: invalid memory reference)</p>
</blockquote>
<p>What is the output above the error for you?</p>
</blockquote>



<a name="184005841"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20Issue%20%231305%20Recent%20regression%20with%20cg_clif/near/184005841" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20Issue.20.231305.20Recent.20regression.20with.20cg_clif.html#184005841">(Dec 21 2019 at 10:45)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/cranelift/issues/1305#issuecomment-568171304" target="_blank" title="https://github.com/bytecodealliance/cranelift/issues/1305#issuecomment-568171304">commented</a> on <a href="https://github.com/bytecodealliance/cranelift/issues/1305" target="_blank" title="https://github.com/bytecodealliance/cranelift/issues/1305">Issue #1305</a>:</p>
<blockquote>
<p>The pc ends up in the middle of an instruction. A breakpoint at the start of the function doesn't get triggered.</p>
</blockquote>



<a name="184041610"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20Issue%20%231305%20Recent%20regression%20with%20cg_clif/near/184041610" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20Issue.20.231305.20Recent.20regression.20with.20cg_clif.html#184041610">(Dec 22 2019 at 06:10)</a>:</h4>
<p>sstangl closed <a href="https://github.com/bytecodealliance/cranelift/issues/1305" target="_blank" title="https://github.com/bytecodealliance/cranelift/issues/1305">Issue #1305</a>:</p>
<blockquote>
<ul>
<li>
<p>What are the steps to reproduce the issue? Can you include a CLIF test case,<br>
  ideally reduced with the <code>bugpoint</code> clif-util command? <a href="https://travis-ci.org/bjorn3/rustc_codegen_cranelift/jobs/627882870" target="_blank" title="https://travis-ci.org/bjorn3/rustc_codegen_cranelift/jobs/627882870">https://travis-ci.org/bjorn3/rustc_codegen_cranelift/jobs/627882870</a></p>
</li>
<li>
<p>What do you expect to happen? What does actually happen? Does it panic, and<br>
  if so, with which assertion? SIGSEGV in coretests test.</p>
</li>
<li>
<p>Which Cranelift version / commit hash / branch are you using? e0d317249194f51a80c97a856f96eea1560c5435</p>
</li>
</ul>
<p>Regression range: <a href="https://github.com/bytecodealliance/cranelift/compare/ec787eb281bb2e18e191508c17abe694e91f0677...e0d317249194f51a80c97a856f96eea1560c5435" target="_blank" title="https://github.com/bytecodealliance/cranelift/compare/ec787eb281bb2e18e191508c17abe694e91f0677...e0d317249194f51a80c97a856f96eea1560c5435">https://github.com/bytecodealliance/cranelift/compare/ec787eb281bb2e18e191508c17abe694e91f0677...e0d317249194f51a80c97a856f96eea1560c5435</a></p>
<p>Likely caused by #1298 (cc @sstangl)</p>
</blockquote>



<a name="184060487"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20Issue%20%231305%20Recent%20regression%20with%20cg_clif/near/184060487" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20Issue.20.231305.20Recent.20regression.20with.20cg_clif.html#184060487">(Dec 22 2019 at 16:27)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/cranelift/issues/1305#issuecomment-568278129" target="_blank" title="https://github.com/bytecodealliance/cranelift/issues/1305#issuecomment-568278129">commented</a> on <a href="https://github.com/bytecodealliance/cranelift/issues/1305" target="_blank" title="https://github.com/bytecodealliance/cranelift/issues/1305">Issue #1305</a>:</p>
<blockquote>
<p>I can confirm that this issue is fixed: <a href="https://travis-ci.org/bjorn3/rustc_codegen_cranelift/jobs/628398038" target="_blank" title="https://travis-ci.org/bjorn3/rustc_codegen_cranelift/jobs/628398038">https://travis-ci.org/bjorn3/rustc_codegen_cranelift/jobs/628398038</a></p>
</blockquote>



<a name="184897398"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20Issue%20%231305%20Recent%20regression%20with%20cg_clif/near/184897398" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20Issue.20.231305.20Recent.20regression.20with.20cg_clif.html#184897398">(Jan 06 2020 at 11:14)</a>:</h4>
<p>bnjbvr <a href="https://github.com/bytecodealliance/cranelift/issues/1305#issuecomment-571101616" target="_blank" title="https://github.com/bytecodealliance/cranelift/issues/1305#issuecomment-571101616">commented</a> on <a href="https://github.com/bytecodealliance/cranelift/issues/1305" target="_blank" title="https://github.com/bytecodealliance/cranelift/issues/1305">Issue #1305</a>:</p>
<blockquote>
<blockquote>
<p>Just follow the build instructions</p>
</blockquote>
<p>Sorry @bjorn3, but this won't scale if we have to do this for every project embedding Cranelift. Please provide a CLIF test case next time, so we can include it in Cranelift's regression test suite.</p>
</blockquote>



<a name="184898850"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20Issue%20%231305%20Recent%20regression%20with%20cg_clif/near/184898850" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20Issue.20.231305.20Recent.20regression.20with.20cg_clif.html#184898850">(Jan 06 2020 at 11:40)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/cranelift/issues/1305#issuecomment-571108540" target="_blank" title="https://github.com/bytecodealliance/cranelift/issues/1305#issuecomment-571108540">commented</a> on <a href="https://github.com/bytecodealliance/cranelift/issues/1305" target="_blank" title="https://github.com/bytecodealliance/cranelift/issues/1305">Issue #1305</a>:</p>
<blockquote>
<p>I understand that it would be much nicer to just provide some clif ir with the bug. However this was a runtime error, but I didn't know where the problem was, so I would have to provide the clif ir of every compiled function. Because I use cranelift_module, that would still miss information necessary to actually compile and run it.</p>
</blockquote>



<a name="184901668"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20Issue%20%231305%20Recent%20regression%20with%20cg_clif/near/184901668" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20Issue.20.231305.20Recent.20regression.20with.20cg_clif.html#184901668">(Jan 06 2020 at 12:26)</a>:</h4>
<p>bnjbvr <a href="https://github.com/bytecodealliance/cranelift/issues/1305#issuecomment-571120474" target="_blank" title="https://github.com/bytecodealliance/cranelift/issues/1305#issuecomment-571120474">commented</a> on <a href="https://github.com/bytecodealliance/cranelift/issues/1305" target="_blank" title="https://github.com/bytecodealliance/cranelift/issues/1305">Issue #1305</a>:</p>
<blockquote>
<p>I understand the difficulty, but for us it's even more work to try to understand your code base, figure out how it uses Cranelift, etc.</p>
<p>Since you have a test case with a segfault at a precise instruction pointer value, could you please:</p>
<ol>
<li>add debug print to show the effective code ranges for each compiled function</li>
<li>run in a debugger (gdb, or rr is even better in this kind of situations) and note down the value of the instruction pointer when the crash happens</li>
<li>find which function is affected by this issue</li>
<li>get the CLIF for this particular function?</li>
</ol>
<p>And then we can figure it out from there. Having a test case is a great deal in effectively fixing a regression.</p>
<p>I think that having item (1) in cranelift-module in general would make sense to make debugging easier (behind an environment option / compile option / controlled by a parameter or whatnot).</p>
</blockquote>



<a name="184903155"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20Issue%20%231305%20Recent%20regression%20with%20cg_clif/near/184903155" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20Issue.20.231305.20Recent.20regression.20with.20cg_clif.html#184903155">(Jan 06 2020 at 12:51)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/cranelift/issues/1305#issuecomment-571126872" target="_blank" title="https://github.com/bytecodealliance/cranelift/issues/1305#issuecomment-571126872">commented</a> on <a href="https://github.com/bytecodealliance/cranelift/issues/1305" target="_blank" title="https://github.com/bytecodealliance/cranelift/issues/1305">Issue #1305</a>:</p>
<blockquote>
<p>I completely agree that it would be nicer to have a test case rather than a big program to compile and run. I try to create a test case when possible. In this particular case that was however not really possible, as there was a jump somewhere to the middle of an instruction, after which the process continued running. I did try to reduce the test case, but even slight changes made it stop crash, crash at a different place or even jump to an unmapped page. This made it hard to find the responsible instruction or even function. rr would have made it easy, but it doesn't work on macOS, which I was using that day.</p>
<blockquote>
<p>find which function is affected by this issue</p>
</blockquote>
<p>The debugger showed me which function was running when it finally crashed (both faerie and object emit symbols for every function, even if private), but at that point the ip was already pointing in the middle of an instruction.</p>
</blockquote>



<a name="184906236"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20Issue%20%231305%20Recent%20regression%20with%20cg_clif/near/184906236" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20Issue.20.231305.20Recent.20regression.20with.20cg_clif.html#184906236">(Jan 06 2020 at 13:38)</a>:</h4>
<p>bnjbvr <a href="https://github.com/bytecodealliance/cranelift/issues/1305#issuecomment-571141355" target="_blank" title="https://github.com/bytecodealliance/cranelift/issues/1305#issuecomment-571141355">commented</a> on <a href="https://github.com/bytecodealliance/cranelift/issues/1305" target="_blank" title="https://github.com/bytecodealliance/cranelift/issues/1305">Issue #1305</a>:</p>
<blockquote>
<blockquote>
<p>The debugger showed me which function was running when it finally crashed (both faerie and object emit symbols for every function, even if private), but at that point the ip was already pointing in the middle of an instruction.</p>
</blockquote>
<p>I see. Note that the aforementioned <a href="https://rr-project.org/" target="_blank" title="https://rr-project.org/">rr</a> is a record and replay debugger, so it allows you to run your code backwards: from the point where it crashed, you can do <code>rsi</code> (reverse step instruction) to see what the previous instruction was. It's a bit of work to install it first, but the payoff is great in situations like this, and I am confident it would help in your Rustc endeavors as well.</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>