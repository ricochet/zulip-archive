<html>
<head><meta charset="utf-8"><title>cranelift / PR #1304 Encode stack load store · git-cranelift · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/index.html">git-cranelift</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231304.20Encode.20stack.20load.20store.html">cranelift / PR #1304 Encode stack load store</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="183969377"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231304%20Encode%20stack%20load%20store/near/183969377" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231304.20Encode.20stack.20load.20store.html#183969377">(Dec 20 2019 at 20:18)</a>:</h4>
<p>bjorn3 opened <a href="https://github.com/bytecodealliance/cranelift/pull/1304" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1304">PR #1304</a> from <code>encode_stack_load_store</code> to <code>master</code>:</p>
<blockquote>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so and/or ping<br>
<code>bnjbvr</code>. The list of suggested reviewers on the right can help you.</li>
</ul>
<p>This currently doesn't encode <code>stack_store</code> correctly.</p>
<div class="codehilite"><pre><span></span>[RexOp1spst_id#8089]                stack_store v0, ss1
[...]
@0000 [RexOp1spaddr_ld_id#808b,%rax] v20 = stack_load.i64 ss1
</pre></div>


<p>results in</p>
<div class="codehilite"><pre><span></span>  4a3df4:       48 89 bc 24 40 00 00    mov    %rdi,0x40(%rsp)
  4a3dfb:       00
[...]
  4a3e04:       48 8b 84 24 40 00 00    mov    0x40(%rsp),%rax
  4a3e0b:       00
</pre></div>


</blockquote>



<a name="183969459"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231304%20Encode%20stack%20load%20store/near/183969459" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231304.20Encode.20stack.20load.20store.html#183969459">(Dec 20 2019 at 20:19)</a>:</h4>
<p>bjorn3 edited <a href="https://github.com/bytecodealliance/cranelift/pull/1304" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1304">PR #1304</a> from <code>encode_stack_load_store</code> to <code>master</code>:</p>
<blockquote>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so and/or ping<br>
<code>bnjbvr</code>. The list of suggested reviewers on the right can help you.</li>
</ul>
<p>This currently doesn't encode <code>stack_load</code> and <code>stack_store</code> correctly.</p>
<div class="codehilite"><pre><span></span>[RexOp1spst_id#8089]                stack_store v0, ss1
[...]
@0000 [RexOp1spaddr_ld_id#808b,%rax] v20 = stack_load.i64 ss1
</pre></div>


<p>results in</p>
<div class="codehilite"><pre><span></span>  4a3df4:       48 89 bc 24 40 00 00    mov    %rdi,0x40(%rsp)
  4a3dfb:       00
[...]
  4a3e04:       48 8b 84 24 40 00 00    mov    0x40(%rsp),%rax
  4a3e0b:       00
</pre></div>


</blockquote>



<a name="184060060"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231304%20Encode%20stack%20load%20store/near/184060060" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231304.20Encode.20stack.20load.20store.html#184060060">(Dec 22 2019 at 16:14)</a>:</h4>
<p>bjorn3 updated <a href="https://github.com/bytecodealliance/cranelift/pull/1304" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1304">PR #1304</a> from <code>encode_stack_load_store</code> to <code>master</code>:</p>
<blockquote>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so and/or ping<br>
<code>bnjbvr</code>. The list of suggested reviewers on the right can help you.</li>
</ul>
<p>This currently doesn't encode <code>stack_load</code> and <code>stack_store</code> correctly.</p>
<div class="codehilite"><pre><span></span>[RexOp1spst_id#8089]                stack_store v0, ss1
[...]
@0000 [RexOp1spaddr_ld_id#808b,%rax] v20 = stack_load.i64 ss1
</pre></div>


<p>results in</p>
<div class="codehilite"><pre><span></span>  4a3df4:       48 89 bc 24 40 00 00    mov    %rdi,0x40(%rsp)
  4a3dfb:       00
[...]
  4a3e04:       48 8b 84 24 40 00 00    mov    0x40(%rsp),%rax
  4a3e0b:       00
</pre></div>


</blockquote>



<a name="184800458"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231304%20Encode%20stack%20load%20store/near/184800458" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231304.20Encode.20stack.20load.20store.html#184800458">(Jan 04 2020 at 11:43)</a>:</h4>
<p>bjorn3 edited <a href="https://github.com/bytecodealliance/cranelift/pull/1304" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1304">PR #1304</a> from <code>encode_stack_load_store</code> to <code>master</code>:</p>
<blockquote>
<ul>
<li>
<p>[x] This has been discussed in issue #597, or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so and/or ping<br>
<code>bnjbvr</code>. The list of suggested reviewers on the right can help you.</li>
</ul>
<p>This currently doesn't encode <code>stack_load</code> and <code>stack_store</code> correctly.</p>
<div class="codehilite"><pre><span></span>[RexOp1spst_id#8089]                stack_store v0, ss1
[...]
@0000 [RexOp1spaddr_ld_id#808b,%rax] v20 = stack_load.i64 ss1
</pre></div>


<p>results in</p>
<div class="codehilite"><pre><span></span>  4a3df4:       48 89 bc 24 40 00 00    mov    %rdi,0x40(%rsp)
  4a3dfb:       00
[...]
  4a3e04:       48 8b 84 24 40 00 00    mov    0x40(%rsp),%rax
  4a3e0b:       00
</pre></div>


</blockquote>



<a name="186572126"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231304%20Encode%20stack%20load%20store/near/186572126" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231304.20Encode.20stack.20load.20store.html#186572126">(Jan 25 2020 at 12:46)</a>:</h4>
<p>bjorn3 updated <a href="https://github.com/bytecodealliance/cranelift/pull/1304" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1304">PR #1304</a> from <code>encode_stack_load_store</code> to <code>master</code>:</p>
<blockquote>
<ul>
<li>
<p>[x] This has been discussed in issue #597, or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so and/or ping<br>
<code>bnjbvr</code>. The list of suggested reviewers on the right can help you.</li>
</ul>
<p>This currently doesn't encode <code>stack_load</code> and <code>stack_store</code> correctly.</p>
<div class="codehilite"><pre><span></span>[RexOp1spst_id#8089]                stack_store v0, ss1
[...]
@0000 [RexOp1spaddr_ld_id#808b,%rax] v20 = stack_load.i64 ss1
</pre></div>


<p>results in</p>
<div class="codehilite"><pre><span></span>  4a3df4:       48 89 bc 24 40 00 00    mov    %rdi,0x40(%rsp)
  4a3dfb:       00
[...]
  4a3e04:       48 8b 84 24 40 00 00    mov    0x40(%rsp),%rax
  4a3e0b:       00
</pre></div>


</blockquote>



<a name="186572142"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231304%20Encode%20stack%20load%20store/near/186572142" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231304.20Encode.20stack.20load.20store.html#186572142">(Jan 25 2020 at 12:47)</a>:</h4>
<p>bjorn3 updated <a href="https://github.com/bytecodealliance/cranelift/pull/1304" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1304">PR #1304</a> from <code>encode_stack_load_store</code> to <code>master</code>:</p>
<blockquote>
<ul>
<li>
<p>[x] This has been discussed in issue #597, or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so and/or ping<br>
<code>bnjbvr</code>. The list of suggested reviewers on the right can help you.</li>
</ul>
<p>This currently doesn't encode <code>stack_load</code> and <code>stack_store</code> correctly.</p>
<div class="codehilite"><pre><span></span>[RexOp1spst_id#8089]                stack_store v0, ss1
[...]
@0000 [RexOp1spaddr_ld_id#808b,%rax] v20 = stack_load.i64 ss1
</pre></div>


<p>results in</p>
<div class="codehilite"><pre><span></span>  4a3df4:       48 89 bc 24 40 00 00    mov    %rdi,0x40(%rsp)
  4a3dfb:       00
[...]
  4a3e04:       48 8b 84 24 40 00 00    mov    0x40(%rsp),%rax
  4a3e0b:       00
</pre></div>


</blockquote>



<a name="186574337"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231304%20Encode%20stack%20load%20store/near/186574337" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231304.20Encode.20stack.20load.20store.html#186574337">(Jan 25 2020 at 13:57)</a>:</h4>
<p>bjorn3 updated <a href="https://github.com/bytecodealliance/cranelift/pull/1304" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1304">PR #1304</a> from <code>encode_stack_load_store</code> to <code>master</code>:</p>
<blockquote>
<ul>
<li>
<p>[x] This has been discussed in issue #597, or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so and/or ping<br>
<code>bnjbvr</code>. The list of suggested reviewers on the right can help you.</li>
</ul>
<p>This currently doesn't encode <code>stack_load</code> and <code>stack_store</code> correctly.</p>
<div class="codehilite"><pre><span></span>[RexOp1spst_id#8089]                stack_store v0, ss1
[...]
@0000 [RexOp1spaddr_ld_id#808b,%rax] v20 = stack_load.i64 ss1
</pre></div>


<p>results in</p>
<div class="codehilite"><pre><span></span>  4a3df4:       48 89 bc 24 40 00 00    mov    %rdi,0x40(%rsp)
  4a3dfb:       00
[...]
  4a3e04:       48 8b 84 24 40 00 00    mov    0x40(%rsp),%rax
  4a3e0b:       00
</pre></div>


</blockquote>



<a name="186574390"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231304%20Encode%20stack%20load%20store/near/186574390" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231304.20Encode.20stack.20load.20store.html#186574390">(Jan 25 2020 at 13:58)</a>:</h4>
<p>bjorn3 updated <a href="https://github.com/bytecodealliance/cranelift/pull/1304" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1304">PR #1304</a> from <code>encode_stack_load_store</code> to <code>master</code>:</p>
<blockquote>
<ul>
<li>
<p>[x] This has been discussed in issue #597, or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so and/or ping<br>
<code>bnjbvr</code>. The list of suggested reviewers on the right can help you.</li>
</ul>
<p>This currently doesn't encode <code>stack_load</code> and <code>stack_store</code> correctly.</p>
<div class="codehilite"><pre><span></span>[RexOp1spst_id#8089]                stack_store v0, ss1
[...]
@0000 [RexOp1spaddr_ld_id#808b,%rax] v20 = stack_load.i64 ss1
</pre></div>


<p>results in</p>
<div class="codehilite"><pre><span></span>  4a3df4:       48 89 bc 24 40 00 00    mov    %rdi,0x40(%rsp)
  4a3dfb:       00
[...]
  4a3e04:       48 8b 84 24 40 00 00    mov    0x40(%rsp),%rax
  4a3e0b:       00
</pre></div>


</blockquote>



<a name="186574599"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231304%20Encode%20stack%20load%20store/near/186574599" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231304.20Encode.20stack.20load.20store.html#186574599">(Jan 25 2020 at 14:05)</a>:</h4>
<p>bjorn3 updated <a href="https://github.com/bytecodealliance/cranelift/pull/1304" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1304">PR #1304</a> from <code>encode_stack_load_store</code> to <code>master</code>:</p>
<blockquote>
<ul>
<li>
<p>[x] This has been discussed in issue #597, or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so and/or ping<br>
<code>bnjbvr</code>. The list of suggested reviewers on the right can help you.</li>
</ul>
<p>This currently doesn't encode <code>stack_load</code> and <code>stack_store</code> correctly.</p>
<div class="codehilite"><pre><span></span>[RexOp1spst_id#8089]                stack_store v0, ss1
[...]
@0000 [RexOp1spaddr_ld_id#808b,%rax] v20 = stack_load.i64 ss1
</pre></div>


<p>results in</p>
<div class="codehilite"><pre><span></span>  4a3df4:       48 89 bc 24 40 00 00    mov    %rdi,0x40(%rsp)
  4a3dfb:       00
[...]
  4a3e04:       48 8b 84 24 40 00 00    mov    0x40(%rsp),%rax
  4a3e0b:       00
</pre></div>


</blockquote>



<a name="186574701"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231304%20Encode%20stack%20load%20store/near/186574701" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231304.20Encode.20stack.20load.20store.html#186574701">(Jan 25 2020 at 14:08)</a>:</h4>
<p>bjorn3 edited <a href="https://github.com/bytecodealliance/cranelift/pull/1304" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1304">PR #1304</a> from <code>encode_stack_load_store</code> to <code>master</code>:</p>
<blockquote>
<ul>
<li>
<p>[x] This has been discussed in issue #597, or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[x] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so and/or ping<br>
<code>bnjbvr</code>. The list of suggested reviewers on the right can help you.</li>
</ul>
<p>This currently doesn't encode <code>stack_load</code> and <code>stack_store</code> correctly.</p>
<div class="codehilite"><pre><span></span>[RexOp1spst_id#8089]                stack_store v0, ss1
[...]
@0000 [RexOp1spaddr_ld_id#808b,%rax] v20 = stack_load.i64 ss1
</pre></div>


<p>results in</p>
<div class="codehilite"><pre><span></span>  4a3df4:       48 89 bc 24 40 00 00    mov    %rdi,0x40(%rsp)
  4a3dfb:       00
[...]
  4a3e04:       48 8b 84 24 40 00 00    mov    0x40(%rsp),%rax
  4a3e0b:       00
</pre></div>


</blockquote>



<a name="186574771"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231304%20Encode%20stack%20load%20store/near/186574771" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231304.20Encode.20stack.20load.20store.html#186574771">(Jan 25 2020 at 14:10)</a>:</h4>
<p>bjorn3 edited <a href="https://github.com/bytecodealliance/cranelift/pull/1304" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1304">PR #1304</a> from <code>encode_stack_load_store</code> to <code>master</code>:</p>
<blockquote>
<ul>
<li>
<p>[x] This has been discussed in issue #597, or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[x] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.<br>
  This adds a <code>stack_load</code> and <code>stack_store</code> encoding for 32bit and 64bit integers. This saves one <code>lea</code> instruction for each <code>stack_load</code> and <code>stack_store</code>.</p>
</li>
<li>
<p>[x] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so and/or ping<br>
<code>bnjbvr</code>. The list of suggested reviewers on the right can help you.</li>
</ul>
<p>&lt;strike&gt;This currently doesn't encode <code>stack_load</code> and <code>stack_store</code> correctly.</p>
<div class="codehilite"><pre><span></span>[RexOp1spst_id#8089]                stack_store v0, ss1
[...]
@0000 [RexOp1spaddr_ld_id#808b,%rax] v20 = stack_load.i64 ss1
</pre></div>


<p>results in</p>
<div class="codehilite"><pre><span></span>  4a3df4:       48 89 bc 24 40 00 00    mov    %rdi,0x40(%rsp)
  4a3dfb:       00
[...]
  4a3e04:       48 8b 84 24 40 00 00    mov    0x40(%rsp),%rax
  4a3e0b:       00
```&lt;/strike&gt;
~~~
</pre></div>


</blockquote>



<a name="186574784"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231304%20Encode%20stack%20load%20store/near/186574784" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231304.20Encode.20stack.20load.20store.html#186574784">(Jan 25 2020 at 14:11)</a>:</h4>
<p>bjorn3 edited <a href="https://github.com/bytecodealliance/cranelift/pull/1304" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1304">PR #1304</a> from <code>encode_stack_load_store</code> to <code>master</code>:</p>
<blockquote>
<ul>
<li>
<p>[x] This has been discussed in issue #597, or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[x] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.<br>
  This adds a <code>stack_load</code> and <code>stack_store</code> encoding for 32bit and 64bit integers. This saves one <code>lea</code> instruction for each <code>stack_load</code> and <code>stack_store</code>.</p>
</li>
<li>
<p>[x] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so and/or ping<br>
<code>bnjbvr</code>. The list of suggested reviewers on the right can help you.</li>
</ul>
<p>&lt;strike&gt;<br>
This currently doesn't encode <code>stack_load</code> and <code>stack_store</code> correctly.</p>
<div class="codehilite"><pre><span></span>[RexOp1spst_id#8089]                stack_store v0, ss1
[...]
@0000 [RexOp1spaddr_ld_id#808b,%rax] v20 = stack_load.i64 ss1
</pre></div>


<p>results in</p>
<div class="codehilite"><pre><span></span>  4a3df4:       48 89 bc 24 40 00 00    mov    %rdi,0x40(%rsp)
  4a3dfb:       00
[...]
  4a3e04:       48 8b 84 24 40 00 00    mov    0x40(%rsp),%rax
  4a3e0b:       00
</pre></div>


<p>&lt;/strike&gt;</p>
</blockquote>



<a name="186574785"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231304%20Encode%20stack%20load%20store/near/186574785" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231304.20Encode.20stack.20load.20store.html#186574785">(Jan 25 2020 at 14:11)</a>:</h4>
<p><strong>bjorn3</strong> requested <a href="https://github.com/bnjbvr" target="_blank" title="https://github.com/bnjbvr">bnjbvr</a> for a review on <a href="https://github.com/bytecodealliance/cranelift/pull/1304" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1304">PR #1304</a>.</p>



<a name="186574786"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231304%20Encode%20stack%20load%20store/near/186574786" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231304.20Encode.20stack.20load.20store.html#186574786">(Jan 25 2020 at 14:11)</a>:</h4>
<p>bjorn3 edited <a href="https://github.com/bytecodealliance/cranelift/pull/1304" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1304">PR #1304</a> from <code>encode_stack_load_store</code> to <code>master</code>:</p>
<blockquote>
<ul>
<li>
<p>[x] This has been discussed in issue #597, or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[x] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.<br>
  This adds a <code>stack_load</code> and <code>stack_store</code> encoding for 32bit and 64bit integers. This saves one <code>lea</code> instruction for each <code>stack_load</code> and <code>stack_store</code>.</p>
</li>
<li>
<p>[x] This PR contains test cases, if meaningful.</p>
</li>
<li>[x] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so and/or ping<br>
<code>bnjbvr</code>. The list of suggested reviewers on the right can help you.</li>
</ul>
<p>&lt;strike&gt;<br>
This currently doesn't encode <code>stack_load</code> and <code>stack_store</code> correctly.</p>
<div class="codehilite"><pre><span></span>[RexOp1spst_id#8089]                stack_store v0, ss1
[...]
@0000 [RexOp1spaddr_ld_id#808b,%rax] v20 = stack_load.i64 ss1
</pre></div>


<p>results in</p>
<div class="codehilite"><pre><span></span>  4a3df4:       48 89 bc 24 40 00 00    mov    %rdi,0x40(%rsp)
  4a3dfb:       00
[...]
  4a3e04:       48 8b 84 24 40 00 00    mov    0x40(%rsp),%rax
  4a3e0b:       00
</pre></div>


<p>&lt;/strike&gt;</p>
</blockquote>



<a name="188094578"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231304%20Encode%20stack%20load%20store/near/188094578" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231304.20Encode.20stack.20load.20store.html#188094578">(Feb 13 2020 at 10:40)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/cranelift/pull/1304#pullrequestreview-358104217" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1304#pullrequestreview-358104217">PR Review</a>.</p>



<a name="188094579"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231304%20Encode%20stack%20load%20store/near/188094579" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231304.20Encode.20stack.20load.20store.html#188094579">(Feb 13 2020 at 10:40)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/cranelift/pull/1304#discussion_r378779522" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1304#discussion_r378779522">PR Review Comment</a>:</p>
<blockquote>
<p>Why is this needed here and not in the load case?</p>
</blockquote>



<a name="188094580"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231304%20Encode%20stack%20load%20store/near/188094580" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231304.20Encode.20stack.20load.20store.html#188094580">(Feb 13 2020 at 10:40)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/cranelift/pull/1304#pullrequestreview-358104217" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1304#pullrequestreview-358104217">PR Review</a>.</p>



<a name="188094581"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231304%20Encode%20stack%20load%20store/near/188094581" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231304.20Encode.20stack.20load.20store.html#188094581">(Feb 13 2020 at 10:40)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/cranelift/pull/1304#discussion_r378772179" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1304#discussion_r378772179">PR Review Comment</a>:</p>
<blockquote>
<p>Is it possible to use the 8-bytes displacement on x86 32 bits, though? It seems like a possible regression, and one that's hard to test, since we only test that the generated machine code matches our encodings.</p>
<p>(One possible way to resolve this would be to just remove this line, in light of the plan to have a new isel/codegen mechanism, since x86 32 bits is badly supported anyways.)</p>
</blockquote>



<a name="188098781"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231304%20Encode%20stack%20load%20store/near/188098781" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231304.20Encode.20stack.20load.20store.html#188098781">(Feb 13 2020 at 11:48)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/cranelift/pull/1304#pullrequestreview-358154831" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1304#pullrequestreview-358154831">PR Review</a>.</p>



<a name="188098782"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231304%20Encode%20stack%20load%20store/near/188098782" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231304.20Encode.20stack.20load.20store.html#188098782">(Feb 13 2020 at 11:48)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/cranelift/pull/1304#discussion_r378812656" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1304#discussion_r378812656">PR Review Comment</a>:</p>
<blockquote>
<p>I followed the example of the spill and fill encodings. Stack loads should always have a stack store before them to prevent reading undefined bytes, so any stack overflow would have already been catched by the stack store. Unlike the fill instruction, a stack load of undefined bytes is possible, so maybe I should add a StackOverflow trap marker to load anyway.</p>
</blockquote>



<a name="188098838"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231304%20Encode%20stack%20load%20store/near/188098838" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231304.20Encode.20stack.20load.20store.html#188098838">(Feb 13 2020 at 11:49)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/cranelift/pull/1304#pullrequestreview-358155540" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1304#pullrequestreview-358155540">PR Review</a>.</p>



<a name="188098839"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231304%20Encode%20stack%20load%20store/near/188098839" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231304.20Encode.20stack.20load.20store.html#188098839">(Feb 13 2020 at 11:49)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/cranelift/pull/1304#discussion_r378813248" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1304#discussion_r378813248">PR Review Comment</a>:</p>
<blockquote>
<p>I can add the 8bit displacement back.</p>
</blockquote>



<a name="188120482"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231304%20Encode%20stack%20load%20store/near/188120482" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231304.20Encode.20stack.20load.20store.html#188120482">(Feb 13 2020 at 16:04)</a>:</h4>
<p>iximeow submitted <a href="https://github.com/bytecodealliance/cranelift/pull/1304#pullrequestreview-358343482" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1304#pullrequestreview-358343482">PR Review</a>.</p>



<a name="188120483"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231304%20Encode%20stack%20load%20store/near/188120483" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231304.20Encode.20stack.20load.20store.html#188120483">(Feb 13 2020 at 16:04)</a>:</h4>
<p>iximeow created <a href="https://github.com/bytecodealliance/cranelift/pull/1304#discussion_r378956967" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1304#discussion_r378956967">PR Review Comment</a>:</p>
<blockquote>
<p>I'm not sure if @bnjbvr meant 8-byte or 8-bit displacement, but to be clear, x86 does not support 8-byte displacements.</p>
<p>I'm suspect of the <code>spaddr4</code> encoding for x86 32-bit that was present since while it used <code>modrm_sib_disp8(out_reg0, sink);</code> to prepare for an 8-bit displacement, it proceeded to write four bytes of displacement out with  <code>sink.put4(sp.offset.checked_add(imm).unwrap() as u32);</code></p>
<p>I think adding keeping an 8-bit displacement form would be good though, as it would be useful for functions with smaller stack regions.</p>
</blockquote>



<a name="188127451"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231304%20Encode%20stack%20load%20store/near/188127451" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231304.20Encode.20stack.20load.20store.html#188127451">(Feb 13 2020 at 17:10)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/cranelift/pull/1304#pullrequestreview-358398544" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1304#pullrequestreview-358398544">PR Review</a>.</p>



<a name="188127452"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231304%20Encode%20stack%20load%20store/near/188127452" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231304.20Encode.20stack.20load.20store.html#188127452">(Feb 13 2020 at 17:10)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/cranelift/pull/1304#discussion_r378999213" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1304#discussion_r378999213">PR Review Comment</a>:</p>
<blockquote>
<p>Yeah, that put4 was the reason I removed it.</p>
</blockquote>



<a name="189392154"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231304%20Encode%20stack%20load%20store/near/189392154" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231304.20Encode.20stack.20load.20store.html#189392154">(Feb 29 2020 at 14:25)</a>:</h4>
<p>bjorn3 updated <a href="https://github.com/bytecodealliance/cranelift/pull/1304" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1304">PR #1304</a> from <code>encode_stack_load_store</code> to <code>master</code>:</p>
<blockquote>
<ul>
<li>
<p>[x] This has been discussed in issue #597, or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[x] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.<br>
  This adds a <code>stack_load</code> and <code>stack_store</code> encoding for 32bit and 64bit integers. This saves one <code>lea</code> instruction for each <code>stack_load</code> and <code>stack_store</code>.</p>
</li>
<li>
<p>[x] This PR contains test cases, if meaningful.</p>
</li>
<li>[x] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so and/or ping<br>
<code>bnjbvr</code>. The list of suggested reviewers on the right can help you.</li>
</ul>
<p>&lt;strike&gt;<br>
This currently doesn't encode <code>stack_load</code> and <code>stack_store</code> correctly.</p>
<div class="codehilite"><pre><span></span>[RexOp1spst_id#8089]                stack_store v0, ss1
[...]
@0000 [RexOp1spaddr_ld_id#808b,%rax] v20 = stack_load.i64 ss1
</pre></div>


<p>results in</p>
<div class="codehilite"><pre><span></span>  4a3df4:       48 89 bc 24 40 00 00    mov    %rdi,0x40(%rsp)
  4a3dfb:       00
[...]
  4a3e04:       48 8b 84 24 40 00 00    mov    0x40(%rsp),%rax
  4a3e0b:       00
</pre></div>


<p>&lt;/strike&gt;</p>
</blockquote>



<a name="189393189"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231304%20Encode%20stack%20load%20store/near/189393189" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231304.20Encode.20stack.20load.20store.html#189393189">(Feb 29 2020 at 14:59)</a>:</h4>
<p>bjorn3 closed without merge <a href="https://github.com/bytecodealliance/cranelift/pull/1304" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1304">PR #1304</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>