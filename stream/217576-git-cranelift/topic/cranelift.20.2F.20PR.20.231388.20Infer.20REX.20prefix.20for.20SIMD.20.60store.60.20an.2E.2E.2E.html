<html>
<head><meta charset="utf-8"><title>cranelift / PR #1388 Infer REX prefix for SIMD `store` an... · git-cranelift · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/index.html">git-cranelift</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231388.20Infer.20REX.20prefix.20for.20SIMD.20.60store.60.20an.2E.2E.2E.html">cranelift / PR #1388 Infer REX prefix for SIMD `store` an...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="188062396"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231388%20Infer%20REX%20prefix%20for%20SIMD%20%60store%60%20an.../near/188062396" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231388.20Infer.20REX.20prefix.20for.20SIMD.20.60store.60.20an.2E.2E.2E.html#188062396">(Feb 12 2020 at 23:08)</a>:</h4>
<p><strong>abrown</strong> requested <a href="https://github.com/iximeow" target="_blank" title="https://github.com/iximeow">iximeow</a> for a review on <a href="https://github.com/bytecodealliance/cranelift/pull/1388" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1388">PR #1388</a>.</p>



<a name="188062397"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231388%20Infer%20REX%20prefix%20for%20SIMD%20%60store%60%20an.../near/188062397" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231388.20Infer.20REX.20prefix.20for.20SIMD.20.60store.60.20an.2E.2E.2E.html#188062397">(Feb 12 2020 at 23:08)</a>:</h4>
<p>abrown opened <a href="https://github.com/bytecodealliance/cranelift/pull/1388" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1388">PR #1388</a> from <code>infer-rex-for-simd</code> to <code>master</code>:</p>
<blockquote>
<ul>
<li>[x] This has been discussed in issues #1090 and #1379.</li>
<li>
<p>[x] A short description of what this does, why it is needed: this demonstrates inferring REX prefixes for SIMD <code>store</code> and <code>vconst</code> instructions; if we think this is the right direction, we have some additional to do to infer REX prefixes for the following recipes:</p>
</li>
<li>
<p>[x] This PR contains test cases, if meaningful.</p>
</li>
<li>[x] A reviewer from the core maintainer team has been assigned for this PR.</li>
</ul>
<p>&lt;!-- Please ensure all communication adheres to the <a href="https://github.com/CraneStation/cranelift/blob/master/CODE_OF_CONDUCT.md" target="_blank" title="https://github.com/CraneStation/cranelift/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>. --&gt;</p>
</blockquote>



<a name="188062449"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231388%20Infer%20REX%20prefix%20for%20SIMD%20%60store%60%20an.../near/188062449" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231388.20Infer.20REX.20prefix.20for.20SIMD.20.60store.60.20an.2E.2E.2E.html#188062449">(Feb 12 2020 at 23:09)</a>:</h4>
<p>abrown edited <a href="https://github.com/bytecodealliance/cranelift/pull/1388" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1388">PR #1388</a> from <code>infer-rex-for-simd</code> to <code>master</code>:</p>
<blockquote>
<ul>
<li>[x] This has been discussed in issues #1090 and #1379.</li>
<li>[x] A short description of what this does, why it is needed: this demonstrates inferring REX prefixes for SIMD <code>store</code> and <code>vconst</code> instructions; if we think this is the right direction, we have some additional to do to infer REX prefixes for the following recipes:</li>
</ul>
<p>__enc_32_64__: fstDisp8, fstDisp32, fld, fldDisp8, fldDisp32, fspillSib32, fregspill32, ffillSib32, fregfill32, frmov, furm, fa, fax, f_ib<br>
__enc_32_64_maybe_isap__: r_ib_unsigned_r, fa_ib, fa, r_ib_unsigned_gpr, fcmp, icscc_fpr<br>
__enc_both__: frurm, pfcmp, fa, furm</p>
<ul>
<li>[x] This PR contains test cases, if meaningful.</li>
<li>[x] A reviewer from the core maintainer team has been assigned for this PR.</li>
</ul>
<p>&lt;!-- Please ensure all communication adheres to the <a href="https://github.com/CraneStation/cranelift/blob/master/CODE_OF_CONDUCT.md" target="_blank" title="https://github.com/CraneStation/cranelift/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>. --&gt;</p>
</blockquote>



<a name="188073517"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231388%20Infer%20REX%20prefix%20for%20SIMD%20%60store%60%20an.../near/188073517" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231388.20Infer.20REX.20prefix.20for.20SIMD.20.60store.60.20an.2E.2E.2E.html#188073517">(Feb 13 2020 at 02:47)</a>:</h4>
<p>iximeow submitted <a href="https://github.com/bytecodealliance/cranelift/pull/1388#pullrequestreview-357915917" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1388#pullrequestreview-357915917">PR Review</a>.</p>



<a name="188073518"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231388%20Infer%20REX%20prefix%20for%20SIMD%20%60store%60%20an.../near/188073518" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231388.20Infer.20REX.20prefix.20for.20SIMD.20.60store.60.20an.2E.2E.2E.html#188073518">(Feb 13 2020 at 02:47)</a>:</h4>
<p>iximeow submitted <a href="https://github.com/bytecodealliance/cranelift/pull/1388#pullrequestreview-357915917" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1388#pullrequestreview-357915917">PR Review</a>.</p>



<a name="188073519"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231388%20Infer%20REX%20prefix%20for%20SIMD%20%60store%60%20an.../near/188073519" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231388.20Infer.20REX.20prefix.20for.20SIMD.20.60store.60.20an.2E.2E.2E.html#188073519">(Feb 13 2020 at 02:47)</a>:</h4>
<p>iximeow created <a href="https://github.com/bytecodealliance/cranelift/pull/1388#discussion_r378618119" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1388#discussion_r378618119">PR Review Comment</a>:</p>
<blockquote>
<p><span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span> </p>
</blockquote>



<a name="188073520"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231388%20Infer%20REX%20prefix%20for%20SIMD%20%60store%60%20an.../near/188073520" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231388.20Infer.20REX.20prefix.20for.20SIMD.20.60store.60.20an.2E.2E.2E.html#188073520">(Feb 13 2020 at 02:47)</a>:</h4>
<p>iximeow created <a href="https://github.com/bytecodealliance/cranelift/pull/1388#discussion_r378624297" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1388#discussion_r378624297">PR Review Comment</a>:</p>
<blockquote>
<p>I think this also needs a <code>|| test_input(1, inst, divert, func, is_extended_reg)</code> in the case that the base register is <code>r8-r15</code>? I have admit I'm not sure which order registers are specified but the other part of the <a href="https://github.com/bytecodealliance/cranelift/blob/ae77d49fa49c7dccceb16f0a71380a25cf45531a/cranelift-codegen/meta/src/isa/x86/recipes.rs#L1506" target="_blank" title="https://github.com/bytecodealliance/cranelift/blob/ae77d49fa49c7dccceb16f0a71380a25cf45531a/cranelift-codegen/meta/src/isa/x86/recipes.rs#L1506">recipe this is used in</a> has me suspect. I'm also not sure how well our tests cover getting less-likely encodings like that - I'd not think about it if I didn't just try to do <code>[r11]</code> a few days ago.</p>
</blockquote>



<a name="188135625"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231388%20Infer%20REX%20prefix%20for%20SIMD%20%60store%60%20an.../near/188135625" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231388.20Infer.20REX.20prefix.20for.20SIMD.20.60store.60.20an.2E.2E.2E.html#188135625">(Feb 13 2020 at 18:34)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/cranelift/pull/1388" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1388">PR #1388</a> from <code>infer-rex-for-simd</code> to <code>master</code>:</p>
<blockquote>
<ul>
<li>[x] This has been discussed in issues #1090 and #1379.</li>
<li>[x] A short description of what this does, why it is needed: this demonstrates inferring REX prefixes for SIMD <code>store</code> and <code>vconst</code> instructions; if we think this is the right direction, we have some additional to do to infer REX prefixes for the following recipes:</li>
</ul>
<p>__enc_32_64__: fstDisp8, fstDisp32, fld, fldDisp8, fldDisp32, fspillSib32, fregspill32, ffillSib32, fregfill32, frmov, furm, fa, fax, f_ib<br>
__enc_32_64_maybe_isap__: r_ib_unsigned_r, fa_ib, fa, r_ib_unsigned_gpr, fcmp, icscc_fpr<br>
__enc_both__: frurm, pfcmp, fa, furm</p>
<ul>
<li>[x] This PR contains test cases, if meaningful.</li>
<li>[x] A reviewer from the core maintainer team has been assigned for this PR.</li>
</ul>
<p>&lt;!-- Please ensure all communication adheres to the <a href="https://github.com/CraneStation/cranelift/blob/master/CODE_OF_CONDUCT.md" target="_blank" title="https://github.com/CraneStation/cranelift/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>. --&gt;</p>
</blockquote>



<a name="188136989"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231388%20Infer%20REX%20prefix%20for%20SIMD%20%60store%60%20an.../near/188136989" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231388.20Infer.20REX.20prefix.20for.20SIMD.20.60store.60.20an.2E.2E.2E.html#188136989">(Feb 13 2020 at 18:48)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/cranelift/pull/1388" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1388">PR #1388</a> from <code>infer-rex-for-simd</code> to <code>master</code>:</p>
<blockquote>
<ul>
<li>[x] This has been discussed in issues #1090 and #1379.</li>
<li>[x] A short description of what this does, why it is needed: this demonstrates inferring REX prefixes for SIMD <code>store</code> and <code>vconst</code> instructions; if we think this is the right direction, we have some additional to do to infer REX prefixes for the following recipes:</li>
</ul>
<p>__enc_32_64__: fstDisp8, fstDisp32, fld, fldDisp8, fldDisp32, fspillSib32, fregspill32, ffillSib32, fregfill32, frmov, furm, fa, fax, f_ib<br>
__enc_32_64_maybe_isap__: r_ib_unsigned_r, fa_ib, fa, r_ib_unsigned_gpr, fcmp, icscc_fpr<br>
__enc_both__: frurm, pfcmp, fa, furm</p>
<ul>
<li>[x] This PR contains test cases, if meaningful.</li>
<li>[x] A reviewer from the core maintainer team has been assigned for this PR.</li>
</ul>
<p>&lt;!-- Please ensure all communication adheres to the <a href="https://github.com/CraneStation/cranelift/blob/master/CODE_OF_CONDUCT.md" target="_blank" title="https://github.com/CraneStation/cranelift/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>. --&gt;</p>
</blockquote>



<a name="188162290"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231388%20Infer%20REX%20prefix%20for%20SIMD%20%60store%60%20an.../near/188162290" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231388.20Infer.20REX.20prefix.20for.20SIMD.20.60store.60.20an.2E.2E.2E.html#188162290">(Feb 13 2020 at 23:08)</a>:</h4>
<p>iximeow submitted <a href="https://github.com/bytecodealliance/cranelift/pull/1388#pullrequestreview-358616473" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1388#pullrequestreview-358616473">PR Review</a>.</p>



<a name="188565069"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231388%20Infer%20REX%20prefix%20for%20SIMD%20%60store%60%20an.../near/188565069" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231388.20Infer.20REX.20prefix.20for.20SIMD.20.60store.60.20an.2E.2E.2E.html#188565069">(Feb 19 2020 at 17:24)</a>:</h4>
<p>abrown merged <a href="https://github.com/bytecodealliance/cranelift/pull/1388" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1388">PR #1388</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>