<html>
<head><meta charset="utf-8"><title>cranelift / Issue #1170 Integrate clippy checking in CI b... · git-cranelift · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/index.html">git-cranelift</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20Issue.20.231170.20Integrate.20clippy.20checking.20in.20CI.20b.2E.2E.2E.html">cranelift / Issue #1170 Integrate clippy checking in CI b...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="185355302"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20Issue%20%231170%20Integrate%20clippy%20checking%20in%20CI%20b.../near/185355302" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20Issue.20.231170.20Integrate.20clippy.20checking.20in.20CI.20b.2E.2E.2E.html#185355302">(Jan 10 2020 at 21:51)</a>:</h4>
<p>abrown <a href="https://github.com/bytecodealliance/cranelift/issues/1170#issuecomment-573219187" target="_blank" title="https://github.com/bytecodealliance/cranelift/issues/1170#issuecomment-573219187">commented</a> on <a href="https://github.com/bytecodealliance/cranelift/issues/1170" target="_blank" title="https://github.com/bytecodealliance/cranelift/issues/1170">Issue #1170</a>:</p>
<blockquote>
<p>Just looked at this a bit more and I think someone with rights should install <a href="https://github.com/marketplace/actions/rust-clippy-check" target="_blank" title="https://github.com/marketplace/actions/rust-clippy-check">https://github.com/marketplace/actions/rust-clippy-check</a>. That GitHub action will use clippy to check PRs and post any issues as annotations (follow the previous link for an example). I think to use this we need to use a GitHub secret token, see <a href="https://github.com/marketplace/actions/rust-clippy-check#example-workflow" target="_blank" title="https://github.com/marketplace/actions/rust-clippy-check#example-workflow">https://github.com/marketplace/actions/rust-clippy-check#example-workflow</a>.</p>
</blockquote>



<a name="185479300"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20Issue%20%231170%20Integrate%20clippy%20checking%20in%20CI%20b.../near/185479300" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20Issue.20.231170.20Integrate.20clippy.20checking.20in.20CI.20b.2E.2E.2E.html#185479300">(Jan 13 2020 at 10:07)</a>:</h4>
<p>bnjbvr <a href="https://github.com/bytecodealliance/cranelift/issues/1170#issuecomment-573588814" target="_blank" title="https://github.com/bytecodealliance/cranelift/issues/1170#issuecomment-573588814">commented</a> on <a href="https://github.com/bytecodealliance/cranelift/issues/1170" target="_blank" title="https://github.com/bytecodealliance/cranelift/issues/1170">Issue #1170</a>:</p>
<blockquote>
<p>Interesting. I'm only wondering what this will do to existing Clippy warnings: will they be reported as part of a PR that modifies code around, or will only new Clippy warnings be reported? In the former case, I think it would be nicer to first fix all the Clippy warnings before enabling such a check.</p>
</blockquote>



<a name="185515825"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20Issue%20%231170%20Integrate%20clippy%20checking%20in%20CI%20b.../near/185515825" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20Issue.20.231170.20Integrate.20clippy.20checking.20in.20CI.20b.2E.2E.2E.html#185515825">(Jan 13 2020 at 17:35)</a>:</h4>
<p>abrown <a href="https://github.com/bytecodealliance/cranelift/issues/1170#issuecomment-573780556" target="_blank" title="https://github.com/bytecodealliance/cranelift/issues/1170#issuecomment-573780556">commented</a> on <a href="https://github.com/bytecodealliance/cranelift/issues/1170" target="_blank" title="https://github.com/bytecodealliance/cranelift/issues/1170">Issue #1170</a>:</p>
<blockquote>
<p>I suspect we would have to fix all the clippy warnings first but that wasn't too difficult: #1340. </p>
</blockquote>



<a name="189152573"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20Issue%20%231170%20Integrate%20clippy%20checking%20in%20CI%20b.../near/189152573" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20Issue.20.231170.20Integrate.20clippy.20checking.20in.20CI.20b.2E.2E.2E.html#189152573">(Feb 26 2020 at 19:59)</a>:</h4>
<p>abrown <a href="https://github.com/bytecodealliance/cranelift/issues/1170#issuecomment-591615140" target="_blank" title="https://github.com/bytecodealliance/cranelift/issues/1170#issuecomment-591615140">commented</a> on <a href="https://github.com/bytecodealliance/cranelift/issues/1170" target="_blank" title="https://github.com/bytecodealliance/cranelift/issues/1170">Issue #1170</a>:</p>
<blockquote>
<p>@alexcrichton, what do you think about adding this to cranelift and wasmtime, perhaps when they merge?</p>
</blockquote>



<a name="189167106"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20Issue%20%231170%20Integrate%20clippy%20checking%20in%20CI%20b.../near/189167106" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20Issue.20.231170.20Integrate.20clippy.20checking.20in.20CI.20b.2E.2E.2E.html#189167106">(Feb 26 2020 at 22:27)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/cranelift/issues/1170#issuecomment-591677029" target="_blank" title="https://github.com/bytecodealliance/cranelift/issues/1170#issuecomment-591677029">commented</a> on <a href="https://github.com/bytecodealliance/cranelift/issues/1170" target="_blank" title="https://github.com/bytecodealliance/cranelift/issues/1170">Issue #1170</a>:</p>
<blockquote>
<p>I personally agree with @fitzgen's <a href="https://github.com/bytecodealliance/cranelift/issues/1170#issuecomment-546428127" target="_blank" title="https://github.com/bytecodealliance/cranelift/issues/1170#issuecomment-546428127">thoughts above</a> where hard-gating on clippy on CI is often quite onerous. I personally disagree with a lot of clippy's lints as well which doesn't help my own opinion though... I would advocate for a "here's how to run it if you want" at most, but otherwise don't hard-gate it on CI.</p>
</blockquote>



<a name="189184768"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20Issue%20%231170%20Integrate%20clippy%20checking%20in%20CI%20b.../near/189184768" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20Issue.20.231170.20Integrate.20clippy.20checking.20in.20CI.20b.2E.2E.2E.html#189184768">(Feb 27 2020 at 03:48)</a>:</h4>
<p>abrown <a href="https://github.com/bytecodealliance/cranelift/issues/1170#issuecomment-591765706" target="_blank" title="https://github.com/bytecodealliance/cranelift/issues/1170#issuecomment-591765706">commented</a> on <a href="https://github.com/bytecodealliance/cranelift/issues/1170" target="_blank" title="https://github.com/bytecodealliance/cranelift/issues/1170">Issue #1170</a>:</p>
<blockquote>
<p><span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span> I agree with the "no hard-gating" point of view as well. I think the point of installing this clippy action would be for awareness more than anything else: instead of running clippy in CI, ignoring failures, and thus doing extra work that is ignored, this action would make PR submitters and reviewers aware of what clippy thinks is problematic. If clippy finds a real issue--good; if clippy finds irrelevant stuff then they can ignore the warning (locally or globally).</p>
</blockquote>



<a name="189185430"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20Issue%20%231170%20Integrate%20clippy%20checking%20in%20CI%20b.../near/189185430" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20Issue.20.231170.20Integrate.20clippy.20checking.20in.20CI.20b.2E.2E.2E.html#189185430">(Feb 27 2020 at 04:08)</a>:</h4>
<p>philipc <a href="https://github.com/bytecodealliance/cranelift/issues/1170#issuecomment-591769769" target="_blank" title="https://github.com/bytecodealliance/cranelift/issues/1170#issuecomment-591769769">commented</a> on <a href="https://github.com/bytecodealliance/cranelift/issues/1170" target="_blank" title="https://github.com/bytecodealliance/cranelift/issues/1170">Issue #1170</a>:</p>
<blockquote>
<p>The limitations on <a href="https://github.com/marketplace/actions/rust-clippy-check" target="_blank" title="https://github.com/marketplace/actions/rust-clippy-check">https://github.com/marketplace/actions/rust-clippy-check</a> make it seem to be not worth the effort: "Due to token permissions, this Action WILL NOT be able to post clippy annotations for Pull Requests from the forked repositories."</p>
</blockquote>



<a name="189236439"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20Issue%20%231170%20Integrate%20clippy%20checking%20in%20CI%20b.../near/189236439" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20Issue.20.231170.20Integrate.20clippy.20checking.20in.20CI.20b.2E.2E.2E.html#189236439">(Feb 27 2020 at 17:43)</a>:</h4>
<p>abrown <a href="https://github.com/bytecodealliance/cranelift/issues/1170#issuecomment-592087483" target="_blank" title="https://github.com/bytecodealliance/cranelift/issues/1170#issuecomment-592087483">commented</a> on <a href="https://github.com/bytecodealliance/cranelift/issues/1170" target="_blank" title="https://github.com/bytecodealliance/cranelift/issues/1170">Issue #1170</a>:</p>
<blockquote>
<p>Hm, yeah, then there's not much point to doing this until that is fixed; seems like this can issue can go forward when/if <a href="https://github.com/actions-rs/clippy-check/issues/2" target="_blank" title="https://github.com/actions-rs/clippy-check/issues/2">https://github.com/actions-rs/clippy-check/issues/2</a> is fixed.</p>
</blockquote>



<a name="189361633"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20Issue%20%231170%20Integrate%20clippy%20checking%20in%20CI%20b.../near/189361633" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20Issue.20.231170.20Integrate.20clippy.20checking.20in.20CI.20b.2E.2E.2E.html#189361633">(Feb 28 2020 at 23:27)</a>:</h4>
<p>alexcrichton transferred <a href="https://github.com/bytecodealliance/cranelift/issues/1170" target="_blank" title="https://github.com/bytecodealliance/cranelift/issues/1170">Issue #1170</a> (assigned to abrown):</p>
<blockquote>
<p>Please try to describe precisely what you would like to do in Cranelift and/or<br>
expect from it. You can answer the questions below if they're relevant and<br>
delete this text before submitting. Thanks for opening an issue!</p>
<ul>
<li>
<p>What is the feature or code improvement you would like to do in Cranelift?<br>
After merging #1169 (and seeing #1168), it occurred to me that we should output clippy warnings as a part of <code>test-all.sh</code>. I'm not sure we should fail the build (though this could be an option) but this would make non-clippy-approved additions more visible.</p>
</li>
<li>
<p>What is the value of adding this in Cranelift?<br>
It should result in cleaner, more standard code in the long run.</p>
</li>
<li>
<p>Do you have an implementation plan, and/or ideas for data structures or<br>
  algorithms to use?<br>
Add <code>cargo clippy</code> to <code>test-all.sh</code> and ensure <code>clippy</code> is installed for Azure pipelines.</p>
</li>
<li>
<p>Have you considered alternative implementations? If so, how are they better<br>
  or worse than your proposal?<br>
No.</p>
</li>
</ul>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>