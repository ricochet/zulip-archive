<html>
<head><meta charset="utf-8"><title>cranelift / PR #1373 Properly preserve and restore CFA st... · git-cranelift · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/index.html">git-cranelift</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231373.20Properly.20preserve.20and.20restore.20CFA.20st.2E.2E.2E.html">cranelift / PR #1373 Properly preserve and restore CFA st...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="187165817"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231373%20Properly%20preserve%20and%20restore%20CFA%20st.../near/187165817" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231373.20Properly.20preserve.20and.20restore.20CFA.20st.2E.2E.2E.html#187165817">(Feb 01 2020 at 15:28)</a>:</h4>
<p>yurydelendik opened <a href="https://github.com/bytecodealliance/cranelift/pull/1373" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1373">PR #1373</a> from <code>fde_multi_ret</code> to <code>master</code>:</p>
<blockquote>
<p>Fixes #1372 (discussion there)</p>
<p>The patch properly arranges frame layout info commands for restore and preserve state. Also, it properly serializes them in into FDE.</p>
</blockquote>



<a name="187165818"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231373%20Properly%20preserve%20and%20restore%20CFA%20st.../near/187165818" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231373.20Properly.20preserve.20and.20restore.20CFA.20st.2E.2E.2E.html#187165818">(Feb 01 2020 at 15:28)</a>:</h4>
<p><strong>yurydelendik</strong> requested <a href="https://github.com/iximeow" target="_blank" title="https://github.com/iximeow">iximeow</a> for a review on <a href="https://github.com/bytecodealliance/cranelift/pull/1373" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1373">PR #1373</a>.</p>



<a name="187193559"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231373%20Properly%20preserve%20and%20restore%20CFA%20st.../near/187193559" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231373.20Properly.20preserve.20and.20restore.20CFA.20st.2E.2E.2E.html#187193559">(Feb 02 2020 at 06:48)</a>:</h4>
<p>yurydelendik updated <a href="https://github.com/bytecodealliance/cranelift/pull/1373" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1373">PR #1373</a> from <code>fde_multi_ret</code> to <code>master</code>:</p>
<blockquote>
<p>Fixes #1372 (discussion there)</p>
<p>The patch properly arranges frame layout info commands for restore and preserve state. Also, it properly serializes them in into FDE.</p>
</blockquote>



<a name="187193572"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231373%20Properly%20preserve%20and%20restore%20CFA%20st.../near/187193572" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231373.20Properly.20preserve.20and.20restore.20CFA.20st.2E.2E.2E.html#187193572">(Feb 02 2020 at 06:49)</a>:</h4>
<p>yurydelendik updated <a href="https://github.com/bytecodealliance/cranelift/pull/1373" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1373">PR #1373</a> from <code>fde_multi_ret</code> to <code>master</code>:</p>
<blockquote>
<p>Fixes #1372 (discussion there)</p>
<p>The patch properly arranges frame layout info commands for restore and preserve state. Also, it properly serializes them in into FDE.</p>
</blockquote>



<a name="187298421"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231373%20Properly%20preserve%20and%20restore%20CFA%20st.../near/187298421" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231373.20Properly.20preserve.20and.20restore.20CFA.20st.2E.2E.2E.html#187298421">(Feb 03 2020 at 20:07)</a>:</h4>
<p>iximeow submitted <a href="https://github.com/bytecodealliance/cranelift/pull/1373#pullrequestreview-352515002" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1373#pullrequestreview-352515002">PR Review</a>.</p>



<a name="187298423"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231373%20Properly%20preserve%20and%20restore%20CFA%20st.../near/187298423" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231373.20Properly.20preserve.20and.20restore.20CFA.20st.2E.2E.2E.html#187298423">(Feb 03 2020 at 20:07)</a>:</h4>
<p>iximeow submitted <a href="https://github.com/bytecodealliance/cranelift/pull/1373#pullrequestreview-352515002" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1373#pullrequestreview-352515002">PR Review</a>.</p>



<a name="187298425"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231373%20Properly%20preserve%20and%20restore%20CFA%20st.../near/187298425" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231373.20Properly.20preserve.20and.20restore.20CFA.20st.2E.2E.2E.html#187298425">(Feb 03 2020 at 20:07)</a>:</h4>
<p>iximeow created <a href="https://github.com/bytecodealliance/cranelift/pull/1373#discussion_r374306671" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1373#discussion_r374306671">PR Review Comment</a>:</p>
<blockquote>
<p><code>move</code> isn't needed on this closure.</p>
</blockquote>



<a name="187298426"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231373%20Properly%20preserve%20and%20restore%20CFA%20st.../near/187298426" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231373.20Properly.20preserve.20and.20restore.20CFA.20st.2E.2E.2E.html#187298426">(Feb 03 2020 at 20:07)</a>:</h4>
<p>iximeow created <a href="https://github.com/bytecodealliance/cranelift/pull/1373#discussion_r374303709" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1373#discussion_r374303709">PR Review Comment</a>:</p>
<blockquote>
<p>Was there an error in inserting <code>Preserve</code>/<code>Restore</code> outside <code>insert_common_epilogue</code>, or is this just a refactor to keep everything in <code>insert_common_epilogue</code>? Regardless, I don't have a great feel for <code>Layout</code>'s API, and <code>last_ebb</code> is much better than the above "is there an instruction in the next basic block" that was there before.</p>
</blockquote>



<a name="187298427"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231373%20Properly%20preserve%20and%20restore%20CFA%20st.../near/187298427" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231373.20Properly.20preserve.20and.20restore.20CFA.20st.2E.2E.2E.html#187298427">(Feb 03 2020 at 20:07)</a>:</h4>
<p>iximeow created <a href="https://github.com/bytecodealliance/cranelift/pull/1373#discussion_r374313600" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1373#discussion_r374313600">PR Review Comment</a>:</p>
<blockquote>
<p>I have a loose preference for making the right vec in the first place rather than conditionally removing an element especially since <code>is_last</code> is an argument now. But, lacking a benchmark I'm not sure if it really matters in release builds.</p>
</blockquote>



<a name="187298428"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231373%20Properly%20preserve%20and%20restore%20CFA%20st.../near/187298428" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231373.20Properly.20preserve.20and.20restore.20CFA.20st.2E.2E.2E.html#187298428">(Feb 03 2020 at 20:07)</a>:</h4>
<p>iximeow created <a href="https://github.com/bytecodealliance/cranelift/pull/1373#discussion_r374311385" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1373#discussion_r374311385">PR Review Comment</a>:</p>
<blockquote>
<p>I think it's worth noting that it's correct to not see additional CFA directives after <code>restore_state</code> here, because the function exit past this point is a trap. I mention here for two reasons:</p>
<ul>
<li>double-checking my own understanding :)</li>
<li>I think it'd be good to have a comment about this, for someone reading these tests in the future.</li>
</ul>
</blockquote>



<a name="187304411"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231373%20Properly%20preserve%20and%20restore%20CFA%20st.../near/187304411" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231373.20Properly.20preserve.20and.20restore.20CFA.20st.2E.2E.2E.html#187304411">(Feb 03 2020 at 21:10)</a>:</h4>
<p>yurydelendik updated <a href="https://github.com/bytecodealliance/cranelift/pull/1373" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1373">PR #1373</a> from <code>fde_multi_ret</code> to <code>master</code>:</p>
<blockquote>
<p>Fixes #1372 (discussion there)</p>
<p>The patch properly arranges frame layout info commands for restore and preserve state. Also, it properly serializes them in into FDE.</p>
</blockquote>



<a name="187304624"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231373%20Properly%20preserve%20and%20restore%20CFA%20st.../near/187304624" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231373.20Properly.20preserve.20and.20restore.20CFA.20st.2E.2E.2E.html#187304624">(Feb 03 2020 at 21:13)</a>:</h4>
<p>yurydelendik created <a href="https://github.com/bytecodealliance/cranelift/pull/1373#discussion_r374344041" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1373#discussion_r374344041">PR Review Comment</a>:</p>
<blockquote>
<p>There was an error in previous logic: it was inserting <code>Preserve</code> after the <code>CallFrameAddressAt</code>, which made useless. The same issue was with <code>Restore</code> -- it was inserted too late.</p>
</blockquote>



<a name="187304625"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231373%20Properly%20preserve%20and%20restore%20CFA%20st.../near/187304625" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231373.20Properly.20preserve.20and.20restore.20CFA.20st.2E.2E.2E.html#187304625">(Feb 03 2020 at 21:13)</a>:</h4>
<p>yurydelendik submitted <a href="https://github.com/bytecodealliance/cranelift/pull/1373#pullrequestreview-352566549" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1373#pullrequestreview-352566549">PR Review</a>.</p>



<a name="187304722"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231373%20Properly%20preserve%20and%20restore%20CFA%20st.../near/187304722" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231373.20Properly.20preserve.20and.20restore.20CFA.20st.2E.2E.2E.html#187304722">(Feb 03 2020 at 21:14)</a>:</h4>
<p>yurydelendik edited <a href="https://github.com/bytecodealliance/cranelift/pull/1373#discussion_r374344041" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1373#discussion_r374344041">PR Review Comment</a>.</p>



<a name="187304788"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231373%20Properly%20preserve%20and%20restore%20CFA%20st.../near/187304788" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231373.20Properly.20preserve.20and.20restore.20CFA.20st.2E.2E.2E.html#187304788">(Feb 03 2020 at 21:14)</a>:</h4>
<p><strong>yurydelendik</strong> requested <a href="https://github.com/iximeow" target="_blank" title="https://github.com/iximeow">iximeow</a> for a review on <a href="https://github.com/bytecodealliance/cranelift/pull/1373" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1373">PR #1373</a>.</p>



<a name="187310251"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231373%20Properly%20preserve%20and%20restore%20CFA%20st.../near/187310251" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231373.20Properly.20preserve.20and.20restore.20CFA.20st.2E.2E.2E.html#187310251">(Feb 03 2020 at 22:07)</a>:</h4>
<p>iximeow submitted <a href="https://github.com/bytecodealliance/cranelift/pull/1373#pullrequestreview-352597848" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1373#pullrequestreview-352597848">PR Review</a>.</p>



<a name="187310252"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231373%20Properly%20preserve%20and%20restore%20CFA%20st.../near/187310252" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231373.20Properly.20preserve.20and.20restore.20CFA.20st.2E.2E.2E.html#187310252">(Feb 03 2020 at 22:07)</a>:</h4>
<p>iximeow created <a href="https://github.com/bytecodealliance/cranelift/pull/1373#discussion_r374368863" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1373#discussion_r374368863">PR Review Comment</a>:</p>
<blockquote>
<p>oh! yes, I see the errors now.</p>
</blockquote>



<a name="187310313"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231373%20Properly%20preserve%20and%20restore%20CFA%20st.../near/187310313" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231373.20Properly.20preserve.20and.20restore.20CFA.20st.2E.2E.2E.html#187310313">(Feb 03 2020 at 22:08)</a>:</h4>
<p>iximeow submitted <a href="https://github.com/bytecodealliance/cranelift/pull/1373#pullrequestreview-352598076" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1373#pullrequestreview-352598076">PR Review</a>.</p>



<a name="187310350"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231373%20Properly%20preserve%20and%20restore%20CFA%20st.../near/187310350" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231373.20Properly.20preserve.20and.20restore.20CFA.20st.2E.2E.2E.html#187310350">(Feb 03 2020 at 22:08)</a>:</h4>
<p>iximeow merged <a href="https://github.com/bytecodealliance/cranelift/pull/1373" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1373">PR #1373</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>