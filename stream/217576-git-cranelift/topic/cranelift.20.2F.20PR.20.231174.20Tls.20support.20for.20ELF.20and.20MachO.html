<html>
<head><meta charset="utf-8"><title>cranelift / PR #1174 Tls support for ELF and MachO · git-cranelift · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/index.html">git-cranelift</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231174.20Tls.20support.20for.20ELF.20and.20MachO.html">cranelift / PR #1174 Tls support for ELF and MachO</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="186621464"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231174%20Tls%20support%20for%20ELF%20and%20MachO/near/186621464" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231174.20Tls.20support.20for.20ELF.20and.20MachO.html#186621464">(Jan 26 2020 at 13:18)</a>:</h4>
<p>bjorn3 edited <a href="https://github.com/bytecodealliance/cranelift/pull/1174" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1174">PR #1174</a> from <code>tls_support</code> to <code>master</code>:</p>
<blockquote>
<p>This adds TLS (thread local storage) support for ELF targets to Cranelift</p>
<ul>
<li>[x] ASM of the <code>tls_example.clif</code> file has been verifier to match the ASM emitted by LLVM at <a href="https://github.com/bjorn3/rustc_codegen_cranelift/issues/388#issuecomment-531466812" target="_blank" title="https://github.com/bjorn3/rustc_codegen_cranelift/issues/388#issuecomment-531466812">https://github.com/bjorn3/rustc_codegen_cranelift/issues/388#issuecomment-531466812</a></li>
<li>[x] Test runtime: object::write doesn't have enough TLS support yet to test execution.</li>
<li>[ ] Verify encodings are correct and idiomatic.</li>
<li>[x] Rustfmt</li>
<li>[x] Add flag to switch between TLS styles (ELF, machO) and set it automatically from either codegen or backends.</li>
<li>
<p>[ ] Add tests</p>
</li>
<li>
<p>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so and/or ping<br>
<code>bnjbvr</code>. &lt;strike&gt;The list of suggested reviewers on the right can help you.&lt;/strike&gt; No list of suggested reviewers shown on the right side.</p>
</li>
</ul>
<p>Fixes #963</p>
<p>cc @philipc <a href="https://github.com/bjorn3/rustc_codegen_cranelift/issues/388#issuecomment-526909856" target="_blank" title="https://github.com/bjorn3/rustc_codegen_cranelift/issues/388#issuecomment-526909856">https://github.com/bjorn3/rustc_codegen_cranelift/issues/388#issuecomment-526909856</a><br>
cc @abrown Because you implemented SIMD support for x86, I think you know enough of x86 encodings to verify that the encodings are correct.</p>
</blockquote>



<a name="188143532"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231174%20Tls%20support%20for%20ELF%20and%20MachO/near/188143532" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231174.20Tls.20support.20for.20ELF.20and.20MachO.html#188143532">(Feb 13 2020 at 19:52)</a>:</h4>
<p>bjorn3 updated <a href="https://github.com/bytecodealliance/cranelift/pull/1174" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1174">PR #1174</a> from <code>tls_support</code> to <code>master</code>:</p>
<blockquote>
<p>This adds TLS (thread local storage) support for ELF targets to Cranelift</p>
<ul>
<li>[x] ASM of the <code>tls_example.clif</code> file has been verifier to match the ASM emitted by LLVM at <a href="https://github.com/bjorn3/rustc_codegen_cranelift/issues/388#issuecomment-531466812" target="_blank" title="https://github.com/bjorn3/rustc_codegen_cranelift/issues/388#issuecomment-531466812">https://github.com/bjorn3/rustc_codegen_cranelift/issues/388#issuecomment-531466812</a></li>
<li>[x] Test runtime: object::write doesn't have enough TLS support yet to test execution.</li>
<li>[ ] Verify encodings are correct and idiomatic.</li>
<li>[x] Rustfmt</li>
<li>[x] Add flag to switch between TLS styles (ELF, machO) and set it automatically from either codegen or backends.</li>
<li>
<p>[ ] Add tests</p>
</li>
<li>
<p>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so and/or ping<br>
<code>bnjbvr</code>. &lt;strike&gt;The list of suggested reviewers on the right can help you.&lt;/strike&gt; No list of suggested reviewers shown on the right side.</p>
</li>
</ul>
<p>Fixes #963</p>
<p>cc @philipc <a href="https://github.com/bjorn3/rustc_codegen_cranelift/issues/388#issuecomment-526909856" target="_blank" title="https://github.com/bjorn3/rustc_codegen_cranelift/issues/388#issuecomment-526909856">https://github.com/bjorn3/rustc_codegen_cranelift/issues/388#issuecomment-526909856</a><br>
cc @abrown Because you implemented SIMD support for x86, I think you know enough of x86 encodings to verify that the encodings are correct.</p>
</blockquote>



<a name="188208398"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231174%20Tls%20support%20for%20ELF%20and%20MachO/near/188208398" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231174.20Tls.20support.20for.20ELF.20and.20MachO.html#188208398">(Feb 14 2020 at 14:04)</a>:</h4>
<p>bjorn3 updated <a href="https://github.com/bytecodealliance/cranelift/pull/1174" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1174">PR #1174</a> from <code>tls_support</code> to <code>master</code>:</p>
<blockquote>
<p>This adds TLS (thread local storage) support for ELF targets to Cranelift</p>
<ul>
<li>[x] ASM of the <code>tls_example.clif</code> file has been verifier to match the ASM emitted by LLVM at <a href="https://github.com/bjorn3/rustc_codegen_cranelift/issues/388#issuecomment-531466812" target="_blank" title="https://github.com/bjorn3/rustc_codegen_cranelift/issues/388#issuecomment-531466812">https://github.com/bjorn3/rustc_codegen_cranelift/issues/388#issuecomment-531466812</a></li>
<li>[x] Test runtime: object::write doesn't have enough TLS support yet to test execution.</li>
<li>[ ] Verify encodings are correct and idiomatic.</li>
<li>[x] Rustfmt</li>
<li>[x] Add flag to switch between TLS styles (ELF, machO) and set it automatically from either codegen or backends.</li>
<li>
<p>[ ] Add tests</p>
</li>
<li>
<p>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so and/or ping<br>
<code>bnjbvr</code>. &lt;strike&gt;The list of suggested reviewers on the right can help you.&lt;/strike&gt; No list of suggested reviewers shown on the right side.</p>
</li>
</ul>
<p>Fixes #963</p>
<p>cc @philipc <a href="https://github.com/bjorn3/rustc_codegen_cranelift/issues/388#issuecomment-526909856" target="_blank" title="https://github.com/bjorn3/rustc_codegen_cranelift/issues/388#issuecomment-526909856">https://github.com/bjorn3/rustc_codegen_cranelift/issues/388#issuecomment-526909856</a><br>
cc @abrown Because you implemented SIMD support for x86, I think you know enough of x86 encodings to verify that the encodings are correct.</p>
</blockquote>



<a name="188215283"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231174%20Tls%20support%20for%20ELF%20and%20MachO/near/188215283" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231174.20Tls.20support.20for.20ELF.20and.20MachO.html#188215283">(Feb 14 2020 at 15:23)</a>:</h4>
<p>bjorn3 updated <a href="https://github.com/bytecodealliance/cranelift/pull/1174" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1174">PR #1174</a> from <code>tls_support</code> to <code>master</code>:</p>
<blockquote>
<p>This adds TLS (thread local storage) support for ELF targets to Cranelift</p>
<ul>
<li>[x] ASM of the <code>tls_example.clif</code> file has been verifier to match the ASM emitted by LLVM at <a href="https://github.com/bjorn3/rustc_codegen_cranelift/issues/388#issuecomment-531466812" target="_blank" title="https://github.com/bjorn3/rustc_codegen_cranelift/issues/388#issuecomment-531466812">https://github.com/bjorn3/rustc_codegen_cranelift/issues/388#issuecomment-531466812</a></li>
<li>[x] Test runtime: object::write doesn't have enough TLS support yet to test execution.</li>
<li>[ ] Verify encodings are correct and idiomatic.</li>
<li>[x] Rustfmt</li>
<li>[x] Add flag to switch between TLS styles (ELF, machO) and set it automatically from either codegen or backends.</li>
<li>
<p>[ ] Add tests</p>
</li>
<li>
<p>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so and/or ping<br>
<code>bnjbvr</code>. &lt;strike&gt;The list of suggested reviewers on the right can help you.&lt;/strike&gt; No list of suggested reviewers shown on the right side.</p>
</li>
</ul>
<p>Fixes #963</p>
<p>cc @philipc <a href="https://github.com/bjorn3/rustc_codegen_cranelift/issues/388#issuecomment-526909856" target="_blank" title="https://github.com/bjorn3/rustc_codegen_cranelift/issues/388#issuecomment-526909856">https://github.com/bjorn3/rustc_codegen_cranelift/issues/388#issuecomment-526909856</a><br>
cc @abrown Because you implemented SIMD support for x86, I think you know enough of x86 encodings to verify that the encodings are correct.</p>
</blockquote>



<a name="188948609"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231174%20Tls%20support%20for%20ELF%20and%20MachO/near/188948609" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231174.20Tls.20support.20for.20ELF.20and.20MachO.html#188948609">(Feb 24 2020 at 17:45)</a>:</h4>
<p>sunfishcode submitted <a href="https://github.com/bytecodealliance/cranelift/pull/1174#pullrequestreview-363569382" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1174#pullrequestreview-363569382">PR Review</a>.</p>



<a name="188948610"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231174%20Tls%20support%20for%20ELF%20and%20MachO/near/188948610" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231174.20Tls.20support.20for.20ELF.20and.20MachO.html#188948610">(Feb 24 2020 at 17:45)</a>:</h4>
<p>sunfishcode submitted <a href="https://github.com/bytecodealliance/cranelift/pull/1174#pullrequestreview-363569382" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1174#pullrequestreview-363569382">PR Review</a>.</p>



<a name="188948611"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231174%20Tls%20support%20for%20ELF%20and%20MachO/near/188948611" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231174.20Tls.20support.20for.20ELF.20and.20MachO.html#188948611">(Feb 24 2020 at 17:45)</a>:</h4>
<p>sunfishcode created <a href="https://github.com/bytecodealliance/cranelift/pull/1174#discussion_r383407878" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1174#discussion_r383407878">PR Review Comment</a>:</p>
<blockquote>
<p>Instead of having a <code>tls_value</code> instruction, would it work to just continue to use <code>symbol_value</code> here, and use the <code>tls</code> flag of <code>gv</code> to determine whether it's TLS or not? You could add a <code>is_tls_data</code> predicate function which could work the same way as <code>is_colocated_data</code>, <code>FormatPredicateKind::IsColocatedData</code>, and so on, and then <code>define_entity_ref</code> in cranelift-codegen/meta/src/isa/x86/encodings.rs could use that to decide when to apply the TLS legalizations.</p>
</blockquote>



<a name="188948612"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231174%20Tls%20support%20for%20ELF%20and%20MachO/near/188948612" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231174.20Tls.20support.20for.20ELF.20and.20MachO.html#188948612">(Feb 24 2020 at 17:45)</a>:</h4>
<p>sunfishcode created <a href="https://github.com/bytecodealliance/cranelift/pull/1174#discussion_r383413608" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1174#discussion_r383413608">PR Review Comment</a>:</p>
<blockquote>
<p>The ELF and Mach-O instructions here have the same signature, and essentially represent the same functionality, except that they record which target to codegen for. Would it simplify the code to just have one instruction, and move the target check into the encoding phase?</p>
</blockquote>



<a name="188949216"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231174%20Tls%20support%20for%20ELF%20and%20MachO/near/188949216" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231174.20Tls.20support.20for.20ELF.20and.20MachO.html#188949216">(Feb 24 2020 at 17:53)</a>:</h4>
<p>abrown assigned <a href="https://github.com/bytecodealliance/cranelift/pull/1174" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1174">PR #1174</a>.</p>



<a name="188953713"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231174%20Tls%20support%20for%20ELF%20and%20MachO/near/188953713" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231174.20Tls.20support.20for.20ELF.20and.20MachO.html#188953713">(Feb 24 2020 at 18:47)</a>:</h4>
<p>bjorn3 edited <a href="https://github.com/bytecodealliance/cranelift/pull/1174" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1174">PR #1174</a> (assigned to abrown) from <code>tls_support</code> to <code>master</code>:</p>
<blockquote>
<p>This adds TLS (thread local storage) support for ELF targets to Cranelift</p>
<ul>
<li>[x] ASM of the <code>tls_example.clif</code> file has been verifier to match the ASM emitted by LLVM at <a href="https://github.com/bjorn3/rustc_codegen_cranelift/issues/388#issuecomment-531466812" target="_blank" title="https://github.com/bjorn3/rustc_codegen_cranelift/issues/388#issuecomment-531466812">https://github.com/bjorn3/rustc_codegen_cranelift/issues/388#issuecomment-531466812</a></li>
<li>[x] Test runtime: object::write doesn't have enough TLS support yet to test execution.</li>
<li>[ ] Verify encodings are correct and idiomatic.</li>
<li>[x] Rustfmt</li>
<li>[x] Add flag to switch between TLS styles (ELF, machO) and set it automatically from either codegen or backends.</li>
<li>
<p>[x] Add tests</p>
</li>
<li>
<p>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so and/or ping<br>
<code>bnjbvr</code>. &lt;strike&gt;The list of suggested reviewers on the right can help you.&lt;/strike&gt; No list of suggested reviewers shown on the right side.</p>
</li>
</ul>
<p>Fixes #963</p>
<p>cc @philipc <a href="https://github.com/bjorn3/rustc_codegen_cranelift/issues/388#issuecomment-526909856" target="_blank" title="https://github.com/bjorn3/rustc_codegen_cranelift/issues/388#issuecomment-526909856">https://github.com/bjorn3/rustc_codegen_cranelift/issues/388#issuecomment-526909856</a><br>
cc @abrown Because you implemented SIMD support for x86, I think you know enough of x86 encodings to verify that the encodings are correct.</p>
</blockquote>



<a name="188953719"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231174%20Tls%20support%20for%20ELF%20and%20MachO/near/188953719" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231174.20Tls.20support.20for.20ELF.20and.20MachO.html#188953719">(Feb 24 2020 at 18:47)</a>:</h4>
<p>bjorn3 edited <a href="https://github.com/bytecodealliance/cranelift/pull/1174" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1174">PR #1174</a> (assigned to abrown) from <code>tls_support</code> to <code>master</code>:</p>
<blockquote>
<p>This adds TLS (thread local storage) support for ELF targets to Cranelift</p>
<ul>
<li>[x] ASM of the <code>tls_example.clif</code> file has been verifier to match the ASM emitted by LLVM at <a href="https://github.com/bjorn3/rustc_codegen_cranelift/issues/388#issuecomment-531466812" target="_blank" title="https://github.com/bjorn3/rustc_codegen_cranelift/issues/388#issuecomment-531466812">https://github.com/bjorn3/rustc_codegen_cranelift/issues/388#issuecomment-531466812</a></li>
<li>[x] Test runtime: object::write doesn't have enough TLS support yet to test execution.</li>
<li>[x] Verify encodings are correct and idiomatic.</li>
<li>[x] Rustfmt</li>
<li>[x] Add flag to switch between TLS styles (ELF, machO) and set it automatically from either codegen or backends.</li>
<li>
<p>[x] Add tests</p>
</li>
<li>
<p>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so and/or ping<br>
<code>bnjbvr</code>. &lt;strike&gt;The list of suggested reviewers on the right can help you.&lt;/strike&gt; No list of suggested reviewers shown on the right side.</p>
</li>
</ul>
<p>Fixes #963</p>
<p>cc @philipc <a href="https://github.com/bjorn3/rustc_codegen_cranelift/issues/388#issuecomment-526909856" target="_blank" title="https://github.com/bjorn3/rustc_codegen_cranelift/issues/388#issuecomment-526909856">https://github.com/bjorn3/rustc_codegen_cranelift/issues/388#issuecomment-526909856</a><br>
cc @abrown Because you implemented SIMD support for x86, I think you know enough of x86 encodings to verify that the encodings are correct.</p>
</blockquote>



<a name="188955537"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231174%20Tls%20support%20for%20ELF%20and%20MachO/near/188955537" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231174.20Tls.20support.20for.20ELF.20and.20MachO.html#188955537">(Feb 24 2020 at 19:06)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/cranelift/pull/1174#discussion_r383455914" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1174#discussion_r383455914">PR Review Comment</a>:</p>
<blockquote>
<p>Both <code>x86_elf_tls_get_addr</code> and <code>x86_macho_tls_get_addr</code> happen to clobber a register. I am currently representing this as an extra output value. In the future there may be other TLS models added that don't clobber exactly one, but zero, two or more registers. In that case a separate instruction is needed. For symmetry I think it would be nice to keep separate instructions for ELF and Mach-O too.</p>
</blockquote>



<a name="188955538"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231174%20Tls%20support%20for%20ELF%20and%20MachO/near/188955538" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231174.20Tls.20support.20for.20ELF.20and.20MachO.html#188955538">(Feb 24 2020 at 19:06)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/cranelift/pull/1174#pullrequestreview-363628185" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1174#pullrequestreview-363628185">PR Review</a>.</p>



<a name="188955579"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231174%20Tls%20support%20for%20ELF%20and%20MachO/near/188955579" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231174.20Tls.20support.20for.20ELF.20and.20MachO.html#188955579">(Feb 24 2020 at 19:06)</a>:</h4>
<p>sunfishcode submitted <a href="https://github.com/bytecodealliance/cranelift/pull/1174#pullrequestreview-363628724" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1174#pullrequestreview-363628724">PR Review</a>.</p>



<a name="188955580"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231174%20Tls%20support%20for%20ELF%20and%20MachO/near/188955580" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231174.20Tls.20support.20for.20ELF.20and.20MachO.html#188955580">(Feb 24 2020 at 19:06)</a>:</h4>
<p>sunfishcode created <a href="https://github.com/bytecodealliance/cranelift/pull/1174#discussion_r383456357" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1174#discussion_r383456357">PR Review Comment</a>:</p>
<blockquote>
<p>Makes sense!</p>
</blockquote>



<a name="188956309"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231174%20Tls%20support%20for%20ELF%20and%20MachO/near/188956309" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231174.20Tls.20support.20for.20ELF.20and.20MachO.html#188956309">(Feb 24 2020 at 19:14)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/cranelift/pull/1174#pullrequestreview-363633210" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1174#pullrequestreview-363633210">PR Review</a>.</p>



<a name="188956310"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231174%20Tls%20support%20for%20ELF%20and%20MachO/near/188956310" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231174.20Tls.20support.20for.20ELF.20and.20MachO.html#188956310">(Feb 24 2020 at 19:14)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/cranelift/pull/1174#discussion_r383460015" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1174#discussion_r383460015">PR Review Comment</a>:</p>
<blockquote>
<p><code>symbol_value</code> can directly be encoded, while <code>tls_value</code> needs to be legalized to the correct instruction for the respective object format. See comment below for why. As far as I know, unlike an encoding, there is no way to predicate a legalization.</p>
</blockquote>



<a name="189056923"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231174%20Tls%20support%20for%20ELF%20and%20MachO/near/189056923" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231174.20Tls.20support.20for.20ELF.20and.20MachO.html#189056923">(Feb 25 2020 at 20:18)</a>:</h4>
<p>bjorn3 updated <a href="https://github.com/bytecodealliance/cranelift/pull/1174" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1174">PR #1174</a> (assigned to abrown) from <code>tls_support</code> to <code>master</code>:</p>
<blockquote>
<p>This adds TLS (thread local storage) support for ELF targets to Cranelift</p>
<ul>
<li>[x] ASM of the <code>tls_example.clif</code> file has been verifier to match the ASM emitted by LLVM at <a href="https://github.com/bjorn3/rustc_codegen_cranelift/issues/388#issuecomment-531466812" target="_blank" title="https://github.com/bjorn3/rustc_codegen_cranelift/issues/388#issuecomment-531466812">https://github.com/bjorn3/rustc_codegen_cranelift/issues/388#issuecomment-531466812</a></li>
<li>[x] Test runtime: object::write doesn't have enough TLS support yet to test execution.</li>
<li>[x] Verify encodings are correct and idiomatic.</li>
<li>[x] Rustfmt</li>
<li>[x] Add flag to switch between TLS styles (ELF, machO) and set it automatically from either codegen or backends.</li>
<li>
<p>[x] Add tests</p>
</li>
<li>
<p>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so and/or ping<br>
<code>bnjbvr</code>. &lt;strike&gt;The list of suggested reviewers on the right can help you.&lt;/strike&gt; No list of suggested reviewers shown on the right side.</p>
</li>
</ul>
<p>Fixes #963</p>
<p>cc @philipc <a href="https://github.com/bjorn3/rustc_codegen_cranelift/issues/388#issuecomment-526909856" target="_blank" title="https://github.com/bjorn3/rustc_codegen_cranelift/issues/388#issuecomment-526909856">https://github.com/bjorn3/rustc_codegen_cranelift/issues/388#issuecomment-526909856</a><br>
cc @abrown Because you implemented SIMD support for x86, I think you know enough of x86 encodings to verify that the encodings are correct.</p>
</blockquote>



<a name="189057083"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231174%20Tls%20support%20for%20ELF%20and%20MachO/near/189057083" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231174.20Tls.20support.20for.20ELF.20and.20MachO.html#189057083">(Feb 25 2020 at 20:21)</a>:</h4>
<p>bjorn3 updated <a href="https://github.com/bytecodealliance/cranelift/pull/1174" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1174">PR #1174</a> (assigned to abrown) from <code>tls_support</code> to <code>master</code>:</p>
<blockquote>
<p>This adds TLS (thread local storage) support for ELF targets to Cranelift</p>
<ul>
<li>[x] ASM of the <code>tls_example.clif</code> file has been verifier to match the ASM emitted by LLVM at <a href="https://github.com/bjorn3/rustc_codegen_cranelift/issues/388#issuecomment-531466812" target="_blank" title="https://github.com/bjorn3/rustc_codegen_cranelift/issues/388#issuecomment-531466812">https://github.com/bjorn3/rustc_codegen_cranelift/issues/388#issuecomment-531466812</a></li>
<li>[x] Test runtime: object::write doesn't have enough TLS support yet to test execution.</li>
<li>[x] Verify encodings are correct and idiomatic.</li>
<li>[x] Rustfmt</li>
<li>[x] Add flag to switch between TLS styles (ELF, machO) and set it automatically from either codegen or backends.</li>
<li>
<p>[x] Add tests</p>
</li>
<li>
<p>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so and/or ping<br>
<code>bnjbvr</code>. &lt;strike&gt;The list of suggested reviewers on the right can help you.&lt;/strike&gt; No list of suggested reviewers shown on the right side.</p>
</li>
</ul>
<p>Fixes #963</p>
<p>cc @philipc <a href="https://github.com/bjorn3/rustc_codegen_cranelift/issues/388#issuecomment-526909856" target="_blank" title="https://github.com/bjorn3/rustc_codegen_cranelift/issues/388#issuecomment-526909856">https://github.com/bjorn3/rustc_codegen_cranelift/issues/388#issuecomment-526909856</a><br>
cc @abrown Because you implemented SIMD support for x86, I think you know enough of x86 encodings to verify that the encodings are correct.</p>
</blockquote>



<a name="189079730"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231174%20Tls%20support%20for%20ELF%20and%20MachO/near/189079730" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231174.20Tls.20support.20for.20ELF.20and.20MachO.html#189079730">(Feb 26 2020 at 01:49)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/cranelift/pull/1174#pullrequestreview-364575022" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1174#pullrequestreview-364575022">PR Review</a>.</p>



<a name="189079781"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217576-git-cranelift/topic/cranelift%20/%20PR%20%231174%20Tls%20support%20for%20ELF%20and%20MachO/near/189079781" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GitHub <a href="https://bytecodealliance.github.io/zulip-archive/stream/217576-git-cranelift/topic/cranelift.20.2F.20PR.20.231174.20Tls.20support.20for.20ELF.20and.20MachO.html#189079781">(Feb 26 2020 at 01:50)</a>:</h4>
<p>abrown merged <a href="https://github.com/bytecodealliance/cranelift/pull/1174" target="_blank" title="https://github.com/bytecodealliance/cranelift/pull/1174">PR #1174</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>