<html>
<head><meta charset="utf-8"><title>✔ Creating a TypedFunc for a component · wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/index.html">wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20Creating.20a.20TypedFunc.20for.20a.20component.html">✔ Creating a TypedFunc for a component</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="394482902"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20Creating%20a%20TypedFunc%20for%20a%20component/near/394482902" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> i509VCB <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20Creating.20a.20TypedFunc.20for.20a.20component.html#394482902">(Oct 02 2023 at 17:39)</a>:</h4>
<p>I'm not sure why I am getting errors about <code>ComponentNamedList</code>.</p>
<p>For reference I am trying to get a TypedFunc for this: <a href="https://github.com/i509VCB/aerugo/blob/ab79099ba124da6f57a021d1f7357e00f45ffce6/wm.wit#L12-L16">https://github.com/i509VCB/aerugo/blob/ab79099ba124da6f57a021d1f7357e00f45ffce6/wm.wit#L12-L16</a></p>
<p>And I have this so far:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">struct</span> <span class="nc">WmFuncs</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">new_toplevel</span>: <span class="nc">TypedFunc</span><span class="o">&lt;</span><span class="n">Resource</span><span class="o">&lt;</span><span class="n">Toplevel</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="n">closed_toplevel</span>: <span class="nc">TypedFunc</span><span class="o">&lt;</span><span class="n">ToplevelId</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="n">update_toplevel</span>: <span class="nc">TypedFunc</span><span class="o">&lt;</span><span class="p">(</span><span class="n">ToplevelId</span><span class="p">,</span><span class="w"> </span><span class="n">ToplevelUpdates</span><span class="p">),</span><span class="w"> </span><span class="p">()</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="n">ack_toplevel</span>: <span class="nc">TypedFunc</span><span class="o">&lt;</span><span class="p">(</span><span class="n">ToplevelId</span><span class="p">,</span><span class="w"> </span><span class="kt">u32</span><span class="p">),</span><span class="w"> </span><span class="p">()</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="n">committed_toplevel</span>: <span class="nc">TypedFunc</span><span class="o">&lt;</span><span class="p">(</span><span class="n">ToplevelId</span><span class="p">,</span><span class="w"> </span><span class="nb">Option</span><span class="o">&lt;</span><span class="n">Resource</span><span class="o">&lt;</span><span class="n">Snapshot</span><span class="o">&gt;&gt;</span><span class="p">),</span><span class="w"> </span><span class="p">()</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="n">key</span>: <span class="nc">TypedFunc</span><span class="o">&lt;</span><span class="p">(</span><span class="kt">u32</span><span class="p">,</span><span class="w"> </span><span class="kt">u32</span><span class="p">,</span><span class="w"> </span><span class="nb">Option</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">KeyStatus</span><span class="p">),</span><span class="w"> </span><span class="n">KeyFilter</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="n">key_modifiers</span>: <span class="nc">TypedFunc</span><span class="o">&lt;</span><span class="n">KeyModifiers</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="n">new_output</span>: <span class="nc">TypedFunc</span><span class="o">&lt;</span><span class="n">Resource</span><span class="o">&lt;</span><span class="n">Output</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="n">disconnect_output</span>: <span class="nc">TypedFunc</span><span class="o">&lt;</span><span class="n">OutputId</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="o">&gt;</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div>
<p>My suspicion is that I'm forgetting something here?</p>



<a name="394483115"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20Creating%20a%20TypedFunc%20for%20a%20component/near/394483115" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> i509VCB <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20Creating.20a.20TypedFunc.20for.20a.20component.html#394483115">(Oct 02 2023 at 17:40)</a>:</h4>
<p>The compiler error:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">error</span><span class="p">[</span><span class="n">E0277</span><span class="p">]</span>: <span class="nc">the</span><span class="w"> </span><span class="k">trait</span><span class="w"> </span><span class="n">bound</span><span class="w"> </span><span class="err">`</span><span class="n">wasmtime</span>::<span class="n">component</span>::<span class="n">Resource</span><span class="o">&lt;</span><span class="n">host</span>::<span class="n">aerugo</span>::<span class="n">wm</span>::<span class="n">types</span>::<span class="n">Toplevel</span><span class="o">&gt;</span>: <span class="nc">ComponentNamedList</span><span class="err">`</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">satisfied</span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">crates</span><span class="o">/</span><span class="n">wm</span><span class="o">-</span><span class="n">runtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">lib</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">300</span>:<span class="mi">36</span>
<span class="w">    </span><span class="o">|</span>
<span class="mi">300</span><span class="w"> </span><span class="o">|</span><span class="w">             </span><span class="n">new_toplevel</span>: <span class="nc">instance</span><span class="p">.</span><span class="n">get_typed_func</span><span class="p">(</span><span class="n">store</span><span class="p">,</span><span class="w"> </span><span class="s">"new-toplevel"</span><span class="p">)</span><span class="o">?</span><span class="p">,</span>
<span class="w">    </span><span class="o">|</span><span class="w">                                    </span><span class="o">^^^^^^^^^^^^^^</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">trait</span><span class="w"> </span><span class="err">`</span><span class="n">ComponentNamedList</span><span class="err">`</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">implemented</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="err">`</span><span class="n">wasmtime</span>::<span class="n">component</span>::<span class="n">Resource</span><span class="o">&lt;</span><span class="n">host</span>::<span class="n">aerugo</span>::<span class="n">wm</span>::<span class="n">types</span>::<span class="n">Toplevel</span><span class="o">&gt;</span><span class="err">`</span>
<span class="w">    </span><span class="o">|</span>
</code></pre></div>



<a name="394483240"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20Creating%20a%20TypedFunc%20for%20a%20component/near/394483240" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20Creating.20a.20TypedFunc.20for.20a.20component.html#394483240">(Oct 02 2023 at 17:41)</a>:</h4>
<p>are you using wasmtime::component::bindgen?</p>



<a name="394483248"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20Creating%20a%20TypedFunc%20for%20a%20component/near/394483248" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20Creating.20a.20TypedFunc.20for.20a.20component.html#394483248">(Oct 02 2023 at 17:41)</a>:</h4>
<p>change <code>new_toplevel: TypedFunc&lt;Resource&lt;Toplevel&gt;, ()&gt;,</code> to <code>new_toplevel: TypedFunc&lt;(Resource&lt;Toplevel&gt;,), ()&gt;,</code> I think</p>



<a name="394483267"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20Creating%20a%20TypedFunc%20for%20a%20component/near/394483267" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20Creating.20a.20TypedFunc.20for.20a.20component.html#394483267">(Oct 02 2023 at 17:41)</a>:</h4>
<p>or yeah use <code>bindgen!</code> if you can</p>



<a name="394483274"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20Creating%20a%20TypedFunc%20for%20a%20component/near/394483274" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> i509VCB <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20Creating.20a.20TypedFunc.20for.20a.20component.html#394483274">(Oct 02 2023 at 17:41)</a>:</h4>
<p><span class="user-mention silent" data-user-id="253992">Pat Hickey</span> <a href="#narrow/stream/217126-wasmtime/topic/Creating.20a.20TypedFunc.20for.20a.20component/near/394483240">said</a>:</p>
<blockquote>
<p>are you using wasmtime::component::bindgen?</p>
</blockquote>
<p>yes</p>



<a name="394483322"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20Creating%20a%20TypedFunc%20for%20a%20component/near/394483322" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> i509VCB <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20Creating.20a.20TypedFunc.20for.20a.20component.html#394483322">(Oct 02 2023 at 17:42)</a>:</h4>
<p>Although I get nothing from bindgen to load those typed funcs from my scan of the expanded macro?</p>



<a name="394483329"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20Creating%20a%20TypedFunc%20for%20a%20component/near/394483329" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20Creating.20a.20TypedFunc.20for.20a.20component.html#394483329">(Oct 02 2023 at 17:42)</a>:</h4>
<p>actually alex got it, its the 1-tuple thing</p>



<a name="394483402"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20Creating%20a%20TypedFunc%20for%20a%20component/near/394483402" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20Creating.20a.20TypedFunc.20for.20a.20component.html#394483402">(Oct 02 2023 at 17:42)</a>:</h4>
<p>is the output of <code>bindgen!</code> what's failing to compile?</p>



<a name="394483432"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20Creating%20a%20TypedFunc%20for%20a%20component/near/394483432" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> i509VCB <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20Creating.20a.20TypedFunc.20for.20a.20component.html#394483432">(Oct 02 2023 at 17:42)</a>:</h4>
<p><span class="user-mention silent" data-user-id="253994">Alex Crichton</span> <a href="#narrow/stream/217126-wasmtime/topic/Creating.20a.20TypedFunc.20for.20a.20component/near/394483402">said</a>:</p>
<blockquote>
<p>is the output of <code>bindgen!</code> what's failing to compile?</p>
</blockquote>
<p>No</p>



<a name="394483495"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20Creating%20a%20TypedFunc%20for%20a%20component/near/394483495" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> i509VCB <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20Creating.20a.20TypedFunc.20for.20a.20component.html#394483495">(Oct 02 2023 at 17:42)</a>:</h4>
<p>Given the mention of <code>bindgen!</code> I'm wondering if I skipped over something that already has the types of the TypedFunc I am trying to load</p>



<a name="394483507"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20Creating%20a%20TypedFunc%20for%20a%20component/near/394483507" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20Creating.20a.20TypedFunc.20for.20a.20component.html#394483507">(Oct 02 2023 at 17:43)</a>:</h4>
<p>ah ok, if you're looking for features in the generated code please feel free to file issues for those</p>



<a name="394483558"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20Creating%20a%20TypedFunc%20for%20a%20component/near/394483558" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20Creating.20a.20TypedFunc.20for.20a.20component.html#394483558">(Oct 02 2023 at 17:43)</a>:</h4>
<p>bindgen will generate a <code>WmTypes::Wm</code> trait that you will need to <code>impl</code> to provide each of those funcs.</p>



<a name="394483606"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20Creating%20a%20TypedFunc%20for%20a%20component/near/394483606" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20Creating.20a.20TypedFunc.20for.20a.20component.html#394483606">(Oct 02 2023 at 17:43)</a>:</h4>
<p>it depends on the structure of the WIT and also what you're doing specifically, but if you find that <code>bindgen!</code> doesn't work for you then we should soup up <code>bindgen!</code> on our end to be more featureful most likely</p>



<a name="394483754"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20Creating%20a%20TypedFunc%20for%20a%20component/near/394483754" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> i509VCB <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20Creating.20a.20TypedFunc.20for.20a.20component.html#394483754">(Oct 02 2023 at 17:44)</a>:</h4>
<p><span class="user-mention silent" data-user-id="253994">Alex Crichton</span> <a href="#narrow/stream/217126-wasmtime/topic/Creating.20a.20TypedFunc.20for.20a.20component/near/394483606">said</a>:</p>
<blockquote>
<p>it depends on the structure of the WIT and also what you're doing specifically, but if you find that <code>bindgen!</code> doesn't work for you then we should soup up <code>bindgen!</code> on our end to be more featureful most likely</p>
</blockquote>
<p>Yeah ideally bindgen! would generate a type containing all the TypedFuncs for the resource returned from wasm like I have done</p>



<a name="394483828"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20Creating%20a%20TypedFunc%20for%20a%20component/near/394483828" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> i509VCB <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20Creating.20a.20TypedFunc.20for.20a.20component.html#394483828">(Oct 02 2023 at 17:45)</a>:</h4>
<p><span class="user-mention silent" data-user-id="253992">Pat Hickey</span> <a href="#narrow/stream/217126-wasmtime/topic/Creating.20a.20TypedFunc.20for.20a.20component/near/394483558">said</a>:</p>
<blockquote>
<p>bindgen will generate a <code>WmTypes::Wm</code> trait that you will need to <code>impl</code> to provide each of those funcs.</p>
</blockquote>
<p>And there is a <code>Wm</code> type but that does not contain anything from the resource.</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">struct</span> <span class="nc">WmTypes</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="n">get_info</span>:<span class="nc">wasmtime</span>::<span class="n">component</span>::<span class="n">Func</span><span class="p">,</span><span class="n">create_wm</span>:<span class="nc">wasmtime</span>::<span class="n">component</span>::<span class="n">Func</span><span class="p">,</span>
<span class="w">        </span><span class="p">}</span>
</code></pre></div>



<a name="394483861"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20Creating%20a%20TypedFunc%20for%20a%20component/near/394483861" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> i509VCB <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20Creating.20a.20TypedFunc.20for.20a.20component.html#394483861">(Oct 02 2023 at 17:45)</a>:</h4>
<p>It's just the two functions from the interface that that contains</p>



<a name="394483873"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20Creating%20a%20TypedFunc%20for%20a%20component/near/394483873" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20Creating.20a.20TypedFunc.20for.20a.20component.html#394483873">(Oct 02 2023 at 17:45)</a>:</h4>
<p>why do you want it to work that way? can you instead define a struct <code>MyWm</code> and <code>impl wm_types::Wm for MyWm</code> ?</p>



<a name="394483903"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20Creating%20a%20TypedFunc%20for%20a%20component/near/394483903" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20Creating.20a.20TypedFunc.20for.20a.20component.html#394483903">(Oct 02 2023 at 17:45)</a>:</h4>
<p>oh I believe these are exports instead of imports</p>



<a name="394483930"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20Creating%20a%20TypedFunc%20for%20a%20component/near/394483930" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20Creating.20a.20TypedFunc.20for.20a.20component.html#394483930">(Oct 02 2023 at 17:45)</a>:</h4>
<p>imports get traits but exports are stored as funcs</p>



<a name="394484077"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20Creating%20a%20TypedFunc%20for%20a%20component/near/394484077" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20Creating.20a.20TypedFunc.20for.20a.20component.html#394484077">(Oct 02 2023 at 17:46)</a>:</h4>
<p><span class="user-mention" data-user-id="653437">@i509VCB</span> unfortunately given lifetimes it's not possible to store those as <code>TypedFunc</code>, but within each <code>call_*</code> method you'll see that the first thing it does is cast to a typed func.</p>



<a name="394484091"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20Creating%20a%20TypedFunc%20for%20a%20component/near/394484091" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20Creating.20a.20TypedFunc.20for.20a.20component.html#394484091">(Oct 02 2023 at 17:46)</a>:</h4>
<p>there will be a <code>wm_types::Host</code> trait that requires an impl of any functions in wm-types.</p>



<a name="394484140"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20Creating%20a%20TypedFunc%20for%20a%20component/near/394484140" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20Creating.20a.20TypedFunc.20for.20a.20component.html#394484140">(Oct 02 2023 at 17:46)</a>:</h4>
<p>but we could add accessors such as <code>bindings.func_*</code> which returns <code>&amp;TypedFunc&lt;...&gt;</code></p>



<a name="394484213"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20Creating%20a%20TypedFunc%20for%20a%20component/near/394484213" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20Creating.20a.20TypedFunc.20for.20a.20component.html#394484213">(Oct 02 2023 at 17:47)</a>:</h4>
<p><span class="user-mention" data-user-id="253992">@Pat Hickey</span> that's only if <code>wm-types</code> was an import though? Given the <code>Func</code> I think these are exports?</p>



<a name="394484219"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20Creating%20a%20TypedFunc%20for%20a%20component/near/394484219" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20Creating.20a.20TypedFunc.20for.20a.20component.html#394484219">(Oct 02 2023 at 17:47)</a>:</h4>
<p>wm_types::Host should just contain <code>fn create_wm(...) ...</code></p>



<a name="394484264"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20Creating%20a%20TypedFunc%20for%20a%20component/near/394484264" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20Creating.20a.20TypedFunc.20for.20a.20component.html#394484264">(Oct 02 2023 at 17:47)</a>:</h4>
<p>oh! of course.</p>



<a name="394484274"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20Creating%20a%20TypedFunc%20for%20a%20component/near/394484274" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20Creating.20a.20TypedFunc.20for.20a.20component.html#394484274">(Oct 02 2023 at 17:47)</a>:</h4>
<p>sorry, i read these wrong.</p>



<a name="394484291"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20Creating%20a%20TypedFunc%20for%20a%20component/near/394484291" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> i509VCB <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20Creating.20a.20TypedFunc.20for.20a.20component.html#394484291">(Oct 02 2023 at 17:47)</a>:</h4>
<p>There is a <code>HostWm</code> trait that's generated but it's entirely empty lol</p>



<a name="394484441"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20Creating%20a%20TypedFunc%20for%20a%20component/near/394484441" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20Creating.20a.20TypedFunc.20for.20a.20component.html#394484441">(Oct 02 2023 at 17:48)</a>:</h4>
<p>which part of this are you trying to implement on the host, and which part in a wasm component</p>



<a name="394484508"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20Creating%20a%20TypedFunc%20for%20a%20component/near/394484508" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> i509VCB <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20Creating.20a.20TypedFunc.20for.20a.20component.html#394484508">(Oct 02 2023 at 17:48)</a>:</h4>
<p>The wasm component implements the <code>wm</code> resource and I call it from the host.</p>



<a name="394484521"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20Creating%20a%20TypedFunc%20for%20a%20component/near/394484521" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20Creating.20a.20TypedFunc.20for.20a.20component.html#394484521">(Oct 02 2023 at 17:48)</a>:</h4>
<p>ok, got it.</p>



<a name="394484576"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20Creating%20a%20TypedFunc%20for%20a%20component/near/394484576" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20Creating.20a.20TypedFunc.20for.20a.20component.html#394484576">(Oct 02 2023 at 17:49)</a>:</h4>
<p>so there should be some<code>struct AerugoWm</code> defined by bindgen!.</p>



<a name="394484600"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20Creating%20a%20TypedFunc%20for%20a%20component/near/394484600" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20Creating.20a.20TypedFunc.20for.20a.20component.html#394484600">(Oct 02 2023 at 17:49)</a>:</h4>
<p>is there a reason the <code>call_*</code> methods won't work for you? e.g. how come you want access to the <code>TypedFunc</code>?</p>



<a name="394484717"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20Creating%20a%20TypedFunc%20for%20a%20component/near/394484717" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20Creating.20a.20TypedFunc.20for.20a.20component.html#394484717">(Oct 02 2023 at 17:50)</a>:</h4>
<p>and that will have a <code>fn aerugo_wm_wm_types(&amp;mut store)</code> which should then be a <code>struct WmTypes</code> and <code>WmTypes</code> should have a <code>fn create_wm</code></p>



<a name="394484766"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20Creating%20a%20TypedFunc%20for%20a%20component/near/394484766" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> i509VCB <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20Creating.20a.20TypedFunc.20for.20a.20component.html#394484766">(Oct 02 2023 at 17:50)</a>:</h4>
<p><span class="user-mention silent" data-user-id="253994">Alex Crichton</span> <a href="#narrow/stream/217126-wasmtime/topic/Creating.20a.20TypedFunc.20for.20a.20component/near/394484600">said</a>:</p>
<blockquote>
<p>is there a reason the <code>call_*</code> methods won't work for you? e.g. how come you want access to the <code>TypedFunc</code>?</p>
</blockquote>
<p>No <code>call</code> methods exist for the functions on the <code>resource wm</code>: This is what the expanded macro generates: <a href="https://gist.github.com/i509VCB/13ebc08130e7b190c9b699d7102a7184">https://gist.github.com/i509VCB/13ebc08130e7b190c9b699d7102a7184</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://gist.github.com/i509VCB/13ebc08130e7b190c9b699d7102a7184" style="background-image: url(https\:\/\/uploads\.zulipusercontent\.net\/2aafd906f69f8f71c7544060163ba3e419b173e8\/68747470733a2f2f6769746875622e6769746875626173736574732e636f6d2f696d616765732f6d6f64756c65732f67697374732f676973742d6f672d696d6167652e706e67)"></a><div class="data-container"><div class="message_embed_title"><a href="https://gist.github.com/i509VCB/13ebc08130e7b190c9b699d7102a7184" title="expanded.rs">expanded.rs</a></div><div class="message_embed_description">GitHub Gist: instantly share code, notes, and snippets.</div></div></div>



<a name="394484794"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20Creating%20a%20TypedFunc%20for%20a%20component/near/394484794" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> i509VCB <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20Creating.20a.20TypedFunc.20for.20a.20component.html#394484794">(Oct 02 2023 at 17:50)</a>:</h4>
<p>Unless this was added recently and I need to update wasmtime again</p>



<a name="394485133"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20Creating%20a%20TypedFunc%20for%20a%20component/near/394485133" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20Creating.20a.20TypedFunc.20for.20a.20component.html#394485133">(Oct 02 2023 at 17:53)</a>:</h4>
<p>Are you using <code>main</code> or are you using 13.0.0?</p>



<a name="394485166"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20Creating%20a%20TypedFunc%20for%20a%20component/near/394485166" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> i509VCB <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20Creating.20a.20TypedFunc.20for.20a.20component.html#394485166">(Oct 02 2023 at 17:53)</a>:</h4>
<p>13.0.0</p>



<a name="394485231"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20Creating%20a%20TypedFunc%20for%20a%20component/near/394485231" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20Creating.20a.20TypedFunc.20for.20a.20component.html#394485231">(Oct 02 2023 at 17:53)</a>:</h4>
<p>ah ok try using <code>main</code>, and I think you should see a new accessor for the resource methods</p>



<a name="394485255"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20Creating%20a%20TypedFunc%20for%20a%20component/near/394485255" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20Creating.20a.20TypedFunc.20for.20a.20component.html#394485255">(Oct 02 2023 at 17:54)</a>:</h4>
<p>support for exported resources didn't make it into 13.0.0</p>



<a name="394485322"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20Creating%20a%20TypedFunc%20for%20a%20component/near/394485322" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> i509VCB <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20Creating.20a.20TypedFunc.20for.20a.20component.html#394485322">(Oct 02 2023 at 17:54)</a>:</h4>
<p>Okay I'll give a look at main, this is still bleeding edge so it's not unexpected</p>



<a name="394488189"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20Creating%20a%20TypedFunc%20for%20a%20component/near/394488189" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> i509VCB <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20Creating.20a.20TypedFunc.20for.20a.20component.html#394488189">(Oct 02 2023 at 18:14)</a>:</h4>
<p>Yeah main generates the stuff. Thank you!</p>



<a name="394488373"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20Creating%20a%20TypedFunc%20for%20a%20component/near/394488373" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20Creating.20a.20TypedFunc.20for.20a.20component.html#394488373">(Oct 02 2023 at 18:16)</a>:</h4>
<p><span class="user-mention silent" data-user-id="653437">i509VCB</span> has marked this topic as resolved.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>