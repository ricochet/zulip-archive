<html>
<head><meta charset="utf-8"><title>✔ debugging: add breakpoint to emitted code · wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/index.html">wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20debugging.3A.20add.20breakpoint.20to.20emitted.20code.html">✔ debugging: add breakpoint to emitted code</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="464050076"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20debugging%3A%20add%20breakpoint%20to%20emitted%20code/near/464050076" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vulcain <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20debugging.3A.20add.20breakpoint.20to.20emitted.20code.html#464050076">(Aug 21 2024 at 13:03)</a>:</h4>
<p>Hey <span aria-label="wave" class="emoji emoji-1f44b" role="img" title="wave">:wave:</span><br>
There is an issue with the emitted code, and I can't find what needs to change to make it work. It would help if I could run the output step by step and display registers, stack etc. Is it possible with lldb ? How can I add a breakpoint ?<br>
Thanks <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="464052839"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20debugging%3A%20add%20breakpoint%20to%20emitted%20code/near/464052839" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ralph <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20debugging.3A.20add.20breakpoint.20to.20emitted.20code.html#464052839">(Aug 21 2024 at 13:10)</a>:</h4>
<p>components or wasi p1?</p>



<a name="464052976"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20debugging%3A%20add%20breakpoint%20to%20emitted%20code/near/464052976" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ralph <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20debugging.3A.20add.20breakpoint.20to.20emitted.20code.html#464052976">(Aug 21 2024 at 13:11)</a>:</h4>
<p>if components: <a href="https://hachyderm.io/@squillace/112989210932769282">https://hachyderm.io/@squillace/112989210932769282</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://hachyderm.io/@squillace/112989210932769282" style="background-image: url(&quot;https://uploads.zulipusercontent.net/ebaf5362fc53977980fb320f009a668d878e91e0/68747470733a2f2f6d656469612e68616368796465726d2e696f2f6d656469615f6174746163686d656e74732f66696c65732f3131322f3938392f3231302f3339362f3631392f3639382f736d616c6c2f333637636162613766663562613231612e706e67&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://hachyderm.io/@squillace/112989210932769282" title="squillace (@squillace@hachyderm.io)">squillace (@squillace@hachyderm.io)</a></div><div class="message_embed_description">Attached: 1 video

Back in March at #wasmio, @anfibiacreativa@mastodon.social and I showed a WIDE array of #webassembly debugging in #vscode: https://www.youtube.com/watch?v=sofGOtwGWu8. 

But, you'll note: the debugger couldn't navigate #webassemblycomponent files. Now it can!</div></div></div>



<a name="464052990"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20debugging%3A%20add%20breakpoint%20to%20emitted%20code/near/464052990" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vulcain <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20debugging.3A.20add.20breakpoint.20to.20emitted.20code.html#464052990">(Aug 21 2024 at 13:11)</a>:</h4>
<p>wasi p1</p>



<a name="464053022"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20debugging%3A%20add%20breakpoint%20to%20emitted%20code/near/464053022" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ralph <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20debugging.3A.20add.20breakpoint.20to.20emitted.20code.html#464053022">(Aug 21 2024 at 13:11)</a>:</h4>
<p>then that works even better:</p>



<a name="464053238"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20debugging%3A%20add%20breakpoint%20to%20emitted%20code/near/464053238" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ralph <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20debugging.3A.20add.20breakpoint.20to.20emitted.20code.html#464053238">(Aug 21 2024 at 13:12)</a>:</h4>
<p>whether in vscode or not, the magic invocation is <a href="https://github.com/squillace/hello-wasi-http/blob/ff567823aed4451142f31bd0a90b196d576fabf7/.vscode/launch.json#L11-L17">https://github.com/squillace/hello-wasi-http/blob/ff567823aed4451142f31bd0a90b196d576fabf7/.vscode/launch.json#L11-L17</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/squillace/hello-wasi-http/blob/ff567823aed4451142f31bd0a90b196d576fabf7/.vscode/launch.json#L11-L17" style="background-image: url(&quot;https://uploads.zulipusercontent.net/6fe258761e5fe0922e275c6c143d3fa953d46dcd/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f303435613235626561626666633932393531346635323836313262643132653531353631653661356265643430393264366666353439383164653333626661312f737175696c6c6163652f68656c6c6f2d776173692d68747470&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/squillace/hello-wasi-http/blob/ff567823aed4451142f31bd0a90b196d576fabf7/.vscode/launch.json#L11-L17" title="hello-wasi-http/.vscode/launch.json at ff567823aed4451142f31bd0a90b196d576fabf7 · squillace/hello-wasi-http">hello-wasi-http/.vscode/launch.json at ff567823aed4451142f31bd0a90b196d576fabf7 · squillace/hello-wasi-http</a></div><div class="message_embed_description">simple repo to demonstrate how to debug Rust wasm components with wasmtime - squillace/hello-wasi-http</div></div></div>



<a name="464053376"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20debugging%3A%20add%20breakpoint%20to%20emitted%20code/near/464053376" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ralph <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20debugging.3A.20add.20breakpoint.20to.20emitted.20code.html#464053376">(Aug 21 2024 at 13:13)</a>:</h4>
<p>lemme know how that works for you, because <em>IT IS NOT PERFECT</em></p>



<a name="464053483"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20debugging%3A%20add%20breakpoint%20to%20emitted%20code/near/464053483" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ralph <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20debugging.3A.20add.20breakpoint.20to.20emitted.20code.html#464053483">(Aug 21 2024 at 13:13)</a>:</h4>
<p>you can also use wamr debugger for wasi p1, but to do so I think you have to build llvm and lldb from scratch and apply a patch and then build the vscode extension... so, <em>harder</em></p>



<a name="464054996"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20debugging%3A%20add%20breakpoint%20to%20emitted%20code/near/464054996" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vulcain <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20debugging.3A.20add.20breakpoint.20to.20emitted.20code.html#464054996">(Aug 21 2024 at 13:19)</a>:</h4>
<p>Thank you, but my situation is a bit specific. I am working on winch, and dwarf has not been developed yet. Also, I don't have any source language, I just wrote the module in WAT</p>



<a name="464056289"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20debugging%3A%20add%20breakpoint%20to%20emitted%20code/near/464056289" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vulcain <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20debugging.3A.20add.20breakpoint.20to.20emitted.20code.html#464056289">(Aug 21 2024 at 13:24)</a>:</h4>
<p>I have an llvm &amp; lldb built from scratch on my machine, so I will try the wamr debugger</p>



<a name="464058575"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20debugging%3A%20add%20breakpoint%20to%20emitted%20code/near/464058575" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vulcain <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20debugging.3A.20add.20breakpoint.20to.20emitted.20code.html#464058575">(Aug 21 2024 at 13:33)</a>:</h4>
<p>Ok, I can't debug the machine instructions emitted from another compiler with wamr. Thank you again for trying to help me</p>



<a name="464069254"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20debugging%3A%20add%20breakpoint%20to%20emitted%20code/near/464069254" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ralph <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20debugging.3A.20add.20breakpoint.20to.20emitted.20code.html#464069254">(Aug 21 2024 at 14:10)</a>:</h4>
<p>ah</p>



<a name="464069427"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20debugging%3A%20add%20breakpoint%20to%20emitted%20code/near/464069427" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ralph <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20debugging.3A.20add.20breakpoint.20to.20emitted.20code.html#464069427">(Aug 21 2024 at 14:10)</a>:</h4>
<p>yeah, that's interesting. It's almost like you need a debugger that steps through wat</p>



<a name="464069535"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20debugging%3A%20add%20breakpoint%20to%20emitted%20code/near/464069535" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ralph <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20debugging.3A.20add.20breakpoint.20to.20emitted.20code.html#464069535">(Aug 21 2024 at 14:11)</a>:</h4>
<p>or the binary wasm, rather</p>



<a name="464069850"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20debugging%3A%20add%20breakpoint%20to%20emitted%20code/near/464069850" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ralph <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20debugging.3A.20add.20breakpoint.20to.20emitted.20code.html#464069850">(Aug 21 2024 at 14:12)</a>:</h4>
<p>I think we'd need a wasm language server for that, which..... <a href="https://github.com/wasm-lsp/wasm-lsp-server">https://github.com/wasm-lsp/wasm-lsp-server</a> is archived, so... hmmm.</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/wasm-lsp/wasm-lsp-server" style="background-image: url(&quot;https://uploads.zulipusercontent.net/4ec0d375dda8b68d441000603223a0b94cf7588d/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f373537613536333335373733356338393434643266353961396537316437633865313137616231386237316566663362323133323233643434343964633631392f7761736d2d6c73702f7761736d2d6c73702d736572766572&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/wasm-lsp/wasm-lsp-server" title="GitHub - wasm-lsp/wasm-lsp-server: A language server for WebAssembly">GitHub - wasm-lsp/wasm-lsp-server: A language server for WebAssembly</a></div><div class="message_embed_description">A language server for WebAssembly. Contribute to wasm-lsp/wasm-lsp-server development by creating an account on GitHub.</div></div></div>



<a name="464069915"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20debugging%3A%20add%20breakpoint%20to%20emitted%20code/near/464069915" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ralph <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20debugging.3A.20add.20breakpoint.20to.20emitted.20code.html#464069915">(Aug 21 2024 at 14:13)</a>:</h4>
<p>Geez, that would be helpful to have.</p>



<a name="464076432"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20debugging%3A%20add%20breakpoint%20to%20emitted%20code/near/464076432" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vulcain <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20debugging.3A.20add.20breakpoint.20to.20emitted.20code.html#464076432">(Aug 21 2024 at 14:40)</a>:</h4>
<p>Yeah it would be cool, but I actually don't need source code mapping or any debug info at all. I just want to run the machine code (arm) step by step</p>



<a name="464078442"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20debugging%3A%20add%20breakpoint%20to%20emitted%20code/near/464078442" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vulcain <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20debugging.3A.20add.20breakpoint.20to.20emitted.20code.html#464078442">(Aug 21 2024 at 14:49)</a>:</h4>
<p><a href="/user_uploads/15107/PaA6usnXvJobrlSj_AvPplBv/image.png">image.png</a><br>
I think it is possible because if I introduce a memory error, it actually stops in the guest code. I just don't know how to add a proper breakpoint</p>
<div class="message_inline_image"><a href="/user_uploads/15107/PaA6usnXvJobrlSj_AvPplBv/image.png" title="image.png"><img data-original-dimensions="1462x582" src="/user_uploads/thumbnail/15107/PaA6usnXvJobrlSj_AvPplBv/image.png/840x560.webp"></a></div>



<a name="464079068"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20debugging%3A%20add%20breakpoint%20to%20emitted%20code/near/464079068" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ralph <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20debugging.3A.20add.20breakpoint.20to.20emitted.20code.html#464079068">(Aug 21 2024 at 14:52)</a>:</h4>
<p>actually, I think we might be able to make one that does this fairly easily.....</p>



<a name="464079229"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20debugging%3A%20add%20breakpoint%20to%20emitted%20code/near/464079229" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ralph <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20debugging.3A.20add.20breakpoint.20to.20emitted.20code.html#464079229">(Aug 21 2024 at 14:53)</a>:</h4>
<p>if you use vscode, there's something called a "mock-debug" extension that implements step-by-step walkthrough using markdown. Functionally speaking, that could easily be modified to walk over WAT</p>



<a name="464079311"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20debugging%3A%20add%20breakpoint%20to%20emitted%20code/near/464079311" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ralph <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20debugging.3A.20add.20breakpoint.20to.20emitted.20code.html#464079311">(Aug 21 2024 at 14:53)</a>:</h4>
<p><span class="user-mention silent" data-user-id="739509">Vulcain</span> <a href="#narrow/stream/217126-wasmtime/topic/debugging.3A.20add.20breakpoint.20to.20emitted.20code/near/464078442">said</a>:</p>
<blockquote>
<p><a href="/user_uploads/15107/PaA6usnXvJobrlSj_AvPplBv/image.png">image.png</a><br>
I think it is possible because if I introduce a memory error, it actually stops in the guest code. I just don't know how to add a proper breakpoint</p>
</blockquote>
<p>oh wait, that's lldb</p>



<a name="464079550"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20debugging%3A%20add%20breakpoint%20to%20emitted%20code/near/464079550" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ralph <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20debugging.3A.20add.20breakpoint.20to.20emitted.20code.html#464079550">(Aug 21 2024 at 14:54)</a>:</h4>
<p>dammit, I've done this....</p>



<a name="464079667"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20debugging%3A%20add%20breakpoint%20to%20emitted%20code/near/464079667" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ralph <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20debugging.3A.20add.20breakpoint.20to.20emitted.20code.html#464079667">(Aug 21 2024 at 14:55)</a>:</h4>
<ol>
<li>breakpoint set -l &lt;line-number&gt; ; sets a breakpoint on a line in the current context.</li>
<li>breakpoint set --file &lt;file-name&gt; -l &lt;line-number&gt; ; sets a breakpoint on a line on a given file.</li>
<li>breakpoint set --name &lt;method-name&gt; ; sets a breakpoint on a given function name, globally.</li>
</ol>



<a name="464080569"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20debugging%3A%20add%20breakpoint%20to%20emitted%20code/near/464080569" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vulcain <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20debugging.3A.20add.20breakpoint.20to.20emitted.20code.html#464080569">(Aug 21 2024 at 14:58)</a>:</h4>
<p>Yes, but there is no file, I am trying to debug the arm code emitted by the winch compiler</p>



<a name="464081437"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20debugging%3A%20add%20breakpoint%20to%20emitted%20code/near/464081437" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ralph <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20debugging.3A.20add.20breakpoint.20to.20emitted.20code.html#464081437">(Aug 21 2024 at 15:00)</a>:</h4>
<p>I was thinking the arm code was a text format, but if it's not, yeah -- you're sol there</p>



<a name="464081656"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20debugging%3A%20add%20breakpoint%20to%20emitted%20code/near/464081656" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vulcain <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20debugging.3A.20add.20breakpoint.20to.20emitted.20code.html#464081656">(Aug 21 2024 at 15:00)</a>:</h4>
<p>Thank you again for trying !</p>



<a name="464082362"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20debugging%3A%20add%20breakpoint%20to%20emitted%20code/near/464082362" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ralph <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20debugging.3A.20add.20breakpoint.20to.20emitted.20code.html#464082362">(Aug 21 2024 at 15:02)</a>:</h4>
<p><a href="https://marketplace.visualstudio.com/items?itemName=Arm.arm-debugger">https://marketplace.visualstudio.com/items?itemName=Arm.arm-debugger</a> ?????</p>
<div class="message_embed"><a class="message_embed_image" href="https://marketplace.visualstudio.com/items?itemName=Arm.arm-debugger" style="background-image: url(&quot;https://uploads.zulipusercontent.net/1548c4d6cbbfe561c902638896509cbf40289e5f/68747470733a2f2f61726d2e67616c6c65727963646e2e76736173736574732e696f2f657874656e73696f6e732f61726d2f61726d2d64656275676765722f312e322e322f313732313832363130393731302f4d6963726f736f66742e56697375616c53747564696f2e53657276696365732e49636f6e732e44656661756c74&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://marketplace.visualstudio.com/items?itemName=Arm.arm-debugger" title="Arm Debugger - Visual Studio Marketplace">Arm Debugger - Visual Studio Marketplace</a></div><div class="message_embed_description">Extension for Visual Studio Code - Arm Debugger for Arm Cortex-M based microcontrollers (MCUs), development boards and debug probes, implementing the Microsoft Debug Adapter Protocol (DAP)</div></div></div>



<a name="464082961"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20debugging%3A%20add%20breakpoint%20to%20emitted%20code/near/464082961" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vulcain <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20debugging.3A.20add.20breakpoint.20to.20emitted.20code.html#464082961">(Aug 21 2024 at 15:04)</a>:</h4>
<p>I have no way to tell this extension where to add the breakpoint as the code does not exist before execution <span aria-label="oh no" class="emoji emoji-1f615" role="img" title="oh no">:oh_no:</span></p>



<a name="464083272"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20debugging%3A%20add%20breakpoint%20to%20emitted%20code/near/464083272" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ralph <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20debugging.3A.20add.20breakpoint.20to.20emitted.20code.html#464083272">(Aug 21 2024 at 15:04)</a>:</h4>
<p>it would need to be run <em>once the code is laid down</em> so that sounds like an attach?</p>



<a name="464083541"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20debugging%3A%20add%20breakpoint%20to%20emitted%20code/near/464083541" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ralph <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20debugging.3A.20add.20breakpoint.20to.20emitted.20code.html#464083541">(Aug 21 2024 at 15:05)</a>:</h4>
<p>at execution time, is the code just held in memory? not on the disk once created?</p>



<a name="464083679"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20debugging%3A%20add%20breakpoint%20to%20emitted%20code/near/464083679" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ralph <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20debugging.3A.20add.20breakpoint.20to.20emitted.20code.html#464083679">(Aug 21 2024 at 15:05)</a>:</h4>
<p>I doubt I have a solution, just trying to imagine what one could look like.</p>



<a name="464083823"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20debugging%3A%20add%20breakpoint%20to%20emitted%20code/near/464083823" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vulcain <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20debugging.3A.20add.20breakpoint.20to.20emitted.20code.html#464083823">(Aug 21 2024 at 15:06)</a>:</h4>
<p>I think so, but this is not a part of the codebase I am familiar with</p>



<a name="464084221"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20debugging%3A%20add%20breakpoint%20to%20emitted%20code/near/464084221" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vulcain <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20debugging.3A.20add.20breakpoint.20to.20emitted.20code.html#464084221">(Aug 21 2024 at 15:07)</a>:</h4>
<p>I can compile AOT, but I don't think the debugger binds cwasm</p>



<a name="464085076"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20debugging%3A%20add%20breakpoint%20to%20emitted%20code/near/464085076" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vulcain <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20debugging.3A.20add.20breakpoint.20to.20emitted.20code.html#464085076">(Aug 21 2024 at 15:10)</a>:</h4>
<p>My guess is it adds the generated code to the heap and jump to this address to execute the code. If it is what is happening, then I have to breakpoint this place. I don't know where it is though</p>



<a name="464086263"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20debugging%3A%20add%20breakpoint%20to%20emitted%20code/near/464086263" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20debugging.3A.20add.20breakpoint.20to.20emitted.20code.html#464086263">(Aug 21 2024 at 15:15)</a>:</h4>
<p><span class="user-mention" data-user-id="739509">@Vulcain</span> if it helps, a technique that I've used to debug emitted-JIT-code issues is to insert artificial breakpoints (<code>ud2</code> on Intel, <code>udf</code> on aarch64) by just... emitting them in sequence in the JIT compiler. Then I run the whole wasmtime process under gdb/lldb; I hit the breakpoint in the code; and (at least in gdb) you can "jump" over the opcode (<code>$pc+2</code> on Intel, <code>$pc+4</code> on aarch64) and single-step from there</p>



<a name="464086295"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20debugging%3A%20add%20breakpoint%20to%20emitted%20code/near/464086295" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20debugging.3A.20add.20breakpoint.20to.20emitted.20code.html#464086295">(Aug 21 2024 at 15:15)</a>:</h4>
<p>very low-level and manual technique but it lets you examine the whole machine state</p>



<a name="464086541"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20debugging%3A%20add%20breakpoint%20to%20emitted%20code/near/464086541" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Saúl Cabrera <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20debugging.3A.20add.20breakpoint.20to.20emitted.20code.html#464086541">(Aug 21 2024 at 15:16)</a>:</h4>
<p>A technique that I usually use with LLDB in macOS is to put a breakpoint in <a href="https://github.com/bytecodealliance/wasmtime/blob/main/crates/wasmtime/src/runtime/func.rs#L1073">https://github.com/bytecodealliance/wasmtime/blob/main/crates/wasmtime/src/runtime/func.rs#L1073</a> (if you're invoking wasmtime from the CLI)</p>
<p>That should get you a debugger at where the function call starts. The complex thing about this approach is that you need to be familiar with how trampolines work in Wasmtime in order to navigate to the assembly of the Wasm function that you're trying to inspect.</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wasmtime/blob/main/crates/wasmtime/src/runtime/func.rs#L1073" style="background-image: url(&quot;https://uploads.zulipusercontent.net/64b8f03d131fd7998eeeea3d929fe4e9e811513a/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f303132336664623737653432336138616264313835303339303362313766313666393230336532316532613465306231393164373137353931396265353537612f62797465636f6465616c6c69616e63652f7761736d74696d65&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wasmtime/blob/main/crates/wasmtime/src/runtime/func.rs#L1073" title="wasmtime/crates/wasmtime/src/runtime/func.rs at main · bytecodealliance/wasmtime">wasmtime/crates/wasmtime/src/runtime/func.rs at main · bytecodealliance/wasmtime</a></div><div class="message_embed_description">A fast and secure runtime for WebAssembly. Contribute to bytecodealliance/wasmtime development by creating an account on GitHub.</div></div></div>



<a name="464086556"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20debugging%3A%20add%20breakpoint%20to%20emitted%20code/near/464086556" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20debugging.3A.20add.20breakpoint.20to.20emitted.20code.html#464086556">(Aug 21 2024 at 15:16)</a>:</h4>
<p>separately, <code>rr</code> (the reversible debugger) is extraordinarily useful for things like these -- Mozilla developed it originally to debug Firefox and its JITs -- and it has certain CPU requirements, on x86 requires recent Intel chips, but I <em>think</em> it also supports Apple aarch64 CPUs if you're running native Asahi Linux (if that applies)</p>



<a name="464087320"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20debugging%3A%20add%20breakpoint%20to%20emitted%20code/near/464087320" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vulcain <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20debugging.3A.20add.20breakpoint.20to.20emitted.20code.html#464087320">(Aug 21 2024 at 15:19)</a>:</h4>
<p><span class="user-mention silent" data-user-id="411395">Saúl Cabrera</span> <a href="#narrow/stream/217126-wasmtime/topic/debugging.3A.20add.20breakpoint.20to.20emitted.20code/near/464086541">said</a>:</p>
<blockquote>
<p>A technique that I usually use with LLDB in macOS is to put a breakpoint in <a href="https://github.com/bytecodealliance/wasmtime/blob/main/crates/wasmtime/src/runtime/func.rs#L1073">https://github.com/bytecodealliance/wasmtime/blob/main/crates/wasmtime/src/runtime/func.rs#L1073</a> (if you're invoking wasmtime from the CLI)</p>
<p>That should get you a debugger at where the function call starts. The complex thing about this approach is that you need to be familiar with how trampolines work in Wasmtime in order to navigate to the assembly of the Wasm function that you're trying to inspect.</p>
</blockquote>
<p>That's the place I was looking for ! I will also try the udf technique, and take a look at <code>rr</code>. Thank you both for the info <span aria-label="grinning" class="emoji emoji-1f600" role="img" title="grinning">:grinning:</span></p>



<a name="464106857"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20debugging%3A%20add%20breakpoint%20to%20emitted%20code/near/464106857" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20debugging.3A.20add.20breakpoint.20to.20emitted.20code.html#464106857">(Aug 21 2024 at 16:35)</a>:</h4>
<p><span class="user-mention silent" data-user-id="739509">Vulcain</span> has marked this topic as resolved.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>