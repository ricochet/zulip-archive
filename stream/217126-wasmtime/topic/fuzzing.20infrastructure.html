<html>
<head><meta charset="utf-8"><title>fuzzing infrastructure · wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/index.html">wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html">fuzzing infrastructure</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="189817303"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/189817303" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Till Schneidereit <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#189817303">(Mar 05 2020 at 17:40)</a>:</h4>
<p><span class="user-mention" data-user-id="253994">@Alex Crichton</span> <span class="user-mention" data-user-id="253990">@fitzgen (he/him)</span> <span class="user-mention" data-user-id="254051">@Jonathan Foote</span> this bug, which was created right after the oss-fuzz integration was set up, and seems to be some kind of problem with the setup, says that it'd be closed within a day after being fixed—does that mean it's not fixed yet? <a href="https://bugs.chromium.org/p/oss-fuzz/issues/detail?id=20472&amp;q=label%3AProj-wasmtime" target="_blank" title="https://bugs.chromium.org/p/oss-fuzz/issues/detail?id=20472&amp;q=label%3AProj-wasmtime">https://bugs.chromium.org/p/oss-fuzz/issues/detail?id=20472&amp;q=label%3AProj-wasmtime</a></p>



<a name="189817798"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/189817798" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> fitzgen (he/him) <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#189817798">(Mar 05 2020 at 17:45)</a>:</h4>
<p>I think that this is trying to build with clang coverage, which is not supported by rustc.</p>
<p>Looking at the build logs I see stuff like:</p>
<div class="codehilite"><pre><span></span>Step #5: du: cannot access &#39;/workspace/out/coverage/dumps/compile.*.profraw&#39;: No such file or directory
Step #5: du: cannot access &#39;/workspace/out/coverage/dumps/instantiate.*.profraw&#39;: No such file or directory
</pre></div>



<a name="189817807"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/189817807" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#189817807">(Mar 05 2020 at 17:45)</a>:</h4>
<p>oh I forgot about that...</p>



<a name="189819330"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/189819330" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#189819330">(Mar 05 2020 at 18:01)</a>:</h4>
<p>I opened up <a href="https://github.com/google/oss-fuzz/issues/3468" target="_blank" title="https://github.com/google/oss-fuzz/issues/3468">https://github.com/google/oss-fuzz/issues/3468</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/google/oss-fuzz/issues/3468" style="background-image: url(https://avatars0.githubusercontent.com/u/1342004?s=400&amp;v=4)" target="_blank"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/google/oss-fuzz/issues/3468" target="_blank" title="Don't know how to fix wasmtime's coverage build · Issue #3468 · google/oss-fuzz">Don't know how to fix wasmtime's coverage build · Issue #3468 · google/oss-fuzz</a></div><div class="message_embed_description">When we first added wasmtime to oss-fuzz we quckly got a bug opened about the coverage build failing. Checking out the build log the end of it has failures that look like: Step #5: du: cannot acces...</div></div></div>



<a name="189821991"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/189821991" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#189821991">(Mar 05 2020 at 18:31)</a>:</h4>
<p>"fixed" :D</p>



<a name="189829026"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/189829026" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Till Schneidereit <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#189829026">(Mar 05 2020 at 19:45)</a>:</h4>
<p>heh, yes, "fixed". Thank you for handling this!</p>



<a name="190104710"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/190104710" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonathan Foote <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#190104710">(Mar 09 2020 at 18:56)</a>:</h4>
<p>Hello all. Apologies for the delay in responding here, I was OOO last week <span aria-label="electric plug" class="emoji emoji-1f50c" role="img" title="electric plug">:electric_plug:</span> For context, I asked Max (Dor1s) and a few other people about the possibility of google providing resources to work on this when I saw him IRL two weeks ago. Unfortunately it sounds like they probably won't, at least from his perspective.</p>



<a name="190104853"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/190104853" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonathan Foote <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#190104853">(Mar 09 2020 at 18:57)</a>:</h4>
<p>IIUC we would effectively want <a href="https://github.com/rust-lang/rust/issues/34701" target="_blank" title="https://github.com/rust-lang/rust/issues/34701">https://github.com/rust-lang/rust/issues/34701</a> addressed</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/rust-lang/rust/issues/34701" style="background-image: url(https://avatars1.githubusercontent.com/u/5430905?s=400&amp;v=4)" target="_blank"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/rust-lang/rust/issues/34701" target="_blank" title="Implement support for LLVMs code coverage instrumentation · Issue #34701 · rust-lang/rust">Implement support for LLVMs code coverage instrumentation · Issue #34701 · rust-lang/rust</a></div><div class="message_embed_description">There are ways to more or less easily obtain code coverage information from rust binaries, some of which are in widespread use (e.g. travis-cargo + gcov + coveralls.io). However, these are either p...</div></div></div>



<a name="190104873"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/190104873" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonathan Foote <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#190104873">(Mar 09 2020 at 18:57)</a>:</h4>
<p>I will mention it on the relevant oss-fuzz GH issue</p>



<a name="190112219"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/190112219" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> fitzgen (he/him) <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#190112219">(Mar 09 2020 at 20:09)</a>:</h4>
<p>This would be nice to have for sure when evaluating whether a fuzz target is exercising all the corners you expect it to. AFAIK, we "just" need to do the work in <code>rustc</code> to hook this stuff up. <span class="user-mention" data-user-id="253994">@Alex Crichton</span> would know more. Not sure how to prioritize working on this vs other wasmtime things though...</p>



<a name="190175013"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/190175013" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#190175013">(Mar 10 2020 at 14:04)</a>:</h4>
<p>Yeah this'd likely looks similar to most of our other sanitizer work which would involve building and shipping the runtime support libraries for select platforms and then having <code>-Z</code> flags in rustc that configures LLVM's pass manager appropriately and then also links the runtime libs, probably not the hardest thing to do but probably also not super trivial.</p>



<a name="190175267"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/190175267" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#190175267">(Mar 10 2020 at 14:06)</a>:</h4>
<p>There I think is some basic profiling support already with <code>-Zprofile</code>, but I would suspect that it's not trivially usable</p>



<a name="190175390"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/190175390" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#190175390">(Mar 10 2020 at 14:07)</a>:</h4>
<p>oh looks like <code>-Zprofile</code> may be one of the three mechanisms in llvm for coverage, and it may be the wrong one</p>



<a name="242269058"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/242269058" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Brown <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#242269058">(Jun 10 2021 at 20:51)</a>:</h4>
<p>In the Wasmtime meeting today we (<span class="user-mention" data-user-id="253994">@Alex Crichton</span>, <span class="user-mention" data-user-id="254389">@Chris Fallin</span>, <span class="user-mention" data-user-id="234973">@Till Schneidereit</span>) talked a bit about fuzzing: what I took away is that the Wasm SIMD fuzzing should be turned on once we finish the Wasm SIMD implementation but even when that happens the differential fuzz targets (i.e. vs wasmi) won't cover this feature. Is that right?</p>



<a name="242269217"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/242269217" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#242269217">(Jun 10 2021 at 20:52)</a>:</h4>
<p>I believe so, yeah</p>



<a name="242269307"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/242269307" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#242269307">(Jun 10 2021 at 20:53)</a>:</h4>
<p>Yes, that's right, we would need a Wasm interpreter that supports SIMD; <code>wasmi</code> doesn't as far as I can tell</p>



<a name="242269359"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/242269359" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Brown <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#242269359">(Jun 10 2021 at 20:53)</a>:</h4>
<p>And I guess we were sort of all agreeing that it would be great if we could use the spec interpreter for this... but it might be tricky to run this</p>



<a name="242269377"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/242269377" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Brown <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#242269377">(Jun 10 2021 at 20:53)</a>:</h4>
<p>...tricky from Rust or within our environment, etc.</p>



<a name="242269450"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/242269450" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#242269450">(Jun 10 2021 at 20:54)</a>:</h4>
<p>yeah, calling into Ocaml from Rust would be tricky, but maybe doable? I have no idea what the FFI is like on the ML side</p>



<a name="242269510"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/242269510" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Brown <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#242269510">(Jun 10 2021 at 20:54)</a>:</h4>
<p>Do we need to call it as a library or can we get away with forking a process to do that?</p>



<a name="242269538"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/242269538" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#242269538">(Jun 10 2021 at 20:55)</a>:</h4>
<p>I wouldn't necessarily consider this a requirement for stabilizing simd though, I think we need to fuzz it at least a little but wasm-smith has us more than covered on that front</p>



<a name="242269545"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/242269545" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#242269545">(Jun 10 2021 at 20:55)</a>:</h4>
<p>ah, well we could fork a process as long as we are able to get the memory and global contents in return</p>



<a name="242269580"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/242269580" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#242269580">(Jun 10 2021 at 20:55)</a>:</h4>
<p>actually that's an interesting idea: build a server process in Ocaml that wraps the spec interpreter, takes Wasm module bytes as input, and returns execution results, in a protocol over a pipe or something</p>



<a name="242269633"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/242269633" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#242269633">(Jun 10 2021 at 20:55)</a>:</h4>
<p>running the spec interpreter on oss-fuzz would be weird though, I'm not sure if we have tight control over the environment the fuzzed binaries are run within, you'd have to look into oss-fuzz for more details on that</p>



<a name="242269643"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/242269643" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Brown <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#242269643">(Jun 10 2021 at 20:56)</a>:</h4>
<blockquote>
<p>I wouldn't necessarily consider this a requirement for stabilizing simd though</p>
</blockquote>
<p>Yeah, I'm just thinking about what is the best possible end state</p>



<a name="242269682"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/242269682" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#242269682">(Jun 10 2021 at 20:56)</a>:</h4>
<p>currently I only know we have tight control over the build environment</p>



<a name="242269762"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/242269762" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Brown <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#242269762">(Jun 10 2021 at 20:56)</a>:</h4>
<p>like, you mean they might not let us open ports, etc.?</p>



<a name="242269782"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/242269782" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#242269782">(Jun 10 2021 at 20:56)</a>:</h4>
<p>I'm sure it's at least somewhat possible though, and most of the works is probably just building the server process in ocaml lol</p>



<a name="242269793"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/242269793" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Brown <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#242269793">(Jun 10 2021 at 20:56)</a>:</h4>
<p>because we can certainly build the spec interpreter binary...</p>



<a name="242269814"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/242269814" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#242269814">(Jun 10 2021 at 20:57)</a>:</h4>
<p>completely harebrained idea: somehow translate the spec interpreter, or the core (opcode-matching) parts of it, to Rust? I have no idea how regular its implementation is and how easy it would be to parse it</p>



<a name="242269839"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/242269839" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#242269839">(Jun 10 2021 at 20:57)</a>:</h4>
<p>nah I'm just not sure how they actually run the binary. I thought it was just "download the binary and run it" which gives us no control over the environment</p>



<a name="242269859"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/242269859" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#242269859">(Jun 10 2021 at 20:57)</a>:</h4>
<p><em>nose goes</em></p>



<a name="242269889"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/242269889" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Brown <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#242269889">(Jun 10 2021 at 20:57)</a>:</h4>
<p>well, I see a Dockerfile in there so I assumed that is what was building the artifacts?</p>



<a name="242269905"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/242269905" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#242269905">(Jun 10 2021 at 20:57)</a>:</h4>
<blockquote>
<p><em>nose goes</em></p>
</blockquote>
<p>I am booked out to <em>checks calendar</em> 2024, but I can slot this in sometime after that :-)</p>



<a name="242269909"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/242269909" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Brown <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#242269909">(Jun 10 2021 at 20:57)</a>:</h4>
<p>in there = <a href="https://github.com/google/oss-fuzz/tree/master/projects/wasmtime">https://github.com/google/oss-fuzz/tree/master/projects/wasmtime</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/google/oss-fuzz/tree/master/projects/wasmtime" style="background-image: url(https://opengraph.githubassets.com/30585b6acfbdd35d8212c5f7d697cefb4ef9e94e1604395d9f9421bcfd4fc339/google/oss-fuzz)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/google/oss-fuzz/tree/master/projects/wasmtime" title="google/oss-fuzz">google/oss-fuzz</a></div><div class="message_embed_description">OSS-Fuzz - continuous fuzzing for open source software. - google/oss-fuzz</div></div></div>



<a name="242269958"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/242269958" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#242269958">(Jun 10 2021 at 20:58)</a>:</h4>
<p>I think you'd basically just want to double-check what the running environment is in oss-fuzz, I really don't know myself, i just suspect it's probably not "vanilla"</p>



<a name="242269971"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/242269971" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Brown <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#242269971">(Jun 10 2021 at 20:58)</a>:</h4>
<p>yeah</p>



<a name="242269988"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/242269988" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#242269988">(Jun 10 2021 at 20:58)</a>:</h4>
<p>yeah the dockerfile there is for building, and I don't think it's used for running but I could be wrong</p>



<a name="242270038"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/242270038" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#242270038">(Jun 10 2021 at 20:59)</a>:</h4>
<p>there must be at least some mechanism to get files in place, for fuzzers that want more complex install environments? or maybe not</p>



<a name="242270068"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/242270068" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#242270068">(Jun 10 2021 at 20:59)</a>:</h4>
<p>and there's the potential they sandbox things somehow too so one can't exec (seccomp or similar)</p>



<a name="242270388"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/242270388" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#242270388">(Jun 10 2021 at 21:01)</a>:</h4>
<p>tbh the best comparison is probably node at this point, I think they've got everything necessary implemented</p>



<a name="242270402"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/242270402" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#242270402">(Jun 10 2021 at 21:01)</a>:</h4>
<p>s/best/easiest/</p>



<a name="242270550"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/242270550" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#242270550">(Jun 10 2021 at 21:02)</a>:</h4>
<p>another thought: it might be <em>ok</em> (not ideal, but ok) if we have a fuzzing mode that requires some additional environment and setup that oss-fuzz can't provide, as we can still run this elsewhere (e.g., the CI machines in the background)</p>



<a name="242274741"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/242274741" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Brown <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#242274741">(Jun 10 2021 at 21:37)</a>:</h4>
<p>(an aside: does anyone know how to fix <code>-fsanitize-coverage=trace-pc-guard is no longer supported by libFuzzer. Please either migrate to a compiler that supports -fsanitize=fuzzer or use an older version of libFuzzer</code> before I go off trying to figure out how to fix it?)</p>



<a name="242274780"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/242274780" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Brown <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#242274780">(Jun 10 2021 at 21:37)</a>:</h4>
<p>Seen when attempting to run: <code>cargo +nightly fuzz run differential</code></p>



<a name="242274910"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/242274910" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#242274910">(Jun 10 2021 at 21:39)</a>:</h4>
<p>I sometimes run <code>cargo fuzz</code> with <code>-s none</code> to turn off all sanitizers, to get a faster build turnaround when debugging a fuzz crash</p>



<a name="242274999"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/242274999" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#242274999">(Jun 10 2021 at 21:40)</a>:</h4>
<p>imho the sanitizers are less important when fuzzing Rust, at least when running locally, as the asserts are the most important oracle (others please correct me if that's not true!)</p>



<a name="242275012"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/242275012" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Brown <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#242275012">(Jun 10 2021 at 21:40)</a>:</h4>
<p>I get: <code>error: 'none' isn't a valid value for '--sanitizer &lt;sanitizer&gt;' [possible values: address, leak, memory, thread]</code></p>



<a name="242275048"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/242275048" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#242275048">(Jun 10 2021 at 21:40)</a>:</h4>
<p>weird, how old is your <code>cargo-fuzz</code>?</p>



<a name="242275072"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/242275072" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Brown <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#242275072">(Jun 10 2021 at 21:41)</a>:</h4>
<p>0.5.2?</p>



<a name="242275105"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/242275105" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#242275105">(Jun 10 2021 at 21:41)</a>:</h4>
<p>Ah, I'm on 0.8.0:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">cfallin</span><span class="o">@</span><span class="n">xap</span>:<span class="o">~/</span><span class="n">work</span><span class="o">/</span><span class="n">regalloc</span><span class="p">.</span><span class="n">rs</span><span class="cp">$</span><span class="w"> </span><span class="n">cargo</span><span class="w"> </span><span class="n">fuzz</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">-</span><span class="n">s</span><span class="w"> </span><span class="n">none</span><span class="w"> </span><span class="n">regalloc2</span><span class="w"></span>
<span class="w">   </span><span class="n">Compiling</span><span class="w"> </span><span class="n">regalloc2</span><span class="w"> </span><span class="n">v0</span><span class="p">.</span><span class="mf">0.1</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">cfallin</span><span class="o">/</span><span class="n">work</span><span class="o">/</span><span class="n">regalloc2</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="n">Compiling</span><span class="w"> </span><span class="n">regalloc</span><span class="w"> </span><span class="n">v0</span><span class="p">.</span><span class="mf">0.31</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">cfallin</span><span class="o">/</span><span class="n">work</span><span class="o">/</span><span class="n">regalloc</span><span class="p">.</span><span class="n">rs</span><span class="o">/</span><span class="n">lib</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="n">Compiling</span><span class="w"> </span><span class="n">minira</span><span class="o">-</span><span class="n">util</span><span class="w"> </span><span class="n">v0</span><span class="p">.</span><span class="mf">1.0</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">cfallin</span><span class="o">/</span><span class="n">work</span><span class="o">/</span><span class="n">regalloc</span><span class="p">.</span><span class="n">rs</span><span class="p">)</span><span class="w"></span>
<span class="o">^</span><span class="n">C</span><span class="w">  </span><span class="n">Building</span><span class="w"> </span><span class="p">[</span><span class="o">========================&gt;</span><span class="w">  </span><span class="p">]</span><span class="w"> </span><span class="mi">53</span><span class="o">/</span><span class="mi">57</span>: <span class="nc">regalloc2</span><span class="p">,</span><span class="w"> </span><span class="n">regalloc</span><span class="p">,</span><span class="w"> </span><span class="n">minira</span><span class="o">-</span><span class="n">util</span><span class="w"></span>
<span class="n">cfallin</span><span class="o">@</span><span class="n">xap</span>:<span class="o">~/</span><span class="n">work</span><span class="o">/</span><span class="n">regalloc</span><span class="p">.</span><span class="n">rs</span><span class="cp">$</span><span class="w"> </span><span class="n">cargo</span><span class="w"> </span><span class="n">fuzz</span><span class="w"> </span><span class="o">--</span><span class="n">version</span><span class="w"></span>
<span class="n">cargo</span><span class="o">-</span><span class="n">fuzz</span><span class="w"> </span><span class="mf">0.8.0</span><span class="w"></span>
</code></pre></div>



<a name="242275106"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/242275106" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Brown <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#242275106">(Jun 10 2021 at 21:41)</a>:</h4>
<p>oh... latest is at 0.10.2...</p>



<a name="242275804"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/242275804" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Brown <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#242275804">(Jun 10 2021 at 21:48)</a>:</h4>
<p>and that works great.</p>



<a name="242632439"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/242632439" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> fitzgen (he/him) <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#242632439">(Jun 14 2021 at 17:28)</a>:</h4>
<p><span class="user-mention silent" data-user-id="254389">Chris Fallin</span> <a href="#narrow/stream/217126-wasmtime/topic/fuzzing.20infrastructure/near/242270550">said</a>:</p>
<blockquote>
<p>another thought: it might be <em>ok</em> (not ideal, but ok) if we have a fuzzing mode that requires some additional environment and setup that oss-fuzz can't provide, as we can still run this elsewhere (e.g., the CI machines in the background)</p>
</blockquote>
<p>the downside here is that we have to build all the infrastructure necessary to dedupe crashes, monitor fuzzing processes and respawn them after they find crashes, etc and this is a bunch of work that oss-fuzz already does for us</p>



<a name="243864105"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/243864105" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Brown <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#243864105">(Jun 25 2021 at 00:36)</a>:</h4>
<p>I mentioned in the meeting today that it didn't seem impossible to use OCaml's FFI to call in to the spec interpreter from Rust. Let me describe a possible plan and I'm interested to hear how feasible this all sounds (esp. from people with more Rust/FFI expertise):</p>
<ul>
<li>The spec interpreter exposes methods like <a href="https://github.com/WebAssembly/spec/blob/master/interpreter/exec/eval.ml#L551">Eval.invoke</a> that allow us to call a function and see the return values; there are also higher-level ways to do this (e.g. load + run a module) and we would need to extend <a href="https://github.com/WebAssembly/spec/blob/master/interpreter/runtime/memory.mli">Memory</a> to allow us to hash it</li>
<li>After building the Ocaml library, we could use the <a href="https://crates.io/crates/ocaml-interop">ocaml_interop</a> to safely get our data (Wasm, values, etc.) over into the OCaml runtime</li>
<li>Then we link in the spec interpreter library (we might need to tweak things a bit and use <a href="https://ocaml.org/manual/intfc.html#s:ocamlmklib">ocamlmklib</a>) to our Rust code</li>
</ul>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/WebAssembly/spec/blob/master/interpreter/exec/eval.ml#L551" style="background-image: url(https://opengraph.githubassets.com/a1121ed959acee7625b91d37e4f4688d3e843708107dedaad9ad3b1bdd7c8d42/WebAssembly/spec)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/WebAssembly/spec/blob/master/interpreter/exec/eval.ml#L551" title="WebAssembly/spec">WebAssembly/spec</a></div><div class="message_embed_description">WebAssembly specification, reference interpreter, and test suite. - WebAssembly/spec</div></div></div><div class="message_embed"><a class="message_embed_image" href="https://github.com/WebAssembly/spec/blob/master/interpreter/runtime/memory.mli" style="background-image: url(https://opengraph.githubassets.com/a1121ed959acee7625b91d37e4f4688d3e843708107dedaad9ad3b1bdd7c8d42/WebAssembly/spec)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/WebAssembly/spec/blob/master/interpreter/runtime/memory.mli" title="WebAssembly/spec">WebAssembly/spec</a></div><div class="message_embed_description">WebAssembly specification, reference interpreter, and test suite. - WebAssembly/spec</div></div></div>



<a name="243864142"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/243864142" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Brown <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#243864142">(Jun 25 2021 at 00:37)</a>:</h4>
<p>It would be ideal if all of that could get wrapped up into a <code>wasm-spec-interpreter</code> crate so that we could use it in the fuzzer...</p>



<a name="243864695"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/243864695" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#243864695">(Jun 25 2021 at 00:46)</a>:</h4>
<p>That all sounds reasonable!</p>



<a name="245064489"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/245064489" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Brown <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#245064489">(Jul 06 2021 at 16:31)</a>:</h4>
<p>An update on this: I tried out the approach above and it works! Well... at least for <code>int</code> types <span aria-label="grinning" class="emoji emoji-1f600" role="img" title="grinning">:grinning:</span></p>



<a name="245064562"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/245064562" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Brown <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#245064562">(Jul 06 2021 at 16:31)</a>:</h4>
<p>I'll try to get more types working before I share the proposed crate</p>



<a name="245065716"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/245065716" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#245065716">(Jul 06 2021 at 16:40)</a>:</h4>
<p>Great news! Looking forward to seeing this!</p>



<a name="245065926"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/245065926" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#245065926">(Jul 06 2021 at 16:42)</a>:</h4>
<p>Others will probably appreciate having "actual Wasm spec interpreter as a Rust crate" as well; the ecosystem of wasm interpreters on <a href="http://crates.io">crates.io</a> is kinda haphazard right now afaict</p>



<a name="247513825"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/247513825" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Brown <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#247513825">(Jul 28 2021 at 20:36)</a>:</h4>
<p>Well, after talking to <span class="user-mention" data-user-id="253994">@Alex Crichton</span> about this I just included the crate in the Wasmtime repository. Here is the current state of things: <a href="https://github.com/bytecodealliance/wasmtime/pull/3124">https://github.com/bytecodealliance/wasmtime/pull/3124</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wasmtime/pull/3124" style="background-image: url(https://opengraph.githubassets.com/637f74e4d54f5cc2bdad5746a282389714069ea8e7402a1b52420dc81a7c8d6e/bytecodealliance/wasmtime/pull/3124)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wasmtime/pull/3124" title="Fuzz Wasmtime against the official Wasm spec interpreter by abrown · Pull Request #3124 · bytecodealliance/wasmtime">Fuzz Wasmtime against the official Wasm spec interpreter by abrown · Pull Request #3124 · bytecodealliance/wasmtime</a></div><div class="message_embed_description">This change introduces a new fuzz target, differential_spec that compares the outputs of executing the first exported function of a Wasm module in Wasmtime and then in the official Wasm spec interp...</div></div></div>



<a name="247616464"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/247616464" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Brown <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#247616464">(Jul 29 2021 at 17:38)</a>:</h4>
<p><span class="user-mention" data-user-id="254389">@Chris Fallin</span> , <span class="user-mention" data-user-id="253990">@fitzgen (he/him)</span>, <span class="user-mention" data-user-id="253994">@Alex Crichton</span>: I think the main problem right now with the PR above is that the wasm-spec-interpreter crate only builds in a certain environment. To solve this, the best I can come up with is to always build the crate but detect during <a href="http://build.rs">build.rs</a> if the right tools are available and build the OCaml library if they are. If they are not, then set a feature flag and in <a href="http://lib.rs">lib.rs</a> implement the <code>interpret</code> function by immediately panicking. So the crate should always build but will crash at runtime if the OCaml/Linux bits aren't there. Thoughts?</p>



<a name="247616668"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/247616668" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#247616668">(Jul 29 2021 at 17:40)</a>:</h4>
<p>That seems like an OK compromise, yeah. I guess we already do something similar for OpenVINO (detect if present at build time, still build without it)</p>



<a name="247616688"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/247616688" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> fitzgen (he/him) <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#247616688">(Jul 29 2021 at 17:40)</a>:</h4>
<p>sounds fine to me</p>



<a name="247616701"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/247616701" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#247616701">(Jul 29 2021 at 17:40)</a>:</h4>
<p>agreed sounds good</p>



<a name="247625119"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/247625119" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Brown <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#247625119">(Jul 29 2021 at 18:49)</a>:</h4>
<p>Well, I forgot a crucial detail so I'm not sure this will work: I can detect if the tools are available, set a feature flag, and use this to compile a panicking <code>interpret</code> function but feature flags set in <code>build.rs</code> don't affect dependencies, IIRC. So the <code>ocaml-sys</code> crate still tries to build and fails. Any ideas?</p>



<a name="248880624"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/248880624" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#248880624">(Aug 09 2021 at 17:30)</a>:</h4>
<p><a href="https://github.com/bytecodealliance/wasm-tools/pull/314">https://github.com/bytecodealliance/wasm-tools/pull/314</a> may be of interest here in generating more modules that get past instantiation in theory. I still think there's a lot of work to be done on the instruction side of things though where we're more intelligent about generating instructions that aren't super likely to just always trap around memory</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wasm-tools/pull/314" style="background-image: url(https://opengraph.githubassets.com/33944f2f467a35b8c7b9944af95f2c275bdd48ae3ebc7e9d1ad3d5006a9126a6/bytecodealliance/wasm-tools/pull/314)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wasm-tools/pull/314" title="wasm-smith: Generate fail-to-instantiate modules far less frequently by alexcrichton · Pull Request #314 · bytecodealliance/wasm-tools">wasm-smith: Generate fail-to-instantiate modules far less frequently by alexcrichton · Pull Request #314 · bytecodealliance/wasm-tools</a></div><div class="message_embed_description">I ran a small program recently where I threw random data at wasm-smith and then tried to instantiate each module. I kept record of statistics about whether or not the module failed to instantiate, ...</div></div></div>



<a name="249131591"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/249131591" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#249131591">(Aug 11 2021 at 16:21)</a>:</h4>
<p><span class="user-mention" data-user-id="254110">@Andrew Brown</span> looks like the oss-fuzz build failed last night -- <a href="https://oss-fuzz-build-logs.storage.googleapis.com/index.html#wasmtime">https://oss-fuzz-build-logs.storage.googleapis.com/index.html#wasmtime</a></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Step</span><span class="w"> </span>#<span class="mi">4</span>:    <span class="nc">Compiling</span><span class="w"> </span><span class="n">cpp_demangle</span><span class="w"> </span><span class="n">v0</span><span class="p">.</span><span class="mf">3.2</span><span class="w"></span>
<span class="n">Step</span><span class="w"> </span>#<span class="mi">4</span>:    <span class="nc">Compiling</span><span class="w"> </span><span class="n">crossbeam</span><span class="o">-</span><span class="n">channel</span><span class="w"> </span><span class="n">v0</span><span class="p">.</span><span class="mf">5.1</span><span class="w"></span>
<span class="n">Step</span><span class="w"> </span>#<span class="mi">4</span>:    <span class="nc">Compiling</span><span class="w"> </span><span class="n">quote</span><span class="w"> </span><span class="n">v1</span><span class="p">.</span><span class="mf">0.9</span><span class="w"></span>
<span class="n">Step</span><span class="w"> </span>#<span class="mi">4</span>:    <span class="nc">Compiling</span><span class="w"> </span><span class="n">aho</span><span class="o">-</span><span class="n">corasick</span><span class="w"> </span><span class="n">v0</span><span class="p">.</span><span class="mf">7.18</span><span class="w"></span>
<span class="n">Step</span><span class="w"> </span>#<span class="mi">4</span>:    <span class="nc">Compiling</span><span class="w"> </span><span class="n">jobserver</span><span class="w"> </span><span class="n">v0</span><span class="p">.</span><span class="mf">1.22</span><span class="w"></span>
<span class="n">Step</span><span class="w"> </span>#<span class="mi">4</span>:    <span class="nc">Compiling</span><span class="w"> </span><span class="n">getrandom</span><span class="w"> </span><span class="n">v0</span><span class="p">.</span><span class="mf">2.3</span><span class="w"></span>
<span class="n">Step</span><span class="w"> </span>#<span class="mi">4</span>: <span class="nc">error</span>: <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">custom</span><span class="w"> </span><span class="n">build</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="err">`</span><span class="n">wasm</span><span class="o">-</span><span class="n">spec</span><span class="o">-</span><span class="n">interpreter</span><span class="w"> </span><span class="n">v0</span><span class="p">.</span><span class="mf">1.0</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">fuzzing</span><span class="o">/</span><span class="n">wasm</span><span class="o">-</span><span class="n">spec</span><span class="o">-</span><span class="n">interpreter</span><span class="p">)</span><span class="err">`</span><span class="w"></span>
<span class="n">Step</span><span class="w"> </span>#<span class="mi">4</span>:
<span class="nc">Step</span><span class="w"> </span>#<span class="mi">4</span>: <span class="nc">Caused</span><span class="w"> </span><span class="n">by</span>:
<span class="nc">Step</span><span class="w"> </span>#<span class="mi">4</span>:   <span class="nc">process</span><span class="w"> </span><span class="n">didn</span><span class="o">'</span><span class="na">t</span><span class="w"> </span><span class="n">exit</span><span class="w"> </span><span class="n">successfully</span>: <span class="err">`</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">wasm</span><span class="o">-</span><span class="n">spec</span><span class="o">-</span><span class="n">interpreter</span><span class="o">-</span><span class="n">e74f205a2f27f8b8</span><span class="o">/</span><span class="n">build</span><span class="o">-</span><span class="n">script</span><span class="o">-</span><span class="n">build</span><span class="err">`</span><span class="w"> </span><span class="p">(</span><span class="n">exit</span><span class="w"> </span><span class="n">status</span>: <span class="mi">101</span><span class="p">)</span><span class="w"></span>
<span class="n">Step</span><span class="w"> </span>#<span class="mi">4</span>:   <span class="o">---</span><span class="w"> </span><span class="n">stdout</span><span class="w"></span>
<span class="n">Step</span><span class="w"> </span>#<span class="mi">4</span>:   <span class="nc">cargo</span>:<span class="nc">rerun</span><span class="o">-</span><span class="k">if</span><span class="o">-</span><span class="n">changed</span><span class="o">=</span><span class="n">ocaml</span><span class="o">/</span><span class="n">interpret</span><span class="p">.</span><span class="n">ml</span><span class="w"></span>
<span class="n">Step</span><span class="w"> </span>#<span class="mi">4</span>:   <span class="nc">cargo</span>:<span class="nc">rerun</span><span class="o">-</span><span class="k">if</span><span class="o">-</span><span class="n">changed</span><span class="o">=</span><span class="n">ocaml</span><span class="o">/</span><span class="n">Makefile</span><span class="w"></span>
<span class="n">Step</span><span class="w"> </span>#<span class="mi">4</span>:   <span class="nc">make</span><span class="w"> </span><span class="o">-</span><span class="n">C</span><span class="w"> </span><span class="n">spec</span><span class="o">/</span><span class="n">interpreter</span><span class="w"> </span><span class="n">libopt</span><span class="w"></span>
<span class="n">Step</span><span class="w"> </span>#<span class="mi">4</span>:   <span class="nc">make</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>: <span class="nc">Entering</span><span class="w"> </span><span class="n">directory</span><span class="w"> </span><span class="o">'/</span><span class="n">src</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">fuzzing</span><span class="o">/</span><span class="n">wasm</span><span class="o">-</span><span class="n">spec</span><span class="o">-</span><span class="n">interpreter</span><span class="o">/</span><span class="n">ocaml</span><span class="o">/</span><span class="n">spec</span><span class="o">/</span><span class="n">interpreter</span><span class="o">'</span><span class="w"></span>
<span class="n">Step</span><span class="w"> </span>#<span class="mi">4</span>:   <span class="nc">ls</span><span class="w"> </span><span class="n">binary</span><span class="o">/</span><span class="n">decode</span><span class="p">.</span><span class="n">ml</span><span class="w"> </span><span class="n">binary</span><span class="o">/</span><span class="n">decode</span><span class="p">.</span><span class="n">mli</span><span class="w"> </span><span class="n">binary</span><span class="o">/</span><span class="n">encode</span><span class="p">.</span><span class="n">ml</span><span class="w"> </span><span class="n">binary</span><span class="o">/</span><span class="n">encode</span><span class="p">.</span><span class="n">mli</span><span class="w"> </span><span class="n">binary</span><span class="o">/</span><span class="n">utf8</span><span class="p">.</span><span class="n">ml</span><span class="w"> </span><span class="n">binary</span><span class="o">/</span><span class="n">utf8</span><span class="p">.</span><span class="n">mli</span><span class="w"> </span><span class="n">exec</span><span class="o">/</span><span class="n">eval</span><span class="p">.</span><span class="n">ml</span><span class="w"> </span><span class="n">exec</span><span class="o">/</span><span class="n">eval</span><span class="p">.</span><span class="n">mli</span><span class="w"> </span><span class="n">exec</span><span class="o">/</span><span class="n">eval_numeric</span><span class="p">.</span><span class="n">ml</span><span class="w"> </span><span class="n">exec</span><span class="o">/</span><span class="n">eval_numeric</span><span class="p">.</span><span class="n">mli</span><span class="w"> </span><span class="n">exec</span><span class="o">/</span><span class="kt">f32</span><span class="p">.</span><span class="n">ml</span><span class="w"> </span><span class="n">exec</span><span class="o">/</span><span class="n">f32_convert</span><span class="p">.</span><span class="n">ml</span><span class="w"> </span><span class="n">exec</span><span class="o">/</span><span class="n">f32_convert</span><span class="p">.</span><span class="n">mli</span><span class="w"> </span><span class="n">exec</span><span class="o">/</span><span class="kt">f64</span><span class="p">.</span><span class="n">ml</span><span class="w"> </span><span class="n">exec</span><span class="o">/</span><span class="n">f64_convert</span><span class="p">.</span><span class="n">ml</span><span class="w"> </span><span class="n">exec</span><span class="o">/</span><span class="n">f64_convert</span><span class="p">.</span><span class="n">mli</span><span class="w"> </span><span class="n">exec</span><span class="o">/</span><span class="n">float</span><span class="p">.</span><span class="n">ml</span><span class="w"> </span><span class="n">exec</span><span class="o">/</span><span class="kt">i32</span><span class="p">.</span><span class="n">ml</span><span class="w"> </span><span class="n">exec</span><span class="o">/</span><span class="n">i32_convert</span><span class="p">.</span><span class="n">ml</span><span class="w"> </span><span class="n">exec</span><span class="o">/</span><span class="n">i32_convert</span><span class="p">.</span><span class="n">mli</span><span class="w"> </span><span class="n">exec</span><span class="o">/</span><span class="kt">i64</span><span class="p">.</span><span class="n">ml</span><span class="w"> </span><span class="n">exec</span><span class="o">/</span><span class="n">i64_convert</span><span class="p">.</span><span class="n">ml</span><span class="w"> </span><span class="n">exec</span><span class="o">/</span><span class="n">i64_convert</span><span class="p">.</span><span class="n">mli</span><span class="w"> </span><span class="n">exec</span><span class="o">/</span><span class="n">int</span><span class="p">.</span><span class="n">ml</span><span class="w"> </span><span class="n">exec</span><span class="o">/</span><span class="n">numeric_error</span><span class="p">.</span><span class="n">ml</span><span class="w"> </span><span class="n">host</span><span class="o">/</span><span class="n">env</span><span class="p">.</span><span class="n">ml</span><span class="w"> </span><span class="n">host</span><span class="o">/</span><span class="n">spectest</span><span class="p">.</span><span class="n">ml</span><span class="w"> </span><span class="n">main</span><span class="o">/</span><span class="n">flags</span><span class="p">.</span><span class="n">ml</span><span class="w"> </span><span class="n">main</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">ml</span><span class="w"> </span><span class="n">runtime</span><span class="o">/</span><span class="n">func</span><span class="p">.</span><span class="n">ml</span><span class="w"> </span><span class="n">runtime</span><span class="o">/</span><span class="n">func</span><span class="p">.</span><span class="n">mli</span><span class="w"> </span><span class="n">runtime</span><span class="o">/</span><span class="n">global</span><span class="p">.</span><span class="n">ml</span><span class="w"> </span><span class="n">runtime</span><span class="o">/</span><span class="n">global</span><span class="p">.</span><span class="n">mli</span><span class="w"> </span><span class="n">runtime</span><span class="o">/</span><span class="n">instance</span><span class="p">.</span><span class="n">ml</span><span class="w"> </span><span class="n">runtime</span><span class="o">/</span><span class="n">memory</span><span class="p">.</span><span class="n">ml</span><span class="w"> </span><span class="n">runtime</span><span class="o">/</span><span class="n">memory</span><span class="p">.</span><span class="n">mli</span><span class="w"> </span><span class="n">runtime</span><span class="o">/</span><span class="n">table</span><span class="p">.</span><span class="n">ml</span><span class="w"> </span><span class="n">runtime</span><span class="o">/</span><span class="n">table</span><span class="p">.</span><span class="n">mli</span><span class="w"> </span><span class="n">script</span><span class="o">/</span><span class="n">import</span><span class="p">.</span><span class="n">ml</span><span class="w"> </span><span class="n">script</span><span class="o">/</span><span class="n">import</span><span class="p">.</span><span class="n">mli</span><span class="w"> </span><span class="n">script</span><span class="o">/</span><span class="n">js</span><span class="p">.</span><span class="n">ml</span><span class="w"> </span><span class="n">script</span><span class="o">/</span><span class="n">js</span><span class="p">.</span><span class="n">mli</span><span class="w"> </span><span class="n">script</span><span class="o">/</span><span class="n">run</span><span class="p">.</span><span class="n">ml</span><span class="w"> </span><span class="n">script</span><span class="o">/</span><span class="n">run</span><span class="p">.</span><span class="n">mli</span><span class="w"> </span><span class="n">script</span><span class="o">/</span><span class="n">script</span><span class="p">.</span><span class="n">ml</span><span class="w"> </span><span class="n">syntax</span><span class="o">/</span><span class="n">ast</span><span class="p">.</span><span class="n">ml</span><span class="w"> </span><span class="n">syntax</span><span class="o">/</span><span class="n">free</span><span class="p">.</span><span class="n">ml</span><span class="w"> </span><span class="n">syntax</span><span class="o">/</span><span class="n">free</span><span class="p">.</span><span class="n">mli</span><span class="w"> </span><span class="n">syntax</span><span class="o">/</span><span class="n">operators</span><span class="p">.</span><span class="n">ml</span><span class="w"> </span><span class="n">syntax</span><span class="o">/</span><span class="n">types</span><span class="p">.</span><span class="n">ml</span><span class="w"> </span><span class="n">syntax</span><span class="o">/</span><span class="n">values</span><span class="p">.</span><span class="n">ml</span><span class="w"> </span><span class="n">text</span><span class="o">/</span><span class="n">arrange</span><span class="p">.</span><span class="n">ml</span><span class="w"> </span><span class="n">text</span><span class="o">/</span><span class="n">arrange</span><span class="p">.</span><span class="n">mli</span><span class="w"> </span><span class="n">text</span><span class="o">/</span><span class="n">lexer</span><span class="p">.</span><span class="n">mli</span><span class="w"> </span><span class="n">text</span><span class="o">/</span><span class="n">lexer</span><span class="p">.</span><span class="n">mll</span><span class="w"> </span><span class="n">text</span><span class="o">/</span><span class="n">parse</span><span class="p">.</span><span class="n">ml</span><span class="w"> </span><span class="n">text</span><span class="o">/</span><span class="n">parse</span><span class="p">.</span><span class="n">mli</span><span class="w"> </span><span class="n">text</span><span class="o">/</span><span class="n">parser</span><span class="p">.</span><span class="n">mly</span><span class="w"> </span><span class="n">text</span><span class="o">/</span><span class="n">print</span><span class="p">.</span><span class="n">ml</span><span class="w"> </span><span class="n">text</span><span class="o">/</span><span class="n">print</span><span class="p">.</span><span class="n">mli</span><span class="w"> </span><span class="n">util</span><span class="o">/</span><span class="n">error</span><span class="p">.</span><span class="n">ml</span><span class="w"> </span><span class="n">util</span><span class="o">/</span><span class="n">error</span><span class="p">.</span><span class="n">mli</span><span class="w"> </span><span class="n">util</span><span class="o">/</span><span class="n">lib</span><span class="p">.</span><span class="n">ml</span><span class="w"> </span><span class="n">util</span><span class="o">/</span><span class="n">lib</span><span class="p">.</span><span class="n">mli</span><span class="w"> </span><span class="n">util</span><span class="o">/</span><span class="n">sexpr</span><span class="p">.</span><span class="n">ml</span><span class="w"> </span><span class="n">util</span><span class="o">/</span><span class="n">sexpr</span><span class="p">.</span><span class="n">mli</span><span class="w"> </span><span class="n">util</span><span class="o">/</span><span class="n">source</span><span class="p">.</span><span class="n">ml</span><span class="w"> </span><span class="n">util</span><span class="o">/</span><span class="n">source</span><span class="p">.</span><span class="n">mli</span><span class="w"> </span><span class="n">valid</span><span class="o">/</span><span class="n">valid</span><span class="p">.</span><span class="n">ml</span><span class="w"> </span><span class="n">valid</span><span class="o">/</span><span class="n">valid</span><span class="p">.</span><span class="n">mli</span><span class="w"> </span><span class="err">\</span><span class="w"></span>
<span class="n">Step</span><span class="w"> </span>#<span class="mi">4</span>:    <span class="o">|</span><span class="w"> </span><span class="n">sed</span><span class="w"> </span><span class="o">'</span><span class="na">s</span>:<span class="err">\</span><span class="p">(.</span><span class="o">*/</span><span class="err">\</span><span class="p">)</span><span class="err">\</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="err">\</span><span class="p">}</span><span class="err">\</span><span class="p">(.</span><span class="o">*</span><span class="err">\</span><span class="p">)</span><span class="err">\</span><span class="p">.[</span><span class="o">^</span><span class="err">\</span><span class="p">.]</span><span class="o">*</span>:<span class="err">\</span><span class="mi">2</span>:<span class="o">'</span> <span class="err">\</span><span class="w"></span>
<span class="n">Step</span><span class="w"> </span>#<span class="mi">4</span>:    <span class="o">|</span><span class="w"> </span><span class="n">grep</span><span class="w"> </span><span class="o">-</span><span class="n">v</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="err">\</span><span class="w"></span>
<span class="n">Step</span><span class="w"> </span>#<span class="mi">4</span>:    <span class="o">|</span><span class="w"> </span><span class="n">sort</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">uniq</span><span class="w"> </span><span class="err">\</span><span class="w"></span>
<span class="n">Step</span><span class="w"> </span>#<span class="mi">4</span>:    <span class="o">&gt;</span><span class="n">wasm</span><span class="p">.</span><span class="n">mlpack</span><span class="w"></span>
<span class="n">Step</span><span class="w"> </span>#<span class="mi">4</span>:   <span class="nc">echo</span><span class="w"> </span><span class="o">&gt;</span><span class="n">_tags</span><span class="w"> </span><span class="s">"true: bin_annot"</span><span class="w"></span>
<span class="n">Step</span><span class="w"> </span>#<span class="mi">4</span>:   <span class="nc">echo</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="n">_tags</span><span class="w"> </span><span class="s">"true: debug"</span><span class="w"></span>
<span class="n">Step</span><span class="w"> </span>#<span class="mi">4</span>:   <span class="nc">echo</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="n">_tags</span><span class="w"> </span><span class="s">"&lt;{util,syntax,binary,text,valid,runtime,exec,script,host,main}/*.cmx&gt;: for-pack(Wasm)"</span><span class="w"></span>
<span class="n">Step</span><span class="w"> </span>#<span class="mi">4</span>:   <span class="nc">ocamlbuild</span><span class="w"> </span><span class="o">-</span><span class="n">lexflags</span><span class="w"> </span><span class="o">-</span><span class="n">ml</span><span class="w"> </span><span class="o">-</span><span class="n">cflags</span><span class="w"> </span><span class="o">'-</span><span class="n">w</span><span class="w"> </span><span class="o">+</span><span class="n">a</span><span class="o">-</span><span class="mi">4</span><span class="o">-</span><span class="mi">27</span><span class="o">-</span><span class="mi">42</span><span class="o">-</span><span class="mi">44</span><span class="o">-</span><span class="mi">45</span><span class="w"> </span><span class="o">-</span><span class="n">warn</span><span class="o">-</span><span class="n">error</span><span class="w"> </span><span class="o">+</span><span class="n">a</span><span class="o">-</span><span class="mi">3</span><span class="o">'</span><span class="w"> </span><span class="o">-</span><span class="n">I</span><span class="w"> </span><span class="n">util</span><span class="w"> </span><span class="o">-</span><span class="n">I</span><span class="w"> </span><span class="n">syntax</span><span class="w"> </span><span class="o">-</span><span class="n">I</span><span class="w"> </span><span class="n">binary</span><span class="w"> </span><span class="o">-</span><span class="n">I</span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="o">-</span><span class="n">I</span><span class="w"> </span><span class="n">valid</span><span class="w"> </span><span class="o">-</span><span class="n">I</span><span class="w"> </span><span class="n">runtime</span><span class="w"> </span><span class="o">-</span><span class="n">I</span><span class="w"> </span><span class="n">exec</span><span class="w"> </span><span class="o">-</span><span class="n">I</span><span class="w"> </span><span class="n">script</span><span class="w"> </span><span class="o">-</span><span class="n">I</span><span class="w"> </span><span class="n">host</span><span class="w"> </span><span class="o">-</span><span class="n">I</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="o">-</span><span class="n">libs</span><span class="w"> </span><span class="n">bigarray</span><span class="w"> </span><span class="o">-</span><span class="n">quiet</span><span class="w"> </span><span class="n">wasm</span><span class="p">.</span><span class="n">cmx</span><span class="w"></span>
<span class="n">Step</span><span class="w"> </span>#<span class="mi">4</span>:   <span class="o">+</span><span class="w"> </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">ocamldep</span><span class="w"> </span><span class="o">-</span><span class="n">modules</span><span class="w"> </span><span class="n">syntax</span><span class="o">/</span><span class="n">ast</span><span class="p">.</span><span class="n">ml</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">syntax</span><span class="o">/</span><span class="n">ast</span><span class="p">.</span><span class="n">ml</span><span class="p">.</span><span class="n">depends</span><span class="w"></span>
<span class="n">Step</span><span class="w"> </span>#<span class="mi">4</span>:   <span class="nc">File</span><span class="w"> </span><span class="s">"syntax/ast.ml"</span><span class="p">,</span><span class="w"> </span><span class="n">line</span><span class="w"> </span><span class="mi">156</span><span class="p">,</span><span class="w"> </span><span class="n">characters</span><span class="w"> </span><span class="mi">14</span><span class="o">-</span><span class="mi">15</span>:
<span class="nc">Step</span><span class="w"> </span>#<span class="mi">4</span>:   <span class="nc">Error</span>: <span class="nc">Syntax</span><span class="w"> </span><span class="n">error</span><span class="w"></span>
<span class="n">Step</span><span class="w"> </span>#<span class="mi">4</span>:   <span class="nc">Command</span><span class="w"> </span><span class="n">exited</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">code</span><span class="w"> </span><span class="mf">2.</span><span class="w"></span>
<span class="n">Step</span><span class="w"> </span>#<span class="mi">4</span>:   <span class="nc">Makefile</span>:<span class="mi">91</span>: <span class="nc">recipe</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">target</span><span class="w"> </span><span class="o">'</span><span class="nb">_</span><span class="na">build</span><span class="o">/</span><span class="n">wasm</span><span class="p">.</span><span class="n">cmx</span><span class="o">'</span><span class="w"> </span><span class="n">failed</span><span class="w"></span>
<span class="n">Step</span><span class="w"> </span>#<span class="mi">4</span>:   <span class="nc">rm</span><span class="w"> </span><span class="n">wasm</span><span class="p">.</span><span class="n">mlpack</span><span class="w"> </span><span class="n">_tags</span><span class="w"></span>
<span class="n">Step</span><span class="w"> </span>#<span class="mi">4</span>:   <span class="nc">make</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>: <span class="nc">Leaving</span><span class="w"> </span><span class="n">directory</span><span class="w"> </span><span class="o">'/</span><span class="n">src</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">fuzzing</span><span class="o">/</span><span class="n">wasm</span><span class="o">-</span><span class="n">spec</span><span class="o">-</span><span class="n">interpreter</span><span class="o">/</span><span class="n">ocaml</span><span class="o">/</span><span class="n">spec</span><span class="o">/</span><span class="n">interpreter</span><span class="o">'</span><span class="w"></span>
<span class="n">Step</span><span class="w"> </span>#<span class="mi">4</span>:   <span class="nc">Makefile</span>:<span class="mi">28</span>: <span class="nc">recipe</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">target</span><span class="w"> </span><span class="o">'</span><span class="na">spec</span><span class="o">/</span><span class="n">interpreter</span><span class="o">/</span><span class="n">_build</span><span class="o">/</span><span class="n">wasm</span><span class="p">.</span><span class="n">cmxa</span><span class="o">'</span><span class="w"> </span><span class="n">failed</span><span class="w"></span>
<span class="n">Step</span><span class="w"> </span>#<span class="mi">4</span>:
<span class="nc">Step</span><span class="w"> </span>#<span class="mi">4</span>:   <span class="o">---</span><span class="w"> </span><span class="n">stderr</span><span class="w"></span>
<span class="n">Step</span><span class="w"> </span>#<span class="mi">4</span>:   <span class="nc">Cloning</span><span class="w"> </span><span class="n">into</span><span class="w"> </span><span class="o">'</span><span class="na">ocaml</span><span class="o">/</span><span class="n">spec</span><span class="o">'..</span><span class="p">.</span><span class="w"></span>
<span class="n">Step</span><span class="w"> </span>#<span class="mi">4</span>:   <span class="nc">make</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>: <span class="o">***</span><span class="w"> </span><span class="p">[</span><span class="n">_build</span><span class="o">/</span><span class="n">wasm</span><span class="p">.</span><span class="n">cmx</span><span class="p">]</span><span class="w"> </span><span class="n">Error</span><span class="w"> </span><span class="mi">10</span><span class="w"></span>
<span class="n">Step</span><span class="w"> </span>#<span class="mi">4</span>:   <span class="nc">make</span>: <span class="o">***</span><span class="w"> </span><span class="p">[</span><span class="n">spec</span><span class="o">/</span><span class="n">interpreter</span><span class="o">/</span><span class="n">_build</span><span class="o">/</span><span class="n">wasm</span><span class="p">.</span><span class="n">cmxa</span><span class="p">]</span><span class="w"> </span><span class="n">Error</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>
<span class="n">Step</span><span class="w"> </span>#<span class="mi">4</span>:   <span class="nc">thread</span><span class="w"> </span><span class="o">'</span><span class="na">main</span><span class="o">'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">'</span><span class="na">Failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">build</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">OCaml</span><span class="w"> </span><span class="n">library</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="o">'</span><span class="na">make</span><span class="sc">'.'</span><span class="p">,</span><span class="w"> </span><span class="n">crates</span><span class="o">/</span><span class="n">fuzzing</span><span class="o">/</span><span class="n">wasm</span><span class="o">-</span><span class="n">spec</span><span class="o">-</span><span class="n">interpreter</span><span class="o">/</span><span class="n">build</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">57</span>:<span class="mi">5</span><span class="w"></span>
<span class="n">Step</span><span class="w"> </span>#<span class="mi">4</span>:   <span class="nc">note</span>: <span class="nc">run</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="err">`</span><span class="n">RUST_BACKTRACE</span><span class="o">=</span><span class="mi">1</span><span class="err">`</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">display</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">backtrace</span><span class="w"></span>
<span class="n">Step</span><span class="w"> </span>#<span class="mi">4</span>: <span class="nc">warning</span>: <span class="nc">build</span><span class="w"> </span><span class="n">failed</span><span class="p">,</span><span class="w"> </span><span class="n">waiting</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="n">jobs</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">finish</span><span class="o">..</span><span class="p">.</span><span class="w"></span>
<span class="n">Step</span><span class="w"> </span>#<span class="mi">4</span>: <span class="nc">error</span>: <span class="nc">build</span><span class="w"> </span><span class="n">failed</span><span class="w"></span>
<span class="n">Step</span><span class="w"> </span>#<span class="mi">4</span>: <span class="nc">Error</span>: <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">build</span><span class="w"> </span><span class="n">fuzz</span><span class="w"> </span><span class="n">script</span>: <span class="s">"cargo"</span><span class="w"> </span><span class="s">"build"</span><span class="w"> </span><span class="s">"--manifest-path"</span><span class="w"> </span><span class="s">"/src/wasmtime/fuzz/Cargo.toml"</span><span class="w"> </span><span class="s">"--target"</span><span class="w"> </span><span class="s">"x86_64-unknown-linux-gnu"</span><span class="w"> </span><span class="s">"--release"</span><span class="w"> </span><span class="s">"--features"</span><span class="w"> </span><span class="s">"peepmatic-fuzzing experimental_x64"</span><span class="w"> </span><span class="s">"--bins"</span><span class="w"></span>
<span class="n">Step</span><span class="w"> </span>#<span class="mi">4</span>: <span class="o">********************************************************************************</span><span class="w"></span>
<span class="n">Step</span><span class="w"> </span>#<span class="mi">4</span>: <span class="nc">Failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">build</span><span class="p">.</span><span class="w"></span>
<span class="n">Step</span><span class="w"> </span>#<span class="mi">4</span>: <span class="nc">To</span><span class="w"> </span><span class="n">reproduce</span><span class="p">,</span><span class="w"> </span><span class="n">run</span>:
<span class="nc">Step</span><span class="w"> </span>#<span class="mi">4</span>: <span class="nc">python</span><span class="w"> </span><span class="n">infra</span><span class="o">/</span><span class="n">helper</span><span class="p">.</span><span class="n">py</span><span class="w"> </span><span class="n">build_image</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"></span>
<span class="n">Step</span><span class="w"> </span>#<span class="mi">4</span>: <span class="nc">python</span><span class="w"> </span><span class="n">infra</span><span class="o">/</span><span class="n">helper</span><span class="p">.</span><span class="n">py</span><span class="w"> </span><span class="n">build_fuzzers</span><span class="w"> </span><span class="o">--</span><span class="n">sanitizer</span><span class="w"> </span><span class="n">address</span><span class="w"> </span><span class="o">--</span><span class="n">engine</span><span class="w"> </span><span class="n">libfuzzer</span><span class="w"> </span><span class="o">--</span><span class="n">architecture</span><span class="w"> </span><span class="n">x86_64</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"></span>
<span class="n">Step</span><span class="w"> </span>#<span class="mi">4</span>: <span class="o">********************************************************************************</span><span class="w"></span>
<span class="n">Finished</span><span class="w"> </span><span class="n">Step</span><span class="w"> </span>#<span class="mi">4</span><span class="w"></span>
<span class="n">ERROR</span><span class="w"></span>
<span class="n">ERROR</span>: <span class="nc">build</span><span class="w"> </span><span class="n">step</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="s">"gcr.io/oss-fuzz/wasmtime"</span><span class="w"> </span><span class="n">failed</span>: <span class="nc">step</span><span class="w"> </span><span class="n">exited</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">non</span><span class="o">-</span><span class="n">zero</span><span class="w"> </span><span class="n">status</span>: <span class="mi">1</span><span class="w"></span>
</code></pre></div>



<a name="249131622"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/249131622" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#249131622">(Aug 11 2021 at 16:21)</a>:</h4>
<p>is that an issue perhaps where ocaml is too old?</p>



<a name="249131691"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/249131691" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#249131691">(Aug 11 2021 at 16:22)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Step</span><span class="w"> </span>#<span class="mi">4</span>:   <span class="nc">File</span><span class="w"> </span><span class="s">"syntax/ast.ml"</span><span class="p">,</span><span class="w"> </span><span class="n">line</span><span class="w"> </span><span class="mi">156</span><span class="p">,</span><span class="w"> </span><span class="n">characters</span><span class="w"> </span><span class="mi">14</span><span class="o">-</span><span class="mi">15</span>:
<span class="nc">Step</span><span class="w"> </span>#<span class="mi">4</span>:   <span class="nc">Error</span>: <span class="nc">Syntax</span><span class="w"> </span><span class="n">error</span><span class="w"></span>
</code></pre></div>



<a name="249131808"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/249131808" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#249131808">(Aug 11 2021 at 16:22)</a>:</h4>
<p>oh wow it looks super old, like 4.02 may be pulled in?</p>



<a name="249131834"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/249131834" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Brown <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#249131834">(Aug 11 2021 at 16:23)</a>:</h4>
<p>yeah, when I ran the oss fuzz image in docker I saw that 4.02 was pulled in</p>



<a name="249131837"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/249131837" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Brown <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#249131837">(Aug 11 2021 at 16:23)</a>:</h4>
<p>yup</p>



<a name="249131840"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/249131840" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#249131840">(Aug 11 2021 at 16:23)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Step</span><span class="w"> </span>#<span class="mi">1</span>: <span class="nc">Setting</span><span class="w"> </span><span class="n">up</span><span class="w"> </span><span class="n">ocaml</span><span class="o">-</span><span class="n">findlib</span><span class="w"> </span><span class="p">(</span><span class="mf">1.5.5</span><span class="o">-</span><span class="mi">2</span><span class="n">build1</span><span class="p">)</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"></span>

<span class="n">Step</span><span class="w"> </span>#<span class="mi">1</span>: <span class="nc">Setting</span><span class="w"> </span><span class="n">up</span><span class="w"> </span><span class="n">ocaml</span><span class="o">-</span><span class="n">compiler</span><span class="o">-</span><span class="n">libs</span><span class="w"> </span><span class="p">(</span><span class="mf">4.02.3</span><span class="o">-</span><span class="mi">5</span><span class="n">ubuntu2</span><span class="p">)</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"></span>

<span class="n">Step</span><span class="w"> </span>#<span class="mi">1</span>: <span class="nc">Setting</span><span class="w"> </span><span class="n">up</span><span class="w"> </span><span class="n">ocaml</span><span class="o">-</span><span class="n">interp</span><span class="w"> </span><span class="p">(</span><span class="mf">4.02.3</span><span class="o">-</span><span class="mi">5</span><span class="n">ubuntu2</span><span class="p">)</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"></span>

<span class="n">Step</span><span class="w"> </span>#<span class="mi">1</span>: <span class="nc">Setting</span><span class="w"> </span><span class="n">up</span><span class="w"> </span><span class="n">ocaml</span><span class="o">-</span><span class="n">nox</span><span class="w"> </span><span class="p">(</span><span class="mf">4.02.3</span><span class="o">-</span><span class="mi">5</span><span class="n">ubuntu2</span><span class="p">)</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"></span>
</code></pre></div>



<a name="249131883"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/249131883" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Brown <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#249131883">(Aug 11 2021 at 16:23)</a>:</h4>
<p>and I thought, "hm, this might be a problem..." <span aria-label="grinning" class="emoji emoji-1f600" role="img" title="grinning">:grinning:</span></p>



<a name="249131929"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/249131929" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Brown <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#249131929">(Aug 11 2021 at 16:23)</a>:</h4>
<p>well, I wonder if there is a way to use opam to upgrade ocaml or something</p>



<a name="249132016"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/249132016" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Brown <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#249132016">(Aug 11 2021 at 16:24)</a>:</h4>
<p>the issue is that they're using a really old Ubuntu as the base for the oss-fuzz image</p>



<a name="249132026"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/249132026" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Brown <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#249132026">(Aug 11 2021 at 16:24)</a>:</h4>
<p>16.x</p>



<a name="249132062"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/249132062" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Brown <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#249132062">(Aug 11 2021 at 16:24)</a>:</h4>
<p>is there a newer oss fuzz image?</p>



<a name="249136127"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/249136127" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Brown <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#249136127">(Aug 11 2021 at 16:57)</a>:</h4>
<p>Looks like there is no newer oss fuzz image, but I think the following sequence will update the tools to 4.12:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">sh</span><span class="w"> </span><span class="o">&lt;</span><span class="p">(</span><span class="n">curl</span><span class="w"> </span><span class="o">-</span><span class="n">sL</span><span class="w"> </span><span class="n">https</span>:<span class="c1">//raw.githubusercontent.com/ocaml/opam/master/shell/install.sh)</span>
<span class="n">opam</span><span class="w"> </span><span class="n">init</span><span class="w"> </span><span class="o">--</span><span class="n">disable</span><span class="o">-</span><span class="n">sandboxing</span><span class="w"></span>
<span class="n">opam</span><span class="w"> </span><span class="n">install</span><span class="w"> </span><span class="n">ocamlbuild</span><span class="w"></span>
<span class="n">eval</span><span class="w"> </span><span class="cp">$(</span><span class="n">opam</span><span class="w"> </span><span class="n">env</span><span class="w"> </span><span class="o">--</span><span class="n">switch</span><span class="o">=</span><span class="n">default</span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<p>Inside the oss fuzz image that is enough to compile the spec interpreter.</p>



<a name="249136795"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/249136795" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Brown <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#249136795">(Aug 11 2021 at 17:01)</a>:</h4>
<p>Unfortunately that has multiple "read from stdin" scripts</p>



<a name="249138710"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/249138710" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#249138710">(Aug 11 2021 at 17:15)</a>:</h4>
<p>eh that's fine imo</p>



<a name="249139139"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/249139139" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Brown <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#249139139">(Aug 11 2021 at 17:18)</a>:</h4>
<p><span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span> I would need to figure out how to pass in the right sequence of <code>&lt;enter&gt; y &lt;enter&gt; ...</code>--do you have a preference on how to do that?</p>



<a name="249140075"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/249140075" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#249140075">(Aug 11 2021 at 17:25)</a>:</h4>
<p>uh... unsure lol</p>



<a name="249140098"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/249140098" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#249140098">(Aug 11 2021 at 17:25)</a>:</h4>
<p>when in doubt sometimes <code>yes | the_script</code> works</p>



<a name="249140120"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/249140120" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#249140120">(Aug 11 2021 at 17:25)</a>:</h4>
<p>but if that doesn't work I'd root around for some sort of "please assume yes" cli switch</p>



<a name="249252155"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/249252155" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Brown <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#249252155">(Aug 12 2021 at 15:43)</a>:</h4>
<p><span class="user-mention" data-user-id="253994">@Alex Crichton</span>, I see that <a href="https://github.com/google/oss-fuzz/pull/6205">https://github.com/google/oss-fuzz/pull/6205</a> got merged; how do we see if the build now passes? Do we have to wait for an e-mail telling us it crashed or is there some other way to inspect what is going on?</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/google/oss-fuzz/pull/6205" style="background-image: url(https://opengraph.githubassets.com/b6273f8699ac3f0442559b6b0316a5ba5d813d89e29cdf80716f487a584aeb7c/google/oss-fuzz/pull/6205)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/google/oss-fuzz/pull/6205" title="wasmtime: install a newer version of OCaml by abrown · Pull Request #6205 · google/oss-fuzz">wasmtime: install a newer version of OCaml by abrown · Pull Request #6205 · google/oss-fuzz</a></div><div class="message_embed_description">
Have a question about this project? Sign up for a free GitHub account to open an issue and contact its maintainers and the community.
  </div></div></div>



<a name="249252232"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/249252232" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#249252232">(Aug 12 2021 at 15:44)</a>:</h4>
<p>I got an email about another build failure, but I think it's because the changes weren't included</p>



<a name="249252247"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/249252247" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#249252247">(Aug 12 2021 at 15:44)</a>:</h4>
<p>I go to oss-fuzz and hit on build logs</p>



<a name="249252252"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/249252252" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#249252252">(Aug 12 2021 at 15:44)</a>:</h4>
<p>and it should have logs for wasmtime</p>



<a name="249253589"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/249253589" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Brown <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#249253589">(Aug 12 2021 at 15:55)</a>:</h4>
<p>I don't see that:<br>
<a href="/user_uploads/15107/C7-ANmdq4GLpIv6zTb70Mw59/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/15107/C7-ANmdq4GLpIv6zTb70Mw59/image.png" title="image.png"><img src="/user_uploads/15107/C7-ANmdq4GLpIv6zTb70Mw59/image.png"></a></div>



<a name="249253667"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/249253667" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Brown <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#249253667">(Aug 12 2021 at 15:56)</a>:</h4>
<p>or you meant build status?</p>



<a name="249253796"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/249253796" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Brown <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#249253796">(Aug 12 2021 at 15:57)</a>:</h4>
<p>Ok, yeah, if I navigate around in there I can see the logs for the latest build and it is still complaining about a syntax error</p>



<a name="250056781"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/250056781" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#250056781">(Aug 19 2021 at 22:23)</a>:</h4>
<p>ok</p>



<a name="250057169"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/250057169" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#250057169">(Aug 19 2021 at 22:28)</a>:</h4>
<p>er, sent early. </p>
<p>I did a bit today looking into the spec interpreter timeouts, and my conclusion is that the whole thing is and probably won't ever be written for performance. I fear that our path to differential fuzzing with the spec interpreter is going to be severly limited given the nature of the spec interpreter.</p>
<p>I was curious, so I played around with Deno's <code>rusty_v8</code> crate to see how bad it would be to set up differential fuzzing against v8 instead of the spec interpreter. I <a href="https://github.com/alexcrichton/differential-wasmtime-v8/blob/main/src/main.rs">came up with this</a> and it seems to be working pretty well. When I enabled simd it pretty quickly found <a href="https://github.com/bytecodealliance/wasmtime/issues/3216">https://github.com/bytecodealliance/wasmtime/issues/3216</a> after I waded through the preexisting fuzz bugs. With the bindings I wrote so far we should have comparisions on instantiation results, comparison on values, and comparisons on memory, which I think is above-and-beyond what we do for both wasmi and the spec interpreter at the moment.</p>
<p>I'm curious how others feel about this. Should we switch from the spec interpreter to v8? Should we try to push on the spec interpreter? I think v8 has the benefit that it's (a) maintained by Deno with <code>rusty_v8</code>, so we get that for free and (b) it's a fuzzed engine we're unlikely to find bugs in (performance or otherwise). Personally I feel that we'll get 99% of the benefit of differential fuzzing by just fuzzing against something other than ourselves. While I think it's nice to fuzz against the spec interpreter I don't think it brings the lion's share of the benefit.</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/alexcrichton/differential-wasmtime-v8/blob/main/src/main.rs" style="background-image: url(https://opengraph.githubassets.com/34f9a8bfc706d9aa7b9a5993d1b1096b07dfcbccbab41bdeba13e7d2acec7859/alexcrichton/differential-wasmtime-v8)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/alexcrichton/differential-wasmtime-v8/blob/main/src/main.rs" title="differential-wasmtime-v8/main.rs at main · alexcrichton/differential-wasmtime-v8">differential-wasmtime-v8/main.rs at main · alexcrichton/differential-wasmtime-v8</a></div><div class="message_embed_description">Contribute to alexcrichton/differential-wasmtime-v8 development by creating an account on GitHub.</div></div></div><div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wasmtime/issues/3216" style="background-image: url(https://opengraph.githubassets.com/e57d75cbd2e6da8f1ebb8205eefeae0e3c300cea40c2d0c5f920d8811cf91dcb/bytecodealliance/wasmtime/issues/3216)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wasmtime/issues/3216" title="x64 simd: Incorrect codegen leads to wrong result · Issue #3216 · bytecodealliance/wasmtime">x64 simd: Incorrect codegen leads to wrong result · Issue #3216 · bytecodealliance/wasmtime</a></div><div class="message_embed_description">Found with some fuzzing, this module: (module (func (result i64) v128.const i64x2 -1 1 global.get 0 f64x2.replace_lane 0 i64x2.extract_lane 1 ) (global f64 (f64.const 1)) (export &quot;&quot; (func...</div></div></div>



<a name="250057514"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/250057514" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#250057514">(Aug 19 2021 at 22:32)</a>:</h4>
<p>Interesting -- thank you for digging into this, first of all!</p>
<p>I think there is definitely a lot of value in fuzzing against "peers" -- especially V8 I expect to be very, very closely checked w.r.t. the spec. I'll note that we already had fuzzing against <code>wasmi</code> as well, so if we're going to mainly focus on this sort of fuzzing, it's worth evaluating whether we want to keep the latter. (Probably not, since it doesn't do SIMD, for starters.)</p>
<p>I am curious if there are any really easy-to-pick bits of performance in the spec interpreter, though. While (i) we aren't in the business of maintaining it, and (ii) it will certainly want to optimize for clear, unambiguous implementation over any sort of optimization, it seems to me that the folks who do maintain it would be interested in fixing obvious quadratic behavior, and also, fuzzing against "The Spec" is a gold standard and a nice thing to be able to say we do, if we can</p>



<a name="250057572"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/250057572" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#250057572">(Aug 19 2021 at 22:34)</a>:</h4>
<p>I did look a wee bit at what the nested-blocks example was doing and it looked like it had a funky multistage eval step function that prepended <code>Plain</code> and did some stack munging on every level -- it felt like it might be home to some inefficient n^2 list-mapping but I didn't dig deep enough to really say. Is that the part you were looking at?</p>



<a name="250057710"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/250057710" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#250057710">(Aug 19 2021 at 22:36)</a>:</h4>
<p>yeah that was the same conclusion I reached on the spec interpreter, adding <code>Plain</code> to new lists in a way that was probably pretty inefficient in terms of list management</p>



<a name="250057764"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/250057764" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#250057764">(Aug 19 2021 at 22:36)</a>:</h4>
<p>Personally I don't want to open a bug on the spec repo, I fear it will get lost to the mists of time or otherwise no one will be able to think of a better way that's "clean enough" for the spec interpreter to use</p>



<a name="250057784"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/250057784" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#250057784">(Aug 19 2021 at 22:37)</a>:</h4>
<p>I do agree though that we don't really need to do differential-execution against multiple implementations, just one should suffice. If the spec interpreter gets further I think we should remove wasmi, and if v8 gets further we should also remove wasmi</p>



<a name="250057862"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/250057862" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#250057862">(Aug 19 2021 at 22:38)</a>:</h4>
<p>fair concern, I too am vaguely scared of crossing a "PL purist" viewpoint that dismisses this if we try to file an issue without a suggested solution; it might be worth playing a bit more with it (by which I mean, I feel like I might do this, in a bit of free time later) though to see if we can offer a constructive suggestion at the same time</p>



<a name="250057973"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/250057973" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#250057973">(Aug 19 2021 at 22:40)</a>:</h4>
<p>I did find it quite easy to reproduce with the interpreter, the input wasm I have in the issue can be changed to just have a <code>start</code> function and the instantiation clearly takes multiple seconds, and it gets worse by adding more blocks.</p>



<a name="250058011"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/250058011" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#250058011">(Aug 19 2021 at 22:40)</a>:</h4>
<p>jumping ahead a few steps -- in the situation where we get <em>both</em> the spec interpreter to work, and also have your V8 differential fuzzing harness polished and merged -- the question would be: does it make sense to have both? I would argue yes; it's interesting to see if there are disagreements between the spec and the "real world", at least</p>



<a name="250058028"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/250058028" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#250058028">(Aug 19 2021 at 22:41)</a>:</h4>
<p>cool, I will put a bit of time into this later then</p>



<a name="250058040"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/250058040" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#250058040">(Aug 19 2021 at 22:41)</a>:</h4>
<p>nah if the spec interpreter works I don't think v8 is worth it</p>



<a name="250058059"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/250058059" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#250058059">(Aug 19 2021 at 22:41)</a>:</h4>
<p>it's a pretty chonky thing to maintain, even if <code>rusty_v8</code> does the worst parts for us</p>



<a name="250058076"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/250058076" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#250058076">(Aug 19 2021 at 22:41)</a>:</h4>
<p>eh, that's fair, if the complexity/cost is too high</p>



<a name="250058131"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/250058131" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#250058131">(Aug 19 2021 at 22:42)</a>:</h4>
<p>like I won't disagree it's strictly better to have more fuzzing, but for bang-for-our-buck I'm not sure how much we'd get</p>



<a name="250058191"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/250058191" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#250058191">(Aug 19 2021 at 22:43)</a>:</h4>
<p>I'm actually sort of curious how oss-fuzz budgets CPU time if we add more fuzz targets; do we get a fixed quota per target or per project? in any case if we don't need it badly enough then it's not really good citizenship to burn the cycles <em>shrug</em></p>



<a name="250058220"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/250058220" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#250058220">(Aug 19 2021 at 22:43)</a>:</h4>
<p>heh for that I have no idea...</p>



<a name="250058299"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/250058299" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#250058299">(Aug 19 2021 at 22:44)</a>:</h4>
<p>FWIW my take on the spec interpreter is that I think the slowdown is <a href="https://github.com/WebAssembly/spec/blob/ed0f0194b50bafd79bafa6156de7dfaa9572d3f6/interpreter/exec/eval.ml#L165">this line</a> b/c all the other lists/maps in the <code>Block</code> case are constant-time, but I could be wrong and it could be related to <code>Label</code> handling later. Unless the ocaml interpreter does crazy optimizations though <code>List32.length</code> and such functions were also O(n) which was about the time I lost hope for making that fast</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/WebAssembly/spec/blob/ed0f0194b50bafd79bafa6156de7dfaa9572d3f6/interpreter/exec/eval.ml#L165" style="background-image: url(https://opengraph.githubassets.com/337564cbbc50f6f9c78a946732cb18b9f04fdbcf3a791124e5dbd729f0d551c7/WebAssembly/spec)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/WebAssembly/spec/blob/ed0f0194b50bafd79bafa6156de7dfaa9572d3f6/interpreter/exec/eval.ml#L165" title="spec/eval.ml at ed0f0194b50bafd79bafa6156de7dfaa9572d3f6 · WebAssembly/spec">spec/eval.ml at ed0f0194b50bafd79bafa6156de7dfaa9572d3f6 · WebAssembly/spec</a></div><div class="message_embed_description">WebAssembly specification, reference interpreter, and test suite. - spec/eval.ml at ed0f0194b50bafd79bafa6156de7dfaa9572d3f6 · WebAssembly/spec</div></div></div>



<a name="250058333"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/250058333" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#250058333">(Aug 19 2021 at 22:45)</a>:</h4>
<p>yup I was staring at that exact bit too</p>



<a name="250061821"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/250061821" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#250061821">(Aug 19 2021 at 23:36)</a>:</h4>
<p>OK, so here's my understanding of the quadratic behavior: the evaluator step function is designed to step the "configuration" (stack of values, and a list of possibly nested terms that represent remaining instructions) exactly one step, no matter how deep the label stack is. The way that a <code>step</code> works when there are many nested labels on the stack is that we recurse down to the innermost label's instruction list, step its configuration once, then walk back out, rebuilding the nest of <code>Label</code>terms up to the root of the function's configuration.</p>
<p>So we start with a config like:</p>
<ul>
<li><code>Block (Block (Block (Block (Block ... (code)))))</code></li>
</ul>
<p>and this steps to</p>
<ul>
<li>
<p><code>Label l1 (Plain Block (Block ...))</code><br>
then</p>
</li>
<li>
<p><code>Label l1(Label l2 (Plain Block ...))</code></p>
</li>
</ul>
<p>and so on.</p>
<p>However each of the steps must go through 1..n recursive <code>step</code> calls, so we have a total of O(n^2) Ocaml calls and executions of <a href="https://github.com/WebAssembly/spec/blob/ed0f0194b50bafd79bafa6156de7dfaa9572d3f6/interpreter/exec/eval.ml#L500-L501">this</a> bit of code.</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/WebAssembly/spec/blob/ed0f0194b50bafd79bafa6156de7dfaa9572d3f6/interpreter/exec/eval.ml#L500-L501" style="background-image: url(https://opengraph.githubassets.com/337564cbbc50f6f9c78a946732cb18b9f04fdbcf3a791124e5dbd729f0d551c7/WebAssembly/spec)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/WebAssembly/spec/blob/ed0f0194b50bafd79bafa6156de7dfaa9572d3f6/interpreter/exec/eval.ml#L500-L501" title="spec/eval.ml at ed0f0194b50bafd79bafa6156de7dfaa9572d3f6 · WebAssembly/spec">spec/eval.ml at ed0f0194b50bafd79bafa6156de7dfaa9572d3f6 · WebAssembly/spec</a></div><div class="message_embed_description">WebAssembly specification, reference interpreter, and test suite. - spec/eval.ml at ed0f0194b50bafd79bafa6156de7dfaa9572d3f6 · WebAssembly/spec</div></div></div>



<a name="250061859"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/250061859" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#250061859">(Aug 19 2021 at 23:37)</a>:</h4>
<p>This is made worse by the handling of the call stack -- it's just a part of the "configuration" as well, so we'll have <code>Label (Label (Label ... (Frame (Label (Label (Label ... ))))))</code> with <code>1000</code> frames in the 1000-deep-recursion-in-nested-blocks timeout example</p>



<a name="250061950"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/250061950" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#250061950">(Aug 19 2021 at 23:38)</a>:</h4>
<p>the fundamental bit that's expensive is the way that the step walks all the way back out the tree of terms and rebuilds it for each inner step; if the inner step did a step to <em>completion</em> then it would be efficient; but I suspect that would break an "execute for exactly one unit of time so as not to run forever" sort of fuel-limiting mechanism</p>



<a name="250061973"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/250061973" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#250061973">(Aug 19 2021 at 23:39)</a>:</h4>
<p>fixing this <em>might</em> not be so bad if we don't care about that; but I'd want to spend a bit more time understanding it first</p>



<a name="250062066"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/250062066" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#250062066">(Aug 19 2021 at 23:40)</a>:</h4>
<p>(fwiw, <code>perf</code> on the interpreter binary showed ~15% of time in just that one line lined above; and ~50% of time in GC-related code, because of the reallocation on each rebuild of the config)</p>



<a name="250062139"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/250062139" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#250062139">(Aug 19 2021 at 23:41)</a>:</h4>
<p>(I'll summarize this on the github issue for the timeout)</p>



<a name="250066358"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/250066358" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#250066358">(Aug 20 2021 at 00:55)</a>:</h4>
<p>... and I went and did the thing: <a href="https://github.com/cfallin/spec/commit/817f8e84f2fa289723e724553e74d6ce13898ec8">https://github.com/cfallin/spec/commit/817f8e84f2fa289723e724553e74d6ce13898ec8</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/cfallin/spec/commit/817f8e84f2fa289723e724553e74d6ce13898ec8" style="background-image: url(https://opengraph.githubassets.com/0e8dd2cf72e0280f236dd75b5f3fceb398c4416eca39ad81bbf80afbf3cc845a/cfallin/spec/commit/817f8e84f2fa289723e724553e74d6ce13898ec8)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/cfallin/spec/commit/817f8e84f2fa289723e724553e74d6ce13898ec8" title="Fix quadratic behavior in reference interpreter. · cfallin/spec@817f8e8">Fix quadratic behavior in reference interpreter. · cfallin/spec@817f8e8</a></div><div class="message_embed_description">The reference interpreter defines a `step` function on the program
configuration. This configuration embeds the current Wasm callstack and
block (label) stack, representing the state of execution w...</div></div></div>



<a name="250140108"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/250140108" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Brown <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#250140108">(Aug 20 2021 at 16:23)</a>:</h4>
<p>Just catching up on this thread: wow! nice analysis and good fix. What are you thinking between merging upstream vs merging into <a href="https://github.com/bytecodealliance/wasm-spec-mirror">https://github.com/bytecodealliance/wasm-spec-mirror</a>?</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wasm-spec-mirror" style="background-image: url(https://opengraph.githubassets.com/37386ae57d36232f12fd73b3956bae0675d8d6aff59ca64a8cfb4aeaecc0bfd6/bytecodealliance/wasm-spec-mirror)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wasm-spec-mirror" title="GitHub - bytecodealliance/wasm-spec-mirror: Mirror of https://github.com/WebAssembly/spec for fuzzing">GitHub - bytecodealliance/wasm-spec-mirror: Mirror of https://github.com/WebAssembly/spec for fuzzing</a></div><div class="message_embed_description">Mirror of https://github.com/WebAssembly/spec for fuzzing - GitHub - bytecodealliance/wasm-spec-mirror: Mirror of https://github.com/WebAssembly/spec for fuzzing</div></div></div>



<a name="250141482"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/250141482" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#250141482">(Aug 20 2021 at 16:34)</a>:</h4>
<p>So I'm cleaning it up a bit and I'll go ahead and create a PR on <code>spec</code> and see what happens -- at worst it will spawn discussion and help to clarify "very simple theoretically correct interpreter" vs. "actually usable interpreter without quadratic behavior" as a position taken by the folks who maintain it :-)</p>



<a name="250142034"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/250142034" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#250142034">(Aug 20 2021 at 16:39)</a>:</h4>
<p><a href="https://github.com/WebAssembly/spec/pull/1354">https://github.com/WebAssembly/spec/pull/1354</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/WebAssembly/spec/pull/1354" style="background-image: url(https://opengraph.githubassets.com/bb3b5dbbeef33ed418f3900fb6f91e30c07f3073eeacf744bcddefb2534326e0/WebAssembly/spec/pull/1354)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/WebAssembly/spec/pull/1354" title="[interpreter] Fix quadratic behavior when stepping in deeply-nested scopes. by cfallin · Pull Request #1354 · WebAssembly/spec">[interpreter] Fix quadratic behavior when stepping in deeply-nested scopes. by cfallin · Pull Request #1354 · WebAssembly/spec</a></div><div class="message_embed_description">Hi, spec-interpreter maintainers! We&#39;ve found some quadratic
behavior in the spec interpreter -- and I&#39;m curious how palatable
this fix will be. Happy to discuss any alternative approaches ...</div></div></div>



<a name="250142972"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/250142972" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Till Schneidereit <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#250142972">(Aug 20 2021 at 16:48)</a>:</h4>
<p>Indeed, great work on figuring this out and fixing it!</p>
<p>My take is that it's fine for the spec interpreter to be written for readability and maintainability over speed—but not for it to execute code in a way that has a different algorithmic complexity class from what production implementations would be expected to have. ISTM that otherwise it just says next to nothing about implementability of proposals, which seems highly unfortunate. Not sure if that'll be the common view, of course</p>



<a name="250143223"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/250143223" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#250143223">(Aug 20 2021 at 16:50)</a>:</h4>
<p>Hmm, it seems I don't have push access to <code>wasm-spec-mirror</code>, and the GitHub UI is not letting me create a PR on it when I also have an open one on WebAssembly/spec (unless I'm missing a nonobvious button somewhere)</p>



<a name="250143259"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/250143259" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#250143259">(Aug 20 2021 at 16:51)</a>:</h4>
<p><span class="user-mention" data-user-id="234973">@Till Schneidereit</span> or <span class="user-mention" data-user-id="254110">@Andrew Brown</span> could you grant me permissions and I'll just push a branch for now?</p>



<a name="250143319"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/250143319" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#250143319">(Aug 20 2021 at 16:51)</a>:</h4>
<p>... ah, nevermind, I had the wrong base branch selected</p>



<a name="250143441"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/250143441" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Till Schneidereit <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#250143441">(Aug 20 2021 at 16:52)</a>:</h4>
<p>I just added wasmtime-core and cranelift-core as repo maintainers</p>



<a name="250143609"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/250143609" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#250143609">(Aug 20 2021 at 16:54)</a>:</h4>
<p>there we go, PR onto <code>fuzzing</code> branch: <a href="https://github.com/bytecodealliance/wasm-spec-mirror/pull/1">https://github.com/bytecodealliance/wasm-spec-mirror/pull/1</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wasm-spec-mirror/pull/1" style="background-image: url(https://opengraph.githubassets.com/17864e48d9f1c11a89b4a9f014c1fd00c3b650da5790e0ebe62e44ac330253b0/bytecodealliance/wasm-spec-mirror/pull/1)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wasm-spec-mirror/pull/1" title="Fix quadratic behavior in reference interpreter. by cfallin · Pull Request #1 · bytecodealliance/wasm-spec-mirror">Fix quadratic behavior in reference interpreter. by cfallin · Pull Request #1 · bytecodealliance/wasm-spec-mirror</a></div><div class="message_embed_description">This is a merge into our mirror's main branch while we have a pending PR open on the upstream.</div></div></div>



<a name="250145458"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/250145458" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Brown <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#250145458">(Aug 20 2021 at 17:09)</a>:</h4>
<p>Ok, merged... let me create a PR to make sure we pull that branch when fuzzing: <a href="https://github.com/bytecodealliance/wasmtime/pull/3221">https://github.com/bytecodealliance/wasmtime/pull/3221</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wasmtime/pull/3221" style="background-image: url(https://opengraph.githubassets.com/b27c226036e388b8c8fdab88be3f49860a9a96609b071029f2aaf23c3c63f211/bytecodealliance/wasmtime/pull/3221)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wasmtime/pull/3221" title="fuzz: use 'fuzzing' branch of Wasm spec mirror by abrown · Pull Request #3221 · bytecodealliance/wasmtime">fuzz: use 'fuzzing' branch of Wasm spec mirror by abrown · Pull Request #3221 · bytecodealliance/wasmtime</a></div><div class="message_embed_description">With this fix to the WebAssembly spec interpreter, the wasm-spec-interpreter crate needs to retrieve itself from the 'fuzzing' branch.</div></div></div>



<a name="250145498"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/250145498" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#250145498">(Aug 20 2021 at 17:10)</a>:</h4>
<p>Oh, I just did that too, sorry for racing!</p>



<a name="250145575"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/250145575" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Brown <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#250145575">(Aug 20 2021 at 17:10)</a>:</h4>
<p>heh, I should have checked <span aria-label="grinning" class="emoji emoji-1f600" role="img" title="grinning">:grinning:</span></p>



<a name="250145606"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/250145606" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Brown <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#250145606">(Aug 20 2021 at 17:10)</a>:</h4>
<p>lol, well take your pick</p>



<a name="250145668"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/250145668" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Brown <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#250145668">(Aug 20 2021 at 17:11)</a>:</h4>
<p>(I was going to ask you if you were going to do it and then though, "oh, I can just push that real quick")</p>



<a name="250145717"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/250145717" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Brown <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#250145717">(Aug 20 2021 at 17:11)</a>:</h4>
<p>let's use yours since it creates a constant up top</p>



<a name="250145745"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/250145745" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#250145745">(Aug 20 2021 at 17:11)</a>:</h4>
<p>sure, either way :-)</p>



<a name="250792723"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/250792723" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#250792723">(Aug 26 2021 at 15:41)</a>:</h4>
<p><span class="user-mention" data-user-id="254110">@Andrew Brown</span> fyi, it's looking like it probably will not be very feasible to remove the quadratic behavior from the spec interpreter: <a href="https://github.com/WebAssembly/spec/pull/1354">https://github.com/WebAssembly/spec/pull/1354</a> (basically we got an "interpreter should be direct translation of small-step semantics" answer)</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/WebAssembly/spec/pull/1354" style="background-image: url(https://opengraph.githubassets.com/cc33ee4ad1971e9a72abd906046a861f49810e99d7e882b4b7565b9cb72e08f7/WebAssembly/spec/pull/1354)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/WebAssembly/spec/pull/1354" title="[interpreter] Fix quadratic behavior when stepping in deeply-nested scopes. by cfallin · Pull Request #1354 · WebAssembly/spec">[interpreter] Fix quadratic behavior when stepping in deeply-nested scopes. by cfallin · Pull Request #1354 · WebAssembly/spec</a></div><div class="message_embed_description">Hi, spec-interpreter maintainers! We&#39;ve found some quadratic
behavior in the spec interpreter -- and I&#39;m curious how palatable
this fix will be. Happy to discuss any alternative approaches ...</div></div></div>



<a name="250792875"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/250792875" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#250792875">(Aug 26 2021 at 15:42)</a>:</h4>
<p>I had an alternate thought though: we could still potentially use it for <em>individual instruction</em> semantics (for especially SIMD this seems valuable). Would it make sense to tweak wasm-smith to generate very simple programs (e.g. no control flow) and use the infra for that?</p>



<a name="250792876"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/250792876" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Brown <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#250792876">(Aug 26 2021 at 15:42)</a>:</h4>
<p>hm, yeah</p>



<a name="250792911"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/250792911" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Brown <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#250792911">(Aug 26 2021 at 15:42)</a>:</h4>
<p>not a bad idea</p>



<a name="250792963"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/250792963" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#250792963">(Aug 26 2021 at 15:42)</a>:</h4>
<p>that's sort of a separate use-case than fuzzing against a fast interpreter, sort of a breadth vs. depth thing (by running larger programs we get less coverage of e.g. different bit patterns in inputs)</p>



<a name="250793006"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/250793006" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Brown <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#250793006">(Aug 26 2021 at 15:43)</a>:</h4>
<p>an extension on that would be to configure wasm-smith to avoid generating cases that cause the quadratic slowdown</p>



<a name="250793062"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/250793062" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Brown <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#250793062">(Aug 26 2021 at 15:43)</a>:</h4>
<p>what a pain this turned out to be <span aria-label="grinning" class="emoji emoji-1f600" role="img" title="grinning">:grinning:</span></p>



<a name="250793175"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/250793175" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#250793175">(Aug 26 2021 at 15:44)</a>:</h4>
<p>"just fuzz against the spec" they said, "how hard could it be" they said...</p>



<a name="250793232"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/250793232" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#250793232">(Aug 26 2021 at 15:44)</a>:</h4>
<p>I <em>think</em> no cnotrol flow (including no calls) is enough to ensure no quadratic behavior</p>



<a name="250793356"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/250793356" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#250793356">(Aug 26 2021 at 15:45)</a>:</h4>
<p>that's probably pretty easy to add to the configuration trait; any interest on your part in trying this? (I can throw it on my long-term todo list otherwise but my todo list is also growing quadratically)</p>



<a name="250793596"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/250793596" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Brown <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#250793596">(Aug 26 2021 at 15:46)</a>:</h4>
<p>well, I was thinking about taking a look at the v128 stuff before I go on sabbatical here in a few weeks, I could look at it when I do that</p>



<a name="250793739"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/250793739" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#250793739">(Aug 26 2021 at 15:47)</a>:</h4>
<p>awesome!</p>



<a name="250814568"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/fuzzing%20infrastructure/near/250814568" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/fuzzing.20infrastructure.html#250814568">(Aug 26 2021 at 18:04)</a>:</h4>
<p>To close the loop on this -- I created <a href="https://github.com/bytecodealliance/wasmtime/issues/3251">https://github.com/bytecodealliance/wasmtime/issues/3251</a> to track it</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wasmtime/issues/3251" style="background-image: url(https://opengraph.githubassets.com/cc8f8b23674798f0ae49a4c1288b58e3a68b5ab009bfeb391cb2fa8a3118d568/bytecodealliance/wasmtime/issues/3251)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wasmtime/issues/3251" title="Spec-interpreter fuzzing: modify to generate and test single-instruction or no-control-flow cases · Issue #3251 · bytecodealliance/wasmtime">Spec-interpreter fuzzing: modify to generate and test single-instruction or no-control-flow cases · Issue #3251 · bytecodealliance/wasmtime</a></div><div class="message_embed_description">In #3186 we found that the WebAssembly spec interpreter may not be suitable for high-throughput fuzzing because of certain performance characteristics. While we were able to locally patch one sourc...</div></div></div>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>