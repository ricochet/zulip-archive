<html>
<head><meta charset="utf-8"><title>__WIT_BINDGEN_COMPONENT_TYPE USES · wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/index.html">wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/__WIT_BINDGEN_COMPONENT_TYPE.20USES.html">__WIT_BINDGEN_COMPONENT_TYPE USES</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="488175256"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/__WIT_BINDGEN_COMPONENT_TYPE%20USES/near/488175256" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ashanti Mutinta <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/__WIT_BINDGEN_COMPONENT_TYPE.20USES.html#488175256">(Dec 11 2024 at 19:50)</a>:</h4>
<p>Hello, was wondering about the purpose of this? I see there is a link_section attached to it, is it only used for debugging? Thanks!</p>



<a name="488175854"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/__WIT_BINDGEN_COMPONENT_TYPE%20USES/near/488175854" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/__WIT_BINDGEN_COMPONENT_TYPE.20USES.html#488175854">(Dec 11 2024 at 19:54)</a>:</h4>
<p>That array encodes the WIT-level type information that gets encoded in a component. It's not just for debugging; it's a required part of the component encoding.</p>



<a name="488176117"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/__WIT_BINDGEN_COMPONENT_TYPE%20USES/near/488176117" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ashanti Mutinta <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/__WIT_BINDGEN_COMPONENT_TYPE.20USES.html#488176117">(Dec 11 2024 at 19:56)</a>:</h4>
<p>I see! I was upgrading teavm-wit to the latest teavm but I think upstream is missing custom sections. I will create an issue. Thank you!</p>



<a name="488177312"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/__WIT_BINDGEN_COMPONENT_TYPE%20USES/near/488177312" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/__WIT_BINDGEN_COMPONENT_TYPE.20USES.html#488177312">(Dec 11 2024 at 20:03)</a>:</h4>
<p>Yeah, I added support for the component type custom section to my fork of TeaVM, but I don't think that ever made it upstream.</p>



<a name="488177804"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/__WIT_BINDGEN_COMPONENT_TYPE%20USES/near/488177804" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ashanti Mutinta <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/__WIT_BINDGEN_COMPONENT_TYPE.20USES.html#488177804">(Dec 11 2024 at 20:06)</a>:</h4>
<p><span class="user-mention silent" data-user-id="509936">Joel Dice</span> <a href="#narrow/stream/217126-wasmtime/topic/__WIT_BINDGEN_COMPONENT_TYPE.20USES/near/488177312">said</a>:</p>
<blockquote>
<p>Yeah, I added support for the component type custom section to my fork of TeaVM, but I don't think that ever made it upstream.</p>
</blockquote>
<p>Yeah! I ended up also copying over your realloc for my project. I think upstream has a GC target implemented but im not sure if it is in the WASI target as well</p>



<a name="488184809"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/__WIT_BINDGEN_COMPONENT_TYPE%20USES/near/488184809" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/__WIT_BINDGEN_COMPONENT_TYPE.20USES.html#488184809">(Dec 11 2024 at 20:44)</a>:</h4>
<p>Fair warning: it's probably the worst <code>realloc</code> implementation ever written</p>



<a name="488193815"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/__WIT_BINDGEN_COMPONENT_TYPE%20USES/near/488193815" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lann Martin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/__WIT_BINDGEN_COMPONENT_TYPE.20USES.html#488193815">(Dec 11 2024 at 21:41)</a>:</h4>
<p>Challenge accepted:</p>
<div class="codehilite" data-code-language="C"><pre><span></span><code><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="nf">realloc</span><span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">ptr</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">len</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)(</span><span class="n">random</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="o">~</span><span class="mi">3</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>



<a name="488926209"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/__WIT_BINDGEN_COMPONENT_TYPE%20USES/near/488926209" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ashanti Mutinta <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/__WIT_BINDGEN_COMPONENT_TYPE.20USES.html#488926209">(Dec 13 2024 at 21:47)</a>:</h4>
<p><span class="user-mention silent" data-user-id="480579">Lann Martin</span> <a href="#narrow/channel/217126-wasmtime/topic/__WIT_BINDGEN_COMPONENT_TYPE.20USES/near/488193815">said</a>:</p>
<blockquote>
<p>Challenge accepted:</p>
<p><div class="codehilite" data-code-language="C"><pre><span></span><code><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="nf">realloc</span><span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">ptr</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">len</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)(</span><span class="n">random</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="o">~</span><span class="mi">3</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div><br>
</p>
</blockquote>
<p>I raise a realloc that will allocate a page for every byte requested</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">unsafe</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">realloc</span><span class="p">(</span><span class="n">ptr</span><span class="p">:</span><span class="o">*</span><span class="k">mut</span><span class="w"> </span><span class="kt">u8</span><span class="p">,</span><span class="n">new_size</span><span class="p">:</span><span class="kt">usize</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="o">*</span><span class="k">mut</span><span class="w"> </span><span class="kt">u8</span>
<span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">layout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">alloc</span><span class="p">::</span><span class="n">Layout</span><span class="p">::</span><span class="n">from_size_align_unchecked</span><span class="p">(</span><span class="n">new_size</span><span class="p">,</span><span class="w"> </span><span class="mi">65536</span><span class="p">);</span>
<span class="w">    </span><span class="n">std</span><span class="p">::</span><span class="n">alloc</span><span class="p">::</span><span class="n">realloc</span><span class="p">(</span><span class="n">ptr</span><span class="p">,</span><span class="w"> </span><span class="n">layout</span><span class="p">,</span><span class="w"> </span><span class="n">new_size</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>