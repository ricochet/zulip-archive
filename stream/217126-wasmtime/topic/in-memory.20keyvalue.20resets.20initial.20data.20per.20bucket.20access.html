<html>
<head><meta charset="utf-8"><title>in-memory keyvalue resets initial data per bucket access · wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/index.html">wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/in-memory.20keyvalue.20resets.20initial.20data.20per.20bucket.20access.html">in-memory keyvalue resets initial data per bucket access</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="463894910"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/in-memory%20keyvalue%20resets%20initial%20data%20per%20bucket%20access/near/463894910" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mark Fisher <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/in-memory.20keyvalue.20resets.20initial.20data.20per.20bucket.20access.html#463894910">(Aug 20 2024 at 23:57)</a>:</h4>
<p>I was excited to try out the new in-memory keyvalue support today! It did however raise a question, and even though I think it's relatively simple, I apologize if my articulation of it is not:</p>
<p>I have a Component C that imports wasi:keyvalue and exports its own function F that is imported by a cli/run Component. If the run Component invokes F multiple times, I expect a counter to change, but because C must get access to the Bucket via store::open, the data is reset to the initial state per invocation. That happens because a new Bucket struct is not just accessed, but (re)created <a href="https://github.com/bytecodealliance/wasmtime/blob/main/crates/wasi-keyvalue/src/lib.rs#L165">here</a>. Is this the intended behavior, or should the in-memory state be scoped with the lifecycle of <code>wasmtime run</code> itself?</p>
<p>I guess this also raises a question as to the meaning of "identifier" since an empty-string is being used to indicate "in-memory" which is more like an identifier for the backing provider of a store. I would expect that identifier would map to a named Bucket and within a store there could be multiple Buckets. As the wasi:keyvalue <a href="https://github.com/WebAssembly/wasi-keyvalue/blob/main/wit/store.wit#L59">wit spec</a> mentions, the exact mapping of Bucket will vary across different backing providers.</p>
<p>Thanks!</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wasmtime/blob/main/crates/wasi-keyvalue/src/lib.rs#L165" style="background-image: url(&quot;https://uploads.zulipusercontent.net/ea625bbeaa253477238809c679c57baf86c9f9bc/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f656439393730323566316331633034303633366238336133396664393062653764326366356166393831396638303634656664666662666532333835316332662f62797465636f6465616c6c69616e63652f7761736d74696d65&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wasmtime/blob/main/crates/wasi-keyvalue/src/lib.rs#L165" title="wasmtime/crates/wasi-keyvalue/src/lib.rs at main · bytecodealliance/wasmtime">wasmtime/crates/wasi-keyvalue/src/lib.rs at main · bytecodealliance/wasmtime</a></div><div class="message_embed_description">A fast and secure runtime for WebAssembly. Contribute to bytecodealliance/wasmtime development by creating an account on GitHub.</div></div></div><div class="message_embed"><a class="message_embed_image" href="https://github.com/WebAssembly/wasi-keyvalue/blob/main/wit/store.wit#L59" style="background-image: url(&quot;https://uploads.zulipusercontent.net/0cc2b30d95105ce49f150bca736d871700ce5bc3/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f316662363165656234396334333737663830356439373662613832643430373335386139356239356462613231333634396539393538393562316430613731342f576562417373656d626c792f776173692d6b657976616c7565&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/WebAssembly/wasi-keyvalue/blob/main/wit/store.wit#L59" title="wasi-keyvalue/wit/store.wit at main · WebAssembly/wasi-keyvalue">wasi-keyvalue/wit/store.wit at main · WebAssembly/wasi-keyvalue</a></div><div class="message_embed_description">Contribute to WebAssembly/wasi-keyvalue development by creating an account on GitHub.</div></div></div>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>