<html>
<head><meta charset="utf-8"><title>✔ how to write a data transformer using wasm? · wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/index.html">wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20how.20to.20write.20a.20data.20transformer.20using.20wasm.3F.html">✔ how to write a data transformer using wasm?</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="456040463"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20how%20to%20write%20a%20data%20transformer%20using%20wasm%3F/near/456040463" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bo Liu <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20how.20to.20write.20a.20data.20transformer.20using.20wasm.3F.html#456040463">(Aug 02 2024 at 20:53)</a>:</h4>
<p>Hi there,<br>
I've been trying to write a data transformer function which takes string as input and outputs a f32 in a wasm.<br>
Also, I want to use wasmtime crate to have this wasm function run inside a wasmtime module/sandbox.</p>
<p>I've been using wit-bindgen to generate the necessary bindings and export a function parse_cost() and parse_unit(), </p>
<div class="codehilite" data-code-language="#"><pre><span></span><code>mod bindings;

use bindings::exports::component::parser::parse::Guest;

struct Component;

impl Guest for Component {
    fn parse_cost(cost: String) -&gt; f32 {
        cost.parse().unwrap_or(0.0)
    }

    fn parse_unit(unit: String) -&gt; f32 {
        unit.parse().unwrap_or(0.0)
    }
}

bindings::export!(Component with_types_in bindings);
</code></pre></div>
<p>however, when using get_typed_func(), the compile complained about <code>required for </code>std:<span aria-label="string" class="emoji emoji-1f9f5" role="img" title="string">:string:</span>:String<code> to implement </code>WasmParams``</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span><span class="w"> </span><span class="nf">parse_cost</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">func_id</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="kt">str</span><span class="p">,</span><span class="w"> </span><span class="n">cost</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="kt">str</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Result</span><span class="o">&lt;</span><span class="kt">f32</span><span class="p">,</span><span class="w"> </span><span class="nb">String</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">guard</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">modules</span><span class="p">.</span><span class="n">lock</span><span class="p">().</span><span class="n">unwrap</span><span class="p">();</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">guard</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">func_id</span><span class="p">).</span><span class="n">ok_or</span><span class="p">(</span><span class="s">"Module not found"</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>

<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">store</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Store</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">.</span><span class="n">engine</span><span class="p">,</span><span class="w"> </span><span class="p">());</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">instance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Instance</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store</span><span class="p">,</span><span class="w"> </span><span class="n">module</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[]).</span><span class="n">unwrap</span><span class="p">();</span>

<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">parse_cost</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">instance</span><span class="p">.</span><span class="n">get_typed_func</span><span class="p">::</span><span class="o">&lt;</span><span class="p">(</span><span class="nb">String</span><span class="p">),</span><span class="w"> </span><span class="kt">f32</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store</span><span class="p">,</span><span class="w"> </span><span class="s">"parse_cost"</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span>

<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parse_cost</span><span class="p">.</span><span class="n">call</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store</span><span class="p">,</span><span class="w"> </span><span class="n">cost</span><span class="p">.</span><span class="n">to_string</span><span class="p">()).</span><span class="n">map_err</span><span class="p">(</span><span class="o">|</span><span class="n">e</span><span class="o">|</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">to_string</span><span class="p">())</span><span class="o">?</span><span class="p">;</span>

<span class="w">        </span><span class="nb">Ok</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
</code></pre></div>
<p>Before this, I figured out a way to manually allocate memory and convert string to {ptr, len}, it worked but it was not perfect, I was hoping wit-bindgen could help me avoid this manual efforts, now I wonder if it is possible?</p>
<p>thanks in advance.</p>



<a name="456044438"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20how%20to%20write%20a%20data%20transformer%20using%20wasm%3F/near/456044438" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20how.20to.20write.20a.20data.20transformer.20using.20wasm.3F.html#456044438">(Aug 02 2024 at 21:27)</a>:</h4>
<p>Try changing <code>(String)</code> to <code>(String,)</code> in the host code.</p>



<a name="456044536"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20how%20to%20write%20a%20data%20transformer%20using%20wasm%3F/near/456044536" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20how.20to.20write.20a.20data.20transformer.20using.20wasm.3F.html#456044536">(Aug 02 2024 at 21:28)</a>:</h4>
<p>Also, consider using the <code>wasmtime::component::bindgen</code> macro, which will make the host side easier.</p>



<a name="456047617"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20how%20to%20write%20a%20data%20transformer%20using%20wasm%3F/near/456047617" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bo Liu <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20how.20to.20write.20a.20data.20transformer.20using.20wasm.3F.html#456047617">(Aug 02 2024 at 21:45)</a>:</h4>
<p><span class="user-mention" data-user-id="509936">@Joel Dice</span> thanks for the suggestion, seems not work, either.</p>
<div class="codehilite" data-code-language="34"><pre><span></span><code>    |                                   --------------   ^^^^^^^^^ the trait `WasmParams` is not implemented for `(std::string::String,)`
    |                                   |
    |                                   required by a bound introduced by this call
</code></pre></div>



<a name="456050105"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20how%20to%20write%20a%20data%20transformer%20using%20wasm%3F/near/456050105" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20how.20to.20write.20a.20data.20transformer.20using.20wasm.3F.html#456050105">(Aug 02 2024 at 21:57)</a>:</h4>
<p>Oops, I see -- you're using the Wasmtime module API rather than the component API.  You'll need to convert your module into a component using e.g. <code>wasm-tools component new</code> or else use <code>cargo-component</code> to build it.  Then, in the host, you'll need to use the <code>wasmtime::component</code> api to instantiate the component.</p>



<a name="456050254"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20how%20to%20write%20a%20data%20transformer%20using%20wasm%3F/near/456050254" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20how.20to.20write.20a.20data.20transformer.20using.20wasm.3F.html#456050254">(Aug 02 2024 at 21:58)</a>:</h4>
<p>This might be helpful: <a href="https://component-model.bytecodealliance.org/">https://component-model.bytecodealliance.org/</a></p>



<a name="456051726"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20how%20to%20write%20a%20data%20transformer%20using%20wasm%3F/near/456051726" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bo Liu <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20how.20to.20write.20a.20data.20transformer.20using.20wasm.3F.html#456051726">(Aug 02 2024 at 22:13)</a>:</h4>
<p><span class="user-mention" data-user-id="509936">@Joel Dice</span> <br>
Hmm, still confused as I'm new to wasm.</p>
<p>so what I am doing is to write a grpc server and in this grpc server process, host a few wasm functions by wasm sandboxes, each function in one wasmtime sandbox, would wasmtime::component be able to support the sandbox?</p>



<a name="456052605"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20how%20to%20write%20a%20data%20transformer%20using%20wasm%3F/near/456052605" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20how.20to.20write.20a.20data.20transformer.20using.20wasm.3F.html#456052605">(Aug 02 2024 at 22:23)</a>:</h4>
<p>Yes, components are run with the same isolation guarantees as modules are.</p>



<a name="456053572"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20how%20to%20write%20a%20data%20transformer%20using%20wasm%3F/near/456053572" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bo Liu <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20how.20to.20write.20a.20data.20transformer.20using.20wasm.3F.html#456053572">(Aug 02 2024 at 22:33)</a>:</h4>
<p>Just to confirm, is <code>wasmtime::component::Linker</code> what you referred to?</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">parse_cost</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">func_id</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="kt">str</span><span class="p">,</span><span class="w"> </span><span class="n">cost</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="kt">str</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Result</span><span class="o">&lt;</span><span class="kt">f32</span><span class="p">,</span><span class="w"> </span><span class="nb">String</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">guard</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">modules</span><span class="p">.</span><span class="n">lock</span><span class="p">().</span><span class="n">unwrap</span><span class="p">();</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">guard</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">func_id</span><span class="p">).</span><span class="n">ok_or</span><span class="p">(</span><span class="s">"Module not found"</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>

<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">linker</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Linker</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">.</span><span class="n">engine</span><span class="p">);</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">instance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">linker</span><span class="p">.</span><span class="n">instantiate</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">component</span><span class="p">).</span><span class="n">map_err</span><span class="p">(</span><span class="o">|</span><span class="n">e</span><span class="o">|</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">to_string</span><span class="p">())</span><span class="o">?</span><span class="p">;</span>

<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">func</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">instance</span><span class="p">.</span><span class="n">get_func</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store</span><span class="p">,</span><span class="w"> </span><span class="s">"parse_cost"</span><span class="p">).</span><span class="n">ok_or</span><span class="p">(</span><span class="s">"Function not found"</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">Val</span><span class="p">::</span><span class="n">F32</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)];</span>
<span class="w">        </span><span class="n">func</span><span class="p">.</span><span class="n">call</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[</span><span class="n">Val</span><span class="p">::</span><span class="nb">String</span><span class="p">(</span><span class="n">cost</span><span class="p">.</span><span class="n">to_string</span><span class="p">()),</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">result</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>

<span class="w">        </span><span class="nb">Ok</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="w">    </span><span class="p">}</span>
</code></pre></div>



<a name="456054045"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20how%20to%20write%20a%20data%20transformer%20using%20wasm%3F/near/456054045" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20how.20to.20write.20a.20data.20transformer.20using.20wasm.3F.html#456054045">(Aug 02 2024 at 22:39)</a>:</h4>
<p>Yes, but keep in mind you'll need to give it a Wasm component -- not a module -- or it will fail at runtime.</p>



<a name="456054196"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20how%20to%20write%20a%20data%20transformer%20using%20wasm%3F/near/456054196" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20how.20to.20write.20a.20data.20transformer.20using.20wasm.3F.html#456054196">(Aug 02 2024 at 22:41)</a>:</h4>
<p>Also, you should be able to use e.g. <a href="https://docs.rs/wasmtime/23.0.1/wasmtime/component/struct.Instance.html#method.get_typed_func">https://docs.rs/wasmtime/23.0.1/wasmtime/component/struct.Instance.html#method.get_typed_func</a> with <code>(String,)</code> as the parameter type.</p>



<a name="456054221"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20how%20to%20write%20a%20data%20transformer%20using%20wasm%3F/near/456054221" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20how.20to.20write.20a.20data.20transformer.20using.20wasm.3F.html#456054221">(Aug 02 2024 at 22:41)</a>:</h4>
<p>Or better yet, <a href="https://docs.rs/wasmtime/23.0.1/wasmtime/component/macro.bindgen.html">https://docs.rs/wasmtime/23.0.1/wasmtime/component/macro.bindgen.html</a></p>



<a name="456054294"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20how%20to%20write%20a%20data%20transformer%20using%20wasm%3F/near/456054294" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bo Liu <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20how.20to.20write.20a.20data.20transformer.20using.20wasm.3F.html#456054294">(Aug 02 2024 at 22:42)</a>:</h4>
<p>for wasm component, I've created a .wit file , and use <code>cargo component build --target wasm32-wasip1 --release</code>,  I assume it will give me a component back, right?</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">package</span><span class="w"> </span><span class="n">component</span><span class="p">:</span><span class="nc">parser</span><span class="p">;</span>

<span class="n">interface</span><span class="w"> </span><span class="n">parse</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">parse</span><span class="o">-</span><span class="n">cost</span><span class="p">:</span><span class="w"> </span><span class="nc">func</span><span class="p">(</span><span class="n">cost</span><span class="p">:</span><span class="w"> </span><span class="nc">string</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="kt">f32</span><span class="p">;</span>
<span class="w">    </span><span class="n">parse</span><span class="o">-</span><span class="n">unit</span><span class="p">:</span><span class="w"> </span><span class="nc">func</span><span class="p">(</span><span class="n">unit</span><span class="p">:</span><span class="w"> </span><span class="nc">string</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="kt">f32</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">world</span><span class="w"> </span><span class="n">parser</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">export</span><span class="w"> </span><span class="n">parse</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>



<a name="456054329"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20how%20to%20write%20a%20data%20transformer%20using%20wasm%3F/near/456054329" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20how.20to.20write.20a.20data.20transformer.20using.20wasm.3F.html#456054329">(Aug 02 2024 at 22:42)</a>:</h4>
<p>I think so, yes.  I haven't used <code>cargo component</code> for a while, but that's what it's made for.</p>



<a name="456054384"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20how%20to%20write%20a%20data%20transformer%20using%20wasm%3F/near/456054384" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20how.20to.20write.20a.20data.20transformer.20using.20wasm.3F.html#456054384">(Aug 02 2024 at 22:43)</a>:</h4>
<p>I'm guessing you don't need to specify <code>--target</code> when using <code>cargo component</code></p>



<a name="456054402"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20how%20to%20write%20a%20data%20transformer%20using%20wasm%3F/near/456054402" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bo Liu <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20how.20to.20write.20a.20data.20transformer.20using.20wasm.3F.html#456054402">(Aug 02 2024 at 22:43)</a>:</h4>
<p><span class="user-mention silent" data-user-id="509936">Joel Dice</span> <a href="#narrow/stream/217126-wasmtime/topic/how.20to.20write.20a.20data.20transformer.20using.20wasm.3F/near/456054221">said</a>:</p>
<blockquote>
<p>Or better yet, <a href="https://docs.rs/wasmtime/23.0.1/wasmtime/component/macro.bindgen.html">https://docs.rs/wasmtime/23.0.1/wasmtime/component/macro.bindgen.html</a></p>
</blockquote>
<p>by looking at its example, I'm confused where are the definition of exported functions</p>



<a name="456054673"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20how%20to%20write%20a%20data%20transformer%20using%20wasm%3F/near/456054673" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bo Liu <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20how.20to.20write.20a.20data.20transformer.20using.20wasm.3F.html#456054673">(Aug 02 2024 at 22:46)</a>:</h4>
<p><span class="user-mention silent" data-user-id="509936">Joel Dice</span> <a href="#narrow/stream/217126-wasmtime/topic/how.20to.20write.20a.20data.20transformer.20using.20wasm.3F/near/456054384">said</a>:</p>
<blockquote>
<p>I'm guessing you don't need to specify <code>--target</code> when using <code>cargo component</code></p>
</blockquote>
<p>Yes, that's true</p>



<a name="456054682"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20how%20to%20write%20a%20data%20transformer%20using%20wasm%3F/near/456054682" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20how.20to.20write.20a.20data.20transformer.20using.20wasm.3F.html#456054682">(Aug 02 2024 at 22:46)</a>:</h4>
<p>You can use e.g. <code>cargo-expand</code> to see the code generated by that macro.  This example might be helpful, also: <a href="https://docs.rs/wasmtime/23.0.1/wasmtime/component/bindgen_examples/_5_all_world_export_kinds/index.html">https://docs.rs/wasmtime/23.0.1/wasmtime/component/bindgen_examples/_5_all_world_export_kinds/index.html</a></p>



<a name="456055218"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20how%20to%20write%20a%20data%20transformer%20using%20wasm%3F/near/456055218" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bo Liu <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20how.20to.20write.20a.20data.20transformer.20using.20wasm.3F.html#456055218">(Aug 02 2024 at 22:53)</a>:</h4>
<p><span class="user-mention silent" data-user-id="509936">Joel Dice</span> <a href="#narrow/stream/217126-wasmtime/topic/how.20to.20write.20a.20data.20transformer.20using.20wasm.3F/near/456054196">said</a>:</p>
<blockquote>
<p>Also, you should be able</p>
</blockquote>
<p>Does <code>(String,)</code> refer to (<code>Val::String</code>,)?</p>



<a name="456055243"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20how%20to%20write%20a%20data%20transformer%20using%20wasm%3F/near/456055243" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20how.20to.20write.20a.20data.20transformer.20using.20wasm.3F.html#456055243">(Aug 02 2024 at 22:53)</a>:</h4>
<p>no, <code>(std::string::String,)</code></p>



<a name="456055326"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20how%20to%20write%20a%20data%20transformer%20using%20wasm%3F/near/456055326" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20how.20to.20write.20a.20data.20transformer.20using.20wasm.3F.html#456055326">(Aug 02 2024 at 22:54)</a>:</h4>
<p><code>Val</code> is only used for the dynamic (i.e. slower, not-statically-type-checked) API</p>



<a name="456055368"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20how%20to%20write%20a%20data%20transformer%20using%20wasm%3F/near/456055368" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20how.20to.20write.20a.20data.20transformer.20using.20wasm.3F.html#456055368">(Aug 02 2024 at 22:55)</a>:</h4>
<p>you should use <code>get_typed_func</code> if you know the types at compile time</p>



<a name="456055373"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20how%20to%20write%20a%20data%20transformer%20using%20wasm%3F/near/456055373" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20how.20to.20write.20a.20data.20transformer.20using.20wasm.3F.html#456055373">(Aug 02 2024 at 22:55)</a>:</h4>
<p>and that's what <code>wasmtime::component::bindgen</code> uses in its generated code</p>



<a name="456056241"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20how%20to%20write%20a%20data%20transformer%20using%20wasm%3F/near/456056241" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bo Liu <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20how.20to.20write.20a.20data.20transformer.20using.20wasm.3F.html#456056241">(Aug 02 2024 at 23:04)</a>:</h4>
<p>I guess for result, (f32,) is also needed?</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">error</span><span class="p">[</span><span class="n">E0277</span><span class="p">]:</span><span class="w"> </span><span class="nc">the</span><span class="w"> </span><span class="k">trait</span><span class="w"> </span><span class="n">bound</span><span class="w"> </span><span class="err">`</span><span class="kt">f32</span><span class="p">:</span><span class="w"> </span><span class="nc">ComponentNamedList</span><span class="err">`</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">satisfied</span>
<span class="w">   </span><span class="o">-</span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">src</span><span class="o">/</span><span class="n">server</span><span class="p">.</span><span class="n">rs</span><span class="p">:</span><span class="mi">36</span><span class="p">:</span><span class="mi">57</span>
<span class="w">    </span><span class="o">|</span>
<span class="mi">36</span><span class="w">  </span><span class="o">|</span><span class="w">         </span><span class="kd">let</span><span class="w"> </span><span class="n">func</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">instance</span><span class="p">.</span><span class="n">get_typed_func</span><span class="p">::</span><span class="o">&lt;</span><span class="p">(</span><span class="nb">String</span><span class="p">,),</span><span class="w"> </span><span class="kt">f32</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store</span><span class="p">,</span><span class="w"> </span><span class="s">"parse_cost"</span><span class="p">).</span><span class="n">map_err</span><span class="p">(</span><span class="o">|</span><span class="n">e</span><span class="o">|</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">to_string</span><span class="p">())</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="o">|</span><span class="w">                             </span><span class="o">--------------</span><span class="w">              </span><span class="o">^^^</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">trait</span><span class="w"> </span><span class="err">`</span><span class="n">ComponentNamedList</span><span class="err">`</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">implemented</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="err">`</span><span class="kt">f32</span><span class="err">`</span>
</code></pre></div>



<a name="456056327"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20how%20to%20write%20a%20data%20transformer%20using%20wasm%3F/near/456056327" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20how.20to.20write.20a.20data.20transformer.20using.20wasm.3F.html#456056327">(Aug 02 2024 at 23:05)</a>:</h4>
<p>Maybe so -- it's been a while since I used that API directly instead of using the <code>bindgen</code> macro</p>



<a name="456057148"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20how%20to%20write%20a%20data%20transformer%20using%20wasm%3F/near/456057148" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bo Liu <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20how.20to.20write.20a.20data.20transformer.20using.20wasm.3F.html#456057148">(Aug 02 2024 at 23:12)</a>:</h4>
<p>ok, let me also try bindgen macro directly</p>



<a name="456058854"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20how%20to%20write%20a%20data%20transformer%20using%20wasm%3F/near/456058854" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bo Liu <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20how.20to.20write.20a.20data.20transformer.20using.20wasm.3F.html#456058854">(Aug 02 2024 at 23:30)</a>:</h4>
<p><span class="user-mention silent" data-user-id="509936">Joel Dice</span> <a href="#narrow/stream/217126-wasmtime/topic/how.20to.20write.20a.20data.20transformer.20using.20wasm.3F/near/456054682">said</a>:</p>
<blockquote>
<p>You can use e.g. <code>cargo-expand</code> to see the code generated by that macro.  This example might be helpful, also: <a href="https://docs.rs/wasmtime/23.0.1/wasmtime/component/bindgen_examples/_5_all_world_export_kinds/index.html">https://docs.rs/wasmtime/23.0.1/wasmtime/component/bindgen_examples/_5_all_world_export_kinds/index.html</a></p>
</blockquote>
<p>quick question, if one wants to implement <code>bytes-to-string</code> differently, like</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="fm">format!</span><span class="p">(</span><span class="s">"hello {}"</span><span class="p">,</span><span class="w"> </span><span class="n">bytes</span><span class="p">)</span>
</code></pre></div>
<p>where should we put the customization?</p>



<a name="456059204"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20how%20to%20write%20a%20data%20transformer%20using%20wasm%3F/near/456059204" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20how.20to.20write.20a.20data.20transformer.20using.20wasm.3F.html#456059204">(Aug 02 2024 at 23:34)</a>:</h4>
<p>You're refering to the code in the example?  Are you wanting to modify the example for some reason?  Or are you trying to translate what the example does to your use case and WIT world?  I'm not quite understanding the question.</p>



<a name="456060609"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20how%20to%20write%20a%20data%20transformer%20using%20wasm%3F/near/456060609" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bo Liu <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20how.20to.20write.20a.20data.20transformer.20using.20wasm.3F.html#456060609">(Aug 02 2024 at 23:50)</a>:</h4>
<p>sure, I want to have a better understanding of bindgen!(), by using cargo expand, I did see the function definition, </p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">                        </span><span class="kd">let</span><span class="w"> </span><span class="n">callee</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">unsafe</span><span class="w"> </span><span class="p">{</span>
<span class="w">                            </span><span class="n">wasmtime</span><span class="p">::</span><span class="n">component</span><span class="p">::</span><span class="n">TypedFunc</span><span class="p">::</span><span class="o">&lt;</span>
<span class="w">                                </span><span class="p">(</span><span class="kt">u64</span><span class="p">,),</span>
<span class="w">                                </span><span class="p">(</span><span class="n">wasmtime</span><span class="p">::</span><span class="n">component</span><span class="p">::</span><span class="n">__internal</span><span class="p">::</span><span class="nb">String</span><span class="p">,),</span>
<span class="w">                            </span><span class="o">&gt;</span><span class="p">::</span><span class="n">new_unchecked</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">bytes_to_string</span><span class="p">)</span>
</code></pre></div>
<p>but it's not clear to me where is bytes_to_string defined,</p>
<p>IOW, if we want to use a different implementation for bytes_to_string() in the 5_all_world_export example, can you please suggest how to do it?</p>



<a name="456060760"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20how%20to%20write%20a%20data%20transformer%20using%20wasm%3F/near/456060760" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20how.20to.20write.20a.20data.20transformer.20using.20wasm.3F.html#456060760">(Aug 02 2024 at 23:52)</a>:</h4>
<p>The <code>bytes_to_string</code> function is implemented in the component in that example.  The host is calling a function that the component exports.</p>



<a name="456061786"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20how%20to%20write%20a%20data%20transformer%20using%20wasm%3F/near/456061786" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bo Liu <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20how.20to.20write.20a.20data.20transformer.20using.20wasm.3F.html#456061786">(Aug 03 2024 at 00:04)</a>:</h4>
<p>Thank you!</p>
<p>I see, it's using function from <br>
<code>let component = Component::from_file(&amp;engine, "./your-component.wasm")?;</code><br>
where <code>bytes-to-string</code> is defined.<br>
somehow I've been missing this line over and over again.</p>



<a name="456690865"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20how%20to%20write%20a%20data%20transformer%20using%20wasm%3F/near/456690865" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bo Liu <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20how.20to.20write.20a.20data.20transformer.20using.20wasm.3F.html#456690865">(Aug 05 2024 at 19:51)</a>:</h4>
<p>Hello, <br>
Following this thread, I was wondering if wit can support references, say if I want to pass a json vec, besides in world.wit I can use list&lt;u8&gt;,  which is interpreted into Vec&lt;u8&gt; after bindgen, is it possible to have &amp;[u8] which holds a pointer from host?</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">package</span><span class="w"> </span><span class="n">component</span><span class="p">:</span><span class="nc">parser</span><span class="p">;</span>

<span class="n">world</span><span class="w"> </span><span class="n">parse</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">export</span><span class="w"> </span><span class="n">parse</span><span class="p">:</span><span class="w"> </span><span class="nc">func</span><span class="p">(</span><span class="n">payload</span><span class="p">:</span><span class="w"> </span><span class="nc">list</span><span class="o">&lt;</span><span class="kt">u8</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">list</span><span class="o">&lt;</span><span class="kt">u8</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>



<a name="456692266"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20how%20to%20write%20a%20data%20transformer%20using%20wasm%3F/near/456692266" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20how.20to.20write.20a.20data.20transformer.20using.20wasm.3F.html#456692266">(Aug 05 2024 at 19:57)</a>:</h4>
<p>Nope, the component needs to have the list copied into its own linear memory- wasm can’t express a pointer into something that’s not a memory, and components need to instantiate their own memory, not import it from the host, to make sure they can be composed with other components</p>



<a name="456692945"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20how%20to%20write%20a%20data%20transformer%20using%20wasm%3F/near/456692945" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bo Liu <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20how.20to.20write.20a.20data.20transformer.20using.20wasm.3F.html#456692945">(Aug 05 2024 at 20:00)</a>:</h4>
<p><span class="user-mention silent" data-user-id="253992">Pat Hickey</span> <a href="#narrow/stream/217126-wasmtime/topic/how.20to.20write.20a.20data.20transformer.20using.20wasm.3F/near/456692266">said</a>:</p>
<blockquote>
<p>Nope, the component needs to have the list copied into its own linear memory- wasm can’t express a pointer into something that’s not a memory, and components need to instantiate their own memory, not import it from the host, to make sure they can be composed with other components</p>
</blockquote>
<p>Thanks!<br>
So in this case can you please suggest what is the idiomatic way to represent binary bytes of json in wit?</p>



<a name="456695359"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20how%20to%20write%20a%20data%20transformer%20using%20wasm%3F/near/456695359" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ramon Klass <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20how.20to.20write.20a.20data.20transformer.20using.20wasm.3F.html#456695359">(Aug 05 2024 at 20:10)</a>:</h4>
<p>json has no notion of bytes or binary, if you want to transport serialized json, you'd probably use string, if you have something that contains an u8[] buffer then json is simply not able to handle this. If it has to be json, people use base64, but I would suggest something like messagepack that can serialize arrays of bytes directly</p>



<a name="456698679"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20how%20to%20write%20a%20data%20transformer%20using%20wasm%3F/near/456698679" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bo Liu <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20how.20to.20write.20a.20data.20transformer.20using.20wasm.3F.html#456698679">(Aug 05 2024 at 20:26)</a>:</h4>
<p>sounds good, I'm going to explore more with base64</p>



<a name="456708219"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20how%20to%20write%20a%20data%20transformer%20using%20wasm%3F/near/456708219" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20how.20to.20write.20a.20data.20transformer.20using.20wasm.3F.html#456708219">(Aug 05 2024 at 21:11)</a>:</h4>
<p>json is a string so you can just use the string type, you dont have to use base64</p>



<a name="456723244"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20how%20to%20write%20a%20data%20transformer%20using%20wasm%3F/near/456723244" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ramon Klass <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20how.20to.20write.20a.20data.20transformer.20using.20wasm.3F.html#456723244">(Aug 05 2024 at 22:56)</a>:</h4>
<p>what I meant is: if your data contains a Uint8Array, you can't toJson it, but if that's not the case use string :)</p>



<a name="456724077"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20how%20to%20write%20a%20data%20transformer%20using%20wasm%3F/near/456724077" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bo Liu <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20how.20to.20write.20a.20data.20transformer.20using.20wasm.3F.html#456724077">(Aug 05 2024 at 23:03)</a>:</h4>
<p><span class="user-mention silent" data-user-id="550770">Ramon Klass</span> <a href="#narrow/stream/217126-wasmtime/topic/how.20to.20write.20a.20data.20transformer.20using.20wasm.3F/near/456723244">said</a>:</p>
<blockquote>
<p>what I meant is: if your data contains a Uint8Array, you can't toJson it, but if that's not the case use string :)</p>
</blockquote>
<p>Right, I want to reduce json size during the transportation, and I'm using a <a href="https://docs.rs/serde_json/1.0.122/serde_json/fn.to_vec.html">https://docs.rs/serde_json/1.0.122/serde_json/fn.to_vec.html#</a> instead of to_string(), so on wasm guest, I'll have to use list&lt;u8&gt; to serve json's Vec&lt;u8&gt;</p>



<a name="456725420"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20how%20to%20write%20a%20data%20transformer%20using%20wasm%3F/near/456725420" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20how.20to.20write.20a.20data.20transformer.20using.20wasm.3F.html#456725420">(Aug 05 2024 at 23:14)</a>:</h4>
<p>the size during transportation wont be changed by using to_vec instead of to_string, the underlying representation is the same, string is just asserting with the rust type system that the vec contents are utf-8 encoded, but json guarantees that anyway</p>



<a name="456725633"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20how%20to%20write%20a%20data%20transformer%20using%20wasm%3F/near/456725633" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bo Liu <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20how.20to.20write.20a.20data.20transformer.20using.20wasm.3F.html#456725633">(Aug 05 2024 at 23:16)</a>:</h4>
<p>I see, thank you for the clarification.</p>



<a name="456728511"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20how%20to%20write%20a%20data%20transformer%20using%20wasm%3F/near/456728511" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ramon Klass <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20how.20to.20write.20a.20data.20transformer.20using.20wasm.3F.html#456728511">(Aug 05 2024 at 23:42)</a>:</h4>
<p>again, several binary formats would be smaller if payload size if a concern</p>



<a name="462405136"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20how%20to%20write%20a%20data%20transformer%20using%20wasm%3F/near/462405136" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bo Liu <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20how.20to.20write.20a.20data.20transformer.20using.20wasm.3F.html#462405136">(Aug 14 2024 at 19:24)</a>:</h4>
<p>Hi, for the same wit file, I'm playing with python wasm support, however, it kept reporting <code>TypeError: Can't instantiate abstract class Parse without an implementation for abstract method 'parse'</code> while I did follow <a href="https://component-model.bytecodealliance.org/language-support/python.html">https://component-model.bytecodealliance.org/language-support/python.html</a></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">#</span><span class="w"> </span><span class="n">cat</span><span class="w"> </span><span class="n">wit</span><span class="o">/</span><span class="n">world</span><span class="p">.</span><span class="n">wit</span>
<span class="n">package</span><span class="w"> </span><span class="n">component</span><span class="p">:</span><span class="nc">parser</span><span class="p">;</span>

<span class="n">world</span><span class="w"> </span><span class="n">parse</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">export</span><span class="w"> </span><span class="n">parse</span><span class="p">:</span><span class="w"> </span><span class="nc">func</span><span class="p">(</span><span class="n">payload</span><span class="p">:</span><span class="w"> </span><span class="nc">list</span><span class="o">&lt;</span><span class="kt">u8</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">list</span><span class="o">&lt;</span><span class="kt">u8</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">#</span><span class="w"> </span><span class="n">cat</span><span class="w"> </span><span class="n">src</span><span class="o">/</span><span class="n">lib</span><span class="p">.</span><span class="n">py</span>
<span class="n">import</span><span class="w"> </span><span class="n">parser</span>

<span class="n">class</span><span class="w"> </span><span class="n">Parse</span><span class="p">(</span><span class="n">parser</span><span class="p">.</span><span class="n">Parse</span><span class="p">):</span>
<span class="w">    </span><span class="nc">def</span><span class="w"> </span><span class="n">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">payload</span><span class="p">:</span><span class="w"> </span><span class="nc">bytes</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">bytes</span><span class="p">:</span>
<span class="w">        </span><span class="p">#</span><span class="w"> </span><span class="n">todo</span><span class="p">:</span><span class="w"> </span><span class="nc">implement</span><span class="w"> </span><span class="n">parsing</span><span class="w"> </span><span class="n">logic</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">payload</span>
</code></pre></div>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">#</span><span class="w"> </span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">wasm</span><span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">venv</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">componentize</span><span class="o">-</span><span class="n">py</span><span class="w"> </span><span class="o">-</span><span class="n">d</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">wit</span><span class="o">/</span><span class="n">world</span><span class="p">.</span><span class="n">wit</span><span class="w"> </span><span class="o">-</span><span class="n">w</span><span class="w"> </span><span class="n">parse</span><span class="w"> </span><span class="n">componentize</span><span class="w"> </span><span class="o">-</span><span class="n">p</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">src</span><span class="w"> </span><span class="n">parse</span><span class="w"> </span><span class="o">-</span><span class="n">o</span><span class="w"> </span><span class="n">parser</span><span class="p">.</span><span class="n">wasm</span>
<span class="n">Traceback</span><span class="w"> </span><span class="p">(</span><span class="n">most</span><span class="w"> </span><span class="n">recent</span><span class="w"> </span><span class="n">call</span><span class="w"> </span><span class="n">last</span><span class="p">):</span>
<span class="w">  </span><span class="nc">File</span><span class="w"> </span><span class="s">"/mnt/wasm/path/to/venv/bin/componentize-py"</span><span class="p">,</span><span class="w"> </span><span class="n">line</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="w">    </span><span class="n">sys</span><span class="p">.</span><span class="n">exit</span><span class="p">(</span><span class="n">script</span><span class="p">())</span>
<span class="w">             </span><span class="o">^^^^^^^^</span>
<span class="n">AssertionError</span><span class="p">:</span>

<span class="nc">Caused</span><span class="w"> </span><span class="n">by</span><span class="p">:</span>
<span class="w">    </span><span class="nc">TypeError</span><span class="p">:</span><span class="w"> </span><span class="nc">Can</span><span class="o">'</span><span class="na">t</span><span class="w"> </span><span class="n">instantiate</span><span class="w"> </span><span class="kr">abstract</span><span class="w"> </span><span class="n">class</span><span class="w"> </span><span class="n">Parse</span><span class="w"> </span><span class="n">without</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">implementation</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="kr">abstract</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="o">'</span><span class="na">parse</span><span class="o">'</span>
</code></pre></div>
<p>I checked the bindings output, looks like I've used the exactly same class and function name, not sure where went wrong.</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">#</span><span class="w"> </span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">wasm</span><span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">venv</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">componentize</span><span class="o">-</span><span class="n">py</span><span class="w"> </span><span class="o">-</span><span class="n">d</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">wit</span><span class="o">/</span><span class="n">world</span><span class="p">.</span><span class="n">wit</span><span class="w"> </span><span class="o">-</span><span class="n">w</span><span class="w"> </span><span class="n">parse</span><span class="w"> </span><span class="n">bindings</span><span class="w"> </span><span class="n">tmp</span>
<span class="n">root</span><span class="o">@</span><span class="n">a23ad5413a51</span><span class="p">:</span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">wasm</span><span class="o">/</span><span class="n">parser_py</span><span class="p">#</span><span class="w"> </span><span class="n">cat</span><span class="w"> </span><span class="n">tmp</span><span class="o">/</span><span class="n">parse</span><span class="o">/</span>
<span class="n">__init__</span><span class="p">.</span><span class="n">py</span><span class="w">  </span><span class="n">types</span><span class="p">.</span><span class="n">py</span>
<span class="n">root</span><span class="o">@</span><span class="n">a23ad5413a51</span><span class="p">:</span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">wasm</span><span class="o">/</span><span class="n">parser_py</span><span class="p">#</span><span class="w"> </span><span class="n">cat</span><span class="w"> </span><span class="n">tmp</span><span class="o">/</span><span class="n">parse</span><span class="o">/</span><span class="n">__init__</span><span class="p">.</span><span class="n">py</span>
<span class="n">from</span><span class="w"> </span><span class="n">typing</span><span class="w"> </span><span class="n">import</span><span class="w"> </span><span class="n">TypeVar</span><span class="p">,</span><span class="w"> </span><span class="n">Generic</span><span class="p">,</span><span class="w"> </span><span class="n">Union</span><span class="p">,</span><span class="w"> </span><span class="n">Optional</span><span class="p">,</span><span class="w"> </span><span class="n">Protocol</span><span class="p">,</span><span class="w"> </span><span class="n">Tuple</span><span class="p">,</span><span class="w"> </span><span class="n">List</span><span class="p">,</span><span class="w"> </span><span class="n">Any</span><span class="p">,</span><span class="w"> </span><span class="bp">Self</span>
<span class="n">from</span><span class="w"> </span><span class="k">enum</span><span class="w"> </span><span class="nc">import</span><span class="w"> </span><span class="n">Flag</span><span class="p">,</span><span class="w"> </span><span class="n">Enum</span><span class="p">,</span><span class="w"> </span><span class="n">auto</span>
<span class="n">from</span><span class="w"> </span><span class="n">dataclasses</span><span class="w"> </span><span class="n">import</span><span class="w"> </span><span class="n">dataclass</span>
<span class="n">from</span><span class="w"> </span><span class="n">abc</span><span class="w"> </span><span class="n">import</span><span class="w"> </span><span class="n">abstractmethod</span>
<span class="n">import</span><span class="w"> </span><span class="n">weakref</span>

<span class="n">from</span><span class="w"> </span><span class="p">.</span><span class="n">types</span><span class="w"> </span><span class="n">import</span><span class="w"> </span><span class="nb">Result</span><span class="p">,</span><span class="w"> </span><span class="nb">Ok</span><span class="p">,</span><span class="w"> </span><span class="nb">Err</span><span class="p">,</span><span class="w"> </span><span class="nb">Some</span>



<span class="n">class</span><span class="w"> </span><span class="n">Parse</span><span class="p">(</span><span class="n">Protocol</span><span class="p">):</span>

<span class="w">    </span><span class="o">@</span><span class="n">abstractmethod</span>
<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">payload</span><span class="p">:</span><span class="w"> </span><span class="nc">bytes</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">bytes</span><span class="p">:</span>
<span class="w">        </span><span class="nc">raise</span><span class="w"> </span><span class="n">NotImplementedError</span>
</code></pre></div>
<p>Did I miss anything?</p>



<a name="462405461"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20how%20to%20write%20a%20data%20transformer%20using%20wasm%3F/near/462405461" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20how.20to.20write.20a.20data.20transformer.20using.20wasm.3F.html#462405461">(Aug 14 2024 at 19:27)</a>:</h4>
<p>It looks like you told <code>componentize-py</code> the module name is "parse", but the file name is <code>lib.py</code>.  Can you try changing that to <code>parse.py</code>?</p>



<a name="462405537"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20how%20to%20write%20a%20data%20transformer%20using%20wasm%3F/near/462405537" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20how.20to.20write.20a.20data.20transformer.20using.20wasm.3F.html#462405537">(Aug 14 2024 at 19:27)</a>:</h4>
<p>actually, nevermind; try changing the module name you give <code>componentize-py</code> to <code>lib</code> instead</p>



<a name="462405612"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20how%20to%20write%20a%20data%20transformer%20using%20wasm%3F/near/462405612" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20how.20to.20write.20a.20data.20transformer.20using.20wasm.3F.html#462405612">(Aug 14 2024 at 19:28)</a>:</h4>
<p>There might be a conflict if the world name and the implementation module name are the same</p>



<a name="462405669"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20how%20to%20write%20a%20data%20transformer%20using%20wasm%3F/near/462405669" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20how.20to.20write.20a.20data.20transformer.20using.20wasm.3F.html#462405669">(Aug 14 2024 at 19:28)</a>:</h4>
<p>e.g. <code>componentize-py -d ./wit/world.wit -w parse componentize -p ./src lib -o parser.wasm</code></p>



<a name="462405732"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20how%20to%20write%20a%20data%20transformer%20using%20wasm%3F/near/462405732" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bo Liu <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20how.20to.20write.20a.20data.20transformer.20using.20wasm.3F.html#462405732">(Aug 14 2024 at 19:29)</a>:</h4>
<p>Thanks! oh, right, now I got a different err,</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">wasm</span><span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">venv</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">componentize</span><span class="o">-</span><span class="n">py</span><span class="w"> </span><span class="o">-</span><span class="n">d</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">wit</span><span class="o">/</span><span class="n">world</span><span class="p">.</span><span class="n">wit</span><span class="w"> </span><span class="o">-</span><span class="n">w</span><span class="w"> </span><span class="n">parse</span><span class="w"> </span><span class="n">componentize</span><span class="w"> </span><span class="o">-</span><span class="n">p</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">src</span><span class="w"> </span><span class="o">-</span><span class="n">o</span><span class="w"> </span><span class="n">parser</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="n">lib</span>
<span class="n">Traceback</span><span class="w"> </span><span class="p">(</span><span class="n">most</span><span class="w"> </span><span class="n">recent</span><span class="w"> </span><span class="n">call</span><span class="w"> </span><span class="n">last</span><span class="p">):</span>
<span class="w">  </span><span class="nc">File</span><span class="w"> </span><span class="s">"/mnt/wasm/path/to/venv/bin/componentize-py"</span><span class="p">,</span><span class="w"> </span><span class="n">line</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="w">    </span><span class="n">sys</span><span class="p">.</span><span class="n">exit</span><span class="p">(</span><span class="n">script</span><span class="p">())</span>
<span class="w">             </span><span class="o">^^^^^^^^</span>
<span class="n">AssertionError</span><span class="p">:</span><span class="w"> </span><span class="nc">Traceback</span><span class="w"> </span><span class="p">(</span><span class="n">most</span><span class="w"> </span><span class="n">recent</span><span class="w"> </span><span class="n">call</span><span class="w"> </span><span class="n">last</span><span class="p">):</span>
<span class="w">  </span><span class="nc">File</span><span class="w"> </span><span class="s">"/0/lib.py"</span><span class="p">,</span><span class="w"> </span><span class="n">line</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="w">    </span><span class="n">import</span><span class="w"> </span><span class="n">parser</span>
<span class="n">ModuleNotFoundError</span><span class="p">:</span><span class="w"> </span><span class="nc">No</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="n">named</span><span class="w"> </span><span class="o">'</span><span class="na">parser</span><span class="o">'</span>


<span class="n">Caused</span><span class="w"> </span><span class="n">by</span><span class="p">:</span>
<span class="w">    </span><span class="nc">ModuleNotFoundError</span><span class="p">:</span><span class="w"> </span><span class="nc">No</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="n">named</span><span class="w"> </span><span class="o">'</span><span class="na">parser</span><span class="o">'</span>
</code></pre></div>



<a name="462405854"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20how%20to%20write%20a%20data%20transformer%20using%20wasm%3F/near/462405854" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20how.20to.20write.20a.20data.20transformer.20using.20wasm.3F.html#462405854">(Aug 14 2024 at 19:30)</a>:</h4>
<p>hmm, I don't see <code>lib</code> in your command</p>



<a name="462405871"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20how%20to%20write%20a%20data%20transformer%20using%20wasm%3F/near/462405871" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20how.20to.20write.20a.20data.20transformer.20using.20wasm.3F.html#462405871">(Aug 14 2024 at 19:30)</a>:</h4>
<p>oops, there it is at the end</p>



<a name="462405894"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20how%20to%20write%20a%20data%20transformer%20using%20wasm%3F/near/462405894" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bo Liu <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20how.20to.20write.20a.20data.20transformer.20using.20wasm.3F.html#462405894">(Aug 14 2024 at 19:30)</a>:</h4>
<p>at the very end, after <code>-o parser.wasm</code> ;)</p>



<a name="462406001"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20how%20to%20write%20a%20data%20transformer%20using%20wasm%3F/near/462406001" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20how.20to.20write.20a.20data.20transformer.20using.20wasm.3F.html#462406001">(Aug 14 2024 at 19:31)</a>:</h4>
<p>what is the <code>import parser</code> line for?  It doesn't look like you're using it.</p>



<a name="462406102"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20how%20to%20write%20a%20data%20transformer%20using%20wasm%3F/near/462406102" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20how.20to.20write.20a.20data.20transformer.20using.20wasm.3F.html#462406102">(Aug 14 2024 at 19:32)</a>:</h4>
<p>ugh, I need to read better before I type; I see you're using the type <code>parser.Parse</code></p>



<a name="462406137"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20how%20to%20write%20a%20data%20transformer%20using%20wasm%3F/near/462406137" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bo Liu <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20how.20to.20write.20a.20data.20transformer.20using.20wasm.3F.html#462406137">(Aug 14 2024 at 19:32)</a>:</h4>
<p>right, trying to get parser.Parse, which is the def from world.wit</p>



<a name="462406143"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20how%20to%20write%20a%20data%20transformer%20using%20wasm%3F/near/462406143" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20how.20to.20write.20a.20data.20transformer.20using.20wasm.3F.html#462406143">(Aug 14 2024 at 19:32)</a>:</h4>
<p>shouldn't it be <code>parse</code>, not <code>parser</code>?</p>



<a name="462406263"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20how%20to%20write%20a%20data%20transformer%20using%20wasm%3F/near/462406263" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bo Liu <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20how.20to.20write.20a.20data.20transformer.20using.20wasm.3F.html#462406263">(Aug 14 2024 at 19:33)</a>:</h4>
<p>hmm, maybe.<br>
I thought it was named after <code>package component:parser;</code> part</p>



<a name="462406315"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20how%20to%20write%20a%20data%20transformer%20using%20wasm%3F/near/462406315" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Dice <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20how.20to.20write.20a.20data.20transformer.20using.20wasm.3F.html#462406315">(Aug 14 2024 at 19:34)</a>:</h4>
<p>no, just the world name</p>



<a name="462406383"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20how%20to%20write%20a%20data%20transformer%20using%20wasm%3F/near/462406383" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bo Liu <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20how.20to.20write.20a.20data.20transformer.20using.20wasm.3F.html#462406383">(Aug 14 2024 at 19:34)</a>:</h4>
<p>I see, now I got </p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">y</span><span class="p">#</span><span class="w"> </span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">wasm</span><span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">venv</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">componentize</span><span class="o">-</span><span class="n">py</span><span class="w"> </span><span class="o">-</span><span class="n">d</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">wit</span><span class="o">/</span><span class="n">world</span><span class="p">.</span><span class="n">wit</span><span class="w"> </span><span class="o">-</span><span class="n">w</span><span class="w"> </span><span class="n">parse</span><span class="w"> </span><span class="n">componentize</span><span class="w"> </span><span class="o">-</span><span class="n">p</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">src</span><span class="w"> </span><span class="o">-</span><span class="n">o</span><span class="w"> </span><span class="n">parser</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="n">lib</span>
<span class="n">Component</span><span class="w"> </span><span class="n">built</span><span class="w"> </span><span class="n">successfully</span>
</code></pre></div>
<p>hooray</p>



<a name="462406459"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20how%20to%20write%20a%20data%20transformer%20using%20wasm%3F/near/462406459" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bo Liu <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20how.20to.20write.20a.20data.20transformer.20using.20wasm.3F.html#462406459">(Aug 14 2024 at 19:35)</a>:</h4>
<p>Thank you so much!</p>



<a name="468775705"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20how%20to%20write%20a%20data%20transformer%20using%20wasm%3F/near/468775705" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20how.20to.20write.20a.20data.20transformer.20using.20wasm.3F.html#468775705">(Sep 09 2024 at 12:18)</a>:</h4>
<p><span class="user-mention silent" data-user-id="234973">Till Schneidereit</span> has marked this topic as resolved.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>