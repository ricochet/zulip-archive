<html>
<head><meta charset="utf-8"><title>reviewing stack overflow changes · wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/index.html">wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/reviewing.20stack.20overflow.20changes.html">reviewing stack overflow changes</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="194496084"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/reviewing%20stack%20overflow%20changes/near/194496084" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/reviewing.20stack.20overflow.20changes.html#194496084">(Apr 17 2020 at 20:32)</a>:</h4>
<p>Would someone be willing to volunteer to review <a href="https://github.com/bytecodealliance/wasmtime/pull/1490" title="https://github.com/bytecodealliance/wasmtime/pull/1490">https://github.com/bytecodealliance/wasmtime/pull/1490</a>?</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wasmtime/pull/1490" style="background-image: url(https://avatars0.githubusercontent.com/u/54038801?s=400&amp;v=4)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wasmtime/pull/1490" title="Implement interrupting wasm code, reimplement stack overflow by alexcrichton · Pull Request #1490 · bytecodealliance/wasmtime">Implement interrupting wasm code, reimplement stack overflow by alexcrichton · Pull Request #1490 · bytecodealliance/wasmtime</a></div><div class="message_embed_description">This commit is a relatively large change for wasmtime with two main
goals:


Primarily this enables interrupting executing wasm code with a trap,
preventing infinite loops in wasm code. Note that r...</div></div></div>



<a name="194500561"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/reviewing%20stack%20overflow%20changes/near/194500561" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/reviewing.20stack.20overflow.20changes.html#194500561">(Apr 17 2020 at 21:11)</a>:</h4>
<p>I'm reviewing it now</p>



<a name="194500709"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/reviewing%20stack%20overflow%20changes/near/194500709" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/reviewing.20stack.20overflow.20changes.html#194500709">(Apr 17 2020 at 21:12)</a>:</h4>
<p>Thanks!</p>



<a name="194503547"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/reviewing%20stack%20overflow%20changes/near/194503547" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/reviewing.20stack.20overflow.20changes.html#194503547">(Apr 17 2020 at 21:41)</a>:</h4>
<p>oh, arg, you're right, this needs to get expanded after the legalizer. let me think about that a bit</p>



<a name="194503589"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/reviewing%20stack%20overflow%20changes/near/194503589" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/reviewing.20stack.20overflow.20changes.html#194503589">(Apr 17 2020 at 21:41)</a>:</h4>
<p>oh lol just wrote the same thing down</p>



<a name="194503606"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/reviewing%20stack%20overflow%20changes/near/194503606" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/reviewing.20stack.20overflow.20changes.html#194503606">(Apr 17 2020 at 21:41)</a>:</h4>
<p>to be clear I'm fine with w/e works here</p>



<a name="194503634"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/reviewing%20stack%20overflow%20changes/near/194503634" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/reviewing.20stack.20overflow.20changes.html#194503634">(Apr 17 2020 at 21:42)</a>:</h4>
<p>could maybe get by with a "mini interpreter" of global values</p>



<a name="194503681"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/reviewing%20stack%20overflow%20changes/near/194503681" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/reviewing.20stack.20overflow.20changes.html#194503681">(Apr 17 2020 at 21:42)</a>:</h4>
<p>and only a small whitelist would be allowed in the prologue</p>



<a name="194504556"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/reviewing%20stack%20overflow%20changes/near/194504556" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/reviewing.20stack.20overflow.20changes.html#194504556">(Apr 17 2020 at 21:49)</a>:</h4>
<p>Yeah, that's what I'm thinking too.</p>



<a name="194504652"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/reviewing%20stack%20overflow%20changes/near/194504652" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/reviewing.20stack.20overflow.20changes.html#194504652">(Apr 17 2020 at 21:50)</a>:</h4>
<p>Use the GlobalValue to describe where the offset is, and have the backend interpret just enough to emit the code you need.</p>



<a name="194504711"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/reviewing%20stack%20overflow%20changes/near/194504711" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/reviewing.20stack.20overflow.20changes.html#194504711">(Apr 17 2020 at 21:50)</a>:</h4>
<p>Does that sound workable?</p>



<a name="194504715"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/reviewing%20stack%20overflow%20changes/near/194504715" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/reviewing.20stack.20overflow.20changes.html#194504715">(Apr 17 2020 at 21:50)</a>:</h4>
<p>mk, I'll work on implementing that</p>



<a name="194504718"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/reviewing%20stack%20overflow%20changes/near/194504718" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/reviewing.20stack.20overflow.20changes.html#194504718">(Apr 17 2020 at 21:50)</a>:</h4>
<p>shouldn't be too too hard</p>



<a name="194547957"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/reviewing%20stack%20overflow%20changes/near/194547957" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Brown <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/reviewing.20stack.20overflow.20changes.html#194547957">(Apr 18 2020 at 14:43)</a>:</h4>
<p>It took me a while to connect the dots but I already have a Cranelift interpreter in progress over at <a href="https://github.com/bytecodealliance/cranelift/pull/1351" title="https://github.com/bytecodealliance/cranelift/pull/1351">https://github.com/bytecodealliance/cranelift/pull/1351</a> that could be used for this. <span class="user-mention" data-user-id="253994">@Alex Crichton</span>, I need to rebase that on some more recent work and address some of Benjamin's comments but I would be interested in figuring out what exactly you need in GlobalValue expressions to make that interpreter work.</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/cranelift/pull/1351" style="background-image: url(https://avatars0.githubusercontent.com/u/54038801?s=400&amp;v=4)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/cranelift/pull/1351" title="Add initial Cranelift interpreter functionality by abrown · Pull Request #1351 · bytecodealliance/cranelift">Add initial Cranelift interpreter functionality by abrown · Pull Request #1351 · bytecodealliance/cranelift</a></div><div class="message_embed_description">This has been discussed in meetings and chat messages.
 A short description of what this does, why it is needed: this implements a rudimentary interpreter for Cranelift IR; only a subset of instruc...</div></div></div>



<a name="194548154"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/reviewing%20stack%20overflow%20changes/near/194548154" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Brown <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/reviewing.20stack.20overflow.20changes.html#194548154">(Apr 18 2020 at 14:48)</a>:</h4>
<p>Uh, that's the old cranelift PR, now the code is at <a href="https://github.com/bytecodealliance/wasmtime/pull/1223" title="https://github.com/bytecodealliance/wasmtime/pull/1223">https://github.com/bytecodealliance/wasmtime/pull/1223</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wasmtime/pull/1223" style="background-image: url(https://avatars0.githubusercontent.com/u/54038801?s=400&amp;v=4)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wasmtime/pull/1223" title="Add initial Cranelift interpreter by abrown · Pull Request #1223 · bytecodealliance/wasmtime">Add initial Cranelift interpreter by abrown · Pull Request #1223 · bytecodealliance/wasmtime</a></div><div class="message_embed_description">See bytecodealliance/cranelift#1351.</div></div></div>



<a name="194548185"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/reviewing%20stack%20overflow%20changes/near/194548185" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/reviewing.20stack.20overflow.20changes.html#194548185">(Apr 18 2020 at 14:49)</a>:</h4>
<p>It turns out that we're using "interpret" here in the sense of "recognize". See <code>interpret_gv</code> in the PR; it's translating to new instructions rather than executing them.</p>



<a name="194554409"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/reviewing%20stack%20overflow%20changes/near/194554409" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/reviewing.20stack.20overflow.20changes.html#194554409">(Apr 18 2020 at 17:10)</a>:</h4>
<p>Oh sorry yeah interpret is probably the wrong term</p>



<a name="194556217"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/reviewing%20stack%20overflow%20changes/near/194556217" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Brown <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/reviewing.20stack.20overflow.20changes.html#194556217">(Apr 18 2020 at 17:53)</a>:</h4>
<p><span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span></p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>