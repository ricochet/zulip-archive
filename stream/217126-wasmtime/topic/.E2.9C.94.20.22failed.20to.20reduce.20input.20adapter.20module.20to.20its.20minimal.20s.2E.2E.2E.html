<html>
<head><meta charset="utf-8"><title>✔ &quot;failed to reduce input adapter module to its minimal s... · wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/index.html">wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20.22failed.20to.20reduce.20input.20adapter.20module.20to.20its.20minimal.20s.2E.2E.2E.html">✔ &quot;failed to reduce input adapter module to its minimal s...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="456698665"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20%22failed%20to%20reduce%20input%20adapter%20module%20to%20its%20minimal%20s.../near/456698665" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> kmeakin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20.22failed.20to.20reduce.20input.20adapter.20module.20to.20its.20minimal.20s.2E.2E.2E.html#456698665">(Aug 05 2024 at 20:26)</a>:</h4>
<p>I'm trying to run <code>./ci/run-tests.sh</code> so I can reproduce the CI failures on <a href="https://github.com/bytecodealliance/wasmtime/pull/9074">https://github.com/bytecodealliance/wasmtime/pull/9074</a> locally. But I'm getting:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">error</span><span class="p">:</span><span class="w"> </span><span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">custom</span><span class="w"> </span><span class="n">build</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="err">`</span><span class="n">test</span><span class="o">-</span><span class="n">programs</span><span class="o">-</span><span class="n">artifacts</span><span class="w"> </span><span class="n">v0</span><span class="p">.</span><span class="mf">0.0</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">karl</span><span class="o">/</span><span class="n">git</span><span class="o">/</span><span class="n">third</span><span class="o">-</span><span class="n">party</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">test</span><span class="o">-</span><span class="n">programs</span><span class="o">/</span><span class="n">artifacts</span><span class="p">)</span><span class="err">`</span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span><span class="p">:</span>
<span class="w">  </span><span class="nc">process</span><span class="w"> </span><span class="n">didn</span><span class="o">'</span><span class="na">t</span><span class="w"> </span><span class="n">exit</span><span class="w"> </span><span class="n">successfully</span><span class="p">:</span><span class="w"> </span><span class="err">`</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">karl</span><span class="o">/</span><span class="n">git</span><span class="o">/</span><span class="n">third</span><span class="o">-</span><span class="n">party</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">test</span><span class="o">-</span><span class="n">programs</span><span class="o">-</span><span class="n">artifacts</span><span class="o">-</span><span class="mi">7</span><span class="n">b1fbb6ef30a3cfe</span><span class="o">/</span><span class="n">build</span><span class="o">-</span><span class="n">script</span><span class="o">-</span><span class="n">build</span><span class="err">`</span><span class="w"> </span><span class="p">(</span><span class="n">exit</span><span class="w"> </span><span class="n">status</span><span class="p">:</span><span class="w"> </span><span class="mi">101</span><span class="p">)</span>
<span class="w">  </span><span class="o">---</span><span class="w"> </span><span class="n">stdout</span>
<span class="w">  </span><span class="n">cargo</span><span class="p">:</span><span class="nc">rerun</span><span class="o">-</span><span class="k">if</span><span class="o">-</span><span class="n">changed</span><span class="o">=../../</span><span class="n">wasi</span><span class="o">-</span><span class="n">preview1</span><span class="o">-</span><span class="n">component</span><span class="o">-</span><span class="n">adapter</span>
<span class="w">  </span><span class="n">wasi</span><span class="w"> </span><span class="n">reactor</span><span class="w"> </span><span class="n">adapter</span><span class="p">:</span><span class="w"> </span><span class="s">"/home/karl/git/third-party/wasmtime/target/debug/build/test-programs-artifacts-8b6599c0f6cb2865/out/wasi_snapshot_preview1.reactor.wasm"</span>
<span class="w">  </span><span class="n">cargo</span><span class="p">:</span><span class="nc">rerun</span><span class="o">-</span><span class="k">if</span><span class="o">-</span><span class="n">changed</span><span class="o">=../../</span><span class="n">wasi</span><span class="o">-</span><span class="n">preview1</span><span class="o">-</span><span class="n">component</span><span class="o">-</span><span class="n">adapter</span>
<span class="w">  </span><span class="n">wasi</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="n">adapter</span><span class="p">:</span><span class="w"> </span><span class="s">"/home/karl/git/third-party/wasmtime/target/debug/build/test-programs-artifacts-8b6599c0f6cb2865/out/wasi_snapshot_preview1.command.wasm"</span>
<span class="w">  </span><span class="n">cargo</span><span class="p">:</span><span class="nc">rerun</span><span class="o">-</span><span class="k">if</span><span class="o">-</span><span class="n">changed</span><span class="o">=../../</span><span class="n">wasi</span><span class="o">-</span><span class="n">preview1</span><span class="o">-</span><span class="n">component</span><span class="o">-</span><span class="n">adapter</span>
<span class="w">  </span><span class="n">wasi</span><span class="w"> </span><span class="n">proxy</span><span class="w"> </span><span class="n">adapter</span><span class="p">:</span><span class="w"> </span><span class="s">"/home/karl/git/third-party/wasmtime/target/debug/build/test-programs-artifacts-8b6599c0f6cb2865/out/wasi_snapshot_preview1.proxy.wasm"</span>
<span class="w">  </span><span class="n">cargo</span><span class="p">:</span><span class="nc">rerun</span><span class="o">-</span><span class="k">if</span><span class="o">-</span><span class="n">changed</span><span class="o">=../</span><span class="n">src</span>
<span class="w">  </span><span class="n">creating</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="s">"/home/karl/git/third-party/wasmtime/target/debug/build/test-programs-artifacts-8b6599c0f6cb2865/out/wasm32-wasip1/debug/api_proxy.wasm"</span>

<span class="w">  </span><span class="o">---</span><span class="w"> </span><span class="n">stderr</span>
<span class="w">  </span><span class="n">running</span><span class="p">:</span><span class="w"> </span><span class="nc">env</span><span class="w"> </span><span class="o">-</span><span class="n">u</span><span class="w"> </span><span class="n">CARGO_ENCODED_RUSTFLAGS</span><span class="w"> </span><span class="n">CARGO_TARGET_DIR</span><span class="o">=</span><span class="s">"/home/karl/git/third-party/wasmtime/target/debug/build/test-programs-artifacts-8b6599c0f6cb2865/out"</span><span class="w"> </span><span class="n">RUSTFLAGS</span><span class="o">=</span><span class="s">""</span><span class="w"> </span><span class="s">"cargo"</span><span class="w"> </span><span class="s">"build"</span><span class="w"> </span><span class="s">"--release"</span><span class="w"> </span><span class="s">"--package=wasi-preview1-component-adapter"</span><span class="w"> </span><span class="s">"--target=wasm32-unknown-unknown"</span>
<span class="w">     </span><span class="n">Compiling</span><span class="w"> </span><span class="n">wasi</span><span class="o">-</span><span class="n">preview1</span><span class="o">-</span><span class="n">component</span><span class="o">-</span><span class="n">adapter</span><span class="w"> </span><span class="n">v25</span><span class="p">.</span><span class="mf">0.0</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">karl</span><span class="o">/</span><span class="n">git</span><span class="o">/</span><span class="n">third</span><span class="o">-</span><span class="n">party</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">wasi</span><span class="o">-</span><span class="n">preview1</span><span class="o">-</span><span class="n">component</span><span class="o">-</span><span class="n">adapter</span><span class="p">)</span>
<span class="w">      </span><span class="n">Finished</span><span class="w"> </span><span class="err">`</span><span class="n">release</span><span class="err">`</span><span class="w"> </span><span class="n">profile</span><span class="w"> </span><span class="p">[</span><span class="n">optimized</span><span class="p">]</span><span class="w"> </span><span class="n">target</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mf">1.98</span><span class="n">s</span>
<span class="w">  </span><span class="n">running</span><span class="p">:</span><span class="w"> </span><span class="nc">env</span><span class="w"> </span><span class="o">-</span><span class="n">u</span><span class="w"> </span><span class="n">CARGO_ENCODED_RUSTFLAGS</span><span class="w"> </span><span class="n">CARGO_TARGET_DIR</span><span class="o">=</span><span class="s">"/home/karl/git/third-party/wasmtime/target/debug/build/test-programs-artifacts-8b6599c0f6cb2865/out"</span><span class="w"> </span><span class="n">RUSTFLAGS</span><span class="o">=</span><span class="s">""</span><span class="w"> </span><span class="s">"cargo"</span><span class="w"> </span><span class="s">"build"</span><span class="w"> </span><span class="s">"--release"</span><span class="w"> </span><span class="s">"--package=wasi-preview1-component-adapter"</span><span class="w"> </span><span class="s">"--target=wasm32-unknown-unknown"</span><span class="w"> </span><span class="s">"--no-default-features"</span><span class="w"> </span><span class="s">"--features=command"</span>
<span class="w">     </span><span class="n">Compiling</span><span class="w"> </span><span class="n">wasi</span><span class="o">-</span><span class="n">preview1</span><span class="o">-</span><span class="n">component</span><span class="o">-</span><span class="n">adapter</span><span class="w"> </span><span class="n">v25</span><span class="p">.</span><span class="mf">0.0</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">karl</span><span class="o">/</span><span class="n">git</span><span class="o">/</span><span class="n">third</span><span class="o">-</span><span class="n">party</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">wasi</span><span class="o">-</span><span class="n">preview1</span><span class="o">-</span><span class="n">component</span><span class="o">-</span><span class="n">adapter</span><span class="p">)</span>
<span class="w">      </span><span class="n">Finished</span><span class="w"> </span><span class="err">`</span><span class="n">release</span><span class="err">`</span><span class="w"> </span><span class="n">profile</span><span class="w"> </span><span class="p">[</span><span class="n">optimized</span><span class="p">]</span><span class="w"> </span><span class="n">target</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mf">1.98</span><span class="n">s</span>
<span class="w">  </span><span class="n">running</span><span class="p">:</span><span class="w"> </span><span class="nc">env</span><span class="w"> </span><span class="o">-</span><span class="n">u</span><span class="w"> </span><span class="n">CARGO_ENCODED_RUSTFLAGS</span><span class="w"> </span><span class="n">CARGO_TARGET_DIR</span><span class="o">=</span><span class="s">"/home/karl/git/third-party/wasmtime/target/debug/build/test-programs-artifacts-8b6599c0f6cb2865/out"</span><span class="w"> </span><span class="n">RUSTFLAGS</span><span class="o">=</span><span class="s">""</span><span class="w"> </span><span class="s">"cargo"</span><span class="w"> </span><span class="s">"build"</span><span class="w"> </span><span class="s">"--release"</span><span class="w"> </span><span class="s">"--package=wasi-preview1-component-adapter"</span><span class="w"> </span><span class="s">"--target=wasm32-unknown-unknown"</span><span class="w"> </span><span class="s">"--no-default-features"</span><span class="w"> </span><span class="s">"--features=proxy"</span>
<span class="w">     </span><span class="n">Compiling</span><span class="w"> </span><span class="n">wasi</span><span class="o">-</span><span class="n">preview1</span><span class="o">-</span><span class="n">component</span><span class="o">-</span><span class="n">adapter</span><span class="w"> </span><span class="n">v25</span><span class="p">.</span><span class="mf">0.0</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">karl</span><span class="o">/</span><span class="n">git</span><span class="o">/</span><span class="n">third</span><span class="o">-</span><span class="n">party</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">wasi</span><span class="o">-</span><span class="n">preview1</span><span class="o">-</span><span class="n">component</span><span class="o">-</span><span class="n">adapter</span><span class="p">)</span>
<span class="w">      </span><span class="n">Finished</span><span class="w"> </span><span class="err">`</span><span class="n">release</span><span class="err">`</span><span class="w"> </span><span class="n">profile</span><span class="w"> </span><span class="p">[</span><span class="n">optimized</span><span class="p">]</span><span class="w"> </span><span class="n">target</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mf">1.18</span><span class="n">s</span>
<span class="w">  </span><span class="n">running</span><span class="p">:</span><span class="w"> </span><span class="nc">env</span><span class="w"> </span><span class="o">-</span><span class="n">u</span><span class="w"> </span><span class="n">CARGO_ENCODED_RUSTFLAGS</span><span class="w"> </span><span class="n">CARGO_PROFILE_DEV_DEBUG</span><span class="o">=</span><span class="s">"2"</span><span class="w"> </span><span class="n">CARGO_TARGET_DIR</span><span class="o">=</span><span class="s">"/home/karl/git/third-party/wasmtime/target/debug/build/test-programs-artifacts-8b6599c0f6cb2865/out"</span><span class="w"> </span><span class="n">RUSTFLAGS</span><span class="o">=</span><span class="s">""</span><span class="w"> </span><span class="s">"cargo"</span><span class="w"> </span><span class="s">"build"</span><span class="w"> </span><span class="s">"--target=wasm32-wasip1"</span><span class="w"> </span><span class="s">"--package=test-programs"</span>
<span class="w">      </span><span class="n">Finished</span><span class="w"> </span><span class="err">`</span><span class="n">dev</span><span class="err">`</span><span class="w"> </span><span class="n">profile</span><span class="w"> </span><span class="p">[</span><span class="n">unoptimized</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">debuginfo</span><span class="p">]</span><span class="w"> </span><span class="n">target</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mf">0.27</span><span class="n">s</span>
<span class="w">  </span><span class="n">thread</span><span class="w"> </span><span class="o">'</span><span class="na">main</span><span class="o">'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">crates</span><span class="o">/</span><span class="n">test</span><span class="o">-</span><span class="n">programs</span><span class="o">/</span><span class="n">artifacts</span><span class="o">/</span><span class="n">build</span><span class="p">.</span><span class="n">rs</span><span class="p">:</span><span class="mi">175</span><span class="p">:</span><span class="mi">10</span><span class="p">:</span>
<span class="w">  </span><span class="nc">module</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">translated</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">component</span><span class="p">:</span><span class="w"> </span><span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">decode</span><span class="w"> </span><span class="n">world</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">module</span>

<span class="w">  </span><span class="n">Caused</span><span class="w"> </span><span class="n">by</span><span class="p">:</span>
<span class="w">      </span><span class="mi">0</span><span class="p">:</span><span class="w"> </span><span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">reduce</span><span class="w"> </span><span class="n">input</span><span class="w"> </span><span class="n">adapter</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">its</span><span class="w"> </span><span class="n">minimal</span><span class="w"> </span><span class="n">size</span>
<span class="w">      </span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="nc">unsupported</span><span class="w"> </span><span class="n">section</span><span class="w"> </span><span class="n">found</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">adapter</span><span class="w"> </span><span class="n">module</span>
<span class="w">  </span><span class="n">note</span><span class="p">:</span><span class="w"> </span><span class="nc">run</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="err">`</span><span class="n">RUST_BACKTRACE</span><span class="o">=</span><span class="mi">1</span><span class="err">`</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">display</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">backtrace</span>
</code></pre></div>
<p>This is with a fresh clone of the repo</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wasmtime/pull/9074" style="background-image: url(&quot;https://uploads.zulipusercontent.net/16f661b657183d97810e335f24ebfc4a149ea0f0/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f306363343930313865663164383062333665643039383032376332353261663066363535616438313961616130343633643764353135663666363337353434312f62797465636f6465616c6c69616e63652f7761736d74696d652f70756c6c2f39303734&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wasmtime/pull/9074" title="egraphs: transpose select on operation to operation on select when it increases sharing by Kmeakin · Pull Request #9074 · bytecodealliance/wasmtime">egraphs: transpose select on operation to operation on select when it increases sharing by Kmeakin · Pull Request #9074 · bytecodealliance/wasmtime</a></div><div class="message_embed_description">This is a second attempt of #6219, but this time only includes rewrites that are obviously beneficial by reducing number of instructions</div></div></div>



<a name="456708508"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20%22failed%20to%20reduce%20input%20adapter%20module%20to%20its%20minimal%20s.../near/456708508" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20.22failed.20to.20reduce.20input.20adapter.20module.20to.20its.20minimal.20s.2E.2E.2E.html#456708508">(Aug 05 2024 at 21:13)</a>:</h4>
<p><code>rustc --version</code>?</p>



<a name="456709841"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20%22failed%20to%20reduce%20input%20adapter%20module%20to%20its%20minimal%20s.../near/456709841" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20.22failed.20to.20reduce.20input.20adapter.20module.20to.20its.20minimal.20s.2E.2E.2E.html#456709841">(Aug 05 2024 at 21:21)</a>:</h4>
<p>i checked out your branch locally and cant reproduce with rust 1.80 on mac aarch64 (host architecture almost certainly shouldnt matter for this part of the build, since its a cross build)</p>



<a name="456709861"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20%22failed%20to%20reduce%20input%20adapter%20module%20to%20its%20minimal%20s.../near/456709861" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20.22failed.20to.20reduce.20input.20adapter.20module.20to.20its.20minimal.20s.2E.2E.2E.html#456709861">(Aug 05 2024 at 21:21)</a>:</h4>
<p>my best guess is to cargo clean and try again</p>



<a name="456716009"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20%22failed%20to%20reduce%20input%20adapter%20module%20to%20its%20minimal%20s.../near/456716009" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> kmeakin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20.22failed.20to.20reduce.20input.20adapter.20module.20to.20its.20minimal.20s.2E.2E.2E.html#456716009">(Aug 05 2024 at 22:03)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">rustc</span><span class="w"> </span><span class="o">--</span><span class="n">version</span><span class="w"> </span><span class="o">--</span><span class="n">verbose</span>
<span class="n">rustc</span><span class="w"> </span><span class="mf">1.82.0</span><span class="o">-</span><span class="n">nightly</span><span class="w"> </span><span class="p">(</span><span class="mf">176e54520</span><span class="w"> </span><span class="mi">2024</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">04</span><span class="p">)</span>
<span class="n">binary</span><span class="p">:</span><span class="w"> </span><span class="nc">rustc</span>
<span class="n">commit</span><span class="o">-</span><span class="n">hash</span><span class="p">:</span><span class="w"> </span><span class="mf">176e5452095444815207</span><span class="n">be02c16de0b1487a1b53</span>
<span class="n">commit</span><span class="o">-</span><span class="n">date</span><span class="p">:</span><span class="w"> </span><span class="mi">2024</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">04</span>
<span class="n">host</span><span class="p">:</span><span class="w"> </span><span class="nc">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span>
<span class="n">release</span><span class="p">:</span><span class="w"> </span><span class="mf">1.82.0</span><span class="o">-</span><span class="n">nightly</span>
<span class="n">LLVM</span><span class="w"> </span><span class="n">version</span><span class="p">:</span><span class="w"> </span><span class="mf">19.1.0</span>
</code></pre></div>



<a name="456716867"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20%22failed%20to%20reduce%20input%20adapter%20module%20to%20its%20minimal%20s.../near/456716867" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> kmeakin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20.22failed.20to.20reduce.20input.20adapter.20module.20to.20its.20minimal.20s.2E.2E.2E.html#456716867">(Aug 05 2024 at 22:10)</a>:</h4>
<p>switching to stable toolchain seems to have fixed it</p>



<a name="456725496"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20%22failed%20to%20reduce%20input%20adapter%20module%20to%20its%20minimal%20s.../near/456725496" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20.22failed.20to.20reduce.20input.20adapter.20module.20to.20its.20minimal.20s.2E.2E.2E.html#456725496">(Aug 05 2024 at 23:15)</a>:</h4>
<p>ah, yeah, i have no idea what might break that with nightly, hopefully its just some temporary blip</p>



<a name="456725654"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20%22failed%20to%20reduce%20input%20adapter%20module%20to%20its%20minimal%20s.../near/456725654" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20.22failed.20to.20reduce.20input.20adapter.20module.20to.20its.20minimal.20s.2E.2E.2E.html#456725654">(Aug 05 2024 at 23:17)</a>:</h4>
<p>unfortunately, the adapter is some of the gnarliest code we have, it uses various shenanigains and sleights of hand so that rustc/llvm produces a wasm binary that doesnt have any const data, and it wouldnt shock me if llvm got smart enough to see through some of those tricks...</p>



<a name="456786292"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20%22failed%20to%20reduce%20input%20adapter%20module%20to%20its%20minimal%20s.../near/456786292" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20.22failed.20to.20reduce.20input.20adapter.20module.20to.20its.20minimal.20s.2E.2E.2E.html#456786292">(Aug 06 2024 at 07:24)</a>:</h4>
<p>I think I've figured out what's going on here and I'm endeavouring to debug</p>



<a name="456851823"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20%22failed%20to%20reduce%20input%20adapter%20module%20to%20its%20minimal%20s.../near/456851823" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20.22failed.20to.20reduce.20input.20adapter.20module.20to.20its.20minimal.20s.2E.2E.2E.html#456851823">(Aug 06 2024 at 13:05)</a>:</h4>
<p>looks like this is a regression from <a href="https://github.com/llvm/llvm-project/commit/ba3c1f9ce30cf4f8aee5f1961df74d65e11d53bc">https://github.com/llvm/llvm-project/commit/ba3c1f9ce30cf4f8aee5f1961df74d65e11d53bc</a> which first got into rust with llvm 19 which happened relatively recently in nightly</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/llvm/llvm-project/commit/ba3c1f9ce30cf4f8aee5f1961df74d65e11d53bc" style="background-image: url(&quot;https://uploads.zulipusercontent.net/40ff5bb3968c75aec2f0fe072d89a77e0e379378/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f386435623931643966646564616331633063623230373436343965306134613730303163613461376463663966666231363232353337363033333834376235372f6c6c766d2f6c6c766d2d70726f6a6563742f636f6d6d69742f62613363316639636533306366346638616565356631393631646637346436356531316435336263&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/llvm/llvm-project/commit/ba3c1f9ce30cf4f8aee5f1961df74d65e11d53bc" title="[WebAssembly] Add segment RETAIN flag to support private retained dat… · llvm/llvm-project@ba3c1f9">[WebAssembly] Add segment RETAIN flag to support private retained dat… · llvm/llvm-project@ba3c1f9</a></div><div class="message_embed_description">…a (#81539)

In WebAssembly, we have `WASM_SYMBOL_NO_STRIP` symbol flag to mark the
referenced content as retained. However, the flag is not enough to
express retained data that is not referenced...</div></div></div>



<a name="457217397"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20%22failed%20to%20reduce%20input%20adapter%20module%20to%20its%20minimal%20s.../near/457217397" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> kmeakin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20.22failed.20to.20reduce.20input.20adapter.20module.20to.20its.20minimal.20s.2E.2E.2E.html#457217397">(Aug 07 2024 at 22:47)</a>:</h4>
<p>Would it help to add a <code>rust-toolchain.toml</code> file so contributors aren't broken by having the wrong version?</p>



<a name="459539765"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20%22failed%20to%20reduce%20input%20adapter%20module%20to%20its%20minimal%20s.../near/459539765" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20.22failed.20to.20reduce.20input.20adapter.20module.20to.20its.20minimal.20s.2E.2E.2E.html#459539765">(Aug 09 2024 at 18:03)</a>:</h4>
<p>I've opened <a href="https://github.com/bytecodealliance/wit-bindgen/pull/1021">https://github.com/bytecodealliance/wit-bindgen/pull/1021</a> to solve this, personally I'd prefer to not do rust-toolchain.toml, I'll leave a comment on the PR</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wit-bindgen/pull/1021" style="background-image: url(&quot;https://uploads.zulipusercontent.net/185e19d2ae2e95b3b9e8ac471afbbc8397345c74/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f326166353464356338393939303330313339363566646261653961393961396561383839333330323065653631393938326439363362383164316133353964632f62797465636f6465616c6c69616e63652f7769742d62696e6467656e2f70756c6c2f31303231&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wit-bindgen/pull/1021" title="Add an option to opt-out of `#[used]` statics by alexcrichton · Pull Request #1021 · bytecodealliance/wit-bindgen">Add an option to opt-out of `#[used]` statics by alexcrichton · Pull Request #1021 · bytecodealliance/wit-bindgen</a></div><div class="message_embed_description">This is not needed for the wasi_snapshot_preview1 adapter in Wasmtime and is causing issues with LLVM 19, so add an option to turn it off which will be enabled in Wasmtime.</div></div></div>



<a name="461961043"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20%22failed%20to%20reduce%20input%20adapter%20module%20to%20its%20minimal%20s.../near/461961043" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20.22failed.20to.20reduce.20input.20adapter.20module.20to.20its.20minimal.20s.2E.2E.2E.html#461961043">(Aug 12 2024 at 21:29)</a>:</h4>
<p>To close the loop here I believe that <code>main</code> as-of now should be able to build on the latest nightly</p>



<a name="468775885"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20%22failed%20to%20reduce%20input%20adapter%20module%20to%20its%20minimal%20s.../near/468775885" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20.22failed.20to.20reduce.20input.20adapter.20module.20to.20its.20minimal.20s.2E.2E.2E.html#468775885">(Sep 09 2024 at 12:18)</a>:</h4>
<p><span class="user-mention silent" data-user-id="234973">Till Schneidereit</span> has marked this topic as resolved.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>