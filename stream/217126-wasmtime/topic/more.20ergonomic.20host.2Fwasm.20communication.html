<html>
<head><meta charset="utf-8"><title>more ergonomic host/wasm communication · wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/index.html">wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html">more ergonomic host/wasm communication</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="226861434"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226861434" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226861434">(Feb 18 2021 at 18:58)</a>:</h4>
<p><span class="user-mention" data-user-id="390627">@Yehuda Katz</span> is your use case primarily the wasm blob calling host functions or the host calling wasm functions?</p>



<a name="226861908"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226861908" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226861908">(Feb 18 2021 at 19:00)</a>:</h4>
<p><span class="user-mention silent" data-user-id="253994">Alex Crichton</span> <a href="#narrow/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication/near/226861434">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="390627">Yehuda Katz</span> is your use case primarily the wasm blob calling host functions or the host calling wasm functions?</p>
</blockquote>
<p>ohai</p>



<a name="226861950"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226861950" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226861950">(Feb 18 2021 at 19:01)</a>:</h4>
<p>I think both directions will end up being important</p>



<a name="226862007"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226862007" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226862007">(Feb 18 2021 at 19:01)</a>:</h4>
<p>mk makes sense, so our general story here is that today it's not amazing</p>



<a name="226862013"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226862013" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226862013">(Feb 18 2021 at 19:01)</a>:</h4>
<p>I think if there's one piece of "low-hanging fruit" I'd say it's making an ergonomic way to pass Strings and Vec&lt;u8&gt;</p>



<a name="226862045"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226862045" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226862045">(Feb 18 2021 at 19:01)</a>:</h4>
<p>wasm-bindgen only works on the web (aka not wasmtime)</p>



<a name="226862065"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226862065" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226862065">(Feb 18 2021 at 19:01)</a>:</h4>
<p>and otherwise there is no equivalent of wasm-bindgen <em>today</em> for host-side wasm</p>



<a name="226862074"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226862074" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226862074">(Feb 18 2021 at 19:01)</a>:</h4>
<p>I was able to jury-rig something up, but it's very hard to convince myself about the safety properties, even if I put more work into it</p>



<a name="226862088"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226862088" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226862088">(Feb 18 2021 at 19:01)</a>:</h4>
<p>stuff like "make sure you grow" etc. etc. is rough</p>



<a name="226862091"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226862091" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226862091">(Feb 18 2021 at 19:01)</a>:</h4>
<p>right</p>



<a name="226862144"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226862144" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226862144">(Feb 18 2021 at 19:02)</a>:</h4>
<p>I made a <code>WasmSlice</code> struct</p>



<a name="226862146"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226862146" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226862146">(Feb 18 2021 at 19:02)</a>:</h4>
<p>yeah so our general answer to this is interface types</p>



<a name="226862163"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226862163" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226862163">(Feb 18 2021 at 19:02)</a>:</h4>
<p>which is basically { ptr, len }</p>



<a name="226862177"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226862177" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226862177">(Feb 18 2021 at 19:02)</a>:</h4>
<p>which works well enough</p>



<a name="226862197"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226862197" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226862197">(Feb 18 2021 at 19:02)</a>:</h4>
<p>but the song and dance is rough to get right</p>



<a name="226862202"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226862202" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226862202">(Feb 18 2021 at 19:02)</a>:</h4>
<p>that's the longer-term vision for how host-wasm communication will be nicer (and it'll abstract all the details of memory growth, string allocations, your slice structures, etc)</p>



<a name="226862238"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226862238" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226862238">(Feb 18 2021 at 19:02)</a>:</h4>
<p>and yeah this is why we're pushing towards a longer-term vision b/c getting it all right today is not easy</p>



<a name="226862245"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226862245" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226862245">(Feb 18 2021 at 19:02)</a>:</h4>
<p><span class="user-mention silent" data-user-id="253994">Alex Crichton</span> <a href="#narrow/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication/near/226862146">said</a>:</p>
<blockquote>
<p>yeah so our general answer to this is interface types</p>
</blockquote>
<p>for my use-case it's really important that whatever I do can easily work both in wasmtime <em>and</em> on the web</p>



<a name="226862265"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226862265" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226862265">(Feb 18 2021 at 19:02)</a>:</h4>
<p>so I'm willing to do more work to wire it up if necessary</p>



<a name="226862308"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226862308" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226862308">(Feb 18 2021 at 19:03)</a>:</h4>
<p>long-term that'll all be in place yeah</p>



<a name="226862343"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226862343" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226862343">(Feb 18 2021 at 19:03)</a>:</h4>
<p>interface types was actually originally created for web host apis</p>



<a name="226862360"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226862360" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226862360">(Feb 18 2021 at 19:03)</a>:</h4>
<p>what are the challenges with higher-level APIs for moving blobs of bytes around?</p>



<a name="226862366"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226862366" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226862366">(Feb 18 2021 at 19:03)</a>:</h4>
<p>yeah I know</p>



<a name="226862389"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226862389" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226862389">(Feb 18 2021 at 19:03)</a>:</h4>
<p>I'm a little weirded out by the fact that they're conceptually coupled to wasm-gc, fwiw</p>



<a name="226862403"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226862403" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226862403">(Feb 18 2021 at 19:03)</a>:</h4>
<p>oh it's mostly just standardization</p>



<a name="226862415"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226862415" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226862415">(Feb 18 2021 at 19:04)</a>:</h4>
<p>Rust teaches us that interface types and GC have nothing to do with each other :P</p>



<a name="226862460"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226862460" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226862460">(Feb 18 2021 at 19:04)</a>:</h4>
<p>like just finding the right way to express all this in wasm and standardize it</p>



<a name="226862470"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226862470" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226862470">(Feb 18 2021 at 19:04)</a>:</h4>
<p>it's not quite <em>just</em> standardization</p>



<a name="226862521"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226862521" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226862521">(Feb 18 2021 at 19:04)</a>:</h4>
<p>but yeah I get it :)</p>



<a name="226862556"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226862556" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226862556">(Feb 18 2021 at 19:04)</a>:</h4>
<p>I noticed all of this because I was working on the interaction between the JS typed objects proposal and wasm</p>



<a name="226862580"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226862580" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226862580">(Feb 18 2021 at 19:04)</a>:</h4>
<p>and it really was "integration with wasm-gc" which seemed weird to me as a Rust person</p>



<a name="226862603"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226862603" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226862603">(Feb 18 2021 at 19:05)</a>:</h4>
<p>the problem with interface types right now it's that it's a very long-term vision and we've not made a ton of progress in making it a closer reality</p>



<a name="226862635"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226862635" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226862635">(Feb 18 2021 at 19:05)</a>:</h4>
<p>yep</p>



<a name="226862668"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226862668" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226862668">(Feb 18 2021 at 19:05)</a>:</h4>
<p>that's something we're starting to make progress on, however</p>



<a name="226862699"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226862699" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226862699">(Feb 18 2021 at 19:05)</a>:</h4>
<p>fitzgen/I are working on the next step towards interface types and such</p>



<a name="226862721"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226862721" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226862721">(Feb 18 2021 at 19:05)</a>:</h4>
<p>and I just recently finished one half of it</p>



<a name="226862725"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226862725" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226862725">(Feb 18 2021 at 19:05)</a>:</h4>
<p>personally, I wish interface types were just separated into their own proposal, but that's so far above my pay grade :)</p>



<a name="226862736"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226862736" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226862736">(Feb 18 2021 at 19:05)</a>:</h4>
<p>excellent</p>



<a name="226862795"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226862795" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226862795">(Feb 18 2021 at 19:06)</a>:</h4>
<p>what would you say is the correct pattern for moving around Vec&lt;u8&gt; today?</p>



<a name="226862808"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226862808" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226862808">(Feb 18 2021 at 19:06)</a>:</h4>
<p>it's also worth pointing out that interface types is somewhat  nebulous</p>



<a name="226862846"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226862846" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226862846">(Feb 18 2021 at 19:06)</a>:</h4>
<p>the long-term vision is aligned with everyone I think</p>



<a name="226862884"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226862884" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226862884">(Feb 18 2021 at 19:06)</a>:</h4>
<p>this is what I was trying to do: <a href="https://github.com/wycats/wand/blob/main/crates/wand-cli/src/slice.rs">https://github.com/wycats/wand/blob/main/crates/wand-cli/src/slice.rs</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/wycats/wand/blob/main/crates/wand-cli/src/slice.rs" style="background-image: url(https://avatars.githubusercontent.com/u/4?s=400&amp;v=4)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/wycats/wand/blob/main/crates/wand-cli/src/slice.rs" title="wycats/wand">wycats/wand</a></div><div class="message_embed_description">Contribute to wycats/wand development by creating an account on GitHub.</div></div></div>



<a name="226862885"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226862885" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226862885">(Feb 18 2021 at 19:06)</a>:</h4>
<p>but there's a lot of various mid-states that are very worthwhile and useful before we get to the long-term part</p>



<a name="226862919"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226862919" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226862919">(Feb 18 2021 at 19:06)</a>:</h4>
<p>so for example a great "mvp" of interface types probably doesn't need wasm-gc</p>



<a name="226862931"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226862931" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226862931">(Feb 18 2021 at 19:06)</a>:</h4>
<p>(e.g. what fitzgen/I are working on)</p>



<a name="226863002"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226863002" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226863002">(Feb 18 2021 at 19:07)</a>:</h4>
<p><span class="user-mention silent" data-user-id="253994">Alex Crichton</span> <a href="#narrow/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication/near/226862846">said</a>:</p>
<blockquote>
<p>the long-term vision is aligned with everyone I think</p>
</blockquote>
<p>as an aside, I think wasm has been most effective when the scope has been:</p>
<ol>
<li>fairly well-specified and understood by everyone</li>
<li>very well-motivated by web use-cases</li>
</ol>
<p>but that's my personal opinion :)</p>



<a name="226863055"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226863055" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226863055">(Feb 18 2021 at 19:07)</a>:</h4>
<p>agreed yeah</p>



<a name="226863068"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226863068" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226863068">(Feb 18 2021 at 19:08)</a>:</h4>
<p><span class="user-mention silent" data-user-id="253994">Alex Crichton</span> <a href="#narrow/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication/near/226862919">said</a>:</p>
<blockquote>
<p>so for example a great "mvp" of interface types probably doesn't need wasm-gc</p>
</blockquote>
<p>it seems like, at minimum, the equivalent of Rust <code>Copy</code> types should be doable as an MVP</p>



<a name="226863126"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226863126" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226863126">(Feb 18 2021 at 19:08)</a>:</h4>
<p>right yeah</p>



<a name="226863157"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226863157" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226863157">(Feb 18 2021 at 19:08)</a>:</h4>
<p>when I bring up <code>Copy</code> to non-Rust people, it's just not a category they know how to wrap their heads around</p>



<a name="226863179"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226863179" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226863179">(Feb 18 2021 at 19:08)</a>:</h4>
<p>for getting something done today what you've got there is a good start, the missing pieces would be safety/error handling as well as dealing with malloc/free</p>



<a name="226863186"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226863186" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226863186">(Feb 18 2021 at 19:08)</a>:</h4>
<p>yeah</p>



<a name="226863205"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226863205" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226863205">(Feb 18 2021 at 19:08)</a>:</h4>
<p>e.g. if you want to pass a string to wasm you need to malloc space for it</p>



<a name="226863215"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226863215" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226863215">(Feb 18 2021 at 19:08)</a>:</h4>
<p>basically I don't know how to think about safety</p>



<a name="226863220"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226863220" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226863220">(Feb 18 2021 at 19:08)</a>:</h4>
<p>or if wasm returns a string you may need to free it</p>



<a name="226863246"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226863246" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226863246">(Feb 18 2021 at 19:09)</a>:</h4>
<p>but so you said you've heard of wiggle?</p>



<a name="226863258"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226863258" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226863258">(Feb 18 2021 at 19:09)</a>:</h4>
<p><a href="https://github.com/wycats/wand/blob/main/crates/wand-cli/src/main.rs#L31">https://github.com/wycats/wand/blob/main/crates/wand-cli/src/main.rs#L31</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/wycats/wand/blob/main/crates/wand-cli/src/main.rs#L31" style="background-image: url(https://avatars.githubusercontent.com/u/4?s=400&amp;v=4)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/wycats/wand/blob/main/crates/wand-cli/src/main.rs#L31" title="wycats/wand">wycats/wand</a></div><div class="message_embed_description">Contribute to wycats/wand development by creating an account on GitHub.</div></div></div>



<a name="226863264"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226863264" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226863264">(Feb 18 2021 at 19:09)</a>:</h4>
<p>this is the other half of it</p>



<a name="226863280"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226863280" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226863280">(Feb 18 2021 at 19:09)</a>:</h4>
<p>I've heard of wiggle but haven't looked into it much</p>



<a name="226863286"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226863286" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226863286">(Feb 18 2021 at 19:09)</a>:</h4>
<p>ah right yeah</p>



<a name="226863296"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226863296" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226863296">(Feb 18 2021 at 19:09)</a>:</h4>
<p>lemme get some links for you</p>



<a name="226863317"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226863317" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226863317">(Feb 18 2021 at 19:09)</a>:</h4>
<p>that link is where I'm confident I'm messing up :P</p>



<a name="226863368"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226863368" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226863368">(Feb 18 2021 at 19:09)</a>:</h4>
<p><span class="user-mention" data-user-id="253994">@Alex Crichton</span> the good news about Rust is that most things have rustdoc. The bad news is that many things <em>only</em> have Rustdoc :P</p>



<a name="226863464"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226863464" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226863464">(Feb 18 2021 at 19:10)</a>:</h4>
<p>it's true :(</p>



<a name="226863470"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226863470" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226863470">(Feb 18 2021 at 19:10)</a>:</h4>
<p>we could alway benefit from more examples</p>



<a name="226863482"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226863482" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226863482">(Feb 18 2021 at 19:10)</a>:</h4>
<p>it's ok ;)</p>



<a name="226863504"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226863504" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226863504">(Feb 18 2021 at 19:10)</a>:</h4>
<p>so the purpose of wiggle is to make integration with <code>*.witx</code> files easier</p>



<a name="226863505"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226863505" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226863505">(Feb 18 2021 at 19:10)</a>:</h4>
<p>I'm always happy to help with docs on things I'm working on</p>



<a name="226863514"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226863514" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226863514">(Feb 18 2021 at 19:10)</a>:</h4>
<p>and write decently fast</p>



<a name="226863520"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226863520" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226863520">(Feb 18 2021 at 19:10)</a>:</h4>
<p>but I need to understand first</p>



<a name="226863521"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226863521" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226863521">(Feb 18 2021 at 19:10)</a>:</h4>
<p>so for example WASI is specified with <code>*.witx</code></p>



<a name="226863533"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226863533" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226863533">(Feb 18 2021 at 19:10)</a>:</h4>
<p>e.g. -- <a href="https://github.com/WebAssembly/WASI/blob/ef8c1a53feb2dfb763d4ea5c7d9e0a0126b45579/phases/snapshot/witx/wasi_snapshot_preview1.witx#L282-L289">https://github.com/WebAssembly/WASI/blob/ef8c1a53feb2dfb763d4ea5c7d9e0a0126b45579/phases/snapshot/witx/wasi_snapshot_preview1.witx#L282-L289</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/WebAssembly/WASI/blob/ef8c1a53feb2dfb763d4ea5c7d9e0a0126b45579/phases/snapshot/witx/wasi_snapshot_preview1.witx#L282-L289" style="background-image: url(https://avatars.githubusercontent.com/u/11578470?s=400&amp;v=4)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/WebAssembly/WASI/blob/ef8c1a53feb2dfb763d4ea5c7d9e0a0126b45579/phases/snapshot/witx/wasi_snapshot_preview1.witx#L282-L289" title="WebAssembly/WASI">WebAssembly/WASI</a></div><div class="message_embed_description">WebAssembly System Interface. Contribute to WebAssembly/WASI development by creating an account on GitHub.</div></div></div>



<a name="226863549"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226863549" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226863549">(Feb 18 2021 at 19:11)</a>:</h4>
<p>which is a high-level description of an API</p>



<a name="226863568"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226863568" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226863568">(Feb 18 2021 at 19:11)</a>:</h4>
<p>as you can see takes a string and returns a <code>Result</code></p>



<a name="226863628"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226863628" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226863628">(Feb 18 2021 at 19:11)</a>:</h4>
<p>what <code>wiggle</code> does is it allows you to hook that up automatically to a host implementation -- <a href="https://github.com/bytecodealliance/wasmtime/blob/aed6de32d4e5603a7f85619d84099a9a05cb7a7c/crates/wasi-common/src/snapshots/preview_1.rs#L687-L696">https://github.com/bytecodealliance/wasmtime/blob/aed6de32d4e5603a7f85619d84099a9a05cb7a7c/crates/wasi-common/src/snapshots/preview_1.rs#L687-L696</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wasmtime/blob/aed6de32d4e5603a7f85619d84099a9a05cb7a7c/crates/wasi-common/src/snapshots/preview_1.rs#L687-L696" style="background-image: url(https://avatars.githubusercontent.com/u/54038801?s=400&amp;v=4)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wasmtime/blob/aed6de32d4e5603a7f85619d84099a9a05cb7a7c/crates/wasi-common/src/snapshots/preview_1.rs#L687-L696" title="bytecodealliance/wasmtime">bytecodealliance/wasmtime</a></div><div class="message_embed_description">Standalone JIT-style runtime for WebAssembly, using Cranelift - bytecodealliance/wasmtime</div></div></div>



<a name="226863655"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226863655" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226863655">(Feb 18 2021 at 19:11)</a>:</h4>
<p>which as you can see is all safe</p>



<a name="226863689"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226863689" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226863689">(Feb 18 2021 at 19:12)</a>:</h4>
<p>wiggle does all the "ABI goop" of bounds checks, errors, etc</p>



<a name="226863731"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226863731" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226863731">(Feb 18 2021 at 19:12)</a>:</h4>
<p>so you only write in 100% safe rust</p>



<a name="226863751"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226863751" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226863751">(Feb 18 2021 at 19:12)</a>:</h4>
<p>this is the theory behind <code>wiggle</code></p>



<a name="226863773"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226863773" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226863773">(Feb 18 2021 at 19:12)</a>:</h4>
<p>it's still kind of boiler-plate-y to get all this hooked up</p>



<a name="226863794"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226863794" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226863794">(Feb 18 2021 at 19:12)</a>:</h4>
<p>and is something we're continuing to improve</p>



<a name="226863823"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226863823" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226863823">(Feb 18 2021 at 19:12)</a>:</h4>
<p><span class="user-mention" data-user-id="253994">@Alex Crichton</span> I think one of the things I would benefit from the most is just a sense of what things are stable</p>



<a name="226863837"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226863837" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226863837">(Feb 18 2021 at 19:12)</a>:</h4>
<p>but that's the general idea of where our end-state will be</p>



<a name="226863875"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226863875" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226863875">(Feb 18 2021 at 19:13)</a>:</h4>
<p><span class="user-mention" data-user-id="253994">@Alex Crichton</span> oh, another random topic</p>



<a name="226863888"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226863888" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226863888">(Feb 18 2021 at 19:13)</a>:</h4>
<p>not that random :P</p>



<a name="226863954"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226863954" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226863954">(Feb 18 2021 at 19:13)</a>:</h4>
<p>I was wondering if folks are thinking that wasi should integrate with stuff like the JS FileSystem API</p>



<a name="226863969"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226863969" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226863969">(Feb 18 2021 at 19:13)</a>:</h4>
<p>I asked Aaron about it and he didn't know</p>



<a name="226863980"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226863980" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226863980">(Feb 18 2021 at 19:13)</a>:</h4>
<p>but I was a little surprised it didn't do that</p>



<a name="226864060"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226864060" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226864060">(Feb 18 2021 at 19:14)</a>:</h4>
<p>(and also, how wasi would handle the need to get permissions in the first place)</p>



<a name="226864066"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226864066" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226864066">(Feb 18 2021 at 19:14)</a>:</h4>
<p>wasi currently focuses mainly on non-web applications of wasm</p>



<a name="226864089"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226864089" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226864089">(Feb 18 2021 at 19:14)</a>:</h4>
<p>it's always been expected, however, that a web port is possible</p>



<a name="226864108"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226864108" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226864108">(Feb 18 2021 at 19:14)</a>:</h4>
<p>but there's not currently an official "here's the wasi api for the web" implementation</p>



<a name="226864131"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226864131" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226864131">(Feb 18 2021 at 19:14)</a>:</h4>
<p>and afaik posix has more of an effect on the design than the web</p>



<a name="226864163"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226864163" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226864163">(Feb 18 2021 at 19:14)</a>:</h4>
<p>(I'm totally unfamiliar with the filesystem api myself)</p>



<a name="226864430"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226864430" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226864430">(Feb 18 2021 at 19:16)</a>:</h4>
<p><span class="user-mention silent" data-user-id="253994">Alex Crichton</span> <a href="#narrow/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication/near/226864066">said</a>:</p>
<blockquote>
<p>wasi currently focuses mainly on non-web applications of wasm</p>
</blockquote>
<p>see my earlier thought about wasm scope</p>



<a name="226864432"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226864432" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226864432">(Feb 18 2021 at 19:16)</a>:</h4>
<p>;)</p>



<a name="226864435"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226864435" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226864435">(Feb 18 2021 at 19:16)</a>:</h4>
<p><a href="https://rustwasm.github.io/wasm-bindgen/api/web_sys/struct.FileSystem.html">https://rustwasm.github.io/wasm-bindgen/api/web_sys/struct.FileSystem.html</a></p>



<a name="226864599"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226864599" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226864599">(Feb 18 2021 at 19:17)</a>:</h4>
<p>in any case today everything about this, especially crossing js/host embeddings, is going to be pretty manual</p>



<a name="226864625"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226864625" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226864625">(Feb 18 2021 at 19:18)</a>:</h4>
<p>e.g. you're going to be writing very similar glue code in both Rust and in JS</p>



<a name="226864701"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226864701" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226864701">(Feb 18 2021 at 19:18)</a>:</h4>
<p>that's what's currently available, and in the future we hope to provide tools to make this much easier, basically auto-generating both the JS and the Rust code based on the desired interface of the module</p>



<a name="226864745"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226864745" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226864745">(Feb 18 2021 at 19:18)</a>:</h4>
<p>like you export a function that takes/returns a string and we'd auto-generate the JS glue and the Rust glue for doing that</p>



<a name="226864767"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226864767" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226864767">(Feb 18 2021 at 19:19)</a>:</h4>
<p>no need to manage <code>WasmSlice</code> yourself</p>



<a name="226865259"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226865259" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226865259">(Feb 18 2021 at 19:22)</a>:</h4>
<p>I don't mind writing a lot of the glue code myself</p>



<a name="226865275"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226865275" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226865275">(Feb 18 2021 at 19:22)</a>:</h4>
<p>I am expecting to need to manually write two hosts</p>



<a name="226865290"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226865290" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226865290">(Feb 18 2021 at 19:22)</a>:</h4>
<p>wasmtime and web</p>



<a name="226865316"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226865316" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226865316">(Feb 18 2021 at 19:22)</a>:</h4>
<p>but I don't want to be forced into assuming a JS client</p>



<a name="226865351"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226865351" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226865351">(Feb 18 2021 at 19:23)</a>:</h4>
<p>I'm literally using wasm-pack right now because it's the best way to run the steps</p>



<a name="226865366"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226865366" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226865366">(Feb 18 2021 at 19:23)</a>:</h4>
<p>and then I literally copy the .wasm</p>



<a name="226865541"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226865541" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226865541">(Feb 18 2021 at 19:24)</a>:</h4>
<p>another aspect which may also be possible is to have two wasm blobs, one using wasm-bindgen for the web and one using handwritten stuff for wasmtime</p>



<a name="226865569"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226865569" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226865569">(Feb 18 2021 at 19:24)</a>:</h4>
<p>that would at least relinquish you from having to write js glue code</p>



<a name="226865619"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226865619" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226865619">(Feb 18 2021 at 19:24)</a>:</h4>
<p>but they can't have a single set of externs</p>



<a name="226865669"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226865669" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226865669">(Feb 18 2021 at 19:25)</a>:</h4>
<p>what's slightly frustrating is that there's not a good story for "how to interact manually with the .wasm file created by wasm-bindgen"</p>



<a name="226865719"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226865719" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226865719">(Feb 18 2021 at 19:25)</a>:</h4>
<p>it kind of feels like there should be a Rust API for calling a wasm_bindgen function that takes a String that doesn't have much to do with JS</p>



<a name="226865720"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226865720" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226865720">(Feb 18 2021 at 19:25)</a>:</h4>
<p>true, the wasm-bindgen ABI is unstable and not really documented</p>



<a name="226865737"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226865737" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226865737">(Feb 18 2021 at 19:25)</a>:</h4>
<p>is that intentional, or just path dependence?</p>



<a name="226865748"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226865748" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226865748">(Feb 18 2021 at 19:25)</a>:</h4>
<p>I would be happy to help :)</p>



<a name="226865751"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226865751" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226865751">(Feb 18 2021 at 19:25)</a>:</h4>
<p>that's totally possible, but it breaks down very quickly</p>



<a name="226865763"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226865763" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226865763">(Feb 18 2021 at 19:26)</a>:</h4>
<p>there's just way too much in wasm-bindgen that assumes JS</p>



<a name="226865830"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226865830" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226865830">(Feb 18 2021 at 19:26)</a>:</h4>
<p>presumably there's some need for a somewhat stable answer in order for the JS side to work?</p>



<a name="226865840"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226865840" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226865840">(Feb 18 2021 at 19:26)</a>:</h4>
<p>right</p>



<a name="226865856"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226865856" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226865856">(Feb 18 2021 at 19:26)</a>:</h4>
<p>once you start only talking about structs and strings what you're actually talking about is interface types</p>



<a name="226865883"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226865883" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226865883">(Feb 18 2021 at 19:26)</a>:</h4>
<p>would it be possible to break out wasm_bindgen_core and wasm_bindgen_js?</p>



<a name="226865898"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226865898" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226865898">(Feb 18 2021 at 19:26)</a>:</h4>
<p>I've toyed with the idea of this in the past</p>



<a name="226865909"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226865909" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226865909">(Feb 18 2021 at 19:26)</a>:</h4>
<p>the tl;dr; is basically "no"</p>



<a name="226865932"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226865932" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226865932">(Feb 18 2021 at 19:26)</a>:</h4>
<p>or rather, it's possible, but you're just doing interface types</p>



<a name="226865996"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226865996" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226865996">(Feb 18 2021 at 19:27)</a>:</h4>
<p>I plan to, one day, rebuild wasm-bindgen on interface types</p>



<a name="226866022"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226866022" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226866022">(Feb 18 2021 at 19:27)</a>:</h4>
<p>but interface types needs to make more progress in the meantime naturally</p>



<a name="226866700"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226866700" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226866700">(Feb 18 2021 at 19:31)</a>:</h4>
<p>why wouldn't the rough interning strategy for JS work more generally?</p>



<a name="226866763"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226866763" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226866763">(Feb 18 2021 at 19:31)</a>:</h4>
<p>half the battle of wasm_bindgen is inside of Rust, right?</p>



<a name="226866818"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226866818" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226866818">(Feb 18 2021 at 19:32)</a>:</h4>
<p>why isn't that stuff fully applicable to non-JS clients?</p>



<a name="226866863"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226866863" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226866863">(Feb 18 2021 at 19:32)</a>:</h4>
<p>oh it is</p>



<a name="226866878"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226866878" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226866878">(Feb 18 2021 at 19:32)</a>:</h4>
<p>if you touch just the right set of things you could write a native side of wasm-bindgen</p>



<a name="226866892"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226866892" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226866892">(Feb 18 2021 at 19:32)</a>:</h4>
<p>like you could just translate the JS glue code to Rust</p>



<a name="226866909"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226866909" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226866909">(Feb 18 2021 at 19:32)</a>:</h4>
<p>there's no fundamental reason that can't be done</p>



<a name="226866938"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226866938" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226866938">(Feb 18 2021 at 19:33)</a>:</h4>
<p>there's practical reasons for why I haven't done that though</p>



<a name="226867028"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226867028" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226867028">(Feb 18 2021 at 19:33)</a>:</h4>
<p>yeah that makes sense</p>



<a name="226867101"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226867101" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226867101">(Feb 18 2021 at 19:34)</a>:</h4>
<p><span class="user-mention silent" data-user-id="253994">Alex Crichton</span> <a href="#narrow/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication/near/226865541">said</a>:</p>
<blockquote>
<p>another aspect which may also be possible is to have two wasm blobs, one using wasm-bindgen for the web and one using handwritten stuff for wasmtime</p>
</blockquote>
<p>I'm trying to work out what exactly it would mean to do this</p>



<a name="226867116"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226867116" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226867116">(Feb 18 2021 at 19:34)</a>:</h4>
<p>I could create two totally different sets of extern functions</p>



<a name="226867134"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226867134" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226867134">(Feb 18 2021 at 19:34)</a>:</h4>
<p>but it feels like it'll just be the same thing twice with slightly different low-level protocols</p>



<a name="226867136"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226867136" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226867136">(Feb 18 2021 at 19:34)</a>:</h4>
<p>yeah that's' what i'm imagining</p>



<a name="226867154"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226867154" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226867154">(Feb 18 2021 at 19:34)</a>:</h4>
<p>basically</p>



<a name="226867159"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226867159" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226867159">(Feb 18 2021 at 19:34)</a>:</h4>
<p>ok, next question</p>



<a name="226867166"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226867166" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226867166">(Feb 18 2021 at 19:34)</a>:</h4>
<p>how do I learn wiggle?</p>



<a name="226867173"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226867173" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226867173">(Feb 18 2021 at 19:34)</a>:</h4>
<p>all the "meat" would be a shared rust dep</p>



<a name="226867197"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226867197" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226867197">(Feb 18 2021 at 19:34)</a>:</h4>
<p>wiggle is only intended for wasm-to-host communication at this time</p>



<a name="226867221"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226867221" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226867221">(Feb 18 2021 at 19:35)</a>:</h4>
<p>hm</p>



<a name="226867227"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226867227" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226867227">(Feb 18 2021 at 19:35)</a>:</h4>
<p>so while it's the right shape of what you want I don't think it's entirely waht you want</p>



<a name="226867247"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226867247" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226867247">(Feb 18 2021 at 19:35)</a>:</h4>
<p>b/c you also want "enriched" host-to-wasm communication</p>



<a name="226867255"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226867255" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226867255">(Feb 18 2021 at 19:35)</a>:</h4>
<p>I'm basically used to the JS story of just transferring very basic bytes</p>



<a name="226867262"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226867262" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226867262">(Feb 18 2021 at 19:35)</a>:</h4>
<p>and I don't mind having to do that</p>



<a name="226867277"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226867277" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226867277">(Feb 18 2021 at 19:35)</a>:</h4>
<p>but even that felt like a song and dance</p>



<a name="226867304"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226867304" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226867304">(Feb 18 2021 at 19:35)</a>:</h4>
<p>I could build WasmString on top of WasmSlice very easily, obviously</p>



<a name="226867333"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226867333" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226867333">(Feb 18 2021 at 19:35)</a>:</h4>
<p>I guess what I'm saying is I want WasmSlice in wasmtime :P</p>



<a name="226867344"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226867344" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226867344">(Feb 18 2021 at 19:35)</a>:</h4>
<p>in addition to <code>Memory</code></p>



<a name="226867387"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226867387" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226867387">(Feb 18 2021 at 19:36)</a>:</h4>
<p>at the limit, I can just transmute the hell out of things</p>



<a name="226867495"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226867495" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226867495">(Feb 18 2021 at 19:36)</a>:</h4>
<p>The new <code>Memory::read</code> API is close I think to what you might want</p>



<a name="226867527"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226867527" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226867527">(Feb 18 2021 at 19:37)</a>:</h4>
<p>perhaps coupled with another <code>Memory::read_vec</code>, <code>Memory::read_string</code>, and <code>Memory::read_str</code></p>



<a name="226867559"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226867559" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226867559">(Feb 18 2021 at 19:37)</a>:</h4>
<p>right</p>



<a name="226867566"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226867566" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226867566">(Feb 18 2021 at 19:37)</a>:</h4>
<p>which would require a tiny ABI</p>



<a name="226867578"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226867578" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226867578">(Feb 18 2021 at 19:37)</a>:</h4>
<p>basically len/ptr</p>



<a name="226867610"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226867610" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226867610">(Feb 18 2021 at 19:37)</a>:</h4>
<p>it also kinda sucks that Rust can't do multi-value easily</p>



<a name="226867627"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226867627" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226867627">(Feb 18 2021 at 19:38)</a>:</h4>
<p>like you want to write a wasm function that retuns two i32</p>



<a name="226867675"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226867675" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226867675">(Feb 18 2021 at 19:38)</a>:</h4>
<p>instead of a packed i64</p>



<a name="226867691"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226867691" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226867691">(Feb 18 2021 at 19:38)</a>:</h4>
<p>but Rust won't let you do that</p>



<a name="226867702"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226867702" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226867702">(Feb 18 2021 at 19:38)</a>:</h4>
<p>can't you just use a tuple?</p>



<a name="226867713"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226867713" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226867713">(Feb 18 2021 at 19:38)</a>:</h4>
<p>I guess I don't know the wasm abi for multi-value</p>



<a name="226867729"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226867729" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226867729">(Feb 18 2021 at 19:38)</a>:</h4>
<p>I guess you can just do <code>read()</code> and carefully make sure to make a Vec with the right capacity?</p>



<a name="226867806"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226867806" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226867806">(Feb 18 2021 at 19:39)</a>:</h4>
<p>it seems like read() is a bit of a rube goldberg machine for reading a certain amount of bytes</p>



<a name="226867821"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226867821" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226867821">(Feb 18 2021 at 19:39)</a>:</h4>
<p>first make a Vec with the right capacity</p>



<a name="226867825"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226867825" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226867825">(Feb 18 2021 at 19:39)</a>:</h4>
<p>well</p>



<a name="226867837"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226867837" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226867837">(Feb 18 2021 at 19:39)</a>:</h4>
<p>first read a u32</p>



<a name="226867862"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226867862" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226867862">(Feb 18 2021 at 19:39)</a>:</h4>
<p>then make a Vec::with_capacity(that size)</p>



<a name="226867869"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226867869" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226867869">(Feb 18 2021 at 19:39)</a>:</h4>
<p>then advance the ptr</p>



<a name="226867882"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226867882" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226867882">(Feb 18 2021 at 19:39)</a>:</h4>
<p>(by 4)</p>



<a name="226867889"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226867889" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226867889">(Feb 18 2021 at 19:39)</a>:</h4>
<p>then read()</p>



<a name="226867890"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226867890" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226867890">(Feb 18 2021 at 19:39)</a>:</h4>
<p>yeah that's what I mean with <code>read_vec</code> in addition to the <code>read</code> that we have today</p>



<a name="226867907"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226867907" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226867907">(Feb 18 2021 at 19:39)</a>:</h4>
<p>yeah</p>



<a name="226867926"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226867926" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226867926">(Feb 18 2021 at 19:40)</a>:</h4>
<p>like you should be able to do <code>memory.read(ptr..ptr+len)</code></p>



<a name="226867964"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226867964" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226867964">(Feb 18 2021 at 19:40)</a>:</h4>
<p>yeah</p>



<a name="226867982"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226867982" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226867982">(Feb 18 2021 at 19:40)</a>:</h4>
<p>and it allocates the <code>Vec</code> for you and all that</p>



<a name="226867989"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226867989" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226867989">(Feb 18 2021 at 19:40)</a>:</h4>
<p>it does?</p>



<a name="226868007"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226868007" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226868007">(Feb 18 2021 at 19:40)</a>:</h4>
<p>no I mean we should have an API that does that</p>



<a name="226868008"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226868008" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226868008">(Feb 18 2021 at 19:40)</a>:</h4>
<p>oh you're saying read_vec</p>



<a name="226868013"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226868013" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226868013">(Feb 18 2021 at 19:40)</a>:</h4>
<p>yeah</p>



<a name="226868014"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226868014" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226868014">(Feb 18 2021 at 19:40)</a>:</h4>
<p>oh sorry yeah</p>



<a name="226868018"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226868018" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226868018">(Feb 18 2021 at 19:40)</a>:</h4>
<p>like I said it would require an ABI</p>



<a name="226868046"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226868046" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226868046">(Feb 18 2021 at 19:40)</a>:</h4>
<p>which is a bit "new" to this API</p>



<a name="226868062"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226868062" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226868062">(Feb 18 2021 at 19:40)</a>:</h4>
<p>how does wasm_bindgen do it?</p>



<a name="226868133"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226868133" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226868133">(Feb 18 2021 at 19:41)</a>:</h4>
<p>hm you may need to be more precise</p>



<a name="226868144"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226868144" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226868144">(Feb 18 2021 at 19:41)</a>:</h4>
<p>do you mean like how does wasm-bindgen return a string from wasm to JS?</p>



<a name="226868268"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226868268" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226868268">(Feb 18 2021 at 19:42)</a>:</h4>
<p>yeah</p>



<a name="226868287"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226868287" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226868287">(Feb 18 2021 at 19:42)</a>:</h4>
<p>what's the protocol?</p>



<a name="226868326"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226868326" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226868326">(Feb 18 2021 at 19:42)</a>:</h4>
<p>I've seen people try to reverse engineer the ABI in various threads</p>



<a name="226868337"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226868337" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226868337">(Feb 18 2021 at 19:42)</a>:</h4>
<p>but it seemed crazy :P</p>



<a name="226868343"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226868343" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226868343">(Feb 18 2021 at 19:42)</a>:</h4>
<p>it's funky -- first 8 bytes of the shadow stack is reserved, and that return pointer is passed as the first parameter</p>



<a name="226868360"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226868360" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226868360">(Feb 18 2021 at 19:43)</a>:</h4>
<p>then when the call finishes the 8 bytes are interpreted as ptr/len</p>



<a name="226868373"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226868373" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226868373">(Feb 18 2021 at 19:43)</a>:</h4>
<p>the ptr/len are then copied out and decoded as utf-8</p>



<a name="226868376"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226868376" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226868376">(Feb 18 2021 at 19:43)</a>:</h4>
<p>then the ptr/len are freed</p>



<a name="226868393"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226868393" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226868393">(Feb 18 2021 at 19:43)</a>:</h4>
<p><span class="user-mention silent" data-user-id="253994">Alex Crichton</span> <a href="#narrow/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication/near/226868343">said</a>:</p>
<blockquote>
<p>it's funky -- first 8 bytes of the shadow stack is reserved, and that return pointer is passed as the first parameter</p>
</blockquote>
<p>is it really that crazy to make an API for the low-level details like the shadow stack?</p>



<a name="226868411"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226868411" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226868411">(Feb 18 2021 at 19:43)</a>:</h4>
<p>it must already be encapsulated for maintenance reasons</p>



<a name="226868471"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226868471" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226868471">(Feb 18 2021 at 19:44)</a>:</h4>
<p>not sure what you mean by encapsulated</p>



<a name="226868534"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226868534" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226868534">(Feb 18 2021 at 19:44)</a>:</h4>
<p>but this is indeed something we could expose an API for</p>



<a name="226868584"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226868584" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226868584">(Feb 18 2021 at 19:44)</a>:</h4>
<p>it's in a shaky realm though b/c we're just guessing what global is actually the shadow stack pointer, if any</p>



<a name="226868589"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226868589" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226868589">(Feb 18 2021 at 19:44)</a>:</h4>
<p>I just mean it must not be a bunch of spaghetti code strewn around</p>



<a name="226868603"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226868603" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226868603">(Feb 18 2021 at 19:44)</a>:</h4>
<p>otherwise you'd keep breaking the codegen :P</p>



<a name="226868606"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226868606" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226868606">(Feb 18 2021 at 19:44)</a>:</h4>
<p>most wasm modules don't even export the shadow stack pointer</p>



<a name="226868644"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226868644" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226868644">(Feb 18 2021 at 19:44)</a>:</h4>
<p>you mean like in wasm-bindgen?</p>



<a name="226868666"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226868666" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226868666">(Feb 18 2021 at 19:44)</a>:</h4>
<p>I think it's ok to say "your client must do XXX YYY ZZZ and your wasm module must expose AAA BBB CCC"</p>



<a name="226868667"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226868667" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226868667">(Feb 18 2021 at 19:44)</a>:</h4>
<p>right</p>



<a name="226868688"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226868688" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226868688">(Feb 18 2021 at 19:45)</a>:</h4>
<p>I literally used wasm-bindgen + wasm-objdump and it's not THAT crazy</p>



<a name="226868716"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226868716" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226868716">(Feb 18 2021 at 19:45)</a>:</h4>
<p>but eventually I was like "this is too hard" and implemented WasmSlice</p>



<a name="226868723"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226868723" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226868723">(Feb 18 2021 at 19:45)</a>:</h4>
<p>wasm-bindgen is a bit more powerful  here in that it has complete control over the .wasm output iteslf</p>



<a name="226868752"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226868752" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226868752">(Feb 18 2021 at 19:45)</a>:</h4>
<p>e.g. wasm-bindgen injects functions to manipulate the stack pointer</p>



<a name="226868775"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226868775" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226868775">(Feb 18 2021 at 19:45)</a>:</h4>
<p>b/c they're not natively present in the wasm file</p>



<a name="226868777"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226868777" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226868777">(Feb 18 2021 at 19:45)</a>:</h4>
<p>but those functions are totally decoupled from the details of a <em>JS</em> client, right?</p>



<a name="226868790"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226868790" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226868790">(Feb 18 2021 at 19:45)</a>:</h4>
<p>wasm-bindgen also just makes blind guesses as to what global is the stack pointer</p>



<a name="226868817"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226868817" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226868817">(Feb 18 2021 at 19:46)</a>:</h4>
<p>lol</p>



<a name="226868859"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226868859" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226868859">(Feb 18 2021 at 19:46)</a>:</h4>
<p>I mean "memory" being the magical memory name is also a protocol ;)</p>



<a name="226868864"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226868864" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226868864">(Feb 18 2021 at 19:46)</a>:</h4>
<p>oh I see, yes, what you mean about taking the exact output of wasm-bindgen and feeding it into rust</p>



<a name="226868888"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226868888" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226868888">(Feb 18 2021 at 19:46)</a>:</h4>
<p>:)</p>



<a name="226868918"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226868918" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226868918">(Feb 18 2021 at 19:46)</a>:</h4>
<p>I was looking at the code myself, but at some point I don't work on the codebase and I hit some walls</p>



<a name="226868932"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226868932" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226868932">(Feb 18 2021 at 19:46)</a>:</h4>
<p>but at a conceptual level it seems like it ought to work</p>



<a name="226868949"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226868949" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226868949">(Feb 18 2021 at 19:46)</a>:</h4>
<p>I can see why interface types takes up the mental oxygen, though</p>



<a name="226868962"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226868962" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226868962">(Feb 18 2021 at 19:47)</a>:</h4>
<p>oh yeah there's nothing stopping you from doing that</p>



<a name="226868994"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226868994" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226868994">(Feb 18 2021 at 19:47)</a>:</h4>
<p>like it's very plausible to add a "rust" output to wasm-bindgen</p>



<a name="226869019"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226869019" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226869019">(Feb 18 2021 at 19:47)</a>:</h4>
<p>where instead of spitting out *.wasm + *.js it spits out *.wasm + *.rs</p>



<a name="226869024"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226869024" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226869024">(Feb 18 2021 at 19:47)</a>:</h4>
<p>I think the use-case of "something that works with both a Rust client and a JS client" is good enough motivation, right?</p>



<a name="226869035"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226869035" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226869035">(Feb 18 2021 at 19:47)</a>:</h4>
<p>right exactly</p>



<a name="226869038"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226869038" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226869038">(Feb 18 2021 at 19:47)</a>:</h4>
<p>bingo</p>



<a name="226869042"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226869042" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226869042">(Feb 18 2021 at 19:47)</a>:</h4>
<p>that's exactly what I mean</p>



<a name="226869084"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226869084" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226869084">(Feb 18 2021 at 19:47)</a>:</h4>
<p>but this is what I mentioned earlier where it breaks down fairly quickly</p>



<a name="226869103"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226869103" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226869103">(Feb 18 2021 at 19:47)</a>:</h4>
<p>the main downside is it occupies the same space as interface types</p>



<a name="226869157"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226869157" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226869157">(Feb 18 2021 at 19:48)</a>:</h4>
<p>and wasm-bindgen is entirely Rust-specific</p>



<a name="226869212"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226869212" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226869212">(Feb 18 2021 at 19:48)</a>:</h4>
<p>but interface types won't work on the web without wasm-gc</p>



<a name="226869215"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226869215" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226869215">(Feb 18 2021 at 19:48)</a>:</h4>
<p>it also breaks down quickly once the *.rs needs to do something js-specific</p>



<a name="226869236"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226869236" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226869236">(Feb 18 2021 at 19:48)</a>:</h4>
<p>like you have a Rust function taking <code>&amp;JsValue</code> as an argument</p>



<a name="226869255"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226869255" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226869255">(Feb 18 2021 at 19:48)</a>:</h4>
<p>that's what I was thinking re: wasm_bindgen_core</p>



<a name="226869276"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226869276" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226869276">(Feb 18 2021 at 19:48)</a>:</h4>
<p>break out the non-JS parts of the protocol</p>



<a name="226869282"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226869282" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226869282">(Feb 18 2021 at 19:48)</a>:</h4>
<p>this is what I meant about multiple phases or interim-periods of interface types</p>



<a name="226869286"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226869286" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226869286">(Feb 18 2021 at 19:49)</a>:</h4>
<p>and you're limited to that if you want a truly portable .wasm</p>



<a name="226869290"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226869290" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226869290">(Feb 18 2021 at 19:49)</a>:</h4>
<p>yeah</p>



<a name="226869318"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226869318" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226869318">(Feb 18 2021 at 19:49)</a>:</h4>
<p>so like today the rust compiler spits out a <code>*.wasm</code> when you compile it and use wasm-bindgen</p>



<a name="226869331"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226869331" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226869331">(Feb 18 2021 at 19:49)</a>:</h4>
<p>that <code>*.wasm</code> has a whole bunch of weird wasm-bindgen-specific stuff</p>



<a name="226869353"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226869353" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226869353">(Feb 18 2021 at 19:49)</a>:</h4>
<p>imagine instead it spits out a <code>*.wasm</code> that's a <em>standard</em> wasm module using interface types</p>



<a name="226869385"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226869385" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226869385">(Feb 18 2021 at 19:49)</a>:</h4>
<p>you can then natively consume that <code>*.wasm</code> in wasmtime (since it's standard)</p>



<a name="226869387"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226869387" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226869387">(Feb 18 2021 at 19:49)</a>:</h4>
<p>yeah</p>



<a name="226869393"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226869393" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226869393">(Feb 18 2021 at 19:49)</a>:</h4>
<p>yeah</p>



<a name="226869399"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226869399" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226869399">(Feb 18 2021 at 19:49)</a>:</h4>
<p>and you can also run a tool to polyfill interface types for the web</p>



<a name="226869418"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226869418" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226869418">(Feb 18 2021 at 19:50)</a>:</h4>
<p>basically exactly what wasm-bindgen does today, except based on the standard</p>



<a name="226869460"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226869460" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226869460">(Feb 18 2021 at 19:50)</a>:</h4>
<p><span class="user-mention silent" data-user-id="253994">Alex Crichton</span> <a href="#narrow/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication/near/226869385">said</a>:</p>
<blockquote>
<p>you can then natively consume that <code>*.wasm</code> in wasmtime (since it's standard)</p>
</blockquote>
<p>as soon as wasmtime actually supports interface types</p>



<a name="226869490"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226869490" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226869490">(Feb 18 2021 at 19:50)</a>:</h4>
<p>you could imagine a polyfill even for wasmtime in the meantime</p>



<a name="226869496"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226869496" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226869496">(Feb 18 2021 at 19:50)</a>:</h4>
<p>according to the issue tracker, the answer to that is ... some time in the future?</p>



<a name="226869500"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226869500" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226869500">(Feb 18 2021 at 19:50)</a>:</h4>
<p>yeah</p>



<a name="226869511"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226869511" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226869511">(Feb 18 2021 at 19:50)</a>:</h4>
<p>I don't know how to write it tho :P</p>



<a name="226869524"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226869524" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226869524">(Feb 18 2021 at 19:50)</a>:</h4>
<p>I like the idea of using interface types as a meta-language for this</p>



<a name="226869543"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226869543" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226869543">(Feb 18 2021 at 19:50)</a>:</h4>
<p>correct yeah, this is basically going to happen but takes a lot of planning</p>



<a name="226869559"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226869559" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226869559">(Feb 18 2021 at 19:50)</a>:</h4>
<p>that can then be turned into the glue layer without needing Rust-specific logic</p>



<a name="226869572"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226869572" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226869572">(Feb 18 2021 at 19:50)</a>:</h4>
<p>we're inching forward but there's a lot of moving pieces and we also have to prioritize with work stuff</p>



<a name="226869579"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226869579" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226869579">(Feb 18 2021 at 19:50)</a>:</h4>
<p>I think that's what Luke pitched to me 3 years ago :P</p>



<a name="226869681"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226869681" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226869681">(Feb 18 2021 at 19:51)</a>:</h4>
<p>I think for now, I don't mind going down the "two extern functions path"</p>



<a name="226869703"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226869703" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226869703">(Feb 18 2021 at 19:51)</a>:</h4>
<p>as long as I feel confident about the safety properties</p>



<a name="226869706"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226869706" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226869706">(Feb 18 2021 at 19:51)</a>:</h4>
<p><code>.read()</code> is good</p>



<a name="226869796"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226869796" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226869796">(Feb 18 2021 at 19:52)</a>:</h4>
<p>more APIs on <code>Memory</code> should be able to give you the safety guarantee</p>



<a name="226869822"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226869822" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226869822">(Feb 18 2021 at 19:52)</a>:</h4>
<p>I feel you on the 3 years part though</p>



<a name="226869838"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226869838" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226869838">(Feb 18 2021 at 19:52)</a>:</h4>
<p>this is the part where standards are... hard</p>



<a name="226869868"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226869868" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226869868">(Feb 18 2021 at 19:52)</a>:</h4>
<p>like wasm-bindgen was easy b/c we could do whatever we wanted</p>



<a name="226869881"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226869881" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226869881">(Feb 18 2021 at 19:52)</a>:</h4>
<p>yeah</p>



<a name="226869901"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226869901" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226869901">(Feb 18 2021 at 19:53)</a>:</h4>
<p>but with interface types it's different b/c we're trying to design a system that lasts</p>



<a name="226870112"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226870112" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226870112">(Feb 18 2021 at 19:54)</a>:</h4>
<p>I think it makes sense to think about the web as a locus of standards control, imo</p>



<a name="226870127"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226870127" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226870127">(Feb 18 2021 at 19:54)</a>:</h4>
<p>the web is the forcing function</p>



<a name="226870237"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226870237" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226870237">(Feb 18 2021 at 19:55)</a>:</h4>
<p>if the entire theory of an API is based on a place where people can theoretically compete with the standard, it makes everything take 10x longer</p>



<a name="226870241"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226870241" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226870241">(Feb 18 2021 at 19:55)</a>:</h4>
<p>if not more :P</p>



<a name="226870344"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226870344" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226870344">(Feb 18 2021 at 19:56)</a>:</h4>
<p>heh true</p>



<a name="226870552"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226870552" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226870552">(Feb 18 2021 at 19:57)</a>:</h4>
<p>I don't have a very clear sense of how the people who are working on wasi think about wasi</p>



<a name="226870605"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226870605" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226870605">(Feb 18 2021 at 19:58)</a>:</h4>
<p>I know how to think of wasm of course</p>



<a name="226870636"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226870636" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226870636">(Feb 18 2021 at 19:58)</a>:</h4>
<p>ok, so it seems like my next steps ought to be:</p>



<a name="226870654"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226870654" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226870654">(Feb 18 2021 at 19:58)</a>:</h4>
<ul>
<li>wrap memory.read() to make WasmSlice simpler</li>
</ul>



<a name="226870706"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226870706" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226870706">(Feb 18 2021 at 19:58)</a>:</h4>
<ul>
<li>propose read_vec and read_str (or reply to an issue if you open it first)</li>
</ul>



<a name="226870764"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226870764" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226870764">(Feb 18 2021 at 19:59)</a>:</h4>
<ul>
<li>discuss/learn the wasm_bindgen protocol, so next time I want to talk about future directions I know enough to be useful</li>
</ul>



<a name="226870789"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226870789" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226870789">(Feb 18 2021 at 19:59)</a>:</h4>
<p>yeah that sounds good</p>



<a name="226870806"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226870806" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226870806">(Feb 18 2021 at 19:59)</a>:</h4>
<p>I'm making a PR for some more <code>read_*</code> methods soon</p>



<a name="226870953"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226870953" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226870953">(Feb 18 2021 at 20:00)</a>:</h4>
<p>I think I need to understand the song-and-dance with relation to freeing memory communicated through Memory</p>



<a name="226871257"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226871257" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226871257">(Feb 18 2021 at 20:02)</a>:</h4>
<p>I assume that to a first approximation, &amp; borrows give you what you need</p>



<a name="226871493"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226871493" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226871493">(Feb 18 2021 at 20:04)</a>:</h4>
<p><span class="user-mention silent" data-user-id="390627">Yehuda Katz</span> <a href="#narrow/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication/near/226871257">said</a>:</p>
<blockquote>
<p>I assume that to a first approximation, &amp; borrows give you what you need</p>
</blockquote>
<p>trying to figure out what the right place to put the wrapper that could borrow out of <code>Memory</code></p>



<a name="226871526"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226871526" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226871526">(Feb 18 2021 at 20:04)</a>:</h4>
<p>in general for safety you'll want to avoid borrowing <code>Memory</code> "for a long time"</p>



<a name="226871538"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226871538" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226871538">(Feb 18 2021 at 20:04)</a>:</h4>
<p>right</p>



<a name="226871548"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226871548" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226871548">(Feb 18 2021 at 20:04)</a>:</h4>
<p>you'll typically want to copy out</p>



<a name="226871561"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226871561" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226871561">(Feb 18 2021 at 20:04)</a>:</h4>
<p>I already have a wrapper around Module</p>



<a name="226871574"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226871574" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226871574">(Feb 18 2021 at 20:04)</a>:</h4>
<p>I could put read_vec in there</p>



<a name="226871644"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226871644" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226871644">(Feb 18 2021 at 20:05)</a>:</h4>
<p>the real question is:</p>



<a name="226871653"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226871653" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226871653">(Feb 18 2021 at 20:05)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">mem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">module</span><span class="p">.</span><span class="n">memory</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">source</span><span class="p">.</span><span class="n">len</span><span class="p">()</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">u32</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">ptr</span>: <span class="kt">u32</span> <span class="o">=</span><span class="w"> </span><span class="n">module</span><span class="p">.</span><span class="n">call1</span><span class="p">(</span><span class="s">"allocate"</span><span class="p">,</span><span class="w"> </span><span class="n">len</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">u32</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">slice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mem</span><span class="p">.</span><span class="n">data_ptr</span><span class="p">();</span><span class="w"></span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">zero</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">unsafe</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">slice</span><span class="p">.</span><span class="n">offset</span><span class="p">(</span><span class="n">ptr</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">isize</span><span class="p">)</span><span class="w"> </span><span class="p">};</span><span class="w"></span>

<span class="w">    </span><span class="k">unsafe</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">zero</span><span class="p">.</span><span class="n">copy_from</span><span class="p">(</span><span class="n">source</span><span class="p">.</span><span class="n">as_ptr</span><span class="p">(),</span><span class="w"> </span><span class="n">source</span><span class="p">.</span><span class="n">len</span><span class="p">())</span><span class="w"> </span><span class="p">};</span><span class="w"></span>

<span class="w">    </span><span class="c1">// slice[ptr] = len;</span>
<span class="w">    </span><span class="n">module</span><span class="p">.</span><span class="n">call2</span><span class="p">(</span><span class="s">"hello"</span><span class="p">,</span><span class="w"> </span><span class="n">ptr</span><span class="p">,</span><span class="w"> </span><span class="n">source</span><span class="p">.</span><span class="n">len</span><span class="p">()</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">u32</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
</code></pre></div>



<a name="226871669"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226871669" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226871669">(Feb 18 2021 at 20:05)</a>:</h4>
<p>is this song-and-dance actually legit?</p>



<a name="226871801"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226871801" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226871801">(Feb 18 2021 at 20:06)</a>:</h4>
<p>I would recommend using <code>memory.write(ptr as usize, &amp;source).unwrap()</code>, but yes</p>



<a name="226871919"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226871919" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226871919">(Feb 18 2021 at 20:07)</a>:</h4>
<p>I saw some comments about the stability of offsets, but I'm not actually casting anything into actual pointers</p>



<a name="226871968"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226871968" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226871968">(Feb 18 2021 at 20:07)</a>:</h4>
<p>but is it possible for <code>ptr</code> to move?</p>



<a name="226871993"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226871993" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226871993">(Feb 18 2021 at 20:07)</a>:</h4>
<p>also: should I be calling grow() somewhere?</p>



<a name="226872011"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226872011" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226872011">(Feb 18 2021 at 20:07)</a>:</h4>
<p>do I need to drop() something somewhere?</p>



<a name="226872128"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226872128" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226872128">(Feb 18 2021 at 20:08)</a>:</h4>
<p>so <code>ptr</code> cannot move because it is relative to the memory base</p>



<a name="226872143"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226872143" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226872143">(Feb 18 2021 at 20:08)</a>:</h4>
<p><code>slice</code> can move due to <code>memory.grow</code></p>



<a name="226872182"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226872182" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226872182">(Feb 18 2021 at 20:08)</a>:</h4>
<p>you do not need to <code>memory.grow</code> because <code>allocate</code> will do that internally if necessary</p>



<a name="226872261"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226872261" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226872261">(Feb 18 2021 at 20:09)</a>:</h4>
<p>ah</p>



<a name="226872278"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226872278" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226872278">(Feb 18 2021 at 20:09)</a>:</h4>
<p>is the allocate song-and-dance roughly correct?</p>



<a name="226872300"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226872300" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226872300">(Feb 18 2021 at 20:09)</a>:</h4>
<p>TLDR make an allocate function in the WASM Rust</p>



<a name="226872306"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226872306" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226872306">(Feb 18 2021 at 20:09)</a>:</h4>
<p>yes</p>



<a name="226872307"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226872307" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226872307">(Feb 18 2021 at 20:09)</a>:</h4>
<p>call it</p>



<a name="226872308"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226872308" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226872308">(Feb 18 2021 at 20:09)</a>:</h4>
<p>get a ptr</p>



<a name="226872318"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226872318" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226872318">(Feb 18 2021 at 20:09)</a>:</h4>
<p>is it correct to cast to u32?</p>



<a name="226872344"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226872344" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226872344">(Feb 18 2021 at 20:10)</a>:</h4>
<p>yes</p>



<a name="226872365"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226872365" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226872365">(Feb 18 2021 at 20:10)</a>:</h4>
<p>I'm assuming wasm32, which seems like it should be fine</p>



<a name="226872387"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226872387" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226872387">(Feb 18 2021 at 20:10)</a>:</h4>
<p>phew</p>



<a name="226872419"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226872419" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226872419">(Feb 18 2021 at 20:10)</a>:</h4>
<p>well <code>allocate</code> will have an exact signature</p>



<a name="226872430"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226872430" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226872430">(Feb 18 2021 at 20:10)</a>:</h4>
<p>and it'll probably return an <code>i32</code></p>



<a name="226872456"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226872456" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226872456">(Feb 18 2021 at 20:10)</a>:</h4>
<p>so if you say <code>i64</code> then your rust code will just fail at runtime saying the signatures mismatch</p>



<a name="226872488"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226872488" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226872488">(Feb 18 2021 at 20:10)</a>:</h4>
<p><span class="user-mention silent" data-user-id="253994">Alex Crichton</span> <a href="#narrow/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication/near/226872143">said</a>:</p>
<blockquote>
<p><code>slice</code> can move due to <code>memory.grow</code></p>
</blockquote>
<p>so just make sure to use it "now"?</p>



<a name="226872500"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226872500" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226872500">(Feb 18 2021 at 20:10)</a>:</h4>
<p>i.e. make it ~ <code>&amp;</code>?</p>



<a name="226872501"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226872501" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226872501">(Feb 18 2021 at 20:10)</a>:</h4>
<p>yep</p>



<a name="226872515"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226872515" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226872515">(Feb 18 2021 at 20:10)</a>:</h4>
<p>ok</p>



<a name="226872520"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226872520" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226872520">(Feb 18 2021 at 20:11)</a>:</h4>
<p>this is why i'd recommend <code>memory.write</code></p>



<a name="226872528"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226872528" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226872528">(Feb 18 2021 at 20:11)</a>:</h4>
<p>yeah that makes sense</p>



<a name="226872530"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226872530" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226872530">(Feb 18 2021 at 20:11)</a>:</h4>
<p>b/c that's a safe API</p>



<a name="226872543"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226872543" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226872543">(Feb 18 2021 at 20:11)</a>:</h4>
<p>I was stuck on the 0.21 docs for a while</p>



<a name="226872584"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226872584" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226872584">(Feb 18 2021 at 20:11)</a>:</h4>
<p>also had no internet or power</p>



<a name="226872586"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226872586" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226872586">(Feb 18 2021 at 20:11)</a>:</h4>
<p>it was fun times :P</p>



<a name="226872715"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226872715" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226872715">(Feb 18 2021 at 20:12)</a>:</h4>
<p>oh dear :(</p>



<a name="226885267"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226885267" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226885267">(Feb 18 2021 at 21:39)</a>:</h4>
<p><span class="user-mention" data-user-id="253994">@Alex Crichton</span> I'm trying to make the changes you recommended, and I was wondering why the <code>Memory</code> APIs use <code>usize</code></p>



<a name="226885368"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226885368" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226885368">(Feb 18 2021 at 21:40)</a>:</h4>
<p>I didn't review them that closely</p>



<a name="226885381"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226885381" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226885381">(Feb 18 2021 at 21:40)</a>:</h4>
<p>I guess it makes sense at a low-level, but you need to get the underlying pointers as <code>u32</code> because wasm32</p>



<a name="226885390"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226885390" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226885390">(Feb 18 2021 at 21:40)</a>:</h4>
<p>so then you end up with blind casts to usize</p>



<a name="226885437"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226885437" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226885437">(Feb 18 2021 at 21:40)</a>:</h4>
<p>We may want to take u64 even since there's memory64 one day too, but I think I agree that <code>usize</code> is wrong</p>



<a name="226885530"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226885530" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226885530">(Feb 18 2021 at 21:41)</a>:</h4>
<p>yeah I don't mind u64</p>



<a name="226885547"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226885547" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226885547">(Feb 18 2021 at 21:41)</a>:</h4>
<p>but it's not actually talking about the host's memory sizes :P</p>



<a name="226885574"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226885574" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226885574">(Feb 18 2021 at 21:41)</a>:</h4>
<p>we may want a type a la usize for the client's sizes</p>



<a name="226885595"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226885595" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226885595">(Feb 18 2021 at 21:41)</a>:</h4>
<p>csize :P</p>



<a name="226885674"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226885674" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226885674">(Feb 18 2021 at 21:42)</a>:</h4>
<p>I admit that I have given 0 thought to portability or evolution ;)</p>



<a name="226885742"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226885742" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226885742">(Feb 18 2021 at 21:42)</a>:</h4>
<p>the funny thing about the errors is that you get stern warnings like:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">you</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">convert</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="err">`</span><span class="kt">u32</span><span class="err">`</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="err">`</span><span class="kt">usize</span><span class="err">`</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">panic</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">converted</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="n">doesn</span><span class="o">'</span><span class="na">t</span><span class="w"> </span><span class="n">fit</span><span class="w"> </span><span class="n">rustc</span><span class="w"> </span><span class="n">E0308</span><span class="w"></span>
</code></pre></div>



<a name="226885992"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226885992" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226885992">(Feb 18 2021 at 21:44)</a>:</h4>
<p>yeah I think rustc warnings are starting to go off the deep end...</p>



<a name="226886004"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226886004" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226886004">(Feb 18 2021 at 21:45)</a>:</h4>
<p>I literally never read them</p>



<a name="226886121"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226886121" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226886121">(Feb 18 2021 at 21:46)</a>:</h4>
<p>hm so one difference between .read() and what I was doing before is that <code>read</code> forces you to copy out of the memory</p>



<a name="226886176"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226886176" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226886176">(Feb 18 2021 at 21:46)</a>:</h4>
<p>maybe I want that anyway?</p>



<a name="226886198"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226886198" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226886198">(Feb 18 2021 at 21:46)</a>:</h4>
<p>I was doing this before:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">        </span><span class="o">&amp;</span><span class="n">memory</span><span class="p">.</span><span class="n">data_unchecked</span><span class="p">()[(</span><span class="bp">self</span><span class="p">.</span><span class="n">ptr</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">usize</span><span class="p">)</span><span class="o">..</span><span class="p">][</span><span class="o">..</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">len</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">usize</span><span class="p">)]</span><span class="w"></span>
</code></pre></div>



<a name="226886214"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226886214" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226886214">(Feb 18 2021 at 21:46)</a>:</h4>
<p>which lets me have this signature:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">unsafe</span><span class="w"> </span><span class="k">fn</span> <span class="nf">as_buf</span><span class="o">&lt;'</span><span class="na">memory</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">memory</span>: <span class="kp">&amp;</span><span class="o">'</span><span class="na">memory</span> <span class="nc">Memory</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kp">&amp;</span><span class="o">'</span><span class="na">memory</span> <span class="p">[</span><span class="kt">u8</span><span class="p">]</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
</code></pre></div>



<a name="226886224"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226886224" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226886224">(Feb 18 2021 at 21:46)</a>:</h4>
<p>obviously the unsafe is not very nice</p>



<a name="226886259"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226886259" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226886259">(Feb 18 2021 at 21:47)</a>:</h4>
<p>but it seems like as long as I have a <code>&amp;Memory</code>, I ought to be able to borrow out of it safely?</p>



<a name="226886316"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226886316" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226886316">(Feb 18 2021 at 21:47)</a>:</h4>
<p>yes and no, that's basically what this talks about -- <a href="https://docs.rs/wasmtime/0.23.0/wasmtime/struct.Memory.html#memory-and-safety">https://docs.rs/wasmtime/0.23.0/wasmtime/struct.Memory.html#memory-and-safety</a></p>



<a name="226886466"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226886466" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226886466">(Feb 18 2021 at 21:48)</a>:</h4>
<p>I guess I don't really know what <code>unsafe</code> is vis a vis wasm memory</p>



<a name="226886520"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226886520" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226886520">(Feb 18 2021 at 21:49)</a>:</h4>
<p>use-after-free in Rust</p>



<a name="226886525"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226886525" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226886525">(Feb 18 2021 at 21:49)</a>:</h4>
<p>segfaults in Rust</p>



<a name="226886530"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226886530" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226886530">(Feb 18 2021 at 21:49)</a>:</h4>
<p>hm</p>



<a name="226886531"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226886531" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226886531">(Feb 18 2021 at 21:49)</a>:</h4>
<p>etc, etc</p>



<a name="226886555"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226886555" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226886555">(Feb 18 2021 at 21:49)</a>:</h4>
<p>basically it's literal UB</p>



<a name="226886556"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226886556" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226886556">(Feb 18 2021 at 21:49)</a>:</h4>
<p>but shouldn't the RefCell be protecting us from that?</p>



<a name="226886563"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226886563" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226886563">(Feb 18 2021 at 21:49)</a>:</h4>
<p>I guess there's no way to actually lock the memory to prevent wasm code from writing to it</p>



<a name="226886570"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226886570" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226886570">(Feb 18 2021 at 21:49)</a>:</h4>
<p>no b/c this has to do with UB in the Rust type system</p>



<a name="226886582"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226886582" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226886582">(Feb 18 2021 at 21:49)</a>:</h4>
<p>since it can be happily running in some other thread</p>



<a name="226886649"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226886649" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226886649">(Feb 18 2021 at 21:50)</a>:</h4>
<p>I basically want to be able to have a GIL I think :P</p>



<a name="226886657"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226886657" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226886657">(Feb 18 2021 at 21:50)</a>:</h4>
<p>right so you're not looking at <code>&amp;[Cell&lt;u8&gt;]</code></p>



<a name="226886666"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226886666" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226886666">(Feb 18 2021 at 21:50)</a>:</h4>
<p>right</p>



<a name="226886670"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226886670" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226886670">(Feb 18 2021 at 21:50)</a>:</h4>
<p>you get <code>&amp;mut [u8]</code> which has a lot of Rust guarantees</p>



<a name="226886679"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226886679" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226886679">(Feb 18 2021 at 21:50)</a>:</h4>
<p>but also the pointer itself is not stable</p>



<a name="226886689"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226886689" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226886689">(Feb 18 2021 at 21:50)</a>:</h4>
<p>Both Neon and Helix ended up  introducing a GIL for this ~ reason</p>



<a name="226886692"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226886692" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226886692">(Feb 18 2021 at 21:50)</a>:</h4>
<p>every <code>memory.grow</code> can invalidate it</p>



<a name="226886714"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226886714" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226886714">(Feb 18 2021 at 21:50)</a>:</h4>
<p>the truth is that copying is not so bad</p>



<a name="226886725"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226886725" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226886725">(Feb 18 2021 at 21:50)</a>:</h4>
<p>indeed</p>



<a name="226886727"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226886727" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226886727">(Feb 18 2021 at 21:50)</a>:</h4>
<p>it's basically memcpy <span aria-label="shrug" class="emoji emoji-1f937" role="img" title="shrug">:shrug:</span></p>



<a name="226886735"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226886735" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226886735">(Feb 18 2021 at 21:50)</a>:</h4>
<p>all copies in an out of memory are safe</p>



<a name="226886745"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226886745" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226886745">(Feb 18 2021 at 21:51)</a>:</h4>
<p>(that's what interface types basically do)</p>



<a name="226886848"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226886848" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226886848">(Feb 18 2021 at 21:52)</a>:</h4>
<p>hehe MemoryAccessError</p>



<a name="226886903"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226886903" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226886903">(Feb 18 2021 at 21:52)</a>:</h4>
<p>we finally got our OOM results</p>



<a name="226886984"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226886984" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226886984">(Feb 18 2021 at 21:52)</a>:</h4>
<p>yeah most of <code>Memory</code> is for interacting with a "possibly hostile" wasm module</p>



<a name="226886989"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226886989" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226886989">(Feb 18 2021 at 21:52)</a>:</h4>
<p>but in your use case the wasm module is trusted</p>



<a name="226886999"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226886999" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226886999">(Feb 18 2021 at 21:52)</a>:</h4>
<p>yeah</p>



<a name="226887019"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226887019" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226887019">(Feb 18 2021 at 21:53)</a>:</h4>
<p>for example it seems pointless to do UTF-8 checks</p>



<a name="226887420"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226887420" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226887420">(Feb 18 2021 at 21:56)</a>:</h4>
<p><span class="user-mention" data-user-id="253994">@Alex Crichton</span> I ended up creating a WasmUnwrap trait that uses my own custom error function to panic</p>



<a name="226887464"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226887464" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226887464">(Feb 18 2021 at 21:56)</a>:</h4>
<p>is this crazy?</p>



<a name="226887494"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226887494" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226887494">(Feb 18 2021 at 21:56)</a>:</h4>
<p>basically I couldn't use the one everyone uses because I'm not JS</p>



<a name="226887649"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226887649" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226887649">(Feb 18 2021 at 21:57)</a>:</h4>
<p>uh... maybe?</p>



<a name="226887660"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226887660" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226887660">(Feb 18 2021 at 21:57)</a>:</h4>
<p>not entirely sure the context in which this trait exists</p>



<a name="226887675"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226887675" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226887675">(Feb 18 2021 at 21:57)</a>:</h4>
<p>and fwiw I'd still do utf-8 checks and unwrap them</p>



<a name="226887680"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226887680" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226887680">(Feb 18 2021 at 21:57)</a>:</h4>
<p>we could change that crate to allow the user to customize the wasm function to call</p>



<a name="226887691"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226887691" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226887691">(Feb 18 2021 at 21:57)</a>:</h4>
<p>it's always better to get panics instead of UB on busg</p>



<a name="226887698"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226887698" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226887698">(Feb 18 2021 at 21:58)</a>:</h4>
<p>yeah sure</p>



<a name="226887702"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226887702" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226887702">(Feb 18 2021 at 21:58)</a>:</h4>
<p>:)</p>



<a name="226887778"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226887778" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226887778">(Feb 18 2021 at 21:58)</a>:</h4>
<p><span class="user-mention" data-user-id="253994">@Alex Crichton</span> it's for cases where I'd have written unwrap() or expect()</p>



<a name="226887791"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226887791" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226887791">(Feb 18 2021 at 21:58)</a>:</h4>
<p>in the wasm blob itself?</p>



<a name="226887813"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226887813" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226887813">(Feb 18 2021 at 21:58)</a>:</h4>
<p>yah</p>



<a name="226887830"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226887830" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226887830">(Feb 18 2021 at 21:58)</a>:</h4>
<p>ah I see, yeah that works</p>



<a name="226887844"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226887844" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226887844">(Feb 18 2021 at 21:58)</a>:</h4>
<p>it assumes:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">extern</span><span class="w"> </span><span class="s">"C"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">log_str</span><span class="p">(</span><span class="n">ptr</span>: <span class="kt">u64</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="226887857"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226887857" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226887857">(Feb 18 2021 at 21:59)</a>:</h4>
<p>which is less coupled than the JS one</p>



<a name="226887863"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226887863" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226887863">(Feb 18 2021 at 21:59)</a>:</h4>
<p>this is an unfortunate thing where wasm32-wasi "just works" but wasm32-unknown-unknown doesn't</p>



<a name="226887867"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226887867" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226887867">(Feb 18 2021 at 21:59)</a>:</h4>
<p>bio break, then call</p>



<a name="226887871"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/more%20ergonomic%20host/wasm%20communication/near/226887871" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yehuda Katz <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/more.20ergonomic.20host.2Fwasm.20communication.html#226887871">(Feb 18 2021 at 21:59)</a>:</h4>
<p>right</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>