<html>
<head><meta charset="utf-8"><title>✔ `canonical_abi` has not been defined · wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/index.html">wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20.60canonical_abi.60.20has.20not.20been.20defined.html">✔ `canonical_abi` has not been defined</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="254620463"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20%60canonical_abi%60%20has%20not%20been%20defined/near/254620463" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Carl Sverre <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20.60canonical_abi.60.20has.20not.20been.20defined.html#254620463">(Sep 23 2021 at 23:17)</a>:</h4>
<p>I am using the latest version (main) of witx-bindgen and running into the error <code>"canonical_abi" has not been defined</code>.  I have a function defined on the host which returns a reference. On the wasm side I am simply echoing the resource back to the host.</p>
<p>Do I need to link something?  If I get rid of the resource stuff and just use s32 instead everything works.</p>



<a name="254620512"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20%60canonical_abi%60%20has%20not%20been%20defined/near/254620512" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Carl Sverre <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20.60canonical_abi.60.20has.20not.20been.20defined.html#254620512">(Sep 23 2021 at 23:17)</a>:</h4>
<p>The witx I am using for the host api is:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">resource</span><span class="w"> </span><span class="n">Row</span><span class="w"></span>

<span class="n">next</span>: <span class="nc">function</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">Row</span><span class="w"></span>
<span class="n">emit</span>: <span class="nc">function</span><span class="p">(</span><span class="n">r</span>: <span class="nc">Row</span><span class="p">)</span><span class="w"></span>
</code></pre></div>



<a name="254620523"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20%60canonical_abi%60%20has%20not%20been%20defined/near/254620523" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Carl Sverre <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20.60canonical_abi.60.20has.20not.20been.20defined.html#254620523">(Sep 23 2021 at 23:17)</a>:</h4>
<p>the host defines Row as simply a simple struct for now</p>



<a name="254620528"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20%60canonical_abi%60%20has%20not%20been%20defined/near/254620528" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Carl Sverre <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20.60canonical_abi.60.20has.20not.20been.20defined.html#254620528">(Sep 23 2021 at 23:17)</a>:</h4>
<p>and I am using rust</p>



<a name="254621825"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20%60canonical_abi%60%20has%20not%20been%20defined/near/254621825" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20.60canonical_abi.60.20has.20not.20been.20defined.html#254621825">(Sep 23 2021 at 23:32)</a>:</h4>
<p>Hm that sounds like a bug in the generated code, can you open an issue for this?</p>



<a name="254621915"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20%60canonical_abi%60%20has%20not%20been%20defined/near/254621915" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Carl Sverre <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20.60canonical_abi.60.20has.20not.20been.20defined.html#254621915">(Sep 23 2021 at 23:33)</a>:</h4>
<p>sure thing</p>



<a name="254621994"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20%60canonical_abi%60%20has%20not%20been%20defined/near/254621994" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Carl Sverre <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20.60canonical_abi.60.20has.20not.20been.20defined.html#254621994">(Sep 23 2021 at 23:34)</a>:</h4>
<p>sounds like this PR might be relevant? <a href="https://github.com/WebAssembly/interface-types/pull/132">https://github.com/WebAssembly/interface-types/pull/132</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/WebAssembly/interface-types/pull/132" style="background-image: url(https://opengraph.githubassets.com/2d3327caf3256d542987c2b496103d1e94b962ea8a61d51e59a4cd35f24d2530/WebAssembly/interface-types/pull/132)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/WebAssembly/interface-types/pull/132" title="Add a draft &quot;canonical ABI&quot; by alexcrichton · Pull Request #132 · WebAssembly/interface-types">Add a draft "canonical ABI" by alexcrichton · Pull Request #132 · WebAssembly/interface-types</a></div><div class="message_embed_description">This PR proposes a &quot;canonical ABI&quot; for interface types. This feature was
alluded to in Luke&#39;s recent presentation to the CG, and this PR
intends to flesh it out more and get a more fo...</div></div></div>



<a name="254622812"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20%60canonical_abi%60%20has%20not%20been%20defined/near/254622812" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Carl Sverre <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20.60canonical_abi.60.20has.20not.20been.20defined.html#254622812">(Sep 23 2021 at 23:44)</a>:</h4>
<p><a href="https://github.com/bytecodealliance/witx-bindgen/issues/76">https://github.com/bytecodealliance/witx-bindgen/issues/76</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/witx-bindgen/issues/76" style="background-image: url(https://opengraph.githubassets.com/4804afcde1b5a5d11f481af7c5e6bd060c5d27de98dcb5973d9c01bcf7629476/bytecodealliance/witx-bindgen/issues/76)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/witx-bindgen/issues/76" title="canonical_abi has not been defined · Issue #76 · bytecodealliance/witx-bindgen">canonical_abi has not been defined · Issue #76 · bytecodealliance/witx-bindgen</a></div><div class="message_embed_description">I have a very trivial setup to play with witx types. To reproduce the problem just run cargo run from the root directory. (requires nightly) Use a vscode devcontainer to reproduce my exact environm...</div></div></div>



<a name="254746891"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20%60canonical_abi%60%20has%20not%20been%20defined/near/254746891" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Carl Sverre <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20.60canonical_abi.60.20has.20not.20been.20defined.html#254746891">(Sep 24 2021 at 18:04)</a>:</h4>
<p><span class="user-mention" data-user-id="253994">@Alex Crichton</span> any ideas on the issue?  It's a bit difficult to hack around</p>



<a name="254747115"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20%60canonical_abi%60%20has%20not%20been%20defined/near/254747115" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20.60canonical_abi.60.20has.20not.20been.20defined.html#254747115">(Sep 24 2021 at 18:05)</a>:</h4>
<p>oops meant to dig in this morning but forgot, let me take a look now</p>



<a name="254747136"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20%60canonical_abi%60%20has%20not%20been%20defined/near/254747136" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Carl Sverre <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20.60canonical_abi.60.20has.20not.20been.20defined.html#254747136">(Sep 24 2021 at 18:05)</a>:</h4>
<p>thanks!</p>



<a name="254748121"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20%60canonical_abi%60%20has%20not%20been%20defined/near/254748121" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20.60canonical_abi.60.20has.20not.20been.20defined.html#254748121">(Sep 24 2021 at 18:12)</a>:</h4>
<p>oh so the bad error message is because of <code>wasm_module_linking(true)</code></p>



<a name="254748132"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20%60canonical_abi%60%20has%20not%20been%20defined/near/254748132" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20.60canonical_abi.60.20has.20not.20been.20defined.html#254748132">(Sep 24 2021 at 18:12)</a>:</h4>
<p>that's a bug in wasmtime</p>



<a name="254748152"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20%60canonical_abi%60%20has%20not%20been%20defined/near/254748152" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20.60canonical_abi.60.20has.20not.20been.20defined.html#254748152">(Sep 24 2021 at 18:12)</a>:</h4>
<p>otherwise I see the issue, should be an easy fix on witx-bindgen's part</p>



<a name="254749617"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20%60canonical_abi%60%20has%20not%20been%20defined/near/254749617" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20.60canonical_abi.60.20has.20not.20been.20defined.html#254749617">(Sep 24 2021 at 18:22)</a>:</h4>
<p>ok should be fixed by &lt;<a href="https://github.com/bytecodealliance/witx-bindgen/pull/79">https://github.com/bytecodealliance/witx-bindgen/pull/79</a>&gt;</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/witx-bindgen/pull/79" style="background-image: url(https://opengraph.githubassets.com/2ec1edfe154e23a94b7f7d40e055995123f2e1670cfe55cdf674aa806c0cfcb5/bytecodealliance/witx-bindgen/pull/79)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/witx-bindgen/pull/79" title="Fix names defining resource intrinsics in Wasmtime by alexcrichton · Pull Request #79 · bytecodealliance/witx-bindgen">Fix names defining resource intrinsics in Wasmtime by alexcrichton · Pull Request #79 · bytecodealliance/witx-bindgen</a></div><div class="message_embed_description">There was an accidentaly .to_snake_case() when it should have been
using the raw name from the witx.
Closes #76</div></div></div>



<a name="254750427"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20%60canonical_abi%60%20has%20not%20been%20defined/near/254750427" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20.60canonical_abi.60.20has.20not.20been.20defined.html#254750427">(Sep 24 2021 at 18:28)</a>:</h4>
<p>and I've submitted <a href="https://github.com/bytecodealliance/wasmtime/issues/3388">https://github.com/bytecodealliance/wasmtime/issues/3388</a> for the bad error message</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wasmtime/issues/3388" style="background-image: url(https://opengraph.githubassets.com/c1bf432eb49e82174d09a68d48109a159157b47a7ee9df95433e488f3bc99e6c/bytecodealliance/wasmtime/issues/3388)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wasmtime/issues/3388" title="Poor linking error message with module linking enabled · Issue #3388 · bytecodealliance/wasmtime">Poor linking error message with module linking enabled · Issue #3388 · bytecodealliance/wasmtime</a></div><div class="message_embed_description">For this program: use wasmtime::*; fn main() { let mut config = Config::new(); config.wasm_module_linking(true); let engine = Engine::new(&amp;config).unwrap(); let module = Module::new( &amp;engin...</div></div></div>



<a name="254754817"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20%60canonical_abi%60%20has%20not%20been%20defined/near/254754817" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Carl Sverre <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20.60canonical_abi.60.20has.20not.20been.20defined.html#254754817">(Sep 24 2021 at 18:58)</a>:</h4>
<p>woohoo - thanks for the fast turn around.  I'll test your PR against my diff</p>



<a name="254781227"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20%60canonical_abi%60%20has%20not%20been%20defined/near/254781227" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Carl Sverre <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20.60canonical_abi.60.20has.20not.20been.20defined.html#254781227">(Sep 24 2021 at 22:19)</a>:</h4>
<p>works great - thanks for the quick turnaround</p>



<a name="254781239"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20%60canonical_abi%60%20has%20not%20been%20defined/near/254781239" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20.60canonical_abi.60.20has.20not.20been.20defined.html#254781239">(Sep 24 2021 at 22:19)</a>:</h4>
<p><span class="user-mention silent" data-user-id="434337">Carl Sverre</span> has marked this topic as resolved.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>