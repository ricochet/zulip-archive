<html>
<head><meta charset="utf-8"><title>Mac M1 CI 路 wasmtime 路 Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/index.html">wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/Mac.20M1.20CI.html">Mac M1 CI</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="240967389"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/Mac%20M1%20CI/near/240967389" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Benjamin Bouvier <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/Mac.20M1.20CI.html#240967389">(Jun 01 2021 at 16:24)</a>:</h4>
<p>Hi all! After observing that a recent regression creeped in into a stable release of wasmtime on Mac M1 (that happens in software engineering!), we at Embark Studios have decided that we needed to help with a stopgap solution to set up some CI on Mac M1, without fiddling with Github actions runner.</p>
<p>And here it is! Wasmtime is now being daily tested on an in-house Mac M1, as part of this public repository's CI: <a href="https://github.com/EmbarkStudios/wasmtime-aarch64-apple-darwin">https://github.com/EmbarkStudios/wasmtime-aarch64-apple-darwin</a><br>
While not running on every single commit, it should help us identify new test failures and notice regressions a bit quicker!</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/EmbarkStudios/wasmtime-aarch64-apple-darwin" style="background-image: url(https://opengraph.githubassets.com/5afcd4e3c1e035cbad694927758a1097e7ab7c59af69a34b96c41e3b044e57d2/EmbarkStudios/wasmtime-aarch64-apple-darwin)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/EmbarkStudios/wasmtime-aarch64-apple-darwin" title="EmbarkStudios/wasmtime-aarch64-apple-darwin">EmbarkStudios/wasmtime-aarch64-apple-darwin</a></div><div class="message_embed_description">A (hopefully temporary) repo to run wasmtime's test on our internal aarch64-apple-darwin CD until github actions adds support - EmbarkStudios/wasmtime-aarch64-apple-darwin</div></div></div>



<a name="240968602"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/Mac%20M1%20CI/near/240968602" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/Mac.20M1.20CI.html#240968602">(Jun 01 2021 at 16:32)</a>:</h4>
<p>Nice! What's the trigger for that CI? Is it expected to run daily?</p>



<a name="240968674"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/Mac%20M1%20CI/near/240968674" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/Mac.20M1.20CI.html#240968674">(Jun 01 2021 at 16:33)</a>:</h4>
<blockquote>
<p><code>    Finished test [unoptimized + debuginfo] target(s) in 1m 18s</code></p>
</blockquote>
<p>also holy cow</p>



<a name="240969038"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/Mac%20M1%20CI/near/240969038" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/Mac.20M1.20CI.html#240969038">(Jun 01 2021 at 16:36)</a>:</h4>
<p>This is great, thanks <span class="user-mention" data-user-id="254393">@Benjamin Bouvier</span> and Embark!</p>



<a name="240982694"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/Mac%20M1%20CI/near/240982694" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Benjamin Bouvier <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/Mac.20M1.20CI.html#240982694">(Jun 01 2021 at 18:16)</a>:</h4>
<p><span class="user-mention" data-user-id="253994">@Alex Crichton</span> it can be triggered manually for Embarkers, otherwise it'll run daily at 3am CET</p>



<a name="241129006"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/Mac%20M1%20CI/near/241129006" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Benjamin Bouvier <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/Mac.20M1.20CI.html#241129006">(Jun 02 2021 at 10:11)</a>:</h4>
<p>Note the repo has been marked internal because security concerns, but the CI will still be running and reports be available at <a href="https://buildkite.com/embark-studios/wasmtime-aarch64-apple-darwin?branch=main">https://buildkite.com/embark-studios/wasmtime-aarch64-apple-darwin?branch=main</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://buildkite.com/embark-studios/wasmtime-aarch64-apple-darwin?branch=main" style="background-image: url(https://buildkiteassets.com/assets/opengraph_default-b929dc7cf439d0d4aac222c96bb82f872532c4e384b5033e811848e97356a030.png)"></a><div class="data-container"><div class="message_embed_title"><a href="https://buildkite.com/embark-studios/wasmtime-aarch64-apple-darwin?branch=main" title="wasmtime-aarch64-apple-darwin 路 Embark Studios">wasmtime-aarch64-apple-darwin 路 Embark Studios</a></div><div class="message_embed_description">Branches for wasmtime-aarch64-apple-darwin: Pipeline for cloning and testing wasmtime on aarch64-apple-darwin</div></div></div>



<a name="253381482"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/Mac%20M1%20CI/near/253381482" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anirudha <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/Mac.20M1.20CI.html#253381482">(Sep 15 2021 at 08:49)</a>:</h4>
<p>How to make it work?<br>
Is there a small doc or steps to follow for this?</p>



<a name="253381860"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/Mac%20M1%20CI/near/253381860" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anirudha <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/Mac.20M1.20CI.html#253381860">(Sep 15 2021 at 08:53)</a>:</h4>
<p>Would this help in running wasmtime-go in M1?</p>



<a name="253457094"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/Mac%20M1%20CI/near/253457094" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/Mac.20M1.20CI.html#253457094">(Sep 15 2021 at 17:42)</a>:</h4>
<p><span class="user-mention" data-user-id="440305">@Anirudha</span> there's no known way to run Mac M1 CI with GitHub Actions for public repos like Wasmtime at this time. That being said being unable to actually execute the binary doesn't mean we can't do anything, we could still add a builder to simply build a release for the M1, which we don't currently do. I think, personally, that would be fine to add to our CI on the wasmtime repo</p>



<a name="253529817"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/Mac%20M1%20CI/near/253529817" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anirudha <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/Mac.20M1.20CI.html#253529817">(Sep 16 2021 at 05:06)</a>:</h4>
<p><span class="user-mention silent" data-user-id="253994">Alex Crichton</span> <a href="#narrow/stream/217126-wasmtime/topic/Mac.20M1.20CI/near/253457094">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="440305">Anirudha</span> there's no known way to run Mac M1 CI with GitHub Actions for public repos like Wasmtime at this time. That being said being unable to actually execute the binary doesn't mean we can't do anything, we could still add a builder to simply build a release for the M1, which we don't currently do. I think, personally, that would be fine to add to our CI on the wasmtime repo</p>
</blockquote>
<p>I see. What would that look like ? If you're occupied, and can point me to what needs to be done to make it run on M1, I can help spend time on it.</p>



<a name="253529930"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/Mac%20M1%20CI/near/253529930" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anirudha <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/Mac.20M1.20CI.html#253529930">(Sep 16 2021 at 05:08)</a>:</h4>
<p>I'm very new to wasmtime but it's a basic dependency for my project, and everyone else is currently on Linux machines.</p>



<a name="253529985"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/Mac%20M1%20CI/near/253529985" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anirudha <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/Mac.20M1.20CI.html#253529985">(Sep 16 2021 at 05:09)</a>:</h4>
<p><span class="user-mention" data-user-id="253994">@Alex Crichton</span> Can we take this ahead on Private message if it's too noisy here?</p>



<a name="253587020"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/Mac%20M1%20CI/near/253587020" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/Mac.20M1.20CI.html#253587020">(Sep 16 2021 at 14:03)</a>:</h4>
<p>oh either way is fine (via PM or here), but this would most likely be an edit to <code>.github/workflows/main.yml</code> where other release binaries are built to add a builder for M1 macs as well (I don't know how to do this myself, I've never built for the M1)</p>



<a name="253607062"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/Mac%20M1%20CI/near/253607062" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/Mac.20M1.20CI.html#253607062">(Sep 16 2021 at 16:12)</a>:</h4>
<p><span class="user-mention" data-user-id="253994">@Alex Crichton</span> do you mean that we should cross-compile for macOS/aarch64 from macOS/x86? That seems like definite progress if it works... but I'm curious if it does (perhaps it requires installation of a system cross-compiler at least). cc <span class="user-mention" data-user-id="254393">@Benjamin Bouvier</span> for more thoughts?</p>



<a name="253617898"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/Mac%20M1%20CI/near/253617898" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/Mac.20M1.20CI.html#253617898">(Sep 16 2021 at 17:23)</a>:</h4>
<p><span class="user-mention" data-user-id="254389">@Chris Fallin</span> AFAIK you don't need to install anything extra for cross-compilation between apple targets.</p>



<a name="253694902"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/Mac%20M1%20CI/near/253694902" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Benjamin Bouvier <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/Mac.20M1.20CI.html#253694902">(Sep 17 2021 at 06:05)</a>:</h4>
<p><span class="user-mention" data-user-id="253994">@Alex Crichton</span> <span class="user-mention" data-user-id="254389">@Chris Fallin</span> If the matter is just about building in release mode and publishing the artifacts somewhere, this is probably something we could do in automation on a daily basis too.</p>



<a name="253697822"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/Mac%20M1%20CI/near/253697822" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anirudha <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/Mac.20M1.20CI.html#253697822">(Sep 17 2021 at 06:45)</a>:</h4>
<p>Could you do it once and we can test if it works?</p>



<a name="253701314"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/Mac%20M1%20CI/near/253701314" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Benjamin Bouvier <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/Mac.20M1.20CI.html#253701314">(Sep 17 2021 at 07:22)</a>:</h4>
<p>I am unclear about what's required by publishing, and that would probably require access tokens to some package repository for wasmtime-go in particular.</p>



<a name="253705592"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/Mac%20M1%20CI/near/253705592" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Benjamin Bouvier <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/Mac.20M1.20CI.html#253705592">(Sep 17 2021 at 08:05)</a>:</h4>
<p>I am being told that Mac M1s have arrived at <a href="https://www.macstadium.com/">MacStadium</a> and could be used for any kind of Mac cloud stuff, if needed too!</p>



<a name="253733173"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/Mac%20M1%20CI/near/253733173" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Till Schneidereit <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/Mac.20M1.20CI.html#253733173">(Sep 17 2021 at 12:21)</a>:</h4>
<p>If that hasn't been fixed more properly yet, there might be an extra step required to enable cross-compilation step for darwin/arm64: <a href="https://github.com/actions/virtual-environments/issues/2557">https://github.com/actions/virtual-environments/issues/2557</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/actions/virtual-environments/issues/2557" style="background-image: url(https://opengraph.githubassets.com/a1e050b962a386192249c534cd0a97aaee1f8b44eca71dfecb8783887a478b24/actions/virtual-environments/issues/2557)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/actions/virtual-environments/issues/2557" title="[macOS] Xcode Toolchain doesn't have arm64 support. 路 Issue #2557 路 actions/virtual-environments">[macOS] Xcode Toolchain doesn't have arm64 support. 路 Issue #2557 路 actions/virtual-environments</a></div><div class="message_embed_description">Description It turns out that the default toolchain in macOS 11.0 doesn&#39;t have architect arm64 support. Area for Triage C/C++ Question, Bug, or Feature? Question/Bug Virtual environments affect...</div></div></div>



<a name="253745217"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/Mac%20M1%20CI/near/253745217" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/Mac.20M1.20CI.html#253745217">(Sep 17 2021 at 13:52)</a>:</h4>
<p>AFAIK rust-lang/rust figured out how to cross-compile on github actions and centralizing infrasturucture in bytecodealliance/wasmtime I think is preferable. If it's impossible to do on github actions though I think doing it on the M1 itself is reasonable</p>



<a name="253754131"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/Mac%20M1%20CI/near/253754131" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/Mac.20M1.20CI.html#253754131">(Sep 17 2021 at 14:50)</a>:</h4>
<p>AFAIK rust runs a patched GHA runner in a VM. This patched runner disables PR builds. The VM is killed and rebuilt fresh after a certain amount of time or once the build completes to prevent any malicious code from persisting. If the queue was empty it is possible for the VM to be killed in the middle of a build as the VM has been waiting for a new job for some time.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>