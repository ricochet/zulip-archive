<html>
<head><meta charset="utf-8"><title>push on master? · wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/index.html">wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/push.20on.20master.3F.html">push on master?</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="194488642"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/push%20on%20master%3F/near/194488642" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/push.20on.20master.3F.html#194488642">(Apr 17 2020 at 19:25)</a>:</h4>
<p><span class="user-mention" data-user-id="254110">@Andrew Brown</span> did you perhaps push to wasmtime master by accident?</p>



<a name="194488687"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/push%20on%20master%3F/near/194488687" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/push.20on.20master.3F.html#194488687">(Apr 17 2020 at 19:25)</a>:</h4>
<p><a href="https://github.com/bytecodealliance/wasmtime/commits/master" title="https://github.com/bytecodealliance/wasmtime/commits/master">https://github.com/bytecodealliance/wasmtime/commits/master</a> shows a few commits by you and CI <a href="https://github.com/bytecodealliance/wasmtime/pull/1544/checks?check_run_id=596395982" title="https://github.com/bytecodealliance/wasmtime/pull/1544/checks?check_run_id=596395982">is failing</a>, and was wondering if this was an accident or intentional</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wasmtime/commits/master" style="background-image: url(https://avatars0.githubusercontent.com/u/54038801?s=400&amp;v=4)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wasmtime/commits/master" title="bytecodealliance/wasmtime">bytecodealliance/wasmtime</a></div><div class="message_embed_description">Standalone JIT-style runtime for WebAssembly, using Cranelift - bytecodealliance/wasmtime</div></div></div><div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wasmtime/pull/1544/checks?check_run_id=596395982" style="background-image: url(https://avatars0.githubusercontent.com/u/64996?s=400&amp;v=4)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wasmtime/pull/1544/checks?check_run_id=596395982" title="Move most wasmtime tests into one test suite by alexcrichton · Pull Request #1544 · bytecodealliance/wasmtime">Move most wasmtime tests into one test suite by alexcrichton · Pull Request #1544 · bytecodealliance/wasmtime</a></div><div class="message_embed_description">This commit moves most wasmtime tests into a single test suite which
gets compiled into one executable instead of having lots of test
executables. The goal here is to reduce disk space on CI, and t...</div></div></div>



<a name="194490163"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/push%20on%20master%3F/near/194490163" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Brown <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/push.20on.20master.3F.html#194490163">(Apr 17 2020 at 19:38)</a>:</h4>
<p>Uh... Weird</p>



<a name="194490208"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/push%20on%20master%3F/near/194490208" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Brown <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/push.20on.20master.3F.html#194490208">(Apr 17 2020 at 19:39)</a>:</h4>
<p>Dan just approved a PR so I merged it but it was a tad old</p>



<a name="194490235"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/push%20on%20master%3F/near/194490235" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Brown <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/push.20on.20master.3F.html#194490235">(Apr 17 2020 at 19:39)</a>:</h4>
<p>So CI may not have run on it recently</p>



<a name="194490364"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/push%20on%20master%3F/near/194490364" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Brown <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/push.20on.20master.3F.html#194490364">(Apr 17 2020 at 19:40)</a>:</h4>
<p>I'll investigate in 15 min?</p>



<a name="194490656"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/push%20on%20master%3F/near/194490656" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/push.20on.20master.3F.html#194490656">(Apr 17 2020 at 19:43)</a>:</h4>
<p><span class="user-mention" data-user-id="254110">@Andrew Brown</span> oh no worries</p>



<a name="194490668"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/push%20on%20master%3F/near/194490668" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/push.20on.20master.3F.html#194490668">(Apr 17 2020 at 19:43)</a>:</h4>
<p>it may just be that it didn't show up as a merge commit</p>



<a name="194490673"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/push%20on%20master%3F/near/194490673" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/push.20on.20master.3F.html#194490673">(Apr 17 2020 at 19:43)</a>:</h4>
<p>sounds good either way</p>



<a name="194490677"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/push%20on%20master%3F/near/194490677" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/push.20on.20master.3F.html#194490677">(Apr 17 2020 at 19:43)</a>:</h4>
<p>and was probably just a normal merge conflict</p>



<a name="194490803"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/push%20on%20master%3F/near/194490803" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/push.20on.20master.3F.html#194490803">(Apr 17 2020 at 19:44)</a>:</h4>
<p>oh d'oh if I click the commits they're obviously attached to a PR</p>



<a name="194491514"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/push%20on%20master%3F/near/194491514" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Brown <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/push.20on.20master.3F.html#194491514">(Apr 17 2020 at 19:51)</a>:</h4>
<p>So here's the resolution: since that PR was created we have added a brand new Aarch64 backend <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span> which does not implement the new <code>ConstAddr</code> instruction I added. I'll open a PR for that.</p>



<a name="194491635"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/push%20on%20master%3F/near/194491635" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/push.20on.20master.3F.html#194491635">(Apr 17 2020 at 19:52)</a>:</h4>
<p><span class="user-mention" data-user-id="254110">@Andrew Brown</span> was just looking at that; since the new backend currently does its own thing for constants, you can probably just add a <code>panic!()</code> to the big lowering <code>match op { ... }</code></p>



<a name="194491682"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/push%20on%20master%3F/near/194491682" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/push.20on.20master.3F.html#194491682">(Apr 17 2020 at 19:53)</a>:</h4>
<p>unless there's some other place <code>const_addr</code> is used that I don't know about yet :-)</p>



<a name="194491997"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/push%20on%20master%3F/near/194491997" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/push.20on.20master.3F.html#194491997">(Apr 17 2020 at 19:55)</a>:</h4>
<p><span class="user-mention" data-user-id="254110">@Andrew Brown</span> oh I also sent <a href="https://github.com/bytecodealliance/wasmtime/pull/1546" title="https://github.com/bytecodealliance/wasmtime/pull/1546">https://github.com/bytecodealliance/wasmtime/pull/1546</a> just now</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wasmtime/pull/1546" style="background-image: url(https://avatars0.githubusercontent.com/u/54038801?s=400&amp;v=4)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wasmtime/pull/1546" title="Fix a compile issue on master by alexcrichton · Pull Request #1546 · bytecodealliance/wasmtime">Fix a compile issue on master by alexcrichton · Pull Request #1546 · bytecodealliance/wasmtime</a></div><div class="message_embed_description">Fixes an accidental "merge conflict" from #1377</div></div></div>



<a name="194492008"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/push%20on%20master%3F/near/194492008" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/push.20on.20master.3F.html#194492008">(Apr 17 2020 at 19:55)</a>:</h4>
<p>but if you have an actual implementation we should close that</p>



<a name="194492483"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/push%20on%20master%3F/near/194492483" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Brown <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/push.20on.20master.3F.html#194492483">(Apr 17 2020 at 19:59)</a>:</h4>
<p>Ha, no, I just pushed the same thing: <a href="https://github.com/bytecodealliance/wasmtime/pull/1548" title="https://github.com/bytecodealliance/wasmtime/pull/1548">https://github.com/bytecodealliance/wasmtime/pull/1548</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wasmtime/pull/1548" style="background-image: url(https://avatars0.githubusercontent.com/u/54038801?s=400&amp;v=4)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wasmtime/pull/1548" title="Resolve CI failures related to ConstAddr and Aarch64 by abrown · Pull Request #1548 · bytecodealliance/wasmtime">Resolve CI failures related to ConstAddr and Aarch64 by abrown · Pull Request #1548 · bytecodealliance/wasmtime</a></div><div class="message_embed_description">@alexcrichton, initially I am going to try this out as unimplemented! but it wouldn&#39;t be difficult to implement: it&#39;s a single LEA in x86. @cfallin, is there a quick fix for this? Where do ...</div></div></div>



<a name="194492683"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/push%20on%20master%3F/near/194492683" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Brown <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/push.20on.20master.3F.html#194492683">(Apr 17 2020 at 20:00)</a>:</h4>
<p>I propose we merge one of those and then open an issue to implement this... it should be very similar to <code>HeapAddr</code> and <code>TableAddr</code></p>



<a name="194492960"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/push%20on%20master%3F/near/194492960" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Brown <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/push.20on.20master.3F.html#194492960">(Apr 17 2020 at 20:03)</a>:</h4>
<p>What do you all think? <span class="user-mention" data-user-id="253994">@Alex Crichton</span>, <span class="user-mention" data-user-id="254389">@Chris Fallin</span></p>



<a name="194493003"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/push%20on%20master%3F/near/194493003" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/push.20on.20master.3F.html#194493003">(Apr 17 2020 at 20:03)</a>:</h4>
<p>:+1+ merged</p>



<a name="194493215"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/push%20on%20master%3F/near/194493215" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/push.20on.20master.3F.html#194493215">(Apr 17 2020 at 20:05)</a>:</h4>
<p><span class="user-mention" data-user-id="254110">@Andrew Brown</span> just commented there; constant pool stuff will be a bit more complex on ARM because of limited address range for PC-rel addressing. Happy to talk more about this later though; looks like it's important for vector constants?</p>



<a name="194493324"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/push%20on%20master%3F/near/194493324" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Brown <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/push.20on.20master.3F.html#194493324">(Apr 17 2020 at 20:06)</a>:</h4>
<p>Yeah <span aria-label="slight smile" class="emoji emoji-1f642" role="img" title="slight smile">:slight_smile:</span>; currently the x86 backend is emitting constants in the code section as well, right after the function body</p>



<a name="194493364"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/push%20on%20master%3F/near/194493364" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Brown <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/push.20on.20master.3F.html#194493364">(Apr 17 2020 at 20:06)</a>:</h4>
<p>is that the same in the ARM backend?</p>



<a name="194493384"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/push%20on%20master%3F/near/194493384" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/push.20on.20master.3F.html#194493384">(Apr 17 2020 at 20:07)</a>:</h4>
<p>Oh, we do even better than that, and emit the constant right after the load-PC-rel-addr instruction and a branch around the constant</p>



<a name="194493417"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/push%20on%20master%3F/near/194493417" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/push.20on.20master.3F.html#194493417">(Apr 17 2020 at 20:07)</a>:</h4>
<p>The "right" way to do it is to defer emission to the end, except for emitting islands of constants if the function is &gt; 1MB large</p>



<a name="194493471"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/push%20on%20master%3F/near/194493471" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/push.20on.20master.3F.html#194493471">(Apr 17 2020 at 20:07)</a>:</h4>
<p>But this works for now and let us avoid gnarly issues with that and with SpiderMonkey relocating the constant pool (which it does to insert its own epilogue)</p>



<a name="194493486"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/push%20on%20master%3F/near/194493486" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Brown <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/push.20on.20master.3F.html#194493486">(Apr 17 2020 at 20:08)</a>:</h4>
<p>Ok, that is what <code>ConstantPool</code> is designed to do</p>



<a name="194493539"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/push%20on%20master%3F/near/194493539" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Brown <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/push.20on.20master.3F.html#194493539">(Apr 17 2020 at 20:08)</a>:</h4>
<p>...the "defer emission to the end" part</p>



<a name="194493627"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/push%20on%20master%3F/near/194493627" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/push.20on.20master.3F.html#194493627">(Apr 17 2020 at 20:09)</a>:</h4>
<p>Got it; I have some thoughts on how to extend it for the "emit when we're about to get out of range" constant-island case; I'll create an issue to track this</p>



<a name="194493642"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/push%20on%20master%3F/near/194493642" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Brown <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/push.20on.20master.3F.html#194493642">(Apr 17 2020 at 20:09)</a>:</h4>
<p><span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span></p>



<a name="194494133"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/push%20on%20master%3F/near/194494133" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Brown <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/push.20on.20master.3F.html#194494133">(Apr 17 2020 at 20:13)</a>:</h4>
<p>In the meantime, can we implement ConstAddr?</p>



<a name="194494152"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/push%20on%20master%3F/near/194494152" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/push.20on.20master.3F.html#194494152">(Apr 17 2020 at 20:13)</a>:</h4>
<p><a href="https://github.com/bytecodealliance/wasmtime/issues/1549" title="https://github.com/bytecodealliance/wasmtime/issues/1549">https://github.com/bytecodealliance/wasmtime/issues/1549</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wasmtime/issues/1549" style="background-image: url(https://avatars0.githubusercontent.com/u/54038801?s=400&amp;v=4)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wasmtime/issues/1549" title="Cranelift aarch64 backend: use constant pool to defer constant emission to the end, unless out of range · Issue #1549 · bytecodealliance/wasmtime">Cranelift aarch64 backend: use constant pool to defer constant emission to the end, unless out of range · Issue #1549 · bytecodealliance/wasmtime</a></div><div class="message_embed_description">Currently, to avoid issues with (i) the PC-relative addressing range of LDR, and (ii) the fact that the constant pool needs to be relocatable, the aarch64 backend emits constants inline with code a...</div></div></div>



<a name="194494182"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/push%20on%20master%3F/near/194494182" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Brown <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/push.20on.20master.3F.html#194494182">(Apr 17 2020 at 20:13)</a>:</h4>
<p>Do you keep track of the pc-rel offset somewhere?</p>



<a name="194494295"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/push%20on%20master%3F/near/194494295" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/push.20on.20master.3F.html#194494295">(Apr 17 2020 at 20:14)</a>:</h4>
<p>No, right now we hardcode "current inst + 8" because of the open-coded "LDR, jump around constant, constant" sequence</p>



<a name="194494359"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/push%20on%20master%3F/near/194494359" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Brown <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/push.20on.20master.3F.html#194494359">(Apr 17 2020 at 20:15)</a>:</h4>
<p>Ah, ok; so I guess unimplemented! is the right way to go for now.</p>



<a name="194494417"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/push%20on%20master%3F/near/194494417" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/push.20on.20master.3F.html#194494417">(Apr 17 2020 at 20:15)</a>:</h4>
<p>Yeah, I'll need to think about this a little bit, sorry! RIght now we basically have done our own thing to get stuff working for evaluation/MVP purposes. There's a bit more work to integrate fully here</p>



<a name="194494567"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/push%20on%20master%3F/near/194494567" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/push.20on.20master.3F.html#194494567">(Apr 17 2020 at 20:16)</a>:</h4>
<p>Actually -- maybe it's not so bad if it's OK to duplicate the constant whenever referenced. Basically, a <code>const_addr</code> would serve both to emit the constant and give an address to it</p>



<a name="194494602"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/push%20on%20master%3F/near/194494602" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/push.20on.20master.3F.html#194494602">(Apr 17 2020 at 20:17)</a>:</h4>
<p>Then the emission is just the same as <code>LoadConst64</code> except instead of <code>LDR</code> (a normal 64-bit load from the embedded constant), we use <code>ADR</code> (get address of PC-rel thing)</p>



<a name="194494613"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/push%20on%20master%3F/near/194494613" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Brown <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/push.20on.20master.3F.html#194494613">(Apr 17 2020 at 20:17)</a>:</h4>
<p>There's an idea</p>



<a name="194494650"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/push%20on%20master%3F/near/194494650" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Brown <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/push.20on.20master.3F.html#194494650">(Apr 17 2020 at 20:17)</a>:</h4>
<p>I mean, implementing ConstAddr shouldn't be the biggest priority but if that is easy to do...</p>



<a name="194494718"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/push%20on%20master%3F/near/194494718" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/push.20on.20master.3F.html#194494718">(Apr 17 2020 at 20:18)</a>:</h4>
<p>Yup, I'll put this on my list. Question: is it used just for vector constants, or do we anticipate other uses (constant array data, ...) as well?</p>



<a name="194494822"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/push%20on%20master%3F/near/194494822" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Brown <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/push.20on.20master.3F.html#194494822">(Apr 17 2020 at 20:19)</a>:</h4>
<p>IIRC, other people mentioned other use cases but all I cared about was SIMD at the time <span aria-label="grinning face with smiling eyes" class="emoji emoji-1f601" role="img" title="grinning face with smiling eyes">:grinning_face_with_smiling_eyes:</span></p>



<a name="194494844"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/push%20on%20master%3F/near/194494844" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/push.20on.20master.3F.html#194494844">(Apr 17 2020 at 20:19)</a>:</h4>
<p>Cool, well we should make it work on arm64 for sure then. Thanks!</p>



<a name="194494926"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/push%20on%20master%3F/near/194494926" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Brown <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/push.20on.20master.3F.html#194494926">(Apr 17 2020 at 20:20)</a>:</h4>
<p><span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span></p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>