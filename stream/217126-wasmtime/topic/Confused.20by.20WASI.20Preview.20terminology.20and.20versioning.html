<html>
<head><meta charset="utf-8"><title>Confused by WASI Preview terminology and versioning 路 wasmtime 路 Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/index.html">wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/Confused.20by.20WASI.20Preview.20terminology.20and.20versioning.html">Confused by WASI Preview terminology and versioning</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="429948281"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/Confused%20by%20WASI%20Preview%20terminology%20and%20versioning/near/429948281" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> adam <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/Confused.20by.20WASI.20Preview.20terminology.20and.20versioning.html#429948281">(Mar 27 2024 at 20:58)</a>:</h4>
<p>Does the WASI package label <code>wasi:io/error@0.2.0</code> correlate to preview 2 as <a href="https://github.com/WebAssembly/WASI/blob/main/preview2/README.md">metioned here</a>?</p>
<p>I see mention of WASI preview 1, 2 and soon to be 3 and I see these versions for the WASI packages. Is there a corresponding wasi_snapshot_preview2.proxy.wasm for Preview 2 or does the name of these snapshot previews with wasmtime 19 not relate to what the WASI preview 2 readme says?</p>
<p>My components built with wasmtime 19 and embedding wasi_snapshot_preview1.proxy.wasm list imports for 0.2.0 so it seems like the preview1 snapshot is packaging 0.2.0 packages. Correct?</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/WebAssembly/WASI/blob/main/preview2/README.md" style="background-image: url(https\:\/\/uploads\.zulipusercontent\.net\/18dda3fae5b077885588e767842fefe1484bf6ac\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f386134633336623238373533386635346366313339306433613131613837643337666135333861353334663862353964373265613061653830363130313564392f576562417373656d626c792f57415349)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/WebAssembly/WASI/blob/main/preview2/README.md" title="WASI/preview2/README.md at main 路 WebAssembly/WASI">WASI/preview2/README.md at main 路 WebAssembly/WASI</a></div><div class="message_embed_description">WebAssembly System Interface. Contribute to WebAssembly/WASI development by creating an account on GitHub.</div></div></div>



<a name="429948712"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/Confused%20by%20WASI%20Preview%20terminology%20and%20versioning/near/429948712" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/Confused.20by.20WASI.20Preview.20terminology.20and.20versioning.html#429948712">(Mar 27 2024 at 21:01)</a>:</h4>
<p>Preview 2 is <code>0.2.x</code>.</p>



<a name="429948779"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/Confused%20by%20WASI%20Preview%20terminology%20and%20versioning/near/429948779" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ramon Klass <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/Confused.20by.20WASI.20Preview.20terminology.20and.20versioning.html#429948779">(Mar 27 2024 at 21:01)</a>:</h4>
<p>the filename of the adapter means that it takes preview1 wasi as input, it always has the latest version as output I think</p>



<a name="429949008"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/Confused%20by%20WASI%20Preview%20terminology%20and%20versioning/near/429949008" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> adam <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/Confused.20by.20WASI.20Preview.20terminology.20and.20versioning.html#429949008">(Mar 27 2024 at 21:03)</a>:</h4>
<p>What would the scenario of not needing to do the embed step to adapt a component? Is it a correct understanding that the step is only needed if the runtime has preview1 and the component is using preview2?</p>



<a name="429949182"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/Confused%20by%20WASI%20Preview%20terminology%20and%20versioning/near/429949182" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/Confused.20by.20WASI.20Preview.20terminology.20and.20versioning.html#429949182">(Mar 27 2024 at 21:04)</a>:</h4>
<p>Yes; work on natively Preview 2 toolchains is underway, and when they're ready they won't need the preview1-to-preview2 adapter.</p>



<a name="429949199"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/Confused%20by%20WASI%20Preview%20terminology%20and%20versioning/near/429949199" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ramon Klass <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/Confused.20by.20WASI.20Preview.20terminology.20and.20versioning.html#429949199">(Mar 27 2024 at 21:04)</a>:</h4>
<p>compilers currently only target preview1, so you always need to adapt to get a component. People are working on a wasm32-wasip2 compiler target, once that exists you can compile components without needing to adapt</p>



<a name="429950283"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/Confused%20by%20WASI%20Preview%20terminology%20and%20versioning/near/429950283" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> adam <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/Confused.20by.20WASI.20Preview.20terminology.20and.20versioning.html#429950283">(Mar 27 2024 at 21:12)</a>:</h4>
<p>I see an example in wasmtime that uses wasi-common to provide WASI APIs to a runtime instance. Yesterday Alex posted a wasmtime-wasi crate example so I see two different paths forward for linking WASI APIs. There's also a crate called wasi also by the bytecodealliance.</p>



<a name="429950607"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/Confused%20by%20WASI%20Preview%20terminology%20and%20versioning/near/429950607" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/Confused.20by.20WASI.20Preview.20terminology.20and.20versioning.html#429950607">(Mar 27 2024 at 21:14)</a>:</h4>
<p>wasi-common contains a Preview 1 host implementation. Current versions of wasmtime-wasi contain a Preview 2 host implementation. Current versions of the <code>wasi</code> crate contains guest bindings for Preview 2 APIs.</p>



<a name="429950703"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/Confused%20by%20WASI%20Preview%20terminology%20and%20versioning/near/429950703" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> adam <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/Confused.20by.20WASI.20Preview.20terminology.20and.20versioning.html#429950703">(Mar 27 2024 at 21:15)</a>:</h4>
<p>And using wasi-common and wasmtime-wasi require switching to nightly Rust. Is that avoiadble?</p>



<a name="429950836"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/Confused%20by%20WASI%20Preview%20terminology%20and%20versioning/near/429950836" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/Confused.20by.20WASI.20Preview.20terminology.20and.20versioning.html#429950836">(Mar 27 2024 at 21:16)</a>:</h4>
<p>They do?</p>



<a name="429950875"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/Confused%20by%20WASI%20Preview%20terminology%20and%20versioning/near/429950875" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ramon Klass <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/Confused.20by.20WASI.20Preview.20terminology.20and.20versioning.html#429950875">(Mar 27 2024 at 21:16)</a>:</h4>
<p>(stable rust works for me)</p>



<a name="429950958"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/Confused%20by%20WASI%20Preview%20terminology%20and%20versioning/near/429950958" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> adam <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/Confused.20by.20WASI.20Preview.20terminology.20and.20versioning.html#429950958">(Mar 27 2024 at 21:17)</a>:</h4>
<p>can_vector from the io-extras crate </p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">error</span><span class="p">[</span><span class="n">E0554</span><span class="p">]</span>: <span class="err">`</span><span class="cp">#![feature]</span><span class="err">`</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">stable</span><span class="w"> </span><span class="n">release</span><span class="w"> </span><span class="n">channel</span>
<span class="w">  </span><span class="o">-</span>-&gt; <span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">adam</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">index</span><span class="p">.</span><span class="n">crates</span><span class="p">.</span><span class="n">io</span><span class="o">-</span><span class="mi">6</span><span class="n">f17d22bba15001f</span><span class="o">/</span><span class="n">io</span><span class="o">-</span><span class="n">extras</span><span class="o">-</span><span class="mf">0.18.1</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">lib</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">19</span>:<span class="mi">33</span>
<span class="w">   </span><span class="o">|</span>
<span class="mi">19</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="cp">#![cfg_attr(can_vector, feature(can_vector))]</span>
<span class="w">   </span><span class="o">|</span><span class="w">                                 </span><span class="o">^^^^^^^^^^</span>
</code></pre></div>



<a name="429951043"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/Confused%20by%20WASI%20Preview%20terminology%20and%20versioning/near/429951043" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> adam <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/Confused.20by.20WASI.20Preview.20terminology.20and.20versioning.html#429951043">(Mar 27 2024 at 21:17)</a>:</h4>
<p>Adding either of those two crates causes this error. Removing them compiles and runs.</p>



<a name="429951075"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/Confused%20by%20WASI%20Preview%20terminology%20and%20versioning/near/429951075" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gohman <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/Confused.20by.20WASI.20Preview.20terminology.20and.20versioning.html#429951075">(Mar 27 2024 at 21:17)</a>:</h4>
<p>That.. is not supposed to happen :-}.</p>



<a name="429951229"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/Confused%20by%20WASI%20Preview%20terminology%20and%20versioning/near/429951229" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ramon Klass <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/Confused.20by.20WASI.20Preview.20terminology.20and.20versioning.html#429951229">(Mar 27 2024 at 21:18)</a>:</h4>
<p>I would run cargo clean next, I've seen the strangest things when target has been written to by different rust versions</p>



<a name="429951563"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/Confused%20by%20WASI%20Preview%20terminology%20and%20versioning/near/429951563" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> adam <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/Confused.20by.20WASI.20Preview.20terminology.20and.20versioning.html#429951563">(Mar 27 2024 at 21:20)</a>:</h4>
<p>cargo clean did the job</p>



<a name="429952185"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/Confused%20by%20WASI%20Preview%20terminology%20and%20versioning/near/429952185" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> adam <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/Confused.20by.20WASI.20Preview.20terminology.20and.20versioning.html#429952185">(Mar 27 2024 at 21:25)</a>:</h4>
<p>The crates/wasi directory in wasmtime repo is actually the crate wasmtime-wasi. Where does the wasi crate for guest bindings live?</p>



<a name="429952251"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/Confused%20by%20WASI%20Preview%20terminology%20and%20versioning/near/429952251" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ramon Klass <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/Confused.20by.20WASI.20Preview.20terminology.20and.20versioning.html#429952251">(Mar 27 2024 at 21:26)</a>:</h4>
<p><a href="https://github.com/bytecodealliance/wasi">https://github.com/bytecodealliance/wasi</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wasi" style="background-image: url(https\:\/\/uploads\.zulipusercontent\.net\/94d69ea5b2953d793f81682b022e3287567c64e0\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f383332626339653766633266366264316231363533656663636163643939313834376231363664613362656431656239303236623461633438316263646532312f62797465636f6465616c6c69616e63652f77617369)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wasi" title="GitHub - bytecodealliance/wasi: Experimental WASI API bindings for Rust">GitHub - bytecodealliance/wasi: Experimental WASI API bindings for Rust</a></div><div class="message_embed_description">Experimental WASI API bindings for Rust. Contribute to bytecodealliance/wasi development by creating an account on GitHub.</div></div></div>



<a name="429953149"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/Confused%20by%20WASI%20Preview%20terminology%20and%20versioning/near/429953149" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> adam <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/Confused.20by.20WASI.20Preview.20terminology.20and.20versioning.html#429953149">(Mar 27 2024 at 21:32)</a>:</h4>
<p>If wasmtime-wasi is the preview 2 host impl and the package used by the example update PR by Alex is wasmtime-wasi::preview1, if I use wasmtime_wasi::ctx it will be preview 2? Which would mean the adapt step wouldn't be necessary?</p>



<a name="429961687"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/Confused%20by%20WASI%20Preview%20terminology%20and%20versioning/near/429961687" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> adam <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/Confused.20by.20WASI.20Preview.20terminology.20and.20versioning.html#429961687">(Mar 27 2024 at 22:47)</a>:</h4>
<p>That was a question answered by your explanation of the preview1 adapting for preview2. Had to look at the code to grok it.</p>



<a name="429962276"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/Confused%20by%20WASI%20Preview%20terminology%20and%20versioning/near/429962276" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> adam <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/Confused.20by.20WASI.20Preview.20terminology.20and.20versioning.html#429962276">(Mar 27 2024 at 22:53)</a>:</h4>
<p>Thanks for the help everyone!</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w"> </span><span class="o">~/</span><span class="n">work</span><span class="o">/</span><span class="n">learning</span><span class="o">/</span><span class="n">learn</span><span class="o">-</span><span class="n">wasm</span><span class="o">-</span><span class="n">components</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">rust</span><span class="w"> </span><span class="n">cargo</span><span class="w"> </span><span class="n">run</span>
<span class="w">   </span><span class="n">Compiling</span><span class="w"> </span><span class="n">runtime</span><span class="w"> </span><span class="n">v0</span><span class="p">.</span><span class="mf">1.0</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">adam</span><span class="o">/</span><span class="n">work</span><span class="o">/</span><span class="n">learning</span><span class="o">/</span><span class="n">learn</span><span class="o">-</span><span class="n">wasm</span><span class="o">-</span><span class="n">components</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">rust</span><span class="p">)</span>
<span class="w">    </span><span class="n">Finished</span><span class="w"> </span><span class="n">dev</span><span class="w"> </span><span class="p">[</span><span class="n">unoptimized</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">debuginfo</span><span class="p">]</span><span class="w"> </span><span class="n">target</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mf">1.94</span><span class="n">s</span>
<span class="w">     </span><span class="n">Running</span><span class="w"> </span><span class="err">`</span><span class="n">target</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">runtime</span><span class="err">`</span>
<span class="mi">26</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">even</span>
</code></pre></div>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>