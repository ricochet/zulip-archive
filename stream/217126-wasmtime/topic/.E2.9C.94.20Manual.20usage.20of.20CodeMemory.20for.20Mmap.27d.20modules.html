<html>
<head><meta charset="utf-8"><title>✔ Manual usage of CodeMemory for Mmap&#x27;d modules · wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/index.html">wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20Manual.20usage.20of.20CodeMemory.20for.20Mmap.27d.20modules.html">✔ Manual usage of CodeMemory for Mmap&#x27;d modules</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="466331317"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20Manual%20usage%20of%20CodeMemory%20for%20Mmap%27d%20modules/near/466331317" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> spino17 <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20Manual.20usage.20of.20CodeMemory.20for.20Mmap.27d.20modules.html#466331317">(Aug 30 2024 at 19:33)</a>:</h4>
<p>I want to manually construct <code>CodeMemory</code>. Right now I am facing difficultly to construct it as it requires <code>MmapVec</code>. I can't use file based APIs as I have a custom persistence layer which has completely different APIs and need to go at the level of <code>CodeMemory</code> and <code>MmapVec</code>. I checked out <code>wasmtime_runtime</code> but they are completely different types not expected by <code>CodeMemory</code>. Any help would be highly appreciated, thanks</p>



<a name="466332032"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20Manual%20usage%20of%20CodeMemory%20for%20Mmap%27d%20modules/near/466332032" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20Manual.20usage.20of.20CodeMemory.20for.20Mmap.27d.20modules.html#466332032">(Aug 30 2024 at 19:39)</a>:</h4>
<p>The wasmtime_runtime crate has been merged into the main wasmtime crate a while back. MmapVec is not publicly accessible.</p>



<a name="466332202"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20Manual%20usage%20of%20CodeMemory%20for%20Mmap%27d%20modules/near/466332202" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> spino17 <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20Manual.20usage.20of.20CodeMemory.20for.20Mmap.27d.20modules.html#466332202">(Aug 30 2024 at 19:40)</a>:</h4>
<p><span class="user-mention" data-user-id="264278">@bjorn3</span> thanks for the response. So what's the way to go if I want to work with CodeMemory APIs ?</p>



<a name="466332308"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20Manual%20usage%20of%20CodeMemory%20for%20Mmap%27d%20modules/near/466332308" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20Manual.20usage.20of.20CodeMemory.20for.20Mmap.27d.20modules.html#466332308">(Aug 30 2024 at 19:41)</a>:</h4>
<p>I'm surprised CodeMemory is public at all. I can't find any way it would be useful at all.</p>



<a name="466332473"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20Manual%20usage%20of%20CodeMemory%20for%20Mmap%27d%20modules/near/466332473" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> spino17 <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20Manual.20usage.20of.20CodeMemory.20for.20Mmap.27d.20modules.html#466332473">(Aug 30 2024 at 19:42)</a>:</h4>
<p><span class="user-mention" data-user-id="264278">@bjorn3</span> yeah, I also thought so. Any specific reason not to expose such APIs ?</p>



<a name="466332528"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20Manual%20usage%20of%20CodeMemory%20for%20Mmap%27d%20modules/near/466332528" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20Manual.20usage.20of.20CodeMemory.20for.20Mmap.27d.20modules.html#466332528">(Aug 30 2024 at 19:42)</a>:</h4>
<p>You probably want to use <code>Module::serialize</code> + <code>Module::deserialize</code> if you handle caching yourself without going through files.</p>



<a name="466332891"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20Manual%20usage%20of%20CodeMemory%20for%20Mmap%27d%20modules/near/466332891" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20Manual.20usage.20of.20CodeMemory.20for.20Mmap.27d.20modules.html#466332891">(Aug 30 2024 at 19:44)</a>:</h4>
<p><code>Module::deserialize_file</code> is slightly more efficient as it avoids writing the module to a memfd, but if you are avoiding real files, the compiled module will eventually have to end up in a memfd anyway for wasmtime to be able to mmap it.</p>



<a name="466333757"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20Manual%20usage%20of%20CodeMemory%20for%20Mmap%27d%20modules/near/466333757" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> spino17 <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20Manual.20usage.20of.20CodeMemory.20for.20Mmap.27d.20modules.html#466333757">(Aug 30 2024 at 19:50)</a>:</h4>
<p><span class="user-mention" data-user-id="264278">@bjorn3</span> thanks for the explanation. This makes sense. Let me try to look into the Module APIs only. Thanks again.</p>



<a name="468570100"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/%E2%9C%94%20Manual%20usage%20of%20CodeMemory%20for%20Mmap%27d%20modules/near/468570100" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/.E2.9C.94.20Manual.20usage.20of.20CodeMemory.20for.20Mmap.27d.20modules.html#468570100">(Sep 08 2024 at 13:48)</a>:</h4>
<p><span class="user-mention silent" data-user-id="234973">Till Schneidereit</span> has marked this topic as resolved.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>