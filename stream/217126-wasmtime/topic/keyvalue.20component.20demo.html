<html>
<head><meta charset="utf-8"><title>keyvalue component demo · wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/index.html">wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/keyvalue.20component.20demo.html">keyvalue component demo</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="316114809"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/keyvalue%20component%20demo/near/316114809" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mossaka (Joe) <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/keyvalue.20component.20demo.html#316114809">(Dec 15 2022 at 18:49)</a>:</h4>
<p>Hey there! I want to share a simple key-value interface and a wasm component demo using the latest "component-model" feature from <code>wasmtime</code>, the<code>wit-bindgen</code> tool and <code>wasm-tools</code>. I did this primarily for my own learning and keeping track of the progress on wasm component tool-chains. I thought it would be beneficial for the community to see an example of running something similar to real-world scenario that involves in a in-memory keyvalue store. </p>
<p>Check it out here <a href="https://github.com/Mossaka/keyvalue-component-model-demo">https://github.com/Mossaka/keyvalue-component-model-demo</a>!</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/Mossaka/keyvalue-component-model-demo" style="background-image: url(https\:\/\/uploads\.zulipusercontent\.net\/66d8b2eca64764775a127b27846dae746ff687fe\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f356632373466363731623536326132626262333761623232333635373134333932666138376261623334333764653139663963643433303738393861373066322f4d6f7373616b612f6b657976616c75652d636f6d706f6e656e742d6d6f64656c2d64656d6f)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/Mossaka/keyvalue-component-model-demo" title="GitHub - Mossaka/keyvalue-component-model-demo: A demo repo that shows how to use the latest component model feature in wasmtime to implement a key-value capability defined in a WIT file.">GitHub - Mossaka/keyvalue-component-model-demo: A demo repo that shows how to use the latest component model feature in wasmtime to implement a key-value capability defined in a WIT file.</a></div><div class="message_embed_description">A demo repo that shows how to use the latest component model feature in wasmtime to implement a key-value capability defined in a WIT file. - GitHub - Mossaka/keyvalue-component-model-demo: A demo ...</div></div></div>



<a name="316136620"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/keyvalue%20component%20demo/near/316136620" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/keyvalue.20component.20demo.html#316136620">(Dec 15 2022 at 20:44)</a>:</h4>
<p>That all looks pretty good to me! I'm curious though if you found <a href="https://github.com/Mossaka/keyvalue-component-model-demo/blob/00448e1c37e2f47cd76ce573e8c9b19e30069b3f/build.rs#L29">this flag to be necessary</a> or if it's copied from elsewhere?</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/Mossaka/keyvalue-component-model-demo/blob/00448e1c37e2f47cd76ce573e8c9b19e30069b3f/build.rs#L29" style="background-image: url(https\:\/\/uploads\.zulipusercontent\.net\/66d8b2eca64764775a127b27846dae746ff687fe\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f356632373466363731623536326132626262333761623232333635373134333932666138376261623334333764653139663963643433303738393861373066322f4d6f7373616b612f6b657976616c75652d636f6d706f6e656e742d6d6f64656c2d64656d6f)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/Mossaka/keyvalue-component-model-demo/blob/00448e1c37e2f47cd76ce573e8c9b19e30069b3f/build.rs#L29" title="keyvalue-component-model-demo/build.rs at 00448e1c37e2f47cd76ce573e8c9b19e30069b3f · Mossaka/keyvalue-component-model-demo">keyvalue-component-model-demo/build.rs at 00448e1c37e2f47cd76ce573e8c9b19e30069b3f · Mossaka/keyvalue-component-model-demo</a></div><div class="message_embed_description">A demo repo that shows how to use the latest component model feature in wasmtime to implement a key-value capability defined in a WIT file. - keyvalue-component-model-demo/build.rs at 00448e1c37e2f...</div></div></div>



<a name="316136827"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/keyvalue%20component%20demo/near/316136827" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/keyvalue.20component.20demo.html#316136827">(Dec 15 2022 at 20:45)</a>:</h4>
<p>You might also be interested in getting the wasi_snapshot_preview1.wasm from <a href="https://github.com/bytecodealliance/preview2-prototyping/releases/tag/latest">here</a> and seeing how that works out. That will require copying some <code>*.wit</code> into your repo though, but in theory you can slim down the wit to just what your one module needs rather than implementing all of preview2</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/preview2-prototyping/releases/tag/latest" style="background-image: url(https\:\/\/uploads\.zulipusercontent\.net\/155e22f378bb7ce66d00026872d14dbe75104462\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f636661353264396336396666386662313162353137376335616265353130366462613336323663306664373336633438386663623065353664373934363966312f62797465636f6465616c6c69616e63652f70726576696577322d70726f746f747970696e672f72656c65617365732f7461672f6c6174657374)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/preview2-prototyping/releases/tag/latest" title="Release Latest Build · bytecodealliance/preview2-prototyping">Release Latest Build · bytecodealliance/preview2-prototyping</a></div><div class="message_embed_description">Commits

272151a: Implement fd_renumber. (#21) (Dan Gohman) #21</div></div></div>



<a name="316339887"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/keyvalue%20component%20demo/near/316339887" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mossaka (Joe) <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/keyvalue.20component.20demo.html#316339887">(Dec 16 2022 at 19:01)</a>:</h4>
<blockquote>
<p>I'm curious though if you found this flag to be necessary or if it's copied from elsewhere?</p>
</blockquote>
<p>It is copied from wit-bindgen <a href="https://github.com/bytecodealliance/wit-bindgen/blob/main/crates/test-helpers/macros/build.rs#L136">https://github.com/bytecodealliance/wit-bindgen/blob/main/crates/test-helpers/macros/build.rs#L136</a></p>
<p>Thanks for providing the link to "wasi_snapshot_preview1.wasm"!</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wit-bindgen/blob/main/crates/test-helpers/macros/build.rs#L136" style="background-image: url(https\:\/\/uploads\.zulipusercontent\.net\/219612327c4e2e6d6db653c323de561691ee7c90\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f373132306131353034316131643137346437346236633332373633353838623135306463303166323033333762353034633435303566636365363561336132322f62797465636f6465616c6c69616e63652f7769742d62696e6467656e)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wit-bindgen/blob/main/crates/test-helpers/macros/build.rs#L136" title="wit-bindgen/build.rs at main · bytecodealliance/wit-bindgen">wit-bindgen/build.rs at main · bytecodealliance/wit-bindgen</a></div><div class="message_embed_description">A language binding generator for WebAssembly interface types - wit-bindgen/build.rs at main · bytecodealliance/wit-bindgen</div></div></div>



<a name="316824757"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/keyvalue%20component%20demo/near/316824757" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mossaka (Joe) <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/keyvalue.20component.20demo.html#316824757">(Dec 19 2022 at 20:22)</a>:</h4>
<p>Hey! Do you have any insights into this error? The <code>wasi_snapshot_preview1.wasm</code> was built from preview2-prototyping repo. </p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">wasm</span><span class="o">-</span><span class="n">tools</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">guest</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">wasm32</span><span class="o">-</span><span class="n">wasi</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">guest</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span><span class="n">adapt</span><span class="w"> </span><span class="o">../</span><span class="n">preview2</span><span class="o">-</span><span class="n">prototyping</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">wasm32</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">unknown</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">wasi_snapshot_preview1</span><span class="p">.</span><span class="n">wasm</span><span class="w"></span>

<span class="n">Error</span>: <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">encode</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">module</span><span class="w"></span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span>:
    <span class="mi">0</span>: <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">reduce</span><span class="w"> </span><span class="n">input</span><span class="w"> </span><span class="n">adapter</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">its</span><span class="w"> </span><span class="n">minimal</span><span class="w"> </span><span class="n">size</span><span class="w"></span>
<span class="w">    </span><span class="mi">1</span>: <span class="nc">locally</span><span class="o">-</span><span class="n">defined</span><span class="w"> </span><span class="n">memories</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">allowed</span><span class="w"> </span><span class="n">define</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">local</span><span class="w"> </span><span class="n">memory</span><span class="w"></span>
</code></pre></div>



<a name="316833675"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/keyvalue%20component%20demo/near/316833675" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mossaka (Joe) <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/keyvalue.20component.20demo.html#316833675">(Dec 19 2022 at 21:23)</a>:</h4>
<p>Nevermind, once I updated wasm-tools to the latest version from the <code>main</code> branch. This problem went away. </p>
<p>However, I still have the same issue with using <code>wit-component</code> as a crate.</p>



<a name="316833741"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217126-wasmtime/topic/keyvalue%20component%20demo/near/316833741" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mossaka (Joe) <a href="https://bytecodealliance.github.io/zulip-archive/stream/217126-wasmtime/topic/keyvalue.20component.20demo.html#316833741">(Dec 19 2022 at 21:23)</a>:</h4>
<p>Updated the repo to use wasi_snapshot_preview1.wasm from the preview2-prototyping repo! <a href="https://github.com/Mossaka/keyvalue-component-model-demo">https://github.com/Mossaka/keyvalue-component-model-demo</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/Mossaka/keyvalue-component-model-demo" style="background-image: url(https\:\/\/uploads\.zulipusercontent\.net\/b4f72dcb0ab811a0c86fb21490593922fc6692ef\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f343466666465623530376362313963656636363838323639343234316466343162326165326362353834316136396230316432356534633539363337316331362f4d6f7373616b612f6b657976616c75652d636f6d706f6e656e742d6d6f64656c2d64656d6f)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/Mossaka/keyvalue-component-model-demo" title="GitHub - Mossaka/keyvalue-component-model-demo: A demo repo that shows how to use the latest component model feature in wasmtime to implement a key-value capability defined in a WIT file.">GitHub - Mossaka/keyvalue-component-model-demo: A demo repo that shows how to use the latest component model feature in wasmtime to implement a key-value capability defined in a WIT file.</a></div><div class="message_embed_description">A demo repo that shows how to use the latest component model feature in wasmtime to implement a key-value capability defined in a WIT file. - GitHub - Mossaka/keyvalue-component-model-demo: A demo ...</div></div></div>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>