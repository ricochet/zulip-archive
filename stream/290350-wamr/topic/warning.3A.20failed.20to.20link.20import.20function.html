<html>
<head><meta charset="utf-8"><title>warning: failed to link import function · wamr · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/290350-wamr/index.html">wamr</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/290350-wamr/topic/warning.3A.20failed.20to.20link.20import.20function.html">warning: failed to link import function</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="418606049"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/290350-wamr/topic/warning%3A%20failed%20to%20link%20import%20function/near/418606049" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Salvatore Bramante <a href="https://bytecodealliance.github.io/zulip-archive/stream/290350-wamr/topic/warning.3A.20failed.20to.20link.20import.20function.html#418606049">(Jan 29 2024 at 10:28)</a>:</h4>
<p>Hello, I'm trying to execute on wamr a simple multithread program on arm cortex a53 (zephyr os), compilation goes well but it shows this log</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="o">--</span><span class="w"> </span><span class="n">west</span><span class="w"> </span><span class="n">build</span>: <span class="nc">running</span><span class="w"> </span><span class="n">target</span><span class="w"> </span><span class="n">run</span>
<span class="p">[</span><span class="mi">0</span><span class="o">/</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="n">To</span><span class="w"> </span><span class="n">exit</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">QEMU</span><span class="w"> </span><span class="n">enter</span>: <span class="o">'</span><span class="na">CTRL</span><span class="o">+</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="o">'</span><span class="p">[</span><span class="n">QEMU</span><span class="p">]</span><span class="w"> </span><span class="n">CPU</span>: <span class="nc">cortex</span><span class="o">-</span><span class="n">a53</span>
<span class="o">***</span><span class="w"> </span><span class="n">Booting</span><span class="w"> </span><span class="n">Zephyr</span><span class="w"> </span><span class="n">OS</span><span class="w"> </span><span class="n">build</span><span class="w"> </span><span class="n">zephyr</span><span class="o">-</span><span class="n">v3</span><span class="p">.</span><span class="mf">5.0</span><span class="o">-</span><span class="mi">4528</span><span class="o">-</span><span class="n">g04de43b1a119</span><span class="w"> </span><span class="o">***</span>
<span class="p">[</span><span class="mi">00</span>:<span class="mi">00</span>:<span class="mi">00</span>:<span class="mi">000</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">4002</span><span class="n">F990</span><span class="p">]</span>: <span class="nc">warning</span>: <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">link</span><span class="w"> </span><span class="n">import</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="p">(</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">pthread_create</span><span class="p">)</span>
<span class="p">[</span><span class="mi">00</span>:<span class="mi">00</span>:<span class="mi">00</span>:<span class="mi">000</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">4002</span><span class="n">F990</span><span class="p">]</span>: <span class="nc">warning</span>: <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">link</span><span class="w"> </span><span class="n">import</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="p">(</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">pthread_join</span><span class="p">)</span>
<span class="n">Exception</span>: <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">call</span><span class="w"> </span><span class="n">unlinked</span><span class="w"> </span><span class="n">import</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="p">(</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">pthread_create</span><span class="p">)</span>
</code></pre></div>
<p>I’ve also enabled wasi-libc of course. My compiling command is </p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="o">/</span><span class="cp">$HOME</span><span class="o">/</span><span class="n">wasi</span><span class="o">-</span><span class="n">sdk</span><span class="o">-</span><span class="mf">21.0</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">clang</span><span class="w">     </span><span class="err">\</span>
<span class="w">   </span><span class="o">--</span><span class="n">target</span><span class="o">=</span><span class="n">wasm32</span><span class="o">-</span><span class="n">wasi</span><span class="o">-</span><span class="n">threads</span><span class="w"> </span><span class="o">-</span><span class="n">pthread</span><span class="w"> </span><span class="o">-</span><span class="n">z</span><span class="w"> </span><span class="n">stack</span><span class="o">-</span><span class="n">size</span><span class="o">=</span><span class="mi">524288</span><span class="w"> </span><span class="o">-</span><span class="n">Wl</span><span class="p">,</span><span class="o">--</span><span class="n">initial</span><span class="o">-</span><span class="n">memory</span><span class="o">=</span><span class="mi">1048576</span><span class="w"> </span><span class="err">\</span>
<span class="w">   </span><span class="o">--</span><span class="n">sysroot</span><span class="o">=/</span><span class="cp">$HOME</span><span class="o">/</span><span class="n">wasi</span><span class="o">-</span><span class="n">sdk</span><span class="o">-</span><span class="mf">21.0</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">wasi</span><span class="o">-</span><span class="n">sysroot</span><span class="w">  </span><span class="err">\</span>
<span class="w">   </span><span class="o">-</span><span class="n">Wl</span><span class="p">,</span><span class="o">--</span><span class="n">allow</span><span class="o">-</span><span class="n">undefined</span><span class="o">-</span><span class="n">file</span><span class="o">=/</span><span class="cp">$HOME</span><span class="o">/</span><span class="n">wasi</span><span class="o">-</span><span class="n">sdk</span><span class="o">-</span><span class="mf">21.0</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">wasi</span><span class="o">-</span><span class="n">sysroot</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">wasm32</span><span class="o">-</span><span class="n">wasi</span><span class="o">-</span><span class="n">threads</span><span class="o">/</span><span class="n">defined</span><span class="o">-</span><span class="n">symbols</span><span class="p">.</span><span class="n">txt</span><span class="w"> </span><span class="err">\</span>
<span class="w">   </span><span class="o">-</span><span class="n">Wl</span><span class="p">,</span><span class="o">--</span><span class="n">strip</span><span class="o">-</span><span class="n">all</span><span class="p">,</span><span class="o">--</span><span class="n">no</span><span class="o">-</span><span class="n">entry</span><span class="w"> </span><span class="o">-</span><span class="n">nostdlib</span><span class="w"> </span><span class="err">\</span>
<span class="w">   </span><span class="o">-</span><span class="n">Wl</span><span class="p">,</span><span class="o">--</span><span class="n">export</span><span class="o">=</span><span class="n">main</span><span class="w"> </span><span class="err">\</span>
<span class="w">   </span><span class="o">-</span><span class="n">Wl</span><span class="p">,</span><span class="o">--</span><span class="n">export</span><span class="o">=</span><span class="n">__data_end</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">Wl</span><span class="p">,</span><span class="o">--</span><span class="n">export</span><span class="o">=</span><span class="n">__heap_base</span><span class="w"> </span><span class="err">\</span>
<span class="w">   </span><span class="o">-</span><span class="n">Wl</span><span class="p">,</span><span class="o">--</span><span class="n">allow</span><span class="o">-</span><span class="n">undefined</span><span class="w"> </span><span class="err">\</span>
<span class="w">   </span><span class="o">-</span><span class="n">o</span><span class="w"> </span><span class="cp">$WASM_BIN</span><span class="w"> </span><span class="cp">$C_FILE</span>
</code></pre></div>
<p>I’ve also tried to not use <code>-nostdlib</code> flag but this led to blank output. Anyone can help me? Thanks in advance :)</p>



<a name="418613838"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/290350-wamr/topic/warning%3A%20failed%20to%20link%20import%20function/near/418613838" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> YAMAMOTO Takashi <a href="https://bytecodealliance.github.io/zulip-archive/stream/290350-wamr/topic/warning.3A.20failed.20to.20link.20import.20function.html#418613838">(Jan 29 2024 at 11:12)</a>:</h4>
<p>use this instead</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="o">/</span><span class="cp">$HOME</span><span class="o">/</span><span class="n">wasi</span><span class="o">-</span><span class="n">sdk</span><span class="o">-</span><span class="mf">21.0</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">clang</span><span class="w">     </span><span class="err">\</span>
<span class="w">   </span><span class="o">--</span><span class="n">target</span><span class="o">=</span><span class="n">wasm32</span><span class="o">-</span><span class="n">wasi</span><span class="o">-</span><span class="n">threads</span><span class="w"> </span><span class="o">-</span><span class="n">pthread</span><span class="w"> </span><span class="o">-</span><span class="n">z</span><span class="w"> </span><span class="n">stack</span><span class="o">-</span><span class="n">size</span><span class="o">=</span><span class="mi">524288</span><span class="w"> </span><span class="o">-</span><span class="n">Wl</span><span class="p">,</span><span class="o">--</span><span class="n">initial</span><span class="o">-</span><span class="n">memory</span><span class="o">=</span><span class="mi">1048576</span><span class="w"> </span><span class="err">\</span>
<span class="w">   </span><span class="o">-</span><span class="n">o</span><span class="w"> </span><span class="cp">$WASM_BIN</span><span class="w"> </span><span class="cp">$C_FILE</span>
</code></pre></div>



<a name="418614650"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/290350-wamr/topic/warning%3A%20failed%20to%20link%20import%20function/near/418614650" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Salvatore Bramante <a href="https://bytecodealliance.github.io/zulip-archive/stream/290350-wamr/topic/warning.3A.20failed.20to.20link.20import.20function.html#418614650">(Jan 29 2024 at 11:17)</a>:</h4>
<p>I've just tried but it gives me blank output (I've included a print before creating a thread but is not shown)</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="o">--</span><span class="w"> </span><span class="n">west</span><span class="w"> </span><span class="n">build</span>: <span class="nc">running</span><span class="w"> </span><span class="n">target</span><span class="w"> </span><span class="n">run</span>
<span class="p">[</span><span class="mi">0</span><span class="o">/</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="n">To</span><span class="w"> </span><span class="n">exit</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">QEMU</span><span class="w"> </span><span class="n">enter</span>: <span class="o">'</span><span class="na">CTRL</span><span class="o">+</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="o">'</span><span class="p">[</span><span class="n">QEMU</span><span class="p">]</span><span class="w"> </span><span class="n">CPU</span>: <span class="nc">cortex</span><span class="o">-</span><span class="n">a53</span>
<span class="o">***</span><span class="w"> </span><span class="n">Booting</span><span class="w"> </span><span class="n">Zephyr</span><span class="w"> </span><span class="n">OS</span><span class="w"> </span><span class="n">build</span><span class="w"> </span><span class="n">zephyr</span><span class="o">-</span><span class="n">v3</span><span class="p">.</span><span class="mf">5.0</span><span class="o">-</span><span class="mi">4528</span><span class="o">-</span><span class="n">g04de43b1a119</span><span class="w"> </span><span class="o">***</span>
</code></pre></div>
<p>I'm calling this module in a C program so, to my mind, I've to export the module main function</p>



<a name="418621467"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/290350-wamr/topic/warning%3A%20failed%20to%20link%20import%20function/near/418621467" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> YAMAMOTO Takashi <a href="https://bytecodealliance.github.io/zulip-archive/stream/290350-wamr/topic/warning.3A.20failed.20to.20link.20import.20function.html#418621467">(Jan 29 2024 at 12:01)</a>:</h4>
<p>in wasi, the entry point is usually _start, which is provided by crt.</p>



<a name="418621805"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/290350-wamr/topic/warning%3A%20failed%20to%20link%20import%20function/near/418621805" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> YAMAMOTO Takashi <a href="https://bytecodealliance.github.io/zulip-archive/stream/290350-wamr/topic/warning.3A.20failed.20to.20link.20import.20function.html#418621805">(Jan 29 2024 at 12:03)</a>:</h4>
<p>given your stack-size and --initial-memory values, i guess it won't be able to create a thread.</p>



<a name="418621958"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/290350-wamr/topic/warning%3A%20failed%20to%20link%20import%20function/near/418621958" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Salvatore Bramante <a href="https://bytecodealliance.github.io/zulip-archive/stream/290350-wamr/topic/warning.3A.20failed.20to.20link.20import.20function.html#418621958">(Jan 29 2024 at 12:04)</a>:</h4>
<p>I should give bigger stack and initial memory?</p>



<a name="418622010"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/290350-wamr/topic/warning%3A%20failed%20to%20link%20import%20function/near/418622010" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> YAMAMOTO Takashi <a href="https://bytecodealliance.github.io/zulip-archive/stream/290350-wamr/topic/warning.3A.20failed.20to.20link.20import.20function.html#418622010">(Jan 29 2024 at 12:04)</a>:</h4>
<p>have you flushed your printf output? depending on configurations, your stdout might not be line-buffered.</p>



<a name="418622078"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/290350-wamr/topic/warning%3A%20failed%20to%20link%20import%20function/near/418622078" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> YAMAMOTO Takashi <a href="https://bytecodealliance.github.io/zulip-archive/stream/290350-wamr/topic/warning.3A.20failed.20to.20link.20import.20function.html#418622078">(Jan 29 2024 at 12:05)</a>:</h4>
<p>smaller stack and larger memory</p>



<a name="418799891"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/290350-wamr/topic/warning%3A%20failed%20to%20link%20import%20function/near/418799891" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Salvatore Bramante <a href="https://bytecodealliance.github.io/zulip-archive/stream/290350-wamr/topic/warning.3A.20failed.20to.20link.20import.20function.html#418799891">(Jan 30 2024 at 09:45)</a>:</h4>
<p>I've tried to double the initial memory and reduce stack but nothing happened. I do not think that the missing prints are related to stdout flush because with my first command:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="o">/</span><span class="cp">$HOME</span><span class="o">/</span><span class="n">wasi</span><span class="o">-</span><span class="n">sdk</span><span class="o">-</span><span class="mf">21.0</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">clang</span><span class="w">     </span><span class="err">\</span>
<span class="w">   </span><span class="o">--</span><span class="n">target</span><span class="o">=</span><span class="n">wasm32</span><span class="o">-</span><span class="n">wasi</span><span class="o">-</span><span class="n">threads</span><span class="w"> </span><span class="o">-</span><span class="n">pthread</span><span class="w"> </span><span class="o">-</span><span class="n">z</span><span class="w"> </span><span class="n">stack</span><span class="o">-</span><span class="n">size</span><span class="o">=</span><span class="mi">524288</span><span class="w"> </span><span class="o">-</span><span class="n">Wl</span><span class="p">,</span><span class="o">--</span><span class="n">initial</span><span class="o">-</span><span class="n">memory</span><span class="o">=</span><span class="mi">1048576</span><span class="w"> </span><span class="err">\</span>
<span class="w">   </span><span class="o">--</span><span class="n">sysroot</span><span class="o">=/</span><span class="cp">$HOME</span><span class="o">/</span><span class="n">wasi</span><span class="o">-</span><span class="n">sdk</span><span class="o">-</span><span class="mf">21.0</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">wasi</span><span class="o">-</span><span class="n">sysroot</span><span class="w">  </span><span class="err">\</span>
<span class="w">   </span><span class="o">-</span><span class="n">Wl</span><span class="p">,</span><span class="o">--</span><span class="n">allow</span><span class="o">-</span><span class="n">undefined</span><span class="o">-</span><span class="n">file</span><span class="o">=/</span><span class="cp">$HOME</span><span class="o">/</span><span class="n">wasi</span><span class="o">-</span><span class="n">sdk</span><span class="o">-</span><span class="mf">21.0</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">wasi</span><span class="o">-</span><span class="n">sysroot</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">wasm32</span><span class="o">-</span><span class="n">wasi</span><span class="o">-</span><span class="n">threads</span><span class="o">/</span><span class="n">defined</span><span class="o">-</span><span class="n">symbols</span><span class="p">.</span><span class="n">txt</span><span class="w"> </span><span class="err">\</span>
<span class="w">   </span><span class="o">-</span><span class="n">Wl</span><span class="p">,</span><span class="o">--</span><span class="n">strip</span><span class="o">-</span><span class="n">all</span><span class="p">,</span><span class="o">--</span><span class="n">no</span><span class="o">-</span><span class="n">entry</span><span class="w"> </span><span class="o">-</span><span class="n">nostdlib</span><span class="w"> </span><span class="err">\</span>
<span class="w">   </span><span class="o">-</span><span class="n">Wl</span><span class="p">,</span><span class="o">--</span><span class="n">export</span><span class="o">=</span><span class="n">main</span><span class="w"> </span><span class="err">\</span>
<span class="w">   </span><span class="o">-</span><span class="n">Wl</span><span class="p">,</span><span class="o">--</span><span class="n">export</span><span class="o">=</span><span class="n">__data_end</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">Wl</span><span class="p">,</span><span class="o">--</span><span class="n">export</span><span class="o">=</span><span class="n">__heap_base</span><span class="w"> </span><span class="err">\</span>
<span class="w">   </span><span class="o">-</span><span class="n">Wl</span><span class="p">,</span><span class="o">--</span><span class="n">allow</span><span class="o">-</span><span class="n">undefined</span><span class="w"> </span><span class="err">\</span>
<span class="w">   </span><span class="o">-</span><span class="n">o</span><span class="w"> </span><span class="cp">$WASM_BIN</span><span class="w"> </span><span class="cp">$C_FILE</span>
</code></pre></div>
<p>prinft worked but pthread did not.  The command you have suggested works only on my host machine (darwin) and not on my target (zephyr/qemu_cortex_a53).</p>



<a name="421649453"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/290350-wamr/topic/warning%3A%20failed%20to%20link%20import%20function/near/421649453" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> YAMAMOTO Takashi <a href="https://bytecodealliance.github.io/zulip-archive/stream/290350-wamr/topic/warning.3A.20failed.20to.20link.20import.20function.html#421649453">(Feb 15 2024 at 13:05)</a>:</h4>
<blockquote>
<p>I do not think that the missing prints are related to stdout flush</p>
</blockquote>
<p>have you tried to flush it?</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>