<html>
<head><meta charset="utf-8"><title>Is nano process suitable for long-running pod? · wasmtime on k8s · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/index.html">wasmtime on k8s</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Is.20nano.20process.20suitable.20for.20long-running.20pod.3F.html">Is nano process suitable for long-running pod?</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="191059388"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Is%20nano%20process%20suitable%20for%20long-running%20pod%3F/near/191059388" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Is.20nano.20process.20suitable.20for.20long-running.20pod.3F.html#191059388">(Mar 19 2020 at 00:12)</a>:</h4>
<p>Stream created by <span class="user-mention silent" data-user-id="273855">Owen Ou</span>.</p>



<a name="191059434"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Is%20nano%20process%20suitable%20for%20long-running%20pod%3F/near/191059434" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Is.20nano.20process.20suitable.20for.20long-running.20pod.3F.html#191059434">(Mar 19 2020 at 00:13)</a>:</h4>
<p>hi!</p>



<a name="191059526"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Is%20nano%20process%20suitable%20for%20long-running%20pod%3F/near/191059526" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Owen Ou <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Is.20nano.20process.20suitable.20for.20long-running.20pod.3F.html#191059526">(Mar 19 2020 at 00:14)</a>:</h4>
<p>Hello <span aria-label="wave" class="emoji emoji-1f44b" role="img" title="wave">:wave:</span></p>



<a name="191059580"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Is%20nano%20process%20suitable%20for%20long-running%20pod%3F/near/191059580" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Owen Ou <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Is.20nano.20process.20suitable.20for.20long-running.20pod.3F.html#191059580">(Mar 19 2020 at 00:15)</a>:</h4>
<p>Created this stream to communicate. I'm unsure if I should use the wasmtime stream or a new one (this). Let's try and see how it goes :)</p>



<a name="191059967"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Is%20nano%20process%20suitable%20for%20long-running%20pod%3F/near/191059967" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Owen Ou <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Is.20nano.20process.20suitable.20for.20long-running.20pod.3F.html#191059967">(Mar 19 2020 at 00:20)</a>:</h4>
<p>Posting Twitter discussion here for visibility: Krustlet spawns a thread for a long-running pod (<a href="https://github.com/deislabs/krustlet/blob/2eb577b88041349c463cc14b80cb83f63cc27e3a/crates/wasi-provider/src/wasi_runtime.rs#L139" target="_blank" title="https://github.com/deislabs/krustlet/blob/2eb577b88041349c463cc14b80cb83f63cc27e3a/crates/wasi-provider/src/wasi_runtime.rs#L139">https://github.com/deislabs/krustlet/blob/2eb577b88041349c463cc14b80cb83f63cc27e3a/crates/wasi-provider/src/wasi_runtime.rs#L139</a>) which isn't recommended for a multi-tenant k8s cluster due to possible Spectre attack IIUC</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/deislabs/krustlet/blob/2eb577b88041349c463cc14b80cb83f63cc27e3a/crates/wasi-provider/src/wasi_runtime.rs#L139" style="background-image: url(https://avatars1.githubusercontent.com/u/44041561?s=400&amp;v=4)" target="_blank"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/deislabs/krustlet/blob/2eb577b88041349c463cc14b80cb83f63cc27e3a/crates/wasi-provider/src/wasi_runtime.rs#L139" target="_blank" title="deislabs/krustlet">deislabs/krustlet</a></div><div class="message_embed_description">Kubernetes Rust Kubelet. Contribute to deislabs/krustlet development by creating an account on GitHub.</div></div></div>



<a name="191061384"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Is%20nano%20process%20suitable%20for%20long-running%20pod%3F/near/191061384" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Is.20nano.20process.20suitable.20for.20long-running.20pod.3F.html#191061384">(Mar 19 2020 at 00:48)</a>:</h4>
<p>(I'm not a Zulip expert, but it seems reasonable to have a separate stream just for these topics.)</p>



<a name="191061471"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Is%20nano%20process%20suitable%20for%20long-running%20pod%3F/near/191061471" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Is.20nano.20process.20suitable.20for.20long-running.20pod.3F.html#191061471">(Mar 19 2020 at 00:50)</a>:</h4>
<p>Yeah, so to restate what I said in the DM, it seems like it all depends on the context the service is being run in.  In full generality (long-running tasks, either with access to time or attacker is able to externally time), I believe you do have to put separate tenants/domains in separate OS processes.  It's a good question of what's the best way to achieve that with either a krustlet or containerd-shim approach.</p>



<a name="191130547"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Is%20nano%20process%20suitable%20for%20long-running%20pod%3F/near/191130547" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Brown <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Is.20nano.20process.20suitable.20for.20long-running.20pod.3F.html#191130547">(Mar 19 2020 at 15:35)</a>:</h4>
<p><span class="user-mention" data-user-id="273855">@Owen Ou</span>, I'm interested in this as well; I tried to get krustlet running a while back but ran into issues so I put that on hold. Have you had better luck with that or WaPC? Or are you thinking about creating something completely different?</p>



<a name="191632635"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Is%20nano%20process%20suitable%20for%20long-running%20pod%3F/near/191632635" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Owen Ou <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Is.20nano.20process.20suitable.20for.20long-running.20pod.3F.html#191632635">(Mar 24 2020 at 16:03)</a>:</h4>
<p><span class="user-mention" data-user-id="254110">@Andrew Brown</span> I'm trying to get more information from the krustlet folks this week. I'm thinking of building a containerd-shim that drives wasmtime.</p>



<a name="191633398"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Is%20nano%20process%20suitable%20for%20long-running%20pod%3F/near/191633398" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Owen Ou <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Is.20nano.20process.20suitable.20for.20long-running.20pod.3F.html#191633398">(Mar 24 2020 at 16:08)</a>:</h4>
<p>Regarding the wasmtime part, I would need wasmtime experts to chime in. It sounds like the most secure way is that each wasmtime instance runs in an OS process. But that means we don't get nano processes :(. Is there a way to avoid Spectre attack for nano processes?</p>



<a name="191635067"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Is%20nano%20process%20suitable%20for%20long-running%20pod%3F/near/191635067" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Brown <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Is.20nano.20process.20suitable.20for.20long-running.20pod.3F.html#191635067">(Mar 24 2020 at 16:19)</a>:</h4>
<p>I'm no expert but there have been discussions about this; cc: <span class="user-mention" data-user-id="258954">@Mingqiu Sun</span>, <span class="user-mention" data-user-id="253992">@Pat Hickey</span></p>



<a name="191643503"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Is%20nano%20process%20suitable%20for%20long-running%20pod%3F/near/191643503" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Owen Ou <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Is.20nano.20process.20suitable.20for.20long-running.20pod.3F.html#191643503">(Mar 24 2020 at 17:15)</a>:</h4>
<p><span class="user-mention" data-user-id="253998">@Luke Wagner</span> <span class="user-mention" data-user-id="253989">@Peter Huene</span> Circling back on the "wasmtime daemon" idea. There is a wasmtimed process that schedules wasm modules on a free wasmtime process in the wasmtime process pool. One nano process is scheduled on a wasmtime process at a time. Wasmtimed won't schedule module on a wasmtime process if it's already occupied by a nano process. <a href="/user_uploads/15107/vzg7mEEUQFwYAnsjxfzYSpKA/wasmtimed-1.png" target="_blank" title="wasmtimed-1.png">wasmtimed-1.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/15107/vzg7mEEUQFwYAnsjxfzYSpKA/wasmtimed-1.png" target="_blank" title="wasmtimed-1.png"><img src="/user_uploads/15107/vzg7mEEUQFwYAnsjxfzYSpKA/wasmtimed-1.png"></a></div>



<a name="191648718"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Is%20nano%20process%20suitable%20for%20long-running%20pod%3F/near/191648718" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Huene <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Is.20nano.20process.20suitable.20for.20long-running.20pod.3F.html#191648718">(Mar 24 2020 at 17:50)</a>:</h4>
<p>I think that was the gist of what Luke was describing, although I wonder if he meant it at the containerd-shim level or at a krustlet -implementation level.  I also think that there's timing attack mitigations we can do in WASI as well (a la limiting access to high-resolution timers like browsers do) that may assist in reducing attack surface for multi-tenant nanoprocesses in the same OS process.</p>



<a name="191649058"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Is%20nano%20process%20suitable%20for%20long-running%20pod%3F/near/191649058" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pat Hickey <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Is.20nano.20process.20suitable.20for.20long-running.20pod.3F.html#191649058">(Mar 24 2020 at 17:53)</a>:</h4>
<p>sorry, I don't have very much insight on this question, I'm not sure how the trust boundaries are being drawn in this problem space</p>



<a name="191657854"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Is%20nano%20process%20suitable%20for%20long-running%20pod%3F/near/191657854" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mingqiu Sun <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Is.20nano.20process.20suitable.20for.20long-running.20pod.3F.html#191657854">(Mar 24 2020 at 19:01)</a>:</h4>
<p>You may consider using the Intel Protection Key Tech for spectre protection at the thread level. But  currently there is a 16 domain limitation.</p>



<a name="191690433"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Is%20nano%20process%20suitable%20for%20long-running%20pod%3F/near/191690433" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Is.20nano.20process.20suitable.20for.20long-running.20pod.3F.html#191690433">(Mar 25 2020 at 00:35)</a>:</h4>
<p><span class="user-mention" data-user-id="273855">@Owen Ou</span> Yes, that is what I was imagining.  That design wasn't specific to either the krustlet or containerd-shim approach.  One high-level takeaway I had from the earlier chat was that the containerd-shim approach may force process creation in a way that might be incompatible with this approach -- it'd be good to verify that claim, though.</p>



<a name="191690515"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Is%20nano%20process%20suitable%20for%20long-running%20pod%3F/near/191690515" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Is.20nano.20process.20suitable.20for.20long-running.20pod.3F.html#191690515">(Mar 25 2020 at 00:36)</a>:</h4>
<p><span class="user-mention" data-user-id="253989">@Peter Huene</span> Even if we take away time via WASI impl, if the wasm can be long-running and the attacker can externally time how long it takes to run (b/c, e.g., the wasm is running as part of a request/response loop), then a timing attack is still possible (b/c the attacker wasm can vary how long it takes based on the speculatively-stolen secret value).</p>



<a name="192419105"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Is%20nano%20process%20suitable%20for%20long-running%20pod%3F/near/192419105" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Thomas <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Is.20nano.20process.20suitable.20for.20long-running.20pod.3F.html#192419105">(Mar 31 2020 at 17:04)</a>:</h4>
<p>Hey all! Finally joined in here so you can just ask Krustlet questions directly :D</p>



<a name="192421203"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Is%20nano%20process%20suitable%20for%20long-running%20pod%3F/near/192421203" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matt Fisher <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Is.20nano.20process.20suitable.20for.20long-running.20pod.3F.html#192421203">(Mar 31 2020 at 17:20)</a>:</h4>
<p>RE: the threading vs. separate OS process approach: we are still working through Krustlet's design. We are still weighing both approaches, and both are possible in the current architecture - just write a new wasmtime Provider that spawns wasmtime instances in a new process and let the Provider manage the instance.</p>
<p>You can take a look at <a href="http://wasi_runtime.rs" title="http://wasi_runtime.rs">wasi_runtime.rs</a> to see how this is accomplished: <a href="https://github.com/deislabs/krustlet/blob/af061f0487fdacdb407bb798501b92b95f78f978/crates/wasi-provider/src/wasi_runtime.rs#L132" title="https://github.com/deislabs/krustlet/blob/af061f0487fdacdb407bb798501b92b95f78f978/crates/wasi-provider/src/wasi_runtime.rs#L132">https://github.com/deislabs/krustlet/blob/af061f0487fdacdb407bb798501b92b95f78f978/crates/wasi-provider/src/wasi_runtime.rs#L132</a></p>
<p>I'm not familiar with the speculative timing attacks mentioned here WRT spawning untrusted wasmtime instances in separate threads. Is there some ticket or design doc that describes this attack in more detail?</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/deislabs/krustlet/blob/af061f0487fdacdb407bb798501b92b95f78f978/crates/wasi-provider/src/wasi_runtime.rs#L132" style="background-image: url(https://avatars1.githubusercontent.com/u/44041561?s=400&amp;v=4)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/deislabs/krustlet/blob/af061f0487fdacdb407bb798501b92b95f78f978/crates/wasi-provider/src/wasi_runtime.rs#L132" title="deislabs/krustlet">deislabs/krustlet</a></div><div class="message_embed_description">Kubernetes Rust Kubelet. Contribute to deislabs/krustlet development by creating an account on GitHub.</div></div></div>



<a name="192554987"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Is%20nano%20process%20suitable%20for%20long-running%20pod%3F/near/192554987" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Owen Ou <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Is.20nano.20process.20suitable.20for.20long-running.20pod.3F.html#192554987">(Apr 01 2020 at 16:29)</a>:</h4>
<p><span class="user-mention" data-user-id="280225">@Matt Fisher</span>:  I think <span class="user-mention" data-user-id="253998">@Luke Wagner</span> and <span class="user-mention" data-user-id="253989">@Peter Huene</span> have more info on ^</p>



<a name="192564591"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Is%20nano%20process%20suitable%20for%20long-running%20pod%3F/near/192564591" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Wagner <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Is.20nano.20process.20suitable.20for.20long-running.20pod.3F.html#192564591">(Apr 01 2020 at 17:34)</a>:</h4>
<p><span class="user-mention" data-user-id="280225">@Matt Fisher</span>  The issue isn't really specific to wasmtime; it's more of a general Spectre consequence that is our new reality.  Basically, the only general way to prevent Spectre attacks is to use an OS process boundary (which are occasionally breached, but at least CPU/OS vendors work in concert to fix these by adding mitigations to context/ring switches).  Acknowledging this fact is why browsers are all doing process-per-origin/site (<a href="https://chromium.googlesource.com/chromium/src/+/master/docs/security/side-channel-threat-model.md" title="https://chromium.googlesource.com/chromium/src/+/master/docs/security/side-channel-threat-model.md">https://chromium.googlesource.com/chromium/src/+/master/docs/security/side-channel-threat-model.md</a>).  Wasmtime really doesn't have a say in the matter in the absence of any sub-process "Time Protection" (<a href="https://ts.data61.csiro.au/publications/csiro_full_text//Ge_YCH_19.pdf" title="https://ts.data61.csiro.au/publications/csiro_full_text//Ge_YCH_19.pdf">https://ts.data61.csiro.au/publications/csiro_full_text//Ge_YCH_19.pdf</a>) primitives.  Of course, in constrained execution scenarios (where you can limit what the attacker can do or observe), one can avoid OS processes, as edge compute vendors have done, but making that argument takes a lot more work and context.</p>



<a name="192622629"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Is%20nano%20process%20suitable%20for%20long-running%20pod%3F/near/192622629" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Owen Ou <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Is.20nano.20process.20suitable.20for.20long-running.20pod.3F.html#192622629">(Apr 02 2020 at 05:35)</a>:</h4>
<p><span class="user-mention" data-user-id="280224">@Taylor Thomas</span> <span class="user-mention" data-user-id="280225">@Matt Fisher</span> I'm trying to get krustlet to run on EKS. I was able to get the krustlet node to register but <code>kubectl logs</code> didn't work:</p>
<div class="codehilite"><pre><span></span>k get nodes -o wide
NAME                                           STATUS   ROLES    AGE   VERSION              INTERNAL-IP      EXTERNAL-IP    OS-IMAGE         KERNEL-VERSION                  CONTAINER-RUNTIME
ip-192-168-23-105.us-west-2.compute.internal   Ready    &lt;none&gt;   55m   v1.14.9-eks-1f0ca9   192.168.23.105   34.221.97.70   Amazon Linux 2   4.14.171-136.231.amzn2.x86_64   docker://18.9.9
ip-192-168-55-201.us-west-2.compute.internal   Ready    agent    8s    v1.17.0              192.168.55.201   &lt;none&gt;         &lt;unknown&gt;        &lt;unknown&gt;                       mvp
</pre></div>


<div class="codehilite"><pre><span></span>k get po
NAME                    READY   STATUS       RESTARTS   AGE
hello-world-wasi-rust   0/1     ExitCode:0   0          2s
</pre></div>


<div class="codehilite"><pre><span></span>k logs hello-world-wasi-rust
Error from server: Get https://192.168.55.201:3000/containerLogs/default/hello-world-wasi-rust/hello-world-wasi-rust: x509: cannot validate certificate for 192.168.55.201 because it doesn&#39;t contain any IP SANs
</pre></div>


<div class="codehilite"><pre><span></span>KUBECONFIG=./kubeconfig-sa PFX_PATH=./krustlet.pfx PFX_PASSWORD=password ./krustlet-wasi
[2020-04-02T05:26:34Z ERROR kubelet::server] error handling connection: error:14094412:SSL routines:ssl3_read_bytes:sslv3 alert bad certificate:ssl/record/rec_layer_s3.c:1544:SSL alert number 42
</pre></div>


<p>There seems to be some cert issue. Do you happen to know what went wrong?</p>
<p>On the node, I could curl the log though by ignoring the cert:</p>
<div class="codehilite"><pre><span></span>curl https://192.168.55.201:3000/containerLogs/default/hello-world-wasi-rust/hello-world-wasi-rust -v -k
*   Trying 192.168.55.201...
* TCP_NODELAY set
* Connected to 192.168.55.201 (192.168.55.201) port 3000 (#0)
* ALPN, offering h2
* ALPN, offering http/1.1
* Cipher selection: ALL:!EXPORT:!EXPORT40:!EXPORT56:!aNULL:!LOW:!RC4:@STRENGTH
* successfully set certificate verify locations:
*   CAfile: /etc/pki/tls/certs/ca-bundle.crt
  CApath: none
* TLSv1.2 (OUT), TLS header, Certificate Status (22):
* TLSv1.2 (OUT), TLS handshake, Client hello (1):
* TLSv1.2 (IN), TLS handshake, Server hello (2):
* TLSv1.2 (IN), TLS handshake, Certificate (11):
* TLSv1.2 (IN), TLS handshake, Server key exchange (12):
* TLSv1.2 (IN), TLS handshake, Server finished (14):
* TLSv1.2 (OUT), TLS handshake, Client key exchange (16):
* TLSv1.2 (OUT), TLS change cipher, Change cipher spec (1):
* TLSv1.2 (OUT), TLS handshake, Finished (20):
* TLSv1.2 (IN), TLS change cipher, Change cipher spec (1):
* TLSv1.2 (IN), TLS handshake, Finished (20):
* SSL connection using TLSv1.2 / ECDHE-RSA-AES128-GCM-SHA256
* ALPN, server did not agree to a protocol
* Server certificate:
*  subject: C=US; ST=.; L=.; O=.; OU=.; CN=krustlet
*  start date: Apr  2 04:44:00 2020 GMT
*  expire date: Apr  2 04:44:00 2021 GMT
*  issuer: CN=kubernetes
*  SSL certificate verify result: unable to get local issuer certificate (20), continuing anyway.
&gt; GET /containerLogs/default/hello-world-wasi-rust/hello-world-wasi-rust HTTP/1.1
&gt; Host: 192.168.55.201:3000
&gt; User-Agent: curl/7.61.1
&gt; Accept: */*
&gt;
&lt; HTTP/1.1 200 OK
&lt; content-length: 116
&lt; date: Thu, 02 Apr 2020 05:41:59 GMT
&lt;
hello from stdout!
hello from stderr!
FOO=bar
CONFIG_MAP_VAL=cool stuff
POD_NAME=hello-world-wasi-rust
Args are: []
* Connection #0 to host 192.168.55.201 left intact
</pre></div>


<p>Another question is that I was trying to run <code>kubectl logs</code> on my local machine against EKS and <code>192.168.55.201</code> is an internal IP. Would I be able to access the log via this internal IP? Should there be an external IP field for Krustlet in <code>kubectl get node</code>? This is what a normal kubelet registers on the same node with both internal ip and external ip:</p>
<div class="codehilite"><pre><span></span>k get nodes -o wide
NAME                                           STATUS   ROLES    AGE   VERSION              INTERNAL-IP      EXTERNAL-IP      OS-IMAGE         KERNEL-VERSION                  CONTAINER-RUNTIME
ip-192-168-23-105.us-west-2.compute.internal   Ready    &lt;none&gt;   50m   v1.14.9-eks-1f0ca9   192.168.23.105   34.221.97.70     Amazon Linux 2   4.14.171-136.231.amzn2.x86_64   docker://18.9.9
ip-192-168-55-201.us-west-2.compute.internal   Ready    &lt;none&gt;   50m   v1.14.9-eks-1f0ca9   192.168.55.201   54.187.160.172   Amazon Linux 2   4.14.171-136.231.amzn2.x86_64   docker://19.3.6
</pre></div>



<a name="192679744"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Is%20nano%20process%20suitable%20for%20long-running%20pod%3F/near/192679744" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matt Fisher <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Is.20nano.20process.20suitable.20for.20long-running.20pod.3F.html#192679744">(Apr 02 2020 at 15:13)</a>:</h4>
<p>Go's TLS crypto library sure is funny... Do you have steps available for how you generated the certificate for the Krustlet node?</p>
<p><span class="user-mention" data-user-id="280224">@Taylor Thomas</span> have you seen this error before? Perhaps it has to do with the <code>common-name</code> parameter when generating the certificate...</p>



<a name="192685256"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Is%20nano%20process%20suitable%20for%20long-running%20pod%3F/near/192685256" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Thomas <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Is.20nano.20process.20suitable.20for.20long-running.20pod.3F.html#192685256">(Apr 02 2020 at 15:43)</a>:</h4>
<p><span class="user-mention" data-user-id="273855">@Owen Ou</span> It looks like you gave the cert the common name of "krustlet" but it has a host name of <code>ip-192-168-55-201.us-west-2.compute.internal</code> That could possibly be the issue. As for the external IP thing, we should probably open an issue to have it register that as well, although for this initial case, we have been targeting things that don't necessarily have a publicly accessible IP address</p>



<a name="192702921"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Is%20nano%20process%20suitable%20for%20long-running%20pod%3F/near/192702921" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Owen Ou <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Is.20nano.20process.20suitable.20for.20long-running.20pod.3F.html#192702921">(Apr 02 2020 at 17:54)</a>:</h4>
<p><span class="user-mention" data-user-id="280224">@Taylor Thomas</span> <span class="user-mention" data-user-id="280225">@Matt Fisher</span>:</p>
<p>I followed the step in <a href="https://github.com/deislabs/krustlet/blob/master/docs/howto/krustlet-on-aks.md#step-2-create-certificate" title="https://github.com/deislabs/krustlet/blob/master/docs/howto/krustlet-on-aks.md#step-2-create-certificate">https://github.com/deislabs/krustlet/blob/master/docs/howto/krustlet-on-aks.md#step-2-create-certificate</a> to generate the cert.</p>
<p>Same issue after changing the CN to <code>ip-192-168-55-201.us-west-2.compute.internal</code>:</p>
<div class="codehilite"><pre><span></span>k logs hello-world-wasi-rust
Error from server: Get https://192.168.55.201:3000/containerLogs/default/hello-world-wasi-rust/hello-world-wasi-rust: x509: cannot validate certificate for 192.168.55.201 because it doesn&#39;t contain any IP SANs
</pre></div>


<div class="codehilite"><pre><span></span>curl https://192.168.55.201:3000/containerLogs/default/hello-world-wasi-rust/hello-world-wasi-rust -v -k
*   Trying 192.168.55.201...
* TCP_NODELAY set
* Connected to 192.168.55.201 (192.168.55.201) port 3000 (#0)
* ALPN, offering h2
* ALPN, offering http/1.1
* Cipher selection: ALL:!EXPORT:!EXPORT40:!EXPORT56:!aNULL:!LOW:!RC4:@STRENGTH
* successfully set certificate verify locations:
*   CAfile: /etc/pki/tls/certs/ca-bundle.crt
  CApath: none
* TLSv1.2 (OUT), TLS header, Certificate Status (22):
* TLSv1.2 (OUT), TLS handshake, Client hello (1):
* TLSv1.2 (IN), TLS handshake, Server hello (2):
* TLSv1.2 (IN), TLS handshake, Certificate (11):
* TLSv1.2 (IN), TLS handshake, Server key exchange (12):
* TLSv1.2 (IN), TLS handshake, Server finished (14):
* TLSv1.2 (OUT), TLS handshake, Client key exchange (16):
* TLSv1.2 (OUT), TLS change cipher, Change cipher spec (1):
* TLSv1.2 (OUT), TLS handshake, Finished (20):
* TLSv1.2 (IN), TLS change cipher, Change cipher spec (1):
* TLSv1.2 (IN), TLS handshake, Finished (20):
* SSL connection using TLSv1.2 / ECDHE-RSA-AES128-GCM-SHA256
* ALPN, server did not agree to a protocol
* Server certificate:
*  subject: C=US; ST=.; L=.; O=.; OU=.; CN=ip-192-168-55-201.us-west-2.compute.internal
*  start date: Apr  2 17:44:00 2020 GMT
*  expire date: Apr  2 17:44:00 2021 GMT
*  issuer: CN=kubernetes
*  SSL certificate verify result: unable to get local issuer certificate (20), continuing anyway.
&gt; GET /containerLogs/default/hello-world-wasi-rust/hello-world-wasi-rust HTTP/1.1
&gt; Host: 192.168.55.201:3000
&gt; User-Agent: curl/7.61.1
&gt; Accept: */*
&gt;
&lt; HTTP/1.1 200 OK
&lt; content-length: 116
&lt; date: Thu, 02 Apr 2020 17:52:13 GMT
&lt;
hello from stdout!
hello from stderr!
FOO=bar
CONFIG_MAP_VAL=cool stuff
POD_NAME=hello-world-wasi-rust
Args are: []
* Connection #0 to host 192.168.55.201 left intact
</pre></div>


<div class="message_embed"><a class="message_embed_image" href="https://github.com/deislabs/krustlet/blob/master/docs/howto/krustlet-on-aks.md#step-2-create-certificate" style="background-image: url(https://avatars1.githubusercontent.com/u/44041561?s=400&amp;v=4)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/deislabs/krustlet/blob/master/docs/howto/krustlet-on-aks.md#step-2-create-certificate" title="deislabs/krustlet">deislabs/krustlet</a></div><div class="message_embed_description">Kubernetes Rust Kubelet. Contribute to deislabs/krustlet development by creating an account on GitHub.</div></div></div>



<a name="192703005"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Is%20nano%20process%20suitable%20for%20long-running%20pod%3F/near/192703005" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Thomas <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Is.20nano.20process.20suitable.20for.20long-running.20pod.3F.html#192703005">(Apr 02 2020 at 17:55)</a>:</h4>
<p>"cannot validate certificate for 192.168.55.201 because it doesn't contain any IP SANs" looks like we need to set its IP as well?</p>



<a name="192703047"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Is%20nano%20process%20suitable%20for%20long-running%20pod%3F/near/192703047" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Thomas <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Is.20nano.20process.20suitable.20for.20long-running.20pod.3F.html#192703047">(Apr 02 2020 at 17:55)</a>:</h4>
<p>I didn't need to on the AKS example, but not sure what the differences are</p>



<a name="192705749"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Is%20nano%20process%20suitable%20for%20long-running%20pod%3F/near/192705749" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Owen Ou <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Is.20nano.20process.20suitable.20for.20long-running.20pod.3F.html#192705749">(Apr 02 2020 at 18:17)</a>:</h4>
<p><span class="user-mention" data-user-id="280224">@Taylor Thomas</span> Setting IP as the CN? I did that as well and still got the same error.</p>



<a name="192708694"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Is%20nano%20process%20suitable%20for%20long-running%20pod%3F/near/192708694" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Thomas <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Is.20nano.20process.20suitable.20for.20long-running.20pod.3F.html#192708694">(Apr 02 2020 at 18:43)</a>:</h4>
<p>I honestly am not good with cert stuff but I think you need to set the SAN with the IP as well (not as the CN):</p>
<div class="codehilite"><pre><span></span>[ req ]
default_bits       = 2048
distinguished_name = req_distinguished_name
req_extensions     = req_ext
[ req_distinguished_name ]
countryName                 = Country Name (2 letter code)
stateOrProvinceName         = State or Province Name (full name)
localityName               = Locality Name (eg, city)
organizationName           = Organization Name (eg, company)
commonName                 = Common Name (e.g. server FQDN or YOUR name)
[ req_ext ]
subjectAltName = @alt_names
[alt_names]
IP.1 = &lt;ip_addr&gt;
</pre></div>



<a name="192708734"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Is%20nano%20process%20suitable%20for%20long-running%20pod%3F/near/192708734" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Thomas <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Is.20nano.20process.20suitable.20for.20long-running.20pod.3F.html#192708734">(Apr 02 2020 at 18:43)</a>:</h4>
<p>Let me put together a full file</p>



<a name="192709578"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Is%20nano%20process%20suitable%20for%20long-running%20pod%3F/near/192709578" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Thomas <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Is.20nano.20process.20suitable.20for.20long-running.20pod.3F.html#192709578">(Apr 02 2020 at 18:51)</a>:</h4>
<p>Try this: </p>
<div class="codehilite"><pre><span></span>[ req ]
distinguished_name = req_distinguished_name
x509_extensions = v3_req
prompt = no
[ req_distinguished_name ]
C = US
ST = .
L = .
OU = .
CN = krustlet
[ v3_req ]
subjectAltName = @alt_names
[alt_names]
IP.1 = 192.168.55.201
</pre></div>


<p>With this command: <br>
<code>openssl req -new -sha256 -newkey rsa:2048 -keyout krustlet.key -out krustlet.csr -nodes -config test_csr.cnf</code></p>
<p>Saving that file as `test_csr.cnf.</p>



<a name="192709585"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Is%20nano%20process%20suitable%20for%20long-running%20pod%3F/near/192709585" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Thomas <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Is.20nano.20process.20suitable.20for.20long-running.20pod.3F.html#192709585">(Apr 02 2020 at 18:51)</a>:</h4>
<p>That should generate your CSR</p>



<a name="192709762"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Is%20nano%20process%20suitable%20for%20long-running%20pod%3F/near/192709762" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Thomas <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Is.20nano.20process.20suitable.20for.20long-running.20pod.3F.html#192709762">(Apr 02 2020 at 18:52)</a>:</h4>
<p>And maybe with that IP address it will allow it</p>



<a name="192709818"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Is%20nano%20process%20suitable%20for%20long-running%20pod%3F/near/192709818" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Thomas <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Is.20nano.20process.20suitable.20for.20long-running.20pod.3F.html#192709818">(Apr 02 2020 at 18:53)</a>:</h4>
<p>curl will never be successful without <code>-k</code> unless you have the CA cert from k8s available</p>



<a name="192731429"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Is%20nano%20process%20suitable%20for%20long-running%20pod%3F/near/192731429" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Owen Ou <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Is.20nano.20process.20suitable.20for.20long-running.20pod.3F.html#192731429">(Apr 02 2020 at 21:49)</a>:</h4>
<p>I tried your cnf file and regenerated certs. Still the same <code>x509: cannot validate certificate for 192.168.55.201 because it doesn't contain any IP SANs</code> error</p>



<a name="192732096"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Is%20nano%20process%20suitable%20for%20long-running%20pod%3F/near/192732096" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Owen Ou <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Is.20nano.20process.20suitable.20for.20long-running.20pod.3F.html#192732096">(Apr 02 2020 at 21:56)</a>:</h4>
<p>I tried to curl with the generated crt on the host and got an error:</p>
<div class="codehilite"><pre><span></span>curl https://192.168.55.201:3000/containerLogs/default/hello-world-wasi-rust/hello-world-wasi-rust -v --cacert ./krustlet.crt
*   Trying 192.168.55.201...
* TCP_NODELAY set
* Connected to 192.168.55.201 (192.168.55.201) port 3000 (#0)
* ALPN, offering h2
* ALPN, offering http/1.1
* Cipher selection: ALL:!EXPORT:!EXPORT40:!EXPORT56:!aNULL:!LOW:!RC4:@STRENGTH
* successfully set certificate verify locations:
*   CAfile: ./krustlet.crt
  CApath: none
* TLSv1.2 (OUT), TLS header, Certificate Status (22):
* TLSv1.2 (OUT), TLS handshake, Client hello (1):
* TLSv1.2 (IN), TLS handshake, Server hello (2):
* TLSv1.2 (IN), TLS handshake, Certificate (11):
* TLSv1.2 (OUT), TLS alert, unknown CA (560):
* SSL certificate problem: unable to get local issuer certificate
* Closing connection 0
curl: (60) SSL certificate problem: unable to get local issuer certificate
More details here: https://curl.haxx.se/docs/sslcerts.html

curl failed to verify the legitimacy of the server and therefore could not
establish a secure connection to it. To learn more about this situation and
how to fix it, please visit the web page mentioned above.
</pre></div>



<a name="192733525"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Is%20nano%20process%20suitable%20for%20long-running%20pod%3F/near/192733525" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Thomas <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Is.20nano.20process.20suitable.20for.20long-running.20pod.3F.html#192733525">(Apr 02 2020 at 22:09)</a>:</h4>
<p><span class="user-mention" data-user-id="273855">@Owen Ou</span> we might need to do a little debug session tomorrow. I am kind of confused how I got the certs to work so easily with AKS and it is being difficult with EKS, even though they are technically the same process. If you are available tomorrow, I can make some time</p>



<a name="192733683"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Is%20nano%20process%20suitable%20for%20long-running%20pod%3F/near/192733683" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Owen Ou <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Is.20nano.20process.20suitable.20for.20long-running.20pod.3F.html#192733683">(Apr 02 2020 at 22:10)</a>:</h4>
<p><span class="user-mention" data-user-id="280224">@Taylor Thomas</span> That would be perfect. Thank you! I'm available anytime after 2pm PST tomorrow. My email <a href="mailto:o@heroku.com" title="mailto:o@heroku.com">o@heroku.com</a></p>



<a name="192739191"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Is%20nano%20process%20suitable%20for%20long-running%20pod%3F/near/192739191" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Owen Ou <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Is.20nano.20process.20suitable.20for.20long-running.20pod.3F.html#192739191">(Apr 02 2020 at 23:06)</a>:</h4>
<p>Hmm...I think it's an EKS issue: <a href="https://github.com/awslabs/amazon-eks-ami/issues/341" title="https://github.com/awslabs/amazon-eks-ami/issues/341">https://github.com/awslabs/amazon-eks-ami/issues/341</a>. The crt signed by kube api doesn't have IP bit:</p>
<div class="codehilite"><pre><span></span>$ openssl x509 -noout -text -in krustlet.crt
Certificate:
    Data:
        Version: 3 (0x2)
        Serial Number:
            36:65:33:da:2b:34:a5:e5:e7:ee:4a:36:4b:5c:c3:c0:45:5c:de:a3
    Signature Algorithm: sha256WithRSAEncryption
        Issuer: CN=kubernetes
        Validity
            Not Before: Apr  2 05:42:00 2020 GMT
            Not After : Apr  2 05:42:00 2021 GMT
        Subject: C=US, ST=., L=., O=., OU=., CN=krustlet
        Subject Public Key Info:
            Public Key Algorithm: rsaEncryption
                Public-Key: (2048 bit)
                Modulus:
                    00:ee:4a:1c:d5:24:6c:98:6c:87:0a:2b:09:74:16:
                    9e:b9:01:15:92:dd:1e:0a:8f:58:19:68:a8:5c:3a:
                    73:c1:d1:d7:ca:f0:30:c1:f3:09:40:71:f8:e1:3d:
                    c4:bd:6e:c5:08:ba:36:27:7c:ab:85:4d:01:97:81:
                    b7:e2:d0:39:8f:a4:09:e1:d0:77:3e:7c:80:60:6b:
                    e3:c0:5a:16:e3:ed:ec:06:64:40:b0:15:2a:c1:fe:
                    2a:fb:ed:ad:b6:11:d3:93:f7:88:2b:4a:0c:be:d9:
                    3f:c9:1e:0a:95:b6:50:63:5e:d4:04:95:6a:23:11:
                    b7:23:a6:8e:c0:0d:51:1b:9d:c9:f7:23:9b:ea:c5:
                    85:0a:bb:12:55:15:4c:99:61:97:5d:29:2c:6f:03:
                    02:11:44:18:fa:88:b8:9f:04:46:b4:df:e4:27:81:
                    91:ba:5b:51:b9:ea:f9:df:ff:00:99:e3:69:f7:4e:
                    af:ce:f0:9c:cb:23:0f:51:68:53:ab:0d:33:0d:27:
                    92:d5:02:41:12:d8:5e:3c:bd:00:03:bc:98:21:f4:
                    99:09:d1:19:21:02:1c:8d:5a:99:0e:f9:44:c5:6d:
                    04:82:6e:06:e7:eb:e9:d2:91:18:be:96:3a:7b:81:
                    89:e7:d6:ce:ca:26:8b:76:cc:05:25:fd:83:ee:d4:
                    64:f5
                Exponent: 65537 (0x10001)
        X509v3 extensions:
            X509v3 Key Usage: critical
                Digital Signature, Key Encipherment
            X509v3 Extended Key Usage:
                TLS Web Server Authentication
            X509v3 Basic Constraints: critical
                CA:FALSE
            X509v3 Subject Key Identifier:
                B4:02:BB:10:95:05:31:73:2D:1E:44:E3:81:67:51:4B:7D:F2:25:E9
    Signature Algorithm: sha256WithRSAEncryption
         46:f2:e8:44:f4:f3:35:0d:56:32:df:5d:63:1d:0d:72:f4:98:
         2e:3d:c3:05:dc:86:09:90:da:83:9e:28:74:a0:39:0b:43:4e:
         90:a8:9f:a9:61:7f:2c:44:74:a0:b0:21:b6:b7:46:a5:d8:cd:
         bf:68:30:32:19:4e:84:73:57:77:26:c0:78:d5:0e:21:d5:4d:
         d4:4a:c9:8f:08:41:7f:d1:62:9b:b8:d1:4b:1f:4d:98:9a:15:
         21:d2:26:bc:b3:6f:10:80:d3:53:43:71:29:39:39:6d:8e:0c:
         67:a9:02:50:a9:37:b2:c4:3e:f0:30:eb:1a:1a:95:93:04:c4:
         04:38:e3:89:55:e4:84:a4:fa:df:24:fa:44:88:20:46:c0:7d:
         b9:c1:71:8a:63:a3:db:ee:ad:05:57:46:1b:b4:e4:1c:ff:75:
         85:85:42:7a:40:87:10:34:af:53:8d:0c:f8:0e:10:96:53:37:
         a4:97:5f:25:d2:23:9e:d4:6a:05:be:f9:a2:bd:47:ad:09:65:
         90:4b:0f:c1:63:eb:b8:62:60:ee:2e:e1:92:cd:ae:e3:04:54:
         b8:8c:b3:8e:36:22:4b:bd:97:ae:5a:51:c5:16:b2:13:cc:cc:
         17:74:92:ee:60:28:22:02:a2:e0:29:0e:f8:cf:92:cf:a8:85:
         2e:3a:b6:eb
</pre></div>


<p>But I can see IP in the altname for the csr that I uploaded:</p>
<div class="codehilite"><pre><span></span>$ k describe CertificateSigningRequest
Name:         krustlet
Labels:       &lt;none&gt;
Annotations:  kubectl.kubernetes.io/last-applied-configuration

CreationTimestamp:  Thu, 02 Apr 2020 15:47:50 -0700
Requesting User:    kubernetes-admin
Status:             Approved,Issued
Subject:
  Common Name:    192.168.55.201
  Serial Number:
Subject Alternative Names:
         DNS Names:     ip-192-168-55-201.us-west-2.compute.internal
         IP Addresses:  192.168.55.201
Events:  &lt;none&gt;
</pre></div>


<div class="message_embed"><a class="message_embed_image" href="https://github.com/awslabs/amazon-eks-ami/issues/341" style="background-image: url(https://avatars2.githubusercontent.com/u/3299148?s=400&amp;v=4)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/awslabs/amazon-eks-ami/issues/341" title="Certificates generated by the cluster signer are missing SANs · Issue #341 · awslabs/amazon-eks-ami">Certificates generated by the cluster signer are missing SANs · Issue #341 · awslabs/amazon-eks-ami</a></div><div class="message_embed_description">We&#39;re facing an issue that was reported before as part of another issue (#244 (comment)) but since the original issue was about something different which is fixed by now I&#39;m extracting this...</div></div></div>



<a name="192739396"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Is%20nano%20process%20suitable%20for%20long-running%20pod%3F/near/192739396" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Owen Ou <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Is.20nano.20process.20suitable.20for.20long-running.20pod.3F.html#192739396">(Apr 02 2020 at 23:08)</a>:</h4>
<p>Can Krustlet support getting the log by DNS name? For example, <code>https://192.168.55.201:3000/containerLogs/default/hello-world-wasi-rust/hello-world-wasi-rust</code> becomes <code>https://ip-192-168-55-201.us-west-2.compute.internal:3000/containerLogs/default/hello-world-wasi-rust/hello-world-wasi-rust</code>. Perhaps that's recommended by EKS. Besides, IP addr can change. Using DNS name is more stable.</p>



<a name="192748188"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Is%20nano%20process%20suitable%20for%20long-running%20pod%3F/near/192748188" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Owen Ou <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Is.20nano.20process.20suitable.20for.20long-running.20pod.3F.html#192748188">(Apr 03 2020 at 01:10)</a>:</h4>
<p>Is this diagram accurate for Krustlet?<br>
<a href="user_uploads/15107/_S1BRzJqfPftsR0jIr-qhkm7/krustlet.png" title="user_uploads/15107/_S1BRzJqfPftsR0jIr-qhkm7/krustlet.png">krustlet.png</a></p>
<div class="message_inline_image"><a href="user_uploads/15107/_S1BRzJqfPftsR0jIr-qhkm7/krustlet.png" title="krustlet.png"><img src="user_uploads/15107/_S1BRzJqfPftsR0jIr-qhkm7/krustlet.png"></a></div><p>I see that there is no kube-proxy equivalent for krustlet yet. I assume it's going to be in the same krustlet process.</p>



<a name="192825207"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Is%20nano%20process%20suitable%20for%20long-running%20pod%3F/near/192825207" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Thomas <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Is.20nano.20process.20suitable.20for.20long-running.20pod.3F.html#192825207">(Apr 03 2020 at 15:57)</a>:</h4>
<p>DNS is perfectly acceptable, I don't think that is a required change for Krustlet unless we aren't configuring something. But I know we are setting the hostname when creating the node, so it seems like a k8s thing (could be totally wrong). If it is something we need to change in Krustlet, let me know and we'll add it in</p>
<p>As for your diagram, it looks correct, except for the providers. There is a 1:1 mapping between each krustlet "node" and provider. To clarify: each running Krustlet process only has 1 provider, though you can run multiple krustlet processes on the same node</p>



<a name="192834836"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Is%20nano%20process%20suitable%20for%20long-running%20pod%3F/near/192834836" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Thomas <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Is.20nano.20process.20suitable.20for.20long-running.20pod.3F.html#192834836">(Apr 03 2020 at 17:03)</a>:</h4>
<p><span class="user-mention" data-user-id="273855">@Owen Ou</span> So it looks like AKS is using DNS addresses: </p>
<div class="codehilite"><pre><span></span># Normal pod
https://aks-agentpool-81651327-vmss000000:10250/containerLogs/kube-system/tunnelfront-864c788cf6-mtkg4/tunnel-front
# Krustlet pod
https://krustlet:3000/containerLogs/default/hello-world-wasi-rust/hello-world-wasi-rust
</pre></div>



<a name="192838748"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Is%20nano%20process%20suitable%20for%20long-running%20pod%3F/near/192838748" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Owen Ou <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Is.20nano.20process.20suitable.20for.20long-running.20pod.3F.html#192838748">(Apr 03 2020 at 17:33)</a>:</h4>
<p><span class="user-mention" data-user-id="280224">@Taylor Thomas</span> Krustlet boots with the node IP. It seems like AKS does a reverse lookup of IP -&gt; DNS and call the DNS instead?</p>



<a name="192839419"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Is%20nano%20process%20suitable%20for%20long-running%20pod%3F/near/192839419" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Thomas <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Is.20nano.20process.20suitable.20for.20long-running.20pod.3F.html#192839419">(Apr 03 2020 at 17:38)</a>:</h4>
<p>Krustlet sets the hostname (there is also an ability to override it) on the node object. Here is an example node from my cluster:</p>
<div class="codehilite"><pre><span></span>apiVersion: v1
kind: Node
metadata:
  annotations:
    node.alpha.kubernetes.io/ttl: &quot;0&quot;
    volumes.kubernetes.io/controller-managed-attach-detach: &quot;true&quot;
  creationTimestamp: &quot;2020-04-02T18:13:32Z&quot;
  labels:
    beta.kubernetes.io/arch: wasm32-wasi
    beta.kubernetes.io/os: linux
    kubernetes.io/arch: wasm32-wasi
    kubernetes.io/hostname: Taylors-MacBook-Pro.local
    kubernetes.io/os: linux
    kubernetes.io/role: agent
    type: krustlet
  name: krustlet-wasi
  resourceVersion: &quot;2182784&quot;
  selfLink: /api/v1/nodes/krustlet-wasi
  uid: 89b11130-8f61-44d5-b92b-edd348497517
spec:
  podCIDR: 10.244.0.0/24
  podCIDRs:
  - 10.244.0.0/24
  taints:
  - effect: NoExecute
    key: krustlet/arch
    value: wasm32-wasi
  - effect: NoSchedule
    key: node.kubernetes.io/unreachable
    timeAdded: &quot;2020-04-02T18:23:57Z&quot;
  - effect: NoExecute
    key: node.kubernetes.io/unreachable
    timeAdded: &quot;2020-04-02T21:21:48Z&quot;
status:
  addresses:
  - address: 10.10.76.188
    type: InternalIP
  - address: Taylors-MacBook-Pro.local
    type: Hostname
  allocatable:
    cpu: &quot;4&quot;
    ephemeral-storage: 61255492Ki
    hugepages-1Gi: &quot;0&quot;
    hugepages-2Mi: &quot;0&quot;
    memory: 4032800Ki
    pods: &quot;30&quot;
  capacity:
    cpu: &quot;4&quot;
    ephemeral-storage: 61255492Ki
    hugepages-1Gi: &quot;0&quot;
    hugepages-2Mi: &quot;0&quot;
    memory: 4032800Ki
    pods: &quot;30&quot;
  conditions:
  - lastHeartbeatTime: &quot;2020-04-02T18:13:32Z&quot;
    lastTransitionTime: &quot;2020-04-02T18:23:57Z&quot;
    message: Kubelet stopped posting node status.
    reason: NodeStatusUnknown
    status: Unknown
    type: Ready
  - lastHeartbeatTime: &quot;2020-04-02T18:13:32Z&quot;
    lastTransitionTime: &quot;2020-04-02T18:13:32Z&quot;
    message: kubelet has sufficient disk space available
    reason: KubeletHasSufficientDisk
    status: &quot;False&quot;
    type: OutOfDisk
  - lastHeartbeatTime: &quot;2020-04-02T18:13:32Z&quot;
    lastTransitionTime: &quot;2020-04-02T18:23:57Z&quot;
    message: Kubelet never posted node status.
    reason: NodeStatusNeverUpdated
    status: Unknown
    type: MemoryPressure
  - lastHeartbeatTime: &quot;2020-04-02T18:13:32Z&quot;
    lastTransitionTime: &quot;2020-04-02T18:23:57Z&quot;
    message: Kubelet never posted node status.
    reason: NodeStatusNeverUpdated
    status: Unknown
    type: DiskPressure
  - lastHeartbeatTime: &quot;2020-04-02T18:13:32Z&quot;
    lastTransitionTime: &quot;2020-04-02T18:23:57Z&quot;
    message: Kubelet never posted node status.
    reason: NodeStatusNeverUpdated
    status: Unknown
    type: PIDPressure
  daemonEndpoints:
    kubeletEndpoint:
      Port: 3001
  nodeInfo:
    architecture: wasm-wasi
    bootID: &quot;&quot;
    containerRuntimeVersion: mvp
    kernelVersion: &quot;&quot;
    kubeProxyVersion: v1.17.0
    kubeletVersion: v1.17.0
    machineID: &quot;&quot;
    operatingSystem: linux
    osImage: &quot;&quot;
    systemUUID: &quot;&quot;
</pre></div>



<a name="192839441"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Is%20nano%20process%20suitable%20for%20long-running%20pod%3F/near/192839441" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Thomas <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Is.20nano.20process.20suitable.20for.20long-running.20pod.3F.html#192839441">(Apr 03 2020 at 17:39)</a>:</h4>
<p>If you look at the address block, it has both the IP and the hostname setup</p>



<a name="192839503"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Is%20nano%20process%20suitable%20for%20long-running%20pod%3F/near/192839503" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Thomas <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Is.20nano.20process.20suitable.20for.20long-running.20pod.3F.html#192839503">(Apr 03 2020 at 17:39)</a>:</h4>
<p>Basically, I don't see anything with this being a krustlet problem and everything with how we get certs configured properly</p>



<a name="192839578"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Is%20nano%20process%20suitable%20for%20long-running%20pod%3F/near/192839578" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Thomas <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Is.20nano.20process.20suitable.20for.20long-running.20pod.3F.html#192839578">(Apr 03 2020 at 17:40)</a>:</h4>
<p>But I could totally be wrong</p>



<a name="192841553"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Is%20nano%20process%20suitable%20for%20long-running%20pod%3F/near/192841553" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Thomas <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Is.20nano.20process.20suitable.20for.20long-running.20pod.3F.html#192841553">(Apr 03 2020 at 17:55)</a>:</h4>
<p><span class="user-mention" data-user-id="273855">@Owen Ou</span> Is there someone you know who has lots of EKS knowledge? It may be useful to engage them to see if we are creating certs properly for EKS</p>



<a name="192880904"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Is%20nano%20process%20suitable%20for%20long-running%20pod%3F/near/192880904" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Owen Ou <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Is.20nano.20process.20suitable.20for.20long-running.20pod.3F.html#192880904">(Apr 04 2020 at 00:58)</a>:</h4>
<p><span class="user-mention" data-user-id="280224">@Taylor Thomas</span>  This is the node info (one EKS kubelet node and one krustlet node):</p>
<div class="codehilite"><pre><span></span>apiVersion: v1
items:
- apiVersion: v1
  kind: Node
  metadata:
    annotations:
      node.alpha.kubernetes.io/ttl: &quot;0&quot;
      volumes.kubernetes.io/controller-managed-attach-detach: &quot;true&quot;
    creationTimestamp: &quot;2020-04-02T04:30:13Z&quot;
    labels:
      alpha.eksctl.io/cluster-name: krustlet-o
      alpha.eksctl.io/instance-id: i-0f4560ac42f0488cb
      alpha.eksctl.io/nodegroup-name: ng-6acf5969
      beta.kubernetes.io/arch: amd64
      beta.kubernetes.io/instance-type: m5.large
      beta.kubernetes.io/os: linux
      failure-domain.beta.kubernetes.io/region: us-west-2
      failure-domain.beta.kubernetes.io/zone: us-west-2a
      kubernetes.io/arch: amd64
      kubernetes.io/hostname: ip-192-168-23-105.us-west-2.compute.internal
      kubernetes.io/os: linux
    name: ip-192-168-23-105.us-west-2.compute.internal
    resourceVersion: &quot;245495&quot;
    selfLink: /api/v1/nodes/ip-192-168-23-105.us-west-2.compute.internal
    uid: a5151dd5-749a-11ea-95cb-0a905beb9b08
  spec:
    providerID: aws:///us-west-2a/i-0f4560ac42f0488cb
  status:
    addresses:
    - address: 192.168.23.105
      type: InternalIP
    - address: 34.221.97.70
      type: ExternalIP
    - address: ip-192-168-23-105.us-west-2.compute.internal
      type: Hostname
    - address: ip-192-168-23-105.us-west-2.compute.internal
      type: InternalDNS
    - address: ec2-34-221-97-70.us-west-2.compute.amazonaws.com
      type: ExternalDNS
    allocatable:
      attachable-volumes-aws-ebs: &quot;25&quot;
      cpu: &quot;2&quot;
      ephemeral-storage: &quot;19316009748&quot;
      hugepages-1Gi: &quot;0&quot;
      hugepages-2Mi: &quot;0&quot;
      memory: 7762632Ki
      pods: &quot;29&quot;
    capacity:
      attachable-volumes-aws-ebs: &quot;25&quot;
      cpu: &quot;2&quot;
      ephemeral-storage: 20959212Ki
      hugepages-1Gi: &quot;0&quot;
      hugepages-2Mi: &quot;0&quot;
      memory: 7865032Ki
      pods: &quot;29&quot;
    conditions:
    - lastHeartbeatTime: &quot;2020-04-04T00:47:12Z&quot;
      lastTransitionTime: &quot;2020-04-02T04:30:13Z&quot;
      message: kubelet has sufficient memory available
      reason: KubeletHasSufficientMemory
      status: &quot;False&quot;
      type: MemoryPressure
    - lastHeartbeatTime: &quot;2020-04-04T00:47:12Z&quot;
      lastTransitionTime: &quot;2020-04-02T04:30:13Z&quot;
      message: kubelet has no disk pressure
      reason: KubeletHasNoDiskPressure
      status: &quot;False&quot;
      type: DiskPressure
    - lastHeartbeatTime: &quot;2020-04-04T00:47:12Z&quot;
      lastTransitionTime: &quot;2020-04-02T04:30:13Z&quot;
      message: kubelet has sufficient PID available
      reason: KubeletHasSufficientPID
      status: &quot;False&quot;
      type: PIDPressure
    - lastHeartbeatTime: &quot;2020-04-04T00:47:12Z&quot;
      lastTransitionTime: &quot;2020-04-02T04:30:33Z&quot;
      message: kubelet is posting ready status
      reason: KubeletReady
      status: &quot;True&quot;
      type: Ready
    daemonEndpoints:
      kubeletEndpoint:
        Port: 10250
    images:
    - names:
      - 602401143452.dkr.ecr.us-west-2.amazonaws.com/amazon-k8s-cni@sha256:a6d23b9fb3d4ba549321e32a28c42d8e79da203897072e93874472ab9e80b768
      - 602401143452.dkr.ecr.us-west-2.amazonaws.com/amazon-k8s-cni:v1.5.5
      sizeBytes: 263850871
    - names:
      - 602401143452.dkr.ecr.us-west-2.amazonaws.com/eks/kube-proxy@sha256:d3a6122f63202665aa50f3c08644ef504dbe56c76a1e0ab05f8e296328f3a6b4
      - 602401143452.dkr.ecr.us-west-2.amazonaws.com/eks/kube-proxy:v1.14.6
      sizeBytes: 82044796
    - names:
      - 602401143452.dkr.ecr.us-west-2.amazonaws.com/eks/coredns@sha256:ff6eadc11a45d8cbad5473b0950e01230c7f23bcb53392c80550feab69f905f1
      - 602401143452.dkr.ecr.us-west-2.amazonaws.com/eks/coredns:v1.6.6
      sizeBytes: 44336675
    - names:
      - 602401143452.dkr.ecr.us-west-2.amazonaws.com/eks/pause-amd64@sha256:bea77c323c47f7b573355516acf927691182d1333333d1f41b7544012fab7adf
      - 602401143452.dkr.ecr.us-west-2.amazonaws.com/eks/pause-amd64:3.1
      sizeBytes: 742472
    nodeInfo:
      architecture: amd64
      bootID: 058a481f-38c1-4368-8faf-1b67966bb06a
      containerRuntimeVersion: docker://18.9.9
      kernelVersion: 4.14.171-136.231.amzn2.x86_64
      kubeProxyVersion: v1.14.9-eks-1f0ca9
      kubeletVersion: v1.14.9-eks-1f0ca9
      machineID: ec2574a7ef250c7988b7b403a4de213e
      operatingSystem: linux
      osImage: Amazon Linux 2
      systemUUID: EC2574A7-EF25-0C79-88B7-B403A4DE213E
- apiVersion: v1
  kind: Node
  metadata:
    annotations:
      node.alpha.kubernetes.io/ttl: &quot;0&quot;
      volumes.kubernetes.io/controller-managed-attach-detach: &quot;true&quot;
    creationTimestamp: &quot;2020-04-02T23:01:03Z&quot;
    labels:
      beta.kubernetes.io/arch: wasm32-wasi
      beta.kubernetes.io/os: linux
      kubernetes.io/arch: wasm32-wasi
      kubernetes.io/hostname: ip-192-168-55-201.us-west-2.compute.internal
      kubernetes.io/os: linux
      kubernetes.io/role: agent
      type: krustlet
    name: ip-192-168-55-201.us-west-2.compute.internal
    resourceVersion: &quot;118145&quot;
    selfLink: /api/v1/nodes/ip-192-168-55-201.us-west-2.compute.internal
    uid: d3f725a8-7535-11ea-95cb-0a905beb9b08
  spec:
    podCIDR: 10.244.0.0/24
    taints:
    - effect: NoSchedule
      key: node.kubernetes.io/unreachable
      timeAdded: &quot;2020-04-03T01:25:45Z&quot;
    - effect: NoExecute
      key: node.kubernetes.io/unreachable
      timeAdded: &quot;2020-04-03T01:25:50Z&quot;
  status:
    addresses:
    - address: 192.168.55.201
      type: InternalIP
    - address: ip-192-168-55-201.us-west-2.compute.internal
      type: Hostname
    allocatable:
      cpu: &quot;4&quot;
      ephemeral-storage: 61255492Ki
      hugepages-1Gi: &quot;0&quot;
      hugepages-2Mi: &quot;0&quot;
      memory: 4032800Ki
      pods: &quot;30&quot;
    capacity:
      cpu: &quot;4&quot;
      ephemeral-storage: 61255492Ki
      hugepages-1Gi: &quot;0&quot;
      hugepages-2Mi: &quot;0&quot;
      memory: 4032800Ki
      pods: &quot;30&quot;
    conditions:
    - lastHeartbeatTime: &quot;2020-04-02T23:01:03Z&quot;
      lastTransitionTime: &quot;2020-04-03T01:25:45Z&quot;
      message: Kubelet stopped posting node status.
      reason: NodeStatusUnknown
      status: Unknown
      type: Ready
    - lastHeartbeatTime: &quot;2020-04-02T23:01:03Z&quot;
      lastTransitionTime: &quot;2020-04-02T23:01:03Z&quot;
      message: kubelet has sufficient disk space available
      reason: KubeletHasSufficientDisk
      status: &quot;False&quot;
      type: OutOfDisk
    - lastHeartbeatTime: &quot;2020-04-02T23:01:03Z&quot;
      lastTransitionTime: &quot;2020-04-03T01:25:45Z&quot;
      message: Kubelet never posted node status.
      reason: NodeStatusNeverUpdated
      status: Unknown
      type: MemoryPressure
    - lastHeartbeatTime: &quot;2020-04-02T23:01:03Z&quot;
      lastTransitionTime: &quot;2020-04-03T01:25:45Z&quot;
      message: Kubelet never posted node status.
      reason: NodeStatusNeverUpdated
      status: Unknown
      type: DiskPressure
    - lastHeartbeatTime: &quot;2020-04-02T23:01:03Z&quot;
      lastTransitionTime: &quot;2020-04-03T01:25:45Z&quot;
      message: Kubelet never posted node status.
      reason: NodeStatusNeverUpdated
      status: Unknown
      type: PIDPressure
    daemonEndpoints:
      kubeletEndpoint:
        Port: 3000
    nodeInfo:
      architecture: wasm-wasi
      bootID: &quot;&quot;
      containerRuntimeVersion: mvp
      kernelVersion: &quot;&quot;
      kubeProxyVersion: v1.17.0
      kubeletVersion: v1.17.0
      machineID: &quot;&quot;
      operatingSystem: linux
      osImage: &quot;&quot;
      systemUUID: &quot;&quot;
kind: List
metadata:
  resourceVersion: &quot;&quot;
  selfLink: &quot;&quot;
</pre></div>



<a name="192881052"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Is%20nano%20process%20suitable%20for%20long-running%20pod%3F/near/192881052" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Owen Ou <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Is.20nano.20process.20suitable.20for.20long-running.20pod.3F.html#192881052">(Apr 04 2020 at 01:00)</a>:</h4>
<p>How did you get the container log ULR for the normal pod (the <code>containerLogs</code> one)? I want to compare it to understand why IP (<a href="https://192.168.55.201:3000" title="https://192.168.55.201:3000">https://192.168.55.201:3000</a>) was preferred instead of the DNS name.</p>



<a name="192881190"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Is%20nano%20process%20suitable%20for%20long-running%20pod%3F/near/192881190" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Owen Ou <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Is.20nano.20process.20suitable.20for.20long-running.20pod.3F.html#192881190">(Apr 04 2020 at 01:03)</a>:</h4>
<p>(deleted)</p>



<a name="192908175"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Is%20nano%20process%20suitable%20for%20long-running%20pod%3F/near/192908175" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ralph <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Is.20nano.20process.20suitable.20for.20long-running.20pod.3F.html#192908175">(Apr 04 2020 at 13:42)</a>:</h4>
<p>Keep at it, <span class="user-mention" data-user-id="273855">@Owen Ou</span> .  When we figure out precisely what is going on with Krustlet and EKS that will help us document it and then work to get it working elsewhere, too. GKE, Alibaba, DO, and so on.....</p>



<a name="193063108"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Is%20nano%20process%20suitable%20for%20long-running%20pod%3F/near/193063108" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Thomas <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Is.20nano.20process.20suitable.20for.20long-running.20pod.3F.html#193063108">(Apr 06 2020 at 16:01)</a>:</h4>
<blockquote>
<p>How did you get the container log ULR for the normal pod (the containerLogs one)? I want to compare it to understand why IP (<a href="https://192.168.55.201:3000" title="https://192.168.55.201:3000">https://192.168.55.201:3000</a>) was preferred instead of the DNS name.</p>
</blockquote>
<p>Funny story, this is actually because my node was offline when I did <code>kubectl logs</code> so when the request timed out, it told me that what the URL it timed out trying to hit. I am guessing you might be able to find it with the right logging level in your apiserver logs</p>



<a name="193238145"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Is%20nano%20process%20suitable%20for%20long-running%20pod%3F/near/193238145" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Thomas <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Is.20nano.20process.20suitable.20for.20long-running.20pod.3F.html#193238145">(Apr 07 2020 at 19:45)</a>:</h4>
<p><span class="user-mention" data-user-id="273855">@Owen Ou</span> if you are still having problems, someone in the community created instructions for using Inlets to tunnel traffic to your krustlet node. Should work anywhere for any k8s cluster: <a href="https://gist.github.com/alexellis/d55d6d6a96ea9ae8d9d65b95297ec27e" title="https://gist.github.com/alexellis/d55d6d6a96ea9ae8d9d65b95297ec27e">https://gist.github.com/alexellis/d55d6d6a96ea9ae8d9d65b95297ec27e</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://gist.github.com/alexellis/d55d6d6a96ea9ae8d9d65b95297ec27e" style="background-image: url(https://github.githubassets.com/images/modules/gists/gist-og-image.png)"></a><div class="data-container"><div class="message_embed_title"><a href="https://gist.github.com/alexellis/d55d6d6a96ea9ae8d9d65b95297ec27e" title="krustlet-inlets">krustlet-inlets</a></div><div class="message_embed_description">krustlet-inlets. GitHub Gist: instantly share code, notes, and snippets.</div></div></div>



<a name="194626086"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Is%20nano%20process%20suitable%20for%20long-running%20pod%3F/near/194626086" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Owen Ou <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Is.20nano.20process.20suitable.20for.20long-running.20pod.3F.html#194626086">(Apr 20 2020 at 01:08)</a>:</h4>
<p>Trying to help automate more of the EKS setup: <a href="https://github.com/deislabs/krustlet/pull/197" title="https://github.com/deislabs/krustlet/pull/197">https://github.com/deislabs/krustlet/pull/197</a> cc: <span class="user-mention" data-user-id="253989">@Peter Huene</span> <span class="user-mention" data-user-id="280224">@Taylor Thomas</span> <span class="user-mention" data-user-id="280225">@Matt Fisher</span></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/deislabs/krustlet/pull/197" style="background-image: url(https://avatars1.githubusercontent.com/u/44041561?s=400&amp;v=4)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/deislabs/krustlet/pull/197" title="Allow specifying labels by jingweno · Pull Request #197 · deislabs/krustlet">Allow specifying labels by jingweno · Pull Request #197 · deislabs/krustlet</a></div><div class="message_embed_description">Add --node-labels to the command line option which appends extra
labels when registering a Krustlet node.
Disclaimer: My Rust skill is rusty and my code may not be idiomatic Rust code :-).
This fix...</div></div></div>



<a name="194700224"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Is%20nano%20process%20suitable%20for%20long-running%20pod%3F/near/194700224" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Thomas <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Is.20nano.20process.20suitable.20for.20long-running.20pod.3F.html#194700224">(Apr 20 2020 at 16:29)</a>:</h4>
<p><span class="user-mention" data-user-id="273855">@Owen Ou</span> Can you take a look at <a href="https://github.com/deislabs/krustlet/pull/199" title="https://github.com/deislabs/krustlet/pull/199">https://github.com/deislabs/krustlet/pull/199</a>? We had the author of that PR join us in our weekly call today. He said he took the work you did and then modified it to parse everything according to the rule specified in the kubelet help text</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/deislabs/krustlet/pull/199" style="background-image: url(https://avatars1.githubusercontent.com/u/44041561?s=400&amp;v=4)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/deislabs/krustlet/pull/199" title="node labels being applied with business rules from help page enforced by DerekStrickland · Pull Request #199 · deislabs/krustlet">node labels being applied with business rules from help page enforced by DerekStrickland · Pull Request #199 · deislabs/krustlet</a></div><div class="message_embed_description">I&#39;m new to Rust and krustlet, so forgive me if it&#39;s not spot on. Happy to take feedback and incorporate.  I think this effectively enforces the rules specified by the man page, and also han...</div></div></div>



<a name="194739531"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Is%20nano%20process%20suitable%20for%20long-running%20pod%3F/near/194739531" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Owen Ou <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Is.20nano.20process.20suitable.20for.20long-running.20pod.3F.html#194739531">(Apr 20 2020 at 22:06)</a>:</h4>
<p><span class="user-mention" data-user-id="280224">@Taylor Thomas</span>  I see. I only quickly added support for labels to avoid manually labeling nodes (<a href="https://github.com/deislabs/krustlet/pull/197" title="https://github.com/deislabs/krustlet/pull/197">https://github.com/deislabs/krustlet/pull/197</a>) but it doesn't validate according to the spec. It's a nice thing to have</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/deislabs/krustlet/pull/197" style="background-image: url(https://avatars1.githubusercontent.com/u/44041561?s=400&amp;v=4)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/deislabs/krustlet/pull/197" title="Allow specifying labels by jingweno · Pull Request #197 · deislabs/krustlet">Allow specifying labels by jingweno · Pull Request #197 · deislabs/krustlet</a></div><div class="message_embed_description">Add --node-labels to the command line option which appends extra
labels when registering a Krustlet node.
Disclaimer: My Rust skill is rusty and my code may not be idiomatic Rust code :-).
This fix...</div></div></div>



<a name="194739568"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Is%20nano%20process%20suitable%20for%20long-running%20pod%3F/near/194739568" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Owen Ou <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Is.20nano.20process.20suitable.20for.20long-running.20pod.3F.html#194739568">(Apr 20 2020 at 22:06)</a>:</h4>
<p>Is there anything I could help with <a href="https://github.com/deislabs/krustlet/issues/187" title="https://github.com/deislabs/krustlet/issues/187">https://github.com/deislabs/krustlet/issues/187</a>? It's a blocker to get a full experience on EKS</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/deislabs/krustlet/issues/187" style="background-image: url(https://avatars1.githubusercontent.com/u/44041561?s=400&amp;v=4)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/deislabs/krustlet/issues/187" title="Panic on EKS while watching nodes (401 unauthorized) · Issue #187 · deislabs/krustlet">Panic on EKS while watching nodes (401 unauthorized) · Issue #187 · deislabs/krustlet</a></div><div class="message_embed_description">I don&#39;t have repro steps other than standing up an EKS cluster and waiting for the node to show up as NotReady. Prior to the panic, the node was Ready and was successfully running WebAssembly a...</div></div></div>



<a name="194739685"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Is%20nano%20process%20suitable%20for%20long-running%20pod%3F/near/194739685" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Owen Ou <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Is.20nano.20process.20suitable.20for.20long-running.20pod.3F.html#194739685">(Apr 20 2020 at 22:08)</a>:</h4>
<p>Also, I didn't know you guys have a community weekly call. Is it open to everybody? Thinking that I may join and ask questions when we collaborate more closely in the future.</p>



<a name="194740986"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Is%20nano%20process%20suitable%20for%20long-running%20pod%3F/near/194740986" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Thomas <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Is.20nano.20process.20suitable.20for.20long-running.20pod.3F.html#194740986">(Apr 20 2020 at 22:24)</a>:</h4>
<p>Yep, we have an open call every monday</p>



<a name="194741021"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Is%20nano%20process%20suitable%20for%20long-running%20pod%3F/near/194741021" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Thomas <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Is.20nano.20process.20suitable.20for.20long-running.20pod.3F.html#194741021">(Apr 20 2020 at 22:24)</a>:</h4>
<p>And feel free to take on 187. Ryan suggested something we could do there</p>



<a name="195090166"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Is%20nano%20process%20suitable%20for%20long-running%20pod%3F/near/195090166" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Thomas <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Is.20nano.20process.20suitable.20for.20long-running.20pod.3F.html#195090166">(Apr 23 2020 at 16:57)</a>:</h4>
<p><span class="user-mention" data-user-id="253989">@Peter Huene</span> <span class="user-mention" data-user-id="273855">@Owen Ou</span> <a href="https://github.com/deislabs/krustlet/issues/187#issuecomment-618516479" title="https://github.com/deislabs/krustlet/issues/187#issuecomment-618516479">https://github.com/deislabs/krustlet/issues/187#issuecomment-618516479</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/deislabs/krustlet/issues/187#issuecomment-618516479" style="background-image: url(https://avatars1.githubusercontent.com/u/44041561?s=400&amp;v=4)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/deislabs/krustlet/issues/187#issuecomment-618516479" title="Panic on EKS while watching nodes (401 unauthorized) · Issue #187 · deislabs/krustlet">Panic on EKS while watching nodes (401 unauthorized) · Issue #187 · deislabs/krustlet</a></div><div class="message_embed_description">I don&#39;t have repro steps other than standing up an EKS cluster and waiting for the node to show up as NotReady. Prior to the panic, the node was Ready and was successfully running WebAssembly a...</div></div></div>



<a name="195096505"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Is%20nano%20process%20suitable%20for%20long-running%20pod%3F/near/195096505" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Huene <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Is.20nano.20process.20suitable.20for.20long-running.20pod.3F.html#195096505">(Apr 23 2020 at 17:49)</a>:</h4>
<p>I'll check today to see how the fix goes.</p>



<a name="195142836"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Is%20nano%20process%20suitable%20for%20long-running%20pod%3F/near/195142836" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Huene <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Is.20nano.20process.20suitable.20for.20long-running.20pod.3F.html#195142836">(Apr 24 2020 at 03:14)</a>:</h4>
<p>Fix is looking good so far.  I'm going to leave the nodes running for a little while and monitor the service log.</p>



<a name="195297580"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Is%20nano%20process%20suitable%20for%20long-running%20pod%3F/near/195297580" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Owen Ou <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Is.20nano.20process.20suitable.20for.20long-running.20pod.3F.html#195297580">(Apr 25 2020 at 18:50)</a>:</h4>
<p>Trying to help validate this too: <a href="https://github.com/deislabs/krustlet/issues/187#issuecomment-619424431" title="https://github.com/deislabs/krustlet/issues/187#issuecomment-619424431">https://github.com/deislabs/krustlet/issues/187#issuecomment-619424431</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/deislabs/krustlet/issues/187#issuecomment-619424431" style="background-image: url(https://avatars1.githubusercontent.com/u/44041561?s=400&amp;v=4)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/deislabs/krustlet/issues/187#issuecomment-619424431" title="Panic on EKS while watching nodes (401 unauthorized) · Issue #187 · deislabs/krustlet">Panic on EKS while watching nodes (401 unauthorized) · Issue #187 · deislabs/krustlet</a></div><div class="message_embed_description">I don&#39;t have repro steps other than standing up an EKS cluster and waiting for the node to show up as NotReady. Prior to the panic, the node was Ready and was successfully running WebAssembly a...</div></div></div>



<a name="195297745"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Is%20nano%20process%20suitable%20for%20long-running%20pod%3F/near/195297745" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Owen Ou <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Is.20nano.20process.20suitable.20for.20long-running.20pod.3F.html#195297745">(Apr 25 2020 at 18:54)</a>:</h4>
<p>For <code>wasm-to-oci</code>, is it expected that pushing to docker hub fails? <a href="https://github.com/engineerd/wasm-to-oci/issues/7" title="https://github.com/engineerd/wasm-to-oci/issues/7">https://github.com/engineerd/wasm-to-oci/issues/7</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/engineerd/wasm-to-oci/issues/7" style="background-image: url(https://avatars1.githubusercontent.com/u/47736799?s=400&amp;v=4)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/engineerd/wasm-to-oci/issues/7" title="Try pushing to docker hub and fail · Issue #7 · engineerd/wasm-to-oci">Try pushing to docker hub and fail · Issue #7 · engineerd/wasm-to-oci</a></div><div class="message_embed_description">Is pushing to docker hub supported? wasm-to-oci --log debug push target/wasm32-wasi/debug/hello-world-rust.wasm docker.io/jingweno/wasm:1234 Error: failed commit on ref &quot;manifest-sha256:beb9a5...</div></div></div>



<a name="195300206"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Is%20nano%20process%20suitable%20for%20long-running%20pod%3F/near/195300206" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Radu Matei <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Is.20nano.20process.20suitable.20for.20long-running.20pod.3F.html#195300206">(Apr 25 2020 at 19:57)</a>:</h4>
<p>(<a href="https://github.com/engineerd/wasm-to-oci/issues/7#issuecomment-619432537" title="https://github.com/engineerd/wasm-to-oci/issues/7#issuecomment-619432537">https://github.com/engineerd/wasm-to-oci/issues/7#issuecomment-619432537</a>)<br>
TL; DR - the proposal used by wasm-to-oci, while an official proposal, is not yet implemented in most container registries - which actively reject unknown media types.</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/engineerd/wasm-to-oci/issues/7#issuecomment-619432537" style="background-image: url(https://avatars1.githubusercontent.com/u/47736799?s=400&amp;v=4)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/engineerd/wasm-to-oci/issues/7#issuecomment-619432537" title="Try pushing to docker hub and fail · Issue #7 · engineerd/wasm-to-oci">Try pushing to docker hub and fail · Issue #7 · engineerd/wasm-to-oci</a></div><div class="message_embed_description">Is pushing to docker hub supported? wasm-to-oci --log debug push target/wasm32-wasi/debug/hello-world-rust.wasm docker.io/jingweno/wasm:1234 Error: failed commit on ref &quot;manifest-sha256:beb9a5...</div></div></div>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>