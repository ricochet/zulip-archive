<html>
<head><meta charset="utf-8"><title>Krustlet · wasmtime on k8s · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/index.html">wasmtime on k8s</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Krustlet.html">Krustlet</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="192592107"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Krustlet/near/192592107" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Owen Ou <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Krustlet.html#192592107">(Apr 01 2020 at 20:58)</a>:</h4>
<p><span class="user-mention" data-user-id="280224">@Taylor Thomas</span> <span class="user-mention" data-user-id="280225">@Matt Fisher</span> I'm playing with Krustlet in Kind by following <a href="https://github.com/deislabs/krustlet/blob/master/docs/howto/krustlet-on-kind.md" title="https://github.com/deislabs/krustlet/blob/master/docs/howto/krustlet-on-kind.md">https://github.com/deislabs/krustlet/blob/master/docs/howto/krustlet-on-kind.md</a>. I can see the krustlet node with <code>kubectl get node</code>. I apply this manifest <a href="https://github.com/deislabs/krustlet/blob/master/demos/wasi/hello-world-rust/k8s.yaml" title="https://github.com/deislabs/krustlet/blob/master/demos/wasi/hello-world-rust/k8s.yaml">https://github.com/deislabs/krustlet/blob/master/demos/wasi/hello-world-rust/k8s.yaml</a> but i couldn't see the log: </p>
<div class="codehilite"><pre><span></span>k logs hello-world-wasi-rust
Error from server: Get https://172.17.0.1:3000/containerLogs/default/hello-world-wasi-rust/hello-world-wasi-rust: dial tcp 172.17.0.1:3000: connect: connection refused
</pre></div>


<p>Do you happen to know what went wrong? I'm on Mac.</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/deislabs/krustlet/blob/master/docs/howto/krustlet-on-kind.md" style="background-image: url(https://avatars1.githubusercontent.com/u/44041561?s=400&amp;v=4)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/deislabs/krustlet/blob/master/docs/howto/krustlet-on-kind.md" title="deislabs/krustlet">deislabs/krustlet</a></div><div class="message_embed_description">Kubernetes Rust Kubelet. Contribute to deislabs/krustlet development by creating an account on GitHub.</div></div></div><div class="message_embed"><a class="message_embed_image" href="https://github.com/deislabs/krustlet/blob/master/demos/wasi/hello-world-rust/k8s.yaml" style="background-image: url(https://avatars1.githubusercontent.com/u/44041561?s=400&amp;v=4)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/deislabs/krustlet/blob/master/demos/wasi/hello-world-rust/k8s.yaml" title="deislabs/krustlet">deislabs/krustlet</a></div><div class="message_embed_description">Kubernetes Rust Kubelet. Contribute to deislabs/krustlet development by creating an account on GitHub.</div></div></div>



<a name="192592343"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Krustlet/near/192592343" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Thomas <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Krustlet.html#192592343">(Apr 01 2020 at 21:00)</a>:</h4>
<p>That is looking like you may be listening on the wrong IP address. Did you double check that is the bridge address? <span class="user-mention" data-user-id="280225">@Matt Fisher</span> just finished those today, so he probably has more tips</p>



<a name="192592770"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Krustlet/near/192592770" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Owen Ou <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Krustlet.html#192592770">(Apr 01 2020 at 21:04)</a>:</h4>
<p>I ran <code>krustlet-wasi --node-ip 172.17.0.1 --pfx-password password</code>.  And I verified the default gateway in the hypervisor is 172.17.0.1:</p>
<div class="codehilite"><pre><span></span>$ docker run --rm -it --privileged --pid=host walkerlee/nsenter -t 1 -m -u -i -n sh
/ # ip addr show docker0
5: docker0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default
    link/ether 02:42:20:cf:45:96 brd ff:ff:ff:ff:ff:ff
    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0
       valid_lft forever preferred_lft forever
    inet6 fe80::42:20ff:fecf:4596/64 scope link
       valid_lft forever preferred_lft forever
</pre></div>


<p>Perhaps I should use a different node-ip because of Docker for Mac</p>



<a name="192593255"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Krustlet/near/192593255" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Owen Ou <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Krustlet.html#192593255">(Apr 01 2020 at 21:09)</a>:</h4>
<p>The error from the <code>krustlet-wasi </code> process</p>
<div class="codehilite"><pre><span></span>./krustlet-wasi --pfx-password password --node-ip 172.17.0.1
[2020-04-01T21:06:13Z ERROR kubelet::kubelet] Error handling event: OCI API error: manifest unknown on https://webassembly.azurecr.io/v2/hello-world-wasi-rust/manifests/v1.1.0
</pre></div>



<a name="192594259"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Krustlet/near/192594259" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Thomas <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Krustlet.html#192594259">(Apr 01 2020 at 21:18)</a>:</h4>
<p>Oh so there is another error there too. Did you modify the k8s.yaml to have a different version tag? v1.1.0 doesn't exist</p>



<a name="192594301"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Krustlet/near/192594301" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Thomas <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Krustlet.html#192594301">(Apr 01 2020 at 21:19)</a>:</h4>
<p>As for the other error, it may be because of docker for mac. <span class="user-mention" data-user-id="280225">@Matt Fisher</span> did you do it on docker for mac?</p>



<a name="192594818"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Krustlet/near/192594818" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Owen Ou <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Krustlet.html#192594818">(Apr 01 2020 at 21:24)</a>:</h4>
<p><span class="user-mention" data-user-id="280224">@Taylor Thomas</span> I got it to work! Thanks for the hints! Two (stupid) mistakes I made: 1) somehow the version tag was changed to v1.1.0, I reverted it back to v0.1.0 2) I don't provide the node-ip and let <code>krustlet-wasi</code> to figure it out itself: <code>./krustlet-wasi --pfx-password password</code></p>



<a name="192594929"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Krustlet/near/192594929" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Owen Ou <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Krustlet.html#192594929">(Apr 01 2020 at 21:25)</a>:</h4>
<p>I'm creating a PR to add the notes for Docker for Mac bit for <code>node-ip</code></p>



<a name="192594993"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Krustlet/near/192594993" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Thomas <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Krustlet.html#192594993">(Apr 01 2020 at 21:26)</a>:</h4>
<p>Oh so it ended up figuring it out on its own?</p>



<a name="192595030"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Krustlet/near/192595030" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Thomas <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Krustlet.html#192595030">(Apr 01 2020 at 21:26)</a>:</h4>
<p>Out of curiosity, what IP address did it end up using?</p>



<a name="192595188"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Krustlet/near/192595188" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Owen Ou <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Krustlet.html#192595188">(Apr 01 2020 at 21:28)</a>:</h4>
<p>It's the host ip, from <code>krustlet-wasi</code>'s help page:</p>
<div class="codehilite"><pre><span></span>--hostname &lt;hostname&gt;            The hostname for this node, defaults to the hostname of this machine [env: KRUSTLET_HOSTNAME=]
</pre></div>


<div class="codehilite"><pre><span></span>kubectl get nodes -o wide
NAME                              STATUS   ROLES    AGE     VERSION   INTERNAL-IP   EXTERNAL-IP   OS-IMAGE       KERNEL-VERSION     CONTAINER-RUNTIME
kind-control-plane                Ready    master   3h34m   v1.17.0   172.17.0.2    &lt;none&gt;        Ubuntu 19.10   4.19.76-linuxkit   containerd://1.3.2
oou-ltm.internal.salesforce.com   Ready    agent    4m47s   v1.17.0   10.3.52.6     &lt;none&gt;        &lt;unknown&gt;      &lt;unknown&gt;          mvp
</pre></div>



<a name="192595248"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Krustlet/near/192595248" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Thomas <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Krustlet.html#192595248">(Apr 01 2020 at 21:28)</a>:</h4>
<p>Yeah, I know it will select one of the available interfaces, but I haven't had that work on the Mac very well. Glad it actually worked though</p>



<a name="192595749"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Krustlet/near/192595749" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Owen Ou <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Krustlet.html#192595749">(Apr 01 2020 at 21:33)</a>:</h4>
<p>Out of curiosity, why is specifying <code>172.17.0.1</code> needed if krustlet can use the hostname of the machine? I guess it's a linux thing?</p>



<a name="192595858"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Krustlet/near/192595858" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Thomas <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Krustlet.html#192595858">(Apr 01 2020 at 21:34)</a>:</h4>
<p>Because sometimes it can select the wrong interface, especially for minikube (which does use a bridge)</p>



<a name="192595865"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Krustlet/near/192595865" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Thomas <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Krustlet.html#192595865">(Apr 01 2020 at 21:34)</a>:</h4>
<p>I have found that it works fine on VMs in the cloud</p>



<a name="192597147"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Krustlet/near/192597147" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matt Fisher <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Krustlet.html#192597147">(Apr 01 2020 at 21:47)</a>:</h4>
<p>It's also because you have Krustlet running on your host OS (macOS) and Kubernetes running in a Docker container. In order for the kubernetes API to make successful calls for <code>kubectl logs</code>, it needs to reach Krustlet. A Docker container cannot resolve the host IP address. 172.17.0.1 is the bridge IP where a container can talk to the host</p>



<a name="192597234"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Krustlet/near/192597234" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matt Fisher <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Krustlet.html#192597234">(Apr 01 2020 at 21:48)</a>:</h4>
<p>Same thing applies for the minikube guide: you need to use the bridge IP if you want applications in your VirtualBox VM to communicate with applications running on the host OS</p>



<a name="192597300"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Krustlet/near/192597300" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matt Fisher <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Krustlet.html#192597300">(Apr 01 2020 at 21:49)</a>:</h4>
<p>In most cases, Krustlet grabs the right IP address (the IP associated with the hostname), but with bridge IPs it's a little different</p>



<a name="192597331"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Krustlet/near/192597331" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matt Fisher <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Krustlet.html#192597331">(Apr 01 2020 at 21:49)</a>:</h4>
<p>If you ran Krustlet in the minikube VM or inside the KinD container, this setup wouldn't be necessary</p>



<a name="192597354"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Krustlet/near/192597354" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matt Fisher <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Krustlet.html#192597354">(Apr 01 2020 at 21:49)</a>:</h4>
<p>but that's a lot harder to setup for new users</p>



<a name="192597480"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Krustlet/near/192597480" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Owen Ou <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Krustlet.html#192597480">(Apr 01 2020 at 21:50)</a>:</h4>
<p>Yeah, you're right. It doesn't seem <code>krustlet</code> can always find the right hostname. I turned off vpn and it errored out (unsure why krustlet can figure out the hostname on VPN but not outside of VPN):</p>
<div class="codehilite"><pre><span></span>./krustlet-wasi --pfx-password password
thread &#39;main&#39; panicked at &#39;unable to get default node IP address: failed to lookup address information: nodename nor servname provided, or not known&#39;, crates/kubelet/src/config.rs:92:13
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
</pre></div>



<a name="192597519"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Krustlet/near/192597519" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Owen Ou <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Krustlet.html#192597519">(Apr 01 2020 at 21:51)</a>:</h4>
<p>I have to <code>./krustlet-wasi --pfx-password password --node-ip 192.168.1.64</code>. <code>192.168.1.64</code> is my en0 ip</p>



<a name="192597536"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Krustlet/near/192597536" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Owen Ou <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Krustlet.html#192597536">(Apr 01 2020 at 21:51)</a>:</h4>
<p>I'm not familiar with bridge IP in Docker for Mac. Is the env0 ip the bridge IP?</p>



<a name="192597630"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Krustlet/near/192597630" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Radu Matei <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Krustlet.html#192597630">(Apr 01 2020 at 21:53)</a>:</h4>
<p>Is there any scenario where you wouldn't be interested in getting the logs with <code>kubectl</code> though?<br>
As this is the main reason for starting the web server, and so it introduces the networking requirement of the control plane accessing the Krustlet node IP..</p>



<a name="192597797"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Krustlet/near/192597797" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matt Fisher <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Krustlet.html#192597797">(Apr 01 2020 at 21:55)</a>:</h4>
<blockquote>
<p>I'm not familiar with bridge IP in Docker for Mac. Is the env0 ip the bridge IP?</p>
</blockquote>
<p>You know, I haven't tested with Docker for Mac. This was on Ubuntu, where Docker creates a <code>docker0</code> network bridge. Try <code>docker network list</code> and see if anything comes up</p>



<a name="192597919"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Krustlet/near/192597919" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matt Fisher <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Krustlet.html#192597919">(Apr 01 2020 at 21:56)</a>:</h4>
<p>It might be different as Docker for Mac uses xhyve.</p>



<a name="192597996"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Krustlet/near/192597996" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Owen Ou <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Krustlet.html#192597996">(Apr 01 2020 at 21:57)</a>:</h4>
<div class="codehilite"><pre><span></span>docker network list
NETWORK ID          NAME                DRIVER              SCOPE
c7c426831aa0        bridge              bridge              local
9eacdd7d7b52        host                host                local
aca588e59558        none                null                local
</pre></div>


<p>bridge:</p>
<div class="codehilite"><pre><span></span>docker network inspect c7c426831aa0
[
    {
        &quot;Name&quot;: &quot;bridge&quot;,
        &quot;Id&quot;: &quot;c7c426831aa0646abf9f35f96f35cacca545319ca21d9b223c923383e2b521ab&quot;,
        &quot;Created&quot;: &quot;2020-04-01T21:39:08.475587129Z&quot;,
        &quot;Scope&quot;: &quot;local&quot;,
        &quot;Driver&quot;: &quot;bridge&quot;,
        &quot;EnableIPv6&quot;: false,
        &quot;IPAM&quot;: {
            &quot;Driver&quot;: &quot;default&quot;,
            &quot;Options&quot;: null,
            &quot;Config&quot;: [
                {
                    &quot;Subnet&quot;: &quot;172.17.0.0/16&quot;,
                    &quot;Gateway&quot;: &quot;172.17.0.1&quot;
                }
            ]
        },
        &quot;Internal&quot;: false,
        &quot;Attachable&quot;: false,
        &quot;Ingress&quot;: false,
        &quot;ConfigFrom&quot;: {
            &quot;Network&quot;: &quot;&quot;
        },
        &quot;ConfigOnly&quot;: false,
        &quot;Containers&quot;: {
            &quot;171beb96c33077025226a63765f1e8ed2024440760922c8b606b47fa66028f0b&quot;: {
                &quot;Name&quot;: &quot;kind-control-plane&quot;,
                &quot;EndpointID&quot;: &quot;88c20ca55f3c76b53ec3fec4b49bd26304139ade265e26ad57c43d9286d059ce&quot;,
                &quot;MacAddress&quot;: &quot;02:42:ac:11:00:02&quot;,
                &quot;IPv4Address&quot;: &quot;172.17.0.2/16&quot;,
                &quot;IPv6Address&quot;: &quot;&quot;
            }
        },
        &quot;Options&quot;: {
            &quot;com.docker.network.bridge.default_bridge&quot;: &quot;true&quot;,
            &quot;com.docker.network.bridge.enable_icc&quot;: &quot;true&quot;,
            &quot;com.docker.network.bridge.enable_ip_masquerade&quot;: &quot;true&quot;,
            &quot;com.docker.network.bridge.host_binding_ipv4&quot;: &quot;0.0.0.0&quot;,
            &quot;com.docker.network.bridge.name&quot;: &quot;docker0&quot;,
            &quot;com.docker.network.driver.mtu&quot;: &quot;1500&quot;
        },
        &quot;Labels&quot;: {}
    }
]
</pre></div>


<p>host</p>
<div class="codehilite"><pre><span></span>docker network inspect 9eacdd7d7b52
[
    {
        &quot;Name&quot;: &quot;host&quot;,
        &quot;Id&quot;: &quot;9eacdd7d7b52e9585b9f6a124841cb66c754cd619839e5638df3ba4991490d97&quot;,
        &quot;Created&quot;: &quot;2019-12-15T02:32:30.276617216Z&quot;,
        &quot;Scope&quot;: &quot;local&quot;,
        &quot;Driver&quot;: &quot;host&quot;,
        &quot;EnableIPv6&quot;: false,
        &quot;IPAM&quot;: {
            &quot;Driver&quot;: &quot;default&quot;,
            &quot;Options&quot;: null,
            &quot;Config&quot;: []
        },
        &quot;Internal&quot;: false,
        &quot;Attachable&quot;: false,
        &quot;Ingress&quot;: false,
        &quot;ConfigFrom&quot;: {
            &quot;Network&quot;: &quot;&quot;
        },
        &quot;ConfigOnly&quot;: false,
        &quot;Containers&quot;: {},
        &quot;Options&quot;: {},
        &quot;Labels&quot;: {}
    }
]
</pre></div>



<a name="192598078"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Krustlet/near/192598078" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matt Fisher <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Krustlet.html#192598078">(Apr 01 2020 at 21:58)</a>:</h4>
<p>ah yeah, looks like your default gateway is 172.17.0.1 based on that output, so that should be your --node-ip</p>



<a name="192598152"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Krustlet/near/192598152" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Owen Ou <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Krustlet.html#192598152">(Apr 01 2020 at 21:59)</a>:</h4>
<p>I did try 172.17.0.1. I got <a href="#narrow/stream/227959-wasmtime-on.20k8s/topic/Krustlet/near/192593255" title="#narrow/stream/227959-wasmtime-on.20k8s/topic/Krustlet/near/192593255">https://bytecodealliance.zulipchat.com/#narrow/stream/227959-wasmtime-on.20k8s/topic/Krustlet/near/192593255</a>. If I use 192.168.1.64 (en0), things work <span aria-label="shrug" class="emoji emoji-1f937" role="img" title="shrug">:shrug:</span></p>



<a name="192598270"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Krustlet/near/192598270" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matt Fisher <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Krustlet.html#192598270">(Apr 01 2020 at 22:00)</a>:</h4>
<p>weird. That error message looks totally unrelated... That looks like the v0.1.0 vs v1.1.0 issue earlier</p>



<a name="192598327"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Krustlet/near/192598327" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matt Fisher <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Krustlet.html#192598327">(Apr 01 2020 at 22:01)</a>:</h4>
<p>it's also possible that xhyve understands the host network, in which case it should be able to address anything in the 192.168.0.0/16 namespace</p>



<a name="192598341"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Krustlet/near/192598341" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matt Fisher <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Krustlet.html#192598341">(Apr 01 2020 at 22:01)</a>:</h4>
<p>/shrug</p>



<a name="192598405"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Krustlet/near/192598405" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matt Fisher <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Krustlet.html#192598405">(Apr 01 2020 at 22:02)</a>:</h4>
<p>if it works, it works!</p>



<a name="192598465"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Krustlet/near/192598465" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matt Fisher <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Krustlet.html#192598465">(Apr 01 2020 at 22:03)</a>:</h4>
<p>You should try a <code>kubectl logs</code> once you have a WebAssembly module running. I find that you don't know if it'll actually work until you make a call to <code>kubectl logs</code>.</p>



<a name="192598511"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Krustlet/near/192598511" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Owen Ou <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Krustlet.html#192598511">(Apr 01 2020 at 22:03)</a>:</h4>
<p>I just retest 172.17.0.1 with the right v0.1.0. Same error:</p>
<div class="codehilite"><pre><span></span>k logs hello-world-wasi-rust
Error from server: Get https://172.17.0.1:3000/containerLogs/default/hello-world-wasi-rust/hello-world-wasi-rust: dial tcp 172.17.0.1:3000: connect: connection refused
</pre></div>


<p>Does <code>kubectl log</code> talk to the http server on <code>krustlet-wasi</code> on the host? If it does, en0 makes sense, instead of 172.17.0.1 which is docerk0 in the hypervisor (the VM).</p>



<a name="192598675"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Krustlet/near/192598675" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matt Fisher <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Krustlet.html#192598675">(Apr 01 2020 at 22:05)</a>:</h4>
<p>yes</p>



<a name="192598813"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Krustlet/near/192598813" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Owen Ou <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Krustlet.html#192598813">(Apr 01 2020 at 22:07)</a>:</h4>
<p>I also tested 0.0.0.0:</p>
<div class="codehilite"><pre><span></span>k logs hello-world-wasi-rust
Error from server: Get https://0.0.0.0:3000/containerLogs/default/hello-world-wasi-rust/hello-world-wasi-rust: dial tcp 0.0.0.0:3000: connect: connection refused
</pre></div>


<p>Looks like something special for en0 with Docker for Mac.</p>



<a name="192599497"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Krustlet/near/192599497" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Thomas <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Krustlet.html#192599497">(Apr 01 2020 at 22:15)</a>:</h4>
<p>Docs for Docker for Mac say the docker0 interface is internal to the VM only</p>



<a name="192599630"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Krustlet/near/192599630" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Owen Ou <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Krustlet.html#192599630">(Apr 01 2020 at 22:16)</a>:</h4>
<p>This may be related: <a href="https://github.com/moby/moby/issues/22753#issuecomment-234078631" title="https://github.com/moby/moby/issues/22753#issuecomment-234078631">https://github.com/moby/moby/issues/22753#issuecomment-234078631</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/moby/moby/issues/22753#issuecomment-234078631" style="background-image: url(https://avatars1.githubusercontent.com/u/27259197?s=400&amp;v=4)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/moby/moby/issues/22753#issuecomment-234078631" title="No docker0 on docker for mac? · Issue #22753 · moby/moby">No docker0 on docker for mac? · Issue #22753 · moby/moby</a></div><div class="message_embed_description">Output of docker version: Client: Version: 1.11.1 API version: 1.23 Go version: go1.5.4 Git commit: 5604cbe Built: Wed Apr 27 00:34:20 2016 OS/Arch: darwin/amd64 Server: Version: 1.11.1 API version...</div></div></div>



<a name="192599757"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Krustlet/near/192599757" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matt Fisher <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Krustlet.html#192599757">(Apr 01 2020 at 22:18)</a>:</h4>
<p>nice! If you want to make an amendment to the document under "step 2: determine your default gateway", that would be much appreciated</p>



<a name="192599902"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Krustlet/near/192599902" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matt Fisher <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Krustlet.html#192599902">(Apr 01 2020 at 22:20)</a>:</h4>
<p>I also found this: <a href="https://docs.docker.com/docker-for-mac/networking/#use-cases-and-workarounds" title="https://docs.docker.com/docker-for-mac/networking/#use-cases-and-workarounds">https://docs.docker.com/docker-for-mac/networking/#use-cases-and-workarounds</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://docs.docker.com/docker-for-mac/networking/#use-cases-and-workarounds" style="background-image: url(https://docs.docker.com/images/docs@2x.png)"></a><div class="data-container"><div class="message_embed_title"><a href="https://docs.docker.com/docker-for-mac/networking/#use-cases-and-workarounds" title="Networking features in Docker Desktop for Mac">Networking features in Docker Desktop for Mac</a></div><div class="message_embed_description">Networking</div></div></div>



<a name="192601898"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Krustlet/near/192601898" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Owen Ou <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Krustlet.html#192601898">(Apr 01 2020 at 22:47)</a>:</h4>
<p>PTAL: <a href="https://github.com/deislabs/krustlet/pull/148" title="https://github.com/deislabs/krustlet/pull/148">https://github.com/deislabs/krustlet/pull/148</a>.</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/deislabs/krustlet/pull/148" style="background-image: url(https://avatars1.githubusercontent.com/u/44041561?s=400&amp;v=4)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/deislabs/krustlet/pull/148" title="Update kind instruction for Mac by jingweno · Pull Request #148 · deislabs/krustlet">Update kind instruction for Mac by jingweno · Pull Request #148 · deislabs/krustlet</a></div><div class="message_embed_description">For Mac, kubectl logs accesses the Krustlet process running on the host.
The default gateway is the en0 interface IP on the host.
Discussion: https://bytecodealliance.zulipchat.com/#narrow/stream/2...</div></div></div>



<a name="192602677"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Krustlet/near/192602677" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Owen Ou <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Krustlet.html#192602677">(Apr 01 2020 at 22:59)</a>:</h4>
<p>Oh you're 1 min ahead of me: <a href="https://github.com/deislabs/krustlet/pull/147" title="https://github.com/deislabs/krustlet/pull/147">https://github.com/deislabs/krustlet/pull/147</a>. Feel free to close mine <span aria-label="slight smile" class="emoji emoji-1f642" role="img" title="slight smile">:slight_smile:</span></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/deislabs/krustlet/pull/147" style="background-image: url(https://avatars1.githubusercontent.com/u/44041561?s=400&amp;v=4)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/deislabs/krustlet/pull/147" title="docs(kind): special instructions for Docker Desktop for Mac by bacongobbler · Pull Request #147 · deislabs/krustlet">docs(kind): special instructions for Docker Desktop for Mac by bacongobbler · Pull Request #147 · deislabs/krustlet</a></div><div class="message_embed_description">thanks to @jingweno for the tip.
Signed-off-by: Matthew Fisher matt.fisher@microsoft.com</div></div></div>



<a name="198003276"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/227959-wasmtime%20on%20k8s/topic/Krustlet/near/198003276" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Radu Matei <a href="https://bytecodealliance.github.io/zulip-archive/stream/227959-wasmtime-on-k8s/topic/Krustlet.html#198003276">(May 18 2020 at 22:28)</a>:</h4>
<p><a href="https://twitter.com/_oftaylor/status/1262482967009476610">https://twitter.com/_oftaylor/status/1262482967009476610</a></p>
<div class="inline-preview-twitter"><div class="twitter-tweet"><a href="https://twitter.com/_oftaylor/status/1262482967009476610"><img class="twitter-avatar" src="https://pbs.twimg.com/profile_images/784449507568132096/_5S4fLuq_normal.jpg"></a><p>We just cut the 0.2 release of Krustlet <span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span> Thanks to all those in the community who have helped out with this! <a href="https://t.co/c9oY4EjMFi">https://github.com/deislabs/krustlet/releases/tag/v0.2.0</a>

We also published the Kubelet logic as its own separate #rustlang crate so you can build your own provider in Rust! <a href="https://t.co/Id3vBHaTma">https://crates.io/crates/kubelet</a></p><span>- Taylor Thomas (@_oftaylor)</span></div></div>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>