<html>
<head><meta charset="utf-8"><title>Runtime panic building a component utilizing `wasi-http` · wasi-cloud · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/356481-wasi-cloud/index.html">wasi-cloud</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/356481-wasi-cloud/topic/Runtime.20panic.20building.20a.20component.20utilizing.20.60wasi-http.60.html">Runtime panic building a component utilizing `wasi-http`</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="345648304"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/356481-wasi-cloud/topic/Runtime%20panic%20building%20a%20component%20utilizing%20%60wasi-http%60/near/345648304" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Roman Volosatovs <a href="https://bytecodealliance.github.io/zulip-archive/stream/356481-wasi-cloud/topic/Runtime.20panic.20building.20a.20component.20utilizing.20.60wasi-http.60.html#345648304">(Mar 30 2023 at 11:57)</a>:</h4>
<p>Hi, not sure where is the right place for this, but I am currently unable to build a component utilizing<code>wasi-http</code> with latest released versions of tooling - <code>wit-component</code> panics during encoding step. Latest git refs do not help from what I can see.</p>
<p>I have opened an issue here <a href="https://github.com/bytecodealliance/wasm-tools/issues/967">https://github.com/bytecodealliance/wasm-tools/issues/967</a><br>
And I have a reproducer repo here <a href="https://github.com/rvolosatovs/wasi-http-guest-repo">https://github.com/rvolosatovs/wasi-http-guest-repo</a></p>
<p>Does anyone have an idea about what could be going on and possible fixes? (happy to attempt to fix, but not sure where to start yet)</p>
<p>I have added test cases to both <code>wit-bindgen</code> and <code>wit-component</code> with this component and both test cases pass just fine. So far, it does not seem that <code>wit-component</code> is actually the culprit</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wasm-tools/issues/967" style="background-image: url(https\:\/\/uploads\.zulipusercontent\.net\/d28b90f47bce9b1cfac05f5555902a46b1794c51\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f666435333234336566376538633663303138336331333235353039326131303931623763646237613462653434653938376533663465656131333131613032372f62797465636f6465616c6c69616e63652f7761736d2d746f6f6c732f6973737565732f393637)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wasm-tools/issues/967" title="Runtime panic encoding a guest component utilizing `wasi-http` · Issue #967 · bytecodealliance/wasm-tools">Runtime panic encoding a guest component utilizing `wasi-http` · Issue #967 · bytecodealliance/wasm-tools</a></div><div class="message_embed_description">WebAssembly components currently cannot utilize https://github.com/WebAssembly/wasi-http on commit 53e2d258ae3008d254bda79ec958355ded8751a9 with: wit-bingen 0.4.0 wit-component 0.7.4 wasi_snapshot_...</div></div></div><div class="message_embed"><a class="message_embed_image" href="https://github.com/rvolosatovs/wasi-http-guest-repo" style="background-image: url(https\:\/\/uploads\.zulipusercontent\.net\/0b3b2fbffaa773ae6991051b09cbb71877ac25dd\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f613930313932653735313138633034373766313063333331363239626637386436666461396561353036396563326533333131356338303766636534636163632f72766f6c6f7361746f76732f776173692d687474702d67756573742d7265706f)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/rvolosatovs/wasi-http-guest-repo" title="GitHub - rvolosatovs/wasi-http-guest-repo">GitHub - rvolosatovs/wasi-http-guest-repo</a></div><div class="message_embed_description">Contribute to rvolosatovs/wasi-http-guest-repo development by creating an account on GitHub.</div></div></div>



<a name="345685218"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/356481-wasi-cloud/topic/Runtime%20panic%20building%20a%20component%20utilizing%20%60wasi-http%60/near/345685218" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Roman Volosatovs <a href="https://bytecodealliance.github.io/zulip-archive/stream/356481-wasi-cloud/topic/Runtime.20panic.20building.20a.20component.20utilizing.20.60wasi-http.60.html#345685218">(Mar 30 2023 at 14:08)</a>:</h4>
<p>Filed a PR with a (temporary) fix <a href="https://github.com/WebAssembly/wasi-http/pull/21">https://github.com/WebAssembly/wasi-http/pull/21</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/WebAssembly/wasi-http/pull/21" style="background-image: url(https\:\/\/uploads\.zulipusercontent\.net\/dc7e5973b17b95a817487cbd5cc2f1cbfe2d6b77\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f616438356237613936313233323962386635383334343137313431326435643162323034623565323838343136666434333536306636323665323333346433342f576562417373656d626c792f776173692d687474702f70756c6c2f3231)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/WebAssembly/wasi-http/pull/21" title="fix: rename `streams` interface by rvolosatovs · Pull Request #21 · WebAssembly/wasi-http">fix: rename `streams` interface by rvolosatovs · Pull Request #21 · WebAssembly/wasi-http</a></div><div class="message_embed_description">Unfortunately, naming the interface dependency streams causes a clash with wasi_snapshot_preview1.wasm streams causing a runtime panic in wit-component. While the fix for this issue clearly belongs...</div></div></div>



<a name="345758698"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/356481-wasi-cloud/topic/Runtime%20panic%20building%20a%20component%20utilizing%20%60wasi-http%60/near/345758698" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mossaka (Joe) <a href="https://bytecodealliance.github.io/zulip-archive/stream/356481-wasi-cloud/topic/Runtime.20panic.20building.20a.20component.20utilizing.20.60wasi-http.60.html#345758698">(Mar 30 2023 at 18:33)</a>:</h4>
<p>Hey thank you for raising the issues! <span class="user-mention" data-user-id="253998">@Luke Wagner</span> could you please take a look?</p>



<a name="346049790"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/356481-wasi-cloud/topic/Runtime%20panic%20building%20a%20component%20utilizing%20%60wasi-http%60/near/346049790" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eduardo Rodrigues <a href="https://bytecodealliance.github.io/zulip-archive/stream/356481-wasi-cloud/topic/Runtime.20panic.20building.20a.20component.20utilizing.20.60wasi-http.60.html#346049790">(Mar 31 2023 at 20:21)</a>:</h4>
<p>Based on Pat’s comments here (<a href="https://github.com/bytecodealliance/wasmtime/pull/5929#issuecomment-1492230954">https://github.com/bytecodealliance/wasmtime/pull/5929#issuecomment-1492230954</a>), we have to wait for the preview1-adapter to get added to the Wasmtime. Basically, we get errors like <span class="user-mention" data-user-id="484032">@Roman Volosatovs</span> reported when mixing both component and module based linkers.</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wasmtime/pull/5929#issuecomment-1492230954" style="background-image: url(https\:\/\/uploads\.zulipusercontent\.net\/5f1f74a3b75d2bbe856135247643f02bcbc321f1\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f633465383962656365613161666563353563643862336339333037633233323436313838333739623662373961376165343561356435343338663366383331652f62797465636f6465616c6c69616e63652f7761736d74696d652f70756c6c2f35393239)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wasmtime/pull/5929#issuecomment-1492230954" title="Begin implementation of wasi-http by brendandburns · Pull Request #5929 · bytecodealliance/wasmtime">Begin implementation of wasi-http by brendandburns · Pull Request #5929 · bytecodealliance/wasmtime</a></div><div class="message_embed_description">Initial draft, working, but with limitations.
Known issues:

Outbound requests only, inbound HTTP serving is not supported
Body for requests is not supported
Request options (e.g. timeout values) a...</div></div></div>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>