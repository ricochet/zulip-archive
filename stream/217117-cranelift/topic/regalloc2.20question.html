<html>
<head><meta charset="utf-8"><title>regalloc2 question · cranelift · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/index.html">cranelift</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/regalloc2.20question.html">regalloc2 question</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="437581588"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/regalloc2%20question/near/437581588" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> CompilerSmith <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/regalloc2.20question.html#437581588">(May 08 2024 at 05:55)</a>:</h4>
<p>Regalloc2 design document states the following:</p>
<blockquote>
<p>The environment also provides exactly one scratch register per class. This register must not be in the preferred or non-preferred vectors, and is used whenever a set of moves that need to occur logically in parallel have a cycle (for a simple example, consider a swap <code>r0, r1 := r1, r0</code>).</p>
</blockquote>
<p>With some more work, we could potentially remove the need for the scratch register by requiring support for an additional edit type from the client ("swap"), but we have not pursued this.</p>
<p>But the rust docs states the following:</p>
<blockquote>
<p>If a scratch register is not provided then the register allocator will automatically allocate one as needed, spilling a value to the stack if necessary.</p>
</blockquote>
<p><a href="https://docs.rs/regalloc2/latest/regalloc2/struct.MachineEnv.html">https://docs.rs/regalloc2/latest/regalloc2/struct.MachineEnv.html</a></p>
<p>Which one of these do i refer too?</p>



<a name="437670598"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/regalloc2%20question/near/437670598" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/regalloc2.20question.html#437670598">(May 08 2024 at 15:07)</a>:</h4>
<p>The latter is accurate; the design doc is out of date</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>