<html>
<head><meta charset="utf-8"><title>just getting started · cranelift · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/index.html">cranelift</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/just.20getting.20started.html">just getting started</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="360174859"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/just%20getting%20started/near/360174859" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Holliday <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/just.20getting.20started.html#360174859">(May 22 2023 at 07:10)</a>:</h4>
<p>I'm quite new. Wondering what's wrong here:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">function</span><span class="w"> </span><span class="n">u0</span>:<span class="mi">0</span><span class="p">()</span><span class="w"> </span><span class="n">system_v</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">ss0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">explicit_slot</span><span class="w"> </span><span class="mi">4</span>

<span class="n">block0</span>:
    <span class="nc">v0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stack_addr</span><span class="p">.</span><span class="kt">i32</span><span class="w"> </span><span class="n">ss0</span>
<span class="w">    </span><span class="n">v1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i32</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="n">store</span><span class="w"> </span><span class="n">v0</span><span class="p">,</span><span class="w"> </span><span class="n">v1</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="n">v1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="n">v2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i32</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="k">return</span>
<span class="p">}</span>
</code></pre></div>



<a name="360175707"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/just%20getting%20started/near/360175707" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Holliday <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/just.20getting.20started.html#360175707">(May 22 2023 at 07:15)</a>:</h4>
<p>looks like I want <code>stack_store</code> instead</p>



<a name="360203266"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/just%20getting%20started/near/360203266" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/just.20getting.20started.html#360203266">(May 22 2023 at 09:11)</a>:</h4>
<p>On 64bit systems you need to use <code>stack_addr.i64</code> instead. The type param of <code>stack_addr</code> is the pointer type.</p>



<a name="360203379"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/just%20getting%20started/near/360203379" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/just.20getting.20started.html#360203379">(May 22 2023 at 09:12)</a>:</h4>
<p><span class="user-mention" data-user-id="601349">@Taylor Holliday</span></p>



<a name="360306015"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/just%20getting%20started/near/360306015" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Holliday <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/just.20getting.20started.html#360306015">(May 22 2023 at 15:27)</a>:</h4>
<p>thanks <span class="user-mention" data-user-id="264278">@bjorn3</span> ! What about the <code>stack_store</code> instruction? Looks like I want to call <code>StackStore</code> but not sure how (<a href="https://docs.rs/cranelift-codegen/latest/cranelift_codegen/ir/trait.InstBuilder.html#method.StackStore">https://docs.rs/cranelift-codegen/latest/cranelift_codegen/ir/trait.InstBuilder.html#method.StackStore</a>)</p>



<a name="360307289"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/just%20getting%20started/near/360307289" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Afonso Bordado <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/just.20getting.20started.html#360307289">(May 22 2023 at 15:31)</a>:</h4>
<p>You might want to use <a href="https://docs.rs/cranelift-codegen/latest/cranelift_codegen/ir/trait.InstBuilder.html#method.stack_store"><code>InstBuilder::stack_store</code></a> instead, which is the more friendly version of that API</p>



<a name="360307556"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/just%20getting%20started/near/360307556" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Afonso Bordado <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/just.20getting.20started.html#360307556">(May 22 2023 at 15:32)</a>:</h4>
<p>There you don't need to specify a pointer type. And can just provide <code>v1</code>(from the example above) as a value and <code>ss0</code> as the stack slot</p>



<a name="360309006"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/just%20getting%20started/near/360309006" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Holliday <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/just.20getting.20started.html#360309006">(May 22 2023 at 15:37)</a>:</h4>
<p>excellent, thanks <span class="user-mention" data-user-id="410955">@Afonso Bordado</span> !</p>



<a name="360315938"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/just%20getting%20started/near/360315938" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/just.20getting.20started.html#360315938">(May 22 2023 at 16:04)</a>:</h4>
<p>The CamelCase methods on <code>InstBuilder</code> should only be used in very specific cases. Rather than building an instruction with a certain opcode, like the snake_case methods do, the CamelCase methods build instructions with specific instruction formats. A single instruction format may be used by multiple opcodes. For example the <code>Binary</code> instruction format is used by <code>iadd</code>, <code>isub</code>, <code>umul</code>, <code>smul</code>, <code>udiv</code>, <code>sdiv</code>, and so on. Instruction formats are an artifact of the way we internally encode instructions. You shouldn't have to worry about them unless you are writing an optimization pass.</p>



<a name="360322050"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/just%20getting%20started/near/360322050" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Holliday <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/just.20getting.20started.html#360322050">(May 22 2023 at 16:31)</a>:</h4>
<p>cool... thanks for the info! I'm not sure how I missed the <code>stack_store</code> function when searching around</p>



<a name="360322327"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/just%20getting%20started/near/360322327" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Holliday <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/just.20getting.20started.html#360322327">(May 22 2023 at 16:32)</a>:</h4>
<p>I'm also wondering how to represent a struct. In LLVM I could build up a struct type, but I guess cranelift IR doesn't have structs?</p>



<a name="360327491"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/just%20getting%20started/near/360327491" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/just.20getting.20started.html#360327491">(May 22 2023 at 16:54)</a>:</h4>
<p><span class="user-mention" data-user-id="601349">@Taylor Holliday</span> we had a recent discussion on this <a href="#narrow/stream/217117-cranelift/topic/Question.20about.20passing.20structs.20by.20value">here</a>, but briefly, that's correct: we don't support structs, only primitive types and pointers, but with those you can build structs at a higher abstraction level (i.e. your compiler) and lower to CLIF</p>



<a name="360327797"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/just%20getting%20started/near/360327797" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Holliday <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/just.20getting.20started.html#360327797">(May 22 2023 at 16:55)</a>:</h4>
<p>cool... thanks <span class="user-mention" data-user-id="254389">@Chris Fallin</span> ! I'm a graphics person attempting a compiler hah</p>



<a name="360328052"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/just%20getting%20started/near/360328052" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/just.20getting.20started.html#360328052">(May 22 2023 at 16:57)</a>:</h4>
<p>you wouldn't be the first person taking that path! :-) Best of luck and feel free to ask more questions here</p>



<a name="360329296"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/just%20getting%20started/near/360329296" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/just.20getting.20started.html#360329296">(May 22 2023 at 17:02)</a>:</h4>
<p>A quick search suggests that you are the developer of Audulus. Do you want to use Cranelift as jit compiler for the audio graph?</p>



<a name="360369430"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/just%20getting%20started/near/360369430" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Holliday <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/just.20getting.20started.html#360369430">(May 22 2023 at 20:32)</a>:</h4>
<p><span class="user-mention" data-user-id="264278">@bjorn3</span> yep! It's gonna be tricky though since Apple forbids JIT on iOS. I was thinking of using a wasm interpreter. I'm also working on a little language for writing DSP code inside the nodes in Audulus: <a href="https://github.com/audulus/lyte">https://github.com/audulus/lyte</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/audulus/lyte" style="background-image: url(https\:\/\/uploads\.zulipusercontent\.net\/68f4be728f0addc3e5f5eb24613b1210146ea434\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f656238333930303130366134363031613836626537383336383931363861396531363439313239333334343065316337613166663838396438363039616431342f617564756c75732f6c797465)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/audulus/lyte" title="GitHub - audulus/lyte: A programming language for Audulus nodes">GitHub - audulus/lyte: A programming language for Audulus nodes</a></div><div class="message_embed_description">A programming language for Audulus nodes. Contribute to audulus/lyte development by creating an account on GitHub.</div></div></div>



<a name="360369868"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/just%20getting%20started/near/360369868" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/just.20getting.20started.html#360369868">(May 22 2023 at 20:35)</a>:</h4>
<p>Yeah, apple forbidding jitting is a pain.</p>



<a name="360369969"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/just%20getting%20started/near/360369969" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/just.20getting.20started.html#360369969">(May 22 2023 at 20:36)</a>:</h4>
<p>By the way I noticed a typo in the readme: langauge -&gt; language</p>



<a name="360370173"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/just%20getting%20started/near/360370173" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Holliday <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/just.20getting.20started.html#360370173">(May 22 2023 at 20:37)</a>:</h4>
<p>ah thanks!</p>



<a name="360370177"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/just%20getting%20started/near/360370177" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/just.20getting.20started.html#360370177">(May 22 2023 at 20:37)</a>:</h4>
<p>Is that language meant to be directly used by end users or will audulus have a fixed set of nodes written in that language that are then composed together using a gui?</p>



<a name="360370201"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/just%20getting%20started/near/360370201" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Holliday <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/just.20getting.20started.html#360370201">(May 22 2023 at 20:37)</a>:</h4>
<p>directly by end users</p>



<a name="360370218"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/just%20getting%20started/near/360370218" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Holliday <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/just.20getting.20started.html#360370218">(May 22 2023 at 20:37)</a>:</h4>
<p>currently there is a Lua DSP node in the app</p>



<a name="360370281"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/just%20getting%20started/near/360370281" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Holliday <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/just.20getting.20started.html#360370281">(May 22 2023 at 20:37)</a>:</h4>
<p>which works reasonably well with LuaJIT</p>



<a name="360370567"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/just%20getting%20started/near/360370567" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Holliday <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/just.20getting.20started.html#360370567">(May 22 2023 at 20:39)</a>:</h4>
<p>I just figured a statically typed language would be better, plus its an excuse for me to make one</p>



<a name="360370679"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/just%20getting%20started/near/360370679" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/just.20getting.20started.html#360370679">(May 22 2023 at 20:40)</a>:</h4>
<p>In that case you can't precompile all nodes at build time for the ios version. Precompiling nodes + interpreting the composition of nodes would likely be faster than interpreting the individual instructions of a node. If there are nodes written in that language maybe you could still precompile just those fixed nodes and interpret the rest.</p>



<a name="360370685"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/just%20getting%20started/near/360370685" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Holliday <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/just.20getting.20started.html#360370685">(May 22 2023 at 20:40)</a>:</h4>
<p>there's also an expression node (simple C math expressions) that would benefit from JITting</p>



<a name="360370883"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/just%20getting%20started/near/360370883" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Holliday <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/just.20getting.20started.html#360370883">(May 22 2023 at 20:41)</a>:</h4>
<p>so actually what I currently do, which is a little nuts, is I generate C for various subgraphs in the library of modules that come with the app. when the app detects such a configuration by checksumming generated C, it will use an AOT compiled function</p>



<a name="360371043"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/just%20getting%20started/near/360371043" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Holliday <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/just.20getting.20started.html#360371043">(May 22 2023 at 20:43)</a>:</h4>
<p>that was the best I could do to work around the JIT restriction so far</p>



<a name="360371341"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/just%20getting%20started/near/360371341" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Holliday <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/just.20getting.20started.html#360371341">(May 22 2023 at 20:45)</a>:</h4>
<p>anyway the app is also on macOS so I can use JITting there</p>



<a name="360371387"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/just%20getting%20started/near/360371387" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Holliday <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/just.20getting.20started.html#360371387">(May 22 2023 at 20:45)</a>:</h4>
<p>and I want to bring back my Linux and Windows versions at some point, but I digress :)</p>



<a name="360371701"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/just%20getting%20started/near/360371701" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/just.20getting.20started.html#360371701">(May 22 2023 at 20:47)</a>:</h4>
<p>I know WebkitView doesn't allow jitting, but does SafariView allow jitting? If so I guess you could from a technical perspective try to compile the graph to webassembly and inject it into the SafariView. But the docs say that it isn't allowed to be hidden, so it wouldn't pass the app store review.</p>



<a name="360371881"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/just%20getting%20started/near/360371881" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Holliday <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/just.20getting.20started.html#360371881">(May 22 2023 at 20:48)</a>:</h4>
<p>oh that's interesting... where's that in the docs?</p>



<a name="360372079"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/just%20getting%20started/near/360372079" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/just.20getting.20started.html#360372079">(May 22 2023 at 20:49)</a>:</h4>
<p>If you are asking about it not being allowed by the app store guidelines: <a href="https://developer.apple.com/documentation/safariservices/sfsafariviewcontroller">https://developer.apple.com/documentation/safariservices/sfsafariviewcontroller</a></p>
<blockquote>
<p>In accordance with App Store Review Guidelines, this view controller must be used to visibly present information to users; the controller may not be hidden or obscured by other views or layers.</p>
</blockquote>
<div class="message_embed"><a class="message_embed_image" href="https://developer.apple.com/documentation/safariservices/sfsafariviewcontroller" style="background-image: url(https\:\/\/uploads\.zulipusercontent\.net\/2c5de1ae193b15bee67ae59b65da13e37ff43be6\/68747470733a2f2f646f63732e646576656c6f7065722e6170706c652e636f6d2f7475746f7269616c732f646576656c6f7065722d6f672e6a7067)"></a><div class="data-container"><div class="message_embed_title"><a href="https://developer.apple.com/documentation/safariservices/sfsafariviewcontroller" title="SFSafariViewController | Apple Developer Documentation">SFSafariViewController | Apple Developer Documentation</a></div><div class="message_embed_description">An object that provides a visible standard interface for browsing the web.</div></div></div>



<a name="360372620"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/just%20getting%20started/near/360372620" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/just.20getting.20started.html#360372620">(May 22 2023 at 20:52)</a>:</h4>
<p>For jit support in safariview I found this, but I'm not sure if that is the default or requires a special entitlement only given to browsers: <a href="https://infrequently.org/2021/08/webkit-ios-deep-dive/">https://infrequently.org/2021/08/webkit-ios-deep-dive/</a></p>
<blockquote>
<p>Safari on iOS had JIT for many years, whereas competing browsers were prevented from approaching similar levels of performance. More recently, WebView browsers on iOS have been able to take advantage of WebKit's JIT-ing JavaScript engine, but are prevented from bringing their own.</p>
</blockquote>
<div class="message_embed"><a class="message_embed_image" href="https://infrequently.org/2021/08/webkit-ios-deep-dive/" style="background-image: url(https\:\/\/uploads\.zulipusercontent\.net\/a3423e2e3857c0cd3418bf2e48bb4eae2492a0c3\/68747470733a2f2f696e6672657175656e746c792e6f72672f323032312f30382f7765626b69742d696f732d646565702d646976652f696f735f757064617465732e6a7067)"></a><div class="data-container"><div class="message_embed_title"><a href="https://infrequently.org/2021/08/webkit-ios-deep-dive/" title="iOS Engine Choice In Depth - Infrequently Noted">iOS Engine Choice In Depth - Infrequently Noted</a></div><div class="message_embed_description">A deep dive into the arguments offered by Apple and others to defend a lack of browser engine choice on iOS. Instead of raising the security floor, Apple has set a cap whilst breeding a monoculture that ensures all iOS browsers are vulnerable to identical attacks, no matter whose icon is on the home screen.</div></div></div>



<a name="360372855"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/just%20getting%20started/near/360372855" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/just.20getting.20started.html#360372855">(May 22 2023 at 20:54)</a>:</h4>
<p>And it seems that jit compilation is possible for sideloaded apps: <a href="https://9to5mac.com/2020/11/06/ios-14-2-brings-jit-compilation-support-which-enables-emulation-apps-at-full-performance/">https://9to5mac.com/2020/11/06/ios-14-2-brings-jit-compilation-support-which-enables-emulation-apps-at-full-performance/</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://9to5mac.com/2020/11/06/ios-14-2-brings-jit-compilation-support-which-enables-emulation-apps-at-full-performance/" style="background-image: url(https\:\/\/uploads\.zulipusercontent\.net\/b80fa685b6e21f3c89a4692ea6310578852048f5\/68747470733a2f2f69302e77702e636f6d2f39746f356d61632e636f6d2f77702d636f6e74656e742f75706c6f6164732f73697465732f362f323032302f31312f695061642d55544d2d564d2e706e673f726573697a653d31323030253243363238267175616c6974793d38322673747269703d616c6c2673736c3d31)"></a><div class="data-container"><div class="message_embed_title"><a href="https://9to5mac.com/2020/11/06/ios-14-2-brings-jit-compilation-support-which-enables-emulation-apps-at-full-performance/" title="iOS 14.2 brings JIT compilation support, which enables emulation apps at full performance">iOS 14.2 brings JIT compilation support, which enables emulation apps at full performance</a></div><div class="message_embed_description">You may know some unofficial iOS apps that offer some kind of emulation. These apps run based on hacks and...</div></div></div>



<a name="360373156"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/just%20getting%20started/near/360373156" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/just.20getting.20started.html#360373156">(May 22 2023 at 20:56)</a>:</h4>
<p>I don't think any of this is realistically usable for a regular app store app though unfortunately.</p>



<a name="360392887"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/just%20getting%20started/near/360392887" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Holliday <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/just.20getting.20started.html#360392887">(May 22 2023 at 23:13)</a>:</h4>
<p>yeah not much one can do about it really</p>



<a name="360392911"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/just%20getting%20started/near/360392911" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Holliday <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/just.20getting.20started.html#360392911">(May 22 2023 at 23:13)</a>:</h4>
<p>thanks for the links!</p>



<a name="360393242"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/just%20getting%20started/near/360393242" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Holliday <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/just.20getting.20started.html#360393242">(May 22 2023 at 23:16)</a>:</h4>
<p>the Infrequently Noted article seems like an excellent treatment of the topic</p>



<a name="360409159"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/just%20getting%20started/near/360409159" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Holliday <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/just.20getting.20started.html#360409159">(May 23 2023 at 01:54)</a>:</h4>
<p>can I generate code to get the address of a <code>cranelift_frontend::Variable</code>? Trying to do lvalues</p>



<a name="360409605"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/just%20getting%20started/near/360409605" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Holliday <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/just.20getting.20started.html#360409605">(May 23 2023 at 01:59)</a>:</h4>
<p>hehe GPT thought I could pass in a <code>Variable</code> instead of a <code>StackSlot</code>: <code>self.builder.ins().stack_addr(I32, variable, 0)</code></p>



<a name="360411798"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/just%20getting%20started/near/360411798" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/just.20getting.20started.html#360411798">(May 23 2023 at 02:21)</a>:</h4>
<p>A <code>Variable</code> doesn't exist in memory; you'll want to create a stackslot if you need a thing that has an address (and then generate loads and stores to it as appropriate)</p>



<a name="360411932"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/just%20getting%20started/near/360411932" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/just.20getting.20started.html#360411932">(May 23 2023 at 02:22)</a>:</h4>
<p>(also just fwiw, I'm pretty annoyed with GPT/LLMs' tendency to hallucinate incorrect things, so I'm really not wild about helping to fix its incorrect output; as a policy I'd prefer to offer help to human intelligences only!)</p>



<a name="360429599"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/just%20getting%20started/near/360429599" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Holliday <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/just.20getting.20started.html#360429599">(May 23 2023 at 05:29)</a>:</h4>
<p>ah ok... think I figured it out. Not sure I'm doing it the right way (I'm not using stack slots at all). Instead I created a separate function for codegen on lvalues which returns a Variable. That may not be doable for more complex lvalue expressions like <code>my_struct.my_array[3]</code> or something. I assume at some point I'll need to generate an address from a stack slot</p>



<a name="360429883"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/just%20getting%20started/near/360429883" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Holliday <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/just.20getting.20started.html#360429883">(May 23 2023 at 05:32)</a>:</h4>
<p>I've been mainly working from the cranelift jit demo (<a href="https://github.com/bytecodealliance/cranelift-jit-demo">https://github.com/bytecodealliance/cranelift-jit-demo</a>), but the toy language only has ints, so assignment is very simple</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/cranelift-jit-demo" style="background-image: url(https\:\/\/uploads\.zulipusercontent\.net\/6fa1a735101edd29a4355a8ba7d1df8ee40fd307\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f663562373363633532623633656231636235346437623036613637643832366236633130353634656437333363623439323835383166323564633835353233342f62797465636f6465616c6c69616e63652f6372616e656c6966742d6a69742d64656d6f)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/cranelift-jit-demo" title="GitHub - bytecodealliance/cranelift-jit-demo: JIT compiler and runtime for a toy language, using Cranelift">GitHub - bytecodealliance/cranelift-jit-demo: JIT compiler and runtime for a toy language, using Cranelift</a></div><div class="message_embed_description">JIT compiler and runtime for a toy language, using Cranelift - GitHub - bytecodealliance/cranelift-jit-demo: JIT compiler and runtime for a toy language, using Cranelift</div></div></div>



<a name="360594472"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/just%20getting%20started/near/360594472" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Holliday <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/just.20getting.20started.html#360594472">(May 23 2023 at 17:18)</a>:</h4>
<p>now I'm wondering where to look for an example of exposing a rust function to be called from the generated code</p>



<a name="360603501"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/just%20getting%20started/near/360603501" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Holliday <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/just.20getting.20started.html#360603501">(May 23 2023 at 17:59)</a>:</h4>
<p>hmm this panics: </p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">    </span><span class="k">fn</span> <span class="nf">setup_library</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">sig</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">module</span><span class="p">.</span><span class="n">make_signature</span><span class="p">();</span>
<span class="w">        </span><span class="n">sig</span><span class="p">.</span><span class="n">params</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">AbiParam</span>::<span class="n">new</span><span class="p">(</span><span class="n">types</span>::<span class="n">I32</span><span class="p">));</span>

<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">func_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">module</span>
<span class="w">        </span><span class="p">.</span><span class="n">declare_function</span><span class="p">(</span><span class="s">"lyte_assert"</span><span class="p">,</span><span class="w"> </span><span class="n">Linkage</span>::<span class="n">Import</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">sig</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="n">unwrap</span><span class="p">();</span>


<span class="w">        </span><span class="bp">self</span><span class="p">.</span><span class="n">module</span><span class="p">.</span><span class="n">define_function</span><span class="p">(</span>
<span class="w">            </span><span class="n">func_id</span><span class="p">,</span>
<span class="w">            </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">ctx</span><span class="p">,</span>
<span class="w">        </span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span><span class="w"> </span><span class="c1">// &lt;--- this panics with InvalidImportDefinition("lyte_assert")</span>
<span class="w">    </span><span class="p">}</span>
</code></pre></div>



<a name="360604011"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/just%20getting%20started/near/360604011" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Holliday <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/just.20getting.20started.html#360604011">(May 23 2023 at 18:01)</a>:</h4>
<p>anything obvious there? I can do a more complete repro if necessary</p>



<a name="360604466"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/just%20getting%20started/near/360604466" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/just.20getting.20started.html#360604466">(May 23 2023 at 18:03)</a>:</h4>
<p><span class="user-mention" data-user-id="264278">@bjorn3</span> would have a more definitive answer (I don't know <code>cranelift-module</code> well) but I <em>think</em> one is not supposed to define a function that is also an import</p>



<a name="360607410"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/just%20getting%20started/near/360607410" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Holliday <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/just.20getting.20started.html#360607410">(May 23 2023 at 18:15)</a>:</h4>
<p>ah ok</p>



<a name="360607420"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/just%20getting%20started/near/360607420" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> PROMETHIA <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/just.20getting.20started.html#360607420">(May 23 2023 at 18:15)</a>:</h4>
<p>If you're only trying to JIT, then an easy way is to make the rust function <code>extern "C"</code>, and then grab its function pointer as an <code>i64</code>. Then you can just load it using <code>iconst()</code> and use that as a value to <code>call_indirect</code>. Just have to make sure you use the system default calling convention too, or else they'll mismatch.</p>



<a name="360607540"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/just%20getting%20started/near/360607540" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Holliday <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/just.20getting.20started.html#360607540">(May 23 2023 at 18:15)</a>:</h4>
<p>dang that's pretty easy :)</p>



<a name="360608778"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/just%20getting%20started/near/360608778" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/just.20getting.20started.html#360608778">(May 23 2023 at 18:21)</a>:</h4>
<p>that's also going to be approximately the most efficient option, because a call from JIT code to some other arbitrary code in the process will have to use a full 64-bit address anyway (not within the 2GB RIP-relative range of an ordinary call instruction); so it's not bad at all!</p>



<a name="360609712"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/just%20getting%20started/near/360609712" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/just.20getting.20started.html#360609712">(May 23 2023 at 18:25)</a>:</h4>
<p>You can also call <code>.symbol("lyte_assert", the_lyte_assert_function as usize as *const u8)</code> on the <code>JITBuilder</code> before you create the <code>JITModule</code> using it.</p>



<a name="360610336"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/just%20getting%20started/near/360610336" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/just.20getting.20started.html#360610336">(May 23 2023 at 18:28)</a>:</h4>
<p><code>.symbol()</code> takes precedence over <code>dlsym()</code> for symbol lookup.</p>



<a name="362355251"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/just%20getting%20started/near/362355251" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Holliday <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/just.20getting.20started.html#362355251">(May 31 2023 at 06:21)</a>:</h4>
<p>I did something dumb, but should cranelift panic like this? </p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">function</span><span class="w"> </span><span class="n">u0</span>:<span class="mi">0</span><span class="p">()</span><span class="w"> </span><span class="n">system_v</span><span class="w"> </span><span class="p">{</span>
<span class="n">block0</span>:
    <span class="nc">v0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i32</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="n">v1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">load</span><span class="p">.</span><span class="kt">i32</span><span class="w"> </span><span class="n">v0</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="n">v0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="n">v2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i32</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="k">return</span>
<span class="p">}</span>

<span class="n">thread</span><span class="w"> </span><span class="o">'</span><span class="na">compiler</span>::<span class="n">tests</span>::<span class="n">basic2</span><span class="o">'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">'</span><span class="na">internal</span><span class="w"> </span><span class="n">error</span>: <span class="nc">entered</span><span class="w"> </span><span class="n">unreachable</span><span class="w"> </span><span class="n">code</span>: <span class="nc">no</span><span class="w"> </span><span class="n">rule</span><span class="w"> </span><span class="n">matched</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">term</span><span class="w"> </span><span class="n">to_amode</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">src</span><span class="o">/</span><span class="n">isa</span><span class="o">/</span><span class="n">x64</span><span class="o">/</span><span class="n">inst</span><span class="p">.</span><span class="n">isle</span><span class="w"> </span><span class="n">line</span><span class="w"> </span><span class="mi">1076</span><span class="p">;</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">partial</span><span class="o">?'</span><span class="p">,</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">holliday</span><span class="o">/</span><span class="n">lyte</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">codegen</span><span class="o">-</span><span class="n">db8482b6e5c711c6</span><span class="o">/</span><span class="n">out</span><span class="o">/</span><span class="n">isle_x64</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">2297</span>:<span class="mi">5</span>
</code></pre></div>



<a name="362385861"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/just%20getting%20started/near/362385861" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/just.20getting.20started.html#362385861">(May 31 2023 at 08:44)</a>:</h4>
<p>If you run the verifier does it throw an error?</p>



<a name="362386066"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/just%20getting%20started/near/362386066" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/just.20getting.20started.html#362386066">(May 31 2023 at 08:45)</a>:</h4>
<p>Backends work under the assumption that the verifier passed.</p>



<a name="362386493"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/just%20getting%20started/near/362386493" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/just.20getting.20started.html#362386493">(May 31 2023 at 08:47)</a>:</h4>
<p>In your case the issue is that you are using a 32bit address on a 64bit arch. If the verifier doesn't catch this even when passing the TargetIsa to verify_function, this is an issue in the verifier.</p>



<a name="362509714"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/just%20getting%20started/near/362509714" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Taylor Holliday <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/just.20getting.20started.html#362509714">(May 31 2023 at 16:29)</a>:</h4>
<p>I was running verify_function</p>



<a name="362520627"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/just%20getting%20started/near/362520627" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/just.20getting.20started.html#362520627">(May 31 2023 at 17:11)</a>:</h4>
<p>The second argument to verify_function can be flags or it can be a TargetIsa. You are passing flags, but the pointer type check only works when you pass it the TargetIsa for which you are compiling.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>