<html>
<head><meta charset="utf-8"><title>blog post on new backend · cranelift · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/index.html">cranelift</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/blog.20post.20on.20new.20backend.html">blog post on new backend</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="210539388"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/blog%20post%20on%20new%20backend/near/210539388" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/blog.20post.20on.20new.20backend.html#210539388">(Sep 18 2020 at 15:55)</a>:</h4>
<p>Hi all -- I promised some folks a while back that I'd write up the new backend's design in a blog post or three. I've posted part 1 here if anyone is curious: <a href="https://cfallin.org/blog/2020/09/18/cranelift-isel-1/">https://cfallin.org/blog/2020/09/18/cranelift-isel-1/</a></p>



<a name="210539424"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/blog%20post%20on%20new%20backend/near/210539424" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/blog.20post.20on.20new.20backend.html#210539424">(Sep 18 2020 at 15:55)</a>:</h4>
<p>(cc <span class="user-mention" data-user-id="234973">@Till Schneidereit</span> ; I know I promised this all the way back in April or so; sorry for the delay :-) )</p>



<a name="210540746"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/blog%20post%20on%20new%20backend/near/210540746" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> fitzgen (he/him) <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/blog.20post.20on.20new.20backend.html#210540746">(Sep 18 2020 at 16:05)</a>:</h4>
<p>do you have a tweet I can retweet?</p>



<a name="210540831"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/blog%20post%20on%20new%20backend/near/210540831" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/blog.20post.20on.20new.20backend.html#210540831">(Sep 18 2020 at 16:05)</a>:</h4>
<p>I don't do twitter (hi it's me stuck in 2006! may change sometime) but please feel free to tweet it!</p>



<a name="210632470"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/blog%20post%20on%20new%20backend/near/210632470" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> fitzgen (he/him) <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/blog.20post.20on.20new.20backend.html#210632470">(Sep 19 2020 at 19:54)</a>:</h4>
<p><span class="user-mention" data-user-id="254389">@Chris Fallin</span> The new backend is doing greedy search for isel right? No cost model and dynamic programming correct?</p>



<a name="210632477"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/blog%20post%20on%20new%20backend/near/210632477" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> fitzgen (he/him) <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/blog.20post.20on.20new.20backend.html#210632477">(Sep 19 2020 at 19:55)</a>:</h4>
<p><a href="https://mobile.twitter.com/typesanitizer/status/1307361862325952518">https://mobile.twitter.com/typesanitizer/status/1307361862325952518</a></p>
<div class="inline-preview-twitter"><div class="twitter-tweet"><a href="https://mobile.twitter.com/typesanitizer/status/1307361862325952518"><img class="twitter-avatar" src="https://pbs.twimg.com/profile_images/1206561022250668032/dAhulspB_normal.jpg"></a><p><a href="https://twitter.com/fitzgen">@fitzgen</a> Is there an explicit cost model for the instructions? If I am understanding correctly, this is doing greedy instruction selection (maximal munch), there's no dynamic programming involved.</p><span>- Varun Gandhi (@typesanitizer)</span></div></div>



<a name="210632492"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/blog%20post%20on%20new%20backend/near/210632492" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> fitzgen (he/him) <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/blog.20post.20on.20new.20backend.html#210632492">(Sep 19 2020 at 19:55)</a>:</h4>
<p>So nothing like burg and similar things</p>



<a name="210634046"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/blog%20post%20on%20new%20backend/near/210634046" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/blog.20post.20on.20new.20backend.html#210634046">(Sep 19 2020 at 20:35)</a>:</h4>
<p>Yes, exactly, the lowering for a given instruction and its operands is deterministic and maximal. We've had some discussions about heuristics to tune this, e.g. one rule that we tried (but quickly discarded) was to avoid merging operations with &gt; 1 use. It turned out to be better at least for our patterns (on AArch64) to always be greedy, because the operations we're merging tend to be free (e.g. built-in register extends/shifts).</p>



<a name="210634119"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/blog%20post%20on%20new%20backend/near/210634119" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/blog.20post.20on.20new.20backend.html#210634119">(Sep 19 2020 at 20:36)</a>:</h4>
<p>(it occurs to me that I should perhaps join tech-twitter someday so as not to rely on middlefolks such as yourself. Thanks for relaying the question!)</p>



<a name="210634195"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/blog%20post%20on%20new%20backend/near/210634195" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Julian Seward <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/blog.20post.20on.20new.20backend.html#210634195">(Sep 19 2020 at 20:38)</a>:</h4>
<p>That's true (re burg).  IMO burg is/was useful for very complex insn sets, most particularly VAX, but in the modern era (arm64, riscv, and to a large extent the subset of x64 that executes fast), it's pretty much irrelevant.</p>



<a name="210636249"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/blog%20post%20on%20new%20backend/near/210636249" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Amanieu <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/blog.20post.20on.20new.20backend.html#210636249">(Sep 19 2020 at 21:29)</a>:</h4>
<p>Note that the AArch64 built-in shift/extend isn't actually free: it adds an extra cycle of latency to the instruction and reduces the max throughput from 3 to 1 since it needs to use the complex ALU execution unit.</p>



<a name="210636254"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/blog%20post%20on%20new%20backend/near/210636254" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Amanieu <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/blog.20post.20on.20new.20backend.html#210636254">(Sep 19 2020 at 21:29)</a>:</h4>
<p><a href="https://developer.arm.com/documentation/swog307215/a/">source</a> Section 3.4</p>



<a name="210636342"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/blog%20post%20on%20new%20backend/near/210636342" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Amanieu <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/blog.20post.20on.20new.20backend.html#210636342">(Sep 19 2020 at 21:31)</a>:</h4>
<p>So in theory if the result of the shift/extend is used by multiple instructions then you're better off leaving it as a separate instruction.</p>



<a name="210636990"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/blog%20post%20on%20new%20backend/near/210636990" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/blog.20post.20on.20new.20backend.html#210636990">(Sep 19 2020 at 21:48)</a>:</h4>
<p>Interesting, I hadn't seen this before, thank you!</p>



<a name="210637095"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/blog%20post%20on%20new%20backend/near/210637095" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/blog.20post.20on.20new.20backend.html#210637095">(Sep 19 2020 at 21:51)</a>:</h4>
<p>Thinking about this a bit more -- there are implications re: register pressure as well. If we can't spare a temp for the shifted/extended value (and the destination of the add or whatever is also a source, so we can't use it as a temp), then the builtin op saves us. Definitely something to consider more carefully if/when we have a more aggressively-optimized isel mode.</p>



<a name="210637146"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/blog%20post%20on%20new%20backend/near/210637146" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Amanieu <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/blog.20post.20on.20new.20backend.html#210637146">(Sep 19 2020 at 21:52)</a>:</h4>
<p>Another (more common) case is folding an extend into a load: you really don't want to have to duplicate the load! However I will admit that cases where a value is actually used multiple times are quite rare in practice, so it is possible that this won't matter much in real programs.</p>



<a name="210637228"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/blog%20post%20on%20new%20backend/near/210637228" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Amanieu <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/blog.20post.20on.20new.20backend.html#210637228">(Sep 19 2020 at 21:56)</a>:</h4>
<p>Could the register pressure issue be somewhat alleviated by adding rematerialization support to the register allocator?</p>



<a name="210637282"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/blog%20post%20on%20new%20backend/near/210637282" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/blog.20post.20on.20new.20backend.html#210637282">(Sep 19 2020 at 21:56)</a>:</h4>
<p>Indeed. Re: loads, we consider those side-effecting now (both because of traps, and because we've punted on the memory-ordering question until we can think more carefully about it) so we won't ever duplicate. But it's certainly a matter to consider once we adapt e.g. x86 to use memory operands directly when it sees add-from-load.</p>



<a name="210637296"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/blog%20post%20on%20new%20backend/near/210637296" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/blog.20post.20on.20new.20backend.html#210637296">(Sep 19 2020 at 21:57)</a>:</h4>
<p>Re-mat is something that could help in general, yup; another thing on the list that we haven't gotten to quiet yet...</p>



<a name="210637363"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/blog%20post%20on%20new%20backend/near/210637363" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/blog.20post.20on.20new.20backend.html#210637363">(Sep 19 2020 at 21:59)</a>:</h4>
<p>(There are two levels, the first being direct-reload from a spillslot when an ISA supports mem operands; the second is the more general case where we track expressions of pure operators to some depth. Want to get to at least the former, and maybe a simple form of the latter)</p>



<a name="210731108"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/blog%20post%20on%20new%20backend/near/210731108" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/blog.20post.20on.20new.20backend.html#210731108">(Sep 21 2020 at 12:01)</a>:</h4>
<p><a href="/user_uploads/15107/YBQ1mAElIxfdTJiMeLnXXLUd/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/15107/YBQ1mAElIxfdTJiMeLnXXLUd/image.png" title="image.png"><img src="/user_uploads/15107/YBQ1mAElIxfdTJiMeLnXXLUd/image.png"></a></div><p>Number 12 on HN right now</p>



<a name="210793895"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/blog%20post%20on%20new%20backend/near/210793895" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mental <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/blog.20post.20on.20new.20backend.html#210793895">(Sep 21 2020 at 20:15)</a>:</h4>
<p>I just finished reading the post (I noticed it floating around reddit) and I must say, it's very well done! I very much enjoyed reading it :D</p>



<a name="210795083"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/blog%20post%20on%20new%20backend/near/210795083" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/blog.20post.20on.20new.20backend.html#210795083">(Sep 21 2020 at 20:25)</a>:</h4>
<p>Happy to hear it! Now I have to live up to this on the followups :-)</p>



<a name="212894040"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/blog%20post%20on%20new%20backend/near/212894040" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alyssa Rosenzweig <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/blog.20post.20on.20new.20backend.html#212894040">(Oct 10 2020 at 02:05)</a>:</h4>
<p>Nice work, and an excellent write-up to boot. Thanks :)</p>



<a name="212894219"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/blog%20post%20on%20new%20backend/near/212894219" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alyssa Rosenzweig <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/blog.20post.20on.20new.20backend.html#212894219">(Oct 10 2020 at 02:11)</a>:</h4>
<p>I bumped into the "linked lists in Rust" problem trying to model backend IR, so I appreciate seeing there's a "better" way for that too. Still new to Rust but from what I've seen cranelift is a work of art. Nice to see it getting even better <span aria-label="heart eyes" class="emoji emoji-1f60d" role="img" title="heart eyes">:heart_eyes:</span></p>



<a name="212894339"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/blog%20post%20on%20new%20backend/near/212894339" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alyssa Rosenzweig <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/blog.20post.20on.20new.20backend.html#212894339">(Oct 10 2020 at 02:15)</a>:</h4>
<p>Use-counting is a nice touch as well... wouldn't mind dropping our own fixed-point backend DCE... (though for our stuff the real issue is RA/scheduling)</p>



<a name="212899664"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/blog%20post%20on%20new%20backend/near/212899664" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/blog.20post.20on.20new.20backend.html#212899664">(Oct 10 2020 at 05:09)</a>:</h4>
<p>Thanks!</p>



<a name="212920913"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/blog%20post%20on%20new%20backend/near/212920913" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alyssa Rosenzweig <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/blog.20post.20on.20new.20backend.html#212920913">(Oct 10 2020 at 15:31)</a>:</h4>
<blockquote>
<p>Eschewing SSA at this level allows us to avoid the overhead of maintaining its invariants, and maps more closely to the real machine. Lowerings for instructions are allowed to, e.g., use a destination register as a temporary before performing a final write into it. If we required SSA form, we would have to allocate a temporary in this case and rely on the register allocator to coalesce it back to the same register, which adds compile-time overhead</p>
</blockquote>
<p>Part of me was hoping to see one of those fancy polynomial-time SSA-based optimal RA algorithms c:</p>



<a name="212921319"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/blog%20post%20on%20new%20backend/near/212921319" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alyssa Rosenzweig <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/blog.20post.20on.20new.20backend.html#212921319">(Oct 10 2020 at 15:41)</a>:</h4>
<blockquote>
<p>Furthermore, a greedy allocator that traverses the dominance tree in pre-order always finds an optimal coloring, if there is no aliasing of registers and no pre-colored registers</p>
</blockquote>
<p>There's the rub :(</p>



<a name="212922636"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/blog%20post%20on%20new%20backend/near/212922636" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Amanieu <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/blog.20post.20on.20new.20backend.html#212922636">(Oct 10 2020 at 16:15)</a>:</h4>
<p><span class="user-mention" data-user-id="353026">@Alyssa Rosenzweig</span> Actually the old cranelift backend <em>does</em> use SSA-based register allocation.</p>



<a name="212922645"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/blog%20post%20on%20new%20backend/near/212922645" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alyssa Rosenzweig <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/blog.20post.20on.20new.20backend.html#212922645">(Oct 10 2020 at 16:15)</a>:</h4>
<p>Eh?</p>



<a name="212922700"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/blog%20post%20on%20new%20backend/near/212922700" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Amanieu <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/blog.20post.20on.20new.20backend.html#212922700">(Oct 10 2020 at 16:16)</a>:</h4>
<p><a href="https://github.com/bytecodealliance/wasmtime/tree/main/cranelift/codegen/src/regalloc">https://github.com/bytecodealliance/wasmtime/tree/main/cranelift/codegen/src/regalloc</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wasmtime/tree/main/cranelift/codegen/src/regalloc" style="background-image: url(https://avatars0.githubusercontent.com/u/54038801?s=400&amp;v=4)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wasmtime/tree/main/cranelift/codegen/src/regalloc" title="bytecodealliance/wasmtime">bytecodealliance/wasmtime</a></div><div class="message_embed_description">Standalone JIT-style runtime for WebAssembly, using Cranelift - bytecodealliance/wasmtime</div></div></div>



<a name="212922780"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/blog%20post%20on%20new%20backend/near/212922780" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Amanieu <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/blog.20post.20on.20new.20backend.html#212922780">(Oct 10 2020 at 16:18)</a>:</h4>
<p>As opposed to use the new backend that uses <a href="https://github.com/bytecodealliance/regalloc.rs">https://github.com/bytecodealliance/regalloc.rs</a> which is not SSA-based.</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/regalloc.rs" style="background-image: url(https://avatars0.githubusercontent.com/u/54038801?s=400&amp;v=4)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/regalloc.rs" title="bytecodealliance/regalloc.rs">bytecodealliance/regalloc.rs</a></div><div class="message_embed_description">Modular register allocator algorithms. Contribute to bytecodealliance/regalloc.rs development by creating an account on GitHub.</div></div></div>



<a name="212922795"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/blog%20post%20on%20new%20backend/near/212922795" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alyssa Rosenzweig <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/blog.20post.20on.20new.20backend.html#212922795">(Oct 10 2020 at 16:18)</a>:</h4>
<p>Looks like I have some "light" reading to do then. Thanks for the links!</p>



<a name="212923149"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/blog%20post%20on%20new%20backend/near/212923149" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alyssa Rosenzweig <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/blog.20post.20on.20new.20backend.html#212923149">(Oct 10 2020 at 16:27)</a>:</h4>
<p>There's also something to be said about register pressure / spills having more to do with scheduling than RA, for which the literature isn't quite there (at least on the GPU side). But I digress.</p>



<a name="212923974"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/blog%20post%20on%20new%20backend/near/212923974" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alyssa Rosenzweig <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/blog.20post.20on.20new.20backend.html#212923974">(Oct 10 2020 at 16:49)</a>:</h4>
<p><span class="user-mention" data-user-id="301625">@Amanieu</span> --Alright, reading through the first link has successfully (re)convinced me to let other people do out-of-SSA and do RA after, thanks</p>



<a name="212924027"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/blog%20post%20on%20new%20backend/near/212924027" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Amanieu <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/blog.20post.20on.20new.20backend.html#212924027">(Oct 10 2020 at 16:50)</a>:</h4>
<p>I'm curious, what in particular convinced you?</p>



<a name="212924118"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/blog%20post%20on%20new%20backend/near/212924118" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alyssa Rosenzweig <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/blog.20post.20on.20new.20backend.html#212924118">(Oct 10 2020 at 16:54)</a>:</h4>
<p>How many gotchas there are absolutely everywhere for real machines. Something I was prepared for, but underscored seeing a real production implementation.</p>



<a name="212924200"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/blog%20post%20on%20new%20backend/near/212924200" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alyssa Rosenzweig <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/blog.20post.20on.20new.20backend.html#212924200">(Oct 10 2020 at 16:55)</a>:</h4>
<p>I have a regalloc algorithm implemented in a few hundred lines of C, with excellent support for aliasing and precolouring. It can't claim to be optimal in any sense, but the order-of-magnitude difference in complexity is... noted.</p>



<a name="212924248"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/blog%20post%20on%20new%20backend/near/212924248" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alyssa Rosenzweig <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/blog.20post.20on.20new.20backend.html#212924248">(Oct 10 2020 at 16:56)</a>:</h4>
<p>(I admit that's an unfair comparison, since out-of-SSA is happening elsewhere with a sufficiently complicated algorithm, and the backend still drives that with its own support code. And liveness analysis is separate since it's used for DCE too. So maybe the gap isn't as aggressive as it looks.)</p>



<a name="212924463"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/blog%20post%20on%20new%20backend/near/212924463" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alyssa Rosenzweig <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/blog.20post.20on.20new.20backend.html#212924463">(Oct 10 2020 at 17:01)</a>:</h4>
<p>[Maybe the real takeaway is that RA is complicated no matter how you try to hide the complexity... and the cranelift implementations are just more honest about that <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span> ]</p>



<a name="212925363"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/blog%20post%20on%20new%20backend/near/212925363" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alyssa Rosenzweig <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/blog.20post.20on.20new.20backend.html#212925363">(Oct 10 2020 at 17:08)</a>:</h4>
<p>If nothing else - I appreciate seeing how production Rust compilers look like as  I [redacted]</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>