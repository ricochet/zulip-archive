<html>
<head><meta charset="utf-8"><title>✔ Testing New Optimizations · cranelift · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/index.html">cranelift</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/.E2.9C.94.20Testing.20New.20Optimizations.html">✔ Testing New Optimizations</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="491348698"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/%E2%9C%94%20Testing%20New%20Optimizations/near/491348698" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bongjun Jang <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/.E2.9C.94.20Testing.20New.20Optimizations.html#491348698">(Dec 31 2024 at 00:56)</a>:</h4>
<p>Thank you for your response!</p>



<a name="491348884"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/%E2%9C%94%20Testing%20New%20Optimizations/near/491348884" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bongjun Jang <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/.E2.9C.94.20Testing.20New.20Optimizations.html#491348884">(Dec 31 2024 at 00:58)</a>:</h4>
<p>One more thing) Is there a way to know which optimization is on/off? I want to know the progress of cranelift's optimization.</p>



<a name="491349058"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/%E2%9C%94%20Testing%20New%20Optimizations/near/491349058" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/.E2.9C.94.20Testing.20New.20Optimizations.html#491349058">(Dec 31 2024 at 01:00)</a>:</h4>
<p>Right now there is one main switch: the <code>opt_level</code> option is set either to <code>speed</code> or <code>none</code>, and that turns on/off the entire optimizer</p>



<a name="491349729"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/%E2%9C%94%20Testing%20New%20Optimizations/near/491349729" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bongjun Jang <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/.E2.9C.94.20Testing.20New.20Optimizations.html#491349729">(Dec 31 2024 at 01:10)</a>:</h4>
<p>Oh thank you. And how do I check if an optimization rule written in ISLE under <code>cranelift/codegen/src/opts/</code> is actually compiled down to cranelift compiler? I want to measure the number of rules that the ISLE compiler is accepting.</p>



<a name="491349756"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/%E2%9C%94%20Testing%20New%20Optimizations/near/491349756" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/.E2.9C.94.20Testing.20New.20Optimizations.html#491349756">(Dec 31 2024 at 01:10)</a>:</h4>
<p>All are included; the ISLE compiler doesn't have any notion of not "accepting" a rule</p>



<a name="491349768"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/%E2%9C%94%20Testing%20New%20Optimizations/near/491349768" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/.E2.9C.94.20Testing.20New.20Optimizations.html#491349768">(Dec 31 2024 at 01:11)</a>:</h4>
<p>(it does have type errors, but then the entire Cranelift build fails)</p>



<a name="491350001"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/%E2%9C%94%20Testing%20New%20Optimizations/near/491350001" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bongjun Jang <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/.E2.9C.94.20Testing.20New.20Optimizations.html#491350001">(Dec 31 2024 at 01:14)</a>:</h4>
<p><a href="https://github.com/bytecodealliance/wasmtime/blob/cb51a4f2137edb90b213d9f30d94b02797d45fc5/cranelift/codegen/src/opts/arithmetic.isle#L78-L82">https://github.com/bytecodealliance/wasmtime/blob/cb51a4f2137edb90b213d9f30d94b02797d45fc5/cranelift/codegen/src/opts/arithmetic.isle#L78-L82</a></p>
<p>So this rule is actually included in the islec-compiled compiler code, but the generated compiler is not optimizing my program. Am I correct?</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wasmtime/blob/cb51a4f2137edb90b213d9f30d94b02797d45fc5/cranelift/codegen/src/opts/arithmetic.isle#L78-L82" style="background-image: url(&quot;https://uploads.zulipusercontent.net/d68c0734deae36ff949fb1c91961090d00ff8b48/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f656364396165383364383736326562333931313265303061636562643265373037353263623561663134326464326563373966626463313732383033386537332f62797465636f6465616c6c69616e63652f7761736d74696d65&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wasmtime/blob/cb51a4f2137edb90b213d9f30d94b02797d45fc5/cranelift/codegen/src/opts/arithmetic.isle#L78-L82" title="wasmtime/cranelift/codegen/src/opts/arithmetic.isle at cb51a4f2137edb90b213d9f30d94b02797d45fc5 · bytecodealliance/wasmtime">wasmtime/cranelift/codegen/src/opts/arithmetic.isle at cb51a4f2137edb90b213d9f30d94b02797d45fc5 · bytecodealliance/wasmtime</a></div><div class="message_embed_description">A lightweight WebAssembly runtime that is fast, secure, and standards-compliant - bytecodealliance/wasmtime</div></div></div>



<a name="491350391"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/%E2%9C%94%20Testing%20New%20Optimizations/near/491350391" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/.E2.9C.94.20Testing.20New.20Optimizations.html#491350391">(Dec 31 2024 at 01:19)</a>:</h4>
<p>Ah, yes, there is some subtlety here. I took "included" to mean that the rule is compiled and included in Cranelift. That rule is indeed included in Cranelift. However the entry point for rule execution is not invoked on trapping operators, for the reasons given in that issue above.</p>



<a name="491350439"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/%E2%9C%94%20Testing%20New%20Optimizations/near/491350439" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/.E2.9C.94.20Testing.20New.20Optimizations.html#491350439">(Dec 31 2024 at 01:20)</a>:</h4>
<p>So the rule is "included" but never executed</p>



<a name="491350477"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/%E2%9C%94%20Testing%20New%20Optimizations/near/491350477" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/.E2.9C.94.20Testing.20New.20Optimizations.html#491350477">(Dec 31 2024 at 01:20)</a>:</h4>
<p>I suppose it's some future-proofing? I'm not sure why we included it otherwise</p>



<a name="491350582"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/%E2%9C%94%20Testing%20New%20Optimizations/near/491350582" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bongjun Jang <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/.E2.9C.94.20Testing.20New.20Optimizations.html#491350582">(Dec 31 2024 at 01:22)</a>:</h4>
<p>Thank you. I think now it is clear to me. Have a good rest of your day!</p>



<a name="491350597"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/%E2%9C%94%20Testing%20New%20Optimizations/near/491350597" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/.E2.9C.94.20Testing.20New.20Optimizations.html#491350597">(Dec 31 2024 at 01:22)</a>:</h4>
<p><span class="user-mention silent" data-user-id="815101">Bongjun Jang</span> has marked this topic as resolved.</p>



<a name="491350613"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/%E2%9C%94%20Testing%20New%20Optimizations/near/491350613" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/.E2.9C.94.20Testing.20New.20Optimizations.html#491350613">(Dec 31 2024 at 01:22)</a>:</h4>
<p>No problem, you as well!</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>