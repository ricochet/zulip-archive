<html>
<head><meta charset="utf-8"><title>Cranelift egraphs in action · cranelift · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/index.html">cranelift</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/Cranelift.20egraphs.20in.20action.html">Cranelift egraphs in action</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="446999232"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/Cranelift%20egraphs%20in%20action/near/446999232" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/Cranelift.20egraphs.20in.20action.html#446999232">(Jun 25 2024 at 21:16)</a>:</h4>
<p>I stumbled across <a href="https://github.com/tkaitchuck/aHash/issues/222">https://github.com/tkaitchuck/aHash/issues/222</a> today and using Afonso's freshly-added support to the compiler explorer whipped up <a href="https://godbolt.org/z/j6YEv81MM">https://godbolt.org/z/j6YEv81MM</a> to show how cranelift's doing quite a good job relative native by eating through all the swap_bytes expansions that llvm inserts</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/tkaitchuck/aHash/issues/222" style="background-image: url(&quot;https://uploads.zulipusercontent.net/d95ef5dce40d4605ed221f64b1e1e76f0b54589a/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f366263376239613863373961323137346232666332313863353138666135666439636237333961356138616432633236646531646536396131343532626437342f746b616974636875636b2f61486173682f6973737565732f323232&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/tkaitchuck/aHash/issues/222" title="Work around `swap_bytes` on WebAssembly · Issue #222 · tkaitchuck/aHash">Work around `swap_bytes` on WebAssembly · Issue #222 · tkaitchuck/aHash</a></div><div class="message_embed_description">Unfortunately neither u128 nor swap_bytes are supported directly by WebAssembly. So both implementations of folded_multiply are very slow. I think an algorithm that takes both u64 values, turns the...</div></div></div><div class="message_embed"><a class="message_embed_image" href="https://godbolt.org/z/j6YEv81MM" style="background-image: url(&quot;https://uploads.zulipusercontent.net/4bf336f7597f851df0732b12f8d4b7b383508ec8/68747470733a2f2f6769746875622e636f6d2f636f6d70696c65722d6578706c6f7265722f696e6672612f626c6f622f6d61696e2f6c6f676f2f66617669636f6e2e706e673f7261773d74727565&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://godbolt.org/z/j6YEv81MM" title="Compiler Explorer">Compiler Explorer</a></div><div class="message_embed_description">Compiler Explorer is an interactive online compiler which shows the assembly output of compiled C++, Rust, Go (and many more) code.</div></div></div>



<a name="446999253"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/Cranelift%20egraphs%20in%20action/near/446999253" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/Cranelift.20egraphs.20in.20action.html#446999253">(Jun 25 2024 at 21:16)</a>:</h4>
<p>just figured it was neat and wanted to share</p>



<a name="446999661"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/Cranelift%20egraphs%20in%20action/near/446999661" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Afonso Bordado <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/Cranelift.20egraphs.20in.20action.html#446999661">(Jun 25 2024 at 21:18)</a>:</h4>
<p>Super neat being able to see all of this in a single screen!</p>



<a name="447000847"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/Cranelift%20egraphs%20in%20action/near/447000847" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> fitzgen (he/him) <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/Cranelift.20egraphs.20in.20action.html#447000847">(Jun 25 2024 at 21:24)</a>:</h4>
<p>nice :)</p>



<a name="468568066"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/Cranelift%20egraphs%20in%20action/near/468568066" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Till Schneidereit <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/Cranelift.20egraphs.20in.20action.html#468568066">(Sep 08 2024 at 13:35)</a>:</h4>
<p>I completely randomly stumbled upon this just now, and then additionally stumbled upon the fact that the Wasmtime output is pretty different with Wasmtime 22—the latest version available on Godbolt: <a href="https://godbolt.org/z/3W8j8MG9n">https://godbolt.org/z/3W8j8MG9n</a></p>
<p>It looks like maybe that's just a matter of more details being printed? I have no idea where the <code>wasm_to_array_trampoline</code> comes from, though</p>
<div class="message_embed"><a class="message_embed_image" href="https://godbolt.org/z/3W8j8MG9n" style="background-image: url(&quot;https://uploads.zulipusercontent.net/4bf336f7597f851df0732b12f8d4b7b383508ec8/68747470733a2f2f6769746875622e636f6d2f636f6d70696c65722d6578706c6f7265722f696e6672612f626c6f622f6d61696e2f6c6f676f2f66617669636f6e2e706e673f7261773d74727565&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://godbolt.org/z/3W8j8MG9n" title="Compiler Explorer">Compiler Explorer</a></div><div class="message_embed_description">Compiler Explorer is an interactive online compiler which shows the assembly output of compiled C++, Rust, Go (and many more) code.</div></div></div>



<a name="468585907"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/Cranelift%20egraphs%20in%20action/near/468585907" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Afonso Bordado <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/Cranelift.20egraphs.20in.20action.html#468585907">(Sep 08 2024 at 15:26)</a>:</h4>
<blockquote>
<p>I have no idea where the <code>wasm_to_array_trampoline</code> comes from, though</p>
</blockquote>
<p>Oh, when we compile wasm in godbolt we compile it into a binary and then dissasemble it. We then filter out some of the trampoline functions that wasmtime includes in the binary, that must be broken somehow.</p>



<a name="468774767"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/Cranelift%20egraphs%20in%20action/near/468774767" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Till Schneidereit <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/Cranelift.20egraphs.20in.20action.html#468774767">(Sep 09 2024 at 12:15)</a>:</h4>
<p>ah, that makes sense—thank you!</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>