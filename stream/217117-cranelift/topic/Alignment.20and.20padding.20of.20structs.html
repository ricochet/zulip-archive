<html>
<head><meta charset="utf-8"><title>Alignment and padding of structs · cranelift · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/index.html">cranelift</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/Alignment.20and.20padding.20of.20structs.html">Alignment and padding of structs</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="409661193"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/Alignment%20and%20padding%20of%20structs/near/409661193" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yorick Peterse <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/Alignment.20and.20padding.20of.20structs.html#409661193">(Dec 23 2023 at 00:32)</a>:</h4>
<p>In LLVM there are routines to get the bit size of a type while taking padding and what not into account. I'm using this to figure out if a returned structure needs to use a regular return or a struct return.</p>
<p>Looking at the Cranelift documentation it seems it doesn't offer anything for this (in part because structures aren't really a thing in the IR). Am I correct in this?</p>



<a name="409661243"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/Alignment%20and%20padding%20of%20structs/near/409661243" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yorick Peterse <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/Alignment.20and.20padding.20of.20structs.html#409661243">(Dec 23 2023 at 00:32)</a>:</h4>
<p>Implementing this myself isn't too hard, but it would be nice if I don't have to repeat something already done by others <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="409664513"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/Alignment%20and%20padding%20of%20structs/near/409664513" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/Alignment.20and.20padding.20of.20structs.html#409664513">(Dec 23 2023 at 00:55)</a>:</h4>
<p>That’s correct, Cranelift has no aggregate types; it’s up to you to compute struct layout and derive pointers appropriately</p>



<a name="409665020"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/Alignment%20and%20padding%20of%20structs/near/409665020" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yorick Peterse <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/Alignment.20and.20padding.20of.20structs.html#409665020">(Dec 23 2023 at 00:59)</a>:</h4>
<p>Gotcha <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="411070557"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/Alignment%20and%20padding%20of%20structs/near/411070557" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/Alignment.20and.20padding.20of.20structs.html#411070557">(Jan 03 2024 at 19:43)</a>:</h4>
<p>You could try using <a href="https://doc.rust-lang.org/std/alloc/struct.Layout.html#method.extend">https://doc.rust-lang.org/std/alloc/struct.Layout.html#method.extend</a> for it, but as you say it's not that hard so whether it'd be worth it isn't necessarily obvious.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>