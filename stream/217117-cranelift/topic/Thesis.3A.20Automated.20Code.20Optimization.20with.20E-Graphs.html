<html>
<head><meta charset="utf-8"><title>Thesis: Automated Code Optimization with E-Graphs · cranelift · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/index.html">cranelift</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/Thesis.3A.20Automated.20Code.20Optimization.20with.20E-Graphs.html">Thesis: Automated Code Optimization with E-Graphs</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="266693295"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/Thesis%3A%20Automated%20Code%20Optimization%20with%20E-Graphs/near/266693295" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/Thesis.3A.20Automated.20Code.20Optimization.20with.20E-Graphs.html#266693295">(Jan 03 2022 at 14:42)</a>:</h4>
<p>This thesis was just linked on hacker news: <a href="https://arxiv.org/abs/2112.14714">https://arxiv.org/abs/2112.14714</a> Would it be possible to apply it to cranelift once the rewrite to isle is done?</p>



<a name="266712390"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/Thesis%3A%20Automated%20Code%20Optimization%20with%20E-Graphs/near/266712390" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/Thesis.3A.20Automated.20Code.20Optimization.20with.20E-Graphs.html#266712390">(Jan 03 2022 at 17:25)</a>:</h4>
<p>@bjorn3 there's been a little discussion around e-graphs, e.g. as they're used (via the <code>egg</code> implementation) in wasm-mutate. I think it's a really cool data structure and could be useful; my main concern when I looked at it most recently was whether there was an efficient way to drive rule application beyond "try all rewrite rules in turn"</p>



<a name="266712628"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/Thesis%3A%20Automated%20Code%20Optimization%20with%20E-Graphs/near/266712628" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/Thesis.3A.20Automated.20Code.20Optimization.20with.20E-Graphs.html#266712628">(Jan 03 2022 at 17:26)</a>:</h4>
<p>in principle if one could build a framework/compiler that makes use of ISLE-style rewrite rules to generate an efficient rewrite pass, I think it could be useful</p>



<a name="266712742"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/Thesis%3A%20Automated%20Code%20Optimization%20with%20E-Graphs/near/266712742" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/Thesis.3A.20Automated.20Code.20Optimization.20with.20E-Graphs.html#266712742">(Jan 03 2022 at 17:27)</a>:</h4>
<p>in particular there's a nice alignment between ISLE's idea of an input graph with multiple possible matches per value (via programmable extractors) and an e-graph's idea of multiple nodes in an equivalence class</p>



<a name="266712773"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/Thesis%3A%20Automated%20Code%20Optimization%20with%20E-Graphs/near/266712773" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/Thesis.3A.20Automated.20Code.20Optimization.20with.20E-Graphs.html#266712773">(Jan 03 2022 at 17:27)</a>:</h4>
<p>Maybe it could be used only when runtime performance is more important than compile times like I would guess it is for Fastly?</p>



<a name="266712854"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/Thesis%3A%20Automated%20Code%20Optimization%20with%20E-Graphs/near/266712854" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/Thesis.3A.20Automated.20Code.20Optimization.20with.20E-Graphs.html#266712854">(Jan 03 2022 at 17:28)</a>:</h4>
<p>right, it could be a good way to build a more optimizing middle-end</p>



<a name="266717107"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/Thesis%3A%20Automated%20Code%20Optimization%20with%20E-Graphs/near/266717107" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> McCoy <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/Thesis.3A.20Automated.20Code.20Optimization.20with.20E-Graphs.html#266717107">(Jan 03 2022 at 18:01)</a>:</h4>
<p>in Julia land, I think this sort of rewrite-driven optimization stuff is aimed at middle layer opts -- not necessarily register allocation.</p>



<a name="266717485"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/Thesis%3A%20Automated%20Code%20Optimization%20with%20E-Graphs/near/266717485" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> McCoy <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/Thesis.3A.20Automated.20Code.20Optimization.20with.20E-Graphs.html#266717485">(Jan 03 2022 at 18:04)</a>:</h4>
<p>I don't quite understand the scope of ISLE tho, so maybe this is right in the ballpark</p>



<a name="266717710"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/Thesis%3A%20Automated%20Code%20Optimization%20with%20E-Graphs/near/266717710" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/Thesis.3A.20Automated.20Code.20Optimization.20with.20E-Graphs.html#266717710">(Jan 03 2022 at 18:06)</a>:</h4>
<p>ISLE happens just before register allocation. It basically translates from clif ir to machine specific vcode which has a roughly 1-to-1 correspondence with machine instructions. This vcode is then register allocated and finally emitted to raw bytes (and performing jump threading in the process of emitting).</p>



<a name="266717845"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/Thesis%3A%20Automated%20Code%20Optimization%20with%20E-Graphs/near/266717845" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/Thesis.3A.20Automated.20Code.20Optimization.20with.20E-Graphs.html#266717845">(Jan 03 2022 at 18:07)</a>:</h4>
<p>Most peephole optimizations happen in a single pass during lowering from clif ir to vcode.</p>



<a name="266718055"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/Thesis%3A%20Automated%20Code%20Optimization%20with%20E-Graphs/near/266718055" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/Thesis.3A.20Automated.20Code.20Optimization.20with.20E-Graphs.html#266718055">(Jan 03 2022 at 18:09)</a>:</h4>
<p>This is the list of all optimizations that are performed: <a href="https://github.com/bytecodealliance/wasmtime/blob/3eb82f1d8ee95c3c372d8b119d09c1560fcef307/cranelift/codegen/src/context.rs#L135-L176">https://github.com/bytecodealliance/wasmtime/blob/3eb82f1d8ee95c3c372d8b119d09c1560fcef307/cranelift/codegen/src/context.rs#L135-L176</a> All architecture dependent things happen during the <code>backend.compile_function()</code> call at <a href="https://github.com/bytecodealliance/wasmtime/blob/3eb82f1d8ee95c3c372d8b119d09c1560fcef307/cranelift/codegen/src/context.rs#L172">https://github.com/bytecodealliance/wasmtime/blob/3eb82f1d8ee95c3c372d8b119d09c1560fcef307/cranelift/codegen/src/context.rs#L172</a>. That is everything starting from the clif ir to vcode lowering through ISLE.</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wasmtime/blob/3eb82f1d8ee95c3c372d8b119d09c1560fcef307/cranelift/codegen/src/context.rs#L135-L176" style="background-image: url(https\:\/\/uploads\.zulipusercontent\.net\/7ccce5c0c3163ac49ffebd53c9249f57044f7ea3\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f343935316266316662323939353037653938653164313534373133386330333636643466396163633332323132633536663630306665316163653530653236642f62797465636f6465616c6c69616e63652f7761736d74696d65)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wasmtime/blob/3eb82f1d8ee95c3c372d8b119d09c1560fcef307/cranelift/codegen/src/context.rs#L135-L176" title="wasmtime/context.rs at 3eb82f1d8ee95c3c372d8b119d09c1560fcef307 · bytecodealliance/wasmtime">wasmtime/context.rs at 3eb82f1d8ee95c3c372d8b119d09c1560fcef307 · bytecodealliance/wasmtime</a></div><div class="message_embed_description">Standalone JIT-style runtime for WebAssembly, using Cranelift - wasmtime/context.rs at 3eb82f1d8ee95c3c372d8b119d09c1560fcef307 · bytecodealliance/wasmtime</div></div></div><div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wasmtime/blob/3eb82f1d8ee95c3c372d8b119d09c1560fcef307/cranelift/codegen/src/context.rs#L172" style="background-image: url(https\:\/\/uploads\.zulipusercontent\.net\/7ccce5c0c3163ac49ffebd53c9249f57044f7ea3\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f343935316266316662323939353037653938653164313534373133386330333636643466396163633332323132633536663630306665316163653530653236642f62797465636f6465616c6c69616e63652f7761736d74696d65)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wasmtime/blob/3eb82f1d8ee95c3c372d8b119d09c1560fcef307/cranelift/codegen/src/context.rs#L172" title="wasmtime/context.rs at 3eb82f1d8ee95c3c372d8b119d09c1560fcef307 · bytecodealliance/wasmtime">wasmtime/context.rs at 3eb82f1d8ee95c3c372d8b119d09c1560fcef307 · bytecodealliance/wasmtime</a></div><div class="message_embed_description">Standalone JIT-style runtime for WebAssembly, using Cranelift - wasmtime/context.rs at 3eb82f1d8ee95c3c372d8b119d09c1560fcef307 · bytecodealliance/wasmtime</div></div></div>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>