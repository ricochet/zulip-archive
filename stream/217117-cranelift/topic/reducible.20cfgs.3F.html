<html>
<head><meta charset="utf-8"><title>reducible cfgs? · cranelift · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/index.html">cranelift</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/reducible.20cfgs.3F.html">reducible cfgs?</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="264158761"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/reducible%20cfgs%3F/near/264158761" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/reducible.20cfgs.3F.html#264158761">(Dec 08 2021 at 14:01)</a>:</h4>
<p>Hello people!  Quick question -- does cranelift require reducible control-flow graphs?</p>



<a name="264163150"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/reducible%20cfgs%3F/near/264163150" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/reducible.20cfgs.3F.html#264163150">(Dec 08 2021 at 14:35)</a>:</h4>
<p>Cranelift doesn't require it.</p>



<a name="264163747"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/reducible%20cfgs%3F/near/264163747" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/reducible.20cfgs.3F.html#264163747">(Dec 08 2021 at 14:39)</a>:</h4>
<p>cool, tx.  (also how do you know?  wasm graphs won't contain these initially; you can only get them after jump threading or such...)</p>



<a name="264163883"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/reducible%20cfgs%3F/near/264163883" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/reducible.20cfgs.3F.html#264163883">(Dec 08 2021 at 14:40)</a>:</h4>
<p>context is i was thinking of having a poke at funclets or similar idioms</p>



<a name="264164001"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/reducible%20cfgs%3F/near/264164001" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/reducible.20cfgs.3F.html#264164001">(Dec 08 2021 at 14:41)</a>:</h4>
<p>rustc_codegen_cranelift doesn't turn potentially irreducable control flow from rustc MIR into reducable control flow when generating cranelift ir</p>



<a name="264164040"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/reducible%20cfgs%3F/near/264164040" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/reducible.20cfgs.3F.html#264164040">(Dec 08 2021 at 14:41)</a>:</h4>
<p>I never got any issues from this.</p>



<a name="264164134"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/reducible%20cfgs%3F/near/264164134" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/reducible.20cfgs.3F.html#264164134">(Dec 08 2021 at 14:42)</a>:</h4>
<p><span class="user-mention silent" data-user-id="396878">Andy Wingo</span> <a href="#narrow/stream/217117-cranelift/topic/reducible.20cfgs.3F/near/264163883">said</a>:</p>
<blockquote>
<p>context is i was thinking of having a poke at funclets or similar idioms</p>
</blockquote>
<p>that isn't supported by cranelift ir yet</p>



<a name="264164418"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/reducible%20cfgs%3F/near/264164418" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/reducible.20cfgs.3F.html#264164418">(Dec 08 2021 at 14:44)</a>:</h4>
<p>that's why i was thinking of having a poke at it</p>



<a name="264164677"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/reducible%20cfgs%3F/near/264164677" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/reducible.20cfgs.3F.html#264164677">(Dec 08 2021 at 14:46)</a>:</h4>
<p>Have you seen <a href="https://github.com/bytecodealliance/wasmtime/issues/3427">https://github.com/bytecodealliance/wasmtime/issues/3427</a>, <a href="https://github.com/bytecodealliance/wasmtime/issues/2049">https://github.com/bytecodealliance/wasmtime/issues/2049</a> and <a href="https://github.com/bytecodealliance/wasmtime/issues/1677">https://github.com/bytecodealliance/wasmtime/issues/1677</a>?</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wasmtime/issues/3427" style="background-image: url(https\:\/\/uploads\.zulipusercontent\.net\/f62ba6fa3ffe804a748a154d453ef6a557527ed5\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f343037653835626162323730613961616630353135376430613435643731656438313534386366626131316334326563666264663430633261306530336231652f62797465636f6465616c6c69616e63652f7761736d74696d652f6973737565732f33343237)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wasmtime/issues/3427" title="Implementation strategy for the Exception Handling proposal · Issue #3427 · bytecodealliance/wasmtime">Implementation strategy for the Exception Handling proposal · Issue #3427 · bytecodealliance/wasmtime</a></div><div class="message_embed_description">I&#39;ve been interested in having the Exception Handling proposal supported in Wasmtime, so I looked into possible ways to implement it. There&#39;s been some prior discussion in issues #2049 and ...</div></div></div><div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wasmtime/issues/2049" style="background-image: url(https\:\/\/uploads\.zulipusercontent\.net\/0176966dfd310e4e1875d0d038ae4ccc1b57b570\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f363264613861646664353739633137353663636238623439353764643462636366343333316336373836343537633361333565656635363766616638356638652f62797465636f6465616c6c69616e63652f7761736d74696d652f6973737565732f32303439)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wasmtime/issues/2049" title="Exception support · Issue #2049 · bytecodealliance/wasmtime">Exception support · Issue #2049 · bytecodealliance/wasmtime</a></div><div class="message_embed_description">Feature Cranelift currently doesn&#39;t support SEH (but has some support for finally I think). This is a feature request to support properly exception (landingpads on Posix, SEH on windows, maybe ...</div></div></div><div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wasmtime/issues/1677" style="background-image: url(https\:\/\/uploads\.zulipusercontent\.net\/41ddd7181cb63424b1c7f787e3be4db4dfc20753\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f306161303238316135663333336237316131626337656233666438316366626331343036633636336231306434313932343132393030383639316134363134662f62797465636f6465616c6c69616e63652f7761736d74696d652f6973737565732f31363737)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wasmtime/issues/1677" title="Support cleanup during unwinding · Issue #1677 · bytecodealliance/wasmtime">Support cleanup during unwinding · Issue #1677 · bytecodealliance/wasmtime</a></div><div class="message_embed_description">Feature Currently the generated unwinding information only restores registers. This issue proposes to make it possible to also run cleanup actions like running destructors during unwinding. Benefit...</div></div></div>



<a name="264164941"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/reducible%20cfgs%3F/near/264164941" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Wingo <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/reducible.20cfgs.3F.html#264164941">(Dec 08 2021 at 14:48)</a>:</h4>
<p>no i had not, thank you for those pointers!</p>



<a name="264165264"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/reducible%20cfgs%3F/near/264165264" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/reducible.20cfgs.3F.html#264165264">(Dec 08 2021 at 14:50)</a>:</h4>
<p><a href="https://github.com/bjorn3/wasmtime/tree/eh_cleanup">https://github.com/bjorn3/wasmtime/tree/eh_cleanup</a> was an experiment of mine for implementing it. Never finished it though.</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bjorn3/wasmtime/tree/eh_cleanup" style="background-image: url(https\:\/\/uploads\.zulipusercontent\.net\/53094f6bfcece4e9efa6445fe7e0badb2e765b4b\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f306139316466376666313630623833363165613261346632303033613634363265643038343530383838306666313936626639313535396639376264333535382f626a6f726e332f7761736d74696d65)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bjorn3/wasmtime/tree/eh_cleanup" title="GitHub - bjorn3/wasmtime at eh_cleanup">GitHub - bjorn3/wasmtime at eh_cleanup</a></div><div class="message_embed_description">Standalone JIT-style runtime for WebAssembly, using Cranelift - GitHub - bjorn3/wasmtime at eh_cleanup</div></div></div>



<a name="264183077"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/reducible%20cfgs%3F/near/264183077" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/reducible.20cfgs.3F.html#264183077">(Dec 08 2021 at 16:44)</a>:</h4>
<p><span class="user-mention" data-user-id="396878">@Andy Wingo</span> to add some confirmation here, the backend parts (regalloc, cfg lowering to branches) were explicitly designed to handle irreducible control flow, and if there's something that breaks with it, I'd consider it a bug; happy to jump on any issues that arise!</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>