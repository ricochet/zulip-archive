<html>
<head><meta charset="utf-8"><title>testcompiler · cranelift · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/index.html">cranelift</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/testcompiler.html">testcompiler</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="197649451"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/testcompiler/near/197649451" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Carlo Kok <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/testcompiler.html#197649451">(May 15 2020 at 05:23)</a>:</h4>
<p>Is there some test compiler that uses cranelift as a backend? Looking to see what it creates for what kind of instructions.</p>



<a name="197649519"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/testcompiler/near/197649519" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Carlo Kok <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/testcompiler.html#197649519">(May 15 2020 at 05:25)</a>:</h4>
<p>In my current case I'm trying to find out the use of vars in frontend. I'm using declare_var to create a new variable, and def_var to define it the first time, I'm using use_var's result to read it, but how to I change the value of a var ?</p>



<a name="197649572"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/testcompiler/near/197649572" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Carlo Kok <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/testcompiler.html#197649572">(May 15 2020 at 05:26)</a>:</h4>
<p>alternatively, can I use stackslots instead and does cranelift optimize those to ssa form?</p>



<a name="197672453"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/testcompiler/near/197672453" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/testcompiler.html#197672453">(May 15 2020 at 10:24)</a>:</h4>
<p>You need to use <code>def_var</code> every time you want to set a new value.</p>



<a name="197672473"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/testcompiler/near/197672473" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/testcompiler.html#197672473">(May 15 2020 at 10:25)</a>:</h4>
<p>Stackslots are not optimized to SSA form.</p>



<a name="197672758"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/testcompiler/near/197672758" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/testcompiler.html#197672758">(May 15 2020 at 10:28)</a>:</h4>
<p><span class="user-mention silent" data-user-id="295546">Carlo Kok</span> <a href="#narrow/stream/217117-cranelift/topic/testcompiler/near/197649451">said</a>:</p>
<blockquote>
<p>Is there some test compiler that uses cranelift as a backend? Looking to see what it creates for what kind of instructions.</p>
</blockquote>
<p>You can take a look at <a href="https://github.com/bytecodealliance/simplejit-demo">https://github.com/bytecodealliance/simplejit-demo</a> and <a href="https://github.com/CraneStation/kaleidoscope-cranelift">https://github.com/CraneStation/kaleidoscope-cranelift</a>, which are made for learning purposes. If you want to see the wasm compilation part, you can look at <code>cranelift-wasm</code> (the <code>cranelift/wasm</code> dir of the <code>wasmtime</code> repo). <a href="https://github.com/jyn514/rcc">https://github.com/jyn514/rcc</a> is a C compiler. <a href="https://github.com/bjorn3/rustc_codegen_cranelift">https://github.com/bjorn3/rustc_codegen_cranelift</a> is a Rust backend I made.</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/simplejit-demo" style="background-image: url(https://avatars0.githubusercontent.com/u/54038801?s=400&amp;v=4)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/simplejit-demo" title="bytecodealliance/simplejit-demo">bytecodealliance/simplejit-demo</a></div><div class="message_embed_description">JIT compiler and runtime for a toy language, using Cranelift - bytecodealliance/simplejit-demo</div></div></div><div class="message_embed"><a class="message_embed_image" href="https://github.com/CraneStation/kaleidoscope-cranelift" style="background-image: url(https://avatars0.githubusercontent.com/u/11573910?s=400&amp;v=4)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/CraneStation/kaleidoscope-cranelift" title="CraneStation/kaleidoscope-cranelift">CraneStation/kaleidoscope-cranelift</a></div><div class="message_embed_description">Tutorial to learn to use the cranelift compiler backend - CraneStation/kaleidoscope-cranelift</div></div></div><div class="message_embed"><a class="message_embed_image" href="https://github.com/jyn514/rcc" style="background-image: url(https://repository-images.githubusercontent.com/190940981/65269b00-1884-11ea-9f37-728b9bc6973f)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/jyn514/rcc" title="jyn514/rcc">jyn514/rcc</a></div><div class="message_embed_description">rcc: a Rust C compiler. Contribute to jyn514/rcc development by creating an account on GitHub.</div></div></div><div class="message_embed"><a class="message_embed_image" href="https://github.com/bjorn3/rustc_codegen_cranelift" style="background-image: url(https://avatars0.githubusercontent.com/u/17426603?s=400&amp;v=4)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bjorn3/rustc_codegen_cranelift" title="bjorn3/rustc_codegen_cranelift">bjorn3/rustc_codegen_cranelift</a></div><div class="message_embed_description">Cranelift backend for rustc. Contribute to bjorn3/rustc_codegen_cranelift development by creating an account on GitHub.</div></div></div>



<a name="197674971"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/testcompiler/near/197674971" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Carlo Kok <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/testcompiler.html#197674971">(May 15 2020 at 10:56)</a>:</h4>
<p>so def_var is block tied? Thanks!</p>



<a name="197674976"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/testcompiler/near/197674976" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Carlo Kok <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/testcompiler.html#197674976">(May 15 2020 at 10:56)</a>:</h4>
<p>that helped a lot.</p>



<a name="197675457"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/testcompiler/near/197675457" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Carlo Kok <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/testcompiler.html#197675457">(May 15 2020 at 11:02)</a>:</h4>
<p>rcc is perfect; that will let me see what to generate (I did the same when using llvm, see what clang does)</p>



<a name="197738367"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/testcompiler/near/197738367" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Carlo Kok <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/testcompiler.html#197738367">(May 15 2020 at 19:07)</a>:</h4>
<p>Is there any way to dump the before optimization and after optimization ir ?</p>



<a name="197741635"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/testcompiler/near/197741635" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/testcompiler.html#197741635">(May 15 2020 at 19:24)</a>:</h4>
<p>You can use <code>println!("{}", func);</code> or <code>cranelift_codegen::write::write_function</code>. For the after optimization ir, as of right now the x86 backend just transforms the clif ir in several ways, while keeping it clif ir. This means that you can just take the <code>context.func</code> after compilation and print it, preferably using <code>write_function</code>.</p>



<a name="197741721"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/testcompiler/near/197741721" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/testcompiler.html#197741721">(May 15 2020 at 19:25)</a>:</h4>
<p>The AArch64 backend and the future x86 backend use an extra layer, for which you need to set <code>context.want_disasm</code> to true and then after compilation access <code>context.mach_compile_result</code>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>