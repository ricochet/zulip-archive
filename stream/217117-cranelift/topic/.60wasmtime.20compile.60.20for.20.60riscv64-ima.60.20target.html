<html>
<head><meta charset="utf-8"><title>`wasmtime compile` for `riscv64-ima` target · cranelift · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/index.html">cranelift</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/.60wasmtime.20compile.60.20for.20.60riscv64-ima.60.20target.html">`wasmtime compile` for `riscv64-ima` target</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="483642712"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/%60wasmtime%20compile%60%20for%20%60riscv64-ima%60%20target/near/483642712" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Borg (aborg-dev) <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/.60wasmtime.20compile.60.20for.20.60riscv64-ima.60.20target.html#483642712">(Nov 21 2024 at 08:47)</a>:</h4>
<p>Hey folks!</p>
<p>I've been experimenting with <code>wasmtime compile</code> to AOT-compile WASM modules for the RISC-V target.</p>
<p>Specifically, I'm interested in <code>riscv64-ima</code> (note no "C" extension for compressed instructions).</p>
<p>I was able to successfully compile code with:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">cargo</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">--</span><span class="n">bin</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="o">--</span><span class="n">features</span><span class="w"> </span><span class="n">all</span><span class="o">-</span><span class="n">arch</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="n">compile</span><span class="w"> </span><span class="o">--</span><span class="n">target</span><span class="w"> </span><span class="n">riscv64</span><span class="w"> </span><span class="n">fibonacci</span><span class="p">.</span><span class="n">wasm</span>
</code></pre></div>
<p>Unfortunately it does contain compressed (16 bit) instructions in some functions, e.g. ones related to <code>type_id</code>: <a href="https://gist.github.com/aborg-dev/55e5d6999122763be79d2957374524b2">gist</a>.</p>
<p>I tried some hackery to disable the compressed instructions on the backend level by removing <code>try_emit_compressed</code> in riscv64/inst/emit.rs but that didn't have any effect on the generated bytecode for the functions above.</p>
<p>Is there any hope I can achieve this with low effort (I'm contemplating an alternative of implementing +C extension in our RISC-V interpreter which will probably take a week or two)? I'm fine with hacky one-off solutions as only need this to do some prototype measurements.</p>
<p>Thanks!</p>
<div class="message_embed"><a class="message_embed_image" href="https://gist.github.com/aborg-dev/55e5d6999122763be79d2957374524b2" style="background-image: url(&quot;https://uploads.zulipusercontent.net/91f9baed8f4fc08c462d1a4de5a8c23942d45e97/68747470733a2f2f6769746875622e6769746875626173736574732e636f6d2f6173736574732f676973742d6f672d696d6167652d3534666437646330373133652e706e67&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://gist.github.com/aborg-dev/55e5d6999122763be79d2957374524b2" title="Cranelift Compile result">Cranelift Compile result</a></div><div class="message_embed_description">Cranelift Compile result. GitHub Gist: instantly share code, notes, and snippets.</div></div></div>



<a name="483642990"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/%60wasmtime%20compile%60%20for%20%60riscv64-ima%60%20target/near/483642990" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Afonso Bordado <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/.60wasmtime.20compile.60.20for.20.60riscv64-ima.60.20target.html#483642990">(Nov 21 2024 at 08:48)</a>:</h4>
<p>Hey, by default we target <code>riscv64gc</code>, but you should be able to disable compressed extensions by specifying the <code>has_c=false</code> flag</p>



<a name="483643118"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/%60wasmtime%20compile%60%20for%20%60riscv64-ima%60%20target/near/483643118" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Afonso Bordado <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/.60wasmtime.20compile.60.20for.20.60riscv64-ima.60.20target.html#483643118">(Nov 21 2024 at 08:49)</a>:</h4>
<p>I don't know exactly the wasmtime flag for that, I rememeber it used to be something along the lines of <code>--cranelift-flag ...</code>, but not quite sure</p>



<a name="483644006"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/%60wasmtime%20compile%60%20for%20%60riscv64-ima%60%20target/near/483644006" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Afonso Bordado <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/.60wasmtime.20compile.60.20for.20.60riscv64-ima.60.20target.html#483644006">(Nov 21 2024 at 08:55)</a>:</h4>
<p>Okay, looking at the code you should be using <code>-Ccranelift-has_zca=false -Ccranelift-has_zcd=false</code>. We do have <code>has_c</code> which is defined as a combination of those two flags, but for some reason the wasmtime cli isn't recognizing that</p>



<a name="483653885"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/%60wasmtime%20compile%60%20for%20%60riscv64-ima%60%20target/near/483653885" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Borg (aborg-dev) <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/.60wasmtime.20compile.60.20for.20.60riscv64-ima.60.20target.html#483653885">(Nov 21 2024 at 09:48)</a>:</h4>
<p><span class="user-mention" data-user-id="410955">@Afonso Bordado</span> , thank you! I was trying to tweak these flags in the code, bug passing them through CLI is much nicer.</p>
<p>As it stands though, I don't see any effect when disabling them, they seemed to be off already. Specifically, here is the experiment that I've tried:</p>
<ol>
<li>Patch this code <a href="https://github.com/aborg-dev/wasmtime/commit/0c1c2f612bb73a5c56eae98fee89e05f8f18f4a0">https://github.com/aborg-dev/wasmtime/commit/0c1c2f612bb73a5c56eae98fee89e05f8f18f4a0</a> to make sure we are not generating compressed instructions in the riscv64 backend.</li>
<li>Compile without <code>has_*</code> flags:</li>
</ol>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">cargo</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">--</span><span class="n">bin</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="o">--</span><span class="n">features</span><span class="w"> </span><span class="n">all</span><span class="o">-</span><span class="n">arch</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="n">compile</span><span class="w"> </span><span class="o">--</span><span class="n">target</span><span class="w"> </span><span class="n">riscv64</span><span class="w"> </span><span class="n">data</span><span class="o">/</span><span class="n">fibonacci</span><span class="p">.</span><span class="n">wasm</span>
<span class="n">md5sum</span><span class="w"> </span><span class="n">fibonacci</span><span class="p">.</span><span class="n">cwasm</span>
<span class="o">&gt;</span><span class="w"> </span><span class="n">dd5a06834687e5af0c8f7d01e5cef81c</span><span class="w">  </span><span class="n">fibonacci</span><span class="p">.</span><span class="n">cwasm</span>
</code></pre></div>
<p>The <code>panic</code> in the code did not fire.</p>
<ol start="3">
<li>Compile with <code>has_*</code> flags:</li>
</ol>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">rm</span><span class="w"> </span><span class="n">fibonacci</span><span class="p">.</span><span class="n">cwasm</span>
<span class="n">cargo</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">--</span><span class="n">bin</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="o">--</span><span class="n">features</span><span class="w"> </span><span class="n">all</span><span class="o">-</span><span class="n">arch</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="n">compile</span><span class="w"> </span><span class="o">-</span><span class="n">Ccranelift</span><span class="o">-</span><span class="n">has_zca</span><span class="o">=</span><span class="kc">false</span><span class="w"> </span><span class="o">-</span><span class="n">Ccranelift</span><span class="o">-</span><span class="n">has_zcd</span><span class="o">=</span><span class="kc">false</span><span class="w"> </span><span class="o">--</span><span class="n">target</span><span class="w"> </span><span class="n">riscv64</span><span class="w"> </span><span class="n">data</span><span class="o">/</span><span class="n">fibonacci</span><span class="p">.</span><span class="n">wasm</span>
<span class="n">md5sum</span><span class="w"> </span><span class="n">fibonacci</span><span class="p">.</span><span class="n">cwasm</span>
<span class="o">&gt;</span><span class="w"> </span><span class="n">dd5a06834687e5af0c8f7d01e5cef81c</span><span class="w">  </span><span class="n">fibonacci</span><span class="p">.</span><span class="n">cwasm</span>
</code></pre></div>
<p>Again, the same checksum and the <code>panic</code> didn't fire</p>
<ol start="4">
<li>Compile for <code>imac</code> target</li>
</ol>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">rm</span><span class="w"> </span><span class="n">fibonacci</span><span class="p">.</span><span class="n">cwasm</span>
<span class="n">cargo</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">--</span><span class="n">bin</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="o">--</span><span class="n">features</span><span class="w"> </span><span class="n">all</span><span class="o">-</span><span class="n">arch</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="n">compile</span><span class="w"> </span><span class="o">--</span><span class="n">target</span><span class="w"> </span><span class="n">riscv64imac</span><span class="w"> </span><span class="n">data</span><span class="o">/</span><span class="n">fibonacci</span><span class="p">.</span><span class="n">wasm</span>
<span class="n">md5sum</span><span class="w"> </span><span class="n">fibonacci</span><span class="p">.</span><span class="n">cwasm</span>
<span class="mf">38e8</span><span class="n">a91b709a5ae8f2fdfc4dee91fb9d</span><span class="w">  </span><span class="n">fibonacci</span><span class="p">.</span><span class="n">cwasm</span>
</code></pre></div>
<p>The checksum changed (I suspect just because the target is encoded in the ELF file), the <code>panic</code> didn't fire</p>
<ol start="5">
<li>Finally, manually enable <code>has_*</code> flags:</li>
</ol>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">cargo</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">--</span><span class="n">bin</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="o">--</span><span class="n">features</span><span class="w"> </span><span class="n">all</span><span class="o">-</span><span class="n">arch</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="n">compile</span><span class="w">  </span><span class="o">-</span><span class="n">Ccranelift</span><span class="o">-</span><span class="n">has_zca</span><span class="o">=</span><span class="kc">true</span><span class="w"> </span><span class="o">-</span><span class="n">Ccranelift</span><span class="o">-</span><span class="n">has_zcd</span><span class="o">=</span><span class="kc">true</span><span class="w"> </span><span class="o">--</span><span class="n">target</span><span class="w"> </span><span class="n">riscv64</span><span class="w"> </span><span class="n">data</span><span class="o">/</span><span class="n">fibonacci</span><span class="p">.</span><span class="n">wasm</span>
</code></pre></div>
<p>Now the panic actually triggers.</p>
<p>I've included the <code>data/fibonacci.wasm</code> in the <a href="https://github.com/aborg-dev/wasmtime/commit/0c1c2f612bb73a5c56eae98fee89e05f8f18f4a0#diff-ff642caab8a0305914ad5c4ffe2acdb13d016564530b39966a9f136549fb36a2">commit</a> if anyone wants to try to reproduce this. It has been generated using <code>rustc</code>.</p>
<p>Overall, it seems that these compressed instructions are generated somewhere outside of riscv64 codegen? I've tracked their source to <code>array_to_wasm_trampoline</code> function, but couldn't find anything suspicious there.</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/aborg-dev/wasmtime/commit/0c1c2f612bb73a5c56eae98fee89e05f8f18f4a0#diff-ff642caab8a0305914ad5c4ffe2acdb13d016564530b39966a9f136549fb36a2" style="background-image: url(&quot;https://uploads.zulipusercontent.net/a2f5a10c55b27065cf4e6336e50bd23b98292575/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f353630336235306135393964326332393430313633346361633532313531313661393736636335616239666536636331306639366130353766646534396431662f61626f72672d6465762f7761736d74696d652f636f6d6d69742f30633163326636313262623733613563353665616539386665653839653035663866313866346130&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/aborg-dev/wasmtime/commit/0c1c2f612bb73a5c56eae98fee89e05f8f18f4a0#diff-ff642caab8a0305914ad5c4ffe2acdb13d016564530b39966a9f136549fb36a2" title="Experiment with compressed instructinos · aborg-dev/wasmtime@0c1c2f6">Experiment with compressed instructinos · aborg-dev/wasmtime@0c1c2f6</a></div><div class="message_embed_description">A fast and secure runtime for WebAssembly. Contribute to aborg-dev/wasmtime development by creating an account on GitHub.</div></div></div><div class="message_embed"><a class="message_embed_image" href="https://github.com/aborg-dev/wasmtime/commit/0c1c2f612bb73a5c56eae98fee89e05f8f18f4a0" style="background-image: url(&quot;https://uploads.zulipusercontent.net/a2f5a10c55b27065cf4e6336e50bd23b98292575/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f353630336235306135393964326332393430313633346361633532313531313661393736636335616239666536636331306639366130353766646534396431662f61626f72672d6465762f7761736d74696d652f636f6d6d69742f30633163326636313262623733613563353665616539386665653839653035663866313866346130&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/aborg-dev/wasmtime/commit/0c1c2f612bb73a5c56eae98fee89e05f8f18f4a0" title="Experiment with compressed instructinos · aborg-dev/wasmtime@0c1c2f6">Experiment with compressed instructinos · aborg-dev/wasmtime@0c1c2f6</a></div><div class="message_embed_description">A fast and secure runtime for WebAssembly. Contribute to aborg-dev/wasmtime development by creating an account on GitHub.</div></div></div>



<a name="483657569"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/%60wasmtime%20compile%60%20for%20%60riscv64-ima%60%20target/near/483657569" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Afonso Bordado <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/.60wasmtime.20compile.60.20for.20.60riscv64-ima.60.20target.html#483657569">(Nov 21 2024 at 10:09)</a>:</h4>
<p>Oh right, if those functions are generated in the trampoline then we don't compile them using cranelift. I think they get compiled at wasmtime compile time and then copied to the final binary. But <span class="user-mention" data-user-id="253994">@Alex Crichton</span> might be able to explain this better.</p>



<a name="483721469"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/%60wasmtime%20compile%60%20for%20%60riscv64-ima%60%20target/near/483721469" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/.60wasmtime.20compile.60.20for.20.60riscv64-ima.60.20target.html#483721469">(Nov 21 2024 at 15:13)</a>:</h4>
<p>From the gist in the OP of this thread, I don't think those are actually compressed instructions. I think that's data after the final <code>ret</code> which happens to disassemble as compressed instructions but I don't believe they're actually executed at runtime (or at least they shouldn't be).</p>
<p>Otherwise I think this all makes sense:</p>
<ul>
<li>I don't think we actually enable the compressed extension by default? </li>
<li>That would explain why <code>--target riscv64</code> doesn't trigger the panic</li>
<li>If <code>--target riscv64</code> doesn't trigger the panic then manually disabling extensions also won't change much</li>
<li>With <code>--target riscv64imac</code> that's parsed by <code>target-lexicon</code> and we don't actually infer target features from that, just the target architecture. Arguably a bug in Wasmtime but that won't actually enable the <code>c</code> extension</li>
<li>With <code>-Ccranelift-has_zca=true -Ccranelift-has_zcd=true</code> that's the first time things were enabled, so that would explain things.</li>
</ul>
<blockquote>
<p>Overall, it seems that these compressed instructions are generated somewhere outside of riscv64 codegen? I've tracked their source to <code>array_to_wasm_trampoline</code> function, but couldn't find anything suspicious there.</p>
</blockquote>
<p>I'm not sure I fully understand this? When you say you've tracked it down to there, is this in a debugger for example (e.g. you ran something and got SIGILL?) Or are you inspecting codegen manually?</p>
<blockquote>
<p>I think they get compiled at wasmtime compile time and then copied to the final binary</p>
</blockquote>
<p>Oh I don't believe that this should be happening, all compiled code is generated by Cranelift</p>



<a name="483723466"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/%60wasmtime%20compile%60%20for%20%60riscv64-ima%60%20target/near/483723466" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Afonso Bordado <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/.60wasmtime.20compile.60.20for.20.60riscv64-ima.60.20target.html#483723466">(Nov 21 2024 at 15:21)</a>:</h4>
<p>Oh right, I thought we had some pieces that were compiled outside of cranelift.</p>
<p>IIRC, by default we use riscv64gc (even if the target is riscv64) that has compressed instructions enabled by default </p>
<p>The extra data being interpreted as instructions seems very likely, I've run into that a lot with our internal disassembly tests as well</p>



<a name="483723695"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/%60wasmtime%20compile%60%20for%20%60riscv64-ima%60%20target/near/483723695" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/.60wasmtime.20compile.60.20for.20.60riscv64-ima.60.20target.html#483723695">(Nov 21 2024 at 15:22)</a>:</h4>
<p>I thought as well we had c enabled by default, but given that <code>--target</code> isn't emitting compressed instructions I think that we don't? (perhaps due to a bug?)</p>



<a name="483724118"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/%60wasmtime%20compile%60%20for%20%60riscv64-ima%60%20target/near/483724118" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Afonso Bordado <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/.60wasmtime.20compile.60.20for.20.60riscv64-ima.60.20target.html#483724118">(Nov 21 2024 at 15:24)</a>:</h4>
<p>Yeah that's strange, I'll try to look into it</p>



<a name="483916320"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/%60wasmtime%20compile%60%20for%20%60riscv64-ima%60%20target/near/483916320" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Borg (aborg-dev) <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/.60wasmtime.20compile.60.20for.20.60riscv64-ima.60.20target.html#483916320">(Nov 22 2024 at 13:55)</a>:</h4>
<p><span class="user-mention" data-user-id="253994">@Alex Crichton</span> , ahhh, very good catch, that explains a lot!</p>
<p>For a bit more context, I'm prototyping an ahead-of-time binary translator from RISC-V bytecode into a custom ISA and it sounds like I need to disambiguate between the actual bytecode and some sort of "payload" that Cranelift codegen stores after the function bytecode? What is this payload? I tried to look at the disasm/vcode of the function, but it ends on the <code>ret</code> statement and actually does not include these additional few bytes that I see in the objdump.</p>
<p>Assuming my understanding is correct, I see two ways to accomplish this:</p>
<ol>
<li>Have a way to find the boundary between the bytecode and Cranelift "payload", e.g. a length of functions stored somewhere, or some special market at the end of a function. Can I rely on "ret" instruction for this?</li>
<li>Have a way to disable the "payload" generation - but I haven't found the place in code where it is added</li>
</ol>



<a name="483959429"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/%60wasmtime%20compile%60%20for%20%60riscv64-ima%60%20target/near/483959429" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/.60wasmtime.20compile.60.20for.20.60riscv64-ima.60.20target.html#483959429">(Nov 22 2024 at 17:38)</a>:</h4>
<p>We have <a href="https://github.com/bytecodealliance/wasmtime/issues/9402">an issue</a> about moving these data bits out of the <code>.text</code> section but otherwise AFAIK there's no great way to detect this right now with our current object files</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wasmtime/issues/9402" style="background-image: url(&quot;https://uploads.zulipusercontent.net/f8a59c154128f55f1d4be3d3c510fe9dba228540/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f656562336530343435383036663537376162613630333337343766373133633466386238336536643437616336343836623262646531663731616535313035642f62797465636f6465616c6c69616e63652f7761736d74696d652f6973737565732f39343032&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wasmtime/issues/9402" title="Move constant pools in compiled code out of the .text section · Issue #9402 · bytecodealliance/wasmtime">Move constant pools in compiled code out of the .text section · Issue #9402 · bytecodealliance/wasmtime</a></div><div class="message_embed_description">Today Cranelift's constant-pools are located in the .text section of the executable, typically located after the function itself. While convenient for code generation this exposes a possible attack...</div></div></div>



<a name="483959479"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/%60wasmtime%20compile%60%20for%20%60riscv64-ima%60%20target/near/483959479" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/.60wasmtime.20compile.60.20for.20.60riscv64-ima.60.20target.html#483959479">(Nov 22 2024 at 17:38)</a>:</h4>
<p>we could perhaps update our object files with new symbols or such to help outline these sections though</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>