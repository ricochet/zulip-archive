<html>
<head><meta charset="utf-8"><title>Ran into build issues when compling islec on an M1 mac · cranelift · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/index.html">cranelift</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/Ran.20into.20build.20issues.20when.20compling.20islec.20on.20an.20M1.20mac.html">Ran into build issues when compling islec on an M1 mac</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="443275189"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/Ran%20into%20build%20issues%20when%20compling%20islec%20on%20an%20M1%20mac/near/443275189" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nihal Pasham <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/Ran.20into.20build.20issues.20when.20compling.20islec.20on.20an.20M1.20mac.html#443275189">(Jun 07 2024 at 11:10)</a>:</h4>
<p>Hi, new to compiler engineering. Just cloned the wasmtime repo and followed the instructions in the README for islec </p>
<p><code>cargo build --release</code> but ran into the following build issues. Am I missing something?</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code><span class="w">   </span>Compiling<span class="w"> </span>libc<span class="w"> </span>v0.2.153
<span class="w">   </span>Compiling<span class="w"> </span>anstyle-query<span class="w"> </span>v1.0.0
<span class="w">   </span>Compiling<span class="w"> </span>rustix<span class="w"> </span>v0.38.31
<span class="w">   </span>Compiling<span class="w"> </span>memchr<span class="w"> </span>v2.5.0
<span class="w">   </span>Compiling<span class="w"> </span>proc-macro2<span class="w"> </span>v1.0.81
<span class="w">   </span>Compiling<span class="w"> </span>log<span class="w"> </span>v0.4.17
<span class="w">   </span>Compiling<span class="w"> </span>anstyle-parse<span class="w"> </span>v0.2.1
<span class="w">   </span>Compiling<span class="w"> </span>clap_lex<span class="w"> </span>v0.5.0
<span class="w">   </span>Compiling<span class="w"> </span>strsim<span class="w"> </span>v0.10.0
<span class="w">   </span>Compiling<span class="w"> </span>heck<span class="w"> </span>v0.4.0
error:<span class="w"> </span>failed<span class="w"> </span>to<span class="w"> </span>run<span class="w"> </span>custom<span class="w"> </span>build<span class="w"> </span><span class="nb">command</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="sb">`</span>libc<span class="w"> </span>v0.2.153<span class="sb">`</span>

Caused<span class="w"> </span>by:
<span class="w">  </span>process<span class="w"> </span>didn<span class="s1">'t exit successfully: `/Users/nihal.pasham/devspace/compiler/wasmtime/target/release/build/libc-c70185b4d15e25fb/build-script-build` (signal: 9, SIGKILL: kill)</span>
<span class="s1">warning: build failed, waiting for other jobs to finish...</span>
<span class="s1">error: failed to run custom build command for `rustix v0.38.31`</span>

<span class="s1">Caused by:</span>
<span class="s1">  process didn'</span>t<span class="w"> </span><span class="nb">exit</span><span class="w"> </span>successfully:<span class="w"> </span><span class="sb">`</span>/Users/nihal.pasham/devspace/compiler/wasmtime/target/release/build/rustix-8f0bd8469e02e97b/build-script-build<span class="sb">`</span><span class="w"> </span><span class="o">(</span>signal:<span class="w"> </span><span class="m">9</span>,<span class="w"> </span>SIGKILL:<span class="w"> </span><span class="nb">kill</span><span class="o">)</span>
error:<span class="w"> </span>failed<span class="w"> </span>to<span class="w"> </span>run<span class="w"> </span>custom<span class="w"> </span>build<span class="w"> </span><span class="nb">command</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="sb">`</span>proc-macro2<span class="w"> </span>v1.0.81<span class="sb">`</span>

Caused<span class="w"> </span>by:
<span class="w">  </span>process<span class="w"> </span>didn<span class="s1">'t exit successfully: `/Users/nihal.pasham/devspace/compiler/wasmtime/target/release/build/proc-macro2-e25cbce0be9ed81c/build-script-build` (signal: 9, SIGKILL: kill)</span>
<span class="s1">error: failed to run custom build command for `memchr v2.5.0`</span>

<span class="s1">Caused by:</span>
<span class="s1">  process didn'</span>t<span class="w"> </span><span class="nb">exit</span><span class="w"> </span>successfully:<span class="w"> </span><span class="sb">`</span>/Users/nihal.pasham/devspace/compiler/wasmtime/target/release/build/memchr-f9a14b593813b5ba/build-script-build<span class="sb">`</span><span class="w"> </span><span class="o">(</span>signal:<span class="w"> </span><span class="m">9</span>,<span class="w"> </span>SIGKILL:<span class="w"> </span><span class="nb">kill</span><span class="o">)</span>
error:<span class="w"> </span>failed<span class="w"> </span>to<span class="w"> </span>run<span class="w"> </span>custom<span class="w"> </span>build<span class="w"> </span><span class="nb">command</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="sb">`</span>log<span class="w"> </span>v0.4.17<span class="sb">`</span>

Caused<span class="w"> </span>by:
<span class="w">  </span>process<span class="w"> </span>didn<span class="err">'</span>t<span class="w"> </span><span class="nb">exit</span><span class="w"> </span>successfully:<span class="w"> </span><span class="sb">`</span>/Users/nihal.pasham/devspace/compiler/wasmtime/target/release/build/log-9127a2af714571ef/build-script-build<span class="sb">`</span><span class="w"> </span><span class="o">(</span>signal:<span class="w"> </span><span class="m">9</span>,<span class="w"> </span>SIGKILL:<span class="w"> </span><span class="nb">kill</span><span class="o">)</span>
</code></pre></div>



<a name="443278660"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/Ran%20into%20build%20issues%20when%20compling%20islec%20on%20an%20M1%20mac/near/443278660" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/Ran.20into.20build.20issues.20when.20compling.20islec.20on.20an.20M1.20mac.html#443278660">(Jun 07 2024 at 11:32)</a>:</h4>
<p>that looks like you may be running out of memory, you can try running it with less parallelism which may reduce the amount of memory necessary to build it by using <code>cargo build --release -jN</code> where <code>N</code> is the amount of parallelism you want, e.g. <code>-j4</code> for using 4 cores. iirc the M1 has 8 cores so defaults to <code>-j8</code></p>



<a name="443287637"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/Ran%20into%20build%20issues%20when%20compling%20islec%20on%20an%20M1%20mac/near/443287637" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nihal Pasham <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/Ran.20into.20build.20issues.20when.20compling.20islec.20on.20an.20M1.20mac.html#443287637">(Jun 07 2024 at 12:25)</a>:</h4>
<p>I actually have an M1 Max with 10 cores but I’ll try the above and report back.</p>



<a name="443291432"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/Ran%20into%20build%20issues%20when%20compling%20islec%20on%20an%20M1%20mac/near/443291432" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nihal Pasham <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/Ran.20into.20build.20issues.20when.20compling.20islec.20on.20an.20M1.20mac.html#443291432">(Jun 07 2024 at 12:48)</a>:</h4>
<p>So tried this but I don't think that's the issue</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>cargo<span class="w"> </span>build<span class="w"> </span>--release<span class="w"> </span>-j4
<span class="w">   </span>Compiling<span class="w"> </span>libc<span class="w"> </span>v0.2.153
<span class="w">   </span>Compiling<span class="w"> </span>rustix<span class="w"> </span>v0.38.31
<span class="w">   </span>Compiling<span class="w"> </span>proc-macro2<span class="w"> </span>v1.0.81
<span class="w">   </span>Compiling<span class="w"> </span>memchr<span class="w"> </span>v2.5.0
error:<span class="w"> </span>failed<span class="w"> </span>to<span class="w"> </span>run<span class="w"> </span>custom<span class="w"> </span>build<span class="w"> </span><span class="nb">command</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="sb">`</span>libc<span class="w"> </span>v0.2.153<span class="sb">`</span>

Caused<span class="w"> </span>by:
<span class="w">  </span>process<span class="w"> </span>didn<span class="s1">'t exit successfully: `/Users/nihal.pasham/devspace/compiler/wasmtime/target/release/build/libc-c70185b4d15e25fb/build-script-build` (signal: 9, SIGKILL: kill)</span>
<span class="s1">warning: build failed, waiting for other jobs to finish...</span>
<span class="s1">error: failed to run custom build command for `rustix v0.38.31`</span>

<span class="s1">Caused by:</span>
<span class="s1">  process didn'</span>t<span class="w"> </span><span class="nb">exit</span><span class="w"> </span>successfully:<span class="w"> </span><span class="sb">`</span>/Users/nihal.pasham/devspace/compiler/wasmtime/target/release/build/rustix-8f0bd8469e02e97b/build-script-build<span class="sb">`</span><span class="w"> </span><span class="o">(</span>signal:<span class="w"> </span><span class="m">9</span>,<span class="w"> </span>SIGKILL:<span class="w"> </span><span class="nb">kill</span><span class="o">)</span>
error:<span class="w"> </span>failed<span class="w"> </span>to<span class="w"> </span>run<span class="w"> </span>custom<span class="w"> </span>build<span class="w"> </span><span class="nb">command</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="sb">`</span>memchr<span class="w"> </span>v2.5.0<span class="sb">`</span>

Caused<span class="w"> </span>by:
<span class="w">  </span>process<span class="w"> </span>didn<span class="s1">'t exit successfully: `/Users/nihal.pasham/devspace/compiler/wasmtime/target/release/build/memchr-f9a14b593813b5ba/build-script-build` (signal: 9, SIGKILL: kill)</span>
<span class="s1">error: failed to run custom build command for `proc-macro2 v1.0.81`</span>

<span class="s1">Caused by:</span>
<span class="s1">  process didn'</span>t<span class="w"> </span><span class="nb">exit</span><span class="w"> </span>successfully:<span class="w"> </span><span class="sb">`</span>/Users/nihal.pasham/devspace/compiler/wasmtime/target/release/build/proc-macro2-e25cbce0be9ed81c/build-script-build<span class="sb">`</span><span class="w"> </span><span class="o">(</span>signal:<span class="w"> </span><span class="m">9</span>,<span class="w"> </span>SIGKILL:<span class="w"> </span><span class="nb">kill</span><span class="o">)</span>
</code></pre></div>



<a name="443293180"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/Ran%20into%20build%20issues%20when%20compling%20islec%20on%20an%20M1%20mac/near/443293180" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nihal Pasham <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/Ran.20into.20build.20issues.20when.20compling.20islec.20on.20an.20M1.20mac.html#443293180">(Jun 07 2024 at 12:57)</a>:</h4>
<p>it kind of seems similar to this - <a href="https://users.rust-lang.org/t/error-failed-to-run-custom-build-command-for-libc-v0-2-150/103006/7">https://users.rust-lang.org/t/error-failed-to-run-custom-build-command-for-libc-v0-2-150/103006/7</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://users.rust-lang.org/t/error-failed-to-run-custom-build-command-for-libc-v0-2-150/103006/7" style="background-image: url(&quot;https://uploads.zulipusercontent.net/2c9a952e57d7867b92177eb25ebd54683f359da0/68747470733a2f2f676c6f62616c2e646973636f757273652d63646e2e636f6d2f627573696e657373352f75706c6f6164732f727573745f6c616e672f6f726967696e616c2f33582f372f322f373263383239366366623935616339663930383137313735316131326534643134633263353631372e676966&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://users.rust-lang.org/t/error-failed-to-run-custom-build-command-for-libc-v0-2-150/103006/7" title="Error: failed to run custom build command for `libc v0.2.150`">Error: failed to run custom build command for `libc v0.2.150`</a></div><div class="message_embed_description">During cargo build there's barely no change in the command top output:  SharedLibs: 557M resident, 124M data, 53M linkedit. MemRegions: 664581 total, 5053M resident, 338M private, 5487M shared. PhysMem: 20G used (3078M wired, 3657M compressor), 3162M unused. VM: 391T vsize, 4285M framework vsize, 109702(0) swapins, 286430(0) swapouts.  Here's Activity Monitor during cargo build:</div></div></div>



<a name="443294820"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/Ran%20into%20build%20issues%20when%20compling%20islec%20on%20an%20M1%20mac/near/443294820" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nihal Pasham <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/Ran.20into.20build.20issues.20when.20compling.20islec.20on.20an.20M1.20mac.html#443294820">(Jun 07 2024 at 13:06)</a>:</h4>
<p>nope - a restart did not work</p>



<a name="443314760"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/Ran%20into%20build%20issues%20when%20compling%20islec%20on%20an%20M1%20mac/near/443314760" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nihal Pasham <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/Ran.20into.20build.20issues.20when.20compling.20islec.20on.20an.20M1.20mac.html#443314760">(Jun 07 2024 at 14:54)</a>:</h4>
<p>I can confirm that debug builds seem to work just fine while release builds fail to run custom build commands/scripts (on Apple Silicon).</p>
<p>Not sure if  I'm missing something but I presume a debug build of <code>islec</code> is good enough for learning. </p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>cargo<span class="w"> </span>build
<span class="w">   </span>Compiling<span class="w"> </span>memchr<span class="w"> </span>v2.7.2
<span class="w">   </span>Compiling<span class="w"> </span>regex-syntax<span class="w"> </span>v0.8.3
<span class="w">   </span>Compiling<span class="w"> </span>libc<span class="w"> </span>v0.2.155
<span class="w">   </span>Compiling<span class="w"> </span>cranelift-isle<span class="w"> </span>v0.110.0<span class="w"> </span><span class="o">(</span>/Users/nihal.pasham/devspace/compiler/wasmtime/cranelift/isle/isle<span class="o">)</span>
<span class="w">   </span>Compiling<span class="w"> </span>codespan-reporting<span class="w"> </span>v0.11.1
<span class="w">   </span>Compiling<span class="w"> </span>syn<span class="w"> </span>v2.0.66
<span class="w">   </span>Compiling<span class="w"> </span>aho-corasick<span class="w"> </span>v1.1.3
<span class="w">   </span>Compiling<span class="w"> </span>is-terminal<span class="w"> </span>v0.4.12
<span class="w">   </span>Compiling<span class="w"> </span>regex-automata<span class="w"> </span>v0.4.6
<span class="w">   </span>Compiling<span class="w"> </span>clap_derive<span class="w"> </span>v4.5.5
<span class="w">   </span>Compiling<span class="w"> </span>regex<span class="w"> </span>v1.10.4
<span class="w">   </span>Compiling<span class="w"> </span>env_logger<span class="w"> </span>v0.10.2
<span class="w">   </span>Compiling<span class="w"> </span>clap<span class="w"> </span>v4.5.6
<span class="w">   </span>Compiling<span class="w"> </span>islec<span class="w"> </span>v0.0.0<span class="w"> </span><span class="o">(</span>/Users/nihal.pasham/devspace/compiler/wasmtime/cranelift/isle/islec<span class="o">)</span>
<span class="w">    </span>Finished<span class="w"> </span><span class="sb">`</span>dev<span class="sb">`</span><span class="w"> </span>profile<span class="w"> </span><span class="o">[</span>unoptimized<span class="w"> </span>+<span class="w"> </span>debuginfo<span class="o">]</span><span class="w"> </span>target<span class="o">(</span>s<span class="o">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">3</span>.01s
</code></pre></div>



<a name="443327804"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/Ran%20into%20build%20issues%20when%20compling%20islec%20on%20an%20M1%20mac/near/443327804" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/Ran.20into.20build.20issues.20when.20compling.20islec.20on.20an.20M1.20mac.html#443327804">(Jun 07 2024 at 16:18)</a>:</h4>
<p>sorry, if that didn't fix it, idk what the issue is, someone more familiar with macos and wasmtime will need to help.</p>



<a name="443372380"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/Ran%20into%20build%20issues%20when%20compling%20islec%20on%20an%20M1%20mac/near/443372380" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/Ran.20into.20build.20issues.20when.20compling.20islec.20on.20an.20M1.20mac.html#443372380">(Jun 07 2024 at 20:23)</a>:</h4>
<p>Do you have a third-party binutils from Nix in your PATH by chance? I had this issue once where binaries were not signed (every binary on aarch64 macOS needs an ad-hoc sig) and were thus immediately killed by the kernel</p>



<a name="443412695"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/Ran%20into%20build%20issues%20when%20compling%20islec%20on%20an%20M1%20mac/near/443412695" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nihal Pasham <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/Ran.20into.20build.20issues.20when.20compling.20islec.20on.20an.20M1.20mac.html#443412695">(Jun 08 2024 at 02:42)</a>:</h4>
<p>I think this may be the issue. Although, I'm not sure how to solve it.  Usually, we should get a prompt asking the user if he wants to continue with a custom build script but that does not happen in my case. </p>
<p>I use <code>homebrew</code> for package installation (i.e. have not used Nix so far).</p>



<a name="443413167"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/Ran%20into%20build%20issues%20when%20compling%20islec%20on%20an%20M1%20mac/near/443413167" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nihal Pasham <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/Ran.20into.20build.20issues.20when.20compling.20islec.20on.20an.20M1.20mac.html#443413167">(Jun 08 2024 at 02:51)</a>:</h4>
<p>but what's weird is debug builds work without any such issues</p>



<a name="443416601"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/Ran%20into%20build%20issues%20when%20compling%20islec%20on%20an%20M1%20mac/near/443416601" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/Ran.20into.20build.20issues.20when.20compling.20islec.20on.20an.20M1.20mac.html#443416601">(Jun 08 2024 at 03:11)</a>:</h4>
<p><span class="user-mention silent" data-user-id="726787">Nihal Pasham</span> <a href="#narrow/stream/217117-cranelift/topic/Ran.20into.20build.20issues.20when.20compling.20islec.20on.20an.20M1.20mac/near/443412695">said</a>:</p>
<blockquote>
<p>I think this may be the issue. Although, I'm not sure how to solve it.  Usually, we should get a prompt asking the user if he wants to continue with a custom build script but that does not happen in my case. </p>
</blockquote>
<p>I’m not sure I’ve ever seen a “prompt asking the user” from Cargo in this case? The build script is necessary: it generates part of Cranelift.</p>
<p>Are you able to build and run an ordinary rust binary (e.g. hello world) in your environment?</p>



<a name="443417067"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/Ran%20into%20build%20issues%20when%20compling%20islec%20on%20an%20M1%20mac/near/443417067" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nihal Pasham <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/Ran.20into.20build.20issues.20when.20compling.20islec.20on.20an.20M1.20mac.html#443417067">(Jun 08 2024 at 03:17)</a>:</h4>
<p>yes, a simple <code>hello-world</code> release build works</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>cargo<span class="w"> </span>build<span class="w"> </span>--release
<span class="w">   </span>Compiling<span class="w"> </span>hello-world<span class="w"> </span>v0.1.0<span class="w"> </span><span class="o">(</span>/Users/nihal.pasham/devspace/rust/projects/exp/hello-world<span class="o">)</span>
<span class="w">    </span>Finished<span class="w"> </span><span class="sb">`</span>release<span class="sb">`</span><span class="w"> </span>profile<span class="w"> </span><span class="o">[</span>optimized<span class="o">]</span><span class="w"> </span>target<span class="o">(</span>s<span class="o">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">14</span>.17s
</code></pre></div>



<a name="443422212"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/Ran%20into%20build%20issues%20when%20compling%20islec%20on%20an%20M1%20mac/near/443422212" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/Ran.20into.20build.20issues.20when.20compling.20islec.20on.20an.20M1.20mac.html#443422212">(Jun 08 2024 at 04:23)</a>:</h4>
<p>Ok. I saw your answer about homebrew but didn’t see anything specifically to my question: do you have a custom binutils (or C compiler) in your $PATH? If so can you run without it?</p>



<a name="443422339"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/Ran%20into%20build%20issues%20when%20compling%20islec%20on%20an%20M1%20mac/near/443422339" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/Ran.20into.20build.20issues.20when.20compling.20islec.20on.20an.20M1.20mac.html#443422339">(Jun 08 2024 at 04:26)</a>:</h4>
<p>Also: any custom linker configuration, eg in your systemwide cargo configuration?</p>



<a name="443422907"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/Ran%20into%20build%20issues%20when%20compling%20islec%20on%20an%20M1%20mac/near/443422907" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nihal Pasham <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/Ran.20into.20build.20issues.20when.20compling.20islec.20on.20an.20M1.20mac.html#443422907">(Jun 08 2024 at 04:34)</a>:</h4>
<p>Oh, I have one custom ref to gcc binutils in my $PATH and some homebrew utils refs. Here is the output for $PATH</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code><span class="nv">$PATH</span>
zsh:<span class="w"> </span>no<span class="w"> </span>such<span class="w"> </span>file<span class="w"> </span>or<span class="w"> </span>directory
:<span class="w"> </span>/Users/nihal.pasham/.modular/pkg/packages.modular.com_mojo/bin
:/Users/nihal.pasham/.wasmtime/bin
:/Users/nihal.pasham/.cargo/bin
:/opt/homebrew/opt/binutils/bin
:/opt/homebrew/opt/openssl@3/bin
:/opt/homebrew/opt/make/libexec/gnubin
:/Users/nihal.pasham/.local/bin
:/opt/homebrew/opt/openjdk/bin
:/Users/nihal.pasham/Library/xPacks/@xpack-dev-tools/arm-none-eabi-gcc/10.3.1-2.3.1/.content/bin
:/opt/local/bin
:/opt/local/sbin
:/opt/homebrew/bin
:/opt/homebrew/sbin
:/usr/local/bin
:/System/Cryptexes/App/usr/bin
:/usr/bin
:/bin
:/usr/sbin
:/sbin
:/var/run/com.apple.security.cryptexd/codex.system/bootstrap/usr/local/bin
:/var/run/com.apple.security.cryptexd/codex.system/bootstrap/usr/bin
:/var/run/com.apple.security.cryptexd/codex.system/bootstrap/usr/appleinternal/bin
:/Library/Apple/usr/bin
:/Users/nihal.pasham/.cargo/binexport
</code></pre></div>
<p>Should I remove them and try compiling? Why would this be a problem?</p>



<a name="443426453"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/Ran%20into%20build%20issues%20when%20compling%20islec%20on%20an%20M1%20mac/near/443426453" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nihal Pasham <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/Ran.20into.20build.20issues.20when.20compling.20islec.20on.20an.20M1.20mac.html#443426453">(Jun 08 2024 at 05:16)</a>:</h4>
<p>Ok, this worked. I removed all references to custom homebrew <code>binutils</code>  in my $PATH.</p>



<a name="443426885"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/Ran%20into%20build%20issues%20when%20compling%20islec%20on%20an%20M1%20mac/near/443426885" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nihal Pasham <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/Ran.20into.20build.20issues.20when.20compling.20islec.20on.20an.20M1.20mac.html#443426885">(Jun 08 2024 at 05:23)</a>:</h4>
<p>PS: This was <strong>not</strong> a cranelift build issue. Any Cargo install relying on a custom build was failing. Apparently, having <code>binutils</code> in one's $PATH can cause issues when building in release mode. We could end up stripping debugging info using <code>strip</code> from Homebrew's binutils instead of picking the right one from /usr/bin.</p>



<a name="443460181"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/Ran%20into%20build%20issues%20when%20compling%20islec%20on%20an%20M1%20mac/near/443460181" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Frank Rehwinkel <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/Ran.20into.20build.20issues.20when.20compling.20islec.20on.20an.20M1.20mac.html#443460181">(Jun 08 2024 at 11:49)</a>:</h4>
<p>Maybe <code>cargo-component</code> should have a <code>doctor</code> sub-command that can check things about the environment. Seems what can be found in $PATH and its affects on the LLVM linker has caused <code>cargo</code> builds to fail for years. This is more of a <code>cargo</code> issue than a <code>cargo-component</code> issue but what are the odds of getting a change into <code>cargo</code>?</p>



<a name="443465161"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/Ran%20into%20build%20issues%20when%20compling%20islec%20on%20an%20M1%20mac/near/443465161" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/Ran.20into.20build.20issues.20when.20compling.20islec.20on.20an.20M1.20mac.html#443465161">(Jun 08 2024 at 12:48)</a>:</h4>
<p>There is a cargo issue for it at least (closed, alas): <a href="https://github.com/rust-lang/cargo/issues/11641">https://github.com/rust-lang/cargo/issues/11641</a></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/rust-lang/cargo/issues/11641" style="background-image: url(&quot;https://uploads.zulipusercontent.net/0a07d4a0ceb77987a80399f6524a9a58ce5a15c5/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f656338333565383066626233363430366164616162666233643836646665306633326137353336363230336634313534656632633039303238343133383364392f727573742d6c616e672f636172676f2f6973737565732f3131363431&quot;)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/rust-lang/cargo/issues/11641" title="cargo failed to run custom build command if strip in m1 mac · Issue #11641 · rust-lang/cargo">cargo failed to run custom build command if strip in m1 mac · Issue #11641 · rust-lang/cargo</a></div><div class="message_embed_description">Problem cargo faild to run custom build command if [profile.release] strip = true command output $ cargo build --release Compiling libc v0.2.139 error: failed to run custom build command for `libc ...</div></div></div>



<a name="443465405"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/Ran%20into%20build%20issues%20when%20compling%20islec%20on%20an%20M1%20mac/near/443465405" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/Ran.20into.20build.20issues.20when.20compling.20islec.20on.20an.20M1.20mac.html#443465405">(Jun 08 2024 at 12:49)</a>:</h4>
<p>The core issue is that the third-party binutils doesn’t understand how to sign macOS binaries so in some sense it’s actually a binutils bug</p>



<a name="443465427"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/Ran%20into%20build%20issues%20when%20compling%20islec%20on%20an%20M1%20mac/near/443465427" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/Ran.20into.20build.20issues.20when.20compling.20islec.20on.20an.20M1.20mac.html#443465427">(Jun 08 2024 at 12:49)</a>:</h4>
<p>(The strip binary specifically)</p>



<a name="443469071"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/Ran%20into%20build%20issues%20when%20compling%20islec%20on%20an%20M1%20mac/near/443469071" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Frank Rehwinkel <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/Ran.20into.20build.20issues.20when.20compling.20islec.20on.20an.20M1.20mac.html#443469071">(Jun 08 2024 at 13:38)</a>:</h4>
<p><span class="user-mention" data-user-id="254389">@Chris Fallin</span>  You've helped others in the past month or so where it was an LLVM linker issue that was silently picking up a different binary to use in one of its steps if it found it in $PATH but worked just fine without the binary in the path. That one may not have been macOS binary specific but also something rust didn't have direct control over because it was an LLVM issue that had been open a while with no clear path to getting changed.</p>



<a name="443472012"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/Ran%20into%20build%20issues%20when%20compling%20islec%20on%20an%20M1%20mac/near/443472012" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Fallin <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/Ran.20into.20build.20issues.20when.20compling.20islec.20on.20an.20M1.20mac.html#443472012">(Jun 08 2024 at 13:52)</a>:</h4>
<p>Ah, the wasm-opt nondeterminism! Yes, like you I don’t have a bunch of hope that upstream will change easily, or at least not without more energy than I have at the moment. Would be good to continue to note the issues to upstream nevertheless…</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>