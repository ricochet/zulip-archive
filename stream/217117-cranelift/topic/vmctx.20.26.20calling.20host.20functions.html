<html>
<head><meta charset="utf-8"><title>vmctx &amp; calling host functions · cranelift · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/index.html">cranelift</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/vmctx.20.26.20calling.20host.20functions.html">vmctx &amp; calling host functions</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="449315304"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/vmctx%20%26%20calling%20host%20functions/near/449315304" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joseph Kanichai <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/vmctx.20.26.20calling.20host.20functions.html#449315304">(Jul 05 2024 at 13:36)</a>:</h4>
<p>I'm playing around with cranelift/wasm and I'm trying to add some instrumentation to wasm, and I'm trying to do this by injecting CallIndirect's in the cranelift IR, which call a host function, but I'm not sure how to access my host function. How do I know the offset's to the pointers to my host function (I'm guessing this is in vmctx). The host function will collect call statistics.  Or is this a bad way to do what i'm trying to achieve?</p>



<a name="449939509"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/217117-cranelift/topic/vmctx%20%26%20calling%20host%20functions/near/449939509" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> fitzgen (he/him) <a href="https://bytecodealliance.github.io/zulip-archive/stream/217117-cranelift/topic/vmctx.20.26.20calling.20host.20functions.html#449939509">(Jul 08 2024 at 17:49)</a>:</h4>
<p>this is probably the wrong place to go about doing this kind of thing, this is more internals and raw stuff. if you want to wrap wasm entry/exit in order to collect metrics/statistics/etc, you should take a look at <a href="https://docs.rs/wasmtime/latest/wasmtime/struct.Store.html#method.call_hook">https://docs.rs/wasmtime/latest/wasmtime/struct.Store.html#method.call_hook</a> and its async variant</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>