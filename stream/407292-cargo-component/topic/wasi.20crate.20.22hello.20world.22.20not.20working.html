<html>
<head><meta charset="utf-8"><title>wasi crate &quot;hello world&quot; not working · cargo-component · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/407292-cargo-component/index.html">cargo-component</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/407292-cargo-component/topic/wasi.20crate.20.22hello.20world.22.20not.20working.html">wasi crate &quot;hello world&quot; not working</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="423424883"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/407292-cargo-component/topic/wasi%20crate%20%22hello%20world%22%20not%20working/near/423424883" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts <a href="https://bytecodealliance.github.io/zulip-archive/stream/407292-cargo-component/topic/wasi.20crate.20.22hello.20world.22.20not.20working.html#423424883">(Feb 26 2024 at 15:46)</a>:</h4>
<p>I just filed <a href="https://github.com/bytecodealliance/cargo-component/issues/236">#236</a> - not sure if I'm possibly holding it wrong? If there's anything I could do to help fix this please let me know - I wouldn't mind having an issue I could fix to contribute to <code>cargo-component</code>!</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/cargo-component/issues/236" style="background-image: url(https\:\/\/uploads\.zulipusercontent\.net\/2fe17e2fe034d9171090edf6c8b60204460184f2\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f383562373831373365633230313762343139613030343233363462323362396465393761346233646437366165363563383665346230303264346265323533332f62797465636f6465616c6c69616e63652f636172676f2d636f6d706f6e656e742f6973737565732f323336)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/cargo-component/issues/236" title="&quot;hello world&quot; example with the `wasi` crate doesn't work · Issue #236 · bytecodealliance/cargo-component">"hello world" example with the `wasi` crate doesn't work · Issue #236 · bytecodealliance/cargo-component</a></div><div class="message_embed_description">Repro If we run the following commands to build the wasi crate: cargo install cargo-component git clone https://github.com/bytecodealliance/wasi cd wasi cargo component build --example hello-world ...</div></div></div>



<a name="423441317"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/407292-cargo-component/topic/wasi%20crate%20%22hello%20world%22%20not%20working/near/423441317" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Huene <a href="https://bytecodealliance.github.io/zulip-archive/stream/407292-cargo-component/topic/wasi.20crate.20.22hello.20world.22.20not.20working.html#423441317">(Feb 26 2024 at 16:56)</a>:</h4>
<p>I've added some context to the issue; there is a bug relating to building examples and <code>cargo-component</code>'s bindings doesn't appear compatible with the latest wit-bindgen due to some breaking changes in runtime types; i can do a release of <code>cargo-component</code> to update it.</p>



<a name="423459238"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/407292-cargo-component/topic/wasi%20crate%20%22hello%20world%22%20not%20working/near/423459238" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ryan Levick (rylev) <a href="https://bytecodealliance.github.io/zulip-archive/stream/407292-cargo-component/topic/wasi.20crate.20.22hello.20world.22.20not.20working.html#423459238">(Feb 26 2024 at 18:30)</a>:</h4>
<p>I believe I ran into the same (or very similar issue) where <code>cargo component new</code> gave me a project which depended on wit-bindgen 0.19.1 which would fail to compile since the bindings were generated by 0.18. Shouldn't the version generated for the Cargo.toml be matched with the version used by <code>cargo-component</code>?</p>



<a name="423462838"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/407292-cargo-component/topic/wasi%20crate%20%22hello%20world%22%20not%20working/near/423462838" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Huene <a href="https://bytecodealliance.github.io/zulip-archive/stream/407292-cargo-component/topic/wasi.20crate.20.22hello.20world.22.20not.20working.html#423462838">(Feb 26 2024 at 18:53)</a>:</h4>
<p>generally it doesn't have to, as changes to the runtime types/functions are less frequently than the bindings generation</p>



<a name="423462877"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/407292-cargo-component/topic/wasi%20crate%20%22hello%20world%22%20not%20working/near/423462877" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Huene <a href="https://bytecodealliance.github.io/zulip-archive/stream/407292-cargo-component/topic/wasi.20crate.20.22hello.20world.22.20not.20working.html#423462877">(Feb 26 2024 at 18:53)</a>:</h4>
<p>if we were to fix it so that this doesn't happen again, i'd love to move in the direction of not having a user's <code>Cargo.toml</code> reference <code>wit-bindgen</code> at all</p>



<a name="423463011"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/407292-cargo-component/topic/wasi%20crate%20%22hello%20world%22%20not%20working/near/423463011" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/407292-cargo-component/topic/wasi.20crate.20.22hello.20world.22.20not.20working.html#423463011">(Feb 26 2024 at 18:54)</a>:</h4>
<p>I wrote up some <a href="https://github.com/bytecodealliance/cargo-component/issues/236#issuecomment-1964912200">longer form thoughts</a> but I agree that <code>wit-bindgen</code> should not have to match in <code>cargo component</code> as that'll create a lot of usability headaches (like this) in the future</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/cargo-component/issues/236#issuecomment-1964912200" style="background-image: url(https\:\/\/uploads\.zulipusercontent\.net\/6bb453cb2ad4abfc95043464288b182299eb3bb0\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f383265373465343961623363643331333534393938356135306135393333626133653839306236373330373538393866376562393662383163613837323037332f62797465636f6465616c6c69616e63652f636172676f2d636f6d706f6e656e742f6973737565732f323336)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/cargo-component/issues/236#issuecomment-1964912200" title="&quot;hello world&quot; example with the `wasi` crate doesn't work · Issue #236 · bytecodealliance/cargo-component">"hello world" example with the `wasi` crate doesn't work · Issue #236 · bytecodealliance/cargo-component</a></div><div class="message_embed_description">Repro If we run the following commands to build the wasi crate: cargo install cargo-component git clone https://github.com/bytecodealliance/wasi cd wasi cargo component build --example hello-world ...</div></div></div>



<a name="423463038"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/407292-cargo-component/topic/wasi%20crate%20%22hello%20world%22%20not%20working/near/423463038" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/407292-cargo-component/topic/wasi.20crate.20.22hello.20world.22.20not.20working.html#423463038">(Feb 26 2024 at 18:54)</a>:</h4>
<p>removing the <code>wit-bindgen</code> dep entirely might be kind of hard though</p>



<a name="423463045"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/407292-cargo-component/topic/wasi%20crate%20%22hello%20world%22%20not%20working/near/423463045" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Huene <a href="https://bytecodealliance.github.io/zulip-archive/stream/407292-cargo-component/topic/wasi.20crate.20.22hello.20world.22.20not.20working.html#423463045">(Feb 26 2024 at 18:54)</a>:</h4>
<p>it would also prevent such problems where users use the <code>wit-bindgen rust</code> CLI and reference a mismatched <code>wit-bindgen</code> in their <code>Cargo.toml</code></p>



<a name="423463124"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/407292-cargo-component/topic/wasi%20crate%20%22hello%20world%22%20not%20working/near/423463124" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/407292-cargo-component/topic/wasi.20crate.20.22hello.20world.22.20not.20working.html#423463124">(Feb 26 2024 at 18:55)</a>:</h4>
<p>if we could define <code>cabi_realloc</code> in a reasonable way I think we could delete the crate entirely</p>



<a name="423463140"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/407292-cargo-component/topic/wasi%20crate%20%22hello%20world%22%20not%20working/near/423463140" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/407292-cargo-component/topic/wasi.20crate.20.22hello.20world.22.20not.20working.html#423463140">(Feb 26 2024 at 18:55)</a>:</h4>
<p>modulo <code>bitflags!</code> I suppose</p>



<a name="423463827"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/407292-cargo-component/topic/wasi%20crate%20%22hello%20world%22%20not%20working/near/423463827" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Huene <a href="https://bytecodealliance.github.io/zulip-archive/stream/407292-cargo-component/topic/wasi.20crate.20.22hello.20world.22.20not.20working.html#423463827">(Feb 26 2024 at 18:58)</a>:</h4>
<p>in the mean time, i'll update the <code>wit-bindgen</code> dependency of <code>cargo-component</code>, fix componentization to not require <code>[package.metadata.component]</code> (i.e. key off of the custom section), and fix examples (and other target crate-types) not being treated as bins when they should be for the purpose of adapter selection</p>



<a name="423464046"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/407292-cargo-component/topic/wasi%20crate%20%22hello%20world%22%20not%20working/near/423464046" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/407292-cargo-component/topic/wasi.20crate.20.22hello.20world.22.20not.20working.html#423464046">(Feb 26 2024 at 19:00)</a>:</h4>
<p>you know maybe this can be the <code>wasm32-wasip2</code> target in Rust</p>



<a name="423464057"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/407292-cargo-component/topic/wasi%20crate%20%22hello%20world%22%20not%20working/near/423464057" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/407292-cargo-component/topic/wasi.20crate.20.22hello.20world.22.20not.20working.html#423464057">(Feb 26 2024 at 19:00)</a>:</h4>
<p>it's got <code>cabi_realloc</code> built-in for us</p>



<a name="423464071"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/407292-cargo-component/topic/wasi%20crate%20%22hello%20world%22%20not%20working/near/423464071" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/407292-cargo-component/topic/wasi.20crate.20.22hello.20world.22.20not.20working.html#423464071">(Feb 26 2024 at 19:00)</a>:</h4>
<p>then <code>wit-bindgen</code> doesn't have to do anything</p>



<a name="423464236"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/407292-cargo-component/topic/wasi%20crate%20%22hello%20world%22%20not%20working/near/423464236" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/407292-cargo-component/topic/wasi.20crate.20.22hello.20world.22.20not.20working.html#423464236">(Feb 26 2024 at 19:01)</a>:</h4>
<p>ok yeah I'm gonna go change <code>wit-bindgen</code> to rely on nothing from the crate but macro things and <code>cabi_realloc</code></p>



<a name="423464956"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/407292-cargo-component/topic/wasi%20crate%20%22hello%20world%22%20not%20working/near/423464956" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Huene <a href="https://bytecodealliance.github.io/zulip-archive/stream/407292-cargo-component/topic/wasi.20crate.20.22hello.20world.22.20not.20working.html#423464956">(Feb 26 2024 at 19:05)</a>:</h4>
<p>hmm; the logic for componentization should be either 1) the <code>[package.metadata.component]</code> section is present, as the module might not have a component type in the case of default "bin" components that don't use bindings and expect a preview1 command adapter for <code>fn main</code> or 2) the module has a <code>component-type</code> CS</p>



<a name="423465108"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/407292-cargo-component/topic/wasi%20crate%20%22hello%20world%22%20not%20working/near/423465108" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/407292-cargo-component/topic/wasi.20crate.20.22hello.20world.22.20not.20working.html#423465108">(Feb 26 2024 at 19:06)</a>:</h4>
<p>that sounds reasonable to me yeah</p>



<a name="423465139"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/407292-cargo-component/topic/wasi%20crate%20%22hello%20world%22%20not%20working/near/423465139" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/407292-cargo-component/topic/wasi.20crate.20.22hello.20world.22.20not.20working.html#423465139">(Feb 26 2024 at 19:06)</a>:</h4>
<p>although the custom section only needs to have <code>component-type</code> as a prefix</p>



<a name="423465153"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/407292-cargo-component/topic/wasi%20crate%20%22hello%20world%22%20not%20working/near/423465153" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Huene <a href="https://bytecodealliance.github.io/zulip-archive/stream/407292-cargo-component/topic/wasi.20crate.20.22hello.20world.22.20not.20working.html#423465153">(Feb 26 2024 at 19:06)</a>:</h4>
<p>right</p>



<a name="423465629"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/407292-cargo-component/topic/wasi%20crate%20%22hello%20world%22%20not%20working/near/423465629" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Huene <a href="https://bytecodealliance.github.io/zulip-archive/stream/407292-cargo-component/topic/wasi.20crate.20.22hello.20world.22.20not.20working.html#423465629">(Feb 26 2024 at 19:09)</a>:</h4>
<p>it seems that the default bin project does include empty bindings with an "empty" component type, so it works even without a <code>[package.metadata.component]</code> section, so never mind</p>



<a name="423465645"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/407292-cargo-component/topic/wasi%20crate%20%22hello%20world%22%20not%20working/near/423465645" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Huene <a href="https://bytecodealliance.github.io/zulip-archive/stream/407292-cargo-component/topic/wasi.20crate.20.22hello.20world.22.20not.20working.html#423465645">(Feb 26 2024 at 19:09)</a>:</h4>
<p>just the custom section presence should work</p>



<a name="423467620"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/407292-cargo-component/topic/wasi%20crate%20%22hello%20world%22%20not%20working/near/423467620" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/407292-cargo-component/topic/wasi.20crate.20.22hello.20world.22.20not.20working.html#423467620">(Feb 26 2024 at 19:21)</a>:</h4>
<p>oh nice</p>



<a name="423481868"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/407292-cargo-component/topic/wasi%20crate%20%22hello%20world%22%20not%20working/near/423481868" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/407292-cargo-component/topic/wasi.20crate.20.22hello.20world.22.20not.20working.html#423481868">(Feb 26 2024 at 20:55)</a>:</h4>
<p>I've implemented <a href="https://github.com/bytecodealliance/wit-bindgen/pull/868">https://github.com/bytecodealliance/wit-bindgen/pull/868</a> for everything except <code>cabi_realloc</code></p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wit-bindgen/pull/868" style="background-image: url(https\:\/\/uploads\.zulipusercontent\.net\/bf593053975c02ea0a78f22a69d64319b88e087d\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f653163343433666235343534353233656637633338363636613663313336383032656139363062666664663834343061623865376636363431306638333638332f62797465636f6465616c6c69616e63652f7769742d62696e6467656e2f70756c6c2f383638)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wit-bindgen/pull/868" title="Move most of the `wit-bindgen` crate into generated code by alexcrichton · Pull Request #868 · bytecodealliance/wit-bindgen">Move most of the `wit-bindgen` crate into generated code by alexcrichton · Pull Request #868 · bytecodealliance/wit-bindgen</a></div><div class="message_embed_description">This PR is borne out of discussion on bytecodealliance/cargo-component#236 where the conclusion was that it'd be best if the generated code that wit-bindgen emits is largely standalone and doesn't ...</div></div></div>



<a name="424918160"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/407292-cargo-component/topic/wasi%20crate%20%22hello%20world%22%20not%20working/near/424918160" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts <a href="https://bytecodealliance.github.io/zulip-archive/stream/407292-cargo-component/topic/wasi.20crate.20.22hello.20world.22.20not.20working.html#424918160">(Mar 05 2024 at 17:10)</a>:</h4>
<p>Now that a new version of <code>cargo-component</code> has been published; does that also mean that we need to publish a new version of the <code>wasi</code> crate with the updated bindings?</p>



<a name="424918487"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/407292-cargo-component/topic/wasi%20crate%20%22hello%20world%22%20not%20working/near/424918487" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts <a href="https://bytecodealliance.github.io/zulip-archive/stream/407292-cargo-component/topic/wasi.20crate.20.22hello.20world.22.20not.20working.html#424918487">(Mar 05 2024 at 17:12)</a>:</h4>
<p>I was just trying out the new release of <code>cargo-component</code>, and am getting this error:</p>
<div class="codehilite" data-code-language="Text only"><pre><span></span><code>Error: failed to run main module `/Users/yosh/Code/wasm-http-tools/target/wasm32-wasi/debug/examples/main.wasm`

Caused by:
    0: import `wasi:http/types@0.2.0` has the wrong type
    1: instance export `fields` has the wrong type
    2: expected resource found nothing
</code></pre></div>
<p>This looks like WIT imports, but all my imports are going through the <code>wasi</code> crate. So I suspect it's probably something there?</p>



<a name="424918767"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/407292-cargo-component/topic/wasi%20crate%20%22hello%20world%22%20not%20working/near/424918767" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts <a href="https://bytecodealliance.github.io/zulip-archive/stream/407292-cargo-component/topic/wasi.20crate.20.22hello.20world.22.20not.20working.html#424918767">(Mar 05 2024 at 17:13)</a>:</h4>
<p>Oh lol, now seeing <a href="https://github.com/bytecodealliance/wasi/pull/80">https://github.com/bytecodealliance/wasi/pull/80</a> is up</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/wasi/pull/80" style="background-image: url(https\:\/\/uploads\.zulipusercontent\.net\/5240aff58c77f8207b8a5177f481f0a2befaf242\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f373435316463636432623132306233346463353630353635323366653266643762366434323336353231323937396163613934663763333562643037656237302f62797465636f6465616c6c69616e63652f776173692f70756c6c2f3830)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/wasi/pull/80" title="Update to wit-bindgen 0.20.0 by alexcrichton · Pull Request #80 · bytecodealliance/wasi">Update to wit-bindgen 0.20.0 by alexcrichton · Pull Request #80 · bytecodealliance/wasi</a></div><div class="message_embed_description">This commit updates the bindings generator to 0.20.0 and refactors the existing support for exporting macros to use the new features of 0.20.0 as well. The macros crate feature is now no longer req...</div></div></div>



<a name="424918783"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/407292-cargo-component/topic/wasi%20crate%20%22hello%20world%22%20not%20working/near/424918783" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts <a href="https://bytecodealliance.github.io/zulip-archive/stream/407292-cargo-component/topic/wasi.20crate.20.22hello.20world.22.20not.20working.html#424918783">(Mar 05 2024 at 17:13)</a>:</h4>
<p>Yeah okay, that would make sense!</p>



<a name="424919981"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/407292-cargo-component/topic/wasi%20crate%20%22hello%20world%22%20not%20working/near/424919981" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/407292-cargo-component/topic/wasi.20crate.20.22hello.20world.22.20not.20working.html#424919981">(Mar 05 2024 at 17:20)</a>:</h4>
<p>Is that error perhaps a missing <code>-S http</code> flag to <code>wasmtime run</code>?</p>



<a name="424920002"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/407292-cargo-component/topic/wasi%20crate%20%22hello%20world%22%20not%20working/near/424920002" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/407292-cargo-component/topic/wasi.20crate.20.22hello.20world.22.20not.20working.html#424920002">(Mar 05 2024 at 17:20)</a>:</h4>
<p>(by default the CLI doesn't give access to wasi-http)</p>



<a name="424920017"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/407292-cargo-component/topic/wasi%20crate%20%22hello%20world%22%20not%20working/near/424920017" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts <a href="https://bytecodealliance.github.io/zulip-archive/stream/407292-cargo-component/topic/wasi.20crate.20.22hello.20world.22.20not.20working.html#424920017">(Mar 05 2024 at 17:20)</a>:</h4>
<p>oh lol, yeah that would probably do it <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="424920026"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/407292-cargo-component/topic/wasi%20crate%20%22hello%20world%22%20not%20working/near/424920026" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts <a href="https://bytecodealliance.github.io/zulip-archive/stream/407292-cargo-component/topic/wasi.20crate.20.22hello.20world.22.20not.20working.html#424920026">(Mar 05 2024 at 17:20)</a>:</h4>
<p>I definitely forgot the flag</p>



<a name="424920552"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/407292-cargo-component/topic/wasi%20crate%20%22hello%20world%22%20not%20working/near/424920552" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts <a href="https://bytecodealliance.github.io/zulip-archive/stream/407292-cargo-component/topic/wasi.20crate.20.22hello.20world.22.20not.20working.html#424920552">(Mar 05 2024 at 17:23)</a>:</h4>
<p>Oh strange, if I do:</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>cargo<span class="w"> </span>component<span class="w"> </span>run<span class="w"> </span>--example<span class="w"> </span>main<span class="w"> </span>--<span class="w"> </span>-S<span class="w"> </span><span class="nv">http</span><span class="o">=</span>y
</code></pre></div>
<p>I still get the same error</p>



<a name="424920632"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/407292-cargo-component/topic/wasi%20crate%20%22hello%20world%22%20not%20working/near/424920632" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts <a href="https://bytecodealliance.github.io/zulip-archive/stream/407292-cargo-component/topic/wasi.20crate.20.22hello.20world.22.20not.20working.html#424920632">(Mar 05 2024 at 17:23)</a>:</h4>
<p>I mean; now that I'm realizing we still need to bump the <code>wasi</code> crate to the latest <code>wasm-bindgen</code> output it makes sense to me that it fails</p>



<a name="424920683"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/407292-cargo-component/topic/wasi%20crate%20%22hello%20world%22%20not%20working/near/424920683" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts <a href="https://bytecodealliance.github.io/zulip-archive/stream/407292-cargo-component/topic/wasi.20crate.20.22hello.20world.22.20not.20working.html#424920683">(Mar 05 2024 at 17:24)</a>:</h4>
<p>Curious how it's that error though</p>



<a name="424920773"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/407292-cargo-component/topic/wasi%20crate%20%22hello%20world%22%20not%20working/near/424920773" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/407292-cargo-component/topic/wasi.20crate.20.22hello.20world.22.20not.20working.html#424920773">(Mar 05 2024 at 17:24)</a>:</h4>
<p>I don't know whether that command passes the <code>-S</code> flag to wasmtime or the wasm binary itself, but I would guess the latter</p>



<a name="424920785"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/407292-cargo-component/topic/wasi%20crate%20%22hello%20world%22%20not%20working/near/424920785" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/407292-cargo-component/topic/wasi.20crate.20.22hello.20world.22.20not.20working.html#424920785">(Mar 05 2024 at 17:24)</a>:</h4>
<p>(others might know for sure though)</p>



<a name="424920871"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/407292-cargo-component/topic/wasi%20crate%20%22hello%20world%22%20not%20working/near/424920871" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://bytecodealliance.github.io/zulip-archive/stream/407292-cargo-component/topic/wasi.20crate.20.22hello.20world.22.20not.20working.html#424920871">(Mar 05 2024 at 17:25)</a>:</h4>
<p>In theory wasi I don't think should need an update, but I haven't checked on that in a bit</p>



<a name="424920923"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/407292-cargo-component/topic/wasi%20crate%20%22hello%20world%22%20not%20working/near/424920923" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts <a href="https://bytecodealliance.github.io/zulip-archive/stream/407292-cargo-component/topic/wasi.20crate.20.22hello.20world.22.20not.20working.html#424920923">(Mar 05 2024 at 17:25)</a>:</h4>
<p>In another example, this compiled correctly for me:</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>cargo<span class="w"> </span>component<span class="w"> </span>run<span class="w"> </span>--<span class="w"> </span>-S<span class="w"> </span><span class="nv">nn</span><span class="o">=</span>y<span class="w">  </span><span class="c1"># Run our app</span>
</code></pre></div>
<p>maybe there's something different when paired with <code>--example</code> ?</p>



<a name="424921061"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/407292-cargo-component/topic/wasi%20crate%20%22hello%20world%22%20not%20working/near/424921061" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts <a href="https://bytecodealliance.github.io/zulip-archive/stream/407292-cargo-component/topic/wasi.20crate.20.22hello.20world.22.20not.20working.html#424921061">(Mar 05 2024 at 17:26)</a>:</h4>
<p><span class="user-mention silent" data-user-id="253994">Alex Crichton</span> <a href="#narrow/stream/407292-cargo-component/topic/wasi.20crate.20.22hello.20world.22.20not.20working/near/424920871">said</a>:</p>
<blockquote>
<p>In theory wasi I don't think should need an update, but I haven't checked on that in a bit</p>
</blockquote>
<p>oh I see!</p>



<a name="424921085"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/407292-cargo-component/topic/wasi%20crate%20%22hello%20world%22%20not%20working/near/424921085" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts <a href="https://bytecodealliance.github.io/zulip-archive/stream/407292-cargo-component/topic/wasi.20crate.20.22hello.20world.22.20not.20working.html#424921085">(Mar 05 2024 at 17:26)</a>:</h4>
<p>haha, yeah don't worry about debugging this right now over Zulip</p>



<a name="424921129"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/407292-cargo-component/topic/wasi%20crate%20%22hello%20world%22%20not%20working/near/424921129" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts <a href="https://bytecodealliance.github.io/zulip-archive/stream/407292-cargo-component/topic/wasi.20crate.20.22hello.20world.22.20not.20working.html#424921129">(Mar 05 2024 at 17:26)</a>:</h4>
<p>I'll spend a bit more time poking at it to see what is causing the failure</p>



<a name="424921210"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/407292-cargo-component/topic/wasi%20crate%20%22hello%20world%22%20not%20working/near/424921210" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts <a href="https://bytecodealliance.github.io/zulip-archive/stream/407292-cargo-component/topic/wasi.20crate.20.22hello.20world.22.20not.20working.html#424921210">(Mar 05 2024 at 17:27)</a>:</h4>
<p>If I can't figure it out I'll bring back something more detailed</p>



<a name="424921237"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/407292-cargo-component/topic/wasi%20crate%20%22hello%20world%22%20not%20working/near/424921237" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts <a href="https://bytecodealliance.github.io/zulip-archive/stream/407292-cargo-component/topic/wasi.20crate.20.22hello.20world.22.20not.20working.html#424921237">(Mar 05 2024 at 17:27)</a>:</h4>
<p>(appreciate the help though!)</p>



<a name="424929072"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/407292-cargo-component/topic/wasi%20crate%20%22hello%20world%22%20not%20working/near/424929072" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Huene <a href="https://bytecodealliance.github.io/zulip-archive/stream/407292-cargo-component/topic/wasi.20crate.20.22hello.20world.22.20not.20working.html#424929072">(Mar 05 2024 at 18:09)</a>:</h4>
<p>The args passed after <code>--</code> are for the guest program and not the runner.  You may use <code>CARGO_TARGET_WASM32_WASI_RUNNER</code> to set the runner to use or <code>target.wasm32-wasi.runner</code> in <code>.cargo/config.toml</code></p>



<a name="424929183"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/407292-cargo-component/topic/wasi%20crate%20%22hello%20world%22%20not%20working/near/424929183" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Huene <a href="https://bytecodealliance.github.io/zulip-archive/stream/407292-cargo-component/topic/wasi.20crate.20.22hello.20world.22.20not.20working.html#424929183">(Mar 05 2024 at 18:10)</a>:</h4>
<p>although it appears we may not be respecting <code>CARGO_TARGET_WASM32_WASI_RUNNER</code> like we should be</p>



<a name="424929221"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/407292-cargo-component/topic/wasi%20crate%20%22hello%20world%22%20not%20working/near/424929221" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Huene <a href="https://bytecodealliance.github.io/zulip-archive/stream/407292-cargo-component/topic/wasi.20crate.20.22hello.20world.22.20not.20working.html#424929221">(Mar 05 2024 at 18:10)</a>:</h4>
<p><code>.cargo/config.toml</code> should work though</p>



<a name="424929377"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/407292-cargo-component/topic/wasi%20crate%20%22hello%20world%22%20not%20working/near/424929377" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Huene <a href="https://bytecodealliance.github.io/zulip-archive/stream/407292-cargo-component/topic/wasi.20crate.20.22hello.20world.22.20not.20working.html#424929377">(Mar 05 2024 at 18:11)</a>:</h4>
<p>oh never mind, the <code>cargo-config</code> crate handles sourcing from the environment variable for us</p>



<a name="424929391"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/407292-cargo-component/topic/wasi%20crate%20%22hello%20world%22%20not%20working/near/424929391" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Huene <a href="https://bytecodealliance.github.io/zulip-archive/stream/407292-cargo-component/topic/wasi.20crate.20.22hello.20world.22.20not.20working.html#424929391">(Mar 05 2024 at 18:11)</a>:</h4>
<p>both should work</p>



<a name="424930413"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/407292-cargo-component/topic/wasi%20crate%20%22hello%20world%22%20not%20working/near/424930413" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Huene <a href="https://bytecodealliance.github.io/zulip-archive/stream/407292-cargo-component/topic/wasi.20crate.20.22hello.20world.22.20not.20working.html#424930413">(Mar 05 2024 at 18:17)</a>:</h4>
<p>if you set <code>CARGO_COMPONENT_LOG=debug</code>, you'll see output for the runner it ends up spawning</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>