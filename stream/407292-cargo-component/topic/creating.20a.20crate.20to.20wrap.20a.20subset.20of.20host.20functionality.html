<html>
<head><meta charset="utf-8"><title>creating a crate to wrap a subset of host functionality · cargo-component · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/407292-cargo-component/index.html">cargo-component</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/407292-cargo-component/topic/creating.20a.20crate.20to.20wrap.20a.20subset.20of.20host.20functionality.html">creating a crate to wrap a subset of host functionality</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="396957006"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/407292-cargo-component/topic/creating%20a%20crate%20to%20wrap%20a%20subset%20of%20host%20functionality/near/396957006" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Dickinson <a href="https://bytecodealliance.github.io/zulip-archive/stream/407292-cargo-component/topic/creating.20a.20crate.20to.20wrap.20a.20subset.20of.20host.20functionality.html#396957006">(Oct 16 2023 at 18:37)</a>:</h4>
<p>Hi folks! I'm adding component model support for dylibso's observe-sdk and am running into <a href="https://github.com/bytecodealliance/cargo-component/issues/76">#76</a> – in particular, the observe SDK adds a set of functions to the host interface (<code>span-{enter,exit,tags}</code>, <code>log</code>, etc) and I'd like to wrap them in a crate.</p>
<p>I have two options – one of which is implemented in a PR <a href="https://github.com/dylibso/observe-sdk/pull/128/">here</a>.</p>
<ol>
<li>
<p>Provide an <code>observe-api</code> crate which links to the appropriate core-module-level functions. This effectively "puns" the canonical abi. This has some upsides and downsides. The main upside is that we can provide a higher-level abstraction over the generated WIT interface. Right now that looks like being able to gracefully map <code>log::Level</code> and other  enums to our WIT enums (which happen to be off-by-one.) I can see three downsides:  users can still access the unwrapped, generated bindings through <code>use bindings::dylibso::observe_sdk::api</code>, the crate is effectively punning the ABI – which might change, and users have to represent this as two dependencies (one crate-level on <code>observe-api</code>, and one at the <a href="http://component.target">component.target</a> level on the <code>observe.wit</code> <a href="https://github.com/dylibso/observe-sdk/pull/128/files#diff-666a7e3d608108d003a2a58b7b5e17ac4e34defcf83e3047e5f71b2d5851b011">bindings</a>)</p>
</li>
<li>
<p>Alternatively, we could hold off on making a crate for now &amp; provide user access exclusively through the <code>bindings::</code> api. This is workable, but pushes more work onto the observe api user – e.g., they have to cast <code>log::Level</code> to generated bindings::dylibso::observe_sdk::api::LogLevel` before calling, etc. We kind of lose a communication channel with folks using the API – in the sense that a crate would give us the usual affordances like release versioning, a CHANGELOG, etc.</p>
</li>
</ol>
<p>Ideally, I'd like to go with the first approach, with a stretch goal of having the <code>observe_api</code> crate somehow _contribute_ WIT interface imports automatically to dependent worlds. I'm not quite sure what that would look like, though. Would y'all have any recommendations for approaching this problem? Are there other folks solving something similar?</p>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/bytecodealliance/cargo-component/issues/76" style="background-image: url(https\:\/\/uploads\.zulipusercontent\.net\/c090ac8150526be6c558591f60dec6beab3c17cc\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f383065613438613637313631666131373539313533643132353561353665386435356532333061326162353264393933386437656235623433383262343065362f62797465636f6465616c6c69616e63652f636172676f2d636f6d706f6e656e742f6973737565732f3736)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/bytecodealliance/cargo-component/issues/76" title="Support bindings wrapper crates that can be used in component implementation crates · Issue #76 · bytecodealliance/cargo-component">Support bindings wrapper crates that can be used in component implementation crates · Issue #76 · bytecodealliance/cargo-component</a></div><div class="message_embed_description">This is a continuation of #75, which exposes the use case. Quoting @peterhuene here: For the feature request, I think it would be along the lines of: Allow component metadata in lib packages that a...</div></div></div><div class="message_embed"><a class="message_embed_image" href="https://github.com/dylibso/observe-sdk/pull/128/" style="background-image: url(https\:\/\/uploads\.zulipusercontent\.net\/7c1726c6aa31edc41f0228adc7998a4dad96343b\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f376536636263366334333437313163626264656130333165663034336333313265663365363632623032333836336635376465363836373032363334393463622f64796c6962736f2f6f6273657276652d73646b2f70756c6c2f313238)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/dylibso/observe-sdk/pull/128/" title="feat(component): wip component model support by chrisdickinson · Pull Request #128 · dylibso/observe-sdk">feat(component): wip component model support by chrisdickinson · Pull Request #128 · dylibso/observe-sdk</a></div><div class="message_embed_description">upgrade to wasmtime&gt;=13, wasmtime_wasi&gt;=13
the component model necessitated splitting the adapter setup into two parts: first creating the adapter so it can be associated with the state, then telli...</div></div></div><div class="message_embed"><a class="message_embed_image" href="https://github.com/dylibso/observe-sdk/pull/128/files#diff-666a7e3d608108d003a2a58b7b5e17ac4e34defcf83e3047e5f71b2d5851b011" style="background-image: url(https\:\/\/uploads\.zulipusercontent\.net\/4edd70f971eed03c3e4997d04fa23ee78b4223d8\/68747470733a2f2f617661746172732e67697468756275736572636f6e74656e742e636f6d2f752f33373330333f733d34303026763d34)"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/dylibso/observe-sdk/pull/128/files#diff-666a7e3d608108d003a2a58b7b5e17ac4e34defcf83e3047e5f71b2d5851b011" title="feat(component): wip component model support by chrisdickinson · Pull Request #128 · dylibso/observe-sdk">feat(component): wip component model support by chrisdickinson · Pull Request #128 · dylibso/observe-sdk</a></div><div class="message_embed_description">upgrade to wasmtime&gt;=13, wasmtime_wasi&gt;=13
the component model necessitated splitting the adapter setup into two parts: first creating the adapter so it can be associated with the state, then...</div></div></div>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>