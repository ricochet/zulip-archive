[
    {
        "content": "<p>Hello!<br>\nI want to define a custom world that I use as a service interface between different WASM apps. But I also want to give those apps access to WASI. I thought this should be enough to make it work:</p>\n<div class=\"codehilite\" data-code-language=\"wit\"><pre><span></span><code>world imports {\n    // Our custom WIT world.\n    import game;\n\n    // Some of the base WASI worlds for file access and more. Makes it possible to rely on `stdlib` in\n    // various languages.\n    include wasi:filesystem@0.2.0;\n    include wasi:io@0.2.0;\n}\n</code></pre></div>\n<p>(where <code>game</code> is an interface). But when using <code>wasmtime</code> to generate the binding code for the host, I get an error saying that <code>/</code> was expected instead of <code>@</code>. I assume my syntax for the <code>include</code> statement is wrong. But I could not find any code that showcases how to import existing worlds.</p>\n<p>This is the code I use in Rust to create the wasmtime bindgen:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">wasmtime</span><span class=\"p\">::</span><span class=\"n\">component</span><span class=\"p\">::</span><span class=\"n\">bindgen</span><span class=\"o\">!</span><span class=\"p\">({</span>\n<span class=\"w\">    </span><span class=\"n\">path</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"./wit/world.wit\"</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"n\">world</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"world\"</span><span class=\"p\">,</span>\n<span class=\"p\">});</span>\n</code></pre></div>\n<p>Thank yoU!</p>",
        "id": 442841274,
        "sender_full_name": "mainrs",
        "timestamp": 1717606244
    },
    {
        "content": "<p>Ah, sorry! The error I got was </p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">error</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">resolve</span><span class=\"w\"> </span><span class=\"n\">directory</span><span class=\"w\"> </span><span class=\"k\">while</span><span class=\"w\"> </span><span class=\"n\">parsing</span><span class=\"w\"> </span><span class=\"n\">WIT</span><span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"n\">path</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">me</span><span class=\"o\">/</span><span class=\"n\">code</span><span class=\"o\">/</span><span class=\"n\">plugin</span><span class=\"o\">-</span><span class=\"n\">host</span><span class=\"o\">/</span><span class=\"n\">wit</span><span class=\"p\">]</span>\n\n<span class=\"w\">       </span><span class=\"n\">Caused</span><span class=\"w\"> </span><span class=\"n\">by</span><span class=\"p\">:</span>\n<span class=\"w\">           </span><span class=\"nc\">package</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">found</span>\n<span class=\"w\">                </span><span class=\"o\">-</span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">me</span><span class=\"o\">/</span><span class=\"n\">code</span><span class=\"o\">/</span><span class=\"n\">plugin</span><span class=\"o\">-</span><span class=\"n\">host</span><span class=\"o\">/</span><span class=\"n\">wit</span><span class=\"o\">/</span><span class=\"n\">world</span><span class=\"p\">.</span><span class=\"n\">wit</span><span class=\"p\">:</span><span class=\"mi\">9</span><span class=\"p\">:</span><span class=\"mi\">13</span>\n<span class=\"w\">                 </span><span class=\"o\">|</span>\n<span class=\"w\">               </span><span class=\"mi\">9</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\">     </span><span class=\"n\">include</span><span class=\"w\"> </span><span class=\"n\">wasi</span><span class=\"p\">:</span><span class=\"nc\">filesystem</span><span class=\"o\">/</span><span class=\"n\">filesystem</span><span class=\"o\">@</span><span class=\"mf\">0.2.0</span><span class=\"p\">;</span>\n<span class=\"w\">                 </span><span class=\"o\">|</span><span class=\"w\">                        </span><span class=\"o\">^--------------</span>\n</code></pre></div>\n<p>I fixed the other one above earlier.  Do I have to clone the WASI Wit files and put them next to my world?</p>",
        "id": 442844406,
        "sender_full_name": "mainrs",
        "timestamp": 1717606974
    },
    {
        "content": "<p>Yeah for now you'll need to copy the <code>*.wit</code> files for WASI into your project</p>",
        "id": 442845637,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1717607255
    },
    {
        "content": "<p>(it's something we hope to improve in the future though)</p>",
        "id": 442845675,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1717607263
    },
    {
        "content": "<p>At the end, my world looks like this:</p>\n<div class=\"codehilite\" data-code-language=\"wit\"><pre><span></span><code>package ugl:plugin;\n\nworld ugl {\n    // Our custom WIT world.\n    import game;\n\n    include wasi:filesystem/imports@0.2.0;\n    include wasi:io/imports@0.2.0;\n</code></pre></div>\n<p>Do I need to exclude the WASI worlds from bindgen? It looks like a bunch of types are generated for these worlds. At the end, I plan to use the existing wasmtime_wasi library that already implement the host part.</p>",
        "id": 442878411,
        "sender_full_name": "mainrs",
        "timestamp": 1717617247
    },
    {
        "content": "<p>You can use the <code>with</code> keyword to point the wasi bits over to the <code>wasmtime_wasi</code> crate, but you can also omit it entirely with a separate world passed to wasmtime's bindgen</p>",
        "id": 442879153,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1717617460
    },
    {
        "content": "<p>I really appreciate your help! Getting started with WASI and the component model is quite hard for me tbh.<br>\nI added the <code>with</code> statement:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">wasmtime</span><span class=\"p\">::</span><span class=\"n\">component</span><span class=\"p\">::</span><span class=\"n\">bindgen</span><span class=\"o\">!</span><span class=\"p\">({</span>\n<span class=\"w\">    </span><span class=\"n\">world</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"ugl\"</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"n\">with</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"s\">\"wasi:filesystem\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">wasmtime_wasi</span><span class=\"p\">::</span><span class=\"n\">bindings</span><span class=\"p\">::</span><span class=\"n\">filesystem</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"s\">\"wasi:io\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">wasmtime_wasi</span><span class=\"p\">::</span><span class=\"n\">bindings</span><span class=\"p\">::</span><span class=\"n\">io</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"p\">},</span>\n<span class=\"p\">});</span>\n</code></pre></div>\n<p>And it seems to work. I only get <code>add_to_linker</code> function references are missing. It sounds like the codegen relies on the function being imported inside the scope. But every module exports their own <code>add_to_linker_get_host</code> function. So I am not sure how I can satisfy this condition for the <code>io</code> and <code>filesystem</code>. It looks to me like they both expect that their respective <code>add_to_linker</code> functions are in scope.</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"err\">‚ùØ</span><span class=\"w\"> </span><span class=\"n\">cargo</span><span class=\"w\"> </span><span class=\"n\">check</span>\n<span class=\"w\">    </span><span class=\"n\">Checking</span><span class=\"w\"> </span><span class=\"n\">ugl</span><span class=\"o\">-</span><span class=\"n\">plugin</span><span class=\"o\">-</span><span class=\"n\">api</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"p\">.</span><span class=\"mf\">1.0</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">me</span><span class=\"o\">/</span><span class=\"n\">code</span><span class=\"o\">/</span><span class=\"n\">plugin</span><span class=\"o\">-</span><span class=\"n\">host</span><span class=\"p\">)</span>\n<span class=\"n\">error</span><span class=\"p\">[</span><span class=\"n\">E0425</span><span class=\"p\">]:</span><span class=\"w\"> </span><span class=\"nc\">cannot</span><span class=\"w\"> </span><span class=\"n\">find</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">add_to_linker</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">module</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">__with_name1</span><span class=\"p\">::</span><span class=\"n\">error</span><span class=\"err\">`</span>\n<span class=\"w\"> </span><span class=\"o\">-</span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nc\">src</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">1</span><span class=\"p\">:</span><span class=\"mi\">1</span>\n<span class=\"w\">  </span><span class=\"o\">|</span>\n<span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"p\">::</span><span class=\"n\">component</span><span class=\"p\">::</span><span class=\"n\">bindgen</span><span class=\"o\">!</span><span class=\"p\">({</span>\n<span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\">     </span><span class=\"n\">world</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"ugl\"</span><span class=\"p\">,</span>\n<span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\">     </span><span class=\"n\">with</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"mi\">4</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\">         </span><span class=\"s\">\"wasi:filesystem\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">wasmtime_wasi</span><span class=\"p\">::</span><span class=\"n\">bindings</span><span class=\"p\">::</span><span class=\"n\">filesystem</span><span class=\"p\">,</span>\n<span class=\"mi\">5</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\">         </span><span class=\"s\">\"wasi:io\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">wasmtime_wasi</span><span class=\"p\">::</span><span class=\"n\">bindings</span><span class=\"p\">::</span><span class=\"n\">io</span><span class=\"p\">,</span>\n<span class=\"mi\">6</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\">     </span><span class=\"p\">},</span>\n<span class=\"mi\">7</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"p\">});</span>\n<span class=\"w\">  </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"n\">__</span><span class=\"o\">^</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">found</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">__with_name1</span><span class=\"p\">::</span><span class=\"n\">error</span><span class=\"err\">`</span>\n<span class=\"w\">  </span><span class=\"o\">|</span>\n<span class=\"w\">  </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">note</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">this</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"w\"> </span><span class=\"n\">originates</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"kr\">macro</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">wasmtime</span><span class=\"p\">::</span><span class=\"n\">component</span><span class=\"p\">::</span><span class=\"n\">bindgen</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">Nightly</span><span class=\"w\"> </span><span class=\"n\">builds</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">with</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">Z</span><span class=\"w\"> </span><span class=\"kr\">macro</span><span class=\"o\">-</span><span class=\"n\">backtrace</span><span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"n\">more</span><span class=\"w\"> </span><span class=\"n\">info</span><span class=\"p\">)</span>\n<span class=\"n\">help</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">consider</span><span class=\"w\"> </span><span class=\"n\">importing</span><span class=\"w\"> </span><span class=\"n\">one</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">these</span><span class=\"w\"> </span><span class=\"n\">items</span>\n<span class=\"w\">  </span><span class=\"o\">|</span>\n<span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"k\">crate</span><span class=\"p\">::</span><span class=\"n\">ugl</span><span class=\"p\">::</span><span class=\"n\">plugin</span><span class=\"p\">::</span><span class=\"n\">game</span><span class=\"p\">::</span><span class=\"n\">add_to_linker</span><span class=\"p\">;</span>\n<span class=\"w\">  </span><span class=\"o\">|</span>\n<span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"k\">crate</span><span class=\"p\">::</span><span class=\"n\">wasi</span><span class=\"p\">::</span><span class=\"n\">clocks</span><span class=\"p\">::</span><span class=\"n\">wall_clock</span><span class=\"p\">::</span><span class=\"n\">add_to_linker</span><span class=\"p\">;</span>\n<span class=\"w\">  </span><span class=\"o\">|</span>\n<span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">wasmtime_wasi</span><span class=\"p\">::</span><span class=\"n\">preview0</span><span class=\"p\">::</span><span class=\"n\">wasi_unstable</span><span class=\"p\">::</span><span class=\"n\">add_to_linker</span><span class=\"p\">;</span>\n<span class=\"w\">  </span><span class=\"o\">|</span>\n<span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">wasmtime_wasi</span><span class=\"p\">::</span><span class=\"n\">preview1</span><span class=\"p\">::</span><span class=\"n\">wasi_snapshot_preview1</span><span class=\"p\">::</span><span class=\"n\">add_to_linker</span><span class=\"p\">;</span>\n<span class=\"w\">  </span><span class=\"o\">|</span>\n\n<span class=\"n\">error</span><span class=\"p\">[</span><span class=\"n\">E0425</span><span class=\"p\">]:</span><span class=\"w\"> </span><span class=\"nc\">cannot</span><span class=\"w\"> </span><span class=\"n\">find</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">add_to_linker</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">module</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">__with_name1</span><span class=\"p\">::</span><span class=\"n\">poll</span><span class=\"err\">`</span>\n<span class=\"w\"> </span><span class=\"o\">-</span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nc\">src</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">1</span><span class=\"p\">:</span><span class=\"mi\">1</span>\n<span class=\"w\">  </span><span class=\"o\">|</span>\n<span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"p\">::</span><span class=\"n\">component</span><span class=\"p\">::</span><span class=\"n\">bindgen</span><span class=\"o\">!</span><span class=\"p\">({</span>\n<span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\">     </span><span class=\"n\">world</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"ugl\"</span><span class=\"p\">,</span>\n<span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\">     </span><span class=\"n\">with</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"mi\">4</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\">         </span><span class=\"s\">\"wasi:filesystem\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">wasmtime_wasi</span><span class=\"p\">::</span><span class=\"n\">bindings</span><span class=\"p\">::</span><span class=\"n\">filesystem</span><span class=\"p\">,</span>\n<span class=\"mi\">5</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\">         </span><span class=\"s\">\"wasi:io\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">wasmtime_wasi</span><span class=\"p\">::</span><span class=\"n\">bindings</span><span class=\"p\">::</span><span class=\"n\">io</span><span class=\"p\">,</span>\n<span class=\"mi\">6</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\">     </span><span class=\"p\">},</span>\n<span class=\"mi\">7</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"p\">});</span>\n<span class=\"w\">  </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"n\">__</span><span class=\"o\">^</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">found</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">__with_name1</span><span class=\"p\">::</span><span class=\"n\">poll</span><span class=\"err\">`</span>\n<span class=\"w\">  </span><span class=\"o\">|</span>\n<span class=\"w\">  </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">note</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">this</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"w\"> </span><span class=\"n\">originates</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"kr\">macro</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">wasmtime</span><span class=\"p\">::</span><span class=\"n\">component</span><span class=\"p\">::</span><span class=\"n\">bindgen</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">Nightly</span><span class=\"w\"> </span><span class=\"n\">builds</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">with</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">Z</span><span class=\"w\"> </span><span class=\"kr\">macro</span><span class=\"o\">-</span><span class=\"n\">backtrace</span><span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"n\">more</span><span class=\"w\"> </span><span class=\"n\">info</span><span class=\"p\">)</span>\n<span class=\"n\">help</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">consider</span><span class=\"w\"> </span><span class=\"n\">importing</span><span class=\"w\"> </span><span class=\"n\">one</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">these</span><span class=\"w\"> </span><span class=\"n\">items</span>\n<span class=\"w\">  </span><span class=\"o\">|</span>\n<span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"k\">crate</span><span class=\"p\">::</span><span class=\"n\">ugl</span><span class=\"p\">::</span><span class=\"n\">plugin</span><span class=\"p\">::</span><span class=\"n\">game</span><span class=\"p\">::</span><span class=\"n\">add_to_linker</span><span class=\"p\">;</span>\n<span class=\"w\">  </span><span class=\"o\">|</span>\n<span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"k\">crate</span><span class=\"p\">::</span><span class=\"n\">wasi</span><span class=\"p\">::</span><span class=\"n\">clocks</span><span class=\"p\">::</span><span class=\"n\">wall_clock</span><span class=\"p\">::</span><span class=\"n\">add_to_linker</span><span class=\"p\">;</span>\n<span class=\"w\">  </span><span class=\"o\">|</span>\n<span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">wasmtime_wasi</span><span class=\"p\">::</span><span class=\"n\">preview0</span><span class=\"p\">::</span><span class=\"n\">wasi_unstable</span><span class=\"p\">::</span><span class=\"n\">add_to_linker</span><span class=\"p\">;</span>\n<span class=\"w\">  </span><span class=\"o\">|</span>\n<span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">wasmtime_wasi</span><span class=\"p\">::</span><span class=\"n\">preview1</span><span class=\"p\">::</span><span class=\"n\">wasi_snapshot_preview1</span><span class=\"p\">::</span><span class=\"n\">add_to_linker</span><span class=\"p\">;</span>\n</code></pre></div>\n<blockquote>\n<p>but you can also omit it entirely with a separate world passed to wasmtime's bindgen</p>\n</blockquote>\n<p>I do not understand this part.</p>",
        "id": 442884022,
        "sender_full_name": "mainrs",
        "timestamp": 1717618823
    },
    {
        "content": "<p>Ah yes that compile error is fixed in Wasmtime 22, that was a bug in Wasmtime 21</p>",
        "id": 442884579,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1717618974
    },
    {
        "content": "<p>For separating the world that would involve having a second <code>world</code> in WIT which doesn't have WASI, and that's what you use for bindgen. You'd then have a \"real\" world which would import wasi and <code>include</code> this world</p>",
        "id": 442884695,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1717619010
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"253994\">Alex Crichton</span> <a href=\"#narrow/stream/217126-wasmtime/topic/Having.20trouble.20composing.20worlds/near/442884579\">said</a>:</p>\n<blockquote>\n<p>Ah yes that compile error is fixed in Wasmtime 22, that was a bug in Wasmtime 21</p>\n</blockquote>\n<p>My <code>wasmtime</code> dependency is using the git repository's main branch directly. Using that I got the above error.</p>\n<div class=\"codehilite\" data-code-language=\"TOML\"><pre><span></span><code><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">git</span><span class=\"w\"> </span><span class=\"p\">=</span><span class=\"w\"> </span><span class=\"s2\">\"https://github.com/bytecodealliance/wasmtime\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">features</span><span class=\"w\"> </span><span class=\"p\">=</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"s2\">\"component-model\"</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"p\">}</span>\n<span class=\"n\">wasmtime-wasi</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"s2\">\"21.0.1\"</span><span class=\"w\"> </span><span class=\"c1\">#  {git = \"https://github.com/bytecodealliance/wasmtime\" }</span>\n</code></pre></div>\n<p>Using the git repository <code>wasmtime-wasi</code> dependency complains about non-matching types for the T in Linker&lt;T&gt;.</p>",
        "id": 443069033,
        "sender_full_name": "mainrs",
        "timestamp": 1717682643
    },
    {
        "content": "<p>You probably need to pin all wasmtime* deps to the same revision, e.g.</p>\n<div class=\"codehilite\" data-code-language=\"TOML\"><pre><span></span><code><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">git</span><span class=\"w\"> </span><span class=\"p\">=</span><span class=\"w\"> </span><span class=\"s2\">\"https://github.com/bytecodealliance/wasmtime\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">rev</span><span class=\"w\"> </span><span class=\"p\">=</span><span class=\"w\"> </span><span class=\"s2\">\"23409ca7e184ef3b7d42fe17938caed470643d5d\"</span><span class=\"w\"> </span><span class=\"p\">}</span>\n<span class=\"n\">wasmtime-wasi</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">git</span><span class=\"w\"> </span><span class=\"p\">=</span><span class=\"w\"> </span><span class=\"s2\">\"https://github.com/bytecodealliance/wasmtime\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">rev</span><span class=\"w\"> </span><span class=\"p\">=</span><span class=\"w\"> </span><span class=\"s2\">\"23409ca7e184ef3b7d42fe17938caed470643d5d\"</span><span class=\"w\"> </span><span class=\"p\">}</span>\n</code></pre></div>",
        "id": 443069490,
        "sender_full_name": "Lann Martin",
        "timestamp": 1717682804
    }
]