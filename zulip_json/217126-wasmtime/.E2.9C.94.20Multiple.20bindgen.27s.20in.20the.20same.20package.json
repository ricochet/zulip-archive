[
    {
        "content": "<p>Greetings, I would like to bind with the imports inside a module and then use these inside other modules.</p>\n<p>I have the following WIT definition:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">world</span><span class=\"w\"> </span><span class=\"n\">sensor</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"n\">wasi</span>:<span class=\"nc\">i2c</span><span class=\"o\">/</span><span class=\"n\">i2c</span><span class=\"o\">@</span><span class=\"mf\">0.2.0</span><span class=\"o\">-</span><span class=\"n\">draft</span><span class=\"p\">;</span>\n\n<span class=\"w\">    </span><span class=\"n\">export</span><span class=\"w\"> </span><span class=\"n\">hts</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n\n<span class=\"n\">world</span><span class=\"w\"> </span><span class=\"n\">screen</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"n\">wasi</span>:<span class=\"nc\">i2c</span><span class=\"o\">/</span><span class=\"n\">i2c</span><span class=\"o\">@</span><span class=\"mf\">0.2.0</span><span class=\"o\">-</span><span class=\"n\">draft</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"n\">wasi</span>:<span class=\"nc\">i2c</span><span class=\"o\">/</span><span class=\"n\">delay</span><span class=\"o\">@</span><span class=\"mf\">0.2.0</span><span class=\"o\">-</span><span class=\"n\">draft</span><span class=\"p\">;</span>\n\n<span class=\"w\">    </span><span class=\"n\">export</span><span class=\"w\"> </span><span class=\"n\">lcd</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p>(<code>hts</code> and <code>lcd</code> are interfaces that export some functions)</p>\n<p>I have a <code>device.rs</code> with inside the following bindgen invocation:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">bindgen</span><span class=\"o\">!</span><span class=\"p\">({</span>\n<span class=\"w\">    </span><span class=\"n\">path</span>: <span class=\"s\">\"../wit/deps/i2c\"</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"n\">world</span>: <span class=\"s\">\"wasi:i2c/imports\"</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"n\">with</span>: <span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"s\">\"wasi:i2c/delay/delay\"</span>: <span class=\"nc\">Delay</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"s\">\"wasi:i2c/i2c/i2c\"</span>: <span class=\"nc\">I2c</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n<span class=\"p\">});</span>\n</code></pre></div>\n<p>And then I have a <code>sensor.rs</code> with the following invocation:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">bindgen</span><span class=\"o\">!</span><span class=\"p\">({</span>\n<span class=\"w\">    </span><span class=\"n\">path</span>: <span class=\"s\">\"../wit\"</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"n\">world</span>: <span class=\"s\">\"sensor\"</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"n\">with</span>: <span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"s\">\"wasi:i2c/i2c/i2c\"</span>: <span class=\"nc\">I2c</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n<span class=\"p\">});</span>\n</code></pre></div>\n<p>But I get the following error:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">error</span><span class=\"p\">[</span><span class=\"n\">E0364</span><span class=\"p\">]</span>: <span class=\"err\">`</span><span class=\"n\">I2c</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">private</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">and</span><span class=\"w\"> </span><span class=\"n\">cannot</span><span class=\"w\"> </span><span class=\"n\">be</span><span class=\"w\"> </span><span class=\"n\">re</span><span class=\"o\">-</span><span class=\"n\">exported</span>\n<span class=\"w\">  </span><span class=\"o\">-</span>-&gt; <span class=\"nc\">src</span><span class=\"o\">/</span><span class=\"n\">sensor</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">14</span>:<span class=\"mi\">1</span>\n<span class=\"w\">   </span><span class=\"o\">|</span>\n<span class=\"mi\">14</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"w\"> </span><span class=\"n\">bindgen</span><span class=\"o\">!</span><span class=\"p\">({</span>\n<span class=\"mi\">15</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\">     </span><span class=\"n\">path</span>: <span class=\"s\">\"../wit\"</span><span class=\"p\">,</span>\n<span class=\"mi\">16</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\">     </span><span class=\"n\">world</span>: <span class=\"s\">\"sensor\"</span><span class=\"p\">,</span>\n<span class=\"mi\">17</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\">     </span><span class=\"n\">with</span>: <span class=\"p\">{</span>\n<span class=\"mi\">18</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\">         </span><span class=\"s\">\"wasi:i2c/i2c/i2c\"</span>: <span class=\"nc\">I2c</span><span class=\"p\">,</span>\n<span class=\"mi\">19</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\">     </span><span class=\"p\">}</span>\n<span class=\"mi\">20</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"p\">});</span>\n<span class=\"w\">   </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"n\">__</span><span class=\"o\">^</span>\n<span class=\"w\">   </span><span class=\"o\">|</span>\n<span class=\"n\">note</span>: <span class=\"nc\">consider</span><span class=\"w\"> </span><span class=\"n\">marking</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">I2c</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"k\">pub</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">imported</span><span class=\"w\"> </span><span class=\"n\">module</span>\n<span class=\"w\">  </span><span class=\"o\">-</span>-&gt; <span class=\"nc\">src</span><span class=\"o\">/</span><span class=\"n\">sensor</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">14</span>:<span class=\"mi\">1</span>\n<span class=\"w\">   </span><span class=\"o\">|</span>\n<span class=\"mi\">14</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"w\"> </span><span class=\"n\">bindgen</span><span class=\"o\">!</span><span class=\"p\">({</span>\n<span class=\"mi\">15</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\">     </span><span class=\"n\">path</span>: <span class=\"s\">\"../wit\"</span><span class=\"p\">,</span>\n<span class=\"mi\">16</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\">     </span><span class=\"n\">world</span>: <span class=\"s\">\"sensor\"</span><span class=\"p\">,</span>\n<span class=\"mi\">17</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\">     </span><span class=\"n\">with</span>: <span class=\"p\">{</span>\n<span class=\"mi\">18</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\">         </span><span class=\"s\">\"wasi:i2c/i2c/i2c\"</span>: <span class=\"nc\">I2c</span><span class=\"p\">,</span>\n<span class=\"mi\">19</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\">     </span><span class=\"p\">}</span>\n<span class=\"mi\">20</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"p\">});</span>\n<span class=\"w\">   </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"n\">__</span><span class=\"o\">^</span>\n<span class=\"w\">   </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">note</span>: <span class=\"nc\">this</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"w\"> </span><span class=\"n\">originates</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"kr\">macro</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">bindgen</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">Nightly</span><span class=\"w\"> </span><span class=\"n\">builds</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">with</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">Z</span><span class=\"w\"> </span><span class=\"kr\">macro</span><span class=\"o\">-</span><span class=\"n\">backtrace</span><span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"n\">more</span><span class=\"w\"> </span><span class=\"n\">info</span><span class=\"p\">)</span>\n</code></pre></div>\n<p>I'm not sure why I get this error, nor how to resolve it. The I2c definition: <code>pub struct I2c(pub I2cdev);</code> and if I inline the macro the error becomes:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">error</span><span class=\"p\">[</span><span class=\"n\">E0364</span><span class=\"p\">]</span>: <span class=\"err\">`</span><span class=\"n\">I2c</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">private</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">and</span><span class=\"w\"> </span><span class=\"n\">cannot</span><span class=\"w\"> </span><span class=\"n\">be</span><span class=\"w\"> </span><span class=\"n\">re</span><span class=\"o\">-</span><span class=\"n\">exported</span>\n<span class=\"w\">   </span><span class=\"o\">-</span>-&gt; <span class=\"nc\">src</span><span class=\"o\">/</span><span class=\"n\">sensor</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">221</span>:<span class=\"mi\">21</span>\n<span class=\"w\">    </span><span class=\"o\">|</span>\n<span class=\"mi\">221</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\">             </span><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"k\">super</span>::<span class=\"k\">super</span>::<span class=\"k\">super</span>::<span class=\"n\">I2c</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"o\">|</span><span class=\"w\">                     </span><span class=\"o\">^^^^^^^^^^^^^^^^^^^^^^^^</span>\n<span class=\"w\">    </span><span class=\"o\">|</span>\n<span class=\"n\">note</span>: <span class=\"nc\">consider</span><span class=\"w\"> </span><span class=\"n\">marking</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">I2c</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"k\">pub</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">imported</span><span class=\"w\"> </span><span class=\"n\">module</span>\n<span class=\"w\">   </span><span class=\"o\">-</span>-&gt; <span class=\"nc\">src</span><span class=\"o\">/</span><span class=\"n\">sensor</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">221</span>:<span class=\"mi\">21</span>\n<span class=\"w\">    </span><span class=\"o\">|</span>\n<span class=\"mi\">221</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\">             </span><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"k\">super</span>::<span class=\"k\">super</span>::<span class=\"k\">super</span>::<span class=\"n\">I2c</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"o\">|</span>\n</code></pre></div>\n<p>Does anyone have any clues on what I could to debug further, or how to resolve this?</p>",
        "id": 432235933,
        "sender_full_name": "Friedrich Vandenberghe",
        "timestamp": 1712668041
    },
    {
        "content": "<p>how is I2c declared? and where?  it should be <code>pub struct I2c</code> -(edit) I see the declaration now - still would try enhancing the <code>with</code></p>\n<p>you may also want to be more specific given that you're generating an interface named I2c - so change your <code>with: ...</code> to <code>fully_qualified::path::to::I2c</code> - the error messages will be better at any rate if you do that</p>",
        "id": 432244747,
        "sender_full_name": "Jeff Schilling",
        "timestamp": 1712670107
    },
    {
        "content": "<p>also <code>cargo expand</code> is super helpful in these cases in my experience</p>",
        "id": 432245319,
        "sender_full_name": "Jeff Schilling",
        "timestamp": 1712670224
    },
    {
        "content": "<p>My guess is that the world sensor should export i2c, given that you use <code>with</code> here to associate with your implementation.</p>",
        "id": 432276817,
        "sender_full_name": "Christof Petig",
        "timestamp": 1712677616
    },
    {
        "content": "<p>Oh, I guess that you should either use import exclusive or with for a given interface.</p>",
        "id": 432277335,
        "sender_full_name": "Christof Petig",
        "timestamp": 1712677759
    },
    {
        "content": "<p>Also I first guessed that this would be the host side, if you target the guest please use a more recent wit-bindgen (I don't see the export! macro and with no longer applies with newer versions)</p>",
        "id": 432278126,
        "sender_full_name": "Christof Petig",
        "timestamp": 1712677967
    },
    {
        "content": "<blockquote>\n<p>you may also want to be more specific given that you're generating an interface named I2c - so change your <code>with: ...</code> to <code>fully_qualified::path::to::I2c</code> - the error messages will be better at any rate if you do that</p>\n</blockquote>\n<p>This fixed it! I honestly did not expect that such a simple change could fix it <span aria-label=\"happy\" class=\"emoji emoji-1f600\" role=\"img\" title=\"happy\">:happy:</span></p>",
        "id": 432891245,
        "sender_full_name": "Friedrich Vandenberghe",
        "timestamp": 1712924232
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"661362\">Friedrich Vandenberghe</span> has marked this topic as resolved.</p>",
        "id": 432894506,
        "sender_full_name": "Notification Bot",
        "timestamp": 1712925356
    }
]