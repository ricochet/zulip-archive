[
    {
        "content": "<p>Hi, I am trying to identify what is missing in Wasmtime to be able to run <code>.wasm</code> files generated by Kotlin/Wasm (currently in early stage, only V8 is supported).</p>\n<p>Kotlin/Wasm requires the following proposals:</p>\n<ul>\n<li>Non-trapping float-to-int operations (supported)</li>\n<li>Reference types (supported)</li>\n<li>Exception handling (not supported yet, related issue <a href=\"https://github.com/bytecodealliance/wasmtime/issues/3427\">gh-3427</a>, mentioned in <a href=\"https://github.com/bytecodealliance/rfcs/blob/main/accepted/cranelift-roadmap-2022.md#exception-handling\">Cranelift 2022 roadmap</a>)</li>\n<li>Typed function references (not supported yet?)</li>\n<li>GC (not supported yet, GC improvement issue <a href=\"https://github.com/bytecodealliance/wasmtime/issues/2459\">gh-2459</a> but maybe unrelated, mentioned in <a href=\"https://github.com/bytecodealliance/rfcs/blob/main/accepted/cranelift-roadmap-2022.md#garbage-collection-gc\">Cranelift 2022 roadmap</a>)</li>\n</ul>\n<p>I would be interested to know for the unsupported proposals if related work is already planned in 2022 (especially outside of Cranelift) and the areas where specific help would be welcomed.</p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/bytecodealliance/wasmtime/issues/3427\" style=\"background-image: url(https\\:\\/\\/uploads\\.zulipusercontent\\.net\\/f62ba6fa3ffe804a748a154d453ef6a557527ed5\\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f343037653835626162323730613961616630353135376430613435643731656438313534386366626131316334326563666264663430633261306530336231652f62797465636f6465616c6c69616e63652f7761736d74696d652f6973737565732f33343237)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/bytecodealliance/wasmtime/issues/3427\" title=\"Implementation strategy for the Exception Handling proposal · Issue #3427 · bytecodealliance/wasmtime\">Implementation strategy for the Exception Handling proposal · Issue #3427 · bytecodealliance/wasmtime</a></div><div class=\"message_embed_description\">I&#39;ve been interested in having the Exception Handling proposal supported in Wasmtime, so I looked into possible ways to implement it. There&#39;s been some prior discussion in issues #2049 and ...</div></div></div><div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/bytecodealliance/rfcs/blob/main/accepted/cranelift-roadmap-2022.md#exception-handling\" style=\"background-image: url(https\\:\\/\\/uploads\\.zulipusercontent\\.net\\/bfa3e48d9d9173ac61d6c859c731cc9859707e87\\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f616234353333383338393165643239396538623236636261323133666438616236323563646463363436333438393332633038656261373736303966653538322f62797465636f6465616c6c69616e63652f72666373)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/bytecodealliance/rfcs/blob/main/accepted/cranelift-roadmap-2022.md#exception-handling\" title=\"rfcs/cranelift-roadmap-2022.md at main · bytecodealliance/rfcs\">rfcs/cranelift-roadmap-2022.md at main · bytecodealliance/rfcs</a></div><div class=\"message_embed_description\">RFC process for Bytecode Alliance projects. Contribute to bytecodealliance/rfcs development by creating an account on GitHub.</div></div></div><div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/bytecodealliance/wasmtime/issues/2459\" style=\"background-image: url(https\\:\\/\\/uploads\\.zulipusercontent\\.net\\/74e822f6934da9600401f9ade590854ddfdba0c0\\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f343565653933633332353632393935643261643165653133306538333338343439666532333737613164393361336538343039353330356537633036303537322f62797465636f6465616c6c69616e63652f7761736d74696d652f6973737565732f32343539)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/bytecodealliance/wasmtime/issues/2459\" title=\"Implement wasmtime GC tracing without libunwind · Issue #2459 · bytecodealliance/wasmtime\">Implement wasmtime GC tracing without libunwind · Issue #2459 · bytecodealliance/wasmtime</a></div><div class=\"message_embed_description\">In wasmtime, GC tracing of reftype pointers currently works by using libunwind to iterate over stack frames, fetching a stackmap for each relevant PC and finding the stack slots with live pointers....</div></div></div><div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/bytecodealliance/rfcs/blob/main/accepted/cranelift-roadmap-2022.md#garbage-collection-gc\" style=\"background-image: url(https\\:\\/\\/uploads\\.zulipusercontent\\.net\\/bfa3e48d9d9173ac61d6c859c731cc9859707e87\\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f616234353333383338393165643239396538623236636261323133666438616236323563646463363436333438393332633038656261373736303966653538322f62797465636f6465616c6c69616e63652f72666373)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/bytecodealliance/rfcs/blob/main/accepted/cranelift-roadmap-2022.md#garbage-collection-gc\" title=\"rfcs/cranelift-roadmap-2022.md at main · bytecodealliance/rfcs\">rfcs/cranelift-roadmap-2022.md at main · bytecodealliance/rfcs</a></div><div class=\"message_embed_description\">RFC process for Bytecode Alliance projects. Contribute to bytecodealliance/rfcs development by creating an account on GitHub.</div></div></div>",
        "id": 275273829,
        "sender_full_name": "Sébastien Deleuze",
        "timestamp": 1647280391
    },
    {
        "content": "<p>Hi Sébastien <span aria-label=\"wave\" class=\"emoji emoji-1f44b\" role=\"img\" title=\"wave\">:wave:</span> Very exciting to hear that you're looking into enabling Kotlin on Wasmtime!</p>\n<p>We're definitely interested in supporting this work, and I'll say a few more things about the specific features below. But at a higher level, it might be good to join our <a href=\"https://github.com/bytecodealliance/wasmtime/tree/main/meetings/wasmtime\">biweekly Wasmtime calls</a> and put this on the agenda there, so we can discuss how best to proceed. We'd gladly facilitate work on all of these, and help in whichever way we can <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span></p>\n<p>On the specific required but not-yet-supported proposals:</p>\n<ul>\n<li>Exception handling is indeed not yet supported. We have a contributor who was potentially interested in working on it and should coordinate with her, but fundamentally would be interested in help on this.</li>\n<li>Typed Function References are also not supported. Adding them shouldn't be too much work, and might be a great task to take on for someone wanting to familiarize themselves with the codebase. We'd be more than happy to mentor someone on this.</li>\n<li>GC isn't currently too high a priority for us, because of how unstable the proposal still is. However, we'd very gladly mentor someone working on this, and provide reviews and other support. It'd probably make sense to start with discussing the overall approach, then implementing fundamental GC support, and only then starting with the aspects specific to the proposal, including the type system, etc</li>\n</ul>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/bytecodealliance/wasmtime/tree/main/meetings/wasmtime\" style=\"background-image: url(https\\:\\/\\/uploads\\.zulipusercontent\\.net\\/e6d58c259e023b68e554138184f5501301025754\\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f383162636436663831626237316632363863616637316461353036656238386537653535323538633236323139323637373532663330633830383064393433342f62797465636f6465616c6c69616e63652f7761736d74696d65)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/bytecodealliance/wasmtime/tree/main/meetings/wasmtime\" title=\"wasmtime/meetings/wasmtime at main · bytecodealliance/wasmtime\">wasmtime/meetings/wasmtime at main · bytecodealliance/wasmtime</a></div><div class=\"message_embed_description\">Standalone JIT-style runtime for WebAssembly, using Cranelift - wasmtime/meetings/wasmtime at main · bytecodealliance/wasmtime</div></div></div>",
        "id": 275365017,
        "sender_full_name": "Till Schneidereit",
        "timestamp": 1647347025
    },
    {
        "content": "<p>Thanks for your feedback, I will join the biweekly meeting shortly to discuss that with you and the wider team.</p>",
        "id": 275406862,
        "sender_full_name": "Sébastien Deleuze",
        "timestamp": 1647365197
    },
    {
        "content": "<p>FYI I have created <a href=\"https://github.com/WebAssembly/binaryen/issues/4590\">this related feature request</a> on Binaryen side (GC to non GC conversion) since that would enable Kotlin/Dart support by \"just\" implementing exception handling support in Wasmtime. Feel free to add your <span aria-label=\"+1\" class=\"emoji emoji-1f44d\" role=\"img\" title=\"+1\">:+1:</span>  in the GitHub issue if you like the idea.</p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/WebAssembly/binaryen/issues/4590\" style=\"background-image: url(https\\:\\/\\/uploads\\.zulipusercontent\\.net\\/eaf7f46c8422d08a3158980216093cba3de23e32\\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f343132653130666137393763613231636331613437626438316436643263386464313635643462323935613566396230356361646231346439376230646439392f576562417373656d626c792f62696e617279656e2f6973737565732f34353930)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/WebAssembly/binaryen/issues/4590\" title=\"Support GC to non-GC conversion · Issue #4590 · WebAssembly/binaryen\">Support GC to non-GC conversion · Issue #4590 · WebAssembly/binaryen</a></div><div class=\"message_embed_description\">Hi, As far as I know, a few GCed languages/platform are working on WASM support by leveraging the GC proposal: Dart Kotlin C#/.NET (even if they seems capable to generate non GC output) For now onl...</div></div></div>",
        "id": 278536374,
        "sender_full_name": "Sébastien Deleuze",
        "timestamp": 1649674587
    }
]