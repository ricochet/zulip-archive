[
    {
        "content": "<p>Is it possible for me to share data from the context of the linker into the state of a registered function?</p>\n<p>For example:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"k\">fn</span> <span class=\"nf\">register</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"o\">&gt;</span><span class=\"p\">(</span><span class=\"n\">linker</span>: <span class=\"nc\">Linker</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"o\">&gt;</span><span class=\"p\">)</span><span class=\"w\"> </span>-&gt; <span class=\"nb\">Result</span><span class=\"o\">&lt;</span><span class=\"p\">()</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">counter</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">opentelemetry</span>::<span class=\"n\">counter</span><span class=\"p\">(</span><span class=\"s\">\"some-count\"</span><span class=\"p\">);</span>\n<span class=\"w\">    </span><span class=\"n\">linker</span><span class=\"p\">.</span><span class=\"n\">func_wrap</span><span class=\"p\">(</span><span class=\"s\">\"my::module\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">\"register\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">register</span><span class=\"p\">)</span><span class=\"o\">?</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"c1\">// Register function has no way of accessing the counter?</span>\n<span class=\"w\">    </span><span class=\"nb\">Ok</span><span class=\"p\">(())</span>\n<span class=\"p\">}</span>\n\n<span class=\"k\">fn</span> <span class=\"nf\">register</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"o\">&gt;</span><span class=\"p\">(</span><span class=\"n\">caller</span>: <span class=\"nc\">Caller</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"o\">&gt;</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"c1\">// I want to access the counter from here to increment it</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p>I'm considering using some kind of global state for this, but was wondering if there's a better way?</p>",
        "id": 347577383,
        "sender_full_name": "Ari Seyhun",
        "timestamp": 1680848171
    },
    {
        "content": "<p>That's possible, yeah, because the argument to <code>func_wrap</code> is a closure, but you'll probably find it more convenient to store such state within the <code>T</code> of the <code>Store&lt;T&gt;</code> as then you can avoid mutexes/locks/etc</p>",
        "id": 347579608,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1680849163
    }
]