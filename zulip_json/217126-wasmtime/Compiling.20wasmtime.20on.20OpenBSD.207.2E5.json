[
    {
        "content": "<p>Tried to do a 'cargo install wasmtime-cli' on an OpenBSD 7.5 where I have cargo (cargo 1.76.0) and even cargo-component (cargo-component 0.13.2 (wasi:040ec92)) compiled. But as OpenBSD is not an OS that is compiled for very often, no surprise it didn't work. Any suggestions how I should proceed given this first error?</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"w\">   </span><span class=\"n\">Compiling</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">wasi</span><span class=\"w\"> </span><span class=\"n\">v22</span><span class=\"p\">.</span><span class=\"mf\">0.0</span>\n<span class=\"n\">error</span><span class=\"p\">[</span><span class=\"n\">E0425</span><span class=\"p\">]:</span><span class=\"w\"> </span><span class=\"nc\">cannot</span><span class=\"w\"> </span><span class=\"n\">find</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">set_tcp_keepidle</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">module</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">sockopt</span><span class=\"err\">`</span>\n<span class=\"w\">    </span><span class=\"o\">-</span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">frank</span><span class=\"o\">/</span><span class=\"p\">.</span><span class=\"n\">cargo</span><span class=\"o\">/</span><span class=\"n\">registry</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">index</span><span class=\"p\">.</span><span class=\"n\">crates</span><span class=\"p\">.</span><span class=\"n\">io</span><span class=\"o\">-</span><span class=\"mi\">6</span><span class=\"n\">f17d22bba15001f</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">wasi</span><span class=\"o\">-</span><span class=\"mf\">22.0.0</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">host</span><span class=\"o\">/</span><span class=\"n\">network</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">409</span><span class=\"p\">:</span><span class=\"mi\">18</span>\n<span class=\"w\">     </span><span class=\"o\">|</span>\n<span class=\"mi\">409</span><span class=\"w\">  </span><span class=\"o\">|</span><span class=\"w\">         </span><span class=\"n\">sockopt</span><span class=\"p\">::</span><span class=\"n\">set_tcp_keepidle</span><span class=\"p\">(</span>\n<span class=\"w\">     </span><span class=\"o\">|</span><span class=\"w\">                  </span><span class=\"o\">^^^^^^^^^^^^^^^^</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">found</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">sockopt</span><span class=\"err\">`</span>\n<span class=\"w\">     </span><span class=\"o\">|</span>\n<span class=\"n\">note</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">found</span><span class=\"w\"> </span><span class=\"n\">an</span><span class=\"w\"> </span><span class=\"n\">item</span><span class=\"w\"> </span><span class=\"n\">that</span><span class=\"w\"> </span><span class=\"n\">was</span><span class=\"w\"> </span><span class=\"n\">configured</span><span class=\"w\"> </span><span class=\"n\">out</span>\n<span class=\"w\">    </span><span class=\"o\">-</span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">frank</span><span class=\"o\">/</span><span class=\"p\">.</span><span class=\"n\">cargo</span><span class=\"o\">/</span><span class=\"n\">registry</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">index</span><span class=\"p\">.</span><span class=\"n\">crates</span><span class=\"p\">.</span><span class=\"n\">io</span><span class=\"o\">-</span><span class=\"mi\">6</span><span class=\"n\">f17d22bba15001f</span><span class=\"o\">/</span><span class=\"n\">rustix</span><span class=\"o\">-</span><span class=\"mf\">0.38.34</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">net</span><span class=\"o\">/</span><span class=\"n\">sockopt</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">1192</span><span class=\"p\">:</span><span class=\"mi\">8</span>\n<span class=\"w\">     </span><span class=\"o\">|</span>\n<span class=\"mi\">1192</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"w\"> </span><span class=\"nf\">set_tcp_keepidle</span><span class=\"o\">&lt;</span><span class=\"n\">Fd</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">AsFd</span><span class=\"o\">&gt;</span><span class=\"p\">(</span><span class=\"n\">fd</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">Fd</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">value</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">Duration</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nc\">io</span><span class=\"p\">::</span><span class=\"nb\">Result</span><span class=\"o\">&lt;</span><span class=\"p\">()</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">     </span><span class=\"o\">|</span><span class=\"w\">        </span><span class=\"o\">^^^^^^^^^^^^^^^^</span>\n<span class=\"n\">help</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">consider</span><span class=\"w\"> </span><span class=\"n\">importing</span><span class=\"w\"> </span><span class=\"n\">this</span><span class=\"w\"> </span><span class=\"n\">function</span>\n<span class=\"w\">     </span><span class=\"o\">|</span>\n<span class=\"mi\">221</span><span class=\"w\">  </span><span class=\"o\">+</span><span class=\"w\">     </span><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"k\">crate</span><span class=\"p\">::</span><span class=\"n\">host</span><span class=\"p\">::</span><span class=\"n\">network</span><span class=\"p\">::</span><span class=\"n\">util</span><span class=\"p\">::</span><span class=\"n\">set_tcp_keepidle</span><span class=\"p\">;</span>\n<span class=\"w\">     </span><span class=\"o\">|</span>\n<span class=\"n\">help</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">if</span><span class=\"w\"> </span><span class=\"n\">you</span><span class=\"w\"> </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">set_tcp_keepidle</span><span class=\"err\">`</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">refer</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">it</span><span class=\"w\"> </span><span class=\"n\">directly</span>\n<span class=\"w\">     </span><span class=\"o\">|</span>\n<span class=\"mi\">409</span><span class=\"w\">  </span><span class=\"o\">-</span><span class=\"w\">         </span><span class=\"n\">sockopt</span><span class=\"p\">::</span><span class=\"n\">set_tcp_keepidle</span><span class=\"p\">(</span>\n<span class=\"mi\">409</span><span class=\"w\">  </span><span class=\"o\">+</span><span class=\"w\">         </span><span class=\"n\">set_tcp_keepidle</span><span class=\"p\">(</span>\n<span class=\"w\">     </span><span class=\"o\">|</span>\n</code></pre></div>",
        "id": 447564814,
        "sender_full_name": "Frank Rehwinkel",
        "timestamp": 1719516248
    },
    {
        "content": "<p>you'll probably want a <code>#[cfg]</code> on that line in wasmtime-wasi to return an error on OpenBSD</p>",
        "id": 447565722,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1719516551
    },
    {
        "content": "<p>and in general the path I took when I bulldozed through and got openbsd working at one point was to either add the relevant syscall support in the rustix/cap-std universe of crates, or conditionalize more as Alex says</p>",
        "id": 447566001,
        "sender_full_name": "Chris Fallin",
        "timestamp": 1719516677
    },
    {
        "content": "<p>modern wasmtime has more in its default config, e.g. <code>wasmtime serve</code>, that might make this a bit harder; if needed you could build without those features as well</p>",
        "id": 447566074,
        "sender_full_name": "Chris Fallin",
        "timestamp": 1719516702
    },
    {
        "content": "<p>Good point. I should start with a minimal feature set and see if it can compile, and then add features to get a lay of the land.</p>",
        "id": 447566329,
        "sender_full_name": "Frank Rehwinkel",
        "timestamp": 1719516777
    }
]