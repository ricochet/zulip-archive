[
    {
        "content": "<p>I'm about to enable the merge queue which means that no one will be able to merge anything until the first PR merges, and after the first PR merges everyone will have to rebase on that PR to ensure that their PR CI is running the right CI to get added to the queue.</p>\n<p>I'll post here once I actually update the branch protections.</p>",
        "id": 328312125,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1676573517
    },
    {
        "content": "<p>I plan to do it within the next half hour though</p>",
        "id": 328312200,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1676573528
    },
    {
        "content": "<p>hm ok, actually gonna update the settings now, so nothing will be able to merge for a bit while <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5766\">https://github.com/bytecodealliance/wasmtime/pull/5766</a> is testing</p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/bytecodealliance/wasmtime/pull/5766\" style=\"background-image: url(https\\:\\/\\/uploads\\.zulipusercontent\\.net\\/60e8544ec393fd9ed2d0f37691ac67d96e0f64c8\\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f656532383336353564383739373936376237616662313339336637663536303134646131326265626534353862666261666532613764633066396239393437352f62797465636f6465616c6c69616e63652f7761736d74696d652f70756c6c2f35373636)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/bytecodealliance/wasmtime/pull/5766\" title=\"Update CI to use GitHub's Merge Queue by alexcrichton · Pull Request #5766 · bytecodealliance/wasmtime\">Update CI to use GitHub's Merge Queue by alexcrichton · Pull Request #5766 · bytecodealliance/wasmtime</a></div><div class=\"message_embed_description\">GitHub recently made its merge queue feature available for use in public repositories owned by organizations meaning that the Wasmtime repository is a candidate for using this. GitHub's Merge Queue...</div></div></div>",
        "id": 328313350,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1676573896
    },
    {
        "content": "<p>I'm realizing now I forgot to write up documentation, so I'll do that once this merges as well</p>",
        "id": 328314459,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1676574231
    },
    {
        "content": "<p>ok queue is turned on and 5766 is in the queue</p>",
        "id": 328317606,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1676575140
    },
    {
        "content": "<p>Is there a way to actually watch the CI run for the merge queue? It doesn't seem like the \"Merge Queue\" view provides it</p>",
        "id": 328319929,
        "sender_full_name": "Chris Fallin",
        "timestamp": 1676575900
    },
    {
        "content": "<p>ah, nevermind, you can get to it from the toplevel actions list</p>",
        "id": 328320095,
        "sender_full_name": "Chris Fallin",
        "timestamp": 1676575949
    },
    {
        "content": "<p>once you make it to the <a href=\"https://github.com/bytecodealliance/wasmtime/queue/main\">merge queue page</a> which is itself hard to find:</p>\n<ul>\n<li>Click \"Queued\" in the <a href=\"https://github.com/bytecodealliance/wasmtime/pulls?page=1&amp;q=is%3Apr+is%3Aopen\">PR list</a> for something queued</li>\n<li>Or click on \"28 branches\" on the repo homepage and <a href=\"https://github.com/bytecodealliance/wasmtime/branches\">click on the \"1 PR to merge\"</a> link there</li>\n</ul>\n<p>but on that page you can click the little icon that looks like a paper with a checkmark to...</p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/bytecodealliance/wasmtime/queue/main\" style=\"background-image: url(https\\:\\/\\/uploads\\.zulipusercontent\\.net\\/b5e10a0f83e419d2648838c8ed717ecc6c676daf\\/68747470733a2f2f6769746875622e6769746875626173736574732e636f6d2f696d616765732f6d6f64756c65732f6f70656e5f67726170682f6769746875622d6f63746f6361742e706e67)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/bytecodealliance/wasmtime/queue/main\" title=\"Build software better, together\">Build software better, together</a></div><div class=\"message_embed_description\">GitHub is where people build software. More than 100 million people use GitHub to discover, fork, and contribute to over 330 million projects.</div></div></div><div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/bytecodealliance/wasmtime/pulls?page=1&amp;q=is%3Apr+is%3Aopen\" style=\"background-image: url(https\\:\\/\\/uploads\\.zulipusercontent\\.net\\/044d49b81ebb3c1ffbfa559c15fe3d273c9384b8\\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f646432376439333432363136383837646533353165633830306630373465613037356239323836336635616562623565663463653762323261303234643437382f62797465636f6465616c6c69616e63652f7761736d74696d65)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/bytecodealliance/wasmtime/pulls?page=1&amp;q=is%3Apr+is%3Aopen\" title=\"Pull requests · bytecodealliance/wasmtime\">Pull requests · bytecodealliance/wasmtime</a></div><div class=\"message_embed_description\">A fast and secure runtime for WebAssembly. Contribute to bytecodealliance/wasmtime development by creating an account on GitHub.</div></div></div><div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/bytecodealliance/wasmtime/branches\" style=\"background-image: url(https\\:\\/\\/uploads\\.zulipusercontent\\.net\\/044d49b81ebb3c1ffbfa559c15fe3d273c9384b8\\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f646432376439333432363136383837646533353165633830306630373465613037356239323836336635616562623565663463653762323261303234643437382f62797465636f6465616c6c69616e63652f7761736d74696d65)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/bytecodealliance/wasmtime/branches\" title=\"Branches · bytecodealliance/wasmtime\">Branches · bytecodealliance/wasmtime</a></div><div class=\"message_embed_description\">A fast and secure runtime for WebAssembly. Contribute to bytecodealliance/wasmtime development by creating an account on GitHub.</div></div></div>",
        "id": 328320288,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1676576023
    },
    {
        "content": "<p>ok I forget that it doesn't actually show it there any more</p>",
        "id": 328320308,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1676576032
    },
    {
        "content": "<p>in any case you can click on the \"Actions\" tab and <a href=\"https://github.com/bytecodealliance/wasmtime/actions/runs/4197428209/jobs/7279733679\">this is the build</a> for the merge</p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/bytecodealliance/wasmtime/actions/runs/4197428209/jobs/7279733679\" style=\"background-image: url(https\\:\\/\\/uploads\\.zulipusercontent\\.net\\/044d49b81ebb3c1ffbfa559c15fe3d273c9384b8\\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f646432376439333432363136383837646533353165633830306630373465613037356239323836336635616562623565663463653762323261303234643437382f62797465636f6465616c6c69616e63652f7761736d74696d65)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/bytecodealliance/wasmtime/actions/runs/4197428209/jobs/7279733679\" title=\"Update CI to use GitHub's Merge Queue (#5766) · bytecodealliance/wasmtime@1efee4a\">Update CI to use GitHub's Merge Queue (#5766) · bytecodealliance/wasmtime@1efee4a</a></div><div class=\"message_embed_description\">A fast and secure runtime for WebAssembly. Contribute to bytecodealliance/wasmtime development by creating an account on GitHub.</div></div></div>",
        "id": 328320398,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1676576060
    },
    {
        "content": "<p>none of this is surfaced in the PR UI AFAIK</p>",
        "id": 328320412,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1676576066
    },
    {
        "content": "<p>ok I just added \"Rustfmt\" as a required check</p>",
        "id": 328320582,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1676576128
    },
    {
        "content": "<p>so if you click the paper-with-checkmark icon the \"Rustfmt\" job should always be there if it's been queued up and you can click \"Details\" to go to the full build</p>",
        "id": 328320635,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1676576146
    },
    {
        "content": "<p>(I don't think that the UI is great here)</p>",
        "id": 328320672,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1676576159
    },
    {
        "content": "<p>CI has passed now, waiting for the queue to pick it up</p>",
        "id": 328324328,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1676577391
    },
    {
        "content": "<p>and it's merged!</p>",
        "id": 328324401,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1676577411
    },
    {
        "content": "<p>I've rebased and queued <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5797\">https://github.com/bytecodealliance/wasmtime/pull/5797</a> now</p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/bytecodealliance/wasmtime/pull/5797\" style=\"background-image: url(https\\:\\/\\/uploads\\.zulipusercontent\\.net\\/71b7d6ee8b003b08d8d67d2e7a69ffab574cc69d\\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f343439643139353436653833316462326561623265626232373134643430373766326462616637643862346532653734343138323163396331363566386535612f62797465636f6465616c6c69616e63652f7761736d74696d652f70756c6c2f35373937)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/bytecodealliance/wasmtime/pull/5797\" title=\"x64: Improve codegen for vectors with constant shift amounts by alexcrichton · Pull Request #5797 · bytecodealliance/wasmtime\">x64: Improve codegen for vectors with constant shift amounts by alexcrichton · Pull Request #5797 · bytecodealliance/wasmtime</a></div><div class=\"message_embed_description\">I stumbled across this working on #5795 and figured this was a nice opportunity to improve the codegen here.</div></div></div>",
        "id": 328324647,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1676577482
    },
    {
        "content": "<p>CInis failing due to rate limits. I need to go to the vet right now so I'll be back in a bit. I think this is the issue labeler job eating all our capacity. I'll try disabling that when I get back</p>",
        "id": 328327099,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1676578276
    },
    {
        "content": "<p>ah, I didn't realize the labeler took away CI capacity. Slightly spicy hot take: if we're CI-bound and talking about finding funding for additional resources etc, maybe we disable it permanently?</p>",
        "id": 328327527,
        "sender_full_name": "Chris Fallin",
        "timestamp": 1676578443
    },
    {
        "content": "<p>(I wonder if there are other ways to get labels, external bots or somesuch; alternately it's not the worst thing in the world to apply labels when creating a PR)</p>",
        "id": 328327655,
        "sender_full_name": "Chris Fallin",
        "timestamp": 1676578498
    },
    {
        "content": "<p>I am supposed to be engaged in finding you all more capacity in some form. I have failed in the current \"who's leaving their job\" environment. I'll see what I can do here.</p>",
        "id": 328328753,
        "sender_full_name": "Ralph",
        "timestamp": 1676578921
    },
    {
        "content": "<p>I'm not certain the labeler is the issue it's just a hunch at this point. If it's the problem I'll give it its own dedicated token which should have a separate rate limit</p>",
        "id": 328330272,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1676579532
    },
    {
        "content": "<p>Ok looking like fewer failures so I'll look into a separate token for the labeler job</p>",
        "id": 328335520,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1676581469
    },
    {
        "content": "<p>We can also turn down the frequency of the issue labeler to every hour or something, fwiw. The jobs last like a couple minutes last time I checked though, so it would be surprising if they were using up any significant amount of our capacity...</p>",
        "id": 328335558,
        "sender_full_name": "fitzgen (he/him)",
        "timestamp": 1676581484
    },
    {
        "content": "<p>oh its about API rate limits? in that case, in addition to scheduling it less often, we can make it process fewer issues per run</p>",
        "id": 328335806,
        "sender_full_name": "fitzgen (he/him)",
        "timestamp": 1676581557
    },
    {
        "content": "<p>The labeler scrapes all open prs and issues right?</p>",
        "id": 328335915,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1676581581
    },
    {
        "content": "<p>not all, there is a configurable number, 40 by default iirc</p>",
        "id": 328335967,
        "sender_full_name": "fitzgen (he/him)",
        "timestamp": 1676581598
    },
    {
        "content": "<p>I'm not sure of the interval of the rate limit and if it's blowing the whole limit in one run or repeated runs in the interval</p>",
        "id": 328335977,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1676581603
    },
    {
        "content": "<p>Wow if it's just 40 we shouldn't be anywhere near rate limits</p>",
        "id": 328336060,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1676581632
    },
    {
        "content": "<p>We've had a lot of historical issues with rate limits that are transient that I've never bottomed out</p>",
        "id": 328336101,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1676581649
    },
    {
        "content": "<p><a href=\"https://github.com/bytecodealliance/label-messager-action/blob/main/action.yml#L10-L12\">https://github.com/bytecodealliance/label-messager-action/blob/main/action.yml#L10-L12</a></p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/bytecodealliance/label-messager-action/blob/main/action.yml#L10-L12\" style=\"background-image: url(https\\:\\/\\/uploads\\.zulipusercontent\\.net\\/c2322456edd13f409c2cdc2c04e86109a928828f\\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f323238666561323130666665623034303134626230373164383538666230383331376561356439343830373033626135646433666663356430333336323862612f62797465636f6465616c6c69616e63652f6c6162656c2d6d657373616765722d616374696f6e)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/bytecodealliance/label-messager-action/blob/main/action.yml#L10-L12\" title=\"label-messager-action/action.yml at main · bytecodealliance/label-messager-action\">label-messager-action/action.yml at main · bytecodealliance/label-messager-action</a></div><div class=\"message_embed_description\">Automatically leave a message when an issue or pull request has a certain label - label-messager-action/action.yml at main · bytecodealliance/label-messager-action</div></div></div>",
        "id": 328336305,
        "sender_full_name": "fitzgen (he/him)",
        "timestamp": 1676581715
    },
    {
        "content": "<p><a href=\"https://github.com/bytecodealliance/subscribe-to-label-action/blob/main/action.yml#L10-L12\">https://github.com/bytecodealliance/subscribe-to-label-action/blob/main/action.yml#L10-L12</a></p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/bytecodealliance/subscribe-to-label-action/blob/main/action.yml#L10-L12\" style=\"background-image: url(https\\:\\/\\/uploads\\.zulipusercontent\\.net\\/2f31ea3215420a31ec6ec1907372c4ad89819ee1\\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f396531643662353939313134303661323166383731646163336463343365343037393839346539653032653732643665306664616435363131303630386237332f62797465636f6465616c6c69616e63652f7375627363726962652d746f2d6c6162656c2d616374696f6e)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/bytecodealliance/subscribe-to-label-action/blob/main/action.yml#L10-L12\" title=\"subscribe-to-label-action/action.yml at main · bytecodealliance/subscribe-to-label-action\">subscribe-to-label-action/action.yml at main · bytecodealliance/subscribe-to-label-action</a></div><div class=\"message_embed_description\">A GitHub action that allows users to subscribe to a label and automatically get @&#39;d when the label is applied - subscribe-to-label-action/action.yml at main · bytecodealliance/subscribe-to-labe...</div></div></div>",
        "id": 328336354,
        "sender_full_name": "fitzgen (he/him)",
        "timestamp": 1676581737
    },
    {
        "content": "<p>Hm ok the rate issue is probably totally unrelated then</p>",
        "id": 328337171,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1676582065
    },
    {
        "content": "<p>I'll reenable the labeler later</p>",
        "id": 328337193,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1676582077
    },
    {
        "content": "<p>Actually if that's not on the v1 tag we aren't using that</p>",
        "id": 328337388,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1676582146
    },
    {
        "content": "<p>And our triage workflow has other actions too</p>",
        "id": 328337407,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1676582154
    },
    {
        "content": "<p>So I'd need to dig into all of them</p>",
        "id": 328337467,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1676582164
    },
    {
        "content": "<p>so <a href=\"https://github.com/bytecodealliance/wasmtime/actions/runs/4197659201/jobs/7280265577\">this job</a> prints out headers which tells us that:</p>\n<ul>\n<li>the time of the PR to the time of the rate limit reset was 30m+</li>\n<li>from the <a href=\"https://github.com/bytecodealliance/wasmtime/actions/runs/4197608247/jobs/7280148973\">prior successful run</a> 200 api calls were used</li>\n</ul>\n<p>so once every 5m with 200+ calls per run I think could account for these issues</p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/bytecodealliance/wasmtime/actions/runs/4197659201/jobs/7280265577\" style=\"background-image: url(https\\:\\/\\/uploads\\.zulipusercontent\\.net\\/75a0532ce60429144b83b5c79679195442382330\\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f343339656536313361396166343133616236366565396533623136666364386231303738366237643335316337613439376362303834396334616533303066322f62797465636f6465616c6c69616e63652f7761736d74696d65)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/bytecodealliance/wasmtime/actions/runs/4197659201/jobs/7280265577\" title=\"Issue / PR Triage · bytecodealliance/wasmtime@80c147d\">Issue / PR Triage · bytecodealliance/wasmtime@80c147d</a></div><div class=\"message_embed_description\">A fast and secure runtime for WebAssembly. Contribute to bytecodealliance/wasmtime development by creating an account on GitHub.</div></div></div><div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/bytecodealliance/wasmtime/actions/runs/4197608247/jobs/7280148973\" style=\"background-image: url(https\\:\\/\\/uploads\\.zulipusercontent\\.net\\/75a0532ce60429144b83b5c79679195442382330\\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f343339656536313361396166343133616236366565396533623136666364386231303738366237643335316337613439376362303834396334616533303066322f62797465636f6465616c6c69616e63652f7761736d74696d65)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/bytecodealliance/wasmtime/actions/runs/4197608247/jobs/7280148973\" title=\"Issue / PR Triage · bytecodealliance/wasmtime@80c147d\">Issue / PR Triage · bytecodealliance/wasmtime@80c147d</a></div><div class=\"message_embed_description\">A fast and secure runtime for WebAssembly. Contribute to bytecodealliance/wasmtime development by creating an account on GitHub.</div></div></div>",
        "id": 328352132,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1676588093
    },
    {
        "content": "<p>I'll send a PR to run once an hour</p>",
        "id": 328352147,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1676588099
    },
    {
        "content": "<p>fwiw github turned down how frequent cron actions could be, so it was effectively set at 15 minutes</p>\n<p>all that stuff should be on the <code>v1</code> branch too, fwiw</p>",
        "id": 328353766,
        "sender_full_name": "fitzgen (he/him)",
        "timestamp": 1676588788
    }
]