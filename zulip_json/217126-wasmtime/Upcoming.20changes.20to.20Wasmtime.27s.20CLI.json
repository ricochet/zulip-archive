[
    {
        "content": "<p>I wanted to start a stream on Zulip about the upcoming changes to Wasmtime's CLI. This is here to serve a few purposes: </p>\n<ul>\n<li>Give everyone a heads up that this is happening</li>\n<li>Keep everyone appraised to the current status</li>\n<li>Provide a default location for discussion to happen</li>\n</ul>\n<p>We talked a fair bit about upcoming changes to Wasmtime's CLI in the meeting today and the conclusion was that we're going to try to communicate these changes broadly and prepare everyone for them since it's likely to break almost all users of the CLI. The current planned release date for these changes is Wasmtie 14.0.0 on October 20.</p>\n<p>The two major changes being implemented are:</p>\n<ul>\n<li><a href=\"https://github.com/bytecodealliance/wasmtime/pull/6737\">Options to wasmtime will be required to come before the wasm module</a></li>\n<li><a href=\"https://github.com/bytecodealliance/wasmtime/pull/6925\">Wasmtime's own options are being consolidated and renamed</a></li>\n</ul>\n<p>Also there's a bit of history here so despite the first PR looking merged it's not actually since it's now <a href=\"https://github.com/bytecodealliance/wasmtime/pull/6944\">been reverted</a> for the 13.0.0 release. This means that, at this time, there is no build available that has these changes merged in which folks can provide feedback on. At this stage this is mostly \"blast out the information\" and gathering feedback if users have concerns before moving forward.</p>\n<p>My current plan is to land both of these changes, pending approvals, on or around September 11 which is the first Monday after WasmCon. This will be on the <code>main</code> branch which will get released as Wasmtime 14.0.0 in October and additionally will intentionally miss creation of the <code>release-13.0.0</code> branch happening on September 5.</p>\n<p>Once these two changes are landed in <code>main</code> I'll post a notification here since there will be builds to download and play around with for interested users. Additionally I hope to write up more long-form information at least in the form of release notes and possibly more information here too.</p>\n<p>If anyone has thoughts or concerns though please post here!</p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/bytecodealliance/wasmtime/pull/6944\" style=\"background-image: url(https\\:\\/\\/uploads\\.zulipusercontent\\.net\\/d697b7a8fefc18880760e65d092810fb453ee04d\\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f653830373133373130643864303439366362346239363638363537623938653061623762363138313030316433633331336332303332363563626539663936342f62797465636f6465616c6c69616e63652f7761736d74696d652f70756c6c2f36393434)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/bytecodealliance/wasmtime/pull/6944\" title=\"Partially revert CLI argument changes from #6737 by alexcrichton · Pull Request #6944 · bytecodealliance/wasmtime\">Partially revert CLI argument changes from #6737 by alexcrichton · Pull Request #6944 · bytecodealliance/wasmtime</a></div><div class=\"message_embed_description\">This commit is a partial revert of #6737. That change was reverted in #6830 for the 12.0.0 release of Wasmtime and otherwise it's currently slated to get released with the 13.0.0 release of Wasmtim...</div></div></div><div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/bytecodealliance/wasmtime/pull/6737\" style=\"background-image: url(https\\:\\/\\/uploads\\.zulipusercontent\\.net\\/25437f3f3d6611a0e16cadc7e6150c93a47c30b8\\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f396538653833616434643464633930363463303764653935616465313830383639373531646533656236373936316161646165343436393036623038653837642f62797465636f6465616c6c69616e63652f7761736d74696d652f70756c6c2f36373337)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/bytecodealliance/wasmtime/pull/6737\" title=\"Require wasmtime options are first when running modules by alexcrichton · Pull Request #6737 · bytecodealliance/wasmtime\">Require wasmtime options are first when running modules by alexcrichton · Pull Request #6737 · bytecodealliance/wasmtime</a></div><div class=\"message_embed_description\">Currently the way we've configured argument parsing it's valid to execute a command such as:\nwasmtime run foo.wasm -O\n\nwhich is the same as:\nwasmtime run -O foo.wasm\n\nor otherwise all flags are att...</div></div></div><div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/bytecodealliance/wasmtime/pull/6925\" style=\"background-image: url(https\\:\\/\\/uploads\\.zulipusercontent\\.net\\/04b6696691cffb38a4627ee2630b5b9e8603b596\\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f656633313461666231353933386362376439613431653837633432376234383961383435343932373536363836666362353537643533353839336333396334342f62797465636f6465616c6c69616e63652f7761736d74696d652f70756c6c2f36393235)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/bytecodealliance/wasmtime/pull/6925\" title=\"Redesign Wasmtime's CLI by alexcrichton · Pull Request #6925 · bytecodealliance/wasmtime\">Redesign Wasmtime's CLI by alexcrichton · Pull Request #6925 · bytecodealliance/wasmtime</a></div><div class=\"message_embed_description\">This commit follows through on discussion from #6741 to redesign the flags that the wasmtime binary accepts on the CLI. Almost all flags have been renamed/moved and will require callers to update. ...</div></div></div>",
        "id": 388395163,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1693511129
    },
    {
        "content": "<p>I'd also like to point out and clarify that this is probably the last major refactor we're going to get to do of Wasmtime's CLI for quite some time, so I'd like to ideally handle as much as possible in terms of concerns! </p>\n<p>Consequently if you have any wishes/concerns/etc about Wasmtime's CLI please bring them up! This is a perfect time to bikeshed and figure out everything since it's gonna be much harder to do this the next time around.</p>",
        "id": 388395321,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1693511206
    },
    {
        "content": "<p>I've opened <a href=\"https://github.com/bytecodealliance/wasmtime/pull/6946\">https://github.com/bytecodealliance/wasmtime/pull/6946</a> now as a PR to land for requiring Wasmtime's options come first, meaning the intent is to land that and <a href=\"https://github.com/bytecodealliance/wasmtime/pull/6925\">https://github.com/bytecodealliance/wasmtime/pull/6925</a> on or around September 11.</p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/bytecodealliance/wasmtime/pull/6946\" style=\"background-image: url(https\\:\\/\\/uploads\\.zulipusercontent\\.net\\/99965f2ffe78e2890ab9e9bc3ee76d699e9b9fec\\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f356130323630366565663365636466666234323230333931653862363162643630643330663661303133346361363836383437386132653764646332626165322f62797465636f6465616c6c69616e63652f7761736d74696d652f70756c6c2f36393436)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/bytecodealliance/wasmtime/pull/6946\" title=\"Require Wasmtime options come before wasm modules by alexcrichton · Pull Request #6946 · bytecodealliance/wasmtime\">Require Wasmtime options come before wasm modules by alexcrichton · Pull Request #6946 · bytecodealliance/wasmtime</a></div><div class=\"message_embed_description\">This commit implements a new behavior for the CLI of the wasmtime executable which will require that options for Wasmtime itself come before the wasm module being run. Currently they're allowed to ...</div></div></div><div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/bytecodealliance/wasmtime/pull/6925\" style=\"background-image: url(https\\:\\/\\/uploads\\.zulipusercontent\\.net\\/04b6696691cffb38a4627ee2630b5b9e8603b596\\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f656633313461666231353933386362376439613431653837633432376234383961383435343932373536363836666362353537643533353839336333396334342f62797465636f6465616c6c69616e63652f7761736d74696d652f70756c6c2f36393235)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/bytecodealliance/wasmtime/pull/6925\" title=\"Redesign Wasmtime's CLI by alexcrichton · Pull Request #6925 · bytecodealliance/wasmtime\">Redesign Wasmtime's CLI by alexcrichton · Pull Request #6925 · bytecodealliance/wasmtime</a></div><div class=\"message_embed_description\">This commit follows through on discussion from #6741 to redesign the flags that the wasmtime binary accepts on the CLI. Almost all flags have been renamed/moved and will require callers to update. ...</div></div></div>",
        "id": 388397742,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1693512279
    },
    {
        "content": "<p>Ok both PRs have now landed. This means that the <code>dev</code> releases, and for anyone contributing to <code>main</code>, the CLI of Wasmtime is now different. Please feel free to kick the tires, report issues, and otherwise provide feedback here or through GitHub!</p>",
        "id": 390808424,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1694642061
    },
    {
        "content": "<p>If anything feels weird or feels like it could be better I'm also keen to hear about it</p>",
        "id": 390808441,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1694642073
    },
    {
        "content": "<p>Oh also, as a reminder, these changes won't get released until October 20. This means that Wasmtime 12, the current release, is not affected. Additionally the Wasmtime 13 release next week will also be unaffected. They continue to use the old CLI and its conventions</p>",
        "id": 390815172,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1694645544
    },
    {
        "content": "<p>Heads up on this one final time to continue to spread awareness, the 14.0.0 release is just around the corner (tomorrow!) and these CLI changes will be included in them. Now's the best time for any final feedback, concerns, or changes</p>",
        "id": 397535082,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1697731131
    },
    {
        "content": "<p>FYI I did a <a href=\"#narrow/stream/206238-general/topic/Popular.20WASI.20runtimes.20w.2F.20a.20CLI.20for.20env.20vars.20and.20dir.20mapping.3F\">survey of WASI runtimes</a> and their CLIs to see if there's any commonality (answer is \"no\"). The proposed <code>--dir=local::guest</code> gets the flag to match wasmedge, but the path separator will be different. Wasmer matches the current/soon-to-be-old <code>--mapdir=local::guest</code> format (wazero uses <code>--mount</code>, so is completely different).</p>",
        "id": 397559217,
        "sender_full_name": "Brett Cannon",
        "timestamp": 1697741335
    },
    {
        "content": "<p>Thanks! One difference I know Wasmtime has is that it does <code>GUEST::HOST</code> which I know additionally differs from Docker and reminds me that I've wanted to change that, so I'll go push that through.</p>\n<p>As for <code>::</code> vs <code>:</code>, I wasn't around when this was originally implemented but if I had to guess it's to handle <code>C:\\...</code> for Windows paths where <code>:</code> shows up there but not on unix, and <code>::</code> is a little less ambiguous</p>",
        "id": 397561311,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1697742068
    },
    {
        "content": "<p>oops lost track of this but <a href=\"https://github.com/bytecodealliance/wasmtime/pull/7301\">here's a PR for swapping the order</a></p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/bytecodealliance/wasmtime/pull/7301\" style=\"background-image: url(https\\:\\/\\/uploads\\.zulipusercontent\\.net\\/00f98105de328a4070dd0386506e4e1d3eb14798\\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f373662613662376231616431636130333630303238303833663431343964323530383766333237343130336365353034663832323162323233623837303066642f62797465636f6465616c6c69616e63652f7761736d74696d652f70756c6c2f37333031)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/bytecodealliance/wasmtime/pull/7301\" title=\"Swap the order of directories in `--dir` by alexcrichton · Pull Request #7301 · bytecodealliance/wasmtime\">Swap the order of directories in `--dir` by alexcrichton · Pull Request #7301 · bytecodealliance/wasmtime</a></div><div class=\"message_embed_description\">This commit changes the --dir argument on the wasmtime CLI to be HOST::GUEST rather than GUEST::HOST. This matches Docker for example and is a little more consistent with only --dir path where the ...</div></div></div>",
        "id": 397587098,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1697755323
    }
]