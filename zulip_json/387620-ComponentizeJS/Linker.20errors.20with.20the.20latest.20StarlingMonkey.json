[
    {
        "content": "<p>Hi! I'm trying to build <code>componentize-js</code> using the latest StarlingMonkey (current <code>main</code> branch in the repo / our fork containing some initial attempts to fix <code>fetch</code>) and found that the following update of SpiderMonkey: <a href=\"https://github.com/bytecodealliance/StarlingMonkey/pull/41\">https://github.com/bytecodealliance/StarlingMonkey/pull/41</a> introduced a linker issue that I could not figure out yet. After doing some minor changes on the componentize-js side (following the rust toolchain update and the change of <code>run_event_loop</code>, and updating to the latest StarlingMonkey version) seems like the build fails to link <code>rust_encoding</code> crate with the <code>jsrust</code> library (although I'm not sure I understand the issue properly):</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">wasm</span><span class=\"o\">-</span><span class=\"n\">ld</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">error</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">duplicate</span><span class=\"w\"> </span><span class=\"n\">symbol</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">encoding_iso_2022_jp_ascii_valid_up_to</span>\n<span class=\"o\">&gt;&gt;&gt;</span><span class=\"w\"> </span><span class=\"n\">defined</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">librust_encoding</span><span class=\"p\">.</span><span class=\"n\">a</span><span class=\"p\">(</span><span class=\"n\">rust_encoding</span><span class=\"o\">-</span><span class=\"mi\">0</span><span class=\"n\">b707846ea6b3289</span><span class=\"p\">.</span><span class=\"n\">rust_encoding</span><span class=\"p\">.</span><span class=\"mi\">59</span><span class=\"n\">ddf5d00e922ee8</span><span class=\"o\">-</span><span class=\"n\">cgu</span><span class=\"p\">.</span><span class=\"mf\">0.</span><span class=\"n\">rcgu</span><span class=\"p\">.</span><span class=\"n\">o</span><span class=\"p\">)</span>\n<span class=\"o\">&gt;&gt;&gt;</span><span class=\"w\"> </span><span class=\"n\">defined</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"o\">/..</span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">ComponentizeJS</span><span class=\"o\">/</span><span class=\"n\">StarlingMonkey</span><span class=\"o\">/</span><span class=\"n\">deps</span><span class=\"o\">/</span><span class=\"n\">cpm_cache</span><span class=\"o\">/</span><span class=\"n\">spidermonkey</span><span class=\"o\">-</span><span class=\"n\">release</span><span class=\"o\">/</span><span class=\"mi\">0724</span><span class=\"n\">b80a62196812717c8fbd9286c717d83c4113</span><span class=\"o\">/</span><span class=\"n\">spidermonkey</span><span class=\"o\">-</span><span class=\"n\">release</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"o\">/</span><span class=\"n\">libjsrust</span><span class=\"p\">.</span><span class=\"n\">a</span><span class=\"p\">(</span><span class=\"n\">jsrust</span><span class=\"o\">-</span><span class=\"mi\">53</span><span class=\"n\">a982b7a59e3f77</span><span class=\"p\">.</span><span class=\"n\">jsrust</span><span class=\"p\">.</span><span class=\"mi\">86</span><span class=\"n\">da07e83e4d91bd</span><span class=\"o\">-</span><span class=\"n\">cgu</span><span class=\"p\">.</span><span class=\"mf\">0.</span><span class=\"n\">rcgu</span><span class=\"p\">.</span><span class=\"n\">o</span><span class=\"p\">)</span>\n\n<span class=\"n\">wasm</span><span class=\"o\">-</span><span class=\"n\">ld</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">error</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">duplicate</span><span class=\"w\"> </span><span class=\"n\">symbol</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">decoder_free</span>\n<span class=\"o\">&gt;&gt;&gt;</span><span class=\"w\"> </span><span class=\"n\">defined</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">librust_encoding</span><span class=\"p\">.</span><span class=\"n\">a</span><span class=\"p\">(</span><span class=\"n\">rust_encoding</span><span class=\"o\">-</span><span class=\"mi\">0</span><span class=\"n\">b707846ea6b3289</span><span class=\"p\">.</span><span class=\"n\">rust_encoding</span><span class=\"p\">.</span><span class=\"mi\">59</span><span class=\"n\">ddf5d00e922ee8</span><span class=\"o\">-</span><span class=\"n\">cgu</span><span class=\"p\">.</span><span class=\"mf\">0.</span><span class=\"n\">rcgu</span><span class=\"p\">.</span><span class=\"n\">o</span><span class=\"p\">)</span>\n<span class=\"o\">&gt;&gt;&gt;</span><span class=\"w\"> </span><span class=\"n\">defined</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"o\">/..</span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">ComponentizeJS</span><span class=\"o\">/</span><span class=\"n\">StarlingMonkey</span><span class=\"o\">/</span><span class=\"n\">deps</span><span class=\"o\">/</span><span class=\"n\">cpm_cache</span><span class=\"o\">/</span><span class=\"n\">spidermonkey</span><span class=\"o\">-</span><span class=\"n\">release</span><span class=\"o\">/</span><span class=\"mi\">0724</span><span class=\"n\">b80a62196812717c8fbd9286c717d83c4113</span><span class=\"o\">/</span><span class=\"n\">spidermonkey</span><span class=\"o\">-</span><span class=\"n\">release</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"o\">/</span><span class=\"n\">libjsrust</span><span class=\"p\">.</span><span class=\"n\">a</span><span class=\"p\">(</span><span class=\"n\">jsrust</span><span class=\"o\">-</span><span class=\"mi\">53</span><span class=\"n\">a982b7a59e3f77</span><span class=\"p\">.</span><span class=\"n\">jsrust</span><span class=\"p\">.</span><span class=\"mi\">86</span><span class=\"n\">da07e83e4d91bd</span><span class=\"o\">-</span><span class=\"n\">cgu</span><span class=\"p\">.</span><span class=\"mf\">0.</span><span class=\"n\">rcgu</span><span class=\"p\">.</span><span class=\"n\">o</span><span class=\"p\">)</span>\n\n<span class=\"o\">....</span>\n</code></pre></div>\n<p>Could you help me in what to try or where to look in order to try to fix this?</p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/bytecodealliance/StarlingMonkey/pull/41\" style=\"background-image: url(&quot;https://uploads.zulipusercontent.net/06e458ac64a62fd189c403bb1129272f2079d152/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f373132646363323637643935633536303763613262346264653733623564313838373437333462373166653630356539643462376266313464633161353066362f62797465636f6465616c6c69616e63652f537461726c696e674d6f6e6b65792f70756c6c2f3431&quot;)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/bytecodealliance/StarlingMonkey/pull/41\" title=\"deps: update to SpiderMonkey 124.0.2 by guybedford · Pull Request #41 · bytecodealliance/StarlingMonkey\">deps: update to SpiderMonkey 124.0.2 by guybedford · Pull Request #41 · bytecodealliance/StarlingMonkey</a></div><div class=\"message_embed_description\">Updates to SpiderMonkey 124.0.2 per bytecodealliance/gecko-dev#43 and bytecodealliance/spidermonkey-wasi-embedding#11.</div></div></div>",
        "id": 440505319,
        "sender_full_name": "Daniel Vigovszky",
        "timestamp": 1716555909
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"620014\">@Daniel Vigovszky</span> that's because the rust toolchain version must match the one in StarlingMonkey here - <a href=\"https://github.com/bytecodealliance/StarlingMonkey/blob/main/rust-toolchain.toml\">https://github.com/bytecodealliance/StarlingMonkey/blob/main/rust-toolchain.toml</a>. I'll see if I can get an update PR going as well.</p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/bytecodealliance/StarlingMonkey/blob/main/rust-toolchain.toml\" style=\"background-image: url(&quot;https://uploads.zulipusercontent.net/1a93e89e284f681d25b85fafbffe68ecddb733a3/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f386362343834363036366663626562396561613664373266333331376366383930646538313361656163383732383061623732636332386336643561343963662f62797465636f6465616c6c69616e63652f537461726c696e674d6f6e6b6579&quot;)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/bytecodealliance/StarlingMonkey/blob/main/rust-toolchain.toml\" title=\"StarlingMonkey/rust-toolchain.toml at main · bytecodealliance/StarlingMonkey\">StarlingMonkey/rust-toolchain.toml at main · bytecodealliance/StarlingMonkey</a></div><div class=\"message_embed_description\">The StarlingMonkey JS runtime. Contribute to bytecodealliance/StarlingMonkey development by creating an account on GitHub.</div></div></div>",
        "id": 440547104,
        "sender_full_name": "Guy Bedford",
        "timestamp": 1716570641
    },
    {
        "content": "<p>turns out this is an upstream issue - <a href=\"https://github.com/bytecodealliance/StarlingMonkey/issues/50\">https://github.com/bytecodealliance/StarlingMonkey/issues/50</a></p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/bytecodealliance/StarlingMonkey/issues/50\" style=\"background-image: url(&quot;https://uploads.zulipusercontent.net/18c1ba9277a39d1cc9bc39ebd6a82fdde2be0515/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f323865373064353162396165383930613266386263623136393166663736663333626336333736363165653636636163303531363664303964376135323231612f62797465636f6465616c6c69616e63652f537461726c696e674d6f6e6b65792f6973737565732f3530&quot;)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/bytecodealliance/StarlingMonkey/issues/50\" title=\"Release build is broken · Issue #50 · bytecodealliance/StarlingMonkey\">Release build is broken · Issue #50 · bytecodealliance/StarlingMonkey</a></div><div class=\"message_embed_description\">The release build is currently not working correctly. This may have happened in the latest SpiderMonkey update. Build error reported: [ 90%] Linking CXX executable starling.wasm wasm-ld: error: dup...</div></div></div>",
        "id": 440552109,
        "sender_full_name": "Guy Bedford",
        "timestamp": 1716572756
    },
    {
        "content": "<p>This is how I tried to match the updated toolchain: <a href=\"https://github.com/golemcloud/ComponentizeJS/pull/1\">https://github.com/golemcloud/ComponentizeJS/pull/1</a><br>\nbut it leads to that linker error.</p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/golemcloud/ComponentizeJS/pull/1\" style=\"background-image: url(&quot;https://uploads.zulipusercontent.net/f9d1c628d32fddc46bccd9d4d0f1517aa28db844/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f636537313937623335633533636139333531363039343163363333313733363837613331356132363661356338333730336164396539376131613966346465352f676f6c656d636c6f75642f436f6d706f6e656e74697a654a532f70756c6c2f31&quot;)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/golemcloud/ComponentizeJS/pull/1\" title=\"Update to use the forked StarlingMonkey by vigoo · Pull Request #1 · golemcloud/ComponentizeJS\">Update to use the forked StarlingMonkey by vigoo · Pull Request #1 · golemcloud/ComponentizeJS</a></div><div class=\"message_embed_description\">JS -&gt; WebAssembly Component. Contribute to golemcloud/ComponentizeJS development by creating an account on GitHub.</div></div></div>",
        "id": 440553418,
        "sender_full_name": "Daniel Vigovszky",
        "timestamp": 1716573261
    }
]