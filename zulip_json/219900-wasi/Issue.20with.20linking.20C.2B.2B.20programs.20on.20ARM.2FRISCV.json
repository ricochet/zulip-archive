[
    {
        "content": "<p>I managed to build wasi-sdk for RISC-V by using a riscv docker container image. However, I cannot compile and link C++ programs to webassembley. C programs work well. Here is the output I get for a simple program:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">opt</span><span class=\"o\">/</span><span class=\"n\">wasi</span><span class=\"o\">-</span><span class=\"n\">sdk</span><span class=\"o\">/</span><span class=\"n\">bin</span><span class=\"o\">/</span><span class=\"n\">clang</span><span class=\"o\">++</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">target</span><span class=\"o\">=</span><span class=\"n\">wasm32</span><span class=\"o\">-</span><span class=\"n\">unknown</span><span class=\"o\">-</span><span class=\"n\">wasi</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">sysroot</span><span class=\"o\">=/</span><span class=\"n\">opt</span><span class=\"o\">/</span><span class=\"n\">wasi</span><span class=\"o\">-</span><span class=\"n\">sdk</span><span class=\"o\">/</span><span class=\"n\">share</span><span class=\"o\">/</span><span class=\"n\">wasi</span><span class=\"o\">-</span><span class=\"n\">sy</span>\n<span class=\"n\">sroot</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">W</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">std</span><span class=\"o\">=</span><span class=\"n\">c</span><span class=\"o\">++</span><span class=\"mi\">11</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">fvisibility</span><span class=\"o\">=</span><span class=\"n\">hidden</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">DNDEBUG</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">fno</span><span class=\"o\">-</span><span class=\"n\">exceptions</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">O2</span><span class=\"w\">   </span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">HashSet</span><span class=\"p\">.</span><span class=\"n\">cpp</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">o</span><span class=\"w\"> </span><span class=\"n\">hashset</span><span class=\"p\">.</span><span class=\"n\">wasm</span>\n<span class=\"n\">clang</span><span class=\"w\"> </span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"mf\">16.0.0</span>\n<span class=\"n\">Target</span>: <span class=\"nc\">wasm32</span><span class=\"o\">-</span><span class=\"n\">unknown</span><span class=\"o\">-</span><span class=\"n\">wasi</span>\n<span class=\"n\">Thread</span><span class=\"w\"> </span><span class=\"n\">model</span>: <span class=\"nc\">posix</span>\n<span class=\"n\">InstalledDir</span>: <span class=\"o\">/</span><span class=\"n\">opt</span><span class=\"o\">/</span><span class=\"n\">wasi</span><span class=\"o\">-</span><span class=\"n\">sdk</span><span class=\"o\">/</span><span class=\"n\">bin</span>\n<span class=\"w\"> </span><span class=\"s\">\"/opt/wasi-sdk/bin/clang-16\"</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">cc1</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">triple</span><span class=\"w\"> </span><span class=\"n\">wasm32</span><span class=\"o\">-</span><span class=\"n\">unknown</span><span class=\"o\">-</span><span class=\"n\">wasi</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">emit</span><span class=\"o\">-</span><span class=\"n\">obj</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">disable</span><span class=\"o\">-</span><span class=\"n\">free</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">clear</span><span class=\"o\">-</span><span class=\"n\">ast</span><span class=\"o\">-</span><span class=\"n\">before</span><span class=\"o\">-</span><span class=\"n\">backend</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">disable</span><span class=\"o\">-</span><span class=\"n\">llvm</span><span class=\"o\">-</span><span class=\"n\">verifier</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">discard</span><span class=\"o\">-</span><span class=\"n\">value</span><span class=\"o\">-</span><span class=\"n\">names</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">main</span><span class=\"o\">-</span><span class=\"n\">file</span><span class=\"o\">-</span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"n\">HashSet</span><span class=\"p\">.</span><span class=\"n\">cpp</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">mrelocation</span><span class=\"o\">-</span><span class=\"n\">model</span><span class=\"w\"> </span><span class=\"k\">static</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">mframe</span><span class=\"o\">-</span><span class=\"n\">pointer</span><span class=\"o\">=</span><span class=\"n\">none</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">ffp</span><span class=\"o\">-</span><span class=\"n\">contract</span><span class=\"o\">=</span><span class=\"n\">on</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">fno</span><span class=\"o\">-</span><span class=\"n\">rounding</span><span class=\"o\">-</span><span class=\"n\">math</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">mconstructor</span><span class=\"o\">-</span><span class=\"n\">aliases</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">target</span><span class=\"o\">-</span><span class=\"n\">cpu</span><span class=\"w\"> </span><span class=\"n\">generic</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">mllvm</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">treat</span><span class=\"o\">-</span><span class=\"n\">scalable</span><span class=\"o\">-</span><span class=\"n\">fixed</span><span class=\"o\">-</span><span class=\"n\">error</span><span class=\"o\">-</span><span class=\"k\">as</span><span class=\"o\">-</span><span class=\"n\">warning</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">debugger</span><span class=\"o\">-</span><span class=\"n\">tuning</span><span class=\"o\">=</span><span class=\"n\">gdb</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">fcoverage</span><span class=\"o\">-</span><span class=\"n\">compilation</span><span class=\"o\">-</span><span class=\"n\">dir</span><span class=\"o\">=/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">ubuntu</span><span class=\"o\">/</span><span class=\"n\">wasm</span><span class=\"o\">/</span><span class=\"n\">wabench</span><span class=\"o\">/</span><span class=\"n\">JetStream2</span><span class=\"o\">/</span><span class=\"n\">hashset</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">resource</span><span class=\"o\">-</span><span class=\"n\">dir</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">opt</span><span class=\"o\">/</span><span class=\"n\">wasi</span><span class=\"o\">-</span><span class=\"n\">sdk</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"o\">/</span><span class=\"n\">clang</span><span class=\"o\">/</span><span class=\"mi\">16</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"n\">NDEBUG</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">isysroot</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">opt</span><span class=\"o\">/</span><span class=\"n\">wasi</span><span class=\"o\">-</span><span class=\"n\">sdk</span><span class=\"o\">/</span><span class=\"n\">share</span><span class=\"o\">/</span><span class=\"n\">wasi</span><span class=\"o\">-</span><span class=\"n\">sysroot</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">internal</span><span class=\"o\">-</span><span class=\"n\">isystem</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">opt</span><span class=\"o\">/</span><span class=\"n\">wasi</span><span class=\"o\">-</span><span class=\"n\">sdk</span><span class=\"o\">/</span><span class=\"n\">share</span><span class=\"o\">/</span><span class=\"n\">wasi</span><span class=\"o\">-</span><span class=\"n\">sysroot</span><span class=\"o\">/</span><span class=\"n\">include</span><span class=\"o\">/</span><span class=\"n\">wasm32</span><span class=\"o\">-</span><span class=\"n\">wasi</span><span class=\"o\">/</span><span class=\"n\">c</span><span class=\"o\">++/</span><span class=\"n\">v1</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">internal</span><span class=\"o\">-</span><span class=\"n\">isystem</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">opt</span><span class=\"o\">/</span><span class=\"n\">wasi</span><span class=\"o\">-</span><span class=\"n\">sdk</span><span class=\"o\">/</span><span class=\"n\">share</span><span class=\"o\">/</span><span class=\"n\">wasi</span><span class=\"o\">-</span><span class=\"n\">sysroot</span><span class=\"o\">/</span><span class=\"n\">include</span><span class=\"o\">/</span><span class=\"n\">c</span><span class=\"o\">++/</span><span class=\"n\">v1</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">internal</span><span class=\"o\">-</span><span class=\"n\">isystem</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">opt</span><span class=\"o\">/</span><span class=\"n\">wasi</span><span class=\"o\">-</span><span class=\"n\">sdk</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"o\">/</span><span class=\"n\">clang</span><span class=\"o\">/</span><span class=\"mi\">16</span><span class=\"o\">/</span><span class=\"n\">include</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">internal</span><span class=\"o\">-</span><span class=\"n\">isystem</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">opt</span><span class=\"o\">/</span><span class=\"n\">wasi</span><span class=\"o\">-</span><span class=\"n\">sdk</span><span class=\"o\">/</span><span class=\"n\">share</span><span class=\"o\">/</span><span class=\"n\">wasi</span><span class=\"o\">-</span><span class=\"n\">sysroot</span><span class=\"o\">/</span><span class=\"n\">include</span><span class=\"o\">/</span><span class=\"n\">wasm32</span><span class=\"o\">-</span><span class=\"n\">wasi</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">internal</span><span class=\"o\">-</span><span class=\"n\">isystem</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">opt</span><span class=\"o\">/</span><span class=\"n\">wasi</span><span class=\"o\">-</span><span class=\"n\">sdk</span><span class=\"o\">/</span><span class=\"n\">share</span><span class=\"o\">/</span><span class=\"n\">wasi</span><span class=\"o\">-</span><span class=\"n\">sysroot</span><span class=\"o\">/</span><span class=\"n\">include</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">O2</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">W</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">std</span><span class=\"o\">=</span><span class=\"n\">c</span><span class=\"o\">++</span><span class=\"mi\">11</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">fdeprecated</span><span class=\"o\">-</span><span class=\"kr\">macro</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">fdebug</span><span class=\"o\">-</span><span class=\"n\">compilation</span><span class=\"o\">-</span><span class=\"n\">dir</span><span class=\"o\">=/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">ubuntu</span><span class=\"o\">/</span><span class=\"n\">wasm</span><span class=\"o\">/</span><span class=\"n\">wabench</span><span class=\"o\">/</span><span class=\"n\">JetStream2</span><span class=\"o\">/</span><span class=\"n\">hashset</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">ferror</span><span class=\"o\">-</span><span class=\"n\">limit</span><span class=\"w\"> </span><span class=\"mi\">19</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">fvisibility</span><span class=\"o\">=</span><span class=\"n\">hidden</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">fgnuc</span><span class=\"o\">-</span><span class=\"n\">version</span><span class=\"o\">=</span><span class=\"mf\">4.2.1</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">fcolor</span><span class=\"o\">-</span><span class=\"n\">diagnostics</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">vectorize</span><span class=\"o\">-</span><span class=\"n\">loops</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">vectorize</span><span class=\"o\">-</span><span class=\"n\">slp</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">o</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">tmp</span><span class=\"o\">/</span><span class=\"n\">HashSet</span><span class=\"o\">-</span><span class=\"mf\">91e8</span><span class=\"n\">a4</span><span class=\"p\">.</span><span class=\"n\">o</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"o\">++</span><span class=\"w\"> </span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">HashSet</span><span class=\"p\">.</span><span class=\"n\">cpp</span>\n<span class=\"n\">clang</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">cc1</span><span class=\"w\"> </span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"mf\">16.0.0</span><span class=\"w\"> </span><span class=\"n\">based</span><span class=\"w\"> </span><span class=\"n\">upon</span><span class=\"w\"> </span><span class=\"n\">LLVM</span><span class=\"w\"> </span><span class=\"mf\">16.0.0</span><span class=\"w\"> </span><span class=\"n\">default</span><span class=\"w\"> </span><span class=\"n\">target</span><span class=\"w\"> </span><span class=\"n\">wasm32</span><span class=\"o\">-</span><span class=\"n\">wasi</span>\n<span class=\"n\">ignoring</span><span class=\"w\"> </span><span class=\"n\">nonexistent</span><span class=\"w\"> </span><span class=\"n\">directory</span><span class=\"w\"> </span><span class=\"s\">\"/opt/wasi-sdk/share/wasi-sysroot/include/wasm32-wasi/c++/v1\"</span>\n<span class=\"n\">ignoring</span><span class=\"w\"> </span><span class=\"n\">nonexistent</span><span class=\"w\"> </span><span class=\"n\">directory</span><span class=\"w\"> </span><span class=\"s\">\"/opt/wasi-sdk/share/wasi-sysroot/include/wasm32-wasi\"</span>\n#<span class=\"n\">include</span><span class=\"w\"> </span><span class=\"s\">\"...\"</span><span class=\"w\"> </span><span class=\"n\">search</span><span class=\"w\"> </span><span class=\"n\">starts</span><span class=\"w\"> </span><span class=\"n\">here</span>:\n#<span class=\"n\">include</span><span class=\"w\"> </span><span class=\"o\">&lt;..</span><span class=\"p\">.</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"n\">search</span><span class=\"w\"> </span><span class=\"n\">starts</span><span class=\"w\"> </span><span class=\"n\">here</span>:\n <span class=\"o\">/</span><span class=\"n\">opt</span><span class=\"o\">/</span><span class=\"n\">wasi</span><span class=\"o\">-</span><span class=\"n\">sdk</span><span class=\"o\">/</span><span class=\"n\">share</span><span class=\"o\">/</span><span class=\"n\">wasi</span><span class=\"o\">-</span><span class=\"n\">sysroot</span><span class=\"o\">/</span><span class=\"n\">include</span><span class=\"o\">/</span><span class=\"n\">c</span><span class=\"o\">++/</span><span class=\"n\">v1</span>\n<span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">opt</span><span class=\"o\">/</span><span class=\"n\">wasi</span><span class=\"o\">-</span><span class=\"n\">sdk</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"o\">/</span><span class=\"n\">clang</span><span class=\"o\">/</span><span class=\"mi\">16</span><span class=\"o\">/</span><span class=\"n\">include</span>\n<span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">opt</span><span class=\"o\">/</span><span class=\"n\">wasi</span><span class=\"o\">-</span><span class=\"n\">sdk</span><span class=\"o\">/</span><span class=\"n\">share</span><span class=\"o\">/</span><span class=\"n\">wasi</span><span class=\"o\">-</span><span class=\"n\">sysroot</span><span class=\"o\">/</span><span class=\"n\">include</span>\n<span class=\"n\">End</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">search</span><span class=\"w\"> </span><span class=\"n\">list</span><span class=\"p\">.</span>\n<span class=\"w\"> </span><span class=\"s\">\"/opt/wasi-sdk/bin/wasm-ld\"</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">wasm32</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">L</span><span class=\"o\">/</span><span class=\"n\">opt</span><span class=\"o\">/</span><span class=\"n\">wasi</span><span class=\"o\">-</span><span class=\"n\">sdk</span><span class=\"o\">/</span><span class=\"n\">share</span><span class=\"o\">/</span><span class=\"n\">wasi</span><span class=\"o\">-</span><span class=\"n\">sysroot</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"o\">/</span><span class=\"n\">wasm32</span><span class=\"o\">-</span><span class=\"n\">wasi</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">opt</span><span class=\"o\">/</span><span class=\"n\">wasi</span><span class=\"o\">-</span><span class=\"n\">sdk</span><span class=\"o\">/</span><span class=\"n\">share</span><span class=\"o\">/</span><span class=\"n\">wasi</span><span class=\"o\">-</span><span class=\"n\">sysroot</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"o\">/</span><span class=\"n\">wasm32</span><span class=\"o\">-</span><span class=\"n\">wasi</span><span class=\"o\">/</span><span class=\"n\">crt1</span><span class=\"o\">-</span><span class=\"n\">command</span><span class=\"p\">.</span><span class=\"n\">o</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">tmp</span><span class=\"o\">/</span><span class=\"n\">HashSet</span><span class=\"o\">-</span><span class=\"mf\">91e8</span><span class=\"n\">a4</span><span class=\"p\">.</span><span class=\"n\">o</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">lc</span><span class=\"o\">++</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">lc</span><span class=\"o\">++</span><span class=\"n\">abi</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">lc</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">opt</span><span class=\"o\">/</span><span class=\"n\">wasi</span><span class=\"o\">-</span><span class=\"n\">sdk</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"o\">/</span><span class=\"n\">clang</span><span class=\"o\">/</span><span class=\"mi\">16</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"o\">/</span><span class=\"n\">wasi</span><span class=\"o\">/</span><span class=\"n\">libclang_rt</span><span class=\"p\">.</span><span class=\"n\">builtins</span><span class=\"o\">-</span><span class=\"n\">wasm32</span><span class=\"p\">.</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">o</span><span class=\"w\"> </span><span class=\"n\">hashset</span><span class=\"p\">.</span><span class=\"n\">wasm</span>\n<span class=\"n\">wasm</span><span class=\"o\">-</span><span class=\"n\">ld</span>: <span class=\"nc\">error</span>: <span class=\"o\">/</span><span class=\"n\">opt</span><span class=\"o\">/</span><span class=\"n\">wasi</span><span class=\"o\">-</span><span class=\"n\">sdk</span><span class=\"o\">/</span><span class=\"n\">share</span><span class=\"o\">/</span><span class=\"n\">wasi</span><span class=\"o\">-</span><span class=\"n\">sysroot</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"o\">/</span><span class=\"n\">wasm32</span><span class=\"o\">-</span><span class=\"n\">wasi</span><span class=\"o\">/</span><span class=\"n\">libc</span><span class=\"o\">++</span><span class=\"n\">abi</span><span class=\"p\">.</span><span class=\"n\">a</span><span class=\"p\">(</span><span class=\"n\">stdlib_new_delete</span><span class=\"p\">.</span><span class=\"n\">cpp</span><span class=\"p\">.</span><span class=\"n\">o</span><span class=\"p\">)</span>: <span class=\"nc\">undefined</span><span class=\"w\"> </span><span class=\"n\">symbol</span>: <span class=\"nc\">__cxa_allocate_exception</span>\n<span class=\"n\">wasm</span><span class=\"o\">-</span><span class=\"n\">ld</span>: <span class=\"nc\">error</span>: <span class=\"o\">/</span><span class=\"n\">opt</span><span class=\"o\">/</span><span class=\"n\">wasi</span><span class=\"o\">-</span><span class=\"n\">sdk</span><span class=\"o\">/</span><span class=\"n\">share</span><span class=\"o\">/</span><span class=\"n\">wasi</span><span class=\"o\">-</span><span class=\"n\">sysroot</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"o\">/</span><span class=\"n\">wasm32</span><span class=\"o\">-</span><span class=\"n\">wasi</span><span class=\"o\">/</span><span class=\"n\">libc</span><span class=\"o\">++</span><span class=\"n\">abi</span><span class=\"p\">.</span><span class=\"n\">a</span><span class=\"p\">(</span><span class=\"n\">stdlib_new_delete</span><span class=\"p\">.</span><span class=\"n\">cpp</span><span class=\"p\">.</span><span class=\"n\">o</span><span class=\"p\">)</span>: <span class=\"nc\">undefined</span><span class=\"w\"> </span><span class=\"n\">symbol</span>: <span class=\"nc\">__cxa_throw</span>\n<span class=\"n\">clang</span><span class=\"o\">-</span><span class=\"mi\">16</span>: <span class=\"nc\">error</span>: <span class=\"nc\">linker</span><span class=\"w\"> </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"n\">failed</span><span class=\"w\"> </span><span class=\"n\">with</span><span class=\"w\"> </span><span class=\"n\">exit</span><span class=\"w\"> </span><span class=\"n\">code</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">v</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">see</span><span class=\"w\"> </span><span class=\"n\">invocation</span><span class=\"p\">)</span>\n</code></pre></div>\n<p>I am using the no-exceptions flag but still I get references to symbols related to exceptions (<code>__cxa_allocate_exception</code> and `__cxa_throw). </p>\n<p>Any pointers on how to resolve this?</p>",
        "id": 364498928,
        "sender_full_name": "Mats Brorsson",
        "timestamp": 1686217110
    },
    {
        "content": "<p>I see in <a href=\"https://github.com/WebAssembly/wasi-sdk/issues/329\">https://github.com/WebAssembly/wasi-sdk/issues/329</a> that you brought up this issue and then realized libcxx was not being built with exceptions turned off. What might be confusing is that it is configured with exceptions turned off: <a href=\"https://github.com/WebAssembly/wasi-sdk/blob/6dde7bb8d639cafe94daf3f946cffeeec68b9f3f/Makefile#L166\">https://github.com/WebAssembly/wasi-sdk/blob/6dde7bb8d639cafe94daf3f946cffeeec68b9f3f/Makefile#L166</a>. But maybe an extra <code>CMAKE_CXX_FLAGS</code> addition might do the trick. I haven't looked much into this myself (apologies for not being more help!).</p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/WebAssembly/wasi-sdk/issues/329\" style=\"background-image: url(https\\:\\/\\/uploads\\.zulipusercontent\\.net\\/9470e7dc3b315dcd0af0356ade547a7611b3cdfa\\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f336666363136616139376635376236303163353037313233383834636365386139313765366631613234366534663037373735363831313338613733373864322f576562417373656d626c792f776173692d73646b2f6973737565732f333239)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/WebAssembly/wasi-sdk/issues/329\" title=\"Undefined exception symbols despite -fno-exceptions · Issue #329 · WebAssembly/wasi-sdk\">Undefined exception symbols despite -fno-exceptions · Issue #329 · WebAssembly/wasi-sdk</a></div><div class=\"message_embed_description\">I have build wasi-sdk for risc-v to use on the VisionFive2 board from StarFive. I have issues with linking C++ programs as the linker insists on undefined references to __cxa_allocate_exceptionand ...</div></div></div><div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/WebAssembly/wasi-sdk/blob/6dde7bb8d639cafe94daf3f946cffeeec68b9f3f/Makefile#L166\" style=\"background-image: url(https\\:\\/\\/uploads\\.zulipusercontent\\.net\\/6936b45efb212608d6f32386c777323ab9105a4a\\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f313333383333323437373338323239626462326633656262633438643633373230336264366662363831653036343361616433343366626361633932326431342f576562417373656d626c792f776173692d73646b)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/WebAssembly/wasi-sdk/blob/6dde7bb8d639cafe94daf3f946cffeeec68b9f3f/Makefile#L166\" title=\"wasi-sdk/Makefile at 6dde7bb8d639cafe94daf3f946cffeeec68b9f3f · WebAssembly/wasi-sdk\">wasi-sdk/Makefile at 6dde7bb8d639cafe94daf3f946cffeeec68b9f3f · WebAssembly/wasi-sdk</a></div><div class=\"message_embed_description\">WASI-enabled WebAssembly C/C++ toolchain. Contribute to WebAssembly/wasi-sdk development by creating an account on GitHub.</div></div></div>",
        "id": 364930887,
        "sender_full_name": "Andrew Brown",
        "timestamp": 1686333402
    },
    {
        "content": "<p>Thanks for the tip <span class=\"user-mention\" data-user-id=\"254110\">@Andrew Brown</span> . I got a workaround working by setting <code>LIBCXX_CXX_FLAGS</code> in <code>libcxx/CMakeLists.txt</code> and <code>LIBCXXABI_CXX_FLAGS</code> in <code>libcxxabi/CMakeLists.txt</code> to <code>-fno-exceptions</code>.</p>\n<p>It's a bit weird that they are not set correctly for RISC-V.</p>",
        "id": 365241058,
        "sender_full_name": "Mats Brorsson",
        "timestamp": 1686462833
    }
]