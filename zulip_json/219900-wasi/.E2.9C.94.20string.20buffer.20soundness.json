[
    {
        "content": "<p>I would like to know if the guest component could rely on the soundness/validity of provided buffer being valid UTF-16/UTF-8.</p>\n<p>When 2 components send each other string and the host could \"do fused adapter\"<br>\nIs the host (wasmtime, jco) responsible for validating the buffer ?<br>\nOr should the guest component (in our case dotnet) be responsible to validate strings ?</p>\n<p>Is that defined in the spec ?</p>\n<p>I found soundness discussion here, but I'm not sure what's the latest.<br>\n<a href=\"https://github.com/WebAssembly/interface-types/issues/128\">https://github.com/WebAssembly/interface-types/issues/128</a></p>\n<p>Consider that if the host would do it, it could be implemented possibly in more optimized way than the guest could do it.</p>\n<p>On the other hand, if it's guest's responsibility I'm not sure that declaring my component to be UTF-16 makes significant perf benefit (because I need to scan/parse the bytes again anyway).</p>\n<p>This question is in context of code generated by wit-bindgen for C#</p>\n<p>cc <span class=\"user-mention\" data-user-id=\"509936\">@Joel Dice</span></p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/WebAssembly/interface-types/issues/128\" style=\"background-image: url(&quot;https://uploads.zulipusercontent.net/0d121f2adb1ae2be83f2552777af504aafc70ee5/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f333135363861623333313761326335336235663265386436366330616463303238316137306565633037366139643739616636343464393530333136613663652f576562417373656d626c792f696e746572666163652d74797065732f6973737565732f313238&quot;)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/WebAssembly/interface-types/issues/128\" title=\"Guaranteeing additional soundness properties · Issue #128 · WebAssembly/interface-types\">Guaranteeing additional soundness properties · Issue #128 · WebAssembly/interface-types</a></div><div class=\"message_embed_description\">After a few recent conversations with @RossTate and @fgmccabe where this came up, I wanted to share my thoughts about how I see the relationship between Interface Types and core WebAssembly and see...</div></div></div>",
        "id": 455750000,
        "sender_full_name": "Pavel Šavara",
        "timestamp": 1722543742
    },
    {
        "content": "<p>Tracing through the Wasmtime code, I can see that fused adapters call into the host to perform both validation and copying, so <span class=\"user-mention\" data-user-id=\"471788\">@Pavel Šavara</span> and I are wondering if it's <em>required</em> by the spec to do that validation, i.e. can the guest rely on it?</p>",
        "id": 455750675,
        "sender_full_name": "Joel Dice",
        "timestamp": 1722543876
    },
    {
        "content": "<p>Yes a guest is guaranteed that all bytes it receives are a valid encoding</p>",
        "id": 455754566,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1722545331
    },
    {
        "content": "<p>Wasmtime doesn't validate strings going into a guest from the host but that's only because Rust provides the guarantee invalid utf8</p>",
        "id": 455754663,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1722545396
    },
    {
        "content": "<p>Thanks.  Is the guarantee made explicit in e.g. <a href=\"https://github.com/WebAssembly/component-model/blob/main/design/mvp/CanonicalABI.md\">https://github.com/WebAssembly/component-model/blob/main/design/mvp/CanonicalABI.md</a>?  I couldn't find it.</p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/WebAssembly/component-model/blob/main/design/mvp/CanonicalABI.md\" style=\"background-image: url(&quot;https://uploads.zulipusercontent.net/7340543fe460b46da7487c546e5f239e5f98b4f0/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f633765366361643033393538643162346562383264663433623335653833336631633261653930386230316437626632383832633639373337656466313363332f576562417373656d626c792f636f6d706f6e656e742d6d6f64656c&quot;)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/WebAssembly/component-model/blob/main/design/mvp/CanonicalABI.md\" title=\"component-model/design/mvp/CanonicalABI.md at main · WebAssembly/component-model\">component-model/design/mvp/CanonicalABI.md at main · WebAssembly/component-model</a></div><div class=\"message_embed_description\">Repository for design and specification of the Component Model - WebAssembly/component-model</div></div></div>",
        "id": 455754761,
        "sender_full_name": "Joel Dice",
        "timestamp": 1722545432
    },
    {
        "content": "<p>In load_string_from_range the UnicodeError and trap() handle this</p>",
        "id": 455755005,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1722545543
    },
    {
        "content": "<p>Where all strings are always valid and the only constructor in the abi is a lift operation</p>",
        "id": 455755041,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1722545569
    },
    {
        "content": "<p>We really need a \"canonical abi intro\" document</p>",
        "id": 455755090,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1722545594
    },
    {
        "content": "<p>FWIW this issue goes into the same question: <a href=\"https://github.com/WebAssembly/component-model/issues/224\">https://github.com/WebAssembly/component-model/issues/224</a></p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/WebAssembly/component-model/issues/224\" style=\"background-image: url(&quot;https://uploads.zulipusercontent.net/55a679ea256744f1182da086c25c401e08634f64/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f636531393235326232336232653839623437633361373335643136323836643137306462643332316666396337373333376437633865396634623963383937322f576562417373656d626c792f636f6d706f6e656e742d6d6f64656c2f6973737565732f323234&quot;)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/WebAssembly/component-model/issues/224\" title=\"UTF-8 Invalid sequences for component model strings · Issue #224 · WebAssembly/component-model\">UTF-8 Invalid sequences for component model strings · Issue #224 · WebAssembly/component-model</a></div><div class=\"message_embed_description\">Forgive me if I'm missing it, but is there a discussion of how the Unicode UTR 36: UTF-8 Exploits are addressed by the component model strings? From what I can tell looking at the CanonicalABI it l...</div></div></div>",
        "id": 455929288,
        "sender_full_name": "Milan",
        "timestamp": 1722603930
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"471788\">Pavel Šavara</span> has marked this topic as resolved.</p>",
        "id": 455932694,
        "sender_full_name": "Notification Bot",
        "timestamp": 1722605239
    }
]