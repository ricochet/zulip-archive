[
    {
        "content": "<p>I tried to follow along with the Bytecode Alliance's blog post on Wasi-nn, and wasn't able to get it to run. One of the Wasi-nn features wasn't available to Wasmtime, despite compiling Wasmtime with <code>--features nn</code>. Code: <a href=\"https://github.com/rjzak/wasi_benchmarks\">https://github.com/rjzak/wasi_benchmarks</a>. Is there any advice? Have things changed since Dec 2020 <a href=\"https://bytecodealliance.org/articles/using-wasi-nn-in-wasmtime\">https://bytecodealliance.org/articles/using-wasi-nn-in-wasmtime</a> ?</p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/rjzak/wasi_benchmarks\" style=\"background-image: url(https\\:\\/\\/uploads\\.zulipusercontent\\.net\\/663ad12de00cfd8f5adc04b1d2f38e6653a97c6d\\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f353339373034363466656363333632303834613634333566346662386236326234663437363164663338376235383038656664343165306564613934643733362f726a7a616b2f776173695f62656e63686d61726b73)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/rjzak/wasi_benchmarks\" title=\"GitHub - rjzak/wasi_benchmarks: Benchmarks for Wasi runtime environments\">GitHub - rjzak/wasi_benchmarks: Benchmarks for Wasi runtime environments</a></div><div class=\"message_embed_description\">Benchmarks for Wasi runtime environments. Contribute to rjzak/wasi_benchmarks development by creating an account on GitHub.</div></div></div><div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://bytecodealliance.org/articles/using-wasi-nn-in-wasmtime\" style=\"background-image: url(https\\:\\/\\/uploads\\.zulipusercontent\\.net\\/b666ca74a20745aca2566cd241108afdcfa09d04\\/68747470733a2f2f62797465636f6465616c6c69616e63652e6f72672f696d616765732f6176617461722e706e67)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://bytecodealliance.org/articles/using-wasi-nn-in-wasmtime\" title=\"Machine Learning in WebAssembly: Using wasi-nn in Wasmtime\">Machine Learning in WebAssembly: Using wasi-nn in Wasmtime</a></div><div class=\"message_embed_description\">The wasi-nn proposal allows WebAssembly programs to access host-provided machine learning(ML) functions. This post will explain the motivation for wasi-nn, a brief look at thespecification, and how to use it in Wasmtime to do machine lea...</div></div></div>",
        "id": 287789137,
        "sender_full_name": "Richard Zak",
        "timestamp": 1656458215
    },
    {
        "content": "<p>Things have changed! I don't think you even have to use that feature flag any more since that feature should now be a default one. Maybe what you're missing is the <code>--wasi-modules experimental-wasi-nn</code> flag at runtime?</p>",
        "id": 287790083,
        "sender_full_name": "Andrew Brown",
        "timestamp": 1656458926
    },
    {
        "content": "<p>cc: <span class=\"user-mention\" data-user-id=\"387536\">@Brian Jones</span> who also works on this</p>",
        "id": 287790108,
        "sender_full_name": "Andrew Brown",
        "timestamp": 1656458955
    },
    {
        "content": "<p>This might be helpful: <a href=\"https://github.com/bytecodealliance/wasmtime/blob/main/ci/run-wasi-nn-example.sh\">https://github.com/bytecodealliance/wasmtime/blob/main/ci/run-wasi-nn-example.sh</a> (and maybe we should document somewhere that that script is a good one to look at for this kind of thing)</p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/bytecodealliance/wasmtime/blob/main/ci/run-wasi-nn-example.sh\" style=\"background-image: url(https\\:\\/\\/uploads\\.zulipusercontent\\.net\\/0b8fad774e44fc109e92817b2f53e73319adc5fe\\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f633836343463363561346564653434666236653463363864383735633130333466353561386665323865323333653834313463633534396266333038636163312f62797465636f6465616c6c69616e63652f7761736d74696d65)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/bytecodealliance/wasmtime/blob/main/ci/run-wasi-nn-example.sh\" title=\"wasmtime/run-wasi-nn-example.sh at main · bytecodealliance/wasmtime\">wasmtime/run-wasi-nn-example.sh at main · bytecodealliance/wasmtime</a></div><div class=\"message_embed_description\">A standalone runtime for WebAssembly. Contribute to bytecodealliance/wasmtime development by creating an account on GitHub.</div></div></div>",
        "id": 287790563,
        "sender_full_name": "Andrew Brown",
        "timestamp": 1656459263
    },
    {
        "content": "<p>I used the <code>--wasi-modules</code> command, and now get a new error, despite running the OpenVINO <code>setupvars.sh</code> script:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">Host</span><span class=\"w\"> </span><span class=\"n\">error</span>: <span class=\"nc\">BackendError</span><span class=\"p\">(</span><span class=\"n\">BackendAccess</span><span class=\"p\">(</span><span class=\"n\">library</span><span class=\"w\"> </span><span class=\"n\">loading</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"w\"></span>\n\n<span class=\"n\">Caused</span><span class=\"w\"> </span><span class=\"n\">by</span>:\n    <span class=\"nc\">system</span><span class=\"w\"> </span><span class=\"n\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">load</span><span class=\"w\"> </span><span class=\"n\">shared</span><span class=\"w\"> </span><span class=\"n\">libraries</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">see</span><span class=\"w\"> </span><span class=\"n\">https</span>:<span class=\"c1\">//github.com/intel/openvino-rs/blob/main/crates/openvino-finder): Unable to find the `inference_engine_c_api` library to load))</span>\n<span class=\"n\">thread</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"na\">main</span><span class=\"o\">'</span><span class=\"w\"> </span><span class=\"n\">panicked</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"na\">not</span><span class=\"w\"> </span><span class=\"n\">implemented</span><span class=\"o\">'</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">crates</span><span class=\"o\">/</span><span class=\"n\">wasi</span><span class=\"o\">-</span><span class=\"n\">nn</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">witx</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">17</span>:<span class=\"mi\">45</span><span class=\"w\"></span>\n<span class=\"n\">note</span>: <span class=\"nc\">run</span><span class=\"w\"> </span><span class=\"n\">with</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">RUST_BACKTRACE</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">environment</span><span class=\"w\"> </span><span class=\"n\">variable</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">display</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">backtrace</span><span class=\"w\"></span>\n</code></pre></div>\n<p>I had thought that wasmtime could link against OpenVINO libraries, but I suppose that isn't the case, as <code>ldd</code> doesn't show anything related to OpenVINO.</p>",
        "id": 287857002,
        "sender_full_name": "Richard Zak",
        "timestamp": 1656510930
    },
    {
        "content": "<p>The libraries are loaded at runtime and it looks like the <code>openvino-finder</code> just cannot find them. That link in the error message explains how it looks for the OpenVINO libraries--could you take a look at that and see if your environment somehow does not include one of those methods for locating the libraries?</p>",
        "id": 287860078,
        "sender_full_name": "Andrew Brown",
        "timestamp": 1656512182
    },
    {
        "content": "<p>Did you source /opt/intel/openvino/bin/setupvars.sh?</p>",
        "id": 287891161,
        "sender_full_name": "Brian Jones",
        "timestamp": 1656524471
    },
    {
        "content": "<p>I'll look more at <code>openvino-finder</code>. And I did run OpenVINO's <code>setupvars.sh</code> script.</p>",
        "id": 287953585,
        "sender_full_name": "Richard Zak",
        "timestamp": 1656544438
    },
    {
        "content": "<p>Let us know how it goes and, if things don't go well, one of us can screen share with you and figure out what's not right in the environment</p>",
        "id": 287957225,
        "sender_full_name": "Andrew Brown",
        "timestamp": 1656546927
    },
    {
        "content": "<p>What's the connection of <code>openvino-finder</code> to all of this? Seems that Wasmtime doesn't use it and maybe it should?</p>",
        "id": 287965232,
        "sender_full_name": "Richard Zak",
        "timestamp": 1656554575
    },
    {
        "content": "<p>Wasmtime depends on the <code>openvino</code> crate which depends on <code>openvino-sys</code> and that depends on <code>openvino-finder</code></p>",
        "id": 288050577,
        "sender_full_name": "Andrew Brown",
        "timestamp": 1656605049
    }
]