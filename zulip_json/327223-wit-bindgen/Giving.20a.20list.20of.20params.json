[
    {
        "content": "<p>Hello! I have a function in my wit which takes a list of struct as a parameter.</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">interface</span><span class=\"w\"> </span><span class=\"n\">michel</span><span class=\"o\">-</span><span class=\"n\">api</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">  </span><span class=\"o\">..</span><span class=\"p\">.</span>\n<span class=\"w\">  </span><span class=\"n\">new</span><span class=\"o\">-</span><span class=\"n\">documents</span><span class=\"o\">-</span><span class=\"k\">for</span><span class=\"o\">-</span><span class=\"n\">index</span>: <span class=\"nc\">func</span><span class=\"p\">(</span><span class=\"n\">index</span>: <span class=\"nc\">string</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">documents</span>: <span class=\"nc\">list</span><span class=\"o\">&lt;</span><span class=\"n\">document</span><span class=\"o\">&gt;</span><span class=\"p\">)</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p>The problem is: my document list is computed, I cannot inline it. And I have lifetime issues..</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">docs</span>: <span class=\"nb\">Vec</span><span class=\"o\">&lt;</span><span class=\"n\">DocumentParam</span><span class=\"o\">&lt;'</span><span class=\"na\">a</span><span class=\"o\">&gt;&gt;</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">files</span>\n<span class=\"w\">        </span><span class=\"p\">.</span><span class=\"n\">iter</span><span class=\"p\">()</span>\n<span class=\"w\">        </span><span class=\"p\">.</span><span class=\"n\">map</span><span class=\"p\">(</span><span class=\"o\">|</span><span class=\"n\">it</span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">DocumentParam</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">            </span><span class=\"n\">identifier</span>: <span class=\"kp\">&amp;</span><span class=\"nc\">it</span><span class=\"p\">.</span><span class=\"n\">id</span><span class=\"p\">.</span><span class=\"n\">to_string</span><span class=\"p\">(),</span>\n<span class=\"w\">            </span><span class=\"n\">fields</span>: <span class=\"kp\">&amp;</span><span class=\"p\">[</span>\n<span class=\"w\">                </span><span class=\"n\">FieldParam</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">                    </span><span class=\"n\">name</span>: <span class=\"s\">\"filename\"</span><span class=\"p\">,</span>\n<span class=\"w\">                    </span><span class=\"n\">value</span>: <span class=\"nc\">Text</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"n\">it</span><span class=\"p\">.</span><span class=\"n\">filename</span><span class=\"p\">.</span><span class=\"n\">to_string</span><span class=\"p\">()),</span>\n<span class=\"w\">                </span><span class=\"p\">},</span>\n<span class=\"w\">                </span><span class=\"n\">FieldParam</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">                    </span><span class=\"n\">name</span>: <span class=\"s\">\"path\"</span><span class=\"p\">,</span>\n<span class=\"w\">                    </span><span class=\"n\">value</span>: <span class=\"nc\">Text</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"n\">it</span><span class=\"p\">.</span><span class=\"n\">path</span><span class=\"p\">.</span><span class=\"n\">to_string_lossy</span><span class=\"p\">()),</span>\n<span class=\"w\">                </span><span class=\"p\">},</span>\n<span class=\"w\">            </span><span class=\"p\">],</span>\n<span class=\"w\">        </span><span class=\"p\">})</span>\n<span class=\"w\">        </span><span class=\"p\">.</span><span class=\"n\">collect</span><span class=\"p\">();</span>\n</code></pre></div>\n<p>I have this error : cannot return value referencing temporary value [E0515] returns a value referencing data owned by the current function</p>",
        "id": 342901675,
        "sender_full_name": "bachrc",
        "timestamp": 1679217879
    },
    {
        "content": "<p>The <code>files</code> is a Vec&lt;FileDocument&gt; where FileDocument is an owned object of mine</p>",
        "id": 342902014,
        "sender_full_name": "bachrc",
        "timestamp": 1679218076
    },
    {
        "content": "<p>It just doesn't seem possible to give this list</p>",
        "id": 342902220,
        "sender_full_name": "bachrc",
        "timestamp": 1679218195
    },
    {
        "content": "<p>Well, after searching even further, I don’t think this is possible. I know this is more a Rust problem, but I can’t find any solution to this. I can only wait for the issue speaking about disabling borrowed types</p>",
        "id": 343346718,
        "sender_full_name": "bachrc",
        "timestamp": 1679399237
    },
    {
        "content": "<p>And I guess that the fact that I don't get any answers means it's not possible <span aria-label=\"sob\" class=\"emoji emoji-1f62d\" role=\"img\" title=\"sob\">:sob:</span></p>",
        "id": 343796132,
        "sender_full_name": "bachrc",
        "timestamp": 1679523545
    },
    {
        "content": "<p>Something like this, perhaps?</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">files</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">files</span><span class=\"p\">.</span><span class=\"n\">iter</span><span class=\"p\">().</span><span class=\"n\">map</span><span class=\"p\">(</span><span class=\"o\">|</span><span class=\"n\">it</span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">  </span><span class=\"p\">(</span><span class=\"n\">it</span><span class=\"p\">.</span><span class=\"n\">id</span><span class=\"p\">.</span><span class=\"n\">to_string</span><span class=\"p\">(),</span><span class=\"w\"> </span><span class=\"n\">it</span><span class=\"p\">.</span><span class=\"n\">filename</span><span class=\"p\">.</span><span class=\"n\">to_string</span><span class=\"p\">(),</span><span class=\"w\"> </span><span class=\"n\">it</span><span class=\"p\">.</span><span class=\"n\">path</span><span class=\"p\">.</span><span class=\"n\">to_string_lossy</span><span class=\"p\">())</span>\n<span class=\"p\">}).</span><span class=\"n\">collect</span>::<span class=\"o\">&lt;</span><span class=\"nb\">Vec</span><span class=\"o\">&lt;</span><span class=\"n\">_</span><span class=\"o\">&gt;&gt;</span><span class=\"p\">();</span>\n\n<span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">docs</span>: <span class=\"nb\">Vec</span><span class=\"o\">&lt;</span><span class=\"n\">DocumentParam</span><span class=\"o\">&lt;'</span><span class=\"nb\">_</span><span class=\"o\">&gt;&gt;</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">files</span>\n<span class=\"w\">        </span><span class=\"p\">.</span><span class=\"n\">iter</span><span class=\"p\">()</span>\n<span class=\"w\">        </span><span class=\"p\">.</span><span class=\"n\">map</span><span class=\"p\">(</span><span class=\"o\">|</span><span class=\"p\">(</span><span class=\"n\">id</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">filename</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">path</span><span class=\"p\">)</span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">DocumentParam</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">            </span><span class=\"n\">identifier</span>: <span class=\"nc\">id</span><span class=\"p\">.</span><span class=\"n\">as_str</span><span class=\"p\">(),</span>\n<span class=\"w\">            </span><span class=\"n\">fields</span>: <span class=\"kp\">&amp;</span><span class=\"p\">[</span>\n<span class=\"w\">                </span><span class=\"n\">FieldParam</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">                    </span><span class=\"n\">name</span>: <span class=\"s\">\"filename\"</span><span class=\"p\">,</span>\n<span class=\"w\">                    </span><span class=\"n\">value</span>: <span class=\"nc\">Text</span><span class=\"p\">(</span><span class=\"n\">filename</span><span class=\"p\">.</span><span class=\"n\">as_str</span><span class=\"p\">()),</span>\n<span class=\"w\">                </span><span class=\"p\">},</span>\n<span class=\"w\">                </span><span class=\"n\">FieldParam</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">                    </span><span class=\"n\">name</span>: <span class=\"s\">\"path\"</span><span class=\"p\">,</span>\n<span class=\"w\">                    </span><span class=\"n\">value</span>: <span class=\"nc\">Text</span><span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">.</span><span class=\"n\">as_str</span><span class=\"p\">()),</span>\n<span class=\"w\">                </span><span class=\"p\">},</span>\n<span class=\"w\">            </span><span class=\"p\">],</span>\n<span class=\"w\">        </span><span class=\"p\">})</span>\n<span class=\"w\">        </span><span class=\"p\">.</span><span class=\"n\">collect</span><span class=\"p\">();</span>\n</code></pre></div>",
        "id": 343797245,
        "sender_full_name": "Joel Dice",
        "timestamp": 1679524083
    },
    {
        "content": "<p>err, actually:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">files</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">files</span>\n<span class=\"w\">        </span><span class=\"p\">.</span><span class=\"n\">iter</span><span class=\"p\">()</span>\n<span class=\"w\">        </span><span class=\"p\">.</span><span class=\"n\">map</span><span class=\"p\">(</span><span class=\"o\">|</span><span class=\"n\">it</span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">            </span><span class=\"p\">(</span>\n<span class=\"w\">                </span><span class=\"n\">it</span><span class=\"p\">.</span><span class=\"n\">id</span><span class=\"p\">.</span><span class=\"n\">to_string</span><span class=\"p\">(),</span>\n<span class=\"w\">                </span><span class=\"n\">it</span><span class=\"p\">.</span><span class=\"n\">filename</span><span class=\"p\">.</span><span class=\"n\">to_string</span><span class=\"p\">(),</span>\n<span class=\"w\">                </span><span class=\"n\">it</span><span class=\"p\">.</span><span class=\"n\">path</span><span class=\"p\">.</span><span class=\"n\">to_string_lossy</span><span class=\"p\">(),</span>\n<span class=\"w\">            </span><span class=\"p\">)</span>\n<span class=\"w\">        </span><span class=\"p\">})</span>\n<span class=\"w\">        </span><span class=\"p\">.</span><span class=\"n\">collect</span>::<span class=\"o\">&lt;</span><span class=\"nb\">Vec</span><span class=\"o\">&lt;</span><span class=\"n\">_</span><span class=\"o\">&gt;&gt;</span><span class=\"p\">();</span>\n\n<span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">files</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">files</span>\n<span class=\"w\">        </span><span class=\"p\">.</span><span class=\"n\">iter</span><span class=\"p\">()</span>\n<span class=\"w\">        </span><span class=\"p\">.</span><span class=\"n\">map</span><span class=\"p\">(</span><span class=\"o\">|</span><span class=\"p\">(</span><span class=\"n\">id</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">filename</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">path</span><span class=\"p\">)</span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">            </span><span class=\"p\">(</span>\n<span class=\"w\">                </span><span class=\"n\">id</span><span class=\"p\">,</span>\n<span class=\"w\">                </span><span class=\"p\">[</span>\n<span class=\"w\">                    </span><span class=\"n\">FieldParam</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">                        </span><span class=\"n\">name</span>: <span class=\"s\">\"filename\"</span><span class=\"p\">,</span>\n<span class=\"w\">                        </span><span class=\"n\">value</span>: <span class=\"nc\">Text</span><span class=\"p\">(</span><span class=\"n\">filename</span><span class=\"p\">.</span><span class=\"n\">as_str</span><span class=\"p\">()),</span>\n<span class=\"w\">                    </span><span class=\"p\">},</span>\n<span class=\"w\">                    </span><span class=\"n\">FieldParam</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">                        </span><span class=\"n\">name</span>: <span class=\"s\">\"path\"</span><span class=\"p\">,</span>\n<span class=\"w\">                        </span><span class=\"n\">value</span>: <span class=\"nc\">Text</span><span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">.</span><span class=\"n\">as_str</span><span class=\"p\">()),</span>\n<span class=\"w\">                    </span><span class=\"p\">},</span>\n<span class=\"w\">                </span><span class=\"p\">],</span>\n<span class=\"w\">            </span><span class=\"p\">)</span>\n<span class=\"w\">        </span><span class=\"p\">})</span>\n<span class=\"w\">        </span><span class=\"p\">.</span><span class=\"n\">collect</span>::<span class=\"o\">&lt;</span><span class=\"nb\">Vec</span><span class=\"o\">&lt;</span><span class=\"n\">_</span><span class=\"o\">&gt;&gt;</span><span class=\"p\">();</span>\n\n<span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">docs</span>: <span class=\"nb\">Vec</span><span class=\"o\">&lt;</span><span class=\"n\">DocumentParam</span><span class=\"o\">&lt;'</span><span class=\"nb\">_</span><span class=\"o\">&gt;&gt;</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">files</span>\n<span class=\"w\">        </span><span class=\"p\">.</span><span class=\"n\">iter</span><span class=\"p\">()</span>\n<span class=\"w\">        </span><span class=\"p\">.</span><span class=\"n\">map</span><span class=\"p\">(</span><span class=\"o\">|</span><span class=\"p\">(</span><span class=\"n\">id</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">fields</span><span class=\"p\">)</span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">DocumentParam</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">            </span><span class=\"n\">identifier</span>: <span class=\"nc\">id</span><span class=\"p\">.</span><span class=\"n\">as_str</span><span class=\"p\">(),</span>\n<span class=\"w\">            </span><span class=\"n\">fields</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"p\">})</span>\n<span class=\"w\">        </span><span class=\"p\">.</span><span class=\"n\">collect</span><span class=\"p\">();</span>\n</code></pre></div>",
        "id": 343799505,
        "sender_full_name": "Joel Dice",
        "timestamp": 1679525316
    },
    {
        "content": "<p>Wow, it seems like it is working... i totally did not understand how splitting this in three variables would help with the ownership in the function, but I really thank you for your time, it really means a lot</p>",
        "id": 344349553,
        "sender_full_name": "bachrc",
        "timestamp": 1679685031
    },
    {
        "content": "<p>Storing the stings and arrays in named variables in the outer scope instead of temporaries in the inner scopes of the closures ensures that the references don't outlive their referents, which is what is needed to make the compiler happy.  The first <code>Vec</code> stores the strings, the second <code>Vec</code> stores the arrays which refer to the strings in the first <code>Vec</code>, and the third <code>Vec</code> stores the references to the arrays in the second <code>Vec</code>, plus the <code>id</code> strings stored in the first <code>Vec</code>.</p>\n<p>You could technically do this more concisely if you venture into the world of self-referential structs using e.g. <code>ouroboros</code> but I wouldn't recommend that for simple situations like this.</p>",
        "id": 344367760,
        "sender_full_name": "Joel Dice",
        "timestamp": 1679691939
    }
]