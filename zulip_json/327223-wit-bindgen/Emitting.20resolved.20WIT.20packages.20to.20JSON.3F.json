[
    {
        "content": "<h2>Challenge</h2>\n<p>Currently, all the <code>wit-bindgen-&lt;language&gt;</code> are written in Rust to emit language code, given that the parsed WIT AST (in particular, <code>Resolve</code> struct) is in Rust. This poses some challenges to language experts to develop and maintain bindgen because they will have to know Rust well. This motivates the idea of developing bindgen in their own languages consuming resolved WIT packages. The question is how and in what format can we supply resolved WIT packages to bindgen written in different languages.</p>\n<h2>Ideas</h2>\n<ol>\n<li>Each bindgen parses fully-resolved WIT packages and then generate bindings</li>\n<li><code>wasm-tools</code> emits a serialization format (like JSON) for fully-resolved WIT packages as a typed tree structure, so that each bindgen can deserialize to language-specific data structures for consuming. </li>\n</ol>\n<p>What do you all think?</p>",
        "id": 383060485,
        "sender_full_name": "Mossaka (Joe)",
        "timestamp": 1691523297
    },
    {
        "content": "<p>Should generators be...components?</p>",
        "id": 383062678,
        "sender_full_name": "Lann Martin",
        "timestamp": 1691523900
    },
    {
        "content": "<p>wait but in order to get components, we will need WIT repr of the WIT AST <span aria-label=\"exploding head\" class=\"emoji emoji-1f92f\" role=\"img\" title=\"exploding head\">:exploding_head:</span></p>",
        "id": 383063658,
        "sender_full_name": "Mossaka (Joe)",
        "timestamp": 1691524168
    },
    {
        "content": "<p><a href=\"https://github.com/protocolbuffers/protobuf/blob/v21.3/src/google/protobuf/descriptor.proto#L62\">https://github.com/protocolbuffers/protobuf/blob/v21.3/src/google/protobuf/descriptor.proto#L62</a> <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span></p>",
        "id": 383063881,
        "sender_full_name": "Lann Martin",
        "timestamp": 1691524231
    },
    {
        "content": "<p>Proposing that the component generator be a component feels appropriate for someone having the \"Untitled Goose Game\" goose as a user-pic <span aria-label=\"laughing\" class=\"emoji emoji-1f606\" role=\"img\" title=\"laughing\">:laughing:</span></p>",
        "id": 383064122,
        "sender_full_name": "Jamey Sharp",
        "timestamp": 1691524304
    },
    {
        "content": "<p>I actually have a use-case for this in the warg registry: JIT generation of bindings for interface packages</p>",
        "id": 383064596,
        "sender_full_name": "Lann Martin",
        "timestamp": 1691524455
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"253994\">@Alex Crichton</span> how difficult do you think this would be? ^ \"This\" being the introduction of a component interface for wit-bindgen generators</p>",
        "id": 383092800,
        "sender_full_name": "Till Schneidereit",
        "timestamp": 1691533767
    },
    {
        "content": "<p>Oh definitely doable IMO, and I think it'd be pretty neat to have something like that combined with an otherwise language-native wasm-dep-management solution or something like that</p>",
        "id": 383093546,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1691534182
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"480579\">@Lann Martin</span> could you please elaborate more about how a component interface for generators would help to solve the challenge mentioned at the top? Isn't this a circular problem that in order to have component in language A, you will need a binding generator, but in order to have binding generator in language A, you will need to have a component?</p>",
        "id": 383117761,
        "sender_full_name": "Mossaka (Joe)",
        "timestamp": 1691544575
    },
    {
        "content": "<p>You can either bootstrap from another language or write the first bindings manually. In practice I think you'll end up writing a lot of initial codegen samples manually anyway.</p>",
        "id": 383118712,
        "sender_full_name": "Lann Martin",
        "timestamp": 1691544995
    },
    {
        "content": "<p>Anyway these aren't mutually exclusive ideas; a codegen component could emit JSON as easily as anything else.</p>",
        "id": 383119583,
        "sender_full_name": "Lann Martin",
        "timestamp": 1691545390
    },
    {
        "content": "<p><span aria-label=\"wave\" class=\"emoji emoji-1f44b\" role=\"img\" title=\"wave\">:wave:</span> I was chatting with <span class=\"user-mention\" data-user-id=\"487764\">@Mossaka (Joe)</span> in the Go Slack about this topic, so he raised it here. I’m interested in helping out with the Go interfaces generated by wit-bindgen.</p>\n<p>It struck me as somewhat similar to the Protobuf tool protoc, which can use external tools to generate language-specific bindings for a Protobuf description. The Protobuf tooling to generate Go bindings is written in Go, so it can use the Go types and AST packages, as well as code formatting and verification.</p>\n<p>As Joe pointed out in the OP, it means that a Go developer can (more?) easily contribute, as the tooling to emit Go is written in Go. I wondered if the same would be possible for wit-bindgen.</p>\n<p>Reading the source code to wit-bindgen, I noticed a Markdown emitter. Guessing here, would it be possible to emit a JSON description of the WIT that another program could consume (e.g. wit-bindgen-go)? I’m not very familiar with Rust, but is there an idiomatic way to emit JSON from a data structure?</p>\n<p>Thanks!</p>",
        "id": 383417176,
        "sender_full_name": "Randy Reddig",
        "timestamp": 1691615003
    },
    {
        "content": "<p>Wit-Bindgen consists of an input parser (or several if you also want to support binary representations of wit), an abstract machine to lift and lower arguments (wasm-tools' cabi create, soon to be moved to wit-bindgen repo) and a code generator with multiple layers.<br>\nI recommend to share the first two across languages, even though the canonical ABI crate's API is quite complex, but sufficiently documented in rustdoc (it took me some time to find this).</p>\n<p>(I am working on creating c++ bindings for both sides and had to dig deeply to learn to value this architecture, but to me switching to c++ was never an option <span aria-label=\"grinning face with smiling eyes\" class=\"emoji emoji-1f601\" role=\"img\" title=\"grinning face with smiling eyes\">:grinning_face_with_smiling_eyes:</span>)</p>",
        "id": 383501518,
        "sender_full_name": "Christof Petig",
        "timestamp": 1691646788
    },
    {
        "content": "<p>Oh, I should probably mention that Alex plans to rewrite the cabi code to generate lifting and lowering functions (there is an issue in wasm tools and wit-bindgen describing this plan), this should make the generated code more easy to understand (also by formatting tools).</p>",
        "id": 383502407,
        "sender_full_name": "Christof Petig",
        "timestamp": 1691647141
    },
    {
        "content": "<p><a href=\"https://github.com/bytecodealliance/wasm-tools/pull/1149\">https://github.com/bytecodealliance/wasm-tools/pull/1149</a></p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/bytecodealliance/wasm-tools/pull/1149\" style=\"background-image: url(https\\:\\/\\/uploads\\.zulipusercontent\\.net\\/c4d962e43b336f755641ecaf814e93db1eac7042\\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f656161636330343064386231326166633936376436666165333134653362663937363163663262346361626537323538303731623064646564613139653637622f62797465636f6465616c6c69616e63652f7761736d2d746f6f6c732f70756c6c2f31313439)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/bytecodealliance/wasm-tools/pull/1149\" title=\"Delete most of `abi` from `wit-parser` by alexcrichton · Pull Request #1149 · bytecodealliance/wasm-tools\">Delete most of `abi` from `wit-parser` by alexcrichton · Pull Request #1149 · bytecodealliance/wasm-tools</a></div><div class=\"message_embed_description\">This commit deletes most of the abi module from the wit-parser crate. This functionality is entirely untested in this repository and was originally intended for wit-bindgen-style generators. In thi...</div></div></div>",
        "id": 383502867,
        "sender_full_name": "Christof Petig",
        "timestamp": 1691647284
    },
    {
        "content": "<p>What if we followed the <a href=\"https://microsoft.github.io/language-server-protocol/\">LSP</a> approach, allowing (bootstrap) bindings generators to be written as WASI commands that speak JSON-RPC over stdio? This would allow reuse of generation code via method call while reducing the bootstrapping requirements to \"just\" supporting WASI.</p>",
        "id": 383741857,
        "sender_full_name": "Lann Martin",
        "timestamp": 1691696878
    },
    {
        "content": "<p>(this could also run native binaries without WASI, but for <em>my</em> pet use-cases I'd like them to use wasm <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span>)</p>",
        "id": 383742126,
        "sender_full_name": "Lann Martin",
        "timestamp": 1691696970
    },
    {
        "content": "<p>Hey there, I've raised an issue on the wit-bindgen repo as I think this is valuable to all. <a href=\"https://github.com/bytecodealliance/wit-bindgen/issues/640\">https://github.com/bytecodealliance/wit-bindgen/issues/640</a></p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/bytecodealliance/wit-bindgen/issues/640\" style=\"background-image: url(https\\:\\/\\/uploads\\.zulipusercontent\\.net\\/7750ad977e68dcd9843bfaaedf2c8502f79d0e9d\\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f356264613063353934343362656230393837306566633231366261653166303065376437643036323839316130643662656436343035313264333465363665392f62797465636f6465616c6c69616e63652f7769742d62696e6467656e2f6973737565732f363430)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/bytecodealliance/wit-bindgen/issues/640\" title=\"Proposal: Allowing WIT bindgen written in languages they are generating for · Issue #640 · bytecodealliance/wit-bindgen\">Proposal: Allowing WIT bindgen written in languages they are generating for · Issue #640 · bytecodealliance/wit-bindgen</a></div><div class=\"message_embed_description\">@ydnar and I originally posted this little proposal on this zulipchat post and I am raising an issue here for a bigger exposure. Challenges Currently, all the WIT binding generators are written in ...</div></div></div>",
        "id": 383765711,
        "sender_full_name": "Mossaka (Joe)",
        "timestamp": 1691704251
    },
    {
        "content": "<blockquote>\n<p>What if we followed the LSP approach</p>\n</blockquote>\n<p>I like this idea!</p>",
        "id": 383767202,
        "sender_full_name": "Mossaka (Joe)",
        "timestamp": 1691704714
    },
    {
        "content": "<p>Follow up on this thread: <span class=\"user-mention\" data-user-id=\"487764\">@Mossaka (Joe)</span> and I have made some progress: JSON serialization support was merged into the <code>wit-parser</code> crate, and we have a Go implementation that can ingest the WIT JSON and re-emit WIT as a proof of concept: <a href=\"https://github.com/ydnar/wasm-tools-go\">https://github.com/ydnar/wasm-tools-go</a></p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/ydnar/wasm-tools-go\" style=\"background-image: url(https\\:\\/\\/uploads\\.zulipusercontent\\.net\\/26451a131093e786df3673d880a8b59d7b748467\\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f353365376438613664633630303735656165653562316162366333393134303837653638333166303962323435376634626632656665316637303635393962632f79646e61722f7761736d2d746f6f6c732d676f)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/ydnar/wasm-tools-go\" title=\"GitHub - ydnar/wasm-tools-go: WebAssembly + WASI tools for go\">GitHub - ydnar/wasm-tools-go: WebAssembly + WASI tools for go</a></div><div class=\"message_embed_description\">WebAssembly + WASI tools for go. Contribute to ydnar/wasm-tools-go development by creating an account on GitHub.</div></div></div>",
        "id": 393264375,
        "sender_full_name": "Randy Reddig",
        "timestamp": 1695742475
    }
]