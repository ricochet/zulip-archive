[
    {
        "content": "<p>Hello everyone, I'm new to the server.</p>\n<p>I'm doing a bachelor thesis next spring, so I'm looking for a topic right now. My compiler professor was positive about the idea of contributing to cranelift. Next step would be to find something concrete to work on. I'm excited about the idea of cranelift being used as a backend for rustc debug builds. That being said, some of you probably have a much better idea of what could be a suitable area to work on and fits in the scope of a bachelor thesis. The thesis will most likely be done by two people. I still need to find a partner, but I'm optimistic about that once I have concrete ideas to offer.</p>\n<p>I'm obviously also talking to other professors about other topics, so nothing is set in stone.</p>\n<p>Best regards, Remo</p>",
        "id": 303573028,
        "sender_full_name": "Remo Senekowitsch",
        "timestamp": 1665559630
    },
    {
        "content": "<p>Hi, author of the cranelift backend for rustc and a fellow student here.</p>",
        "id": 303608312,
        "sender_full_name": "bjorn3",
        "timestamp": 1665574657
    },
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"554293\">@Remo Senekowitsch</span> <span aria-label=\"wavy dash\" class=\"emoji emoji-3030\" role=\"img\" title=\"wavy dash\">:wavy_dash:</span> </p>\n<p>One idea we've been kicking around for a while but haven't had a chance to invest time in yet is a \"chaos mode\" for Cranelift that would help us uncover latent bugs: <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4134\">https://github.com/bytecodealliance/wasmtime/issues/4134</a></p>\n<p>Maybe this (or part of it, since the scope could almost endlessly expand) is interesting to you?</p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/bytecodealliance/wasmtime/issues/4134\" style=\"background-image: url(https\\:\\/\\/uploads\\.zulipusercontent\\.net\\/aa5ad8057ccf92a7cdecf0eb35c8ac73746197ae\\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f363437633430623235613135616664303461316238636532346335363130346435393537346238643466633838616234646138326264663534333633306232332f62797465636f6465616c6c69616e63652f7761736d74696d652f6973737565732f34313334)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/bytecodealliance/wasmtime/issues/4134\" title=\"Cranelift: test the compiler with a &quot;chaos mode&quot; · Issue #4134 · bytecodealliance/wasmtime\">Cranelift: test the compiler with a \"chaos mode\" · Issue #4134 · bytecodealliance/wasmtime</a></div><div class=\"message_embed_description\">We should rigorously test the compiler with a randomized testing strategy one might call &quot;chaos mode&quot;. The general idea is to introduce perturbations (deterministically derived from some ...</div></div></div>",
        "id": 303620132,
        "sender_full_name": "fitzgen (he/him)",
        "timestamp": 1665578936
    },
    {
        "content": "<p>Thank you, this sounds very interesting! I'll rephrase the basic idea to make sure I understood correctly:</p>\n<p>Centrally and deterministically from a seed, it should be possible to fuzz test different possible decisions the compiler can make. So that <em>doesn't</em> mean errors and invalid states / decisions are inserted or forced, in order to test if the compiler can recover from errors. Rather, it would be used to test situations where it is thought the compiler should behave equally, independent of a chosen option. This would make it easier to discover and locate bugs where that assumption is broken.</p>",
        "id": 303662805,
        "sender_full_name": "Remo Senekowitsch",
        "timestamp": 1665588027
    },
    {
        "content": "<p>we would use this mode when fuzzing but nothing about the mode should be tied to fuzzing</p>\n<p>compilation should still be deterministic, given the same chaos mode seed</p>\n<blockquote>\n<p>So that doesn't mean errors and invalid states / decisions are inserted or forced, in order to test if the compiler can recover from errors. Rather, it would be used to test situations where it is thought the compiler should behave equally, independent of a chosen option. </p>\n</blockquote>\n<p>exactly.</p>\n<p>for example, when there is too much register pressure, we need to spill a value that is currently in a register to the stack to make room for the current value that must be in a register right now. which register do we spill? our register allocator has heuristics for choosing one right now, but what if we chose a different, random one? that is still valid, despite probably not ideal from a code quality point of view, and it definitely shouldn't trigger a bug in instruction encoding or change the semantics of the compiled program</p>",
        "id": 303664311,
        "sender_full_name": "fitzgen (he/him)",
        "timestamp": 1665588492
    },
    {
        "content": "<p>That would be fantastic if you wanted to tackle this idea, <span class=\"user-mention\" data-user-id=\"554293\">@Remo Senekowitsch</span> ! Just chiming in to say I'd be happy to mentor this; it's an idea we've had floating around for a few years and I've wanted to see it implemented as I think it has significant value in ensuring correctness</p>",
        "id": 303668778,
        "sender_full_name": "Chris Fallin",
        "timestamp": 1665589921
    },
    {
        "content": "<p>One nice aspect here from the point of view of a time-scoped project is that it's fairly modular and adjustable in effort: there's a framework, then there are a bunch of specific ideas (configurable spills, explicitly clobbering undefined state, tweaking isel, changing inst/block order, changing optimization pass order/applicability, ...) that can make the project smaller or larger as your time allows</p>",
        "id": 303669309,
        "sender_full_name": "Chris Fallin",
        "timestamp": 1665590072
    },
    {
        "content": "<p>That sounds amazing, having a mentor from the project would be immensely helpful! And I agree it's a perfect fit as the scope is quite flexible. I'll run this by my professor and get back to you when I have news.</p>",
        "id": 303675576,
        "sender_full_name": "Remo Senekowitsch",
        "timestamp": 1665592085
    },
    {
        "content": "<p>Hello, little status update from my side. My professor has agreed to do it! And I think he would still be ok if I did it alone, in which case, I would want to do it alone. But my school is pushing for people to do it in groups. I've been talking to two other students who have experience with Rust, love it and would be interested in this specific idea as well. I think it's likely they'll agree to do it with me in a group of three. (Maybe the professor would ask to expand the scope in that case.)</p>\n<p>The decision is usually finalized in December, so that would be the latest you hear from me again. Likely sooner, if there are relevant news for you in the meantime. I'm excited!</p>\n<p>Have a good day <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span></p>",
        "id": 305779595,
        "sender_full_name": "Remo Senekowitsch",
        "timestamp": 1666603946
    },
    {
        "content": "<p>exciting!</p>",
        "id": 305843163,
        "sender_full_name": "fitzgen (he/him)",
        "timestamp": 1666624549
    },
    {
        "content": "<p>That's super-exciting! Happy to meet, help brainstorm/write out details, etc whenever you need; just let us know</p>",
        "id": 305859512,
        "sender_full_name": "Chris Fallin",
        "timestamp": 1666629077
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"254389\">Chris Fallin</span> <a href=\"#narrow/stream/217117-cranelift/topic/Chaos.20mode.20bachelor.20thesis/near/305859512\">said</a>:</p>\n<blockquote>\n<p>That's super-exciting! Happy to meet, help brainstorm/write out details, etc whenever you need; just let us know</p>\n</blockquote>\n<p>I'd love to take you up on this offer <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span> I'm thinking it would be best to have a meeting with:</p>\n<ul>\n<li>you</li>\n<li>us three students</li>\n<li>our professor</li>\n</ul>\n<p>to discuss some details. I will see them on Monday and ask them what exactly they would like to discuss so the meeting can be efficient. I'll get back to you when I know more.</p>\n<p>And I have two small questions to get a better idea of the work we'd be doing:</p>\n<ul>\n<li>What would be a good example of a heuristic decision that should be influenced by the chaos mode? (pointers to one or two source files &amp; line number would be perfect)</li>\n<li>The chaos mode will be a pretty intrusive form of dependency injection. What kind of approach would be appropriate for this? possibilities that are floating around in my head:<ul>\n<li>injecting choas mode via generic arguments / strategy pattern. probably a bad idea, leads to unnecessary \"prop drilling\" bloating the code</li>\n<li>using macros to modify heuristic decisions</li>\n<li>conditional compilation, turning on chaos mode via a feature</li>\n</ul>\n</li>\n</ul>\n<p>The way I understand it currently, I'm leaning toward conditional compilation. It would be pretty simple to do, easy to turn chaos mode on, and still provide the necessary flexibility of running arbitrary code per decision, so each perturbation can make use of the control plane differently according to need. pseudo code:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"k\">mod</span> <span class=\"nn\">chaos_engine</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"k\">fn</span> <span class=\"nf\">get_chaotic_decision</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">{}</span><span class=\"w\"></span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n\n<span class=\"k\">mod</span> <span class=\"nn\">some_heuristic</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"k\">fn</span> <span class=\"nf\">make_decision</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"cp\">#[cfg(not(feature = </span><span class=\"s\">\"chaos_mode\"</span><span class=\"cp\">))]</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">decision</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">get_mormal_decision</span><span class=\"p\">();</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"cp\">#[cfg(feature = </span><span class=\"s\">\"chaos_mode\"</span><span class=\"cp\">)]</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">decision</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">chaos_engine</span>::<span class=\"n\">get_chaotic_decision</span><span class=\"p\">();</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">}</span><span class=\"w\"></span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n</code></pre></div>",
        "id": 306839944,
        "sender_full_name": "Remo Senekowitsch",
        "timestamp": 1667050497
    },
    {
        "content": "<p>There are a lot of heuristics in regalloc2 chaos mode can influence I think. You could also randomize basic block order (<a href=\"https://github.com/bytecodealliance/wasmtime/blob/main/cranelift/codegen/src/machinst/blockorder.rs\">https://github.com/bytecodealliance/wasmtime/blob/main/cranelift/codegen/src/machinst/blockorder.rs</a>), not optimize branches away (<a href=\"https://github.com/bytecodealliance/wasmtime/blob/434fbf2b27e900533e438088ac843215f2ec19d3/cranelift/codegen/src/machinst/buffer.rs#L775\">https://github.com/bytecodealliance/wasmtime/blob/434fbf2b27e900533e438088ac843215f2ec19d3/cranelift/codegen/src/machinst/buffer.rs#L775</a>) and other things of that kind.</p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/bytecodealliance/wasmtime/blob/main/cranelift/codegen/src/machinst/blockorder.rs\" style=\"background-image: url(https\\:\\/\\/uploads\\.zulipusercontent\\.net\\/5e26c069cedee430dd873707459599d2b81e788d\\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f316236623563356266386335646133623832333462343236386361313538353332646565323363316130336338666332323961633436316166333337326532312f62797465636f6465616c6c69616e63652f7761736d74696d65)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/bytecodealliance/wasmtime/blob/main/cranelift/codegen/src/machinst/blockorder.rs\" title=\"wasmtime/blockorder.rs at main · bytecodealliance/wasmtime\">wasmtime/blockorder.rs at main · bytecodealliance/wasmtime</a></div><div class=\"message_embed_description\">A fast and secure runtime for WebAssembly. Contribute to bytecodealliance/wasmtime development by creating an account on GitHub.</div></div></div><div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/bytecodealliance/wasmtime/blob/434fbf2b27e900533e438088ac843215f2ec19d3/cranelift/codegen/src/machinst/buffer.rs#L775\" style=\"background-image: url(https\\:\\/\\/uploads\\.zulipusercontent\\.net\\/5e26c069cedee430dd873707459599d2b81e788d\\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f316236623563356266386335646133623832333462343236386361313538353332646565323363316130336338666332323961633436316166333337326532312f62797465636f6465616c6c69616e63652f7761736d74696d65)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/bytecodealliance/wasmtime/blob/434fbf2b27e900533e438088ac843215f2ec19d3/cranelift/codegen/src/machinst/buffer.rs#L775\" title=\"wasmtime/buffer.rs at 434fbf2b27e900533e438088ac843215f2ec19d3 · bytecodealliance/wasmtime\">wasmtime/buffer.rs at 434fbf2b27e900533e438088ac843215f2ec19d3 · bytecodealliance/wasmtime</a></div><div class=\"message_embed_description\">A fast and secure runtime for WebAssembly. Contribute to bytecodealliance/wasmtime development by creating an account on GitHub.</div></div></div>",
        "id": 306886487,
        "sender_full_name": "bjorn3",
        "timestamp": 1667076397
    },
    {
        "content": "<p>I think chaos mode should be behind a feature flag, but also make it possible to set a fixed seed to allow reproducing bugs uncovered by chaos mode.</p>",
        "id": 306886619,
        "sender_full_name": "bjorn3",
        "timestamp": 1667076491
    },
    {
        "content": "<p>Thanks! I was thinking a command line argument or environment variable for the seed should be fine?</p>",
        "id": 306888352,
        "sender_full_name": "Remo Senekowitsch",
        "timestamp": 1667077923
    },
    {
        "content": "<p>That would work as interface when using wasmtime, but I don't think cranelift itself should set it. Maybe there could be a <a href=\"https://docs.rs/cranelift-codegen/latest/cranelift_codegen/settings/struct.Flags.html\">cranelift flag</a> with the seed?</p>",
        "id": 306893561,
        "sender_full_name": "bjorn3",
        "timestamp": 1667082778
    },
    {
        "content": "<p>Hello <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span> Just letting you know that the paperwork is signed! <span aria-label=\"tada\" class=\"emoji emoji-1f389\" role=\"img\" title=\"tada\">:tada:</span> I'm looking forward to working on this, starting in mid February.</p>",
        "id": 316445790,
        "sender_full_name": "Remo Senekowitsch",
        "timestamp": 1671278961
    },
    {
        "content": "<p>Exciting!</p>",
        "id": 319249353,
        "sender_full_name": "fitzgen (he/him)",
        "timestamp": 1672768668
    },
    {
        "content": "<p>Hello!</p>\n<p>Semester has started and today was the first day we were working on the bachelor thesis. Our first goal is to get our feet wet in the code base, such that we can figure out how our testing stuff is going to fit into the existing framework.</p>\n<p>We're having trouble getting the fuzz tests to run (same problem on two machines, fedora and pop os).</p>\n<p>It seems to us that <code>crates/fuzzing/wasm-spec-interpreter</code> is not building correctly. In that directory, we found some more specific instructions not contained in the regular documentation, like the book chapter 9.4. Specifically we installed <code>ocaml</code> and <code>libgmp</code> (<code>gmp-static</code> in my case, running fedora). However, we still get the following error output (e.g. by running <code>cargo fuzz run api_calls</code>):</p>\n<p><a href=\"/user_uploads/15107/SDhFZEFsRjg0ALBsBxBM-cZT/fuzz_failure.txt\">fuzz_failure.txt</a></p>\n<p>I don't really understand most of that. I'm not experienced with <code>make</code> or <code>OCaml</code>. What caught my eye was this:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">make</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">]</span>: <span class=\"nc\">ocamlbuild</span>: <span class=\"nc\">No</span><span class=\"w\"> </span><span class=\"n\">such</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"w\"> </span><span class=\"n\">or</span><span class=\"w\"> </span><span class=\"n\">directory</span>\n</code></pre></div>\n<p>And we found this in the Makefile:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code>#<span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"n\">space</span><span class=\"o\">-</span><span class=\"n\">separated</span><span class=\"w\"> </span><span class=\"n\">list</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">paths</span><span class=\"w\"> </span><span class=\"n\">that</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">linker</span><span class=\"w\"> </span><span class=\"n\">will</span><span class=\"w\"> </span><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">search</span><span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"n\">libgmp</span><span class=\"p\">.</span>\n#<span class=\"w\"> </span><span class=\"n\">Override</span><span class=\"w\"> </span><span class=\"n\">with</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">make</span><span class=\"w\"> </span><span class=\"n\">LIBGMP_PATHS</span><span class=\"o\">=..</span><span class=\"p\">.</span><span class=\"err\">`</span><span class=\"p\">.</span>\n<span class=\"n\">LIBGMP_PATHS</span><span class=\"w\"> </span><span class=\"o\">?=</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">usr</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">usr</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"o\">/</span><span class=\"n\">x86_64</span><span class=\"o\">-</span><span class=\"n\">linux</span><span class=\"o\">-</span><span class=\"n\">gnu</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">lib64</span>\n</code></pre></div>\n<p>Feeling lucky, I added <code>/usr/lib64</code> to this list, which seems to be where fedora put <code>libgmp</code> in my case. But sadly, that wasn't it. I might be on the wrong track.</p>\n<p>Maybe someone can help us figure this out?</p>",
        "id": 329783754,
        "sender_full_name": "Remo Senekowitsch",
        "timestamp": 1677174912
    },
    {
        "content": "<p>Building with the spec interpreter requires OCaml to be installed locally; <span class=\"user-mention\" data-user-id=\"254110\">@Andrew Brown</span> might have more specific suggestions (perhaps we can improve the docs too). But actually most of my fuzzing work I do with the spec-interpreter disabled, as I also have occasional troubles with the ocaml build :-)</p>\n<p>You can do this by removing the <code>fuzz-spec-interpreter</code> feature from the <code>default</code> feature list in <code>fuzz/Cargo.toml</code>, IIRC...</p>",
        "id": 329787045,
        "sender_full_name": "Chris Fallin",
        "timestamp": 1677175819
    },
    {
        "content": "<p>That seems to work! Thanks a lot :-)</p>",
        "id": 329791924,
        "sender_full_name": "Remo Senekowitsch",
        "timestamp": 1677177292
    },
    {
        "content": "<p>Another option is to build the fuzzers with <code>--no-default-features</code> which will disable the build of the ocaml interpreter, which I frequently do myself when I haven't installed ocaml already on a machine</p>",
        "id": 329793807,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1677177865
    },
    {
        "content": "<p>If you do want to end up fuzzing with the spec interpreter, you probably want to <a href=\"https://opam.ocaml.org/doc/Install.html\">install OPAM</a> and then run something like <code>opam install ocamlbuild</code> to install the binary you're missing. I suspect there's a Fedora package that also provides it.</p>",
        "id": 329815135,
        "sender_full_name": "Andrew Brown",
        "timestamp": 1677185109
    },
    {
        "content": "<p>FYI I filed an issue for one chaos thing we could do: <a href=\"https://github.com/bytecodealliance/wasmtime/issues/6009\">https://github.com/bytecodealliance/wasmtime/issues/6009</a></p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/bytecodealliance/wasmtime/issues/6009\" style=\"background-image: url(https\\:\\/\\/uploads\\.zulipusercontent\\.net\\/08acb19ef13bebda037ff192fde430ac28a7872a\\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f643631623566643630383632336634616337376166316132626135393564393839653637336134333238363431636437313837353931393765303230356462642f62797465636f6465616c6c69616e63652f7761736d74696d652f6973737565732f36303039)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/bytecodealliance/wasmtime/issues/6009\" title=\"[chaos mode] Choose a random e-node from the e-class rather than the best one · Issue #6009 · bytecodealliance/wasmtime\">[chaos mode] Choose a random e-node from the e-class rather than the best one · Issue #6009 · bytecodealliance/wasmtime</a></div><div class=\"message_embed_description\">This is what wasm-mutate does to generate pseudo-random semantics-preserving Wasm programs from an input Wasm module. We could also do it in our own mid end to exercise the back half of the compile...</div></div></div>",
        "id": 341570527,
        "sender_full_name": "fitzgen (he/him)",
        "timestamp": 1678740547
    },
    {
        "content": "<p>Thanks! I linked it to the original issue and I'm adding it to our notes.</p>",
        "id": 342081816,
        "sender_full_name": "Remo Senekowitsch",
        "timestamp": 1678892234
    },
    {
        "content": "<p>I've got fuzz testing with randomly skipped branch optimization working <span aria-label=\"tada\" class=\"emoji emoji-1f389\" role=\"img\" title=\"tada\">:tada:</span> here's <a href=\"https://github.com/bytecodealliance/wasmtime/pull/6039\">the draft PR</a></p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/bytecodealliance/wasmtime/pull/6039\" style=\"background-image: url(https\\:\\/\\/uploads\\.zulipusercontent\\.net\\/3ae77a53e17bfa7e37ea06a4147532e67a7889a4\\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f353862643130636537663262643265356463343465363065306538373430653438376538346564336563313338323837653865366237353439383532366661652f62797465636f6465616c6c69616e63652f7761736d74696d652f70756c6c2f36303339)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/bytecodealliance/wasmtime/pull/6039\" title=\"Chaos mode MVP: Skip branch optimization in MachBuffer by remlse · Pull Request #6039 · bytecodealliance/wasmtime\">Chaos mode MVP: Skip branch optimization in MachBuffer by remlse · Pull Request #6039 · bytecodealliance/wasmtime</a></div><div class=\"message_embed_description\">This is a draft of the MVP for chaos mode (#4134).\nIt extends the fuzz target cranelift-icache for now, by allowing it to run with the feature chaos enabled. This will pseudo-randomly toggle branch...</div></div></div>",
        "id": 342469129,
        "sender_full_name": "Remo Senekowitsch",
        "timestamp": 1679027564
    },
    {
        "content": "<p>I missed a couple spots, gonna fix CI when I get a minute</p>",
        "id": 342470228,
        "sender_full_name": "Remo Senekowitsch",
        "timestamp": 1679028565
    },
    {
        "content": "<p>This is fantastic work -- I plan to review it today. Thanks so much!</p>",
        "id": 342617676,
        "sender_full_name": "Chris Fallin",
        "timestamp": 1679072053
    },
    {
        "content": "<p>Small question - what is the general policy / convention on rebasing and rewriting history? Is it ok if the commits in a PR are a little messy, and at the end the commits are rewritten to be neat, logical, atomic? Or is the history left as is for already reviewed commits? I can see that the history is linear, so rebasing is required, but maybe there's an understanding to not go overboard with it.</p>",
        "id": 344090056,
        "sender_full_name": "Remo Senekowitsch",
        "timestamp": 1679601843
    },
    {
        "content": "<p>It's usually better during codereview to push new commits rather than force-push over the existing history, because the latter makes it harder to see \"what haven't I reviewed yet\" and makes comments go stale</p>",
        "id": 344090295,
        "sender_full_name": "Chris Fallin",
        "timestamp": 1679601920
    },
    {
        "content": "<p>we squash-on-merge so a PR will be one commit once it's done</p>",
        "id": 344090361,
        "sender_full_name": "Chris Fallin",
        "timestamp": 1679601939
    },
    {
        "content": "<p>sometimes it's good if there's a lot of work-in-progress history to rebase once, at the end, before we squash-on-merge so we get a nicer concatenated commit message, but that's not strictly necessary</p>",
        "id": 344090504,
        "sender_full_name": "Chris Fallin",
        "timestamp": 1679601969
    },
    {
        "content": "<p>to add on to what Chris said: in general it is nice to have logical commits (when that doesn't ruin history for follow up reviews after new commits addressing previous reviews' feedback) so when first opening a PR, it may make sense to clean things up a bit, or squash to a single commit if the history is messy. that also makes it easier for reviewers.</p>",
        "id": 345159800,
        "sender_full_name": "fitzgen (he/him)",
        "timestamp": 1680015664
    },
    {
        "content": "<p>I have a little proof of concept working for the fuel parameter. I'm not yet sure where this parameter should be coming from though. The <code>settings::Flags</code> has been suggested, so I tried to figure out how these are set. It seems that can be done via wasmtime CLI arguments, but also comments inside a WAT file? There might be more, I didn't check all the references exhaustively.</p>\n<p>During fuzz testing, we're not using the wasmtime CLI and also not manipulating WAT files directly. Is there another suitable way to inject settings flags that I'm missing?</p>\n<p>We could also just read the fuel parameter from an environment variable. I'm thinking the binary search for bug sources could be handled by a little CLI tool that manages this environment variable. What do you think?</p>",
        "id": 348273134,
        "sender_full_name": "Remo Senekowitsch",
        "timestamp": 1681149108
    },
    {
        "content": "<p>Settings are part of the compilation fuzz targets; there should be plumbing where they are injected into the backend construction (the <code>wasmtime::Config</code> has Cranelift settings inside of it, for example). I like the idea of an \"optimize up to this much fuel\" setting, right alongside <code>opt_level</code> and friends.</p>\n<p>Definitely we do not want to rely on an environment variable -- that's a Unix antipattern of unmaintainable impure dependencies that is just a recipe for bugs :-)</p>",
        "id": 348278020,
        "sender_full_name": "Chris Fallin",
        "timestamp": 1681150777
    },
    {
        "content": "<p>It was suggested that one of the perturbations we could do is to randomize the basic block order in <code>machinst/blockorder.rs</code>. We have a branch that's pretty much ready to go, we just aren't sure if we're randomizing the order of the correct thing. We now noticed the file has completely changed since the suggestion was made in the first place. Does it still make sense to do this and if so, <em>which order exactly</em> should we randomize?</p>\n<p>The big refactor was made <a href=\"https://github.com/bytecodealliance/wasmtime/commit/8abfe928d6073d76ebd991a2e991bf8268b4e5a2#diff-e4caf9885e5824bdf135a3d1a92ec70fda005275941cb740609557cfb7f05e39\">here</a>.</p>\n<p><span class=\"user-mention\" data-user-id=\"506239\">@Trevor Elliott</span> you committed this, maybe you can help out <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span></p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/bytecodealliance/wasmtime/commit/8abfe928d6073d76ebd991a2e991bf8268b4e5a2#diff-e4caf9885e5824bdf135a3d1a92ec70fda005275941cb740609557cfb7f05e39\" style=\"background-image: url(https\\:\\/\\/uploads\\.zulipusercontent\\.net\\/f35a7946b919239f48590ebee4a3757853e8b003\\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f646261393361343966653932336430376637383736383165376466326662363037613362386234633235383564366165373465353366666232636537316631622f62797465636f6465616c6c69616e63652f7761736d74696d652f636f6d6d69742f38616266653932386436303733643736656264393931613265393931626638323638623465356132)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/bytecodealliance/wasmtime/commit/8abfe928d6073d76ebd991a2e991bf8268b4e5a2#diff-e4caf9885e5824bdf135a3d1a92ec70fda005275941cb740609557cfb7f05e39\" title=\"Reuse the DominatorTree postorder travesal in BlockLoweringOrder (#5843) · bytecodealliance/wasmtime@8abfe92\">Reuse the DominatorTree postorder travesal in BlockLoweringOrder (#5843) · bytecodealliance/wasmtime@8abfe92</a></div><div class=\"message_embed_description\">* Rework the blockorder module to reuse the dom tree&#39;s cfg postorder\n\n* Update domtree tests\n\n* Treat br_table with an empty jump table as multiple block exits\n\n* Bless tests\n\n* Change branch_i...</div></div></div>",
        "id": 351348761,
        "sender_full_name": "Remo Senekowitsch",
        "timestamp": 1682002016
    },
    {
        "content": "<p>for context, I've opened a draft pull request <a href=\"https://github.com/bytecodealliance/wasmtime/pull/6254\">here</a> with what we have so far.</p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/bytecodealliance/wasmtime/pull/6254\" style=\"background-image: url(https\\:\\/\\/uploads\\.zulipusercontent\\.net\\/05530ea089addf678adde05c8339aa9662a56240\\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f353665366230636366313633383232643866656434356561656239666438366535363361356334363662656638356564386162663166343236623332383561652f62797465636f6465616c6c69616e63652f7761736d74696d652f70756c6c2f36323534)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/bytecodealliance/wasmtime/pull/6254\" title=\"fuzz: randomize block lowering order by remlse · Pull Request #6254 · bytecodealliance/wasmtime\">fuzz: randomize block lowering order by remlse · Pull Request #6254 · bytecodealliance/wasmtime</a></div><div class=\"message_embed_description\">relates to #4134\nThe block lowering order should have no impact on correctness, so we may randomize it during fuzzing.</div></div></div>",
        "id": 351400918,
        "sender_full_name": "Remo Senekowitsch",
        "timestamp": 1682015331
    },
    {
        "content": "<p>As long as the entry block comes first, I believe we should generate correct code no matter what order the rest of the blocks are emitted in. You do have to make sure that the critical-edge-splitting blocks are inserted somewhere, but you could permute the blocks either before or after that happens. \"After\" is sort of preferable since that's the complete set of basic blocks, but if it's easier to do \"before\" then I think that would be fine.</p>",
        "id": 351402218,
        "sender_full_name": "Jamey Sharp",
        "timestamp": 1682015702
    },
    {
        "content": "<p>We could even support putting the entry block elsewhere if we detect that case in VCode::emit and generate a jump as the first instruction! but that's easily done later, no need to build that now</p>",
        "id": 351402638,
        "sender_full_name": "Chris Fallin",
        "timestamp": 1682015843
    },
    {
        "content": "<p>So that would be right between steps 2 and 3 in <code>BlockLoweringOrder::new</code>, something like this?</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"c1\">// Step 2: walk the postorder from the domtree in reverse to produce our desired node</span>\n<span class=\"c1\">// lowering order, identifying critical edges to split along the way.</span>\n\n<span class=\"c1\">// ...</span>\n\n<span class=\"c1\">// do not shuffle the entry block for now</span>\n<span class=\"c1\">//                                    v</span>\n<span class=\"n\">ctrl_plane</span><span class=\"p\">.</span><span class=\"n\">shuffle</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"k\">mut</span><span class=\"w\"> </span><span class=\"n\">lowered_order</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"o\">..</span><span class=\"p\">]);</span>\n\n<span class=\"c1\">// Step 3: build the successor tables given the lowering order. We can't perform this step</span>\n<span class=\"c1\">// during the creation of `lowering_order`, as we need `lb_to_bindex` to be fully populated</span>\n<span class=\"c1\">// first.</span>\n</code></pre></div>",
        "id": 351404192,
        "sender_full_name": "Remo Senekowitsch",
        "timestamp": 1682016273
    },
    {
        "content": "<p>I don't think that'll quite work, because the <code>lb_to_bindex</code> map would need to be updated as well, and I'm not entirely sure about the \"Mutate the successor to be a critical edge\" step either.</p>",
        "id": 351407108,
        "sender_full_name": "Jamey Sharp",
        "timestamp": 1682017130
    },
    {
        "content": "<p>Ah, I see. I'll try to pass a closure with some cleanup code to <code>ctrl_plane.shuffle</code> as well</p>",
        "id": 351408317,
        "sender_full_name": "Remo Senekowitsch",
        "timestamp": 1682017484
    },
    {
        "content": "<p>I think you might be better off building a vector of indices (e.g. <code>(1..lowered_order.len()).collect()</code>) and shuffling that, then indirecting through that table whenever accessing <code>lowered_order</code>. Or something along those lines.</p>",
        "id": 351408672,
        "sender_full_name": "Jamey Sharp",
        "timestamp": 1682017579
    },
    {
        "content": "<p>Wouldn't that introduce some overhead even when chaos mode is disabled? I had the idea of the closure because I'm always thinking everything we do must happen inside a control plane method, so conditional compilation can get rid of it entirely.</p>",
        "id": 351409430,
        "sender_full_name": "Remo Senekowitsch",
        "timestamp": 1682017841
    },
    {
        "content": "<p>Yeah, it's true that I'd rather not have the indirection overhead the rest of the time… Hmm…</p>",
        "id": 351409873,
        "sender_full_name": "Jamey Sharp",
        "timestamp": 1682018035
    },
    {
        "content": "<p>Here's an idea that might both simplify your work and <strong>possibly</strong> provide a performance improvement during normal compilation at the same time. We can wait to build <code>lb_to_bindex</code> until after <code>lowered_order</code> is fully built, with:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">lb_to_bindex</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">FxHashMap</span>::<span class=\"n\">from_iter</span><span class=\"p\">(</span>\n<span class=\"w\">    </span><span class=\"n\">lowered_order</span><span class=\"p\">.</span><span class=\"n\">iter</span><span class=\"p\">()</span>\n<span class=\"w\">        </span><span class=\"p\">.</span><span class=\"n\">enumerate</span><span class=\"p\">()</span>\n<span class=\"w\">        </span><span class=\"p\">.</span><span class=\"n\">map</span><span class=\"p\">(</span><span class=\"o\">|</span><span class=\"p\">(</span><span class=\"n\">i</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">lb</span><span class=\"p\">)</span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">lb</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"p\">))</span>\n<span class=\"p\">);</span>\n</code></pre></div>\n<p>That could hurt performance due to worse cache locality, but could be better by pre-allocating memory for all the elements up front. I couldn't be sure without measuring it, but I'd guess <code>lowered_order</code> easily fits in L1 and the cost of memory allocation is the bigger effect. At any rate it makes the loop building <code>lowered_order</code> a little easier to understand.</p>\n<p>Given that change, I think you should be safe to shuffle <code>lowered_order</code> immediately before building <code>lb_to_bindex</code>.</p>",
        "id": 351412008,
        "sender_full_name": "Jamey Sharp",
        "timestamp": 1682018804
    },
    {
        "content": "<p>I'm very pleased that this turned out to be an unambiguous performance improvement, as well as making the code simpler and making it possible for you to make your changes. <span aria-label=\"grinning face with smiling eyes\" class=\"emoji emoji-1f601\" role=\"img\" title=\"grinning face with smiling eyes\">:grinning_face_with_smiling_eyes:</span></p>",
        "id": 351438499,
        "sender_full_name": "Jamey Sharp",
        "timestamp": 1682029638
    },
    {
        "content": "<p>Fantastic! Thanks for the help <span aria-label=\"smiley\" class=\"emoji emoji-1f603\" role=\"img\" title=\"smiley\">:smiley:</span></p>",
        "id": 351527531,
        "sender_full_name": "Remo Senekowitsch",
        "timestamp": 1682061087
    },
    {
        "content": "<p>The issue I filed about having an owned variant of  <code>arbitrary::Unstructured</code>: <a href=\"https://github.com/rust-fuzz/arbitrary/issues/147\">https://github.com/rust-fuzz/arbitrary/issues/147</a></p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/rust-fuzz/arbitrary/issues/147\" style=\"background-image: url(https\\:\\/\\/uploads\\.zulipusercontent\\.net\\/f197d6ee31ecc5a443942766adf18b990ba33944\\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f616631326435323231646666616332613966623661303730663066626364636335323334326639333466343434303135323338363537376239333362336235382f727573742d66757a7a2f6172626974726172792f6973737565732f313437)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/rust-fuzz/arbitrary/issues/147\" title=\"Consider supporting owned `Unstructured`s · Issue #147 · rust-fuzz/arbitrary\">Consider supporting owned `Unstructured`s · Issue #147 · rust-fuzz/arbitrary</a></div><div class=\"message_embed_description\">Talking with some folks who would like to pass around an Unstructured through Cranelift to implement a \"chaos mode\" that does semantics-preserving random mutations like shuffle basic blocks, but do...</div></div></div>",
        "id": 351687228,
        "sender_full_name": "fitzgen (he/him)",
        "timestamp": 1682096814
    },
    {
        "content": "<p>I'm trying to include the control plane in CLIF. There's a small problem: The control_plane_fuel is never included in the printed output of cargo-fuzz. I think the input to the fuzz target is generated again when a panic is encountered, but that generation does not get passed the same CLI args as before (<code>--fuel=XX</code> in my case). I think this might be impossible to fix, or am I missing something?</p>\n<p><a href=\"https://github.com/bytecodealliance/wasmtime/compare/main...remlse:wasmtime:control-plane-in-clif?diff=split#diff-7e77f700326e887cf8ef8327df2692daeb869db9116fb0c44eb80e3f18f1c987R391-R394\">Here</a> is where I'm reading the CLI arg for fuzzing, which works as expected.</p>\n<p><a href=\"https://github.com/bytecodealliance/wasmtime/compare/main...remlse:wasmtime:control-plane-in-clif?diff=split#diff-7e77f700326e887cf8ef8327df2692daeb869db9116fb0c44eb80e3f18f1c987R173-R177\">Here</a> is where I'm reading the CLI arg for printing after a panic was encountered. That doesn't work.</p>\n<p>Printing of control plane data and parsing of both control plane data and the fuel limit are working.</p>\n<p>Maybe an automated tooling for bisection with the fuel limit could make this less of a problem.</p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/bytecodealliance/wasmtime/compare/main...remlse:wasmtime:control-plane-in-clif?diff=split#diff-7e77f700326e887cf8ef8327df2692daeb869db9116fb0c44eb80e3f18f1c987R391-R394\" style=\"background-image: url(https\\:\\/\\/uploads\\.zulipusercontent\\.net\\/cb180db23b8d9bb3bb320aa4d92f028e5ec4847b\\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f636362383765613261396633333166646137346262656336313638363666626264383836613333303535333737636639393835616339653462663439366330622f62797465636f6465616c6c69616e63652f7761736d74696d65)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/bytecodealliance/wasmtime/compare/main...remlse:wasmtime:control-plane-in-clif?diff=split#diff-7e77f700326e887cf8ef8327df2692daeb869db9116fb0c44eb80e3f18f1c987R391-R394\" title=\"Comparing bytecodealliance:main...remlse:control-plane-in-clif · bytecodealliance/wasmtime\">Comparing bytecodealliance:main...remlse:control-plane-in-clif · bytecodealliance/wasmtime</a></div><div class=\"message_embed_description\">A fast and secure runtime for WebAssembly. Contribute to bytecodealliance/wasmtime development by creating an account on GitHub.</div></div></div><div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/bytecodealliance/wasmtime/compare/main...remlse:wasmtime:control-plane-in-clif?diff=split#diff-7e77f700326e887cf8ef8327df2692daeb869db9116fb0c44eb80e3f18f1c987R173-R177\" style=\"background-image: url(https\\:\\/\\/uploads\\.zulipusercontent\\.net\\/cb180db23b8d9bb3bb320aa4d92f028e5ec4847b\\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f636362383765613261396633333166646137346262656336313638363666626264383836613333303535333737636639393835616339653462663439366330622f62797465636f6465616c6c69616e63652f7761736d74696d65)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/bytecodealliance/wasmtime/compare/main...remlse:wasmtime:control-plane-in-clif?diff=split#diff-7e77f700326e887cf8ef8327df2692daeb869db9116fb0c44eb80e3f18f1c987R173-R177\" title=\"Comparing bytecodealliance:main...remlse:control-plane-in-clif · bytecodealliance/wasmtime\">Comparing bytecodealliance:main...remlse:control-plane-in-clif · bytecodealliance/wasmtime</a></div><div class=\"message_embed_description\">A fast and secure runtime for WebAssembly. Contribute to bytecodealliance/wasmtime development by creating an account on GitHub.</div></div></div>",
        "id": 357079429,
        "sender_full_name": "Remo Senekowitsch",
        "timestamp": 1683659410
    },
    {
        "content": "<p>I think a meta-comment here might actually be useful: the work to figure out fuel is a lot of fiddly design, and it's not totally clear to me what the right approach is (still), and it's not as useful in terms of testing coverage as other kinds of randomized decisions; IMHO it'd be fine to drop the further work on it in favor of, e.g., the pseudo-insts to clobber values, or other chaos injected into lowering</p>",
        "id": 357082024,
        "sender_full_name": "Chris Fallin",
        "timestamp": 1683660231
    },
    {
        "content": "<p>that's not to say the work linked so far is not useful! I agree that a bisection tool will be nice to have. Just thinking in terms of limited time remaining</p>",
        "id": 357082198,
        "sender_full_name": "Chris Fallin",
        "timestamp": 1683660271
    },
    {
        "content": "<p>I may be missing some context here, but could the <code>struct TestCase</code> have <code>fuel: Option&lt;u32&gt;</code> as a field? The fuzz input would then be used to initialize this field (probably not with the full range of <code>u32</code> but some smaller upper bound instead)</p>",
        "id": 357082555,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1683660380
    },
    {
        "content": "<p>That would work, but the fuel limit is not supposed to come from the data generated by the fuzzer, its purpose is to be set manually.</p>",
        "id": 357082880,
        "sender_full_name": "Remo Senekowitsch",
        "timestamp": 1683660500
    },
    {
        "content": "<p>For a given input by the fuzzer (which triggered some bug), the fuel limit can be set manually on top of it to figure out which mutation introduced by the control plane actually triggered the bug.</p>",
        "id": 357083362,
        "sender_full_name": "Remo Senekowitsch",
        "timestamp": 1683660678
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"254389\">Chris Fallin</span> <a href=\"#narrow/stream/217117-cranelift/topic/Chaos.20mode.20bachelor.20thesis/near/357082024\">said</a>:</p>\n<blockquote>\n<p>it'd be fine to drop the further work on it in favor of, e.g., the pseudo-insts to clobber values, or other chaos injected into lowering</p>\n</blockquote>\n<p>Yeah, that makes sense. I'll focus on this for now. Thanks!</p>",
        "id": 357083385,
        "sender_full_name": "Remo Senekowitsch",
        "timestamp": 1683660690
    },
    {
        "content": "<p>Hm I'm not sure I understand, if a fuzz input fails then reduction should auto reduce the fuel value and otherwise it can be manually adjusted in the text form?</p>",
        "id": 357084836,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1683661177
    },
    {
        "content": "<p>this is exactly the unclear nature of the idea that I want to avoid :-) FWIW, the clearest kind of \"fuel\" idea I can imagine is actually unrelated to the chaos-mode features altogether, and instead controls the ordinary optimizations; it just rides on the same control plane. A kind of fuel that regulates how much of the chaos we use is potentially also useful, but much fuzzier</p>",
        "id": 357085816,
        "sender_full_name": "Chris Fallin",
        "timestamp": 1683661499
    },
    {
        "content": "<p>we've gone back and forth on this a lot; I feel time is more productively spent actually building out other kinds of chaos injection</p>",
        "id": 357085870,
        "sender_full_name": "Chris Fallin",
        "timestamp": 1683661525
    },
    {
        "content": "<p>Sorry but I'm still confused, right now this is parsing <code>env::args</code> which no other fuzzer is doing so it's actively going out of its way to create a nonstandard method of generating fuzz input. The alternative, using <code>fuel: Option&lt;u32&gt;</code> as a struct field and generating from the fuzzer input, I don't know why it has a downside?</p>",
        "id": 357086177,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1683661644
    },
    {
        "content": "<p>I don't mean to radically change designs after the fact, but I'm also not sure why this would be a big change</p>",
        "id": 357086243,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1683661675
    },
    {
        "content": "<p>I would prefer we actually delete the approach that reads <code>env::args</code> as well; I'm not disagreeing with you at all</p>",
        "id": 357086688,
        "sender_full_name": "Chris Fallin",
        "timestamp": 1683661810
    },
    {
        "content": "<p>I felt pretty uncomfortable with it during code review (sorry <span class=\"user-mention\" data-user-id=\"554293\">@Remo Senekowitsch</span> ) and in the end was ok with landing it to make forward progress</p>",
        "id": 357086768,
        "sender_full_name": "Chris Fallin",
        "timestamp": 1683661836
    },
    {
        "content": "<p>but I really don't like the idea of fuel controlling chaos at all; it's one fuzz input that masks another (\"please ignore other parts of this struct\")</p>",
        "id": 357086830,
        "sender_full_name": "Chris Fallin",
        "timestamp": 1683661854
    },
    {
        "content": "<p>my \"time is more productively spent\" is trying to redirect away from the idea of fuel <em>at all</em></p>",
        "id": 357086911,
        "sender_full_name": "Chris Fallin",
        "timestamp": 1683661888
    },
    {
        "content": "<p>Oh well I don't know whether to say we should have fuel or not in the fuzz input, but I can say that in our experience with libfuzzer it's generally really quite good at probing all reachable paths, so although fuel can mask optimizations and such by disabling them fuzzing still has a quite good chance of reaching there when libfuzzer automatically increases the fuel or changes the input</p>",
        "id": 357087254,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1683661999
    },
    {
        "content": "<p>Right; the same \"good at probing all paths\" though can equally just trim the sequence of decisions given in the input (and in a sense that's a more direct/efficient encoding of the \"DNA\")</p>",
        "id": 357087486,
        "sender_full_name": "Chris Fallin",
        "timestamp": 1683662072
    },
    {
        "content": "<p>as a meta-comment though in the context of this topic (bachelors' thesis) I again want to redirect energy away from any more work on fuel, precisely because it is not totally settled, and toward other kinds of chaos</p>",
        "id": 357087655,
        "sender_full_name": "Chris Fallin",
        "timestamp": 1683662125
    },
    {
        "content": "<p>Hello everyone <span aria-label=\"wave\" class=\"emoji emoji-1f44b\" role=\"img\" title=\"wave\">:wave:</span> </p>\n<p>We've had a busy week getting our thesis across the finish line, we handed it in on Friday. Here's a little excerpt from the preface, translated from German:</p>\n<blockquote>\n<p>Our gratitude goes to:</p>\n<p>Chris Fallin, developer of Cranelift, for his instructive and patient mentoring.<br>\nHe always gently guided our efforts on the right track through his experience.</p>\n<p>(our teachers)</p>\n<p>The other developers of Cranelift, for their generous help.<br>\nThese include, among others: Alex Crichton, Trevor Elliott, Nick Fitzgerald and Jamey Sharp.</p>\n</blockquote>\n<p>So yeah, thanks again for everything <span aria-label=\"pray\" class=\"emoji emoji-1f64f\" role=\"img\" title=\"pray\">:pray:</span> </p>\n<p><span class=\"user-mention\" data-user-id=\"254389\">@Chris Fallin</span> <span class=\"user-mention\" data-user-id=\"253994\">@Alex Crichton</span> <span class=\"user-mention\" data-user-id=\"506239\">@Trevor Elliott</span> <span class=\"user-mention\" data-user-id=\"253990\">@fitzgen (he/him)</span> <span class=\"user-mention\" data-user-id=\"504918\">@Jamey Sharp</span></p>",
        "id": 365447182,
        "sender_full_name": "Remo Senekowitsch",
        "timestamp": 1686549298
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"254389\">@Chris Fallin</span> I'm happy to do any cleanup work you think makes sense to wrap things up. Maybe add some documentation for things that currently live in our heads only? Or improve the state of how the fuel parameter is handled. I think you'd like to have it moved out of the fuzz-target entirely and only have it part of clif-util(?)</p>",
        "id": 365447222,
        "sender_full_name": "Remo Senekowitsch",
        "timestamp": 1686549313
    },
    {
        "content": "<p>That's great to hear, and I'm happy the project went as well as it did! Will the thesis be anywhere public that we can read it?</p>\n<p>Re: cleanup, I think you all actually did a fairly good job of upstreaming, so I'm happy to see it stay as-is if you'd prefer that. We could work out a better way to do fuel -- doing as you say and controlling it only from the CLI, for reduction, is one option -- but there are still some unresolved design details there I think and I don't want to burden you more than needed. On the other hand, docs of any sort are always welcome -- please do feel free to summarize the system in a new markdown file and put it in <code>cranelift/docs/</code> if you'd like (and after writing the thesis I suppose you have some good succinct ways of describing the system anyway!). Thanks!</p>",
        "id": 365601793,
        "sender_full_name": "Chris Fallin",
        "timestamp": 1686583970
    },
    {
        "content": "<p>The school might publish it later. But we're happy to provide a copy right now if your interested. Would you like us to run the source through a translator? The main text is only in German right now.</p>\n<p>I'll read through those docs another time and see if I can add something of value.</p>",
        "id": 365620965,
        "sender_full_name": "Remo Senekowitsch",
        "timestamp": 1686588093
    },
    {
        "content": "<p>sure, if you're willing to share! the original is fine, we can use a translator as necessary or puzzle it out otherwise for those who can't read German :-)</p>",
        "id": 365629319,
        "sender_full_name": "Chris Fallin",
        "timestamp": 1686590074
    },
    {
        "content": "<p>Alright, let me know if the link doesn't work for some reason:<br>\n<a href=\"https://drive.google.com/file/d/1Lrnn7OLbHd7GQXd3J8Pgr8g4IbNnoUJX/view\">https://drive.google.com/file/d/1Lrnn7OLbHd7GQXd3J8Pgr8g4IbNnoUJX/view</a></p>",
        "id": 365635981,
        "sender_full_name": "Remo Senekowitsch",
        "timestamp": 1686591790
    }
]