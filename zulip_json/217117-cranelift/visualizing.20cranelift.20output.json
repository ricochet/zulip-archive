[
    {
        "content": "<p>Hi, I'm writing a project that uses Cranelift as a JIT backend for dynamic recompilation. Is there any way to get a GraphViz printout of the basic blocks + instructions from Cranelift for ease of debugging? Or any other debugging outputs I could use, other than just disassembling the JIT output?</p>",
        "id": 248430207,
        "sender_full_name": "chc4",
        "timestamp": 1628128725
    },
    {
        "content": "<p>Hey, You should be able to get an output in the form of Cranelift IR by calling <a href=\"https://docs.rs/cranelift-frontend/0.76.0/cranelift_frontend/struct.FunctionBuilder.html#method.display\">display</a> on a FunctionBuilder or Function and get a string with the Cranelift IR Module. (Here's a more complete <a href=\"https://docs.rs/cranelift-frontend/0.76.0/cranelift_frontend/index.html#example\">example</a>)</p>\n<p>This gets you an output a bit higher level than disassembly. I don't know if we have a GraphViz formatter.</p>",
        "id": 248452103,
        "sender_full_name": "Afonso Bordado",
        "timestamp": 1628153250
    },
    {
        "content": "<p>Oops, it looks like you don't get a String directly, but a formattable object, which you can pass into <code>println!</code> like: <code>println!(\"{}\", func.display(None));</code></p>",
        "id": 248452688,
        "sender_full_name": "Afonso Bordado",
        "timestamp": 1628153713
    },
    {
        "content": "<p>Or into <a href=\"https://doc.rust-lang.org/1.53.0/std/macro.format.html\">format!</a> <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span></p>",
        "id": 248452813,
        "sender_full_name": "Till Schneidereit",
        "timestamp": 1628153817
    },
    {
        "content": "<p>Great, thank you!</p>",
        "id": 248477884,
        "sender_full_name": "chc4",
        "timestamp": 1628170824
    },
    {
        "content": "<blockquote>\n<p>Is there any way to get a GraphViz printout of the basic blocks + instructions from Cranelift for ease of debugging?</p>\n</blockquote>\n<p>Yes, clif-util has the <code>print_cfg</code> subcommand. You can also use <code>cranelift_codegen::cfg_printer::CFGPrinter</code>.</p>",
        "id": 248492833,
        "sender_full_name": "bjorn3",
        "timestamp": 1628176951
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"410955\">Afonso Bordado</span> <a href=\"#narrow/stream/217117-cranelift/topic/visualizing.20cranelift.20output/near/248452103\">said</a>:</p>\n<blockquote>\n<p>Hey, You should be able to get an output in the form of Cranelift IR by calling <a href=\"https://docs.rs/cranelift-frontend/0.76.0/cranelift_frontend/struct.FunctionBuilder.html#method.display\">display</a> on a FunctionBuilder or Function and get a string with the Cranelift IR Module. (Here's a more complete <a href=\"https://docs.rs/cranelift-frontend/0.76.0/cranelift_frontend/index.html#example\">example</a>)</p>\n<p>This gets you an output a bit higher level than disassembly. I don't know if we have a GraphViz formatter.</p>\n</blockquote>\n<p>Is there a way to do this currently? <code>display</code> method seems to have been removed since you've commented</p>",
        "id": 261173474,
        "sender_full_name": "Ivan Chinenov",
        "timestamp": 1636657874
    },
    {
        "content": "<p>The <code>Function</code> has a <code>display</code> method in the latest version (though indeed it seems the analogous one on <code>FunctionBuilder</code> went away as part of some recent cleanups (?)): <a href=\"https://docs.rs/cranelift-codegen/0.78.0/cranelift_codegen/ir/function/struct.Function.html#method.display\">docs here</a></p>",
        "id": 261174709,
        "sender_full_name": "Chris Fallin",
        "timestamp": 1636658537
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"254389\">Chris Fallin</span> <a href=\"#narrow/stream/217117-cranelift/topic/visualizing.20cranelift.20output/near/261174709\">said</a>:</p>\n<blockquote>\n<p>The <code>Function</code> has a <code>display</code> method in the latest version (though indeed it seems the analogous one on <code>FunctionBuilder</code> went away as part of some recent cleanups (?)): <a href=\"https://docs.rs/cranelift-codegen/0.78.0/cranelift_codegen/ir/function/struct.Function.html#method.display\">docs here</a></p>\n</blockquote>\n<p>Thanks. How do I acquire a <code>Function</code>? I'm following along with the JIT demo and all I have access to is a <code>FunctionBuilder</code>.</p>",
        "id": 261175181,
        "sender_full_name": "Ivan Chinenov",
        "timestamp": 1636658837
    },
    {
        "content": "<p>Oh, I see, it's <code>func</code> on FunctionBuilder</p>",
        "id": 261175297,
        "sender_full_name": "Ivan Chinenov",
        "timestamp": 1636658895
    },
    {
        "content": "<p>Somewhat related to this, I've been trying to figure out how to associate user-generated <code>ExternalName</code>s to strings or to otherwise make cranelift output use actual names for functions and stuff instead of numbers, is that possible?</p>",
        "id": 275403208,
        "sender_full_name": "Chase Wilson",
        "timestamp": 1647363766
    },
    {
        "content": "<p>Currently this is handled outside of the core Cranelift IR types -- the idea is that the embedding, if it has a concept of symbol names or whatnot, would carry a mapping</p>",
        "id": 275408552,
        "sender_full_name": "Chris Fallin",
        "timestamp": 1647366048
    },
    {
        "content": "<p>there's some overlap between this design choice and the \"function-local compilation\" choice: keeping a symtab within CLIF would mean duplicating symbols in each function that refers to them, unless we add some module-level context</p>",
        "id": 275408650,
        "sender_full_name": "Chris Fallin",
        "timestamp": 1647366101
    },
    {
        "content": "<p>but, plugging in some custom mapping for symbols to text names during pretty-printing is not a bad idea -- I'm open to something like that at least!</p>",
        "id": 275408753,
        "sender_full_name": "Chris Fallin",
        "timestamp": 1647366133
    },
    {
        "content": "<p>See also <a href=\"https://github.com/bjorn3/rustc_codegen_cranelift/blob/master/src/pretty_clif.rs\">https://github.com/bjorn3/rustc_codegen_cranelift/blob/master/src/pretty_clif.rs</a></p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/bjorn3/rustc_codegen_cranelift/blob/master/src/pretty_clif.rs\" style=\"background-image: url(https\\:\\/\\/uploads\\.zulipusercontent\\.net\\/d6a6508b2b3b78c4b8db13af608d23b3b6579f3e\\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f303931333463343030653331303334663735653531653062616431366663643862373134326532306239616334353235333739666235306134666134316137342f626a6f726e332f72757374635f636f646567656e5f6372616e656c696674)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/bjorn3/rustc_codegen_cranelift/blob/master/src/pretty_clif.rs\" title=\"rustc_codegen_cranelift/pretty_clif.rs at master · bjorn3/rustc_codegen_cranelift\">rustc_codegen_cranelift/pretty_clif.rs at master · bjorn3/rustc_codegen_cranelift</a></div><div class=\"message_embed_description\">Cranelift based backend for rustc. Contribute to bjorn3/rustc_codegen_cranelift development by creating an account on GitHub.</div></div></div>",
        "id": 275422285,
        "sender_full_name": "bjorn3",
        "timestamp": 1647371706
    },
    {
        "content": "<p>Hi, I'm trying to print out some cranelift IR with <code>display</code>, but I keep getting the below panic, and it happens only if the function i'm printing has a <code>call</code> in it. Anyone have an idea?</p>\n<p>Panic:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">thread</span><span class=\"w\"> </span><span class=\"o\">'&lt;</span><span class=\"n\">unnamed</span><span class=\"o\">&gt;'</span><span class=\"w\"> </span><span class=\"n\">panicked</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">joefe</span><span class=\"o\">/</span><span class=\"p\">.</span><span class=\"n\">cargo</span><span class=\"o\">/</span><span class=\"n\">registry</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">index</span><span class=\"p\">.</span><span class=\"n\">crates</span><span class=\"p\">.</span><span class=\"n\">io</span><span class=\"o\">-</span><span class=\"mi\">6</span><span class=\"n\">f17d22bba15001f</span><span class=\"o\">/</span><span class=\"n\">cranelift</span><span class=\"o\">-</span><span class=\"n\">codegen</span><span class=\"o\">-</span><span class=\"mf\">0.91.1</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">ir</span><span class=\"o\">/</span><span class=\"n\">extname</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">191</span><span class=\"p\">:</span><span class=\"mi\">58</span><span class=\"p\">:</span>\n<span class=\"nc\">index</span><span class=\"w\"> </span><span class=\"n\">out</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">bounds</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">the</span><span class=\"w\"> </span><span class=\"n\">len</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"n\">but</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">index</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"n\">stack</span><span class=\"w\"> </span><span class=\"n\">backtrace</span><span class=\"p\">:</span>\n<span class=\"w\">   </span><span class=\"mi\">0</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">rust_begin_unwind</span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a28077b28a02b92985b3a3faecf92813155f1ea1</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">panicking</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">597</span><span class=\"p\">:</span><span class=\"mi\">5</span>\n<span class=\"w\">   </span><span class=\"mi\">1</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">core</span><span class=\"p\">::</span><span class=\"n\">panicking</span><span class=\"p\">::</span><span class=\"n\">panic_fmt</span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a28077b28a02b92985b3a3faecf92813155f1ea1</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">panicking</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">72</span><span class=\"p\">:</span><span class=\"mi\">14</span>\n<span class=\"w\">   </span><span class=\"mi\">2</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">core</span><span class=\"p\">::</span><span class=\"n\">panicking</span><span class=\"p\">::</span><span class=\"n\">panic_bounds_check</span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a28077b28a02b92985b3a3faecf92813155f1ea1</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">panicking</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">180</span><span class=\"p\">:</span><span class=\"mi\">5</span>\n<span class=\"w\">   </span><span class=\"mi\">3</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"kt\">usize</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">core</span><span class=\"p\">::</span><span class=\"n\">slice</span><span class=\"p\">::</span><span class=\"n\">index</span><span class=\"p\">::</span><span class=\"n\">SliceIndex</span><span class=\"o\">&lt;</span><span class=\"p\">[</span><span class=\"n\">T</span><span class=\"p\">]</span><span class=\"o\">&gt;&gt;</span><span class=\"p\">::</span><span class=\"n\">index</span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a28077b28a02b92985b3a3faecf92813155f1ea1</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">slice</span><span class=\"o\">/</span><span class=\"n\">index</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">261</span><span class=\"p\">:</span><span class=\"mi\">10</span>\n<span class=\"w\">   </span><span class=\"mi\">4</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">core</span><span class=\"p\">::</span><span class=\"n\">slice</span><span class=\"p\">::</span><span class=\"n\">index</span><span class=\"p\">::</span><span class=\"o\">&lt;</span><span class=\"k\">impl</span><span class=\"w\"> </span><span class=\"n\">core</span><span class=\"p\">::</span><span class=\"n\">ops</span><span class=\"p\">::</span><span class=\"n\">index</span><span class=\"p\">::</span><span class=\"n\">Index</span><span class=\"o\">&lt;</span><span class=\"n\">I</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">T</span><span class=\"p\">]</span><span class=\"o\">&gt;</span><span class=\"p\">::</span><span class=\"n\">index</span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a28077b28a02b92985b3a3faecf92813155f1ea1</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">slice</span><span class=\"o\">/</span><span class=\"n\">index</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">18</span><span class=\"p\">:</span><span class=\"mi\">9</span>\n<span class=\"w\">   </span><span class=\"mi\">5</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">alloc</span><span class=\"p\">::</span><span class=\"n\">vec</span><span class=\"p\">::</span><span class=\"nb\">Vec</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"p\">,</span><span class=\"n\">A</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">core</span><span class=\"p\">::</span><span class=\"n\">ops</span><span class=\"p\">::</span><span class=\"n\">index</span><span class=\"p\">::</span><span class=\"n\">Index</span><span class=\"o\">&lt;</span><span class=\"n\">I</span><span class=\"o\">&gt;&gt;</span><span class=\"p\">::</span><span class=\"n\">index</span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a28077b28a02b92985b3a3faecf92813155f1ea1</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">alloc</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">vec</span><span class=\"o\">/</span><span class=\"k\">mod</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">2728</span><span class=\"p\">:</span><span class=\"mi\">9</span>\n<span class=\"w\">   </span><span class=\"mi\">6</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">cranelift_entity</span><span class=\"p\">::</span><span class=\"n\">primary</span><span class=\"p\">::</span><span class=\"n\">PrimaryMap</span><span class=\"o\">&lt;</span><span class=\"n\">K</span><span class=\"p\">,</span><span class=\"n\">V</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">core</span><span class=\"p\">::</span><span class=\"n\">ops</span><span class=\"p\">::</span><span class=\"n\">index</span><span class=\"p\">::</span><span class=\"n\">Index</span><span class=\"o\">&lt;</span><span class=\"n\">K</span><span class=\"o\">&gt;&gt;</span><span class=\"p\">::</span><span class=\"n\">index</span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">joefe</span><span class=\"o\">/</span><span class=\"p\">.</span><span class=\"n\">cargo</span><span class=\"o\">/</span><span class=\"n\">registry</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">index</span><span class=\"p\">.</span><span class=\"n\">crates</span><span class=\"p\">.</span><span class=\"n\">io</span><span class=\"o\">-</span><span class=\"mi\">6</span><span class=\"n\">f17d22bba15001f</span><span class=\"o\">/</span><span class=\"n\">cranelift</span><span class=\"o\">-</span><span class=\"n\">entity</span><span class=\"o\">-</span><span class=\"mf\">0.91.1</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">primary</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">202</span><span class=\"p\">:</span><span class=\"mi\">20</span>\n<span class=\"w\">   </span><span class=\"mi\">7</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">cranelift_codegen</span><span class=\"p\">::</span><span class=\"n\">ir</span><span class=\"p\">::</span><span class=\"n\">extname</span><span class=\"p\">::</span><span class=\"n\">DisplayableExternalName</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">core</span><span class=\"p\">::</span><span class=\"n\">fmt</span><span class=\"p\">::</span><span class=\"n\">Display</span><span class=\"o\">&gt;</span><span class=\"p\">::</span><span class=\"n\">fmt</span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">joefe</span><span class=\"o\">/</span><span class=\"p\">.</span><span class=\"n\">cargo</span><span class=\"o\">/</span><span class=\"n\">registry</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">index</span><span class=\"p\">.</span><span class=\"n\">crates</span><span class=\"p\">.</span><span class=\"n\">io</span><span class=\"o\">-</span><span class=\"mi\">6</span><span class=\"n\">f17d22bba15001f</span><span class=\"o\">/</span><span class=\"n\">cranelift</span><span class=\"o\">-</span><span class=\"n\">codegen</span><span class=\"o\">-</span><span class=\"mf\">0.91.1</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">ir</span><span class=\"o\">/</span><span class=\"n\">extname</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">191</span><span class=\"p\">:</span><span class=\"mi\">58</span>\n<span class=\"w\">   </span><span class=\"mi\">8</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">core</span><span class=\"p\">::</span><span class=\"n\">fmt</span><span class=\"p\">::</span><span class=\"n\">rt</span><span class=\"p\">::</span><span class=\"n\">Argument</span><span class=\"p\">::</span><span class=\"n\">fmt</span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a28077b28a02b92985b3a3faecf92813155f1ea1</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">fmt</span><span class=\"o\">/</span><span class=\"n\">rt</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">138</span><span class=\"p\">:</span><span class=\"mi\">9</span>\n<span class=\"w\">   </span><span class=\"mi\">9</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">core</span><span class=\"p\">::</span><span class=\"n\">fmt</span><span class=\"p\">::</span><span class=\"n\">write</span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a28077b28a02b92985b3a3faecf92813155f1ea1</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">fmt</span><span class=\"o\">/</span><span class=\"k\">mod</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">1114</span><span class=\"p\">:</span><span class=\"mi\">21</span>\n<span class=\"w\">  </span><span class=\"mi\">10</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">cranelift_codegen</span><span class=\"p\">::</span><span class=\"n\">ir</span><span class=\"p\">::</span><span class=\"n\">extfunc</span><span class=\"p\">::</span><span class=\"n\">DisplayableExtFuncData</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">core</span><span class=\"p\">::</span><span class=\"n\">fmt</span><span class=\"p\">::</span><span class=\"n\">Display</span><span class=\"o\">&gt;</span><span class=\"p\">::</span><span class=\"n\">fmt</span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">joefe</span><span class=\"o\">/</span><span class=\"p\">.</span><span class=\"n\">cargo</span><span class=\"o\">/</span><span class=\"n\">registry</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">index</span><span class=\"p\">.</span><span class=\"n\">crates</span><span class=\"p\">.</span><span class=\"n\">io</span><span class=\"o\">-</span><span class=\"mi\">6</span><span class=\"n\">f17d22bba15001f</span><span class=\"o\">/</span><span class=\"n\">cranelift</span><span class=\"o\">-</span><span class=\"n\">codegen</span><span class=\"o\">-</span><span class=\"mf\">0.91.1</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">ir</span><span class=\"o\">/</span><span class=\"n\">extfunc</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">363</span><span class=\"p\">:</span><span class=\"mi\">9</span>\n<span class=\"w\">  </span><span class=\"mi\">11</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">core</span><span class=\"p\">::</span><span class=\"n\">fmt</span><span class=\"p\">::</span><span class=\"n\">rt</span><span class=\"p\">::</span><span class=\"n\">Argument</span><span class=\"p\">::</span><span class=\"n\">fmt</span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a28077b28a02b92985b3a3faecf92813155f1ea1</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">fmt</span><span class=\"o\">/</span><span class=\"n\">rt</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">138</span><span class=\"p\">:</span><span class=\"mi\">9</span>\n<span class=\"w\">  </span><span class=\"mi\">12</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">core</span><span class=\"p\">::</span><span class=\"n\">fmt</span><span class=\"p\">::</span><span class=\"n\">write</span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a28077b28a02b92985b3a3faecf92813155f1ea1</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">fmt</span><span class=\"o\">/</span><span class=\"k\">mod</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">1114</span><span class=\"p\">:</span><span class=\"mi\">21</span>\n<span class=\"w\">  </span><span class=\"mi\">13</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">cranelift_codegen</span><span class=\"p\">::</span><span class=\"n\">write</span><span class=\"p\">::</span><span class=\"n\">FuncWriter</span><span class=\"p\">::</span><span class=\"n\">super_entity_definition</span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">joefe</span><span class=\"o\">/</span><span class=\"p\">.</span><span class=\"n\">cargo</span><span class=\"o\">/</span><span class=\"n\">registry</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">index</span><span class=\"p\">.</span><span class=\"n\">crates</span><span class=\"p\">.</span><span class=\"n\">io</span><span class=\"o\">-</span><span class=\"mi\">6</span><span class=\"n\">f17d22bba15001f</span><span class=\"o\">/</span><span class=\"n\">cranelift</span><span class=\"o\">-</span><span class=\"n\">codegen</span><span class=\"o\">-</span><span class=\"mf\">0.91.1</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">write</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">131</span><span class=\"p\">:</span><span class=\"mi\">9</span>\n<span class=\"w\">  </span><span class=\"mi\">14</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">cranelift_codegen</span><span class=\"p\">::</span><span class=\"n\">write</span><span class=\"p\">::</span><span class=\"n\">FuncWriter</span><span class=\"p\">::</span><span class=\"n\">write_entity_definition</span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">joefe</span><span class=\"o\">/</span><span class=\"p\">.</span><span class=\"n\">cargo</span><span class=\"o\">/</span><span class=\"n\">registry</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">index</span><span class=\"p\">.</span><span class=\"n\">crates</span><span class=\"p\">.</span><span class=\"n\">io</span><span class=\"o\">-</span><span class=\"mi\">6</span><span class=\"n\">f17d22bba15001f</span><span class=\"o\">/</span><span class=\"n\">cranelift</span><span class=\"o\">-</span><span class=\"n\">codegen</span><span class=\"o\">-</span><span class=\"mf\">0.91.1</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">write</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">119</span><span class=\"p\">:</span><span class=\"mi\">9</span>\n<span class=\"w\">  </span><span class=\"mi\">15</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">cranelift_codegen</span><span class=\"p\">::</span><span class=\"n\">write</span><span class=\"p\">::</span><span class=\"n\">FuncWriter</span><span class=\"p\">::</span><span class=\"n\">super_preamble</span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">joefe</span><span class=\"o\">/</span><span class=\"p\">.</span><span class=\"n\">cargo</span><span class=\"o\">/</span><span class=\"n\">registry</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">index</span><span class=\"p\">.</span><span class=\"n\">crates</span><span class=\"p\">.</span><span class=\"n\">io</span><span class=\"o\">-</span><span class=\"mi\">6</span><span class=\"n\">f17d22bba15001f</span><span class=\"o\">/</span><span class=\"n\">cranelift</span><span class=\"o\">-</span><span class=\"n\">codegen</span><span class=\"o\">-</span><span class=\"mf\">0.91.1</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">write</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">84</span><span class=\"p\">:</span><span class=\"mi\">17</span>\n<span class=\"w\">  </span><span class=\"mi\">16</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">cranelift_codegen</span><span class=\"p\">::</span><span class=\"n\">write</span><span class=\"p\">::</span><span class=\"n\">FuncWriter</span><span class=\"p\">::</span><span class=\"n\">write_preamble</span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">joefe</span><span class=\"o\">/</span><span class=\"p\">.</span><span class=\"n\">cargo</span><span class=\"o\">/</span><span class=\"n\">registry</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">index</span><span class=\"p\">.</span><span class=\"n\">crates</span><span class=\"p\">.</span><span class=\"n\">io</span><span class=\"o\">-</span><span class=\"mi\">6</span><span class=\"n\">f17d22bba15001f</span><span class=\"o\">/</span><span class=\"n\">cranelift</span><span class=\"o\">-</span><span class=\"n\">codegen</span><span class=\"o\">-</span><span class=\"mf\">0.91.1</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">write</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">38</span><span class=\"p\">:</span><span class=\"mi\">9</span>\n<span class=\"w\">  </span><span class=\"mi\">17</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">cranelift_codegen</span><span class=\"p\">::</span><span class=\"n\">write</span><span class=\"p\">::</span><span class=\"n\">decorate_function</span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">joefe</span><span class=\"o\">/</span><span class=\"p\">.</span><span class=\"n\">cargo</span><span class=\"o\">/</span><span class=\"n\">registry</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">index</span><span class=\"p\">.</span><span class=\"n\">crates</span><span class=\"p\">.</span><span class=\"n\">io</span><span class=\"o\">-</span><span class=\"mi\">6</span><span class=\"n\">f17d22bba15001f</span><span class=\"o\">/</span><span class=\"n\">cranelift</span><span class=\"o\">-</span><span class=\"n\">codegen</span><span class=\"o\">-</span><span class=\"mf\">0.91.1</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">write</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">191</span><span class=\"p\">:</span><span class=\"mi\">19</span>\n<span class=\"w\">  </span><span class=\"mi\">18</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">cranelift_codegen</span><span class=\"p\">::</span><span class=\"n\">write</span><span class=\"p\">::</span><span class=\"n\">write_function</span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">joefe</span><span class=\"o\">/</span><span class=\"p\">.</span><span class=\"n\">cargo</span><span class=\"o\">/</span><span class=\"n\">registry</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">index</span><span class=\"p\">.</span><span class=\"n\">crates</span><span class=\"p\">.</span><span class=\"n\">io</span><span class=\"o\">-</span><span class=\"mi\">6</span><span class=\"n\">f17d22bba15001f</span><span class=\"o\">/</span><span class=\"n\">cranelift</span><span class=\"o\">-</span><span class=\"n\">codegen</span><span class=\"o\">-</span><span class=\"mf\">0.91.1</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">write</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">164</span><span class=\"p\">:</span><span class=\"mi\">5</span>\n</code></pre></div>\n<p>Wasm throwing the error:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"p\">(</span><span class=\"n\">module</span>\n<span class=\"w\">  </span><span class=\"p\">(</span><span class=\"k\">type</span><span class=\"w\"> </span><span class=\"p\">(;</span><span class=\"mi\">0</span><span class=\"p\">;)</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">func</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">param</span><span class=\"w\"> </span><span class=\"kt\">i32</span><span class=\"w\"> </span><span class=\"kt\">i32</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">result</span><span class=\"w\"> </span><span class=\"kt\">i32</span><span class=\"p\">)))</span>\n<span class=\"w\">  </span><span class=\"p\">(</span><span class=\"k\">type</span><span class=\"w\"> </span><span class=\"p\">(;</span><span class=\"mi\">1</span><span class=\"p\">;)</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">func</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">param</span><span class=\"w\"> </span><span class=\"kt\">i32</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">result</span><span class=\"w\"> </span><span class=\"kt\">i32</span><span class=\"p\">)))</span>\n<span class=\"w\">  </span><span class=\"p\">(</span><span class=\"n\">func</span><span class=\"w\"> </span><span class=\"p\">(;</span><span class=\"mi\">0</span><span class=\"p\">;)</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"k\">type</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">param</span><span class=\"w\"> </span><span class=\"kt\">i32</span><span class=\"w\"> </span><span class=\"kt\">i32</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">result</span><span class=\"w\"> </span><span class=\"kt\">i32</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"p\">(</span><span class=\"n\">local</span><span class=\"w\"> </span><span class=\"kt\">i32</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"n\">local</span><span class=\"p\">.</span><span class=\"n\">get</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"w\">    </span><span class=\"n\">local</span><span class=\"p\">.</span><span class=\"n\">get</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"w\">    </span><span class=\"kt\">i32</span><span class=\"p\">.</span><span class=\"n\">add</span>\n<span class=\"w\">    </span><span class=\"n\">local</span><span class=\"p\">.</span><span class=\"n\">set</span><span class=\"w\"> </span><span class=\"mi\">2</span>\n<span class=\"w\">    </span><span class=\"n\">local</span><span class=\"p\">.</span><span class=\"n\">get</span><span class=\"w\"> </span><span class=\"mi\">2</span>\n<span class=\"w\">    </span><span class=\"k\">return</span><span class=\"p\">)</span>\n<span class=\"w\">  </span><span class=\"p\">(</span><span class=\"n\">func</span><span class=\"w\"> </span><span class=\"p\">(;</span><span class=\"mi\">1</span><span class=\"p\">;)</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"k\">type</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">param</span><span class=\"w\"> </span><span class=\"kt\">i32</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">result</span><span class=\"w\"> </span><span class=\"kt\">i32</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"p\">(</span><span class=\"n\">local</span><span class=\"w\"> </span><span class=\"kt\">i32</span><span class=\"w\"> </span><span class=\"kt\">i32</span><span class=\"w\"> </span><span class=\"kt\">i32</span><span class=\"w\"> </span><span class=\"kt\">i32</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"kt\">i32</span><span class=\"p\">.</span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"mi\">2</span>\n<span class=\"w\">    </span><span class=\"n\">local</span><span class=\"p\">.</span><span class=\"n\">set</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"w\">    </span><span class=\"n\">local</span><span class=\"p\">.</span><span class=\"n\">get</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"w\">    </span><span class=\"n\">local</span><span class=\"p\">.</span><span class=\"n\">get</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"w\">    </span><span class=\"n\">call</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"w\">    </span><span class=\"n\">local</span><span class=\"p\">.</span><span class=\"n\">set</span><span class=\"w\"> </span><span class=\"mi\">2</span>\n<span class=\"w\">    </span><span class=\"kt\">i32</span><span class=\"p\">.</span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"mi\">5</span>\n<span class=\"w\">    </span><span class=\"n\">local</span><span class=\"p\">.</span><span class=\"n\">set</span><span class=\"w\"> </span><span class=\"mi\">3</span>\n<span class=\"w\">    </span><span class=\"n\">local</span><span class=\"p\">.</span><span class=\"n\">get</span><span class=\"w\"> </span><span class=\"mi\">2</span>\n<span class=\"w\">    </span><span class=\"n\">local</span><span class=\"p\">.</span><span class=\"n\">get</span><span class=\"w\"> </span><span class=\"mi\">3</span>\n<span class=\"w\">    </span><span class=\"kt\">i32</span><span class=\"p\">.</span><span class=\"n\">add</span>\n<span class=\"w\">    </span><span class=\"n\">local</span><span class=\"p\">.</span><span class=\"n\">set</span><span class=\"w\"> </span><span class=\"mi\">4</span>\n<span class=\"w\">    </span><span class=\"n\">local</span><span class=\"p\">.</span><span class=\"n\">get</span><span class=\"w\"> </span><span class=\"mi\">4</span>\n<span class=\"w\">    </span><span class=\"k\">return</span><span class=\"p\">)</span>\n<span class=\"w\">  </span><span class=\"p\">(</span><span class=\"n\">table</span><span class=\"w\"> </span><span class=\"p\">(;</span><span class=\"mi\">0</span><span class=\"p\">;)</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">funcref</span><span class=\"p\">)</span>\n<span class=\"w\">  </span><span class=\"p\">(</span><span class=\"n\">memory</span><span class=\"w\"> </span><span class=\"p\">(;</span><span class=\"mi\">0</span><span class=\"p\">;)</span><span class=\"w\"> </span><span class=\"mi\">16</span><span class=\"p\">)</span>\n<span class=\"w\">  </span><span class=\"p\">(</span><span class=\"n\">global</span><span class=\"w\"> </span><span class=\"p\">(;</span><span class=\"mi\">0</span><span class=\"p\">;)</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"k\">mut</span><span class=\"w\"> </span><span class=\"kt\">i32</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"kt\">i32</span><span class=\"p\">.</span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"mi\">1048576</span><span class=\"p\">))</span>\n<span class=\"w\">  </span><span class=\"p\">(</span><span class=\"n\">global</span><span class=\"w\"> </span><span class=\"p\">(;</span><span class=\"mi\">1</span><span class=\"p\">;)</span><span class=\"w\"> </span><span class=\"kt\">i32</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"kt\">i32</span><span class=\"p\">.</span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"mi\">1048576</span><span class=\"p\">))</span>\n<span class=\"w\">  </span><span class=\"p\">(</span><span class=\"n\">global</span><span class=\"w\"> </span><span class=\"p\">(;</span><span class=\"mi\">2</span><span class=\"p\">;)</span><span class=\"w\"> </span><span class=\"kt\">i32</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"kt\">i32</span><span class=\"p\">.</span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"mi\">1048576</span><span class=\"p\">))</span>\n<span class=\"w\">  </span><span class=\"p\">(</span><span class=\"n\">export</span><span class=\"w\"> </span><span class=\"s\">\"memory\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">memory</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">))</span>\n<span class=\"w\">  </span><span class=\"p\">(</span><span class=\"n\">export</span><span class=\"w\"> </span><span class=\"s\">\"add\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">func</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">))</span>\n<span class=\"w\">  </span><span class=\"p\">(</span><span class=\"n\">export</span><span class=\"w\"> </span><span class=\"s\">\"add_two\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">func</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">))</span>\n<span class=\"w\">  </span><span class=\"p\">(</span><span class=\"n\">export</span><span class=\"w\"> </span><span class=\"s\">\"__data_end\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">global</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">))</span>\n<span class=\"w\">  </span><span class=\"p\">(</span><span class=\"n\">export</span><span class=\"w\"> </span><span class=\"s\">\"__heap_base\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">global</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"p\">)))</span>\n</code></pre></div>",
        "id": 444457365,
        "sender_full_name": "Joseph Kanichai",
        "timestamp": 1718282882
    },
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"728247\">@Joseph Kanichai</span> -- can you clarify exactly the method you are using to construct the CLIF?</p>\n<p>For example, I don't get a panic from this:</p>\n<div class=\"codehilite\" data-code-language=\"Bash Session\"><pre><span></span><code><span class=\"gp\">$ </span>wasmtime<span class=\"w\"> </span>compile<span class=\"w\"> </span>--emit-clif<span class=\"w\"> </span>clif<span class=\"w\"> </span>input.wat\n</code></pre></div>\n<p>and fwiw, that yields the following clif files:</p>\n<p><code>clif/wasm_func_0.clif</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>function u0:0(i64 vmctx, i64, i32, i32) -&gt; i32 tail {\n    gv0 = vmctx\n    gv1 = load.i64 notrap aligned readonly gv0+8\n    gv2 = load.i64 notrap aligned gv1\n    stack_limit = gv2\n\n                                block0(v0: i64, v1: i64, v2: i32, v3: i32):\n@007e                               v5 = iconst.i32 0\n@0084                               v6 = iadd v2, v3\n@0089                               return v6\n}\n</code></pre></div>\n<p><code>clif/wasm_func_1.clif</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>function u0:1(i64 vmctx, i64, i32) -&gt; i32 tail {\n    gv0 = vmctx\n    gv1 = load.i64 notrap aligned readonly gv0+8\n    gv2 = load.i64 notrap aligned gv1\n    sig0 = (i64 vmctx, i64, i32, i32) -&gt; i32 tail\n    fn0 = colocated u0:0 sig0\n    stack_limit = gv2\n\n                                block0(v0: i64, v1: i64, v2: i32):\n@008d                               v4 = iconst.i32 0\n@008f                               v5 = iconst.i32 2\n@0097                               v6 = call fn0(v0, v0, v2, v5)  ; v5 = 2\n@009b                               v7 = iconst.i32 5\n@00a3                               v8 = iadd v6, v7  ; v7 = 5\n@00a8                               return v8\n}\n</code></pre></div>",
        "id": 444491322,
        "sender_full_name": "fitzgen (he/him)",
        "timestamp": 1718291915
    },
    {
        "content": "<blockquote>\n<p>can you clarify exactly the method you are using to construct the CLIF?</p>\n</blockquote>\n<p>to add a little more color here, I ask because it looks like you are indexing into some kind of <code>PrimaryMap</code> with a key that doesn't exist in that map, which indicates a bug somewhere in that general viscinity</p>",
        "id": 444491542,
        "sender_full_name": "fitzgen (he/him)",
        "timestamp": 1718291994
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"253990\">fitzgen (he/him)</span> <a href=\"#narrow/stream/217117-cranelift/topic/visualizing.20cranelift.20output/near/444491542\">said</a>:</p>\n<blockquote>\n<blockquote>\n<p>can you clarify exactly the method you are using to construct the CLIF?</p>\n</blockquote>\n<p>to add a little more color here, I ask because it looks like you are indexing into some kind of <code>PrimaryMap</code> with a key that doesn't exist in that map, which indicates a bug somewhere in that general viscinity</p>\n</blockquote>\n<p>I'm calling <code>.display</code> on <code>cranelift_codegen::ir::function</code></p>",
        "id": 444492488,
        "sender_full_name": "Joseph Kanichai",
        "timestamp": 1718292238
    },
    {
        "content": "<p>how did you get the <code>ir::Function</code>?</p>",
        "id": 444494012,
        "sender_full_name": "fitzgen (he/him)",
        "timestamp": 1718292619
    },
    {
        "content": "<p>and did you modify it yourself at all?</p>",
        "id": 444494105,
        "sender_full_name": "fitzgen (he/him)",
        "timestamp": 1718292643
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"253990\">fitzgen (he/him)</span> <a href=\"#narrow/stream/217117-cranelift/topic/visualizing.20cranelift.20output/near/444494105\">said</a>:</p>\n<blockquote>\n<p>and did you modify it yourself at all?</p>\n</blockquote>\n<p>I have not performed any modifications, and It's inside a compile function inside wasmer, <a href=\"https://github.com/wasmerio/wasmer/blob/27066c6450e1abf254bdb63261eb13c9c161c8e5/lib/compiler-cranelift/src/compiler.rs#L161\">here</a>.</p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/wasmerio/wasmer/blob/27066c6450e1abf254bdb63261eb13c9c161c8e5/lib/compiler-cranelift/src/compiler.rs#L161\" style=\"background-image: url(&quot;https://uploads.zulipusercontent.net/a972c19a3595891898947bc4d1ac1c52668aabc5/68747470733a2f2f7265706f7369746f72792d696d616765732e67697468756275736572636f6e74656e742e636f6d2f3135323537323138362f66343637666530302d633865362d313165392d393233372d393434393435346664636635&quot;)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/wasmerio/wasmer/blob/27066c6450e1abf254bdb63261eb13c9c161c8e5/lib/compiler-cranelift/src/compiler.rs#L161\" title=\"wasmer/lib/compiler-cranelift/src/compiler.rs at 27066c6450e1abf254bdb63261eb13c9c161c8e5 · wasmerio/wasmer\">wasmer/lib/compiler-cranelift/src/compiler.rs at 27066c6450e1abf254bdb63261eb13c9c161c8e5 · wasmerio/wasmer</a></div><div class=\"message_embed_description\">🚀 The leading Wasm Runtime supporting WASIX, WASI and Emscripten - wasmerio/wasmer</div></div></div>",
        "id": 444495360,
        "sender_full_name": "Joseph Kanichai",
        "timestamp": 1718292892
    },
    {
        "content": "<p>wasmer is not associated with the bytecode alliance, uses a very outdated version of cranelift, and we don't provide support for it here. if you would like to try out wasmtime, we can help you out with that, but otherwise you're on your own with wasmer issues. good luck!</p>",
        "id": 444495993,
        "sender_full_name": "fitzgen (he/him)",
        "timestamp": 1718293032
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"253990\">fitzgen (he/him)</span> Yep looks like wasmer's old cranelift version has issues. Just tried it in wasmtime's repo and it's running fine.</p>",
        "id": 444500342,
        "sender_full_name": "Joseph Kanichai",
        "timestamp": 1718294095
    }
]