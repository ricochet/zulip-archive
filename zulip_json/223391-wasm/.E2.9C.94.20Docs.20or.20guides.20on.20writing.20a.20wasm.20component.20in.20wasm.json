[
    {
        "content": "<p>Hey,</p>\n<p>I'm trying to get comfortable with wasm components by writing them by hand in wat, so far I've gotten a few experiments to work, but I struggle with things like getting a function with a record type to work.</p>\n<p>For example: </p>\n<div class=\"codehilite\" data-code-language=\"WebAssembly\"><pre><span></span><code><span class=\"p\">(</span><span class=\"err\">component</span>\n  <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"nv\">$vec2</span> <span class=\"p\">(</span><span class=\"err\">record</span> <span class=\"p\">(</span><span class=\"err\">field</span> <span class=\"s2\">\"x\"</span> <span class=\"kt\">f64</span><span class=\"p\">)</span> <span class=\"p\">(</span><span class=\"err\">field</span> <span class=\"s2\">\"y\"</span> <span class=\"kt\">f64</span><span class=\"p\">)))</span>\n  <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"nv\">$add_t</span> <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"p\">(</span><span class=\"k\">param</span> <span class=\"s2\">\"a\"</span> <span class=\"mi\">0</span><span class=\"p\">)</span> <span class=\"p\">(</span><span class=\"k\">param</span> <span class=\"s2\">\"b\"</span> <span class=\"mi\">0</span><span class=\"p\">)</span> <span class=\"p\">(</span><span class=\"k\">result</span> <span class=\"s2\">\"res\"</span> <span class=\"mi\">0</span><span class=\"p\">)))</span>\n  <span class=\"p\">(</span><span class=\"err\">core</span> <span class=\"k\">module</span> <span class=\"nv\">$module</span>\n    <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"nv\">$add</span> <span class=\"p\">(</span><span class=\"k\">export</span> <span class=\"s2\">\"add\"</span><span class=\"p\">)</span> <span class=\"p\">(</span><span class=\"k\">param</span> <span class=\"nv\">$a</span> <span class=\"p\">(</span><span class=\"err\">ref</span> <span class=\"nv\">$vec2</span><span class=\"p\">))</span> <span class=\"p\">(</span><span class=\"k\">param</span> <span class=\"nv\">$b</span> <span class=\"p\">(</span><span class=\"err\">ref</span> <span class=\"nv\">$vec2</span><span class=\"p\">))</span> <span class=\"p\">(</span><span class=\"k\">result</span> <span class=\"p\">(</span><span class=\"err\">ref</span> <span class=\"nv\">$vec2</span><span class=\"p\">))</span>\n      <span class=\"p\">(</span><span class=\"err\">...</span><span class=\"p\">)</span>\n    <span class=\"p\">)</span>\n    <span class=\"p\">(</span><span class=\"k\">memory</span> <span class=\"p\">(</span><span class=\"k\">export</span> <span class=\"s2\">\"mem\"</span><span class=\"p\">)</span> <span class=\"mi\">1</span><span class=\"p\">)</span>\n  <span class=\"p\">)</span>\n  <span class=\"p\">(</span><span class=\"err\">core</span> <span class=\"err\">instance</span> <span class=\"nv\">$instance</span> <span class=\"p\">(</span><span class=\"err\">instantiate</span> <span class=\"mi\">0</span><span class=\"p\">))</span>\n  <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"nv\">$add</span> <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"nv\">$add_t</span><span class=\"p\">)</span>\n    <span class=\"p\">(</span><span class=\"err\">canon</span> <span class=\"err\">l</span><span class=\"nb\">if</span><span class=\"err\">t</span>\n        <span class=\"p\">(</span><span class=\"err\">core</span> <span class=\"k\">func</span> <span class=\"nv\">$instance</span> <span class=\"s2\">\"add\"</span><span class=\"p\">)</span>\n        <span class=\"p\">(</span><span class=\"k\">memory</span> <span class=\"nv\">$instance</span> <span class=\"s2\">\"mem\"</span><span class=\"p\">)</span>\n        <span class=\"err\">string-encoding=utf</span><span class=\"mi\">8</span>\n        <span class=\"p\">)</span>\n    <span class=\"p\">)</span>\n<span class=\"p\">)</span>\n</code></pre></div>\n<p>I can't figure out how to use the types from the component.<br>\nAnother question I have is that I've noticed that components created in rust and wasm-tools include package names and interfaces. This is something I'd also like to figure out</p>\n<p>Jens</p>",
        "id": 452863316,
        "sender_full_name": "Jens Gåsemyr Magnus",
        "timestamp": 1721494249
    },
    {
        "content": "<p>Types in the component type index space cannot be used as core module types in the core module type index space. Furthermore core modules don't have the ability to alias types from outside within a component itself, right now the component model is a pure wrapper around teh core wasm spec so there are no modifications to core wasm to enable such aliasing at this time. </p>\n<p>What you probably want here is to review the CanonicalABI.md to understand how the component model type <code>$vec2</code> is lowered into wasm. For example your wasm signature here will be <code>(func (param i32 i32 i32 i32 i32))</code> and the canonical abi will explain what each of those fields are. </p>\n<p>You can also try playing around with <code>wasm-tools component embed --dummy</code> which will generate a dummy <code>*.wat</code> file for a particular WIT world</p>",
        "id": 452914458,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1721520927
    },
    {
        "content": "<p>Thanks! <code>wasm-tools component embed --dummy</code> was very helpful <span aria-label=\"grinning face with smiling eyes\" class=\"emoji emoji-1f601\" role=\"img\" title=\"grinning face with smiling eyes\">:grinning_face_with_smiling_eyes:</span></p>",
        "id": 453009874,
        "sender_full_name": "Jens Gåsemyr Magnus",
        "timestamp": 1721580624
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"512924\">Jens Gåsemyr Magnus</span> has marked this topic as resolved.</p>",
        "id": 453023572,
        "sender_full_name": "Notification Bot",
        "timestamp": 1721586740
    }
]