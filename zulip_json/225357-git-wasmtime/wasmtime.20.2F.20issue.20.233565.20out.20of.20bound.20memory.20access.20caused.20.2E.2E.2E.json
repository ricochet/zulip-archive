[
    {
        "content": "<p>PureWhiteWu opened <a href=\"https://github.com/bytecodealliance/wasmtime/issues/3565\">issue #3565</a>:</p>\n<blockquote>\n<h3>Test Case</h3>\n<p>I've uploaded the code to <a href=\"https://github.com/PureWhiteWu/wasmtime_ub_demo\">https://github.com/PureWhiteWu/wasmtime_ub_demo</a>.</p>\n<h3>Steps to Reproduce</h3>\n<p>I tried to access some out of bound memory in my rust code using unsafe, and found that it didn't report error in some cases. Instead, it caused UB.</p>\n<p>You may clone <a href=\"https://github.com/PureWhiteWu/wasmtime_ub_demo\">https://github.com/PureWhiteWu/wasmtime_ub_demo</a> and just call <code>run.sh</code> to execute the test cases.</p>\n<h3>Expected Results</h3>\n<p>For tests cases <code>1m_minus_two_i32</code>, <code>1m_plus_one</code>, <code>1m_plus_64k</code>, <code>1m_plus_64k_plus_one</code>, <code>2m</code>, should fail with <code>out of bounds memory access</code>.</p>\n<h3>Actual Results</h3>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">wasmtime</span>: <span class=\"nc\">compiling</span><span class=\"w\"> </span><span class=\"n\">using</span><span class=\"w\"> </span><span class=\"n\">cranelift</span><span class=\"o\">..</span><span class=\"p\">.</span><span class=\"w\"></span>\n<span class=\"n\">wasmtime</span>: <span class=\"nc\">running</span><span class=\"w\"> </span><span class=\"n\">cranelift</span><span class=\"w\"> </span><span class=\"n\">version</span><span class=\"o\">..</span><span class=\"p\">.</span><span class=\"w\"></span>\n<span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"mi\">64</span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">cranelift</span>:\n<span class=\"mi\">0</span><span class=\"w\"></span>\n<span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"mi\">64</span><span class=\"n\">k_plus_one</span><span class=\"w\"> </span><span class=\"n\">cranelift</span>:\n<span class=\"mi\">0</span><span class=\"w\"></span>\n<span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"n\">m_minus_four_i32</span><span class=\"w\"> </span><span class=\"n\">cranelift</span>:\n<span class=\"mi\">0</span><span class=\"w\"></span>\n<span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"n\">m_minus_two_i32</span><span class=\"w\"> </span><span class=\"n\">cranelift</span>:\n<span class=\"o\">-</span><span class=\"mi\">201326592</span><span class=\"w\"></span>\n<span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">cranelift</span>:\n<span class=\"mi\">0</span><span class=\"w\"></span>\n<span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"n\">m_plus_one</span><span class=\"w\"> </span><span class=\"n\">cranelift</span>:\n<span class=\"mi\">244</span><span class=\"w\"></span>\n<span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"n\">m_plus_64k</span><span class=\"w\"> </span><span class=\"n\">cranelift</span>:\n<span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">note</span>: <span class=\"nc\">this</span><span class=\"w\"> </span><span class=\"n\">may</span><span class=\"w\"> </span><span class=\"n\">change</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">random</span><span class=\"w\"> </span><span class=\"n\">number</span><span class=\"w\"> </span><span class=\"n\">during</span><span class=\"w\"> </span><span class=\"n\">different</span><span class=\"w\"> </span><span class=\"n\">running</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"n\">m_plus_64k_plus_one</span><span class=\"w\"> </span><span class=\"n\">cranelift</span>:\n<span class=\"nc\">Error</span>: <span class=\"nc\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"w\"> </span><span class=\"n\">module</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">target</span><span class=\"o\">/</span><span class=\"n\">wasm32</span><span class=\"o\">-</span><span class=\"n\">wasi</span><span class=\"o\">/</span><span class=\"n\">release</span><span class=\"o\">/</span><span class=\"mi\">1</span><span class=\"n\">m_plus_64k_plus_one</span><span class=\"p\">.</span><span class=\"n\">wasmtime</span><span class=\"err\">`</span><span class=\"w\"></span>\n\n<span class=\"n\">Caused</span><span class=\"w\"> </span><span class=\"n\">by</span>:\n    <span class=\"mi\">0</span>: <span class=\"nc\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">invoke</span><span class=\"w\"> </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"n\">default</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"mi\">1</span>: <span class=\"nc\">wasm</span><span class=\"w\"> </span><span class=\"n\">trap</span>: <span class=\"nc\">out</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">bounds</span><span class=\"w\"> </span><span class=\"n\">memory</span><span class=\"w\"> </span><span class=\"n\">access</span><span class=\"w\"></span>\n<span class=\"w\">       </span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"n\">backtrace</span>:\n           <span class=\"mi\">0</span>:  <span class=\"mh\">0x2b8</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!</span><span class=\"n\">_1m_plus_64k_plus_one</span>::<span class=\"n\">main</span>::<span class=\"n\">h16960bb87b178e85</span><span class=\"w\"></span>\n<span class=\"w\">           </span><span class=\"mi\">1</span>:  <span class=\"mh\">0x293</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!</span><span class=\"n\">std</span>::<span class=\"n\">sys_common</span>::<span class=\"n\">backtrace</span>::<span class=\"n\">__rust_begin_short_backtrace</span>::<span class=\"n\">h048d11a00c6a35d0</span><span class=\"w\"></span>\n<span class=\"w\">           </span><span class=\"mi\">2</span>: <span class=\"mh\">0x18ba</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!</span><span class=\"n\">__original_main</span><span class=\"w\"></span>\n<span class=\"w\">           </span><span class=\"mi\">3</span>:  <span class=\"mh\">0x279</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!</span><span class=\"n\">_start</span><span class=\"w\"></span>\n<span class=\"w\">           </span><span class=\"mi\">4</span>: <span class=\"mh\">0xb90c</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!</span><span class=\"n\">_start</span><span class=\"p\">.</span><span class=\"n\">command_export</span><span class=\"w\"></span>\n<span class=\"w\">       </span><span class=\"n\">note</span>: <span class=\"nc\">using</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">WASMTIME_BACKTRACE_DETAILS</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">environment</span><span class=\"w\"> </span><span class=\"n\">variable</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">may</span><span class=\"w\"> </span><span class=\"n\">show</span><span class=\"w\"> </span><span class=\"n\">more</span><span class=\"w\"> </span><span class=\"n\">debugging</span><span class=\"w\"> </span><span class=\"n\">information</span><span class=\"w\"></span>\n\n<span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">cranelift</span>:\n<span class=\"nc\">Error</span>: <span class=\"nc\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"w\"> </span><span class=\"n\">module</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">target</span><span class=\"o\">/</span><span class=\"n\">wasm32</span><span class=\"o\">-</span><span class=\"n\">wasi</span><span class=\"o\">/</span><span class=\"n\">release</span><span class=\"o\">/</span><span class=\"mi\">2</span><span class=\"n\">m</span><span class=\"p\">.</span><span class=\"n\">wasmtime</span><span class=\"err\">`</span><span class=\"w\"></span>\n\n<span class=\"n\">Caused</span><span class=\"w\"> </span><span class=\"n\">by</span>:\n    <span class=\"mi\">0</span>: <span class=\"nc\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">invoke</span><span class=\"w\"> </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"n\">default</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"mi\">1</span>: <span class=\"nc\">wasm</span><span class=\"w\"> </span><span class=\"n\">trap</span>: <span class=\"nc\">out</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">bounds</span><span class=\"w\"> </span><span class=\"n\">memory</span><span class=\"w\"> </span><span class=\"n\">access</span><span class=\"w\"></span>\n<span class=\"w\">       </span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"n\">backtrace</span>:\n           <span class=\"mi\">0</span>:  <span class=\"mh\">0x2b8</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!</span><span class=\"n\">_2m</span>::<span class=\"n\">main</span>::<span class=\"n\">h9f0049353c958a74</span><span class=\"w\"></span>\n<span class=\"w\">           </span><span class=\"mi\">1</span>:  <span class=\"mh\">0x293</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!</span><span class=\"n\">std</span>::<span class=\"n\">sys_common</span>::<span class=\"n\">backtrace</span>::<span class=\"n\">__rust_begin_short_backtrace</span>::<span class=\"n\">h6d0aa0bccba5db1c</span><span class=\"w\"></span>\n<span class=\"w\">           </span><span class=\"mi\">2</span>: <span class=\"mh\">0x18ba</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!</span><span class=\"n\">__original_main</span><span class=\"w\"></span>\n<span class=\"w\">           </span><span class=\"mi\">3</span>:  <span class=\"mh\">0x279</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!</span><span class=\"n\">_start</span><span class=\"w\"></span>\n<span class=\"w\">           </span><span class=\"mi\">4</span>: <span class=\"mh\">0xb90c</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!</span><span class=\"n\">_start</span><span class=\"p\">.</span><span class=\"n\">command_export</span><span class=\"w\"></span>\n<span class=\"w\">       </span><span class=\"n\">note</span>: <span class=\"nc\">using</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">WASMTIME_BACKTRACE_DETAILS</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">environment</span><span class=\"w\"> </span><span class=\"n\">variable</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">may</span><span class=\"w\"> </span><span class=\"n\">show</span><span class=\"w\"> </span><span class=\"n\">more</span><span class=\"w\"> </span><span class=\"n\">debugging</span><span class=\"w\"> </span><span class=\"n\">information</span><span class=\"w\"></span>\n\n<span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">end</span><span class=\"o\">..</span><span class=\"p\">.</span><span class=\"w\"></span>\n</code></pre></div>\n<p><code>1m_minus_two_i32</code> reads from 1m-2 to 1m+2 (an i32), which should failed with <code>out of bounds memory access</code>, but seems it succeed with undefined behaviour.<br>\n<code>1m_plus_one</code>, <code>1m_plus_64k</code> reads only a byte, and should fail with <code>out of bounds memory access</code>, but seems reads unpredictable values too.</p>\n<h3>Versions and Environment</h3>\n<p>Wasmtime version or commit: wasmtime 0.31.0</p>\n<p>Operating system: Linux 5.4.56 Debian 10</p>\n<p>Architecture: amd64 / AMD EPYC 7642 48-Core Processor</p>\n</blockquote>",
        "id": 263024497,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1638200349
    },
    {
        "content": "<p>PureWhiteWu labeled <a href=\"https://github.com/bytecodealliance/wasmtime/issues/3565\">issue #3565</a>:</p>\n<blockquote>\n<h3>Test Case</h3>\n<p>I've uploaded the code to <a href=\"https://github.com/PureWhiteWu/wasmtime_ub_demo\">https://github.com/PureWhiteWu/wasmtime_ub_demo</a>.</p>\n<h3>Steps to Reproduce</h3>\n<p>I tried to access some out of bound memory in my rust code using unsafe, and found that it didn't report error in some cases. Instead, it caused UB.</p>\n<p>You may clone <a href=\"https://github.com/PureWhiteWu/wasmtime_ub_demo\">https://github.com/PureWhiteWu/wasmtime_ub_demo</a> and just call <code>run.sh</code> to execute the test cases.</p>\n<h3>Expected Results</h3>\n<p>For tests cases <code>1m_minus_two_i32</code>, <code>1m_plus_one</code>, <code>1m_plus_64k</code>, <code>1m_plus_64k_plus_one</code>, <code>2m</code>, should fail with <code>out of bounds memory access</code>.</p>\n<h3>Actual Results</h3>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">wasmtime</span>: <span class=\"nc\">compiling</span><span class=\"w\"> </span><span class=\"n\">using</span><span class=\"w\"> </span><span class=\"n\">cranelift</span><span class=\"o\">..</span><span class=\"p\">.</span><span class=\"w\"></span>\n<span class=\"n\">wasmtime</span>: <span class=\"nc\">running</span><span class=\"w\"> </span><span class=\"n\">cranelift</span><span class=\"w\"> </span><span class=\"n\">version</span><span class=\"o\">..</span><span class=\"p\">.</span><span class=\"w\"></span>\n<span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"mi\">64</span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">cranelift</span>:\n<span class=\"mi\">0</span><span class=\"w\"></span>\n<span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"mi\">64</span><span class=\"n\">k_plus_one</span><span class=\"w\"> </span><span class=\"n\">cranelift</span>:\n<span class=\"mi\">0</span><span class=\"w\"></span>\n<span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"n\">m_minus_four_i32</span><span class=\"w\"> </span><span class=\"n\">cranelift</span>:\n<span class=\"mi\">0</span><span class=\"w\"></span>\n<span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"n\">m_minus_two_i32</span><span class=\"w\"> </span><span class=\"n\">cranelift</span>:\n<span class=\"o\">-</span><span class=\"mi\">201326592</span><span class=\"w\"></span>\n<span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">cranelift</span>:\n<span class=\"mi\">0</span><span class=\"w\"></span>\n<span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"n\">m_plus_one</span><span class=\"w\"> </span><span class=\"n\">cranelift</span>:\n<span class=\"mi\">244</span><span class=\"w\"></span>\n<span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"n\">m_plus_64k</span><span class=\"w\"> </span><span class=\"n\">cranelift</span>:\n<span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">note</span>: <span class=\"nc\">this</span><span class=\"w\"> </span><span class=\"n\">may</span><span class=\"w\"> </span><span class=\"n\">change</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">random</span><span class=\"w\"> </span><span class=\"n\">number</span><span class=\"w\"> </span><span class=\"n\">during</span><span class=\"w\"> </span><span class=\"n\">different</span><span class=\"w\"> </span><span class=\"n\">running</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"n\">m_plus_64k_plus_one</span><span class=\"w\"> </span><span class=\"n\">cranelift</span>:\n<span class=\"nc\">Error</span>: <span class=\"nc\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"w\"> </span><span class=\"n\">module</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">target</span><span class=\"o\">/</span><span class=\"n\">wasm32</span><span class=\"o\">-</span><span class=\"n\">wasi</span><span class=\"o\">/</span><span class=\"n\">release</span><span class=\"o\">/</span><span class=\"mi\">1</span><span class=\"n\">m_plus_64k_plus_one</span><span class=\"p\">.</span><span class=\"n\">wasmtime</span><span class=\"err\">`</span><span class=\"w\"></span>\n\n<span class=\"n\">Caused</span><span class=\"w\"> </span><span class=\"n\">by</span>:\n    <span class=\"mi\">0</span>: <span class=\"nc\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">invoke</span><span class=\"w\"> </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"n\">default</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"mi\">1</span>: <span class=\"nc\">wasm</span><span class=\"w\"> </span><span class=\"n\">trap</span>: <span class=\"nc\">out</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">bounds</span><span class=\"w\"> </span><span class=\"n\">memory</span><span class=\"w\"> </span><span class=\"n\">access</span><span class=\"w\"></span>\n<span class=\"w\">       </span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"n\">backtrace</span>:\n           <span class=\"mi\">0</span>:  <span class=\"mh\">0x2b8</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!</span><span class=\"n\">_1m_plus_64k_plus_one</span>::<span class=\"n\">main</span>::<span class=\"n\">h16960bb87b178e85</span><span class=\"w\"></span>\n<span class=\"w\">           </span><span class=\"mi\">1</span>:  <span class=\"mh\">0x293</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!</span><span class=\"n\">std</span>::<span class=\"n\">sys_common</span>::<span class=\"n\">backtrace</span>::<span class=\"n\">__rust_begin_short_backtrace</span>::<span class=\"n\">h048d11a00c6a35d0</span><span class=\"w\"></span>\n<span class=\"w\">           </span><span class=\"mi\">2</span>: <span class=\"mh\">0x18ba</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!</span><span class=\"n\">__original_main</span><span class=\"w\"></span>\n<span class=\"w\">           </span><span class=\"mi\">3</span>:  <span class=\"mh\">0x279</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!</span><span class=\"n\">_start</span><span class=\"w\"></span>\n<span class=\"w\">           </span><span class=\"mi\">4</span>: <span class=\"mh\">0xb90c</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!</span><span class=\"n\">_start</span><span class=\"p\">.</span><span class=\"n\">command_export</span><span class=\"w\"></span>\n<span class=\"w\">       </span><span class=\"n\">note</span>: <span class=\"nc\">using</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">WASMTIME_BACKTRACE_DETAILS</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">environment</span><span class=\"w\"> </span><span class=\"n\">variable</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">may</span><span class=\"w\"> </span><span class=\"n\">show</span><span class=\"w\"> </span><span class=\"n\">more</span><span class=\"w\"> </span><span class=\"n\">debugging</span><span class=\"w\"> </span><span class=\"n\">information</span><span class=\"w\"></span>\n\n<span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">cranelift</span>:\n<span class=\"nc\">Error</span>: <span class=\"nc\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"w\"> </span><span class=\"n\">module</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">target</span><span class=\"o\">/</span><span class=\"n\">wasm32</span><span class=\"o\">-</span><span class=\"n\">wasi</span><span class=\"o\">/</span><span class=\"n\">release</span><span class=\"o\">/</span><span class=\"mi\">2</span><span class=\"n\">m</span><span class=\"p\">.</span><span class=\"n\">wasmtime</span><span class=\"err\">`</span><span class=\"w\"></span>\n\n<span class=\"n\">Caused</span><span class=\"w\"> </span><span class=\"n\">by</span>:\n    <span class=\"mi\">0</span>: <span class=\"nc\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">invoke</span><span class=\"w\"> </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"n\">default</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"mi\">1</span>: <span class=\"nc\">wasm</span><span class=\"w\"> </span><span class=\"n\">trap</span>: <span class=\"nc\">out</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">bounds</span><span class=\"w\"> </span><span class=\"n\">memory</span><span class=\"w\"> </span><span class=\"n\">access</span><span class=\"w\"></span>\n<span class=\"w\">       </span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"n\">backtrace</span>:\n           <span class=\"mi\">0</span>:  <span class=\"mh\">0x2b8</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!</span><span class=\"n\">_2m</span>::<span class=\"n\">main</span>::<span class=\"n\">h9f0049353c958a74</span><span class=\"w\"></span>\n<span class=\"w\">           </span><span class=\"mi\">1</span>:  <span class=\"mh\">0x293</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!</span><span class=\"n\">std</span>::<span class=\"n\">sys_common</span>::<span class=\"n\">backtrace</span>::<span class=\"n\">__rust_begin_short_backtrace</span>::<span class=\"n\">h6d0aa0bccba5db1c</span><span class=\"w\"></span>\n<span class=\"w\">           </span><span class=\"mi\">2</span>: <span class=\"mh\">0x18ba</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!</span><span class=\"n\">__original_main</span><span class=\"w\"></span>\n<span class=\"w\">           </span><span class=\"mi\">3</span>:  <span class=\"mh\">0x279</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!</span><span class=\"n\">_start</span><span class=\"w\"></span>\n<span class=\"w\">           </span><span class=\"mi\">4</span>: <span class=\"mh\">0xb90c</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!</span><span class=\"n\">_start</span><span class=\"p\">.</span><span class=\"n\">command_export</span><span class=\"w\"></span>\n<span class=\"w\">       </span><span class=\"n\">note</span>: <span class=\"nc\">using</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">WASMTIME_BACKTRACE_DETAILS</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">environment</span><span class=\"w\"> </span><span class=\"n\">variable</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">may</span><span class=\"w\"> </span><span class=\"n\">show</span><span class=\"w\"> </span><span class=\"n\">more</span><span class=\"w\"> </span><span class=\"n\">debugging</span><span class=\"w\"> </span><span class=\"n\">information</span><span class=\"w\"></span>\n\n<span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">end</span><span class=\"o\">..</span><span class=\"p\">.</span><span class=\"w\"></span>\n</code></pre></div>\n<p><code>1m_minus_two_i32</code> reads from 1m-2 to 1m+2 (an i32), which should failed with <code>out of bounds memory access</code>, but seems it succeed with undefined behaviour.<br>\n<code>1m_plus_one</code>, <code>1m_plus_64k</code> reads only a byte, and should fail with <code>out of bounds memory access</code>, but seems reads unpredictable values too.</p>\n<h3>Versions and Environment</h3>\n<p>Wasmtime version or commit: wasmtime 0.31.0</p>\n<p>Operating system: Linux 5.4.56 Debian 10</p>\n<p>Architecture: amd64 / AMD EPYC 7642 48-Core Processor</p>\n</blockquote>",
        "id": 263024498,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1638200349
    },
    {
        "content": "<p>PureWhiteWu edited <a href=\"https://github.com/bytecodealliance/wasmtime/issues/3565\">issue #3565</a>:</p>\n<blockquote>\n<h3>Test Case</h3>\n<p>I've uploaded the code to <a href=\"https://github.com/PureWhiteWu/wasmtime_ub_demo\">https://github.com/PureWhiteWu/wasmtime_ub_demo</a>.</p>\n<h3>Steps to Reproduce</h3>\n<p>I tried to access some out of bound memory in my rust code using unsafe, and found that it didn't report error in some cases. Instead, it caused UB.</p>\n<p>You may clone <a href=\"https://github.com/PureWhiteWu/wasmtime_ub_demo\">https://github.com/PureWhiteWu/wasmtime_ub_demo</a> and just call <code>run.sh</code> to execute the test cases.</p>\n<h3>Expected Results</h3>\n<p>For tests cases <code>1m_minus_two_i32</code>, <code>1m_plus_one</code>, <code>1m_plus_64k</code>, <code>1m_plus_64k_plus_one</code>, <code>2m</code>, should fail with <code>out of bounds memory access</code>.</p>\n<h3>Actual Results</h3>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">wasmtime</span>: <span class=\"nc\">compiling</span><span class=\"w\"> </span><span class=\"n\">using</span><span class=\"w\"> </span><span class=\"n\">cranelift</span><span class=\"o\">..</span><span class=\"p\">.</span><span class=\"w\"></span>\n<span class=\"n\">wasmtime</span>: <span class=\"nc\">running</span><span class=\"w\"> </span><span class=\"n\">cranelift</span><span class=\"w\"> </span><span class=\"n\">version</span><span class=\"o\">..</span><span class=\"p\">.</span><span class=\"w\"></span>\n<span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"mi\">64</span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">cranelift</span>:\n<span class=\"mi\">0</span><span class=\"w\"></span>\n<span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"mi\">64</span><span class=\"n\">k_plus_one</span><span class=\"w\"> </span><span class=\"n\">cranelift</span>:\n<span class=\"mi\">0</span><span class=\"w\"></span>\n<span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"n\">m_minus_four_i32</span><span class=\"w\"> </span><span class=\"n\">cranelift</span>:\n<span class=\"mi\">0</span><span class=\"w\"></span>\n<span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"n\">m_minus_two_i32</span><span class=\"w\"> </span><span class=\"n\">cranelift</span>:\n<span class=\"o\">-</span><span class=\"mi\">201326592</span><span class=\"w\"></span>\n<span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">cranelift</span>:\n<span class=\"mi\">0</span><span class=\"w\"></span>\n<span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"n\">m_plus_one</span><span class=\"w\"> </span><span class=\"n\">cranelift</span>:\n<span class=\"mi\">244</span><span class=\"w\"></span>\n<span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"n\">m_plus_64k</span><span class=\"w\"> </span><span class=\"n\">cranelift</span>:\n<span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">note</span>: <span class=\"nc\">this</span><span class=\"w\"> </span><span class=\"n\">may</span><span class=\"w\"> </span><span class=\"n\">change</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">random</span><span class=\"w\"> </span><span class=\"n\">number</span><span class=\"w\"> </span><span class=\"n\">during</span><span class=\"w\"> </span><span class=\"n\">different</span><span class=\"w\"> </span><span class=\"n\">running</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"n\">m_plus_64k_plus_one</span><span class=\"w\"> </span><span class=\"n\">cranelift</span>:\n<span class=\"nc\">Error</span>: <span class=\"nc\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"w\"> </span><span class=\"n\">module</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">target</span><span class=\"o\">/</span><span class=\"n\">wasm32</span><span class=\"o\">-</span><span class=\"n\">wasi</span><span class=\"o\">/</span><span class=\"n\">release</span><span class=\"o\">/</span><span class=\"mi\">1</span><span class=\"n\">m_plus_64k_plus_one</span><span class=\"p\">.</span><span class=\"n\">wasmtime</span><span class=\"err\">`</span><span class=\"w\"></span>\n\n<span class=\"n\">Caused</span><span class=\"w\"> </span><span class=\"n\">by</span>:\n    <span class=\"mi\">0</span>: <span class=\"nc\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">invoke</span><span class=\"w\"> </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"n\">default</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"mi\">1</span>: <span class=\"nc\">wasm</span><span class=\"w\"> </span><span class=\"n\">trap</span>: <span class=\"nc\">out</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">bounds</span><span class=\"w\"> </span><span class=\"n\">memory</span><span class=\"w\"> </span><span class=\"n\">access</span><span class=\"w\"></span>\n<span class=\"w\">       </span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"n\">backtrace</span>:\n           <span class=\"mi\">0</span>:  <span class=\"mh\">0x2b8</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!</span><span class=\"n\">_1m_plus_64k_plus_one</span>::<span class=\"n\">main</span>::<span class=\"n\">h16960bb87b178e85</span><span class=\"w\"></span>\n<span class=\"w\">           </span><span class=\"mi\">1</span>:  <span class=\"mh\">0x293</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!</span><span class=\"n\">std</span>::<span class=\"n\">sys_common</span>::<span class=\"n\">backtrace</span>::<span class=\"n\">__rust_begin_short_backtrace</span>::<span class=\"n\">h048d11a00c6a35d0</span><span class=\"w\"></span>\n<span class=\"w\">           </span><span class=\"mi\">2</span>: <span class=\"mh\">0x18ba</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!</span><span class=\"n\">__original_main</span><span class=\"w\"></span>\n<span class=\"w\">           </span><span class=\"mi\">3</span>:  <span class=\"mh\">0x279</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!</span><span class=\"n\">_start</span><span class=\"w\"></span>\n<span class=\"w\">           </span><span class=\"mi\">4</span>: <span class=\"mh\">0xb90c</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!</span><span class=\"n\">_start</span><span class=\"p\">.</span><span class=\"n\">command_export</span><span class=\"w\"></span>\n<span class=\"w\">       </span><span class=\"n\">note</span>: <span class=\"nc\">using</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">WASMTIME_BACKTRACE_DETAILS</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">environment</span><span class=\"w\"> </span><span class=\"n\">variable</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">may</span><span class=\"w\"> </span><span class=\"n\">show</span><span class=\"w\"> </span><span class=\"n\">more</span><span class=\"w\"> </span><span class=\"n\">debugging</span><span class=\"w\"> </span><span class=\"n\">information</span><span class=\"w\"></span>\n\n<span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">cranelift</span>:\n<span class=\"nc\">Error</span>: <span class=\"nc\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"w\"> </span><span class=\"n\">module</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">target</span><span class=\"o\">/</span><span class=\"n\">wasm32</span><span class=\"o\">-</span><span class=\"n\">wasi</span><span class=\"o\">/</span><span class=\"n\">release</span><span class=\"o\">/</span><span class=\"mi\">2</span><span class=\"n\">m</span><span class=\"p\">.</span><span class=\"n\">wasmtime</span><span class=\"err\">`</span><span class=\"w\"></span>\n\n<span class=\"n\">Caused</span><span class=\"w\"> </span><span class=\"n\">by</span>:\n    <span class=\"mi\">0</span>: <span class=\"nc\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">invoke</span><span class=\"w\"> </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"n\">default</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"mi\">1</span>: <span class=\"nc\">wasm</span><span class=\"w\"> </span><span class=\"n\">trap</span>: <span class=\"nc\">out</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">bounds</span><span class=\"w\"> </span><span class=\"n\">memory</span><span class=\"w\"> </span><span class=\"n\">access</span><span class=\"w\"></span>\n<span class=\"w\">       </span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"n\">backtrace</span>:\n           <span class=\"mi\">0</span>:  <span class=\"mh\">0x2b8</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!</span><span class=\"n\">_2m</span>::<span class=\"n\">main</span>::<span class=\"n\">h9f0049353c958a74</span><span class=\"w\"></span>\n<span class=\"w\">           </span><span class=\"mi\">1</span>:  <span class=\"mh\">0x293</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!</span><span class=\"n\">std</span>::<span class=\"n\">sys_common</span>::<span class=\"n\">backtrace</span>::<span class=\"n\">__rust_begin_short_backtrace</span>::<span class=\"n\">h6d0aa0bccba5db1c</span><span class=\"w\"></span>\n<span class=\"w\">           </span><span class=\"mi\">2</span>: <span class=\"mh\">0x18ba</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!</span><span class=\"n\">__original_main</span><span class=\"w\"></span>\n<span class=\"w\">           </span><span class=\"mi\">3</span>:  <span class=\"mh\">0x279</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!</span><span class=\"n\">_start</span><span class=\"w\"></span>\n<span class=\"w\">           </span><span class=\"mi\">4</span>: <span class=\"mh\">0xb90c</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!</span><span class=\"n\">_start</span><span class=\"p\">.</span><span class=\"n\">command_export</span><span class=\"w\"></span>\n<span class=\"w\">       </span><span class=\"n\">note</span>: <span class=\"nc\">using</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">WASMTIME_BACKTRACE_DETAILS</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">environment</span><span class=\"w\"> </span><span class=\"n\">variable</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">may</span><span class=\"w\"> </span><span class=\"n\">show</span><span class=\"w\"> </span><span class=\"n\">more</span><span class=\"w\"> </span><span class=\"n\">debugging</span><span class=\"w\"> </span><span class=\"n\">information</span><span class=\"w\"></span>\n\n<span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">end</span><span class=\"o\">..</span><span class=\"p\">.</span><span class=\"w\"></span>\n</code></pre></div>\n<p><code>1m_minus_two_i32</code> reads from 1m-2 to 1m+2 (an i32), which should failed with <code>out of bounds memory access</code>, but seems it succeed with undefined behaviour.<br>\n<code>1m_plus_one</code>, <code>1m_plus_64k</code> reads only a byte, and should fail with <code>out of bounds memory access</code>, but seems reads unpredictable values too.</p>\n<h3>Versions and Environment</h3>\n<p>Wasmtime version or commit: wasmtime 0.31.0</p>\n<p>Operating system: Linux 5.4.56 Debian 10</p>\n<p>Architecture: amd64 / AMD EPYC 7642 48-Core Processor</p>\n</blockquote>",
        "id": 263024533,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1638200364
    },
    {
        "content": "<p>bjorn3 <a href=\"https://github.com/bytecodealliance/wasmtime/issues/3565#issuecomment-981771120\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/3565\">issue #3565</a>:</p>\n<blockquote>\n<p>I just checked <code>1m_minus_two_i32</code>. The compiled wasm file specifies a linear memory of 17 pages. As a wasm page is 64k, this means that the first 1088KiB of the linear memory is fully readable and writable. This is exactly 1MiB + 64KiB. <code>1m_minus_two_i32</code> and <code>1m_plus_one</code> should thus succeed. <code>1m_plus_64k</code> succeeding would be an off-by-one error in the bounds check of wasmtime if I did my math correctly. <code>1m_plus_64k_plus_one</code> and <code>2m</code> give an out of bounds error as intended.</p>\n<p>All examples invoke UB at the Rust level as you dereference a pointer created from an arbitrary integer, but this does not translate to the wasm level. <code>1m_plus_64k_plus_one</code>, <code>2m</code> and I think <code>1m_plus_64k</code> are defined as trapping, but the rest is fully defined at wasm level.</p>\n</blockquote>",
        "id": 263027415,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1638201529
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/3565#issuecomment-981771808\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/3565\">issue #3565</a>:</p>\n<blockquote>\n<p>Thanks for the report but I  believe that this is all working as intended. Looking at the modules themselves it appears that most of them have a <code>memory</code> with 17 pages of memory, which is 1MB plus 64k, which I believe explains why all the tests exhibit the behavior that they do. Otherwise though I believe everything is in working order with the wasm spec, so I'm going to close this.</p>\n</blockquote>",
        "id": 263027527,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1638201578
    },
    {
        "content": "<p>alexcrichton closed <a href=\"https://github.com/bytecodealliance/wasmtime/issues/3565\">issue #3565</a>:</p>\n<blockquote>\n<h3>Test Case</h3>\n<p>I've uploaded the code to <a href=\"https://github.com/PureWhiteWu/wasmtime_ub_demo\">https://github.com/PureWhiteWu/wasmtime_ub_demo</a>.</p>\n<h3>Steps to Reproduce</h3>\n<p>I tried to access some out of bound memory in my rust code using unsafe, and found that it didn't report error in some cases. Instead, it caused UB.</p>\n<p>You may clone <a href=\"https://github.com/PureWhiteWu/wasmtime_ub_demo\">https://github.com/PureWhiteWu/wasmtime_ub_demo</a> and just call <code>run.sh</code> to execute the test cases.</p>\n<h3>Expected Results</h3>\n<p>For tests cases <code>1m_minus_two_i32</code>, <code>1m_plus_one</code>, <code>1m_plus_64k</code>, <code>1m_plus_64k_plus_one</code>, <code>2m</code>, should fail with <code>out of bounds memory access</code>.</p>\n<h3>Actual Results</h3>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">wasmtime</span>: <span class=\"nc\">compiling</span><span class=\"w\"> </span><span class=\"n\">using</span><span class=\"w\"> </span><span class=\"n\">cranelift</span><span class=\"o\">..</span><span class=\"p\">.</span><span class=\"w\"></span>\n<span class=\"n\">wasmtime</span>: <span class=\"nc\">running</span><span class=\"w\"> </span><span class=\"n\">cranelift</span><span class=\"w\"> </span><span class=\"n\">version</span><span class=\"o\">..</span><span class=\"p\">.</span><span class=\"w\"></span>\n<span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"mi\">64</span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">cranelift</span>:\n<span class=\"mi\">0</span><span class=\"w\"></span>\n<span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"mi\">64</span><span class=\"n\">k_plus_one</span><span class=\"w\"> </span><span class=\"n\">cranelift</span>:\n<span class=\"mi\">0</span><span class=\"w\"></span>\n<span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"n\">m_minus_four_i32</span><span class=\"w\"> </span><span class=\"n\">cranelift</span>:\n<span class=\"mi\">0</span><span class=\"w\"></span>\n<span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"n\">m_minus_two_i32</span><span class=\"w\"> </span><span class=\"n\">cranelift</span>:\n<span class=\"o\">-</span><span class=\"mi\">201326592</span><span class=\"w\"></span>\n<span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">cranelift</span>:\n<span class=\"mi\">0</span><span class=\"w\"></span>\n<span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"n\">m_plus_one</span><span class=\"w\"> </span><span class=\"n\">cranelift</span>:\n<span class=\"mi\">244</span><span class=\"w\"></span>\n<span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"n\">m_plus_64k</span><span class=\"w\"> </span><span class=\"n\">cranelift</span>:\n<span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">note</span>: <span class=\"nc\">this</span><span class=\"w\"> </span><span class=\"n\">may</span><span class=\"w\"> </span><span class=\"n\">change</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">random</span><span class=\"w\"> </span><span class=\"n\">number</span><span class=\"w\"> </span><span class=\"n\">during</span><span class=\"w\"> </span><span class=\"n\">different</span><span class=\"w\"> </span><span class=\"n\">running</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"n\">m_plus_64k_plus_one</span><span class=\"w\"> </span><span class=\"n\">cranelift</span>:\n<span class=\"nc\">Error</span>: <span class=\"nc\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"w\"> </span><span class=\"n\">module</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">target</span><span class=\"o\">/</span><span class=\"n\">wasm32</span><span class=\"o\">-</span><span class=\"n\">wasi</span><span class=\"o\">/</span><span class=\"n\">release</span><span class=\"o\">/</span><span class=\"mi\">1</span><span class=\"n\">m_plus_64k_plus_one</span><span class=\"p\">.</span><span class=\"n\">wasmtime</span><span class=\"err\">`</span><span class=\"w\"></span>\n\n<span class=\"n\">Caused</span><span class=\"w\"> </span><span class=\"n\">by</span>:\n    <span class=\"mi\">0</span>: <span class=\"nc\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">invoke</span><span class=\"w\"> </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"n\">default</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"mi\">1</span>: <span class=\"nc\">wasm</span><span class=\"w\"> </span><span class=\"n\">trap</span>: <span class=\"nc\">out</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">bounds</span><span class=\"w\"> </span><span class=\"n\">memory</span><span class=\"w\"> </span><span class=\"n\">access</span><span class=\"w\"></span>\n<span class=\"w\">       </span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"n\">backtrace</span>:\n           <span class=\"mi\">0</span>:  <span class=\"mh\">0x2b8</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!</span><span class=\"n\">_1m_plus_64k_plus_one</span>::<span class=\"n\">main</span>::<span class=\"n\">h16960bb87b178e85</span><span class=\"w\"></span>\n<span class=\"w\">           </span><span class=\"mi\">1</span>:  <span class=\"mh\">0x293</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!</span><span class=\"n\">std</span>::<span class=\"n\">sys_common</span>::<span class=\"n\">backtrace</span>::<span class=\"n\">__rust_begin_short_backtrace</span>::<span class=\"n\">h048d11a00c6a35d0</span><span class=\"w\"></span>\n<span class=\"w\">           </span><span class=\"mi\">2</span>: <span class=\"mh\">0x18ba</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!</span><span class=\"n\">__original_main</span><span class=\"w\"></span>\n<span class=\"w\">           </span><span class=\"mi\">3</span>:  <span class=\"mh\">0x279</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!</span><span class=\"n\">_start</span><span class=\"w\"></span>\n<span class=\"w\">           </span><span class=\"mi\">4</span>: <span class=\"mh\">0xb90c</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!</span><span class=\"n\">_start</span><span class=\"p\">.</span><span class=\"n\">command_export</span><span class=\"w\"></span>\n<span class=\"w\">       </span><span class=\"n\">note</span>: <span class=\"nc\">using</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">WASMTIME_BACKTRACE_DETAILS</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">environment</span><span class=\"w\"> </span><span class=\"n\">variable</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">may</span><span class=\"w\"> </span><span class=\"n\">show</span><span class=\"w\"> </span><span class=\"n\">more</span><span class=\"w\"> </span><span class=\"n\">debugging</span><span class=\"w\"> </span><span class=\"n\">information</span><span class=\"w\"></span>\n\n<span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">cranelift</span>:\n<span class=\"nc\">Error</span>: <span class=\"nc\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"w\"> </span><span class=\"n\">module</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">target</span><span class=\"o\">/</span><span class=\"n\">wasm32</span><span class=\"o\">-</span><span class=\"n\">wasi</span><span class=\"o\">/</span><span class=\"n\">release</span><span class=\"o\">/</span><span class=\"mi\">2</span><span class=\"n\">m</span><span class=\"p\">.</span><span class=\"n\">wasmtime</span><span class=\"err\">`</span><span class=\"w\"></span>\n\n<span class=\"n\">Caused</span><span class=\"w\"> </span><span class=\"n\">by</span>:\n    <span class=\"mi\">0</span>: <span class=\"nc\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">invoke</span><span class=\"w\"> </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"n\">default</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"mi\">1</span>: <span class=\"nc\">wasm</span><span class=\"w\"> </span><span class=\"n\">trap</span>: <span class=\"nc\">out</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">bounds</span><span class=\"w\"> </span><span class=\"n\">memory</span><span class=\"w\"> </span><span class=\"n\">access</span><span class=\"w\"></span>\n<span class=\"w\">       </span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"n\">backtrace</span>:\n           <span class=\"mi\">0</span>:  <span class=\"mh\">0x2b8</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!</span><span class=\"n\">_2m</span>::<span class=\"n\">main</span>::<span class=\"n\">h9f0049353c958a74</span><span class=\"w\"></span>\n<span class=\"w\">           </span><span class=\"mi\">1</span>:  <span class=\"mh\">0x293</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!</span><span class=\"n\">std</span>::<span class=\"n\">sys_common</span>::<span class=\"n\">backtrace</span>::<span class=\"n\">__rust_begin_short_backtrace</span>::<span class=\"n\">h6d0aa0bccba5db1c</span><span class=\"w\"></span>\n<span class=\"w\">           </span><span class=\"mi\">2</span>: <span class=\"mh\">0x18ba</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!</span><span class=\"n\">__original_main</span><span class=\"w\"></span>\n<span class=\"w\">           </span><span class=\"mi\">3</span>:  <span class=\"mh\">0x279</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!</span><span class=\"n\">_start</span><span class=\"w\"></span>\n<span class=\"w\">           </span><span class=\"mi\">4</span>: <span class=\"mh\">0xb90c</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!</span><span class=\"n\">_start</span><span class=\"p\">.</span><span class=\"n\">command_export</span><span class=\"w\"></span>\n<span class=\"w\">       </span><span class=\"n\">note</span>: <span class=\"nc\">using</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">WASMTIME_BACKTRACE_DETAILS</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">environment</span><span class=\"w\"> </span><span class=\"n\">variable</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">may</span><span class=\"w\"> </span><span class=\"n\">show</span><span class=\"w\"> </span><span class=\"n\">more</span><span class=\"w\"> </span><span class=\"n\">debugging</span><span class=\"w\"> </span><span class=\"n\">information</span><span class=\"w\"></span>\n\n<span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">end</span><span class=\"o\">..</span><span class=\"p\">.</span><span class=\"w\"></span>\n</code></pre></div>\n<p><code>1m_minus_two_i32</code> reads from 1m-2 to 1m+2 (an i32), which should failed with <code>out of bounds memory access</code>, but seems it succeed with undefined behaviour.<br>\n<code>1m_plus_one</code>, <code>1m_plus_64k</code> reads only a byte, and should fail with <code>out of bounds memory access</code>, but seems reads unpredictable values too.</p>\n<h3>Versions and Environment</h3>\n<p>Wasmtime version or commit: wasmtime 0.31.0</p>\n<p>Operating system: Linux 5.4.56 Debian 10</p>\n<p>Architecture: amd64 / AMD EPYC 7642 48-Core Processor</p>\n</blockquote>",
        "id": 263027533,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1638201581
    },
    {
        "content": "<p>PureWhiteWu <a href=\"https://github.com/bytecodealliance/wasmtime/issues/3565#issuecomment-981777753\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/3565\">issue #3565</a>:</p>\n<blockquote>\n<p>Oh you are right! This is because I invoke UB in Rust not wasmtime.<br>\nThanks for your reply!</p>\n</blockquote>",
        "id": 263028560,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1638201942
    }
]