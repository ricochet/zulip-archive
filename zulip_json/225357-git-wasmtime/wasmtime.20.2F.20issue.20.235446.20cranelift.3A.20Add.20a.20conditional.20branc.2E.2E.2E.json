[
    {
        "content": "<p>elliottt <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446#issuecomment-1354072067\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446\">issue #5446</a>:</p>\n<blockquote>\n<blockquote>\n<p>I haven't reviewed the backend lowerings, but I looked at everything else, and this is looking pretty solid to me. I did spot a few small typos, but mostly I have questions about the verifier and the lexer.</p>\n</blockquote>\n<p>The backend lowerings were all copied from each backend's current implementation of <code>brnz</code>, so it should hopefully be a quick review there <span aria-label=\"+1\" class=\"emoji emoji-1f44d\" role=\"img\" title=\"+1\">:+1:</span> </p>\n</blockquote>",
        "id": 316176194,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671155983
    },
    {
        "content": "<p>afonso360 <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446#issuecomment-1355352683\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446\">issue #5446</a>:</p>\n<blockquote>\n<p><span aria-label=\"wave\" class=\"emoji emoji-1f44b\" role=\"img\" title=\"wave\">:wave:</span> Hey,</p>\n<p>I'm not sure how ready or not this is, but I was playing around with adding fuzzer support for it (see <a href=\"https://github.com/afonso360/wasmtime/tree/fuzz-brif\">this branch</a>) and it found a regalloc issue. (Both on x86_64 and AArch64)</p>\n<p>&lt;details&gt;<br>\n&lt;summary&gt;Test Case&lt;/summary&gt;</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">test</span><span class=\"w\"> </span><span class=\"n\">interpret</span><span class=\"w\"></span>\n<span class=\"n\">test</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"></span>\n<span class=\"n\">target</span><span class=\"w\"> </span><span class=\"n\">aarch64</span><span class=\"w\"></span>\n<span class=\"n\">target</span><span class=\"w\"> </span><span class=\"n\">x86_64</span><span class=\"w\"></span>\n\n<span class=\"n\">function</span><span class=\"w\"> </span><span class=\"o\">%</span><span class=\"n\">a</span><span class=\"p\">()</span><span class=\"w\"> </span>-&gt; <span class=\"kt\">i8</span> <span class=\"nc\">system_v</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"n\">block0</span>:\n    <span class=\"nc\">v1</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">iconst</span><span class=\"p\">.</span><span class=\"kt\">i8</span><span class=\"w\"> </span><span class=\"mi\">35</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">brif</span><span class=\"w\"> </span><span class=\"n\">v1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">block1</span><span class=\"p\">(</span><span class=\"n\">v1</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">block1</span><span class=\"p\">(</span><span class=\"n\">v1</span><span class=\"p\">)</span><span class=\"w\">  </span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">v1</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">35</span><span class=\"w\"></span>\n\n<span class=\"n\">block1</span><span class=\"p\">(</span><span class=\"n\">v0</span>: <span class=\"kt\">i8</span><span class=\"p\">)</span>:\n    <span class=\"nc\">return</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"w\"></span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n\n<span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">run</span>: <span class=\"o\">%</span><span class=\"n\">a</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"mi\">35</span><span class=\"w\"></span>\n</code></pre></div>\n<p>&lt;/details&gt;</p>\n<p>&lt;details&gt;<br>\n&lt;summary&gt;Result&lt;/summary&gt;</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">ERROR</span><span class=\"w\"> </span><span class=\"n\">cranelift_codegen</span>::<span class=\"n\">machinst</span>::<span class=\"n\">compile</span><span class=\"w\"> </span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"n\">Register</span><span class=\"w\"> </span><span class=\"n\">allocation</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"n\">vcode</span><span class=\"w\"></span>\n<span class=\"n\">VCode</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"n\">Entry</span><span class=\"w\"> </span><span class=\"n\">block</span>: <span class=\"mi\">0</span><span class=\"w\"></span>\n<span class=\"n\">Block</span><span class=\"w\"> </span><span class=\"mi\">0</span>:\n    <span class=\"p\">(</span><span class=\"n\">original</span><span class=\"w\"> </span><span class=\"n\">IR</span><span class=\"w\"> </span><span class=\"n\">block</span>: <span class=\"nc\">block0</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">(</span><span class=\"n\">successor</span>: <span class=\"nc\">Block</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">(</span><span class=\"n\">successor</span>: <span class=\"nc\">Block</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">(</span><span class=\"n\">instruction</span><span class=\"w\"> </span><span class=\"n\">range</span>: <span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">..</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"n\">Inst</span><span class=\"w\"> </span><span class=\"mi\">0</span>: <span class=\"nc\">movl</span><span class=\"w\">    </span><span class=\"cp\">$</span><span class=\"mi\">35</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">%</span><span class=\"n\">v132l</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"n\">Inst</span><span class=\"w\"> </span><span class=\"mi\">1</span>: <span class=\"nc\">testb</span><span class=\"w\">   </span><span class=\"o\">%</span><span class=\"n\">v132b</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">%</span><span class=\"n\">v132b</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"n\">Inst</span><span class=\"w\"> </span><span class=\"mi\">2</span>: <span class=\"nc\">jnz</span><span class=\"w\">     </span><span class=\"n\">label1</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"n\">label2</span><span class=\"w\"></span>\n<span class=\"n\">Block</span><span class=\"w\"> </span><span class=\"mi\">1</span>:\n    <span class=\"p\">(</span><span class=\"n\">successor</span>: <span class=\"nc\">Block</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">(</span><span class=\"n\">instruction</span><span class=\"w\"> </span><span class=\"n\">range</span>: <span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"o\">..</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"n\">Inst</span><span class=\"w\"> </span><span class=\"mi\">3</span>: <span class=\"nc\">jmp</span><span class=\"w\">     </span><span class=\"n\">label3</span><span class=\"w\"></span>\n<span class=\"n\">Block</span><span class=\"w\"> </span><span class=\"mi\">2</span>:\n    <span class=\"p\">(</span><span class=\"n\">successor</span>: <span class=\"nc\">Block</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">(</span><span class=\"n\">instruction</span><span class=\"w\"> </span><span class=\"n\">range</span>: <span class=\"mi\">4</span><span class=\"w\"> </span><span class=\"o\">..</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"n\">Inst</span><span class=\"w\"> </span><span class=\"mi\">4</span>: <span class=\"nc\">jmp</span><span class=\"w\">     </span><span class=\"n\">label3</span><span class=\"w\"></span>\n<span class=\"n\">Block</span><span class=\"w\"> </span><span class=\"mi\">3</span>:\n    <span class=\"p\">(</span><span class=\"n\">original</span><span class=\"w\"> </span><span class=\"n\">IR</span><span class=\"w\"> </span><span class=\"n\">block</span>: <span class=\"nc\">block1</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">(</span><span class=\"n\">instruction</span><span class=\"w\"> </span><span class=\"n\">range</span>: <span class=\"mi\">5</span><span class=\"w\"> </span><span class=\"o\">..</span><span class=\"w\"> </span><span class=\"mi\">6</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"n\">Inst</span><span class=\"w\"> </span><span class=\"mi\">5</span>: <span class=\"nc\">ret</span><span class=\"w\"></span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n\n<span class=\"n\">Error</span>: <span class=\"nc\">Branch</span><span class=\"p\">(</span><span class=\"n\">Inst</span><span class=\"p\">(</span><span class=\"mi\">2</span><span class=\"p\">))</span><span class=\"w\"></span>\n<span class=\"n\">CLIF</span><span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"n\">error</span>:\n<span class=\"nc\">function</span><span class=\"w\"> </span><span class=\"n\">u0</span>:<span class=\"mi\">0</span><span class=\"p\">()</span><span class=\"w\"> </span>-&gt; <span class=\"kt\">i8</span> <span class=\"nc\">system_v</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"n\">block0</span>:\n    <span class=\"nc\">v1</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">iconst</span><span class=\"p\">.</span><span class=\"kt\">i8</span><span class=\"w\"> </span><span class=\"mi\">35</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">brif</span><span class=\"w\"> </span><span class=\"n\">v1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">block1</span><span class=\"p\">(</span><span class=\"n\">v1</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">block1</span><span class=\"p\">(</span><span class=\"n\">v1</span><span class=\"p\">)</span><span class=\"w\">  </span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">v1</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">35</span><span class=\"w\"></span>\n\n<span class=\"n\">block1</span><span class=\"p\">(</span><span class=\"n\">v0</span>: <span class=\"kt\">i8</span><span class=\"p\">)</span>:\n    <span class=\"nc\">return</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"w\"></span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n\n<span class=\"n\">thread</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"na\">worker</span><span class=\"w\"> </span>#<span class=\"mi\">0</span><span class=\"o\">'</span><span class=\"w\"> </span><span class=\"n\">panicked</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"na\">register</span><span class=\"w\"> </span><span class=\"n\">allocation</span>: <span class=\"nc\">Branch</span><span class=\"p\">(</span><span class=\"n\">Inst</span><span class=\"p\">(</span><span class=\"mi\">2</span><span class=\"p\">))</span><span class=\"o\">'</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">cranelift</span><span class=\"o\">/</span><span class=\"n\">codegen</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">machinst</span><span class=\"o\">/</span><span class=\"n\">compile</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">67</span>:<span class=\"mi\">14</span><span class=\"w\"></span>\n<span class=\"n\">note</span>: <span class=\"nc\">run</span><span class=\"w\"> </span><span class=\"n\">with</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">RUST_BACKTRACE</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">environment</span><span class=\"w\"> </span><span class=\"n\">variable</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">display</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">backtrace</span><span class=\"w\"></span>\n<span class=\"w\"> </span><span class=\"n\">ERROR</span><span class=\"w\"> </span><span class=\"n\">cranelift_filetests</span>::<span class=\"n\">concurrent</span><span class=\"w\">      </span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"n\">FAIL</span>: <span class=\"nc\">panicked</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">worker</span><span class=\"w\"> </span>#<span class=\"mi\">0</span>: <span class=\"nc\">register</span><span class=\"w\"> </span><span class=\"n\">allocation</span>: <span class=\"nc\">Branch</span><span class=\"p\">(</span><span class=\"n\">Inst</span><span class=\"p\">(</span><span class=\"mi\">2</span><span class=\"p\">))</span><span class=\"w\"></span>\n<span class=\"n\">FAIL</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">lmao</span><span class=\"p\">.</span><span class=\"n\">clif</span>: <span class=\"nc\">panicked</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">worker</span><span class=\"w\"> </span>#<span class=\"mi\">0</span>: <span class=\"nc\">register</span><span class=\"w\"> </span><span class=\"n\">allocation</span>: <span class=\"nc\">Branch</span><span class=\"p\">(</span><span class=\"n\">Inst</span><span class=\"p\">(</span><span class=\"mi\">2</span><span class=\"p\">))</span><span class=\"w\"></span>\n<span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">tests</span><span class=\"w\"></span>\n<span class=\"n\">Error</span>: <span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">failure</span><span class=\"w\"></span>\n</code></pre></div>\n<p>&lt;/details&gt;</p>\n</blockquote>",
        "id": 316330594,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671214472
    },
    {
        "content": "<p>elliottt <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446#issuecomment-1355413923\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446\">issue #5446</a>:</p>\n<blockquote>\n<blockquote>\n<p>wave Hey,</p>\n<p>I'm not sure how ready or not this is, but I was playing around with adding fuzzer support for it (see <a href=\"https://github.com/afonso360/wasmtime/tree/fuzz-brif\">this branch</a>) and it found a regalloc issue. (Both on x86_64 and AArch64)</p>\n</blockquote>\n<p>Interesting! I'm surprised to see this, as the lowering for <code>brif</code>  should match <code>brnz</code>, but modifying the test to use <code>brnz</code> / <code>jump</code> doesn't show the same problem. Thanks for the test case!</p>\n</blockquote>",
        "id": 316337412,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671216488
    },
    {
        "content": "<p>elliottt <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446#issuecomment-1355513202\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446\">issue #5446</a>:</p>\n<blockquote>\n<p>@afonso360 that bug is fixed now -- I hadn't updated <code>lower_branch_blockparam_args</code> to account for the fact that <code>brif</code> doesn't store its block params in the varargs of the branch instruction itself. Thanks for finding this!</p>\n</blockquote>",
        "id": 316348350,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671220384
    },
    {
        "content": "<p>afonso360 <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446#issuecomment-1356782426\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446\">issue #5446</a>:</p>\n<blockquote>\n<p>Here's another one. This one only triggers with <code>use_egraphs</code>. It also doesn't require any <code>opt_level</code> which is weird to me, because I thought that we only enabled egraph optimizations at some <code>opt_level</code>?</p>\n<p>&lt;details&gt;<br>\n  &lt;summary&gt;Testcase&lt;/summary&gt;</p>\n<p>```<br>\ntest compile<br>\nset use_egraphs=true<br>\ntarget aarch64<br>\ntarget s390x<br>\ntarget riscv64<br>\ntarget x86_64</p>\n<p>function %a(i32, i8) -&gt; i32 {<br>\nblock0(v0: i32, v1: i8):<br>\n    v2 = iconst.i32 0x00cd_cdcd<br>\n    brif v1, block1(v0), block1(v2)</p>\n<p>block1(v3: i32):<br>\n    return v3<br>\n}<br>\n  ```<br>\n&lt;/details&gt;</p>\n<p>&lt;details&gt;<br>\n  &lt;summary&gt;Error&lt;/summary&gt;</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">thread</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"na\">worker</span><span class=\"w\"> </span>#<span class=\"mi\">0</span><span class=\"o\">'</span><span class=\"w\"> </span><span class=\"n\">panicked</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"na\">assertion</span><span class=\"w\"> </span><span class=\"n\">failed</span>: <span class=\"nc\">regs</span><span class=\"p\">.</span><span class=\"n\">is_valid</span><span class=\"p\">()</span><span class=\"o\">'</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">cranelift</span><span class=\"o\">/</span><span class=\"n\">codegen</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">machinst</span><span class=\"o\">/</span><span class=\"n\">lower</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">1321</span>:<span class=\"mi\">9</span><span class=\"w\"></span>\n<span class=\"n\">stack</span><span class=\"w\"> </span><span class=\"n\">backtrace</span>:\n   <span class=\"mi\">0</span>: <span class=\"nc\">rust_begin_unwind</span><span class=\"w\"></span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"mf\">897e37553</span><span class=\"n\">bba8b42751c67658967889d11ecd120</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">panicking</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">584</span>:<span class=\"mi\">5</span><span class=\"w\"></span>\n<span class=\"w\">   </span><span class=\"mi\">1</span>: <span class=\"nc\">core</span>::<span class=\"n\">panicking</span>::<span class=\"n\">panic_fmt</span><span class=\"w\"></span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"mf\">897e37553</span><span class=\"n\">bba8b42751c67658967889d11ecd120</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">panicking</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">142</span>:<span class=\"mi\">14</span><span class=\"w\"></span>\n<span class=\"w\">   </span><span class=\"mi\">2</span>: <span class=\"nc\">core</span>::<span class=\"n\">panicking</span>::<span class=\"n\">panic</span><span class=\"w\"></span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"mf\">897e37553</span><span class=\"n\">bba8b42751c67658967889d11ecd120</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">panicking</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">48</span>:<span class=\"mi\">5</span><span class=\"w\"></span>\n<span class=\"w\">   </span><span class=\"mi\">3</span>: <span class=\"nc\">cranelift_codegen</span>::<span class=\"n\">machinst</span>::<span class=\"n\">lower</span>::<span class=\"n\">Lower</span><span class=\"o\">&lt;</span><span class=\"n\">I</span><span class=\"o\">&gt;</span>::<span class=\"n\">put_value_in_regs</span><span class=\"w\"></span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">codegen</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">machinst</span><span class=\"o\">/</span><span class=\"n\">lower</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">1321</span>:<span class=\"mi\">9</span><span class=\"w\"></span>\n<span class=\"w\">   </span><span class=\"mi\">4</span>: <span class=\"nc\">cranelift_codegen</span>::<span class=\"n\">machinst</span>::<span class=\"n\">lower</span>::<span class=\"n\">Lower</span><span class=\"o\">&lt;</span><span class=\"n\">I</span><span class=\"o\">&gt;</span>::<span class=\"n\">lower_branch_blockparam_args</span><span class=\"w\"></span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">codegen</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">machinst</span><span class=\"o\">/</span><span class=\"n\">lower</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">964</span>:<span class=\"mi\">28</span><span class=\"w\"></span>\n<span class=\"w\">   </span><span class=\"mi\">5</span>: <span class=\"nc\">cranelift_codegen</span>::<span class=\"n\">machinst</span>::<span class=\"n\">lower</span>::<span class=\"n\">Lower</span><span class=\"o\">&lt;</span><span class=\"n\">I</span><span class=\"o\">&gt;</span>::<span class=\"n\">lower_clif_branches</span><span class=\"w\"></span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">codegen</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">machinst</span><span class=\"o\">/</span><span class=\"n\">lower</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">939</span>:<span class=\"mi\">9</span><span class=\"w\"></span>\n<span class=\"w\">   </span><span class=\"mi\">6</span>: <span class=\"nc\">cranelift_codegen</span>::<span class=\"n\">machinst</span>::<span class=\"n\">lower</span>::<span class=\"n\">Lower</span><span class=\"o\">&lt;</span><span class=\"n\">I</span><span class=\"o\">&gt;</span>::<span class=\"n\">lower</span><span class=\"w\"></span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">codegen</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">machinst</span><span class=\"o\">/</span><span class=\"n\">lower</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">1046</span>:<span class=\"mi\">21</span><span class=\"w\"></span>\n<span class=\"w\">   </span><span class=\"mi\">7</span>: <span class=\"nc\">cranelift_codegen</span>::<span class=\"n\">machinst</span>::<span class=\"n\">compile</span>::<span class=\"n\">compile</span><span class=\"w\"></span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">codegen</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">machinst</span><span class=\"o\">/</span><span class=\"n\">compile</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">37</span>:<span class=\"mi\">9</span><span class=\"w\"></span>\n<span class=\"w\">   </span><span class=\"mi\">8</span>: <span class=\"nc\">cranelift_codegen</span>::<span class=\"n\">isa</span>::<span class=\"n\">aarch64</span>::<span class=\"n\">AArch64Backend</span>::<span class=\"n\">compile_vcode</span><span class=\"w\"></span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">codegen</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">isa</span><span class=\"o\">/</span><span class=\"n\">aarch64</span><span class=\"o\">/</span><span class=\"k\">mod</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">63</span>:<span class=\"mi\">9</span><span class=\"w\"></span>\n<span class=\"w\">   </span><span class=\"mi\">9</span>: <span class=\"o\">&lt;</span><span class=\"n\">cranelift_codegen</span>::<span class=\"n\">isa</span>::<span class=\"n\">aarch64</span>::<span class=\"n\">AArch64Backend</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">cranelift_codegen</span>::<span class=\"n\">isa</span>::<span class=\"n\">TargetIsa</span><span class=\"o\">&gt;</span>::<span class=\"n\">compile_function</span><span class=\"w\"></span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">codegen</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">isa</span><span class=\"o\">/</span><span class=\"n\">aarch64</span><span class=\"o\">/</span><span class=\"k\">mod</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">73</span>:<span class=\"mi\">40</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"mi\">10</span>: <span class=\"nc\">cranelift_codegen</span>::<span class=\"n\">context</span>::<span class=\"n\">Context</span>::<span class=\"n\">compile_stencil</span><span class=\"w\"></span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">codegen</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">context</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">143</span>:<span class=\"mi\">9</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"mi\">11</span>: <span class=\"nc\">cranelift_codegen</span>::<span class=\"n\">context</span>::<span class=\"n\">Context</span>::<span class=\"n\">compile</span><span class=\"w\"></span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">codegen</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">context</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">213</span>:<span class=\"mi\">23</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"mi\">12</span>: <span class=\"o\">&lt;</span><span class=\"n\">cranelift_filetests</span>::<span class=\"n\">test_compile</span>::<span class=\"n\">TestCompile</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">cranelift_filetests</span>::<span class=\"n\">subtest</span>::<span class=\"n\">SubTest</span><span class=\"o\">&gt;</span>::<span class=\"n\">run</span><span class=\"w\"></span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">filetests</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">test_compile</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">56</span>:<span class=\"mi\">29</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"mi\">13</span>: <span class=\"nc\">cranelift_filetests</span>::<span class=\"n\">subtest</span>::<span class=\"n\">SubTest</span>::<span class=\"n\">run_target</span><span class=\"w\"></span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">filetests</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">subtest</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">97</span>:<span class=\"mi\">13</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"mi\">14</span>: <span class=\"nc\">cranelift_filetests</span>::<span class=\"n\">runone</span>::<span class=\"n\">run</span><span class=\"w\"></span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">filetests</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">runone</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">101</span>:<span class=\"mi\">9</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"mi\">15</span>: <span class=\"nc\">cranelift_filetests</span>::<span class=\"n\">concurrent</span>::<span class=\"n\">worker_thread</span>::<span class=\"p\">{{</span><span class=\"n\">closure</span><span class=\"p\">}}</span>::<span class=\"p\">{{</span><span class=\"n\">closure</span><span class=\"p\">}}</span><span class=\"w\"></span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">filetests</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">concurrent</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">150</span>:<span class=\"mi\">46</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"mi\">16</span>: <span class=\"nc\">std</span>::<span class=\"n\">panicking</span>::<span class=\"kr\">try</span>::<span class=\"n\">do_call</span><span class=\"w\"></span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"mf\">897e37553</span><span class=\"n\">bba8b42751c67658967889d11ecd120</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">panicking</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">492</span>:<span class=\"mi\">40</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"mi\">17</span>: <span class=\"nc\">__rust_try</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"mi\">18</span>: <span class=\"nc\">std</span>::<span class=\"n\">panicking</span>::<span class=\"kr\">try</span><span class=\"w\"></span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"mf\">897e37553</span><span class=\"n\">bba8b42751c67658967889d11ecd120</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">panicking</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">456</span>:<span class=\"mi\">19</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"mi\">19</span>: <span class=\"nc\">std</span>::<span class=\"n\">panic</span>::<span class=\"n\">catch_unwind</span><span class=\"w\"></span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"mf\">897e37553</span><span class=\"n\">bba8b42751c67658967889d11ecd120</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">panic</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">137</span>:<span class=\"mi\">14</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"mi\">20</span>: <span class=\"nc\">cranelift_filetests</span>::<span class=\"n\">concurrent</span>::<span class=\"n\">worker_thread</span>::<span class=\"p\">{{</span><span class=\"n\">closure</span><span class=\"p\">}}</span><span class=\"w\"></span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">filetests</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">concurrent</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">150</span>:<span class=\"mi\">30</span><span class=\"w\"></span>\n<span class=\"n\">note</span>: <span class=\"nb\">Some</span> <span class=\"nc\">details</span><span class=\"w\"> </span><span class=\"n\">are</span><span class=\"w\"> </span><span class=\"n\">omitted</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">with</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">RUST_BACKTRACE</span><span class=\"o\">=</span><span class=\"n\">full</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">verbose</span><span class=\"w\"> </span><span class=\"n\">backtrace</span><span class=\"p\">.</span><span class=\"w\"></span>\n<span class=\"w\"> </span><span class=\"n\">ERROR</span><span class=\"w\"> </span><span class=\"n\">cranelift_filetests</span>::<span class=\"n\">concurrent</span><span class=\"w\"> </span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"n\">FAIL</span>: <span class=\"nc\">panicked</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">worker</span><span class=\"w\"> </span>#<span class=\"mi\">0</span>: <span class=\"nc\">assertion</span><span class=\"w\"> </span><span class=\"n\">failed</span>: <span class=\"nc\">regs</span><span class=\"p\">.</span><span class=\"n\">is_valid</span><span class=\"p\">()</span><span class=\"w\"></span>\n<span class=\"n\">FAIL</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">lmao</span><span class=\"p\">.</span><span class=\"n\">clif</span>: <span class=\"nc\">panicked</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">worker</span><span class=\"w\"> </span>#<span class=\"mi\">0</span>: <span class=\"nc\">assertion</span><span class=\"w\"> </span><span class=\"n\">failed</span>: <span class=\"nc\">regs</span><span class=\"p\">.</span><span class=\"n\">is_valid</span><span class=\"p\">()</span><span class=\"w\"></span>\n<span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">tests</span><span class=\"w\"></span>\n<span class=\"n\">Error</span>: <span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">failure</span><span class=\"w\"></span>\n</code></pre></div>\n<p>&lt;/details&gt;</p>\n</blockquote>",
        "id": 316576177,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671364598
    },
    {
        "content": "<p>elliottt <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446#issuecomment-1356894712\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446\">issue #5446</a>:</p>\n<blockquote>\n<p>@afonso360 thanks for finding that one! I found it separately on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464\">https://github.com/bytecodealliance/wasmtime/pull/5464</a>. I decided that it would be a good idea to rework all branching instructions to use <code>BlockWithArgs</code>, and that showed all the places that I was overlooking on this branch. Ultimately #5464 will allow us to have block arguments with <code>br_table</code> instructions as well, so I'll try to land that and then rebase this PR on top of it.</p>\n</blockquote>",
        "id": 316645679,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671404171
    },
    {
        "content": "<p>jameysharp <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446#issuecomment-1357930141\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446\">issue #5446</a>:</p>\n<blockquote>\n<blockquote>\n<p>It also doesn't require any <code>opt_level</code> which is weird to me, because I thought that we only enabled egraph optimizations at some <code>opt_level</code>?</p>\n</blockquote>\n<p>That's an interesting question. Looking at <code>cranelift/codegen/src/context.rs</code>, I guess <code>use_egraphs</code> entirely ignores the optimization level. Also, it looks like there's no difference in Cranelift between the different values of <code>OptLevel</code> except for testing whether it's <code>OptLevel::None</code> or not. So <code>use_egraphs</code> effectively forces a non-<code>None</code> optimization level.</p>\n</blockquote>",
        "id": 316782968,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671467607
    },
    {
        "content": "<p>cfallin <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446#issuecomment-1358001915\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446\">issue #5446</a>:</p>\n<blockquote>\n<blockquote>\n<blockquote>\n<p>It also doesn't require any <code>opt_level</code> which is weird to me, because I thought that we only enabled egraph optimizations at some <code>opt_level</code>?</p>\n</blockquote>\n<p>That's an interesting question. Looking at <code>cranelift/codegen/src/context.rs</code>, I guess <code>use_egraphs</code> entirely ignores the optimization level. Also, it looks like there's no difference in Cranelift between the different values of <code>OptLevel</code> except for testing whether it's <code>OptLevel::None</code> or not. So <code>use_egraphs</code> effectively forces a non-<code>None</code> optimization level.</p>\n</blockquote>\n<p>Indeed, the intent of that behavior (it was this way with original egraphs and kept with the refactor) was to make the flag a top-level override; when we delete the non-egraphs path it makes sense to use <code>opt_level</code> again to choose whether to use the egraph pass.</p>\n</blockquote>",
        "id": 316793983,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671470915
    },
    {
        "content": "<p>github-actions[bot] <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446#issuecomment-1387459019\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446\">issue #5446</a>:</p>\n<blockquote>\n<h4>Subscribe to Label Action</h4>\n<p>cc @cfallin, @fitzgen</p>\n<p>&lt;details&gt;<br>\nThis issue or pull request has been labeled: \"cranelift\", \"cranelift:area:aarch64\", \"cranelift:area:machinst\", \"cranelift:area:x64\", \"cranelift:meta\", \"isle\"</p>\n<p>Thus the following users have been cc'd because of the following labels:</p>\n<ul>\n<li>cfallin: isle</li>\n<li>fitzgen: isle</li>\n</ul>\n<p>To subscribe or unsubscribe from this label, edit the &lt;code&gt;.github/subscribe-to-label.json&lt;/code&gt; configuration file.</p>\n<p><a href=\"https://github.com/bytecodealliance/subscribe-to-label-action\">Learn more.</a><br>\n&lt;/details&gt;</p>\n</blockquote>",
        "id": 322111986,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1674063314
    },
    {
        "content": "<p>elliottt <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446#issuecomment-1387529618\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446\">issue #5446</a>:</p>\n<blockquote>\n<p>@afonso360 I added support for fuzzing on this branch by considering <code>brif</code> as one candidate for instruction generation in the <code>BlockTerminator::Br</code> case. The diff ended up a bit smaller than your original branch now that the builder for <code>brif</code> doesn't need to construct a <code>BlockCall</code> directly <span aria-label=\"+1\" class=\"emoji emoji-1f44d\" role=\"img\" title=\"+1\">:+1:</span> </p>\n</blockquote>",
        "id": 322123651,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1674066636
    }
]