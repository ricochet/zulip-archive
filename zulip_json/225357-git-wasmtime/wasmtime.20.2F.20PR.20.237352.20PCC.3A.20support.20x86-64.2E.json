[
    {
        "content": "<p><strong>cfallin</strong> requested <a href=\"https://github.com/abrown\">abrown</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/7352\">PR #7352</a>.</p>",
        "id": 398364106,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1698183383
    },
    {
        "content": "<p>cfallin opened <a href=\"https://github.com/bytecodealliance/wasmtime/pull/7352\">PR #7352</a> from <code>cfallin:pcc-x86</code> to <code>bytecodealliance:main</code>:</p>\n<blockquote>\n<p>This PR extends the proof-carrying-code infrastructure to support x86-64 as well as aarch64. In the process, many of the mechanisms had to be made a little more general.</p>\n<p>One important change is that the PCC leaves more \"breadcrumbs\" on the frontend now, avoiding the need for magic handling of facts on constant values, etc., in the backend. For the first time a lowering rule also gains the ability to add a fact to a vreg to preserve the chain as well.</p>\n<p>With these changes, we can validate compilation of SpiderMonkey.wasm with Wasm static memories on x86-64 and aarch64:</p>\n<p><div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">cfallin</span><span class=\"o\">@</span><span class=\"n\">fastly2</span>:<span class=\"o\">~/</span><span class=\"n\">work</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">%</span><span class=\"w\"> </span><span class=\"n\">target</span><span class=\"o\">/</span><span class=\"n\">release</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">compile</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">pcc</span><span class=\"o\">=</span><span class=\"n\">yes</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">target</span><span class=\"w\"> </span><span class=\"n\">x86_64</span><span class=\"w\"> </span><span class=\"o\">../</span><span class=\"n\">wasm</span><span class=\"o\">-</span><span class=\"n\">tests</span><span class=\"o\">/</span><span class=\"n\">spidermonkey</span><span class=\"p\">.</span><span class=\"n\">wasm</span>\n<span class=\"n\">cfallin</span><span class=\"o\">@</span><span class=\"n\">fastly2</span>:<span class=\"o\">~/</span><span class=\"n\">work</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">%</span><span class=\"w\"> </span><span class=\"n\">target</span><span class=\"o\">/</span><span class=\"n\">release</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">compile</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">pcc</span><span class=\"o\">=</span><span class=\"n\">yes</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">target</span><span class=\"w\"> </span><span class=\"n\">aarch64</span><span class=\"w\"> </span><span class=\"o\">../</span><span class=\"n\">wasm</span><span class=\"o\">-</span><span class=\"n\">tests</span><span class=\"o\">/</span><span class=\"n\">spidermonkey</span><span class=\"p\">.</span><span class=\"n\">wasm</span>\n<span class=\"n\">cfallin</span><span class=\"o\">@</span><span class=\"n\">fastly2</span>:<span class=\"o\">~/</span><span class=\"n\">work</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">%</span>\n</code></pre></div><br>\n</p>\n</blockquote>",
        "id": 398364107,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1698183383
    },
    {
        "content": "<p><strong>cfallin</strong> requested <a href=\"https://github.com/orgs/bytecodealliance/teams/wasmtime-compiler-reviewers\">wasmtime-compiler-reviewers</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/7352\">PR #7352</a>.</p>",
        "id": 398364108,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1698183383
    },
    {
        "content": "<p><strong>cfallin</strong> requested <a href=\"https://github.com/fitzgen\">fitzgen</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/7352\">PR #7352</a>.</p>",
        "id": 398364145,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1698183412
    },
    {
        "content": "<p>cfallin updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/7352\">PR #7352</a>.</p>",
        "id": 398365860,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1698184387
    },
    {
        "content": "<p>fitzgen submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/7352#pullrequestreview-1697836625\">PR review</a>:</p>\n<blockquote>\n<p>Nice!!</p>\n<p>A few comments below.</p>\n</blockquote>",
        "id": 398533700,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1698255589
    },
    {
        "content": "<p>fitzgen submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/7352#pullrequestreview-1697836625\">PR review</a>:</p>\n<blockquote>\n<p>Nice!!</p>\n<p>A few comments below.</p>\n</blockquote>",
        "id": 398533701,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1698255589
    },
    {
        "content": "<p>fitzgen created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/7352#discussion_r1372059553\">PR review comment</a>:</p>\n<blockquote>\n<p>Ditto.</p>\n</blockquote>",
        "id": 398533702,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1698255589
    },
    {
        "content": "<p>fitzgen created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/7352#discussion_r1372059625\">PR review comment</a>:</p>\n<blockquote>\n<p>Ditto.</p>\n</blockquote>",
        "id": 398533703,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1698255589
    },
    {
        "content": "<p>fitzgen created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/7352#discussion_r1372079058\">PR review comment</a>:</p>\n<blockquote>\n<p>Will all these traces in this file continue to be useful? As written, I don't think they really have enough context to be helpful, but maybe they would with more context in the message? Or maybe it would be better to just remove them?</p>\n</blockquote>",
        "id": 398533704,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1698255589
    },
    {
        "content": "<p>fitzgen created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/7352#discussion_r1372059288\">PR review comment</a>:</p>\n<blockquote>\n<p>Right now an <code>XmmMem</code> provides a strong guarantee because the field is private and all constructors do checks. We can't make these inner fields <code>pub</code> because that would allow someone to mutate, for example, an <code>XmmMem</code> such that it wraps a non-XMM register and that breaks the type's invariants.</p>\n<p>Same for the other register class newtypes.</p>\n<p>There should be all the various conversions available like <code>From</code>, <code>TryFrom</code>, and <code>Into</code> but if any aren't present then we can add them. I think we might still need <code>AsRef</code> implementations.</p>\n<p>But we really shouldn't add <em>unchecked</em> constructors or anything that is the equivalent (like making the inner fields <code>pub</code> or having an <code>AsMut</code> implementation)</p>\n</blockquote>",
        "id": 398533705,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1698255589
    },
    {
        "content": "<p>fitzgen created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/7352#discussion_r1372093901\">PR review comment</a>:</p>\n<blockquote>\n<p>It seems like the trace here should be the <code>Display</code>/<code>Debug</code> of the error returned, and the error should contain the instruction or instruction index.</p>\n<p>That is a bit larger of a refactor, and can happen in a follow up PR, but we should at least in the meantime make this a <code>log::error!</code> rather than a <code>crate::trace!</code>.</p>\n</blockquote>",
        "id": 398533706,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1698255589
    },
    {
        "content": "<p>fitzgen created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/7352#discussion_r1372104136\">PR review comment</a>:</p>\n<blockquote>\n<p>I think this would be a little bit more general and less ad-hoc or at least more aesthetically pleasing to me if we separated fact attachment from fact construction:</p>\n<div class=\"codehilite\" data-code-language=\"suggestion\"><pre><span></span><code>        (let ((fact Fact (make_range_fact 64 0 0xffff_ffff)))\n          (with_fact src fact)))\n</code></pre></div>\n<p>But feel free to take or leave this suggestion.</p>\n</blockquote>",
        "id": 398533707,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1698255590
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/7352#pullrequestreview-1697925202\">PR review</a>.</p>",
        "id": 398534307,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1698255870
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/7352#discussion_r1372115320\">PR review comment</a>:</p>\n<blockquote>\n<p>Hmm, yeah, in principle I agree, but I couldn't find a way to make the pattern-matches see through these. Without the ability to pattern-match <code>Inst::Inst { src: GprMem(RegMem::Mem { ... }), .. }</code> vs. <code>Inst::Inst { src: GprMem(RegMem::Reg { ... }), .. }</code>, the code in <code>isa::x64::pcc</code> either becomes nightmarish or just impossible. I think we need to find a way to preserve that somehow...</p>\n</blockquote>",
        "id": 398534309,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1698255870
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/7352#pullrequestreview-1697930889\">PR review</a>.</p>",
        "id": 398534755,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1698256084
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/7352#discussion_r1372118865\">PR review comment</a>:</p>\n<blockquote>\n<p>The right long-term answer -- both typesafe and compatible with pattern-matching -- would be to directly have <code>enum GprMem { Gpr { ... }, Mem { ... } }</code>; that way the type still names the invariant, but we also can pattern-match on the interior. I don't want to couple that refactor to this work though, and unfortunately I don't see any trait impls that will let pattern-matching work otherwise; I would love to be wrong though if you know a way?</p>\n</blockquote>",
        "id": 398534762,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1698256084
    },
    {
        "content": "<p>fitzgen created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/7352#discussion_r1372126679\">PR review comment</a>:</p>\n<blockquote>\n<p>Instead of only matching when the <code>{Gpr,Xmm}Mem</code> wraps a <code>RegMem::Mem</code>, we can always match and then call <code>operand.as_ref()</code> or <code>operand.into()</code> to get the underlying <code>RegMem</code>, and finally pass that into a helper that early exits when given a <code>RegMem::Reg</code>. Essentially pushing the <code>::Reg</code> vs <code>::Mem</code> filtering down one layer.</p>\n</blockquote>",
        "id": 398535744,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1698256525
    },
    {
        "content": "<p>fitzgen submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/7352#pullrequestreview-1697942682\">PR review</a>.</p>",
        "id": 398535745,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1698256525
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/7352#pullrequestreview-1697953995\">PR review</a>.</p>",
        "id": 398536916,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1698256951
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/7352#discussion_r1372133931\">PR review comment</a>:</p>\n<blockquote>\n<p>Right, I get that this is a workaround, but I'm saying that the code becomes nightmarish: we really do need the ability to match on the Inst overall with specific kinds of operands...</p>\n</blockquote>",
        "id": 398536918,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1698256951
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/7352#discussion_r1372155633\">PR review comment</a>:</p>\n<blockquote>\n<p>(Spoke offline with fitzgen a bit; I'm going to try to refactor in this direction anyway and see how bad it really is. Long-term it would still be nice to get to separate enums to allow native deep sub-pattern-matching!)</p>\n</blockquote>",
        "id": 398539842,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1698258242
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/7352#pullrequestreview-1698000670\">PR review</a>.</p>",
        "id": 398539844,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1698258242
    },
    {
        "content": "<p>cfallin updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/7352\">PR #7352</a>.</p>",
        "id": 398585805,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1698284682
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/7352#pullrequestreview-1698593640\">PR review</a>.</p>",
        "id": 398585860,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1698284737
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/7352#discussion_r1372479870\">PR review comment</a>:</p>\n<blockquote>\n<p>Added one in the toplevel driver loop, thanks!</p>\n</blockquote>",
        "id": 398585861,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1698284737
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/7352#pullrequestreview-1698594070\">PR review</a>.</p>",
        "id": 398585921,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1698284778
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/7352#discussion_r1372480258\">PR review comment</a>:</p>\n<blockquote>\n<p>For now I'm going to keep this just for expediency / YAGNI but let's refactor as needed when we come to other sorts of fact propagation!</p>\n</blockquote>",
        "id": 398585923,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1698284778
    },
    {
        "content": "<p>cfallin updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/7352\">PR #7352</a>.</p>",
        "id": 398732601,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1698340325
    },
    {
        "content": "<p>fitzgen submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/7352#pullrequestreview-1700229350\">PR review</a>.</p>",
        "id": 398741464,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1698343814
    },
    {
        "content": "<p>fitzgen has enabled auto merge for <a href=\"https://github.com/bytecodealliance/wasmtime/pull/7352\">PR #7352</a>.</p>",
        "id": 398741501,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1698343828
    },
    {
        "content": "<p>fitzgen has disabled auto merge for <a href=\"https://github.com/bytecodealliance/wasmtime/pull/7352\">PR #7352</a>.</p>",
        "id": 398741570,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1698343850
    },
    {
        "content": "<p>cfallin updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/7352\">PR #7352</a>.</p>",
        "id": 398746943,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1698345798
    },
    {
        "content": "<p>cfallin has enabled auto merge for <a href=\"https://github.com/bytecodealliance/wasmtime/pull/7352\">PR #7352</a>.</p>",
        "id": 398752422,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1698347829
    },
    {
        "content": "<p>cfallin merged <a href=\"https://github.com/bytecodealliance/wasmtime/pull/7352\">PR #7352</a>.</p>",
        "id": 398759793,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1698351070
    }
]