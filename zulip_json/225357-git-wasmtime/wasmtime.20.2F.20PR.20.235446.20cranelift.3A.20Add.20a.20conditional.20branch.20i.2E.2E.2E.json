[
    {
        "content": "<p>elliottt opened <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446\">PR #5446</a> from <code>trevor/brif</code> to <code>main</code>:</p>\n<blockquote>\n<p>Add a conditional branch instruction with two targets: <code>brif</code>. This instruction<br>\nwill eventually replace <code>brz</code> and <code>brnz</code>, as it encompasses the behavior of<br>\nboth.<br>\n&lt;!--</p>\n<p>Please ensure that the following steps are all taken care of before submitting<br>\nthe PR.</p>\n<ul>\n<li>\n<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>\n  here.</p>\n</li>\n<li>\n<p>[ ] A short description of what this does, why it is needed; if the<br>\n  description becomes long, the matter should probably be discussed in an issue<br>\n  first.</p>\n</li>\n<li>\n<p>[ ] This PR contains test cases, if meaningful.</p>\n</li>\n<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>\n  If you don't know who could review this, please indicate so. The list of<br>\n  suggested reviewers on the right can help you.</li>\n</ul>\n<p>Please ensure all communication adheres to the <a href=\"https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md\">code of\nconduct</a>.<br>\n--&gt;<br>\n</p>\n</blockquote>",
        "id": 316084137,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671121861
    },
    {
        "content": "<p>elliottt edited <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446\">PR #5446</a> from <code>trevor/brif</code> to <code>main</code>:</p>\n<blockquote>\n<p>Add a conditional branch instruction with two targets: <code>brif</code>. This instruction will eventually replace <code>brz</code> and <code>brnz</code>, as it encompasses the behavior of both.<br>\n&lt;!--</p>\n<p>Please ensure that the following steps are all taken care of before submitting<br>\nthe PR.</p>\n<ul>\n<li>\n<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>\n  here.</p>\n</li>\n<li>\n<p>[ ] A short description of what this does, why it is needed; if the<br>\n  description becomes long, the matter should probably be discussed in an issue<br>\n  first.</p>\n</li>\n<li>\n<p>[ ] This PR contains test cases, if meaningful.</p>\n</li>\n<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>\n  If you don't know who could review this, please indicate so. The list of<br>\n  suggested reviewers on the right can help you.</li>\n</ul>\n<p>Please ensure all communication adheres to the <a href=\"https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md\">code of\nconduct</a>.<br>\n--&gt;<br>\n</p>\n</blockquote>",
        "id": 316085297,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671122167
    },
    {
        "content": "<p>elliottt updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446\">PR #5446</a> from <code>trevor/brif</code> to <code>main</code>.</p>",
        "id": 316086466,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671122434
    },
    {
        "content": "<p>bjorn3 submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446#pullrequestreview-1219649114\">PR review</a>.</p>",
        "id": 316094780,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671124595
    },
    {
        "content": "<p>bjorn3 created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446#discussion_r1049937631\">PR review comment</a>:</p>\n<blockquote>\n<p>This is a gross hack. <code>Block</code> and <code>Value</code> are two entirely distinct types. They should never be mixed.</p>\n</blockquote>",
        "id": 316094781,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671124595
    },
    {
        "content": "<p>bjorn3 submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446#pullrequestreview-1219652138\">PR review</a>.</p>",
        "id": 316095268,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671124720
    },
    {
        "content": "<p>bjorn3 created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446#discussion_r1049939934\">PR review comment</a>:</p>\n<blockquote>\n<p>Did you mean to commit this file?</p>\n</blockquote>",
        "id": 316095270,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671124720
    },
    {
        "content": "<p>bjorn3 submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446#pullrequestreview-1219655169\">PR review</a>.</p>",
        "id": 316095755,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671124850
    },
    {
        "content": "<p>bjorn3 created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446#discussion_r1049942060\">PR review comment</a>:</p>\n<blockquote>\n<p>Maybe you could have a <code>BlockOrValue</code> type just for <code>BlockWithArgs</code> and then ensure that this type never leaks out of the <code>BlockWithArgs</code>?</p>\n</blockquote>",
        "id": 316095757,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671124850
    },
    {
        "content": "<p>elliottt submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446#pullrequestreview-1219674123\">PR review</a>.</p>",
        "id": 316098913,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671125672
    },
    {
        "content": "<p>elliottt created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446#discussion_r1049955091\">PR review comment</a>:</p>\n<blockquote>\n<p>It was pulled in after rebasing over more recent work. Thanks for catching that.</p>\n</blockquote>",
        "id": 316098914,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671125672
    },
    {
        "content": "<p>elliottt updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446\">PR #5446</a> from <code>trevor/brif</code> to <code>main</code>.</p>",
        "id": 316099173,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671125737
    },
    {
        "content": "<p>jameysharp submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446#pullrequestreview-1219835179\">PR review</a>.</p>",
        "id": 316123960,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671133001
    },
    {
        "content": "<p>jameysharp created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446#discussion_r1050061328\">PR review comment</a>:</p>\n<blockquote>\n<p>I appreciate how quick you are to share your insights on Cranelift issues and PRs. Your comments are usually helpful and lead to making Cranelift better for everyone. In this case, though, this is not the most helpful comment.</p>\n<p>Before commenting on code where I'm not satisfied with its quality, I try to ask myself: Why did the author choose this way of expressing this idea? Maybe they know it's not ideal but they needed a placeholder while they're focusing on other parts of the problem. This case looks like a placeholder, given the empty \"TODO\" comments. Since this PR is still in \"draft\" status, placeholders are fine. They're only an issue if we merge something to main that'll cause us problems later.</p>\n<p>It's useful to open draft PRs to run CI against work-in-progress. They're also an opportunity to get early feedback, but preferably when the author has specifically requested it. Even then, that feedback should be focused on the high-level ideas, not the implementation details, which are likely to change as the patch matures. (I aspire to follow the \"Three-Phase Contribution Review\" model described in \"<a href=\"https://sage.thesharps.us/2014/09/01/the-gentle-art-of-patch-review/\">The Gentle Art of Patch Review</a>\".)</p>\n<p>So, while I agree with you that this PR probably shouldn't be merged in exactly this form, it's too early to critique this implementation detail with the degree of severity of your first reaction. Your <code>BlockOrValue</code> suggestion is a good one, but Trevor may have equally good alternatives in mind.</p>\n<p>It's good to suggest better alternatives, and even good to note concerns. For example, you could say, \"We'll have to carefully audit anywhere that the <code>Block</code> and <code>Value</code> types are allowed to mix, and in the final version of this PR I'd prefer to avoid that.\" Just keep in mind that the patch's author may already know that, especially for draft PRs, and that they may even have good reasons for it.</p>\n</blockquote>",
        "id": 316123961,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671133001
    },
    {
        "content": "<p>bjorn3 submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446#pullrequestreview-1219904377\">PR review</a>.</p>",
        "id": 316133991,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671136235
    },
    {
        "content": "<p>bjorn3 created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446#discussion_r1050107939\">PR review comment</a>:</p>\n<blockquote>\n<p>I agree I could have reacted much better. I will keep this in mind for the future.</p>\n</blockquote>",
        "id": 316133992,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671136235
    },
    {
        "content": "<p>elliottt updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446\">PR #5446</a> from <code>trevor/brif</code> to <code>main</code>.</p>",
        "id": 316153124,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671143009
    },
    {
        "content": "<p>elliottt updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446\">PR #5446</a> from <code>trevor/brif</code> to <code>main</code>.</p>",
        "id": 316168576,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671150611
    },
    {
        "content": "<p>elliottt updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446\">PR #5446</a> from <code>trevor/brif</code> to <code>main</code>.</p>",
        "id": 316169321,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671151082
    },
    {
        "content": "<p>elliottt updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446\">PR #5446</a> from <code>trevor/brif</code> to <code>main</code>.</p>",
        "id": 316173372,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671153729
    },
    {
        "content": "<p>jameysharp submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446#pullrequestreview-1220152336\">PR review</a>.</p>",
        "id": 316173898,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671154139
    },
    {
        "content": "<p>jameysharp created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446#discussion_r1050279692\">PR review comment</a>:</p>\n<blockquote>\n<p>\"bloks\" -&gt; \"blocks\"</p>\n</blockquote>",
        "id": 316173899,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671154139
    },
    {
        "content": "<p>jameysharp created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446#discussion_r1050281821\">PR review comment</a>:</p>\n<blockquote>\n<p>I've noticed rust-analyzer doesn't do quite what I want with imports like this. I'd want <code>BlockWithArgs</code> to go into the list of imports on line 68, and leave <code>use crate::ir;</code> as a separate item, but several times I've seen it do this kind of rewrite instead.</p>\n</blockquote>",
        "id": 316173900,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671154139
    },
    {
        "content": "<p>jameysharp created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446#discussion_r1050286507\">PR review comment</a>:</p>\n<blockquote>\n<p>I haven't looked at how this lexer works. Does this correctly handle missing whitespace? Like, if someone wrote <code>brif v0 thenblock1 elseblock2</code>, would it reject that or would it strip off the \"then\"/\"else\" prefix and then see that it has a valid block name?</p>\n</blockquote>",
        "id": 316173902,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671154139
    },
    {
        "content": "<p>jameysharp created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446#discussion_r1050284794\">PR review comment</a>:</p>\n<blockquote>\n<p>I think this is the first place that <code>typecheck_variable_args_iterator</code> is called twice with the same instruction. Since it compares the given iterator against <code>inst_variable_args(inst)</code>, I wouldn't think that would be the right thing to do. Is it?</p>\n</blockquote>",
        "id": 316173903,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671154139
    },
    {
        "content": "<p>jameysharp created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446#discussion_r1050279460\">PR review comment</a>:</p>\n<blockquote>\n<p>I see this was copy-pasted from the comment above because they all have the same typo. <span aria-label=\"laughing\" class=\"emoji emoji-1f606\" role=\"img\" title=\"laughing\">:laughing:</span> \"primarliy\" -&gt; \"primarily\"</p>\n</blockquote>",
        "id": 316173904,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671154139
    },
    {
        "content": "<p>jameysharp submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446#pullrequestreview-1220152336\">PR review</a>.</p>",
        "id": 316173905,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671154139
    },
    {
        "content": "<p>elliottt created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446#discussion_r1050289507\">PR review comment</a>:</p>\n<blockquote>\n<p>What about adding a <code>self</code> import on line 67 and removing line 66?</p>\n</blockquote>",
        "id": 316174306,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671154426
    },
    {
        "content": "<p>elliottt submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446#pullrequestreview-1220165910\">PR review</a>.</p>",
        "id": 316174307,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671154426
    },
    {
        "content": "<p>elliottt edited <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446#discussion_r1050289507\">PR review comment</a>.</p>",
        "id": 316174366,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671154447
    },
    {
        "content": "<p>jameysharp submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446#pullrequestreview-1220167227\">PR review</a>.</p>",
        "id": 316174547,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671154580
    },
    {
        "content": "<p>jameysharp created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446#discussion_r1050290457\">PR review comment</a>:</p>\n<blockquote>\n<p>This description of the <code>BlockWithArgs</code> invariants is exactly what I wanted to see. Perhaps most of it should be merged into the doc comment for the <code>BlockWithArgs::values</code> field above, though?</p>\n</blockquote>",
        "id": 316174548,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671154580
    },
    {
        "content": "<p>elliottt submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446#pullrequestreview-1220170012\">PR review</a>.</p>",
        "id": 316174834,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671154805
    },
    {
        "content": "<p>elliottt created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446#discussion_r1050291884\">PR review comment</a>:</p>\n<blockquote>\n<p>It shouldn't be called at all, thanks for catching this! This was a hold-over from when the block args were held in the same ValueList.</p>\n</blockquote>",
        "id": 316174835,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671154805
    },
    {
        "content": "<p>elliottt submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446#pullrequestreview-1220171163\">PR review</a>.</p>",
        "id": 316174883,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671154838
    },
    {
        "content": "<p>elliottt created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446#discussion_r1050292110\">PR review comment</a>:</p>\n<blockquote>\n<p>Happy to move it!</p>\n</blockquote>",
        "id": 316174884,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671154838
    },
    {
        "content": "<p>jameysharp submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446#pullrequestreview-1220173685\">PR review</a>.</p>",
        "id": 316175025,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671154945
    },
    {
        "content": "<p>jameysharp created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446#discussion_r1050293082\">PR review comment</a>:</p>\n<blockquote>\n<p>I don't feel strongly either way about using <code>self</code> imports. I just don't like having two import items with different parts of the import list like this.</p>\n<p>I'd actually be tempted to quit importing anything except <code>ir</code> and <code>ir::types</code>, and qualify every reference to names in the <code>ir</code> module, given how short the module name is. But that's not something to do in this PR; it has enough else going on already.</p>\n</blockquote>",
        "id": 316175026,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671154945
    },
    {
        "content": "<p>elliottt submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446#pullrequestreview-1220178137\">PR review</a>.</p>",
        "id": 316175653,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671155484
    },
    {
        "content": "<p>elliottt created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446#discussion_r1050298788\">PR review comment</a>:</p>\n<blockquote>\n<p>Scratch that, it should be called from here: how else would we typecheck the branches of <code>brif</code> :)</p>\n<p>I think the issue here is that it's assumed that the args always come from the instruction. I'll rework this to take the args as a separate argument, so that it's possible to check the args for a specific block.</p>\n</blockquote>",
        "id": 316175654,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671155484
    },
    {
        "content": "<p>elliottt updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446\">PR #5446</a> from <code>trevor/brif</code> to <code>main</code>.</p>",
        "id": 316176037,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671155857
    },
    {
        "content": "<p>jameysharp submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446#pullrequestreview-1220184023\">PR review</a>.</p>",
        "id": 316176482,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671156147
    },
    {
        "content": "<p>jameysharp created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446#discussion_r1050303369\">PR review comment</a>:</p>\n<blockquote>\n<p>Like with the <code>Conditional</code> case below, you can get the args from <code>SingleDest</code>'s second field, can't you?</p>\n<p>I think the same is true of both <code>CallInfo</code> cases, for that matter.</p>\n</blockquote>",
        "id": 316176483,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671156147
    },
    {
        "content": "<p>jameysharp submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446#pullrequestreview-1220184023\">PR review</a>.</p>",
        "id": 316176484,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671156147
    },
    {
        "content": "<p>elliottt updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446\">PR #5446</a> from <code>trevor/brif</code> to <code>main</code>.</p>",
        "id": 316176947,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671156529
    },
    {
        "content": "<p>elliottt updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446\">PR #5446</a> from <code>trevor/brif</code> to <code>main</code>.</p>",
        "id": 316177076,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671156640
    },
    {
        "content": "<p>elliottt submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446#pullrequestreview-1220190219\">PR review</a>.</p>",
        "id": 316177122,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671156686
    },
    {
        "content": "<p>elliottt created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446#discussion_r1050307734\">PR review comment</a>:</p>\n<blockquote>\n<p>Oh nice catch!</p>\n</blockquote>",
        "id": 316177123,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671156686
    },
    {
        "content": "<p>elliottt updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446\">PR #5446</a> from <code>trevor/brif</code> to <code>main</code>.</p>",
        "id": 316177246,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671156771
    },
    {
        "content": "<p>elliottt created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446#discussion_r1050308839\">PR review comment</a>:</p>\n<blockquote>\n<p>You're right, it would parse <code>thenblock0</code>. I've opted to remove those keywords for now, separating the control argument and blocks with commas instead:</p>\n<p><div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">brif</span><span class=\"w\"> </span><span class=\"n\">v1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">block1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">block2</span><span class=\"w\"></span>\n</code></pre></div><br>\n</p>\n</blockquote>",
        "id": 316177370,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671156868
    },
    {
        "content": "<p>elliottt submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446#pullrequestreview-1220191722\">PR review</a>.</p>",
        "id": 316177371,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671156868
    },
    {
        "content": "<p>elliottt edited <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446\">PR #5446</a> from <code>trevor/brif</code> to <code>main</code>:</p>\n<blockquote>\n<p>Add a conditional branch instruction with two targets: <code>brif</code>. This instruction will eventually replace <code>brz</code> and <code>brnz</code>, as it encompasses the behavior of both.</p>\n<p>This PR is currently rebased on top of #5450.<br>\n&lt;!--</p>\n<p>Please ensure that the following steps are all taken care of before submitting<br>\nthe PR.</p>\n<ul>\n<li>\n<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>\n  here.</p>\n</li>\n<li>\n<p>[ ] A short description of what this does, why it is needed; if the<br>\n  description becomes long, the matter should probably be discussed in an issue<br>\n  first.</p>\n</li>\n<li>\n<p>[ ] This PR contains test cases, if meaningful.</p>\n</li>\n<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>\n  If you don't know who could review this, please indicate so. The list of<br>\n  suggested reviewers on the right can help you.</li>\n</ul>\n<p>Please ensure all communication adheres to the <a href=\"https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md\">code of\nconduct</a>.<br>\n--&gt;<br>\n</p>\n</blockquote>",
        "id": 316177548,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671157048
    },
    {
        "content": "<p>elliottt updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446\">PR #5446</a> from <code>trevor/brif</code> to <code>main</code>.</p>",
        "id": 316187705,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671166059
    },
    {
        "content": "<p>elliottt updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446\">PR #5446</a> from <code>trevor/brif</code> to <code>main</code>.</p>",
        "id": 316337096,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671216405
    },
    {
        "content": "<p>elliottt edited <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446\">PR #5446</a> from <code>trevor/brif</code> to <code>main</code>:</p>\n<blockquote>\n<p>Add a conditional branch instruction with two targets: <code>brif</code>. This instruction will eventually replace <code>brz</code> and <code>brnz</code>, as it encompasses the behavior of both.<br>\n&lt;!--</p>\n<p>Please ensure that the following steps are all taken care of before submitting<br>\nthe PR.</p>\n<ul>\n<li>\n<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>\n  here.</p>\n</li>\n<li>\n<p>[ ] A short description of what this does, why it is needed; if the<br>\n  description becomes long, the matter should probably be discussed in an issue<br>\n  first.</p>\n</li>\n<li>\n<p>[ ] This PR contains test cases, if meaningful.</p>\n</li>\n<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>\n  If you don't know who could review this, please indicate so. The list of<br>\n  suggested reviewers on the right can help you.</li>\n</ul>\n<p>Please ensure all communication adheres to the <a href=\"https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md\">code of\nconduct</a>.<br>\n--&gt;<br>\n</p>\n</blockquote>",
        "id": 316337141,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671216418
    },
    {
        "content": "<p>elliottt updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446\">PR #5446</a> from <code>trevor/brif</code> to <code>main</code>.</p>",
        "id": 316348061,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671220298
    },
    {
        "content": "<p>elliottt updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446\">PR #5446</a> from <code>trevor/brif</code> to <code>main</code>.</p>",
        "id": 316355622,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671223142
    },
    {
        "content": "<p>elliottt updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446\">PR #5446</a> from <code>trevor/brif</code> to <code>main</code>.</p>",
        "id": 316370839,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671229125
    },
    {
        "content": "<p>elliottt updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446\">PR #5446</a> from <code>trevor/brif</code> to <code>main</code>.</p>",
        "id": 316384380,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671236568
    },
    {
        "content": "<p>elliottt updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446\">PR #5446</a> from <code>trevor/brif</code> to <code>main</code>.</p>",
        "id": 321953660,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1674001958
    },
    {
        "content": "<p>bjorn3 submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446#pullrequestreview-1253527480\">PR review</a>.</p>",
        "id": 322057619,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1674050094
    },
    {
        "content": "<p>bjorn3 created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446#discussion_r1073565699\">PR review comment</a>:</p>\n<blockquote>\n<p><code>branch_destination</code> below will need to be updated too I think to return <code>None</code> for <code>Brif</code>.</p>\n</blockquote>",
        "id": 322057621,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1674050095
    },
    {
        "content": "<p>bjorn3 edited <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446#discussion_r1073565699\">PR review comment</a>.</p>",
        "id": 322057716,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1674050122
    },
    {
        "content": "<p>bjorn3 submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446#pullrequestreview-1253548497\">PR review</a>.</p>",
        "id": 322060491,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1674050806
    },
    {
        "content": "<p>bjorn3 created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446#discussion_r1073579517\">PR review comment</a>:</p>\n<blockquote>\n<p>I think it does so in the order returned by <code>visit_branch_targets</code> which you implemented as <code>then_block</code> and then <code>else_block</code>, but the code to compute this doesn't seem to be made to preserve this order, but rather preserved it by accident. See <a href=\"https://github.com/bytecodealliance/wasmtime/blob/94b51cdb179d08dbedd2934a3dc11e2c5aef481a/cranelift/codegen/src/machinst/blockorder.rs\">https://github.com/bytecodealliance/wasmtime/blob/94b51cdb179d08dbedd2934a3dc11e2c5aef481a/cranelift/codegen/src/machinst/blockorder.rs</a></p>\n</blockquote>",
        "id": 322060496,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1674050806
    },
    {
        "content": "<p>bjorn3 edited <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446#discussion_r1073579517\">PR review comment</a>.</p>",
        "id": 322060773,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1674050877
    },
    {
        "content": "<p>elliottt submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446#pullrequestreview-1253845628\">PR review</a>.</p>",
        "id": 322096263,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1674059356
    },
    {
        "content": "<p>elliottt created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446#discussion_r1073768985\">PR review comment</a>:</p>\n<blockquote>\n<p>Yep, I have a load of local changes that rework <code>branch_destination</code> to be generated the way that <code>arguments</code> is currently, so that we can use the same trick to view multiple <code>BlockCall</code> values as a slice.</p>\n</blockquote>",
        "id": 322096264,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1674059356
    },
    {
        "content": "<p>elliottt updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446\">PR #5446</a> from <code>trevor/brif</code> to <code>main</code>.</p>",
        "id": 322110632,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1674062939
    },
    {
        "content": "<p>elliottt updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446\">PR #5446</a> from <code>trevor/brif</code> to <code>main</code>.</p>",
        "id": 322122211,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1674066199
    },
    {
        "content": "<p>elliottt updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446\">PR #5446</a> from <code>trevor/brif</code> to <code>main</code>.</p>",
        "id": 322123025,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1674066450
    },
    {
        "content": "<p>elliottt updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446\">PR #5446</a> from <code>trevor/brif</code> to <code>main</code>.</p>",
        "id": 322134565,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1674069806
    },
    {
        "content": "<p>elliottt updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446\">PR #5446</a> from <code>trevor/brif</code> to <code>main</code>.</p>",
        "id": 322141321,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1674072093
    },
    {
        "content": "<p>elliottt updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446\">PR #5446</a> from <code>trevor/brif</code> to <code>main</code>.</p>",
        "id": 322142468,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1674072467
    },
    {
        "content": "<p>elliottt updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446\">PR #5446</a> from <code>trevor/brif</code> to <code>main</code>.</p>",
        "id": 322174814,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1674085199
    },
    {
        "content": "<p>elliottt updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446\">PR #5446</a> from <code>trevor/brif</code> to <code>main</code>.</p>",
        "id": 322183404,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1674090335
    },
    {
        "content": "<p>elliottt updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446\">PR #5446</a> from <code>trevor/brif</code> to <code>main</code>.</p>",
        "id": 322184589,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1674091093
    },
    {
        "content": "<p>elliottt updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446\">PR #5446</a> from <code>trevor/brif</code> to <code>main</code>.</p>",
        "id": 322627368,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1674253371
    },
    {
        "content": "<p>elliottt updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446\">PR #5446</a> from <code>trevor/brif</code> to <code>main</code>.</p>",
        "id": 322628488,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1674253797
    },
    {
        "content": "<p>elliottt updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446\">PR #5446</a> from <code>trevor/brif</code> to <code>main</code>.</p>",
        "id": 322631595,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1674254945
    },
    {
        "content": "<p>elliottt updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446\">PR #5446</a> from <code>trevor/brif</code> to <code>main</code>.</p>",
        "id": 322641030,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1674260101
    },
    {
        "content": "<p>elliottt updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446\">PR #5446</a> from <code>trevor/brif</code> to <code>main</code>.</p>",
        "id": 322782397,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1674337984
    },
    {
        "content": "<p>elliottt updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446\">PR #5446</a> from <code>trevor/brif</code> to <code>main</code>.</p>",
        "id": 322783224,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1674338586
    },
    {
        "content": "<p>elliottt edited <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446\">PR #5446</a> from <code>trevor/brif</code> to <code>main</code>:</p>\n<blockquote>\n<p>Add a conditional branch instruction with two targets: <code>brif</code>. This instruction will eventually replace <code>brz</code> and <code>brnz</code>, as it encompasses the behavior of both.</p>\n<p>This PR also changes the <code>InstructionData</code> layout for instruction formats that hold <code>BlockCall</code> values, taking the same approach we use for <code>Value</code>  arguments. This allows <code>branch_destination</code> to return a slice to the <code>BlockCall</code> values held in the instruction, rather than requiring that we pattern match on <code>InstructionData</code> to fetch the then/else blocks.</p>\n<p>Function generation for fuzzing has been updated to generate uses of <code>brif</code>, and I've run the <code>cranelift-fuzzgen</code> target locally for hours without triggering any new failures.<br>\n&lt;!--</p>\n<p>Please ensure that the following steps are all taken care of before submitting<br>\nthe PR.</p>\n<ul>\n<li>\n<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>\n  here.</p>\n</li>\n<li>\n<p>[ ] A short description of what this does, why it is needed; if the<br>\n  description becomes long, the matter should probably be discussed in an issue<br>\n  first.</p>\n</li>\n<li>\n<p>[ ] This PR contains test cases, if meaningful.</p>\n</li>\n<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>\n  If you don't know who could review this, please indicate so. The list of<br>\n  suggested reviewers on the right can help you.</li>\n</ul>\n<p>Please ensure all communication adheres to the <a href=\"https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md\">code of\nconduct</a>.<br>\n--&gt;<br>\n</p>\n</blockquote>",
        "id": 322783868,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1674339123
    },
    {
        "content": "<p><strong>elliottt</strong> has marked <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446\">PR #5446</a> as ready for review.</p>",
        "id": 322783900,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1674339136
    },
    {
        "content": "<p><strong>elliottt</strong> requested <a href=\"https://github.com/jameysharp\">jameysharp</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446\">PR #5446</a>.</p>",
        "id": 322783913,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1674339147
    },
    {
        "content": "<p><strong>elliottt</strong> requested <a href=\"https://github.com/cfallin\">cfallin</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446\">PR #5446</a>.</p>",
        "id": 322783921,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1674339154
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446#pullrequestreview-1266349598\">PR review</a>.</p>",
        "id": 323119864,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1674508689
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446#pullrequestreview-1266349598\">PR review</a>.</p>",
        "id": 323119865,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1674508690
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446#discussion_r1084562626\">PR review comment</a>:</p>\n<blockquote>\n<p>Will this always be enough? I don't remember if we have any explicitly-enforced implementation limits on <code>br_table</code> successor count, but we should verify this (and leave a comment here, and possibly enforce in the validator) if we stick with a <code>u8</code>.</p>\n</blockquote>",
        "id": 323119866,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1674508690
    },
    {
        "content": "<p>bjorn3 submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446#pullrequestreview-1266360338\">PR review</a>.</p>",
        "id": 323120769,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1674509102
    },
    {
        "content": "<p>bjorn3 created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446#discussion_r1084573687\">PR review comment</a>:</p>\n<blockquote>\n<p><code>cranelift_frontend::Switch</code> assumes that everything that fits in 32bits works. It is definitively realistic to have more than 256 entires in a <code>br_table</code> for rust code.</p>\n</blockquote>",
        "id": 323120773,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1674509102
    },
    {
        "content": "<p>elliottt submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446#pullrequestreview-1266612780\">PR review</a>.</p>",
        "id": 323140391,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1674518386
    },
    {
        "content": "<p>elliottt created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446#discussion_r1084691641\">PR review comment</a>:</p>\n<blockquote>\n<p>Good call, I'll bump this to <code>u32</code>.</p>\n</blockquote>",
        "id": 323140392,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1674518386
    },
    {
        "content": "<p>elliottt updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446\">PR #5446</a> from <code>trevor/brif</code> to <code>main</code>.</p>",
        "id": 323141354,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1674518891
    },
    {
        "content": "<p>fitzgen submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446#pullrequestreview-1266616855\">PR review</a>.</p>",
        "id": 323141453,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1674518952
    },
    {
        "content": "<p>fitzgen submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446#pullrequestreview-1266616855\">PR review</a>.</p>",
        "id": 323141454,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1674518952
    },
    {
        "content": "<p>fitzgen created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446#discussion_r1084694958\">PR review comment</a>:</p>\n<blockquote>\n<p>Comment missing.</p>\n</blockquote>",
        "id": 323141455,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1674518953
    },
    {
        "content": "<p>fitzgen created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446#discussion_r1084696572\">PR review comment</a>:</p>\n<blockquote>\n<p>I'm not seeing any test here where the <code>then_block</code> and <code>else_block</code> have different numbers of block arguments. That could be good to exercise if it isn't done elsewhere.</p>\n</blockquote>",
        "id": 323141456,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1674518953
    },
    {
        "content": "<p>elliottt updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446\">PR #5446</a> from <code>trevor/brif</code> to <code>main</code>.</p>",
        "id": 323148344,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1674522771
    },
    {
        "content": "<p>elliottt updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446\">PR #5446</a> from <code>trevor/brif</code> to <code>main</code>.</p>",
        "id": 323148840,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1674523129
    },
    {
        "content": "<p>elliottt merged <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5446\">PR #5446</a>.</p>",
        "id": 323367387,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1674599838
    }
]