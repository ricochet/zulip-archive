[
    {
        "content": "<p>unicornt edited <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7246\">issue #7246</a>:</p>\n<blockquote>\n<h3>Test Case</h3>\n<p><a href=\"https://github.com/bytecodealliance/wasmtime/files/12912094/report.zip\">report.zip</a></p>\n<h3>Steps to Reproduce</h3>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">time</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">case</span><span class=\"p\">.</span><span class=\"n\">wasm</span>\n</code></pre></div>\n<h3>Actual Results</h3>\n<p><code>Wasmtime</code> takes an abnormal long time to execute this wasm file and <strong>no</strong> exception is thrown.</p>\n<h3>Expected Results</h3>\n<p>Other runtime use much less time or report an <code>out of memory access</code> exception</p>\n<p>&lt;img width=\"1230\" alt=\"image\" src=\"<a href=\"https://github.com/bytecodealliance/wasmtime/assets/18662046/626efd7d-16aa-49d7-ae8d-4e66c5f857ce\">https://github.com/bytecodealliance/wasmtime/assets/18662046/626efd7d-16aa-49d7-ae8d-4e66c5f857ce</a>\"&gt;</p>\n<h3>Versions and Environment</h3>\n<p>Wasmtime version or commit: 15.0.0</p>\n<p>Operating system: Ubuntu 20.04</p>\n<p>Architecture: x86_64<br>\n</p>\n</blockquote>",
        "id": 396823204,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1697432390
    },
    {
        "content": "<p>afonso360 <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7246#issuecomment-1764147864\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7246\">issue #7246</a>:</p>\n<blockquote>\n<p>It looks like wasmtime wasn't compiled in release mode, would you be able to retest using the <code>--release</code> flag when compiling wasmtime?</p>\n</blockquote>",
        "id": 396867196,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1697450967
    },
    {
        "content": "<p>afonso360 edited a <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7246#issuecomment-1764147864\">comment</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7246\">issue #7246</a>:</p>\n<blockquote>\n<p>It looks like wasmtime wasn't compiled in release mode, would you be able to re-test using the <code>--release</code> flag when compiling wasmtime?</p>\n</blockquote>",
        "id": 396867217,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1697450974
    },
    {
        "content": "<p>unicornt <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7246#issuecomment-1764443374\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7246\">issue #7246</a>:</p>\n<blockquote>\n<blockquote>\n<p>It looks like wasmtime wasn't compiled in release mode, would you be able to re-test using the <code>--release</code> flag when compiling wasmtime?</p>\n</blockquote>\n<p>Thank you for the reply! I tried to build wasmtime with <code>--release</code> flag, but it turned out to be <strong>useless</strong>.</p>\n<p>&lt;img width=\"1199\" alt=\"image\" src=\"<a href=\"https://github.com/bytecodealliance/wasmtime/assets/18662046/c4e02349-3151-4ca7-9f53-0d165c875c46\">https://github.com/bytecodealliance/wasmtime/assets/18662046/c4e02349-3151-4ca7-9f53-0d165c875c46</a>\"&gt;</p>\n</blockquote>",
        "id": 396898169,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1697461450
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7246#issuecomment-1764599467\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7246\">issue #7246</a>:</p>\n<blockquote>\n<p>Would you be able to help diagnose what's happening locally? I'm unable to reproduce this and the runtime for this module isn't too bad locally. If you could run</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">perf</span><span class=\"w\"> </span><span class=\"n\">record</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"n\">mono</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">profile</span><span class=\"w\"> </span><span class=\"n\">jitdump</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">case</span><span class=\"o\">=</span><span class=\"n\">no</span><span class=\"w\"> </span><span class=\"n\">case</span><span class=\"p\">.</span><span class=\"n\">wasm</span>\n<span class=\"n\">perf</span><span class=\"w\"> </span><span class=\"n\">inject</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">jit</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">input</span><span class=\"w\"> </span><span class=\"n\">perf</span><span class=\"p\">.</span><span class=\"n\">data</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">output</span><span class=\"w\"> </span><span class=\"n\">perf</span><span class=\"p\">.</span><span class=\"n\">jit</span><span class=\"p\">.</span><span class=\"n\">data</span>\n<span class=\"n\">perf</span><span class=\"w\"> </span><span class=\"n\">report</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">input</span><span class=\"w\"> </span><span class=\"n\">perf</span><span class=\"p\">.</span><span class=\"n\">jit</span><span class=\"p\">.</span><span class=\"n\">data</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">no</span><span class=\"o\">-</span><span class=\"n\">children</span>\n</code></pre></div>\n<p>and then copy/paste the top 10-20 functions into this issue that'll help explain where all the time is going.</p>\n<p>One thing I've noticed is that this module is trying to write to file descriptor 0 inside the wasm itself. Wasmtime is returning <code>EBADF</code> because of that (0 is stdin, not stdout). Other runtimes likely aren't performing such a check in their WASI implementations. This provides a point of divergence between runtimes which may explain why runtimes are behaving differently.</p>\n<p>Nevertheless though I'm not sure what's taking 20+ seconds for you in Wasmtime. Locally this module executes in 1-3 seconds for me. I unfortunately don't have access to native x86_64 hardware though and so this could be specific to that.</p>\n</blockquote>",
        "id": 396915295,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1697466362
    },
    {
        "content": "<p>afonso360 <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7246#issuecomment-1764630584\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7246\">issue #7246</a>:</p>\n<blockquote>\n<blockquote>\n<p>Nevertheless though I'm not sure what's taking 20+ seconds for you in Wasmtime. Locally this module executes in 1-3 seconds for me. I unfortunately don't have access to native x86_64 hardware though and so this could be specific to that.</p>\n</blockquote>\n<p>I'm also unable to reproduce this on x86, it takes ~3 seconds for me. With 98.86% of the time being spent on <code>wasm[0]::function[3]</code>.</p>\n</blockquote>",
        "id": 396918539,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1697467256
    },
    {
        "content": "<p>unicornt <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7246#issuecomment-1765714850\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7246\">issue #7246</a>:</p>\n<blockquote>\n<blockquote>\n<blockquote>\n<p>Nevertheless though I'm not sure what's taking 20+ seconds for you in Wasmtime. Locally this module executes in 1-3 seconds for me. I unfortunately don't have access to native x86_64 hardware though and so this could be specific to that.</p>\n</blockquote>\n<p>I'm also unable to reproduce this on x86, it takes ~3 seconds for me. With 98.86% of the time being spent on <code>wasm[0]::function[3]</code>.</p>\n</blockquote>\n<p>I got similar output that 99.7% of the time is spent on function[3]. However, the total time is still 20+ seconds.</p>\n<p>&lt;img width=\"1389\" alt=\"image\" src=\"<a href=\"https://github.com/bytecodealliance/wasmtime/assets/18662046/6bff0da0-a3ef-4d78-aa51-5d889a141491\">https://github.com/bytecodealliance/wasmtime/assets/18662046/6bff0da0-a3ef-4d78-aa51-5d889a141491</a>\"&gt;</p>\n<p>Here is <code>perf stat</code> output of wasmtime and wasmedge(AOT mod). Hope it can help to find out why it happened!</p>\n<p>&lt;img width=\"1224\" alt=\"image\" src=\"<a href=\"https://github.com/bytecodealliance/wasmtime/assets/18662046/b639c272-7297-4d8d-b8ca-f6eea6ccda9c\">https://github.com/bytecodealliance/wasmtime/assets/18662046/b639c272-7297-4d8d-b8ca-f6eea6ccda9c</a>\"&gt;</p>\n</blockquote>",
        "id": 397033085,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1697521980
    },
    {
        "content": "<p>bjorn3 <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7246#issuecomment-1765779128\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7246\">issue #7246</a>:</p>\n<blockquote>\n<p>An IPC of 0.08 is abnornally low. Could you show the annotated assembly of <code>wasm[0]::function[3]</code> as reported by <code>perf report</code>?</p>\n</blockquote>",
        "id": 397040185,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1697525576
    },
    {
        "content": "<p>unicornt <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7246#issuecomment-1765810346\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7246\">issue #7246</a>:</p>\n<blockquote>\n<blockquote>\n<p>An IPC of 0.08 is abnornally low. Could you show the annotated assembly of <code>wasm[0]::function[3]</code> as reported by <code>perf report</code>?</p>\n</blockquote>\n<p>Is this what you want? Sorry I'm not familiar with <code>perf</code> tools.</p>\n<p>&lt;img width=\"1407\" alt=\"image\" src=\"<a href=\"https://github.com/bytecodealliance/wasmtime/assets/18662046/ff6e3c6e-a0da-4fe7-8068-f48d9a67d8ea\">https://github.com/bytecodealliance/wasmtime/assets/18662046/ff6e3c6e-a0da-4fe7-8068-f48d9a67d8ea</a>\"&gt;</p>\n</blockquote>",
        "id": 397043955,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1697527028
    },
    {
        "content": "<p>bjorn3 <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7246#issuecomment-1765914836\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7246\">issue #7246</a>:</p>\n<blockquote>\n<p>Yes. The amount of time spent in what should be trivial instructions (mov between registers and xor) is weird.</p>\n</blockquote>",
        "id": 397054940,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1697530986
    },
    {
        "content": "<p>unicornt <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7246#issuecomment-1766460432\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7246\">issue #7246</a>:</p>\n<blockquote>\n<blockquote>\n<p>Yes. The amount of time spent in what should be trivial instructions (mov between registers and xor) is weird.</p>\n</blockquote>\n<p>Do you have any idea about why it happened? Anything I can do to figure it out?</p>\n</blockquote>",
        "id": 397113183,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1697550560
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7246#issuecomment-1766536373\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7246\">issue #7246</a>:</p>\n<blockquote>\n<p>Could you share the output of <code>lscpu</code>? This might be specific to your particular CPU and some edge case related to cache sizes or something like that perhaps.</p>\n</blockquote>",
        "id": 397121403,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1697552912
    },
    {
        "content": "<p>unicornt <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7246#issuecomment-1766575759\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7246\">issue #7246</a>:</p>\n<blockquote>\n<p>Here is my output of <code>lspcpu</code></p>\n<p><div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"err\">âžœ</span><span class=\"w\">  </span><span class=\"o\">~</span><span class=\"w\"> </span><span class=\"n\">lscpu</span>\n<span class=\"n\">Architecture</span>:                       <span class=\"nc\">x86_64</span>\n<span class=\"n\">CPU</span><span class=\"w\"> </span><span class=\"n\">op</span><span class=\"o\">-</span><span class=\"n\">mode</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">)</span>:                     <span class=\"mi\">32</span><span class=\"o\">-</span><span class=\"n\">bit</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">64</span><span class=\"o\">-</span><span class=\"n\">bit</span>\n<span class=\"n\">Byte</span><span class=\"w\"> </span><span class=\"n\">Order</span>:                         <span class=\"nc\">Little</span><span class=\"w\"> </span><span class=\"n\">Endian</span>\n<span class=\"n\">Address</span><span class=\"w\"> </span><span class=\"n\">sizes</span>:                      <span class=\"mi\">39</span><span class=\"w\"> </span><span class=\"n\">bits</span><span class=\"w\"> </span><span class=\"n\">physical</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">48</span><span class=\"w\"> </span><span class=\"n\">bits</span><span class=\"w\"> </span><span class=\"kr\">virtual</span>\n<span class=\"n\">CPU</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">)</span>:                             <span class=\"mi\">16</span>\n<span class=\"n\">On</span><span class=\"o\">-</span><span class=\"n\">line</span><span class=\"w\"> </span><span class=\"n\">CPU</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">list</span>:                <span class=\"mi\">0</span><span class=\"o\">-</span><span class=\"mi\">15</span>\n<span class=\"n\">Thread</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">per</span><span class=\"w\"> </span><span class=\"n\">core</span>:                 <span class=\"mi\">2</span>\n<span class=\"n\">Core</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">per</span><span class=\"w\"> </span><span class=\"n\">socket</span>:                 <span class=\"mi\">8</span>\n<span class=\"n\">Socket</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">)</span>:                          <span class=\"mi\">1</span>\n<span class=\"n\">NUMA</span><span class=\"w\"> </span><span class=\"n\">node</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">)</span>:                       <span class=\"mi\">1</span>\n<span class=\"n\">Vendor</span><span class=\"w\"> </span><span class=\"n\">ID</span>:                          <span class=\"nc\">GenuineIntel</span>\n<span class=\"n\">CPU</span><span class=\"w\"> </span><span class=\"n\">family</span>:                         <span class=\"mi\">6</span>\n<span class=\"n\">Model</span>:                              <span class=\"mi\">165</span>\n<span class=\"n\">Model</span><span class=\"w\"> </span><span class=\"n\">name</span>:                         <span class=\"nc\">Intel</span><span class=\"p\">(</span><span class=\"n\">R</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">Core</span><span class=\"p\">(</span><span class=\"n\">TM</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">i7</span><span class=\"o\">-</span><span class=\"mi\">10700</span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"n\">CPU</span><span class=\"w\"> </span><span class=\"o\">@</span><span class=\"w\"> </span><span class=\"mf\">2.90</span><span class=\"n\">GHz</span>\n<span class=\"n\">Stepping</span>:                           <span class=\"mi\">5</span>\n<span class=\"n\">CPU</span><span class=\"w\"> </span><span class=\"n\">MHz</span>:                            <span class=\"mf\">2900.000</span>\n<span class=\"n\">CPU</span><span class=\"w\"> </span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"n\">MHz</span>:                        <span class=\"mf\">4800.0000</span>\n<span class=\"n\">CPU</span><span class=\"w\"> </span><span class=\"n\">min</span><span class=\"w\"> </span><span class=\"n\">MHz</span>:                        <span class=\"mf\">800.0000</span>\n<span class=\"n\">BogoMIPS</span>:                           <span class=\"mf\">5799.77</span>\n<span class=\"n\">Virtualization</span>:                     <span class=\"nc\">VT</span><span class=\"o\">-</span><span class=\"n\">x</span>\n<span class=\"n\">L1d</span><span class=\"w\"> </span><span class=\"n\">cache</span>:                          <span class=\"mi\">256</span><span class=\"w\"> </span><span class=\"n\">KiB</span>\n<span class=\"n\">L1i</span><span class=\"w\"> </span><span class=\"n\">cache</span>:                          <span class=\"mi\">256</span><span class=\"w\"> </span><span class=\"n\">KiB</span>\n<span class=\"n\">L2</span><span class=\"w\"> </span><span class=\"n\">cache</span>:                           <span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"n\">MiB</span>\n<span class=\"n\">L3</span><span class=\"w\"> </span><span class=\"n\">cache</span>:                           <span class=\"mi\">16</span><span class=\"w\"> </span><span class=\"n\">MiB</span>\n<span class=\"n\">NUMA</span><span class=\"w\"> </span><span class=\"n\">node0</span><span class=\"w\"> </span><span class=\"n\">CPU</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">)</span>:                  <span class=\"mi\">0</span><span class=\"o\">-</span><span class=\"mi\">15</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Gather</span><span class=\"w\"> </span><span class=\"n\">data</span><span class=\"w\"> </span><span class=\"n\">sampling</span>: <span class=\"nc\">Mitigation</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">Microcode</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Itlb</span><span class=\"w\"> </span><span class=\"n\">multihit</span>:        <span class=\"nc\">KVM</span>: <span class=\"nc\">Mitigation</span>: <span class=\"nc\">VMX</span><span class=\"w\"> </span><span class=\"n\">disabled</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">L1tf</span>:                 <span class=\"nc\">Not</span><span class=\"w\"> </span><span class=\"n\">affected</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Mds</span>:                  <span class=\"nc\">Not</span><span class=\"w\"> </span><span class=\"n\">affected</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Meltdown</span>:             <span class=\"nc\">Not</span><span class=\"w\"> </span><span class=\"n\">affected</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Mmio</span><span class=\"w\"> </span><span class=\"n\">stale</span><span class=\"w\"> </span><span class=\"n\">data</span>:      <span class=\"nc\">Mitigation</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">Clear</span><span class=\"w\"> </span><span class=\"n\">CPU</span><span class=\"w\"> </span><span class=\"n\">buffers</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">SMT</span><span class=\"w\"> </span><span class=\"n\">vulnerable</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Retbleed</span>:             <span class=\"nc\">Mitigation</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">Enhanced</span><span class=\"w\"> </span><span class=\"n\">IBRS</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Spec</span><span class=\"w\"> </span><span class=\"n\">rstack</span><span class=\"w\"> </span><span class=\"n\">overflow</span>: <span class=\"nc\">Not</span><span class=\"w\"> </span><span class=\"n\">affected</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Spec</span><span class=\"w\"> </span><span class=\"n\">store</span><span class=\"w\"> </span><span class=\"n\">bypass</span>:    <span class=\"nc\">Mitigation</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">Speculative</span><span class=\"w\"> </span><span class=\"n\">Store</span><span class=\"w\"> </span><span class=\"n\">Bypass</span><span class=\"w\"> </span><span class=\"n\">disabled</span><span class=\"w\"> </span><span class=\"n\">via</span><span class=\"w\"> </span><span class=\"n\">prctl</span><span class=\"w\"> </span><span class=\"n\">and</span><span class=\"w\"> </span><span class=\"n\">seccomp</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Spectre</span><span class=\"w\"> </span><span class=\"n\">v1</span>:           <span class=\"nc\">Mitigation</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">usercopy</span><span class=\"o\">/</span><span class=\"n\">swapgs</span><span class=\"w\"> </span><span class=\"n\">barriers</span><span class=\"w\"> </span><span class=\"n\">and</span><span class=\"w\"> </span><span class=\"n\">__user</span><span class=\"w\"> </span><span class=\"n\">pointer</span><span class=\"w\"> </span><span class=\"n\">sanitization</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Spectre</span><span class=\"w\"> </span><span class=\"n\">v2</span>:           <span class=\"nc\">Mitigation</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">Enhanced</span><span class=\"w\"> </span><span class=\"n\">IBRS</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">IBPB</span><span class=\"w\"> </span><span class=\"n\">conditional</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">RSB</span><span class=\"w\"> </span><span class=\"n\">filling</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">PBRSB</span><span class=\"o\">-</span><span class=\"n\">eIBRS</span><span class=\"w\"> </span><span class=\"n\">SW</span><span class=\"w\"> </span><span class=\"n\">sequence</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Srbds</span>:                <span class=\"nc\">Mitigation</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">Microcode</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Tsx</span><span class=\"w\"> </span><span class=\"k\">async</span><span class=\"w\"> </span><span class=\"n\">abort</span>:      <span class=\"nc\">Not</span><span class=\"w\"> </span><span class=\"n\">affected</span>\n<span class=\"n\">Flags</span>:                              <span class=\"nc\">fpu</span><span class=\"w\"> </span><span class=\"n\">vme</span><span class=\"w\"> </span><span class=\"n\">de</span><span class=\"w\"> </span><span class=\"n\">pse</span><span class=\"w\"> </span><span class=\"n\">tsc</span><span class=\"w\"> </span><span class=\"n\">msr</span><span class=\"w\"> </span><span class=\"n\">pae</span><span class=\"w\"> </span><span class=\"n\">mce</span><span class=\"w\"> </span><span class=\"n\">cx8</span><span class=\"w\"> </span><span class=\"n\">apic</span><span class=\"w\"> </span><span class=\"n\">sep</span><span class=\"w\"> </span><span class=\"n\">mtrr</span><span class=\"w\"> </span><span class=\"n\">pge</span><span class=\"w\"> </span><span class=\"n\">mca</span><span class=\"w\"> </span><span class=\"n\">cmov</span><span class=\"w\"> </span><span class=\"n\">pat</span><span class=\"w\"> </span><span class=\"n\">pse36</span><span class=\"w\"> </span><span class=\"n\">clflush</span><span class=\"w\"> </span><span class=\"n\">dts</span><span class=\"w\"> </span><span class=\"n\">acpi</span><span class=\"w\"> </span><span class=\"n\">mmx</span><span class=\"w\"> </span><span class=\"n\">fxsr</span><span class=\"w\"> </span><span class=\"n\">sse</span><span class=\"w\"> </span><span class=\"n\">sse2</span><span class=\"w\"> </span><span class=\"n\">ss</span><span class=\"w\"> </span><span class=\"n\">ht</span><span class=\"w\"> </span><span class=\"n\">tm</span><span class=\"w\"> </span><span class=\"n\">pbe</span><span class=\"w\"> </span><span class=\"n\">syscal</span>\n<span class=\"w\">                                    </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"n\">nx</span><span class=\"w\"> </span><span class=\"n\">pdpe1gb</span><span class=\"w\"> </span><span class=\"n\">rdtscp</span><span class=\"w\"> </span><span class=\"n\">lm</span><span class=\"w\"> </span><span class=\"n\">constant_tsc</span><span class=\"w\"> </span><span class=\"n\">art</span><span class=\"w\"> </span><span class=\"n\">arch_perfmon</span><span class=\"w\"> </span><span class=\"n\">pebs</span><span class=\"w\"> </span><span class=\"n\">bts</span><span class=\"w\"> </span><span class=\"n\">rep_good</span><span class=\"w\"> </span><span class=\"n\">nopl</span><span class=\"w\"> </span><span class=\"n\">xtopology</span><span class=\"w\"> </span><span class=\"n\">nonstop_tsc</span><span class=\"w\"> </span><span class=\"n\">cpuid</span><span class=\"w\"> </span><span class=\"n\">aperfmperf</span><span class=\"w\"> </span><span class=\"n\">pni</span><span class=\"w\"> </span><span class=\"n\">pclmulq</span>\n<span class=\"w\">                                    </span><span class=\"n\">dq</span><span class=\"w\"> </span><span class=\"n\">dtes64</span><span class=\"w\"> </span><span class=\"n\">monitor</span><span class=\"w\"> </span><span class=\"n\">ds_cpl</span><span class=\"w\"> </span><span class=\"n\">vmx</span><span class=\"w\"> </span><span class=\"n\">est</span><span class=\"w\"> </span><span class=\"n\">tm2</span><span class=\"w\"> </span><span class=\"n\">ssse3</span><span class=\"w\"> </span><span class=\"n\">sdbg</span><span class=\"w\"> </span><span class=\"n\">fma</span><span class=\"w\"> </span><span class=\"n\">cx16</span><span class=\"w\"> </span><span class=\"n\">xtpr</span><span class=\"w\"> </span><span class=\"n\">pdcm</span><span class=\"w\"> </span><span class=\"n\">pcid</span><span class=\"w\"> </span><span class=\"n\">sse4_1</span><span class=\"w\"> </span><span class=\"n\">sse4_2</span><span class=\"w\"> </span><span class=\"n\">x2apic</span><span class=\"w\"> </span><span class=\"n\">movbe</span><span class=\"w\"> </span><span class=\"n\">popcnt</span><span class=\"w\"> </span><span class=\"n\">tsc_deadline_timer</span><span class=\"w\"> </span><span class=\"n\">a</span>\n<span class=\"w\">                                    </span><span class=\"n\">es</span><span class=\"w\"> </span><span class=\"n\">xsave</span><span class=\"w\"> </span><span class=\"n\">avx</span><span class=\"w\"> </span><span class=\"n\">f16c</span><span class=\"w\"> </span><span class=\"n\">rdrand</span><span class=\"w\"> </span><span class=\"n\">lahf_lm</span><span class=\"w\"> </span><span class=\"n\">abm</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"n\">dnowprefetch</span><span class=\"w\"> </span><span class=\"n\">cpuid_fault</span><span class=\"w\"> </span><span class=\"n\">invpcid_single</span><span class=\"w\"> </span><span class=\"n\">ssbd</span><span class=\"w\"> </span><span class=\"n\">ibrs</span><span class=\"w\"> </span><span class=\"n\">ibpb</span><span class=\"w\"> </span><span class=\"n\">stibp</span><span class=\"w\"> </span><span class=\"n\">ibrs_enhanced</span><span class=\"w\"> </span><span class=\"n\">tpr_shadow</span><span class=\"w\"> </span><span class=\"n\">vn</span>\n<span class=\"w\">                                    </span><span class=\"n\">mi</span><span class=\"w\"> </span><span class=\"n\">flexpriority</span><span class=\"w\"> </span><span class=\"n\">ept</span><span class=\"w\"> </span><span class=\"n\">vpid</span><span class=\"w\"> </span><span class=\"n\">ept_ad</span><span class=\"w\"> </span><span class=\"n\">fsgsbase</span><span class=\"w\"> </span><span class=\"n\">tsc_adjust</span><span class=\"w\"> </span><span class=\"n\">bmi1</span><span class=\"w\"> </span><span class=\"n\">avx2</span><span class=\"w\"> </span><span class=\"n\">smep</span><span class=\"w\"> </span><span class=\"n\">bmi2</span><span class=\"w\"> </span><span class=\"n\">erms</span><span class=\"w\"> </span><span class=\"n\">invpcid</span><span class=\"w\"> </span><span class=\"n\">mpx</span><span class=\"w\"> </span><span class=\"n\">rdseed</span><span class=\"w\"> </span><span class=\"n\">adx</span><span class=\"w\"> </span><span class=\"n\">smap</span><span class=\"w\"> </span><span class=\"n\">clflushopt</span><span class=\"w\"> </span><span class=\"n\">intel_pt</span><span class=\"w\"> </span><span class=\"n\">x</span>\n<span class=\"w\">                                    </span><span class=\"n\">saveopt</span><span class=\"w\"> </span><span class=\"n\">xsavec</span><span class=\"w\"> </span><span class=\"n\">xgetbv1</span><span class=\"w\"> </span><span class=\"n\">xsaves</span><span class=\"w\"> </span><span class=\"n\">dtherm</span><span class=\"w\"> </span><span class=\"n\">ida</span><span class=\"w\"> </span><span class=\"n\">arat</span><span class=\"w\"> </span><span class=\"n\">pln</span><span class=\"w\"> </span><span class=\"n\">pts</span><span class=\"w\"> </span><span class=\"n\">hwp</span><span class=\"w\"> </span><span class=\"n\">hwp_notify</span><span class=\"w\"> </span><span class=\"n\">hwp_act_window</span><span class=\"w\"> </span><span class=\"n\">hwp_epp</span><span class=\"w\"> </span><span class=\"n\">pku</span><span class=\"w\"> </span><span class=\"n\">ospke</span><span class=\"w\"> </span><span class=\"n\">md_clear</span><span class=\"w\"> </span><span class=\"n\">flush_l1d</span><span class=\"w\"> </span><span class=\"n\">arch_</span>\n<span class=\"w\">                                    </span><span class=\"n\">capabilities</span>\n</code></pre></div><br>\n</p>\n</blockquote>",
        "id": 397125469,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1697554110
    },
    {
        "content": "<p>unicornt <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7246#issuecomment-1767664571\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7246\">issue #7246</a>:</p>\n<blockquote>\n<p>Hi, I tried the same code on another machine. The result is almost <code>the same</code>, including the weird time of <code>mov</code> and <code>xor</code>.</p>\n<p>The OS of this machine is <code>ubuntu 20.04</code> and version of wasmtime is <code>15.0.0</code>.</p>\n<p>Here is the output of <code>lscpu</code> on this machine.</p>\n<p><div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">Architecture</span>:                       <span class=\"nc\">x86_64</span>\n<span class=\"n\">CPU</span><span class=\"w\"> </span><span class=\"n\">op</span><span class=\"o\">-</span><span class=\"n\">mode</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">)</span>:                     <span class=\"mi\">32</span><span class=\"o\">-</span><span class=\"n\">bit</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">64</span><span class=\"o\">-</span><span class=\"n\">bit</span>\n<span class=\"n\">Byte</span><span class=\"w\"> </span><span class=\"n\">Order</span>:                         <span class=\"nc\">Little</span><span class=\"w\"> </span><span class=\"n\">Endian</span>\n<span class=\"n\">Address</span><span class=\"w\"> </span><span class=\"n\">sizes</span>:                      <span class=\"mi\">39</span><span class=\"w\"> </span><span class=\"n\">bits</span><span class=\"w\"> </span><span class=\"n\">physical</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">48</span><span class=\"w\"> </span><span class=\"n\">bits</span><span class=\"w\"> </span><span class=\"kr\">virtual</span>\n<span class=\"n\">CPU</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">)</span>:                             <span class=\"mi\">6</span>\n<span class=\"n\">On</span><span class=\"o\">-</span><span class=\"n\">line</span><span class=\"w\"> </span><span class=\"n\">CPU</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">list</span>:                <span class=\"mi\">0</span><span class=\"o\">-</span><span class=\"mi\">5</span>\n<span class=\"n\">Thread</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">per</span><span class=\"w\"> </span><span class=\"n\">core</span>:                 <span class=\"mi\">1</span>\n<span class=\"n\">Core</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">per</span><span class=\"w\"> </span><span class=\"n\">socket</span>:                 <span class=\"mi\">6</span>\n<span class=\"n\">Socket</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">)</span>:                          <span class=\"mi\">1</span>\n<span class=\"n\">NUMA</span><span class=\"w\"> </span><span class=\"n\">node</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">)</span>:                       <span class=\"mi\">1</span>\n<span class=\"n\">Vendor</span><span class=\"w\"> </span><span class=\"n\">ID</span>:                          <span class=\"nc\">GenuineIntel</span>\n<span class=\"n\">CPU</span><span class=\"w\"> </span><span class=\"n\">family</span>:                         <span class=\"mi\">6</span>\n<span class=\"n\">Model</span>:                              <span class=\"mi\">158</span>\n<span class=\"n\">Model</span><span class=\"w\"> </span><span class=\"n\">name</span>:                         <span class=\"nc\">Intel</span><span class=\"p\">(</span><span class=\"n\">R</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">Core</span><span class=\"p\">(</span><span class=\"n\">TM</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">i5</span><span class=\"o\">-</span><span class=\"mi\">9500</span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"n\">CPU</span><span class=\"w\"> </span><span class=\"o\">@</span><span class=\"w\"> </span><span class=\"mf\">2.20</span><span class=\"n\">GHz</span>\n<span class=\"n\">Stepping</span>:                           <span class=\"mi\">10</span>\n<span class=\"n\">CPU</span><span class=\"w\"> </span><span class=\"n\">MHz</span>:                            <span class=\"mf\">2200.000</span>\n<span class=\"n\">CPU</span><span class=\"w\"> </span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"n\">MHz</span>:                        <span class=\"mf\">3700.0000</span>\n<span class=\"n\">CPU</span><span class=\"w\"> </span><span class=\"n\">min</span><span class=\"w\"> </span><span class=\"n\">MHz</span>:                        <span class=\"mf\">800.0000</span>\n<span class=\"n\">BogoMIPS</span>:                           <span class=\"mf\">4399.99</span>\n<span class=\"n\">Virtualization</span>:                     <span class=\"nc\">VT</span><span class=\"o\">-</span><span class=\"n\">x</span>\n<span class=\"n\">L1d</span><span class=\"w\"> </span><span class=\"n\">cache</span>:                          <span class=\"mi\">192</span><span class=\"w\"> </span><span class=\"n\">KiB</span>\n<span class=\"n\">L1i</span><span class=\"w\"> </span><span class=\"n\">cache</span>:                          <span class=\"mi\">192</span><span class=\"w\"> </span><span class=\"n\">KiB</span>\n<span class=\"n\">L2</span><span class=\"w\"> </span><span class=\"n\">cache</span>:                           <span class=\"mf\">1.5</span><span class=\"w\"> </span><span class=\"n\">MiB</span>\n<span class=\"n\">L3</span><span class=\"w\"> </span><span class=\"n\">cache</span>:                           <span class=\"mi\">9</span><span class=\"w\"> </span><span class=\"n\">MiB</span>\n<span class=\"n\">NUMA</span><span class=\"w\"> </span><span class=\"n\">node0</span><span class=\"w\"> </span><span class=\"n\">CPU</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">)</span>:                  <span class=\"mi\">0</span><span class=\"o\">-</span><span class=\"mi\">5</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Gather</span><span class=\"w\"> </span><span class=\"n\">data</span><span class=\"w\"> </span><span class=\"n\">sampling</span>: <span class=\"nc\">Mitigation</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">Microcode</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Itlb</span><span class=\"w\"> </span><span class=\"n\">multihit</span>:        <span class=\"nc\">KVM</span>: <span class=\"nc\">Mitigation</span>: <span class=\"nc\">VMX</span><span class=\"w\"> </span><span class=\"n\">disabled</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">L1tf</span>:                 <span class=\"nc\">Mitigation</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">PTE</span><span class=\"w\"> </span><span class=\"n\">Inversion</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">VMX</span><span class=\"w\"> </span><span class=\"n\">conditional</span><span class=\"w\"> </span><span class=\"n\">cache</span><span class=\"w\"> </span><span class=\"n\">flushes</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">SMT</span><span class=\"w\"> </span><span class=\"n\">disabled</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Mds</span>:                  <span class=\"nc\">Mitigation</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">Clear</span><span class=\"w\"> </span><span class=\"n\">CPU</span><span class=\"w\"> </span><span class=\"n\">buffers</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">SMT</span><span class=\"w\"> </span><span class=\"n\">disabled</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Meltdown</span>:             <span class=\"nc\">Mitigation</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">PTI</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Mmio</span><span class=\"w\"> </span><span class=\"n\">stale</span><span class=\"w\"> </span><span class=\"n\">data</span>:      <span class=\"nc\">Mitigation</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">Clear</span><span class=\"w\"> </span><span class=\"n\">CPU</span><span class=\"w\"> </span><span class=\"n\">buffers</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">SMT</span><span class=\"w\"> </span><span class=\"n\">disabled</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Retbleed</span>:             <span class=\"nc\">Mitigation</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">IBRS</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Spec</span><span class=\"w\"> </span><span class=\"n\">rstack</span><span class=\"w\"> </span><span class=\"n\">overflow</span>: <span class=\"nc\">Not</span><span class=\"w\"> </span><span class=\"n\">affected</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Spec</span><span class=\"w\"> </span><span class=\"n\">store</span><span class=\"w\"> </span><span class=\"n\">bypass</span>:    <span class=\"nc\">Mitigation</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">Speculative</span><span class=\"w\"> </span><span class=\"n\">Store</span><span class=\"w\"> </span><span class=\"n\">Bypass</span><span class=\"w\"> </span><span class=\"n\">disabled</span><span class=\"w\"> </span><span class=\"n\">via</span><span class=\"w\"> </span><span class=\"n\">prctl</span><span class=\"w\"> </span><span class=\"n\">and</span><span class=\"w\"> </span><span class=\"n\">seccomp</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Spectre</span><span class=\"w\"> </span><span class=\"n\">v1</span>:           <span class=\"nc\">Mitigation</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">usercopy</span><span class=\"o\">/</span><span class=\"n\">swapgs</span><span class=\"w\"> </span><span class=\"n\">barriers</span><span class=\"w\"> </span><span class=\"n\">and</span><span class=\"w\"> </span><span class=\"n\">__user</span><span class=\"w\"> </span><span class=\"n\">pointer</span><span class=\"w\"> </span><span class=\"n\">sanitization</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Spectre</span><span class=\"w\"> </span><span class=\"n\">v2</span>:           <span class=\"nc\">Mitigation</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">IBRS</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">IBPB</span><span class=\"w\"> </span><span class=\"n\">conditional</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">STIBP</span><span class=\"w\"> </span><span class=\"n\">disabled</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">RSB</span><span class=\"w\"> </span><span class=\"n\">filling</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">PBRSB</span><span class=\"o\">-</span><span class=\"n\">eIBRS</span><span class=\"w\"> </span><span class=\"n\">Not</span><span class=\"w\"> </span><span class=\"n\">affected</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Srbds</span>:                <span class=\"nc\">Mitigation</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">Microcode</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Tsx</span><span class=\"w\"> </span><span class=\"k\">async</span><span class=\"w\"> </span><span class=\"n\">abort</span>:      <span class=\"nc\">Mitigation</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">TSX</span><span class=\"w\"> </span><span class=\"n\">disabled</span>\n<span class=\"n\">Flags</span>:                              <span class=\"nc\">fpu</span><span class=\"w\"> </span><span class=\"n\">vme</span><span class=\"w\"> </span><span class=\"n\">de</span><span class=\"w\"> </span><span class=\"n\">pse</span><span class=\"w\"> </span><span class=\"n\">tsc</span><span class=\"w\"> </span><span class=\"n\">msr</span><span class=\"w\"> </span><span class=\"n\">pae</span><span class=\"w\"> </span><span class=\"n\">mce</span><span class=\"w\"> </span><span class=\"n\">cx8</span><span class=\"w\"> </span><span class=\"n\">apic</span><span class=\"w\"> </span><span class=\"n\">sep</span><span class=\"w\"> </span><span class=\"n\">mtrr</span><span class=\"w\"> </span><span class=\"n\">pge</span><span class=\"w\"> </span><span class=\"n\">mca</span><span class=\"w\"> </span><span class=\"n\">cmov</span><span class=\"w\"> </span><span class=\"n\">pat</span><span class=\"w\"> </span><span class=\"n\">pse36</span><span class=\"w\"> </span><span class=\"n\">clflush</span><span class=\"w\"> </span><span class=\"n\">dts</span><span class=\"w\"> </span><span class=\"n\">acpi</span><span class=\"w\"> </span><span class=\"n\">mmx</span>\n<span class=\"w\">                                     </span><span class=\"n\">fxsr</span><span class=\"w\"> </span><span class=\"n\">sse</span><span class=\"w\"> </span><span class=\"n\">sse2</span><span class=\"w\"> </span><span class=\"n\">ss</span><span class=\"w\"> </span><span class=\"n\">ht</span><span class=\"w\"> </span><span class=\"n\">tm</span><span class=\"w\"> </span><span class=\"n\">pbe</span><span class=\"w\"> </span><span class=\"n\">syscall</span><span class=\"w\"> </span><span class=\"n\">nx</span><span class=\"w\"> </span><span class=\"n\">pdpe1gb</span><span class=\"w\"> </span><span class=\"n\">rdtscp</span><span class=\"w\"> </span><span class=\"n\">lm</span><span class=\"w\"> </span><span class=\"n\">constant_tsc</span><span class=\"w\"> </span><span class=\"n\">art</span><span class=\"w\"> </span><span class=\"n\">arch_perfmon</span><span class=\"w\"> </span><span class=\"n\">pebs</span>\n<span class=\"w\">                                    </span><span class=\"n\">bts</span><span class=\"w\"> </span><span class=\"n\">rep_good</span><span class=\"w\"> </span><span class=\"n\">nopl</span><span class=\"w\"> </span><span class=\"n\">xtopology</span><span class=\"w\"> </span><span class=\"n\">nonstop_tsc</span><span class=\"w\"> </span><span class=\"n\">cpuid</span><span class=\"w\"> </span><span class=\"n\">aperfmperf</span><span class=\"w\"> </span><span class=\"n\">pni</span><span class=\"w\"> </span><span class=\"n\">pclmulqdq</span><span class=\"w\"> </span><span class=\"n\">dtes64</span><span class=\"w\"> </span><span class=\"n\">monitor</span><span class=\"w\"> </span><span class=\"n\">ds_cpl</span>\n<span class=\"w\">                                     </span><span class=\"n\">vmx</span><span class=\"w\"> </span><span class=\"n\">smx</span><span class=\"w\"> </span><span class=\"n\">est</span><span class=\"w\"> </span><span class=\"n\">tm2</span><span class=\"w\"> </span><span class=\"n\">ssse3</span><span class=\"w\"> </span><span class=\"n\">sdbg</span><span class=\"w\"> </span><span class=\"n\">fma</span><span class=\"w\"> </span><span class=\"n\">cx16</span><span class=\"w\"> </span><span class=\"n\">xtpr</span><span class=\"w\"> </span><span class=\"n\">pdcm</span><span class=\"w\"> </span><span class=\"n\">pcid</span><span class=\"w\"> </span><span class=\"n\">sse4_1</span><span class=\"w\"> </span><span class=\"n\">sse4_2</span><span class=\"w\"> </span><span class=\"n\">x2apic</span><span class=\"w\"> </span><span class=\"n\">movbe</span><span class=\"w\"> </span><span class=\"n\">popcnt</span><span class=\"w\"> </span><span class=\"n\">tsc_de</span>\n<span class=\"w\">                                    </span><span class=\"n\">adline_timer</span><span class=\"w\"> </span><span class=\"n\">aes</span><span class=\"w\"> </span><span class=\"n\">xsave</span><span class=\"w\"> </span><span class=\"n\">avx</span><span class=\"w\"> </span><span class=\"n\">f16c</span><span class=\"w\"> </span><span class=\"n\">rdrand</span><span class=\"w\"> </span><span class=\"n\">lahf_lm</span><span class=\"w\"> </span><span class=\"n\">abm</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"n\">dnowprefetch</span><span class=\"w\"> </span><span class=\"n\">cpuid_fault</span><span class=\"w\"> </span><span class=\"n\">epb</span><span class=\"w\"> </span><span class=\"n\">invpcid_sin</span>\n<span class=\"w\">                                    </span><span class=\"n\">gle</span><span class=\"w\"> </span><span class=\"n\">pti</span><span class=\"w\"> </span><span class=\"n\">ssbd</span><span class=\"w\"> </span><span class=\"n\">ibrs</span><span class=\"w\"> </span><span class=\"n\">ibpb</span><span class=\"w\"> </span><span class=\"n\">stibp</span><span class=\"w\"> </span><span class=\"n\">tpr_shadow</span><span class=\"w\"> </span><span class=\"n\">vnmi</span><span class=\"w\"> </span><span class=\"n\">flexpriority</span><span class=\"w\"> </span><span class=\"n\">ept</span><span class=\"w\"> </span><span class=\"n\">vpid</span><span class=\"w\"> </span><span class=\"n\">ept_ad</span><span class=\"w\"> </span><span class=\"n\">fsgsbase</span><span class=\"w\"> </span><span class=\"n\">tsc_adjus</span>\n<span class=\"w\">                                    </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"n\">bmi1</span><span class=\"w\"> </span><span class=\"n\">avx2</span><span class=\"w\"> </span><span class=\"n\">smep</span><span class=\"w\"> </span><span class=\"n\">bmi2</span><span class=\"w\"> </span><span class=\"n\">erms</span><span class=\"w\"> </span><span class=\"n\">invpcid</span><span class=\"w\"> </span><span class=\"n\">mpx</span><span class=\"w\"> </span><span class=\"n\">rdseed</span><span class=\"w\"> </span><span class=\"n\">adx</span><span class=\"w\"> </span><span class=\"n\">smap</span><span class=\"w\"> </span><span class=\"n\">clflushopt</span><span class=\"w\"> </span><span class=\"n\">intel_pt</span><span class=\"w\"> </span><span class=\"n\">xsaveopt</span><span class=\"w\"> </span><span class=\"n\">xsavec</span><span class=\"w\"> </span><span class=\"n\">x</span>\n<span class=\"w\">                                    </span><span class=\"n\">getbv1</span><span class=\"w\"> </span><span class=\"n\">xsaves</span><span class=\"w\"> </span><span class=\"n\">dtherm</span><span class=\"w\"> </span><span class=\"n\">ida</span><span class=\"w\"> </span><span class=\"n\">arat</span><span class=\"w\"> </span><span class=\"n\">pln</span><span class=\"w\"> </span><span class=\"n\">pts</span><span class=\"w\"> </span><span class=\"n\">hwp</span><span class=\"w\"> </span><span class=\"n\">hwp_notify</span><span class=\"w\"> </span><span class=\"n\">hwp_act_window</span><span class=\"w\"> </span><span class=\"n\">hwp_epp</span><span class=\"w\"> </span><span class=\"n\">md_clear</span><span class=\"w\"> </span><span class=\"n\">flush_l</span>\n<span class=\"w\">                                    </span><span class=\"mi\">1</span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"n\">arch_capabilities</span>\n</code></pre></div><br>\n</p>\n</blockquote>",
        "id": 397233074,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1697606629
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7246#issuecomment-1769038478\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7246\">issue #7246</a>:</p>\n<blockquote>\n<p>Ok thanks again for both reporting this and helping us follow-up! @elliottt was able to reproduce on hardware he has which resulted in us bottoming out in <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7283\">https://github.com/bytecodealliance/wasmtime/issues/7283</a> as the cause of this issue. I'm going to close this in favor of that issue to keep the issue discussion a bit shorter, but if you'd like to confirm locally @unicornt you can comment out <a href=\"https://github.com/bytecodealliance/wasmtime/blob/5c7ed43058fd8bc3122b20debe712c9cbfecf9f2/cranelift/codegen/src/opts/remat.isle#L28-L31\">these lines</a> in a custom Wasmtime build and the performance of this program should be better. Note though that it's just a proof-of-concept of what the slowdown is and is not a full complete fix, that'll get tracked by <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7283\">https://github.com/bytecodealliance/wasmtime/issues/7283</a></p>\n</blockquote>",
        "id": 397358900,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1697651041
    },
    {
        "content": "<p>alexcrichton closed <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7246\">issue #7246</a>:</p>\n<blockquote>\n<h3>Test Case</h3>\n<p><a href=\"https://github.com/bytecodealliance/wasmtime/files/12912094/report.zip\">report.zip</a></p>\n<h3>Steps to Reproduce</h3>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">time</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">case</span><span class=\"p\">.</span><span class=\"n\">wasm</span>\n</code></pre></div>\n<h3>Actual Results</h3>\n<p><code>Wasmtime</code> takes an abnormal long time to execute this wasm file and <strong>no</strong> exception is thrown.</p>\n<h3>Expected Results</h3>\n<p>Other runtime use much less time or report an <code>out of memory access</code> exception</p>\n<p>&lt;img width=\"1230\" alt=\"image\" src=\"<a href=\"https://github.com/bytecodealliance/wasmtime/assets/18662046/626efd7d-16aa-49d7-ae8d-4e66c5f857ce\">https://github.com/bytecodealliance/wasmtime/assets/18662046/626efd7d-16aa-49d7-ae8d-4e66c5f857ce</a>\"&gt;</p>\n<h3>Versions and Environment</h3>\n<p>Wasmtime version or commit: 15.0.0</p>\n<p>Operating system: Ubuntu 20.04</p>\n<p>Architecture: x86_64<br>\n</p>\n</blockquote>",
        "id": 397358929,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1697651044
    },
    {
        "content": "<p>yfaming <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7246#issuecomment-1769797610\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7246\">issue #7246</a>:</p>\n<blockquote>\n<p>I'm using a MacBook Pro with a 2.6 GHz 6-Core Intel Core i7 CPU. I attempted to run the .wasm module provided by @alexcrichton @unicornt , and it was indeed quite slow, taking around 27s. I also tried wasmer, and it took about 7s.</p>\n<p>Following @alexcrichton @alexcrichton's advice, I commented out the last 4 lines in <code>cranelift/codegen/src/opts/remat.isle</code>, recompiled wasmtime, and ran it again. The execution time dropped to less than 1s. Amazing!</p>\n</blockquote>",
        "id": 397414783,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1697683107
    },
    {
        "content": "<p>yfaming edited a <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7246#issuecomment-1769797610\">comment</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7246\">issue #7246</a>:</p>\n<blockquote>\n<p>I'm using a MacBook Pro with a 2.6 GHz 6-Core Intel Core i7 CPU. I attempted to run the .wasm module provided by @alexcrichton @unicornt , and it was indeed quite slow, taking around 27s. I also tried wasmer, and it took about 7s.</p>\n<p>Following @alexcrichton's advice, I commented out the last 4 lines in <code>cranelift/codegen/src/opts/remat.isle</code>, recompiled wasmtime, and ran it again. The execution time dropped to less than 1s. Amazing!</p>\n</blockquote>",
        "id": 397414809,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1697683122
    },
    {
        "content": "<p>yfaming edited a <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7246#issuecomment-1769797610\">comment</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7246\">issue #7246</a>:</p>\n<blockquote>\n<p>I'm using a MacBook Pro with a 2.6 GHz 6-Core Intel Core i7 CPU. I attempted to run the .wasm module provided by @unicornt , and it was indeed quite slow, taking around 27s. I also tried wasmer, and it took about 7s.</p>\n<p>Following @alexcrichton's advice, I commented out the last 4 lines in <code>cranelift/codegen/src/opts/remat.isle</code>, recompiled wasmtime, and ran it again. The execution time dropped to less than 1s. Amazing!</p>\n</blockquote>",
        "id": 397414839,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1697683134
    },
    {
        "content": "<p>hungryzzz <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7246#issuecomment-1772242886\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7246\">issue #7246</a>:</p>\n<blockquote>\n<p>@alexcrichton Hi, I try to reduce the above <code>wasm</code> bytecode to get a buggy case as shortest as possible, the reduced results are attached. The execute time in <code>Wasmer</code> and <code>Wasmtime</code> still have a big difference:</p>\n<ul>\n<li><code>Wasmer</code>: 0.67s</li>\n<li><code>Wasmtime</code>: 12.24s</li>\n</ul>\n<p>But I find that the performance regression is not only related to the <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7283\">https://github.com/bytecodealliance/wasmtime/issues/7283</a>, because if I change the constant in <code>f64.const 5.43231e-312</code> to <code>f64.const 5.4</code>, the execution time will be back to normal(but indeed, the loop-invariant code will be sinked into loop in the corresponding binary generated by <code>Wasmtime</code>):</p>\n<ul>\n<li><code>Wasmer</code>: 0.70s</li>\n<li><code>Wasmtime</code>: 0.34s</li>\n</ul>\n<p>By the way, I also check the binary generated by <code>LLVM</code>, I find that the whole computation will be optimized to empty(I think  because there is nothing depends on the result of the loop).</p>\n<p>I think it is also a strange case I cannot understand and explain...</p>\n<div class=\"codehilite\" data-code-language=\"WebAssembly\"><pre><span></span><code><span class=\"c1\">;; reduce.wat</span>\n<span class=\"p\">(</span><span class=\"k\">module</span>\n  <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"cm\">(;0;)</span> <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"p\">(</span><span class=\"k\">param</span> <span class=\"kt\">i32</span><span class=\"p\">)))</span>\n  <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"cm\">(;1;)</span> <span class=\"p\">(</span><span class=\"k\">func</span><span class=\"p\">))</span>\n  <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"cm\">(;2;)</span> <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"p\">(</span><span class=\"k\">result</span> <span class=\"kt\">i32</span><span class=\"p\">)))</span>\n  <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"cm\">(;3;)</span> <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"p\">(</span><span class=\"k\">param</span> <span class=\"kt\">i32</span><span class=\"p\">)</span> <span class=\"p\">(</span><span class=\"k\">result</span> <span class=\"kt\">i32</span><span class=\"p\">)))</span>\n  <span class=\"p\">(</span><span class=\"k\">import</span> <span class=\"s2\">\"wasi_snapshot_preview1\"</span> <span class=\"s2\">\"proc_exit\"</span> <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"cm\">(;0;)</span> <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"mi\">0</span><span class=\"p\">)))</span>\n  <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"cm\">(;2;)</span> <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"mi\">1</span><span class=\"p\">)</span>\n    <span class=\"nb\">call</span> <span class=\"mi\">2</span>\n    <span class=\"nb\">i32.const</span> <span class=\"mi\">0</span>\n    <span class=\"nb\">call</span> <span class=\"mi\">0</span>\n    <span class=\"nb\">unreachable</span><span class=\"p\">)</span>\n  <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"cm\">(;2;)</span> <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"mi\">1</span><span class=\"p\">)</span>\n    <span class=\"p\">(</span><span class=\"k\">local</span> <span class=\"kt\">f64</span> <span class=\"kt\">f64</span> <span class=\"kt\">i32</span><span class=\"p\">)</span>\n    <span class=\"nb\">f64.const</span> <span class=\"mf\">5.43231e-312</span> <span class=\"c1\">;; Magic Number!!!</span>\n    <span class=\"nb\">f64.const</span> <span class=\"mf\">1.0</span>\n    <span class=\"nb\">f64.mul</span>\n    <span class=\"nb\">local.set</span> <span class=\"mi\">1</span>\n    <span class=\"k\">loop</span>  <span class=\"c1\">;; label = @1</span>\n      <span class=\"nb\">local.get</span> <span class=\"mi\">1</span>\n      <span class=\"nb\">local.get</span> <span class=\"mi\">0</span>\n      <span class=\"nb\">f64.add</span>\n      <span class=\"nb\">local.set</span> <span class=\"mi\">0</span>\n      <span class=\"nb\">local.get</span> <span class=\"mi\">2</span>   <span class=\"c1\">;; condition variable i</span>\n      <span class=\"nb\">i32.const</span> <span class=\"mi\">1</span>\n      <span class=\"nb\">i32.add</span>\n      <span class=\"nb\">local.tee</span> <span class=\"mi\">2</span>   <span class=\"c1\">;; i++</span>\n      <span class=\"nb\">i32.const</span> <span class=\"mf\">312500000</span>\n      <span class=\"nb\">i32.ne</span>\n      <span class=\"nb\">br_if</span> <span class=\"mi\">0</span> <span class=\"cm\">(;@1;)</span>\n    <span class=\"k\">end</span>\n  <span class=\"p\">)</span>\n  <span class=\"p\">(</span><span class=\"k\">table</span> <span class=\"cm\">(;0;)</span> <span class=\"mf\">2 2</span> <span class=\"k\">funcref</span><span class=\"p\">)</span>\n  <span class=\"p\">(</span><span class=\"k\">memory</span> <span class=\"cm\">(;0;)</span> <span class=\"mf\">8192</span> <span class=\"mf\">8192</span><span class=\"p\">)</span>\n  <span class=\"p\">(</span><span class=\"k\">global</span> <span class=\"cm\">(;0;)</span> <span class=\"p\">(</span><span class=\"k\">mut</span> <span class=\"kt\">i32</span><span class=\"p\">)</span> <span class=\"p\">(</span><span class=\"nb\">i32.const</span> <span class=\"mf\">66576</span><span class=\"p\">))</span>\n  <span class=\"p\">(</span><span class=\"k\">export</span> <span class=\"s2\">\"memory\"</span> <span class=\"p\">(</span><span class=\"k\">memory</span> <span class=\"mi\">0</span><span class=\"p\">))</span>\n  <span class=\"p\">(</span><span class=\"k\">export</span> <span class=\"s2\">\"__indirect_function_table\"</span> <span class=\"p\">(</span><span class=\"k\">table</span> <span class=\"mi\">0</span><span class=\"p\">))</span>\n  <span class=\"p\">(</span><span class=\"k\">export</span> <span class=\"s2\">\"_start\"</span> <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"mi\">1</span><span class=\"p\">)))</span>\n</code></pre></div>\n<h3>Environment Version</h3>\n<ul>\n<li><code>Wasmer</code>: wasmer 4.1.2 (98188df 2023-09-19)<br>\nbinary: wasmer-cli<br>\ncommit-hash: 98188df80096dfc7134ce202731878cf9d8f6f4e<br>\ncommit-date: 2023-09-19<br>\nhost: x86_64-unknown-linux-gnu<br>\ncompiler: singlepass,cranelift,llvm</li>\n<li><code>Wasmtime</code>: build from 8e00cc202f82445a42adbad6e8187e901f91833b (release version)</li>\n<li>CPU</li>\n</ul>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"err\">âžœ</span><span class=\"w\">  </span><span class=\"o\">~</span><span class=\"w\"> </span><span class=\"n\">lscpu</span>\n<span class=\"n\">Architecture</span>:                       <span class=\"nc\">x86_64</span>\n<span class=\"n\">CPU</span><span class=\"w\"> </span><span class=\"n\">op</span><span class=\"o\">-</span><span class=\"n\">mode</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">)</span>:                     <span class=\"mi\">32</span><span class=\"o\">-</span><span class=\"n\">bit</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">64</span><span class=\"o\">-</span><span class=\"n\">bit</span>\n<span class=\"n\">Byte</span><span class=\"w\"> </span><span class=\"n\">Order</span>:                         <span class=\"nc\">Little</span><span class=\"w\"> </span><span class=\"n\">Endian</span>\n<span class=\"n\">Address</span><span class=\"w\"> </span><span class=\"n\">sizes</span>:                      <span class=\"mi\">39</span><span class=\"w\"> </span><span class=\"n\">bits</span><span class=\"w\"> </span><span class=\"n\">physical</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">48</span><span class=\"w\"> </span><span class=\"n\">bits</span><span class=\"w\"> </span><span class=\"kr\">virtual</span>\n<span class=\"n\">CPU</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">)</span>:                             <span class=\"mi\">6</span>\n<span class=\"n\">On</span><span class=\"o\">-</span><span class=\"n\">line</span><span class=\"w\"> </span><span class=\"n\">CPU</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">list</span>:                <span class=\"mi\">0</span><span class=\"o\">-</span><span class=\"mi\">5</span>\n<span class=\"n\">Thread</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">per</span><span class=\"w\"> </span><span class=\"n\">core</span>:                 <span class=\"mi\">1</span>\n<span class=\"n\">Core</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">per</span><span class=\"w\"> </span><span class=\"n\">socket</span>:                 <span class=\"mi\">6</span>\n<span class=\"n\">Socket</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">)</span>:                          <span class=\"mi\">1</span>\n<span class=\"n\">NUMA</span><span class=\"w\"> </span><span class=\"n\">node</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">)</span>:                       <span class=\"mi\">1</span>\n<span class=\"n\">Vendor</span><span class=\"w\"> </span><span class=\"n\">ID</span>:                          <span class=\"nc\">GenuineIntel</span>\n<span class=\"n\">CPU</span><span class=\"w\"> </span><span class=\"n\">family</span>:                         <span class=\"mi\">6</span>\n<span class=\"n\">Model</span>:                              <span class=\"mi\">158</span>\n<span class=\"n\">Model</span><span class=\"w\"> </span><span class=\"n\">name</span>:                         <span class=\"nc\">Intel</span><span class=\"p\">(</span><span class=\"n\">R</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">Core</span><span class=\"p\">(</span><span class=\"n\">TM</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">i5</span><span class=\"o\">-</span><span class=\"mi\">9500</span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"n\">CPU</span><span class=\"w\"> </span><span class=\"o\">@</span><span class=\"w\"> </span><span class=\"mf\">2.20</span><span class=\"n\">GHz</span>\n<span class=\"n\">Stepping</span>:                           <span class=\"mi\">10</span>\n<span class=\"n\">CPU</span><span class=\"w\"> </span><span class=\"n\">MHz</span>:                            <span class=\"mf\">2200.000</span>\n<span class=\"n\">CPU</span><span class=\"w\"> </span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"n\">MHz</span>:                        <span class=\"mf\">3700.0000</span>\n<span class=\"n\">CPU</span><span class=\"w\"> </span><span class=\"n\">min</span><span class=\"w\"> </span><span class=\"n\">MHz</span>:                        <span class=\"mf\">800.0000</span>\n<span class=\"n\">BogoMIPS</span>:                           <span class=\"mf\">4399.99</span>\n<span class=\"n\">Virtualization</span>:                     <span class=\"nc\">VT</span><span class=\"o\">-</span><span class=\"n\">x</span>\n<span class=\"n\">L1d</span><span class=\"w\"> </span><span class=\"n\">cache</span>:                          <span class=\"mi\">192</span><span class=\"w\"> </span><span class=\"n\">KiB</span>\n<span class=\"n\">L1i</span><span class=\"w\"> </span><span class=\"n\">cache</span>:                          <span class=\"mi\">192</span><span class=\"w\"> </span><span class=\"n\">KiB</span>\n<span class=\"n\">L2</span><span class=\"w\"> </span><span class=\"n\">cache</span>:                           <span class=\"mf\">1.5</span><span class=\"w\"> </span><span class=\"n\">MiB</span>\n<span class=\"n\">L3</span><span class=\"w\"> </span><span class=\"n\">cache</span>:                           <span class=\"mi\">9</span><span class=\"w\"> </span><span class=\"n\">MiB</span>\n<span class=\"n\">NUMA</span><span class=\"w\"> </span><span class=\"n\">node0</span><span class=\"w\"> </span><span class=\"n\">CPU</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">)</span>:                  <span class=\"mi\">0</span><span class=\"o\">-</span><span class=\"mi\">5</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Gather</span><span class=\"w\"> </span><span class=\"n\">data</span><span class=\"w\"> </span><span class=\"n\">sampling</span>: <span class=\"nc\">Mitigation</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">Microcode</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Itlb</span><span class=\"w\"> </span><span class=\"n\">multihit</span>:        <span class=\"nc\">KVM</span>: <span class=\"nc\">Mitigation</span>: <span class=\"nc\">VMX</span><span class=\"w\"> </span><span class=\"n\">disabled</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">L1tf</span>:                 <span class=\"nc\">Mitigation</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">PTE</span><span class=\"w\"> </span><span class=\"n\">Inversion</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">VMX</span><span class=\"w\"> </span><span class=\"n\">conditional</span><span class=\"w\"> </span><span class=\"n\">cache</span><span class=\"w\"> </span><span class=\"n\">flushes</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">SMT</span><span class=\"w\"> </span><span class=\"n\">disabled</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Mds</span>:                  <span class=\"nc\">Mitigation</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">Clear</span><span class=\"w\"> </span><span class=\"n\">CPU</span><span class=\"w\"> </span><span class=\"n\">buffers</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">SMT</span><span class=\"w\"> </span><span class=\"n\">disabled</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Meltdown</span>:             <span class=\"nc\">Mitigation</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">PTI</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Mmio</span><span class=\"w\"> </span><span class=\"n\">stale</span><span class=\"w\"> </span><span class=\"n\">data</span>:      <span class=\"nc\">Mitigation</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">Clear</span><span class=\"w\"> </span><span class=\"n\">CPU</span><span class=\"w\"> </span><span class=\"n\">buffers</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">SMT</span><span class=\"w\"> </span><span class=\"n\">disabled</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Retbleed</span>:             <span class=\"nc\">Mitigation</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">IBRS</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Spec</span><span class=\"w\"> </span><span class=\"n\">rstack</span><span class=\"w\"> </span><span class=\"n\">overflow</span>: <span class=\"nc\">Not</span><span class=\"w\"> </span><span class=\"n\">affected</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Spec</span><span class=\"w\"> </span><span class=\"n\">store</span><span class=\"w\"> </span><span class=\"n\">bypass</span>:    <span class=\"nc\">Mitigation</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">Speculative</span><span class=\"w\"> </span><span class=\"n\">Store</span><span class=\"w\"> </span><span class=\"n\">Bypass</span><span class=\"w\"> </span><span class=\"n\">disabled</span><span class=\"w\"> </span><span class=\"n\">via</span><span class=\"w\"> </span><span class=\"n\">prctl</span><span class=\"w\"> </span><span class=\"n\">and</span><span class=\"w\"> </span><span class=\"n\">seccomp</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Spectre</span><span class=\"w\"> </span><span class=\"n\">v1</span>:           <span class=\"nc\">Mitigation</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">usercopy</span><span class=\"o\">/</span><span class=\"n\">swapgs</span><span class=\"w\"> </span><span class=\"n\">barriers</span><span class=\"w\"> </span><span class=\"n\">and</span><span class=\"w\"> </span><span class=\"n\">__user</span><span class=\"w\"> </span><span class=\"n\">pointer</span><span class=\"w\"> </span><span class=\"n\">sanitization</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Spectre</span><span class=\"w\"> </span><span class=\"n\">v2</span>:           <span class=\"nc\">Mitigation</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">IBRS</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">IBPB</span><span class=\"w\"> </span><span class=\"n\">conditional</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">STIBP</span><span class=\"w\"> </span><span class=\"n\">disabled</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">RSB</span><span class=\"w\"> </span><span class=\"n\">filling</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">PBRSB</span><span class=\"o\">-</span><span class=\"n\">eIBRS</span><span class=\"w\"> </span><span class=\"n\">Not</span><span class=\"w\"> </span><span class=\"n\">affected</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Srbds</span>:                <span class=\"nc\">Mitigation</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">Microcode</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Tsx</span><span class=\"w\"> </span><span class=\"k\">async</span><span class=\"w\"> </span><span class=\"n\">abort</span>:      <span class=\"nc\">Mitigation</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">TSX</span><span class=\"w\"> </span><span class=\"n\">disabled</span>\n<span class=\"n\">Flags</span>:                              <span class=\"nc\">fpu</span><span class=\"w\"> </span><span class=\"n\">vme</span><span class=\"w\"> </span><span class=\"n\">de</span><span class=\"w\"> </span><span class=\"n\">pse</span><span class=\"w\"> </span><span class=\"n\">tsc</span><span class=\"w\"> </span><span class=\"n\">msr</span><span class=\"w\"> </span><span class=\"n\">pae</span><span class=\"w\"> </span><span class=\"n\">mce</span><span class=\"w\"> </span><span class=\"n\">cx8</span><span class=\"w\"> </span><span class=\"n\">apic</span><span class=\"w\"> </span><span class=\"n\">sep</span><span class=\"w\"> </span><span class=\"n\">mtrr</span><span class=\"w\"> </span><span class=\"n\">pge</span><span class=\"w\"> </span><span class=\"n\">mca</span><span class=\"w\"> </span><span class=\"n\">cmov</span><span class=\"w\"> </span><span class=\"n\">pat</span><span class=\"w\"> </span><span class=\"n\">pse36</span><span class=\"w\"> </span><span class=\"n\">clflush</span><span class=\"w\"> </span><span class=\"n\">dts</span><span class=\"w\"> </span><span class=\"n\">acpi</span><span class=\"w\"> </span><span class=\"n\">mmx</span><span class=\"w\"> </span><span class=\"n\">fxsr</span><span class=\"w\"> </span><span class=\"n\">sse</span><span class=\"w\"> </span><span class=\"n\">sse2</span><span class=\"w\"> </span><span class=\"n\">ss</span><span class=\"w\"> </span><span class=\"n\">ht</span><span class=\"w\"> </span><span class=\"n\">tm</span><span class=\"w\"> </span><span class=\"n\">pbe</span><span class=\"w\"> </span><span class=\"n\">syscal</span>\n<span class=\"w\">                                    </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"n\">nx</span><span class=\"w\"> </span><span class=\"n\">pdpe1gb</span><span class=\"w\"> </span><span class=\"n\">rdtscp</span><span class=\"w\"> </span><span class=\"n\">lm</span><span class=\"w\"> </span><span class=\"n\">constant_tsc</span><span class=\"w\"> </span><span class=\"n\">art</span><span class=\"w\"> </span><span class=\"n\">arch_perfmon</span><span class=\"w\"> </span><span class=\"n\">pebs</span><span class=\"w\"> </span><span class=\"n\">bts</span><span class=\"w\"> </span><span class=\"n\">rep_good</span><span class=\"w\"> </span><span class=\"n\">nopl</span><span class=\"w\"> </span><span class=\"n\">xtopology</span><span class=\"w\"> </span><span class=\"n\">nonstop_tsc</span><span class=\"w\"> </span><span class=\"n\">cpuid</span><span class=\"w\"> </span><span class=\"n\">aperfmperf</span><span class=\"w\"> </span><span class=\"n\">pni</span><span class=\"w\"> </span><span class=\"n\">pclmulq</span>\n<span class=\"w\">                                    </span><span class=\"n\">dq</span><span class=\"w\"> </span><span class=\"n\">dtes64</span><span class=\"w\"> </span><span class=\"n\">monitor</span><span class=\"w\"> </span><span class=\"n\">ds_cpl</span><span class=\"w\"> </span><span class=\"n\">vmx</span><span class=\"w\"> </span><span class=\"n\">smx</span><span class=\"w\"> </span><span class=\"n\">est</span><span class=\"w\"> </span><span class=\"n\">tm2</span><span class=\"w\"> </span><span class=\"n\">ssse3</span><span class=\"w\"> </span><span class=\"n\">sdbg</span><span class=\"w\"> </span><span class=\"n\">fma</span><span class=\"w\"> </span><span class=\"n\">cx16</span><span class=\"w\"> </span><span class=\"n\">xtpr</span><span class=\"w\"> </span><span class=\"n\">pdcm</span><span class=\"w\"> </span><span class=\"n\">pcid</span><span class=\"w\"> </span><span class=\"n\">sse4_1</span><span class=\"w\"> </span><span class=\"n\">sse4_2</span><span class=\"w\"> </span><span class=\"n\">x2apic</span><span class=\"w\"> </span><span class=\"n\">movbe</span><span class=\"w\"> </span><span class=\"n\">popcnt</span><span class=\"w\"> </span><span class=\"n\">tsc_deadline_tim</span>\n<span class=\"w\">                                    </span><span class=\"n\">er</span><span class=\"w\"> </span><span class=\"n\">aes</span><span class=\"w\"> </span><span class=\"n\">xsave</span><span class=\"w\"> </span><span class=\"n\">avx</span><span class=\"w\"> </span><span class=\"n\">f16c</span><span class=\"w\"> </span><span class=\"n\">rdrand</span><span class=\"w\"> </span><span class=\"n\">lahf_lm</span><span class=\"w\"> </span><span class=\"n\">abm</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"n\">dnowprefetch</span><span class=\"w\"> </span><span class=\"n\">cpuid_fault</span><span class=\"w\"> </span><span class=\"n\">epb</span><span class=\"w\"> </span><span class=\"n\">invpcid_single</span><span class=\"w\"> </span><span class=\"n\">pti</span><span class=\"w\"> </span><span class=\"n\">ssbd</span><span class=\"w\"> </span><span class=\"n\">ibrs</span><span class=\"w\"> </span><span class=\"n\">ibpb</span><span class=\"w\"> </span><span class=\"n\">stibp</span><span class=\"w\"> </span><span class=\"n\">tpr_shadow</span><span class=\"w\"> </span><span class=\"n\">vnmi</span>\n<span class=\"w\">                                     </span><span class=\"n\">flexpriority</span><span class=\"w\"> </span><span class=\"n\">ept</span><span class=\"w\"> </span><span class=\"n\">vpid</span><span class=\"w\"> </span><span class=\"n\">ept_ad</span><span class=\"w\"> </span><span class=\"n\">fsgsbase</span><span class=\"w\"> </span><span class=\"n\">tsc_adjust</span><span class=\"w\"> </span><span class=\"n\">bmi1</span><span class=\"w\"> </span><span class=\"n\">avx2</span><span class=\"w\"> </span><span class=\"n\">smep</span><span class=\"w\"> </span><span class=\"n\">bmi2</span><span class=\"w\"> </span><span class=\"n\">erms</span><span class=\"w\"> </span><span class=\"n\">invpcid</span><span class=\"w\"> </span><span class=\"n\">mpx</span><span class=\"w\"> </span><span class=\"n\">rdseed</span><span class=\"w\"> </span><span class=\"n\">adx</span><span class=\"w\"> </span><span class=\"n\">smap</span><span class=\"w\"> </span><span class=\"n\">clflushopt</span><span class=\"w\"> </span><span class=\"n\">intel_pt</span><span class=\"w\"> </span><span class=\"n\">xsa</span>\n<span class=\"w\">                                    </span><span class=\"n\">veopt</span><span class=\"w\"> </span><span class=\"n\">xsavec</span><span class=\"w\"> </span><span class=\"n\">xgetbv1</span><span class=\"w\"> </span><span class=\"n\">xsaves</span><span class=\"w\"> </span><span class=\"n\">dtherm</span><span class=\"w\"> </span><span class=\"n\">ida</span><span class=\"w\"> </span><span class=\"n\">arat</span><span class=\"w\"> </span><span class=\"n\">pln</span><span class=\"w\"> </span><span class=\"n\">pts</span><span class=\"w\"> </span><span class=\"n\">hwp</span><span class=\"w\"> </span><span class=\"n\">hwp_notify</span><span class=\"w\"> </span><span class=\"n\">hwp_act_window</span><span class=\"w\"> </span><span class=\"n\">hwp_epp</span><span class=\"w\"> </span><span class=\"n\">md_clear</span><span class=\"w\"> </span><span class=\"n\">flush_l1d</span><span class=\"w\"> </span><span class=\"n\">arch_capabilities</span>\n</code></pre></div>\n<p><a href=\"https://github.com/bytecodealliance/wasmtime/files/13051519/reduce.zip\">reduce.zip</a><br>\n</p>\n</blockquote>",
        "id": 397649780,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1697787774
    },
    {
        "content": "<p>hungryzzz edited a <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7246#issuecomment-1772242886\">comment</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7246\">issue #7246</a>:</p>\n<blockquote>\n<p>@alexcrichton Hi, I try to reduce the above <code>wasm</code> bytecode to get a buggy case as shortest as possible, the reduced results are attached. The execute time in <code>Wasmer</code> and <code>Wasmtime</code> still have a big difference:</p>\n<ul>\n<li><code>Wasmer</code>: 0.67s</li>\n<li><code>Wasmtime</code>: 12.24s</li>\n</ul>\n<p>But I find that the performance regression is not only related to the <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7283\">https://github.com/bytecodealliance/wasmtime/issues/7283</a>, because if I change the constant in <code>f64.const 5.43231e-312</code> to <code>f64.const 5.4</code>, the execution time will back to normal(but indeed, the loop-invariant code will be sinked into loop in the corresponding binary generated by <code>Wasmtime</code>):</p>\n<ul>\n<li><code>Wasmer</code>: 0.70s</li>\n<li><code>Wasmtime</code>: 0.34s</li>\n</ul>\n<p>By the way, I also check the binary generated by <code>LLVM</code>, I find that the whole computation will be optimized to empty(I think  because there is nothing depends on the result of the loop).</p>\n<p>I think it is also a strange case I cannot understand and explain...</p>\n<div class=\"codehilite\" data-code-language=\"WebAssembly\"><pre><span></span><code><span class=\"c1\">;; reduce.wat</span>\n<span class=\"p\">(</span><span class=\"k\">module</span>\n  <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"cm\">(;0;)</span> <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"p\">(</span><span class=\"k\">param</span> <span class=\"kt\">i32</span><span class=\"p\">)))</span>\n  <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"cm\">(;1;)</span> <span class=\"p\">(</span><span class=\"k\">func</span><span class=\"p\">))</span>\n  <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"cm\">(;2;)</span> <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"p\">(</span><span class=\"k\">result</span> <span class=\"kt\">i32</span><span class=\"p\">)))</span>\n  <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"cm\">(;3;)</span> <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"p\">(</span><span class=\"k\">param</span> <span class=\"kt\">i32</span><span class=\"p\">)</span> <span class=\"p\">(</span><span class=\"k\">result</span> <span class=\"kt\">i32</span><span class=\"p\">)))</span>\n  <span class=\"p\">(</span><span class=\"k\">import</span> <span class=\"s2\">\"wasi_snapshot_preview1\"</span> <span class=\"s2\">\"proc_exit\"</span> <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"cm\">(;0;)</span> <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"mi\">0</span><span class=\"p\">)))</span>\n  <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"cm\">(;2;)</span> <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"mi\">1</span><span class=\"p\">)</span>\n    <span class=\"nb\">call</span> <span class=\"mi\">2</span>\n    <span class=\"nb\">i32.const</span> <span class=\"mi\">0</span>\n    <span class=\"nb\">call</span> <span class=\"mi\">0</span>\n    <span class=\"nb\">unreachable</span><span class=\"p\">)</span>\n  <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"cm\">(;2;)</span> <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"mi\">1</span><span class=\"p\">)</span>\n    <span class=\"p\">(</span><span class=\"k\">local</span> <span class=\"kt\">f64</span> <span class=\"kt\">f64</span> <span class=\"kt\">i32</span><span class=\"p\">)</span>\n    <span class=\"nb\">f64.const</span> <span class=\"mf\">5.43231e-312</span> <span class=\"c1\">;; Magic Number!!!</span>\n    <span class=\"nb\">f64.const</span> <span class=\"mf\">1.0</span>\n    <span class=\"nb\">f64.mul</span>\n    <span class=\"nb\">local.set</span> <span class=\"mi\">1</span>\n    <span class=\"k\">loop</span>  <span class=\"c1\">;; label = @1</span>\n      <span class=\"nb\">local.get</span> <span class=\"mi\">1</span>\n      <span class=\"nb\">local.get</span> <span class=\"mi\">0</span>\n      <span class=\"nb\">f64.add</span>\n      <span class=\"nb\">local.set</span> <span class=\"mi\">0</span>\n      <span class=\"nb\">local.get</span> <span class=\"mi\">2</span>   <span class=\"c1\">;; condition variable i</span>\n      <span class=\"nb\">i32.const</span> <span class=\"mi\">1</span>\n      <span class=\"nb\">i32.add</span>\n      <span class=\"nb\">local.tee</span> <span class=\"mi\">2</span>   <span class=\"c1\">;; i++</span>\n      <span class=\"nb\">i32.const</span> <span class=\"mf\">312500000</span>\n      <span class=\"nb\">i32.ne</span>\n      <span class=\"nb\">br_if</span> <span class=\"mi\">0</span> <span class=\"cm\">(;@1;)</span>\n    <span class=\"k\">end</span>\n  <span class=\"p\">)</span>\n  <span class=\"p\">(</span><span class=\"k\">table</span> <span class=\"cm\">(;0;)</span> <span class=\"mf\">2 2</span> <span class=\"k\">funcref</span><span class=\"p\">)</span>\n  <span class=\"p\">(</span><span class=\"k\">memory</span> <span class=\"cm\">(;0;)</span> <span class=\"mf\">8192</span> <span class=\"mf\">8192</span><span class=\"p\">)</span>\n  <span class=\"p\">(</span><span class=\"k\">global</span> <span class=\"cm\">(;0;)</span> <span class=\"p\">(</span><span class=\"k\">mut</span> <span class=\"kt\">i32</span><span class=\"p\">)</span> <span class=\"p\">(</span><span class=\"nb\">i32.const</span> <span class=\"mf\">66576</span><span class=\"p\">))</span>\n  <span class=\"p\">(</span><span class=\"k\">export</span> <span class=\"s2\">\"memory\"</span> <span class=\"p\">(</span><span class=\"k\">memory</span> <span class=\"mi\">0</span><span class=\"p\">))</span>\n  <span class=\"p\">(</span><span class=\"k\">export</span> <span class=\"s2\">\"__indirect_function_table\"</span> <span class=\"p\">(</span><span class=\"k\">table</span> <span class=\"mi\">0</span><span class=\"p\">))</span>\n  <span class=\"p\">(</span><span class=\"k\">export</span> <span class=\"s2\">\"_start\"</span> <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"mi\">1</span><span class=\"p\">)))</span>\n</code></pre></div>\n<h3>Environment Version</h3>\n<ul>\n<li><code>Wasmer</code>: wasmer 4.1.2 (98188df 2023-09-19)<br>\nbinary: wasmer-cli<br>\ncommit-hash: 98188df80096dfc7134ce202731878cf9d8f6f4e<br>\ncommit-date: 2023-09-19<br>\nhost: x86_64-unknown-linux-gnu<br>\ncompiler: singlepass,cranelift,llvm</li>\n<li><code>Wasmtime</code>: build from 8e00cc202f82445a42adbad6e8187e901f91833b (release version)</li>\n<li>CPU</li>\n</ul>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"err\">âžœ</span><span class=\"w\">  </span><span class=\"o\">~</span><span class=\"w\"> </span><span class=\"n\">lscpu</span>\n<span class=\"n\">Architecture</span>:                       <span class=\"nc\">x86_64</span>\n<span class=\"n\">CPU</span><span class=\"w\"> </span><span class=\"n\">op</span><span class=\"o\">-</span><span class=\"n\">mode</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">)</span>:                     <span class=\"mi\">32</span><span class=\"o\">-</span><span class=\"n\">bit</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">64</span><span class=\"o\">-</span><span class=\"n\">bit</span>\n<span class=\"n\">Byte</span><span class=\"w\"> </span><span class=\"n\">Order</span>:                         <span class=\"nc\">Little</span><span class=\"w\"> </span><span class=\"n\">Endian</span>\n<span class=\"n\">Address</span><span class=\"w\"> </span><span class=\"n\">sizes</span>:                      <span class=\"mi\">39</span><span class=\"w\"> </span><span class=\"n\">bits</span><span class=\"w\"> </span><span class=\"n\">physical</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">48</span><span class=\"w\"> </span><span class=\"n\">bits</span><span class=\"w\"> </span><span class=\"kr\">virtual</span>\n<span class=\"n\">CPU</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">)</span>:                             <span class=\"mi\">6</span>\n<span class=\"n\">On</span><span class=\"o\">-</span><span class=\"n\">line</span><span class=\"w\"> </span><span class=\"n\">CPU</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">list</span>:                <span class=\"mi\">0</span><span class=\"o\">-</span><span class=\"mi\">5</span>\n<span class=\"n\">Thread</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">per</span><span class=\"w\"> </span><span class=\"n\">core</span>:                 <span class=\"mi\">1</span>\n<span class=\"n\">Core</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">per</span><span class=\"w\"> </span><span class=\"n\">socket</span>:                 <span class=\"mi\">6</span>\n<span class=\"n\">Socket</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">)</span>:                          <span class=\"mi\">1</span>\n<span class=\"n\">NUMA</span><span class=\"w\"> </span><span class=\"n\">node</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">)</span>:                       <span class=\"mi\">1</span>\n<span class=\"n\">Vendor</span><span class=\"w\"> </span><span class=\"n\">ID</span>:                          <span class=\"nc\">GenuineIntel</span>\n<span class=\"n\">CPU</span><span class=\"w\"> </span><span class=\"n\">family</span>:                         <span class=\"mi\">6</span>\n<span class=\"n\">Model</span>:                              <span class=\"mi\">158</span>\n<span class=\"n\">Model</span><span class=\"w\"> </span><span class=\"n\">name</span>:                         <span class=\"nc\">Intel</span><span class=\"p\">(</span><span class=\"n\">R</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">Core</span><span class=\"p\">(</span><span class=\"n\">TM</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">i5</span><span class=\"o\">-</span><span class=\"mi\">9500</span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"n\">CPU</span><span class=\"w\"> </span><span class=\"o\">@</span><span class=\"w\"> </span><span class=\"mf\">2.20</span><span class=\"n\">GHz</span>\n<span class=\"n\">Stepping</span>:                           <span class=\"mi\">10</span>\n<span class=\"n\">CPU</span><span class=\"w\"> </span><span class=\"n\">MHz</span>:                            <span class=\"mf\">2200.000</span>\n<span class=\"n\">CPU</span><span class=\"w\"> </span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"n\">MHz</span>:                        <span class=\"mf\">3700.0000</span>\n<span class=\"n\">CPU</span><span class=\"w\"> </span><span class=\"n\">min</span><span class=\"w\"> </span><span class=\"n\">MHz</span>:                        <span class=\"mf\">800.0000</span>\n<span class=\"n\">BogoMIPS</span>:                           <span class=\"mf\">4399.99</span>\n<span class=\"n\">Virtualization</span>:                     <span class=\"nc\">VT</span><span class=\"o\">-</span><span class=\"n\">x</span>\n<span class=\"n\">L1d</span><span class=\"w\"> </span><span class=\"n\">cache</span>:                          <span class=\"mi\">192</span><span class=\"w\"> </span><span class=\"n\">KiB</span>\n<span class=\"n\">L1i</span><span class=\"w\"> </span><span class=\"n\">cache</span>:                          <span class=\"mi\">192</span><span class=\"w\"> </span><span class=\"n\">KiB</span>\n<span class=\"n\">L2</span><span class=\"w\"> </span><span class=\"n\">cache</span>:                           <span class=\"mf\">1.5</span><span class=\"w\"> </span><span class=\"n\">MiB</span>\n<span class=\"n\">L3</span><span class=\"w\"> </span><span class=\"n\">cache</span>:                           <span class=\"mi\">9</span><span class=\"w\"> </span><span class=\"n\">MiB</span>\n<span class=\"n\">NUMA</span><span class=\"w\"> </span><span class=\"n\">node0</span><span class=\"w\"> </span><span class=\"n\">CPU</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">)</span>:                  <span class=\"mi\">0</span><span class=\"o\">-</span><span class=\"mi\">5</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Gather</span><span class=\"w\"> </span><span class=\"n\">data</span><span class=\"w\"> </span><span class=\"n\">sampling</span>: <span class=\"nc\">Mitigation</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">Microcode</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Itlb</span><span class=\"w\"> </span><span class=\"n\">multihit</span>:        <span class=\"nc\">KVM</span>: <span class=\"nc\">Mitigation</span>: <span class=\"nc\">VMX</span><span class=\"w\"> </span><span class=\"n\">disabled</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">L1tf</span>:                 <span class=\"nc\">Mitigation</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">PTE</span><span class=\"w\"> </span><span class=\"n\">Inversion</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">VMX</span><span class=\"w\"> </span><span class=\"n\">conditional</span><span class=\"w\"> </span><span class=\"n\">cache</span><span class=\"w\"> </span><span class=\"n\">flushes</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">SMT</span><span class=\"w\"> </span><span class=\"n\">disabled</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Mds</span>:                  <span class=\"nc\">Mitigation</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">Clear</span><span class=\"w\"> </span><span class=\"n\">CPU</span><span class=\"w\"> </span><span class=\"n\">buffers</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">SMT</span><span class=\"w\"> </span><span class=\"n\">disabled</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Meltdown</span>:             <span class=\"nc\">Mitigation</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">PTI</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Mmio</span><span class=\"w\"> </span><span class=\"n\">stale</span><span class=\"w\"> </span><span class=\"n\">data</span>:      <span class=\"nc\">Mitigation</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">Clear</span><span class=\"w\"> </span><span class=\"n\">CPU</span><span class=\"w\"> </span><span class=\"n\">buffers</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">SMT</span><span class=\"w\"> </span><span class=\"n\">disabled</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Retbleed</span>:             <span class=\"nc\">Mitigation</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">IBRS</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Spec</span><span class=\"w\"> </span><span class=\"n\">rstack</span><span class=\"w\"> </span><span class=\"n\">overflow</span>: <span class=\"nc\">Not</span><span class=\"w\"> </span><span class=\"n\">affected</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Spec</span><span class=\"w\"> </span><span class=\"n\">store</span><span class=\"w\"> </span><span class=\"n\">bypass</span>:    <span class=\"nc\">Mitigation</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">Speculative</span><span class=\"w\"> </span><span class=\"n\">Store</span><span class=\"w\"> </span><span class=\"n\">Bypass</span><span class=\"w\"> </span><span class=\"n\">disabled</span><span class=\"w\"> </span><span class=\"n\">via</span><span class=\"w\"> </span><span class=\"n\">prctl</span><span class=\"w\"> </span><span class=\"n\">and</span><span class=\"w\"> </span><span class=\"n\">seccomp</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Spectre</span><span class=\"w\"> </span><span class=\"n\">v1</span>:           <span class=\"nc\">Mitigation</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">usercopy</span><span class=\"o\">/</span><span class=\"n\">swapgs</span><span class=\"w\"> </span><span class=\"n\">barriers</span><span class=\"w\"> </span><span class=\"n\">and</span><span class=\"w\"> </span><span class=\"n\">__user</span><span class=\"w\"> </span><span class=\"n\">pointer</span><span class=\"w\"> </span><span class=\"n\">sanitization</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Spectre</span><span class=\"w\"> </span><span class=\"n\">v2</span>:           <span class=\"nc\">Mitigation</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">IBRS</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">IBPB</span><span class=\"w\"> </span><span class=\"n\">conditional</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">STIBP</span><span class=\"w\"> </span><span class=\"n\">disabled</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">RSB</span><span class=\"w\"> </span><span class=\"n\">filling</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">PBRSB</span><span class=\"o\">-</span><span class=\"n\">eIBRS</span><span class=\"w\"> </span><span class=\"n\">Not</span><span class=\"w\"> </span><span class=\"n\">affected</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Srbds</span>:                <span class=\"nc\">Mitigation</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">Microcode</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Tsx</span><span class=\"w\"> </span><span class=\"k\">async</span><span class=\"w\"> </span><span class=\"n\">abort</span>:      <span class=\"nc\">Mitigation</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">TSX</span><span class=\"w\"> </span><span class=\"n\">disabled</span>\n<span class=\"n\">Flags</span>:                              <span class=\"nc\">fpu</span><span class=\"w\"> </span><span class=\"n\">vme</span><span class=\"w\"> </span><span class=\"n\">de</span><span class=\"w\"> </span><span class=\"n\">pse</span><span class=\"w\"> </span><span class=\"n\">tsc</span><span class=\"w\"> </span><span class=\"n\">msr</span><span class=\"w\"> </span><span class=\"n\">pae</span><span class=\"w\"> </span><span class=\"n\">mce</span><span class=\"w\"> </span><span class=\"n\">cx8</span><span class=\"w\"> </span><span class=\"n\">apic</span><span class=\"w\"> </span><span class=\"n\">sep</span><span class=\"w\"> </span><span class=\"n\">mtrr</span><span class=\"w\"> </span><span class=\"n\">pge</span><span class=\"w\"> </span><span class=\"n\">mca</span><span class=\"w\"> </span><span class=\"n\">cmov</span><span class=\"w\"> </span><span class=\"n\">pat</span><span class=\"w\"> </span><span class=\"n\">pse36</span><span class=\"w\"> </span><span class=\"n\">clflush</span><span class=\"w\"> </span><span class=\"n\">dts</span><span class=\"w\"> </span><span class=\"n\">acpi</span><span class=\"w\"> </span><span class=\"n\">mmx</span><span class=\"w\"> </span><span class=\"n\">fxsr</span><span class=\"w\"> </span><span class=\"n\">sse</span><span class=\"w\"> </span><span class=\"n\">sse2</span><span class=\"w\"> </span><span class=\"n\">ss</span><span class=\"w\"> </span><span class=\"n\">ht</span><span class=\"w\"> </span><span class=\"n\">tm</span><span class=\"w\"> </span><span class=\"n\">pbe</span><span class=\"w\"> </span><span class=\"n\">syscal</span>\n<span class=\"w\">                                    </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"n\">nx</span><span class=\"w\"> </span><span class=\"n\">pdpe1gb</span><span class=\"w\"> </span><span class=\"n\">rdtscp</span><span class=\"w\"> </span><span class=\"n\">lm</span><span class=\"w\"> </span><span class=\"n\">constant_tsc</span><span class=\"w\"> </span><span class=\"n\">art</span><span class=\"w\"> </span><span class=\"n\">arch_perfmon</span><span class=\"w\"> </span><span class=\"n\">pebs</span><span class=\"w\"> </span><span class=\"n\">bts</span><span class=\"w\"> </span><span class=\"n\">rep_good</span><span class=\"w\"> </span><span class=\"n\">nopl</span><span class=\"w\"> </span><span class=\"n\">xtopology</span><span class=\"w\"> </span><span class=\"n\">nonstop_tsc</span><span class=\"w\"> </span><span class=\"n\">cpuid</span><span class=\"w\"> </span><span class=\"n\">aperfmperf</span><span class=\"w\"> </span><span class=\"n\">pni</span><span class=\"w\"> </span><span class=\"n\">pclmulq</span>\n<span class=\"w\">                                    </span><span class=\"n\">dq</span><span class=\"w\"> </span><span class=\"n\">dtes64</span><span class=\"w\"> </span><span class=\"n\">monitor</span><span class=\"w\"> </span><span class=\"n\">ds_cpl</span><span class=\"w\"> </span><span class=\"n\">vmx</span><span class=\"w\"> </span><span class=\"n\">smx</span><span class=\"w\"> </span><span class=\"n\">est</span><span class=\"w\"> </span><span class=\"n\">tm2</span><span class=\"w\"> </span><span class=\"n\">ssse3</span><span class=\"w\"> </span><span class=\"n\">sdbg</span><span class=\"w\"> </span><span class=\"n\">fma</span><span class=\"w\"> </span><span class=\"n\">cx16</span><span class=\"w\"> </span><span class=\"n\">xtpr</span><span class=\"w\"> </span><span class=\"n\">pdcm</span><span class=\"w\"> </span><span class=\"n\">pcid</span><span class=\"w\"> </span><span class=\"n\">sse4_1</span><span class=\"w\"> </span><span class=\"n\">sse4_2</span><span class=\"w\"> </span><span class=\"n\">x2apic</span><span class=\"w\"> </span><span class=\"n\">movbe</span><span class=\"w\"> </span><span class=\"n\">popcnt</span><span class=\"w\"> </span><span class=\"n\">tsc_deadline_tim</span>\n<span class=\"w\">                                    </span><span class=\"n\">er</span><span class=\"w\"> </span><span class=\"n\">aes</span><span class=\"w\"> </span><span class=\"n\">xsave</span><span class=\"w\"> </span><span class=\"n\">avx</span><span class=\"w\"> </span><span class=\"n\">f16c</span><span class=\"w\"> </span><span class=\"n\">rdrand</span><span class=\"w\"> </span><span class=\"n\">lahf_lm</span><span class=\"w\"> </span><span class=\"n\">abm</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"n\">dnowprefetch</span><span class=\"w\"> </span><span class=\"n\">cpuid_fault</span><span class=\"w\"> </span><span class=\"n\">epb</span><span class=\"w\"> </span><span class=\"n\">invpcid_single</span><span class=\"w\"> </span><span class=\"n\">pti</span><span class=\"w\"> </span><span class=\"n\">ssbd</span><span class=\"w\"> </span><span class=\"n\">ibrs</span><span class=\"w\"> </span><span class=\"n\">ibpb</span><span class=\"w\"> </span><span class=\"n\">stibp</span><span class=\"w\"> </span><span class=\"n\">tpr_shadow</span><span class=\"w\"> </span><span class=\"n\">vnmi</span>\n<span class=\"w\">                                     </span><span class=\"n\">flexpriority</span><span class=\"w\"> </span><span class=\"n\">ept</span><span class=\"w\"> </span><span class=\"n\">vpid</span><span class=\"w\"> </span><span class=\"n\">ept_ad</span><span class=\"w\"> </span><span class=\"n\">fsgsbase</span><span class=\"w\"> </span><span class=\"n\">tsc_adjust</span><span class=\"w\"> </span><span class=\"n\">bmi1</span><span class=\"w\"> </span><span class=\"n\">avx2</span><span class=\"w\"> </span><span class=\"n\">smep</span><span class=\"w\"> </span><span class=\"n\">bmi2</span><span class=\"w\"> </span><span class=\"n\">erms</span><span class=\"w\"> </span><span class=\"n\">invpcid</span><span class=\"w\"> </span><span class=\"n\">mpx</span><span class=\"w\"> </span><span class=\"n\">rdseed</span><span class=\"w\"> </span><span class=\"n\">adx</span><span class=\"w\"> </span><span class=\"n\">smap</span><span class=\"w\"> </span><span class=\"n\">clflushopt</span><span class=\"w\"> </span><span class=\"n\">intel_pt</span><span class=\"w\"> </span><span class=\"n\">xsa</span>\n<span class=\"w\">                                    </span><span class=\"n\">veopt</span><span class=\"w\"> </span><span class=\"n\">xsavec</span><span class=\"w\"> </span><span class=\"n\">xgetbv1</span><span class=\"w\"> </span><span class=\"n\">xsaves</span><span class=\"w\"> </span><span class=\"n\">dtherm</span><span class=\"w\"> </span><span class=\"n\">ida</span><span class=\"w\"> </span><span class=\"n\">arat</span><span class=\"w\"> </span><span class=\"n\">pln</span><span class=\"w\"> </span><span class=\"n\">pts</span><span class=\"w\"> </span><span class=\"n\">hwp</span><span class=\"w\"> </span><span class=\"n\">hwp_notify</span><span class=\"w\"> </span><span class=\"n\">hwp_act_window</span><span class=\"w\"> </span><span class=\"n\">hwp_epp</span><span class=\"w\"> </span><span class=\"n\">md_clear</span><span class=\"w\"> </span><span class=\"n\">flush_l1d</span><span class=\"w\"> </span><span class=\"n\">arch_capabilities</span>\n</code></pre></div>\n<p><a href=\"https://github.com/bytecodealliance/wasmtime/files/13051519/reduce.zip\">reduce.zip</a><br>\n</p>\n</blockquote>",
        "id": 397650994,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1697788247
    },
    {
        "content": "<p>hungryzzz edited a <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7246#issuecomment-1772242886\">comment</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7246\">issue #7246</a>:</p>\n<blockquote>\n<p>@alexcrichton Hi, I try to reduce the above <code>wasm</code> bytecode to get a buggy case as shortest as possible, the reduced results are attached. The execute time in <code>Wasmer</code> and <code>Wasmtime</code> still have a big difference:</p>\n<ul>\n<li><code>Wasmer</code>: 0.67s</li>\n<li><code>Wasmtime</code>: 12.24s</li>\n</ul>\n<p>But I find that the performance regression is not only related to the <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7283\">https://github.com/bytecodealliance/wasmtime/issues/7283</a>, because if I change the constant in <code>f64.const 5.43231e-312</code> to <code>f64.const 5.4</code>, the execution time will back to normal(but indeed, the loop-invariant code will be sinked into loop in the corresponding binary generated by <code>Wasmtime</code>):</p>\n<ul>\n<li><code>Wasmer</code>: 0.70s</li>\n<li><code>Wasmtime</code>: 0.34s</li>\n</ul>\n<p>By the way, I also check the binary generated by <code>LLVM</code>, I find that the whole computation will be optimized to empty(I think  because there is nothing depends on the result of the loop).</p>\n<p>I think it is also a strange case I cannot understand and explain...</p>\n<div class=\"codehilite\" data-code-language=\"WebAssembly\"><pre><span></span><code><span class=\"c1\">;; reduce.wat</span>\n<span class=\"p\">(</span><span class=\"k\">module</span>\n  <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"cm\">(;0;)</span> <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"p\">(</span><span class=\"k\">param</span> <span class=\"kt\">i32</span><span class=\"p\">)))</span>\n  <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"cm\">(;1;)</span> <span class=\"p\">(</span><span class=\"k\">func</span><span class=\"p\">))</span>\n  <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"cm\">(;2;)</span> <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"p\">(</span><span class=\"k\">result</span> <span class=\"kt\">i32</span><span class=\"p\">)))</span>\n  <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"cm\">(;3;)</span> <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"p\">(</span><span class=\"k\">param</span> <span class=\"kt\">i32</span><span class=\"p\">)</span> <span class=\"p\">(</span><span class=\"k\">result</span> <span class=\"kt\">i32</span><span class=\"p\">)))</span>\n  <span class=\"p\">(</span><span class=\"k\">import</span> <span class=\"s2\">\"wasi_snapshot_preview1\"</span> <span class=\"s2\">\"proc_exit\"</span> <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"cm\">(;0;)</span> <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"mi\">0</span><span class=\"p\">)))</span>\n  <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"cm\">(;2;)</span> <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"mi\">1</span><span class=\"p\">)</span>\n    <span class=\"nb\">call</span> <span class=\"mi\">2</span>\n    <span class=\"nb\">i32.const</span> <span class=\"mi\">0</span>\n    <span class=\"nb\">call</span> <span class=\"mi\">0</span>\n    <span class=\"nb\">unreachable</span><span class=\"p\">)</span>\n  <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"cm\">(;2;)</span> <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"mi\">1</span><span class=\"p\">)</span>\n    <span class=\"p\">(</span><span class=\"k\">local</span> <span class=\"kt\">f64</span> <span class=\"kt\">f64</span> <span class=\"kt\">i32</span><span class=\"p\">)</span>\n    <span class=\"nb\">f64.const</span> <span class=\"mf\">5.43231e-312</span> <span class=\"c1\">;; Magic Number!!!</span>\n    <span class=\"nb\">f64.const</span> <span class=\"mf\">1.0</span>\n    <span class=\"nb\">f64.mul</span>\n    <span class=\"nb\">local.set</span> <span class=\"mi\">1</span>\n    <span class=\"k\">loop</span>  <span class=\"c1\">;; label = @1</span>\n      <span class=\"nb\">local.get</span> <span class=\"mi\">1</span>\n      <span class=\"nb\">local.get</span> <span class=\"mi\">0</span>\n      <span class=\"nb\">f64.add</span>\n      <span class=\"nb\">local.set</span> <span class=\"mi\">0</span>\n      <span class=\"nb\">local.get</span> <span class=\"mi\">2</span>   <span class=\"c1\">;; condition variable i</span>\n      <span class=\"nb\">i32.const</span> <span class=\"mi\">1</span>\n      <span class=\"nb\">i32.add</span>\n      <span class=\"nb\">local.tee</span> <span class=\"mi\">2</span>   <span class=\"c1\">;; i++</span>\n      <span class=\"nb\">i32.const</span> <span class=\"mf\">312500000</span>\n      <span class=\"nb\">i32.ne</span>\n      <span class=\"nb\">br_if</span> <span class=\"mi\">0</span> <span class=\"cm\">(;@1;)</span>\n    <span class=\"k\">end</span>\n  <span class=\"p\">)</span>\n  <span class=\"p\">(</span><span class=\"k\">table</span> <span class=\"cm\">(;0;)</span> <span class=\"mf\">2 2</span> <span class=\"k\">funcref</span><span class=\"p\">)</span>\n  <span class=\"p\">(</span><span class=\"k\">memory</span> <span class=\"cm\">(;0;)</span> <span class=\"mf\">8192</span> <span class=\"mf\">8192</span><span class=\"p\">)</span>\n  <span class=\"p\">(</span><span class=\"k\">global</span> <span class=\"cm\">(;0;)</span> <span class=\"p\">(</span><span class=\"k\">mut</span> <span class=\"kt\">i32</span><span class=\"p\">)</span> <span class=\"p\">(</span><span class=\"nb\">i32.const</span> <span class=\"mf\">66576</span><span class=\"p\">))</span>\n  <span class=\"p\">(</span><span class=\"k\">export</span> <span class=\"s2\">\"memory\"</span> <span class=\"p\">(</span><span class=\"k\">memory</span> <span class=\"mi\">0</span><span class=\"p\">))</span>\n  <span class=\"p\">(</span><span class=\"k\">export</span> <span class=\"s2\">\"__indirect_function_table\"</span> <span class=\"p\">(</span><span class=\"k\">table</span> <span class=\"mi\">0</span><span class=\"p\">))</span>\n  <span class=\"p\">(</span><span class=\"k\">export</span> <span class=\"s2\">\"_start\"</span> <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"mi\">1</span><span class=\"p\">)))</span>\n</code></pre></div>\n<h3>Environment Version</h3>\n<ul>\n<li><code>Wasmer</code>: wasmer 4.1.2 (98188df 2023-09-19)<br>\nbinary: wasmer-cli<br>\ncommit-hash: 98188df80096dfc7134ce202731878cf9d8f6f4e<br>\ncommit-date: 2023-09-19<br>\nhost: x86_64-unknown-linux-gnu<br>\ncompiler: singlepass,cranelift,llvm</li>\n<li><code>Wasmtime</code>: build from 8e00cc202f82445a42adbad6e8187e901f91833b (release version)</li>\n<li>CPU</li>\n</ul>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"err\">âžœ</span><span class=\"w\">  </span><span class=\"o\">~</span><span class=\"w\"> </span><span class=\"n\">lscpu</span>\n<span class=\"n\">Architecture</span>:                       <span class=\"nc\">x86_64</span>\n<span class=\"n\">CPU</span><span class=\"w\"> </span><span class=\"n\">op</span><span class=\"o\">-</span><span class=\"n\">mode</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">)</span>:                     <span class=\"mi\">32</span><span class=\"o\">-</span><span class=\"n\">bit</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">64</span><span class=\"o\">-</span><span class=\"n\">bit</span>\n<span class=\"n\">Byte</span><span class=\"w\"> </span><span class=\"n\">Order</span>:                         <span class=\"nc\">Little</span><span class=\"w\"> </span><span class=\"n\">Endian</span>\n<span class=\"n\">Address</span><span class=\"w\"> </span><span class=\"n\">sizes</span>:                      <span class=\"mi\">39</span><span class=\"w\"> </span><span class=\"n\">bits</span><span class=\"w\"> </span><span class=\"n\">physical</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">48</span><span class=\"w\"> </span><span class=\"n\">bits</span><span class=\"w\"> </span><span class=\"kr\">virtual</span>\n<span class=\"n\">CPU</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">)</span>:                             <span class=\"mi\">6</span>\n<span class=\"n\">On</span><span class=\"o\">-</span><span class=\"n\">line</span><span class=\"w\"> </span><span class=\"n\">CPU</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">list</span>:                <span class=\"mi\">0</span><span class=\"o\">-</span><span class=\"mi\">5</span>\n<span class=\"n\">Thread</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">per</span><span class=\"w\"> </span><span class=\"n\">core</span>:                 <span class=\"mi\">1</span>\n<span class=\"n\">Core</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">per</span><span class=\"w\"> </span><span class=\"n\">socket</span>:                 <span class=\"mi\">6</span>\n<span class=\"n\">Socket</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">)</span>:                          <span class=\"mi\">1</span>\n<span class=\"n\">NUMA</span><span class=\"w\"> </span><span class=\"n\">node</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">)</span>:                       <span class=\"mi\">1</span>\n<span class=\"n\">Vendor</span><span class=\"w\"> </span><span class=\"n\">ID</span>:                          <span class=\"nc\">GenuineIntel</span>\n<span class=\"n\">CPU</span><span class=\"w\"> </span><span class=\"n\">family</span>:                         <span class=\"mi\">6</span>\n<span class=\"n\">Model</span>:                              <span class=\"mi\">158</span>\n<span class=\"n\">Model</span><span class=\"w\"> </span><span class=\"n\">name</span>:                         <span class=\"nc\">Intel</span><span class=\"p\">(</span><span class=\"n\">R</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">Core</span><span class=\"p\">(</span><span class=\"n\">TM</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">i5</span><span class=\"o\">-</span><span class=\"mi\">9500</span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"n\">CPU</span><span class=\"w\"> </span><span class=\"o\">@</span><span class=\"w\"> </span><span class=\"mf\">2.20</span><span class=\"n\">GHz</span>\n<span class=\"n\">Stepping</span>:                           <span class=\"mi\">10</span>\n<span class=\"n\">CPU</span><span class=\"w\"> </span><span class=\"n\">MHz</span>:                            <span class=\"mf\">2200.000</span>\n<span class=\"n\">CPU</span><span class=\"w\"> </span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"n\">MHz</span>:                        <span class=\"mf\">3700.0000</span>\n<span class=\"n\">CPU</span><span class=\"w\"> </span><span class=\"n\">min</span><span class=\"w\"> </span><span class=\"n\">MHz</span>:                        <span class=\"mf\">800.0000</span>\n<span class=\"n\">BogoMIPS</span>:                           <span class=\"mf\">4399.99</span>\n<span class=\"n\">Virtualization</span>:                     <span class=\"nc\">VT</span><span class=\"o\">-</span><span class=\"n\">x</span>\n<span class=\"n\">L1d</span><span class=\"w\"> </span><span class=\"n\">cache</span>:                          <span class=\"mi\">192</span><span class=\"w\"> </span><span class=\"n\">KiB</span>\n<span class=\"n\">L1i</span><span class=\"w\"> </span><span class=\"n\">cache</span>:                          <span class=\"mi\">192</span><span class=\"w\"> </span><span class=\"n\">KiB</span>\n<span class=\"n\">L2</span><span class=\"w\"> </span><span class=\"n\">cache</span>:                           <span class=\"mf\">1.5</span><span class=\"w\"> </span><span class=\"n\">MiB</span>\n<span class=\"n\">L3</span><span class=\"w\"> </span><span class=\"n\">cache</span>:                           <span class=\"mi\">9</span><span class=\"w\"> </span><span class=\"n\">MiB</span>\n<span class=\"n\">NUMA</span><span class=\"w\"> </span><span class=\"n\">node0</span><span class=\"w\"> </span><span class=\"n\">CPU</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">)</span>:                  <span class=\"mi\">0</span><span class=\"o\">-</span><span class=\"mi\">5</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Gather</span><span class=\"w\"> </span><span class=\"n\">data</span><span class=\"w\"> </span><span class=\"n\">sampling</span>: <span class=\"nc\">Mitigation</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">Microcode</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Itlb</span><span class=\"w\"> </span><span class=\"n\">multihit</span>:        <span class=\"nc\">KVM</span>: <span class=\"nc\">Mitigation</span>: <span class=\"nc\">VMX</span><span class=\"w\"> </span><span class=\"n\">disabled</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">L1tf</span>:                 <span class=\"nc\">Mitigation</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">PTE</span><span class=\"w\"> </span><span class=\"n\">Inversion</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">VMX</span><span class=\"w\"> </span><span class=\"n\">conditional</span><span class=\"w\"> </span><span class=\"n\">cache</span><span class=\"w\"> </span><span class=\"n\">flushes</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">SMT</span><span class=\"w\"> </span><span class=\"n\">disabled</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Mds</span>:                  <span class=\"nc\">Mitigation</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">Clear</span><span class=\"w\"> </span><span class=\"n\">CPU</span><span class=\"w\"> </span><span class=\"n\">buffers</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">SMT</span><span class=\"w\"> </span><span class=\"n\">disabled</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Meltdown</span>:             <span class=\"nc\">Mitigation</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">PTI</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Mmio</span><span class=\"w\"> </span><span class=\"n\">stale</span><span class=\"w\"> </span><span class=\"n\">data</span>:      <span class=\"nc\">Mitigation</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">Clear</span><span class=\"w\"> </span><span class=\"n\">CPU</span><span class=\"w\"> </span><span class=\"n\">buffers</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">SMT</span><span class=\"w\"> </span><span class=\"n\">disabled</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Retbleed</span>:             <span class=\"nc\">Mitigation</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">IBRS</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Spec</span><span class=\"w\"> </span><span class=\"n\">rstack</span><span class=\"w\"> </span><span class=\"n\">overflow</span>: <span class=\"nc\">Not</span><span class=\"w\"> </span><span class=\"n\">affected</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Spec</span><span class=\"w\"> </span><span class=\"n\">store</span><span class=\"w\"> </span><span class=\"n\">bypass</span>:    <span class=\"nc\">Mitigation</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">Speculative</span><span class=\"w\"> </span><span class=\"n\">Store</span><span class=\"w\"> </span><span class=\"n\">Bypass</span><span class=\"w\"> </span><span class=\"n\">disabled</span><span class=\"w\"> </span><span class=\"n\">via</span><span class=\"w\"> </span><span class=\"n\">prctl</span><span class=\"w\"> </span><span class=\"n\">and</span><span class=\"w\"> </span><span class=\"n\">seccomp</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Spectre</span><span class=\"w\"> </span><span class=\"n\">v1</span>:           <span class=\"nc\">Mitigation</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">usercopy</span><span class=\"o\">/</span><span class=\"n\">swapgs</span><span class=\"w\"> </span><span class=\"n\">barriers</span><span class=\"w\"> </span><span class=\"n\">and</span><span class=\"w\"> </span><span class=\"n\">__user</span><span class=\"w\"> </span><span class=\"n\">pointer</span><span class=\"w\"> </span><span class=\"n\">sanitization</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Spectre</span><span class=\"w\"> </span><span class=\"n\">v2</span>:           <span class=\"nc\">Mitigation</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">IBRS</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">IBPB</span><span class=\"w\"> </span><span class=\"n\">conditional</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">STIBP</span><span class=\"w\"> </span><span class=\"n\">disabled</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">RSB</span><span class=\"w\"> </span><span class=\"n\">filling</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">PBRSB</span><span class=\"o\">-</span><span class=\"n\">eIBRS</span><span class=\"w\"> </span><span class=\"n\">Not</span><span class=\"w\"> </span><span class=\"n\">affected</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Srbds</span>:                <span class=\"nc\">Mitigation</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">Microcode</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Tsx</span><span class=\"w\"> </span><span class=\"k\">async</span><span class=\"w\"> </span><span class=\"n\">abort</span>:      <span class=\"nc\">Mitigation</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">TSX</span><span class=\"w\"> </span><span class=\"n\">disabled</span>\n<span class=\"n\">Flags</span>:                              <span class=\"nc\">fpu</span><span class=\"w\"> </span><span class=\"n\">vme</span><span class=\"w\"> </span><span class=\"n\">de</span><span class=\"w\"> </span><span class=\"n\">pse</span><span class=\"w\"> </span><span class=\"n\">tsc</span><span class=\"w\"> </span><span class=\"n\">msr</span><span class=\"w\"> </span><span class=\"n\">pae</span><span class=\"w\"> </span><span class=\"n\">mce</span><span class=\"w\"> </span><span class=\"n\">cx8</span><span class=\"w\"> </span><span class=\"n\">apic</span><span class=\"w\"> </span><span class=\"n\">sep</span><span class=\"w\"> </span><span class=\"n\">mtrr</span><span class=\"w\"> </span><span class=\"n\">pge</span><span class=\"w\"> </span><span class=\"n\">mca</span><span class=\"w\"> </span><span class=\"n\">cmov</span><span class=\"w\"> </span><span class=\"n\">pat</span><span class=\"w\"> </span><span class=\"n\">pse36</span><span class=\"w\"> </span><span class=\"n\">clflush</span><span class=\"w\"> </span><span class=\"n\">dts</span><span class=\"w\"> </span><span class=\"n\">acpi</span><span class=\"w\"> </span><span class=\"n\">mmx</span><span class=\"w\"> </span><span class=\"n\">fxsr</span><span class=\"w\"> </span><span class=\"n\">sse</span><span class=\"w\"> </span><span class=\"n\">sse2</span><span class=\"w\"> </span><span class=\"n\">ss</span><span class=\"w\"> </span><span class=\"n\">ht</span><span class=\"w\"> </span><span class=\"n\">tm</span><span class=\"w\"> </span><span class=\"n\">pbe</span><span class=\"w\"> </span><span class=\"n\">syscal</span>\n<span class=\"w\">                                    </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"n\">nx</span><span class=\"w\"> </span><span class=\"n\">pdpe1gb</span><span class=\"w\"> </span><span class=\"n\">rdtscp</span><span class=\"w\"> </span><span class=\"n\">lm</span><span class=\"w\"> </span><span class=\"n\">constant_tsc</span><span class=\"w\"> </span><span class=\"n\">art</span><span class=\"w\"> </span><span class=\"n\">arch_perfmon</span><span class=\"w\"> </span><span class=\"n\">pebs</span><span class=\"w\"> </span><span class=\"n\">bts</span><span class=\"w\"> </span><span class=\"n\">rep_good</span><span class=\"w\"> </span><span class=\"n\">nopl</span><span class=\"w\"> </span><span class=\"n\">xtopology</span><span class=\"w\"> </span><span class=\"n\">nonstop_tsc</span><span class=\"w\"> </span><span class=\"n\">cpuid</span><span class=\"w\"> </span><span class=\"n\">aperfmperf</span><span class=\"w\"> </span><span class=\"n\">pni</span><span class=\"w\"> </span><span class=\"n\">pclmulq</span>\n<span class=\"w\">                                    </span><span class=\"n\">dq</span><span class=\"w\"> </span><span class=\"n\">dtes64</span><span class=\"w\"> </span><span class=\"n\">monitor</span><span class=\"w\"> </span><span class=\"n\">ds_cpl</span><span class=\"w\"> </span><span class=\"n\">vmx</span><span class=\"w\"> </span><span class=\"n\">smx</span><span class=\"w\"> </span><span class=\"n\">est</span><span class=\"w\"> </span><span class=\"n\">tm2</span><span class=\"w\"> </span><span class=\"n\">ssse3</span><span class=\"w\"> </span><span class=\"n\">sdbg</span><span class=\"w\"> </span><span class=\"n\">fma</span><span class=\"w\"> </span><span class=\"n\">cx16</span><span class=\"w\"> </span><span class=\"n\">xtpr</span><span class=\"w\"> </span><span class=\"n\">pdcm</span><span class=\"w\"> </span><span class=\"n\">pcid</span><span class=\"w\"> </span><span class=\"n\">sse4_1</span><span class=\"w\"> </span><span class=\"n\">sse4_2</span><span class=\"w\"> </span><span class=\"n\">x2apic</span><span class=\"w\"> </span><span class=\"n\">movbe</span><span class=\"w\"> </span><span class=\"n\">popcnt</span><span class=\"w\"> </span><span class=\"n\">tsc_deadline_tim</span>\n<span class=\"w\">                                    </span><span class=\"n\">er</span><span class=\"w\"> </span><span class=\"n\">aes</span><span class=\"w\"> </span><span class=\"n\">xsave</span><span class=\"w\"> </span><span class=\"n\">avx</span><span class=\"w\"> </span><span class=\"n\">f16c</span><span class=\"w\"> </span><span class=\"n\">rdrand</span><span class=\"w\"> </span><span class=\"n\">lahf_lm</span><span class=\"w\"> </span><span class=\"n\">abm</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"n\">dnowprefetch</span><span class=\"w\"> </span><span class=\"n\">cpuid_fault</span><span class=\"w\"> </span><span class=\"n\">epb</span><span class=\"w\"> </span><span class=\"n\">invpcid_single</span><span class=\"w\"> </span><span class=\"n\">pti</span><span class=\"w\"> </span><span class=\"n\">ssbd</span><span class=\"w\"> </span><span class=\"n\">ibrs</span><span class=\"w\"> </span><span class=\"n\">ibpb</span><span class=\"w\"> </span><span class=\"n\">stibp</span><span class=\"w\"> </span><span class=\"n\">tpr_shadow</span><span class=\"w\"> </span><span class=\"n\">vnmi</span>\n<span class=\"w\">                                     </span><span class=\"n\">flexpriority</span><span class=\"w\"> </span><span class=\"n\">ept</span><span class=\"w\"> </span><span class=\"n\">vpid</span><span class=\"w\"> </span><span class=\"n\">ept_ad</span><span class=\"w\"> </span><span class=\"n\">fsgsbase</span><span class=\"w\"> </span><span class=\"n\">tsc_adjust</span><span class=\"w\"> </span><span class=\"n\">bmi1</span><span class=\"w\"> </span><span class=\"n\">avx2</span><span class=\"w\"> </span><span class=\"n\">smep</span><span class=\"w\"> </span><span class=\"n\">bmi2</span><span class=\"w\"> </span><span class=\"n\">erms</span><span class=\"w\"> </span><span class=\"n\">invpcid</span><span class=\"w\"> </span><span class=\"n\">mpx</span><span class=\"w\"> </span><span class=\"n\">rdseed</span><span class=\"w\"> </span><span class=\"n\">adx</span><span class=\"w\"> </span><span class=\"n\">smap</span><span class=\"w\"> </span><span class=\"n\">clflushopt</span><span class=\"w\"> </span><span class=\"n\">intel_pt</span><span class=\"w\"> </span><span class=\"n\">xsa</span>\n<span class=\"w\">                                    </span><span class=\"n\">veopt</span><span class=\"w\"> </span><span class=\"n\">xsavec</span><span class=\"w\"> </span><span class=\"n\">xgetbv1</span><span class=\"w\"> </span><span class=\"n\">xsaves</span><span class=\"w\"> </span><span class=\"n\">dtherm</span><span class=\"w\"> </span><span class=\"n\">ida</span><span class=\"w\"> </span><span class=\"n\">arat</span><span class=\"w\"> </span><span class=\"n\">pln</span><span class=\"w\"> </span><span class=\"n\">pts</span><span class=\"w\"> </span><span class=\"n\">hwp</span><span class=\"w\"> </span><span class=\"n\">hwp_notify</span><span class=\"w\"> </span><span class=\"n\">hwp_act_window</span><span class=\"w\"> </span><span class=\"n\">hwp_epp</span><span class=\"w\"> </span><span class=\"n\">md_clear</span><span class=\"w\"> </span><span class=\"n\">flush_l1d</span><span class=\"w\"> </span><span class=\"n\">arch_capabilities</span>\n</code></pre></div>\n<p>Also, I use the inline assembly to compare the execution time (but get the almost same execution time) and maybe it is helpful to your debugging so I paste it here.</p>\n<div class=\"codehilite\" data-code-language=\"C\"><pre><span></span><code><span class=\"cp\">#include</span><span class=\"w\"> </span><span class=\"cpf\">&lt;stdint.h&gt;</span>\n\n\n<span class=\"kt\">double</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">1.0</span><span class=\"p\">;</span>\n\n<span class=\"kt\">uint64_t</span><span class=\"w\"> </span><span class=\"nf\">test_wasmtime</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">  </span><span class=\"n\">__asm__</span><span class=\"w\"> </span><span class=\"n\">__volatile__</span><span class=\"p\">(</span>\n<span class=\"s\">\"vxorpd %%xmm5,%%xmm5,%%xmm6</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span>\n<span class=\"s\">\"xor    %%r11d,%%r11d</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span>\n<span class=\"s\">\"START1%=:</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span>\n<span class=\"s\">\"add    $0x1,%%r11d</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span>\n<span class=\"s\">\"movabs $0x1cd1a94e7ac14ff,%%rsi</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span>\n<span class=\"s\">\"vmovq  %%rsi,%%xmm0</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span>\n<span class=\"s\">\"vmulsd %0,%%xmm0,%%xmm7</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span>\n<span class=\"s\">\"vaddsd %%xmm6,%%xmm7,%%xmm6</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span>\n<span class=\"s\">\"cmp    $0x12a05f20,%%r11d</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span>\n<span class=\"s\">\"jne    START1%=</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span><span class=\"o\">:</span><span class=\"s\">\"=m\"</span><span class=\"p\">(</span><span class=\"n\">X</span><span class=\"p\">)</span><span class=\"o\">::</span><span class=\"s\">\"rsi\"</span><span class=\"p\">,</span><span class=\"s\">\"r11\"</span><span class=\"p\">);</span>\n<span class=\"w\">  </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n\n<span class=\"kt\">uint64_t</span><span class=\"w\"> </span><span class=\"nf\">test_wasmer</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">  </span><span class=\"n\">__asm__</span><span class=\"w\"> </span><span class=\"n\">__volatile__</span><span class=\"p\">(</span>\n<span class=\"s\">\"movabs $0x1cd1a94e7ac14ff,%%r11</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span>\n<span class=\"s\">\"movq   %%r11,%%xmm9</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span>\n<span class=\"s\">\"mulsd  %0,%%xmm9</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span>\n<span class=\"s\">\"xorpd  %%xmm7,%%xmm7</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span>\n<span class=\"s\">\"xor    %%r8d,%%r8d</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span>\n<span class=\"s\">\"START2%=:</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span>\n<span class=\"s\">\"movdqa %%xmm9,%%xmm15</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span>\n<span class=\"s\">\"addsd  %%xmm7,%%xmm15</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span>\n<span class=\"s\">\"add    $0x1,%%r8d</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span>\n<span class=\"s\">\"cmp    $0x12a05f20,%%r8d</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span>\n<span class=\"s\">\"setne  %%dil</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span>\n<span class=\"s\">\"movzbl %%dil,%%edi</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span>\n<span class=\"s\">\"test   %%edi,%%edi</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span>\n<span class=\"s\">\"je     EXIT2%=</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span>\n<span class=\"s\">\"movdqa %%xmm15,%%xmm7</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span>\n<span class=\"s\">\"jmp   START2%=</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span>\n<span class=\"s\">\"EXIT2%=:</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span><span class=\"o\">:</span><span class=\"s\">\"=m\"</span><span class=\"p\">(</span><span class=\"n\">X</span><span class=\"p\">)</span><span class=\"o\">::</span><span class=\"s\">\"r11\"</span><span class=\"p\">,</span><span class=\"s\">\"r8\"</span><span class=\"p\">,</span><span class=\"s\">\"rdi\"</span><span class=\"p\">);</span>\n<span class=\"w\">  </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n\n<span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"nf\">main</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">  </span><span class=\"n\">test_wasmtime</span><span class=\"p\">();</span>\n<span class=\"w\">  </span><span class=\"c1\">// test_wasmer();</span>\n<span class=\"w\">  </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p><a href=\"https://github.com/bytecodealliance/wasmtime/files/13051519/reduce.zip\">reduce.zip</a><br>\n</p>\n</blockquote>",
        "id": 397655396,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1697789804
    },
    {
        "content": "<p>hungryzzz edited a <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7246#issuecomment-1772242886\">comment</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7246\">issue #7246</a>:</p>\n<blockquote>\n<p>@alexcrichton Hi, I try to reduce the above <code>wasm</code> bytecode to get a buggy case as shortest as possible, the reduced results are attached. The execute time in <code>Wasmer</code> and <code>Wasmtime</code> still have a big difference:</p>\n<ul>\n<li><code>Wasmer</code>: 0.67s</li>\n<li><code>Wasmtime</code>: 12.24s</li>\n</ul>\n<p>But I find that the performance regression is not only related to the <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7283\">https://github.com/bytecodealliance/wasmtime/issues/7283</a>, because if I change the constant in <code>f64.const 5.43231e-312</code> to <code>f64.const 5.4</code>, the execution time will back to normal(but indeed, the loop-invariant code will be sinked into loop in the corresponding binary generated by <code>Wasmtime</code>):</p>\n<ul>\n<li><code>Wasmer</code>: 0.70s</li>\n<li><code>Wasmtime</code>: 0.34s</li>\n</ul>\n<p>By the way, I also check the binary generated by <code>LLVM</code>, I find that the whole computation will be optimized to empty(I think  because there is nothing depends on the result of the loop).</p>\n<p>I think it is also a strange case I cannot understand and explain...</p>\n<div class=\"codehilite\" data-code-language=\"WebAssembly\"><pre><span></span><code><span class=\"c1\">;; reduce.wat</span>\n<span class=\"p\">(</span><span class=\"k\">module</span>\n  <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"cm\">(;0;)</span> <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"p\">(</span><span class=\"k\">param</span> <span class=\"kt\">i32</span><span class=\"p\">)))</span>\n  <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"cm\">(;1;)</span> <span class=\"p\">(</span><span class=\"k\">func</span><span class=\"p\">))</span>\n  <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"cm\">(;2;)</span> <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"p\">(</span><span class=\"k\">result</span> <span class=\"kt\">i32</span><span class=\"p\">)))</span>\n  <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"cm\">(;3;)</span> <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"p\">(</span><span class=\"k\">param</span> <span class=\"kt\">i32</span><span class=\"p\">)</span> <span class=\"p\">(</span><span class=\"k\">result</span> <span class=\"kt\">i32</span><span class=\"p\">)))</span>\n  <span class=\"p\">(</span><span class=\"k\">import</span> <span class=\"s2\">\"wasi_snapshot_preview1\"</span> <span class=\"s2\">\"proc_exit\"</span> <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"cm\">(;0;)</span> <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"mi\">0</span><span class=\"p\">)))</span>\n  <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"cm\">(;2;)</span> <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"mi\">1</span><span class=\"p\">)</span>\n    <span class=\"nb\">call</span> <span class=\"mi\">2</span>\n    <span class=\"nb\">i32.const</span> <span class=\"mi\">0</span>\n    <span class=\"nb\">call</span> <span class=\"mi\">0</span>\n    <span class=\"nb\">unreachable</span><span class=\"p\">)</span>\n  <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"cm\">(;2;)</span> <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"mi\">1</span><span class=\"p\">)</span>\n    <span class=\"p\">(</span><span class=\"k\">local</span> <span class=\"kt\">f64</span> <span class=\"kt\">f64</span> <span class=\"kt\">i32</span><span class=\"p\">)</span>\n    <span class=\"nb\">f64.const</span> <span class=\"mf\">5.43231e-312</span> <span class=\"c1\">;; Magic Number!!!</span>\n    <span class=\"nb\">f64.const</span> <span class=\"mf\">1.0</span>\n    <span class=\"nb\">f64.mul</span>\n    <span class=\"nb\">local.set</span> <span class=\"mi\">1</span>\n    <span class=\"k\">loop</span>  <span class=\"c1\">;; label = @1</span>\n      <span class=\"nb\">local.get</span> <span class=\"mi\">1</span>\n      <span class=\"nb\">local.get</span> <span class=\"mi\">0</span>\n      <span class=\"nb\">f64.add</span>\n      <span class=\"nb\">local.set</span> <span class=\"mi\">0</span>\n      <span class=\"nb\">local.get</span> <span class=\"mi\">2</span>   <span class=\"c1\">;; condition variable i</span>\n      <span class=\"nb\">i32.const</span> <span class=\"mi\">1</span>\n      <span class=\"nb\">i32.add</span>\n      <span class=\"nb\">local.tee</span> <span class=\"mi\">2</span>   <span class=\"c1\">;; i++</span>\n      <span class=\"nb\">i32.const</span> <span class=\"mf\">312500000</span>\n      <span class=\"nb\">i32.ne</span>\n      <span class=\"nb\">br_if</span> <span class=\"mi\">0</span> <span class=\"cm\">(;@1;)</span>\n    <span class=\"k\">end</span>\n  <span class=\"p\">)</span>\n  <span class=\"p\">(</span><span class=\"k\">table</span> <span class=\"cm\">(;0;)</span> <span class=\"mf\">2 2</span> <span class=\"k\">funcref</span><span class=\"p\">)</span>\n  <span class=\"p\">(</span><span class=\"k\">memory</span> <span class=\"cm\">(;0;)</span> <span class=\"mf\">8192</span> <span class=\"mf\">8192</span><span class=\"p\">)</span>\n  <span class=\"p\">(</span><span class=\"k\">global</span> <span class=\"cm\">(;0;)</span> <span class=\"p\">(</span><span class=\"k\">mut</span> <span class=\"kt\">i32</span><span class=\"p\">)</span> <span class=\"p\">(</span><span class=\"nb\">i32.const</span> <span class=\"mf\">66576</span><span class=\"p\">))</span>\n  <span class=\"p\">(</span><span class=\"k\">export</span> <span class=\"s2\">\"memory\"</span> <span class=\"p\">(</span><span class=\"k\">memory</span> <span class=\"mi\">0</span><span class=\"p\">))</span>\n  <span class=\"p\">(</span><span class=\"k\">export</span> <span class=\"s2\">\"__indirect_function_table\"</span> <span class=\"p\">(</span><span class=\"k\">table</span> <span class=\"mi\">0</span><span class=\"p\">))</span>\n  <span class=\"p\">(</span><span class=\"k\">export</span> <span class=\"s2\">\"_start\"</span> <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"mi\">1</span><span class=\"p\">)))</span>\n</code></pre></div>\n<h3>Environment Version</h3>\n<ul>\n<li><code>Wasmer</code>: wasmer 4.1.2 (98188df 2023-09-19)<br>\nbinary: wasmer-cli<br>\ncommit-hash: 98188df80096dfc7134ce202731878cf9d8f6f4e<br>\ncommit-date: 2023-09-19<br>\nhost: x86_64-unknown-linux-gnu<br>\ncompiler: singlepass,cranelift,llvm</li>\n<li><code>Wasmtime</code>: build from 8e00cc202f82445a42adbad6e8187e901f91833b (release version)</li>\n<li>CPU</li>\n</ul>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"err\">âžœ</span><span class=\"w\">  </span><span class=\"o\">~</span><span class=\"w\"> </span><span class=\"n\">lscpu</span>\n<span class=\"n\">Architecture</span>:                       <span class=\"nc\">x86_64</span>\n<span class=\"n\">CPU</span><span class=\"w\"> </span><span class=\"n\">op</span><span class=\"o\">-</span><span class=\"n\">mode</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">)</span>:                     <span class=\"mi\">32</span><span class=\"o\">-</span><span class=\"n\">bit</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">64</span><span class=\"o\">-</span><span class=\"n\">bit</span>\n<span class=\"n\">Byte</span><span class=\"w\"> </span><span class=\"n\">Order</span>:                         <span class=\"nc\">Little</span><span class=\"w\"> </span><span class=\"n\">Endian</span>\n<span class=\"n\">Address</span><span class=\"w\"> </span><span class=\"n\">sizes</span>:                      <span class=\"mi\">39</span><span class=\"w\"> </span><span class=\"n\">bits</span><span class=\"w\"> </span><span class=\"n\">physical</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">48</span><span class=\"w\"> </span><span class=\"n\">bits</span><span class=\"w\"> </span><span class=\"kr\">virtual</span>\n<span class=\"n\">CPU</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">)</span>:                             <span class=\"mi\">6</span>\n<span class=\"n\">On</span><span class=\"o\">-</span><span class=\"n\">line</span><span class=\"w\"> </span><span class=\"n\">CPU</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">list</span>:                <span class=\"mi\">0</span><span class=\"o\">-</span><span class=\"mi\">5</span>\n<span class=\"n\">Thread</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">per</span><span class=\"w\"> </span><span class=\"n\">core</span>:                 <span class=\"mi\">1</span>\n<span class=\"n\">Core</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">per</span><span class=\"w\"> </span><span class=\"n\">socket</span>:                 <span class=\"mi\">6</span>\n<span class=\"n\">Socket</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">)</span>:                          <span class=\"mi\">1</span>\n<span class=\"n\">NUMA</span><span class=\"w\"> </span><span class=\"n\">node</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">)</span>:                       <span class=\"mi\">1</span>\n<span class=\"n\">Vendor</span><span class=\"w\"> </span><span class=\"n\">ID</span>:                          <span class=\"nc\">GenuineIntel</span>\n<span class=\"n\">CPU</span><span class=\"w\"> </span><span class=\"n\">family</span>:                         <span class=\"mi\">6</span>\n<span class=\"n\">Model</span>:                              <span class=\"mi\">158</span>\n<span class=\"n\">Model</span><span class=\"w\"> </span><span class=\"n\">name</span>:                         <span class=\"nc\">Intel</span><span class=\"p\">(</span><span class=\"n\">R</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">Core</span><span class=\"p\">(</span><span class=\"n\">TM</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">i5</span><span class=\"o\">-</span><span class=\"mi\">9500</span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"n\">CPU</span><span class=\"w\"> </span><span class=\"o\">@</span><span class=\"w\"> </span><span class=\"mf\">2.20</span><span class=\"n\">GHz</span>\n<span class=\"n\">Stepping</span>:                           <span class=\"mi\">10</span>\n<span class=\"n\">CPU</span><span class=\"w\"> </span><span class=\"n\">MHz</span>:                            <span class=\"mf\">2200.000</span>\n<span class=\"n\">CPU</span><span class=\"w\"> </span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"n\">MHz</span>:                        <span class=\"mf\">3700.0000</span>\n<span class=\"n\">CPU</span><span class=\"w\"> </span><span class=\"n\">min</span><span class=\"w\"> </span><span class=\"n\">MHz</span>:                        <span class=\"mf\">800.0000</span>\n<span class=\"n\">BogoMIPS</span>:                           <span class=\"mf\">4399.99</span>\n<span class=\"n\">Virtualization</span>:                     <span class=\"nc\">VT</span><span class=\"o\">-</span><span class=\"n\">x</span>\n<span class=\"n\">L1d</span><span class=\"w\"> </span><span class=\"n\">cache</span>:                          <span class=\"mi\">192</span><span class=\"w\"> </span><span class=\"n\">KiB</span>\n<span class=\"n\">L1i</span><span class=\"w\"> </span><span class=\"n\">cache</span>:                          <span class=\"mi\">192</span><span class=\"w\"> </span><span class=\"n\">KiB</span>\n<span class=\"n\">L2</span><span class=\"w\"> </span><span class=\"n\">cache</span>:                           <span class=\"mf\">1.5</span><span class=\"w\"> </span><span class=\"n\">MiB</span>\n<span class=\"n\">L3</span><span class=\"w\"> </span><span class=\"n\">cache</span>:                           <span class=\"mi\">9</span><span class=\"w\"> </span><span class=\"n\">MiB</span>\n<span class=\"n\">NUMA</span><span class=\"w\"> </span><span class=\"n\">node0</span><span class=\"w\"> </span><span class=\"n\">CPU</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">)</span>:                  <span class=\"mi\">0</span><span class=\"o\">-</span><span class=\"mi\">5</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Gather</span><span class=\"w\"> </span><span class=\"n\">data</span><span class=\"w\"> </span><span class=\"n\">sampling</span>: <span class=\"nc\">Mitigation</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">Microcode</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Itlb</span><span class=\"w\"> </span><span class=\"n\">multihit</span>:        <span class=\"nc\">KVM</span>: <span class=\"nc\">Mitigation</span>: <span class=\"nc\">VMX</span><span class=\"w\"> </span><span class=\"n\">disabled</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">L1tf</span>:                 <span class=\"nc\">Mitigation</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">PTE</span><span class=\"w\"> </span><span class=\"n\">Inversion</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">VMX</span><span class=\"w\"> </span><span class=\"n\">conditional</span><span class=\"w\"> </span><span class=\"n\">cache</span><span class=\"w\"> </span><span class=\"n\">flushes</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">SMT</span><span class=\"w\"> </span><span class=\"n\">disabled</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Mds</span>:                  <span class=\"nc\">Mitigation</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">Clear</span><span class=\"w\"> </span><span class=\"n\">CPU</span><span class=\"w\"> </span><span class=\"n\">buffers</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">SMT</span><span class=\"w\"> </span><span class=\"n\">disabled</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Meltdown</span>:             <span class=\"nc\">Mitigation</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">PTI</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Mmio</span><span class=\"w\"> </span><span class=\"n\">stale</span><span class=\"w\"> </span><span class=\"n\">data</span>:      <span class=\"nc\">Mitigation</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">Clear</span><span class=\"w\"> </span><span class=\"n\">CPU</span><span class=\"w\"> </span><span class=\"n\">buffers</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">SMT</span><span class=\"w\"> </span><span class=\"n\">disabled</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Retbleed</span>:             <span class=\"nc\">Mitigation</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">IBRS</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Spec</span><span class=\"w\"> </span><span class=\"n\">rstack</span><span class=\"w\"> </span><span class=\"n\">overflow</span>: <span class=\"nc\">Not</span><span class=\"w\"> </span><span class=\"n\">affected</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Spec</span><span class=\"w\"> </span><span class=\"n\">store</span><span class=\"w\"> </span><span class=\"n\">bypass</span>:    <span class=\"nc\">Mitigation</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">Speculative</span><span class=\"w\"> </span><span class=\"n\">Store</span><span class=\"w\"> </span><span class=\"n\">Bypass</span><span class=\"w\"> </span><span class=\"n\">disabled</span><span class=\"w\"> </span><span class=\"n\">via</span><span class=\"w\"> </span><span class=\"n\">prctl</span><span class=\"w\"> </span><span class=\"n\">and</span><span class=\"w\"> </span><span class=\"n\">seccomp</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Spectre</span><span class=\"w\"> </span><span class=\"n\">v1</span>:           <span class=\"nc\">Mitigation</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">usercopy</span><span class=\"o\">/</span><span class=\"n\">swapgs</span><span class=\"w\"> </span><span class=\"n\">barriers</span><span class=\"w\"> </span><span class=\"n\">and</span><span class=\"w\"> </span><span class=\"n\">__user</span><span class=\"w\"> </span><span class=\"n\">pointer</span><span class=\"w\"> </span><span class=\"n\">sanitization</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Spectre</span><span class=\"w\"> </span><span class=\"n\">v2</span>:           <span class=\"nc\">Mitigation</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">IBRS</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">IBPB</span><span class=\"w\"> </span><span class=\"n\">conditional</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">STIBP</span><span class=\"w\"> </span><span class=\"n\">disabled</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">RSB</span><span class=\"w\"> </span><span class=\"n\">filling</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">PBRSB</span><span class=\"o\">-</span><span class=\"n\">eIBRS</span><span class=\"w\"> </span><span class=\"n\">Not</span><span class=\"w\"> </span><span class=\"n\">affected</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Srbds</span>:                <span class=\"nc\">Mitigation</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">Microcode</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Tsx</span><span class=\"w\"> </span><span class=\"k\">async</span><span class=\"w\"> </span><span class=\"n\">abort</span>:      <span class=\"nc\">Mitigation</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">TSX</span><span class=\"w\"> </span><span class=\"n\">disabled</span>\n<span class=\"n\">Flags</span>:                              <span class=\"nc\">fpu</span><span class=\"w\"> </span><span class=\"n\">vme</span><span class=\"w\"> </span><span class=\"n\">de</span><span class=\"w\"> </span><span class=\"n\">pse</span><span class=\"w\"> </span><span class=\"n\">tsc</span><span class=\"w\"> </span><span class=\"n\">msr</span><span class=\"w\"> </span><span class=\"n\">pae</span><span class=\"w\"> </span><span class=\"n\">mce</span><span class=\"w\"> </span><span class=\"n\">cx8</span><span class=\"w\"> </span><span class=\"n\">apic</span><span class=\"w\"> </span><span class=\"n\">sep</span><span class=\"w\"> </span><span class=\"n\">mtrr</span><span class=\"w\"> </span><span class=\"n\">pge</span><span class=\"w\"> </span><span class=\"n\">mca</span><span class=\"w\"> </span><span class=\"n\">cmov</span><span class=\"w\"> </span><span class=\"n\">pat</span><span class=\"w\"> </span><span class=\"n\">pse36</span><span class=\"w\"> </span><span class=\"n\">clflush</span><span class=\"w\"> </span><span class=\"n\">dts</span><span class=\"w\"> </span><span class=\"n\">acpi</span><span class=\"w\"> </span><span class=\"n\">mmx</span><span class=\"w\"> </span><span class=\"n\">fxsr</span><span class=\"w\"> </span><span class=\"n\">sse</span><span class=\"w\"> </span><span class=\"n\">sse2</span><span class=\"w\"> </span><span class=\"n\">ss</span><span class=\"w\"> </span><span class=\"n\">ht</span><span class=\"w\"> </span><span class=\"n\">tm</span><span class=\"w\"> </span><span class=\"n\">pbe</span><span class=\"w\"> </span><span class=\"n\">syscal</span>\n<span class=\"w\">                                    </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"n\">nx</span><span class=\"w\"> </span><span class=\"n\">pdpe1gb</span><span class=\"w\"> </span><span class=\"n\">rdtscp</span><span class=\"w\"> </span><span class=\"n\">lm</span><span class=\"w\"> </span><span class=\"n\">constant_tsc</span><span class=\"w\"> </span><span class=\"n\">art</span><span class=\"w\"> </span><span class=\"n\">arch_perfmon</span><span class=\"w\"> </span><span class=\"n\">pebs</span><span class=\"w\"> </span><span class=\"n\">bts</span><span class=\"w\"> </span><span class=\"n\">rep_good</span><span class=\"w\"> </span><span class=\"n\">nopl</span><span class=\"w\"> </span><span class=\"n\">xtopology</span><span class=\"w\"> </span><span class=\"n\">nonstop_tsc</span><span class=\"w\"> </span><span class=\"n\">cpuid</span><span class=\"w\"> </span><span class=\"n\">aperfmperf</span><span class=\"w\"> </span><span class=\"n\">pni</span><span class=\"w\"> </span><span class=\"n\">pclmulq</span>\n<span class=\"w\">                                    </span><span class=\"n\">dq</span><span class=\"w\"> </span><span class=\"n\">dtes64</span><span class=\"w\"> </span><span class=\"n\">monitor</span><span class=\"w\"> </span><span class=\"n\">ds_cpl</span><span class=\"w\"> </span><span class=\"n\">vmx</span><span class=\"w\"> </span><span class=\"n\">smx</span><span class=\"w\"> </span><span class=\"n\">est</span><span class=\"w\"> </span><span class=\"n\">tm2</span><span class=\"w\"> </span><span class=\"n\">ssse3</span><span class=\"w\"> </span><span class=\"n\">sdbg</span><span class=\"w\"> </span><span class=\"n\">fma</span><span class=\"w\"> </span><span class=\"n\">cx16</span><span class=\"w\"> </span><span class=\"n\">xtpr</span><span class=\"w\"> </span><span class=\"n\">pdcm</span><span class=\"w\"> </span><span class=\"n\">pcid</span><span class=\"w\"> </span><span class=\"n\">sse4_1</span><span class=\"w\"> </span><span class=\"n\">sse4_2</span><span class=\"w\"> </span><span class=\"n\">x2apic</span><span class=\"w\"> </span><span class=\"n\">movbe</span><span class=\"w\"> </span><span class=\"n\">popcnt</span><span class=\"w\"> </span><span class=\"n\">tsc_deadline_tim</span>\n<span class=\"w\">                                    </span><span class=\"n\">er</span><span class=\"w\"> </span><span class=\"n\">aes</span><span class=\"w\"> </span><span class=\"n\">xsave</span><span class=\"w\"> </span><span class=\"n\">avx</span><span class=\"w\"> </span><span class=\"n\">f16c</span><span class=\"w\"> </span><span class=\"n\">rdrand</span><span class=\"w\"> </span><span class=\"n\">lahf_lm</span><span class=\"w\"> </span><span class=\"n\">abm</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"n\">dnowprefetch</span><span class=\"w\"> </span><span class=\"n\">cpuid_fault</span><span class=\"w\"> </span><span class=\"n\">epb</span><span class=\"w\"> </span><span class=\"n\">invpcid_single</span><span class=\"w\"> </span><span class=\"n\">pti</span><span class=\"w\"> </span><span class=\"n\">ssbd</span><span class=\"w\"> </span><span class=\"n\">ibrs</span><span class=\"w\"> </span><span class=\"n\">ibpb</span><span class=\"w\"> </span><span class=\"n\">stibp</span><span class=\"w\"> </span><span class=\"n\">tpr_shadow</span><span class=\"w\"> </span><span class=\"n\">vnmi</span>\n<span class=\"w\">                                     </span><span class=\"n\">flexpriority</span><span class=\"w\"> </span><span class=\"n\">ept</span><span class=\"w\"> </span><span class=\"n\">vpid</span><span class=\"w\"> </span><span class=\"n\">ept_ad</span><span class=\"w\"> </span><span class=\"n\">fsgsbase</span><span class=\"w\"> </span><span class=\"n\">tsc_adjust</span><span class=\"w\"> </span><span class=\"n\">bmi1</span><span class=\"w\"> </span><span class=\"n\">avx2</span><span class=\"w\"> </span><span class=\"n\">smep</span><span class=\"w\"> </span><span class=\"n\">bmi2</span><span class=\"w\"> </span><span class=\"n\">erms</span><span class=\"w\"> </span><span class=\"n\">invpcid</span><span class=\"w\"> </span><span class=\"n\">mpx</span><span class=\"w\"> </span><span class=\"n\">rdseed</span><span class=\"w\"> </span><span class=\"n\">adx</span><span class=\"w\"> </span><span class=\"n\">smap</span><span class=\"w\"> </span><span class=\"n\">clflushopt</span><span class=\"w\"> </span><span class=\"n\">intel_pt</span><span class=\"w\"> </span><span class=\"n\">xsa</span>\n<span class=\"w\">                                    </span><span class=\"n\">veopt</span><span class=\"w\"> </span><span class=\"n\">xsavec</span><span class=\"w\"> </span><span class=\"n\">xgetbv1</span><span class=\"w\"> </span><span class=\"n\">xsaves</span><span class=\"w\"> </span><span class=\"n\">dtherm</span><span class=\"w\"> </span><span class=\"n\">ida</span><span class=\"w\"> </span><span class=\"n\">arat</span><span class=\"w\"> </span><span class=\"n\">pln</span><span class=\"w\"> </span><span class=\"n\">pts</span><span class=\"w\"> </span><span class=\"n\">hwp</span><span class=\"w\"> </span><span class=\"n\">hwp_notify</span><span class=\"w\"> </span><span class=\"n\">hwp_act_window</span><span class=\"w\"> </span><span class=\"n\">hwp_epp</span><span class=\"w\"> </span><span class=\"n\">md_clear</span><span class=\"w\"> </span><span class=\"n\">flush_l1d</span><span class=\"w\"> </span><span class=\"n\">arch_capabilities</span>\n</code></pre></div>\n<p>Also, I use the inline assembly to run the binary generated by <code>Wasmer</code> and <code>Wasmtime</code> and compare the execution time (but get the almost same execution time) and maybe it is helpful to your debugging so I paste it here.</p>\n<div class=\"codehilite\" data-code-language=\"C\"><pre><span></span><code><span class=\"cp\">#include</span><span class=\"w\"> </span><span class=\"cpf\">&lt;stdint.h&gt;</span>\n\n\n<span class=\"kt\">double</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">1.0</span><span class=\"p\">;</span>\n\n<span class=\"kt\">uint64_t</span><span class=\"w\"> </span><span class=\"nf\">test_wasmtime</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">  </span><span class=\"n\">__asm__</span><span class=\"w\"> </span><span class=\"n\">__volatile__</span><span class=\"p\">(</span>\n<span class=\"s\">\"vxorpd %%xmm5,%%xmm5,%%xmm6</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span>\n<span class=\"s\">\"xor    %%r11d,%%r11d</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span>\n<span class=\"s\">\"START1%=:</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span>\n<span class=\"s\">\"add    $0x1,%%r11d</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span>\n<span class=\"s\">\"movabs $0x1cd1a94e7ac14ff,%%rsi</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span>\n<span class=\"s\">\"vmovq  %%rsi,%%xmm0</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span>\n<span class=\"s\">\"vmulsd %0,%%xmm0,%%xmm7</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span>\n<span class=\"s\">\"vaddsd %%xmm6,%%xmm7,%%xmm6</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span>\n<span class=\"s\">\"cmp    $0x12a05f20,%%r11d</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span>\n<span class=\"s\">\"jne    START1%=</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span><span class=\"o\">:</span><span class=\"s\">\"=m\"</span><span class=\"p\">(</span><span class=\"n\">X</span><span class=\"p\">)</span><span class=\"o\">::</span><span class=\"s\">\"rsi\"</span><span class=\"p\">,</span><span class=\"s\">\"r11\"</span><span class=\"p\">);</span>\n<span class=\"w\">  </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n\n<span class=\"kt\">uint64_t</span><span class=\"w\"> </span><span class=\"nf\">test_wasmer</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">  </span><span class=\"n\">__asm__</span><span class=\"w\"> </span><span class=\"n\">__volatile__</span><span class=\"p\">(</span>\n<span class=\"s\">\"movabs $0x1cd1a94e7ac14ff,%%r11</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span>\n<span class=\"s\">\"movq   %%r11,%%xmm9</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span>\n<span class=\"s\">\"mulsd  %0,%%xmm9</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span>\n<span class=\"s\">\"xorpd  %%xmm7,%%xmm7</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span>\n<span class=\"s\">\"xor    %%r8d,%%r8d</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span>\n<span class=\"s\">\"START2%=:</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span>\n<span class=\"s\">\"movdqa %%xmm9,%%xmm15</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span>\n<span class=\"s\">\"addsd  %%xmm7,%%xmm15</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span>\n<span class=\"s\">\"add    $0x1,%%r8d</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span>\n<span class=\"s\">\"cmp    $0x12a05f20,%%r8d</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span>\n<span class=\"s\">\"setne  %%dil</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span>\n<span class=\"s\">\"movzbl %%dil,%%edi</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span>\n<span class=\"s\">\"test   %%edi,%%edi</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span>\n<span class=\"s\">\"je     EXIT2%=</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span>\n<span class=\"s\">\"movdqa %%xmm15,%%xmm7</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span>\n<span class=\"s\">\"jmp   START2%=</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span>\n<span class=\"s\">\"EXIT2%=:</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span><span class=\"o\">:</span><span class=\"s\">\"=m\"</span><span class=\"p\">(</span><span class=\"n\">X</span><span class=\"p\">)</span><span class=\"o\">::</span><span class=\"s\">\"r11\"</span><span class=\"p\">,</span><span class=\"s\">\"r8\"</span><span class=\"p\">,</span><span class=\"s\">\"rdi\"</span><span class=\"p\">);</span>\n<span class=\"w\">  </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n\n<span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"nf\">main</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">  </span><span class=\"n\">test_wasmtime</span><span class=\"p\">();</span>\n<span class=\"w\">  </span><span class=\"c1\">// test_wasmer();</span>\n<span class=\"w\">  </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p><a href=\"https://github.com/bytecodealliance/wasmtime/files/13051519/reduce.zip\">reduce.zip</a><br>\n</p>\n</blockquote>",
        "id": 397655557,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1697789867
    },
    {
        "content": "<p>hungryzzz edited a <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7246#issuecomment-1772242886\">comment</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7246\">issue #7246</a>:</p>\n<blockquote>\n<p>@alexcrichton Hi, I try to reduce the above <code>wasm</code> bytecode to get a buggy case as shortest as possible, the reduced results are attached. The execute time in <code>Wasmer</code> and <code>Wasmtime</code> still have a big difference:</p>\n<ul>\n<li><code>Wasmer</code>: 0.67s</li>\n<li><code>Wasmtime</code>: 12.24s</li>\n</ul>\n<p>But I find that the performance regression is not only related to the <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7283\">https://github.com/bytecodealliance/wasmtime/issues/7283</a>, because if I change the constant in <code>f64.const 5.43231e-312</code> to <code>f64.const 5.4</code>, the execution time will back to normal(but indeed, the loop-invariant code will be sinked into loop in the corresponding binary generated by <code>Wasmtime</code>):</p>\n<ul>\n<li><code>Wasmer</code>: 0.70s</li>\n<li><code>Wasmtime</code>: 0.34s</li>\n</ul>\n<p>By the way, I also check the binary generated by <code>LLVM</code>, I find that the whole computation will be optimized to empty(I think  because there is nothing depends on the result of the loop).</p>\n<p>I think it is also a strange case I cannot understand and explain...</p>\n<div class=\"codehilite\" data-code-language=\"WebAssembly\"><pre><span></span><code><span class=\"c1\">;; reduce.wat</span>\n<span class=\"p\">(</span><span class=\"k\">module</span>\n  <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"cm\">(;0;)</span> <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"p\">(</span><span class=\"k\">param</span> <span class=\"kt\">i32</span><span class=\"p\">)))</span>\n  <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"cm\">(;1;)</span> <span class=\"p\">(</span><span class=\"k\">func</span><span class=\"p\">))</span>\n  <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"cm\">(;2;)</span> <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"p\">(</span><span class=\"k\">result</span> <span class=\"kt\">i32</span><span class=\"p\">)))</span>\n  <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"cm\">(;3;)</span> <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"p\">(</span><span class=\"k\">param</span> <span class=\"kt\">i32</span><span class=\"p\">)</span> <span class=\"p\">(</span><span class=\"k\">result</span> <span class=\"kt\">i32</span><span class=\"p\">)))</span>\n  <span class=\"p\">(</span><span class=\"k\">import</span> <span class=\"s2\">\"wasi_snapshot_preview1\"</span> <span class=\"s2\">\"proc_exit\"</span> <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"cm\">(;0;)</span> <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"mi\">0</span><span class=\"p\">)))</span>\n  <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"cm\">(;2;)</span> <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"mi\">1</span><span class=\"p\">)</span>\n    <span class=\"nb\">call</span> <span class=\"mi\">2</span>\n    <span class=\"nb\">i32.const</span> <span class=\"mi\">0</span>\n    <span class=\"nb\">call</span> <span class=\"mi\">0</span>\n    <span class=\"nb\">unreachable</span><span class=\"p\">)</span>\n  <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"cm\">(;2;)</span> <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"mi\">1</span><span class=\"p\">)</span>\n    <span class=\"p\">(</span><span class=\"k\">local</span> <span class=\"kt\">f64</span> <span class=\"kt\">f64</span> <span class=\"kt\">i32</span><span class=\"p\">)</span>\n    <span class=\"nb\">f64.const</span> <span class=\"mf\">5.43231e-312</span> <span class=\"c1\">;; Magic Number!!!</span>\n    <span class=\"nb\">f64.const</span> <span class=\"mf\">1.0</span>\n    <span class=\"nb\">f64.mul</span>\n    <span class=\"nb\">local.set</span> <span class=\"mi\">1</span>\n    <span class=\"k\">loop</span>  <span class=\"c1\">;; label = @1</span>\n      <span class=\"nb\">local.get</span> <span class=\"mi\">1</span>\n      <span class=\"nb\">local.get</span> <span class=\"mi\">0</span>\n      <span class=\"nb\">f64.add</span>\n      <span class=\"nb\">local.set</span> <span class=\"mi\">0</span>\n      <span class=\"nb\">local.get</span> <span class=\"mi\">2</span>   <span class=\"c1\">;; condition variable i</span>\n      <span class=\"nb\">i32.const</span> <span class=\"mi\">1</span>\n      <span class=\"nb\">i32.add</span>\n      <span class=\"nb\">local.tee</span> <span class=\"mi\">2</span>   <span class=\"c1\">;; i++</span>\n      <span class=\"nb\">i32.const</span> <span class=\"mf\">312500000</span>\n      <span class=\"nb\">i32.ne</span>\n      <span class=\"nb\">br_if</span> <span class=\"mi\">0</span> <span class=\"cm\">(;@1;)</span>\n    <span class=\"k\">end</span>\n  <span class=\"p\">)</span>\n  <span class=\"p\">(</span><span class=\"k\">table</span> <span class=\"cm\">(;0;)</span> <span class=\"mf\">2 2</span> <span class=\"k\">funcref</span><span class=\"p\">)</span>\n  <span class=\"p\">(</span><span class=\"k\">memory</span> <span class=\"cm\">(;0;)</span> <span class=\"mf\">8192</span> <span class=\"mf\">8192</span><span class=\"p\">)</span>\n  <span class=\"p\">(</span><span class=\"k\">global</span> <span class=\"cm\">(;0;)</span> <span class=\"p\">(</span><span class=\"k\">mut</span> <span class=\"kt\">i32</span><span class=\"p\">)</span> <span class=\"p\">(</span><span class=\"nb\">i32.const</span> <span class=\"mf\">66576</span><span class=\"p\">))</span>\n  <span class=\"p\">(</span><span class=\"k\">export</span> <span class=\"s2\">\"memory\"</span> <span class=\"p\">(</span><span class=\"k\">memory</span> <span class=\"mi\">0</span><span class=\"p\">))</span>\n  <span class=\"p\">(</span><span class=\"k\">export</span> <span class=\"s2\">\"__indirect_function_table\"</span> <span class=\"p\">(</span><span class=\"k\">table</span> <span class=\"mi\">0</span><span class=\"p\">))</span>\n  <span class=\"p\">(</span><span class=\"k\">export</span> <span class=\"s2\">\"_start\"</span> <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"mi\">1</span><span class=\"p\">)))</span>\n</code></pre></div>\n<h3>Environment Version</h3>\n<ul>\n<li><code>Wasmer</code>: wasmer 4.1.2 (98188df 2023-09-19)<br>\nbinary: wasmer-cli<br>\ncommit-hash: 98188df80096dfc7134ce202731878cf9d8f6f4e<br>\ncommit-date: 2023-09-19<br>\nhost: x86_64-unknown-linux-gnu<br>\ncompiler: singlepass,cranelift,llvm</li>\n<li><code>Wasmtime</code>: build from 8e00cc202f82445a42adbad6e8187e901f91833b (release version)</li>\n<li>CPU</li>\n</ul>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"err\">âžœ</span><span class=\"w\">  </span><span class=\"o\">~</span><span class=\"w\"> </span><span class=\"n\">lscpu</span>\n<span class=\"n\">Architecture</span>:                       <span class=\"nc\">x86_64</span>\n<span class=\"n\">CPU</span><span class=\"w\"> </span><span class=\"n\">op</span><span class=\"o\">-</span><span class=\"n\">mode</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">)</span>:                     <span class=\"mi\">32</span><span class=\"o\">-</span><span class=\"n\">bit</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">64</span><span class=\"o\">-</span><span class=\"n\">bit</span>\n<span class=\"n\">Byte</span><span class=\"w\"> </span><span class=\"n\">Order</span>:                         <span class=\"nc\">Little</span><span class=\"w\"> </span><span class=\"n\">Endian</span>\n<span class=\"n\">Address</span><span class=\"w\"> </span><span class=\"n\">sizes</span>:                      <span class=\"mi\">39</span><span class=\"w\"> </span><span class=\"n\">bits</span><span class=\"w\"> </span><span class=\"n\">physical</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">48</span><span class=\"w\"> </span><span class=\"n\">bits</span><span class=\"w\"> </span><span class=\"kr\">virtual</span>\n<span class=\"n\">CPU</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">)</span>:                             <span class=\"mi\">6</span>\n<span class=\"n\">On</span><span class=\"o\">-</span><span class=\"n\">line</span><span class=\"w\"> </span><span class=\"n\">CPU</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">list</span>:                <span class=\"mi\">0</span><span class=\"o\">-</span><span class=\"mi\">5</span>\n<span class=\"n\">Thread</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">per</span><span class=\"w\"> </span><span class=\"n\">core</span>:                 <span class=\"mi\">1</span>\n<span class=\"n\">Core</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">per</span><span class=\"w\"> </span><span class=\"n\">socket</span>:                 <span class=\"mi\">6</span>\n<span class=\"n\">Socket</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">)</span>:                          <span class=\"mi\">1</span>\n<span class=\"n\">NUMA</span><span class=\"w\"> </span><span class=\"n\">node</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">)</span>:                       <span class=\"mi\">1</span>\n<span class=\"n\">Vendor</span><span class=\"w\"> </span><span class=\"n\">ID</span>:                          <span class=\"nc\">GenuineIntel</span>\n<span class=\"n\">CPU</span><span class=\"w\"> </span><span class=\"n\">family</span>:                         <span class=\"mi\">6</span>\n<span class=\"n\">Model</span>:                              <span class=\"mi\">158</span>\n<span class=\"n\">Model</span><span class=\"w\"> </span><span class=\"n\">name</span>:                         <span class=\"nc\">Intel</span><span class=\"p\">(</span><span class=\"n\">R</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">Core</span><span class=\"p\">(</span><span class=\"n\">TM</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">i5</span><span class=\"o\">-</span><span class=\"mi\">9500</span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"n\">CPU</span><span class=\"w\"> </span><span class=\"o\">@</span><span class=\"w\"> </span><span class=\"mf\">2.20</span><span class=\"n\">GHz</span>\n<span class=\"n\">Stepping</span>:                           <span class=\"mi\">10</span>\n<span class=\"n\">CPU</span><span class=\"w\"> </span><span class=\"n\">MHz</span>:                            <span class=\"mf\">2200.000</span>\n<span class=\"n\">CPU</span><span class=\"w\"> </span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"n\">MHz</span>:                        <span class=\"mf\">3700.0000</span>\n<span class=\"n\">CPU</span><span class=\"w\"> </span><span class=\"n\">min</span><span class=\"w\"> </span><span class=\"n\">MHz</span>:                        <span class=\"mf\">800.0000</span>\n<span class=\"n\">BogoMIPS</span>:                           <span class=\"mf\">4399.99</span>\n<span class=\"n\">Virtualization</span>:                     <span class=\"nc\">VT</span><span class=\"o\">-</span><span class=\"n\">x</span>\n<span class=\"n\">L1d</span><span class=\"w\"> </span><span class=\"n\">cache</span>:                          <span class=\"mi\">192</span><span class=\"w\"> </span><span class=\"n\">KiB</span>\n<span class=\"n\">L1i</span><span class=\"w\"> </span><span class=\"n\">cache</span>:                          <span class=\"mi\">192</span><span class=\"w\"> </span><span class=\"n\">KiB</span>\n<span class=\"n\">L2</span><span class=\"w\"> </span><span class=\"n\">cache</span>:                           <span class=\"mf\">1.5</span><span class=\"w\"> </span><span class=\"n\">MiB</span>\n<span class=\"n\">L3</span><span class=\"w\"> </span><span class=\"n\">cache</span>:                           <span class=\"mi\">9</span><span class=\"w\"> </span><span class=\"n\">MiB</span>\n<span class=\"n\">NUMA</span><span class=\"w\"> </span><span class=\"n\">node0</span><span class=\"w\"> </span><span class=\"n\">CPU</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">)</span>:                  <span class=\"mi\">0</span><span class=\"o\">-</span><span class=\"mi\">5</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Gather</span><span class=\"w\"> </span><span class=\"n\">data</span><span class=\"w\"> </span><span class=\"n\">sampling</span>: <span class=\"nc\">Mitigation</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">Microcode</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Itlb</span><span class=\"w\"> </span><span class=\"n\">multihit</span>:        <span class=\"nc\">KVM</span>: <span class=\"nc\">Mitigation</span>: <span class=\"nc\">VMX</span><span class=\"w\"> </span><span class=\"n\">disabled</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">L1tf</span>:                 <span class=\"nc\">Mitigation</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">PTE</span><span class=\"w\"> </span><span class=\"n\">Inversion</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">VMX</span><span class=\"w\"> </span><span class=\"n\">conditional</span><span class=\"w\"> </span><span class=\"n\">cache</span><span class=\"w\"> </span><span class=\"n\">flushes</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">SMT</span><span class=\"w\"> </span><span class=\"n\">disabled</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Mds</span>:                  <span class=\"nc\">Mitigation</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">Clear</span><span class=\"w\"> </span><span class=\"n\">CPU</span><span class=\"w\"> </span><span class=\"n\">buffers</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">SMT</span><span class=\"w\"> </span><span class=\"n\">disabled</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Meltdown</span>:             <span class=\"nc\">Mitigation</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">PTI</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Mmio</span><span class=\"w\"> </span><span class=\"n\">stale</span><span class=\"w\"> </span><span class=\"n\">data</span>:      <span class=\"nc\">Mitigation</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">Clear</span><span class=\"w\"> </span><span class=\"n\">CPU</span><span class=\"w\"> </span><span class=\"n\">buffers</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">SMT</span><span class=\"w\"> </span><span class=\"n\">disabled</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Retbleed</span>:             <span class=\"nc\">Mitigation</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">IBRS</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Spec</span><span class=\"w\"> </span><span class=\"n\">rstack</span><span class=\"w\"> </span><span class=\"n\">overflow</span>: <span class=\"nc\">Not</span><span class=\"w\"> </span><span class=\"n\">affected</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Spec</span><span class=\"w\"> </span><span class=\"n\">store</span><span class=\"w\"> </span><span class=\"n\">bypass</span>:    <span class=\"nc\">Mitigation</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">Speculative</span><span class=\"w\"> </span><span class=\"n\">Store</span><span class=\"w\"> </span><span class=\"n\">Bypass</span><span class=\"w\"> </span><span class=\"n\">disabled</span><span class=\"w\"> </span><span class=\"n\">via</span><span class=\"w\"> </span><span class=\"n\">prctl</span><span class=\"w\"> </span><span class=\"n\">and</span><span class=\"w\"> </span><span class=\"n\">seccomp</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Spectre</span><span class=\"w\"> </span><span class=\"n\">v1</span>:           <span class=\"nc\">Mitigation</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">usercopy</span><span class=\"o\">/</span><span class=\"n\">swapgs</span><span class=\"w\"> </span><span class=\"n\">barriers</span><span class=\"w\"> </span><span class=\"n\">and</span><span class=\"w\"> </span><span class=\"n\">__user</span><span class=\"w\"> </span><span class=\"n\">pointer</span><span class=\"w\"> </span><span class=\"n\">sanitization</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Spectre</span><span class=\"w\"> </span><span class=\"n\">v2</span>:           <span class=\"nc\">Mitigation</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">IBRS</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">IBPB</span><span class=\"w\"> </span><span class=\"n\">conditional</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">STIBP</span><span class=\"w\"> </span><span class=\"n\">disabled</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">RSB</span><span class=\"w\"> </span><span class=\"n\">filling</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">PBRSB</span><span class=\"o\">-</span><span class=\"n\">eIBRS</span><span class=\"w\"> </span><span class=\"n\">Not</span><span class=\"w\"> </span><span class=\"n\">affected</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Srbds</span>:                <span class=\"nc\">Mitigation</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">Microcode</span>\n<span class=\"n\">Vulnerability</span><span class=\"w\"> </span><span class=\"n\">Tsx</span><span class=\"w\"> </span><span class=\"k\">async</span><span class=\"w\"> </span><span class=\"n\">abort</span>:      <span class=\"nc\">Mitigation</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">TSX</span><span class=\"w\"> </span><span class=\"n\">disabled</span>\n<span class=\"n\">Flags</span>:                              <span class=\"nc\">fpu</span><span class=\"w\"> </span><span class=\"n\">vme</span><span class=\"w\"> </span><span class=\"n\">de</span><span class=\"w\"> </span><span class=\"n\">pse</span><span class=\"w\"> </span><span class=\"n\">tsc</span><span class=\"w\"> </span><span class=\"n\">msr</span><span class=\"w\"> </span><span class=\"n\">pae</span><span class=\"w\"> </span><span class=\"n\">mce</span><span class=\"w\"> </span><span class=\"n\">cx8</span><span class=\"w\"> </span><span class=\"n\">apic</span><span class=\"w\"> </span><span class=\"n\">sep</span><span class=\"w\"> </span><span class=\"n\">mtrr</span><span class=\"w\"> </span><span class=\"n\">pge</span><span class=\"w\"> </span><span class=\"n\">mca</span><span class=\"w\"> </span><span class=\"n\">cmov</span><span class=\"w\"> </span><span class=\"n\">pat</span><span class=\"w\"> </span><span class=\"n\">pse36</span><span class=\"w\"> </span><span class=\"n\">clflush</span><span class=\"w\"> </span><span class=\"n\">dts</span><span class=\"w\"> </span><span class=\"n\">acpi</span><span class=\"w\"> </span><span class=\"n\">mmx</span><span class=\"w\"> </span><span class=\"n\">fxsr</span><span class=\"w\"> </span><span class=\"n\">sse</span><span class=\"w\"> </span><span class=\"n\">sse2</span><span class=\"w\"> </span><span class=\"n\">ss</span><span class=\"w\"> </span><span class=\"n\">ht</span><span class=\"w\"> </span><span class=\"n\">tm</span><span class=\"w\"> </span><span class=\"n\">pbe</span><span class=\"w\"> </span><span class=\"n\">syscal</span>\n<span class=\"w\">                                    </span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"n\">nx</span><span class=\"w\"> </span><span class=\"n\">pdpe1gb</span><span class=\"w\"> </span><span class=\"n\">rdtscp</span><span class=\"w\"> </span><span class=\"n\">lm</span><span class=\"w\"> </span><span class=\"n\">constant_tsc</span><span class=\"w\"> </span><span class=\"n\">art</span><span class=\"w\"> </span><span class=\"n\">arch_perfmon</span><span class=\"w\"> </span><span class=\"n\">pebs</span><span class=\"w\"> </span><span class=\"n\">bts</span><span class=\"w\"> </span><span class=\"n\">rep_good</span><span class=\"w\"> </span><span class=\"n\">nopl</span><span class=\"w\"> </span><span class=\"n\">xtopology</span><span class=\"w\"> </span><span class=\"n\">nonstop_tsc</span><span class=\"w\"> </span><span class=\"n\">cpuid</span><span class=\"w\"> </span><span class=\"n\">aperfmperf</span><span class=\"w\"> </span><span class=\"n\">pni</span><span class=\"w\"> </span><span class=\"n\">pclmulq</span>\n<span class=\"w\">                                    </span><span class=\"n\">dq</span><span class=\"w\"> </span><span class=\"n\">dtes64</span><span class=\"w\"> </span><span class=\"n\">monitor</span><span class=\"w\"> </span><span class=\"n\">ds_cpl</span><span class=\"w\"> </span><span class=\"n\">vmx</span><span class=\"w\"> </span><span class=\"n\">smx</span><span class=\"w\"> </span><span class=\"n\">est</span><span class=\"w\"> </span><span class=\"n\">tm2</span><span class=\"w\"> </span><span class=\"n\">ssse3</span><span class=\"w\"> </span><span class=\"n\">sdbg</span><span class=\"w\"> </span><span class=\"n\">fma</span><span class=\"w\"> </span><span class=\"n\">cx16</span><span class=\"w\"> </span><span class=\"n\">xtpr</span><span class=\"w\"> </span><span class=\"n\">pdcm</span><span class=\"w\"> </span><span class=\"n\">pcid</span><span class=\"w\"> </span><span class=\"n\">sse4_1</span><span class=\"w\"> </span><span class=\"n\">sse4_2</span><span class=\"w\"> </span><span class=\"n\">x2apic</span><span class=\"w\"> </span><span class=\"n\">movbe</span><span class=\"w\"> </span><span class=\"n\">popcnt</span><span class=\"w\"> </span><span class=\"n\">tsc_deadline_tim</span>\n<span class=\"w\">                                    </span><span class=\"n\">er</span><span class=\"w\"> </span><span class=\"n\">aes</span><span class=\"w\"> </span><span class=\"n\">xsave</span><span class=\"w\"> </span><span class=\"n\">avx</span><span class=\"w\"> </span><span class=\"n\">f16c</span><span class=\"w\"> </span><span class=\"n\">rdrand</span><span class=\"w\"> </span><span class=\"n\">lahf_lm</span><span class=\"w\"> </span><span class=\"n\">abm</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"n\">dnowprefetch</span><span class=\"w\"> </span><span class=\"n\">cpuid_fault</span><span class=\"w\"> </span><span class=\"n\">epb</span><span class=\"w\"> </span><span class=\"n\">invpcid_single</span><span class=\"w\"> </span><span class=\"n\">pti</span><span class=\"w\"> </span><span class=\"n\">ssbd</span><span class=\"w\"> </span><span class=\"n\">ibrs</span><span class=\"w\"> </span><span class=\"n\">ibpb</span><span class=\"w\"> </span><span class=\"n\">stibp</span><span class=\"w\"> </span><span class=\"n\">tpr_shadow</span><span class=\"w\"> </span><span class=\"n\">vnmi</span>\n<span class=\"w\">                                     </span><span class=\"n\">flexpriority</span><span class=\"w\"> </span><span class=\"n\">ept</span><span class=\"w\"> </span><span class=\"n\">vpid</span><span class=\"w\"> </span><span class=\"n\">ept_ad</span><span class=\"w\"> </span><span class=\"n\">fsgsbase</span><span class=\"w\"> </span><span class=\"n\">tsc_adjust</span><span class=\"w\"> </span><span class=\"n\">bmi1</span><span class=\"w\"> </span><span class=\"n\">avx2</span><span class=\"w\"> </span><span class=\"n\">smep</span><span class=\"w\"> </span><span class=\"n\">bmi2</span><span class=\"w\"> </span><span class=\"n\">erms</span><span class=\"w\"> </span><span class=\"n\">invpcid</span><span class=\"w\"> </span><span class=\"n\">mpx</span><span class=\"w\"> </span><span class=\"n\">rdseed</span><span class=\"w\"> </span><span class=\"n\">adx</span><span class=\"w\"> </span><span class=\"n\">smap</span><span class=\"w\"> </span><span class=\"n\">clflushopt</span><span class=\"w\"> </span><span class=\"n\">intel_pt</span><span class=\"w\"> </span><span class=\"n\">xsa</span>\n<span class=\"w\">                                    </span><span class=\"n\">veopt</span><span class=\"w\"> </span><span class=\"n\">xsavec</span><span class=\"w\"> </span><span class=\"n\">xgetbv1</span><span class=\"w\"> </span><span class=\"n\">xsaves</span><span class=\"w\"> </span><span class=\"n\">dtherm</span><span class=\"w\"> </span><span class=\"n\">ida</span><span class=\"w\"> </span><span class=\"n\">arat</span><span class=\"w\"> </span><span class=\"n\">pln</span><span class=\"w\"> </span><span class=\"n\">pts</span><span class=\"w\"> </span><span class=\"n\">hwp</span><span class=\"w\"> </span><span class=\"n\">hwp_notify</span><span class=\"w\"> </span><span class=\"n\">hwp_act_window</span><span class=\"w\"> </span><span class=\"n\">hwp_epp</span><span class=\"w\"> </span><span class=\"n\">md_clear</span><span class=\"w\"> </span><span class=\"n\">flush_l1d</span><span class=\"w\"> </span><span class=\"n\">arch_capabilities</span>\n</code></pre></div>\n<p>Also, I use the inline assembly to run the binary generated by <code>Wasmer</code> and <code>Wasmtime</code> and compare the execution time, I also find the difference in execution time. Maybe it is helpful to your debugging so I paste it here.<br>\n- <code>test_wasmtime</code>: 12.59s<br>\n- <code>test_wasmer</code>: 0.35s</p>\n<div class=\"codehilite\" data-code-language=\"C\"><pre><span></span><code><span class=\"cp\">#include</span><span class=\"w\"> </span><span class=\"cpf\">&lt;stdint.h&gt;</span>\n\n\n<span class=\"kt\">double</span><span class=\"w\"> </span><span class=\"n\">X</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">1.0</span><span class=\"p\">;</span>\n\n<span class=\"kt\">uint64_t</span><span class=\"w\"> </span><span class=\"nf\">test_wasmtime</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">  </span><span class=\"n\">__asm__</span><span class=\"w\"> </span><span class=\"n\">__volatile__</span><span class=\"p\">(</span>\n<span class=\"s\">\"vxorpd %%xmm5,%%xmm5,%%xmm6</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span>\n<span class=\"s\">\"xor    %%r11d,%%r11d</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span>\n<span class=\"s\">\"START1%=:</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span>\n<span class=\"s\">\"add    $0x1,%%r11d</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span>\n<span class=\"s\">\"movabs $0x100000264d8,%%rsi</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span>\n<span class=\"s\">\"vmovq  %%rsi,%%xmm0</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span>\n<span class=\"s\">\"vmulsd %0,%%xmm0,%%xmm7</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span>\n<span class=\"s\">\"vaddsd %%xmm6,%%xmm7,%%xmm6</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span>\n<span class=\"s\">\"cmp    $0x12a05f20,%%r11d</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span>\n<span class=\"s\">\"jne    START1%=</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span><span class=\"o\">:</span><span class=\"s\">\"=m\"</span><span class=\"p\">(</span><span class=\"n\">X</span><span class=\"p\">)</span><span class=\"o\">::</span><span class=\"s\">\"rsi\"</span><span class=\"p\">,</span><span class=\"s\">\"r11\"</span><span class=\"p\">);</span>\n<span class=\"w\">  </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n\n<span class=\"kt\">uint64_t</span><span class=\"w\"> </span><span class=\"nf\">test_wasmer</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">  </span><span class=\"n\">__asm__</span><span class=\"w\"> </span><span class=\"n\">__volatile__</span><span class=\"p\">(</span>\n<span class=\"s\">\"movabs $0x100000264d8,%%r11</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span>\n<span class=\"s\">\"movq   %%r11,%%xmm9</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span>\n<span class=\"s\">\"mulsd  %0,%%xmm9</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span>\n<span class=\"s\">\"xorpd  %%xmm7,%%xmm7</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span>\n<span class=\"s\">\"xor    %%r8d,%%r8d</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span>\n<span class=\"s\">\"START2%=:</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span>\n<span class=\"s\">\"movdqa %%xmm9,%%xmm15</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span>\n<span class=\"s\">\"addsd  %%xmm7,%%xmm15</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span>\n<span class=\"s\">\"add    $0x1,%%r8d</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span>\n<span class=\"s\">\"cmp    $0x12a05f20,%%r8d</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span>\n<span class=\"s\">\"setne  %%dil</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span>\n<span class=\"s\">\"movzbl %%dil,%%edi</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span>\n<span class=\"s\">\"test   %%edi,%%edi</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span>\n<span class=\"s\">\"je     EXIT2%=</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span>\n<span class=\"s\">\"movdqa %%xmm15,%%xmm7</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span>\n<span class=\"s\">\"jmp   START2%=</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span>\n<span class=\"s\">\"EXIT2%=:</span><span class=\"se\">\\n\\t</span><span class=\"s\">\"</span><span class=\"o\">:</span><span class=\"s\">\"=m\"</span><span class=\"p\">(</span><span class=\"n\">X</span><span class=\"p\">)</span><span class=\"o\">::</span><span class=\"s\">\"r11\"</span><span class=\"p\">,</span><span class=\"s\">\"r8\"</span><span class=\"p\">,</span><span class=\"s\">\"rdi\"</span><span class=\"p\">);</span>\n<span class=\"w\">  </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n\n<span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"nf\">main</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">  </span><span class=\"n\">test_wasmtime</span><span class=\"p\">();</span>\n<span class=\"w\">  </span><span class=\"c1\">// test_wasmer();</span>\n<span class=\"w\">  </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p><a href=\"https://github.com/bytecodealliance/wasmtime/files/13051519/reduce.zip\">reduce.zip</a><br>\n</p>\n</blockquote>",
        "id": 397698751,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1697804693
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7246#issuecomment-1772924778\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7246\">issue #7246</a>:</p>\n<blockquote>\n<p>Thanks for the follow-up @hungryzzz, although I've got a few questions for you. It's known that Wasmtime is slow with respect to this computation on its <code>main</code> branch (as of right now and the commit you said you were using). <a href=\"https://github.com/bytecodealliance/wasmtime/pull/7306\">https://github.com/bytecodealliance/wasmtime/pull/7306</a> fixes the problem though by keeping one of the computations here out of the loop. In your <code>test_wasmtime</code> function, for example, the loop has both a <code>vmulsd</code> and a <code>vaddsd</code>, but the <code>vmulsd</code> computation is loop-invariant and shouldn't be in the loop.</p>\n<p>Generating the x64 assembly with #7306 I get:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"mi\">0000000000000040</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">wasm</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span>::<span class=\"n\">function</span><span class=\"p\">[</span><span class=\"mi\">2</span><span class=\"p\">]</span><span class=\"o\">&gt;</span>:\n      <span class=\"mi\">40</span>: <span class=\"mi\">55</span><span class=\"w\">                            </span><span class=\"n\">pushq</span><span class=\"w\">   </span><span class=\"o\">%</span><span class=\"n\">rbp</span>\n<span class=\"w\">      </span><span class=\"mi\">41</span>: <span class=\"mi\">48</span><span class=\"w\"> </span><span class=\"mi\">89</span><span class=\"w\"> </span><span class=\"n\">e5</span><span class=\"w\">                      </span><span class=\"n\">movq</span><span class=\"w\">    </span><span class=\"o\">%</span><span class=\"n\">rsp</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">%</span><span class=\"n\">rbp</span>\n<span class=\"w\">      </span><span class=\"mi\">44</span>: <span class=\"mi\">4</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"mi\">8</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"mi\">57</span><span class=\"w\"> </span><span class=\"mi\">08</span><span class=\"w\">                   </span><span class=\"n\">movq</span><span class=\"w\">    </span><span class=\"mi\">8</span><span class=\"p\">(</span><span class=\"o\">%</span><span class=\"n\">rdi</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"o\">%</span><span class=\"n\">r10</span>\n<span class=\"w\">      </span><span class=\"mi\">48</span>: <span class=\"mi\">4</span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"mi\">8</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"mi\">12</span><span class=\"w\">                      </span><span class=\"n\">movq</span><span class=\"w\">    </span><span class=\"p\">(</span><span class=\"o\">%</span><span class=\"n\">r10</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"o\">%</span><span class=\"n\">r10</span>\n<span class=\"w\">      </span><span class=\"mi\">4</span><span class=\"n\">b</span>: <span class=\"mi\">49</span><span class=\"w\"> </span><span class=\"mi\">39</span><span class=\"w\"> </span><span class=\"n\">e2</span><span class=\"w\">                      </span><span class=\"n\">cmpq</span><span class=\"w\">    </span><span class=\"o\">%</span><span class=\"n\">rsp</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">%</span><span class=\"n\">r10</span>\n<span class=\"w\">      </span><span class=\"mi\">4</span><span class=\"n\">e</span>: <span class=\"mi\">0</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"mi\">87</span><span class=\"w\"> </span><span class=\"mi\">38</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\">             </span><span class=\"n\">ja</span><span class=\"w\">      </span><span class=\"mh\">0x8c</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">wasm</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span>::<span class=\"n\">function</span><span class=\"p\">[</span><span class=\"mi\">2</span><span class=\"p\">]</span><span class=\"o\">+</span><span class=\"mh\">0x4c</span><span class=\"o\">&gt;</span>\n<span class=\"w\">      </span><span class=\"mi\">54</span>: <span class=\"nc\">c5</span><span class=\"w\"> </span><span class=\"n\">d1</span><span class=\"w\"> </span><span class=\"mi\">57</span><span class=\"w\"> </span><span class=\"n\">e5</span><span class=\"w\">                   </span><span class=\"n\">vxorpd</span><span class=\"w\">  </span><span class=\"o\">%</span><span class=\"n\">xmm5</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">%</span><span class=\"n\">xmm5</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">%</span><span class=\"n\">xmm4</span>\n<span class=\"w\">      </span><span class=\"mi\">58</span>: <span class=\"mi\">45</span><span class=\"w\"> </span><span class=\"mi\">31</span><span class=\"w\"> </span><span class=\"n\">c9</span><span class=\"w\">                      </span><span class=\"n\">xorl</span><span class=\"w\">    </span><span class=\"o\">%</span><span class=\"n\">r9d</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">%</span><span class=\"n\">r9d</span>\n<span class=\"w\">      </span><span class=\"mi\">5</span><span class=\"n\">b</span>: <span class=\"mi\">48</span><span class=\"w\"> </span><span class=\"n\">ba</span><span class=\"w\"> </span><span class=\"n\">d8</span><span class=\"w\"> </span><span class=\"mi\">64</span><span class=\"w\"> </span><span class=\"mi\">02</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">01</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"n\">movabsq</span><span class=\"w\"> </span><span class=\"cp\">$</span><span class=\"mi\">1099511784664</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">%</span><span class=\"n\">rdx</span><span class=\"w\">    </span>#<span class=\"w\"> </span><span class=\"n\">imm</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mh\">0x100000264D8</span>\n<span class=\"w\">      </span><span class=\"mi\">65</span>: <span class=\"nc\">c4</span><span class=\"w\"> </span><span class=\"n\">e1</span><span class=\"w\"> </span><span class=\"n\">f9</span><span class=\"w\"> </span><span class=\"mi\">6</span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"n\">fa</span><span class=\"w\">                </span><span class=\"n\">vmovq</span><span class=\"w\">   </span><span class=\"o\">%</span><span class=\"n\">rdx</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">%</span><span class=\"n\">xmm7</span>\n<span class=\"w\">      </span><span class=\"mi\">6</span><span class=\"n\">a</span>: <span class=\"nc\">c5</span><span class=\"w\"> </span><span class=\"n\">c3</span><span class=\"w\"> </span><span class=\"mi\">59</span><span class=\"w\"> </span><span class=\"mi\">35</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\">       </span><span class=\"n\">vmulsd</span><span class=\"w\">  </span><span class=\"mi\">30</span><span class=\"p\">(</span><span class=\"o\">%</span><span class=\"n\">rip</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"o\">%</span><span class=\"n\">xmm7</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">%</span><span class=\"n\">xmm6</span><span class=\"w\">  </span>#<span class=\"w\"> </span><span class=\"mh\">0x90</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">wasm</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span>::<span class=\"n\">function</span><span class=\"p\">[</span><span class=\"mi\">2</span><span class=\"p\">]</span><span class=\"o\">+</span><span class=\"mh\">0x50</span><span class=\"o\">&gt;</span>\n<span class=\"w\">      </span><span class=\"mi\">72</span>: <span class=\"mi\">41</span><span class=\"w\"> </span><span class=\"mi\">83</span><span class=\"w\"> </span><span class=\"n\">c1</span><span class=\"w\"> </span><span class=\"mi\">01</span><span class=\"w\">                   </span><span class=\"n\">addl</span><span class=\"w\">    </span><span class=\"cp\">$</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">%</span><span class=\"n\">r9d</span>\n<span class=\"w\">      </span><span class=\"mi\">76</span>: <span class=\"nc\">c5</span><span class=\"w\"> </span><span class=\"n\">cb</span><span class=\"w\"> </span><span class=\"mi\">58</span><span class=\"w\"> </span><span class=\"n\">e4</span><span class=\"w\">                   </span><span class=\"n\">vaddsd</span><span class=\"w\">  </span><span class=\"o\">%</span><span class=\"n\">xmm4</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">%</span><span class=\"n\">xmm6</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">%</span><span class=\"n\">xmm4</span>\n<span class=\"w\">      </span><span class=\"mi\">7</span><span class=\"n\">a</span>: <span class=\"mi\">41</span><span class=\"w\"> </span><span class=\"mi\">81</span><span class=\"w\"> </span><span class=\"n\">f9</span><span class=\"w\"> </span><span class=\"mi\">20</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">a0</span><span class=\"w\"> </span><span class=\"mi\">12</span><span class=\"w\">          </span><span class=\"n\">cmpl</span><span class=\"w\">    </span><span class=\"cp\">$</span><span class=\"mi\">312500000</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">%</span><span class=\"n\">r9d</span><span class=\"w\">        </span>#<span class=\"w\"> </span><span class=\"n\">imm</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mh\">0x12A05F20</span>\n<span class=\"w\">      </span><span class=\"mi\">81</span>: <span class=\"mi\">0</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"mi\">85</span><span class=\"w\"> </span><span class=\"n\">eb</span><span class=\"w\"> </span><span class=\"n\">ff</span><span class=\"w\"> </span><span class=\"n\">ff</span><span class=\"w\"> </span><span class=\"n\">ff</span><span class=\"w\">             </span><span class=\"n\">jne</span><span class=\"w\">     </span><span class=\"mh\">0x72</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">wasm</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span>::<span class=\"n\">function</span><span class=\"p\">[</span><span class=\"mi\">2</span><span class=\"p\">]</span><span class=\"o\">+</span><span class=\"mh\">0x32</span><span class=\"o\">&gt;</span>\n<span class=\"w\">      </span><span class=\"mi\">87</span>: <span class=\"mi\">48</span><span class=\"w\"> </span><span class=\"mi\">89</span><span class=\"w\"> </span><span class=\"n\">ec</span><span class=\"w\">                      </span><span class=\"n\">movq</span><span class=\"w\">    </span><span class=\"o\">%</span><span class=\"n\">rbp</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">%</span><span class=\"n\">rsp</span>\n<span class=\"w\">      </span><span class=\"mi\">8</span><span class=\"n\">a</span>: <span class=\"mi\">5</span><span class=\"n\">d</span><span class=\"w\">                            </span><span class=\"n\">popq</span><span class=\"w\">    </span><span class=\"o\">%</span><span class=\"n\">rbp</span>\n<span class=\"w\">      </span><span class=\"mi\">8</span><span class=\"n\">b</span>: <span class=\"nc\">c3</span><span class=\"w\">                            </span><span class=\"n\">retq</span>\n<span class=\"w\">      </span><span class=\"mi\">8</span><span class=\"n\">c</span>: <span class=\"mi\">0</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"n\">b</span><span class=\"w\">                         </span><span class=\"n\">ud2</span>\n</code></pre></div>\n<p>where here the conditional jump at 0x81 goes to 0x72 meaning that the <code>vmulsd</code> is lifted outside of the loop as expected. I unfortunately do not have an x64 machine to test the relative performance before and after #7306, but I wanted to ask whether you tested this? When testing the performance of this program I'd recommend using #7306 as the version of Wasmtime to use. If you're using that though and still seeing performance problems let us know!</p>\n</blockquote>",
        "id": 397731387,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1697814705
    },
    {
        "content": "<p>hungryzzz <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7246#issuecomment-1774017356\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7246\">issue #7246</a>:</p>\n<blockquote>\n<p>@alexcrichton Hi, the performance regression disappeared in the latest <code>Wasmtime</code>.</p>\n<p>But I think the performance regression in the old version <code>Wasmtime</code> is not only related to the wrong code sinking, because if I change the magic number <code>5.43231e-312</code> to <code>5.4</code>(or other normal floating point numbers), the execution time  will back to normal. So I think the performance regression is the result of both wrong code sinking and this magic number <code>5.43231e-312</code>.</p>\n<p>After searching, I find the reason from this paper <a href=\"https://ieeexplore.ieee.org/document/7163051\">On Subnormal Floating Point and Abnormal Timing</a>.</p>\n<blockquote>\n<p>We identify a timing channel in the floating point instructions of modern x86 processors: the running time of floating point addition and multiplication instructions can vary by two orders of magnitude depending on their operands. </p>\n</blockquote>\n<p>This paper finds that floating point operands ranging from <code>4.9e-324 ~ 2.23e-308</code> will result in execution times of two orders of magnitude, so if I use other floating point numbers, the wrong code sinking to loop does not bring such a big performance regression. But you're right, <a href=\"https://github.com/bytecodealliance/wasmtime/pull/7306\">https://github.com/bytecodealliance/wasmtime/pull/7306</a> will fix this performance regression.</p>\n<p><div class=\"codehilite\" data-code-language=\"WebAssembly\"><pre><span></span><code><span class=\"c1\">;; reduce.wat</span>\n<span class=\"p\">(</span><span class=\"k\">module</span>\n  <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"cm\">(;0;)</span> <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"p\">(</span><span class=\"k\">param</span> <span class=\"kt\">i32</span><span class=\"p\">)))</span>\n  <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"cm\">(;1;)</span> <span class=\"p\">(</span><span class=\"k\">func</span><span class=\"p\">))</span>\n  <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"cm\">(;2;)</span> <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"p\">(</span><span class=\"k\">result</span> <span class=\"kt\">i32</span><span class=\"p\">)))</span>\n  <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"cm\">(;3;)</span> <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"p\">(</span><span class=\"k\">param</span> <span class=\"kt\">i32</span><span class=\"p\">)</span> <span class=\"p\">(</span><span class=\"k\">result</span> <span class=\"kt\">i32</span><span class=\"p\">)))</span>\n  <span class=\"p\">(</span><span class=\"k\">import</span> <span class=\"s2\">\"wasi_snapshot_preview1\"</span> <span class=\"s2\">\"proc_exit\"</span> <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"cm\">(;0;)</span> <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"mi\">0</span><span class=\"p\">)))</span>\n  <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"cm\">(;2;)</span> <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"mi\">1</span><span class=\"p\">)</span>\n    <span class=\"nb\">call</span> <span class=\"mi\">2</span>\n    <span class=\"nb\">i32.const</span> <span class=\"mi\">0</span>\n    <span class=\"nb\">call</span> <span class=\"mi\">0</span>\n    <span class=\"nb\">unreachable</span><span class=\"p\">)</span>\n  <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"cm\">(;2;)</span> <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"mi\">1</span><span class=\"p\">)</span>\n    <span class=\"p\">(</span><span class=\"k\">local</span> <span class=\"kt\">f64</span> <span class=\"kt\">f64</span> <span class=\"kt\">i32</span><span class=\"p\">)</span>\n    <span class=\"nb\">f64.const</span> <span class=\"mf\">5.43231e-312</span> <span class=\"c1\">;; Magic Number!!!</span>\n    <span class=\"nb\">f64.const</span> <span class=\"mf\">1.0</span>\n    <span class=\"nb\">f64.mul</span>\n    <span class=\"nb\">local.set</span> <span class=\"mi\">1</span>\n    <span class=\"k\">loop</span>  <span class=\"c1\">;; label = @1</span>\n      <span class=\"nb\">local.get</span> <span class=\"mi\">1</span>\n      <span class=\"nb\">local.get</span> <span class=\"mi\">0</span>\n      <span class=\"nb\">f64.add</span>\n      <span class=\"nb\">local.set</span> <span class=\"mi\">0</span>\n      <span class=\"nb\">local.get</span> <span class=\"mi\">2</span>   <span class=\"c1\">;; condition variable i</span>\n      <span class=\"nb\">i32.const</span> <span class=\"mi\">1</span>\n      <span class=\"nb\">i32.add</span>\n      <span class=\"nb\">local.tee</span> <span class=\"mi\">2</span>   <span class=\"c1\">;; i++</span>\n      <span class=\"nb\">i32.const</span> <span class=\"mf\">312500000</span>\n      <span class=\"nb\">i32.ne</span>\n      <span class=\"nb\">br_if</span> <span class=\"mi\">0</span> <span class=\"cm\">(;@1;)</span>\n    <span class=\"k\">end</span>\n  <span class=\"p\">)</span>\n  <span class=\"p\">(</span><span class=\"k\">table</span> <span class=\"cm\">(;0;)</span> <span class=\"mf\">2 2</span> <span class=\"k\">funcref</span><span class=\"p\">)</span>\n  <span class=\"p\">(</span><span class=\"k\">memory</span> <span class=\"cm\">(;0;)</span> <span class=\"mf\">8192</span> <span class=\"mf\">8192</span><span class=\"p\">)</span>\n  <span class=\"p\">(</span><span class=\"k\">global</span> <span class=\"cm\">(;0;)</span> <span class=\"p\">(</span><span class=\"k\">mut</span> <span class=\"kt\">i32</span><span class=\"p\">)</span> <span class=\"p\">(</span><span class=\"nb\">i32.const</span> <span class=\"mf\">66576</span><span class=\"p\">))</span>\n  <span class=\"p\">(</span><span class=\"k\">export</span> <span class=\"s2\">\"memory\"</span> <span class=\"p\">(</span><span class=\"k\">memory</span> <span class=\"mi\">0</span><span class=\"p\">))</span>\n  <span class=\"p\">(</span><span class=\"k\">export</span> <span class=\"s2\">\"__indirect_function_table\"</span> <span class=\"p\">(</span><span class=\"k\">table</span> <span class=\"mi\">0</span><span class=\"p\">))</span>\n  <span class=\"p\">(</span><span class=\"k\">export</span> <span class=\"s2\">\"_start\"</span> <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"mi\">1</span><span class=\"p\">)))</span>\n</code></pre></div><br>\n</p>\n</blockquote>",
        "id": 397919224,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1697959038
    },
    {
        "content": "<p>hungryzzz edited a <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7246#issuecomment-1774017356\">comment</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7246\">issue #7246</a>:</p>\n<blockquote>\n<p>@alexcrichton Hi, the performance regression disappeared in the latest <code>Wasmtime</code>.</p>\n<p>But I think the performance regression in the old version <code>Wasmtime</code> is not only related to the wrong code sinking, because if I change the magic number <code>5.43231e-312</code> to <code>5.4</code>(or other normal floating point numbers), the execution time  will back to normal. So I think the performance regression is the result of both wrong code sinking and this magic number <code>5.43231e-312</code>.</p>\n<p>After searching, We find the reason from this paper <a href=\"https://ieeexplore.ieee.org/document/7163051\">On Subnormal Floating Point and Abnormal Timing</a>.</p>\n<blockquote>\n<p>We identify a timing channel in the floating point instructions of modern x86 processors: the running time of floating point addition and multiplication instructions can vary by two orders of magnitude depending on their operands. </p>\n</blockquote>\n<p>This paper finds that floating point operands ranging from <code>4.9e-324 ~ 2.23e-308</code> will result in execution times of two orders of magnitude, so if I use other floating point numbers, the wrong code sinking to loop does not bring such a big performance regression. But you're right, <a href=\"https://github.com/bytecodealliance/wasmtime/pull/7306\">https://github.com/bytecodealliance/wasmtime/pull/7306</a> will fix this performance regression.</p>\n<p><div class=\"codehilite\" data-code-language=\"WebAssembly\"><pre><span></span><code><span class=\"c1\">;; reduce.wat</span>\n<span class=\"p\">(</span><span class=\"k\">module</span>\n  <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"cm\">(;0;)</span> <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"p\">(</span><span class=\"k\">param</span> <span class=\"kt\">i32</span><span class=\"p\">)))</span>\n  <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"cm\">(;1;)</span> <span class=\"p\">(</span><span class=\"k\">func</span><span class=\"p\">))</span>\n  <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"cm\">(;2;)</span> <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"p\">(</span><span class=\"k\">result</span> <span class=\"kt\">i32</span><span class=\"p\">)))</span>\n  <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"cm\">(;3;)</span> <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"p\">(</span><span class=\"k\">param</span> <span class=\"kt\">i32</span><span class=\"p\">)</span> <span class=\"p\">(</span><span class=\"k\">result</span> <span class=\"kt\">i32</span><span class=\"p\">)))</span>\n  <span class=\"p\">(</span><span class=\"k\">import</span> <span class=\"s2\">\"wasi_snapshot_preview1\"</span> <span class=\"s2\">\"proc_exit\"</span> <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"cm\">(;0;)</span> <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"mi\">0</span><span class=\"p\">)))</span>\n  <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"cm\">(;2;)</span> <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"mi\">1</span><span class=\"p\">)</span>\n    <span class=\"nb\">call</span> <span class=\"mi\">2</span>\n    <span class=\"nb\">i32.const</span> <span class=\"mi\">0</span>\n    <span class=\"nb\">call</span> <span class=\"mi\">0</span>\n    <span class=\"nb\">unreachable</span><span class=\"p\">)</span>\n  <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"cm\">(;2;)</span> <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"mi\">1</span><span class=\"p\">)</span>\n    <span class=\"p\">(</span><span class=\"k\">local</span> <span class=\"kt\">f64</span> <span class=\"kt\">f64</span> <span class=\"kt\">i32</span><span class=\"p\">)</span>\n    <span class=\"nb\">f64.const</span> <span class=\"mf\">5.43231e-312</span> <span class=\"c1\">;; Magic Number!!!</span>\n    <span class=\"nb\">f64.const</span> <span class=\"mf\">1.0</span>\n    <span class=\"nb\">f64.mul</span>\n    <span class=\"nb\">local.set</span> <span class=\"mi\">1</span>\n    <span class=\"k\">loop</span>  <span class=\"c1\">;; label = @1</span>\n      <span class=\"nb\">local.get</span> <span class=\"mi\">1</span>\n      <span class=\"nb\">local.get</span> <span class=\"mi\">0</span>\n      <span class=\"nb\">f64.add</span>\n      <span class=\"nb\">local.set</span> <span class=\"mi\">0</span>\n      <span class=\"nb\">local.get</span> <span class=\"mi\">2</span>   <span class=\"c1\">;; condition variable i</span>\n      <span class=\"nb\">i32.const</span> <span class=\"mi\">1</span>\n      <span class=\"nb\">i32.add</span>\n      <span class=\"nb\">local.tee</span> <span class=\"mi\">2</span>   <span class=\"c1\">;; i++</span>\n      <span class=\"nb\">i32.const</span> <span class=\"mf\">312500000</span>\n      <span class=\"nb\">i32.ne</span>\n      <span class=\"nb\">br_if</span> <span class=\"mi\">0</span> <span class=\"cm\">(;@1;)</span>\n    <span class=\"k\">end</span>\n  <span class=\"p\">)</span>\n  <span class=\"p\">(</span><span class=\"k\">table</span> <span class=\"cm\">(;0;)</span> <span class=\"mf\">2 2</span> <span class=\"k\">funcref</span><span class=\"p\">)</span>\n  <span class=\"p\">(</span><span class=\"k\">memory</span> <span class=\"cm\">(;0;)</span> <span class=\"mf\">8192</span> <span class=\"mf\">8192</span><span class=\"p\">)</span>\n  <span class=\"p\">(</span><span class=\"k\">global</span> <span class=\"cm\">(;0;)</span> <span class=\"p\">(</span><span class=\"k\">mut</span> <span class=\"kt\">i32</span><span class=\"p\">)</span> <span class=\"p\">(</span><span class=\"nb\">i32.const</span> <span class=\"mf\">66576</span><span class=\"p\">))</span>\n  <span class=\"p\">(</span><span class=\"k\">export</span> <span class=\"s2\">\"memory\"</span> <span class=\"p\">(</span><span class=\"k\">memory</span> <span class=\"mi\">0</span><span class=\"p\">))</span>\n  <span class=\"p\">(</span><span class=\"k\">export</span> <span class=\"s2\">\"__indirect_function_table\"</span> <span class=\"p\">(</span><span class=\"k\">table</span> <span class=\"mi\">0</span><span class=\"p\">))</span>\n  <span class=\"p\">(</span><span class=\"k\">export</span> <span class=\"s2\">\"_start\"</span> <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"mi\">1</span><span class=\"p\">)))</span>\n</code></pre></div><br>\n</p>\n</blockquote>",
        "id": 397919708,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1697959604
    },
    {
        "content": "<p>hungryzzz edited a <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7246#issuecomment-1774017356\">comment</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7246\">issue #7246</a>:</p>\n<blockquote>\n<p>@alexcrichton Hi, the performance regression disappeared in the latest <code>Wasmtime</code>.</p>\n<p>But I think the performance regression in the old version <code>Wasmtime</code> is not only related to the wrong code sinking, because if I change the magic number <code>5.43231e-312</code> to <code>5.4</code>(or other normal floating point numbers), the execution time  will back to normal. So I think the performance regression is the result of both wrong code sinking and this magic number <code>5.43231e-312</code>.</p>\n<p>After searching, we find the reason from this paper <a href=\"https://ieeexplore.ieee.org/document/7163051\">On Subnormal Floating Point and Abnormal Timing</a>.</p>\n<blockquote>\n<p>We identify a timing channel in the floating point instructions of modern x86 processors: the running time of floating point addition and multiplication instructions can vary by two orders of magnitude depending on their operands. </p>\n</blockquote>\n<p>This paper finds that floating point operands ranging from <code>4.9e-324 ~ 2.23e-308</code> will result in execution times of two orders of magnitude, so if I use other floating point numbers, the wrong code sinking to loop does not bring such a big performance regression. But you're right, <a href=\"https://github.com/bytecodealliance/wasmtime/pull/7306\">https://github.com/bytecodealliance/wasmtime/pull/7306</a> will fix this performance regression.</p>\n<p><div class=\"codehilite\" data-code-language=\"WebAssembly\"><pre><span></span><code><span class=\"c1\">;; reduce.wat</span>\n<span class=\"p\">(</span><span class=\"k\">module</span>\n  <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"cm\">(;0;)</span> <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"p\">(</span><span class=\"k\">param</span> <span class=\"kt\">i32</span><span class=\"p\">)))</span>\n  <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"cm\">(;1;)</span> <span class=\"p\">(</span><span class=\"k\">func</span><span class=\"p\">))</span>\n  <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"cm\">(;2;)</span> <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"p\">(</span><span class=\"k\">result</span> <span class=\"kt\">i32</span><span class=\"p\">)))</span>\n  <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"cm\">(;3;)</span> <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"p\">(</span><span class=\"k\">param</span> <span class=\"kt\">i32</span><span class=\"p\">)</span> <span class=\"p\">(</span><span class=\"k\">result</span> <span class=\"kt\">i32</span><span class=\"p\">)))</span>\n  <span class=\"p\">(</span><span class=\"k\">import</span> <span class=\"s2\">\"wasi_snapshot_preview1\"</span> <span class=\"s2\">\"proc_exit\"</span> <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"cm\">(;0;)</span> <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"mi\">0</span><span class=\"p\">)))</span>\n  <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"cm\">(;2;)</span> <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"mi\">1</span><span class=\"p\">)</span>\n    <span class=\"nb\">call</span> <span class=\"mi\">2</span>\n    <span class=\"nb\">i32.const</span> <span class=\"mi\">0</span>\n    <span class=\"nb\">call</span> <span class=\"mi\">0</span>\n    <span class=\"nb\">unreachable</span><span class=\"p\">)</span>\n  <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"cm\">(;2;)</span> <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"mi\">1</span><span class=\"p\">)</span>\n    <span class=\"p\">(</span><span class=\"k\">local</span> <span class=\"kt\">f64</span> <span class=\"kt\">f64</span> <span class=\"kt\">i32</span><span class=\"p\">)</span>\n    <span class=\"nb\">f64.const</span> <span class=\"mf\">5.43231e-312</span> <span class=\"c1\">;; Magic Number!!!</span>\n    <span class=\"nb\">f64.const</span> <span class=\"mf\">1.0</span>\n    <span class=\"nb\">f64.mul</span>\n    <span class=\"nb\">local.set</span> <span class=\"mi\">1</span>\n    <span class=\"k\">loop</span>  <span class=\"c1\">;; label = @1</span>\n      <span class=\"nb\">local.get</span> <span class=\"mi\">1</span>\n      <span class=\"nb\">local.get</span> <span class=\"mi\">0</span>\n      <span class=\"nb\">f64.add</span>\n      <span class=\"nb\">local.set</span> <span class=\"mi\">0</span>\n      <span class=\"nb\">local.get</span> <span class=\"mi\">2</span>   <span class=\"c1\">;; condition variable i</span>\n      <span class=\"nb\">i32.const</span> <span class=\"mi\">1</span>\n      <span class=\"nb\">i32.add</span>\n      <span class=\"nb\">local.tee</span> <span class=\"mi\">2</span>   <span class=\"c1\">;; i++</span>\n      <span class=\"nb\">i32.const</span> <span class=\"mf\">312500000</span>\n      <span class=\"nb\">i32.ne</span>\n      <span class=\"nb\">br_if</span> <span class=\"mi\">0</span> <span class=\"cm\">(;@1;)</span>\n    <span class=\"k\">end</span>\n  <span class=\"p\">)</span>\n  <span class=\"p\">(</span><span class=\"k\">table</span> <span class=\"cm\">(;0;)</span> <span class=\"mf\">2 2</span> <span class=\"k\">funcref</span><span class=\"p\">)</span>\n  <span class=\"p\">(</span><span class=\"k\">memory</span> <span class=\"cm\">(;0;)</span> <span class=\"mf\">8192</span> <span class=\"mf\">8192</span><span class=\"p\">)</span>\n  <span class=\"p\">(</span><span class=\"k\">global</span> <span class=\"cm\">(;0;)</span> <span class=\"p\">(</span><span class=\"k\">mut</span> <span class=\"kt\">i32</span><span class=\"p\">)</span> <span class=\"p\">(</span><span class=\"nb\">i32.const</span> <span class=\"mf\">66576</span><span class=\"p\">))</span>\n  <span class=\"p\">(</span><span class=\"k\">export</span> <span class=\"s2\">\"memory\"</span> <span class=\"p\">(</span><span class=\"k\">memory</span> <span class=\"mi\">0</span><span class=\"p\">))</span>\n  <span class=\"p\">(</span><span class=\"k\">export</span> <span class=\"s2\">\"__indirect_function_table\"</span> <span class=\"p\">(</span><span class=\"k\">table</span> <span class=\"mi\">0</span><span class=\"p\">))</span>\n  <span class=\"p\">(</span><span class=\"k\">export</span> <span class=\"s2\">\"_start\"</span> <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"mi\">1</span><span class=\"p\">)))</span>\n</code></pre></div><br>\n</p>\n</blockquote>",
        "id": 397919731,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1697959633
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7246#issuecomment-1775345262\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7246\">issue #7246</a>:</p>\n<blockquote>\n<p>Fascinating! Not what I would have expected but helps explain the results for sure!</p>\n</blockquote>",
        "id": 398098991,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1698071667
    }
]