[
    {
        "content": "<p>elliottt opened <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464\">PR #5464</a> from <code>trevor/block-with-args</code> to <code>main</code>:</p>\n<blockquote>\n<p>Add a new type <code>BlockWithArgs</code> that represents the pair of a block name with arguments to be passed to it. Rework the implementation of <code>jump</code>, <code>brz</code>, and <code>brnz</code> to use <code>BlockWithArgs</code> instead of storing the block arguments as varargs in the instruction's <code>ValueList</code>.</p>\n<p>&lt;!--</p>\n<p>Please ensure that the following steps are all taken care of before submitting<br>\nthe PR.</p>\n<ul>\n<li>\n<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>\n  here.</p>\n</li>\n<li>\n<p>[ ] A short description of what this does, why it is needed; if the<br>\n  description becomes long, the matter should probably be discussed in an issue<br>\n  first.</p>\n</li>\n<li>\n<p>[ ] This PR contains test cases, if meaningful.</p>\n</li>\n<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>\n  If you don't know who could review this, please indicate so. The list of<br>\n  suggested reviewers on the right can help you.</li>\n</ul>\n<p>Please ensure all communication adheres to the <a href=\"https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md\">code of\nconduct</a>.<br>\n--&gt;<br>\n</p>\n</blockquote>",
        "id": 316390705,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671241761
    },
    {
        "content": "<p>elliottt edited <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464\">PR #5464</a> from <code>trevor/block-with-args</code> to <code>main</code>:</p>\n<blockquote>\n<p>Add a new type <code>BlockWithArgs</code> that represents the pair of a block name with arguments to be passed to it. Rework the implementation of <code>jump</code>, <code>brz</code>, and <code>brnz</code> to use <code>BlockWithArgs</code> instead of storing the block arguments as varargs in the instruction's <code>ValueList</code>.</p>\n<p>Some open questions:</p>\n<ul>\n<li>[ ] Does the return value of  <code>num_fixed_actuals</code> function still make sense for <code>brz</code> and <code>brnz</code> even though they no longer store their control argument in the instruction's argument list?</li>\n<li>[ ]The reworked builder api for <code>jump</code>, <code>brz</code>, and <code>brnz</code> is not very nice to work with. Can we generate two variations of each function, one that takes a <code>BlockWithArgs</code> and one that takes the pair of <code>Block</code> and <code>Value</code> slice?</li>\n<li>[ ] I'm not 100% confident that I've found everywhere that we're using instruction arguments and block arguments interchangeably. Is there a good way to track this down beyond fuzzing?</li>\n</ul>\n<p>&lt;!--</p>\n<p>Please ensure that the following steps are all taken care of before submitting<br>\nthe PR.</p>\n<ul>\n<li>\n<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>\n  here.</p>\n</li>\n<li>\n<p>[ ] A short description of what this does, why it is needed; if the<br>\n  description becomes long, the matter should probably be discussed in an issue<br>\n  first.</p>\n</li>\n<li>\n<p>[ ] This PR contains test cases, if meaningful.</p>\n</li>\n<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>\n  If you don't know who could review this, please indicate so. The list of<br>\n  suggested reviewers on the right can help you.</li>\n</ul>\n<p>Please ensure all communication adheres to the <a href=\"https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md\">code of\nconduct</a>.<br>\n--&gt;<br>\n</p>\n</blockquote>",
        "id": 316391005,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671242043
    },
    {
        "content": "<p>elliottt edited <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464\">PR #5464</a> from <code>trevor/block-with-args</code> to <code>main</code>:</p>\n<blockquote>\n<p>Add a new type <code>BlockWithArgs</code> that represents the pair of a block name with arguments to be passed to it. Rework the implementation of <code>jump</code>, <code>brz</code>, and <code>brnz</code> to use <code>BlockWithArgs</code> instead of storing the block arguments as varargs in the instruction's <code>ValueList</code>.</p>\n<p>Some open questions:</p>\n<ul>\n<li>[ ] Does the return value of  <code>num_fixed_actuals</code> function still make sense for <code>brz</code> and <code>brnz</code> even though they no longer store their control argument in the instruction's argument list?</li>\n<li>[ ] The reworked builder api for <code>jump</code>, <code>brz</code>, and <code>brnz</code> is not very nice to work with. Can we generate two variations of each function, one that takes a <code>BlockWithArgs</code> and one that takes the pair of <code>Block</code> and <code>Value</code> slice?</li>\n<li>[ ] I'm not 100% confident that I've found everywhere that we're using instruction arguments and block arguments interchangeably. Is there a good way to track this down beyond fuzzing?</li>\n</ul>\n<p>&lt;!--</p>\n<p>Please ensure that the following steps are all taken care of before submitting<br>\nthe PR.</p>\n<ul>\n<li>\n<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>\n  here.</p>\n</li>\n<li>\n<p>[ ] A short description of what this does, why it is needed; if the<br>\n  description becomes long, the matter should probably be discussed in an issue<br>\n  first.</p>\n</li>\n<li>\n<p>[ ] This PR contains test cases, if meaningful.</p>\n</li>\n<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>\n  If you don't know who could review this, please indicate so. The list of<br>\n  suggested reviewers on the right can help you.</li>\n</ul>\n<p>Please ensure all communication adheres to the <a href=\"https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md\">code of\nconduct</a>.<br>\n--&gt;<br>\n</p>\n</blockquote>",
        "id": 316391035,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671242051
    },
    {
        "content": "<p>elliottt updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464\">PR #5464</a> from <code>trevor/block-with-args</code> to <code>main</code>.</p>",
        "id": 316797184,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671471972
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464#pullrequestreview-1223295362\">PR review</a>.</p>",
        "id": 316803929,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671474258
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464#pullrequestreview-1223295362\">PR review</a>.</p>",
        "id": 316803930,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671474258
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464#discussion_r1052476712\">PR review comment</a>:</p>\n<blockquote>\n<p>Can we note that args are included here (in contrast to <code>label</code> below), and possibly also call it <code>block_with_args</code> throughout for clarity?</p>\n</blockquote>",
        "id": 316803931,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671474258
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464#discussion_r1052477043\">PR review comment</a>:</p>\n<blockquote>\n<p>Likewise here, note that args are included</p>\n</blockquote>",
        "id": 316803932,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671474258
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464#discussion_r1052484037\">PR review comment</a>:</p>\n<blockquote>\n<p>Is this correct for conditional branches? We need to skip the first arg from the elab stack, no?</p>\n</blockquote>",
        "id": 316803934,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671474258
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464#discussion_r1052485236\">PR review comment</a>:</p>\n<blockquote>\n<p>The code duplication here is pretty unfortunate. Could we wrap it in a closure (<code>handle_use</code> or somesuch)?</p>\n<p>(Making it a closure will probably require closure args for borrows so the closure itself doesn't hold the borrows for too long)</p>\n</blockquote>",
        "id": 316803935,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671474258
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464#discussion_r1052489449\">PR review comment</a>:</p>\n<blockquote>\n<p>Somewhat confusing to name this local <code>cell</code> if it's not actually a Cell or some other kind of interior mutability -- can we just call it <code>first_elem</code> or something?</p>\n</blockquote>",
        "id": 316803936,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671474258
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464#discussion_r1052488755\">PR review comment</a>:</p>\n<blockquote>\n<p>We can probably preallocate the list with the appropriate length upfront, since <code>args</code> is a slice and we know its length?</p>\n</blockquote>",
        "id": 316803937,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671474259
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464#pullrequestreview-1223295362\">PR review</a>.</p>",
        "id": 316804076,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671474315
    },
    {
        "content": "<p>jameysharp submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464#pullrequestreview-1223351104\">PR review</a>.</p>",
        "id": 316806041,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671474897
    },
    {
        "content": "<p>jameysharp created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464#discussion_r1052513877\">PR review comment</a>:</p>\n<blockquote>\n<p>Huh, apparently <code>EntityList</code> doesn't have a <code>with_capacity</code> constructor. Its <code>extend</code> method does make some use of <code>Iterator::size_hint</code> though, so this reallocs the list at most once, when it has only one element in it. We could use <code>Iterator::chain</code> to preallocate the right size but I'm not convinced it's worth bothering.</p>\n</blockquote>",
        "id": 316806042,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671474897
    },
    {
        "content": "<p>elliottt updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464\">PR #5464</a> from <code>trevor/block-with-args</code> to <code>main</code>.</p>",
        "id": 316809635,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1671476142
    },
    {
        "content": "<p>elliottt updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464\">PR #5464</a> from <code>trevor/block-with-args</code> to <code>main</code>.</p>",
        "id": 319658337,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1672947301
    },
    {
        "content": "<p>elliottt updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464\">PR #5464</a> from <code>trevor/block-with-args</code> to <code>main</code>.</p>",
        "id": 319705790,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1672969511
    },
    {
        "content": "<p>elliottt edited <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464\">PR #5464</a> from <code>trevor/block-with-args</code> to <code>main</code>:</p>\n<blockquote>\n<p>Add a new type <code>BlockWithArgs</code> that represents the pair of a block name with arguments to be passed to it. Rework the implementation of <code>jump</code>, <code>brz</code>, and <code>brnz</code> to use <code>BlockWithArgs</code> instead of storing the block arguments as varargs in the instruction's <code>ValueList</code>.</p>\n<p>Some open questions:</p>\n<ul>\n<li>[ ] Does the return value of  <code>num_fixed_actuals</code> function still make sense for <code>brz</code> and <code>brnz</code> even though they no longer store their control argument in the instruction's argument list?</li>\n<li>[x] The reworked builder api for <code>jump</code>, <code>brz</code>, and <code>brnz</code> is not very nice to work with. Can we generate two variations of each function, one that takes a <code>BlockWithArgs</code> and one that takes the pair of <code>Block</code> and <code>Value</code> slice?</li>\n<li>[ ] I'm not 100% confident that I've found everywhere that we're using instruction arguments and block arguments interchangeably. Is there a good way to track this down beyond fuzzing?</li>\n</ul>\n<p>&lt;!--</p>\n<p>Please ensure that the following steps are all taken care of before submitting<br>\nthe PR.</p>\n<ul>\n<li>\n<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>\n  here.</p>\n</li>\n<li>\n<p>[ ] A short description of what this does, why it is needed; if the<br>\n  description becomes long, the matter should probably be discussed in an issue<br>\n  first.</p>\n</li>\n<li>\n<p>[ ] This PR contains test cases, if meaningful.</p>\n</li>\n<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>\n  If you don't know who could review this, please indicate so. The list of<br>\n  suggested reviewers on the right can help you.</li>\n</ul>\n<p>Please ensure all communication adheres to the <a href=\"https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md\">code of\nconduct</a>.<br>\n--&gt;<br>\n</p>\n</blockquote>",
        "id": 319705882,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1672969570
    },
    {
        "content": "<p>elliottt updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464\">PR #5464</a> from <code>trevor/block-with-args</code> to <code>main</code>.</p>",
        "id": 319888206,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673052609
    },
    {
        "content": "<p>elliottt updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464\">PR #5464</a> from <code>trevor/block-with-args</code> to <code>main</code>.</p>",
        "id": 319888223,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673052625
    },
    {
        "content": "<p>elliottt submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464#pullrequestreview-1239571010\">PR review</a>.</p>",
        "id": 319888319,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673052704
    },
    {
        "content": "<p>elliottt created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464#discussion_r1063919237\">PR review comment</a>:</p>\n<blockquote>\n<p>Yep, this wasn't correct. Switching to using a map function for values made it much easier to get this right.</p>\n</blockquote>",
        "id": 319888321,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673052704
    },
    {
        "content": "<p>elliottt submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464#pullrequestreview-1239571269\">PR review</a>.</p>",
        "id": 319888445,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673052765
    },
    {
        "content": "<p>elliottt created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464#discussion_r1063919595\">PR review comment</a>:</p>\n<blockquote>\n<p>I've added some functions to abstract over the values of an instruction to avoid this sort of duplication, and am in the process of auditing uses of the existing arg accessors to determine if they need to be changed.</p>\n</blockquote>",
        "id": 319888446,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673052765
    },
    {
        "content": "<p>elliottt edited <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464\">PR #5464</a> from <code>trevor/block-with-args</code> to <code>main</code>:</p>\n<blockquote>\n<p>Add a new type <code>BlockWithArgs</code> that represents the pair of a block name with arguments to be passed to it. Rework the implementation of <code>jump</code>, <code>brz</code>, and <code>brnz</code> to use <code>BlockWithArgs</code> instead of storing the block arguments as varargs in the instruction's <code>ValueList</code>.</p>\n<p>Some open questions:</p>\n<ul>\n<li>[x] Does the return value of  <code>num_fixed_actuals</code> function still make sense for <code>brz</code> and <code>brnz</code> even though they no longer store their control argument in the instruction's argument list?</li>\n<li>[x] The reworked builder api for <code>jump</code>, <code>brz</code>, and <code>brnz</code> is not very nice to work with. Can we generate two variations of each function, one that takes a <code>BlockWithArgs</code> and one that takes the pair of <code>Block</code> and <code>Value</code> slice?</li>\n<li>[ ] I'm not 100% confident that I've found everywhere that we're using instruction arguments and block arguments interchangeably. Is there a good way to track this down beyond fuzzing?</li>\n</ul>\n<p>&lt;!--</p>\n<p>Please ensure that the following steps are all taken care of before submitting<br>\nthe PR.</p>\n<ul>\n<li>\n<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>\n  here.</p>\n</li>\n<li>\n<p>[ ] A short description of what this does, why it is needed; if the<br>\n  description becomes long, the matter should probably be discussed in an issue<br>\n  first.</p>\n</li>\n<li>\n<p>[ ] This PR contains test cases, if meaningful.</p>\n</li>\n<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>\n  If you don't know who could review this, please indicate so. The list of<br>\n  suggested reviewers on the right can help you.</li>\n</ul>\n<p>Please ensure all communication adheres to the <a href=\"https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md\">code of\nconduct</a>.<br>\n--&gt;<br>\n</p>\n</blockquote>",
        "id": 319889205,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673053247
    },
    {
        "content": "<p>elliottt updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464\">PR #5464</a> from <code>trevor/block-with-args</code> to <code>main</code>.</p>",
        "id": 319893306,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673056817
    },
    {
        "content": "<p>elliottt updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464\">PR #5464</a> from <code>trevor/block-with-args</code> to <code>main</code>.</p>",
        "id": 319893533,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673056986
    },
    {
        "content": "<p>elliottt updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464\">PR #5464</a> from <code>trevor/block-with-args</code> to <code>main</code>.</p>",
        "id": 320292089,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673287785
    },
    {
        "content": "<p>elliottt updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464\">PR #5464</a> from <code>trevor/block-with-args</code> to <code>main</code>.</p>",
        "id": 320339633,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673301793
    },
    {
        "content": "<p>elliottt updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464\">PR #5464</a> from <code>trevor/block-with-args</code> to <code>main</code>.</p>",
        "id": 320340915,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673302328
    },
    {
        "content": "<p>elliottt edited <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464\">PR #5464</a> from <code>trevor/block-with-args</code> to <code>main</code>:</p>\n<blockquote>\n<p>Add a new type <code>BlockWithArgs</code> that represents the pair of a block name with arguments to be passed to it. Rework the implementation of <code>jump</code>, <code>brz</code>, and <code>brnz</code> to use <code>BlockWithArgs</code> instead of storing the block arguments as varargs in the instruction's <code>ValueList</code>.</p>\n<p>Some open questions:</p>\n<ul>\n<li>[x] Does the return value of  <code>num_fixed_actuals</code> function still make sense for <code>brz</code> and <code>brnz</code> even though they no longer store their control argument in the instruction's argument list?</li>\n<li>[x] The reworked builder api for <code>jump</code>, <code>brz</code>, and <code>brnz</code> is not very nice to work with. Can we generate two variations of each function, one that takes a <code>BlockWithArgs</code> and one that takes the pair of <code>Block</code> and <code>Value</code> slice?</li>\n<li>[x] I'm not 100% confident that I've found everywhere that we're using instruction arguments and block arguments interchangeably. Is there a good way to track this down beyond fuzzing?</li>\n</ul>\n<p>&lt;!--</p>\n<p>Please ensure that the following steps are all taken care of before submitting<br>\nthe PR.</p>\n<ul>\n<li>\n<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>\n  here.</p>\n</li>\n<li>\n<p>[ ] A short description of what this does, why it is needed; if the<br>\n  description becomes long, the matter should probably be discussed in an issue<br>\n  first.</p>\n</li>\n<li>\n<p>[ ] This PR contains test cases, if meaningful.</p>\n</li>\n<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>\n  If you don't know who could review this, please indicate so. The list of<br>\n  suggested reviewers on the right can help you.</li>\n</ul>\n<p>Please ensure all communication adheres to the <a href=\"https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md\">code of\nconduct</a>.<br>\n--&gt;<br>\n</p>\n</blockquote>",
        "id": 320342630,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673303066
    },
    {
        "content": "<p>jameysharp submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464#pullrequestreview-1241318124\">PR review</a>.</p>",
        "id": 320354815,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673308979
    },
    {
        "content": "<p>jameysharp created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464#discussion_r1065193641\">PR review comment</a>:</p>\n<blockquote>\n<p>I was concerned about silently deleting the \"Can't use <code>.sum()</code> for <code>Cost</code> types\" comment and then effectively implementing our own version of <code>Iterator::sum</code>. But I see that <code>Cost</code> does implement <code>std::ops::Add</code> and this statement was already relying on <code>+</code> being overloaded. So I'm pretty sure this change is correct.</p>\n</blockquote>",
        "id": 320354816,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673308979
    },
    {
        "content": "<p>jameysharp submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464#pullrequestreview-1241318124\">PR review</a>.</p>",
        "id": 320354817,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673308979
    },
    {
        "content": "<p>elliottt updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464\">PR #5464</a> from <code>trevor/block-with-args</code> to <code>main</code>.</p>",
        "id": 320363557,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673314227
    },
    {
        "content": "<p>elliottt updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464\">PR #5464</a> from <code>trevor/block-with-args</code> to <code>main</code>.</p>",
        "id": 320495623,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673369294
    },
    {
        "content": "<p>elliottt updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464\">PR #5464</a> from <code>trevor/block-with-args</code> to <code>main</code>.</p>",
        "id": 320496140,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673369452
    },
    {
        "content": "<p>elliottt updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464\">PR #5464</a> from <code>trevor/block-with-args</code> to <code>main</code>.</p>",
        "id": 320497016,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673369689
    },
    {
        "content": "<p>elliottt updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464\">PR #5464</a> from <code>trevor/block-with-args</code> to <code>main</code>.</p>",
        "id": 320524789,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673377726
    },
    {
        "content": "<p>elliottt updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464\">PR #5464</a> from <code>trevor/block-with-args</code> to <code>main</code>.</p>",
        "id": 320528997,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673379058
    },
    {
        "content": "<p>elliottt edited <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464\">PR #5464</a> from <code>trevor/block-with-args</code> to <code>main</code>:</p>\n<blockquote>\n<p>Add a new type <code>BlockWithArgs</code> that represents the pair of a block name with arguments to be passed to it. Rework the implementation of <code>jump</code>, <code>brz</code>, and <code>brnz</code> to use <code>BlockWithArgs</code> instead of storing the block arguments as varargs in the instruction's <code>ValueList</code>.</p>\n<p>Some open questions:</p>\n<ul>\n<li>[x] Does the return value of  <code>num_fixed_actuals</code> function still make sense for <code>brz</code> and <code>brnz</code> even though they no longer store their control argument in the instruction's argument list?</li>\n<li>[x] The reworked builder api for <code>jump</code>, <code>brz</code>, and <code>brnz</code> is not very nice to work with. Can we generate two variations of each function, one that takes a <code>BlockWithArgs</code> and one that takes the pair of <code>Block</code> and <code>Value</code> slice?</li>\n<li>[x] I'm not 100% confident that I've found everywhere that we're using instruction arguments and block arguments interchangeably. Is there a good way to track this down beyond fuzzing?</li>\n</ul>\n<p>&lt;!--</p>\n<p>Please ensure that the following steps are all taken care of before submitting<br>\nthe PR.</p>\n<ul>\n<li>\n<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>\n  here.</p>\n</li>\n<li>\n<p>[ ] A short description of what this does, why it is needed; if the<br>\n  description becomes long, the matter should probably be discussed in an issue<br>\n  first.</p>\n</li>\n<li>\n<p>[ ] This PR contains test cases, if meaningful.</p>\n</li>\n<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>\n  If you don't know who could review this, please indicate so. The list of<br>\n  suggested reviewers on the right can help you.</li>\n</ul>\n<p>Please ensure all communication adheres to the <a href=\"https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md\">code of\nconduct</a>.<br>\n--&gt;<br>\n</p>\n</blockquote>",
        "id": 320529162,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673379113
    },
    {
        "content": "<p>elliottt edited <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464\">PR #5464</a> from <code>trevor/block-with-args</code> to <code>main</code>:</p>\n<blockquote>\n<p>Add a new type <code>BlockCall</code> that represents the pair of a block name with arguments to be passed to it. (The mnemonic here is that it looks a bit like a function call.) Rework the implementation of <code>jump</code>, <code>brz</code>, and <code>brnz</code> to use <code>BlockCall</code> instead of storing the block arguments as varargs in the instruction's <code>ValueList</code>.</p>\n<p>To ensure that we're processing value references from <code>BlockCall</code> values held in instructions, introduce three new functions on <code>DataFlowGraph</code>: <code>inst_values</code>, <code>inst_values_mut</code>, and <code>inst_values_mut_with</code>. The first function returns an iterator that traverses both the instruction and block arguments, while the latter two return a custom type that has a single <code>map</code> function for mutating the values referenced. The <code>inst_values_mut_with</code> variant exists for cases where the <code>DataFlowGraph</code> being mutated is held within another structure that needs to be mutated simultaneously.</p>\n<p>&lt;!--</p>\n<p>Please ensure that the following steps are all taken care of before submitting<br>\nthe PR.</p>\n<ul>\n<li>\n<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>\n  here.</p>\n</li>\n<li>\n<p>[ ] A short description of what this does, why it is needed; if the<br>\n  description becomes long, the matter should probably be discussed in an issue<br>\n  first.</p>\n</li>\n<li>\n<p>[ ] This PR contains test cases, if meaningful.</p>\n</li>\n<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>\n  If you don't know who could review this, please indicate so. The list of<br>\n  suggested reviewers on the right can help you.</li>\n</ul>\n<p>Please ensure all communication adheres to the <a href=\"https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md\">code of\nconduct</a>.<br>\n--&gt;<br>\n</p>\n</blockquote>",
        "id": 320529857,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673379355
    },
    {
        "content": "<p><strong>elliottt</strong> has marked <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464\">PR #5464</a> as ready for review.</p>",
        "id": 320529938,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673379371
    },
    {
        "content": "<p>elliottt edited <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464\">PR #5464</a> from <code>trevor/block-with-args</code> to <code>main</code>:</p>\n<blockquote>\n<p>Add a new type <code>BlockCall</code> that represents the pair of a block name with arguments to be passed to it. (The mnemonic here is that it looks a bit like a function call.) Rework the implementation of <code>jump</code>, <code>brz</code>, and <code>brnz</code> to use <code>BlockCall</code> instead of storing the block arguments as varargs in the instruction's <code>ValueList</code>.</p>\n<p>To ensure that we're processing value references from <code>BlockCall</code> values held in instructions, introduce three new functions on <code>DataFlowGraph</code>: <code>inst_values</code>, <code>inst_values_mut</code>, and <code>inst_values_mut_with</code>. The first function returns an iterator that traverses both the instruction and block arguments, while the latter two return a custom type that has a single <code>map</code> function for mutating the values referenced. The <code>inst_values_mut_with</code> variant exists for cases where the <code>DataFlowGraph</code> being mutated is held within another structure that needs to be mutated simultaneously.</p>\n<p>I went through the existing uses of <code>inst_args</code>, <code>inst_fixed_args</code>, <code>inst_variable_args</code>, and their mut variants to decide whether or not they should be using the new iterator interface introduced above. Many needed to be migrated over, but there were cases where the original instruction was correct: the fuzzgen passes for fcvt and int_divz are examples of where the block args were never being indexed.</p>\n<p>&lt;!--</p>\n<p>Please ensure that the following steps are all taken care of before submitting<br>\nthe PR.</p>\n<ul>\n<li>\n<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>\n  here.</p>\n</li>\n<li>\n<p>[ ] A short description of what this does, why it is needed; if the<br>\n  description becomes long, the matter should probably be discussed in an issue<br>\n  first.</p>\n</li>\n<li>\n<p>[ ] This PR contains test cases, if meaningful.</p>\n</li>\n<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>\n  If you don't know who could review this, please indicate so. The list of<br>\n  suggested reviewers on the right can help you.</li>\n</ul>\n<p>Please ensure all communication adheres to the <a href=\"https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md\">code of\nconduct</a>.<br>\n--&gt;<br>\n</p>\n</blockquote>",
        "id": 320530446,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673379543
    },
    {
        "content": "<p><strong>elliottt</strong> requested <a href=\"https://github.com/jameysharp\">jameysharp</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464\">PR #5464</a>.</p>",
        "id": 320530455,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673379546
    },
    {
        "content": "<p>elliottt updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464\">PR #5464</a> from <code>trevor/block-with-args</code> to <code>main</code>.</p>",
        "id": 320561678,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673391670
    },
    {
        "content": "<p>elliottt edited <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464\">PR #5464</a> from <code>trevor/block-with-args</code> to <code>main</code>:</p>\n<blockquote>\n<p>Add a new type <code>BlockCall</code> that represents the pair of a block name with arguments to be passed to it. (The mnemonic here is that it looks a bit like a function call.) Rework the implementation of <code>jump</code>, <code>brz</code>, and <code>brnz</code> to use <code>BlockCall</code> instead of storing the block arguments as varargs in the instruction's <code>ValueList</code>.</p>\n<p>To ensure that we're processing block arguments from <code>BlockCall</code> values in instructions, three new functions have been introduced on <code>DataFlowGraph</code> that both sets of arguments: </p>\n<ul>\n<li><code>inst_values</code> - returns an iterator that traverses values in the instruction and block arguments</li>\n<li><code>map_inst_values</code> - applies a function to each value in the instruction and block arguments</li>\n<li><code>overwrite_inst_values</code> - overwrite all values in an instruction and block arguments with values from the iterator</li>\n</ul>\n<p>I went through the existing uses of <code>inst_args</code>, <code>inst_fixed_args</code>, <code>inst_variable_args</code>, and their mut variants to decide whether or not they should be using the new iterator interface introduced above. Many needed to be migrated over, but there were cases where the original instruction was correct: the fuzzgen passes for fcvt and int_divz are examples of where the block args were never being indexed.</p>\n<p>&lt;!--</p>\n<p>Please ensure that the following steps are all taken care of before submitting<br>\nthe PR.</p>\n<ul>\n<li>\n<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>\n  here.</p>\n</li>\n<li>\n<p>[ ] A short description of what this does, why it is needed; if the<br>\n  description becomes long, the matter should probably be discussed in an issue<br>\n  first.</p>\n</li>\n<li>\n<p>[ ] This PR contains test cases, if meaningful.</p>\n</li>\n<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>\n  If you don't know who could review this, please indicate so. The list of<br>\n  suggested reviewers on the right can help you.</li>\n</ul>\n<p>Please ensure all communication adheres to the <a href=\"https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md\">code of\nconduct</a>.<br>\n--&gt;<br>\n</p>\n</blockquote>",
        "id": 320564812,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673393352
    },
    {
        "content": "<p>jameysharp submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464#pullrequestreview-1243126646\">PR review</a>.</p>",
        "id": 320581238,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673404073
    },
    {
        "content": "<p>jameysharp submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464#pullrequestreview-1243126646\">PR review</a>.</p>",
        "id": 320581239,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673404073
    },
    {
        "content": "<p>jameysharp created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464#discussion_r1066459265\">PR review comment</a>:</p>\n<blockquote>\n<p>I believe every part of this iterator supports access from both ends. If true, that means you can change the declaration this way, I think, and then callers can use <code>Iterator::rev</code> if they want.</p>\n<p><div class=\"codehilite\" data-code-language=\"suggestion\"><pre><span></span><code>    pub fn inst_values&lt;'dfg&gt;(&amp;'dfg self, inst: Inst) -&gt; impl DoubleEndedIterator&lt;Item = Value&gt; + 'dfg {\n</code></pre></div><br>\n</p>\n</blockquote>",
        "id": 320581241,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673404073
    },
    {
        "content": "<p>jameysharp created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464#discussion_r1066454633\">PR review comment</a>:</p>\n<blockquote>\n<p>Continuing the theme, how about renaming <code>block</code> here to <code>block_call</code> and extending the documentation to \"Destination basic block, with its arguments provided\"?</p>\n</blockquote>",
        "id": 320581242,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673404073
    },
    {
        "content": "<p>jameysharp created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464#discussion_r1066455831\">PR review comment</a>:</p>\n<blockquote>\n<p>I guess this blank line doesn't really need to be added here.</p>\n</blockquote>",
        "id": 320581243,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673404073
    },
    {
        "content": "<p>jameysharp created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464#discussion_r1066460809\">PR review comment</a>:</p>\n<blockquote>\n<p>Since it turned out that <code>inst_values</code> can return an iterator, you can replace all the uses of <code>for_each</code> with <code>for</code> loops. In cases like this one that's good both because it minimizes the diff here and because <code>for_each</code> is generally discouraged, as a Rust idiom. Switching back to <code>for</code> loops is a bigger win for the uses of <code>try_for_each</code>, which can just use <code>break</code> statements or the <code>?</code> operator instead of <code>ControlFlow</code>.</p>\n</blockquote>",
        "id": 320581244,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673404073
    },
    {
        "content": "<p>jameysharp created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464#discussion_r1066465376\">PR review comment</a>:</p>\n<blockquote>\n<p>The comment isn't quite true: This vector can't be moved onto <code>self</code>, since the reason for introducing it is to avoid holding borrows of <code>self</code> across calls to <code>self.elaborate_eclass_use</code>.</p>\n<p>But this function, <code>elaborate_block</code>, is only called from <code>elaborate_domtree</code>, so the vector could be allocated there and passed in by reference. That function in turn is called only once for the pass, so allocating the temporary storage there is as good as storing it on <code>self</code> would be.</p>\n</blockquote>",
        "id": 320581245,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673404073
    },
    {
        "content": "<p>jameysharp created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464#discussion_r1066463286\">PR review comment</a>:</p>\n<blockquote>\n<p>I think most of the changes around here can be undone, assuming that <code>self.func.dfg.inst_values(inst)</code> can return a <code>DoubleEndedIterator</code>.</p>\n</blockquote>",
        "id": 320581246,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673404073
    },
    {
        "content": "<p>jameysharp created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464#discussion_r1066455445\">PR review comment</a>:</p>\n<blockquote>\n<p>I've never had reason to use this Rust format-string syntax before, but this seems like a good place for it:</p>\n<p><div class=\"codehilite\" data-code-language=\"suggestion\"><pre><span></span><code>                \"let {0} = self.data_flow_graph_mut().block_with_args({0}_label, {0}_args);\",\n                op.name\n</code></pre></div><br>\n</p>\n</blockquote>",
        "id": 320581247,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673404073
    },
    {
        "content": "<p>jameysharp created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464#discussion_r1066467072\">PR review comment</a>:</p>\n<blockquote>\n<p>I'm amused that leaving the semicolon off here is legal, but let's not...</p>\n<p><div class=\"codehilite\" data-code-language=\"suggestion\"><pre><span></span><code>                *arg = new_arg.value;\n</code></pre></div><br>\n</p>\n</blockquote>",
        "id": 320581248,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673404074
    },
    {
        "content": "<p>jameysharp created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464#discussion_r1066466169\">PR review comment</a>:</p>\n<blockquote>\n<p>A minor cleanup here is to call <code>Vec::drain</code> instead of <code>iter</code>, <code>copied</code>, and <code>clear</code>.</p>\n<p><div class=\"codehilite\" data-code-language=\"suggestion\"><pre><span></span><code>            self.func\n                .dfg\n                .overwrite_inst_values(inst, elab_values.drain(..));\n</code></pre></div><br>\n</p>\n</blockquote>",
        "id": 320581249,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673404074
    },
    {
        "content": "<p>jameysharp created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464#discussion_r1066472886\">PR review comment</a>:</p>\n<blockquote>\n<p>Minor style note: a <code>for</code> loop always calls <code>into_iter</code>, so you don't need to do it here.</p>\n<p><div class=\"codehilite\" data-code-language=\"suggestion\"><pre><span></span><code>        for mut block in self.insts[inst].branch_destination() {\n</code></pre></div><br>\n</p>\n</blockquote>",
        "id": 320581250,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673404074
    },
    {
        "content": "<p>jameysharp created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464#discussion_r1066488732\">PR review comment</a>:</p>\n<blockquote>\n<p>Like the <code>for_each</code> calls, now that <code>inst_values</code> is an iterator this can turn back into a <code>for</code> loop with an early return.</p>\n</blockquote>",
        "id": 320581251,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673404074
    },
    {
        "content": "<p>jameysharp created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464#discussion_r1066470221\">PR review comment</a>:</p>\n<blockquote>\n<p>I don't see that this <code>count_values</code> method is used anywhere. Am I missing something?</p>\n</blockquote>",
        "id": 320581252,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673404074
    },
    {
        "content": "<p>jameysharp created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464#discussion_r1066468163\">PR review comment</a>:</p>\n<blockquote>\n<p>Since <code>map_inst_values</code> writes back unconditionally, let's not bother checking for unchanged values here either. (I expect rustfmt will want the outer curly braces removed too, but GitHub won't let me do suggestions on the full range of lines here.)</p>\n<p><div class=\"codehilite\" data-code-language=\"suggestion\"><pre><span></span><code>            resolve_aliases(&amp;dfg.values, arg)\n</code></pre></div><br>\n</p>\n</blockquote>",
        "id": 320581253,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673404074
    },
    {
        "content": "<p>jameysharp created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464#discussion_r1066482909\">PR review comment</a>:</p>\n<blockquote>\n<p><code>into_iter</code> isn't necessary here either:</p>\n<p><div class=\"codehilite\" data-code-language=\"suggestion\"><pre><span></span><code>        for mut block in self.insts[inst].branch_destination() {\n</code></pre></div><br>\n</p>\n</blockquote>",
        "id": 320581254,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673404074
    },
    {
        "content": "<p>jameysharp created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464#discussion_r1066498273\">PR review comment</a>:</p>\n<blockquote>\n<p>Good call updating this comment. Maybe \"a count only of the <code>Value</code> arguments\" or something along those lines? It doesn't include various kinds of immediate arguments either.</p>\n</blockquote>",
        "id": 320581255,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673404074
    },
    {
        "content": "<p>jameysharp created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464#discussion_r1066504697\">PR review comment</a>:</p>\n<blockquote>\n<p>This closure is called with <code>block</code> set to <code>branch()</code>, which is then shadowed here with the same value. I think this closure shouldn't take any arguments.</p>\n<p>With that change, I think this will be the only call to <code>branch()</code>, so I'd inline it into <code>continue_at</code>.</p>\n</blockquote>",
        "id": 320581256,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673404074
    },
    {
        "content": "<p>jameysharp created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464#discussion_r1066508411\">PR review comment</a>:</p>\n<blockquote>\n<p>Do you suppose this function should be renamed to <code>block_call</code> now, or perhaps <code>make_block_call</code> or something? I think calling it <code>block_with_args</code> isn't terrible but it's worth taking a moment to think about it.</p>\n<p>Also, there are various comments that still refer to <code>BlockWithArgs</code>, like this one and a bunch of places in <code>instructions.rs</code>.</p>\n</blockquote>",
        "id": 320581257,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673404074
    },
    {
        "content": "<p>jameysharp created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464#discussion_r1066497679\">PR review comment</a>:</p>\n<blockquote>\n<p>I wonder if this alternative is any better (after applying rustfmt, anyway). What do you think?</p>\n<p><div class=\"codehilite\" data-code-language=\"suggestion\"><pre><span></span><code>            let branch_args = self.f.dfg.insts[inst].branch_destination().into_iter().flat_map(|block| block.args_slice(&amp;self.f.dfg.value_lists));\n</code></pre></div><br>\n</p>\n</blockquote>",
        "id": 320581258,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673404074
    },
    {
        "content": "<p>jameysharp created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464#discussion_r1066508783\">PR review comment</a>:</p>\n<blockquote>\n<p>Another place where <code>into_iter</code> isn't necessary:</p>\n<p><div class=\"codehilite\" data-code-language=\"suggestion\"><pre><span></span><code>            for branch in dfg.insts[pred.inst].branch_destination_mut() {\n</code></pre></div><br>\n</p>\n</blockquote>",
        "id": 320581259,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673404074
    },
    {
        "content": "<p>elliottt submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464#pullrequestreview-1243281497\">PR review</a>.</p>",
        "id": 320596966,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673412425
    },
    {
        "content": "<p>elliottt created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464#discussion_r1066569088\">PR review comment</a>:</p>\n<blockquote>\n<p>I'm surprised this wasn't caught by rustfmt!</p>\n</blockquote>",
        "id": 320596967,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673412426
    },
    {
        "content": "<p>elliottt deleted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464#discussion_r1066569088\">PR review comment</a>.</p>",
        "id": 320596997,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673412444
    },
    {
        "content": "<p>elliottt submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464#pullrequestreview-1243282221\">PR review</a>.</p>",
        "id": 320597168,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673412508
    },
    {
        "content": "<p>elliottt created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464#discussion_r1066569562\">PR review comment</a>:</p>\n<blockquote>\n<p>It was left-over from an earlier refactoring, thanks for catching it!</p>\n</blockquote>",
        "id": 320597170,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673412508
    },
    {
        "content": "<p>elliottt submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464#pullrequestreview-1243283125\">PR review</a>.</p>",
        "id": 320597492,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673412611
    },
    {
        "content": "<p>elliottt created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464#discussion_r1066570182\">PR review comment</a>:</p>\n<blockquote>\n<p>Ah, this was to avoid a warning. Do you mind if we leave these for now and remove them once <code>branch_destination</code> returns a slice?</p>\n</blockquote>",
        "id": 320597493,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673412612
    },
    {
        "content": "<p>elliottt updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464\">PR #5464</a> from <code>trevor/block-with-args</code> to <code>main</code>.</p>",
        "id": 320598351,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673412960
    },
    {
        "content": "<p>jameysharp created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464#discussion_r1067182538\">PR review comment</a>:</p>\n<blockquote>\n<p>Oh, that makes sense! Sure, leave the <code>.into_iter()</code> calls in, that's fine.</p>\n</blockquote>",
        "id": 320739437,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673453384
    },
    {
        "content": "<p>jameysharp submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464#pullrequestreview-1244198765\">PR review</a>.</p>",
        "id": 320739440,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673453384
    },
    {
        "content": "<p>jameysharp submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464#pullrequestreview-1244219720\">PR review</a>.</p>",
        "id": 320742319,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673454112
    },
    {
        "content": "<p>jameysharp created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464#discussion_r1067196616\">PR review comment</a>:</p>\n<blockquote>\n<p>I guess the current CI failure is that this <code>use</code> item is no longer necessary.</p>\n</blockquote>",
        "id": 320742321,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673454113
    },
    {
        "content": "<p>elliottt submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464#pullrequestreview-1244295055\">PR review</a>.</p>",
        "id": 320752455,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673456768
    },
    {
        "content": "<p>elliottt created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464#discussion_r1067247240\">PR review comment</a>:</p>\n<blockquote>\n<p>I've removed the comment and implemented that change, thanks!</p>\n</blockquote>",
        "id": 320752456,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673456768
    },
    {
        "content": "<p>elliottt submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464#pullrequestreview-1244350310\">PR review</a>.</p>",
        "id": 320759943,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673459004
    },
    {
        "content": "<p>elliottt created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464#discussion_r1067284384\">PR review comment</a>:</p>\n<blockquote>\n<p>I like it!</p>\n</blockquote>",
        "id": 320759944,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673459005
    },
    {
        "content": "<p>elliottt updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464\">PR #5464</a> from <code>trevor/block-with-args</code> to <code>main</code>.</p>",
        "id": 320783161,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673466120
    },
    {
        "content": "<p>elliottt updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464\">PR #5464</a> from <code>trevor/block-with-args</code> to <code>main</code>.</p>",
        "id": 320784748,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673466650
    },
    {
        "content": "<p>elliottt updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464\">PR #5464</a> from <code>trevor/block-with-args</code> to <code>main</code>.</p>",
        "id": 320784911,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673466707
    },
    {
        "content": "<p>elliottt edited <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464\">PR #5464</a> from <code>trevor/block-with-args</code> to <code>main</code>:</p>\n<blockquote>\n<p>Add a new type <code>BlockCall</code> that represents the pair of a block name with arguments to be passed to it. (The mnemonic here is that it looks a bit like a function call.) Rework the implementation of <code>jump</code>, <code>brz</code>, and <code>brnz</code> to use <code>BlockCall</code> instead of storing the block arguments as varargs in the instruction's <code>ValueList</code>.</p>\n<p>To ensure that we're processing block arguments from <code>BlockCall</code> values in instructions, three new functions have been introduced on <code>DataFlowGraph</code> that both sets of arguments: </p>\n<ul>\n<li><code>inst_values</code> - returns an iterator that traverses values in the instruction and block arguments</li>\n<li><code>map_inst_values</code> - applies a function to each value in the instruction and block arguments</li>\n<li><code>overwrite_inst_values</code> - overwrite all values in an instruction and block arguments with values from the iterator</li>\n</ul>\n<p>I went through the existing uses of <code>inst_args</code>, <code>inst_fixed_args</code>, <code>inst_variable_args</code>, and their mut variants to decide whether or not they should be using the new iterator interface introduced above. Many needed to be migrated over, but there were cases where the original instruction was correct: the fuzzgen passes for fcvt and int_divz are examples of where the block args were never being indexed.</p>\n<p>Fixes #5451 <br>\n&lt;!--</p>\n<p>Please ensure that the following steps are all taken care of before submitting<br>\nthe PR.</p>\n<ul>\n<li>\n<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>\n  here.</p>\n</li>\n<li>\n<p>[ ] A short description of what this does, why it is needed; if the<br>\n  description becomes long, the matter should probably be discussed in an issue<br>\n  first.</p>\n</li>\n<li>\n<p>[ ] This PR contains test cases, if meaningful.</p>\n</li>\n<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>\n  If you don't know who could review this, please indicate so. The list of<br>\n  suggested reviewers on the right can help you.</li>\n</ul>\n<p>Please ensure all communication adheres to the <a href=\"https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md\">code of\nconduct</a>.<br>\n--&gt;<br>\n</p>\n</blockquote>",
        "id": 320805779,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673474475
    },
    {
        "content": "<p>elliottt updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464\">PR #5464</a> from <code>trevor/block-with-args</code> to <code>main</code>.</p>",
        "id": 320814513,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673478386
    },
    {
        "content": "<p>elliottt updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464\">PR #5464</a> from <code>trevor/block-with-args</code> to <code>main</code>.</p>",
        "id": 320817120,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673479969
    },
    {
        "content": "<p>elliottt edited <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464\">PR #5464</a> from <code>trevor/block-with-args</code> to <code>main</code>:</p>\n<blockquote>\n<p>Add a new type <code>BlockCall</code> that represents the pair of a block name with arguments to be passed to it. (The mnemonic here is that it looks a bit like a function call.) Rework the implementation of <code>jump</code>, <code>brz</code>, and <code>brnz</code> to use <code>BlockCall</code> instead of storing the block arguments as varargs in the instruction's <code>ValueList</code>.</p>\n<p>To ensure that we're processing block arguments from <code>BlockCall</code> values in instructions, three new functions have been introduced on <code>DataFlowGraph</code> that both sets of arguments: </p>\n<ul>\n<li><code>inst_values</code> - returns an iterator that traverses values in the instruction and block arguments</li>\n<li><code>map_inst_values</code> - applies a function to each value in the instruction and block arguments</li>\n<li><code>overwrite_inst_values</code> - overwrite all values in an instruction and block arguments with values from the iterator</li>\n</ul>\n<p>I went through the existing uses of <code>inst_args</code>, <code>inst_fixed_args</code>, <code>inst_variable_args</code>, and their mut variants to decide whether or not they should be using the new iterator interface introduced above. Many needed to be migrated over, but there were cases where the original instruction was correct: the fuzzgen passes for fcvt and int_divz are examples of where the block args were never being indexed.<br>\n&lt;!--</p>\n<p>Please ensure that the following steps are all taken care of before submitting<br>\nthe PR.</p>\n<ul>\n<li>\n<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>\n  here.</p>\n</li>\n<li>\n<p>[ ] A short description of what this does, why it is needed; if the<br>\n  description becomes long, the matter should probably be discussed in an issue<br>\n  first.</p>\n</li>\n<li>\n<p>[ ] This PR contains test cases, if meaningful.</p>\n</li>\n<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>\n  If you don't know who could review this, please indicate so. The list of<br>\n  suggested reviewers on the right can help you.</li>\n</ul>\n<p>Please ensure all communication adheres to the <a href=\"https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md\">code of\nconduct</a>.<br>\n--&gt;<br>\n</p>\n</blockquote>",
        "id": 320825299,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673484546
    },
    {
        "content": "<p>elliottt updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464\">PR #5464</a> from <code>trevor/block-with-args</code> to <code>main</code>.</p>",
        "id": 320826933,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673485715
    },
    {
        "content": "<p>elliottt updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464\">PR #5464</a> from <code>trevor/block-with-args</code> to <code>main</code>.</p>",
        "id": 320979629,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673540827
    },
    {
        "content": "<p>jameysharp submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464#pullrequestreview-1248483159\">PR review</a>.</p>",
        "id": 321280047,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673653834
    },
    {
        "content": "<p>jameysharp submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464#pullrequestreview-1248483159\">PR review</a>.</p>",
        "id": 321280048,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673653834
    },
    {
        "content": "<p>jameysharp created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464#discussion_r1070018741\">PR review comment</a>:</p>\n<blockquote>\n<p>Should this just use <code>inst_values</code>, now that that's an iterator? I'm not sure I quite understand how the stack is being used here, but I don't _think_ it requires these to be in separate iterators, so I think this simplification should be okay.</p>\n<p><div class=\"codehilite\" data-code-language=\"suggestion\"><pre><span></span><code>                stack.push(f.dfg.inst_values(src_inst));\n</code></pre></div><br>\n</p>\n</blockquote>",
        "id": 321280049,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673653834
    },
    {
        "content": "<p>jameysharp created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464#discussion_r1070149572\">PR review comment</a>:</p>\n<blockquote>\n<p>Would you mind passing the <code>block</code> from the caller? It's already done the necessary pattern match and can avoid the <code>.unwrap()</code>.</p>\n</blockquote>",
        "id": 321280050,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673653835
    },
    {
        "content": "<p>jameysharp created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464#discussion_r1070152718\">PR review comment</a>:</p>\n<blockquote>\n<p>Most (maybe all?) of this complexity should go away when the <code>br_if</code> migration is done, so I don't care whether you make this change before merging, but:</p>\n<p>I just noticed we can delete the <code>BranchOrderKind</code> enum and deduplicate the <code>replace</code> calls below by just directly returning which opcode the <code>Branch</code> should use after this rewrite:</p>\n<div class=\"codehilite\" data-code-language=\"suggestion\"><pre><span></span><code>                        Opcode::Brz =&gt; Opcode::Brnz,\n                        Opcode::Brnz =&gt; Opcode::Brz,\n</code></pre></div>\n<p>We could also get rid of some noise by moving the <code>replace</code> calls inside the inner match, instead of returning a tuple below and having to let-bind it above.</p>\n</blockquote>",
        "id": 321280051,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673653835
    },
    {
        "content": "<p>elliottt created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464#discussion_r1072443710\">PR review comment</a>:</p>\n<blockquote>\n<p>Yep, it definitely should, thanks for catching that one!</p>\n</blockquote>",
        "id": 321873821,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673973556
    },
    {
        "content": "<p>elliottt submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464#pullrequestreview-1251966353\">PR review</a>.</p>",
        "id": 321873822,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673973556
    },
    {
        "content": "<p>elliottt created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464#discussion_r1072478572\">PR review comment</a>:</p>\n<blockquote>\n<p>I remember what happened when I tried this with a previous version of this branch: we need to change the element type of <code>stack</code> to <code>Box&lt;dyn Iterator&lt;Item=Value&gt;&gt;</code> for that change to work because <code>inst_values</code> returns an <code>impl Iterator&lt;Item=Value&gt;</code>. Will the heap indirection be worth the change here?</p>\n</blockquote>",
        "id": 321878992,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673974875
    },
    {
        "content": "<p>elliottt submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464#pullrequestreview-1252043266\">PR review</a>.</p>",
        "id": 321878994,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673974875
    },
    {
        "content": "<p>elliottt updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464\">PR #5464</a> from <code>trevor/block-with-args</code> to <code>main</code>.</p>",
        "id": 321881433,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673975479
    },
    {
        "content": "<p>elliottt submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464#pullrequestreview-1252456273\">PR review</a>.</p>",
        "id": 321926302,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673989652
    },
    {
        "content": "<p>elliottt created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464#discussion_r1072819463\">PR review comment</a>:</p>\n<blockquote>\n<p>We went back and forth on alternate approaches here in a DM, and @jameysharp found a great one that he's going to push in a separate PR.</p>\n</blockquote>",
        "id": 321926303,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673989652
    },
    {
        "content": "<p>elliottt submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464#pullrequestreview-1252522339\">PR review</a>.</p>",
        "id": 321934120,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673992918
    },
    {
        "content": "<p>elliottt created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464#discussion_r1072874312\">PR review comment</a>:</p>\n<blockquote>\n<p>This refactoring was made in #5586.</p>\n</blockquote>",
        "id": 321934124,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673992918
    },
    {
        "content": "<p>elliottt updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464\">PR #5464</a> from <code>trevor/block-with-args</code> to <code>main</code>.</p>",
        "id": 321940147,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673995483
    },
    {
        "content": "<p>elliottt updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464\">PR #5464</a> from <code>trevor/block-with-args</code> to <code>main</code>.</p>",
        "id": 321941047,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673995883
    },
    {
        "content": "<p>elliottt updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464\">PR #5464</a> from <code>trevor/block-with-args</code> to <code>main</code>.</p>",
        "id": 321941217,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1673995952
    },
    {
        "content": "<p>elliottt merged <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5464\">PR #5464</a>.</p>",
        "id": 321953517,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1674001877
    }
]