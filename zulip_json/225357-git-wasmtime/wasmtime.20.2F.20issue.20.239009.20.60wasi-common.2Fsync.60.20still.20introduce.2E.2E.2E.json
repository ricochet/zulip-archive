[
    {
        "content": "<p>Robbepop opened <a href=\"https://github.com/bytecodealliance/wasmtime/issues/9009\">issue #9009</a>:</p>\n<blockquote>\n<p>Recently we merged <a href=\"https://github.com/bytecodealliance/wasmtime/pull/8900\">https://github.com/bytecodealliance/wasmtime/pull/8900</a> to remove the <code>wasmtime</code> optional dependency from <code>wasi-common/sync</code> since it was unused mostly.</p>\n<p>This had the effect that users could use <code>wasi-common</code> with its <code>sync</code> feature without pulling in the giantic Wasmtime dependency ... or so I thought.<br>\nToday I wanted to use <code>wasi-common</code> v23.0.1 (including this improvement) into Wasmi's <code>wasmi_wasi</code> crate and to my surprise Cargo pulled Wasmtime via the <code>wasi-common</code> dependency.<br>\nWhen I removed the <code>sync</code> feature usage (which is kinda critical unfortunately) the Wasmtime dependency was gone.</p>\n<p>I am seriously confused as to why this happens. Looking at <code>wasi-common</code>'s <code>Cargo.toml</code> file does not help my confusion.<br>\n<a href=\"https://github.com/bytecodealliance/wasmtime/blob/main/crates/wasi-common/Cargo.toml\">https://github.com/bytecodealliance/wasmtime/blob/main/crates/wasi-common/Cargo.toml</a></p>\n<p>Any help or clarification?</p>\n</blockquote>",
        "id": 453930948,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1721909770
    },
    {
        "content": "<p>Robbepop edited <a href=\"https://github.com/bytecodealliance/wasmtime/issues/9009\">issue #9009</a>:</p>\n<blockquote>\n<p>Recently we merged <a href=\"https://github.com/bytecodealliance/wasmtime/pull/8900\">https://github.com/bytecodealliance/wasmtime/pull/8900</a> to remove the <code>wasmtime</code> optional dependency from <code>wasi-common/sync</code> since it was unused mostly.</p>\n<p>This had the effect that users could use <code>wasi-common</code> with its <code>sync</code> feature without pulling in the giantic Wasmtime dependency ... or so I thought.<br>\nToday I wanted to use <code>wasi-common</code> v23.0.1 (including this improvement) into Wasmi's <code>wasmi_wasi</code> crate and to my surprise Cargo pulled Wasmtime via the <code>wasi-common</code> dependency.<br>\nWhen I removed the <code>sync</code> feature usage (which is kinda critical unfortunately) the Wasmtime dependency was gone.</p>\n<p>I am seriously confused as to why this happens. Looking at <code>wasi-common</code>'s <code>Cargo.toml</code> file does not help my confusion.<br>\n<a href=\"https://github.com/bytecodealliance/wasmtime/blob/main/crates/wasi-common/Cargo.toml\">https://github.com/bytecodealliance/wasmtime/blob/main/crates/wasi-common/Cargo.toml</a></p>\n<p>Any help or clarification?</p>\n<p>tl;dr:</p>\n<p>This pulls Wasmtime:</p>\n<div class=\"codehilite\" data-code-language=\"TOML\"><pre><span></span><code><span class=\"k\">[dependencies]</span>\n<span class=\"n\">wasi-common</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"p\">=</span><span class=\"w\"> </span><span class=\"s2\">\"23.0.1\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">default-features</span><span class=\"w\"> </span><span class=\"p\">=</span><span class=\"w\"> </span><span class=\"kc\">false</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">features</span><span class=\"w\"> </span><span class=\"p\">=</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"s2\">\"sync\"</span><span class=\"p\">]}</span>\n</code></pre></div>\n<p>And this does not:</p>\n<p><div class=\"codehilite\" data-code-language=\"TOML\"><pre><span></span><code><span class=\"k\">[dependencies]</span>\n<span class=\"n\">wasi-common</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"p\">=</span><span class=\"w\"> </span><span class=\"s2\">\"23.0.1\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">default-features</span><span class=\"w\"> </span><span class=\"p\">=</span><span class=\"w\"> </span><span class=\"kc\">false</span><span class=\"p\">}</span>\n</code></pre></div><br>\n</p>\n</blockquote>",
        "id": 453931295,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1721909862
    },
    {
        "content": "<p>Robbepop edited <a href=\"https://github.com/bytecodealliance/wasmtime/issues/9009\">issue #9009</a>:</p>\n<blockquote>\n<p>Recently we merged <a href=\"https://github.com/bytecodealliance/wasmtime/pull/8900\">https://github.com/bytecodealliance/wasmtime/pull/8900</a> to remove the <code>wasmtime</code> optional dependency from <code>wasi-common/sync</code> since it was unused mostly.</p>\n<p>This had the effect that users could use <code>wasi-common</code> with its <code>sync</code> feature without pulling in the giantic Wasmtime dependency ... or so I thought.<br>\nToday I wanted to use <code>wasi-common</code> v23.0.1 (including this improvement) into Wasmi's <code>wasmi_wasi</code> crate and to my surprise Cargo pulled Wasmtime via the <code>wasi-common</code> dependency.<br>\nWhen I removed the <code>sync</code> feature usage (which is kinda critical unfortunately) the Wasmtime dependency was gone.</p>\n<p>I am seriously confused as to why this happens. Looking at <code>wasi-common</code>'s <code>Cargo.toml</code> file does not help my confusion.<br>\n<a href=\"https://github.com/bytecodealliance/wasmtime/blob/main/crates/wasi-common/Cargo.toml\">https://github.com/bytecodealliance/wasmtime/blob/main/crates/wasi-common/Cargo.toml</a></p>\n<p>Any help or clarification?</p>\n<p>tl;dr:</p>\n<p>This pulls Wasmtime:</p>\n<div class=\"codehilite\" data-code-language=\"TOML\"><pre><span></span><code><span class=\"k\">[dependencies]</span>\n<span class=\"n\">wasi-common</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"p\">=</span><span class=\"w\"> </span><span class=\"s2\">\"23.0.1\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">default-features</span><span class=\"w\"> </span><span class=\"p\">=</span><span class=\"w\"> </span><span class=\"kc\">false</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">features</span><span class=\"w\"> </span><span class=\"p\">=</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"s2\">\"sync\"</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"p\">}</span>\n</code></pre></div>\n<p>And this does not:</p>\n<div class=\"codehilite\" data-code-language=\"TOML\"><pre><span></span><code><span class=\"k\">[dependencies]</span>\n<span class=\"n\">wasi-common</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"p\">=</span><span class=\"w\"> </span><span class=\"s2\">\"23.0.1\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">default-features</span><span class=\"w\"> </span><span class=\"p\">=</span><span class=\"w\"> </span><span class=\"kc\">false</span><span class=\"w\"> </span><span class=\"p\">}</span>\n</code></pre></div>\n<p>But why?</p>\n</blockquote>",
        "id": 453931396,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1721909885
    },
    {
        "content": "<p>Robbepop <a href=\"https://github.com/bytecodealliance/wasmtime/issues/9009#issuecomment-2250214656\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/9009\">issue #9009</a>:</p>\n<blockquote>\n<p>Here is a Wasmi PR with which you can reproduce the issue: <a href=\"https://github.com/wasmi-labs/wasmi/pull/1140\">https://github.com/wasmi-labs/wasmi/pull/1140</a></p>\n</blockquote>",
        "id": 453935536,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1721910829
    },
    {
        "content": "<p>Robbepop <a href=\"https://github.com/bytecodealliance/wasmtime/issues/9009#issuecomment-2250255213\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/9009\">issue #9009</a>:</p>\n<blockquote>\n<p>Building <code>wasmi_wasi</code> with</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">cargo</span><span class=\"w\"> </span><span class=\"n\">build</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">wasmi_wasi</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">no</span><span class=\"o\">-</span><span class=\"n\">default</span><span class=\"o\">-</span><span class=\"n\">features</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">verbose</span>\n</code></pre></div>\n<p>Reveals that somehow the <code>wasmtime</code> feature flag is set:<br>\n![image](<a href=\"https://github.com/user-attachments/assets/44f4fa29-57bf-4da5-a478-0e98daabe4a9\">https://github.com/user-attachments/assets/44f4fa29-57bf-4da5-a478-0e98daabe4a9</a>)</p>\n</blockquote>",
        "id": 453940688,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1721912130
    },
    {
        "content": "<p>bjorn3 <a href=\"https://github.com/bytecodealliance/wasmtime/issues/9009#issuecomment-2250268558\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/9009\">issue #9009</a>:</p>\n<blockquote>\n<p>According to <a href=\"https://docs.rs/crate/wasi-common/23.0.1/source/Cargo.toml.orig\">https://docs.rs/crate/wasi-common/23.0.1/source/Cargo.toml.orig</a>, #8900 is not yet included in wasi-common 23.0.x. Each release branches on the 5th of the month and gets released on the 20th: <a href=\"https://github.com/bytecodealliance/wasmtime/blob/5d0d61602f2dfa5478ef120a86a9009d74ac56bb/.github/workflows/release-process.yml#L23-L24\">https://github.com/bytecodealliance/wasmtime/blob/5d0d61602f2dfa5478ef120a86a9009d74ac56bb/.github/workflows/release-process.yml#L23-L24</a> #8900 got merged on the 8th of this month, which is 3 days after the 23.0 release got branched.</p>\n</blockquote>",
        "id": 453943060,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1721912533
    },
    {
        "content": "<p>Robbepop <a href=\"https://github.com/bytecodealliance/wasmtime/issues/9009#issuecomment-2250272393\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/9009\">issue #9009</a>:</p>\n<blockquote>\n<blockquote>\n<p>According to <a href=\"https://docs.rs/crate/wasi-common/23.0.1/source/Cargo.toml.orig\">https://docs.rs/crate/wasi-common/23.0.1/source/Cargo.toml.orig</a>, #8900 is not yet included in wasi-common 23.0.x. Each release branches on the 5th of the month and gets released on the 20th:</p>\n<p><a href=\"https://github.com/bytecodealliance/wasmtime/blob/5d0d61602f2dfa5478ef120a86a9009d74ac56bb/.github/workflows/release-process.yml#L23-L24\">https://github.com/bytecodealliance/wasmtime/blob/5d0d61602f2dfa5478ef120a86a9009d74ac56bb/.github/workflows/release-process.yml#L23-L24</a><br>\n#8900 got merged on the 8th of this month, which is 3 days after the 23.0 release got branched.</p>\n</blockquote>\n<p>Ah okay, that explains why I just successfully built <code>wasi-common</code> without the Wasmtime dependency when using the current <code>main</code> branch of Wasmtime. <span aria-label=\"face palm\" class=\"emoji emoji-1f926\" role=\"img\" title=\"face palm\">:face_palm:</span> Good to know.</p>\n<p>So this means some more waiting before I can merge the Wasmi PR. Thanks for letting me know!</p>\n<p>This issue can be closed then.</p>\n</blockquote>",
        "id": 453943586,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1721912650
    },
    {
        "content": "<p>alexcrichton closed <a href=\"https://github.com/bytecodealliance/wasmtime/issues/9009\">issue #9009</a>:</p>\n<blockquote>\n<p>Recently we merged <a href=\"https://github.com/bytecodealliance/wasmtime/pull/8900\">https://github.com/bytecodealliance/wasmtime/pull/8900</a> to remove the <code>wasmtime</code> optional dependency from <code>wasi-common/sync</code> since it was unused mostly.</p>\n<p>This had the effect that users could use <code>wasi-common</code> with its <code>sync</code> feature without pulling in the giantic Wasmtime dependency ... or so I thought.<br>\nToday I wanted to use <code>wasi-common</code> v23.0.1 (including this improvement) into Wasmi's <code>wasmi_wasi</code> crate and to my surprise Cargo pulled Wasmtime via the <code>wasi-common</code> dependency.<br>\nWhen I removed the <code>sync</code> feature usage (which is kinda critical unfortunately) the Wasmtime dependency was gone.</p>\n<p>I am seriously confused as to why this happens. Looking at <code>wasi-common</code>'s <code>Cargo.toml</code> file does not help my confusion.<br>\n<a href=\"https://github.com/bytecodealliance/wasmtime/blob/main/crates/wasi-common/Cargo.toml\">https://github.com/bytecodealliance/wasmtime/blob/main/crates/wasi-common/Cargo.toml</a></p>\n<p>Any help or clarification?</p>\n<p>tl;dr:</p>\n<p>This pulls Wasmtime:</p>\n<div class=\"codehilite\" data-code-language=\"TOML\"><pre><span></span><code><span class=\"k\">[dependencies]</span>\n<span class=\"n\">wasi-common</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"p\">=</span><span class=\"w\"> </span><span class=\"s2\">\"23.0.1\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">default-features</span><span class=\"w\"> </span><span class=\"p\">=</span><span class=\"w\"> </span><span class=\"kc\">false</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">features</span><span class=\"w\"> </span><span class=\"p\">=</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"s2\">\"sync\"</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"p\">}</span>\n</code></pre></div>\n<p>And this does not:</p>\n<div class=\"codehilite\" data-code-language=\"TOML\"><pre><span></span><code><span class=\"k\">[dependencies]</span>\n<span class=\"n\">wasi-common</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"p\">=</span><span class=\"w\"> </span><span class=\"s2\">\"23.0.1\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">default-features</span><span class=\"w\"> </span><span class=\"p\">=</span><span class=\"w\"> </span><span class=\"kc\">false</span><span class=\"w\"> </span><span class=\"p\">}</span>\n</code></pre></div>\n<p>But why?</p>\n</blockquote>",
        "id": 453970979,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1721919438
    }
]