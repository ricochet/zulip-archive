[
    {
        "content": "<p>tertsdiepraam opened <a href=\"https://github.com/bytecodealliance/wasmtime/pull/9279\">PR #9279</a> from <code>tertsdiepraam:fix-stackslot-alignment</code> to <code>bytecodealliance:main</code>:</p>\n<blockquote>\n<p>Hi! I think that the stackslots weren't properly aligned, because the padding for the alignment is being added to the end of the slot instead of at the start, meaning that the slot itself isn't really being aligned.</p>\n<p>This was creating issues for me where I requested a slot that was aligned at 16 bytes, but in reality it wasn't.</p>\n<p>With this change this case from the tests:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">ss0</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">explicit_slot</span><span class=\"w\"> </span><span class=\"mi\">8</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">align</span><span class=\"o\">=</span><span class=\"mi\">16</span>\n<span class=\"n\">ss1</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">explicit_slot</span><span class=\"w\"> </span><span class=\"mi\">8</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">align</span><span class=\"o\">=</span><span class=\"mi\">16</span>\n<span class=\"n\">ss2</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">explicit_slot</span><span class=\"w\"> </span><span class=\"mi\">4</span>\n<span class=\"n\">ss3</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">explicit_slot</span><span class=\"w\"> </span><span class=\"mi\">4</span>\n</code></pre></div>\n<p>gets these offsets:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">ss0</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"n\">ss1</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">16</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">because</span><span class=\"w\"> </span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">ss0</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"n\">padding</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">get</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"mi\">16</span><span class=\"p\">)</span>\n<span class=\"n\">ss2</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">24</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">because</span><span class=\"w\"> </span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">ss1</span><span class=\"p\">)</span>\n<span class=\"n\">ss3</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">32</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">because</span><span class=\"w\"> </span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">ss2</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"n\">padding</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">get</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">word</span><span class=\"w\"> </span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"mi\">8</span><span class=\"p\">)</span>\n</code></pre></div>\n<p>Note that the <code>align=16</code> of <code>ss0</code> is essentially a noop now.</p>\n<p>And this case from a test I added:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">ss0</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">explicit_slot</span><span class=\"w\"> </span><span class=\"mi\">8</span>\n<span class=\"n\">ss1</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">explicit_slot</span><span class=\"w\"> </span><span class=\"mi\">32</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">align</span><span class=\"o\">=</span><span class=\"mi\">16</span>\n</code></pre></div>\n<p>gets these offsets:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">ss0</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"n\">ss1</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">16</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">because</span><span class=\"w\"> </span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">ss0</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"n\">padding</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">get</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"mi\">16</span><span class=\"p\">)</span>\n</code></pre></div>\n<p>I hope I didn't make any mistakes here or misinterpreted what stackslot alignment should do. Let me know if I need to change anything!</p>\n<p>&lt;!--<br>\nPlease make sure you include the following information:</p>\n<ul>\n<li>\n<p>If this work has been discussed elsewhere, please include a link to that<br>\n  conversation. If it was discussed in an issue, just mention \"issue #...\".</p>\n</li>\n<li>\n<p>Explain why this change is needed. If the details are in an issue already,<br>\n  this can be brief.</p>\n</li>\n</ul>\n<p>Our development process is documented in the Wasmtime book:<br>\n<a href=\"https://docs.wasmtime.dev/contributing-development-process.html\">https://docs.wasmtime.dev/contributing-development-process.html</a></p>\n<p>Please ensure all communication follows the code of conduct:<br>\n<a href=\"https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md\">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>\n--&gt;</p>\n</blockquote>",
        "id": 471459239,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1726743275
    },
    {
        "content": "<p><strong>tertsdiepraam</strong> requested <a href=\"https://github.com/cfallin\">cfallin</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/9279\">PR #9279</a>.</p>",
        "id": 471459240,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1726743275
    },
    {
        "content": "<p><strong>tertsdiepraam</strong> requested <a href=\"https://github.com/orgs/bytecodealliance/teams/wasmtime-compiler-reviewers\">wasmtime-compiler-reviewers</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/9279\">PR #9279</a>.</p>",
        "id": 471459241,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1726743275
    },
    {
        "content": "<p>tertsdiepraam edited <a href=\"https://github.com/bytecodealliance/wasmtime/pull/9279\">PR #9279</a>:</p>\n<blockquote>\n<p>Hi! I think that the stackslots weren't properly aligned, because the padding for the alignment is being added to the end of the slot instead of at the start, meaning that the slot itself isn't really being aligned.</p>\n<p>This was creating issues for me where I requested a slot that was aligned at 16 bytes, but in reality it wasn't.</p>\n<p>With this change this case from the tests:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">ss0</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">explicit_slot</span><span class=\"w\"> </span><span class=\"mi\">8</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">align</span><span class=\"o\">=</span><span class=\"mi\">16</span>\n<span class=\"n\">ss1</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">explicit_slot</span><span class=\"w\"> </span><span class=\"mi\">8</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">align</span><span class=\"o\">=</span><span class=\"mi\">16</span>\n<span class=\"n\">ss2</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">explicit_slot</span><span class=\"w\"> </span><span class=\"mi\">4</span>\n<span class=\"n\">ss3</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">explicit_slot</span><span class=\"w\"> </span><span class=\"mi\">4</span>\n</code></pre></div>\n<p>gets these offsets:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">ss0</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"n\">ss1</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">16</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">because</span><span class=\"w\"> </span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">ss0</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"n\">padding</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">get</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"mi\">16</span><span class=\"p\">)</span>\n<span class=\"n\">ss2</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">24</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">because</span><span class=\"w\"> </span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">ss1</span><span class=\"p\">)</span>\n<span class=\"n\">ss3</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">32</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">because</span><span class=\"w\"> </span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">ss2</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"n\">padding</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">get</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">word</span><span class=\"w\"> </span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"mi\">8</span><span class=\"p\">)</span>\n</code></pre></div>\n<p>Note that the <code>align=16</code> of <code>ss0</code> is essentially a noop now.</p>\n<p>And this case from a test I added:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">ss0</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">explicit_slot</span><span class=\"w\"> </span><span class=\"mi\">8</span>\n<span class=\"n\">ss1</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">explicit_slot</span><span class=\"w\"> </span><span class=\"mi\">32</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">align</span><span class=\"o\">=</span><span class=\"mi\">16</span>\n</code></pre></div>\n<p>gets these offsets:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">ss0</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"n\">ss1</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">16</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">because</span><span class=\"w\"> </span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">ss0</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"n\">padding</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">get</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"mi\">16</span><span class=\"p\">)</span>\n</code></pre></div>\n<p>I hope I didn't make any mistakes here or misinterpreted what stackslot alignment should do. Let me know if I need to change anything!</p>\n<p>The issue was originally found here: <a href=\"#narrow/stream/217117-cranelift/topic/Retrieve.20alignment.20of.20architecture/near/471006324\">https://bytecodealliance.zulipchat.com/#narrow/stream/217117-cranelift/topic/Retrieve.20alignment.20of.20architecture/near/471006324</a></p>\n<p>&lt;!--<br>\nPlease make sure you include the following information:</p>\n<ul>\n<li>\n<p>If this work has been discussed elsewhere, please include a link to that<br>\n  conversation. If it was discussed in an issue, just mention \"issue #...\".</p>\n</li>\n<li>\n<p>Explain why this change is needed. If the details are in an issue already,<br>\n  this can be brief.</p>\n</li>\n</ul>\n<p>Our development process is documented in the Wasmtime book:<br>\n<a href=\"https://docs.wasmtime.dev/contributing-development-process.html\">https://docs.wasmtime.dev/contributing-development-process.html</a></p>\n<p>Please ensure all communication follows the code of conduct:<br>\n<a href=\"https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md\">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>\n--&gt;</p>\n</blockquote>",
        "id": 471459532,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1726743376
    },
    {
        "content": "<p>tertsdiepraam updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/9279\">PR #9279</a>.</p>",
        "id": 471460508,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1726743712
    },
    {
        "content": "<p>bal-e submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/9279#pullrequestreview-2315236965\">PR review</a>.</p>",
        "id": 471463643,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1726744977
    },
    {
        "content": "<p>bal-e created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/9279#discussion_r1766656442\">PR review comment</a>:</p>\n<blockquote>\n<p>Should this cause a panic?</p>\n</blockquote>",
        "id": 471463645,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1726744977
    },
    {
        "content": "<p>tertsdiepraam submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/9279#pullrequestreview-2315242790\">PR review</a>.</p>",
        "id": 471463858,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1726745045
    },
    {
        "content": "<p>tertsdiepraam created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/9279#discussion_r1766659686\">PR review comment</a>:</p>\n<blockquote>\n<p>Oops committed by accident thanks</p>\n</blockquote>",
        "id": 471463861,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1726745045
    },
    {
        "content": "<p>tertsdiepraam updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/9279\">PR #9279</a>.</p>",
        "id": 471464293,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1726745213
    },
    {
        "content": "<p>tertsdiepraam updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/9279\">PR #9279</a>.</p>",
        "id": 471464353,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1726745242
    },
    {
        "content": "<p>tertsdiepraam updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/9279\">PR #9279</a>.</p>",
        "id": 471465044,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1726745519
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/9279#pullrequestreview-2315932093\">PR review</a>:</p>\n<blockquote>\n<p>Thanks a bunch for fixing this!</p>\n</blockquote>",
        "id": 471514491,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1726760549
    },
    {
        "content": "<p>cfallin merged <a href=\"https://github.com/bytecodealliance/wasmtime/pull/9279\">PR #9279</a>.</p>",
        "id": 471520381,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1726762349
    },
    {
        "content": "<p>tertsdiepraam <a href=\"https://github.com/bytecodealliance/wasmtime/pull/9279#issuecomment-2361456381\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/9279\">PR #9279</a>:</p>\n<blockquote>\n<p>Thanks!</p>\n</blockquote>",
        "id": 471521343,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1726762646
    }
]