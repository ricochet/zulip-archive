[
    {
        "content": "<p><a href=\"https://github.com/orangeC23\">orangeC23</a> added the bug label to <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7331\">Issue #7331</a>.</p>",
        "id": 398091828,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1698069620
    },
    {
        "content": "<p>orangeC23 opened <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7331\">issue #7331</a>:</p>\n<blockquote>\n<h3>Steps to Reproduce</h3>\n<p>(1) The cfile is :</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code>#<span class=\"n\">include</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">stdio</span><span class=\"p\">.</span><span class=\"n\">h</span><span class=\"o\">&gt;</span>\n#<span class=\"n\">include</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">stdlib</span><span class=\"p\">.</span><span class=\"n\">h</span><span class=\"o\">&gt;</span>\n#<span class=\"n\">include</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">dirent</span><span class=\"p\">.</span><span class=\"n\">h</span><span class=\"o\">&gt;</span>\n#<span class=\"n\">include</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">sys</span><span class=\"o\">/</span><span class=\"n\">stat</span><span class=\"p\">.</span><span class=\"n\">h</span><span class=\"o\">&gt;</span>\n\n\n<span class=\"c1\">//#include &lt;sys/uio.h&gt;</span>\n<span class=\"c1\">//#include &lt;unistd.h&gt;</span>\n#<span class=\"n\">include</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">fcntl</span><span class=\"p\">.</span><span class=\"n\">h</span><span class=\"o\">&gt;</span>\n\n\n<span class=\"n\">int</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"kt\">char</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">dirPath</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">\"Data/mydir\"</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"n\">int</span><span class=\"w\"> </span><span class=\"n\">open_style</span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">O_RDONLY</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"n\">int</span><span class=\"w\"> </span><span class=\"n\">fd</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">get_fd</span><span class=\"p\">(</span><span class=\"n\">dirPath</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">open_style</span><span class=\"p\">);</span>\n<span class=\"w\">    </span><span class=\"n\">readdirQ6TwcRnVK4</span><span class=\"p\">(</span><span class=\"n\">dirPath</span><span class=\"p\">);</span>\n<span class=\"w\">    </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n\n<span class=\"n\">int</span><span class=\"w\"> </span><span class=\"n\">readdirQ6TwcRnVK4</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"kt\">char</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">path</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">fd_readdir</span><span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">);</span>\n<span class=\"p\">}</span>\n\n<span class=\"n\">int</span><span class=\"w\"> </span><span class=\"n\">get_fd</span><span class=\"p\">(</span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"kt\">char</span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">file_name</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">int</span><span class=\"w\"> </span><span class=\"n\">open_style</span><span class=\"p\">){</span>\n<span class=\"w\">    </span><span class=\"n\">int</span><span class=\"w\"> </span><span class=\"n\">fd</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">open</span><span class=\"p\">(</span><span class=\"n\">file_name</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">open_style</span><span class=\"p\">);</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">fd</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"n\">perror</span><span class=\"p\">(</span><span class=\"s\">\"Failed to open the file\"</span><span class=\"p\">);</span>\n<span class=\"w\">        </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n\n<span class=\"w\">    </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">fd</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n\n<span class=\"n\">int</span><span class=\"w\"> </span><span class=\"n\">fd_readdir</span><span class=\"p\">(</span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"kt\">char</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">path</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"n\">printf</span><span class=\"p\">(</span><span class=\"s\">\"Enter fd_readdir.</span><span class=\"se\">\\n</span><span class=\"s\">\"</span><span class=\"p\">);</span>\n\n<span class=\"w\">    </span><span class=\"n\">DIR</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">directory</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"k\">struct</span> <span class=\"nc\">dirent</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">entry</span><span class=\"p\">;</span>\n\n<span class=\"w\">    </span><span class=\"n\">directory</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">opendir</span><span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">);</span>\n\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">directory</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"n\">NULL</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"n\">perror</span><span class=\"p\">(</span><span class=\"s\">\"opendir\"</span><span class=\"p\">);</span>\n<span class=\"w\">        </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n\n<span class=\"w\">    </span><span class=\"k\">while</span><span class=\"w\"> </span><span class=\"p\">((</span><span class=\"n\">entry</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">readdir</span><span class=\"p\">(</span><span class=\"n\">directory</span><span class=\"p\">))</span><span class=\"w\"> </span><span class=\"o\">!=</span><span class=\"w\"> </span><span class=\"n\">NULL</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"n\">printf</span><span class=\"p\">(</span><span class=\"s\">\"%s</span><span class=\"se\">\\n</span><span class=\"s\">\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">entry</span>-&gt;<span class=\"nc\">d_name</span><span class=\"p\">);</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n\n<span class=\"w\">    </span><span class=\"n\">closedir</span><span class=\"p\">(</span><span class=\"n\">directory</span><span class=\"p\">);</span>\n<span class=\"w\">    </span><span class=\"n\">printf</span><span class=\"p\">(</span><span class=\"s\">\"Leave fd_readdir.</span><span class=\"se\">\\n</span><span class=\"s\">\"</span><span class=\"p\">);</span>\n<span class=\"w\">    </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p>(2)compile the c file into wasm: <code>./wasi-sdk-16.0/bin/clang --target=wasm32-unkown-wasi --sysroot=./wasi-sdk-16.0/share/wasi-sysroot readdir.c -o readdir.wasm</code><br>\n(3)exeute open.wasm<br>\n<code>wasmtime run  --dir=./Data test1.wasm</code><br>\nThe permission of Data/mydir is 0400 or 0500 or 0600, user1 create the Data/mydir directory before and user1 execute the Wasm file.</p>\n<h3>Expected Results</h3>\n<p>Using <code>gcc test1.c -o test1</code> and <code>./test1</code> to execute get the following result:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">Enter</span><span class=\"w\"> </span><span class=\"n\">fd_readdir</span><span class=\"p\">.</span>\n<span class=\"p\">.</span>\n<span class=\"o\">..</span>\n<span class=\"n\">test</span><span class=\"p\">.</span><span class=\"n\">txt</span>\n<span class=\"n\">Leave</span><span class=\"w\"> </span><span class=\"n\">fd_readdir</span><span class=\"p\">.</span>\n</code></pre></div>\n<p>And wamr, wasmedge also print the above message.</p>\n<h3>Actual Results</h3>\n<p>wasmtime prints:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">Enter</span><span class=\"w\"> </span><span class=\"n\">fd_readdir</span><span class=\"p\">.</span>\n<span class=\"n\">opendir</span>: <span class=\"nc\">Permission</span><span class=\"w\"> </span><span class=\"n\">denied</span>\n</code></pre></div>\n<p>I'm not sure whether wasmtime and native ubuntu and other runtimes get different could be a bug or only difference ? Maybe something error about the permission?<br>\n0400 r--<br>\n0500 r-x<br>\n0600 rw-</p>\n<p>0400, 0500, and 0600 has the read permission</p>\n<h3>Versions and Environment</h3>\n<p>wasmtime 13.0.0<br>\nOperating system: Ubuntu 20.04</p>\n<p>Architecture: x86_64</p>\n</blockquote>",
        "id": 398091831,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1698069621
    },
    {
        "content": "<p>orangeC23 edited <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7331\">issue #7331</a>:</p>\n<blockquote>\n<h3>Steps to Reproduce</h3>\n<p>(1) The cfile is :</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code>#<span class=\"n\">include</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">stdio</span><span class=\"p\">.</span><span class=\"n\">h</span><span class=\"o\">&gt;</span>\n#<span class=\"n\">include</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">stdlib</span><span class=\"p\">.</span><span class=\"n\">h</span><span class=\"o\">&gt;</span>\n#<span class=\"n\">include</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">dirent</span><span class=\"p\">.</span><span class=\"n\">h</span><span class=\"o\">&gt;</span>\n#<span class=\"n\">include</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">sys</span><span class=\"o\">/</span><span class=\"n\">stat</span><span class=\"p\">.</span><span class=\"n\">h</span><span class=\"o\">&gt;</span>\n#<span class=\"n\">include</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">fcntl</span><span class=\"p\">.</span><span class=\"n\">h</span><span class=\"o\">&gt;</span>\n\n\n<span class=\"n\">int</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"kt\">char</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">dirPath</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">\"Data/mydir\"</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"n\">int</span><span class=\"w\"> </span><span class=\"n\">open_style</span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">O_RDONLY</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"n\">int</span><span class=\"w\"> </span><span class=\"n\">fd</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">get_fd</span><span class=\"p\">(</span><span class=\"n\">dirPath</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">open_style</span><span class=\"p\">);</span>\n<span class=\"w\">    </span><span class=\"n\">readdirQ6TwcRnVK4</span><span class=\"p\">(</span><span class=\"n\">dirPath</span><span class=\"p\">);</span>\n<span class=\"w\">    </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n\n<span class=\"n\">int</span><span class=\"w\"> </span><span class=\"n\">readdirQ6TwcRnVK4</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"kt\">char</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">path</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">fd_readdir</span><span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">);</span>\n<span class=\"p\">}</span>\n\n<span class=\"n\">int</span><span class=\"w\"> </span><span class=\"n\">get_fd</span><span class=\"p\">(</span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"kt\">char</span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">file_name</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">int</span><span class=\"w\"> </span><span class=\"n\">open_style</span><span class=\"p\">){</span>\n<span class=\"w\">    </span><span class=\"n\">int</span><span class=\"w\"> </span><span class=\"n\">fd</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">open</span><span class=\"p\">(</span><span class=\"n\">file_name</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">open_style</span><span class=\"p\">);</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">fd</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"n\">perror</span><span class=\"p\">(</span><span class=\"s\">\"Failed to open the file\"</span><span class=\"p\">);</span>\n<span class=\"w\">        </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n\n<span class=\"w\">    </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">fd</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n\n<span class=\"n\">int</span><span class=\"w\"> </span><span class=\"n\">fd_readdir</span><span class=\"p\">(</span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"kt\">char</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">path</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"n\">printf</span><span class=\"p\">(</span><span class=\"s\">\"Enter fd_readdir.</span><span class=\"se\">\\n</span><span class=\"s\">\"</span><span class=\"p\">);</span>\n\n<span class=\"w\">    </span><span class=\"n\">DIR</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">directory</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"k\">struct</span> <span class=\"nc\">dirent</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">entry</span><span class=\"p\">;</span>\n\n<span class=\"w\">    </span><span class=\"n\">directory</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">opendir</span><span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">);</span>\n\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">directory</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"n\">NULL</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"n\">perror</span><span class=\"p\">(</span><span class=\"s\">\"opendir\"</span><span class=\"p\">);</span>\n<span class=\"w\">        </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n\n<span class=\"w\">    </span><span class=\"k\">while</span><span class=\"w\"> </span><span class=\"p\">((</span><span class=\"n\">entry</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">readdir</span><span class=\"p\">(</span><span class=\"n\">directory</span><span class=\"p\">))</span><span class=\"w\"> </span><span class=\"o\">!=</span><span class=\"w\"> </span><span class=\"n\">NULL</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"n\">printf</span><span class=\"p\">(</span><span class=\"s\">\"%s</span><span class=\"se\">\\n</span><span class=\"s\">\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">entry</span>-&gt;<span class=\"nc\">d_name</span><span class=\"p\">);</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n\n<span class=\"w\">    </span><span class=\"n\">closedir</span><span class=\"p\">(</span><span class=\"n\">directory</span><span class=\"p\">);</span>\n<span class=\"w\">    </span><span class=\"n\">printf</span><span class=\"p\">(</span><span class=\"s\">\"Leave fd_readdir.</span><span class=\"se\">\\n</span><span class=\"s\">\"</span><span class=\"p\">);</span>\n<span class=\"w\">    </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p>(2)compile the c file into wasm: <code>./wasi-sdk-16.0/bin/clang --target=wasm32-unkown-wasi --sysroot=./wasi-sdk-16.0/share/wasi-sysroot readdir.c -o readdir.wasm</code><br>\n(3)exeute open.wasm<br>\n<code>wasmtime run  --dir=./Data test1.wasm</code><br>\nThe permission of Data/mydir is 0400 or 0500 or 0600, user1 create the Data/mydir directory before and user1 execute the Wasm file.</p>\n<h3>Expected Results</h3>\n<p>Using <code>gcc test1.c -o test1</code> and <code>./test1</code> to execute get the following result:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">Enter</span><span class=\"w\"> </span><span class=\"n\">fd_readdir</span><span class=\"p\">.</span>\n<span class=\"p\">.</span>\n<span class=\"o\">..</span>\n<span class=\"n\">test</span><span class=\"p\">.</span><span class=\"n\">txt</span>\n<span class=\"n\">Leave</span><span class=\"w\"> </span><span class=\"n\">fd_readdir</span><span class=\"p\">.</span>\n</code></pre></div>\n<p>And wamr, wasmedge also print the above message.</p>\n<h3>Actual Results</h3>\n<p>wasmtime prints:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">Enter</span><span class=\"w\"> </span><span class=\"n\">fd_readdir</span><span class=\"p\">.</span>\n<span class=\"n\">opendir</span>: <span class=\"nc\">Permission</span><span class=\"w\"> </span><span class=\"n\">denied</span>\n</code></pre></div>\n<p>I'm not sure whether wasmtime and native ubuntu and other runtimes get different could be a bug or only difference ? Maybe something error about the permission?<br>\n0400 r--<br>\n0500 r-x<br>\n0600 rw-</p>\n<p>0400, 0500, and 0600 has the read permission</p>\n<h3>Versions and Environment</h3>\n<p>wasmtime 13.0.0<br>\nOperating system: Ubuntu 20.04</p>\n<p>Architecture: x86_64</p>\n</blockquote>",
        "id": 398091890,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1698069641
    },
    {
        "content": "<p>orangeC23 edited <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7331\">issue #7331</a>:</p>\n<blockquote>\n<h3>Steps to Reproduce</h3>\n<p>(1) The cfile is :</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code>#<span class=\"n\">include</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">stdio</span><span class=\"p\">.</span><span class=\"n\">h</span><span class=\"o\">&gt;</span>\n#<span class=\"n\">include</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">stdlib</span><span class=\"p\">.</span><span class=\"n\">h</span><span class=\"o\">&gt;</span>\n#<span class=\"n\">include</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">dirent</span><span class=\"p\">.</span><span class=\"n\">h</span><span class=\"o\">&gt;</span>\n#<span class=\"n\">include</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">sys</span><span class=\"o\">/</span><span class=\"n\">stat</span><span class=\"p\">.</span><span class=\"n\">h</span><span class=\"o\">&gt;</span>\n#<span class=\"n\">include</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">fcntl</span><span class=\"p\">.</span><span class=\"n\">h</span><span class=\"o\">&gt;</span>\n\n\n<span class=\"n\">int</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"kt\">char</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">dirPath</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">\"Data/mydir\"</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"n\">int</span><span class=\"w\"> </span><span class=\"n\">open_style</span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">O_RDONLY</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"n\">int</span><span class=\"w\"> </span><span class=\"n\">fd</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">get_fd</span><span class=\"p\">(</span><span class=\"n\">dirPath</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">open_style</span><span class=\"p\">);</span>\n<span class=\"w\">    </span><span class=\"n\">readdirQ6TwcRnVK4</span><span class=\"p\">(</span><span class=\"n\">dirPath</span><span class=\"p\">);</span>\n<span class=\"w\">    </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n\n<span class=\"n\">int</span><span class=\"w\"> </span><span class=\"n\">readdirQ6TwcRnVK4</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"kt\">char</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">path</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">fd_readdir</span><span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">);</span>\n<span class=\"p\">}</span>\n\n<span class=\"n\">int</span><span class=\"w\"> </span><span class=\"n\">get_fd</span><span class=\"p\">(</span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"kt\">char</span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">file_name</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">int</span><span class=\"w\"> </span><span class=\"n\">open_style</span><span class=\"p\">){</span>\n<span class=\"w\">    </span><span class=\"n\">int</span><span class=\"w\"> </span><span class=\"n\">fd</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">open</span><span class=\"p\">(</span><span class=\"n\">file_name</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">open_style</span><span class=\"p\">);</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">fd</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"n\">perror</span><span class=\"p\">(</span><span class=\"s\">\"Failed to open the file\"</span><span class=\"p\">);</span>\n<span class=\"w\">        </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n\n<span class=\"w\">    </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">fd</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n\n<span class=\"n\">int</span><span class=\"w\"> </span><span class=\"n\">fd_readdir</span><span class=\"p\">(</span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"kt\">char</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">path</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"n\">printf</span><span class=\"p\">(</span><span class=\"s\">\"Enter fd_readdir.</span><span class=\"se\">\\n</span><span class=\"s\">\"</span><span class=\"p\">);</span>\n\n<span class=\"w\">    </span><span class=\"n\">DIR</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">directory</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"k\">struct</span> <span class=\"nc\">dirent</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">entry</span><span class=\"p\">;</span>\n\n<span class=\"w\">    </span><span class=\"n\">directory</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">opendir</span><span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">);</span>\n\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">directory</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"n\">NULL</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"n\">perror</span><span class=\"p\">(</span><span class=\"s\">\"opendir\"</span><span class=\"p\">);</span>\n<span class=\"w\">        </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n\n<span class=\"w\">    </span><span class=\"k\">while</span><span class=\"w\"> </span><span class=\"p\">((</span><span class=\"n\">entry</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">readdir</span><span class=\"p\">(</span><span class=\"n\">directory</span><span class=\"p\">))</span><span class=\"w\"> </span><span class=\"o\">!=</span><span class=\"w\"> </span><span class=\"n\">NULL</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"n\">printf</span><span class=\"p\">(</span><span class=\"s\">\"%s</span><span class=\"se\">\\n</span><span class=\"s\">\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">entry</span>-&gt;<span class=\"nc\">d_name</span><span class=\"p\">);</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n\n<span class=\"w\">    </span><span class=\"n\">closedir</span><span class=\"p\">(</span><span class=\"n\">directory</span><span class=\"p\">);</span>\n<span class=\"w\">    </span><span class=\"n\">printf</span><span class=\"p\">(</span><span class=\"s\">\"Leave fd_readdir.</span><span class=\"se\">\\n</span><span class=\"s\">\"</span><span class=\"p\">);</span>\n<span class=\"w\">    </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p>(2)compile the c file into wasm: <code>./wasi-sdk-16.0/bin/clang --target=wasm32-unkown-wasi --sysroot=./wasi-sdk-16.0/share/wasi-sysroot readdir.c -o readdir.wasm</code><br>\n(3)exeute open.wasm<br>\n<code>wasmtime run  --dir=./Data readdir.wasm</code><br>\nThe permission of Data/mydir is 0400 or 0500 or 0600, user1 create the Data/mydir directory before and user1 execute the Wasm file.</p>\n<h3>Expected Results</h3>\n<p>Using <code>gcc readdir.c -o readdir</code> and <code>./readdir</code> to execute get the following result:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">Enter</span><span class=\"w\"> </span><span class=\"n\">fd_readdir</span><span class=\"p\">.</span>\n<span class=\"p\">.</span>\n<span class=\"o\">..</span>\n<span class=\"n\">test</span><span class=\"p\">.</span><span class=\"n\">txt</span>\n<span class=\"n\">Leave</span><span class=\"w\"> </span><span class=\"n\">fd_readdir</span><span class=\"p\">.</span>\n</code></pre></div>\n<p>And wamr, wasmedge also print the above message.</p>\n<h3>Actual Results</h3>\n<p>wasmtime prints:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">Enter</span><span class=\"w\"> </span><span class=\"n\">fd_readdir</span><span class=\"p\">.</span>\n<span class=\"n\">opendir</span>: <span class=\"nc\">Permission</span><span class=\"w\"> </span><span class=\"n\">denied</span>\n</code></pre></div>\n<p>I'm not sure whether wasmtime and native ubuntu and other runtimes get different could be a bug or only difference ? Maybe something error about the permission?<br>\n0400 r--<br>\n0500 r-x<br>\n0600 rw-</p>\n<p>0400, 0500, and 0600 has the read permission</p>\n<h3>Versions and Environment</h3>\n<p>wasmtime 13.0.0<br>\nOperating system: Ubuntu 20.04</p>\n<p>Architecture: x86_64</p>\n</blockquote>",
        "id": 398091988,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1698069670
    },
    {
        "content": "<p>orangeC23 edited <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7331\">issue #7331</a>:</p>\n<blockquote>\n<h3>Steps to Reproduce</h3>\n<p>(1) The cfile is :</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code>#<span class=\"n\">include</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">stdio</span><span class=\"p\">.</span><span class=\"n\">h</span><span class=\"o\">&gt;</span>\n#<span class=\"n\">include</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">stdlib</span><span class=\"p\">.</span><span class=\"n\">h</span><span class=\"o\">&gt;</span>\n#<span class=\"n\">include</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">dirent</span><span class=\"p\">.</span><span class=\"n\">h</span><span class=\"o\">&gt;</span>\n#<span class=\"n\">include</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">sys</span><span class=\"o\">/</span><span class=\"n\">stat</span><span class=\"p\">.</span><span class=\"n\">h</span><span class=\"o\">&gt;</span>\n#<span class=\"n\">include</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">fcntl</span><span class=\"p\">.</span><span class=\"n\">h</span><span class=\"o\">&gt;</span>\n\n\n<span class=\"n\">int</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"kt\">char</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">dirPath</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">\"Data/mydir\"</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"n\">int</span><span class=\"w\"> </span><span class=\"n\">open_style</span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">O_RDONLY</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"n\">int</span><span class=\"w\"> </span><span class=\"n\">fd</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">get_fd</span><span class=\"p\">(</span><span class=\"n\">dirPath</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">open_style</span><span class=\"p\">);</span>\n<span class=\"w\">    </span><span class=\"n\">readdirQ6TwcRnVK4</span><span class=\"p\">(</span><span class=\"n\">dirPath</span><span class=\"p\">);</span>\n<span class=\"w\">    </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n\n<span class=\"n\">int</span><span class=\"w\"> </span><span class=\"n\">readdirQ6TwcRnVK4</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"kt\">char</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">path</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">fd_readdir</span><span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">);</span>\n<span class=\"p\">}</span>\n\n<span class=\"n\">int</span><span class=\"w\"> </span><span class=\"n\">get_fd</span><span class=\"p\">(</span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"kt\">char</span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">file_name</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">int</span><span class=\"w\"> </span><span class=\"n\">open_style</span><span class=\"p\">){</span>\n<span class=\"w\">    </span><span class=\"n\">int</span><span class=\"w\"> </span><span class=\"n\">fd</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">open</span><span class=\"p\">(</span><span class=\"n\">file_name</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">open_style</span><span class=\"p\">);</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">fd</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"n\">perror</span><span class=\"p\">(</span><span class=\"s\">\"Failed to open the file\"</span><span class=\"p\">);</span>\n<span class=\"w\">        </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n\n<span class=\"w\">    </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">fd</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n\n<span class=\"n\">int</span><span class=\"w\"> </span><span class=\"n\">fd_readdir</span><span class=\"p\">(</span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"kt\">char</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">path</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"n\">printf</span><span class=\"p\">(</span><span class=\"s\">\"Enter fd_readdir.</span><span class=\"se\">\\n</span><span class=\"s\">\"</span><span class=\"p\">);</span>\n\n<span class=\"w\">    </span><span class=\"n\">DIR</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">directory</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"k\">struct</span> <span class=\"nc\">dirent</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">entry</span><span class=\"p\">;</span>\n\n<span class=\"w\">    </span><span class=\"n\">directory</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">opendir</span><span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">);</span>\n\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">directory</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"n\">NULL</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"n\">perror</span><span class=\"p\">(</span><span class=\"s\">\"opendir\"</span><span class=\"p\">);</span>\n<span class=\"w\">        </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n\n<span class=\"w\">    </span><span class=\"k\">while</span><span class=\"w\"> </span><span class=\"p\">((</span><span class=\"n\">entry</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">readdir</span><span class=\"p\">(</span><span class=\"n\">directory</span><span class=\"p\">))</span><span class=\"w\"> </span><span class=\"o\">!=</span><span class=\"w\"> </span><span class=\"n\">NULL</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"n\">printf</span><span class=\"p\">(</span><span class=\"s\">\"%s</span><span class=\"se\">\\n</span><span class=\"s\">\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">entry</span>-&gt;<span class=\"nc\">d_name</span><span class=\"p\">);</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n\n<span class=\"w\">    </span><span class=\"n\">closedir</span><span class=\"p\">(</span><span class=\"n\">directory</span><span class=\"p\">);</span>\n<span class=\"w\">    </span><span class=\"n\">printf</span><span class=\"p\">(</span><span class=\"s\">\"Leave fd_readdir.</span><span class=\"se\">\\n</span><span class=\"s\">\"</span><span class=\"p\">);</span>\n<span class=\"w\">    </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p>(2)compile the c file into wasm: <code>./wasi-sdk-16.0/bin/clang --target=wasm32-unkown-wasi --sysroot=./wasi-sdk-16.0/share/wasi-sysroot readdir.c -o readdir.wasm</code><br>\n(3)exeute open.wasm<br>\n<code>wasmtime run  --dir=./Data readdir.wasm</code><br>\nThe permission of Data/mydir is 0400 or 0500 or 0600, user1 create the Data/mydir directory before and user1 execute the Wasm file.</p>\n<h3>Expected Results</h3>\n<p>Using <code>gcc readdir.c -o readdir</code> and <code>./readdir</code> to execute get the following result:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">Enter</span><span class=\"w\"> </span><span class=\"n\">fd_readdir</span><span class=\"p\">.</span>\n<span class=\"p\">.</span>\n<span class=\"o\">..</span>\n<span class=\"n\">test</span><span class=\"p\">.</span><span class=\"n\">txt</span>\n<span class=\"n\">Leave</span><span class=\"w\"> </span><span class=\"n\">fd_readdir</span><span class=\"p\">.</span>\n</code></pre></div>\n<p>And wamr, wasmedge also print the above message.</p>\n<h3>Actual Results</h3>\n<p>wasmtime prints:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">Enter</span><span class=\"w\"> </span><span class=\"n\">fd_readdir</span><span class=\"p\">.</span>\n<span class=\"n\">opendir</span>: <span class=\"nc\">Permission</span><span class=\"w\"> </span><span class=\"n\">denied</span>\n</code></pre></div>\n<p>I'm not sure whether wasmtime and native ubuntu and other runtimes get different could be a bug or only difference ? Maybe something error about the permission?<br>\n0400 r--<br>\n0500 r-x<br>\n0600 rw-</p>\n<p>0400, 0500, and 0600 has the read permission</p>\n<p>Sorry for bothering you. Thanks a lot !</p>\n<h3>Versions and Environment</h3>\n<p>wasmtime 13.0.0<br>\nOperating system: Ubuntu 20.04</p>\n<p>Architecture: x86_64</p>\n</blockquote>",
        "id": 398092106,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1698069714
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7331#issuecomment-1775534139\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7331\">issue #7331</a>:</p>\n<blockquote>\n<p>Thanks for the report, although I can ask a few clarify questions. Your C code as-provided does not compile for me because the functions are in the wrong order. Are you transforming the code to post in this issue report vs what you're running locally?</p>\n<p>I can reproduce this behavior for 0400 and 0600 permissions but with 0500 permissions it seems to read the directory ok. Can you confirm whether 0500 works or not for you?</p>\n<p>Locally this seems to be related to the 'x' permisison bit. Interestingly I also get different behavior on various platforms. The <code>ls</code> command for example can read an 0600 directory on Linux but not on macOS. A native Rust executable using <code>std::fs::read_dir</code> can seem to open it on both platforms.</p>\n<p>I don't know what the \"right\" behavior is, or even if there is one. I'll cc @sunfishcode as this is related to what <code>cap-std</code> does. On Linux at least cap-std for the <code>entries</code> method on directories issues:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"p\">[</span><span class=\"n\">pid</span><span class=\"w\"> </span><span class=\"mi\">534964</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"n\">openat2</span><span class=\"p\">(</span><span class=\"mi\">3</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">\"mydir\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"n\">flags</span><span class=\"o\">=</span><span class=\"n\">O_RDONLY</span><span class=\"o\">|</span><span class=\"n\">O_LARGEFILE</span><span class=\"o\">|</span><span class=\"n\">O_CLOEXEC</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">resolve</span><span class=\"o\">=</span><span class=\"n\">RESOLVE_NO_MAGICLINKS</span><span class=\"o\">|</span><span class=\"n\">RESOLVE_BENEATH</span><span class=\"p\">},</span><span class=\"w\"> </span><span class=\"mi\">24</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">6</span>\n<span class=\"p\">[</span><span class=\"n\">pid</span><span class=\"w\"> </span><span class=\"mi\">534964</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"n\">statx</span><span class=\"p\">(</span><span class=\"mi\">6</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">\"\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">AT_STATX_SYNC_AS_STAT</span><span class=\"o\">|</span><span class=\"n\">AT_EMPTY_PATH</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">STATX_ALL</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"n\">stx_mask</span><span class=\"o\">=</span><span class=\"n\">STATX_ALL</span><span class=\"o\">|</span><span class=\"n\">STATX_MNT_ID</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">stx_attributes</span><span class=\"o\">=</span><span class=\"mi\">0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">stx_mode</span><span class=\"o\">=</span><span class=\"n\">S_IFDIR</span><span class=\"o\">|</span><span class=\"mi\">0600</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">stx_size</span><span class=\"o\">=</span><span class=\"mi\">4096</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">..</span><span class=\"p\">.})</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"p\">[</span><span class=\"n\">pid</span><span class=\"w\"> </span><span class=\"mi\">534964</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"n\">statx</span><span class=\"p\">(</span><span class=\"mi\">6</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">\"\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">AT_STATX_SYNC_AS_STAT</span><span class=\"o\">|</span><span class=\"n\">AT_EMPTY_PATH</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">STATX_ALL</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"n\">stx_mask</span><span class=\"o\">=</span><span class=\"n\">STATX_ALL</span><span class=\"o\">|</span><span class=\"n\">STATX_MNT_ID</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">stx_attributes</span><span class=\"o\">=</span><span class=\"mi\">0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">stx_mode</span><span class=\"o\">=</span><span class=\"n\">S_IFDIR</span><span class=\"o\">|</span><span class=\"mi\">0600</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">stx_size</span><span class=\"o\">=</span><span class=\"mi\">4096</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">..</span><span class=\"p\">.})</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"p\">[</span><span class=\"n\">pid</span><span class=\"w\"> </span><span class=\"mi\">534964</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"n\">openat</span><span class=\"p\">(</span><span class=\"mi\">6</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">\".\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">O_RDONLY</span><span class=\"o\">|</span><span class=\"n\">O_LARGEFILE</span><span class=\"o\">|</span><span class=\"n\">O_NOFOLLOW</span><span class=\"o\">|</span><span class=\"n\">O_CLOEXEC</span><span class=\"o\">|</span><span class=\"n\">O_DIRECTORY</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">EACCES</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">Permission</span><span class=\"w\"> </span><span class=\"n\">denied</span><span class=\"p\">)</span>\n</code></pre></div>\n<p>as compared to the Rust standard library which issues:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">openat</span><span class=\"p\">(</span><span class=\"n\">AT_FDCWD</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">\"./Data/mydir\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">O_RDONLY</span><span class=\"o\">|</span><span class=\"n\">O_NONBLOCK</span><span class=\"o\">|</span><span class=\"n\">O_CLOEXEC</span><span class=\"o\">|</span><span class=\"n\">O_DIRECTORY</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">3</span>\n<span class=\"n\">newfstatat</span><span class=\"p\">(</span><span class=\"mi\">3</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">\"\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"n\">st_mode</span><span class=\"o\">=</span><span class=\"n\">S_IFDIR</span><span class=\"o\">|</span><span class=\"mi\">0600</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">st_size</span><span class=\"o\">=</span><span class=\"mi\">4096</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">..</span><span class=\"p\">.},</span><span class=\"w\"> </span><span class=\"n\">AT_EMPTY_PATH</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n</code></pre></div>\n<p>That's at least what I've found, but this is also assuming a lot about the original program and @orangeC23's issue, so this could also perhaps be \"simply resolved\" with more clarifications in the above issue.</p>\n</blockquote>",
        "id": 398117466,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1698077244
    },
    {
        "content": "<p>orangeC23 edited <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7331\">issue #7331</a>:</p>\n<blockquote>\n<h3>Steps to Reproduce</h3>\n<p>(1) The cfile is :</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code>#<span class=\"n\">include</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">stdio</span><span class=\"p\">.</span><span class=\"n\">h</span><span class=\"o\">&gt;</span>\n#<span class=\"n\">include</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">stdlib</span><span class=\"p\">.</span><span class=\"n\">h</span><span class=\"o\">&gt;</span>\n#<span class=\"n\">include</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">dirent</span><span class=\"p\">.</span><span class=\"n\">h</span><span class=\"o\">&gt;</span>\n#<span class=\"n\">include</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">sys</span><span class=\"o\">/</span><span class=\"n\">stat</span><span class=\"p\">.</span><span class=\"n\">h</span><span class=\"o\">&gt;</span>\n#<span class=\"n\">include</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">fcntl</span><span class=\"p\">.</span><span class=\"n\">h</span><span class=\"o\">&gt;</span>\n\n\n<span class=\"n\">int</span><span class=\"w\"> </span><span class=\"n\">get_fd</span><span class=\"p\">(</span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"kt\">char</span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">file_name</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">int</span><span class=\"w\"> </span><span class=\"n\">open_style</span><span class=\"p\">){</span>\n<span class=\"w\">    </span><span class=\"n\">int</span><span class=\"w\"> </span><span class=\"n\">fd</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">open</span><span class=\"p\">(</span><span class=\"n\">file_name</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">open_style</span><span class=\"p\">);</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">fd</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"n\">perror</span><span class=\"p\">(</span><span class=\"s\">\"Failed to open the file\"</span><span class=\"p\">);</span>\n<span class=\"w\">        </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n\n<span class=\"w\">    </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">fd</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n\n<span class=\"n\">int</span><span class=\"w\"> </span><span class=\"n\">fd_readdir</span><span class=\"p\">(</span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"kt\">char</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">path</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"n\">printf</span><span class=\"p\">(</span><span class=\"s\">\"Enter fd_readdir.</span><span class=\"se\">\\n</span><span class=\"s\">\"</span><span class=\"p\">);</span>\n\n<span class=\"w\">    </span><span class=\"n\">DIR</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">directory</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"k\">struct</span> <span class=\"nc\">dirent</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">entry</span><span class=\"p\">;</span>\n\n<span class=\"w\">    </span><span class=\"n\">directory</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">opendir</span><span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">);</span>\n\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">directory</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"n\">NULL</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"n\">perror</span><span class=\"p\">(</span><span class=\"s\">\"opendir\"</span><span class=\"p\">);</span>\n<span class=\"w\">        </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n\n<span class=\"w\">    </span><span class=\"k\">while</span><span class=\"w\"> </span><span class=\"p\">((</span><span class=\"n\">entry</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">readdir</span><span class=\"p\">(</span><span class=\"n\">directory</span><span class=\"p\">))</span><span class=\"w\"> </span><span class=\"o\">!=</span><span class=\"w\"> </span><span class=\"n\">NULL</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"n\">printf</span><span class=\"p\">(</span><span class=\"s\">\"%s</span><span class=\"se\">\\n</span><span class=\"s\">\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">entry</span>-&gt;<span class=\"nc\">d_name</span><span class=\"p\">);</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n\n<span class=\"w\">    </span><span class=\"n\">closedir</span><span class=\"p\">(</span><span class=\"n\">directory</span><span class=\"p\">);</span>\n<span class=\"w\">    </span><span class=\"n\">printf</span><span class=\"p\">(</span><span class=\"s\">\"Leave fd_readdir.</span><span class=\"se\">\\n</span><span class=\"s\">\"</span><span class=\"p\">);</span>\n<span class=\"w\">    </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n\n<span class=\"n\">int</span><span class=\"w\"> </span><span class=\"n\">readdirQ6TwcRnVK4</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"kt\">char</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">path</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">fd_readdir</span><span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">);</span>\n<span class=\"p\">}</span>\n\n\n<span class=\"n\">int</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"kt\">char</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">dirPath</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">\"Data/mydir\"</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"n\">int</span><span class=\"w\"> </span><span class=\"n\">open_style</span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">O_RDONLY</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"n\">int</span><span class=\"w\"> </span><span class=\"n\">fd</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">get_fd</span><span class=\"p\">(</span><span class=\"n\">dirPath</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">open_style</span><span class=\"p\">);</span>\n<span class=\"w\">    </span><span class=\"n\">readdirQ6TwcRnVK4</span><span class=\"p\">(</span><span class=\"n\">dirPath</span><span class=\"p\">);</span>\n<span class=\"w\">    </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p>(2)compile the c file into wasm: <code>./wasi-sdk-16.0/bin/clang --target=wasm32-unkown-wasi --sysroot=./wasi-sdk-16.0/share/wasi-sysroot readdir.c -o readdir.wasm</code><br>\n(3)exeute open.wasm<br>\n<code>wasmtime run  --dir=./Data readdir.wasm</code><br>\nThe permission of Data/mydir is 0400 or 0500 or 0600, user1 create the Data/mydir directory before and user1 execute the Wasm file.</p>\n<h3>Expected Results</h3>\n<p>Using <code>gcc readdir.c -o readdir</code> and <code>./readdir</code> to execute get the following result:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">Enter</span><span class=\"w\"> </span><span class=\"n\">fd_readdir</span><span class=\"p\">.</span>\n<span class=\"p\">.</span>\n<span class=\"o\">..</span>\n<span class=\"n\">test</span><span class=\"p\">.</span><span class=\"n\">txt</span>\n<span class=\"n\">Leave</span><span class=\"w\"> </span><span class=\"n\">fd_readdir</span><span class=\"p\">.</span>\n</code></pre></div>\n<p>And wamr, wasmedge also print the above message.</p>\n<h3>Actual Results</h3>\n<p>wasmtime prints:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">Enter</span><span class=\"w\"> </span><span class=\"n\">fd_readdir</span><span class=\"p\">.</span>\n<span class=\"n\">opendir</span>: <span class=\"nc\">Permission</span><span class=\"w\"> </span><span class=\"n\">denied</span>\n</code></pre></div>\n<p>I'm not sure whether wasmtime and native ubuntu and other runtimes get different could be a bug or only difference ? Maybe something error about the permission?<br>\n0400 r--<br>\n0500 r-x<br>\n0600 rw-</p>\n<p>0400, 0500, and 0600 has the read permission</p>\n<p>Sorry for bothering you. Thanks a lot !</p>\n<h3>Versions and Environment</h3>\n<p>wasmtime 13.0.0<br>\nOperating system: Ubuntu 20.04</p>\n<p>Architecture: x86_64</p>\n</blockquote>",
        "id": 398184388,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1698113019
    },
    {
        "content": "<p>orangeC23 <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7331#issuecomment-1776383760\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7331\">issue #7331</a>:</p>\n<blockquote>\n<p>Sorry. I updated the C program.</p>\n</blockquote>",
        "id": 398184905,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1698113292
    },
    {
        "content": "<p>orangeC23 edited a <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7331#issuecomment-1776383760\">comment</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7331\">issue #7331</a>:</p>\n<blockquote>\n<p>Sorry. I updated the C program. I'll check the other information your provided. Thanks for your reply !</p>\n</blockquote>",
        "id": 398185164,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1698113433
    }
]