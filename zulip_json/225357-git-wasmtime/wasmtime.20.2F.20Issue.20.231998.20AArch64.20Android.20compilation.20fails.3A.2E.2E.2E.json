[
    {
        "content": "<p>Rochet2 opened <a href=\"https://github.com/bytecodealliance/wasmtime/issues/1998\">Issue #1998</a>:</p>\n<blockquote>\n<p>When compiling wasmtime for android aarch64, an error occurs:</p>\n<div class=\"codehilite\"><pre><span></span><code>$ cargo +nightly build --target aarch64-linux-android --release\n   Compiling wasmtime-runtime v0.18.0 <span class=\"o\">(</span>/home/local/rimi/Documents/test/wasmtimetest/android_runtime/wasmtime/crates/runtime<span class=\"o\">)</span>\nerror: unsupported platform\n   --&gt; wasmtime/crates/runtime/src/traphandlers.rs:171:21\n    <span class=\"p\">|</span>\n<span class=\"m\">171</span> <span class=\"p\">|</span>                     compile_error!<span class=\"o\">(</span><span class=\"s2\">&quot;unsupported platform&quot;</span><span class=\"o\">)</span><span class=\"p\">;</span>\n    <span class=\"p\">|</span>                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\nerror<span class=\"o\">[</span>E0308<span class=\"o\">]</span>: mismatched types\n   --&gt; wasmtime/crates/runtime/src/traphandlers.rs:156:52\n    <span class=\"p\">|</span>\n<span class=\"m\">156</span> <span class=\"p\">|</span>         unsafe fn get_pc<span class=\"o\">(</span>cx: *mut libc::c_void<span class=\"o\">)</span> -&gt; *const u8 <span class=\"o\">{</span>\n    <span class=\"p\">|</span>                   ------                           ^^^^^^^^^ expected *-ptr, found <span class=\"sb\">`</span><span class=\"o\">()</span><span class=\"sb\">`</span>\n    <span class=\"p\">|</span>                   <span class=\"p\">|</span>\n    <span class=\"p\">|</span>                   implicitly returns <span class=\"sb\">`</span><span class=\"o\">()</span><span class=\"sb\">`</span> as its body has no tail or <span class=\"sb\">`</span><span class=\"k\">return</span><span class=\"sb\">`</span> expression\n    <span class=\"p\">|</span>\n    <span class=\"o\">=</span> note: expected raw pointer <span class=\"sb\">`</span>*const u8<span class=\"sb\">`</span>\n                 found unit <span class=\"nb\">type</span> <span class=\"sb\">`</span><span class=\"o\">()</span><span class=\"sb\">`</span>\n\nerror: aborting due to <span class=\"m\">2</span> previous errors\n\nFor more information about this error, try <span class=\"sb\">`</span>rustc --explain E0308<span class=\"sb\">`</span>.\nerror: could not compile <span class=\"sb\">`</span>wasmtime-runtime<span class=\"sb\">`</span>.\n\nTo learn more, run the <span class=\"nb\">command</span> again with --verbose.\n</code></pre></div>\n\n\n<p>The error comes from this code: <a href=\"https://github.com/bytecodealliance/wasmtime/blob/c9a3f05afd45961b0b397f97c4ad79cd7a7c807d/crates/runtime/src/traphandlers.rs#L156-L174\">https://github.com/bytecodealliance/wasmtime/blob/c9a3f05afd45961b0b397f97c4ad79cd7a7c807d/crates/runtime/src/traphandlers.rs#L156-L174</a></p>\n<p>The reason seems to be that there is no aarch64 <strong>android</strong> case in the code.<br>\nBy doing the following change I am able to compile successfully, but I am unsure if this is a proper fix to the issue.<br>\nThe diff was generated for 5c35a9631cdffc00a32b416f9cb0b80f182b716e.</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"gh\">diff --git a/crates/runtime/src/traphandlers.rs b/crates/runtime/src/traphandlers.rs</span>\n<span class=\"gh\">index 0bd6f2cd1b..198d03a640 100644</span>\n<span class=\"gd\">--- a/crates/runtime/src/traphandlers.rs</span>\n<span class=\"gi\">+++ b/crates/runtime/src/traphandlers.rs</span>\n<span class=\"gu\">@@ -161,7 +161,7 @@ cfg_if::cfg_if! {</span>\n                 } else if #[cfg(all(target_os = &quot;linux&quot;, target_arch = &quot;x86&quot;))] {\n                     let cx = &amp;*(cx as *const libc::ucontext_t);\n                     cx.uc_mcontext.gregs[libc::REG_EIP as usize] as *const u8\n<span class=\"gd\">-                } else if #[cfg(all(target_os = &quot;linux&quot;, target_arch = &quot;aarch64&quot;))] {</span>\n<span class=\"gi\">+                } else if #[cfg(all(any(target_os = &quot;linux&quot;, target_os = &quot;android&quot;), target_arch = &quot;aarch64&quot;))] {</span>\n                     let cx = &amp;*(cx as *const libc::ucontext_t);\n                     cx.uc_mcontext.pc as *const u8\n                 } else if #[cfg(target_os = &quot;macos&quot;)] {\n```*\n~~~\n</code></pre></div>\n\n\n</blockquote>",
        "id": 203370608,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1594290174
    },
    {
        "content": "<p>Rochet2 edited <a href=\"https://github.com/bytecodealliance/wasmtime/issues/1998\">Issue #1998</a>:</p>\n<blockquote>\n<p>When compiling wasmtime for android aarch64, an error occurs:</p>\n<div class=\"codehilite\"><pre><span></span><code>$ cargo +nightly build --target aarch64-linux-android --release\n   Compiling wasmtime-runtime v0.18.0 <span class=\"o\">(</span>/home/local/rimi/Documents/test/wasmtimetest/android_runtime/wasmtime/crates/runtime<span class=\"o\">)</span>\nerror: unsupported platform\n   --&gt; wasmtime/crates/runtime/src/traphandlers.rs:171:21\n    <span class=\"p\">|</span>\n<span class=\"m\">171</span> <span class=\"p\">|</span>                     compile_error!<span class=\"o\">(</span><span class=\"s2\">&quot;unsupported platform&quot;</span><span class=\"o\">)</span><span class=\"p\">;</span>\n    <span class=\"p\">|</span>                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\nerror<span class=\"o\">[</span>E0308<span class=\"o\">]</span>: mismatched types\n   --&gt; wasmtime/crates/runtime/src/traphandlers.rs:156:52\n    <span class=\"p\">|</span>\n<span class=\"m\">156</span> <span class=\"p\">|</span>         unsafe fn get_pc<span class=\"o\">(</span>cx: *mut libc::c_void<span class=\"o\">)</span> -&gt; *const u8 <span class=\"o\">{</span>\n    <span class=\"p\">|</span>                   ------                           ^^^^^^^^^ expected *-ptr, found <span class=\"sb\">`</span><span class=\"o\">()</span><span class=\"sb\">`</span>\n    <span class=\"p\">|</span>                   <span class=\"p\">|</span>\n    <span class=\"p\">|</span>                   implicitly returns <span class=\"sb\">`</span><span class=\"o\">()</span><span class=\"sb\">`</span> as its body has no tail or <span class=\"sb\">`</span><span class=\"k\">return</span><span class=\"sb\">`</span> expression\n    <span class=\"p\">|</span>\n    <span class=\"o\">=</span> note: expected raw pointer <span class=\"sb\">`</span>*const u8<span class=\"sb\">`</span>\n                 found unit <span class=\"nb\">type</span> <span class=\"sb\">`</span><span class=\"o\">()</span><span class=\"sb\">`</span>\n\nerror: aborting due to <span class=\"m\">2</span> previous errors\n\nFor more information about this error, try <span class=\"sb\">`</span>rustc --explain E0308<span class=\"sb\">`</span>.\nerror: could not compile <span class=\"sb\">`</span>wasmtime-runtime<span class=\"sb\">`</span>.\n\nTo learn more, run the <span class=\"nb\">command</span> again with --verbose.\n</code></pre></div>\n\n\n<p>The error comes from this code: <a href=\"https://github.com/bytecodealliance/wasmtime/blob/c9a3f05afd45961b0b397f97c4ad79cd7a7c807d/crates/runtime/src/traphandlers.rs#L156-L174\">https://github.com/bytecodealliance/wasmtime/blob/c9a3f05afd45961b0b397f97c4ad79cd7a7c807d/crates/runtime/src/traphandlers.rs#L156-L174</a></p>\n<p>The reason seems to be that there is no aarch64 <strong>android</strong> case in the code.<br>\nBy doing the following change I am able to compile successfully, but I am unsure if this is a proper fix to the issue.<br>\nThe diff was generated for 5c35a9631cdffc00a32b416f9cb0b80f182b716e.</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"gh\">diff --git a/crates/runtime/src/traphandlers.rs b/crates/runtime/src/traphandlers.rs</span>\n<span class=\"gh\">index 0bd6f2cd1b..198d03a640 100644</span>\n<span class=\"gd\">--- a/crates/runtime/src/traphandlers.rs</span>\n<span class=\"gi\">+++ b/crates/runtime/src/traphandlers.rs</span>\n<span class=\"gu\">@@ -161,7 +161,7 @@ cfg_if::cfg_if! {</span>\n                 } else if #[cfg(all(target_os = &quot;linux&quot;, target_arch = &quot;x86&quot;))] {\n                     let cx = &amp;*(cx as *const libc::ucontext_t);\n                     cx.uc_mcontext.gregs[libc::REG_EIP as usize] as *const u8\n<span class=\"gd\">-                } else if #[cfg(all(target_os = &quot;linux&quot;, target_arch = &quot;aarch64&quot;))] {</span>\n<span class=\"gi\">+                } else if #[cfg(all(any(target_os = &quot;linux&quot;, target_os = &quot;android&quot;), target_arch = &quot;aarch64&quot;))] {</span>\n                     let cx = &amp;*(cx as *const libc::ucontext_t);\n                     cx.uc_mcontext.pc as *const u8\n                 } else if #[cfg(target_os = &quot;macos&quot;)] {\n</code></pre></div>\n\n\n</blockquote>",
        "id": 203370631,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1594290201
    },
    {
        "content": "<p>Rochet2 edited <a href=\"https://github.com/bytecodealliance/wasmtime/issues/1998\">Issue #1998</a>:</p>\n<blockquote>\n<h2>Error</h2>\n<p>When compiling wasmtime for android aarch64, an error occurs:</p>\n<div class=\"codehilite\"><pre><span></span><code>$ cargo +nightly build --target aarch64-linux-android --release\n   Compiling wasmtime-runtime v0.18.0 <span class=\"o\">(</span>/home/local/rimi/Documents/test/wasmtimetest/android_runtime/wasmtime/crates/runtime<span class=\"o\">)</span>\nerror: unsupported platform\n   --&gt; wasmtime/crates/runtime/src/traphandlers.rs:171:21\n    <span class=\"p\">|</span>\n<span class=\"m\">171</span> <span class=\"p\">|</span>                     compile_error!<span class=\"o\">(</span><span class=\"s2\">&quot;unsupported platform&quot;</span><span class=\"o\">)</span><span class=\"p\">;</span>\n    <span class=\"p\">|</span>                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\nerror<span class=\"o\">[</span>E0308<span class=\"o\">]</span>: mismatched types\n   --&gt; wasmtime/crates/runtime/src/traphandlers.rs:156:52\n    <span class=\"p\">|</span>\n<span class=\"m\">156</span> <span class=\"p\">|</span>         unsafe fn get_pc<span class=\"o\">(</span>cx: *mut libc::c_void<span class=\"o\">)</span> -&gt; *const u8 <span class=\"o\">{</span>\n    <span class=\"p\">|</span>                   ------                           ^^^^^^^^^ expected *-ptr, found <span class=\"sb\">`</span><span class=\"o\">()</span><span class=\"sb\">`</span>\n    <span class=\"p\">|</span>                   <span class=\"p\">|</span>\n    <span class=\"p\">|</span>                   implicitly returns <span class=\"sb\">`</span><span class=\"o\">()</span><span class=\"sb\">`</span> as its body has no tail or <span class=\"sb\">`</span><span class=\"k\">return</span><span class=\"sb\">`</span> expression\n    <span class=\"p\">|</span>\n    <span class=\"o\">=</span> note: expected raw pointer <span class=\"sb\">`</span>*const u8<span class=\"sb\">`</span>\n                 found unit <span class=\"nb\">type</span> <span class=\"sb\">`</span><span class=\"o\">()</span><span class=\"sb\">`</span>\n\nerror: aborting due to <span class=\"m\">2</span> previous errors\n\nFor more information about this error, try <span class=\"sb\">`</span>rustc --explain E0308<span class=\"sb\">`</span>.\nerror: could not compile <span class=\"sb\">`</span>wasmtime-runtime<span class=\"sb\">`</span>.\n\nTo learn more, run the <span class=\"nb\">command</span> again with --verbose.\n</code></pre></div>\n\n\n<h2>Problem</h2>\n<p>The error comes from this code: <a href=\"https://github.com/bytecodealliance/wasmtime/blob/c9a3f05afd45961b0b397f97c4ad79cd7a7c807d/crates/runtime/src/traphandlers.rs#L156-L174\">https://github.com/bytecodealliance/wasmtime/blob/c9a3f05afd45961b0b397f97c4ad79cd7a7c807d/crates/runtime/src/traphandlers.rs#L156-L174</a><br>\nThe reason seems to be that there is no aarch64 <strong>android</strong> case in the code.</p>\n<h2>Proposed solution</h2>\n<p>By doing the following change I am able to compile successfully, but I am unsure if this is a proper fix to the issue.<br>\nThe diff was generated for 5c35a9631cdffc00a32b416f9cb0b80f182b716e.</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"gh\">diff --git a/crates/runtime/src/traphandlers.rs b/crates/runtime/src/traphandlers.rs</span>\n<span class=\"gh\">index 0bd6f2cd1b..198d03a640 100644</span>\n<span class=\"gd\">--- a/crates/runtime/src/traphandlers.rs</span>\n<span class=\"gi\">+++ b/crates/runtime/src/traphandlers.rs</span>\n<span class=\"gu\">@@ -161,7 +161,7 @@ cfg_if::cfg_if! {</span>\n                 } else if #[cfg(all(target_os = &quot;linux&quot;, target_arch = &quot;x86&quot;))] {\n                     let cx = &amp;*(cx as *const libc::ucontext_t);\n                     cx.uc_mcontext.gregs[libc::REG_EIP as usize] as *const u8\n<span class=\"gd\">-                } else if #[cfg(all(target_os = &quot;linux&quot;, target_arch = &quot;aarch64&quot;))] {</span>\n<span class=\"gi\">+                } else if #[cfg(all(any(target_os = &quot;linux&quot;, target_os = &quot;android&quot;), target_arch = &quot;aarch64&quot;))] {</span>\n                     let cx = &amp;*(cx as *const libc::ucontext_t);\n                     cx.uc_mcontext.pc as *const u8\n                 } else if #[cfg(target_os = &quot;macos&quot;)] {\n</code></pre></div>\n\n\n</blockquote>",
        "id": 203378130,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1594296968
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/1998#issuecomment-656142161\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/1998\">Issue #1998</a>:</p>\n<blockquote>\n<p>If that patch works for you then it looks right to me too, would you be interested in sending a PR for this?</p>\n</blockquote>",
        "id": 203387682,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1594302890
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/1998#issuecomment-656213987\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/1998\">Issue #1998</a>:</p>\n<blockquote>\n<p>Addressed in <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2002\">https://github.com/bytecodealliance/wasmtime/pull/2002</a></p>\n</blockquote>",
        "id": 203405366,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1594310646
    },
    {
        "content": "<p>alexcrichton closed <a href=\"https://github.com/bytecodealliance/wasmtime/issues/1998\">Issue #1998</a>:</p>\n<blockquote>\n<h2>Error</h2>\n<p>When compiling wasmtime for android aarch64, an error occurs:</p>\n<div class=\"codehilite\"><pre><span></span><code>$ cargo +nightly build --target aarch64-linux-android --release\n   Compiling wasmtime-runtime v0.18.0 <span class=\"o\">(</span>/home/local/rimi/Documents/test/wasmtimetest/android_runtime/wasmtime/crates/runtime<span class=\"o\">)</span>\nerror: unsupported platform\n   --&gt; wasmtime/crates/runtime/src/traphandlers.rs:171:21\n    <span class=\"p\">|</span>\n<span class=\"m\">171</span> <span class=\"p\">|</span>                     compile_error!<span class=\"o\">(</span><span class=\"s2\">&quot;unsupported platform&quot;</span><span class=\"o\">)</span><span class=\"p\">;</span>\n    <span class=\"p\">|</span>                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\nerror<span class=\"o\">[</span>E0308<span class=\"o\">]</span>: mismatched types\n   --&gt; wasmtime/crates/runtime/src/traphandlers.rs:156:52\n    <span class=\"p\">|</span>\n<span class=\"m\">156</span> <span class=\"p\">|</span>         unsafe fn get_pc<span class=\"o\">(</span>cx: *mut libc::c_void<span class=\"o\">)</span> -&gt; *const u8 <span class=\"o\">{</span>\n    <span class=\"p\">|</span>                   ------                           ^^^^^^^^^ expected *-ptr, found <span class=\"sb\">`</span><span class=\"o\">()</span><span class=\"sb\">`</span>\n    <span class=\"p\">|</span>                   <span class=\"p\">|</span>\n    <span class=\"p\">|</span>                   implicitly returns <span class=\"sb\">`</span><span class=\"o\">()</span><span class=\"sb\">`</span> as its body has no tail or <span class=\"sb\">`</span><span class=\"k\">return</span><span class=\"sb\">`</span> expression\n    <span class=\"p\">|</span>\n    <span class=\"o\">=</span> note: expected raw pointer <span class=\"sb\">`</span>*const u8<span class=\"sb\">`</span>\n                 found unit <span class=\"nb\">type</span> <span class=\"sb\">`</span><span class=\"o\">()</span><span class=\"sb\">`</span>\n\nerror: aborting due to <span class=\"m\">2</span> previous errors\n\nFor more information about this error, try <span class=\"sb\">`</span>rustc --explain E0308<span class=\"sb\">`</span>.\nerror: could not compile <span class=\"sb\">`</span>wasmtime-runtime<span class=\"sb\">`</span>.\n\nTo learn more, run the <span class=\"nb\">command</span> again with --verbose.\n</code></pre></div>\n\n\n<h2>Problem</h2>\n<p>The error comes from this code: <a href=\"https://github.com/bytecodealliance/wasmtime/blob/c9a3f05afd45961b0b397f97c4ad79cd7a7c807d/crates/runtime/src/traphandlers.rs#L156-L174\">https://github.com/bytecodealliance/wasmtime/blob/c9a3f05afd45961b0b397f97c4ad79cd7a7c807d/crates/runtime/src/traphandlers.rs#L156-L174</a><br>\nThe reason seems to be that there is no aarch64 <strong>android</strong> case in the code.</p>\n<h2>Proposed solution</h2>\n<p>By doing the following change I am able to compile successfully, but I am unsure if this is a proper fix to the issue.<br>\nThe diff was generated for 5c35a9631cdffc00a32b416f9cb0b80f182b716e.</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"gh\">diff --git a/crates/runtime/src/traphandlers.rs b/crates/runtime/src/traphandlers.rs</span>\n<span class=\"gh\">index 0bd6f2cd1b..198d03a640 100644</span>\n<span class=\"gd\">--- a/crates/runtime/src/traphandlers.rs</span>\n<span class=\"gi\">+++ b/crates/runtime/src/traphandlers.rs</span>\n<span class=\"gu\">@@ -161,7 +161,7 @@ cfg_if::cfg_if! {</span>\n                 } else if #[cfg(all(target_os = &quot;linux&quot;, target_arch = &quot;x86&quot;))] {\n                     let cx = &amp;*(cx as *const libc::ucontext_t);\n                     cx.uc_mcontext.gregs[libc::REG_EIP as usize] as *const u8\n<span class=\"gd\">-                } else if #[cfg(all(target_os = &quot;linux&quot;, target_arch = &quot;aarch64&quot;))] {</span>\n<span class=\"gi\">+                } else if #[cfg(all(any(target_os = &quot;linux&quot;, target_os = &quot;android&quot;), target_arch = &quot;aarch64&quot;))] {</span>\n                     let cx = &amp;*(cx as *const libc::ucontext_t);\n                     cx.uc_mcontext.pc as *const u8\n                 } else if #[cfg(target_os = &quot;macos&quot;)] {\n</code></pre></div>\n\n\n</blockquote>",
        "id": 203405367,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1594310647
    }
]