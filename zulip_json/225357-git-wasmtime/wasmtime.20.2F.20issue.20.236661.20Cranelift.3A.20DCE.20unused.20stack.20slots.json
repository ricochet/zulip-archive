[
    {
        "content": "<p>fitzgen opened <a href=\"https://github.com/bytecodealliance/wasmtime/issues/6661\">issue #6661</a>:</p>\n<blockquote>\n<p>If there are explicit stack slots that are never used (say because of some earlier optimization making it dead) then we will never DCE the stack slot itself, and will always allocate stack space for that slot. This can then lead to code that might otherwise not have been emitted, like stack limit checks and stack probes.</p>\n<p>Example:</p>\n<p><div class=\"codehilite\" data-code-language=\"WebAssembly\"><pre><span></span><code><span class=\"err\">function</span> <span class=\"err\">%f</span><span class=\"p\">(</span><span class=\"kt\">i64</span> <span class=\"err\">vmctx,</span> <span class=\"kt\">i32</span><span class=\"p\">)</span> <span class=\"err\">-&gt;</span> <span class=\"kt\">i32</span> <span class=\"err\">{</span>\n    <span class=\"err\">gv</span><span class=\"mi\">0</span> <span class=\"err\">=</span> <span class=\"err\">vmctx</span>\n    <span class=\"err\">stack_limit</span> <span class=\"err\">=</span> <span class=\"err\">gv</span><span class=\"mi\">0</span>\n\n    <span class=\"c1\">;; Comment out this unused stack slot and we won't allocate any stack space</span>\n    <span class=\"c1\">;; and therefore won't emit any stack-limit checks. Leave it in and we</span>\n    <span class=\"c1\">;; unnecessarily do those things, even though nothing uses this stack slot.</span>\n    <span class=\"err\">ss</span><span class=\"mi\">0</span> <span class=\"err\">=</span> <span class=\"err\">explicit_slot</span> <span class=\"mi\">8</span>\n\n<span class=\"k\">block</span><span class=\"mi\">0</span><span class=\"p\">(</span><span class=\"err\">v</span><span class=\"mi\">0</span><span class=\"err\">:</span> <span class=\"kt\">i64</span><span class=\"err\">,</span> <span class=\"err\">v</span><span class=\"mi\">1</span><span class=\"err\">:</span> <span class=\"kt\">i32</span><span class=\"p\">)</span><span class=\"err\">:</span>\n    <span class=\"nb\">return</span> <span class=\"err\">v</span><span class=\"mi\">1</span>\n<span class=\"err\">}</span>\n</code></pre></div><br>\n</p>\n</blockquote>",
        "id": 370503265,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1687970914
    },
    {
        "content": "<p>fitzgen labeled <a href=\"https://github.com/bytecodealliance/wasmtime/issues/6661\">issue #6661</a>:</p>\n<blockquote>\n<p>If there are explicit stack slots that are never used (say because of some earlier optimization making it dead) then we will never DCE the stack slot itself, and will always allocate stack space for that slot. This can then lead to code that might otherwise not have been emitted, like stack limit checks and stack probes.</p>\n<p>Example:</p>\n<p><div class=\"codehilite\" data-code-language=\"WebAssembly\"><pre><span></span><code><span class=\"err\">function</span> <span class=\"err\">%f</span><span class=\"p\">(</span><span class=\"kt\">i64</span> <span class=\"err\">vmctx,</span> <span class=\"kt\">i32</span><span class=\"p\">)</span> <span class=\"err\">-&gt;</span> <span class=\"kt\">i32</span> <span class=\"err\">{</span>\n    <span class=\"err\">gv</span><span class=\"mi\">0</span> <span class=\"err\">=</span> <span class=\"err\">vmctx</span>\n    <span class=\"err\">stack_limit</span> <span class=\"err\">=</span> <span class=\"err\">gv</span><span class=\"mi\">0</span>\n\n    <span class=\"c1\">;; Comment out this unused stack slot and we won't allocate any stack space</span>\n    <span class=\"c1\">;; and therefore won't emit any stack-limit checks. Leave it in and we</span>\n    <span class=\"c1\">;; unnecessarily do those things, even though nothing uses this stack slot.</span>\n    <span class=\"err\">ss</span><span class=\"mi\">0</span> <span class=\"err\">=</span> <span class=\"err\">explicit_slot</span> <span class=\"mi\">8</span>\n\n<span class=\"k\">block</span><span class=\"mi\">0</span><span class=\"p\">(</span><span class=\"err\">v</span><span class=\"mi\">0</span><span class=\"err\">:</span> <span class=\"kt\">i64</span><span class=\"err\">,</span> <span class=\"err\">v</span><span class=\"mi\">1</span><span class=\"err\">:</span> <span class=\"kt\">i32</span><span class=\"p\">)</span><span class=\"err\">:</span>\n    <span class=\"nb\">return</span> <span class=\"err\">v</span><span class=\"mi\">1</span>\n<span class=\"err\">}</span>\n</code></pre></div><br>\n</p>\n</blockquote>",
        "id": 370503269,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1687970914
    },
    {
        "content": "<p>fitzgen labeled <a href=\"https://github.com/bytecodealliance/wasmtime/issues/6661\">issue #6661</a>:</p>\n<blockquote>\n<p>If there are explicit stack slots that are never used (say because of some earlier optimization making it dead) then we will never DCE the stack slot itself, and will always allocate stack space for that slot. This can then lead to code that might otherwise not have been emitted, like stack limit checks and stack probes.</p>\n<p>Example:</p>\n<p><div class=\"codehilite\" data-code-language=\"WebAssembly\"><pre><span></span><code><span class=\"err\">function</span> <span class=\"err\">%f</span><span class=\"p\">(</span><span class=\"kt\">i64</span> <span class=\"err\">vmctx,</span> <span class=\"kt\">i32</span><span class=\"p\">)</span> <span class=\"err\">-&gt;</span> <span class=\"kt\">i32</span> <span class=\"err\">{</span>\n    <span class=\"err\">gv</span><span class=\"mi\">0</span> <span class=\"err\">=</span> <span class=\"err\">vmctx</span>\n    <span class=\"err\">stack_limit</span> <span class=\"err\">=</span> <span class=\"err\">gv</span><span class=\"mi\">0</span>\n\n    <span class=\"c1\">;; Comment out this unused stack slot and we won't allocate any stack space</span>\n    <span class=\"c1\">;; and therefore won't emit any stack-limit checks. Leave it in and we</span>\n    <span class=\"c1\">;; unnecessarily do those things, even though nothing uses this stack slot.</span>\n    <span class=\"err\">ss</span><span class=\"mi\">0</span> <span class=\"err\">=</span> <span class=\"err\">explicit_slot</span> <span class=\"mi\">8</span>\n\n<span class=\"k\">block</span><span class=\"mi\">0</span><span class=\"p\">(</span><span class=\"err\">v</span><span class=\"mi\">0</span><span class=\"err\">:</span> <span class=\"kt\">i64</span><span class=\"err\">,</span> <span class=\"err\">v</span><span class=\"mi\">1</span><span class=\"err\">:</span> <span class=\"kt\">i32</span><span class=\"p\">)</span><span class=\"err\">:</span>\n    <span class=\"nb\">return</span> <span class=\"err\">v</span><span class=\"mi\">1</span>\n<span class=\"err\">}</span>\n</code></pre></div><br>\n</p>\n</blockquote>",
        "id": 370503270,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1687970914
    },
    {
        "content": "<p>fitzgen <a href=\"https://github.com/bytecodealliance/wasmtime/issues/6661#issuecomment-1611766481\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/6661\">issue #6661</a>:</p>\n<blockquote>\n<p>Note that if we ever fix this, we will have to make various filetests that rely on us not DCEing stack slots actually touch their stack slots so that they continue to test the stack-limit interactions and such things that they are trying to test.</p>\n</blockquote>",
        "id": 370503517,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1687970964
    },
    {
        "content": "<p>bjorn3 <a href=\"https://github.com/bytecodealliance/wasmtime/issues/6661#issuecomment-1611777905\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/6661\">issue #6661</a>:</p>\n<blockquote>\n<p><code>CompiledCode</code> lists all the offsets of all stack slots, thus allowing external code to read and write stack slots. Maybe add a flag to stack slot definitions to indicate that their address is not leaked unless <code>stack_addr</code> explicitly leaks it, and as such are not accessed outside of code inside the function.</p>\n</blockquote>",
        "id": 370506315,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1687971507
    }
]