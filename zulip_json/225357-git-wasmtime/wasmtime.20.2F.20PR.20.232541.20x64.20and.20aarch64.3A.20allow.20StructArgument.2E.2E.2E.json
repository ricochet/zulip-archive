[
    {
        "content": "<p>cfallin opened <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2541\">PR #2541</a> from <code>struct-arg-ret</code> to <code>main</code>:</p>\n<blockquote>\n<p>This PR depends on #2538 and #2539 and includes those commits.</p>\n<p>The StructReturn ABI is fairly simple at the codegen/isel level: we only<br>\nneed to take care to return the sret pointer as one of the return values<br>\nif that wasn't specified in the initial function signature.</p>\n<p>Struct arguments are a little more complex. A struct argument is stored<br>\nas a chunk of memory in the stack-args space. However, the CLIF<br>\nsemantics are slightly special: on the caller side, the parameter passed<br>\nin is a pointer to an arbitrary memory block, and we must memcpy this<br>\ndata to the on-stack struct-argument; and on the callee side, we provide<br>\na pointer to the passed-in struct-argument as the CLIF block param<br>\nvalue.</p>\n<p>This is necessary to support various ABIs other than Wasm, such as that<br>\nof Rust (with the cg_clif codegen backend).<br>\n</p>\n</blockquote>",
        "id": 221493034,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1609741816
    },
    {
        "content": "<p><strong>cfallin</strong> requested <a href=\"https://github.com/bnjbvr\">bnjbvr</a> and <a href=\"https://github.com/julian-seward1\">julian-seward1</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2541\">PR #2541</a>.</p>",
        "id": 221493035,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1609741816
    },
    {
        "content": "<p><strong>cfallin</strong> requested <a href=\"https://github.com/bnjbvr\">bnjbvr</a> and <a href=\"https://github.com/julian-seward1\">julian-seward1</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2541\">PR #2541</a>.</p>",
        "id": 221493036,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1609741816
    },
    {
        "content": "<p>bjorn3 submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2541#pullrequestreview-561262129\">PR Review</a>.</p>",
        "id": 221564716,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1609786558
    },
    {
        "content": "<p>cfallin updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2541\">PR #2541</a> from <code>struct-arg-ret</code> to <code>main</code>:</p>\n<blockquote>\n<p>This PR depends on #2538 and #2539 and includes those commits.</p>\n<p>The StructReturn ABI is fairly simple at the codegen/isel level: we only<br>\nneed to take care to return the sret pointer as one of the return values<br>\nif that wasn't specified in the initial function signature.</p>\n<p>Struct arguments are a little more complex. A struct argument is stored<br>\nas a chunk of memory in the stack-args space. However, the CLIF<br>\nsemantics are slightly special: on the caller side, the parameter passed<br>\nin is a pointer to an arbitrary memory block, and we must memcpy this<br>\ndata to the on-stack struct-argument; and on the callee side, we provide<br>\na pointer to the passed-in struct-argument as the CLIF block param<br>\nvalue.</p>\n<p>This is necessary to support various ABIs other than Wasm, such as that<br>\nof Rust (with the cg_clif codegen backend).<br>\n</p>\n</blockquote>",
        "id": 221579170,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1609793688
    },
    {
        "content": "<p>cfallin updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2541\">PR #2541</a> from <code>struct-arg-ret</code> to <code>main</code>:</p>\n<blockquote>\n<p>This PR depends on #2538 and #2539 and includes those commits.</p>\n<p>The StructReturn ABI is fairly simple at the codegen/isel level: we only<br>\nneed to take care to return the sret pointer as one of the return values<br>\nif that wasn't specified in the initial function signature.</p>\n<p>Struct arguments are a little more complex. A struct argument is stored<br>\nas a chunk of memory in the stack-args space. However, the CLIF<br>\nsemantics are slightly special: on the caller side, the parameter passed<br>\nin is a pointer to an arbitrary memory block, and we must memcpy this<br>\ndata to the on-stack struct-argument; and on the callee side, we provide<br>\na pointer to the passed-in struct-argument as the CLIF block param<br>\nvalue.</p>\n<p>This is necessary to support various ABIs other than Wasm, such as that<br>\nof Rust (with the cg_clif codegen backend).<br>\n</p>\n</blockquote>",
        "id": 221579891,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1609794010
    },
    {
        "content": "<p>cfallin updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2541\">PR #2541</a> from <code>struct-arg-ret</code> to <code>main</code>:</p>\n<blockquote>\n<p>This PR depends on #2538 and #2539 and includes those commits.</p>\n<p>The StructReturn ABI is fairly simple at the codegen/isel level: we only<br>\nneed to take care to return the sret pointer as one of the return values<br>\nif that wasn't specified in the initial function signature.</p>\n<p>Struct arguments are a little more complex. A struct argument is stored<br>\nas a chunk of memory in the stack-args space. However, the CLIF<br>\nsemantics are slightly special: on the caller side, the parameter passed<br>\nin is a pointer to an arbitrary memory block, and we must memcpy this<br>\ndata to the on-stack struct-argument; and on the callee side, we provide<br>\na pointer to the passed-in struct-argument as the CLIF block param<br>\nvalue.</p>\n<p>This is necessary to support various ABIs other than Wasm, such as that<br>\nof Rust (with the cg_clif codegen backend).<br>\n</p>\n</blockquote>",
        "id": 221726396,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1609899009
    },
    {
        "content": "<p>cfallin updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2541\">PR #2541</a> from <code>struct-arg-ret</code> to <code>main</code>:</p>\n<blockquote>\n<p>This PR depends on #2538 and #2539 and includes those commits.</p>\n<p>The StructReturn ABI is fairly simple at the codegen/isel level: we only<br>\nneed to take care to return the sret pointer as one of the return values<br>\nif that wasn't specified in the initial function signature.</p>\n<p>Struct arguments are a little more complex. A struct argument is stored<br>\nas a chunk of memory in the stack-args space. However, the CLIF<br>\nsemantics are slightly special: on the caller side, the parameter passed<br>\nin is a pointer to an arbitrary memory block, and we must memcpy this<br>\ndata to the on-stack struct-argument; and on the callee side, we provide<br>\na pointer to the passed-in struct-argument as the CLIF block param<br>\nvalue.</p>\n<p>This is necessary to support various ABIs other than Wasm, such as that<br>\nof Rust (with the cg_clif codegen backend).<br>\n</p>\n</blockquote>",
        "id": 221800232,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1609956107
    },
    {
        "content": "<p>bnjbvr submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2541#pullrequestreview-566352134\">PR Review</a>.</p>",
        "id": 222448550,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1610466026
    },
    {
        "content": "<p>bnjbvr submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2541#pullrequestreview-566352134\">PR Review</a>.</p>",
        "id": 222448551,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1610466026
    },
    {
        "content": "<p>bnjbvr created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2541#discussion_r555834015\">PR Review Comment</a>:</p>\n<blockquote>\n<p>Could <code>x64::lower::emit_vm_call</code> be hoisted/split in a way that it could be reused, instead of having this specific helper?</p>\n</blockquote>",
        "id": 222448552,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1610466026
    },
    {
        "content": "<p>bnjbvr created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2541#discussion_r555832255\">PR Review Comment</a>:</p>\n<blockquote>\n<p>Is there an implicit invariant on the struct argument's size being a multiple of 8 or 16, so the callee can address it? If so, could we add an explicit assert here?</p>\n</blockquote>",
        "id": 222448553,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1610466026
    },
    {
        "content": "<p>bnjbvr created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2541#discussion_r555836407\">PR Review Comment</a>:</p>\n<blockquote>\n<p>Here we should probably use the <code>emit_vm_call</code>.</p>\n</blockquote>",
        "id": 222448554,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1610466026
    },
    {
        "content": "<p>bnjbvr created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2541#discussion_r555860816\">PR Review Comment</a>:</p>\n<blockquote>\n<p>Is it wanted to a function returning multiple values, the second of which would be a struct return, would trigger the insertion below? (in other words: should this be \"any return is the struct return\")</p>\n</blockquote>",
        "id": 222448555,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1610466026
    },
    {
        "content": "<p>bnjbvr created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2541#discussion_r555842180\">PR Review Comment</a>:</p>\n<blockquote>\n<p>Is the clone necessary here?</p>\n</blockquote>",
        "id": 222448557,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1610466026
    },
    {
        "content": "<p>bnjbvr created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2541#discussion_r555860026\">PR Review Comment</a>:</p>\n<blockquote>\n<p>Since this is a single-purpose legalization enforcing the presence of a StructReturn ret if there's an StructReturn input, how about naming it <code>ensure_struct_return_is_in_out</code>, or something more targeted and precise?</p>\n</blockquote>",
        "id": 222448558,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1610466026
    },
    {
        "content": "<p>bnjbvr created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2541#discussion_r555835769\">PR Review Comment</a>:</p>\n<blockquote>\n<p>Same question about alignment.</p>\n</blockquote>",
        "id": 222448559,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1610466026
    },
    {
        "content": "<p>bnjbvr created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2541#discussion_r555861721\">PR Review Comment</a>:</p>\n<blockquote>\n<p>light suggestion: could we use a newtype here (and below, where this comment is also repeated), explaining what the normalization is about?</p>\n</blockquote>",
        "id": 222448560,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1610466026
    },
    {
        "content": "<p>bnjbvr created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2541#discussion_r555867299\">PR Review Comment</a>:</p>\n<blockquote>\n<p>Can you add a comment referring to the <code>legalize_signature</code> function (or whatever is its new name), saying that it ensured its first <code>retval</code> register <em>is</em> the struct return value?</p>\n<p>Also... would this unnecessarily add spill pressure for the entire function's lifetime to do it here (since one more register is blocked), instead of doing in the retval setup function?</p>\n</blockquote>",
        "id": 222448561,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1610466026
    },
    {
        "content": "<p>bnjbvr created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2541#discussion_r555863871\">PR Review Comment</a>:</p>\n<blockquote>\n<p>There may be at most one struct arg, so we could break after this. There's even an <code>index</code> function we can use on <code>iter()</code> that would allow this to be a one-liner I think.</p>\n</blockquote>",
        "id": 222448563,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1610466026
    },
    {
        "content": "<p>bjorn3 submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2541#pullrequestreview-566409901\">PR Review</a>.</p>",
        "id": 222449716,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1610466477
    },
    {
        "content": "<p>bjorn3 created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2541#discussion_r555875059\">PR Review Comment</a>:</p>\n<blockquote>\n<p>Such an invariant shouldn't exist. Or at least cg_clif doesn't honour it. Maybe the abi requires it, in which case it would be nice to automatically add padding.</p>\n</blockquote>",
        "id": 222449717,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1610466477
    },
    {
        "content": "<p>bjorn3 submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2541#pullrequestreview-566412017\">PR Review</a>.</p>",
        "id": 222450041,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1610466601
    },
    {
        "content": "<p>bjorn3 created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2541#discussion_r555876672\">PR Review Comment</a>:</p>\n<blockquote>\n<p>It is important that the stack space for the outgoing arguments is not clobbered other than the stack space for the argument this should write. Using <code>emit_vm_call</code> makes it much harder to prevent accidentally doing this I think.</p>\n</blockquote>",
        "id": 222450042,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1610466602
    },
    {
        "content": "<p>cfallin updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2541\">PR #2541</a> from <code>struct-arg-ret</code> to <code>main</code>:</p>\n<blockquote>\n<p>This PR depends on #2538 and #2539 and includes those commits.</p>\n<p>The StructReturn ABI is fairly simple at the codegen/isel level: we only<br>\nneed to take care to return the sret pointer as one of the return values<br>\nif that wasn't specified in the initial function signature.</p>\n<p>Struct arguments are a little more complex. A struct argument is stored<br>\nas a chunk of memory in the stack-args space. However, the CLIF<br>\nsemantics are slightly special: on the caller side, the parameter passed<br>\nin is a pointer to an arbitrary memory block, and we must memcpy this<br>\ndata to the on-stack struct-argument; and on the callee side, we provide<br>\na pointer to the passed-in struct-argument as the CLIF block param<br>\nvalue.</p>\n<p>This is necessary to support various ABIs other than Wasm, such as that<br>\nof Rust (with the cg_clif codegen backend).<br>\n</p>\n</blockquote>",
        "id": 222803335,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1610669222
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2541#pullrequestreview-568725117\">PR Review</a>.</p>",
        "id": 222803341,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1610669226
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2541#discussion_r557779038\">PR Review Comment</a>:</p>\n<blockquote>\n<p>Good point; actually it could be <em>not</em> the first return value, so I've changed this to be more general and just find the StructReturn one (panic'ing if not present).</p>\n<p>Re: register pressure, yes, possibly, though we're basically passing a value through from an arg to a return value so we either have to keep it in a vreg (note that <code>retval_regs</code> is filled with vregs; the move to rax happens in the epilogue) or create a pseudo-spill-slot ourselves to save it; we can't recompute it later. So I don't think we can do better than this given the ABI, sadly...</p>\n</blockquote>",
        "id": 222803343,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1610669226
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2541#pullrequestreview-568725142\">PR Review</a>.</p>",
        "id": 222803346,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1610669228
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2541#discussion_r557779059\">PR Review Comment</a>:</p>\n<blockquote>\n<p>I think there may be more than one struct arg? Struct return, yes, only one (unless we have multi-value with structs someday); but an arbitrary subset of the args may be struct types, I think.</p>\n</blockquote>",
        "id": 222803347,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1610669229
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2541#pullrequestreview-568725161\">PR Review</a>.</p>",
        "id": 222803349,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1610669231
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2541#discussion_r557779081\">PR Review Comment</a>:</p>\n<blockquote>\n<p>I considered this, but we mostly just hold onto it to return it back through the ABI trait, at which point we strip off the newtype wrapper anyway, so it didn't seem to add very much; happy to propagate it upward if you think that's best though!</p>\n</blockquote>",
        "id": 222803350,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1610669231
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2541#pullrequestreview-568725208\">PR Review</a>.</p>",
        "id": 222803354,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1610669237
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2541#discussion_r557779111\">PR Review Comment</a>:</p>\n<blockquote>\n<p>Fixed -- it should match any return value's purpose.</p>\n</blockquote>",
        "id": 222803355,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1610669237
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2541#discussion_r557779142\">PR Review Comment</a>:</p>\n<blockquote>\n<p>Done!</p>\n</blockquote>",
        "id": 222803362,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1610669244
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2541#pullrequestreview-568725250\">PR Review</a>.</p>",
        "id": 222803364,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1610669244
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2541#pullrequestreview-568725278\">PR Review</a>.</p>",
        "id": 222803369,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1610669249
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2541#discussion_r557779168\">PR Review Comment</a>:</p>\n<blockquote>\n<p>Unfortunately yes, otherwise this holds an immutable borrow on <code>vcode</code> for the duration of the loop while we also pass in <code>&amp;mut vcode</code> to <code>alloc_vregs()</code> below. I considered turning some subset of the vcode inside-out somehow to work around this but it didn't seem worth it...</p>\n</blockquote>",
        "id": 222803370,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1610669249
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2541#discussion_r557779276\">PR Review Comment</a>:</p>\n<blockquote>\n<p>Resolved as above :-)</p>\n</blockquote>",
        "id": 222803378,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1610669264
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2541#pullrequestreview-568725382\">PR Review</a>.</p>",
        "id": 222803379,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1610669264
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2541#pullrequestreview-568725411\">PR Review</a>.</p>",
        "id": 222803385,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1610669269
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2541#discussion_r557779325\">PR Review Comment</a>:</p>\n<blockquote>\n<p>My reading of the <a href=\"https://github.com/ARM-software/abi-aa/blob/master/aapcs64/aapcs64.rst#parameter-passing-rules\">aarch64 spec</a> is that on-stack args have 8-byte-aligned sizes; as far as I can tell the <a href=\"https://www.uclibc.org/docs/psABI-x86_64.pdf\">x64 SystemV spec</a> also shows on-stack args broken down into \"eightbytes\". I've added an align-to-8 assert for both architectures.</p>\n</blockquote>",
        "id": 222803386,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1610669269
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2541#pullrequestreview-568725447\">PR Review</a>.</p>",
        "id": 222803394,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1610669275
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2541#discussion_r557779379\">PR Review Comment</a>:</p>\n<blockquote>\n<p>Yep, we need to be careful in exactly how we set up args and emit this call here, so I think it's best to open-code it.</p>\n</blockquote>",
        "id": 222803395,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1610669275
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2541#pullrequestreview-568727593\">PR Review</a>.</p>",
        "id": 222803727,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1610669626
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2541#discussion_r557781262\">PR Review Comment</a>:</p>\n<blockquote>\n<p>So I started down this path, but pulling on the string actually unravels a <em>lot</em> of things -- <code>emit_vm_call</code> takes a LowerCtx and emits directly, which we need to do because the caller-side ABI object that it uses requires this; but <code>gen_memcpy()</code> returns a list of instructions because we cannot parameterize on the <code>LowerCtx</code> in the callee-side ABI object, because it is used as a dyn trait. This is slightly unfortunate, to say the least. If you think it will be a problem in practice then I can do this, but it requires altering the caller-side stuff to use more Vecs. In practice I <em>think</em> this will be OK because: struct args will only show up in SystemV and Fastcall cases; in both cases we can handle three register args; no stack adjustment or other ABI stuff should be necessary. Thoughts?</p>\n</blockquote>",
        "id": 222803728,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1610669626
    },
    {
        "content": "<p>bnjbvr submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2541#pullrequestreview-569244873\">PR Review</a>.</p>",
        "id": 222854683,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1610716214
    },
    {
        "content": "<p>bnjbvr created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2541#discussion_r558296082\">PR Review Comment</a>:</p>\n<blockquote>\n<p>Ah, didn't see the LowerCtx trait coming! Okay, I'm convinced that this shouldn't be a problem for Fastcall too, so we can keep this code like this. If there's a <code>call_conv</code> hanging around, could we assert it's either equal to <code>SystemV</code> or <code>Fastcall</code>, just for future-proofing?</p>\n</blockquote>",
        "id": 222854684,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1610716214
    },
    {
        "content": "<p>bnjbvr submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2541#pullrequestreview-569246094\">PR Review</a>.</p>",
        "id": 222854864,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1610716326
    },
    {
        "content": "<p>bnjbvr created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2541#discussion_r558297002\">PR Review Comment</a>:</p>\n<blockquote>\n<p>I was looking for a way to document a bit better what this signature is about, and when it should be used in place of the Function's signature field. The newtype would make it semi-obvious, but it could be sufficient with a good comment here/on the getter too. Let's keep it as is.</p>\n</blockquote>",
        "id": 222854867,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1610716326
    },
    {
        "content": "<p>bnjbvr submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2541#pullrequestreview-569247015\">PR Review</a>.</p>",
        "id": 222854986,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1610716408
    },
    {
        "content": "<p>bnjbvr created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2541#discussion_r558297684\">PR Review Comment</a>:</p>\n<blockquote>\n<blockquote>\n<p>Good point; actually it could be not the first return value, so I've changed this to be more general and just find the StructReturn one (panic'ing if not present).</p>\n</blockquote>\n<p>Is there a test for this? (and if there's not, can you add one please?)</p>\n</blockquote>",
        "id": 222854987,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1610716408
    },
    {
        "content": "<p>bnjbvr submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2541#pullrequestreview-569263859\">PR Review</a>.</p>",
        "id": 222863418,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1610720743
    },
    {
        "content": "<p>bnjbvr submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2541#pullrequestreview-569263859\">PR Review</a>.</p>",
        "id": 222863419,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1610720743
    },
    {
        "content": "<p>bnjbvr created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2541#discussion_r558310519\">PR Review Comment</a>:</p>\n<blockquote>\n<p>uber-nit: <code>unimplemented!</code> or <code>todo!</code> here?</p>\n</blockquote>",
        "id": 222863420,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1610720743
    },
    {
        "content": "<p>bnjbvr created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2541#discussion_r558314642\">PR Review Comment</a>:</p>\n<blockquote>\n<p>nit: It really could be any pointer-typed temporary vreg here, right? This is only used to store the callee address, not an argument per se. It would require changing the signature of this function for a new temporary register. If your intent was to use one register, that happens to be fixed (because it's simpler than passing the temp) but while making sure it was unused by the other three, maybe rename the variable and add a comment here?</p>\n</blockquote>",
        "id": 222863421,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1610720743
    },
    {
        "content": "<p>bnjbvr created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2541#discussion_r558337592\">PR Review Comment</a>:</p>\n<blockquote>\n<p>Can you add a test case with a call to a function that has two struct arguments, located at different offsets, please?</p>\n</blockquote>",
        "id": 222863422,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1610720743
    },
    {
        "content": "<p>bnjbvr created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2541#discussion_r558339560\">PR Review Comment</a>:</p>\n<blockquote>\n<p>Just saw this TODO question: for the calling convention, there's actually <code>CallConv::for_libcall</code>. For the rest of the signature, we should assert in the <code>gen_memcpy</code> impl that the calling convention is one of a few known (e.g., not any of the <code>Baldrdash</code> ones).</p>\n</blockquote>",
        "id": 222863423,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1610720743
    },
    {
        "content": "<p>bnjbvr created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2541#discussion_r558317671\">PR Review Comment</a>:</p>\n<blockquote>\n<p>Is there, like on x64, some helper we could use to abstract \"the first register argument\", etc.?</p>\n</blockquote>",
        "id": 222863424,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1610720743
    },
    {
        "content": "<p>bnjbvr created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2541#discussion_r558312458\">PR Review Comment</a>:</p>\n<blockquote>\n<p>(Looks like <code>get_intreg_for_arg_system</code> will check for the calling convention, so we should be fine!)</p>\n</blockquote>",
        "id": 222863425,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1610720743
    },
    {
        "content": "<p>cfallin updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2541\">PR #2541</a> from <code>struct-arg-ret</code> to <code>main</code>:</p>\n<blockquote>\n<p>This PR depends on #2538 and #2539 and includes those commits.</p>\n<p>The StructReturn ABI is fairly simple at the codegen/isel level: we only<br>\nneed to take care to return the sret pointer as one of the return values<br>\nif that wasn't specified in the initial function signature.</p>\n<p>Struct arguments are a little more complex. A struct argument is stored<br>\nas a chunk of memory in the stack-args space. However, the CLIF<br>\nsemantics are slightly special: on the caller side, the parameter passed<br>\nin is a pointer to an arbitrary memory block, and we must memcpy this<br>\ndata to the on-stack struct-argument; and on the callee side, we provide<br>\na pointer to the passed-in struct-argument as the CLIF block param<br>\nvalue.</p>\n<p>This is necessary to support various ABIs other than Wasm, such as that<br>\nof Rust (with the cg_clif codegen backend).<br>\n</p>\n</blockquote>",
        "id": 223087212,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1610953947
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2541#pullrequestreview-570216707\">PR Review</a>.</p>",
        "id": 223087231,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1610953965
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2541#discussion_r559354768\">PR Review Comment</a>:</p>\n<blockquote>\n<p>Ah, that's more canonical, yes. Updated this and added asserts in x64/aarch64 <code>gen_memcpy()</code> that we aren't using a Baldrdash calling convention -- we should never be seeing struct args there anyway.</p>\n</blockquote>",
        "id": 223087232,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1610953965
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2541#pullrequestreview-570216746\">PR Review</a>.</p>",
        "id": 223087234,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1610953971
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2541#discussion_r559354796\">PR Review Comment</a>:</p>\n<blockquote>\n<p>Done!</p>\n</blockquote>",
        "id": 223087235,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1610953971
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2541#pullrequestreview-570216768\">PR Review</a>.</p>",
        "id": 223087239,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1610953975
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2541#discussion_r559354811\">PR Review Comment</a>:</p>\n<blockquote>\n<p>The aarch64 ABI impl is a bit simpler in this regard (because arg <code>i</code> is in X-reg <code>i</code>), so no helper is defined, but I've created named <code>let</code>-bindings to make this a bit clearer.</p>\n</blockquote>",
        "id": 223087240,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1610953975
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2541#pullrequestreview-570216813\">PR Review</a>.</p>",
        "id": 223087245,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1610953980
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2541#discussion_r559354837\">PR Review Comment</a>:</p>\n<blockquote>\n<p>Done!</p>\n</blockquote>",
        "id": 223087246,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1610953980
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2541#pullrequestreview-570216848\">PR Review</a>.</p>",
        "id": 223087256,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1610953984
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2541#discussion_r559354861\">PR Review Comment</a>:</p>\n<blockquote>\n<p>Done!</p>\n</blockquote>",
        "id": 223087257,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1610953984
    },
    {
        "content": "<p>cfallin merged <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2541\">PR #2541</a>.</p>",
        "id": 223089230,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1610956221
    }
]