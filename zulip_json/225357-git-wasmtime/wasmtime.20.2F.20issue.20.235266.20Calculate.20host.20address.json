[
    {
        "content": "<p>alexthomas1 edited <a href=\"https://github.com/bytecodealliance/wasmtime/issues/5266\">issue #5266</a>:</p>\n<blockquote>\n<p>I am trying to calculate the host address and I found a similar issue: #2547</p>\n<p>However, it seems like <code>wasmtime_linker_instantiate</code> takes in type <code>wasmtime_instance_t</code>, but this isn't compatible with <code>wasm_instance_exports</code>. Is there an updated way to get the base pointer of a module using linker? Thank you.</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">wasm_instance_t</span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">wasm_instance</span><span class=\"p\">;</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">error</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">wasmtime_linker_instantiate</span><span class=\"p\">(</span><span class=\"n\">linker</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">module</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">wasm_instance</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">trap</span><span class=\"p\">);</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">error</span><span class=\"w\"> </span><span class=\"o\">!=</span><span class=\"w\"> </span><span class=\"n\">NULL</span><span class=\"w\"> </span><span class=\"o\">||</span><span class=\"w\"> </span><span class=\"n\">trap</span><span class=\"w\"> </span><span class=\"o\">!=</span><span class=\"w\"> </span><span class=\"n\">NULL</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"n\">printf</span><span class=\"p\">(</span><span class=\"s\">\"Failed to instantiate </span><span class=\"se\">\\n</span><span class=\"s\">\"</span><span class=\"p\">);</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"n\">exit</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">);</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">}</span><span class=\"w\"></span>\n\n<span class=\"n\">wasm_extern_vec_t</span><span class=\"w\"> </span><span class=\"n\">exports</span><span class=\"p\">;</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">wasm_instance_exports</span><span class=\"p\">(</span><span class=\"n\">wasm_instance</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">exports</span><span class=\"p\">);</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">size_t</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">g_memory</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">get_export_memory</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"n\">exports</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">++</span><span class=\"p\">);</span><span class=\"w\"></span>\n\n<span class=\"w\">    </span><span class=\"c1\">// Run it.</span>\n<span class=\"w\">    </span><span class=\"n\">wasm_func_t</span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">func</span><span class=\"p\">;</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">wasmtime_linker_get_default</span><span class=\"p\">(</span><span class=\"n\">linker</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">empty</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">func</span><span class=\"p\">);</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">error</span><span class=\"w\"> </span><span class=\"o\">!=</span><span class=\"w\"> </span><span class=\"n\">NULL</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"n\">exit_with_error</span><span class=\"p\">(</span><span class=\"s\">\"failed to locate default export for module\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">NULL</span><span class=\"p\">);</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">error</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">wasmtime_func_call</span><span class=\"p\">(</span><span class=\"n\">func</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">NULL</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">NULL</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">trap</span><span class=\"p\">);</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">error</span><span class=\"w\"> </span><span class=\"o\">!=</span><span class=\"w\"> </span><span class=\"n\">NULL</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"n\">exit_with_error</span><span class=\"p\">(</span><span class=\"s\">\"error calling default export\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">trap</span><span class=\"p\">);</span><span class=\"w\"></span>\n</code></pre></div>\n</blockquote>",
        "id": 310110278,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1668472765
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/5266#issuecomment-1315445651\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/5266\">issue #5266</a>:</p>\n<blockquote>\n<p>The <code>wasm_instance_t</code> and <code>wasmtime_instance_t</code> types are not compatible and can't be used with one another. The above code in theory should give you a warning from your C compiler which you'll need to fix. Using the <code>wasmtime/*.h</code> family of headers you can extract the memory export and base pointer of memory.</p>\n</blockquote>",
        "id": 310221012,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1668524885
    },
    {
        "content": "<p>alexthomas1 <a href=\"https://github.com/bytecodealliance/wasmtime/issues/5266#issuecomment-1315969877\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/5266\">issue #5266</a>:</p>\n<blockquote>\n<p>Any specific functions I should look at? Or any examples  I can take a look for a more up to date version of getting the base pointer?</p>\n</blockquote>",
        "id": 310307447,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1668552487
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/5266#issuecomment-1317176435\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/5266\">issue #5266</a>:</p>\n<blockquote>\n<p>I would recommend reading <a href=\"https://github.com/bytecodealliance/wasmtime/blob/main/examples/memory.c\">this example</a></p>\n</blockquote>",
        "id": 310431668,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1668611564
    },
    {
        "content": "<p>alexcrichton closed <a href=\"https://github.com/bytecodealliance/wasmtime/issues/5266\">issue #5266</a>:</p>\n<blockquote>\n<p>I am trying to calculate the host address and I found a similar issue: #2547</p>\n<p>However, it seems like <code>wasmtime_linker_instantiate</code> takes in type <code>wasmtime_instance_t</code>, but this isn't compatible with <code>wasm_instance_exports</code>. Is there an updated way to get the base pointer of a module using linker? Thank you.</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">wasm_instance_t</span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">wasm_instance</span><span class=\"p\">;</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">error</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">wasmtime_linker_instantiate</span><span class=\"p\">(</span><span class=\"n\">linker</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">module</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">wasm_instance</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">trap</span><span class=\"p\">);</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">error</span><span class=\"w\"> </span><span class=\"o\">!=</span><span class=\"w\"> </span><span class=\"n\">NULL</span><span class=\"w\"> </span><span class=\"o\">||</span><span class=\"w\"> </span><span class=\"n\">trap</span><span class=\"w\"> </span><span class=\"o\">!=</span><span class=\"w\"> </span><span class=\"n\">NULL</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"n\">printf</span><span class=\"p\">(</span><span class=\"s\">\"Failed to instantiate </span><span class=\"se\">\\n</span><span class=\"s\">\"</span><span class=\"p\">);</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"n\">exit</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">);</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">}</span><span class=\"w\"></span>\n\n<span class=\"n\">wasm_extern_vec_t</span><span class=\"w\"> </span><span class=\"n\">exports</span><span class=\"p\">;</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">wasm_instance_exports</span><span class=\"p\">(</span><span class=\"n\">wasm_instance</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">exports</span><span class=\"p\">);</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">size_t</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">g_memory</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">get_export_memory</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"n\">exports</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">++</span><span class=\"p\">);</span><span class=\"w\"></span>\n\n<span class=\"w\">    </span><span class=\"c1\">// Run it.</span>\n<span class=\"w\">    </span><span class=\"n\">wasm_func_t</span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">func</span><span class=\"p\">;</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">wasmtime_linker_get_default</span><span class=\"p\">(</span><span class=\"n\">linker</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">empty</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">func</span><span class=\"p\">);</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">error</span><span class=\"w\"> </span><span class=\"o\">!=</span><span class=\"w\"> </span><span class=\"n\">NULL</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"n\">exit_with_error</span><span class=\"p\">(</span><span class=\"s\">\"failed to locate default export for module\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">NULL</span><span class=\"p\">);</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">error</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">wasmtime_func_call</span><span class=\"p\">(</span><span class=\"n\">func</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">NULL</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">NULL</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">trap</span><span class=\"p\">);</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">error</span><span class=\"w\"> </span><span class=\"o\">!=</span><span class=\"w\"> </span><span class=\"n\">NULL</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"n\">exit_with_error</span><span class=\"p\">(</span><span class=\"s\">\"error calling default export\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">trap</span><span class=\"p\">);</span><span class=\"w\"></span>\n</code></pre></div>\n</blockquote>",
        "id": 311702413,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1669148708
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/5266#issuecomment-1324200761\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/5266\">issue #5266</a>:</p>\n<blockquote>\n<p>I'm going to close this but if you still have any questions feel free to post them here as well.</p>\n</blockquote>",
        "id": 311702414,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1669148708
    }
]