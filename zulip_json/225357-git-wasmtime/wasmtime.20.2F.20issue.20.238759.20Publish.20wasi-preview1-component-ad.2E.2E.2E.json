[
    {
        "content": "<p>juntyr opened <a href=\"https://github.com/bytecodealliance/wasmtime/issues/8759\">issue #8759</a>:</p>\n<blockquote>\n<h4>Feature</h4>\n<p>It would be great if wasi-preview1-component-adapter was published to <a href=\"http://crates.io\">crates.io</a>, either directly, or using a wrapper crate that exposes the prebuilt (either before publishing or as part of this crate's build process) adapter WASM file. Note that if the crate is just published as-is, the latter can also be done by users themselves.</p>\n<h4>Benefit</h4>\n<p>I am building several WASM components in my crate. This is currently orchestrated by a build script, which builds the WASM module crates and then adapts them to components using the wit-component crate and the wasi-preview1-component-adapter WASM file. This adapter is currently downloaded in the build script from wasmtime's release page. A manual download like this is a quite unrusty approach and would fail inside a network-isolated build script. Being able to build the WASM adapter directly in my build graph would solve this problem.</p>\n<h4>Implementation</h4>\n<p>The <a href=\"https://crates.io/crates/wasi-preview1-component-adapter\">https://crates.io/crates/wasi-preview1-component-adapter</a> crate name has already been reserved, so starting with the next wasmtime release, the wasi-preview1-component-adapter crate could be published as-is to <a href=\"http://crates.io\">crates.io</a> just like the other crates.</p>\n<h4>Alternatives</h4>\n<p>Publishing the pre-built WASM file, e.g. embedded in the source of a crate, would remove the complexity of building the WASM file from end-users and allow everyone to depend on exactly the same binary WASM file. However, it would require an extra wrapper crate.<br>\n</p>\n</blockquote>",
        "id": 443426865,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1717824167
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/8759#issuecomment-2158562717\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/8759\">issue #8759</a>:</p>\n<blockquote>\n<p>The adapters are unfortunately sort of nontrivial to build, for example <a href=\"https://github.com/bytecodealliance/wasmtime/blob/af59c4d568d487b7efbb49d7d31a861e7c3933a6/Cargo.toml#L457-L478\">these configuration settings are required</a>. The <a href=\"https://github.com/bytecodealliance/wasmtime/blob/main/ci/build-wasi-preview1-component-adapter.sh\">build script</a> also has checks to verify that the adapter is a valid adapter (e.g. no <code>data</code> sections). It's possible to publish the crate as-is but I'd fear that it might not help your building situation. Is this a case where vendoring the binary could perhaps be done? That's probably the easiest way to depend on the adapter.</p>\n</blockquote>",
        "id": 443787308,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1718030685
    },
    {
        "content": "<p>juntyr <a href=\"https://github.com/bytecodealliance/wasmtime/issues/8759#issuecomment-2158597890\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/8759\">issue #8759</a>:</p>\n<blockquote>\n<p>Thank you for your reply @alexcrichton and for always taking the time to help me :)</p>\n<p>I’d been aware of the complex build script but not yet of the config. If I would need to replicate those in my own workspace Cargo.toml, then I agree that that would defeat part of the advantage of integrating the adapter directly into my build.</p>\n<p>At the moment, I have a build script which downloads the adapter from the releases page and then builds several other crates as WASM modules (and then turns them into components). Directly embedding the binary into my repo would work to solve the build isolation issue but would make maintenance a bit harder and my repo a bit more bloated. I think that would be ok temporarily.</p>\n<p>What about the idea of creating a wrapper crate that exports the adapter as a byte string? The crate could be built just after the adapter in CI and then published to <a href=\"http://crates.io\">crates.io</a>. That way tools that currently require the adapter to be downloaded could depend on this crate as well.</p>\n<p>If that’s a possible path forward, I’d happily write up a PR for it.</p>\n<p>Thanks again for your help!</p>\n</blockquote>",
        "id": 443790460,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1718031573
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/8759#issuecomment-2158661094\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/8759\">issue #8759</a>:</p>\n<blockquote>\n<p>I do think something like that could work yeah. I'm not sure how best to architect it though. Publishing crates with generated files as part of the publish I've found historically is not an easy task unless all the generated files are additionally checked in to the repository. Basically Cargo doesn't provide an easy way to manage all this, so the other alternative is lots of CI logic to paper over it which can get quite hairy from a maintenance perspective.</p>\n<p>Despite that though I can think of a few other possible consumers for a crates.io-based version of the compiled adapters, so it would indeed be really nice to have. The lowest-overhead solution is to probably check the adapters into the repository and check on CI that the adapters haven't changed. That has its own downsides of requiring a fixed toolchain but given that most developers aren't changing the adapter when contributing the Wasmtime it's not the end of the world.</p>\n</blockquote>",
        "id": 443798427,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1718033281
    },
    {
        "content": "<p>alexcrichton closed <a href=\"https://github.com/bytecodealliance/wasmtime/issues/8759\">issue #8759</a>:</p>\n<blockquote>\n<h4>Feature</h4>\n<p>It would be great if wasi-preview1-component-adapter was published to <a href=\"http://crates.io\">crates.io</a>, either directly, or using a wrapper crate that exposes the prebuilt (either before publishing or as part of this crate's build process) adapter WASM file. Note that if the crate is just published as-is, the latter can also be done by users themselves.</p>\n<h4>Benefit</h4>\n<p>I am building several WASM components in my crate. This is currently orchestrated by a build script, which builds the WASM module crates and then adapts them to components using the wit-component crate and the wasi-preview1-component-adapter WASM file. This adapter is currently downloaded in the build script from wasmtime's release page. A manual download like this is a quite unrusty approach and would fail inside a network-isolated build script. Being able to build the WASM adapter directly in my build graph would solve this problem.</p>\n<h4>Implementation</h4>\n<p>The <a href=\"https://crates.io/crates/wasi-preview1-component-adapter\">https://crates.io/crates/wasi-preview1-component-adapter</a> crate name has already been reserved, so starting with the next wasmtime release, the wasi-preview1-component-adapter crate could be published as-is to <a href=\"http://crates.io\">crates.io</a> just like the other crates.</p>\n<h4>Alternatives</h4>\n<p>Publishing the pre-built WASM file, e.g. embedded in the source of a crate, would remove the complexity of building the WASM file from end-users and allow everyone to depend on exactly the same binary WASM file. However, it would require an extra wrapper crate.<br>\n</p>\n</blockquote>",
        "id": 445397837,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1718726086
    }
]