[
    {
        "content": "<p>nivkner <a href=\"https://github.com/bytecodealliance/wasmtime/pull/4953#issuecomment-1266486802\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/4953\">issue #4953</a>:</p>\n<blockquote>\n<p>tested using <code>cranelift-tools</code> with the following <code>clif</code> code:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">target</span><span class=\"w\"> </span><span class=\"n\">x86_64</span><span class=\"w\"></span>\n\n<span class=\"n\">function</span><span class=\"w\"> </span><span class=\"n\">u0</span>:<span class=\"mi\">359</span><span class=\"p\">(</span><span class=\"kt\">i64</span><span class=\"p\">)</span><span class=\"w\"> </span>-&gt; <span class=\"kt\">i8</span> <span class=\"nc\">system_v</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n\n<span class=\"w\">    </span><span class=\"n\">ss0</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">explicit_slot</span><span class=\"w\"> </span><span class=\"mi\">16</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">sig0</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"kt\">i64</span><span class=\"p\">)</span><span class=\"w\"> </span>-&gt; <span class=\"kt\">i8</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">i8</span><span class=\"w\"> </span><span class=\"n\">system_v</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">fn0</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">colocated</span><span class=\"w\"> </span><span class=\"n\">u0</span>:<span class=\"mi\">521</span><span class=\"w\"> </span><span class=\"n\">sig0</span><span class=\"w\"></span>\n\n<span class=\"w\">    </span><span class=\"n\">block0</span><span class=\"p\">(</span><span class=\"n\">v0</span>: <span class=\"kt\">i64</span><span class=\"p\">)</span>:\n    <span class=\"nc\">v3</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v4</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">call</span><span class=\"w\"> </span><span class=\"n\">fn0</span><span class=\"p\">(</span><span class=\"n\">v0</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">v3</span><span class=\"w\"></span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n</code></pre></div>\n<p>when calling</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">target</span><span class=\"o\">/</span><span class=\"n\">debug</span><span class=\"o\">/</span><span class=\"n\">clif</span><span class=\"o\">-</span><span class=\"n\">util</span><span class=\"w\"> </span><span class=\"n\">compile</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">set</span><span class=\"w\"> </span><span class=\"n\">use_egraphs</span><span class=\"o\">=</span><span class=\"kc\">false</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">target</span><span class=\"w\"> </span><span class=\"n\">x86_64</span><span class=\"o\">-</span><span class=\"n\">unknown</span><span class=\"o\">-</span><span class=\"n\">linux</span><span class=\"o\">-</span><span class=\"n\">gnu</span><span class=\"w\"> </span><span class=\"n\">example</span><span class=\"p\">.</span><span class=\"n\">clif</span><span class=\"w\"></span>\n</code></pre></div>\n<p>the code compiles with out error.</p>\n<p>when setting <code>--set use_egraphs=true</code><br>\nthe following error is produced:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">thread</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"na\">main</span><span class=\"o\">'</span><span class=\"w\"> </span><span class=\"n\">panicked</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"na\">enode</span><span class=\"w\"> </span><span class=\"n\">depends</span><span class=\"w\"> </span><span class=\"n\">directly</span><span class=\"w\"> </span><span class=\"n\">on</span><span class=\"w\"> </span><span class=\"n\">multi</span><span class=\"o\">-</span><span class=\"n\">value</span><span class=\"w\"> </span><span class=\"n\">result</span><span class=\"o\">'</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">cranelift</span><span class=\"o\">/</span><span class=\"n\">codegen</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">egraph</span><span class=\"o\">/</span><span class=\"n\">elaborate</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">396</span>:<span class=\"mi\">33</span><span class=\"w\"></span>\n</code></pre></div>\n<p>&lt;details&gt;<br>\n  &lt;summary&gt;backtrace&lt;/summary&gt;</p>\n<p><code>\nstack backtrace:\n   0: rust_begin_unwind\n             at /rustc/a55dd71d5fb0ec5a6a3a9e8c27b2127ba491ce52/library/std/src/panicking.rs:584:5\n   1: core::panicking::panic_fmt\n             at /rustc/a55dd71d5fb0ec5a6a3a9e8c27b2127ba491ce52/library/core/src/panicking.rs:142:14\n   2: cranelift_codegen::egraph::elaborate::Elaborator::process_elab_stack::{{closure}}\n             at ./cranelift/codegen/src/egraph/elaborate.rs:396:33\n   3: core::ops::function::impls::&lt;impl core::ops::function::FnOnce&lt;A&gt; for &amp;mut F&gt;::call_once\n             at /rustc/a55dd71d5fb0ec5a6a3a9e8c27b2127ba491ce52/library/core/src/ops/function.rs:301:13\n   4: core::option::Option&lt;T&gt;::map\n             at /rustc/a55dd71d5fb0ec5a6a3a9e8c27b2127ba491ce52/library/core/src/option.rs:929:29\n   5: &lt;core::iter::adapters::map::Map&lt;I,F&gt; as core::iter::traits::iterator::Iterator&gt;::next\n             at /rustc/a55dd71d5fb0ec5a6a3a9e8c27b2127ba491ce52/library/core/src/iter/adapters/map.rs:103:9\n   6: &lt;smallvec::SmallVec&lt;A&gt; as core::iter::traits::collect::Extend&lt;&lt;A as smallvec::Array&gt;::Item&gt;&gt;::extend\n             at /home/user/.local/share/cargo/registry/src/github.com-1ecc6299db9ec823/smallvec-1.8.0/src/lib.rs:1742:36\n   7: &lt;smallvec::SmallVec&lt;A&gt; as core::iter::traits::collect::FromIterator&lt;&lt;A as smallvec::Array&gt;::Item&gt;&gt;::from_iter\n             at /home/user/.local/share/cargo/registry/src/github.com-1ecc6299db9ec823/smallvec-1.8.0/src/lib.rs:1727:9\n   8: core::iter::traits::iterator::Iterator::collect\n             at /rustc/a55dd71d5fb0ec5a6a3a9e8c27b2127ba491ce52/library/core/src/iter/traits/iterator.rs:1836:9\n   9: cranelift_codegen::egraph::elaborate::Elaborator::process_elab_stack\n             at ./cranelift/codegen/src/egraph/elaborate.rs:391:60\n  10: cranelift_codegen::egraph::elaborate::Elaborator::elaborate_eclass_use\n             at ./cranelift/codegen/src/egraph/elaborate.rs:285:9\n  11: cranelift_codegen::egraph::elaborate::Elaborator::elaborate_block\n             at ./cranelift/codegen/src/egraph/elaborate.rs:511:13\n  12: cranelift_codegen::egraph::elaborate::Elaborator::elaborate_domtree\n             at ./cranelift/codegen/src/egraph/elaborate.rs:532:21\n  13: cranelift_codegen::egraph::elaborate::Elaborator::elaborate\n             at ./cranelift/codegen/src/egraph/elaborate.rs:583:9\n  14: cranelift_codegen::egraph::FuncEGraph::elaborate\n             at ./cranelift/codegen/src/egraph.rs:348:9\n  15: cranelift_codegen::context::Context::optimize\n             at ./cranelift/codegen/src/context.rs:203:13\n  16: cranelift_codegen::context::Context::compile_stencil\n             at ./cranelift/codegen/src/context.rs:149:13\n  17: cranelift_codegen::context::Context::compile\n             at ./cranelift/codegen/src/context.rs:224:23\n  18: cranelift_codegen::context::Context::compile_and_emit\n             at ./cranelift/codegen/src/context.rs:132:29\n  19: clif_util::compile::handle_module\n             at ./cranelift/src/compile.rs:71:33\n  20: clif_util::compile::run\n             at ./cranelift/src/compile.rs:46:9\n  21: clif_util::main\n             at ./cranelift/src/clif-util.rs:106:33\n  22: core::ops::function::FnOnce::call_once\n             at /rustc/a55dd71d5fb0ec5a6a3a9e8c27b2127ba491ce52/library/core/src/ops/function.rs:248:5\nnote: Some details are omitted, run with `RUST_BACKTRACE=full` for a verbose backtrace.\n  </code><br>\n&lt;/details&gt;</p>\n</blockquote>",
        "id": 302200442,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1664866538
    },
    {
        "content": "<p>nivkner edited a <a href=\"https://github.com/bytecodealliance/wasmtime/pull/4953#issuecomment-1266486802\">comment</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/4953\">issue #4953</a>:</p>\n<blockquote>\n<p>tested using <code>cranelift-tools</code> with the following <code>clif</code> code:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">target</span><span class=\"w\"> </span><span class=\"n\">x86_64</span><span class=\"w\"></span>\n\n<span class=\"n\">function</span><span class=\"w\"> </span><span class=\"n\">u0</span>:<span class=\"mi\">359</span><span class=\"p\">(</span><span class=\"kt\">i64</span><span class=\"p\">)</span><span class=\"w\"> </span>-&gt; <span class=\"kt\">i8</span> <span class=\"nc\">system_v</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n\n<span class=\"w\">    </span><span class=\"n\">ss0</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">explicit_slot</span><span class=\"w\"> </span><span class=\"mi\">16</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">sig0</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"kt\">i64</span><span class=\"p\">)</span><span class=\"w\"> </span>-&gt; <span class=\"kt\">i8</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">i8</span><span class=\"w\"> </span><span class=\"n\">system_v</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">fn0</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">colocated</span><span class=\"w\"> </span><span class=\"n\">u0</span>:<span class=\"mi\">521</span><span class=\"w\"> </span><span class=\"n\">sig0</span><span class=\"w\"></span>\n\n<span class=\"w\">    </span><span class=\"n\">block0</span><span class=\"p\">(</span><span class=\"n\">v0</span>: <span class=\"kt\">i64</span><span class=\"p\">)</span>:\n    <span class=\"nc\">v3</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v4</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">call</span><span class=\"w\"> </span><span class=\"n\">fn0</span><span class=\"p\">(</span><span class=\"n\">v0</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">v3</span><span class=\"w\"></span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n</code></pre></div>\n<p>when calling</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">target</span><span class=\"o\">/</span><span class=\"n\">debug</span><span class=\"o\">/</span><span class=\"n\">clif</span><span class=\"o\">-</span><span class=\"n\">util</span><span class=\"w\"> </span><span class=\"n\">compile</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">set</span><span class=\"w\"> </span><span class=\"n\">use_egraphs</span><span class=\"o\">=</span><span class=\"kc\">false</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">target</span><span class=\"w\"> </span><span class=\"n\">x86_64</span><span class=\"o\">-</span><span class=\"n\">unknown</span><span class=\"o\">-</span><span class=\"n\">linux</span><span class=\"o\">-</span><span class=\"n\">gnu</span><span class=\"w\"> </span><span class=\"n\">example</span><span class=\"p\">.</span><span class=\"n\">clif</span><span class=\"w\"></span>\n</code></pre></div>\n<p>the code compiles with out error.</p>\n<p>when setting <code>--set use_egraphs=true</code><br>\nthe following error is produced:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">thread</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"na\">main</span><span class=\"o\">'</span><span class=\"w\"> </span><span class=\"n\">panicked</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"na\">enode</span><span class=\"w\"> </span><span class=\"n\">depends</span><span class=\"w\"> </span><span class=\"n\">directly</span><span class=\"w\"> </span><span class=\"n\">on</span><span class=\"w\"> </span><span class=\"n\">multi</span><span class=\"o\">-</span><span class=\"n\">value</span><span class=\"w\"> </span><span class=\"n\">result</span><span class=\"o\">'</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">cranelift</span><span class=\"o\">/</span><span class=\"n\">codegen</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">egraph</span><span class=\"o\">/</span><span class=\"n\">elaborate</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">396</span>:<span class=\"mi\">33</span><span class=\"w\"></span>\n</code></pre></div>\n<p>&lt;details&gt;<br>\n  &lt;summary&gt;backtrace&lt;/summary&gt;</p>\n<p><code>\nstack backtrace:\n   0: rust_begin_unwind\n             at /rustc/a55dd71d5fb0ec5a6a3a9e8c27b2127ba491ce52/library/std/src/panicking.rs:584:5\n   1: core::panicking::panic_fmt\n             at /rustc/a55dd71d5fb0ec5a6a3a9e8c27b2127ba491ce52/library/core/src/panicking.rs:142:14\n   2: cranelift_codegen::egraph::elaborate::Elaborator::process_elab_stack::{{closure}}\n             at ./cranelift/codegen/src/egraph/elaborate.rs:396:33\n   3: core::ops::function::impls::&lt;impl core::ops::function::FnOnce&lt;A&gt; for &amp;mut F&gt;::call_once\n             at /rustc/a55dd71d5fb0ec5a6a3a9e8c27b2127ba491ce52/library/core/src/ops/function.rs:301:13\n   4: core::option::Option&lt;T&gt;::map\n             at /rustc/a55dd71d5fb0ec5a6a3a9e8c27b2127ba491ce52/library/core/src/option.rs:929:29\n   5: &lt;core::iter::adapters::map::Map&lt;I,F&gt; as core::iter::traits::iterator::Iterator&gt;::next\n             at /rustc/a55dd71d5fb0ec5a6a3a9e8c27b2127ba491ce52/library/core/src/iter/adapters/map.rs:103:9\n   6: &lt;smallvec::SmallVec&lt;A&gt; as core::iter::traits::collect::Extend&lt;&lt;A as smallvec::Array&gt;::Item&gt;&gt;::extend\n             at /home/user/.local/share/cargo/registry/src/github.com-1ecc6299db9ec823/smallvec-1.8.0/src/lib.rs:1742:36\n   7: &lt;smallvec::SmallVec&lt;A&gt; as core::iter::traits::collect::FromIterator&lt;&lt;A as smallvec::Array&gt;::Item&gt;&gt;::from_iter\n             at /home/user/.local/share/cargo/registry/src/github.com-1ecc6299db9ec823/smallvec-1.8.0/src/lib.rs:1727:9\n   8: core::iter::traits::iterator::Iterator::collect\n             at /rustc/a55dd71d5fb0ec5a6a3a9e8c27b2127ba491ce52/library/core/src/iter/traits/iterator.rs:1836:9\n   9: cranelift_codegen::egraph::elaborate::Elaborator::process_elab_stack\n             at ./cranelift/codegen/src/egraph/elaborate.rs:391:60\n  10: cranelift_codegen::egraph::elaborate::Elaborator::elaborate_eclass_use\n             at ./cranelift/codegen/src/egraph/elaborate.rs:285:9\n  11: cranelift_codegen::egraph::elaborate::Elaborator::elaborate_block\n             at ./cranelift/codegen/src/egraph/elaborate.rs:511:13\n  12: cranelift_codegen::egraph::elaborate::Elaborator::elaborate_domtree\n             at ./cranelift/codegen/src/egraph/elaborate.rs:532:21\n  13: cranelift_codegen::egraph::elaborate::Elaborator::elaborate\n             at ./cranelift/codegen/src/egraph/elaborate.rs:583:9\n  14: cranelift_codegen::egraph::FuncEGraph::elaborate\n             at ./cranelift/codegen/src/egraph.rs:348:9\n  15: cranelift_codegen::context::Context::optimize\n             at ./cranelift/codegen/src/context.rs:203:13\n  16: cranelift_codegen::context::Context::compile_stencil\n             at ./cranelift/codegen/src/context.rs:149:13\n  17: cranelift_codegen::context::Context::compile\n             at ./cranelift/codegen/src/context.rs:224:23\n  18: cranelift_codegen::context::Context::compile_and_emit\n             at ./cranelift/codegen/src/context.rs:132:29\n  19: clif_util::compile::handle_module\n             at ./cranelift/src/compile.rs:71:33\n  20: clif_util::compile::run\n             at ./cranelift/src/compile.rs:46:9\n  21: clif_util::main\n             at ./cranelift/src/clif-util.rs:106:33\n  22: core::ops::function::FnOnce::call_once\n             at /rustc/a55dd71d5fb0ec5a6a3a9e8c27b2127ba491ce52/library/core/src/ops/function.rs:248:5\nnote: Some details are omitted, run with `RUST_BACKTRACE=full` for a verbose backtrace.\n  </code><br>\n&lt;/details&gt;</p>\n<p>file reduced from <code>clif</code> of <code>core</code> produced when attempting to compile <code>core</code> with <a href=\"https://github.com/bjorn3/rustc_codegen_cranelift\">https://github.com/bjorn3/rustc_codegen_cranelift</a> patched to use this PR</p>\n</blockquote>",
        "id": 302200710,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1664866677
    },
    {
        "content": "<p>nivkner edited a <a href=\"https://github.com/bytecodealliance/wasmtime/pull/4953#issuecomment-1266486802\">comment</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/4953\">issue #4953</a>:</p>\n<blockquote>\n<p>tested using <code>cranelift-tools</code> with the following <code>clif</code> code:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">target</span><span class=\"w\"> </span><span class=\"n\">x86_64</span><span class=\"w\"></span>\n\n<span class=\"n\">function</span><span class=\"w\"> </span><span class=\"n\">u0</span>:<span class=\"mi\">359</span><span class=\"p\">(</span><span class=\"kt\">i64</span><span class=\"p\">)</span><span class=\"w\"> </span>-&gt; <span class=\"kt\">i8</span> <span class=\"nc\">system_v</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n\n<span class=\"w\">    </span><span class=\"n\">ss0</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">explicit_slot</span><span class=\"w\"> </span><span class=\"mi\">16</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">sig0</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"kt\">i64</span><span class=\"p\">)</span><span class=\"w\"> </span>-&gt; <span class=\"kt\">i8</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">i8</span><span class=\"w\"> </span><span class=\"n\">system_v</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">fn0</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">colocated</span><span class=\"w\"> </span><span class=\"n\">u0</span>:<span class=\"mi\">521</span><span class=\"w\"> </span><span class=\"n\">sig0</span><span class=\"w\"></span>\n\n<span class=\"w\">    </span><span class=\"n\">block0</span><span class=\"p\">(</span><span class=\"n\">v0</span>: <span class=\"kt\">i64</span><span class=\"p\">)</span>:\n    <span class=\"nc\">v3</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v4</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">call</span><span class=\"w\"> </span><span class=\"n\">fn0</span><span class=\"p\">(</span><span class=\"n\">v0</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">v3</span><span class=\"w\"></span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n</code></pre></div>\n<p>when calling</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">target</span><span class=\"o\">/</span><span class=\"n\">debug</span><span class=\"o\">/</span><span class=\"n\">clif</span><span class=\"o\">-</span><span class=\"n\">util</span><span class=\"w\"> </span><span class=\"n\">compile</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">set</span><span class=\"w\"> </span><span class=\"n\">use_egraphs</span><span class=\"o\">=</span><span class=\"kc\">false</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">target</span><span class=\"w\"> </span><span class=\"n\">x86_64</span><span class=\"o\">-</span><span class=\"n\">unknown</span><span class=\"o\">-</span><span class=\"n\">linux</span><span class=\"o\">-</span><span class=\"n\">gnu</span><span class=\"w\"> </span><span class=\"n\">example</span><span class=\"p\">.</span><span class=\"n\">clif</span><span class=\"w\"></span>\n</code></pre></div>\n<p>the code compiles without error.</p>\n<p>when setting <code>--set use_egraphs=true</code><br>\nthe following error is produced:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">thread</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"na\">main</span><span class=\"o\">'</span><span class=\"w\"> </span><span class=\"n\">panicked</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"na\">enode</span><span class=\"w\"> </span><span class=\"n\">depends</span><span class=\"w\"> </span><span class=\"n\">directly</span><span class=\"w\"> </span><span class=\"n\">on</span><span class=\"w\"> </span><span class=\"n\">multi</span><span class=\"o\">-</span><span class=\"n\">value</span><span class=\"w\"> </span><span class=\"n\">result</span><span class=\"o\">'</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">cranelift</span><span class=\"o\">/</span><span class=\"n\">codegen</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">egraph</span><span class=\"o\">/</span><span class=\"n\">elaborate</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">396</span>:<span class=\"mi\">33</span><span class=\"w\"></span>\n</code></pre></div>\n<p>&lt;details&gt;<br>\n  &lt;summary&gt;backtrace&lt;/summary&gt;</p>\n<p><code>\nstack backtrace:\n   0: rust_begin_unwind\n             at /rustc/a55dd71d5fb0ec5a6a3a9e8c27b2127ba491ce52/library/std/src/panicking.rs:584:5\n   1: core::panicking::panic_fmt\n             at /rustc/a55dd71d5fb0ec5a6a3a9e8c27b2127ba491ce52/library/core/src/panicking.rs:142:14\n   2: cranelift_codegen::egraph::elaborate::Elaborator::process_elab_stack::{{closure}}\n             at ./cranelift/codegen/src/egraph/elaborate.rs:396:33\n   3: core::ops::function::impls::&lt;impl core::ops::function::FnOnce&lt;A&gt; for &amp;mut F&gt;::call_once\n             at /rustc/a55dd71d5fb0ec5a6a3a9e8c27b2127ba491ce52/library/core/src/ops/function.rs:301:13\n   4: core::option::Option&lt;T&gt;::map\n             at /rustc/a55dd71d5fb0ec5a6a3a9e8c27b2127ba491ce52/library/core/src/option.rs:929:29\n   5: &lt;core::iter::adapters::map::Map&lt;I,F&gt; as core::iter::traits::iterator::Iterator&gt;::next\n             at /rustc/a55dd71d5fb0ec5a6a3a9e8c27b2127ba491ce52/library/core/src/iter/adapters/map.rs:103:9\n   6: &lt;smallvec::SmallVec&lt;A&gt; as core::iter::traits::collect::Extend&lt;&lt;A as smallvec::Array&gt;::Item&gt;&gt;::extend\n             at /home/user/.local/share/cargo/registry/src/github.com-1ecc6299db9ec823/smallvec-1.8.0/src/lib.rs:1742:36\n   7: &lt;smallvec::SmallVec&lt;A&gt; as core::iter::traits::collect::FromIterator&lt;&lt;A as smallvec::Array&gt;::Item&gt;&gt;::from_iter\n             at /home/user/.local/share/cargo/registry/src/github.com-1ecc6299db9ec823/smallvec-1.8.0/src/lib.rs:1727:9\n   8: core::iter::traits::iterator::Iterator::collect\n             at /rustc/a55dd71d5fb0ec5a6a3a9e8c27b2127ba491ce52/library/core/src/iter/traits/iterator.rs:1836:9\n   9: cranelift_codegen::egraph::elaborate::Elaborator::process_elab_stack\n             at ./cranelift/codegen/src/egraph/elaborate.rs:391:60\n  10: cranelift_codegen::egraph::elaborate::Elaborator::elaborate_eclass_use\n             at ./cranelift/codegen/src/egraph/elaborate.rs:285:9\n  11: cranelift_codegen::egraph::elaborate::Elaborator::elaborate_block\n             at ./cranelift/codegen/src/egraph/elaborate.rs:511:13\n  12: cranelift_codegen::egraph::elaborate::Elaborator::elaborate_domtree\n             at ./cranelift/codegen/src/egraph/elaborate.rs:532:21\n  13: cranelift_codegen::egraph::elaborate::Elaborator::elaborate\n             at ./cranelift/codegen/src/egraph/elaborate.rs:583:9\n  14: cranelift_codegen::egraph::FuncEGraph::elaborate\n             at ./cranelift/codegen/src/egraph.rs:348:9\n  15: cranelift_codegen::context::Context::optimize\n             at ./cranelift/codegen/src/context.rs:203:13\n  16: cranelift_codegen::context::Context::compile_stencil\n             at ./cranelift/codegen/src/context.rs:149:13\n  17: cranelift_codegen::context::Context::compile\n             at ./cranelift/codegen/src/context.rs:224:23\n  18: cranelift_codegen::context::Context::compile_and_emit\n             at ./cranelift/codegen/src/context.rs:132:29\n  19: clif_util::compile::handle_module\n             at ./cranelift/src/compile.rs:71:33\n  20: clif_util::compile::run\n             at ./cranelift/src/compile.rs:46:9\n  21: clif_util::main\n             at ./cranelift/src/clif-util.rs:106:33\n  22: core::ops::function::FnOnce::call_once\n             at /rustc/a55dd71d5fb0ec5a6a3a9e8c27b2127ba491ce52/library/core/src/ops/function.rs:248:5\nnote: Some details are omitted, run with `RUST_BACKTRACE=full` for a verbose backtrace.\n  </code><br>\n&lt;/details&gt;</p>\n<p>file reduced from <code>clif</code> of <code>core</code> produced when attempting to compile <code>core</code> with <a href=\"https://github.com/bjorn3/rustc_codegen_cranelift\">https://github.com/bjorn3/rustc_codegen_cranelift</a> patched to use this PR</p>\n</blockquote>",
        "id": 302200823,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1664866728
    },
    {
        "content": "<p>nivkner edited a <a href=\"https://github.com/bytecodealliance/wasmtime/pull/4953#issuecomment-1266486802\">comment</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/4953\">issue #4953</a>:</p>\n<blockquote>\n<p>tested using <code>cranelift-tools</code> with the following <code>clif</code> code:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">target</span><span class=\"w\"> </span><span class=\"n\">x86_64</span><span class=\"w\"></span>\n\n<span class=\"n\">function</span><span class=\"w\"> </span><span class=\"n\">u0</span>:<span class=\"mi\">359</span><span class=\"p\">(</span><span class=\"kt\">i64</span><span class=\"p\">)</span><span class=\"w\"> </span>-&gt; <span class=\"kt\">i8</span> <span class=\"nc\">system_v</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n\n<span class=\"w\">    </span><span class=\"n\">sig0</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"kt\">i64</span><span class=\"p\">)</span><span class=\"w\"> </span>-&gt; <span class=\"kt\">i8</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">i8</span><span class=\"w\"> </span><span class=\"n\">system_v</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">fn0</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">colocated</span><span class=\"w\"> </span><span class=\"n\">u0</span>:<span class=\"mi\">521</span><span class=\"w\"> </span><span class=\"n\">sig0</span><span class=\"w\"></span>\n\n<span class=\"w\">    </span><span class=\"n\">block0</span><span class=\"p\">(</span><span class=\"n\">v0</span>: <span class=\"kt\">i64</span><span class=\"p\">)</span>:\n    <span class=\"nc\">v3</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v4</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">call</span><span class=\"w\"> </span><span class=\"n\">fn0</span><span class=\"p\">(</span><span class=\"n\">v0</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">v3</span><span class=\"w\"></span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n</code></pre></div>\n<p>when calling</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">target</span><span class=\"o\">/</span><span class=\"n\">debug</span><span class=\"o\">/</span><span class=\"n\">clif</span><span class=\"o\">-</span><span class=\"n\">util</span><span class=\"w\"> </span><span class=\"n\">compile</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">set</span><span class=\"w\"> </span><span class=\"n\">use_egraphs</span><span class=\"o\">=</span><span class=\"kc\">false</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">target</span><span class=\"w\"> </span><span class=\"n\">x86_64</span><span class=\"o\">-</span><span class=\"n\">unknown</span><span class=\"o\">-</span><span class=\"n\">linux</span><span class=\"o\">-</span><span class=\"n\">gnu</span><span class=\"w\"> </span><span class=\"n\">example</span><span class=\"p\">.</span><span class=\"n\">clif</span><span class=\"w\"></span>\n</code></pre></div>\n<p>the code compiles without error.</p>\n<p>when setting <code>--set use_egraphs=true</code><br>\nthe following error is produced:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">thread</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"na\">main</span><span class=\"o\">'</span><span class=\"w\"> </span><span class=\"n\">panicked</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"na\">enode</span><span class=\"w\"> </span><span class=\"n\">depends</span><span class=\"w\"> </span><span class=\"n\">directly</span><span class=\"w\"> </span><span class=\"n\">on</span><span class=\"w\"> </span><span class=\"n\">multi</span><span class=\"o\">-</span><span class=\"n\">value</span><span class=\"w\"> </span><span class=\"n\">result</span><span class=\"o\">'</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">cranelift</span><span class=\"o\">/</span><span class=\"n\">codegen</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">egraph</span><span class=\"o\">/</span><span class=\"n\">elaborate</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">396</span>:<span class=\"mi\">33</span><span class=\"w\"></span>\n</code></pre></div>\n<p>&lt;details&gt;<br>\n  &lt;summary&gt;backtrace&lt;/summary&gt;</p>\n<p><code>\nstack backtrace:\n   0: rust_begin_unwind\n             at /rustc/a55dd71d5fb0ec5a6a3a9e8c27b2127ba491ce52/library/std/src/panicking.rs:584:5\n   1: core::panicking::panic_fmt\n             at /rustc/a55dd71d5fb0ec5a6a3a9e8c27b2127ba491ce52/library/core/src/panicking.rs:142:14\n   2: cranelift_codegen::egraph::elaborate::Elaborator::process_elab_stack::{{closure}}\n             at ./cranelift/codegen/src/egraph/elaborate.rs:396:33\n   3: core::ops::function::impls::&lt;impl core::ops::function::FnOnce&lt;A&gt; for &amp;mut F&gt;::call_once\n             at /rustc/a55dd71d5fb0ec5a6a3a9e8c27b2127ba491ce52/library/core/src/ops/function.rs:301:13\n   4: core::option::Option&lt;T&gt;::map\n             at /rustc/a55dd71d5fb0ec5a6a3a9e8c27b2127ba491ce52/library/core/src/option.rs:929:29\n   5: &lt;core::iter::adapters::map::Map&lt;I,F&gt; as core::iter::traits::iterator::Iterator&gt;::next\n             at /rustc/a55dd71d5fb0ec5a6a3a9e8c27b2127ba491ce52/library/core/src/iter/adapters/map.rs:103:9\n   6: &lt;smallvec::SmallVec&lt;A&gt; as core::iter::traits::collect::Extend&lt;&lt;A as smallvec::Array&gt;::Item&gt;&gt;::extend\n             at /home/user/.local/share/cargo/registry/src/github.com-1ecc6299db9ec823/smallvec-1.8.0/src/lib.rs:1742:36\n   7: &lt;smallvec::SmallVec&lt;A&gt; as core::iter::traits::collect::FromIterator&lt;&lt;A as smallvec::Array&gt;::Item&gt;&gt;::from_iter\n             at /home/user/.local/share/cargo/registry/src/github.com-1ecc6299db9ec823/smallvec-1.8.0/src/lib.rs:1727:9\n   8: core::iter::traits::iterator::Iterator::collect\n             at /rustc/a55dd71d5fb0ec5a6a3a9e8c27b2127ba491ce52/library/core/src/iter/traits/iterator.rs:1836:9\n   9: cranelift_codegen::egraph::elaborate::Elaborator::process_elab_stack\n             at ./cranelift/codegen/src/egraph/elaborate.rs:391:60\n  10: cranelift_codegen::egraph::elaborate::Elaborator::elaborate_eclass_use\n             at ./cranelift/codegen/src/egraph/elaborate.rs:285:9\n  11: cranelift_codegen::egraph::elaborate::Elaborator::elaborate_block\n             at ./cranelift/codegen/src/egraph/elaborate.rs:511:13\n  12: cranelift_codegen::egraph::elaborate::Elaborator::elaborate_domtree\n             at ./cranelift/codegen/src/egraph/elaborate.rs:532:21\n  13: cranelift_codegen::egraph::elaborate::Elaborator::elaborate\n             at ./cranelift/codegen/src/egraph/elaborate.rs:583:9\n  14: cranelift_codegen::egraph::FuncEGraph::elaborate\n             at ./cranelift/codegen/src/egraph.rs:348:9\n  15: cranelift_codegen::context::Context::optimize\n             at ./cranelift/codegen/src/context.rs:203:13\n  16: cranelift_codegen::context::Context::compile_stencil\n             at ./cranelift/codegen/src/context.rs:149:13\n  17: cranelift_codegen::context::Context::compile\n             at ./cranelift/codegen/src/context.rs:224:23\n  18: cranelift_codegen::context::Context::compile_and_emit\n             at ./cranelift/codegen/src/context.rs:132:29\n  19: clif_util::compile::handle_module\n             at ./cranelift/src/compile.rs:71:33\n  20: clif_util::compile::run\n             at ./cranelift/src/compile.rs:46:9\n  21: clif_util::main\n             at ./cranelift/src/clif-util.rs:106:33\n  22: core::ops::function::FnOnce::call_once\n             at /rustc/a55dd71d5fb0ec5a6a3a9e8c27b2127ba491ce52/library/core/src/ops/function.rs:248:5\nnote: Some details are omitted, run with `RUST_BACKTRACE=full` for a verbose backtrace.\n  </code><br>\n&lt;/details&gt;</p>\n<p>file reduced from <code>clif</code> of <code>core</code> produced when attempting to compile <code>core</code> with <a href=\"https://github.com/bjorn3/rustc_codegen_cranelift\">https://github.com/bjorn3/rustc_codegen_cranelift</a> patched to use this PR</p>\n</blockquote>",
        "id": 302201597,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1664867141
    },
    {
        "content": "<p>nivkner edited a <a href=\"https://github.com/bytecodealliance/wasmtime/pull/4953#issuecomment-1266486802\">comment</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/4953\">issue #4953</a>:</p>\n<blockquote>\n<p>tested using <code>cranelift-tools</code> with the following <code>clif</code> code:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">target</span><span class=\"w\"> </span><span class=\"n\">x86_64</span><span class=\"w\"></span>\n\n<span class=\"n\">function</span><span class=\"w\"> </span><span class=\"n\">u0</span>:<span class=\"mi\">359</span><span class=\"p\">(</span><span class=\"kt\">i64</span><span class=\"p\">)</span><span class=\"w\"> </span>-&gt; <span class=\"kt\">i8</span> <span class=\"nc\">system_v</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n\n<span class=\"w\">    </span><span class=\"n\">sig0</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"kt\">i64</span><span class=\"p\">)</span><span class=\"w\"> </span>-&gt; <span class=\"kt\">i8</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">i8</span><span class=\"w\"> </span><span class=\"n\">system_v</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">fn0</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">colocated</span><span class=\"w\"> </span><span class=\"n\">u0</span>:<span class=\"mi\">521</span><span class=\"w\"> </span><span class=\"n\">sig0</span><span class=\"w\"></span>\n\n<span class=\"w\">    </span><span class=\"n\">block0</span><span class=\"p\">(</span><span class=\"n\">v0</span>: <span class=\"kt\">i64</span><span class=\"p\">)</span>:\n    <span class=\"nc\">v3</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v4</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">call</span><span class=\"w\"> </span><span class=\"n\">fn0</span><span class=\"p\">(</span><span class=\"n\">v0</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">v3</span><span class=\"w\"></span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n</code></pre></div>\n<p>when calling</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">target</span><span class=\"o\">/</span><span class=\"n\">debug</span><span class=\"o\">/</span><span class=\"n\">clif</span><span class=\"o\">-</span><span class=\"n\">util</span><span class=\"w\"> </span><span class=\"n\">compile</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">set</span><span class=\"w\"> </span><span class=\"n\">use_egraphs</span><span class=\"o\">=</span><span class=\"kc\">false</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">target</span><span class=\"w\"> </span><span class=\"n\">x86_64</span><span class=\"o\">-</span><span class=\"n\">unknown</span><span class=\"o\">-</span><span class=\"n\">linux</span><span class=\"o\">-</span><span class=\"n\">gnu</span><span class=\"w\"> </span><span class=\"n\">example</span><span class=\"p\">.</span><span class=\"n\">clif</span><span class=\"w\"></span>\n</code></pre></div>\n<p>the code compiles without error.</p>\n<p>when setting <code>--set use_egraphs=true</code> the following error is produced:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">thread</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"na\">main</span><span class=\"o\">'</span><span class=\"w\"> </span><span class=\"n\">panicked</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"na\">enode</span><span class=\"w\"> </span><span class=\"n\">depends</span><span class=\"w\"> </span><span class=\"n\">directly</span><span class=\"w\"> </span><span class=\"n\">on</span><span class=\"w\"> </span><span class=\"n\">multi</span><span class=\"o\">-</span><span class=\"n\">value</span><span class=\"w\"> </span><span class=\"n\">result</span><span class=\"o\">'</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">cranelift</span><span class=\"o\">/</span><span class=\"n\">codegen</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">egraph</span><span class=\"o\">/</span><span class=\"n\">elaborate</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">396</span>:<span class=\"mi\">33</span><span class=\"w\"></span>\n</code></pre></div>\n<p>&lt;details&gt;<br>\n  &lt;summary&gt;backtrace&lt;/summary&gt;</p>\n<p><code>\nstack backtrace:\n   0: rust_begin_unwind\n             at /rustc/a55dd71d5fb0ec5a6a3a9e8c27b2127ba491ce52/library/std/src/panicking.rs:584:5\n   1: core::panicking::panic_fmt\n             at /rustc/a55dd71d5fb0ec5a6a3a9e8c27b2127ba491ce52/library/core/src/panicking.rs:142:14\n   2: cranelift_codegen::egraph::elaborate::Elaborator::process_elab_stack::{{closure}}\n             at ./cranelift/codegen/src/egraph/elaborate.rs:396:33\n   3: core::ops::function::impls::&lt;impl core::ops::function::FnOnce&lt;A&gt; for &amp;mut F&gt;::call_once\n             at /rustc/a55dd71d5fb0ec5a6a3a9e8c27b2127ba491ce52/library/core/src/ops/function.rs:301:13\n   4: core::option::Option&lt;T&gt;::map\n             at /rustc/a55dd71d5fb0ec5a6a3a9e8c27b2127ba491ce52/library/core/src/option.rs:929:29\n   5: &lt;core::iter::adapters::map::Map&lt;I,F&gt; as core::iter::traits::iterator::Iterator&gt;::next\n             at /rustc/a55dd71d5fb0ec5a6a3a9e8c27b2127ba491ce52/library/core/src/iter/adapters/map.rs:103:9\n   6: &lt;smallvec::SmallVec&lt;A&gt; as core::iter::traits::collect::Extend&lt;&lt;A as smallvec::Array&gt;::Item&gt;&gt;::extend\n             at /home/user/.local/share/cargo/registry/src/github.com-1ecc6299db9ec823/smallvec-1.8.0/src/lib.rs:1742:36\n   7: &lt;smallvec::SmallVec&lt;A&gt; as core::iter::traits::collect::FromIterator&lt;&lt;A as smallvec::Array&gt;::Item&gt;&gt;::from_iter\n             at /home/user/.local/share/cargo/registry/src/github.com-1ecc6299db9ec823/smallvec-1.8.0/src/lib.rs:1727:9\n   8: core::iter::traits::iterator::Iterator::collect\n             at /rustc/a55dd71d5fb0ec5a6a3a9e8c27b2127ba491ce52/library/core/src/iter/traits/iterator.rs:1836:9\n   9: cranelift_codegen::egraph::elaborate::Elaborator::process_elab_stack\n             at ./cranelift/codegen/src/egraph/elaborate.rs:391:60\n  10: cranelift_codegen::egraph::elaborate::Elaborator::elaborate_eclass_use\n             at ./cranelift/codegen/src/egraph/elaborate.rs:285:9\n  11: cranelift_codegen::egraph::elaborate::Elaborator::elaborate_block\n             at ./cranelift/codegen/src/egraph/elaborate.rs:511:13\n  12: cranelift_codegen::egraph::elaborate::Elaborator::elaborate_domtree\n             at ./cranelift/codegen/src/egraph/elaborate.rs:532:21\n  13: cranelift_codegen::egraph::elaborate::Elaborator::elaborate\n             at ./cranelift/codegen/src/egraph/elaborate.rs:583:9\n  14: cranelift_codegen::egraph::FuncEGraph::elaborate\n             at ./cranelift/codegen/src/egraph.rs:348:9\n  15: cranelift_codegen::context::Context::optimize\n             at ./cranelift/codegen/src/context.rs:203:13\n  16: cranelift_codegen::context::Context::compile_stencil\n             at ./cranelift/codegen/src/context.rs:149:13\n  17: cranelift_codegen::context::Context::compile\n             at ./cranelift/codegen/src/context.rs:224:23\n  18: cranelift_codegen::context::Context::compile_and_emit\n             at ./cranelift/codegen/src/context.rs:132:29\n  19: clif_util::compile::handle_module\n             at ./cranelift/src/compile.rs:71:33\n  20: clif_util::compile::run\n             at ./cranelift/src/compile.rs:46:9\n  21: clif_util::main\n             at ./cranelift/src/clif-util.rs:106:33\n  22: core::ops::function::FnOnce::call_once\n             at /rustc/a55dd71d5fb0ec5a6a3a9e8c27b2127ba491ce52/library/core/src/ops/function.rs:248:5\nnote: Some details are omitted, run with `RUST_BACKTRACE=full` for a verbose backtrace.\n  </code><br>\n&lt;/details&gt;</p>\n<p>file reduced from <code>clif</code> of <code>core</code> produced when attempting to compile <code>core</code> with <a href=\"https://github.com/bjorn3/rustc_codegen_cranelift\">https://github.com/bjorn3/rustc_codegen_cranelift</a> patched to use this PR</p>\n</blockquote>",
        "id": 302202019,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1664867373
    },
    {
        "content": "<p>nivkner edited a <a href=\"https://github.com/bytecodealliance/wasmtime/pull/4953#issuecomment-1266486802\">comment</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/4953\">issue #4953</a>:</p>\n<blockquote>\n<p>tested using <code>cranelift-tools</code> with the following <code>clif</code> code:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">target</span><span class=\"w\"> </span><span class=\"n\">x86_64</span><span class=\"w\"></span>\n\n<span class=\"n\">function</span><span class=\"w\"> </span><span class=\"n\">u0</span>:<span class=\"mi\">359</span><span class=\"p\">(</span><span class=\"kt\">i64</span><span class=\"p\">)</span><span class=\"w\"> </span>-&gt; <span class=\"kt\">i8</span> <span class=\"nc\">system_v</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n\n<span class=\"w\">    </span><span class=\"n\">sig0</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"kt\">i64</span><span class=\"p\">)</span><span class=\"w\"> </span>-&gt; <span class=\"kt\">i8</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">i8</span><span class=\"w\"> </span><span class=\"n\">system_v</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">fn0</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">colocated</span><span class=\"w\"> </span><span class=\"n\">u0</span>:<span class=\"mi\">521</span><span class=\"w\"> </span><span class=\"n\">sig0</span><span class=\"w\"></span>\n\n<span class=\"w\">    </span><span class=\"n\">block0</span><span class=\"p\">(</span><span class=\"n\">v0</span>: <span class=\"kt\">i64</span><span class=\"p\">)</span>:\n    <span class=\"nc\">v3</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v4</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">call</span><span class=\"w\"> </span><span class=\"n\">fn0</span><span class=\"p\">(</span><span class=\"n\">v0</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">v3</span><span class=\"w\"></span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n</code></pre></div>\n<p>when calling</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">target</span><span class=\"o\">/</span><span class=\"n\">debug</span><span class=\"o\">/</span><span class=\"n\">clif</span><span class=\"o\">-</span><span class=\"n\">util</span><span class=\"w\"> </span><span class=\"n\">compile</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">set</span><span class=\"w\"> </span><span class=\"n\">use_egraphs</span><span class=\"o\">=</span><span class=\"kc\">false</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">target</span><span class=\"w\"> </span><span class=\"n\">x86_64</span><span class=\"o\">-</span><span class=\"n\">unknown</span><span class=\"o\">-</span><span class=\"n\">linux</span><span class=\"o\">-</span><span class=\"n\">gnu</span><span class=\"w\"> </span><span class=\"n\">example</span><span class=\"p\">.</span><span class=\"n\">clif</span><span class=\"w\"></span>\n</code></pre></div>\n<p>the code compiles without error.</p>\n<p>when setting <code>use_egraphs=true</code> the following error is produced:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">thread</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"na\">main</span><span class=\"o\">'</span><span class=\"w\"> </span><span class=\"n\">panicked</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"na\">enode</span><span class=\"w\"> </span><span class=\"n\">depends</span><span class=\"w\"> </span><span class=\"n\">directly</span><span class=\"w\"> </span><span class=\"n\">on</span><span class=\"w\"> </span><span class=\"n\">multi</span><span class=\"o\">-</span><span class=\"n\">value</span><span class=\"w\"> </span><span class=\"n\">result</span><span class=\"o\">'</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">cranelift</span><span class=\"o\">/</span><span class=\"n\">codegen</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">egraph</span><span class=\"o\">/</span><span class=\"n\">elaborate</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">396</span>:<span class=\"mi\">33</span><span class=\"w\"></span>\n</code></pre></div>\n<p>&lt;details&gt;<br>\n  &lt;summary&gt;backtrace&lt;/summary&gt;</p>\n<p><code>\nstack backtrace:\n   0: rust_begin_unwind\n             at /rustc/a55dd71d5fb0ec5a6a3a9e8c27b2127ba491ce52/library/std/src/panicking.rs:584:5\n   1: core::panicking::panic_fmt\n             at /rustc/a55dd71d5fb0ec5a6a3a9e8c27b2127ba491ce52/library/core/src/panicking.rs:142:14\n   2: cranelift_codegen::egraph::elaborate::Elaborator::process_elab_stack::{{closure}}\n             at ./cranelift/codegen/src/egraph/elaborate.rs:396:33\n   3: core::ops::function::impls::&lt;impl core::ops::function::FnOnce&lt;A&gt; for &amp;mut F&gt;::call_once\n             at /rustc/a55dd71d5fb0ec5a6a3a9e8c27b2127ba491ce52/library/core/src/ops/function.rs:301:13\n   4: core::option::Option&lt;T&gt;::map\n             at /rustc/a55dd71d5fb0ec5a6a3a9e8c27b2127ba491ce52/library/core/src/option.rs:929:29\n   5: &lt;core::iter::adapters::map::Map&lt;I,F&gt; as core::iter::traits::iterator::Iterator&gt;::next\n             at /rustc/a55dd71d5fb0ec5a6a3a9e8c27b2127ba491ce52/library/core/src/iter/adapters/map.rs:103:9\n   6: &lt;smallvec::SmallVec&lt;A&gt; as core::iter::traits::collect::Extend&lt;&lt;A as smallvec::Array&gt;::Item&gt;&gt;::extend\n             at /home/user/.local/share/cargo/registry/src/github.com-1ecc6299db9ec823/smallvec-1.8.0/src/lib.rs:1742:36\n   7: &lt;smallvec::SmallVec&lt;A&gt; as core::iter::traits::collect::FromIterator&lt;&lt;A as smallvec::Array&gt;::Item&gt;&gt;::from_iter\n             at /home/user/.local/share/cargo/registry/src/github.com-1ecc6299db9ec823/smallvec-1.8.0/src/lib.rs:1727:9\n   8: core::iter::traits::iterator::Iterator::collect\n             at /rustc/a55dd71d5fb0ec5a6a3a9e8c27b2127ba491ce52/library/core/src/iter/traits/iterator.rs:1836:9\n   9: cranelift_codegen::egraph::elaborate::Elaborator::process_elab_stack\n             at ./cranelift/codegen/src/egraph/elaborate.rs:391:60\n  10: cranelift_codegen::egraph::elaborate::Elaborator::elaborate_eclass_use\n             at ./cranelift/codegen/src/egraph/elaborate.rs:285:9\n  11: cranelift_codegen::egraph::elaborate::Elaborator::elaborate_block\n             at ./cranelift/codegen/src/egraph/elaborate.rs:511:13\n  12: cranelift_codegen::egraph::elaborate::Elaborator::elaborate_domtree\n             at ./cranelift/codegen/src/egraph/elaborate.rs:532:21\n  13: cranelift_codegen::egraph::elaborate::Elaborator::elaborate\n             at ./cranelift/codegen/src/egraph/elaborate.rs:583:9\n  14: cranelift_codegen::egraph::FuncEGraph::elaborate\n             at ./cranelift/codegen/src/egraph.rs:348:9\n  15: cranelift_codegen::context::Context::optimize\n             at ./cranelift/codegen/src/context.rs:203:13\n  16: cranelift_codegen::context::Context::compile_stencil\n             at ./cranelift/codegen/src/context.rs:149:13\n  17: cranelift_codegen::context::Context::compile\n             at ./cranelift/codegen/src/context.rs:224:23\n  18: cranelift_codegen::context::Context::compile_and_emit\n             at ./cranelift/codegen/src/context.rs:132:29\n  19: clif_util::compile::handle_module\n             at ./cranelift/src/compile.rs:71:33\n  20: clif_util::compile::run\n             at ./cranelift/src/compile.rs:46:9\n  21: clif_util::main\n             at ./cranelift/src/clif-util.rs:106:33\n  22: core::ops::function::FnOnce::call_once\n             at /rustc/a55dd71d5fb0ec5a6a3a9e8c27b2127ba491ce52/library/core/src/ops/function.rs:248:5\nnote: Some details are omitted, run with `RUST_BACKTRACE=full` for a verbose backtrace.\n  </code><br>\n&lt;/details&gt;</p>\n<p>file reduced from <code>clif</code> of <code>core</code> produced when attempting to compile <code>core</code> with <a href=\"https://github.com/bjorn3/rustc_codegen_cranelift\">https://github.com/bjorn3/rustc_codegen_cranelift</a> patched to use this PR</p>\n</blockquote>",
        "id": 302202063,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1664867392
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/pull/4953#issuecomment-1267082659\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/4953\">issue #4953</a>:</p>\n<blockquote>\n<blockquote>\n<p>it's surprising that this fails if all the other builds work fine? </p>\n</blockquote>\n<p>You'll need to edit <a href=\"https://github.com/bytecodealliance/wasmtime/blob/c9ff14e00bb0a90905a4f1cc2968c1e3e0417ce5/scripts/publish.rs#L18-L67\">this list</a> to include automatic publishing of a new crate.</p>\n</blockquote>",
        "id": 302271024,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1664893197
    },
    {
        "content": "<p>cfallin <a href=\"https://github.com/bytecodealliance/wasmtime/pull/4953#issuecomment-1267250512\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/4953\">issue #4953</a>:</p>\n<blockquote>\n<blockquote>\n<blockquote>\n<p>it's surprising that this fails if all the other builds work fine?</p>\n</blockquote>\n<p>You'll need to edit <a href=\"https://github.com/bytecodealliance/wasmtime/blob/c9ff14e00bb0a90905a4f1cc2968c1e3e0417ce5/scripts/publish.rs#L18-L67\">this list</a> to include automatic publishing of a new crate.</p>\n</blockquote>\n<p>It’s actually already there, from the earlier PR that introduced the crate (line 28); this seems to be something new related to the workspaces change?</p>\n</blockquote>",
        "id": 302297950,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1664900315
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/pull/4953#issuecomment-1267257205\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/4953\">issue #4953</a>:</p>\n<blockquote>\n<p>Ah I only checked the diff of this PR, the list also needs to be topologically sorted so if <code>cranelift-codegen</code> is picking up a new dep then the list needs to be reordered.</p>\n</blockquote>",
        "id": 302299209,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1664900663
    },
    {
        "content": "<p>cfallin <a href=\"https://github.com/bytecodealliance/wasmtime/pull/4953#issuecomment-1267276643\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/4953\">issue #4953</a>:</p>\n<blockquote>\n<p>Ah, that makes sense, thanks!</p>\n</blockquote>",
        "id": 302302455,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1664901690
    },
    {
        "content": "<p>cfallin <a href=\"https://github.com/bytecodealliance/wasmtime/pull/4953#issuecomment-1267374913\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/4953\">issue #4953</a>:</p>\n<blockquote>\n<blockquote>\n<p>when setting use_egraphs=true the following error is produced:</p>\n<p><code>\nthread 'main' panicked at 'enode depends directly on multi-value result', cranelift/codegen/src/egraph/elaborate.rs:396:33\n</code></p>\n</blockquote>\n<p>Fixed, thanks! This was an issue introduced in my non-recursive rewrite of the extraction (best-cost node) procedure's handling of value projections.</p>\n</blockquote>",
        "id": 302319379,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1664907192
    },
    {
        "content": "<p>nivkner <a href=\"https://github.com/bytecodealliance/wasmtime/pull/4953#issuecomment-1267541924\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/4953\">issue #4953</a>:</p>\n<blockquote>\n<p>the following code compiles without error when setting <code>use_egraphs=false</code> but produces an error when <code>use_egraphs=true</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">target</span><span class=\"w\"> </span><span class=\"n\">x86_64</span><span class=\"w\"></span>\n\n<span class=\"n\">function</span><span class=\"w\"> </span><span class=\"n\">u0</span>:<span class=\"mi\">1302</span><span class=\"p\">(</span><span class=\"kt\">i64</span><span class=\"p\">)</span><span class=\"w\"> </span>-&gt; <span class=\"kt\">i64</span> <span class=\"nc\">system_v</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n\n<span class=\"w\">        </span><span class=\"n\">block0</span><span class=\"p\">(</span><span class=\"n\">v0</span>: <span class=\"kt\">i64</span><span class=\"p\">)</span>:\n                <span class=\"nc\">v9</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">atomic_rmw</span><span class=\"p\">.</span><span class=\"kt\">i64</span><span class=\"w\"> </span><span class=\"n\">add</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"w\"></span>\n<span class=\"w\">                </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"w\"></span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n</code></pre></div>\n<p>the error is</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">thread</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"na\">main</span><span class=\"o\">'</span><span class=\"w\"> </span><span class=\"n\">panicked</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"na\">index</span><span class=\"w\"> </span><span class=\"n\">out</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">bounds</span>: <span class=\"nc\">the</span><span class=\"w\"> </span><span class=\"n\">len</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">but</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">index</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">'</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">user</span><span class=\"o\">/</span><span class=\"n\">Documents</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">/</span><span class=\"n\">target</span><span class=\"o\">/</span><span class=\"n\">debug</span><span class=\"o\">/</span><span class=\"n\">build</span><span class=\"o\">/</span><span class=\"n\">cranelift</span><span class=\"o\">-</span><span class=\"n\">codegen</span><span class=\"o\">-</span><span class=\"n\">ae89adb74262e952</span><span class=\"o\">/</span><span class=\"n\">out</span><span class=\"o\">/</span><span class=\"n\">opcodes</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">1979</span>:<span class=\"mi\">39</span><span class=\"w\"></span>\n</code></pre></div>\n<p>&lt;details&gt;<br>\n&lt;summary&gt;backtrace&lt;/summary&gt;</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">stack</span><span class=\"w\"> </span><span class=\"n\">backtrace</span>:\n   <span class=\"mi\">0</span>: <span class=\"nc\">rust_begin_unwind</span><span class=\"w\"></span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a55dd71d5fb0ec5a6a3a9e8c27b2127ba491ce52</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">panicking</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">584</span>:<span class=\"mi\">5</span><span class=\"w\"></span>\n<span class=\"w\">   </span><span class=\"mi\">1</span>: <span class=\"nc\">core</span>::<span class=\"n\">panicking</span>::<span class=\"n\">panic_fmt</span><span class=\"w\"></span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a55dd71d5fb0ec5a6a3a9e8c27b2127ba491ce52</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">panicking</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">142</span>:<span class=\"mi\">14</span><span class=\"w\"></span>\n<span class=\"w\">   </span><span class=\"mi\">2</span>: <span class=\"nc\">core</span>::<span class=\"n\">panicking</span>::<span class=\"n\">panic_bounds_check</span><span class=\"w\"></span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a55dd71d5fb0ec5a6a3a9e8c27b2127ba491ce52</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">panicking</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">84</span>:<span class=\"mi\">5</span><span class=\"w\"></span>\n<span class=\"w\">   </span><span class=\"mi\">3</span>: <span class=\"nc\">cranelift_codegen</span>::<span class=\"n\">ir</span>::<span class=\"n\">instructions</span>::<span class=\"n\">InstructionImms</span>::<span class=\"n\">with_args</span><span class=\"w\"></span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">target</span><span class=\"o\">/</span><span class=\"n\">debug</span><span class=\"o\">/</span><span class=\"n\">build</span><span class=\"o\">/</span><span class=\"n\">cranelift</span><span class=\"o\">-</span><span class=\"n\">codegen</span><span class=\"o\">-</span><span class=\"n\">ae89adb74262e952</span><span class=\"o\">/</span><span class=\"n\">out</span><span class=\"o\">/</span><span class=\"n\">opcodes</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">1979</span>:<span class=\"mi\">39</span><span class=\"w\"></span>\n<span class=\"w\">   </span><span class=\"mi\">4</span>: <span class=\"nc\">cranelift_codegen</span>::<span class=\"n\">egraph</span>::<span class=\"n\">elaborate</span>::<span class=\"n\">Elaborator</span>::<span class=\"n\">add_node</span><span class=\"w\"></span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">cranelift</span><span class=\"o\">/</span><span class=\"n\">codegen</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">egraph</span><span class=\"o\">/</span><span class=\"n\">elaborate</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">197</span>:<span class=\"mi\">17</span><span class=\"w\"></span>\n<span class=\"w\">   </span><span class=\"mi\">5</span>: <span class=\"nc\">cranelift_codegen</span>::<span class=\"n\">egraph</span>::<span class=\"n\">elaborate</span>::<span class=\"n\">Elaborator</span>::<span class=\"n\">process_elab_stack</span><span class=\"w\"></span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">cranelift</span><span class=\"o\">/</span><span class=\"n\">codegen</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">egraph</span><span class=\"o\">/</span><span class=\"n\">elaborate</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">445</span>:<span class=\"mi\">35</span><span class=\"w\"></span>\n<span class=\"w\">   </span><span class=\"mi\">6</span>: <span class=\"nc\">cranelift_codegen</span>::<span class=\"n\">egraph</span>::<span class=\"n\">elaborate</span>::<span class=\"n\">Elaborator</span>::<span class=\"n\">elaborate_eclass_use</span><span class=\"w\"></span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">cranelift</span><span class=\"o\">/</span><span class=\"n\">codegen</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">egraph</span><span class=\"o\">/</span><span class=\"n\">elaborate</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">285</span>:<span class=\"mi\">9</span><span class=\"w\"></span>\n<span class=\"w\">   </span><span class=\"mi\">7</span>: <span class=\"nc\">cranelift_codegen</span>::<span class=\"n\">egraph</span>::<span class=\"n\">elaborate</span>::<span class=\"n\">Elaborator</span>::<span class=\"n\">elaborate_block</span><span class=\"w\"></span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">cranelift</span><span class=\"o\">/</span><span class=\"n\">codegen</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">egraph</span><span class=\"o\">/</span><span class=\"n\">elaborate</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">513</span>:<span class=\"mi\">13</span><span class=\"w\"></span>\n<span class=\"w\">   </span><span class=\"mi\">8</span>: <span class=\"nc\">cranelift_codegen</span>::<span class=\"n\">egraph</span>::<span class=\"n\">elaborate</span>::<span class=\"n\">Elaborator</span>::<span class=\"n\">elaborate_domtree</span><span class=\"w\"></span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">cranelift</span><span class=\"o\">/</span><span class=\"n\">codegen</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">egraph</span><span class=\"o\">/</span><span class=\"n\">elaborate</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">534</span>:<span class=\"mi\">21</span><span class=\"w\"></span>\n<span class=\"w\">   </span><span class=\"mi\">9</span>: <span class=\"nc\">cranelift_codegen</span>::<span class=\"n\">egraph</span>::<span class=\"n\">elaborate</span>::<span class=\"n\">Elaborator</span>::<span class=\"n\">elaborate</span><span class=\"w\"></span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">cranelift</span><span class=\"o\">/</span><span class=\"n\">codegen</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">egraph</span><span class=\"o\">/</span><span class=\"n\">elaborate</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">585</span>:<span class=\"mi\">9</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"mi\">10</span>: <span class=\"nc\">cranelift_codegen</span>::<span class=\"n\">egraph</span>::<span class=\"n\">FuncEGraph</span>::<span class=\"n\">elaborate</span><span class=\"w\"></span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">cranelift</span><span class=\"o\">/</span><span class=\"n\">codegen</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">egraph</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">348</span>:<span class=\"mi\">9</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"mi\">11</span>: <span class=\"nc\">cranelift_codegen</span>::<span class=\"n\">context</span>::<span class=\"n\">Context</span>::<span class=\"n\">optimize</span><span class=\"w\"></span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">cranelift</span><span class=\"o\">/</span><span class=\"n\">codegen</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">context</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">203</span>:<span class=\"mi\">13</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"mi\">12</span>: <span class=\"nc\">cranelift_codegen</span>::<span class=\"n\">context</span>::<span class=\"n\">Context</span>::<span class=\"n\">compile_stencil</span><span class=\"w\"></span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">cranelift</span><span class=\"o\">/</span><span class=\"n\">codegen</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">context</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">149</span>:<span class=\"mi\">13</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"mi\">13</span>: <span class=\"nc\">cranelift_codegen</span>::<span class=\"n\">context</span>::<span class=\"n\">Context</span>::<span class=\"n\">compile</span><span class=\"w\"></span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">cranelift</span><span class=\"o\">/</span><span class=\"n\">codegen</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">context</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">224</span>:<span class=\"mi\">23</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"mi\">14</span>: <span class=\"nc\">cranelift_codegen</span>::<span class=\"n\">context</span>::<span class=\"n\">Context</span>::<span class=\"n\">compile_and_emit</span><span class=\"w\"></span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">cranelift</span><span class=\"o\">/</span><span class=\"n\">codegen</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">context</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">132</span>:<span class=\"mi\">29</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"mi\">15</span>: <span class=\"nc\">clif_util</span>::<span class=\"n\">compile</span>::<span class=\"n\">handle_module</span><span class=\"w\"></span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">cranelift</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">compile</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">71</span>:<span class=\"mi\">33</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"mi\">16</span>: <span class=\"nc\">clif_util</span>::<span class=\"n\">compile</span>::<span class=\"n\">run</span><span class=\"w\"></span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">cranelift</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">compile</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">46</span>:<span class=\"mi\">9</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"mi\">17</span>: <span class=\"nc\">clif_util</span>::<span class=\"n\">main</span><span class=\"w\"></span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">cranelift</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">clif</span><span class=\"o\">-</span><span class=\"n\">util</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">106</span>:<span class=\"mi\">33</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"mi\">18</span>: <span class=\"nc\">core</span>::<span class=\"n\">ops</span>::<span class=\"n\">function</span>::<span class=\"nb\">FnOnce</span>::<span class=\"n\">call_once</span><span class=\"w\"></span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a55dd71d5fb0ec5a6a3a9e8c27b2127ba491ce52</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">ops</span><span class=\"o\">/</span><span class=\"n\">function</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">248</span>:<span class=\"mi\">5</span><span class=\"w\"></span>\n</code></pre></div>\n<p>&lt;/details&gt;</p>\n</blockquote>",
        "id": 302341474,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1664915399
    },
    {
        "content": "<p>nivkner edited a <a href=\"https://github.com/bytecodealliance/wasmtime/pull/4953#issuecomment-1267541924\">comment</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/4953\">issue #4953</a>:</p>\n<blockquote>\n<p>the following code compiles without error when setting <code>use_egraphs=false</code> but produces an error when <code>use_egraphs=true</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">target</span><span class=\"w\"> </span><span class=\"n\">x86_64</span><span class=\"w\"></span>\n\n<span class=\"n\">function</span><span class=\"w\"> </span><span class=\"n\">u0</span>:<span class=\"mi\">1302</span><span class=\"p\">(</span><span class=\"kt\">i64</span><span class=\"p\">)</span><span class=\"w\"> </span>-&gt; <span class=\"kt\">i64</span> <span class=\"nc\">system_v</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n\n<span class=\"w\">        </span><span class=\"n\">block0</span><span class=\"p\">(</span><span class=\"n\">v0</span>: <span class=\"kt\">i64</span><span class=\"p\">)</span>:\n                <span class=\"nc\">v9</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">atomic_rmw</span><span class=\"p\">.</span><span class=\"kt\">i64</span><span class=\"w\"> </span><span class=\"n\">add</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"w\"></span>\n<span class=\"w\">                </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"w\"></span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n</code></pre></div>\n<p>the error is</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">thread</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"na\">main</span><span class=\"o\">'</span><span class=\"w\"> </span><span class=\"n\">panicked</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"na\">index</span><span class=\"w\"> </span><span class=\"n\">out</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">bounds</span>: <span class=\"nc\">the</span><span class=\"w\"> </span><span class=\"n\">len</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">but</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">index</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">'</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">user</span><span class=\"o\">/</span><span class=\"n\">Documents</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">/</span><span class=\"n\">target</span><span class=\"o\">/</span><span class=\"n\">debug</span><span class=\"o\">/</span><span class=\"n\">build</span><span class=\"o\">/</span><span class=\"n\">cranelift</span><span class=\"o\">-</span><span class=\"n\">codegen</span><span class=\"o\">-</span><span class=\"n\">ae89adb74262e952</span><span class=\"o\">/</span><span class=\"n\">out</span><span class=\"o\">/</span><span class=\"n\">opcodes</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">1979</span>:<span class=\"mi\">39</span><span class=\"w\"></span>\n</code></pre></div>\n<p>&lt;details&gt;<br>\n&lt;summary&gt;backtrace&lt;/summary&gt;</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">stack</span><span class=\"w\"> </span><span class=\"n\">backtrace</span>:\n   <span class=\"mi\">0</span>: <span class=\"nc\">rust_begin_unwind</span><span class=\"w\"></span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a55dd71d5fb0ec5a6a3a9e8c27b2127ba491ce52</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">panicking</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">584</span>:<span class=\"mi\">5</span><span class=\"w\"></span>\n<span class=\"w\">   </span><span class=\"mi\">1</span>: <span class=\"nc\">core</span>::<span class=\"n\">panicking</span>::<span class=\"n\">panic_fmt</span><span class=\"w\"></span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a55dd71d5fb0ec5a6a3a9e8c27b2127ba491ce52</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">panicking</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">142</span>:<span class=\"mi\">14</span><span class=\"w\"></span>\n<span class=\"w\">   </span><span class=\"mi\">2</span>: <span class=\"nc\">core</span>::<span class=\"n\">panicking</span>::<span class=\"n\">panic_bounds_check</span><span class=\"w\"></span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a55dd71d5fb0ec5a6a3a9e8c27b2127ba491ce52</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">panicking</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">84</span>:<span class=\"mi\">5</span><span class=\"w\"></span>\n<span class=\"w\">   </span><span class=\"mi\">3</span>: <span class=\"nc\">cranelift_codegen</span>::<span class=\"n\">ir</span>::<span class=\"n\">instructions</span>::<span class=\"n\">InstructionImms</span>::<span class=\"n\">with_args</span><span class=\"w\"></span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">target</span><span class=\"o\">/</span><span class=\"n\">debug</span><span class=\"o\">/</span><span class=\"n\">build</span><span class=\"o\">/</span><span class=\"n\">cranelift</span><span class=\"o\">-</span><span class=\"n\">codegen</span><span class=\"o\">-</span><span class=\"n\">ae89adb74262e952</span><span class=\"o\">/</span><span class=\"n\">out</span><span class=\"o\">/</span><span class=\"n\">opcodes</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">1979</span>:<span class=\"mi\">39</span><span class=\"w\"></span>\n<span class=\"w\">   </span><span class=\"mi\">4</span>: <span class=\"nc\">cranelift_codegen</span>::<span class=\"n\">egraph</span>::<span class=\"n\">elaborate</span>::<span class=\"n\">Elaborator</span>::<span class=\"n\">add_node</span><span class=\"w\"></span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">cranelift</span><span class=\"o\">/</span><span class=\"n\">codegen</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">egraph</span><span class=\"o\">/</span><span class=\"n\">elaborate</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">197</span>:<span class=\"mi\">17</span><span class=\"w\"></span>\n<span class=\"w\">   </span><span class=\"mi\">5</span>: <span class=\"nc\">cranelift_codegen</span>::<span class=\"n\">egraph</span>::<span class=\"n\">elaborate</span>::<span class=\"n\">Elaborator</span>::<span class=\"n\">process_elab_stack</span><span class=\"w\"></span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">cranelift</span><span class=\"o\">/</span><span class=\"n\">codegen</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">egraph</span><span class=\"o\">/</span><span class=\"n\">elaborate</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">445</span>:<span class=\"mi\">35</span><span class=\"w\"></span>\n<span class=\"w\">   </span><span class=\"mi\">6</span>: <span class=\"nc\">cranelift_codegen</span>::<span class=\"n\">egraph</span>::<span class=\"n\">elaborate</span>::<span class=\"n\">Elaborator</span>::<span class=\"n\">elaborate_eclass_use</span><span class=\"w\"></span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">cranelift</span><span class=\"o\">/</span><span class=\"n\">codegen</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">egraph</span><span class=\"o\">/</span><span class=\"n\">elaborate</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">285</span>:<span class=\"mi\">9</span><span class=\"w\"></span>\n<span class=\"w\">   </span><span class=\"mi\">7</span>: <span class=\"nc\">cranelift_codegen</span>::<span class=\"n\">egraph</span>::<span class=\"n\">elaborate</span>::<span class=\"n\">Elaborator</span>::<span class=\"n\">elaborate_block</span><span class=\"w\"></span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">cranelift</span><span class=\"o\">/</span><span class=\"n\">codegen</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">egraph</span><span class=\"o\">/</span><span class=\"n\">elaborate</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">513</span>:<span class=\"mi\">13</span><span class=\"w\"></span>\n<span class=\"w\">   </span><span class=\"mi\">8</span>: <span class=\"nc\">cranelift_codegen</span>::<span class=\"n\">egraph</span>::<span class=\"n\">elaborate</span>::<span class=\"n\">Elaborator</span>::<span class=\"n\">elaborate_domtree</span><span class=\"w\"></span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">cranelift</span><span class=\"o\">/</span><span class=\"n\">codegen</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">egraph</span><span class=\"o\">/</span><span class=\"n\">elaborate</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">534</span>:<span class=\"mi\">21</span><span class=\"w\"></span>\n<span class=\"w\">   </span><span class=\"mi\">9</span>: <span class=\"nc\">cranelift_codegen</span>::<span class=\"n\">egraph</span>::<span class=\"n\">elaborate</span>::<span class=\"n\">Elaborator</span>::<span class=\"n\">elaborate</span><span class=\"w\"></span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">cranelift</span><span class=\"o\">/</span><span class=\"n\">codegen</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">egraph</span><span class=\"o\">/</span><span class=\"n\">elaborate</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">585</span>:<span class=\"mi\">9</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"mi\">10</span>: <span class=\"nc\">cranelift_codegen</span>::<span class=\"n\">egraph</span>::<span class=\"n\">FuncEGraph</span>::<span class=\"n\">elaborate</span><span class=\"w\"></span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">cranelift</span><span class=\"o\">/</span><span class=\"n\">codegen</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">egraph</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">348</span>:<span class=\"mi\">9</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"mi\">11</span>: <span class=\"nc\">cranelift_codegen</span>::<span class=\"n\">context</span>::<span class=\"n\">Context</span>::<span class=\"n\">optimize</span><span class=\"w\"></span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">cranelift</span><span class=\"o\">/</span><span class=\"n\">codegen</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">context</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">203</span>:<span class=\"mi\">13</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"mi\">12</span>: <span class=\"nc\">cranelift_codegen</span>::<span class=\"n\">context</span>::<span class=\"n\">Context</span>::<span class=\"n\">compile_stencil</span><span class=\"w\"></span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">cranelift</span><span class=\"o\">/</span><span class=\"n\">codegen</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">context</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">149</span>:<span class=\"mi\">13</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"mi\">13</span>: <span class=\"nc\">cranelift_codegen</span>::<span class=\"n\">context</span>::<span class=\"n\">Context</span>::<span class=\"n\">compile</span><span class=\"w\"></span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">cranelift</span><span class=\"o\">/</span><span class=\"n\">codegen</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">context</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">224</span>:<span class=\"mi\">23</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"mi\">14</span>: <span class=\"nc\">cranelift_codegen</span>::<span class=\"n\">context</span>::<span class=\"n\">Context</span>::<span class=\"n\">compile_and_emit</span><span class=\"w\"></span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">cranelift</span><span class=\"o\">/</span><span class=\"n\">codegen</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">context</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">132</span>:<span class=\"mi\">29</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"mi\">15</span>: <span class=\"nc\">clif_util</span>::<span class=\"n\">compile</span>::<span class=\"n\">handle_module</span><span class=\"w\"></span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">cranelift</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">compile</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">71</span>:<span class=\"mi\">33</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"mi\">16</span>: <span class=\"nc\">clif_util</span>::<span class=\"n\">compile</span>::<span class=\"n\">run</span><span class=\"w\"></span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">cranelift</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">compile</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">46</span>:<span class=\"mi\">9</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"mi\">17</span>: <span class=\"nc\">clif_util</span>::<span class=\"n\">main</span><span class=\"w\"></span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">cranelift</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">clif</span><span class=\"o\">-</span><span class=\"n\">util</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">106</span>:<span class=\"mi\">33</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"mi\">18</span>: <span class=\"nc\">core</span>::<span class=\"n\">ops</span>::<span class=\"n\">function</span>::<span class=\"nb\">FnOnce</span>::<span class=\"n\">call_once</span><span class=\"w\"></span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a55dd71d5fb0ec5a6a3a9e8c27b2127ba491ce52</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">ops</span><span class=\"o\">/</span><span class=\"n\">function</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">248</span>:<span class=\"mi\">5</span><span class=\"w\"></span>\n</code></pre></div>\n<p>&lt;/details&gt;</p>\n</blockquote>",
        "id": 302341876,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1664915525
    },
    {
        "content": "<p>nivkner edited a <a href=\"https://github.com/bytecodealliance/wasmtime/pull/4953#issuecomment-1267541924\">comment</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/4953\">issue #4953</a>:</p>\n<blockquote>\n<p>the following code compiles without error when setting <code>use_egraphs=false</code> but produces an error when <code>use_egraphs=true</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">target</span><span class=\"w\"> </span><span class=\"n\">x86_64</span><span class=\"w\"></span>\n\n<span class=\"n\">function</span><span class=\"w\"> </span><span class=\"n\">u0</span>:<span class=\"mi\">1302</span><span class=\"p\">(</span><span class=\"kt\">i64</span><span class=\"p\">)</span><span class=\"w\"> </span>-&gt; <span class=\"kt\">i64</span> <span class=\"nc\">system_v</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n\n<span class=\"w\">        </span><span class=\"n\">block0</span><span class=\"p\">(</span><span class=\"n\">v0</span>: <span class=\"kt\">i64</span><span class=\"p\">)</span>:\n                <span class=\"nc\">v9</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">atomic_rmw</span><span class=\"p\">.</span><span class=\"kt\">i64</span><span class=\"w\"> </span><span class=\"n\">add</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"w\"></span>\n<span class=\"w\">                </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"w\"></span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n</code></pre></div>\n<p>the error is</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">thread</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"na\">main</span><span class=\"o\">'</span><span class=\"w\"> </span><span class=\"n\">panicked</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"na\">index</span><span class=\"w\"> </span><span class=\"n\">out</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">bounds</span>: <span class=\"nc\">the</span><span class=\"w\"> </span><span class=\"n\">len</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">but</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">index</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"o\">'</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">user</span><span class=\"o\">/</span><span class=\"n\">Documents</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">/</span><span class=\"n\">target</span><span class=\"o\">/</span><span class=\"n\">debug</span><span class=\"o\">/</span><span class=\"n\">build</span><span class=\"o\">/</span><span class=\"n\">cranelift</span><span class=\"o\">-</span><span class=\"n\">codegen</span><span class=\"o\">-</span><span class=\"n\">ae89adb74262e952</span><span class=\"o\">/</span><span class=\"n\">out</span><span class=\"o\">/</span><span class=\"n\">opcodes</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">1979</span>:<span class=\"mi\">39</span><span class=\"w\"></span>\n</code></pre></div>\n<p>&lt;details&gt;<br>\n&lt;summary&gt;backtrace&lt;/summary&gt;</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">stack</span><span class=\"w\"> </span><span class=\"n\">backtrace</span>:\n   <span class=\"mi\">0</span>: <span class=\"nc\">rust_begin_unwind</span><span class=\"w\"></span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a55dd71d5fb0ec5a6a3a9e8c27b2127ba491ce52</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">panicking</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">584</span>:<span class=\"mi\">5</span><span class=\"w\"></span>\n<span class=\"w\">   </span><span class=\"mi\">1</span>: <span class=\"nc\">core</span>::<span class=\"n\">panicking</span>::<span class=\"n\">panic_fmt</span><span class=\"w\"></span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a55dd71d5fb0ec5a6a3a9e8c27b2127ba491ce52</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">panicking</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">142</span>:<span class=\"mi\">14</span><span class=\"w\"></span>\n<span class=\"w\">   </span><span class=\"mi\">2</span>: <span class=\"nc\">core</span>::<span class=\"n\">panicking</span>::<span class=\"n\">panic_bounds_check</span><span class=\"w\"></span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a55dd71d5fb0ec5a6a3a9e8c27b2127ba491ce52</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">panicking</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">84</span>:<span class=\"mi\">5</span><span class=\"w\"></span>\n<span class=\"w\">   </span><span class=\"mi\">3</span>: <span class=\"nc\">cranelift_codegen</span>::<span class=\"n\">ir</span>::<span class=\"n\">instructions</span>::<span class=\"n\">InstructionImms</span>::<span class=\"n\">with_args</span><span class=\"w\"></span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">target</span><span class=\"o\">/</span><span class=\"n\">debug</span><span class=\"o\">/</span><span class=\"n\">build</span><span class=\"o\">/</span><span class=\"n\">cranelift</span><span class=\"o\">-</span><span class=\"n\">codegen</span><span class=\"o\">-</span><span class=\"n\">ae89adb74262e952</span><span class=\"o\">/</span><span class=\"n\">out</span><span class=\"o\">/</span><span class=\"n\">opcodes</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">1979</span>:<span class=\"mi\">39</span><span class=\"w\"></span>\n<span class=\"w\">   </span><span class=\"mi\">4</span>: <span class=\"nc\">cranelift_codegen</span>::<span class=\"n\">egraph</span>::<span class=\"n\">elaborate</span>::<span class=\"n\">Elaborator</span>::<span class=\"n\">add_node</span><span class=\"w\"></span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">cranelift</span><span class=\"o\">/</span><span class=\"n\">codegen</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">egraph</span><span class=\"o\">/</span><span class=\"n\">elaborate</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">197</span>:<span class=\"mi\">17</span><span class=\"w\"></span>\n<span class=\"w\">   </span><span class=\"mi\">5</span>: <span class=\"nc\">cranelift_codegen</span>::<span class=\"n\">egraph</span>::<span class=\"n\">elaborate</span>::<span class=\"n\">Elaborator</span>::<span class=\"n\">process_elab_stack</span><span class=\"w\"></span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">cranelift</span><span class=\"o\">/</span><span class=\"n\">codegen</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">egraph</span><span class=\"o\">/</span><span class=\"n\">elaborate</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">445</span>:<span class=\"mi\">35</span><span class=\"w\"></span>\n<span class=\"w\">   </span><span class=\"mi\">6</span>: <span class=\"nc\">cranelift_codegen</span>::<span class=\"n\">egraph</span>::<span class=\"n\">elaborate</span>::<span class=\"n\">Elaborator</span>::<span class=\"n\">elaborate_eclass_use</span><span class=\"w\"></span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">cranelift</span><span class=\"o\">/</span><span class=\"n\">codegen</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">egraph</span><span class=\"o\">/</span><span class=\"n\">elaborate</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">285</span>:<span class=\"mi\">9</span><span class=\"w\"></span>\n<span class=\"w\">   </span><span class=\"mi\">7</span>: <span class=\"nc\">cranelift_codegen</span>::<span class=\"n\">egraph</span>::<span class=\"n\">elaborate</span>::<span class=\"n\">Elaborator</span>::<span class=\"n\">elaborate_block</span><span class=\"w\"></span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">cranelift</span><span class=\"o\">/</span><span class=\"n\">codegen</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">egraph</span><span class=\"o\">/</span><span class=\"n\">elaborate</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">513</span>:<span class=\"mi\">13</span><span class=\"w\"></span>\n<span class=\"w\">   </span><span class=\"mi\">8</span>: <span class=\"nc\">cranelift_codegen</span>::<span class=\"n\">egraph</span>::<span class=\"n\">elaborate</span>::<span class=\"n\">Elaborator</span>::<span class=\"n\">elaborate_domtree</span><span class=\"w\"></span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">cranelift</span><span class=\"o\">/</span><span class=\"n\">codegen</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">egraph</span><span class=\"o\">/</span><span class=\"n\">elaborate</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">534</span>:<span class=\"mi\">21</span><span class=\"w\"></span>\n<span class=\"w\">   </span><span class=\"mi\">9</span>: <span class=\"nc\">cranelift_codegen</span>::<span class=\"n\">egraph</span>::<span class=\"n\">elaborate</span>::<span class=\"n\">Elaborator</span>::<span class=\"n\">elaborate</span><span class=\"w\"></span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">cranelift</span><span class=\"o\">/</span><span class=\"n\">codegen</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">egraph</span><span class=\"o\">/</span><span class=\"n\">elaborate</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">585</span>:<span class=\"mi\">9</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"mi\">10</span>: <span class=\"nc\">cranelift_codegen</span>::<span class=\"n\">egraph</span>::<span class=\"n\">FuncEGraph</span>::<span class=\"n\">elaborate</span><span class=\"w\"></span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">cranelift</span><span class=\"o\">/</span><span class=\"n\">codegen</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">egraph</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">348</span>:<span class=\"mi\">9</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"mi\">11</span>: <span class=\"nc\">cranelift_codegen</span>::<span class=\"n\">context</span>::<span class=\"n\">Context</span>::<span class=\"n\">optimize</span><span class=\"w\"></span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">cranelift</span><span class=\"o\">/</span><span class=\"n\">codegen</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">context</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">203</span>:<span class=\"mi\">13</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"mi\">12</span>: <span class=\"nc\">cranelift_codegen</span>::<span class=\"n\">context</span>::<span class=\"n\">Context</span>::<span class=\"n\">compile_stencil</span><span class=\"w\"></span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">cranelift</span><span class=\"o\">/</span><span class=\"n\">codegen</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">context</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">149</span>:<span class=\"mi\">13</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"mi\">13</span>: <span class=\"nc\">cranelift_codegen</span>::<span class=\"n\">context</span>::<span class=\"n\">Context</span>::<span class=\"n\">compile</span><span class=\"w\"></span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">cranelift</span><span class=\"o\">/</span><span class=\"n\">codegen</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">context</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">224</span>:<span class=\"mi\">23</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"mi\">14</span>: <span class=\"nc\">cranelift_codegen</span>::<span class=\"n\">context</span>::<span class=\"n\">Context</span>::<span class=\"n\">compile_and_emit</span><span class=\"w\"></span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">cranelift</span><span class=\"o\">/</span><span class=\"n\">codegen</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">context</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">132</span>:<span class=\"mi\">29</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"mi\">15</span>: <span class=\"nc\">clif_util</span>::<span class=\"n\">compile</span>::<span class=\"n\">handle_module</span><span class=\"w\"></span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">cranelift</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">compile</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">71</span>:<span class=\"mi\">33</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"mi\">16</span>: <span class=\"nc\">clif_util</span>::<span class=\"n\">compile</span>::<span class=\"n\">run</span><span class=\"w\"></span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">cranelift</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">compile</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">46</span>:<span class=\"mi\">9</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"mi\">17</span>: <span class=\"nc\">clif_util</span>::<span class=\"n\">main</span><span class=\"w\"></span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">cranelift</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">clif</span><span class=\"o\">-</span><span class=\"n\">util</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">106</span>:<span class=\"mi\">33</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"mi\">18</span>: <span class=\"nc\">core</span>::<span class=\"n\">ops</span>::<span class=\"n\">function</span>::<span class=\"nb\">FnOnce</span>::<span class=\"n\">call_once</span><span class=\"w\"></span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a55dd71d5fb0ec5a6a3a9e8c27b2127ba491ce52</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">ops</span><span class=\"o\">/</span><span class=\"n\">function</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">248</span>:<span class=\"mi\">5</span><span class=\"w\"></span>\n</code></pre></div>\n<p>&lt;/details&gt;</p>\n<p>also reduced from <code>rustc_codegen_cranelift</code> output</p>\n</blockquote>",
        "id": 302342032,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1664915585
    },
    {
        "content": "<p>cfallin <a href=\"https://github.com/bytecodealliance/wasmtime/pull/4953#issuecomment-1267600329\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/4953\">issue #4953</a>:</p>\n<blockquote>\n<blockquote>\n<p>the following code compiles without error when setting use_egraphs=false but produces an error when use_egraphs=true:</p>\n</blockquote>\n<p>Thanks! Fixed now -- atomic ops were incorrectly being handled as ordinary loads by the alias-analysis machinery in egraph optimization.</p>\n</blockquote>",
        "id": 302350703,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1664919119
    },
    {
        "content": "<p>cfallin <a href=\"https://github.com/bytecodealliance/wasmtime/pull/4953#issuecomment-1270723215\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/4953\">issue #4953</a>:</p>\n<blockquote>\n<p>Thanks @jameysharp! I've addressed your comments so far and merged the latest <code>main</code> in again (including resolving overlaps in the current mid-end rules, as overlap checking is now on by default). Happy to address any other comments as you have them.</p>\n</blockquote>",
        "id": 302745154,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1665092115
    },
    {
        "content": "<p>nivkner <a href=\"https://github.com/bytecodealliance/wasmtime/pull/4953#issuecomment-1270935417\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/4953\">issue #4953</a>:</p>\n<blockquote>\n<p>when modifying <a href=\"https://github.com/bjorn3/rustc_codegen_cranelift\">https://github.com/bjorn3/rustc_codegen_cranelift</a> to use this PR, and running the tests of <code>rand_chacha</code> using <code>cargo-clif</code> as described in the <code>rustc_codegen_cranelift</code> repo,<br>\nwithout this PR all the tests pass, with this PR <code>test_chacha_true_values_c</code> fails.</p>\n</blockquote>",
        "id": 302765309,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1665103914
    },
    {
        "content": "<p>cfallin <a href=\"https://github.com/bytecodealliance/wasmtime/pull/4953#issuecomment-1271030659\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/4953\">issue #4953</a>:</p>\n<blockquote>\n<blockquote>\n<p>when modifying <a href=\"https://github.com/bjorn3/rustc_codegen_cranelift\">https://github.com/bjorn3/rustc_codegen_cranelift</a> to use this PR, and running the tests of <code>rand_chacha</code> using <code>cargo-clif</code> as described in the <code>rustc_codegen_cranelift</code> repo,<br>\nwithout this PR all the tests pass, with this PR <code>test_chacha_true_values_c</code> fails.</p>\n</blockquote>\n<p>Could you see if you can minimize this to a CLIF file? Or at least, provide more details on the failure?</p>\n<p>Reports from out-of-repo users are absolutely valuable, but are hard to act upon: generally we should strive for development of Cranelift to require only the Cranelift repo, and if failures are seen only outside of the repo, that means we need more tests in-repo. We definitely should not have to create a cg\\_clif development setup to chase down bugs. If/when a bug report with sufficient detail exists, we can work through it.</p>\n<p>Thank you for trying this out, though.</p>\n</blockquote>",
        "id": 302772338,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1665109808
    },
    {
        "content": "<p>cfallin <a href=\"https://github.com/bytecodealliance/wasmtime/pull/4953#issuecomment-1271856599\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/4953\">issue #4953</a>:</p>\n<blockquote>\n<p>@jameysharp I've addressed everything except for the one open thread above; thanks!</p>\n</blockquote>",
        "id": 302900075,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1665163486
    },
    {
        "content": "<p>cfallin <a href=\"https://github.com/bytecodealliance/wasmtime/pull/4953#issuecomment-1272167766\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/4953\">issue #4953</a>:</p>\n<blockquote>\n<p>Just merged in <code>main</code> once more. Hopefully that's the last merge from <code>main</code> into this PR, if all goes well :-) @jameysharp I'm eagerly awaiting any more comments you have!</p>\n</blockquote>",
        "id": 302950284,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1665187055
    },
    {
        "content": "<p>nivkner edited a <a href=\"https://github.com/bytecodealliance/wasmtime/pull/4953#issuecomment-1270935417\">comment</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/4953\">issue #4953</a>:</p>\n<blockquote>\n<p>when modifying <a href=\"https://github.com/bjorn3/rustc_codegen_cranelift\">https://github.com/bjorn3/rustc_codegen_cranelift</a> to use this PR, and running the tests of <code>rand_chacha</code> using <code>cargo-clif</code> as described in the <code>rustc_codegen_cranelift</code> repo,<br>\nwithout this PR all the tests pass, with this PR <code>test_chacha_true_values_c</code> fails.</p>\n<p>EDIT: unable to reproduce the above bug as of e992197b405b8976094b26489955e271379fcda3.</p>\n</blockquote>",
        "id": 302994391,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1665224627
    },
    {
        "content": "<p>bjorn3 <a href=\"https://github.com/bytecodealliance/wasmtime/pull/4953#issuecomment-1273754408\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/4953\">issue #4953</a>:</p>\n<blockquote>\n<p>To be clear this doesn't change anything if the respective setting isn't explicitly enabled? If it does change things I would like to test it with cg_clif first tomorrow.</p>\n</blockquote>",
        "id": 303319058,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1665432199
    },
    {
        "content": "<p>cfallin <a href=\"https://github.com/bytecodealliance/wasmtime/pull/4953#issuecomment-1273756082\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/4953\">issue #4953</a>:</p>\n<blockquote>\n<blockquote>\n<p>To be clear this doesn't change anything if the respective setting isn't explicitly enabled? If it does change things I would like to test it with cg_clif first tomorrow.</p>\n</blockquote>\n<p>Yes, there is no change by default; the option has to be specifically enabled. At some later point we'll want to turn it on by default but only after it's tested and mature.</p>\n</blockquote>",
        "id": 303319256,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1665432309
    },
    {
        "content": "<p>cfallin <a href=\"https://github.com/bytecodealliance/wasmtime/pull/4953#issuecomment-1274101634\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/4953\">issue #4953</a>:</p>\n<blockquote>\n<blockquote>\n<p>Have you measured the performance impact of this PR with egraphs disabled? I see that ScopedHashMap is used by simple_gvn, which I was recently noticing takes a non-trivial amount of time. It looks to me like the ScopedHashMap changes should make some operations faster, so it could be an improvement, but it would be nice to check that it's not a regression.</p>\n</blockquote>\n<p>I did earlier on, and testing again just now with SpiderMonkey.wasm, I see, uh... a 6% speedup?</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">cfallin</span><span class=\"o\">@</span><span class=\"n\">min</span>:<span class=\"o\">~/</span><span class=\"n\">work</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"o\">%</span><span class=\"w\"> </span><span class=\"n\">RAYON_NUM_THREADS</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">hyperfine</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"p\">.</span><span class=\"n\">main</span><span class=\"w\"> </span><span class=\"n\">compile</span><span class=\"w\"> </span><span class=\"o\">../</span><span class=\"n\">wasm</span><span class=\"o\">-</span><span class=\"n\">tests</span><span class=\"o\">/</span><span class=\"n\">spidermonkey</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"o\">'</span><span class=\"w\"></span>\n<span class=\"n\">Benchmark</span><span class=\"w\"> </span><span class=\"mi\">1</span>: <span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"p\">.</span><span class=\"n\">main</span><span class=\"w\"> </span><span class=\"n\">compile</span><span class=\"w\"> </span><span class=\"o\">../</span><span class=\"n\">wasm</span><span class=\"o\">-</span><span class=\"n\">tests</span><span class=\"o\">/</span><span class=\"n\">spidermonkey</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"n\">Time</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">mean</span><span class=\"w\"> </span><span class=\"err\">±</span><span class=\"w\"> </span><span class=\"err\">σ</span><span class=\"p\">)</span>:      <span class=\"mf\">6.028</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"err\">±</span><span class=\"w\">  </span><span class=\"mf\">0.196</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\">    </span><span class=\"p\">[</span><span class=\"n\">User</span>: <span class=\"mf\">5.821</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">System</span>: <span class=\"mf\">0.157</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"p\">]</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"n\">Range</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">min</span><span class=\"w\"> </span><span class=\"err\">…</span><span class=\"w\"> </span><span class=\"n\">max</span><span class=\"p\">)</span>:    <span class=\"mf\">5.883</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"err\">…</span><span class=\"w\">  </span><span class=\"mf\">6.483</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\">    </span><span class=\"mi\">10</span><span class=\"w\"> </span><span class=\"n\">runs</span><span class=\"w\"></span>\n\n<span class=\"n\">cfallin</span><span class=\"o\">@</span><span class=\"n\">min</span>:<span class=\"o\">~/</span><span class=\"n\">work</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"o\">%</span><span class=\"w\"> </span><span class=\"n\">RAYON_NUM_THREADS</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">hyperfine</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"p\">.</span><span class=\"n\">egraph</span><span class=\"w\"> </span><span class=\"n\">compile</span><span class=\"w\"> </span><span class=\"o\">../</span><span class=\"n\">wasm</span><span class=\"o\">-</span><span class=\"n\">tests</span><span class=\"o\">/</span><span class=\"n\">spidermonkey</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"o\">'</span><span class=\"w\"></span>\n<span class=\"n\">Benchmark</span><span class=\"w\"> </span><span class=\"mi\">1</span>: <span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"p\">.</span><span class=\"n\">egraph</span><span class=\"w\"> </span><span class=\"n\">compile</span><span class=\"w\"> </span><span class=\"o\">../</span><span class=\"n\">wasm</span><span class=\"o\">-</span><span class=\"n\">tests</span><span class=\"o\">/</span><span class=\"n\">spidermonkey</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"n\">Time</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">mean</span><span class=\"w\"> </span><span class=\"err\">±</span><span class=\"w\"> </span><span class=\"err\">σ</span><span class=\"p\">)</span>:      <span class=\"mf\">5.761</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"err\">±</span><span class=\"w\">  </span><span class=\"mf\">0.030</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\">    </span><span class=\"p\">[</span><span class=\"n\">User</span>: <span class=\"mf\">5.613</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">System</span>: <span class=\"mf\">0.139</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"p\">]</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"n\">Range</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">min</span><span class=\"w\"> </span><span class=\"err\">…</span><span class=\"w\"> </span><span class=\"n\">max</span><span class=\"p\">)</span>:    <span class=\"mf\">5.702</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"err\">…</span><span class=\"w\">  </span><span class=\"mf\">5.808</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\">    </span><span class=\"mi\">10</span><span class=\"w\"> </span><span class=\"n\">runs</span><span class=\"w\"></span>\n</code></pre></div>\n<p>(That's measuring on my M1 Air laptop, pinned to 1 core but otherwise no special measures. I verified looking at the <code>context.rs</code> diff again that the list of passes being run is not any different. I suspect the difference could be at least partly due to the faster <code>ScopedHashMap</code> but I can look a bit deeper into this)</p>\n<blockquote>\n<p>I don't think I can review the code-motion changes in the ISLE preludes, on either the Rust or .isle sides. I tried some basic diffs but it looks like things are in a different order as well as being moved to different files.</p>\n</blockquote>\n<p>Yeah, sorry, that's a bit of a mess now due to all the rebasing -- there was a good amount of manual cherrypicking of new definitions. I'll see if I can clean up the diff a bit (given that this is hopefully merging soon there won't be other work that'll invalidate this with more conflicts later!).</p>\n<blockquote>\n<p>Ignoring those, I think I just have <a href=\"http://egraph.rs\">egraph.rs</a> and <a href=\"http://elaborate.rs\">elaborate.rs</a> left, which I'll have to tackle tomorrow.</p>\n</blockquote>\n<p>Thanks (and uh, bon voyage and good luck; those are some of the most exciting bits of this PR)!</p>\n</blockquote>",
        "id": 303361387,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1665465643
    },
    {
        "content": "<p>cfallin <a href=\"https://github.com/bytecodealliance/wasmtime/pull/4953#issuecomment-1275207197\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/4953\">issue #4953</a>:</p>\n<blockquote>\n<blockquote>\n<p>Yeah, sorry, that's a bit of a mess now due to all the rebasing -- there was a good amount of manual cherrypicking of new definitions. I'll see if I can clean up the diff a bit (given that this is hopefully merging soon there won't be other work that'll invalidate this with more conflicts later!).</p>\n</blockquote>\n<p>I've gone over the diff to the ISLE-side and Rust-side definitions of the prelude and ensured that the common bits, which are new files from git's point of view, now have contents that are strictly in the same order and exactly match the removed lines from the old (lowering-only) prelude. (Latest commit does some reordering to make this true.)</p>\n<p>(This involved a \"diff-of-diffs\" workflow and was a little ugly; and I wish git had better ways of showing code provenance for cross-file moves; but in the end at least I'm confident no definition was inadvertently missed or reverted to an older version.)</p>\n</blockquote>",
        "id": 303510434,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1665518433
    },
    {
        "content": "<p>cfallin <a href=\"https://github.com/bytecodealliance/wasmtime/pull/4953#issuecomment-1275433398\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/4953\">issue #4953</a>:</p>\n<blockquote>\n<p>Thanks so much for the detailed review -- it was really helpful!</p>\n<p>So ends one long saga, and begins another (actually using this thing) :-)</p>\n</blockquote>",
        "id": 303541789,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1665534663
    },
    {
        "content": "<p>jameysharp <a href=\"https://github.com/bytecodealliance/wasmtime/pull/4953#issuecomment-1275441255\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/4953\">issue #4953</a>:</p>\n<blockquote>\n<blockquote>\n<blockquote>\n<p>Have you measured the performance impact of this PR with egraphs disabled? I see that ScopedHashMap is used by simple_gvn, which I was recently noticing takes a non-trivial amount of time. It looks to me like the ScopedHashMap changes should make some operations faster, so it could be an improvement, but it would be nice to check that it's not a regression.</p>\n</blockquote>\n<p>I did earlier on, and testing again just now with SpiderMonkey.wasm, I see, uh... a 6% speedup?</p>\n</blockquote>\n<p>I was curious about this so I've just compared the current merge-base from main (d68ca3711) with this branch (ec8a1a932). I see a 1% improvement in compile time/CPU cycles/instructions retired on the bz2, pulldown-cmark, and spidermonkey benchmarks. Not 6% but definitely nice!</p>\n</blockquote>",
        "id": 303542955,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1665535484
    }
]