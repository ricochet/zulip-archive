[
    {
        "content": "<p><a href=\"https://github.com/puremourning\">puremourning</a> added the bug label to <a href=\"https://github.com/bytecodealliance/wasmtime/issues/9909\">Issue #9909</a>.</p>",
        "id": 491101061,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1735400796
    },
    {
        "content": "<p>puremourning opened <a href=\"https://github.com/bytecodealliance/wasmtime/issues/9909\">issue #9909</a>:</p>\n<blockquote>\n<p>According to the <a href=\"https://docs.wasmtime.dev/examples-c-debugging.html\">documentation</a> it should be possible to use a source/line debugger with guest code running inside the wasmtime VM.</p>\n<p>This works well for rust embeddings, but when using the <code>c-api</code> (or anything based on it, like <code>wasmtime-cpp</code>), the DWARF data is not exposed to the debugger.</p>\n<p>After a little investigation and debugging, this is because the <code>debug-builtins</code> cargo feature is not enabled in builds of the C api crate.</p>\n<h3>Test Case</h3>\n<p><a href=\"https://docs.wasmtime.dev/examples-c-debugging.html\">https://docs.wasmtime.dev/examples-c-debugging.html</a></p>\n<h3>Steps to Reproduce</h3>\n<ul>\n<li>build the C api:</li>\n</ul>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">cmake</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"n\">crates</span><span class=\"o\">/</span><span class=\"n\">c</span><span class=\"o\">-</span><span class=\"n\">api</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"n\">target</span><span class=\"o\">/</span><span class=\"n\">c</span><span class=\"o\">-</span><span class=\"n\">api</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">install</span><span class=\"o\">-</span><span class=\"n\">prefix</span><span class=\"w\"> </span><span class=\"s\">\"$(pwd)/artifacts\"</span><span class=\"w\"> </span><span class=\"err\">\\</span>\n<span class=\"w\">    </span><span class=\"o\">-</span><span class=\"n\">DCMAKE_BUILD_TYPE</span><span class=\"o\">=</span><span class=\"n\">Debug</span><span class=\"w\"> </span><span class=\"err\">\\</span>\n<span class=\"w\">    </span><span class=\"o\">-</span><span class=\"n\">DCMAKE_EXPORT_COMPILE_COMMANDS</span><span class=\"o\">=</span><span class=\"n\">ON</span>\n<span class=\"n\">cmake</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">build</span><span class=\"w\"> </span><span class=\"n\">target</span><span class=\"o\">/</span><span class=\"n\">c</span><span class=\"o\">-</span><span class=\"n\">api</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">parallel</span><span class=\"w\"> </span><span class=\"mi\">16</span>\n<span class=\"n\">cmake</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">install</span><span class=\"w\"> </span><span class=\"n\">target</span><span class=\"o\">/</span><span class=\"n\">c</span><span class=\"o\">-</span><span class=\"n\">api</span>\n</code></pre></div>\n<ul>\n<li>Build the example fib wasm</li>\n</ul>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">rustup</span><span class=\"w\"> </span><span class=\"n\">target</span><span class=\"w\"> </span><span class=\"n\">add</span><span class=\"w\"> </span><span class=\"n\">wasm32</span><span class=\"o\">-</span><span class=\"n\">unknown</span><span class=\"o\">-</span><span class=\"n\">unknown</span>\n<span class=\"n\">cargo</span><span class=\"w\"> </span><span class=\"n\">build</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">example</span><span class=\"o\">-</span><span class=\"n\">fib</span><span class=\"o\">-</span><span class=\"n\">debug</span><span class=\"o\">-</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">target</span><span class=\"w\"> </span><span class=\"n\">wasm32</span><span class=\"o\">-</span><span class=\"n\">unknown</span><span class=\"o\">-</span><span class=\"n\">unknown</span>\n</code></pre></div>\n<ul>\n<li>Build the example <code>main.c</code> above:</li>\n</ul>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">cd</span><span class=\"w\"> </span><span class=\"n\">examples</span><span class=\"o\">/</span><span class=\"n\">fib</span><span class=\"o\">-</span><span class=\"n\">debug</span>\n<span class=\"n\">gcc</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"p\">.</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">I</span><span class=\"o\">../../</span><span class=\"n\">artifacts</span><span class=\"o\">/</span><span class=\"n\">include</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">L</span><span class=\"o\">../../</span><span class=\"n\">artifacts</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">Xlinker</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">rpath</span><span class=\"w\"> </span><span class=\"cp\">$(</span><span class=\"n\">pwd</span><span class=\"p\">)</span><span class=\"o\">/../../</span><span class=\"n\">artifacts</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">Xlinker</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">lwasmtime</span>\n</code></pre></div>\n<ul>\n<li>Run the example in debugger (e.g. lldb)</li>\n</ul>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">ben</span><span class=\"o\">@</span><span class=\"n\">BenMBP2021</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"o\">%</span><span class=\"w\"> </span><span class=\"n\">lldb</span><span class=\"w\"> </span><span class=\"n\">examples</span><span class=\"o\">/</span><span class=\"n\">fib</span><span class=\"o\">-</span><span class=\"n\">debug</span><span class=\"o\">/</span><span class=\"n\">a</span><span class=\"p\">.</span><span class=\"n\">out</span>\n<span class=\"p\">(</span><span class=\"n\">lldb</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">target</span><span class=\"w\"> </span><span class=\"n\">create</span><span class=\"w\"> </span><span class=\"s\">\"examples/fib-debug/a.out\"</span>\n<span class=\"n\">Current</span><span class=\"w\"> </span><span class=\"n\">executable</span><span class=\"w\"> </span><span class=\"n\">set</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"o\">'/</span><span class=\"n\">Users</span><span class=\"o\">/</span><span class=\"n\">ben</span><span class=\"o\">/</span><span class=\"n\">Development</span><span class=\"o\">/</span><span class=\"n\">wasm</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">/</span><span class=\"n\">examples</span><span class=\"o\">/</span><span class=\"n\">fib</span><span class=\"o\">-</span><span class=\"n\">debug</span><span class=\"o\">/</span><span class=\"n\">a</span><span class=\"p\">.</span><span class=\"n\">out</span><span class=\"o\">'</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">arm64</span><span class=\"p\">).</span>\n<span class=\"p\">(</span><span class=\"n\">lldb</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">settings</span><span class=\"w\"> </span><span class=\"n\">set</span><span class=\"w\"> </span><span class=\"n\">plugin</span><span class=\"p\">.</span><span class=\"n\">jit</span><span class=\"o\">-</span><span class=\"n\">loader</span><span class=\"p\">.</span><span class=\"n\">gdb</span><span class=\"p\">.</span><span class=\"n\">enable</span><span class=\"w\"> </span><span class=\"n\">on</span>\n\n<span class=\"p\">(</span><span class=\"n\">lldb</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"k\">break</span><span class=\"w\"> </span><span class=\"n\">set</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">examples</span><span class=\"o\">/</span><span class=\"n\">fib</span><span class=\"o\">-</span><span class=\"n\">debug</span><span class=\"o\">/</span><span class=\"n\">wasm</span><span class=\"o\">/</span><span class=\"n\">fib</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"mi\">3</span>\n<span class=\"n\">Breakpoint</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">no</span><span class=\"w\"> </span><span class=\"n\">locations</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">pending</span><span class=\"p\">).</span>\n<span class=\"n\">WARNING</span><span class=\"p\">:</span><span class=\"w\">  </span><span class=\"nc\">Unable</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">resolve</span><span class=\"w\"> </span><span class=\"n\">breakpoint</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">any</span><span class=\"w\"> </span><span class=\"n\">actual</span><span class=\"w\"> </span><span class=\"n\">locations</span><span class=\"p\">.</span>\n\n<span class=\"p\">(</span><span class=\"n\">lldb</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">run</span>\n<span class=\"n\">Process</span><span class=\"w\"> </span><span class=\"mi\">55426</span><span class=\"w\"> </span><span class=\"n\">launched</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"o\">'/</span><span class=\"n\">Users</span><span class=\"o\">/</span><span class=\"n\">ben</span><span class=\"o\">/</span><span class=\"n\">Development</span><span class=\"o\">/</span><span class=\"n\">wasm</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">/</span><span class=\"n\">examples</span><span class=\"o\">/</span><span class=\"n\">fib</span><span class=\"o\">-</span><span class=\"n\">debug</span><span class=\"o\">/</span><span class=\"n\">a</span><span class=\"p\">.</span><span class=\"n\">out</span><span class=\"o\">'</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">arm64</span><span class=\"p\">)</span>\n<span class=\"n\">Initializing</span><span class=\"o\">..</span><span class=\"p\">.</span>\n<span class=\"n\">Loading</span><span class=\"w\"> </span><span class=\"n\">binary</span><span class=\"o\">..</span><span class=\"p\">.</span>\n<span class=\"n\">Compiling</span><span class=\"w\"> </span><span class=\"n\">module</span><span class=\"o\">..</span><span class=\"p\">.</span>\n<span class=\"n\">Instantiating</span><span class=\"w\"> </span><span class=\"n\">module</span><span class=\"o\">..</span><span class=\"p\">.</span>\n<span class=\"n\">Calling</span><span class=\"w\"> </span><span class=\"n\">fib</span><span class=\"o\">..</span><span class=\"p\">.</span>\n<span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"n\">fib</span><span class=\"p\">(</span><span class=\"mi\">6</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">21</span>\n<span class=\"n\">Shutting</span><span class=\"w\"> </span><span class=\"n\">down</span><span class=\"o\">..</span><span class=\"p\">.</span>\n<span class=\"n\">Done</span><span class=\"p\">.</span>\n<span class=\"n\">Process</span><span class=\"w\"> </span><span class=\"mi\">55426</span><span class=\"w\"> </span><span class=\"n\">exited</span><span class=\"w\"> </span><span class=\"n\">with</span><span class=\"w\"> </span><span class=\"n\">status</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"mh\">0x00000000</span><span class=\"p\">)</span>\n</code></pre></div>\n<h3>Expected Results</h3>\n<ul>\n<li>Breakpoint is hit in the <a href=\"http://fib.rs\">fib.rs</a> file</li>\n</ul>\n<h3>Actual Results</h3>\n<ul>\n<li>No breakpoint is hit</li>\n</ul>\n<h3>Versions and Environment</h3>\n<p>Wasmtime version or commit: 01a43ed65d00d92807c7a8ae075ba9a948814c83</p>\n<p>Operating system: macOS</p>\n<p>Architecture: arm64</p>\n<h3>Extra Info</h3>\n<p>I made a quick patch to enable the feature, repeated the test above and it works.</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">ben</span><span class=\"o\">@</span><span class=\"n\">BenMBP2021</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"o\">%</span><span class=\"w\"> </span><span class=\"n\">lldb</span><span class=\"w\"> </span><span class=\"n\">examples</span><span class=\"o\">/</span><span class=\"n\">fib</span><span class=\"o\">-</span><span class=\"n\">debug</span><span class=\"o\">/</span><span class=\"n\">a</span><span class=\"p\">.</span><span class=\"n\">out</span>\n<span class=\"p\">(</span><span class=\"n\">lldb</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">target</span><span class=\"w\"> </span><span class=\"n\">create</span><span class=\"w\"> </span><span class=\"s\">\"examples/fib-debug/a.out\"</span>\n<span class=\"n\">Current</span><span class=\"w\"> </span><span class=\"n\">executable</span><span class=\"w\"> </span><span class=\"n\">set</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"o\">'/</span><span class=\"n\">Users</span><span class=\"o\">/</span><span class=\"n\">ben</span><span class=\"o\">/</span><span class=\"n\">Development</span><span class=\"o\">/</span><span class=\"n\">wasm</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">/</span><span class=\"n\">examples</span><span class=\"o\">/</span><span class=\"n\">fib</span><span class=\"o\">-</span><span class=\"n\">debug</span><span class=\"o\">/</span><span class=\"n\">a</span><span class=\"p\">.</span><span class=\"n\">out</span><span class=\"o\">'</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">arm64</span><span class=\"p\">).</span>\n<span class=\"p\">(</span><span class=\"n\">lldb</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"k\">break</span><span class=\"w\"> </span><span class=\"n\">set</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">Users</span><span class=\"o\">/</span><span class=\"n\">ben</span><span class=\"o\">/</span><span class=\"n\">Devel</span><span class=\"o\">^</span><span class=\"n\">Cment</span><span class=\"o\">/</span><span class=\"n\">wasm</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">/</span><span class=\"n\">examples</span><span class=\"o\">/</span><span class=\"n\">fib</span><span class=\"o\">-</span><span class=\"n\">debug</span><span class=\"o\">/</span><span class=\"n\">wasm</span><span class=\"o\">/</span><span class=\"n\">fib</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\">                                                </span><span class=\"n\">bck</span><span class=\"o\">?</span><span class=\"n\">options</span><span class=\"w\">                                                                                                                                 </span><span class=\"n\">b</span>\n<span class=\"p\">(</span><span class=\"n\">lldb</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">settings</span><span class=\"w\"> </span><span class=\"n\">set</span><span class=\"w\"> </span><span class=\"n\">plugin</span><span class=\"p\">.</span><span class=\"n\">jit</span><span class=\"o\">-</span><span class=\"n\">loader</span><span class=\"p\">.</span><span class=\"n\">gdb</span><span class=\"p\">.</span><span class=\"n\">enable</span><span class=\"w\"> </span><span class=\"n\">on</span>\n<span class=\"p\">(</span><span class=\"n\">lldb</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"k\">break</span><span class=\"w\"> </span><span class=\"n\">set</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">examples</span><span class=\"o\">/</span><span class=\"n\">fib</span><span class=\"o\">-</span><span class=\"n\">debug</span><span class=\"o\">/</span><span class=\"n\">wasm</span><span class=\"o\">/</span><span class=\"n\">fib</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">l</span><span class=\"w\"> </span><span class=\"mi\">3</span>\n<span class=\"n\">Breakpoint</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">no</span><span class=\"w\"> </span><span class=\"n\">locations</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">pending</span><span class=\"p\">).</span>\n<span class=\"n\">WARNING</span><span class=\"p\">:</span><span class=\"w\">  </span><span class=\"nc\">Unable</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">resolve</span><span class=\"w\"> </span><span class=\"n\">breakpoint</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">any</span><span class=\"w\"> </span><span class=\"n\">actual</span><span class=\"w\"> </span><span class=\"n\">locations</span><span class=\"p\">.</span>\n<span class=\"p\">(</span><span class=\"n\">lldb</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">run</span>\n<span class=\"n\">Process</span><span class=\"w\"> </span><span class=\"mi\">55596</span><span class=\"w\"> </span><span class=\"n\">launched</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"o\">'/</span><span class=\"n\">Users</span><span class=\"o\">/</span><span class=\"n\">ben</span><span class=\"o\">/</span><span class=\"n\">Development</span><span class=\"o\">/</span><span class=\"n\">wasm</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">/</span><span class=\"n\">examples</span><span class=\"o\">/</span><span class=\"n\">fib</span><span class=\"o\">-</span><span class=\"n\">debug</span><span class=\"o\">/</span><span class=\"n\">a</span><span class=\"p\">.</span><span class=\"n\">out</span><span class=\"o\">'</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">arm64</span><span class=\"p\">)</span>\n<span class=\"n\">Initializing</span><span class=\"o\">..</span><span class=\"p\">.</span>\n<span class=\"n\">Loading</span><span class=\"w\"> </span><span class=\"n\">binary</span><span class=\"o\">..</span><span class=\"p\">.</span>\n<span class=\"n\">Compiling</span><span class=\"w\"> </span><span class=\"n\">module</span><span class=\"o\">..</span><span class=\"p\">.</span>\n<span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">location</span><span class=\"w\"> </span><span class=\"n\">added</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">breakpoint</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"n\">Instantiating</span><span class=\"w\"> </span><span class=\"n\">module</span><span class=\"o\">..</span><span class=\"p\">.</span>\n<span class=\"n\">Calling</span><span class=\"w\"> </span><span class=\"n\">fib</span><span class=\"o\">..</span><span class=\"p\">.</span>\n<span class=\"n\">Process</span><span class=\"w\"> </span><span class=\"mi\">55596</span><span class=\"w\"> </span><span class=\"n\">stopped</span>\n\n<span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">thread</span><span class=\"w\"> </span><span class=\"p\">#</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">queue</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"na\">com</span><span class=\"p\">.</span><span class=\"n\">apple</span><span class=\"p\">.</span><span class=\"n\">main</span><span class=\"o\">-</span><span class=\"n\">thread</span><span class=\"o\">'</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">stop</span><span class=\"w\"> </span><span class=\"n\">reason</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">breakpoint</span><span class=\"w\"> </span><span class=\"mf\">1.1</span>\n<span class=\"w\">    </span><span class=\"n\">frame</span><span class=\"w\"> </span><span class=\"p\">#</span><span class=\"mi\">0</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mh\">0x0000000100090040</span><span class=\"w\"> </span><span class=\"n\">JIT</span><span class=\"p\">(</span><span class=\"mh\">0x1402a8000</span><span class=\"p\">)</span><span class=\"err\">`</span><span class=\"n\">fib</span><span class=\"p\">(</span><span class=\"n\">n</span><span class=\"o\">=</span><span class=\"mi\">6</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">fib</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">3</span><span class=\"p\">:</span><span class=\"mi\">17</span>\n<span class=\"w\">   </span><span class=\"mi\">1</span><span class=\"w\">    </span><span class=\"cp\">#[no_mangle]</span>\n<span class=\"w\">   </span><span class=\"mi\">2</span><span class=\"w\">    </span><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"k\">extern</span><span class=\"w\"> </span><span class=\"s\">\"C\"</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"w\"> </span><span class=\"nf\">fib</span><span class=\"p\">(</span><span class=\"n\">n</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"kt\">u32</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"kt\">u32</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\">        </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"k\">mut</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">;</span>\n<span class=\"w\">   </span><span class=\"mi\">4</span><span class=\"w\">        </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"k\">mut</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">;</span>\n<span class=\"w\">   </span><span class=\"mi\">5</span><span class=\"w\">        </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">..</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">   </span><span class=\"mi\">6</span><span class=\"w\">            </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"p\">;</span>\n<span class=\"w\">   </span><span class=\"mi\">7</span><span class=\"w\">            </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"p\">;</span>\n<span class=\"n\">JIT</span><span class=\"p\">(</span><span class=\"mh\">0x1402a8000</span><span class=\"p\">)</span><span class=\"err\">`</span><span class=\"n\">fib</span><span class=\"p\">:</span>\n<span class=\"p\">-&gt;</span><span class=\"w\">  </span><span class=\"mh\">0x100090040</span><span class=\"w\"> </span><span class=\"o\">&lt;+</span><span class=\"mi\">64</span><span class=\"o\">&gt;</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">mov</span><span class=\"w\">    </span><span class=\"n\">w0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">#</span><span class=\"mh\">0x1</span><span class=\"w\"> </span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"mi\">1</span>\n<span class=\"w\">    </span><span class=\"mh\">0x100090044</span><span class=\"w\"> </span><span class=\"o\">&lt;+</span><span class=\"mi\">68</span><span class=\"o\">&gt;</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">ldr</span><span class=\"w\">    </span><span class=\"n\">x1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">x2</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">#</span><span class=\"mh\">0x60</span><span class=\"p\">]</span>\n<span class=\"w\">    </span><span class=\"mh\">0x100090048</span><span class=\"w\"> </span><span class=\"o\">&lt;+</span><span class=\"mi\">72</span><span class=\"o\">&gt;</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">add</span><span class=\"w\">    </span><span class=\"n\">x1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">x1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">#</span><span class=\"mh\">0x10</span>\n<span class=\"w\">    </span><span class=\"mh\">0x10009004c</span><span class=\"w\"> </span><span class=\"o\">&lt;+</span><span class=\"mi\">76</span><span class=\"o\">&gt;</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"kt\">str</span><span class=\"w\">    </span><span class=\"nc\">w0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">x1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">w22</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">uxtw</span><span class=\"p\">]</span>\n<span class=\"n\">Target</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">a</span><span class=\"p\">.</span><span class=\"n\">out</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">stopped</span><span class=\"p\">.</span>\n<span class=\"n\">warning</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">This</span><span class=\"w\"> </span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">LLDB</span><span class=\"w\"> </span><span class=\"n\">has</span><span class=\"w\"> </span><span class=\"n\">no</span><span class=\"w\"> </span><span class=\"n\">plugin</span><span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">language</span><span class=\"w\"> </span><span class=\"s\">\"rust\"</span><span class=\"p\">.</span><span class=\"w\"> </span><span class=\"n\">Inspection</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">frame</span><span class=\"w\"> </span><span class=\"n\">variables</span><span class=\"w\"> </span><span class=\"n\">will</span><span class=\"w\"> </span><span class=\"n\">be</span><span class=\"w\"> </span><span class=\"n\">limited</span><span class=\"p\">.</span>\n<span class=\"p\">(</span><span class=\"n\">lldb</span><span class=\"p\">)</span>\n</code></pre></div>\n<p>Here's the trivial patch:</p>\n<div class=\"codehilite\" data-code-language=\"Diff\"><pre><span></span><code>commit 8f69c41d998ddb33b1d099b913f104cb93ba1b3d (HEAD -&gt; main)\nAuthor: Ben Jackson &lt;puremourning@gmail.com&gt;\nDate:   Sat Dec 28 15:31:54 2024 +0000\n\n<span class=\"w\"> </span>   Enable JIT DWARF info in c-api\n\n<span class=\"gh\">diff --git a/crates/c-api/Cargo.toml b/crates/c-api/Cargo.toml</span>\n<span class=\"gh\">index 84b7d45ed..d77312f42 100644</span>\n<span class=\"gd\">--- a/crates/c-api/Cargo.toml</span>\n<span class=\"gi\">+++ b/crates/c-api/Cargo.toml</span>\n<span class=\"gu\">@@ -56,5 +56,6 @@ gc-drc = [\"wasmtime/gc-drc\"]</span>\n<span class=\"w\"> </span>gc-null = [\"wasmtime/gc-null\"]\n<span class=\"w\"> </span>cranelift = ['wasmtime/cranelift']\n<span class=\"w\"> </span>winch = ['wasmtime/winch']\n<span class=\"gi\">+debug-builtins = ['wasmtime/debug-builtins']</span>\n<span class=\"w\"> </span># ... if you add a line above this be sure to change the other locations\n<span class=\"w\"> </span># marked WASMTIME_FEATURE_LIST\n<span class=\"gh\">diff --git a/crates/c-api/artifact/Cargo.toml b/crates/c-api/artifact/Cargo.toml</span>\n<span class=\"gh\">index 1eb6659ec..8aa846d23 100644</span>\n<span class=\"gd\">--- a/crates/c-api/artifact/Cargo.toml</span>\n<span class=\"gi\">+++ b/crates/c-api/artifact/Cargo.toml</span>\n<span class=\"gu\">@@ -38,6 +38,7 @@ default = [</span>\n<span class=\"w\"> </span>  'gc-null',\n<span class=\"w\"> </span>  'cranelift',\n<span class=\"w\"> </span>  'winch',\n<span class=\"gi\">+  'debug-builtins',</span>\n<span class=\"w\"> </span>  # ... if you add a line above this be sure to change the other locations\n<span class=\"w\"> </span>  # marked WASMTIME_FEATURE_LIST\n<span class=\"w\"> </span>]\n<span class=\"gu\">@@ -58,5 +59,6 @@ gc-drc = [\"wasmtime-c-api/gc-drc\"]</span>\n<span class=\"w\"> </span>gc-null = [\"wasmtime-c-api/gc-null\"]\n<span class=\"w\"> </span>cranelift = [\"wasmtime-c-api/cranelift\"]\n<span class=\"w\"> </span>winch = [\"wasmtime-c-api/winch\"]\n<span class=\"gi\">+debug-builtins = [\"wasmtime-c-api/debug-builtins\"]</span>\n<span class=\"w\"> </span># ... if you add a line above this be sure to read the comment at the end of\n<span class=\"w\"> </span># `default`\n<span class=\"gh\">diff --git a/crates/c-api/build.rs b/crates/c-api/build.rs</span>\n<span class=\"gh\">index b500fd1bf..12bc0b501 100644</span>\n<span class=\"gd\">--- a/crates/c-api/build.rs</span>\n<span class=\"gi\">+++ b/crates/c-api/build.rs</span>\n<span class=\"gu\">@@ -19,6 +19,7 @@ const FEATURES: &amp;[&amp;str] = &amp;[</span>\n<span class=\"w\"> </span>    \"GC_NULL\",\n<span class=\"w\"> </span>    \"CRANELIFT\",\n<span class=\"w\"> </span>    \"WINCH\",\n<span class=\"gi\">+    \"DEBUG_BUILTINS\",</span>\n<span class=\"w\"> </span>];\n<span class=\"w\"> </span>// ... if you add a line above this be sure to change the other locations\n<span class=\"w\"> </span>// marked WASMTIME_FEATURE_LIST\n<span class=\"gh\">diff --git a/crates/c-api/cmake/features.cmake b/crates/c-api/cmake/features.cmake</span>\n<span class=\"gh\">index 385c13965..727412a04 100644</span>\n<span class=\"gd\">--- a/crates/c-api/cmake/features.cmake</span>\n<span class=\"gi\">+++ b/crates/c-api/cmake/features.cmake</span>\n<span class=\"gu\">@@ -43,5 +43,6 @@ feature(gc-null ON)</span>\n<span class=\"w\"> </span>feature(async ON)\n<span class=\"w\"> </span>feature(cranelift ON)\n<span class=\"w\"> </span>feature(winch ON)\n<span class=\"gi\">+feature(debug-builtins ON)</span>\n<span class=\"w\"> </span># ... if you add a line above this be sure to change the other locations\n<span class=\"w\"> </span># marked WASMTIME_FEATURE_LIST\n<span class=\"gh\">diff --git a/crates/c-api/include/wasmtime/conf.h.in b/crates/c-api/include/wasmtime/conf.h.in</span>\n<span class=\"gh\">index 3dff987ac..03f4debf9 100644</span>\n<span class=\"gd\">--- a/crates/c-api/include/wasmtime/conf.h.in</span>\n<span class=\"gi\">+++ b/crates/c-api/include/wasmtime/conf.h.in</span>\n<span class=\"gu\">@@ -25,6 +25,7 @@</span>\n<span class=\"w\"> </span>#cmakedefine WASMTIME_FEATURE_ASYNC\n<span class=\"w\"> </span>#cmakedefine WASMTIME_FEATURE_CRANELIFT\n<span class=\"w\"> </span>#cmakedefine WASMTIME_FEATURE_WINCH\n<span class=\"gi\">+#cmakedefine WASMTIME_FEATURE_DEBUG_BUILTINS</span>\n<span class=\"w\"> </span>// ... if you add a line above this be sure to change the other locations\n<span class=\"w\"> </span>// marked WASMTIME_FEATURE_LIST\n</code></pre></div>\n<p>I'm not clear if the issue here is the feature _should_ be enabled, and the docs are right, or a decision was made to not enable it, and the docs are wrong, or if there is some other way to enable this feature in the C-api or other C embeddings.</p>\n</blockquote>",
        "id": 491101063,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1735400797
    }
]