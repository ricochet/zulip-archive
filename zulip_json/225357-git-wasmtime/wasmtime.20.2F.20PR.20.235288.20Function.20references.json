[
    {
        "content": "<p>CosineP opened <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288\">PR #5288</a> from <code>function-references</code> to <code>main</code>:</p>\n<blockquote>\n<p>&lt;!--</p>\n<p>Please ensure that the following steps are all taken care of before submitting<br>\nthe PR.</p>\n<ul>\n<li>\n<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>\n  here.</p>\n</li>\n<li>\n<p>[ ] A short description of what this does, why it is needed; if the<br>\n  description becomes long, the matter should probably be discussed in an issue<br>\n  first.</p>\n</li>\n<li>\n<p>[ ] This PR contains test cases, if meaningful.</p>\n</li>\n<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>\n  If you don't know who could review this, please indicate so. The list of<br>\n  suggested reviewers on the right can help you.</li>\n</ul>\n<p>Please ensure all communication adheres to the <a href=\"https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md\">code of\nconduct</a>.<br>\n--&gt;</p>\n<p>This patch, written by @dhil and I, implements the (complete) <a href=\"https://github.com/WebAssembly/function-references\">function references proposal</a>, forming the wasmtime side of the existing pull request <a href=\"https://github.com/bytecodealliance/wasm-tools/issues/701\">bytecodealliance/wasm-tools#701</a>.   It is missing some obvious things:</p>\n<ul>\n<li>call_ref is simply translated as a cranelift indirect_call.    A faster cranelift indirect call that does not check the callee signature can (and should) eventually be added and used.</li>\n<li>The wasm-tools PR has advanced past the version we depend on here.    We hope to update all at once, once the wasm-tools side has fully settled.    This will result in the removal of a number of ValType::Bot branches, the addition of the type annotation on call_ref, and a handful of other convenient things.    The version we depend on is called <a href=\"https://github.com/effect-handlers/wasm-tools/tree/func-ref-2\">func-ref-2</a>, if you need to reference it*.</li>\n<li>Wasmtime, too, has of course advanced past our parent.   I tried to rebase on the latest changes, but due to particular Cargo.toml changes, I think this will be much easier when we've retargetted to the latest wasm-tools#701 and can keep our dependencies consistent in the history</li>\n</ul>\n<p>Otherwise, things should be mostly obvious.    Typed function references are represented by the existing untyped function references.   Even though it's held up by wasm-tools, we ended up with a fairly polished changeset that we figured we could send out and get feedback on.    There's no rush on our end, as we've been happily using this in our typed continuations work for some time now.    But we're happy to discuss any changes, problems, or suggestions!</p>\n<p>\\* We added a public peek method to the validator to attain a signature for call_ref.   This is now unnecesary because call_ref comes with a type annotation, and will disappear fairly conveniently.</p>\n</blockquote>",
        "id": 310544692,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1668660164
    },
    {
        "content": "<p>CosineP edited <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288\">PR #5288</a> from <code>function-references</code> to <code>main</code>:</p>\n<blockquote>\n<p>&lt;!--</p>\n<p>Please ensure that the following steps are all taken care of before submitting<br>\nthe PR.</p>\n<ul>\n<li>\n<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>\n  here.</p>\n</li>\n<li>\n<p>[ ] A short description of what this does, why it is needed; if the<br>\n  description becomes long, the matter should probably be discussed in an issue<br>\n  first.</p>\n</li>\n<li>\n<p>[ ] This PR contains test cases, if meaningful.</p>\n</li>\n<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>\n  If you don't know who could review this, please indicate so. The list of<br>\n  suggested reviewers on the right can help you.</li>\n</ul>\n<p>Please ensure all communication adheres to the <a href=\"https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md\">code of\nconduct</a>.<br>\n--&gt;</p>\n<p>This patch, written by @dhil and I, implements the (complete) <a href=\"https://github.com/WebAssembly/function-references\">function references proposal</a>, forming the wasmtime side of the existing pull request <a href=\"https://github.com/bytecodealliance/wasm-tools/issues/701\">bytecodealliance/wasm-tools#701</a>.   It is missing some obvious things:</p>\n<ul>\n<li>call_ref is simply translated as a cranelift indirect_call.    A faster cranelift indirect call that does not check the callee signature can (and should) eventually be added and used.   Further, no null check is elided.</li>\n<li>The wasm-tools PR has advanced past the version we depend on here.    We hope to update all at once, once the wasm-tools side has fully settled.    This will result in the removal of a number of ValType::Bot branches, the addition of the type annotation on call_ref, and a handful of other convenient things.    The version we depend on is called <a href=\"https://github.com/effect-handlers/wasm-tools/tree/func-ref-2\">func-ref-2</a>, if you need to reference it*.</li>\n<li>Wasmtime, too, has of course advanced past our parent.   I tried to rebase on the latest changes, but due to particular Cargo.toml changes, I think this will be much easier when we've retargetted to the latest wasm-tools#701 and can keep our dependencies consistent in the history</li>\n</ul>\n<p>Otherwise, things should be mostly obvious.    Typed function references are represented by the existing untyped function references.   Even though it's held up by wasm-tools, we ended up with a fairly polished changeset that we figured we could send out and get feedback on.    There's no rush on our end, as we've been happily using this in our typed continuations work for some time now.    But we're happy to discuss any changes, problems, or suggestions!</p>\n<p>\\* We added a public peek method to the validator to attain a signature for call_ref.   This is now unnecesary because call_ref comes with a type annotation, and will disappear fairly conveniently.</p>\n</blockquote>",
        "id": 310544858,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1668660355
    },
    {
        "content": "<p>alexcrichton submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#pullrequestreview-1184566309\">PR review</a>.</p>",
        "id": 310645654,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1668702137
    },
    {
        "content": "<p>alexcrichton submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#pullrequestreview-1184566309\">PR review</a>.</p>",
        "id": 310645655,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1668702137
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1025373874\">PR review comment</a>:</p>\n<blockquote>\n<p>This feels sort of wrong in the sense that <code>R64</code> is going to be used to represent a family of types so it's not necessarily possible to go backwards from a cranelift type to a wasm type (like could be done historically). Reading over this thought this function is only used for <code>ModuleTranslationState::from_func_sigs</code> which I think is otherwise dead code. I opened <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5290\">https://github.com/bytecodealliance/wasmtime/pull/5290</a> to remove this code which should help address this.</p>\n</blockquote>",
        "id": 310645657,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1668702138
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1025362890\">PR review comment</a>:</p>\n<blockquote>\n<p>Could this perhaps reuse the <code>IndirectCallToNull</code>? While not technically the exact same error conditions it still captures the case that this comes up with <code>call_ref</code> to a <code>null</code> table entry.</p>\n</blockquote>",
        "id": 310645658,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1668702138
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1025368291\">PR review comment</a>:</p>\n<blockquote>\n<p>It's ok to skip this attribute, we don't run clippy in this repository on CI or such.</p>\n</blockquote>",
        "id": 310645659,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1668702138
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1025377009\">PR review comment</a>:</p>\n<blockquote>\n<p>I think that this is also dead code, which I've now added to <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5290\">https://github.com/bytecodealliance/wasmtime/pull/5290</a> to get removed.</p>\n</blockquote>",
        "id": 310645660,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1668702138
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1025366554\">PR review comment</a>:</p>\n<blockquote>\n<p>FWIW I think now that <code>CallRef</code> carries its type payload the need for <code>ty: Option&lt;ValType&gt;</code> will probably go away, although this won't otherwise change significantly I suspect.</p>\n</blockquote>",
        "id": 310645661,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1668702138
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1025369570\">PR review comment</a>:</p>\n<blockquote>\n<p>FWIW this is one of the reasons that I preferred to keep <code>Bot</code> out of the public API of <code>wasmparser</code> since it prevents consumers like this from having to have <code>panic!(...)</code> branches for something that shouldn't ever be reachable.</p>\n</blockquote>",
        "id": 310645662,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1668702138
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1025387738\">PR review comment</a>:</p>\n<blockquote>\n<p>Actually if we wanted to get _super_ clever here (which is totally ok if you'd rather not) I think that this check can be entirely skipped. The <code>.load()</code> below will segfault if the <code>callee</code> is a null pointer which we can catch in a signal handler to report a trap, which means that technically speaking we can skip the check entirely here. I think the codegen may need to get changed slightly since the <code>MemFlags::trusted</code> used when loading the <code>func_addr</code> may or may not be right (a Cranelift expert would want to weigh in).</p>\n<p>Anyway just a tiny optimization that probably doesn't matter too much in the grand scheme of things, and more than ok to defer to later.</p>\n</blockquote>",
        "id": 310645663,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1668702138
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1025402754\">PR review comment</a>:</p>\n<blockquote>\n<p>For this I think it's fine to generate a <code>Func</code> for a typed function index. There's no real way to propagate the type runtime type information into the Rust type system so I think it's best to return <code>Func</code> here and then embedders can used <code>.typed()</code> as today to get the typed view.</p>\n</blockquote>",
        "id": 310645664,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1668702138
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1025380378\">PR review comment</a>:</p>\n<blockquote>\n<p>I think it's ok to leave this as-is, and if it's ever a perf-issue we can always reach for a <code>SmallVec</code> here or something like that.</p>\n</blockquote>",
        "id": 310645665,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1668702138
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1025381835\">PR review comment</a>:</p>\n<blockquote>\n<p>Should This also match <code>WasmHeapType::Index(_)</code>?</p>\n<p>(if so could a test be added too?)</p>\n</blockquote>",
        "id": 310645666,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1668702138
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1025384997\">PR review comment</a>:</p>\n<blockquote>\n<p>I think that the translation here is actually almost-perfect. The <code>call_indirect</code> instruction in Cranelift isn't the same as the one in wasm and doesn't perform any type checks or anything, it's as raw as it gets. In that sense the performance of <code>call_ref</code> is only mildly hampered where if the callee is known to be non-null a null-check still happens. Otherwise though I think that the generation here should be optimal.</p>\n</blockquote>",
        "id": 310645667,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1668702138
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1025395988\">PR review comment</a>:</p>\n<blockquote>\n<p>I think definitely for the case of the the <code>wasmtime</code> crate's public API we'll want to hide <code>Bot</code>, even if it ends up getting exposed in <code>wasmparser</code>.</p>\n</blockquote>",
        "id": 310645668,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1668702138
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1025392797\">PR review comment</a>:</p>\n<blockquote>\n<p>I went ahead an opened <a href=\"https://github.com/bytecodealliance/wasmtime/issues/5291\">https://github.com/bytecodealliance/wasmtime/issues/5291</a> since this applies to <code>call_indirect</code> as well.</p>\n</blockquote>",
        "id": 310645669,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1668702138
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1025383002\">PR review comment</a>:</p>\n<blockquote>\n<p>Should <code>Index</code> be matched here as well?</p>\n</blockquote>",
        "id": 310645670,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1668702138
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1025398728\">PR review comment</a>:</p>\n<blockquote>\n<p>In retrospect, I think this might be better modeled as perhaps:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"k\">impl</span><span class=\"w\"> </span><span class=\"n\">ValType</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">EXTERNREF</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">..</span><span class=\"p\">.;</span><span class=\"w\"></span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n\n<span class=\"k\">impl</span><span class=\"w\"> </span><span class=\"n\">WasmRefType</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">EXTERN</span>: <span class=\"nc\">WasmRefType</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">..</span><span class=\"p\">.;</span><span class=\"w\"></span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n</code></pre></div>\n<p>basically just using associated <code>const</code>s to namespace things instead of splatting it into the module namespace here.</p>\n</blockquote>",
        "id": 310645671,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1668702139
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1025394229\">PR review comment</a>:</p>\n<blockquote>\n<p>I think that this condition isn't quite right, you'll probably want to <code>match</code> on the <code>heap_type</code> here and explicitly reject <code>externref</code> but both typed functions and normal functions should be able to fall through.</p>\n</blockquote>",
        "id": 310645672,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1668702139
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1025401183\">PR review comment</a>:</p>\n<blockquote>\n<p>This won't actually be stored as a field in <code>Config</code> but rather <code>self.features</code>, so this field can be omitted from the Wasmtime crate.</p>\n</blockquote>",
        "id": 310645673,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1668702139
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1025400509\">PR review comment</a>:</p>\n<blockquote>\n<p>This'll want to be omitted I believe until the proposal is stabilized.</p>\n</blockquote>",
        "id": 310645674,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1668702139
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1025399035\">PR review comment</a>:</p>\n<blockquote>\n<p>As a bit of a bikeshed, perhaps <code>RefType</code> instead of <code>Wasm*</code>?</p>\n</blockquote>",
        "id": 310645675,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1668702139
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1025409870\">PR review comment</a>:</p>\n<blockquote>\n<p>I think that this <code>match</code> is going to need to grow more cases or otherwise embedders can't interact with typed function tables in the embedder API. That's ok for a first pass and can be deferred to a future PR but it's functionality we'll eventually want to fill out.</p>\n</blockquote>",
        "id": 310645677,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1668702139
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1025407441\">PR review comment</a>:</p>\n<blockquote>\n<p>At the layer of the Wasmtime embedding here it's unfortunately not longer suitable to use a <code>u32</code> here since there's not actually any way to translate this <code>u32</code> to an actual type to inspect.</p>\n<p>This actually raises a particularly interesting embedding question for me, though, which is how an embedder is expected to invoke an exported function from a wasm module which takes a typed function reference as an argument (or returns such a result).</p>\n<p>I can talk more with y'all if you'd like for something like this, but the <code>u32</code> here more-or-less needs to become something like a <code>FuncType</code>, but not literally that given how lightweight <code>ValType</code> is supposed to be relative to hwo heavyweight <code>FuncType</code> is. We'll probably want some form of indexing or such but this is moving into the realm of relatively large-ish changes which y'all may want to defer to later if possible.</p>\n</blockquote>",
        "id": 310645679,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1668702139
    },
    {
        "content": "<p>fitzgen created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1025715729\">PR review comment</a>:</p>\n<blockquote>\n<p>This is due to some vestigial bits from when we had extended basic blocks instead of plain basic blocks. Because we have basic blocks, we can't add new non-block-terminating instructions after a <code>brz</code>. But also we don't currently have a two-way conditional branch instruction, so blocks ending in control flow splits have to end with something like <code>brz L1; jump L2</code> instead. We have general plans to clean this stuff up in the not super distant future, but thats the state of affairs for now.</p>\n</blockquote>",
        "id": 310697829,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1668718576
    },
    {
        "content": "<p>fitzgen submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#pullrequestreview-1185079496\">PR review</a>.</p>",
        "id": 310697830,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1668718577
    },
    {
        "content": "<p>fitzgen edited <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1025715729\">PR review comment</a>.</p>",
        "id": 310697863,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1668718594
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#pullrequestreview-1185096205\">PR review</a>.</p>",
        "id": 310699724,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1668719315
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1025734326\">PR review comment</a>:</p>\n<blockquote>\n<p>Indeed, we would want to remove the <code>trusted</code> flag here, if the load can trap, and this would require a bit more plumbing to emit the right trap code associated with this load's PC (it's no longer a heap-out-of-bounds). But this is probably an O(tens of lines)-sized change, not too bad. Happy to dig a bit and point out specific bits if you want to do this in a followup PR.</p>\n</blockquote>",
        "id": 310699726,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1668719315
    },
    {
        "content": "<p>fitzgen submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#pullrequestreview-1185084890\">PR review</a>.</p>",
        "id": 310703503,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1668720900
    },
    {
        "content": "<p>fitzgen submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#pullrequestreview-1185084890\">PR review</a>.</p>",
        "id": 310703505,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1668720900
    },
    {
        "content": "<p>fitzgen created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1025720628\">PR review comment</a>:</p>\n<blockquote>\n<p>Should this case be unreachable given that we've checked that the instruction is valid? If so, then this can be an <code>unreachable!()</code> instead. If not, then it should return a proper error instead of panicking.</p>\n</blockquote>",
        "id": 310703506,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1668720900
    },
    {
        "content": "<p>fitzgen created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1025749498\">PR review comment</a>:</p>\n<blockquote>\n<p>lol not the best situation, yes, but this is the one that is generally public-facing rather than an implementation detail, so it should really have Proper(tm) docs with punctuation and a helpful description and all that.</p>\n</blockquote>",
        "id": 310703507,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1668720900
    },
    {
        "content": "<p>fitzgen created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1025736879\">PR review comment</a>:</p>\n<blockquote>\n<p>Following up on Alex's question: do the spec tests for typed function references not exercise tables of typed function references (and all the various table operations on them like <code>table.fill</code>)? If so, that seems like something where it is worth sending a PR upstream for or at least filing an issue.</p>\n</blockquote>",
        "id": 310703508,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1668720900
    },
    {
        "content": "<p>fitzgen created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1025744337\">PR review comment</a>:</p>\n<blockquote>\n<p>Why is this a <code>TryFrom</code> impl instead of a <code>From</code> impl? It appears to be infallible.</p>\n</blockquote>",
        "id": 310703509,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1668720900
    },
    {
        "content": "<p>CosineP submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#pullrequestreview-1205521799\">PR review</a>.</p>",
        "id": 314150256,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1670285890
    },
    {
        "content": "<p>CosineP created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1040252011\">PR review comment</a>:</p>\n<blockquote>\n<p>Fortunately this whole expression disappears on merge because call_ref has gained a proper type annotation</p>\n</blockquote>",
        "id": 314150257,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1670285890
    },
    {
        "content": "<p>CosineP submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#pullrequestreview-1205535397\">PR review</a>.</p>",
        "id": 314151693,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1670286842
    },
    {
        "content": "<p>CosineP created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1040261402\">PR review comment</a>:</p>\n<blockquote>\n<p>Oh gosh I'm sorry haha, I guess this somehow made it through the \"rebase and sanitize 12am thoughts\" process</p>\n</blockquote>",
        "id": 314151703,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1670286842
    },
    {
        "content": "<p>CosineP updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288\">PR #5288</a> from <code>function-references</code> to <code>main</code>.</p>",
        "id": 314151736,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1670286858
    },
    {
        "content": "<p>CosineP submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#pullrequestreview-1206908002\">PR review</a>.</p>",
        "id": 314271829,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1670343731
    },
    {
        "content": "<p>CosineP created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1041185988\">PR review comment</a>:</p>\n<blockquote>\n<p>Should the pre-existing WasmType be renamed as well?</p>\n</blockquote>",
        "id": 314271830,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1670343731
    },
    {
        "content": "<p>CosineP updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288\">PR #5288</a> from <code>function-references</code> to <code>main</code>.</p>",
        "id": 314272286,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1670343867
    },
    {
        "content": "<p>dhil updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288\">PR #5288</a> from <code>function-references</code> to <code>main</code>.</p>",
        "id": 329762400,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1677169336
    },
    {
        "content": "<p>alexcrichton submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#pullrequestreview-1313875636\">PR review</a>.</p>",
        "id": 336555489,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1677263581
    },
    {
        "content": "<p>alexcrichton submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#pullrequestreview-1313875636\">PR review</a>.</p>",
        "id": 336555491,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1677263581
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1117283484\">PR review comment</a>:</p>\n<blockquote>\n<p>Stray change?</p>\n</blockquote>",
        "id": 336555492,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1677263581
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1117284971\">PR review comment</a>:</p>\n<blockquote>\n<p>I think this may need to be <code>null_reference</code> since I think this is used during parsing of the <code>*.clif</code> IR which wouldn't work with a space in the middle I think</p>\n</blockquote>",
        "id": 336555493,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1677263581
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1117285632\">PR review comment</a>:</p>\n<blockquote>\n<p>This file may have snuck in during the merge?</p>\n</blockquote>",
        "id": 336555496,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1677263581
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1117283312\">PR review comment</a>:</p>\n<blockquote>\n<p>I think this file snuck back in from the recent merge?</p>\n</blockquote>",
        "id": 336555498,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1677263581
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1117287116\">PR review comment</a>:</p>\n<blockquote>\n<p>I think this can be written as <code>u32::from(*type_idx)</code> to be a bit more concise.</p>\n</blockquote>",
        "id": 336555501,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1677263581
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1117456482\">PR review comment</a>:</p>\n<blockquote>\n<p>Could the <code>nullable</code> field here be filled out based on whether the value is <code>Some</code> or <code>None</code>?</p>\n</blockquote>",
        "id": 336555502,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1677263581
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1117303486\">PR review comment</a>:</p>\n<blockquote>\n<p>These two values are showing up quite a lot in tests, so I think it might be good to refactor this to have, at the definition:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"k\">impl</span><span class=\"w\"> </span><span class=\"n\">RefType</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">EXTERNREF</span>: <span class=\"nc\">RefType</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">..</span><span class=\"p\">.;</span>\n<span class=\"w\">    </span><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">FUNCREF</span>: <span class=\"nc\">RefType</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">..</span><span class=\"p\">.;</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p>and probably similarly for <code>ValType</code></p>\n</blockquote>",
        "id": 336555503,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1677263581
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1117458230\">PR review comment</a>:</p>\n<blockquote>\n<p>I think this will want to match <code>nullable: true</code> since storing a null funcref into a table that is non-nullable should be an error</p>\n</blockquote>",
        "id": 336555504,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1677263581
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1117461627\">PR review comment</a>:</p>\n<blockquote>\n<p>I'll bump this again, this is a serious issue which must be addressed before the PR is merged. As I mentioned before though this has far-reaching implications and is unfortunately not going to be easy to handle. For example the <code>PartialEq</code>/<code>Eq</code> implementations for this type (and transitively for <code>ValType</code>) aren't valid any more to go through <code>u32</code> since two different modules could have the same <code>u32</code> pointing at different types.</p>\n</blockquote>",
        "id": 336555505,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1677263581
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1117459209\">PR review comment</a>:</p>\n<blockquote>\n<p>To bump this, I think it would be good to have at least have a specific error for <code>HeapType::Index</code> which indicates that support is missing.</p>\n</blockquote>",
        "id": 336555506,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1677263581
    },
    {
        "content": "<p>dhil submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#pullrequestreview-1315497701\">PR review</a>.</p>",
        "id": 338315337,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1677501471
    },
    {
        "content": "<p>dhil created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1118682127\">PR review comment</a>:</p>\n<blockquote>\n<p>Yes! Thank you.</p>\n</blockquote>",
        "id": 338315339,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1677501471
    },
    {
        "content": "<p>dhil submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#pullrequestreview-1315498312\">PR review</a>.</p>",
        "id": 338315452,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1677501495
    },
    {
        "content": "<p>dhil created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1118682548\">PR review comment</a>:</p>\n<blockquote>\n<p>Yep! I'll remove it.</p>\n</blockquote>",
        "id": 338315454,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1677501495
    },
    {
        "content": "<p>dhil submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#pullrequestreview-1315498986\">PR review</a>.</p>",
        "id": 338315527,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1677501523
    },
    {
        "content": "<p>dhil created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1118683069\">PR review comment</a>:</p>\n<blockquote>\n<p>Got it!</p>\n</blockquote>",
        "id": 338315529,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1677501523
    },
    {
        "content": "<p>dhil created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1118683448\">PR review comment</a>:</p>\n<blockquote>\n<p>Yep, it looks that way. I quite possibly missed \"a deleted by them\" during the merge.</p>\n</blockquote>",
        "id": 338315607,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1677501546
    },
    {
        "content": "<p>dhil submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#pullrequestreview-1315499519\">PR review</a>.</p>",
        "id": 338315608,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1677501546
    },
    {
        "content": "<p>dhil submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#pullrequestreview-1315499715\">PR review</a>.</p>",
        "id": 338315627,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1677501554
    },
    {
        "content": "<p>dhil created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1118683591\">PR review comment</a>:</p>\n<blockquote>\n<p>Thanks!</p>\n</blockquote>",
        "id": 338315629,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1677501554
    },
    {
        "content": "<p>dhil submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#pullrequestreview-1315500494\">PR review</a>.</p>",
        "id": 338315738,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1677501584
    },
    {
        "content": "<p>dhil created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1118684093\">PR review comment</a>:</p>\n<blockquote>\n<p>What would be the right place to store this shared logic for testing?</p>\n</blockquote>",
        "id": 338315740,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1677501584
    },
    {
        "content": "<p>dhil edited <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1118684093\">PR review comment</a>.</p>",
        "id": 338315772,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1677501592
    },
    {
        "content": "<p>dhil submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#pullrequestreview-1315504691\">PR review</a>.</p>",
        "id": 338316375,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1677501752
    },
    {
        "content": "<p>dhil created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1118686913\">PR review comment</a>:</p>\n<blockquote>\n<p>Yep, it is technically possible since it is valid to use a non-nullable reference in place of a nullable reference. However, it does come with a cost -- which I think is inevitable anyways -- which is that we must perform a subtype check where we would previously perform a standard equality <code>==</code> check.</p>\n</blockquote>",
        "id": 338316377,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1677501752
    },
    {
        "content": "<p>dhil submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#pullrequestreview-1315504971\">PR review</a>.</p>",
        "id": 338316410,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1677501765
    },
    {
        "content": "<p>dhil created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1118687084\">PR review comment</a>:</p>\n<blockquote>\n<p>Good catch! Thanks. I will add a couple of test cases.</p>\n</blockquote>",
        "id": 338316412,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1677501765
    },
    {
        "content": "<p>dhil updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288\">PR #5288</a> from <code>function-references</code> to <code>main</code>.</p>",
        "id": 338316499,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1677501788
    },
    {
        "content": "<p>dhil submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#pullrequestreview-1315516761\">PR review</a>.</p>",
        "id": 338318299,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1677502248
    },
    {
        "content": "<p>dhil created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1118694996\">PR review comment</a>:</p>\n<blockquote>\n<p>So would we need to equip the type with some sort of provenance that can inform us about the origin module?</p>\n</blockquote>",
        "id": 338318303,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1677502248
    },
    {
        "content": "<p>dhil submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#pullrequestreview-1315517219\">PR review</a>.</p>",
        "id": 338318367,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1677502265
    },
    {
        "content": "<p>dhil created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1118695266\">PR review comment</a>:</p>\n<blockquote>\n<p>Added, thanks!</p>\n</blockquote>",
        "id": 338318368,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1677502266
    },
    {
        "content": "<p>dhil updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288\">PR #5288</a> from <code>function-references</code> to <code>main</code>.</p>",
        "id": 338332131,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1677505915
    },
    {
        "content": "<p>dhil submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#pullrequestreview-1315636427\">PR review</a>.</p>",
        "id": 338332758,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1677506101
    },
    {
        "content": "<p>dhil created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1118767872\">PR review comment</a>:</p>\n<blockquote>\n<p>It now reads:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"bp\">self</span><span class=\"p\">.</span><span class=\"n\">module</span><span class=\"p\">.</span><span class=\"n\">table_plans</span><span class=\"p\">[</span><span class=\"n\">segment</span><span class=\"p\">.</span><span class=\"n\">table_index</span><span class=\"p\">]</span>\n<span class=\"w\">                </span><span class=\"p\">.</span><span class=\"n\">table</span>\n<span class=\"w\">                </span><span class=\"p\">.</span><span class=\"n\">wasm_ty</span>\n<span class=\"w\">                </span><span class=\"p\">.</span><span class=\"n\">heap_type</span>\n<span class=\"w\">                </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"n\">WasmHeapType</span>::<span class=\"n\">Extern</span>\n<span class=\"w\">            </span><span class=\"p\">{</span>\n<span class=\"w\">                </span><span class=\"n\">leftovers</span><span class=\"p\">.</span><span class=\"n\">push</span><span class=\"p\">(</span><span class=\"n\">segment</span><span class=\"p\">.</span><span class=\"n\">clone</span><span class=\"p\">());</span>\n<span class=\"w\">                </span><span class=\"k\">continue</span><span class=\"p\">;</span>\n<span class=\"w\">            </span><span class=\"p\">}</span>\n</code></pre></div>\n<p>Is this close enough to what you had in mind? Alternatively, we can match explicitly on <code>heap_type</code> to make this code more robust against changes to <code>WasmHeapType</code>.</p>\n</blockquote>",
        "id": 338332762,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1677506101
    },
    {
        "content": "<p>dhil edited <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1118767872\">PR review comment</a>.</p>",
        "id": 338333035,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1677506179
    },
    {
        "content": "<p>alexcrichton submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#pullrequestreview-1318332703\">PR review</a>.</p>",
        "id": 338669669,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1677611341
    },
    {
        "content": "<p>alexcrichton submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#pullrequestreview-1318332703\">PR review</a>.</p>",
        "id": 338669671,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1677611341
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1120614524\">PR review comment</a>:</p>\n<blockquote>\n<p>I think this may also need <code>s/ /_/</code>?</p>\n</blockquote>",
        "id": 338669674,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1677611341
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1120617719\">PR review comment</a>:</p>\n<blockquote>\n<p>This is a \"dummy\" implementation anyway so this representation is fine FWIW (should be ok to drop the comment here)</p>\n</blockquote>",
        "id": 338669677,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1677611341
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1120615519\">PR review comment</a>:</p>\n<blockquote>\n<p>I think these comments may be leftover from prior refactorings? (and some below this as well)</p>\n</blockquote>",
        "id": 338669678,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1677611341
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1120628362\">PR review comment</a>:</p>\n<blockquote>\n<p>I think this may not be correct in the sense that <code>EXTERNREF</code> is \"nullable <code>ref extern</code>\" but non-nullable externs should still use this code path which does reference counting.</p>\n</blockquote>",
        "id": 338669680,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1677611341
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1120616421\">PR review comment</a>:</p>\n<blockquote>\n<p>It's ok to drop this as we don't have a ton of rhyme or reason to the current opcode ordering at this time.</p>\n</blockquote>",
        "id": 338669681,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1677611341
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1120629137\">PR review comment</a>:</p>\n<blockquote>\n<p>Like above I think this needs to handle non-nullable externrefs here as well to destroy them properly</p>\n</blockquote>",
        "id": 338669682,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1677611341
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1120632985\">PR review comment</a>:</p>\n<blockquote>\n<p>This makes sense to me to add, but can <code>PartialEq</code> and <code>Eq</code> be removed from <code>ValType</code> as well? (to force callers to use this function)</p>\n</blockquote>",
        "id": 338669684,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1677611342
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1120642776\">PR review comment</a>:</p>\n<blockquote>\n<p>More-or-less yeah. In some sense this \"needs\" to become <code>FuncType</code> which internally has a params/results list. I don't think we can literally do that though because of the performance ramifications (e.g. that's an owned list, requires extra allocations to move around, etc). </p>\n<p>An alternative would be something akin to <code>VMSharedSignatureIndex</code> which is a unique 32-bit integer deduplicating function types within an <code>Engine</code>. That wouldn't work literally as well either though because indices different engines can't be compared. Additionally this wouldn't work because when performing a subtype check you'd need to be able to walk through the indices to perform a deep subtyping check on params/results of functions.</p>\n<p>One possibility would be to perhaps:</p>\n<ul>\n<li>Assign a unique 32-bit id to each <code>Engine</code> (similar to how a store gets an id today)</li>\n<li>Provide an <code>Engine</code> in the subtyping check</li>\n<li>Store an engine id and a shared signature index here.</li>\n</ul>\n<p>Even with all this though that's still unfortunately pretty expansive and I'm not sure whether it would work out. So with all that in mind I would propose an alternative. I suspect that the modules you're interested in running don't use funcrefs \"at the boundary\" in the sense of imported/exported functions from the module that the host interacts with. In that sense I think it's fine to just fail to compile any module that has a funcref/etc in imports/exports in Wasmtime for now. Filling out support for that is fine to have as a \"TODO\" at some point.</p>\n<p>Basically my point is that I think it's fine to implement the \"runtime\" half of the function-references proposal without implementing the \"embedder half\". It means Wasmtime won't be able to run every module under the sun that's valid for function-references but it'll probably still run at least the most interesting ones. If you decide to go down this route, though, it will involve a number of changes to the <code>wasmtime</code> crate, namely to basically back out any function-references support and to thread errors through from \"when function references are encountered at the import/export level an error is returned\"</p>\n</blockquote>",
        "id": 338669685,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1677611342
    },
    {
        "content": "<p>dhil updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288\">PR #5288</a> from <code>function-references</code> to <code>main</code>.</p>",
        "id": 338847337,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1677679076
    },
    {
        "content": "<p>dhil submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#pullrequestreview-1320031452\">PR review</a>.</p>",
        "id": 338865443,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1677682857
    },
    {
        "content": "<p>dhil created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1121874371\">PR review comment</a>:</p>\n<blockquote>\n<p>I will tidy this up.</p>\n</blockquote>",
        "id": 338865450,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1677682858
    },
    {
        "content": "<p>dhil submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#pullrequestreview-1320031698\">PR review</a>.</p>",
        "id": 338865461,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1677682859
    },
    {
        "content": "<p>dhil created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1121874431\">PR review comment</a>:</p>\n<blockquote>\n<p>Ok, I will remove the todo.</p>\n</blockquote>",
        "id": 338865463,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1677682859
    },
    {
        "content": "<p>dhil created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1121874255\">PR review comment</a>:</p>\n<blockquote>\n<p>Yes!</p>\n</blockquote>",
        "id": 338865464,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1677682859
    },
    {
        "content": "<p>dhil submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#pullrequestreview-1320031605\">PR review</a>.</p>",
        "id": 338865475,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1677682862
    },
    {
        "content": "<p>dhil created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1121874506\">PR review comment</a>:</p>\n<blockquote>\n<p>Ok, thanks!</p>\n</blockquote>",
        "id": 338865478,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1677682864
    },
    {
        "content": "<p>dhil submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#pullrequestreview-1320031898\">PR review</a>.</p>",
        "id": 338865485,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1677682865
    },
    {
        "content": "<p>dhil submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#pullrequestreview-1320031989\">PR review</a>.</p>",
        "id": 338865507,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1677682868
    },
    {
        "content": "<p>dhil created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1121874687\">PR review comment</a>:</p>\n<blockquote>\n<p>Got it!</p>\n</blockquote>",
        "id": 338865508,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1677682868
    },
    {
        "content": "<p>dhil submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#pullrequestreview-1320031796\">PR review</a>.</p>",
        "id": 338865511,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1677682869
    },
    {
        "content": "<p>dhil submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#pullrequestreview-1320032088\">PR review</a>.</p>",
        "id": 338865521,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1677682870
    },
    {
        "content": "<p>dhil created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1121874588\">PR review comment</a>:</p>\n<blockquote>\n<p>Yes, good catch!</p>\n</blockquote>",
        "id": 338865522,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1677682871
    },
    {
        "content": "<p>dhil created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1121874779\">PR review comment</a>:</p>\n<blockquote>\n<p>Interesting suggestion. Doing this revealed some potential bugs. It did require me to change the <code>assert_eq!</code> in the <code>func</code> and <code>host_func</code> tests as they extensively relied on the ability to use the <code>PartialEq</code> operator for comparisons.</p>\n<p>There is one place where I am not entirely sure that we want to do subtyping: in <a href=\"https://github.com/bytecodealliance/wasmtime/blob/63ff410119e90f340fdc91ccaba65fddcc3ebe3a/crates/wasi-threads/src/lib.rs#L173\"><code>wasi-threads</code></a> used a strict equality check; I have preserved this for now because I don't know enough about what's going on there.</p>\n</blockquote>",
        "id": 338865531,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1677682872
    },
    {
        "content": "<p>dhil updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288\">PR #5288</a> from <code>function-references</code> to <code>main</code>.</p>",
        "id": 339348170,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1677850955
    },
    {
        "content": "<p>dhil submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#pullrequestreview-1323859288\">PR review</a>.</p>",
        "id": 339353856,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1677852309
    },
    {
        "content": "<p>dhil created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1124499953\">PR review comment</a>:</p>\n<blockquote>\n<p>It sounds like to me it might be worth to survey the design space a little more before committing to implementing a particular design. I think what I would like to do is to separate the work into a \"runtime half\" PR and at a later stage an \"embedder half\" PR. It sounds less risky to me personally, and I think you are right, that for my research I do not yet need things to work at the boundary.</p>\n</blockquote>",
        "id": 339353858,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1677852309
    },
    {
        "content": "<p>alexcrichton submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#pullrequestreview-1326528506\">PR review</a>.</p>",
        "id": 339894433,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1678115533
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1126569577\">PR review comment</a>:</p>\n<blockquote>\n<p>Yeah that's reasonable to me and I think would work out well. You may have to add a few more error-paths in places that may be infallible but that's ok, at the top-level I think everything is fallible to communicate the necessary errors here so it'd just be internal refactoring.</p>\n</blockquote>",
        "id": 339894434,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1678115533
    },
    {
        "content": "<p><strong>dhil</strong> requested <a href=\"https://github.com/orgs/bytecodealliance/teams/wasmtime-compiler-reviewers\">wasmtime-compiler-reviewers</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288\">PR #5288</a>.</p>",
        "id": 349023901,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1681371400
    },
    {
        "content": "<p><strong>dhil</strong> requested <a href=\"https://github.com/abrown\">abrown</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288\">PR #5288</a>.</p>",
        "id": 349023902,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1681371400
    },
    {
        "content": "<p><strong>dhil</strong> requested <a href=\"https://github.com/alexcrichton\">alexcrichton</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288\">PR #5288</a>.</p>",
        "id": 349023907,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1681371401
    },
    {
        "content": "<p><strong>dhil</strong> requested <a href=\"https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers\">wasmtime-core-reviewers</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288\">PR #5288</a>.</p>",
        "id": 349023908,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1681371401
    },
    {
        "content": "<p><strong>dhil</strong> requested <a href=\"https://github.com/orgs/bytecodealliance/teams/wasmtime-default-reviewers\">wasmtime-default-reviewers</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288\">PR #5288</a>.</p>",
        "id": 349023910,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1681371401
    },
    {
        "content": "<p>dhil updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288\">PR #5288</a>.</p>",
        "id": 349023911,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1681371401
    },
    {
        "content": "<p>dhil updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288\">PR #5288</a>.</p>",
        "id": 349026875,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1681372202
    },
    {
        "content": "<p>dhil updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288\">PR #5288</a>.</p>",
        "id": 350437194,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1681719390
    },
    {
        "content": "<p>dhil updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288\">PR #5288</a>.</p>",
        "id": 350693282,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1681802840
    },
    {
        "content": "<p>dhil updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288\">PR #5288</a>.</p>",
        "id": 350837648,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1681836897
    },
    {
        "content": "<p>dhil updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288\">PR #5288</a>.</p>",
        "id": 351018099,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1681904225
    },
    {
        "content": "<p>dhil updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288\">PR #5288</a>.</p>",
        "id": 351049995,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1681911144
    },
    {
        "content": "<p>dhil updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288\">PR #5288</a>.</p>",
        "id": 351050542,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1681911242
    },
    {
        "content": "<p>dhil updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288\">PR #5288</a>.</p>",
        "id": 351234172,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1681976245
    },
    {
        "content": "<p>dhil updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288\">PR #5288</a>.</p>",
        "id": 351359316,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1682004394
    },
    {
        "content": "<p>dhil updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288\">PR #5288</a>.</p>",
        "id": 351360774,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1682004662
    },
    {
        "content": "<p>dhil updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288\">PR #5288</a>.</p>",
        "id": 352535661,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1682428720
    },
    {
        "content": "<p>dhil updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288\">PR #5288</a>.</p>",
        "id": 353157209,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1682583495
    },
    {
        "content": "<p>dhil updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288\">PR #5288</a>.</p>",
        "id": 355380813,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1683107652
    },
    {
        "content": "<p>dhil updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288\">PR #5288</a>.</p>",
        "id": 355381138,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1683107753
    },
    {
        "content": "<p>dhil updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288\">PR #5288</a>.</p>",
        "id": 358656266,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1684225715
    },
    {
        "content": "<p>dhil updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288\">PR #5288</a>.</p>",
        "id": 358968463,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1684326029
    },
    {
        "content": "<p>dhil updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288\">PR #5288</a>.</p>",
        "id": 359630456,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1684496431
    },
    {
        "content": "<p>dhil updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288\">PR #5288</a>.</p>",
        "id": 360237579,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1684754616
    },
    {
        "content": "<p>dhil updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288\">PR #5288</a>.</p>",
        "id": 360506897,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1684842642
    },
    {
        "content": "<p>dhil updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288\">PR #5288</a>.</p>",
        "id": 360511341,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1684843729
    },
    {
        "content": "<p>dhil updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288\">PR #5288</a>.</p>",
        "id": 360703047,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1684910906
    },
    {
        "content": "<p>alexcrichton submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#pullrequestreview-1442094245\">PR review</a>:</p>\n<blockquote>\n<p>Ok this looks good to go to me, thanks again @CosineP and @dhil!</p>\n<p>I'd like another pair of eyes on this though given what's changing here, so I'm going to request that @fitzgen take a look as well. If y'all would be ok opening up a tracking issue for the remaining items that'd be appreciated!</p>\n</blockquote>",
        "id": 360812353,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1684939621
    },
    {
        "content": "<p><strong>alexcrichton</strong> requested <a href=\"https://github.com/fitzgen\">fitzgen</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288\">PR #5288</a>.</p>",
        "id": 360812397,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1684939629
    },
    {
        "content": "<p>dhil updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288\">PR #5288</a>.</p>",
        "id": 361122708,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1685035340
    },
    {
        "content": "<p>fitzgen submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#pullrequestreview-1444478345\">PR review</a>:</p>\n<blockquote>\n<p>Let's get this merged! Thanks @dhil and @CosineP!</p>\n</blockquote>",
        "id": 361153081,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1685043992
    },
    {
        "content": "<p>fitzgen submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#pullrequestreview-1444478345\">PR review</a>:</p>\n<blockquote>\n<p>Let's get this merged! Thanks @dhil and @CosineP!</p>\n</blockquote>",
        "id": 361153082,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1685043992
    },
    {
        "content": "<p>fitzgen created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1205905935\">PR review comment</a>:</p>\n<blockquote>\n<p>Can we file an issue to track this?</p>\n</blockquote>",
        "id": 361153083,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1685043992
    },
    {
        "content": "<p>fitzgen created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1205897529\">PR review comment</a>:</p>\n<blockquote>\n<p>This function's allocations were previously showing up in DHAT for some profiling I did, which is why we ended up wit the super generic interface to this function and weird <code>&amp;'static [_]</code> stuff going on. All that is to say that I think we should probably use a small vec here.</p>\n<p>Fine to do as a follow up.</p>\n</blockquote>",
        "id": 361153084,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1685043992
    },
    {
        "content": "<p>dhil updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288\">PR #5288</a>.</p>",
        "id": 361250795,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1685089297
    },
    {
        "content": "<p>dhil created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1206423254\">PR review comment</a>:</p>\n<blockquote>\n<p>I've added this to #6455. I can hoist it into a separate issue if need be.</p>\n</blockquote>",
        "id": 361253266,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1685089872
    },
    {
        "content": "<p>dhil updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288\">PR #5288</a>.</p>",
        "id": 361354769,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1685113166
    },
    {
        "content": "<p>alexcrichton has enabled auto merge for <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288\">PR #5288</a>.</p>",
        "id": 361357571,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1685113737
    },
    {
        "content": "<p>alexcrichton merged <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5288\">PR #5288</a>.</p>",
        "id": 361373930,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1685117171
    }
]