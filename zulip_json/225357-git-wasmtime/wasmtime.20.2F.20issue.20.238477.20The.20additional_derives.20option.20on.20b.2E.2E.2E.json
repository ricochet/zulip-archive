[
    {
        "content": "<p>alec-deason opened <a href=\"https://github.com/bytecodealliance/wasmtime/issues/8477\">issue #8477</a>:</p>\n<blockquote>\n<p>#8441  recently added support for additional_derives in <code>wasmtime::component::bindgen</code> but the new version appears not to apply the derives to all types. In particular it seems to miss variants which are only used as fields in records, as in this definition:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">test</span>:<span class=\"nc\">bindgen</span><span class=\"o\">-</span><span class=\"n\">test</span><span class=\"p\">;</span>\n\n<span class=\"n\">interface</span><span class=\"w\"> </span><span class=\"n\">types</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"n\">variant</span><span class=\"w\"> </span><span class=\"n\">inner</span><span class=\"o\">-</span><span class=\"n\">variant</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"n\">a</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"n\">b</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"n\">c</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n<span class=\"w\">    </span><span class=\"n\">record</span><span class=\"w\"> </span><span class=\"n\">outer</span><span class=\"o\">-</span><span class=\"n\">record</span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"n\">inner</span>: <span class=\"nc\">inner</span><span class=\"o\">-</span><span class=\"n\">variant</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n<span class=\"p\">}</span>\n\n<span class=\"n\">world</span><span class=\"w\"> </span><span class=\"n\">bindgen</span><span class=\"o\">-</span><span class=\"n\">test</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">types</span><span class=\"p\">.{</span><span class=\"n\">outer</span><span class=\"o\">-</span><span class=\"n\">record</span><span class=\"p\">};</span>\n<span class=\"w\">    </span><span class=\"n\">export</span><span class=\"w\"> </span><span class=\"n\">test</span><span class=\"o\">-</span><span class=\"n\">failure</span>: <span class=\"nc\">func</span><span class=\"p\">()</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">outer</span><span class=\"o\">-</span><span class=\"n\">record</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p>In my testing the derives will be applied to OuterRecord but not to InnerVariant.</p>\n<p>Attached is a complete test case which fails to compile.<br>\n<a href=\"https://github.com/bytecodealliance/wasmtime/files/15120002/bindgen_case.tgz\">bindgen_case.tgz</a><br>\n</p>\n</blockquote>",
        "id": 435457593,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1714074884
    },
    {
        "content": "<p>fibonacci1729 <a href=\"https://github.com/bytecodealliance/wasmtime/issues/8477#issuecomment-2078346923\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/8477\">issue #8477</a>:</p>\n<blockquote>\n<p>@alec-deason Sorry about that! I added the fix in #8482.</p>\n</blockquote>",
        "id": 435483830,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1714088797
    },
    {
        "content": "<p>alexcrichton closed <a href=\"https://github.com/bytecodealliance/wasmtime/issues/8477\">issue #8477</a>:</p>\n<blockquote>\n<p>#8441  recently added support for additional_derives in <code>wasmtime::component::bindgen</code> but the new version appears not to apply the derives to all types. In particular it seems to miss variants which are only used as fields in records, as in this definition:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">test</span>:<span class=\"nc\">bindgen</span><span class=\"o\">-</span><span class=\"n\">test</span><span class=\"p\">;</span>\n\n<span class=\"n\">interface</span><span class=\"w\"> </span><span class=\"n\">types</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"n\">variant</span><span class=\"w\"> </span><span class=\"n\">inner</span><span class=\"o\">-</span><span class=\"n\">variant</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"n\">a</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"n\">b</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"n\">c</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n<span class=\"w\">    </span><span class=\"n\">record</span><span class=\"w\"> </span><span class=\"n\">outer</span><span class=\"o\">-</span><span class=\"n\">record</span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"n\">inner</span>: <span class=\"nc\">inner</span><span class=\"o\">-</span><span class=\"n\">variant</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n<span class=\"p\">}</span>\n\n<span class=\"n\">world</span><span class=\"w\"> </span><span class=\"n\">bindgen</span><span class=\"o\">-</span><span class=\"n\">test</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">types</span><span class=\"p\">.{</span><span class=\"n\">outer</span><span class=\"o\">-</span><span class=\"n\">record</span><span class=\"p\">};</span>\n<span class=\"w\">    </span><span class=\"n\">export</span><span class=\"w\"> </span><span class=\"n\">test</span><span class=\"o\">-</span><span class=\"n\">failure</span>: <span class=\"nc\">func</span><span class=\"p\">()</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">outer</span><span class=\"o\">-</span><span class=\"n\">record</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p>In my testing the derives will be applied to OuterRecord but not to InnerVariant.</p>\n<p>Attached is a complete test case which fails to compile.<br>\n<a href=\"https://github.com/bytecodealliance/wasmtime/files/15120002/bindgen_case.tgz\">bindgen_case.tgz</a><br>\n</p>\n</blockquote>",
        "id": 435486950,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1714091218
    }
]