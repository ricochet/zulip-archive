[
    {
        "content": "<p><a href=\"https://github.com/cimacmillan\">cimacmillan</a> added the bug label to <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7418\">Issue #7418</a>.</p>",
        "id": 399462652,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1698745860
    },
    {
        "content": "<p>cimacmillan opened <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7418\">issue #7418</a>:</p>\n<blockquote>\n<p>Thanks for filing a bug report! Please fill out the TODOs below.</p>\n<p><strong>Note: if you want to report a security issue, please read our <a href=\"https://bytecodealliance.org/security\">security policy</a>!</strong></p>\n<h3>Test Case</h3>\n<p>Attached <code>reproducing.zip</code> which contains the WASM file, when ran with WASM time with log-to-files, causes panic</p>\n<h3>Steps to Reproduce</h3>\n<ul>\n<li>Download the reproducing.zip and decompress</li>\n<li>Run <code>RUST_LOG=wasi_common=trace wasmtime --wasm threads --wasi threads -D log-to-files reproducing.wasm</code></li>\n</ul>\n<h3>Expected Results</h3>\n<p>Program should run (although shouldn't exit, due to another issue <a href=\"#narrow/stream/349267-wasi-threads/topic/rust/near/395138228\">see</a>).</p>\n<h3>Actual Results</h3>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">thread</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"na\">wasi</span><span class=\"o\">-</span><span class=\"n\">thread</span><span class=\"o\">-</span><span class=\"mi\">949396201</span><span class=\"o\">'</span><span class=\"w\"> </span><span class=\"n\">panicked</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"na\">call</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">logger</span><span class=\"o\">'</span><span class=\"na\">s</span><span class=\"w\"> </span><span class=\"n\">initialize</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"n\">first</span><span class=\"o\">'</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">runner</span><span class=\"o\">/</span><span class=\"n\">work</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">/</span><span class=\"n\">vendor</span><span class=\"o\">/</span><span class=\"n\">file</span><span class=\"o\">-</span><span class=\"n\">per</span><span class=\"o\">-</span><span class=\"n\">thread</span><span class=\"o\">-</span><span class=\"n\">logger</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">164</span>:<span class=\"mi\">22</span>\n<span class=\"n\">note</span>: <span class=\"nc\">run</span><span class=\"w\"> </span><span class=\"n\">with</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">RUST_BACKTRACE</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">environment</span><span class=\"w\"> </span><span class=\"n\">variable</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">display</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">backtrace</span>\n<span class=\"n\">wasi</span><span class=\"o\">-</span><span class=\"n\">thread</span><span class=\"o\">-</span><span class=\"mi\">949396201</span><span class=\"w\"> </span><span class=\"n\">panicked</span>: <span class=\"nc\">Any</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"o\">..</span><span class=\"w\"> </span><span class=\"p\">}</span>\n</code></pre></div>\n<p>With backtrace,</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">thread</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"na\">wasi</span><span class=\"o\">-</span><span class=\"n\">thread</span><span class=\"o\">-</span><span class=\"mi\">1053380974</span><span class=\"o\">'</span><span class=\"w\"> </span><span class=\"n\">panicked</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"na\">call</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">logger</span><span class=\"o\">'</span><span class=\"na\">s</span><span class=\"w\"> </span><span class=\"n\">initialize</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"n\">first</span><span class=\"o\">'</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">runner</span><span class=\"o\">/</span><span class=\"n\">work</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">/</span><span class=\"n\">vendor</span><span class=\"o\">/</span><span class=\"n\">file</span><span class=\"o\">-</span><span class=\"n\">per</span><span class=\"o\">-</span><span class=\"n\">thread</span><span class=\"o\">-</span><span class=\"n\">logger</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">164</span>:<span class=\"mi\">22</span>\n<span class=\"n\">stack</span><span class=\"w\"> </span><span class=\"n\">backtrace</span>:\n   <span class=\"mi\">0</span>: <span class=\"nc\">rust_begin_unwind</span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"mi\">5680</span><span class=\"n\">fa18feaa87f3ff04063800aec256c3d4b4be</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">panicking</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">593</span>:<span class=\"mi\">5</span>\n<span class=\"w\">   </span><span class=\"mi\">1</span>: <span class=\"nc\">core</span>::<span class=\"n\">panicking</span>::<span class=\"n\">panic_fmt</span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"mi\">5680</span><span class=\"n\">fa18feaa87f3ff04063800aec256c3d4b4be</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">panicking</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">67</span>:<span class=\"mi\">14</span>\n<span class=\"w\">   </span><span class=\"mi\">2</span>: <span class=\"nc\">core</span>::<span class=\"n\">panicking</span>::<span class=\"n\">panic_display</span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"mi\">5680</span><span class=\"n\">fa18feaa87f3ff04063800aec256c3d4b4be</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">panicking</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">150</span>:<span class=\"mi\">5</span>\n<span class=\"w\">   </span><span class=\"mi\">3</span>: <span class=\"nc\">core</span>::<span class=\"n\">panicking</span>::<span class=\"n\">panic_str</span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"mi\">5680</span><span class=\"n\">fa18feaa87f3ff04063800aec256c3d4b4be</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">panicking</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">134</span>:<span class=\"mi\">5</span>\n<span class=\"w\">   </span><span class=\"mi\">4</span>: <span class=\"nc\">core</span>::<span class=\"n\">option</span>::<span class=\"n\">expect_failed</span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"mi\">5680</span><span class=\"n\">fa18feaa87f3ff04063800aec256c3d4b4be</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">option</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">1952</span>:<span class=\"mi\">5</span>\n<span class=\"w\">   </span><span class=\"mi\">5</span>: <span class=\"o\">&lt;</span><span class=\"n\">file_per_thread_logger</span>::<span class=\"n\">FilePerThreadLogger</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">log</span>::<span class=\"n\">Log</span><span class=\"o\">&gt;</span>::<span class=\"n\">log</span>\n<span class=\"w\">   </span><span class=\"mi\">6</span>: <span class=\"nc\">tracing</span>::<span class=\"n\">span</span>::<span class=\"n\">Span</span>::<span class=\"n\">log</span>\n<span class=\"w\">   </span><span class=\"mi\">7</span>: <span class=\"nc\">tracing</span>::<span class=\"n\">span</span>::<span class=\"n\">Span</span>::<span class=\"n\">record_all</span>\n<span class=\"w\">   </span><span class=\"mi\">8</span>: <span class=\"nc\">wasi_common</span>::<span class=\"n\">snapshots</span>::<span class=\"n\">preview_1</span>::<span class=\"n\">wasi_snapshot_preview1</span>::<span class=\"n\">sched_yield</span>\n<span class=\"w\">   </span><span class=\"mi\">9</span>: <span class=\"nc\">wiggle</span>::<span class=\"n\">run_in_dummy_executor</span>\n<span class=\"w\">  </span><span class=\"mi\">10</span>: <span class=\"o\">&lt;</span><span class=\"n\">core</span>::<span class=\"n\">panic</span>::<span class=\"n\">unwind_safe</span>::<span class=\"n\">AssertUnwindSafe</span><span class=\"o\">&lt;</span><span class=\"n\">F</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">core</span>::<span class=\"n\">ops</span>::<span class=\"n\">function</span>::<span class=\"nb\">FnOnce</span><span class=\"o\">&lt;</span><span class=\"p\">()</span><span class=\"o\">&gt;&gt;</span>::<span class=\"n\">call_once</span>\n<span class=\"w\">  </span><span class=\"mi\">11</span>: <span class=\"nc\">wasmtime_runtime</span>::<span class=\"n\">instance</span>::<span class=\"n\">Instance</span>::<span class=\"n\">from_vmctx</span>\n<span class=\"w\">  </span><span class=\"mi\">12</span>: <span class=\"o\">&lt;</span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span>::<span class=\"n\">func</span>::<span class=\"n\">IntoFunc</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"p\">,(</span><span class=\"n\">wasmtime</span>::<span class=\"n\">func</span>::<span class=\"n\">Caller</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"o\">&gt;</span><span class=\"p\">,),</span><span class=\"n\">R</span><span class=\"o\">&gt;&gt;</span>::<span class=\"n\">into_func</span>::<span class=\"n\">native_call_shim</span>\n<span class=\"w\">  </span><span class=\"mi\">13</span>: <span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;</span>\n<span class=\"w\">  </span><span class=\"mi\">14</span>: <span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;</span>\n<span class=\"w\">  </span><span class=\"mi\">15</span>: <span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;</span>\n<span class=\"w\">  </span><span class=\"mi\">16</span>: <span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;</span>\n<span class=\"w\">  </span><span class=\"mi\">17</span>: <span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;</span>\n<span class=\"w\">  </span><span class=\"mi\">18</span>: <span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;</span>\n<span class=\"w\">  </span><span class=\"mi\">19</span>: <span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;</span>\n<span class=\"w\">  </span><span class=\"mi\">20</span>: <span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;</span>\n<span class=\"w\">  </span><span class=\"mi\">21</span>: <span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;</span>\n<span class=\"w\">  </span><span class=\"mi\">22</span>: <span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;</span>\n<span class=\"w\">  </span><span class=\"mi\">23</span>: <span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;</span>\n<span class=\"w\">  </span><span class=\"mi\">24</span>: <span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;</span>\n<span class=\"w\">  </span><span class=\"mi\">25</span>: <span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;</span>\n<span class=\"w\">  </span><span class=\"mi\">26</span>: <span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;</span>\n<span class=\"w\">  </span><span class=\"mi\">27</span>: <span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;</span>\n<span class=\"w\">  </span><span class=\"mi\">28</span>: <span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;</span>\n<span class=\"w\">  </span><span class=\"mi\">29</span>: <span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;</span>\n<span class=\"w\">  </span><span class=\"mi\">30</span>: <span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;</span>\n<span class=\"w\">  </span><span class=\"mi\">31</span>: <span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;</span>\n<span class=\"w\">  </span><span class=\"mi\">32</span>: <span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;</span>\n<span class=\"w\">  </span><span class=\"mi\">33</span>: <span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;</span>\n<span class=\"w\">  </span><span class=\"mi\">34</span>: <span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;</span>\n<span class=\"w\">  </span><span class=\"mi\">35</span>: <span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;</span>\n<span class=\"w\">  </span><span class=\"mi\">36</span>: <span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;</span>\n<span class=\"w\">  </span><span class=\"mi\">37</span>: <span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;</span>\n<span class=\"w\">  </span><span class=\"mi\">38</span>: <span class=\"nc\">wasmtime_runtime</span>::<span class=\"n\">traphandlers</span>::<span class=\"n\">catch_traps</span>::<span class=\"n\">call_closure</span>\n<span class=\"w\">  </span><span class=\"mi\">39</span>: <span class=\"nc\">wasmtime_setjmp_14_0_2</span>\n<span class=\"w\">  </span><span class=\"mi\">40</span>: <span class=\"nc\">wasmtime_runtime</span>::<span class=\"n\">traphandlers</span>::<span class=\"o\">&lt;</span><span class=\"k\">impl</span><span class=\"w\"> </span><span class=\"n\">wasmtime_runtime</span>::<span class=\"n\">traphandlers</span>::<span class=\"n\">call_thread_state</span>::<span class=\"n\">CallThreadState</span><span class=\"o\">&gt;</span>::<span class=\"n\">with</span>\n<span class=\"w\">  </span><span class=\"mi\">41</span>: <span class=\"nc\">wasmtime</span>::<span class=\"n\">func</span>::<span class=\"n\">typed</span>::<span class=\"n\">TypedFunc</span><span class=\"o\">&lt;</span><span class=\"n\">Params</span><span class=\"p\">,</span><span class=\"n\">Results</span><span class=\"o\">&gt;</span>::<span class=\"n\">call</span>\n<span class=\"w\">  </span><span class=\"mi\">42</span>: <span class=\"o\">&lt;</span><span class=\"n\">core</span>::<span class=\"n\">panic</span>::<span class=\"n\">unwind_safe</span>::<span class=\"n\">AssertUnwindSafe</span><span class=\"o\">&lt;</span><span class=\"n\">F</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">core</span>::<span class=\"n\">ops</span>::<span class=\"n\">function</span>::<span class=\"nb\">FnOnce</span><span class=\"o\">&lt;</span><span class=\"p\">()</span><span class=\"o\">&gt;&gt;</span>::<span class=\"n\">call_once</span>\n<span class=\"n\">note</span>: <span class=\"nb\">Some</span> <span class=\"nc\">details</span><span class=\"w\"> </span><span class=\"n\">are</span><span class=\"w\"> </span><span class=\"n\">omitted</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">with</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">RUST_BACKTRACE</span><span class=\"o\">=</span><span class=\"n\">full</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">verbose</span><span class=\"w\"> </span><span class=\"n\">backtrace</span><span class=\"p\">.</span>\n<span class=\"n\">wasi</span><span class=\"o\">-</span><span class=\"n\">thread</span><span class=\"o\">-</span><span class=\"mi\">1053380974</span><span class=\"w\"> </span><span class=\"n\">panicked</span>: <span class=\"nc\">Any</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"o\">..</span><span class=\"w\"> </span><span class=\"p\">}</span>\n</code></pre></div>\n<h3>Versions and Environment</h3>\n<p>Wasmtime version or commit: Reproduced on 1d46c2d589d97cd5a13c17c88c8d288f643bdaff, and current release</p>\n<p>Operating system: Ubuntu 22</p>\n<p>Architecture: x86-64</p>\n<h3>Extra Info</h3>\n<p>Anything else you'd like to add? </p>\n<p>The backtrace is showing <code>wasi_common::snapshots::preview_1::wasi_snapshot_preview1::sched_yield</code> which could be related to the bug in wasi-threads I am investigating, which is likely an issue in rust std library as it can be reproduced in both wasmtime and wamr. However, I don't think it should result in a crash in wasmtime either way, so thought to open this report.</p>\n<p><a href=\"https://github.com/bytecodealliance/wasmtime/files/13214681/reproducing.zip\">reproducing.zip</a><br>\n</p>\n</blockquote>",
        "id": 399462655,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1698745861
    },
    {
        "content": "<p>fitzgen closed <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7418\">issue #7418</a>:</p>\n<blockquote>\n<p>Thanks for filing a bug report! Please fill out the TODOs below.</p>\n<p><strong>Note: if you want to report a security issue, please read our <a href=\"https://bytecodealliance.org/security\">security policy</a>!</strong></p>\n<h3>Test Case</h3>\n<p>Attached <code>reproducing.zip</code> which contains the WASM file, when ran with WASM time with log-to-files, causes panic</p>\n<h3>Steps to Reproduce</h3>\n<ul>\n<li>Download the reproducing.zip and decompress</li>\n<li>Run <code>RUST_LOG=wasi_common=trace wasmtime --wasm threads --wasi threads -D log-to-files reproducing.wasm</code></li>\n</ul>\n<h3>Expected Results</h3>\n<p>Program should run (although shouldn't exit, due to another issue <a href=\"#narrow/stream/349267-wasi-threads/topic/rust/near/395138228\">see</a>).</p>\n<h3>Actual Results</h3>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">thread</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"na\">wasi</span><span class=\"o\">-</span><span class=\"n\">thread</span><span class=\"o\">-</span><span class=\"mi\">949396201</span><span class=\"o\">'</span><span class=\"w\"> </span><span class=\"n\">panicked</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"na\">call</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">logger</span><span class=\"o\">'</span><span class=\"na\">s</span><span class=\"w\"> </span><span class=\"n\">initialize</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"n\">first</span><span class=\"o\">'</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">runner</span><span class=\"o\">/</span><span class=\"n\">work</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">/</span><span class=\"n\">vendor</span><span class=\"o\">/</span><span class=\"n\">file</span><span class=\"o\">-</span><span class=\"n\">per</span><span class=\"o\">-</span><span class=\"n\">thread</span><span class=\"o\">-</span><span class=\"n\">logger</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">164</span>:<span class=\"mi\">22</span>\n<span class=\"n\">note</span>: <span class=\"nc\">run</span><span class=\"w\"> </span><span class=\"n\">with</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">RUST_BACKTRACE</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">environment</span><span class=\"w\"> </span><span class=\"n\">variable</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">display</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">backtrace</span>\n<span class=\"n\">wasi</span><span class=\"o\">-</span><span class=\"n\">thread</span><span class=\"o\">-</span><span class=\"mi\">949396201</span><span class=\"w\"> </span><span class=\"n\">panicked</span>: <span class=\"nc\">Any</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"o\">..</span><span class=\"w\"> </span><span class=\"p\">}</span>\n</code></pre></div>\n<p>With backtrace,</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">thread</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"na\">wasi</span><span class=\"o\">-</span><span class=\"n\">thread</span><span class=\"o\">-</span><span class=\"mi\">1053380974</span><span class=\"o\">'</span><span class=\"w\"> </span><span class=\"n\">panicked</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"na\">call</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">logger</span><span class=\"o\">'</span><span class=\"na\">s</span><span class=\"w\"> </span><span class=\"n\">initialize</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"n\">first</span><span class=\"o\">'</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">runner</span><span class=\"o\">/</span><span class=\"n\">work</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">/</span><span class=\"n\">vendor</span><span class=\"o\">/</span><span class=\"n\">file</span><span class=\"o\">-</span><span class=\"n\">per</span><span class=\"o\">-</span><span class=\"n\">thread</span><span class=\"o\">-</span><span class=\"n\">logger</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">164</span>:<span class=\"mi\">22</span>\n<span class=\"n\">stack</span><span class=\"w\"> </span><span class=\"n\">backtrace</span>:\n   <span class=\"mi\">0</span>: <span class=\"nc\">rust_begin_unwind</span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"mi\">5680</span><span class=\"n\">fa18feaa87f3ff04063800aec256c3d4b4be</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">panicking</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">593</span>:<span class=\"mi\">5</span>\n<span class=\"w\">   </span><span class=\"mi\">1</span>: <span class=\"nc\">core</span>::<span class=\"n\">panicking</span>::<span class=\"n\">panic_fmt</span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"mi\">5680</span><span class=\"n\">fa18feaa87f3ff04063800aec256c3d4b4be</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">panicking</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">67</span>:<span class=\"mi\">14</span>\n<span class=\"w\">   </span><span class=\"mi\">2</span>: <span class=\"nc\">core</span>::<span class=\"n\">panicking</span>::<span class=\"n\">panic_display</span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"mi\">5680</span><span class=\"n\">fa18feaa87f3ff04063800aec256c3d4b4be</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">panicking</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">150</span>:<span class=\"mi\">5</span>\n<span class=\"w\">   </span><span class=\"mi\">3</span>: <span class=\"nc\">core</span>::<span class=\"n\">panicking</span>::<span class=\"n\">panic_str</span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"mi\">5680</span><span class=\"n\">fa18feaa87f3ff04063800aec256c3d4b4be</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">panicking</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">134</span>:<span class=\"mi\">5</span>\n<span class=\"w\">   </span><span class=\"mi\">4</span>: <span class=\"nc\">core</span>::<span class=\"n\">option</span>::<span class=\"n\">expect_failed</span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"mi\">5680</span><span class=\"n\">fa18feaa87f3ff04063800aec256c3d4b4be</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">option</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">1952</span>:<span class=\"mi\">5</span>\n<span class=\"w\">   </span><span class=\"mi\">5</span>: <span class=\"o\">&lt;</span><span class=\"n\">file_per_thread_logger</span>::<span class=\"n\">FilePerThreadLogger</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">log</span>::<span class=\"n\">Log</span><span class=\"o\">&gt;</span>::<span class=\"n\">log</span>\n<span class=\"w\">   </span><span class=\"mi\">6</span>: <span class=\"nc\">tracing</span>::<span class=\"n\">span</span>::<span class=\"n\">Span</span>::<span class=\"n\">log</span>\n<span class=\"w\">   </span><span class=\"mi\">7</span>: <span class=\"nc\">tracing</span>::<span class=\"n\">span</span>::<span class=\"n\">Span</span>::<span class=\"n\">record_all</span>\n<span class=\"w\">   </span><span class=\"mi\">8</span>: <span class=\"nc\">wasi_common</span>::<span class=\"n\">snapshots</span>::<span class=\"n\">preview_1</span>::<span class=\"n\">wasi_snapshot_preview1</span>::<span class=\"n\">sched_yield</span>\n<span class=\"w\">   </span><span class=\"mi\">9</span>: <span class=\"nc\">wiggle</span>::<span class=\"n\">run_in_dummy_executor</span>\n<span class=\"w\">  </span><span class=\"mi\">10</span>: <span class=\"o\">&lt;</span><span class=\"n\">core</span>::<span class=\"n\">panic</span>::<span class=\"n\">unwind_safe</span>::<span class=\"n\">AssertUnwindSafe</span><span class=\"o\">&lt;</span><span class=\"n\">F</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">core</span>::<span class=\"n\">ops</span>::<span class=\"n\">function</span>::<span class=\"nb\">FnOnce</span><span class=\"o\">&lt;</span><span class=\"p\">()</span><span class=\"o\">&gt;&gt;</span>::<span class=\"n\">call_once</span>\n<span class=\"w\">  </span><span class=\"mi\">11</span>: <span class=\"nc\">wasmtime_runtime</span>::<span class=\"n\">instance</span>::<span class=\"n\">Instance</span>::<span class=\"n\">from_vmctx</span>\n<span class=\"w\">  </span><span class=\"mi\">12</span>: <span class=\"o\">&lt;</span><span class=\"n\">F</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span>::<span class=\"n\">func</span>::<span class=\"n\">IntoFunc</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"p\">,(</span><span class=\"n\">wasmtime</span>::<span class=\"n\">func</span>::<span class=\"n\">Caller</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"o\">&gt;</span><span class=\"p\">,),</span><span class=\"n\">R</span><span class=\"o\">&gt;&gt;</span>::<span class=\"n\">into_func</span>::<span class=\"n\">native_call_shim</span>\n<span class=\"w\">  </span><span class=\"mi\">13</span>: <span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;</span>\n<span class=\"w\">  </span><span class=\"mi\">14</span>: <span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;</span>\n<span class=\"w\">  </span><span class=\"mi\">15</span>: <span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;</span>\n<span class=\"w\">  </span><span class=\"mi\">16</span>: <span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;</span>\n<span class=\"w\">  </span><span class=\"mi\">17</span>: <span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;</span>\n<span class=\"w\">  </span><span class=\"mi\">18</span>: <span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;</span>\n<span class=\"w\">  </span><span class=\"mi\">19</span>: <span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;</span>\n<span class=\"w\">  </span><span class=\"mi\">20</span>: <span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;</span>\n<span class=\"w\">  </span><span class=\"mi\">21</span>: <span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;</span>\n<span class=\"w\">  </span><span class=\"mi\">22</span>: <span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;</span>\n<span class=\"w\">  </span><span class=\"mi\">23</span>: <span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;</span>\n<span class=\"w\">  </span><span class=\"mi\">24</span>: <span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;</span>\n<span class=\"w\">  </span><span class=\"mi\">25</span>: <span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;</span>\n<span class=\"w\">  </span><span class=\"mi\">26</span>: <span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;</span>\n<span class=\"w\">  </span><span class=\"mi\">27</span>: <span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;</span>\n<span class=\"w\">  </span><span class=\"mi\">28</span>: <span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;</span>\n<span class=\"w\">  </span><span class=\"mi\">29</span>: <span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;</span>\n<span class=\"w\">  </span><span class=\"mi\">30</span>: <span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;</span>\n<span class=\"w\">  </span><span class=\"mi\">31</span>: <span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;</span>\n<span class=\"w\">  </span><span class=\"mi\">32</span>: <span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;</span>\n<span class=\"w\">  </span><span class=\"mi\">33</span>: <span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;</span>\n<span class=\"w\">  </span><span class=\"mi\">34</span>: <span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;</span>\n<span class=\"w\">  </span><span class=\"mi\">35</span>: <span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;</span>\n<span class=\"w\">  </span><span class=\"mi\">36</span>: <span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;</span>\n<span class=\"w\">  </span><span class=\"mi\">37</span>: <span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;</span>\n<span class=\"w\">  </span><span class=\"mi\">38</span>: <span class=\"nc\">wasmtime_runtime</span>::<span class=\"n\">traphandlers</span>::<span class=\"n\">catch_traps</span>::<span class=\"n\">call_closure</span>\n<span class=\"w\">  </span><span class=\"mi\">39</span>: <span class=\"nc\">wasmtime_setjmp_14_0_2</span>\n<span class=\"w\">  </span><span class=\"mi\">40</span>: <span class=\"nc\">wasmtime_runtime</span>::<span class=\"n\">traphandlers</span>::<span class=\"o\">&lt;</span><span class=\"k\">impl</span><span class=\"w\"> </span><span class=\"n\">wasmtime_runtime</span>::<span class=\"n\">traphandlers</span>::<span class=\"n\">call_thread_state</span>::<span class=\"n\">CallThreadState</span><span class=\"o\">&gt;</span>::<span class=\"n\">with</span>\n<span class=\"w\">  </span><span class=\"mi\">41</span>: <span class=\"nc\">wasmtime</span>::<span class=\"n\">func</span>::<span class=\"n\">typed</span>::<span class=\"n\">TypedFunc</span><span class=\"o\">&lt;</span><span class=\"n\">Params</span><span class=\"p\">,</span><span class=\"n\">Results</span><span class=\"o\">&gt;</span>::<span class=\"n\">call</span>\n<span class=\"w\">  </span><span class=\"mi\">42</span>: <span class=\"o\">&lt;</span><span class=\"n\">core</span>::<span class=\"n\">panic</span>::<span class=\"n\">unwind_safe</span>::<span class=\"n\">AssertUnwindSafe</span><span class=\"o\">&lt;</span><span class=\"n\">F</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">core</span>::<span class=\"n\">ops</span>::<span class=\"n\">function</span>::<span class=\"nb\">FnOnce</span><span class=\"o\">&lt;</span><span class=\"p\">()</span><span class=\"o\">&gt;&gt;</span>::<span class=\"n\">call_once</span>\n<span class=\"n\">note</span>: <span class=\"nb\">Some</span> <span class=\"nc\">details</span><span class=\"w\"> </span><span class=\"n\">are</span><span class=\"w\"> </span><span class=\"n\">omitted</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">with</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">RUST_BACKTRACE</span><span class=\"o\">=</span><span class=\"n\">full</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">verbose</span><span class=\"w\"> </span><span class=\"n\">backtrace</span><span class=\"p\">.</span>\n<span class=\"n\">wasi</span><span class=\"o\">-</span><span class=\"n\">thread</span><span class=\"o\">-</span><span class=\"mi\">1053380974</span><span class=\"w\"> </span><span class=\"n\">panicked</span>: <span class=\"nc\">Any</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"o\">..</span><span class=\"w\"> </span><span class=\"p\">}</span>\n</code></pre></div>\n<h3>Versions and Environment</h3>\n<p>Wasmtime version or commit: Reproduced on 1d46c2d589d97cd5a13c17c88c8d288f643bdaff, and current release</p>\n<p>Operating system: Ubuntu 22</p>\n<p>Architecture: x86-64</p>\n<h3>Extra Info</h3>\n<p>Anything else you'd like to add? </p>\n<p>The backtrace is showing <code>wasi_common::snapshots::preview_1::wasi_snapshot_preview1::sched_yield</code> which could be related to the bug in wasi-threads I am investigating, which is likely an issue in rust std library as it can be reproduced in both wasmtime and wamr. However, I don't think it should result in a crash in wasmtime either way, so thought to open this report.</p>\n<p><a href=\"https://github.com/bytecodealliance/wasmtime/files/13214681/reproducing.zip\">reproducing.zip</a><br>\n</p>\n</blockquote>",
        "id": 399567983,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1698772565
    }
]