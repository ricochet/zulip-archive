[
    {
        "content": "<p><a href=\"https://github.com/MendyBerger\">MendyBerger</a> added the bug label to <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7951\">Issue #7951</a>.</p>",
        "id": 421853037,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1708088260
    },
    {
        "content": "<p>MendyBerger opened <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7951\">issue #7951</a>:</p>\n<blockquote>\n<p>This issue is a weird one. There seems to be some very specific set of inputs that trigger a utf8 parsing error, and modifying the inputs even just a little can stop it from happening. This was really hard to get to reproduce reliably.</p>\n<p>I ran into this issue twice, and this is my smallest reproduction that triggers it. Sorry if it's too convoluted, don't know how to make it smaller, and already spent quite a few hours on it.</p>\n<h3>Test Case</h3>\n<p><a href=\"https://github.com/MendyBerger/wasmtime-utf8-parsing-error/blob/main/wasm/out.wasm\">https://github.com/MendyBerger/wasmtime-utf8-parsing-error/blob/main/wasm/out.wasm</a></p>\n<h3>Steps to Reproduce</h3>\n<p>Clone the repo at <a href=\"https://github.com/MendyBerger/wasmtime-utf8-parsing-error\">https://github.com/MendyBerger/wasmtime-utf8-parsing-error</a>.<br>\nCompile the wasm module.<br>\nRun with the runtime.</p>\n<p>Here's a list of commnads</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code>#<span class=\"w\"> </span><span class=\"n\">clone</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">repo</span>\n<span class=\"n\">git</span><span class=\"w\"> </span><span class=\"n\">clone</span><span class=\"w\"> </span><span class=\"n\">https</span>:<span class=\"c1\">//github.com/MendyBerger/wasmtime-utf8-parsing-error</span>\n<span class=\"n\">cd</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">utf8</span><span class=\"o\">-</span><span class=\"n\">parsing</span><span class=\"o\">-</span><span class=\"n\">error</span>\n\n#<span class=\"w\"> </span><span class=\"n\">compile</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"n\">module</span>\n<span class=\"n\">cd</span><span class=\"w\"> </span><span class=\"n\">wasm</span>\n<span class=\"n\">cargo</span><span class=\"w\"> </span><span class=\"n\">build</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">release</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">target</span><span class=\"w\"> </span><span class=\"n\">wasm32</span><span class=\"o\">-</span><span class=\"n\">unknown</span><span class=\"o\">-</span><span class=\"n\">unknown</span>\n<span class=\"n\">wasm</span><span class=\"o\">-</span><span class=\"n\">tools</span><span class=\"w\"> </span><span class=\"n\">component</span><span class=\"w\"> </span><span class=\"n\">new</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">target</span><span class=\"o\">/</span><span class=\"n\">wasm32</span><span class=\"o\">-</span><span class=\"n\">unknown</span><span class=\"o\">-</span><span class=\"n\">unknown</span><span class=\"o\">/</span><span class=\"n\">release</span><span class=\"o\">/</span><span class=\"n\">wasm</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">o</span><span class=\"w\"> </span><span class=\"n\">out</span><span class=\"p\">.</span><span class=\"n\">wasm</span>\n\n#<span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">runtime</span>\n<span class=\"n\">cd</span><span class=\"w\"> </span><span class=\"o\">../</span><span class=\"n\">runtime</span>\n<span class=\"n\">cargo</span><span class=\"w\"> </span><span class=\"n\">run</span>\n</code></pre></div>\n<h3>Expected Results</h3>\n<p>Expect it to just run.</p>\n<h3>Actual Results</h3>\n<p>Fails with the following error:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">Error</span>: <span class=\"nc\">error</span><span class=\"w\"> </span><span class=\"k\">while</span><span class=\"w\"> </span><span class=\"n\">executing</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"n\">backtrace</span>:\n    <span class=\"mi\">0</span>: <span class=\"mh\">0x1596ef</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">wit</span><span class=\"o\">-</span><span class=\"n\">component</span>:<span class=\"nc\">shim</span><span class=\"o\">!</span><span class=\"n\">indirect</span><span class=\"o\">-</span><span class=\"cp\">$root</span><span class=\"o\">-</span><span class=\"n\">my</span><span class=\"o\">-</span><span class=\"n\">func</span>\n<span class=\"w\">    </span><span class=\"mi\">1</span>:  <span class=\"mh\">0x4ab</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!</span><span class=\"n\">run</span>\n<span class=\"n\">note</span>: <span class=\"nc\">using</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">WASMTIME_BACKTRACE_DETAILS</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">environment</span><span class=\"w\"> </span><span class=\"n\">variable</span><span class=\"w\"> </span><span class=\"n\">may</span><span class=\"w\"> </span><span class=\"n\">show</span><span class=\"w\"> </span><span class=\"n\">more</span><span class=\"w\"> </span><span class=\"n\">debugging</span><span class=\"w\"> </span><span class=\"n\">information</span>\n\n<span class=\"n\">Caused</span><span class=\"w\"> </span><span class=\"n\">by</span>:\n    <span class=\"nc\">invalid</span><span class=\"w\"> </span><span class=\"n\">utf</span><span class=\"o\">-</span><span class=\"mi\">8</span><span class=\"w\"> </span><span class=\"n\">sequence</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">bytes</span><span class=\"w\"> </span><span class=\"n\">from</span><span class=\"w\"> </span><span class=\"n\">index</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n</code></pre></div>\n<h3>Versions and Environment</h3>\n<p>Wasmtime version or commit: <code>17.0.1</code></p>\n<p>Operating system: Ubuntu </p>\n<p>Architecture: x86</p>\n<h3>Extra Info</h3>\n<p>Some of the weirdness:</p>\n<ul>\n<li>Try to change the 'p' to a 'j' <a href=\"https://github.com/MendyBerger/wasmtime-utf8-parsing-error/blob/ccf0f1a9039eca12cc5bb3b81b07439c75427ca3/wasm/src/lib.rs#L22\">here</a>, notice how it no longer triggers the issue <span aria-label=\"upside down\" class=\"emoji emoji-1f643\" role=\"img\" title=\"upside down\">:upside_down:</span></li>\n<li>Remove a single 'p' from <a href=\"https://github.com/MendyBerger/wasmtime-utf8-parsing-error/blob/ccf0f1a9039eca12cc5bb3b81b07439c75427ca3/wasm/src/lib.rs#L24\">this</a> string, and the issue no longer gets triggered <span aria-label=\"astonished\" class=\"emoji emoji-1f632\" role=\"img\" title=\"astonished\">:astonished:</span> </li>\n<li>Change the 'p's <a href=\"https://github.com/MendyBerger/wasmtime-utf8-parsing-error/blob/ccf0f1a9039eca12cc5bb3b81b07439c75427ca3/wasm/src/lib.rs#L24\">here</a> for another char, and the issue still gets triggered <span aria-label=\"thinking\" class=\"emoji emoji-1f914\" role=\"img\" title=\"thinking\">:thinking:</span><br>\n</li>\n</ul>\n</blockquote>",
        "id": 421853039,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1708088261
    },
    {
        "content": "<p>MendyBerger edited <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7951\">issue #7951</a>:</p>\n<blockquote>\n<p>This issue is a weird one. There seems to be some very specific set of inputs that trigger a utf8 parsing error, and modifying the inputs even just a little can stop it from happening. This was really hard to get to reproduce reliably.</p>\n<p>I ran into this issue twice, and this is my smallest reproduction that triggers it. Sorry if it's too convoluted, don't know how to make it smaller, and already spent quite a few hours on it.</p>\n<h3>Test Case</h3>\n<p><a href=\"https://github.com/MendyBerger/wasmtime-utf8-parsing-error/blob/main/wasm/out.wasm\">https://github.com/MendyBerger/wasmtime-utf8-parsing-error/blob/main/wasm/out.wasm</a></p>\n<h3>Steps to Reproduce</h3>\n<p>Clone the repo at <a href=\"https://github.com/MendyBerger/wasmtime-utf8-parsing-error\">https://github.com/MendyBerger/wasmtime-utf8-parsing-error</a>.<br>\nCompile the wasm module.<br>\nRun with the runtime.</p>\n<p>Here's a list of commands</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code>#<span class=\"w\"> </span><span class=\"n\">clone</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">repo</span>\n<span class=\"n\">git</span><span class=\"w\"> </span><span class=\"n\">clone</span><span class=\"w\"> </span><span class=\"n\">https</span>:<span class=\"c1\">//github.com/MendyBerger/wasmtime-utf8-parsing-error</span>\n<span class=\"n\">cd</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">utf8</span><span class=\"o\">-</span><span class=\"n\">parsing</span><span class=\"o\">-</span><span class=\"n\">error</span>\n\n#<span class=\"w\"> </span><span class=\"n\">compile</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"n\">module</span>\n<span class=\"n\">cd</span><span class=\"w\"> </span><span class=\"n\">wasm</span>\n<span class=\"n\">cargo</span><span class=\"w\"> </span><span class=\"n\">build</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">release</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">target</span><span class=\"w\"> </span><span class=\"n\">wasm32</span><span class=\"o\">-</span><span class=\"n\">unknown</span><span class=\"o\">-</span><span class=\"n\">unknown</span>\n<span class=\"n\">wasm</span><span class=\"o\">-</span><span class=\"n\">tools</span><span class=\"w\"> </span><span class=\"n\">component</span><span class=\"w\"> </span><span class=\"n\">new</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">target</span><span class=\"o\">/</span><span class=\"n\">wasm32</span><span class=\"o\">-</span><span class=\"n\">unknown</span><span class=\"o\">-</span><span class=\"n\">unknown</span><span class=\"o\">/</span><span class=\"n\">release</span><span class=\"o\">/</span><span class=\"n\">wasm</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">o</span><span class=\"w\"> </span><span class=\"n\">out</span><span class=\"p\">.</span><span class=\"n\">wasm</span>\n\n#<span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">runtime</span>\n<span class=\"n\">cd</span><span class=\"w\"> </span><span class=\"o\">../</span><span class=\"n\">runtime</span>\n<span class=\"n\">cargo</span><span class=\"w\"> </span><span class=\"n\">run</span>\n</code></pre></div>\n<h3>Expected Results</h3>\n<p>Expect it to just run.</p>\n<h3>Actual Results</h3>\n<p>Fails with the following error:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">Error</span>: <span class=\"nc\">error</span><span class=\"w\"> </span><span class=\"k\">while</span><span class=\"w\"> </span><span class=\"n\">executing</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"n\">backtrace</span>:\n    <span class=\"mi\">0</span>: <span class=\"mh\">0x1596ef</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">wit</span><span class=\"o\">-</span><span class=\"n\">component</span>:<span class=\"nc\">shim</span><span class=\"o\">!</span><span class=\"n\">indirect</span><span class=\"o\">-</span><span class=\"cp\">$root</span><span class=\"o\">-</span><span class=\"n\">my</span><span class=\"o\">-</span><span class=\"n\">func</span>\n<span class=\"w\">    </span><span class=\"mi\">1</span>:  <span class=\"mh\">0x4ab</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!</span><span class=\"n\">run</span>\n<span class=\"n\">note</span>: <span class=\"nc\">using</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">WASMTIME_BACKTRACE_DETAILS</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">environment</span><span class=\"w\"> </span><span class=\"n\">variable</span><span class=\"w\"> </span><span class=\"n\">may</span><span class=\"w\"> </span><span class=\"n\">show</span><span class=\"w\"> </span><span class=\"n\">more</span><span class=\"w\"> </span><span class=\"n\">debugging</span><span class=\"w\"> </span><span class=\"n\">information</span>\n\n<span class=\"n\">Caused</span><span class=\"w\"> </span><span class=\"n\">by</span>:\n    <span class=\"nc\">invalid</span><span class=\"w\"> </span><span class=\"n\">utf</span><span class=\"o\">-</span><span class=\"mi\">8</span><span class=\"w\"> </span><span class=\"n\">sequence</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">bytes</span><span class=\"w\"> </span><span class=\"n\">from</span><span class=\"w\"> </span><span class=\"n\">index</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n</code></pre></div>\n<h3>Versions and Environment</h3>\n<p>Wasmtime version or commit: <code>17.0.1</code></p>\n<p>Operating system: Ubuntu </p>\n<p>Architecture: x86</p>\n<h3>Extra Info</h3>\n<p>Some of the weirdness:</p>\n<ul>\n<li>Try to change the 'p' to a 'j' <a href=\"https://github.com/MendyBerger/wasmtime-utf8-parsing-error/blob/ccf0f1a9039eca12cc5bb3b81b07439c75427ca3/wasm/src/lib.rs#L22\">here</a>, notice how it no longer triggers the issue <span aria-label=\"upside down\" class=\"emoji emoji-1f643\" role=\"img\" title=\"upside down\">:upside_down:</span></li>\n<li>Remove a single 'p' from <a href=\"https://github.com/MendyBerger/wasmtime-utf8-parsing-error/blob/ccf0f1a9039eca12cc5bb3b81b07439c75427ca3/wasm/src/lib.rs#L24\">this</a> string, and the issue no longer gets triggered <span aria-label=\"astonished\" class=\"emoji emoji-1f632\" role=\"img\" title=\"astonished\">:astonished:</span> </li>\n<li>Change the 'p's <a href=\"https://github.com/MendyBerger/wasmtime-utf8-parsing-error/blob/ccf0f1a9039eca12cc5bb3b81b07439c75427ca3/wasm/src/lib.rs#L24\">here</a> for another char, and the issue still gets triggered <span aria-label=\"thinking\" class=\"emoji emoji-1f914\" role=\"img\" title=\"thinking\">:thinking:</span><br>\n</li>\n</ul>\n</blockquote>",
        "id": 421853333,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1708088393
    },
    {
        "content": "<p>MendyBerger edited <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7951\">issue #7951</a>:</p>\n<blockquote>\n<p>This issue is a weird one. There seems to be some very specific set of inputs that trigger a utf8 parsing error, and modifying the inputs even just a little can stop it from happening. This was really hard to get to reproduce reliably.</p>\n<p>I ran into this issue twice, and this is my smallest reproduction that triggers it. Sorry if it's too convoluted, don't know how to make it smaller, and already spent quite a few hours on it.</p>\n<h3>Test Case</h3>\n<p>Wasm input:<br>\n<a href=\"https://github.com/MendyBerger/wasmtime-utf8-parsing-error/blob/main/wasm/src/lib.rs\">https://github.com/MendyBerger/wasmtime-utf8-parsing-error/blob/main/wasm/src/lib.rs</a></p>\n<p>Actual wasm:<br>\n<a href=\"https://github.com/MendyBerger/wasmtime-utf8-parsing-error/blob/main/wasm/out.wasm\">https://github.com/MendyBerger/wasmtime-utf8-parsing-error/blob/main/wasm/out.wasm</a></p>\n<p>Runtime code:<br>\n<a href=\"https://github.com/MendyBerger/wasmtime-utf8-parsing-error/blob/main/runtime/src/main.rs\">https://github.com/MendyBerger/wasmtime-utf8-parsing-error/blob/main/runtime/src/main.rs</a></p>\n<h3>Steps to Reproduce</h3>\n<p>Clone the repo at <a href=\"https://github.com/MendyBerger/wasmtime-utf8-parsing-error\">https://github.com/MendyBerger/wasmtime-utf8-parsing-error</a>.<br>\nCompile the wasm module.<br>\nRun with the runtime.</p>\n<p>Here's a list of commands</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code>#<span class=\"w\"> </span><span class=\"n\">clone</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">repo</span>\n<span class=\"n\">git</span><span class=\"w\"> </span><span class=\"n\">clone</span><span class=\"w\"> </span><span class=\"n\">https</span>:<span class=\"c1\">//github.com/MendyBerger/wasmtime-utf8-parsing-error</span>\n<span class=\"n\">cd</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">utf8</span><span class=\"o\">-</span><span class=\"n\">parsing</span><span class=\"o\">-</span><span class=\"n\">error</span>\n\n#<span class=\"w\"> </span><span class=\"n\">compile</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"n\">module</span>\n<span class=\"n\">cd</span><span class=\"w\"> </span><span class=\"n\">wasm</span>\n<span class=\"n\">cargo</span><span class=\"w\"> </span><span class=\"n\">build</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">release</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">target</span><span class=\"w\"> </span><span class=\"n\">wasm32</span><span class=\"o\">-</span><span class=\"n\">unknown</span><span class=\"o\">-</span><span class=\"n\">unknown</span>\n<span class=\"n\">wasm</span><span class=\"o\">-</span><span class=\"n\">tools</span><span class=\"w\"> </span><span class=\"n\">component</span><span class=\"w\"> </span><span class=\"n\">new</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">target</span><span class=\"o\">/</span><span class=\"n\">wasm32</span><span class=\"o\">-</span><span class=\"n\">unknown</span><span class=\"o\">-</span><span class=\"n\">unknown</span><span class=\"o\">/</span><span class=\"n\">release</span><span class=\"o\">/</span><span class=\"n\">wasm</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">o</span><span class=\"w\"> </span><span class=\"n\">out</span><span class=\"p\">.</span><span class=\"n\">wasm</span>\n\n#<span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">runtime</span>\n<span class=\"n\">cd</span><span class=\"w\"> </span><span class=\"o\">../</span><span class=\"n\">runtime</span>\n<span class=\"n\">cargo</span><span class=\"w\"> </span><span class=\"n\">run</span>\n</code></pre></div>\n<h3>Expected Results</h3>\n<p>Expect it to just run.</p>\n<h3>Actual Results</h3>\n<p>Fails with the following error:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">Error</span>: <span class=\"nc\">error</span><span class=\"w\"> </span><span class=\"k\">while</span><span class=\"w\"> </span><span class=\"n\">executing</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"n\">backtrace</span>:\n    <span class=\"mi\">0</span>: <span class=\"mh\">0x1596ef</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">wit</span><span class=\"o\">-</span><span class=\"n\">component</span>:<span class=\"nc\">shim</span><span class=\"o\">!</span><span class=\"n\">indirect</span><span class=\"o\">-</span><span class=\"cp\">$root</span><span class=\"o\">-</span><span class=\"n\">my</span><span class=\"o\">-</span><span class=\"n\">func</span>\n<span class=\"w\">    </span><span class=\"mi\">1</span>:  <span class=\"mh\">0x4ab</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!</span><span class=\"n\">run</span>\n<span class=\"n\">note</span>: <span class=\"nc\">using</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">WASMTIME_BACKTRACE_DETAILS</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">environment</span><span class=\"w\"> </span><span class=\"n\">variable</span><span class=\"w\"> </span><span class=\"n\">may</span><span class=\"w\"> </span><span class=\"n\">show</span><span class=\"w\"> </span><span class=\"n\">more</span><span class=\"w\"> </span><span class=\"n\">debugging</span><span class=\"w\"> </span><span class=\"n\">information</span>\n\n<span class=\"n\">Caused</span><span class=\"w\"> </span><span class=\"n\">by</span>:\n    <span class=\"nc\">invalid</span><span class=\"w\"> </span><span class=\"n\">utf</span><span class=\"o\">-</span><span class=\"mi\">8</span><span class=\"w\"> </span><span class=\"n\">sequence</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">bytes</span><span class=\"w\"> </span><span class=\"n\">from</span><span class=\"w\"> </span><span class=\"n\">index</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n</code></pre></div>\n<h3>Versions and Environment</h3>\n<p>Wasmtime version or commit: <code>17.0.1</code></p>\n<p>Operating system: Ubuntu </p>\n<p>Architecture: x86</p>\n<h3>Extra Info</h3>\n<p>Some of the weirdness:</p>\n<ul>\n<li>Try to change the 'p' to a 'j' <a href=\"https://github.com/MendyBerger/wasmtime-utf8-parsing-error/blob/ccf0f1a9039eca12cc5bb3b81b07439c75427ca3/wasm/src/lib.rs#L22\">here</a>, notice how it no longer triggers the issue <span aria-label=\"upside down\" class=\"emoji emoji-1f643\" role=\"img\" title=\"upside down\">:upside_down:</span></li>\n<li>Remove a single 'p' from <a href=\"https://github.com/MendyBerger/wasmtime-utf8-parsing-error/blob/ccf0f1a9039eca12cc5bb3b81b07439c75427ca3/wasm/src/lib.rs#L24\">this</a> string, and the issue no longer gets triggered <span aria-label=\"astonished\" class=\"emoji emoji-1f632\" role=\"img\" title=\"astonished\">:astonished:</span> </li>\n<li>Change the 'p's <a href=\"https://github.com/MendyBerger/wasmtime-utf8-parsing-error/blob/ccf0f1a9039eca12cc5bb3b81b07439c75427ca3/wasm/src/lib.rs#L24\">here</a> for another char, and the issue still gets triggered <span aria-label=\"thinking\" class=\"emoji emoji-1f914\" role=\"img\" title=\"thinking\">:thinking:</span><br>\n</li>\n</ul>\n</blockquote>",
        "id": 421853797,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1708088552
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7951#issuecomment-1948732130\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7951\">issue #7951</a>:</p>\n<blockquote>\n<p>Thanks for the report, and very much appreciate the work put in to minimizing this! Looking at the code I haven't reproduce this exactly just yet but I suspect you're running into <a href=\"https://github.com/bytecodealliance/wit-bindgen/issues/817\">https://github.com/bytecodealliance/wit-bindgen/issues/817</a> where this is a bug in the guest generated code where there's UB in the rust/wasm layer, which I think could explain why you're seeing such surprising behavior here.</p>\n<p>I'll try to see if I can fix that issue soon and see if it fixes this as well</p>\n</blockquote>",
        "id": 421887946,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1708099251
    },
    {
        "content": "<p>MendyBerger <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7951#issuecomment-1948940861\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7951\">issue #7951</a>:</p>\n<blockquote>\n<p>Thanks!! I'll keep an eye on that one.</p>\n</blockquote>",
        "id": 421904793,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1708104104
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7951#issuecomment-1949797468\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7951\">issue #7951</a>:</p>\n<blockquote>\n<p>Ok I've confirmed that your issue should be fixed by <a href=\"https://github.com/bytecodealliance/wit-bindgen/pull/846\">https://github.com/bytecodealliance/wit-bindgen/pull/846</a>, so I think it was indeed that wit-bindgen issue.</p>\n</blockquote>",
        "id": 421980827,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1708151392
    },
    {
        "content": "<p>MendyBerger <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7951#issuecomment-1950717739\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7951\">issue #7951</a>:</p>\n<blockquote>\n<p>@alexcrichton thanks so much!!! I super appreciate how quickly you did this!</p>\n</blockquote>",
        "id": 422056526,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1708219640
    },
    {
        "content": "<p>alexcrichton closed <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7951\">issue #7951</a>:</p>\n<blockquote>\n<p>This issue is a weird one. There seems to be some very specific set of inputs that trigger a utf8 parsing error, and modifying the inputs even just a little can stop it from happening. This was really hard to get to reproduce reliably.</p>\n<p>I ran into this issue twice, and this is my smallest reproduction that triggers it. Sorry if it's too convoluted, don't know how to make it smaller, and already spent quite a few hours on it.</p>\n<h3>Test Case</h3>\n<p>Wasm input:<br>\n<a href=\"https://github.com/MendyBerger/wasmtime-utf8-parsing-error/blob/main/wasm/src/lib.rs\">https://github.com/MendyBerger/wasmtime-utf8-parsing-error/blob/main/wasm/src/lib.rs</a></p>\n<p>Actual wasm:<br>\n<a href=\"https://github.com/MendyBerger/wasmtime-utf8-parsing-error/blob/main/wasm/out.wasm\">https://github.com/MendyBerger/wasmtime-utf8-parsing-error/blob/main/wasm/out.wasm</a></p>\n<p>Runtime code:<br>\n<a href=\"https://github.com/MendyBerger/wasmtime-utf8-parsing-error/blob/main/runtime/src/main.rs\">https://github.com/MendyBerger/wasmtime-utf8-parsing-error/blob/main/runtime/src/main.rs</a></p>\n<h3>Steps to Reproduce</h3>\n<p>Clone the repo at <a href=\"https://github.com/MendyBerger/wasmtime-utf8-parsing-error\">https://github.com/MendyBerger/wasmtime-utf8-parsing-error</a>.<br>\nCompile the wasm module.<br>\nRun with the runtime.</p>\n<p>Here's a list of commands</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code>#<span class=\"w\"> </span><span class=\"n\">clone</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">repo</span>\n<span class=\"n\">git</span><span class=\"w\"> </span><span class=\"n\">clone</span><span class=\"w\"> </span><span class=\"n\">https</span>:<span class=\"c1\">//github.com/MendyBerger/wasmtime-utf8-parsing-error</span>\n<span class=\"n\">cd</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">utf8</span><span class=\"o\">-</span><span class=\"n\">parsing</span><span class=\"o\">-</span><span class=\"n\">error</span>\n\n#<span class=\"w\"> </span><span class=\"n\">compile</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"n\">module</span>\n<span class=\"n\">cd</span><span class=\"w\"> </span><span class=\"n\">wasm</span>\n<span class=\"n\">cargo</span><span class=\"w\"> </span><span class=\"n\">build</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">release</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">target</span><span class=\"w\"> </span><span class=\"n\">wasm32</span><span class=\"o\">-</span><span class=\"n\">unknown</span><span class=\"o\">-</span><span class=\"n\">unknown</span>\n<span class=\"n\">wasm</span><span class=\"o\">-</span><span class=\"n\">tools</span><span class=\"w\"> </span><span class=\"n\">component</span><span class=\"w\"> </span><span class=\"n\">new</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">target</span><span class=\"o\">/</span><span class=\"n\">wasm32</span><span class=\"o\">-</span><span class=\"n\">unknown</span><span class=\"o\">-</span><span class=\"n\">unknown</span><span class=\"o\">/</span><span class=\"n\">release</span><span class=\"o\">/</span><span class=\"n\">wasm</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">o</span><span class=\"w\"> </span><span class=\"n\">out</span><span class=\"p\">.</span><span class=\"n\">wasm</span>\n\n#<span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">runtime</span>\n<span class=\"n\">cd</span><span class=\"w\"> </span><span class=\"o\">../</span><span class=\"n\">runtime</span>\n<span class=\"n\">cargo</span><span class=\"w\"> </span><span class=\"n\">run</span>\n</code></pre></div>\n<h3>Expected Results</h3>\n<p>Expect it to just run.</p>\n<h3>Actual Results</h3>\n<p>Fails with the following error:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">Error</span>: <span class=\"nc\">error</span><span class=\"w\"> </span><span class=\"k\">while</span><span class=\"w\"> </span><span class=\"n\">executing</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"n\">backtrace</span>:\n    <span class=\"mi\">0</span>: <span class=\"mh\">0x1596ef</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">wit</span><span class=\"o\">-</span><span class=\"n\">component</span>:<span class=\"nc\">shim</span><span class=\"o\">!</span><span class=\"n\">indirect</span><span class=\"o\">-</span><span class=\"cp\">$root</span><span class=\"o\">-</span><span class=\"n\">my</span><span class=\"o\">-</span><span class=\"n\">func</span>\n<span class=\"w\">    </span><span class=\"mi\">1</span>:  <span class=\"mh\">0x4ab</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!</span><span class=\"n\">run</span>\n<span class=\"n\">note</span>: <span class=\"nc\">using</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">WASMTIME_BACKTRACE_DETAILS</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">environment</span><span class=\"w\"> </span><span class=\"n\">variable</span><span class=\"w\"> </span><span class=\"n\">may</span><span class=\"w\"> </span><span class=\"n\">show</span><span class=\"w\"> </span><span class=\"n\">more</span><span class=\"w\"> </span><span class=\"n\">debugging</span><span class=\"w\"> </span><span class=\"n\">information</span>\n\n<span class=\"n\">Caused</span><span class=\"w\"> </span><span class=\"n\">by</span>:\n    <span class=\"nc\">invalid</span><span class=\"w\"> </span><span class=\"n\">utf</span><span class=\"o\">-</span><span class=\"mi\">8</span><span class=\"w\"> </span><span class=\"n\">sequence</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">bytes</span><span class=\"w\"> </span><span class=\"n\">from</span><span class=\"w\"> </span><span class=\"n\">index</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n</code></pre></div>\n<h3>Versions and Environment</h3>\n<p>Wasmtime version or commit: <code>17.0.1</code></p>\n<p>Operating system: Ubuntu </p>\n<p>Architecture: x86</p>\n<h3>Extra Info</h3>\n<p>Some of the weirdness:</p>\n<ul>\n<li>Try to change the 'p' to a 'j' <a href=\"https://github.com/MendyBerger/wasmtime-utf8-parsing-error/blob/ccf0f1a9039eca12cc5bb3b81b07439c75427ca3/wasm/src/lib.rs#L22\">here</a>, notice how it no longer triggers the issue <span aria-label=\"upside down\" class=\"emoji emoji-1f643\" role=\"img\" title=\"upside down\">:upside_down:</span></li>\n<li>Remove a single 'p' from <a href=\"https://github.com/MendyBerger/wasmtime-utf8-parsing-error/blob/ccf0f1a9039eca12cc5bb3b81b07439c75427ca3/wasm/src/lib.rs#L24\">this</a> string, and the issue no longer gets triggered <span aria-label=\"astonished\" class=\"emoji emoji-1f632\" role=\"img\" title=\"astonished\">:astonished:</span> </li>\n<li>Change the 'p's <a href=\"https://github.com/MendyBerger/wasmtime-utf8-parsing-error/blob/ccf0f1a9039eca12cc5bb3b81b07439c75427ca3/wasm/src/lib.rs#L24\">here</a> for another char, and the issue still gets triggered <span aria-label=\"thinking\" class=\"emoji emoji-1f914\" role=\"img\" title=\"thinking\">:thinking:</span><br>\n</li>\n</ul>\n</blockquote>",
        "id": 422492246,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1708459308
    }
]