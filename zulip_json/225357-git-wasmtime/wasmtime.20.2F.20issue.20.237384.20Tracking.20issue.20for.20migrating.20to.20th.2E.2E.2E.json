[
    {
        "content": "<p>alexcrichton opened <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7384\">issue #7384</a>:</p>\n<blockquote>\n<p>I'm opening this as a tracking issue to assist users in migrating from the old<br>\nWasmtime 13-and-prior CLI to the new Wasmtime 14-and-later CLI. Wasmtime 14.0.x<br>\nis going to receive a patch update which restores support for the old CLI to<br>\nsimultaneously support both the old and the new. The support, however, will<br>\nissue warnings that point to this issue. Specifically:</p>\n<ul>\n<li>\n<p>If a CLI invocation parses different in Wasmtime 13 (\"the old\") and Wasmtime<br>\n  14 (\"the new\") then a warning is issued. For example:</p>\n<p><code>\nwasmtime run foo.wasm --invoke bar\n</code></p>\n<p>Was parsed in the old parser as invoking the <code>bar</code> function of <code>foo.wasm</code>. In<br>\nthe new parser this parses as passing the <code>--invoke</code> flag to the <code>foo.wasm</code><br>\nCLI program. In this situation a warning will be issued. This example could be<br>\nfixed by changing the order of the arguments:</p>\n<p><code>\nwasmtime run --invoke bar foo.wasm\n</code></p>\n<p>which will no longer emit a warning.</p>\n</li>\n<li>\n<p>CLI invocations which fail to parse in the new parser but succeed in the old<br>\n  parser will continue to work but emit a warning. For example:</p>\n<p><code>\nwasmtime run --disable-cache foo.wasm\n</code></p>\n<p>no longer works because <code>--disable-cache</code> was renamed to <code>-C cache=n</code>. This<br>\nwill continue to work through but emit a warning.</p>\n</li>\n</ul>\n<p>This issue is being filed as I'm going to hardcode in the source code a print<br>\nof a warning which points here for users to find and discuss. My hope is to<br>\nincorporate feedback here into future iterations of the warning and/or the CLI.</p>\n<h1>Changes in Wasmtime 14</h1>\n<p>In Wasmtime 14 the <code>wasmtime</code> executable CLI syntax changed. #6925 has a<br>\nsummary of the changes as well as a detailed table to renamed flags, but a<br>\nsummary is restated here as well.</p>\n<h2>Parsing Changes</h2>\n<p>The first major change in Wasmtime 14 was a change to how arguments are parsed<br>\nto Wasmtime vs the WebAssembly program being run. Previously Wasmtime would<br>\nparse arguments anywhere before a <code>--</code> on the CLI as its own, and everything<br>\nelse was passed to the wasm program. This is a future compatibility hazard<br>\nthough because <code>--</code> is often omitted meaning that in the future it could be<br>\ndifficult for Wasmtime to add new CLI options as they would shadow any matching<br>\noption passed to wasm itself.</p>\n<p>Instead, starting in Wasmtime 14, all flags to Wasmtime must happen between the<br>\n<code>wasmtime</code> subcommand and the WebAssembly program being run. For example:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">flags</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">wasm</span><span class=\"o\">-</span><span class=\"n\">flags</span><span class=\"p\">]</span>\n</code></pre></div>\n<p>or</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">flags</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">wasm</span><span class=\"o\">-</span><span class=\"n\">flags</span><span class=\"p\">]</span>\n</code></pre></div>\n<h2>Syntax Changes</h2>\n<p>The second major change in Wasmtime 14 was a change to the syntax of how many<br>\narguments are passed. The Wasmtime CLI had previously organically grown where<br>\noptions were inconsistently named and surfaced. This ended up with a sprawling<br>\n<code>--help</code> page as well differences between option names. Options are now<br>\ncategorized into five broad categories:</p>\n<ul>\n<li><code>-O foo</code> - an optimization or performance-tuning related option</li>\n<li><code>-C foo</code> - a codegen option affecting the compilation process.</li>\n<li><code>-D foo</code> - a debug-related option</li>\n<li><code>-W foo</code> - a wasm-related option, for example changing wasm semantics</li>\n<li><code>-S foo</code> - a WASI-related option, configuring various proposals for example</li>\n</ul>\n<p>These single-letter flags additionally have <code>--longer</code> names as well. Nearly<br>\nall configuration and tuning options for Wasmtime are now housed behind one of<br>\nthese flags. Each flag can be explored with <code>wasmtime -O help</code> for example.</p>\n<h1>Examples of handling warnings</h1>\n<p>This section is intended to list a suite of old CLI invocations and their<br>\nequivalent in the new CLI. Where possible a new command is listed which parses<br>\nthe same both under the old CLI and the new CLI.</p>\n<p><strong>Moving Wasmtime options before the WebAssembly file</strong></p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">old</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">invoke</span><span class=\"w\"> </span><span class=\"n\">bar</span>\n<span class=\"n\">new</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">invoke</span><span class=\"w\"> </span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span>\n</code></pre></div>\n<p><strong>Renaming Wasmtime options</strong></p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">old</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">disable</span><span class=\"o\">-</span><span class=\"n\">cache</span>\n<span class=\"n\">new</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">cache</span><span class=\"o\">=</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span>\n</code></pre></div>\n<p><strong>Renaming Wasmtime options</strong></p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">old</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">disable</span><span class=\"o\">-</span><span class=\"n\">cache</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span>\n<span class=\"n\">new</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">cache</span><span class=\"o\">=</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span>\n</code></pre></div>\n<p><strong>Passing flags to WebAssembly files</strong></p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">old</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">flag</span>\n<span class=\"n\">new</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">flag</span>\n</code></pre></div>\n<p>Note that the new CLI also accepts <code>wasmtime run foo.wasm --flag</code> but the old<br>\nCLI does not accept this.</p>\n<p><strong>Passing <code>--</code> to a wasm file</strong></p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">old</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"w\"> </span><span class=\"o\">--</span>\n<span class=\"n\">new</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"o\">--</span>\n</code></pre></div>\n<p>Note that the new CLI also accepts <code>wasmtime run foo.wasm --</code> but the old<br>\nCLI does not accept this.<br>\n</p>\n</blockquote>",
        "id": 398766337,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1698353889
    },
    {
        "content": "<p>alexcrichton edited <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7384\">issue #7384</a>:</p>\n<blockquote>\n<p>I'm opening this as a tracking issue to assist users in migrating from the old<br>\nWasmtime 13-and-prior CLI to the new Wasmtime 14-and-later CLI. Wasmtime 14.0.x<br>\nis going to receive a patch update which restores support for the old CLI to<br>\nsimultaneously support both the old and the new. The support, however, will<br>\nissue warnings that point to this issue. Specifically:</p>\n<ul>\n<li>\n<p>If a CLI invocation parses different in Wasmtime 13 (\"the old\") and Wasmtime<br>\n  14 (\"the new\") then a warning is issued. For example:</p>\n<p><code>\nwasmtime run foo.wasm --invoke bar\n</code></p>\n<p>Was parsed in the old parser as invoking the <code>bar</code> function of <code>foo.wasm</code>. In<br>\nthe new parser this parses as passing the <code>--invoke</code> flag to the <code>foo.wasm</code><br>\nCLI program. In this situation a warning will be issued. This example could be<br>\nfixed by changing the order of the arguments:</p>\n<p><code>\nwasmtime run --invoke bar foo.wasm\n</code></p>\n<p>which will no longer emit a warning.</p>\n</li>\n<li>\n<p>CLI invocations which fail to parse in the new parser but succeed in the old<br>\n  parser will continue to work but emit a warning. For example:</p>\n<p><code>\nwasmtime run --disable-cache foo.wasm\n</code></p>\n<p>no longer works because <code>--disable-cache</code> was renamed to <code>-C cache=n</code>. This<br>\nwill continue to work through but emit a warning.</p>\n</li>\n</ul>\n<p>This issue is being filed as I'm going to hardcode in the source code a print<br>\nof a warning which points here for users to find and discuss. My hope is to<br>\nincorporate feedback here into future iterations of the warning and/or the CLI.</p>\n<h1>Changes in Wasmtime 14</h1>\n<p>In Wasmtime 14 the <code>wasmtime</code> executable CLI syntax changed. #6925 has a<br>\nsummary of the changes as well as a detailed table to renamed flags, but a<br>\nsummary is restated here as well.</p>\n<h2>Parsing Changes</h2>\n<p>The first major change in Wasmtime 14 was a change to how arguments are parsed<br>\nto Wasmtime vs the WebAssembly program being run. Previously Wasmtime would<br>\nparse arguments anywhere before a <code>--</code> on the CLI as its own, and everything<br>\nelse was passed to the wasm program. This is a future compatibility hazard<br>\nthough because <code>--</code> is often omitted meaning that in the future it could be<br>\ndifficult for Wasmtime to add new CLI options as they would shadow any matching<br>\noption passed to wasm itself.</p>\n<p>Instead, starting in Wasmtime 14, all flags to Wasmtime must happen between the<br>\n<code>wasmtime</code> subcommand and the WebAssembly program being run. For example:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">flags</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">wasm</span><span class=\"o\">-</span><span class=\"n\">flags</span><span class=\"p\">]</span>\n</code></pre></div>\n<p>or</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">flags</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">wasm</span><span class=\"o\">-</span><span class=\"n\">flags</span><span class=\"p\">]</span>\n</code></pre></div>\n<h2>Syntax Changes</h2>\n<p>The second major change in Wasmtime 14 was a change to the syntax of how many<br>\narguments are passed. The Wasmtime CLI had previously organically grown where<br>\noptions were inconsistently named and surfaced. This ended up with a sprawling<br>\n<code>--help</code> page as well differences between option names. Options are now<br>\ncategorized into five broad categories:</p>\n<ul>\n<li><code>-O foo</code> - an optimization or performance-tuning related option</li>\n<li><code>-C foo</code> - a codegen option affecting the compilation process.</li>\n<li><code>-D foo</code> - a debug-related option</li>\n<li><code>-W foo</code> - a wasm-related option, for example changing wasm semantics</li>\n<li><code>-S foo</code> - a WASI-related option, configuring various proposals for example</li>\n</ul>\n<p>These single-letter flags additionally have <code>--longer</code> names as well. Nearly<br>\nall configuration and tuning options for Wasmtime are now housed behind one of<br>\nthese flags. Each flag can be explored with <code>wasmtime -O help</code> for example.</p>\n<h1>Examples of handling warnings</h1>\n<p>This section is intended to list a suite of old CLI invocations and their<br>\nequivalent in the new CLI. Where possible a new command is listed which parses<br>\nthe same both under the old CLI and the new CLI.</p>\n<p><strong>Moving Wasmtime options before the WebAssembly file</strong></p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"p\">[</span><span class=\"n\">old</span><span class=\"p\">]</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">invoke</span><span class=\"w\"> </span><span class=\"n\">bar</span>\n<span class=\"p\">[</span><span class=\"n\">new</span><span class=\"p\">]</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">invoke</span><span class=\"w\"> </span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span>\n</code></pre></div>\n<p><strong>Renaming Wasmtime options</strong></p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"p\">[</span><span class=\"n\">old</span><span class=\"p\">]</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">disable</span><span class=\"o\">-</span><span class=\"n\">cache</span>\n<span class=\"p\">[</span><span class=\"n\">new</span><span class=\"p\">]</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">cache</span><span class=\"o\">=</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span>\n</code></pre></div>\n<p><strong>Renaming Wasmtime options</strong></p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"p\">[</span><span class=\"n\">old</span><span class=\"p\">]</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">disable</span><span class=\"o\">-</span><span class=\"n\">cache</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span>\n<span class=\"p\">[</span><span class=\"n\">new</span><span class=\"p\">]</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">cache</span><span class=\"o\">=</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span>\n</code></pre></div>\n<p><strong>Passing flags to WebAssembly files</strong></p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"p\">[</span><span class=\"n\">old</span><span class=\"p\">]</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">flag</span>\n<span class=\"p\">[</span><span class=\"n\">new</span><span class=\"p\">]</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">flag</span>\n</code></pre></div>\n<p>Note that the new CLI also accepts <code>wasmtime run foo.wasm --flag</code> but the old CLI does not accept this. Additionally this will print a warning while the old CLI is still supported.</p>\n<p><strong>Passing <code>--</code> to a wasm file</strong></p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"p\">[</span><span class=\"n\">old</span><span class=\"p\">]</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"w\"> </span><span class=\"o\">--</span>\n<span class=\"p\">[</span><span class=\"n\">new</span><span class=\"p\">]</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"o\">--</span>\n</code></pre></div>\n<p>Note that the new CLI also accepts <code>wasmtime run foo.wasm --</code> but the old CLI does not accept this. Additionally this will print a warning while the old CLI is still supported.<br>\nCLI does not accept this.<br>\n</p>\n</blockquote>",
        "id": 398767111,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1698354180
    },
    {
        "content": "<p>alexcrichton edited <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7384\">issue #7384</a>:</p>\n<blockquote>\n<blockquote>\n<p><strong>Note</strong>: if you'd rather not read up on this change and deal with it later then set <code>WASMTIME_NEW_CLI=0</code> to force usage of the old CLI or <code>WASMTIME_NEW_CLI=1</code> to force usage of the new CLI. This environment variable will go away in the future and the old CLI will be removed. This won't happen at least until Wasmtime 16 and at this time no exact time to make this change has been determined.</p>\n</blockquote>\n<p>I'm opening this as a tracking issue to assist users in migrating from the old<br>\nWasmtime 13-and-prior CLI to the new Wasmtime 14-and-later CLI. Wasmtime 14.0.x<br>\nis going to receive a patch update which restores support for the old CLI to<br>\nsimultaneously support both the old and the new. The support, however, will<br>\nissue warnings that point to this issue. Specifically:</p>\n<ul>\n<li>\n<p>If a CLI invocation parses different in Wasmtime 13 (\"the old\") and Wasmtime<br>\n  14 (\"the new\") then a warning is issued. For example:</p>\n<p><code>\nwasmtime run foo.wasm --invoke bar\n</code></p>\n<p>Was parsed in the old parser as invoking the <code>bar</code> function of <code>foo.wasm</code>. In<br>\nthe new parser this parses as passing the <code>--invoke</code> flag to the <code>foo.wasm</code><br>\nCLI program. In this situation a warning will be issued. This example could be<br>\nfixed by changing the order of the arguments:</p>\n<p><code>\nwasmtime run --invoke bar foo.wasm\n</code></p>\n<p>which will no longer emit a warning.</p>\n</li>\n<li>\n<p>CLI invocations which fail to parse in the new parser but succeed in the old<br>\n  parser will continue to work but emit a warning. For example:</p>\n<p><code>\nwasmtime run --disable-cache foo.wasm\n</code></p>\n<p>no longer works because <code>--disable-cache</code> was renamed to <code>-C cache=n</code>. This<br>\nwill continue to work through but emit a warning.</p>\n</li>\n</ul>\n<p>This issue is being filed as I'm going to hardcode in the source code a print<br>\nof a warning which points here for users to find and discuss. My hope is to<br>\nincorporate feedback here into future iterations of the warning and/or the CLI.</p>\n<h1>Changes in Wasmtime 14</h1>\n<p>In Wasmtime 14 the <code>wasmtime</code> executable CLI syntax changed. #6925 has a<br>\nsummary of the changes as well as a detailed table to renamed flags, but a<br>\nsummary is restated here as well.</p>\n<h2>Parsing Changes</h2>\n<p>The first major change in Wasmtime 14 was a change to how arguments are parsed<br>\nto Wasmtime vs the WebAssembly program being run. Previously Wasmtime would<br>\nparse arguments anywhere before a <code>--</code> on the CLI as its own, and everything<br>\nelse was passed to the wasm program. This is a future compatibility hazard<br>\nthough because <code>--</code> is often omitted meaning that in the future it could be<br>\ndifficult for Wasmtime to add new CLI options as they would shadow any matching<br>\noption passed to wasm itself.</p>\n<p>Instead, starting in Wasmtime 14, all flags to Wasmtime must happen between the<br>\n<code>wasmtime</code> subcommand and the WebAssembly program being run. For example:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">flags</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">wasm</span><span class=\"o\">-</span><span class=\"n\">flags</span><span class=\"p\">]</span>\n</code></pre></div>\n<p>or</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">flags</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">wasm</span><span class=\"o\">-</span><span class=\"n\">flags</span><span class=\"p\">]</span>\n</code></pre></div>\n<h2>Syntax Changes</h2>\n<p>The second major change in Wasmtime 14 was a change to the syntax of how many<br>\narguments are passed. The Wasmtime CLI had previously organically grown where<br>\noptions were inconsistently named and surfaced. This ended up with a sprawling<br>\n<code>--help</code> page as well differences between option names. Options are now<br>\ncategorized into five broad categories:</p>\n<ul>\n<li><code>-O foo</code> - an optimization or performance-tuning related option</li>\n<li><code>-C foo</code> - a codegen option affecting the compilation process.</li>\n<li><code>-D foo</code> - a debug-related option</li>\n<li><code>-W foo</code> - a wasm-related option, for example changing wasm semantics</li>\n<li><code>-S foo</code> - a WASI-related option, configuring various proposals for example</li>\n</ul>\n<p>These single-letter flags additionally have <code>--longer</code> names as well. Nearly<br>\nall configuration and tuning options for Wasmtime are now housed behind one of<br>\nthese flags. Each flag can be explored with <code>wasmtime -O help</code> for example.</p>\n<h1>Examples of handling warnings</h1>\n<p>This section is intended to list a suite of old CLI invocations and their<br>\nequivalent in the new CLI. Where possible a new command is listed which parses<br>\nthe same both under the old CLI and the new CLI.</p>\n<p><strong>Moving Wasmtime options before the WebAssembly file</strong></p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"p\">[</span><span class=\"n\">old</span><span class=\"p\">]</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">invoke</span><span class=\"w\"> </span><span class=\"n\">bar</span>\n<span class=\"p\">[</span><span class=\"n\">new</span><span class=\"p\">]</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">invoke</span><span class=\"w\"> </span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span>\n</code></pre></div>\n<p><strong>Renaming Wasmtime options</strong></p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"p\">[</span><span class=\"n\">old</span><span class=\"p\">]</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">disable</span><span class=\"o\">-</span><span class=\"n\">cache</span>\n<span class=\"p\">[</span><span class=\"n\">new</span><span class=\"p\">]</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">cache</span><span class=\"o\">=</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span>\n</code></pre></div>\n<p><strong>Renaming Wasmtime options</strong></p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"p\">[</span><span class=\"n\">old</span><span class=\"p\">]</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">disable</span><span class=\"o\">-</span><span class=\"n\">cache</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span>\n<span class=\"p\">[</span><span class=\"n\">new</span><span class=\"p\">]</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">cache</span><span class=\"o\">=</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span>\n</code></pre></div>\n<p><strong>Passing flags to WebAssembly files</strong></p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"p\">[</span><span class=\"n\">old</span><span class=\"p\">]</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">flag</span>\n<span class=\"p\">[</span><span class=\"n\">new</span><span class=\"p\">]</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">flag</span>\n</code></pre></div>\n<p>Note that the new CLI also accepts <code>wasmtime run foo.wasm --flag</code> but the old CLI does not accept this. Additionally this will print a warning while the old CLI is still supported.</p>\n<p><strong>Passing <code>--</code> to a wasm file</strong></p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"p\">[</span><span class=\"n\">old</span><span class=\"p\">]</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"w\"> </span><span class=\"o\">--</span>\n<span class=\"p\">[</span><span class=\"n\">new</span><span class=\"p\">]</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"o\">--</span>\n</code></pre></div>\n<p>Note that the new CLI also accepts <code>wasmtime run foo.wasm --</code> but the old CLI does not accept this. Additionally this will print a warning while the old CLI is still supported.<br>\nCLI does not accept this.<br>\n</p>\n</blockquote>",
        "id": 398767371,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1698354277
    },
    {
        "content": "<p>alexcrichton edited <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7384\">issue #7384</a>:</p>\n<blockquote>\n<blockquote>\n<p><strong>Note</strong>: if you'd rather not read up on this change and deal with it later then set <code>WASMTIME_NEW_CLI=0</code> to force usage of the old CLI or <code>WASMTIME_NEW_CLI=1</code> to force usage of the new CLI. This environment variable will go away in the future and the old CLI will be removed. This won't happen at least until Wasmtime 16 and at this time no exact time to make this change has been determined.</p>\n</blockquote>\n<p>I'm opening this as a tracking issue to assist users in migrating from the old<br>\nWasmtime 13-and-prior CLI to the new Wasmtime 14-and-later CLI. Wasmtime 14.0.x<br>\nis going to receive a patch update which restores support for the old CLI to<br>\nsimultaneously support both the old and the new. The support, however, will<br>\nissue warnings that point to this issue. Specifically:</p>\n<ul>\n<li>\n<p>If a CLI invocation parses different in Wasmtime 13 (\"the old\") and Wasmtime<br>\n  14 (\"the new\") then a warning is issued. For example:</p>\n<p><code>\nwasmtime run foo.wasm --invoke bar\n</code></p>\n<p>Was parsed in the old parser as invoking the <code>bar</code> function of <code>foo.wasm</code>. In<br>\nthe new parser this parses as passing the <code>--invoke</code> flag to the <code>foo.wasm</code><br>\nCLI program. In this situation a warning will be issued. This example could be<br>\nfixed by changing the order of the arguments:</p>\n<p><code>\nwasmtime run --invoke bar foo.wasm\n</code></p>\n<p>which will no longer emit a warning.</p>\n</li>\n<li>\n<p>CLI invocations which fail to parse in the new parser but succeed in the old<br>\n  parser will continue to work but emit a warning. For example:</p>\n<p><code>\nwasmtime run --disable-cache foo.wasm\n</code></p>\n<p>no longer works because <code>--disable-cache</code> was renamed to <code>-C cache=n</code>. This<br>\nwill continue to work through but emit a warning.</p>\n</li>\n</ul>\n<p>This issue is being filed as I'm going to hardcode in the source code a print<br>\nof a warning which points here for users to find and discuss. My hope is to<br>\nincorporate feedback here into future iterations of the warning and/or the CLI.</p>\n<h1>Changes in Wasmtime 14</h1>\n<p>In Wasmtime 14 the <code>wasmtime</code> executable CLI syntax changed. #6925 has a<br>\nsummary of the changes as well as a detailed table to renamed flags, but a<br>\nsummary is restated here as well.</p>\n<h2>Parsing Changes</h2>\n<p>The first major change in Wasmtime 14 was a change to how arguments are parsed<br>\nto Wasmtime vs the WebAssembly program being run. Previously Wasmtime would<br>\nparse arguments anywhere before a <code>--</code> on the CLI as its own, and everything<br>\nelse was passed to the wasm program. This is a future compatibility hazard<br>\nthough because <code>--</code> is often omitted meaning that in the future it could be<br>\ndifficult for Wasmtime to add new CLI options as they would shadow any matching<br>\noption passed to wasm itself.</p>\n<p>Instead, starting in Wasmtime 14, all flags to Wasmtime must happen between the<br>\n<code>wasmtime</code> subcommand and the WebAssembly program being run. For example:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">flags</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">wasm</span><span class=\"o\">-</span><span class=\"n\">flags</span><span class=\"p\">]</span>\n</code></pre></div>\n<p>or</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">flags</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">wasm</span><span class=\"o\">-</span><span class=\"n\">flags</span><span class=\"p\">]</span>\n</code></pre></div>\n<h2>Syntax Changes</h2>\n<p>The second major change in Wasmtime 14 was a change to the syntax of how many<br>\narguments are passed. The Wasmtime CLI had previously organically grown where<br>\noptions were inconsistently named and surfaced. This ended up with a sprawling<br>\n<code>--help</code> page as well differences between option names. Options are now<br>\ncategorized into five broad categories:</p>\n<ul>\n<li><code>-O foo</code> - an optimization or performance-tuning related option</li>\n<li><code>-C foo</code> - a codegen option affecting the compilation process.</li>\n<li><code>-D foo</code> - a debug-related option</li>\n<li><code>-W foo</code> - a wasm-related option, for example changing wasm semantics</li>\n<li><code>-S foo</code> - a WASI-related option, configuring various proposals for example</li>\n</ul>\n<p>These single-letter flags additionally have <code>--longer</code> names as well. Nearly<br>\nall configuration and tuning options for Wasmtime are now housed behind one of<br>\nthese flags. Each flag can be explored with <code>wasmtime -O help</code> for example.</p>\n<h1>Examples of handling warnings</h1>\n<p>This section is intended to list a suite of old CLI invocations and their<br>\nequivalent in the new CLI. Where possible a new command is listed which parses<br>\nthe same both under the old CLI and the new CLI.</p>\n<p><strong>Moving Wasmtime options before the WebAssembly file</strong></p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"p\">[</span><span class=\"n\">old</span><span class=\"p\">]</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">invoke</span><span class=\"w\"> </span><span class=\"n\">bar</span>\n<span class=\"p\">[</span><span class=\"n\">new</span><span class=\"p\">]</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">invoke</span><span class=\"w\"> </span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span>\n<span class=\"p\">[</span><span class=\"n\">old</span><span class=\"p\">]</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">invoke</span><span class=\"w\"> </span><span class=\"n\">bar</span>\n<span class=\"p\">[</span><span class=\"n\">new</span><span class=\"p\">]</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">invoke</span><span class=\"w\"> </span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span>\n</code></pre></div>\n<p><strong>Renaming Wasmtime options</strong></p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"p\">[</span><span class=\"n\">old</span><span class=\"p\">]</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">disable</span><span class=\"o\">-</span><span class=\"n\">cache</span>\n<span class=\"p\">[</span><span class=\"n\">new</span><span class=\"p\">]</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">cache</span><span class=\"o\">=</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span>\n</code></pre></div>\n<p><strong>Renaming Wasmtime options</strong></p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"p\">[</span><span class=\"n\">old</span><span class=\"p\">]</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">disable</span><span class=\"o\">-</span><span class=\"n\">cache</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span>\n<span class=\"p\">[</span><span class=\"n\">new</span><span class=\"p\">]</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">cache</span><span class=\"o\">=</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span>\n<span class=\"p\">[</span><span class=\"n\">old</span><span class=\"p\">]</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">disable</span><span class=\"o\">-</span><span class=\"n\">cache</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span>\n<span class=\"p\">[</span><span class=\"n\">new</span><span class=\"p\">]</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">cache</span><span class=\"o\">=</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span>\n</code></pre></div>\n<p><strong>Passing flags to WebAssembly files</strong></p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"p\">[</span><span class=\"n\">old</span><span class=\"p\">]</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">flag</span>\n<span class=\"p\">[</span><span class=\"n\">new</span><span class=\"p\">]</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">flag</span>\n</code></pre></div>\n<p>Note that the new CLI also accepts <code>wasmtime run foo.wasm --flag</code> but the old CLI does not accept this. Additionally this will print a warning while the old CLI is still supported.</p>\n<p><strong>Passing <code>--</code> to a wasm file</strong></p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"p\">[</span><span class=\"n\">old</span><span class=\"p\">]</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"w\"> </span><span class=\"o\">--</span>\n<span class=\"p\">[</span><span class=\"n\">new</span><span class=\"p\">]</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"o\">--</span>\n</code></pre></div>\n<p>Note that the new CLI also accepts <code>wasmtime run foo.wasm --</code> but the old CLI does not accept this. Additionally this will print a warning while the old CLI is still supported.<br>\nCLI does not accept this.<br>\n</p>\n</blockquote>",
        "id": 398768923,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1698355007
    },
    {
        "content": "<p>alexcrichton edited <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7384\">issue #7384</a>:</p>\n<blockquote>\n<blockquote>\n<p><strong>Note</strong>: if you'd rather not read up on this change and deal with it later then set <code>WASMTIME_NEW_CLI=0</code> to force usage of the old CLI or <code>WASMTIME_NEW_CLI=1</code> to force usage of the new CLI. This environment variable will go away in the future and the old CLI will be removed. This won't happen at least until Wasmtime 16 and at this time no exact time to make this change has been determined.</p>\n</blockquote>\n<p>I'm opening this as a tracking issue to assist users in migrating from the old<br>\nWasmtime 13-and-prior CLI to the new Wasmtime 14-and-later CLI. Wasmtime 14.0.x<br>\nis going to receive a patch update which restores support for the old CLI to<br>\nsimultaneously support both the old and the new. The support, however, will<br>\nissue warnings that point to this issue. Specifically:</p>\n<ul>\n<li>\n<p>If a CLI invocation parses different in Wasmtime 13 (\"the old\") and Wasmtime<br>\n  14 (\"the new\") then a warning is issued. For example:</p>\n<p><code>\nwasmtime run foo.wasm --invoke bar\n</code></p>\n<p>Was parsed in the old parser as invoking the <code>bar</code> function of <code>foo.wasm</code>. In<br>\nthe new parser this parses as passing the <code>--invoke</code> flag to the <code>foo.wasm</code><br>\nCLI program. In this situation a warning will be issued. This example could be<br>\nfixed by changing the order of the arguments:</p>\n<p><code>\nwasmtime run --invoke bar foo.wasm\n</code></p>\n<p>which will no longer emit a warning.</p>\n</li>\n<li>\n<p>CLI invocations which fail to parse in the new parser but succeed in the old<br>\n  parser will continue to work but emit a warning. For example:</p>\n<p><code>\nwasmtime run --disable-cache foo.wasm\n</code></p>\n<p>no longer works because <code>--disable-cache</code> was renamed to <code>-C cache=n</code>. This<br>\nwill continue to work through but emit a warning.</p>\n</li>\n</ul>\n<p>This issue is being filed as I'm going to hardcode in the source code a print<br>\nof a warning which points here for users to find and discuss. My hope is to<br>\nincorporate feedback here into future iterations of the warning and/or the CLI.</p>\n<h1>Changes in Wasmtime 14</h1>\n<p>In Wasmtime 14 the <code>wasmtime</code> executable CLI syntax changed. #6925 has a<br>\nsummary of the changes as well as a detailed table to renamed flags, but a<br>\nsummary is restated here as well.</p>\n<h2>Parsing Changes</h2>\n<p>The first major change in Wasmtime 14 was a change to how arguments are parsed<br>\nto Wasmtime vs the WebAssembly program being run. Previously Wasmtime would<br>\nparse arguments anywhere before a <code>--</code> on the CLI as its own, and everything<br>\nelse was passed to the wasm program. This is a future compatibility hazard<br>\nthough because <code>--</code> is often omitted meaning that in the future it could be<br>\ndifficult for Wasmtime to add new CLI options as they would shadow any matching<br>\noption passed to wasm itself.</p>\n<p>Instead, starting in Wasmtime 14, all flags to Wasmtime must happen between the<br>\n<code>wasmtime</code> subcommand and the WebAssembly program being run. For example:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">flags</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">wasm</span><span class=\"o\">-</span><span class=\"n\">flags</span><span class=\"p\">]</span>\n</code></pre></div>\n<p>or</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">flags</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">wasm</span><span class=\"o\">-</span><span class=\"n\">flags</span><span class=\"p\">]</span>\n</code></pre></div>\n<h2>Syntax Changes</h2>\n<p>The second major change in Wasmtime 14 was a change to the syntax of how many<br>\narguments are passed. The Wasmtime CLI had previously organically grown where<br>\noptions were inconsistently named and surfaced. This ended up with a sprawling<br>\n<code>--help</code> page as well differences between option names. Options are now<br>\ncategorized into five broad categories:</p>\n<ul>\n<li><code>-O foo</code> - an optimization or performance-tuning related option</li>\n<li><code>-C foo</code> - a codegen option affecting the compilation process.</li>\n<li><code>-D foo</code> - a debug-related option</li>\n<li><code>-W foo</code> - a wasm-related option, for example changing wasm semantics</li>\n<li><code>-S foo</code> - a WASI-related option, configuring various proposals for example</li>\n</ul>\n<p>These single-letter flags additionally have <code>--longer</code> names as well. Nearly<br>\nall configuration and tuning options for Wasmtime are now housed behind one of<br>\nthese flags. Each flag can be explored with <code>wasmtime -O help</code> for example.</p>\n<h1>Examples of handling warnings</h1>\n<p>This section is intended to list a suite of old CLI invocations and their<br>\nequivalent in the new CLI. Where possible a new command is listed which parses<br>\nthe same both under the old CLI and the new CLI.</p>\n<p><strong>Moving Wasmtime options before the WebAssembly file</strong></p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"p\">[</span><span class=\"n\">old</span><span class=\"p\">]</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">invoke</span><span class=\"w\"> </span><span class=\"n\">bar</span>\n<span class=\"p\">[</span><span class=\"n\">new</span><span class=\"p\">]</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">invoke</span><span class=\"w\"> </span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span>\n<span class=\"p\">[</span><span class=\"n\">old</span><span class=\"p\">]</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">invoke</span><span class=\"w\"> </span><span class=\"n\">bar</span>\n<span class=\"p\">[</span><span class=\"n\">new</span><span class=\"p\">]</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">invoke</span><span class=\"w\"> </span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span>\n</code></pre></div>\n<p><strong>Renaming Wasmtime options</strong></p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"p\">[</span><span class=\"n\">old</span><span class=\"p\">]</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">disable</span><span class=\"o\">-</span><span class=\"n\">cache</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span>\n<span class=\"p\">[</span><span class=\"n\">new</span><span class=\"p\">]</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">cache</span><span class=\"o\">=</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span>\n<span class=\"p\">[</span><span class=\"n\">old</span><span class=\"p\">]</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">disable</span><span class=\"o\">-</span><span class=\"n\">cache</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span>\n<span class=\"p\">[</span><span class=\"n\">new</span><span class=\"p\">]</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">cache</span><span class=\"o\">=</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span>\n</code></pre></div>\n<p><strong>Passing flags to WebAssembly files</strong></p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"p\">[</span><span class=\"n\">old</span><span class=\"p\">]</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">flag</span>\n<span class=\"p\">[</span><span class=\"n\">new</span><span class=\"p\">]</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">flag</span>\n</code></pre></div>\n<p>Note that the new CLI also accepts <code>wasmtime run foo.wasm --flag</code> but the old CLI does not accept this. Additionally this will print a warning while the old CLI is still supported.</p>\n<p><strong>Passing <code>--</code> to a wasm file</strong></p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"p\">[</span><span class=\"n\">old</span><span class=\"p\">]</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"w\"> </span><span class=\"o\">--</span>\n<span class=\"p\">[</span><span class=\"n\">new</span><span class=\"p\">]</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"o\">--</span>\n</code></pre></div>\n<p>Note that the new CLI also accepts <code>wasmtime run foo.wasm --</code> but the old CLI does not accept this. Additionally this will print a warning while the old CLI is still supported.<br>\nCLI does not accept this.<br>\n</p>\n</blockquote>",
        "id": 398768966,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1698355032
    },
    {
        "content": "<p>alexcrichton edited <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7384\">issue #7384</a>:</p>\n<blockquote>\n<blockquote>\n<p><strong>Note</strong>: if you'd rather not read up on this change and deal with it later then set <code>WASMTIME_NEW_CLI=0</code> to force usage of the old CLI or <code>WASMTIME_NEW_CLI=1</code> to force usage of the new CLI. This environment variable will go away in the future and the old CLI will be removed. This won't happen at least until Wasmtime 16 and at this time no exact time to make this change has been determined.</p>\n</blockquote>\n<p>I'm opening this as a tracking issue to assist users in migrating from the old<br>\nWasmtime 13-and-prior CLI to the new Wasmtime 14-and-later CLI. Wasmtime 14.0.x<br>\nis going to receive a patch update which restores support for the old CLI to<br>\nsimultaneously support both the old and the new. The support, however, will<br>\nissue warnings that point to this issue. Specifically:</p>\n<ul>\n<li>\n<p>If a CLI invocation parses different in Wasmtime 13 (\"the old\") and Wasmtime<br>\n  14 (\"the new\") then a warning is issued. For example:</p>\n<p><code>\nwasmtime run foo.wasm --invoke bar\n</code></p>\n<p>Was parsed in the old parser as invoking the <code>bar</code> function of <code>foo.wasm</code>. In<br>\nthe new parser this parses as passing the <code>--invoke</code> flag to the <code>foo.wasm</code><br>\nCLI program. In this situation a warning will be issued. This example could be<br>\nfixed by changing the order of the arguments:</p>\n<p><code>\nwasmtime run --invoke bar foo.wasm\n</code></p>\n<p>which will no longer emit a warning.</p>\n</li>\n<li>\n<p>CLI invocations which fail to parse in the new parser but succeed in the old<br>\n  parser will continue to work but emit a warning. For example:</p>\n<p><code>\nwasmtime run --disable-cache foo.wasm\n</code></p>\n<p>no longer works because <code>--disable-cache</code> was renamed to <code>-C cache=n</code>. This<br>\nwill continue to work through but emit a warning.</p>\n</li>\n</ul>\n<p>This issue is being filed as I'm going to hardcode in the source code a print<br>\nof a warning which points here for users to find and discuss. My hope is to<br>\nincorporate feedback here into future iterations of the warning and/or the CLI.</p>\n<h1>Changes in Wasmtime 14</h1>\n<p>In Wasmtime 14 the <code>wasmtime</code> executable CLI syntax changed. #6925 has a<br>\nsummary of the changes as well as a detailed table to renamed flags, but a<br>\nsummary is restated here as well.</p>\n<h2>Parsing Changes</h2>\n<p>The first major change in Wasmtime 14 was a change to how arguments are parsed<br>\nto Wasmtime vs the WebAssembly program being run. Previously Wasmtime would<br>\nparse arguments anywhere before a <code>--</code> on the CLI as its own, and everything<br>\nelse was passed to the wasm program. This is a future compatibility hazard<br>\nthough because <code>--</code> is often omitted meaning that in the future it could be<br>\ndifficult for Wasmtime to add new CLI options as they would shadow any matching<br>\noption passed to wasm itself.</p>\n<p>Instead, starting in Wasmtime 14, all flags to Wasmtime must happen between the<br>\n<code>wasmtime</code> subcommand and the WebAssembly program being run. For example:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">flags</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">wasm</span><span class=\"o\">-</span><span class=\"n\">flags</span><span class=\"p\">]</span>\n</code></pre></div>\n<p>or</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">flags</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">wasm</span><span class=\"o\">-</span><span class=\"n\">flags</span><span class=\"p\">]</span>\n</code></pre></div>\n<h2>Syntax Changes</h2>\n<p>The second major change in Wasmtime 14 was a change to the syntax of how many<br>\narguments are passed. The Wasmtime CLI had previously organically grown where<br>\noptions were inconsistently named and surfaced. This ended up with a sprawling<br>\n<code>--help</code> page as well differences between option names. Options are now<br>\ncategorized into five broad categories:</p>\n<ul>\n<li><code>-O foo</code> - an optimization or performance-tuning related option</li>\n<li><code>-C foo</code> - a codegen option affecting the compilation process.</li>\n<li><code>-D foo</code> - a debug-related option</li>\n<li><code>-W foo</code> - a wasm-related option, for example changing wasm semantics</li>\n<li><code>-S foo</code> - a WASI-related option, configuring various proposals for example</li>\n</ul>\n<p>These single-letter flags additionally have <code>--longer</code> names as well. Nearly<br>\nall configuration and tuning options for Wasmtime are now housed behind one of<br>\nthese flags. Each flag can be explored with <code>wasmtime -O help</code> for example.</p>\n<h1>Examples of handling warnings</h1>\n<p>This section is intended to list a suite of old CLI invocations and their<br>\nequivalent in the new CLI. Where possible a new command is listed which parses<br>\nthe same both under the old CLI and the new CLI.</p>\n<p><strong>Moving Wasmtime options before the WebAssembly file</strong></p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"p\">[</span><span class=\"n\">old</span><span class=\"p\">]</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">invoke</span><span class=\"w\"> </span><span class=\"n\">bar</span>\n<span class=\"p\">[</span><span class=\"n\">new</span><span class=\"p\">]</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">invoke</span><span class=\"w\"> </span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span>\n<span class=\"p\">[</span><span class=\"n\">old</span><span class=\"p\">]</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">invoke</span><span class=\"w\"> </span><span class=\"n\">bar</span>\n<span class=\"p\">[</span><span class=\"n\">new</span><span class=\"p\">]</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">invoke</span><span class=\"w\"> </span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span>\n</code></pre></div>\n<p><strong>Renaming Wasmtime options</strong></p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"p\">[</span><span class=\"n\">old</span><span class=\"p\">]</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">disable</span><span class=\"o\">-</span><span class=\"n\">cache</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span>\n<span class=\"p\">[</span><span class=\"n\">new</span><span class=\"p\">]</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">cache</span><span class=\"o\">=</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span>\n<span class=\"p\">[</span><span class=\"n\">old</span><span class=\"p\">]</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">disable</span><span class=\"o\">-</span><span class=\"n\">cache</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span>\n<span class=\"p\">[</span><span class=\"n\">new</span><span class=\"p\">]</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">cache</span><span class=\"o\">=</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span>\n</code></pre></div>\n<p><strong>Passing flags to WebAssembly files</strong></p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"p\">[</span><span class=\"n\">old</span><span class=\"p\">]</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">flag</span>\n<span class=\"p\">[</span><span class=\"n\">new</span><span class=\"p\">]</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">flag</span>\n</code></pre></div>\n<p>Note that the new CLI also accepts <code>wasmtime run foo.wasm --flag</code> but the old CLI does not accept this. Additionally this will print a warning while the old CLI is still supported.</p>\n<p><strong>Passing <code>--</code> to a wasm file</strong></p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"p\">[</span><span class=\"n\">old</span><span class=\"p\">]</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"w\"> </span><span class=\"o\">--</span>\n<span class=\"p\">[</span><span class=\"n\">new</span><span class=\"p\">]</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"o\">--</span>\n</code></pre></div>\n<p>Note that the new CLI also accepts <code>wasmtime run foo.wasm --</code> but the old CLI does not accept this. Additionally this will print a warning while the old CLI is still supported.<br>\n</p>\n</blockquote>",
        "id": 398769093,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1698355088
    },
    {
        "content": "<p>eminence <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7384#issuecomment-1785816734\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7384\">issue #7384</a>:</p>\n<blockquote>\n<p>Some things to add to the TODO list, when you have a chance:</p>\n<ul>\n<li>Update the usage examples in the output of <code>wasmtime --help</code></li>\n<li>Update the online docs (for example <a href=\"https://docs.wasmtime.dev/lang-bash.html\">https://docs.wasmtime.dev/lang-bash.html</a>)</li>\n</ul>\n</blockquote>",
        "id": 399356618,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1698690686
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7384#issuecomment-1785827805\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7384\">issue #7384</a>:</p>\n<blockquote>\n<p>Thanks for the heads up! I posted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/7408\">https://github.com/bytecodealliance/wasmtime/pull/7408</a> to cover those. Apologies for missing the <code>--help</code>, I thought I went through that but I ended up missing it...</p>\n</blockquote>",
        "id": 399357758,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1698691132
    },
    {
        "content": "<p>alexcrichton closed <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7384\">issue #7384</a>:</p>\n<blockquote>\n<blockquote>\n<p><strong>Note</strong>: if you'd rather not read up on this change and deal with it later then set <code>WASMTIME_NEW_CLI=0</code> to force usage of the old CLI or <code>WASMTIME_NEW_CLI=1</code> to force usage of the new CLI. This environment variable will go away in the future and the old CLI will be removed. This won't happen at least until Wasmtime 16 and at this time no exact time to make this change has been determined.</p>\n</blockquote>\n<p>I'm opening this as a tracking issue to assist users in migrating from the old<br>\nWasmtime 13-and-prior CLI to the new Wasmtime 14-and-later CLI. Wasmtime 14.0.x<br>\nis going to receive a patch update which restores support for the old CLI to<br>\nsimultaneously support both the old and the new. The support, however, will<br>\nissue warnings that point to this issue. Specifically:</p>\n<ul>\n<li>\n<p>If a CLI invocation parses different in Wasmtime 13 (\"the old\") and Wasmtime<br>\n  14 (\"the new\") then a warning is issued. For example:</p>\n<p><code>\nwasmtime run foo.wasm --invoke bar\n</code></p>\n<p>Was parsed in the old parser as invoking the <code>bar</code> function of <code>foo.wasm</code>. In<br>\nthe new parser this parses as passing the <code>--invoke</code> flag to the <code>foo.wasm</code><br>\nCLI program. In this situation a warning will be issued. This example could be<br>\nfixed by changing the order of the arguments:</p>\n<p><code>\nwasmtime run --invoke bar foo.wasm\n</code></p>\n<p>which will no longer emit a warning.</p>\n</li>\n<li>\n<p>CLI invocations which fail to parse in the new parser but succeed in the old<br>\n  parser will continue to work but emit a warning. For example:</p>\n<p><code>\nwasmtime run --disable-cache foo.wasm\n</code></p>\n<p>no longer works because <code>--disable-cache</code> was renamed to <code>-C cache=n</code>. This<br>\nwill continue to work through but emit a warning.</p>\n</li>\n</ul>\n<p>This issue is being filed as I'm going to hardcode in the source code a print<br>\nof a warning which points here for users to find and discuss. My hope is to<br>\nincorporate feedback here into future iterations of the warning and/or the CLI.</p>\n<h1>Changes in Wasmtime 14</h1>\n<p>In Wasmtime 14 the <code>wasmtime</code> executable CLI syntax changed. #6925 has a<br>\nsummary of the changes as well as a detailed table to renamed flags, but a<br>\nsummary is restated here as well.</p>\n<h2>Parsing Changes</h2>\n<p>The first major change in Wasmtime 14 was a change to how arguments are parsed<br>\nto Wasmtime vs the WebAssembly program being run. Previously Wasmtime would<br>\nparse arguments anywhere before a <code>--</code> on the CLI as its own, and everything<br>\nelse was passed to the wasm program. This is a future compatibility hazard<br>\nthough because <code>--</code> is often omitted meaning that in the future it could be<br>\ndifficult for Wasmtime to add new CLI options as they would shadow any matching<br>\noption passed to wasm itself.</p>\n<p>Instead, starting in Wasmtime 14, all flags to Wasmtime must happen between the<br>\n<code>wasmtime</code> subcommand and the WebAssembly program being run. For example:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">flags</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">wasm</span><span class=\"o\">-</span><span class=\"n\">flags</span><span class=\"p\">]</span>\n</code></pre></div>\n<p>or</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">flags</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">wasm</span><span class=\"o\">-</span><span class=\"n\">flags</span><span class=\"p\">]</span>\n</code></pre></div>\n<h2>Syntax Changes</h2>\n<p>The second major change in Wasmtime 14 was a change to the syntax of how many<br>\narguments are passed. The Wasmtime CLI had previously organically grown where<br>\noptions were inconsistently named and surfaced. This ended up with a sprawling<br>\n<code>--help</code> page as well differences between option names. Options are now<br>\ncategorized into five broad categories:</p>\n<ul>\n<li><code>-O foo</code> - an optimization or performance-tuning related option</li>\n<li><code>-C foo</code> - a codegen option affecting the compilation process.</li>\n<li><code>-D foo</code> - a debug-related option</li>\n<li><code>-W foo</code> - a wasm-related option, for example changing wasm semantics</li>\n<li><code>-S foo</code> - a WASI-related option, configuring various proposals for example</li>\n</ul>\n<p>These single-letter flags additionally have <code>--longer</code> names as well. Nearly<br>\nall configuration and tuning options for Wasmtime are now housed behind one of<br>\nthese flags. Each flag can be explored with <code>wasmtime -O help</code> for example.</p>\n<h1>Examples of handling warnings</h1>\n<p>This section is intended to list a suite of old CLI invocations and their<br>\nequivalent in the new CLI. Where possible a new command is listed which parses<br>\nthe same both under the old CLI and the new CLI.</p>\n<p><strong>Moving Wasmtime options before the WebAssembly file</strong></p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"p\">[</span><span class=\"n\">old</span><span class=\"p\">]</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">invoke</span><span class=\"w\"> </span><span class=\"n\">bar</span>\n<span class=\"p\">[</span><span class=\"n\">new</span><span class=\"p\">]</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">invoke</span><span class=\"w\"> </span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span>\n<span class=\"p\">[</span><span class=\"n\">old</span><span class=\"p\">]</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">invoke</span><span class=\"w\"> </span><span class=\"n\">bar</span>\n<span class=\"p\">[</span><span class=\"n\">new</span><span class=\"p\">]</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">invoke</span><span class=\"w\"> </span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span>\n</code></pre></div>\n<p><strong>Renaming Wasmtime options</strong></p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"p\">[</span><span class=\"n\">old</span><span class=\"p\">]</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">disable</span><span class=\"o\">-</span><span class=\"n\">cache</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span>\n<span class=\"p\">[</span><span class=\"n\">new</span><span class=\"p\">]</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">cache</span><span class=\"o\">=</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span>\n<span class=\"p\">[</span><span class=\"n\">old</span><span class=\"p\">]</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">disable</span><span class=\"o\">-</span><span class=\"n\">cache</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span>\n<span class=\"p\">[</span><span class=\"n\">new</span><span class=\"p\">]</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">cache</span><span class=\"o\">=</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span>\n</code></pre></div>\n<p><strong>Passing flags to WebAssembly files</strong></p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"p\">[</span><span class=\"n\">old</span><span class=\"p\">]</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">flag</span>\n<span class=\"p\">[</span><span class=\"n\">new</span><span class=\"p\">]</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">flag</span>\n</code></pre></div>\n<p>Note that the new CLI also accepts <code>wasmtime run foo.wasm --flag</code> but the old CLI does not accept this. Additionally this will print a warning while the old CLI is still supported.</p>\n<p><strong>Passing <code>--</code> to a wasm file</strong></p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"p\">[</span><span class=\"n\">old</span><span class=\"p\">]</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"w\"> </span><span class=\"o\">--</span>\n<span class=\"p\">[</span><span class=\"n\">new</span><span class=\"p\">]</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"o\">--</span>\n</code></pre></div>\n<p>Note that the new CLI also accepts <code>wasmtime run foo.wasm --</code> but the old CLI does not accept this. Additionally this will print a warning while the old CLI is still supported.<br>\n</p>\n</blockquote>",
        "id": 446199671,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1719016248
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7384#issuecomment-2183609117\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7384\">issue #7384</a>:</p>\n<blockquote>\n<p>The old CLI was removed in <a href=\"https://github.com/bytecodealliance/wasmtime/pull/8597\">https://github.com/bytecodealliance/wasmtime/pull/8597</a> and Wasmtime 22 no longer supports the old CLI</p>\n</blockquote>",
        "id": 446199672,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1719016248
    }
]