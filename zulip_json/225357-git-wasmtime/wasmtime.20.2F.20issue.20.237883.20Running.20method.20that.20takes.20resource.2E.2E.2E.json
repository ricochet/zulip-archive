[
    {
        "content": "<p>Lifeblossom opened <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7883\">issue #7883</a>:</p>\n<blockquote>\n<h3>Test Case</h3>\n<p><a href=\"https://github.com/Lifeblossom/wasmtime-resource-paremeter-bug-report\">https://github.com/Lifeblossom/wasmtime-resource-paremeter-bug-report</a></p>\n<p>Wit file:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">component</span>:<span class=\"nc\">bug</span><span class=\"o\">-</span><span class=\"n\">report</span><span class=\"p\">;</span>\n\n<span class=\"n\">world</span><span class=\"w\"> </span><span class=\"n\">example</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"n\">resource2</span><span class=\"o\">-</span><span class=\"n\">interface</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"n\">resource1</span><span class=\"o\">-</span><span class=\"n\">interface</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n\n<span class=\"n\">interface</span><span class=\"w\"> </span><span class=\"n\">resource1</span><span class=\"o\">-</span><span class=\"n\">interface</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"n\">create</span>: <span class=\"nc\">func</span><span class=\"p\">()</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">resource1</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"n\">resource</span><span class=\"w\"> </span><span class=\"n\">resource1</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n\n<span class=\"n\">interface</span><span class=\"w\"> </span><span class=\"n\">resource2</span><span class=\"o\">-</span><span class=\"n\">interface</span><span class=\"w\"> </span><span class=\"p\">{</span>\n\n<span class=\"w\">    </span><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">resource1</span><span class=\"o\">-</span><span class=\"n\">interface</span><span class=\"p\">.{</span><span class=\"n\">resource1</span><span class=\"p\">};</span>\n<span class=\"w\">    </span><span class=\"n\">create</span><span class=\"o\">-</span><span class=\"n\">resource2</span>: <span class=\"nc\">func</span><span class=\"p\">(</span><span class=\"n\">resource1</span>: <span class=\"nc\">resource1</span><span class=\"p\">)</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">resource2</span><span class=\"p\">;</span>\n\n<span class=\"w\">    </span><span class=\"kr\">do</span><span class=\"o\">-</span><span class=\"n\">stuff</span>: <span class=\"nc\">func</span><span class=\"p\">(</span><span class=\"n\">resource1</span>: <span class=\"nc\">resource1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">resource2</span>: <span class=\"nc\">resource2</span><span class=\"p\">)</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">resource2</span><span class=\"p\">;</span>\n\n<span class=\"w\">    </span><span class=\"n\">resource</span><span class=\"w\"> </span><span class=\"n\">resource2</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<h3>Steps to Reproduce</h3>\n<ul>\n<li>Clone repository</li>\n<li>Run cargo component build</li>\n<li>Run cargo test --test test</li>\n</ul>\n<p>Test that compares returned resource instances will run</p>\n<h3>Expected Results</h3>\n<p>Test passes</p>\n<h3>Actual Results</h3>\n<p>Test failes on resource2 comparison - that means that <code>create-resource2</code> returned the same value two times.</p>\n<h3>Versions and Environment</h3>\n<p>Wasmtime version or commit: 17.0.0</p>\n<p>Operating system: Windows 11</p>\n<p>Architecture: amd64</p>\n<h3>Extra Info</h3>\n<p>Test also includes method that uses both resource1 and resource2. You can comment out <code>ensure!(res2_1 != res2_2);</code> which causes this method to run. Invocation results in following error:</p>\n<p><div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">Error</span>: <span class=\"nc\">unknown</span><span class=\"w\"> </span><span class=\"n\">handle</span><span class=\"w\"> </span><span class=\"n\">index</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n</code></pre></div><br>\n</p>\n</blockquote>",
        "id": 420164954,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1707269348
    },
    {
        "content": "<p>Lifeblossom edited <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7883\">issue #7883</a>:</p>\n<blockquote>\n<h3>Test Case</h3>\n<p><a href=\"https://github.com/Lifeblossom/wasmtime-resource-paremeter-bug-report\">https://github.com/Lifeblossom/wasmtime-resource-paremeter-bug-report</a></p>\n<p>Wit file:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">component</span>:<span class=\"nc\">bug</span><span class=\"o\">-</span><span class=\"n\">report</span><span class=\"p\">;</span>\n\n<span class=\"n\">world</span><span class=\"w\"> </span><span class=\"n\">example</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"n\">resource2</span><span class=\"o\">-</span><span class=\"n\">interface</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"n\">resource1</span><span class=\"o\">-</span><span class=\"n\">interface</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n\n<span class=\"n\">interface</span><span class=\"w\"> </span><span class=\"n\">resource1</span><span class=\"o\">-</span><span class=\"n\">interface</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"n\">create</span>: <span class=\"nc\">func</span><span class=\"p\">()</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">resource1</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"n\">resource</span><span class=\"w\"> </span><span class=\"n\">resource1</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n\n<span class=\"n\">interface</span><span class=\"w\"> </span><span class=\"n\">resource2</span><span class=\"o\">-</span><span class=\"n\">interface</span><span class=\"w\"> </span><span class=\"p\">{</span>\n\n<span class=\"w\">    </span><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">resource1</span><span class=\"o\">-</span><span class=\"n\">interface</span><span class=\"p\">.{</span><span class=\"n\">resource1</span><span class=\"p\">};</span>\n<span class=\"w\">    </span><span class=\"n\">create</span><span class=\"o\">-</span><span class=\"n\">resource2</span>: <span class=\"nc\">func</span><span class=\"p\">(</span><span class=\"n\">resource1</span>: <span class=\"nc\">resource1</span><span class=\"p\">)</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">resource2</span><span class=\"p\">;</span>\n\n<span class=\"w\">    </span><span class=\"kr\">do</span><span class=\"o\">-</span><span class=\"n\">stuff</span>: <span class=\"nc\">func</span><span class=\"p\">(</span><span class=\"n\">resource1</span>: <span class=\"nc\">resource1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">resource2</span>: <span class=\"nc\">resource2</span><span class=\"p\">)</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">resource2</span><span class=\"p\">;</span>\n\n<span class=\"w\">    </span><span class=\"n\">resource</span><span class=\"w\"> </span><span class=\"n\">resource2</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<h3>Steps to Reproduce</h3>\n<ul>\n<li>Clone repository</li>\n<li>Run cargo component build</li>\n<li>Run cargo test --test test</li>\n</ul>\n<p>Test that compares returned resource instances will run</p>\n<h3>Expected Results</h3>\n<p>Test passes</p>\n<h3>Actual Results</h3>\n<p>Test failes on resource2 comparison - that means that <code>create-resource2</code> returned the same value two times.</p>\n<h3>Versions and Environment</h3>\n<p>Wasmtime version or commit: 17.0.0</p>\n<p>Operating system: Windows 11</p>\n<p>Architecture: amd64</p>\n<h3>Extra Info</h3>\n<p>Test also includes method that uses both resource1 and resource2. You can comment out <code>ensure!(res2_1 != res2_2);</code> which causes this method to run. Invocation results in following error:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">Error</span>: <span class=\"nc\">unknown</span><span class=\"w\"> </span><span class=\"n\">handle</span><span class=\"w\"> </span><span class=\"n\">index</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n</code></pre></div>\n<p>```[tasklist]</p>\n<h3>Tasks</h3>\n<p><div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"o\">~~~</span>\n</code></pre></div><br>\n</p>\n</blockquote>",
        "id": 420164957,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1707269352
    },
    {
        "content": "<p>Lifeblossom edited <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7883\">issue #7883</a>:</p>\n<blockquote>\n<h3>Test Case</h3>\n<p><a href=\"https://github.com/Lifeblossom/wasmtime-resource-paremeter-bug-report\">https://github.com/Lifeblossom/wasmtime-resource-paremeter-bug-report</a></p>\n<p>Wit file:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">component</span>:<span class=\"nc\">bug</span><span class=\"o\">-</span><span class=\"n\">report</span><span class=\"p\">;</span>\n\n<span class=\"n\">world</span><span class=\"w\"> </span><span class=\"n\">example</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"n\">resource2</span><span class=\"o\">-</span><span class=\"n\">interface</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"n\">resource1</span><span class=\"o\">-</span><span class=\"n\">interface</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n\n<span class=\"n\">interface</span><span class=\"w\"> </span><span class=\"n\">resource1</span><span class=\"o\">-</span><span class=\"n\">interface</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"n\">create</span>: <span class=\"nc\">func</span><span class=\"p\">()</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">resource1</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"n\">resource</span><span class=\"w\"> </span><span class=\"n\">resource1</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n\n<span class=\"n\">interface</span><span class=\"w\"> </span><span class=\"n\">resource2</span><span class=\"o\">-</span><span class=\"n\">interface</span><span class=\"w\"> </span><span class=\"p\">{</span>\n\n<span class=\"w\">    </span><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">resource1</span><span class=\"o\">-</span><span class=\"n\">interface</span><span class=\"p\">.{</span><span class=\"n\">resource1</span><span class=\"p\">};</span>\n<span class=\"w\">    </span><span class=\"n\">create</span><span class=\"o\">-</span><span class=\"n\">resource2</span>: <span class=\"nc\">func</span><span class=\"p\">(</span><span class=\"n\">resource1</span>: <span class=\"nc\">resource1</span><span class=\"p\">)</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">resource2</span><span class=\"p\">;</span>\n\n<span class=\"w\">    </span><span class=\"kr\">do</span><span class=\"o\">-</span><span class=\"n\">stuff</span>: <span class=\"nc\">func</span><span class=\"p\">(</span><span class=\"n\">resource1</span>: <span class=\"nc\">resource1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">resource2</span>: <span class=\"nc\">resource2</span><span class=\"p\">)</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">resource2</span><span class=\"p\">;</span>\n\n<span class=\"w\">    </span><span class=\"n\">resource</span><span class=\"w\"> </span><span class=\"n\">resource2</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<h3>Steps to Reproduce</h3>\n<ul>\n<li>Clone repository</li>\n<li>Run cargo component build</li>\n<li>Run cargo test --test test</li>\n</ul>\n<p>Test that compares returned resource instances will run</p>\n<h3>Expected Results</h3>\n<p>Test passes</p>\n<h3>Actual Results</h3>\n<p>Test failes on resource2 comparison - that means that <code>create-resource2</code> returned the same value two times.</p>\n<h3>Versions and Environment</h3>\n<p>Wasmtime version or commit: 17.0.0</p>\n<p>Operating system: Windows 11</p>\n<p>Architecture: amd64</p>\n<h3>Extra Info</h3>\n<p>Test also includes method that uses both resource1 and resource2. You can comment out <code>ensure!(res2_1 != res2_2);</code> which causes this method to run. Invocation results in following error:</p>\n<p><div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">Error</span>: <span class=\"nc\">unknown</span><span class=\"w\"> </span><span class=\"n\">handle</span><span class=\"w\"> </span><span class=\"n\">index</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n</code></pre></div><br>\n</p>\n</blockquote>",
        "id": 420164972,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1707269362
    },
    {
        "content": "<p>Lifeblossom edited <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7883\">issue #7883</a>:</p>\n<blockquote>\n<h3>Test Case</h3>\n<p><a href=\"https://github.com/Lifeblossom/wasmtime-resource-paremeter-bug-report\">https://github.com/Lifeblossom/wasmtime-resource-paremeter-bug-report</a></p>\n<p>Wit file:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">component</span>:<span class=\"nc\">bug</span><span class=\"o\">-</span><span class=\"n\">report</span><span class=\"p\">;</span>\n\n<span class=\"n\">world</span><span class=\"w\"> </span><span class=\"n\">example</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"n\">resource2</span><span class=\"o\">-</span><span class=\"n\">interface</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"n\">resource1</span><span class=\"o\">-</span><span class=\"n\">interface</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n\n<span class=\"n\">interface</span><span class=\"w\"> </span><span class=\"n\">resource1</span><span class=\"o\">-</span><span class=\"n\">interface</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"n\">create</span>: <span class=\"nc\">func</span><span class=\"p\">()</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">resource1</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"n\">resource</span><span class=\"w\"> </span><span class=\"n\">resource1</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n\n<span class=\"n\">interface</span><span class=\"w\"> </span><span class=\"n\">resource2</span><span class=\"o\">-</span><span class=\"n\">interface</span><span class=\"w\"> </span><span class=\"p\">{</span>\n\n<span class=\"w\">    </span><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">resource1</span><span class=\"o\">-</span><span class=\"n\">interface</span><span class=\"p\">.{</span><span class=\"n\">resource1</span><span class=\"p\">};</span>\n<span class=\"w\">    </span><span class=\"n\">create</span><span class=\"o\">-</span><span class=\"n\">resource2</span>: <span class=\"nc\">func</span><span class=\"p\">(</span><span class=\"n\">resource1</span>: <span class=\"nc\">resource1</span><span class=\"p\">)</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">resource2</span><span class=\"p\">;</span>\n\n<span class=\"w\">    </span><span class=\"kr\">do</span><span class=\"o\">-</span><span class=\"n\">stuff</span>: <span class=\"nc\">func</span><span class=\"p\">(</span><span class=\"n\">resource1</span>: <span class=\"nc\">resource1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">resource2</span>: <span class=\"nc\">resource2</span><span class=\"p\">)</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">resource2</span><span class=\"p\">;</span>\n\n<span class=\"w\">    </span><span class=\"n\">resource</span><span class=\"w\"> </span><span class=\"n\">resource2</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<h3>Steps to Reproduce</h3>\n<ul>\n<li>Clone repository</li>\n<li>Run cargo component build</li>\n<li>Run cargo test --test test</li>\n</ul>\n<p>Test that compares returned resource instances will run</p>\n<h3>Expected Results</h3>\n<p>Test passes</p>\n<h3>Actual Results</h3>\n<p>Test failes on resource2 comparison - that means that <code>create-resource2</code> returned the same value two times.</p>\n<h3>Versions and Environment</h3>\n<p>Wasmtime version or commit: 17.0.0</p>\n<p>Operating system: Windows 11</p>\n<p>Architecture: amd64</p>\n<h3>Extra Info</h3>\n<p>Test also includes method that uses both resource1 and resource2. You can comment out <code>ensure!(res2_1 != res2_2);</code> which causes this method to run. Invocation results in following error:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">Error</span>: <span class=\"nc\">unknown</span><span class=\"w\"> </span><span class=\"n\">handle</span><span class=\"w\"> </span><span class=\"n\">index</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n</code></pre></div>\n<p>Other findings<br>\nWhen using debugger both <code>res2_1</code> and <code>res_2_2</code> have idx <code>0</code>, but when <code>res_1_1</code> is replaced with <code>res_1_2</code> it is <code>1</code>. So I guess the resource id is taken from resource that was used as parameter.</p>\n</blockquote>",
        "id": 420166749,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1707270711
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7883#issuecomment-1936062714\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7883\">issue #7883</a>:</p>\n<blockquote>\n<p>Thank you for the report and the reproduction, it was very thorough! I was able to reproduce this and after digging into it I've opened up <a href=\"https://github.com/bytecodealliance/wasmtime/pull/7902\">https://github.com/bytecodealliance/wasmtime/pull/7902</a> which is sort of a fix and sort of not.</p>\n<p>The root issue here is that on <a href=\"https://github.com/Lifeblossom/wasmtime-resource-paremeter-bug-report/blob/b98eed9f6602ddb6518135fd3028d67132f4ba1d/tests/test.rs#L87\">this line</a> I suspect you intended <code>res1_2</code> instead of <code>res1_1</code>. Otherwise what you're attempting to do is to reuse an resource previously consumed again, which is not valid to do. The reason #7902 fixes this is that the resuse of a consumed resource now triggers a runtime error instead of silently allowing it.</p>\n<p>Much of this comes because we've found it difficult historically to map resource types into Rust's type system. For example you might expect an owned value for resources but that has unfortunately not played out well so that's not how they work. Resources are instead and index into something owned by the store which means that they can suffer ABA and use-after-free style patterns (not in the unsound sense of use-after-free, moreso in the like-this-example-use-the-same-thing-twice sense).</p>\n<p>I'll note that this also means that equality between resources is somewhat loose at best. Resource equality doesn't take into account the <code>rep</code> that the underlying resource was created with. Additionally equality doesn't mean much with consumed resources like in this case because once an index is consumed then anything else could take it.</p>\n<p>In any case I hope that's all able to help at least unblock you, but if you have further questions I can try to answer them here.</p>\n</blockquote>",
        "id": 420666548,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1707490015
    },
    {
        "content": "<p>Lifeblossom <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7883#issuecomment-1936394596\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7883\">issue #7883</a>:</p>\n<blockquote>\n<p>It wasn't a typo - I didn't knew that <code>borrow</code> exists and since bindings allowed to me use resource multiple times I've assumed that this will be handled properly (as in resource won't be used).<br>\nNow when I think about it on the other side I get Resource&lt;something&gt; object which also is kinda suprising in this context. I would expect to just get the object without any wrapper (since the object is used by my function I can just drop it).</p>\n</blockquote>",
        "id": 420706140,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1707502509
    },
    {
        "content": "<p>Lifeblossom edited a <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7883#issuecomment-1936394596\">comment</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7883\">issue #7883</a>:</p>\n<blockquote>\n<p>It wasn't a typo - I didn't know that <code>borrow</code> exists and since bindings allowed to me use resource multiple times I've assumed that this will be handled properly (as in resource won't be used).<br>\nNow when I think about it on the other side I get Resource&lt;something&gt; object which also is kinda suprising in this context. I would expect to just get the object without any wrapper (since the object is used by my function I can just drop it).</p>\n</blockquote>",
        "id": 420706148,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1707502517
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7883#issuecomment-1936434917\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7883\">issue #7883</a>:</p>\n<blockquote>\n<p>Indeed designing embedding APIs is not easy! <code>ResourceAny</code> and <code>Resource&lt;T&gt;</code> are the best we could figure out for now on the host side. If you've got suggestions about how to improve though please let us know!</p>\n</blockquote>",
        "id": 420710834,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1707504421
    },
    {
        "content": "<p>alexcrichton closed <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7883\">issue #7883</a>:</p>\n<blockquote>\n<h3>Test Case</h3>\n<p><a href=\"https://github.com/Lifeblossom/wasmtime-resource-paremeter-bug-report\">https://github.com/Lifeblossom/wasmtime-resource-paremeter-bug-report</a></p>\n<p>Wit file:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">component</span>:<span class=\"nc\">bug</span><span class=\"o\">-</span><span class=\"n\">report</span><span class=\"p\">;</span>\n\n<span class=\"n\">world</span><span class=\"w\"> </span><span class=\"n\">example</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"n\">resource2</span><span class=\"o\">-</span><span class=\"n\">interface</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"n\">resource1</span><span class=\"o\">-</span><span class=\"n\">interface</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n\n<span class=\"n\">interface</span><span class=\"w\"> </span><span class=\"n\">resource1</span><span class=\"o\">-</span><span class=\"n\">interface</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"n\">create</span>: <span class=\"nc\">func</span><span class=\"p\">()</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">resource1</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"n\">resource</span><span class=\"w\"> </span><span class=\"n\">resource1</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n\n<span class=\"n\">interface</span><span class=\"w\"> </span><span class=\"n\">resource2</span><span class=\"o\">-</span><span class=\"n\">interface</span><span class=\"w\"> </span><span class=\"p\">{</span>\n\n<span class=\"w\">    </span><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">resource1</span><span class=\"o\">-</span><span class=\"n\">interface</span><span class=\"p\">.{</span><span class=\"n\">resource1</span><span class=\"p\">};</span>\n<span class=\"w\">    </span><span class=\"n\">create</span><span class=\"o\">-</span><span class=\"n\">resource2</span>: <span class=\"nc\">func</span><span class=\"p\">(</span><span class=\"n\">resource1</span>: <span class=\"nc\">resource1</span><span class=\"p\">)</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">resource2</span><span class=\"p\">;</span>\n\n<span class=\"w\">    </span><span class=\"kr\">do</span><span class=\"o\">-</span><span class=\"n\">stuff</span>: <span class=\"nc\">func</span><span class=\"p\">(</span><span class=\"n\">resource1</span>: <span class=\"nc\">resource1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">resource2</span>: <span class=\"nc\">resource2</span><span class=\"p\">)</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">resource2</span><span class=\"p\">;</span>\n\n<span class=\"w\">    </span><span class=\"n\">resource</span><span class=\"w\"> </span><span class=\"n\">resource2</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<h3>Steps to Reproduce</h3>\n<ul>\n<li>Clone repository</li>\n<li>Run cargo component build</li>\n<li>Run cargo test --test test</li>\n</ul>\n<p>Test that compares returned resource instances will run</p>\n<h3>Expected Results</h3>\n<p>Test passes</p>\n<h3>Actual Results</h3>\n<p>Test failes on resource2 comparison - that means that <code>create-resource2</code> returned the same value two times.</p>\n<h3>Versions and Environment</h3>\n<p>Wasmtime version or commit: 17.0.0</p>\n<p>Operating system: Windows 11</p>\n<p>Architecture: amd64</p>\n<h3>Extra Info</h3>\n<p>Test also includes method that uses both resource1 and resource2. You can comment out <code>ensure!(res2_1 != res2_2);</code> which causes this method to run. Invocation results in following error:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">Error</span>: <span class=\"nc\">unknown</span><span class=\"w\"> </span><span class=\"n\">handle</span><span class=\"w\"> </span><span class=\"n\">index</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n</code></pre></div>\n<p>Other findings<br>\nWhen using debugger both <code>res2_1</code> and <code>res_2_2</code> have idx <code>0</code>, but when <code>res_1_1</code> is replaced with <code>res_1_2</code> it is <code>1</code>. So I guess the resource id is taken from resource that was used as parameter.</p>\n</blockquote>",
        "id": 421147253,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1707779479
    }
]