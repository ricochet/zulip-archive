[
    {
        "content": "<p>alexcrichton opened <a href=\"https://github.com/bytecodealliance/wasmtime/issues/8752\">issue #8752</a>:</p>\n<blockquote>\n<p>Spinning off <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7278#issuecomment-2152906576\">https://github.com/bytecodealliance/wasmtime/issues/7278#issuecomment-2152906576</a> into its own issue I've done a local bisection that points to <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5843\">https://github.com/bytecodealliance/wasmtime/pull/5843</a> as the source of where some DWARF debugging broke a long time ago. My bisection script was:</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code><span class=\"nb\">set</span><span class=\"w\"> </span>-ex\n\ncargo<span class=\"w\"> </span>build\n\nrustc<span class=\"w\"> </span><span class=\"se\">\\</span>\n<span class=\"w\">  </span>examples/fib-debug/wasm/fib.rs<span class=\"w\"> </span><span class=\"se\">\\</span>\n<span class=\"w\">  </span>--crate-type<span class=\"w\"> </span>cdylib<span class=\"w\"> </span><span class=\"se\">\\</span>\n<span class=\"w\">  </span>-C<span class=\"w\"> </span><span class=\"nv\">debuginfo</span><span class=\"o\">=</span><span class=\"m\">2</span><span class=\"w\"> </span><span class=\"se\">\\</span>\n<span class=\"w\">  </span>-o<span class=\"w\"> </span>./fib.wasm<span class=\"w\"> </span><span class=\"se\">\\</span>\n<span class=\"w\">  </span>--target<span class=\"w\"> </span>wasm32-unknown-unknown<span class=\"w\"> </span><span class=\"se\">\\</span>\n<span class=\"w\">  </span>-C<span class=\"w\"> </span><span class=\"nv\">incremental</span><span class=\"o\">=</span>./target/tmp-incremental\n\n<span class=\"c1\"># lldb \\</span>\n<span class=\"c1\">#   --one-line 'b fib.rs:7' \\</span>\n<span class=\"c1\">#   --one-line 'run' \\</span>\n<span class=\"c1\">#   --one-line 'fr v' \\</span>\n<span class=\"c1\">#   --one-line 'exit' \\</span>\n<span class=\"c1\">#   -- \\</span>\n<span class=\"c1\">#   ./target/debug/wasmtime run \\</span>\n<span class=\"c1\">#     -Ccache=n \\</span>\n<span class=\"c1\">#     -Ddebug-info \\</span>\n<span class=\"c1\">#     -Oopt-level=0 \\</span>\n<span class=\"c1\">#     --invoke fib \\</span>\n<span class=\"c1\">#     ./fib.wasm 5</span>\n\nlldb<span class=\"w\"> </span><span class=\"se\">\\</span>\n<span class=\"w\">  </span>--one-line<span class=\"w\"> </span><span class=\"s1\">'b fib.rs:7'</span><span class=\"w\"> </span><span class=\"se\">\\</span>\n<span class=\"w\">  </span>--one-line<span class=\"w\"> </span><span class=\"s1\">'run'</span><span class=\"w\"> </span><span class=\"se\">\\</span>\n<span class=\"w\">  </span>--one-line<span class=\"w\"> </span><span class=\"s1\">'fr v'</span><span class=\"w\"> </span><span class=\"se\">\\</span>\n<span class=\"w\">  </span>--one-line<span class=\"w\"> </span><span class=\"s1\">'exit'</span><span class=\"w\"> </span><span class=\"se\">\\</span>\n<span class=\"w\">  </span>--<span class=\"w\"> </span><span class=\"se\">\\</span>\n<span class=\"w\">  </span>./target/debug/wasmtime<span class=\"w\"> </span>run<span class=\"w\"> </span><span class=\"se\">\\</span>\n<span class=\"w\">    </span>--disable-cache<span class=\"w\"> </span><span class=\"se\">\\</span>\n<span class=\"w\">    </span>-g<span class=\"w\"> </span><span class=\"se\">\\</span>\n<span class=\"w\">    </span>--opt-level<span class=\"w\"> </span><span class=\"m\">0</span><span class=\"w\"> </span><span class=\"se\">\\</span>\n<span class=\"w\">    </span>--invoke<span class=\"w\"> </span>fib<span class=\"w\"> </span><span class=\"se\">\\</span>\n<span class=\"w\">    </span>./fib.wasm<span class=\"w\"> </span><span class=\"m\">5</span>\n</code></pre></div>\n<p>Where on this commit it prints:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">sh</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">sh</span>\n<span class=\"o\">..</span><span class=\"p\">.</span>\n<span class=\"p\">(</span><span class=\"n\">lldb</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">fr</span><span class=\"w\"> </span><span class=\"n\">v</span>\n<span class=\"p\">(</span><span class=\"n\">WasmtimeVMContext</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">__vmctx</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">variable</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">available</span><span class=\"o\">&gt;</span>\n\n<span class=\"p\">(</span><span class=\"n\">unsigned</span><span class=\"w\"> </span><span class=\"n\">int</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">variable</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">available</span><span class=\"o\">&gt;</span>\n\n<span class=\"p\">(</span><span class=\"n\">lldb</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">exit</span>\n</code></pre></div>\n<p>but before the commit it prints:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">sh</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">sh</span>\n<span class=\"o\">..</span><span class=\"p\">.</span>\n<span class=\"p\">(</span><span class=\"n\">lldb</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">fr</span><span class=\"w\"> </span><span class=\"n\">v</span>\n<span class=\"p\">(</span><span class=\"n\">WasmtimeVMContext</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">__vmctx</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mh\">0x0000555557671860</span>\n<span class=\"p\">(</span><span class=\"n\">unsigned</span><span class=\"w\"> </span><span class=\"n\">int</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">5</span>\n<span class=\"p\">(</span><span class=\"n\">unsigned</span><span class=\"w\"> </span><span class=\"n\">int</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"p\">(</span><span class=\"n\">unsigned</span><span class=\"w\"> </span><span class=\"n\">int</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"p\">(</span><span class=\"n\">core</span><span class=\"p\">::</span><span class=\"n\">ops</span><span class=\"p\">::</span><span class=\"n\">range</span><span class=\"p\">::</span><span class=\"n\">Range</span><span class=\"o\">&lt;</span><span class=\"n\">unsigned</span><span class=\"w\"> </span><span class=\"n\">int</span><span class=\"o\">&gt;</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">iter</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">start</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">end</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"p\">)</span>\n<span class=\"p\">(</span><span class=\"n\">unsigned</span><span class=\"w\"> </span><span class=\"n\">int</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"p\">(</span><span class=\"n\">lldb</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">exit</span>\n</code></pre></div>\n<p>Interestingly if you compile without <code>-Cincremental</code> then the debugging works fine on <code>main</code>. I don't know whether that's related or if #5843 is the main culprit.</p>\n</blockquote>",
        "id": 443160160,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1717707461
    },
    {
        "content": "<p>pgherveou <a href=\"https://github.com/bytecodealliance/wasmtime/issues/8752#issuecomment-2154179706\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/8752\">issue #8752</a>:</p>\n<blockquote>\n<p>Ah nice, thanks for digging into this @alexcrichton <br>\nI was able to debug the fib example using </p>\n<p><div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">CARGO_INCREMENTAL</span><span class=\"o\">=</span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"n\">cargo</span><span class=\"w\"> </span><span class=\"n\">build</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">example</span><span class=\"o\">-</span><span class=\"n\">fib</span><span class=\"o\">-</span><span class=\"n\">debug</span><span class=\"o\">-</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">target</span><span class=\"w\"> </span><span class=\"n\">wasm32</span><span class=\"o\">-</span><span class=\"n\">unknown</span><span class=\"o\">-</span><span class=\"n\">unknown</span>\n</code></pre></div><br>\n</p>\n</blockquote>",
        "id": 443221313,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1717741863
    },
    {
        "content": "<p>alexcrichton closed <a href=\"https://github.com/bytecodealliance/wasmtime/issues/8752\">issue #8752</a>:</p>\n<blockquote>\n<p>Spinning off <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7278#issuecomment-2152906576\">https://github.com/bytecodealliance/wasmtime/issues/7278#issuecomment-2152906576</a> into its own issue I've done a local bisection that points to <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5843\">https://github.com/bytecodealliance/wasmtime/pull/5843</a> as the source of where some DWARF debugging broke a long time ago. My bisection script was:</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code><span class=\"nb\">set</span><span class=\"w\"> </span>-ex\n\ncargo<span class=\"w\"> </span>build\n\nrustc<span class=\"w\"> </span><span class=\"se\">\\</span>\n<span class=\"w\">  </span>examples/fib-debug/wasm/fib.rs<span class=\"w\"> </span><span class=\"se\">\\</span>\n<span class=\"w\">  </span>--crate-type<span class=\"w\"> </span>cdylib<span class=\"w\"> </span><span class=\"se\">\\</span>\n<span class=\"w\">  </span>-C<span class=\"w\"> </span><span class=\"nv\">debuginfo</span><span class=\"o\">=</span><span class=\"m\">2</span><span class=\"w\"> </span><span class=\"se\">\\</span>\n<span class=\"w\">  </span>-o<span class=\"w\"> </span>./fib.wasm<span class=\"w\"> </span><span class=\"se\">\\</span>\n<span class=\"w\">  </span>--target<span class=\"w\"> </span>wasm32-unknown-unknown<span class=\"w\"> </span><span class=\"se\">\\</span>\n<span class=\"w\">  </span>-C<span class=\"w\"> </span><span class=\"nv\">incremental</span><span class=\"o\">=</span>./target/tmp-incremental\n\n<span class=\"c1\"># lldb \\</span>\n<span class=\"c1\">#   --one-line 'b fib.rs:7' \\</span>\n<span class=\"c1\">#   --one-line 'run' \\</span>\n<span class=\"c1\">#   --one-line 'fr v' \\</span>\n<span class=\"c1\">#   --one-line 'exit' \\</span>\n<span class=\"c1\">#   -- \\</span>\n<span class=\"c1\">#   ./target/debug/wasmtime run \\</span>\n<span class=\"c1\">#     -Ccache=n \\</span>\n<span class=\"c1\">#     -Ddebug-info \\</span>\n<span class=\"c1\">#     -Oopt-level=0 \\</span>\n<span class=\"c1\">#     --invoke fib \\</span>\n<span class=\"c1\">#     ./fib.wasm 5</span>\n\nlldb<span class=\"w\"> </span><span class=\"se\">\\</span>\n<span class=\"w\">  </span>--one-line<span class=\"w\"> </span><span class=\"s1\">'b fib.rs:7'</span><span class=\"w\"> </span><span class=\"se\">\\</span>\n<span class=\"w\">  </span>--one-line<span class=\"w\"> </span><span class=\"s1\">'run'</span><span class=\"w\"> </span><span class=\"se\">\\</span>\n<span class=\"w\">  </span>--one-line<span class=\"w\"> </span><span class=\"s1\">'fr v'</span><span class=\"w\"> </span><span class=\"se\">\\</span>\n<span class=\"w\">  </span>--one-line<span class=\"w\"> </span><span class=\"s1\">'exit'</span><span class=\"w\"> </span><span class=\"se\">\\</span>\n<span class=\"w\">  </span>--<span class=\"w\"> </span><span class=\"se\">\\</span>\n<span class=\"w\">  </span>./target/debug/wasmtime<span class=\"w\"> </span>run<span class=\"w\"> </span><span class=\"se\">\\</span>\n<span class=\"w\">    </span>--disable-cache<span class=\"w\"> </span><span class=\"se\">\\</span>\n<span class=\"w\">    </span>-g<span class=\"w\"> </span><span class=\"se\">\\</span>\n<span class=\"w\">    </span>--opt-level<span class=\"w\"> </span><span class=\"m\">0</span><span class=\"w\"> </span><span class=\"se\">\\</span>\n<span class=\"w\">    </span>--invoke<span class=\"w\"> </span>fib<span class=\"w\"> </span><span class=\"se\">\\</span>\n<span class=\"w\">    </span>./fib.wasm<span class=\"w\"> </span><span class=\"m\">5</span>\n</code></pre></div>\n<p>Where on this commit it prints:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">sh</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">sh</span>\n<span class=\"o\">..</span><span class=\"p\">.</span>\n<span class=\"p\">(</span><span class=\"n\">lldb</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">fr</span><span class=\"w\"> </span><span class=\"n\">v</span>\n<span class=\"p\">(</span><span class=\"n\">WasmtimeVMContext</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">__vmctx</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">variable</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">available</span><span class=\"o\">&gt;</span>\n\n<span class=\"p\">(</span><span class=\"n\">unsigned</span><span class=\"w\"> </span><span class=\"n\">int</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">variable</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">available</span><span class=\"o\">&gt;</span>\n\n<span class=\"p\">(</span><span class=\"n\">lldb</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">exit</span>\n</code></pre></div>\n<p>but before the commit it prints:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">sh</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">sh</span>\n<span class=\"o\">..</span><span class=\"p\">.</span>\n<span class=\"p\">(</span><span class=\"n\">lldb</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">fr</span><span class=\"w\"> </span><span class=\"n\">v</span>\n<span class=\"p\">(</span><span class=\"n\">WasmtimeVMContext</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">__vmctx</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mh\">0x0000555557671860</span>\n<span class=\"p\">(</span><span class=\"n\">unsigned</span><span class=\"w\"> </span><span class=\"n\">int</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">5</span>\n<span class=\"p\">(</span><span class=\"n\">unsigned</span><span class=\"w\"> </span><span class=\"n\">int</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"p\">(</span><span class=\"n\">unsigned</span><span class=\"w\"> </span><span class=\"n\">int</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"p\">(</span><span class=\"n\">core</span><span class=\"p\">::</span><span class=\"n\">ops</span><span class=\"p\">::</span><span class=\"n\">range</span><span class=\"p\">::</span><span class=\"n\">Range</span><span class=\"o\">&lt;</span><span class=\"n\">unsigned</span><span class=\"w\"> </span><span class=\"n\">int</span><span class=\"o\">&gt;</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">iter</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">start</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">end</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"p\">)</span>\n<span class=\"p\">(</span><span class=\"n\">unsigned</span><span class=\"w\"> </span><span class=\"n\">int</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"p\">(</span><span class=\"n\">lldb</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">exit</span>\n</code></pre></div>\n<p>Interestingly if you compile without <code>-Cincremental</code> then the debugging works fine on <code>main</code>. I don't know whether that's related or if #5843 is the main culprit.</p>\n</blockquote>",
        "id": 443873897,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1718058176
    }
]