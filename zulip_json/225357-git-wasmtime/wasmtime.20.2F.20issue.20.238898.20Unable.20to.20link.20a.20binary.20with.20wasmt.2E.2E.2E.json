[
    {
        "content": "<p><a href=\"https://github.com/pimeys\">pimeys</a> added the bug label to <a href=\"https://github.com/bytecodealliance/wasmtime/issues/8898\">Issue #8898</a>.</p>",
        "id": 448895287,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1720023319
    },
    {
        "content": "<p>pimeys opened <a href=\"https://github.com/bytecodealliance/wasmtime/issues/8898\">issue #8898</a>:</p>\n<blockquote>\n<h3>Test Case</h3>\n<p>I'm sorry I cannot find an isolated example for you to test with a small dependency tree, but in our repo, when we updated wasmtime from 21.0.1 to 22.0.0 we suddenly started having issues linking the binary when compiling against musl target.</p>\n<p>Here's the branch:</p>\n<p><a href=\"https://github.com/grafbase/grafbase/pull/1840\">https://github.com/grafbase/grafbase/pull/1840</a></p>\n<p>And the error we see when linking:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"w\">  </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">note</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">usr</span><span class=\"o\">/</span><span class=\"n\">bin</span><span class=\"o\">/</span><span class=\"n\">ld</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">usr</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"o\">/</span><span class=\"n\">x86_64</span><span class=\"o\">-</span><span class=\"n\">linux</span><span class=\"o\">-</span><span class=\"n\">gnu</span><span class=\"o\">/</span><span class=\"n\">libm</span><span class=\"o\">-</span><span class=\"mf\">2.35.</span><span class=\"n\">a</span><span class=\"p\">(</span><span class=\"n\">e_pow</span><span class=\"p\">.</span><span class=\"n\">o</span><span class=\"p\">):</span><span class=\"w\"> </span><span class=\"nc\">warning</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">relocation</span><span class=\"w\"> </span><span class=\"n\">against</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">_dl_x86_cpu_features</span><span class=\"o\">'</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">read</span><span class=\"o\">-</span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"n\">section</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"p\">.</span><span class=\"n\">text</span><span class=\"o\">'</span>\n<span class=\"w\">          </span><span class=\"o\">/</span><span class=\"n\">usr</span><span class=\"o\">/</span><span class=\"n\">bin</span><span class=\"o\">/</span><span class=\"n\">ld</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">usr</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"o\">/</span><span class=\"n\">x86_64</span><span class=\"o\">-</span><span class=\"n\">linux</span><span class=\"o\">-</span><span class=\"n\">gnu</span><span class=\"o\">/</span><span class=\"n\">libm</span><span class=\"o\">-</span><span class=\"mf\">2.35.</span><span class=\"n\">a</span><span class=\"p\">(</span><span class=\"n\">s_ceil</span><span class=\"p\">.</span><span class=\"n\">o</span><span class=\"p\">):</span><span class=\"w\"> </span><span class=\"nc\">in</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">__ceil_ifunc</span><span class=\"o\">'</span><span class=\"p\">:</span>\n<span class=\"w\">          </span><span class=\"p\">(.</span><span class=\"n\">text</span><span class=\"o\">+</span><span class=\"mh\">0x6</span><span class=\"p\">):</span><span class=\"w\"> </span><span class=\"nc\">undefined</span><span class=\"w\"> </span><span class=\"n\">reference</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">_dl_x86_cpu_features</span><span class=\"o\">'</span>\n<span class=\"w\">          </span><span class=\"o\">/</span><span class=\"n\">usr</span><span class=\"o\">/</span><span class=\"n\">bin</span><span class=\"o\">/</span><span class=\"n\">ld</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">usr</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"o\">/</span><span class=\"n\">x86_64</span><span class=\"o\">-</span><span class=\"n\">linux</span><span class=\"o\">-</span><span class=\"n\">gnu</span><span class=\"o\">/</span><span class=\"n\">libm</span><span class=\"o\">-</span><span class=\"mf\">2.35.</span><span class=\"n\">a</span><span class=\"p\">(</span><span class=\"n\">s_trunc</span><span class=\"p\">.</span><span class=\"n\">o</span><span class=\"p\">):</span><span class=\"w\"> </span><span class=\"nc\">in</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">__trunc_ifunc</span><span class=\"o\">'</span><span class=\"p\">:</span>\n<span class=\"w\">          </span><span class=\"p\">(.</span><span class=\"n\">text</span><span class=\"o\">+</span><span class=\"mh\">0x6</span><span class=\"p\">):</span><span class=\"w\"> </span><span class=\"nc\">undefined</span><span class=\"w\"> </span><span class=\"n\">reference</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">_dl_x86_cpu_features</span><span class=\"o\">'</span>\n<span class=\"w\">          </span><span class=\"o\">/</span><span class=\"n\">usr</span><span class=\"o\">/</span><span class=\"n\">bin</span><span class=\"o\">/</span><span class=\"n\">ld</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">usr</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"o\">/</span><span class=\"n\">x86_64</span><span class=\"o\">-</span><span class=\"n\">linux</span><span class=\"o\">-</span><span class=\"n\">gnu</span><span class=\"o\">/</span><span class=\"n\">libm</span><span class=\"o\">-</span><span class=\"mf\">2.35.</span><span class=\"n\">a</span><span class=\"p\">(</span><span class=\"n\">s_fma</span><span class=\"p\">.</span><span class=\"n\">o</span><span class=\"p\">):</span><span class=\"w\"> </span><span class=\"nc\">in</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">__fma_ifunc</span><span class=\"o\">'</span><span class=\"p\">:</span>\n<span class=\"w\">          </span><span class=\"p\">(.</span><span class=\"n\">text</span><span class=\"o\">+</span><span class=\"mh\">0xafd</span><span class=\"p\">):</span><span class=\"w\"> </span><span class=\"nc\">undefined</span><span class=\"w\"> </span><span class=\"n\">reference</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">_dl_x86_cpu_features</span><span class=\"o\">'</span>\n<span class=\"w\">          </span><span class=\"o\">/</span><span class=\"n\">usr</span><span class=\"o\">/</span><span class=\"n\">bin</span><span class=\"o\">/</span><span class=\"n\">ld</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">(.</span><span class=\"n\">text</span><span class=\"o\">+</span><span class=\"mh\">0xb06</span><span class=\"p\">):</span><span class=\"w\"> </span><span class=\"nc\">undefined</span><span class=\"w\"> </span><span class=\"n\">reference</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">_dl_x86_cpu_features</span><span class=\"o\">'</span>\n<span class=\"w\">          </span><span class=\"o\">/</span><span class=\"n\">usr</span><span class=\"o\">/</span><span class=\"n\">bin</span><span class=\"o\">/</span><span class=\"n\">ld</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">usr</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"o\">/</span><span class=\"n\">x86_64</span><span class=\"o\">-</span><span class=\"n\">linux</span><span class=\"o\">-</span><span class=\"n\">gnu</span><span class=\"o\">/</span><span class=\"n\">libm</span><span class=\"o\">-</span><span class=\"mf\">2.35.</span><span class=\"n\">a</span><span class=\"p\">(</span><span class=\"n\">w_fmod</span><span class=\"p\">.</span><span class=\"n\">o</span><span class=\"p\">):</span><span class=\"w\"> </span><span class=\"nc\">in</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">__fmod</span><span class=\"o\">'</span><span class=\"p\">:</span>\n<span class=\"w\">          </span><span class=\"p\">(.</span><span class=\"n\">text</span><span class=\"o\">+</span><span class=\"mh\">0x41</span><span class=\"p\">):</span><span class=\"w\"> </span><span class=\"nc\">undefined</span><span class=\"w\"> </span><span class=\"n\">reference</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">errno</span><span class=\"o\">'</span>\n<span class=\"w\">          </span><span class=\"o\">/</span><span class=\"n\">usr</span><span class=\"o\">/</span><span class=\"n\">bin</span><span class=\"o\">/</span><span class=\"n\">ld</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">usr</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"o\">/</span><span class=\"n\">x86_64</span><span class=\"o\">-</span><span class=\"n\">linux</span><span class=\"o\">-</span><span class=\"n\">gnu</span><span class=\"o\">/</span><span class=\"n\">libm</span><span class=\"o\">-</span><span class=\"mf\">2.35.</span><span class=\"n\">a</span><span class=\"p\">(</span><span class=\"n\">w_pow</span><span class=\"p\">.</span><span class=\"n\">o</span><span class=\"p\">):</span><span class=\"w\"> </span><span class=\"nc\">in</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">__pow</span><span class=\"o\">'</span><span class=\"p\">:</span>\n<span class=\"w\">          </span><span class=\"p\">(.</span><span class=\"n\">text</span><span class=\"o\">+</span><span class=\"mh\">0x75</span><span class=\"p\">):</span><span class=\"w\"> </span><span class=\"nc\">undefined</span><span class=\"w\"> </span><span class=\"n\">reference</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">errno</span><span class=\"o\">'</span>\n<span class=\"w\">          </span><span class=\"o\">/</span><span class=\"n\">usr</span><span class=\"o\">/</span><span class=\"n\">bin</span><span class=\"o\">/</span><span class=\"n\">ld</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">(.</span><span class=\"n\">text</span><span class=\"o\">+</span><span class=\"mh\">0xab</span><span class=\"p\">):</span><span class=\"w\"> </span><span class=\"nc\">undefined</span><span class=\"w\"> </span><span class=\"n\">reference</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">errno</span><span class=\"o\">'</span>\n<span class=\"w\">          </span><span class=\"o\">/</span><span class=\"n\">usr</span><span class=\"o\">/</span><span class=\"n\">bin</span><span class=\"o\">/</span><span class=\"n\">ld</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">usr</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"o\">/</span><span class=\"n\">x86_64</span><span class=\"o\">-</span><span class=\"n\">linux</span><span class=\"o\">-</span><span class=\"n\">gnu</span><span class=\"o\">/</span><span class=\"n\">libm</span><span class=\"o\">-</span><span class=\"mf\">2.35.</span><span class=\"n\">a</span><span class=\"p\">(</span><span class=\"n\">s_truncf</span><span class=\"p\">.</span><span class=\"n\">o</span><span class=\"p\">):</span><span class=\"w\"> </span><span class=\"nc\">in</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">__truncf_ifunc</span><span class=\"o\">'</span><span class=\"p\">:</span>\n<span class=\"w\">          </span><span class=\"p\">(.</span><span class=\"n\">text</span><span class=\"o\">+</span><span class=\"mh\">0x6</span><span class=\"p\">):</span><span class=\"w\"> </span><span class=\"nc\">undefined</span><span class=\"w\"> </span><span class=\"n\">reference</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">_dl_x86_cpu_features</span><span class=\"o\">'</span>\n<span class=\"w\">          </span><span class=\"o\">/</span><span class=\"n\">usr</span><span class=\"o\">/</span><span class=\"n\">bin</span><span class=\"o\">/</span><span class=\"n\">ld</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">usr</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"o\">/</span><span class=\"n\">x86_64</span><span class=\"o\">-</span><span class=\"n\">linux</span><span class=\"o\">-</span><span class=\"n\">gnu</span><span class=\"o\">/</span><span class=\"n\">libm</span><span class=\"o\">-</span><span class=\"mf\">2.35.</span><span class=\"n\">a</span><span class=\"p\">(</span><span class=\"n\">math_err</span><span class=\"p\">.</span><span class=\"n\">o</span><span class=\"p\">):</span><span class=\"w\"> </span><span class=\"nc\">in</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">with_errno</span><span class=\"o\">'</span><span class=\"p\">:</span>\n<span class=\"w\">          </span><span class=\"p\">(.</span><span class=\"n\">text</span><span class=\"o\">+</span><span class=\"mh\">0x3</span><span class=\"p\">):</span><span class=\"w\"> </span><span class=\"nc\">undefined</span><span class=\"w\"> </span><span class=\"n\">reference</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">errno</span><span class=\"o\">'</span>\n<span class=\"w\">          </span><span class=\"o\">/</span><span class=\"n\">usr</span><span class=\"o\">/</span><span class=\"n\">bin</span><span class=\"o\">/</span><span class=\"n\">ld</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">usr</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"o\">/</span><span class=\"n\">x86_64</span><span class=\"o\">-</span><span class=\"n\">linux</span><span class=\"o\">-</span><span class=\"n\">gnu</span><span class=\"o\">/</span><span class=\"n\">libm</span><span class=\"o\">-</span><span class=\"mf\">2.35.</span><span class=\"n\">a</span><span class=\"p\">(</span><span class=\"n\">math_err</span><span class=\"p\">.</span><span class=\"n\">o</span><span class=\"p\">):</span><span class=\"w\"> </span><span class=\"nc\">in</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">with_errno</span><span class=\"p\">.</span><span class=\"n\">constprop</span><span class=\"p\">.</span><span class=\"mi\">0</span><span class=\"o\">'</span><span class=\"p\">:</span>\n<span class=\"w\">          </span><span class=\"p\">(.</span><span class=\"n\">text</span><span class=\"o\">+</span><span class=\"mh\">0x13</span><span class=\"p\">):</span><span class=\"w\"> </span><span class=\"nc\">undefined</span><span class=\"w\"> </span><span class=\"n\">reference</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">errno</span><span class=\"o\">'</span>\n<span class=\"w\">          </span><span class=\"o\">/</span><span class=\"n\">usr</span><span class=\"o\">/</span><span class=\"n\">bin</span><span class=\"o\">/</span><span class=\"n\">ld</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">usr</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"o\">/</span><span class=\"n\">x86_64</span><span class=\"o\">-</span><span class=\"n\">linux</span><span class=\"o\">-</span><span class=\"n\">gnu</span><span class=\"o\">/</span><span class=\"n\">libm</span><span class=\"o\">-</span><span class=\"mf\">2.35.</span><span class=\"n\">a</span><span class=\"p\">(</span><span class=\"n\">e_pow</span><span class=\"p\">.</span><span class=\"n\">o</span><span class=\"p\">):</span><span class=\"w\"> </span><span class=\"nc\">in</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">__ieee754_pow_ifunc</span><span class=\"o\">'</span><span class=\"p\">:</span>\n<span class=\"w\">          </span><span class=\"p\">(.</span><span class=\"n\">text</span><span class=\"o\">+</span><span class=\"mh\">0x746</span><span class=\"p\">):</span><span class=\"w\"> </span><span class=\"nc\">undefined</span><span class=\"w\"> </span><span class=\"n\">reference</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">_dl_x86_cpu_features</span><span class=\"o\">'</span>\n<span class=\"w\">          </span><span class=\"o\">/</span><span class=\"n\">usr</span><span class=\"o\">/</span><span class=\"n\">bin</span><span class=\"o\">/</span><span class=\"n\">ld</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">(.</span><span class=\"n\">text</span><span class=\"o\">+</span><span class=\"mh\">0x74f</span><span class=\"p\">):</span><span class=\"w\"> </span><span class=\"nc\">undefined</span><span class=\"w\"> </span><span class=\"n\">reference</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">_dl_x86_cpu_features</span><span class=\"o\">'</span>\n<span class=\"w\">          </span><span class=\"o\">/</span><span class=\"n\">usr</span><span class=\"o\">/</span><span class=\"n\">bin</span><span class=\"o\">/</span><span class=\"n\">ld</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">(.</span><span class=\"n\">text</span><span class=\"o\">+</span><span class=\"mh\">0x75f</span><span class=\"p\">):</span><span class=\"w\"> </span><span class=\"nc\">undefined</span><span class=\"w\"> </span><span class=\"n\">reference</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">_dl_x86_cpu_features</span><span class=\"o\">'</span>\n<span class=\"w\">          </span><span class=\"o\">/</span><span class=\"n\">usr</span><span class=\"o\">/</span><span class=\"n\">bin</span><span class=\"o\">/</span><span class=\"n\">ld</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">read</span><span class=\"o\">-</span><span class=\"n\">only</span><span class=\"w\"> </span><span class=\"n\">segment</span><span class=\"w\"> </span><span class=\"n\">has</span><span class=\"w\"> </span><span class=\"n\">dynamic</span><span class=\"w\"> </span><span class=\"n\">relocations</span>\n<span class=\"w\">          </span><span class=\"n\">collect2</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">error</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">ld</span><span class=\"w\"> </span><span class=\"n\">returned</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">exit</span><span class=\"w\"> </span><span class=\"n\">status</span>\n</code></pre></div>\n<p>We can currently work with the previous version, but this issue prevents us from updating to the latest runtime.</p>\n<h3>Steps to Reproduce</h3>\n<ul>\n<li>fetch the branch linked in the previous chapter</li>\n<li>Make sure to have musl target installed from rustup</li>\n<li>Install musl-gcc if needed</li>\n<li><code>cargo build -p grafbase-gateway --release --target x86_64-unknown-linux-musl</code></li>\n</ul>\n<h3>Expected Results</h3>\n<p>The project compiles correctly into a working binary.</p>\n<h3>Actual Results</h3>\n<p>Linking fails as explained in the first chapter.</p>\n<h3>Versions and Environment</h3>\n<p>Wasmtime version or commit: 22.0.0</p>\n<p>Operating system: NixOS unstable and Debian Bookworm</p>\n<p>Architecture: x86_64-unknown-linux-musl</p>\n<h3>Extra Info</h3>\n<p>This is most probably some issue with wasmtime and some other crate together. I could not reduce a nice and clean repro as a new project. Been trying to get that the whole afternoon... But something definitely broke in the latest update of wasmtime.<br>\n</p>\n</blockquote>",
        "id": 448895293,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1720023320
    },
    {
        "content": "<p>bjorn3 <a href=\"https://github.com/bytecodealliance/wasmtime/issues/8898#issuecomment-2206750703\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/8898\">issue #8898</a>:</p>\n<blockquote>\n<p>For one reason or another the linker is using glibc's version of libm rather than musl's version of libm. You shouldn't need musl installed on the host system, nor use musl-gcc. Rustc already ships with a copy of musl's libc.a which includes libm.</p>\n</blockquote>",
        "id": 448898039,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1720024064
    },
    {
        "content": "<p>bjorn3 edited a <a href=\"https://github.com/bytecodealliance/wasmtime/issues/8898#issuecomment-2206750703\">comment</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/8898\">issue #8898</a>:</p>\n<blockquote>\n<p>For one reason or another the linker is using glibc's version of libm rather than musl's version of libm. I'm not sure why that happens,. In any case you shouldn't need musl installed on the host system, nor use musl-gcc. Rustc already ships with a copy of musl's libc.a which includes libm.</p>\n</blockquote>",
        "id": 448898156,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1720024094
    },
    {
        "content": "<p>pimeys <a href=\"https://github.com/bytecodealliance/wasmtime/issues/8898#issuecomment-2206793587\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/8898\">issue #8898</a>:</p>\n<blockquote>\n<p>This might be it. I installed a clean debian container to test this out and some dependency didn't build due to missing musl-gcc... I will get back to this when I'm on my computer again.</p>\n</blockquote>",
        "id": 448902875,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1720025693
    },
    {
        "content": "<p>pimeys <a href=\"https://github.com/bytecodealliance/wasmtime/issues/8898#issuecomment-2208605565\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/8898\">issue #8898</a>:</p>\n<blockquote>\n<p>So, this is what I found out:</p>\n<ul>\n<li>wasmtime depends on ittapi, which depends on ittapi-sys</li>\n<li>ittapi-sys depends on cc crate, and fails to compile on a system without musl-gcc </li>\n<li>if installing musl-tools, the crate compiles but with version 22 of wasmtime the linking stage fails to the error described in the issue</li>\n</ul>\n<p>I wonder how common these kind of issues are with musl? We do have several sys dependencies which contain C code and which compile just fine against musl. But why did the wasmtime 22 update break the linking?</p>\n</blockquote>",
        "id": 449051112,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1720087695
    },
    {
        "content": "<p>pimeys <a href=\"https://github.com/bytecodealliance/wasmtime/issues/8898#issuecomment-2208974500\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/8898\">issue #8898</a>:</p>\n<blockquote>\n<p>I did a git-bisect today trying to find which commit broke the build and I think I found it:</p>\n<p><a href=\"https://github.com/bytecodealliance/wasmtime/commit/cc93e8f7f0476c89e1a2ca3a27518e0a7c4177aa#diff-0edccdae9479a6e6d11da47ad26d419b88045e14c5a6086ce7cdd8e236132ed4R38-R41\">https://github.com/bytecodealliance/wasmtime/commit/cc93e8f7f0476c89e1a2ca3a27518e0a7c4177aa#diff-0edccdae9479a6e6d11da47ad26d419b88045e14c5a6086ce7cdd8e236132ed4R38-R41</a></p>\n<p>Ping @alexcrichton </p>\n</blockquote>",
        "id": 449085965,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1720099146
    },
    {
        "content": "<p>pimeys edited a <a href=\"https://github.com/bytecodealliance/wasmtime/issues/8898#issuecomment-2208974500\">comment</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/8898\">issue #8898</a>:</p>\n<blockquote>\n<p>I did a git-bisect today trying to find which commit broke the build and I think I found it:</p>\n<p><a href=\"https://github.com/bytecodealliance/wasmtime/commit/cc93e8f7f0476c89e1a2ca3a27518e0a7c4177aa#diff-0edccdae9479a6e6d11da47ad26d419b88045e14c5a6086ce7cdd8e236132ed4R38-R41\">https://github.com/bytecodealliance/wasmtime/commit/cc93e8f7f0476c89e1a2ca3a27518e0a7c4177aa#diff-0edccdae9479a6e6d11da47ad26d419b88045e14c5a6086ce7cdd8e236132ed4R38-R41</a></p>\n<p>Ping @alexcrichton </p>\n<p>Removing these lines from <a href=\"http://build.rs\">build.rs</a> fixes the issue. But this probably breaks something else...</p>\n</blockquote>",
        "id": 449087386,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1720099450
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/8898#issuecomment-2214117577\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/8898\">issue #8898</a>:</p>\n<blockquote>\n<p>I agree with @bjorn3 that this error is probably a misconfigured linker error rather than anything else. Are you configuring the linker as used by Cargo for the musl target? For example <code>CARGO_TARGET_X86_64_UNKNOWN_LINUX_MUSL_LINKER=musl-gcc</code>. Usage of <code>musl-gcc</code> is auto-configured by the <code>cc</code> crate but the Rust compiler itself does not leverage the same decision making process so the Rust compiler uses <code>cc</code> by default which doesn't work with musl objects since then it crosses the wires by accident.</p>\n</blockquote>",
        "id": 449873400,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1720446241
    },
    {
        "content": "<p>pimeys <a href=\"https://github.com/bytecodealliance/wasmtime/issues/8898#issuecomment-2217715031\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/8898\">issue #8898</a>:</p>\n<blockquote>\n<p>Hey @alexcrichton, is there some documentation how exactly the static musl compilation of a Rust project with C dependencies should look like? In general everybody seems to say you _just_ add a target with rustup and add the target to the cargo cli params. This has worked in the past seven years I've been working with Rust quite well. Now, when changing the  <code>CARGO_TARGET_X86_64_UNKNOWN_LINUX_MUSL_LINKER</code> to <code>musl-gcc</code>, immediately when getting a crate depending on libc we get:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">error</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">linking</span><span class=\"w\"> </span><span class=\"n\">with</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">cc</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">failed</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">exit</span><span class=\"w\"> </span><span class=\"n\">status</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"w\">  </span><span class=\"o\">|</span>\n<span class=\"w\">  </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">note</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">LC_ALL</span><span class=\"o\">=</span><span class=\"s\">\"C\"</span><span class=\"w\"> </span><span class=\"n\">PATH</span><span class=\"o\">=</span><span class=\"s\">\"/home/pimeys/.rustup/toolchains/1.79.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/bin:/home/pimeys/code/grafbase/grafbase/cli/.cargo/bin:/home/pimeys/code/grafbase/grafbase/node_modules/.bin:/nix/store/628y2lfy59bz200rcpbrh9sc2p9v83dm-cargo-insta-1.33.0/bin:/nix/store/vcpa0lb46lyk6afvaj1bqk6z3sayz4ak-cargo-nextest-0.9.72/bin:/nix/store/pxnxx19lr32mqgxkpsz4h7qixzyd84q8-cargo-component-0.13.2/bin:/nix/store/9dna4y1s34nv8glc6d7pkp3a0a9v6ijr-hey-0.1.4/bin:/nix/store/z8lzlvwbygb865qx25wrvxpfa9x8k81i-cargo-bloat-0.12.1/bin:/nix/store/fdg2c6w444j2718mi6q88n5g4lap51pa-cargo-make-0.37.12/bin:/nix/store/q0v146ks60hyw0lc9z91gg7b991rsvys-cargo-release-0.25.0/bin:/nix/store/gfsnb85cmpavq0qkxl0k62jrxmvrriz8-npm-10.8.1/bin:/nix/store/kkkk3zjfa8nm6ghdd1rpdbavzvlyixcy-semver-7.6.2/bin:/nix/store/gcsghgcyax8ri9z9hif5cgqzqvq2dib0-sd-1.0.0/bin:/nix/store/6g9n96qf1yx139xklnmy3v4xhjvjgsji-nodejs-20.12.2/bin:/nix/store/v3ws3vn47r0lm16rjr6yriq6ywv4xvwv-prettier-3.3.0/bin:/nix/store/3ws1qnjgq1rbxs96q67php6i8aygcxgg-bun-1.1.10/bin:/nix/store/qannz09m66qpcy3ny1f4nkl4ql0g71ks-openssl-3.0.13-bin/bin:/nix/store/zdvrzlvzbn9ymb0z8na50w995j8np16z-pkg-config-wrapper-0.29.2/bin:/nix/store/q1nssraba326p2kp6627hldd2bhg254c-cmake-3.29.2/bin:/nix/store/y74bzy6hjnc2n5d3hgq309imwfa0fpw4-rustup-1.26.0/bin:/nix/store/yrmlzr241pa9irf54fslilijnwv664c6-musl-1.2.3-dev/bin:/nix/store/bqjb40djywqk5n4dfzs5babpz7mycz04-musl-1.2.3-bin/bin:/nix/store/s25mgibyiwc2ahwpz2pbvdpj4vvngsva-pnpm-9.1.1/bin:/nix/store/k0d34jsjxzr7mg1c02vvbr616rb1m8nq-yarn-1.22.22/bin:/nix/store/hv6lq8yxrk5cb24147qaakp8isqq4pd9-cargo-about-0.6.2/bin:/nix/store/nbad47q0m0m9c5xid7zh05hiknwircbp-patchelf-0.15.0/bin:/nix/store/9bv7dcvmfcjnmg5mnqwqlq2wxfn8d7yi-gcc-wrapper-13.2.0/bin:/nix/store/14c6s4xzhy14i2b05s00rjns2j93gzz4-gcc-13.2.0/bin:/nix/store/c2i631h8i5vcs1sqifwxfsazhwrg6wr5-glibc-2.39-52-bin/bin:/nix/store/php4qidg2bxzmm79vpri025bqi0fa889-coreutils-9.5/bin:/nix/store/kln7kinji3b7sz8r50h4gn9yy6k1js9a-binutils-wrapper-2.41/bin:/nix/store/bgcaxhhxswzvmxjbbgvvaximm5hwghz1-binutils-2.41/bin:/nix/store/php4qidg2bxzmm79vpri025bqi0fa889-coreutils-9.5/bin:/nix/store/jjcsr5gs4qanf7ln5c6wgcq4sn75a978-findutils-4.9.0/bin:/nix/store/i34mknsjgrfyy71k2h79gda0bvagzc2j-diffutils-3.10/bin:/nix/store/5zjms21vpxlkbc0qyl5pmj2sidfmzmd7-gnused-4.9/bin:/nix/store/28gpmx3z6ss3znd7fhmrzmvk3x5lnfbk-gnugrep-3.11/bin:/nix/store/8vvkbgmnin1x2jkp7wcb2zg1p0vc4ks9-gawk-5.2.2/bin:/nix/store/rik7p68cq7yzlj5pmfpf4yv6jnrpvlgf-gnutar-1.35/bin:/nix/store/j5chw7v1x3vlmf3wmdpdb5gwh9hl0b80-gzip-1.13/bin:/nix/store/mxcq77rlan82dzpv3cgj0fh6qvv8ncil-bzip2-1.0.8-bin/bin:/nix/store/cdzpn0rdq810aknww3w9fy3wmw9ixr66-gnumake-4.4.1/bin:/nix/store/306znyj77fv49kwnkpxmb0j2znqpa8bj-bash-5.2p26/bin:/nix/store/0lfxbmchigx9vs9qmrlbahcy6nxwfnj1-patch-2.7.6/bin:/nix/store/6i4xxaa812vsbli9jkq4mksdddrk27lw-xz-5.4.6-bin/bin:/nix/store/xx7x1dwybpssfhq8yikvzz38bh3yrq97-file-5.45/bin:/home/pimeys/code/grafbase/grafbase/.direnv/bin:/home/pimeys/.cargo/bin:/home/pimeys/.local/bin:/home/pimeys/.atuin/bin:/run/wrappers/bin:/home/pimeys/.nix-profile/bin:/nix/profile/bin:/home/pimeys/.local/state/nix/profile/bin:/etc/profiles/per-user/pimeys/bin:/nix/var/nix/profiles/default/bin:/run/current-system/sw/bin\"</span><span class=\"w\"> </span><span class=\"n\">VSLANG</span><span class=\"o\">=</span><span class=\"s\">\"1033\"</span><span class=\"w\"> </span><span class=\"s\">\"cc\"</span><span class=\"w\"> </span><span class=\"s\">\"-m64\"</span><span class=\"w\"> </span><span class=\"s\">\"/tmp/rustcmngWD1/symbols.o\"</span><span class=\"w\"> </span><span class=\"s\">\"/home/pimeys/code/grafbase/grafbase/target/release/build/serde-7224d35ce8b6f84a/build_script_build-7224d35ce8b6f84a.build_script_build.6d0fdb83d6651bae-cgu.0.rcgu.o\"</span><span class=\"w\"> </span><span class=\"s\">\"/home/pimeys/code/grafbase/grafbase/target/release/build/serde-7224d35ce8b6f84a/build_script_build-7224d35ce8b6f84a.441cvjjahr7ngc3d.rcgu.o\"</span><span class=\"w\"> </span><span class=\"s\">\"-Wl,--as-needed\"</span><span class=\"w\"> </span><span class=\"s\">\"-L\"</span><span class=\"w\"> </span><span class=\"s\">\"/home/pimeys/code/grafbase/grafbase/target/release/deps\"</span><span class=\"w\"> </span><span class=\"s\">\"-L\"</span><span class=\"w\"> </span><span class=\"s\">\"/home/pimeys/.rustup/toolchains/1.79.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib\"</span><span class=\"w\"> </span><span class=\"s\">\"-Wl,-Bstatic\"</span><span class=\"w\"> </span><span class=\"s\">\"/home/pimeys/.rustup/toolchains/1.79.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libstd-d5189b81a4fa4d36.rlib\"</span><span class=\"w\"> </span><span class=\"s\">\"/home/pimeys/.rustup/toolchains/1.79.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libpanic_unwind-6a4779412a873200.rlib\"</span><span class=\"w\"> </span><span class=\"s\">\"/home/pimeys/.rustup/toolchains/1.79.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libobject-c88c426dd6780435.rlib\"</span><span class=\"w\"> </span><span class=\"s\">\"/home/pimeys/.rustup/toolchains/1.79.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libmemchr-e74540b31113a555.rlib\"</span><span class=\"w\"> </span><span class=\"s\">\"/home/pimeys/.rustup/toolchains/1.79.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libaddr2line-8751b61bd13c15cf.rlib\"</span><span class=\"w\"> </span><span class=\"s\">\"/home/pimeys/.rustup/toolchains/1.79.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libgimli-a8b99dba9f449259.rlib\"</span><span class=\"w\"> </span><span class=\"s\">\"/home/pimeys/.rustup/toolchains/1.79.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/librustc_demangle-f0068d76172a0372.rlib\"</span><span class=\"w\"> </span><span class=\"s\">\"/home/pimeys/.rustup/toolchains/1.79.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libstd_detect-c16dfaf47799564e.rlib\"</span><span class=\"w\"> </span><span class=\"s\">\"/home/pimeys/.rustup/toolchains/1.79.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libhashbrown-bfa26dd63e299db5.rlib\"</span><span class=\"w\"> </span><span class=\"s\">\"/home/pimeys/.rustup/toolchains/1.79.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/librustc_std_workspace_alloc-75a2330a693e738f.rlib\"</span><span class=\"w\"> </span><span class=\"s\">\"/home/pimeys/.rustup/toolchains/1.79.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libminiz_oxide-76779dce1f7ab63d.rlib\"</span><span class=\"w\"> </span><span class=\"s\">\"/home/pimeys/.rustup/toolchains/1.79.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libadler-01c5cc588623cb35.rlib\"</span><span class=\"w\"> </span><span class=\"s\">\"/home/pimeys/.rustup/toolchains/1.79.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libunwind-07bb9745ec737292.rlib\"</span><span class=\"w\"> </span><span class=\"s\">\"/home/pimeys/.rustup/toolchains/1.79.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libcfg_if-6eacdcc91004cefb.rlib\"</span><span class=\"w\"> </span><span class=\"s\">\"/home/pimeys/.rustup/toolchains/1.79.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/liblibc-ae2488b58226c836.rlib\"</span><span class=\"w\"> </span><span class=\"s\">\"/home/pimeys/.rustup/toolchains/1.79.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/liballoc-52acaddcaaba04c6.rlib\"</span><span class=\"w\"> </span><span class=\"s\">\"/home/pimeys/.rustup/toolchains/1.79.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/librustc_std_workspace_core-326b78eac9ecd050.rlib\"</span><span class=\"w\"> </span><span class=\"s\">\"/home/pimeys/.rustup/toolchains/1.79.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libcore-307ebf19f0f13d30.rlib\"</span><span class=\"w\"> </span><span class=\"s\">\"/home/pimeys/.rustup/toolchains/1.79.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libcompiler_builtins-d9076ee5964191bf.rlib\"</span><span class=\"w\"> </span><span class=\"s\">\"-Wl,-Bdynamic\"</span><span class=\"w\"> </span><span class=\"s\">\"-lgcc_s\"</span><span class=\"w\"> </span><span class=\"s\">\"-lutil\"</span><span class=\"w\"> </span><span class=\"s\">\"-lrt\"</span><span class=\"w\"> </span><span class=\"s\">\"-lpthread\"</span><span class=\"w\"> </span><span class=\"s\">\"-lm\"</span><span class=\"w\"> </span><span class=\"s\">\"-ldl\"</span><span class=\"w\"> </span><span class=\"s\">\"-lc\"</span><span class=\"w\"> </span><span class=\"s\">\"-Wl,--eh-frame-hdr\"</span><span class=\"w\"> </span><span class=\"s\">\"-Wl,-z,noexecstack\"</span><span class=\"w\"> </span><span class=\"s\">\"-L\"</span><span class=\"w\"> </span><span class=\"s\">\"/home/pimeys/.rustup/toolchains/1.79.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib\"</span><span class=\"w\"> </span><span class=\"s\">\"-o\"</span><span class=\"w\"> </span><span class=\"s\">\"/home/pimeys/code/grafbase/grafbase/target/release/build/serde-7224d35ce8b6f84a/build_script_build-7224d35ce8b6f84a\"</span><span class=\"w\"> </span><span class=\"s\">\"-Wl,--gc-sections\"</span><span class=\"w\"> </span><span class=\"s\">\"-pie\"</span><span class=\"w\"> </span><span class=\"s\">\"-Wl,-z,relro,-z,now\"</span><span class=\"w\"> </span><span class=\"s\">\"-Wl,--strip-all\"</span><span class=\"w\"> </span><span class=\"s\">\"-nodefaultlibs\"</span>\n<span class=\"w\">  </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">note</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">nix</span><span class=\"o\">/</span><span class=\"n\">store</span><span class=\"o\">/</span><span class=\"n\">bgcaxhhxswzvmxjbbgvvaximm5hwghz1</span><span class=\"o\">-</span><span class=\"n\">binutils</span><span class=\"o\">-</span><span class=\"mf\">2.41</span><span class=\"o\">/</span><span class=\"n\">bin</span><span class=\"o\">/</span><span class=\"n\">ld</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">pimeys</span><span class=\"o\">/</span><span class=\"p\">.</span><span class=\"n\">rustup</span><span class=\"o\">/</span><span class=\"n\">toolchains</span><span class=\"o\">/</span><span class=\"mf\">1.79.0</span><span class=\"o\">-</span><span class=\"n\">x86_64</span><span class=\"o\">-</span><span class=\"n\">unknown</span><span class=\"o\">-</span><span class=\"n\">linux</span><span class=\"o\">-</span><span class=\"n\">gnu</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"o\">/</span><span class=\"n\">rustlib</span><span class=\"o\">/</span><span class=\"n\">x86_64</span><span class=\"o\">-</span><span class=\"n\">unknown</span><span class=\"o\">-</span><span class=\"n\">linux</span><span class=\"o\">-</span><span class=\"n\">gnu</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"o\">/</span><span class=\"n\">libstd</span><span class=\"o\">-</span><span class=\"n\">d5189b81a4fa4d36</span><span class=\"p\">.</span><span class=\"n\">rlib</span><span class=\"p\">(</span><span class=\"n\">std</span><span class=\"o\">-</span><span class=\"n\">d5189b81a4fa4d36</span><span class=\"p\">.</span><span class=\"n\">std</span><span class=\"p\">.</span><span class=\"mi\">3</span><span class=\"n\">c8ba8ebcf555201</span><span class=\"o\">-</span><span class=\"n\">cgu</span><span class=\"p\">.</span><span class=\"mf\">0.</span><span class=\"n\">rcgu</span><span class=\"p\">.</span><span class=\"n\">o</span><span class=\"p\">):</span><span class=\"w\"> </span><span class=\"nc\">undefined</span><span class=\"w\"> </span><span class=\"n\">reference</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">symbol</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"na\">gnu_get_libc_version</span><span class=\"o\">@@</span><span class=\"n\">GLIBC_2</span><span class=\"p\">.</span><span class=\"mf\">2.5</span><span class=\"o\">'</span>\n<span class=\"w\">          </span><span class=\"o\">/</span><span class=\"n\">nix</span><span class=\"o\">/</span><span class=\"n\">store</span><span class=\"o\">/</span><span class=\"n\">bgcaxhhxswzvmxjbbgvvaximm5hwghz1</span><span class=\"o\">-</span><span class=\"n\">binutils</span><span class=\"o\">-</span><span class=\"mf\">2.41</span><span class=\"o\">/</span><span class=\"n\">bin</span><span class=\"o\">/</span><span class=\"n\">ld</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">nix</span><span class=\"o\">/</span><span class=\"n\">store</span><span class=\"o\">/</span><span class=\"n\">k7zgvzp2r31zkg9xqgjim7mbknryv6bs</span><span class=\"o\">-</span><span class=\"n\">glibc</span><span class=\"o\">-</span><span class=\"mf\">2.39</span><span class=\"o\">-</span><span class=\"mi\">52</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"o\">/</span><span class=\"n\">libc</span><span class=\"p\">.</span><span class=\"n\">so</span><span class=\"p\">.</span><span class=\"mi\">6</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">error</span><span class=\"w\"> </span><span class=\"n\">adding</span><span class=\"w\"> </span><span class=\"n\">symbols</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">DSO</span><span class=\"w\"> </span><span class=\"n\">missing</span><span class=\"w\"> </span><span class=\"n\">from</span><span class=\"w\"> </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"n\">line</span>\n<span class=\"w\">          </span><span class=\"n\">collect2</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">error</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">ld</span><span class=\"w\"> </span><span class=\"n\">returned</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">exit</span><span class=\"w\"> </span><span class=\"n\">status</span>\n</code></pre></div>\n<p>I'm all in on changing our build setup, but first I'd really like to know what is the recommended setup with musl? What we see with wasmtime is the added build param to include libm really started causing trouble. Without having that include, the compilation works just fine.<br>\n</p>\n</blockquote>",
        "id": 450169600,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1720530879
    },
    {
        "content": "<p>pimeys edited a <a href=\"https://github.com/bytecodealliance/wasmtime/issues/8898#issuecomment-2217715031\">comment</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/8898\">issue #8898</a>:</p>\n<blockquote>\n<p>Hey @alexcrichton, is there some documentation how exactly the static musl compilation of a Rust project with C dependencies should look like? In general everybody seems to say you _just_ add a target with rustup and add the target to the cargo cli params. This has worked in the past eight years I've been working with Rust quite well. Now, when changing the  <code>CARGO_TARGET_X86_64_UNKNOWN_LINUX_MUSL_LINKER</code> to <code>musl-gcc</code>, immediately when getting a crate depending on libc we get:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">error</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">linking</span><span class=\"w\"> </span><span class=\"n\">with</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">cc</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">failed</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">exit</span><span class=\"w\"> </span><span class=\"n\">status</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"w\">  </span><span class=\"o\">|</span>\n<span class=\"w\">  </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">note</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">LC_ALL</span><span class=\"o\">=</span><span class=\"s\">\"C\"</span><span class=\"w\"> </span><span class=\"n\">PATH</span><span class=\"o\">=</span><span class=\"s\">\"/home/pimeys/.rustup/toolchains/1.79.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/bin:/home/pimeys/code/grafbase/grafbase/cli/.cargo/bin:/home/pimeys/code/grafbase/grafbase/node_modules/.bin:/nix/store/628y2lfy59bz200rcpbrh9sc2p9v83dm-cargo-insta-1.33.0/bin:/nix/store/vcpa0lb46lyk6afvaj1bqk6z3sayz4ak-cargo-nextest-0.9.72/bin:/nix/store/pxnxx19lr32mqgxkpsz4h7qixzyd84q8-cargo-component-0.13.2/bin:/nix/store/9dna4y1s34nv8glc6d7pkp3a0a9v6ijr-hey-0.1.4/bin:/nix/store/z8lzlvwbygb865qx25wrvxpfa9x8k81i-cargo-bloat-0.12.1/bin:/nix/store/fdg2c6w444j2718mi6q88n5g4lap51pa-cargo-make-0.37.12/bin:/nix/store/q0v146ks60hyw0lc9z91gg7b991rsvys-cargo-release-0.25.0/bin:/nix/store/gfsnb85cmpavq0qkxl0k62jrxmvrriz8-npm-10.8.1/bin:/nix/store/kkkk3zjfa8nm6ghdd1rpdbavzvlyixcy-semver-7.6.2/bin:/nix/store/gcsghgcyax8ri9z9hif5cgqzqvq2dib0-sd-1.0.0/bin:/nix/store/6g9n96qf1yx139xklnmy3v4xhjvjgsji-nodejs-20.12.2/bin:/nix/store/v3ws3vn47r0lm16rjr6yriq6ywv4xvwv-prettier-3.3.0/bin:/nix/store/3ws1qnjgq1rbxs96q67php6i8aygcxgg-bun-1.1.10/bin:/nix/store/qannz09m66qpcy3ny1f4nkl4ql0g71ks-openssl-3.0.13-bin/bin:/nix/store/zdvrzlvzbn9ymb0z8na50w995j8np16z-pkg-config-wrapper-0.29.2/bin:/nix/store/q1nssraba326p2kp6627hldd2bhg254c-cmake-3.29.2/bin:/nix/store/y74bzy6hjnc2n5d3hgq309imwfa0fpw4-rustup-1.26.0/bin:/nix/store/yrmlzr241pa9irf54fslilijnwv664c6-musl-1.2.3-dev/bin:/nix/store/bqjb40djywqk5n4dfzs5babpz7mycz04-musl-1.2.3-bin/bin:/nix/store/s25mgibyiwc2ahwpz2pbvdpj4vvngsva-pnpm-9.1.1/bin:/nix/store/k0d34jsjxzr7mg1c02vvbr616rb1m8nq-yarn-1.22.22/bin:/nix/store/hv6lq8yxrk5cb24147qaakp8isqq4pd9-cargo-about-0.6.2/bin:/nix/store/nbad47q0m0m9c5xid7zh05hiknwircbp-patchelf-0.15.0/bin:/nix/store/9bv7dcvmfcjnmg5mnqwqlq2wxfn8d7yi-gcc-wrapper-13.2.0/bin:/nix/store/14c6s4xzhy14i2b05s00rjns2j93gzz4-gcc-13.2.0/bin:/nix/store/c2i631h8i5vcs1sqifwxfsazhwrg6wr5-glibc-2.39-52-bin/bin:/nix/store/php4qidg2bxzmm79vpri025bqi0fa889-coreutils-9.5/bin:/nix/store/kln7kinji3b7sz8r50h4gn9yy6k1js9a-binutils-wrapper-2.41/bin:/nix/store/bgcaxhhxswzvmxjbbgvvaximm5hwghz1-binutils-2.41/bin:/nix/store/php4qidg2bxzmm79vpri025bqi0fa889-coreutils-9.5/bin:/nix/store/jjcsr5gs4qanf7ln5c6wgcq4sn75a978-findutils-4.9.0/bin:/nix/store/i34mknsjgrfyy71k2h79gda0bvagzc2j-diffutils-3.10/bin:/nix/store/5zjms21vpxlkbc0qyl5pmj2sidfmzmd7-gnused-4.9/bin:/nix/store/28gpmx3z6ss3znd7fhmrzmvk3x5lnfbk-gnugrep-3.11/bin:/nix/store/8vvkbgmnin1x2jkp7wcb2zg1p0vc4ks9-gawk-5.2.2/bin:/nix/store/rik7p68cq7yzlj5pmfpf4yv6jnrpvlgf-gnutar-1.35/bin:/nix/store/j5chw7v1x3vlmf3wmdpdb5gwh9hl0b80-gzip-1.13/bin:/nix/store/mxcq77rlan82dzpv3cgj0fh6qvv8ncil-bzip2-1.0.8-bin/bin:/nix/store/cdzpn0rdq810aknww3w9fy3wmw9ixr66-gnumake-4.4.1/bin:/nix/store/306znyj77fv49kwnkpxmb0j2znqpa8bj-bash-5.2p26/bin:/nix/store/0lfxbmchigx9vs9qmrlbahcy6nxwfnj1-patch-2.7.6/bin:/nix/store/6i4xxaa812vsbli9jkq4mksdddrk27lw-xz-5.4.6-bin/bin:/nix/store/xx7x1dwybpssfhq8yikvzz38bh3yrq97-file-5.45/bin:/home/pimeys/code/grafbase/grafbase/.direnv/bin:/home/pimeys/.cargo/bin:/home/pimeys/.local/bin:/home/pimeys/.atuin/bin:/run/wrappers/bin:/home/pimeys/.nix-profile/bin:/nix/profile/bin:/home/pimeys/.local/state/nix/profile/bin:/etc/profiles/per-user/pimeys/bin:/nix/var/nix/profiles/default/bin:/run/current-system/sw/bin\"</span><span class=\"w\"> </span><span class=\"n\">VSLANG</span><span class=\"o\">=</span><span class=\"s\">\"1033\"</span><span class=\"w\"> </span><span class=\"s\">\"cc\"</span><span class=\"w\"> </span><span class=\"s\">\"-m64\"</span><span class=\"w\"> </span><span class=\"s\">\"/tmp/rustcmngWD1/symbols.o\"</span><span class=\"w\"> </span><span class=\"s\">\"/home/pimeys/code/grafbase/grafbase/target/release/build/serde-7224d35ce8b6f84a/build_script_build-7224d35ce8b6f84a.build_script_build.6d0fdb83d6651bae-cgu.0.rcgu.o\"</span><span class=\"w\"> </span><span class=\"s\">\"/home/pimeys/code/grafbase/grafbase/target/release/build/serde-7224d35ce8b6f84a/build_script_build-7224d35ce8b6f84a.441cvjjahr7ngc3d.rcgu.o\"</span><span class=\"w\"> </span><span class=\"s\">\"-Wl,--as-needed\"</span><span class=\"w\"> </span><span class=\"s\">\"-L\"</span><span class=\"w\"> </span><span class=\"s\">\"/home/pimeys/code/grafbase/grafbase/target/release/deps\"</span><span class=\"w\"> </span><span class=\"s\">\"-L\"</span><span class=\"w\"> </span><span class=\"s\">\"/home/pimeys/.rustup/toolchains/1.79.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib\"</span><span class=\"w\"> </span><span class=\"s\">\"-Wl,-Bstatic\"</span><span class=\"w\"> </span><span class=\"s\">\"/home/pimeys/.rustup/toolchains/1.79.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libstd-d5189b81a4fa4d36.rlib\"</span><span class=\"w\"> </span><span class=\"s\">\"/home/pimeys/.rustup/toolchains/1.79.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libpanic_unwind-6a4779412a873200.rlib\"</span><span class=\"w\"> </span><span class=\"s\">\"/home/pimeys/.rustup/toolchains/1.79.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libobject-c88c426dd6780435.rlib\"</span><span class=\"w\"> </span><span class=\"s\">\"/home/pimeys/.rustup/toolchains/1.79.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libmemchr-e74540b31113a555.rlib\"</span><span class=\"w\"> </span><span class=\"s\">\"/home/pimeys/.rustup/toolchains/1.79.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libaddr2line-8751b61bd13c15cf.rlib\"</span><span class=\"w\"> </span><span class=\"s\">\"/home/pimeys/.rustup/toolchains/1.79.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libgimli-a8b99dba9f449259.rlib\"</span><span class=\"w\"> </span><span class=\"s\">\"/home/pimeys/.rustup/toolchains/1.79.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/librustc_demangle-f0068d76172a0372.rlib\"</span><span class=\"w\"> </span><span class=\"s\">\"/home/pimeys/.rustup/toolchains/1.79.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libstd_detect-c16dfaf47799564e.rlib\"</span><span class=\"w\"> </span><span class=\"s\">\"/home/pimeys/.rustup/toolchains/1.79.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libhashbrown-bfa26dd63e299db5.rlib\"</span><span class=\"w\"> </span><span class=\"s\">\"/home/pimeys/.rustup/toolchains/1.79.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/librustc_std_workspace_alloc-75a2330a693e738f.rlib\"</span><span class=\"w\"> </span><span class=\"s\">\"/home/pimeys/.rustup/toolchains/1.79.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libminiz_oxide-76779dce1f7ab63d.rlib\"</span><span class=\"w\"> </span><span class=\"s\">\"/home/pimeys/.rustup/toolchains/1.79.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libadler-01c5cc588623cb35.rlib\"</span><span class=\"w\"> </span><span class=\"s\">\"/home/pimeys/.rustup/toolchains/1.79.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libunwind-07bb9745ec737292.rlib\"</span><span class=\"w\"> </span><span class=\"s\">\"/home/pimeys/.rustup/toolchains/1.79.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libcfg_if-6eacdcc91004cefb.rlib\"</span><span class=\"w\"> </span><span class=\"s\">\"/home/pimeys/.rustup/toolchains/1.79.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/liblibc-ae2488b58226c836.rlib\"</span><span class=\"w\"> </span><span class=\"s\">\"/home/pimeys/.rustup/toolchains/1.79.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/liballoc-52acaddcaaba04c6.rlib\"</span><span class=\"w\"> </span><span class=\"s\">\"/home/pimeys/.rustup/toolchains/1.79.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/librustc_std_workspace_core-326b78eac9ecd050.rlib\"</span><span class=\"w\"> </span><span class=\"s\">\"/home/pimeys/.rustup/toolchains/1.79.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libcore-307ebf19f0f13d30.rlib\"</span><span class=\"w\"> </span><span class=\"s\">\"/home/pimeys/.rustup/toolchains/1.79.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libcompiler_builtins-d9076ee5964191bf.rlib\"</span><span class=\"w\"> </span><span class=\"s\">\"-Wl,-Bdynamic\"</span><span class=\"w\"> </span><span class=\"s\">\"-lgcc_s\"</span><span class=\"w\"> </span><span class=\"s\">\"-lutil\"</span><span class=\"w\"> </span><span class=\"s\">\"-lrt\"</span><span class=\"w\"> </span><span class=\"s\">\"-lpthread\"</span><span class=\"w\"> </span><span class=\"s\">\"-lm\"</span><span class=\"w\"> </span><span class=\"s\">\"-ldl\"</span><span class=\"w\"> </span><span class=\"s\">\"-lc\"</span><span class=\"w\"> </span><span class=\"s\">\"-Wl,--eh-frame-hdr\"</span><span class=\"w\"> </span><span class=\"s\">\"-Wl,-z,noexecstack\"</span><span class=\"w\"> </span><span class=\"s\">\"-L\"</span><span class=\"w\"> </span><span class=\"s\">\"/home/pimeys/.rustup/toolchains/1.79.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib\"</span><span class=\"w\"> </span><span class=\"s\">\"-o\"</span><span class=\"w\"> </span><span class=\"s\">\"/home/pimeys/code/grafbase/grafbase/target/release/build/serde-7224d35ce8b6f84a/build_script_build-7224d35ce8b6f84a\"</span><span class=\"w\"> </span><span class=\"s\">\"-Wl,--gc-sections\"</span><span class=\"w\"> </span><span class=\"s\">\"-pie\"</span><span class=\"w\"> </span><span class=\"s\">\"-Wl,-z,relro,-z,now\"</span><span class=\"w\"> </span><span class=\"s\">\"-Wl,--strip-all\"</span><span class=\"w\"> </span><span class=\"s\">\"-nodefaultlibs\"</span>\n<span class=\"w\">  </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">note</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">nix</span><span class=\"o\">/</span><span class=\"n\">store</span><span class=\"o\">/</span><span class=\"n\">bgcaxhhxswzvmxjbbgvvaximm5hwghz1</span><span class=\"o\">-</span><span class=\"n\">binutils</span><span class=\"o\">-</span><span class=\"mf\">2.41</span><span class=\"o\">/</span><span class=\"n\">bin</span><span class=\"o\">/</span><span class=\"n\">ld</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">pimeys</span><span class=\"o\">/</span><span class=\"p\">.</span><span class=\"n\">rustup</span><span class=\"o\">/</span><span class=\"n\">toolchains</span><span class=\"o\">/</span><span class=\"mf\">1.79.0</span><span class=\"o\">-</span><span class=\"n\">x86_64</span><span class=\"o\">-</span><span class=\"n\">unknown</span><span class=\"o\">-</span><span class=\"n\">linux</span><span class=\"o\">-</span><span class=\"n\">gnu</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"o\">/</span><span class=\"n\">rustlib</span><span class=\"o\">/</span><span class=\"n\">x86_64</span><span class=\"o\">-</span><span class=\"n\">unknown</span><span class=\"o\">-</span><span class=\"n\">linux</span><span class=\"o\">-</span><span class=\"n\">gnu</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"o\">/</span><span class=\"n\">libstd</span><span class=\"o\">-</span><span class=\"n\">d5189b81a4fa4d36</span><span class=\"p\">.</span><span class=\"n\">rlib</span><span class=\"p\">(</span><span class=\"n\">std</span><span class=\"o\">-</span><span class=\"n\">d5189b81a4fa4d36</span><span class=\"p\">.</span><span class=\"n\">std</span><span class=\"p\">.</span><span class=\"mi\">3</span><span class=\"n\">c8ba8ebcf555201</span><span class=\"o\">-</span><span class=\"n\">cgu</span><span class=\"p\">.</span><span class=\"mf\">0.</span><span class=\"n\">rcgu</span><span class=\"p\">.</span><span class=\"n\">o</span><span class=\"p\">):</span><span class=\"w\"> </span><span class=\"nc\">undefined</span><span class=\"w\"> </span><span class=\"n\">reference</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">symbol</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"na\">gnu_get_libc_version</span><span class=\"o\">@@</span><span class=\"n\">GLIBC_2</span><span class=\"p\">.</span><span class=\"mf\">2.5</span><span class=\"o\">'</span>\n<span class=\"w\">          </span><span class=\"o\">/</span><span class=\"n\">nix</span><span class=\"o\">/</span><span class=\"n\">store</span><span class=\"o\">/</span><span class=\"n\">bgcaxhhxswzvmxjbbgvvaximm5hwghz1</span><span class=\"o\">-</span><span class=\"n\">binutils</span><span class=\"o\">-</span><span class=\"mf\">2.41</span><span class=\"o\">/</span><span class=\"n\">bin</span><span class=\"o\">/</span><span class=\"n\">ld</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">nix</span><span class=\"o\">/</span><span class=\"n\">store</span><span class=\"o\">/</span><span class=\"n\">k7zgvzp2r31zkg9xqgjim7mbknryv6bs</span><span class=\"o\">-</span><span class=\"n\">glibc</span><span class=\"o\">-</span><span class=\"mf\">2.39</span><span class=\"o\">-</span><span class=\"mi\">52</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"o\">/</span><span class=\"n\">libc</span><span class=\"p\">.</span><span class=\"n\">so</span><span class=\"p\">.</span><span class=\"mi\">6</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">error</span><span class=\"w\"> </span><span class=\"n\">adding</span><span class=\"w\"> </span><span class=\"n\">symbols</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">DSO</span><span class=\"w\"> </span><span class=\"n\">missing</span><span class=\"w\"> </span><span class=\"n\">from</span><span class=\"w\"> </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"n\">line</span>\n<span class=\"w\">          </span><span class=\"n\">collect2</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">error</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">ld</span><span class=\"w\"> </span><span class=\"n\">returned</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">exit</span><span class=\"w\"> </span><span class=\"n\">status</span>\n</code></pre></div>\n<p>I'm all in on changing our build setup, but first I'd really like to know what is the recommended setup with musl? What we see with wasmtime is the added build param to include libm really started causing trouble. Without having that include, the compilation works just fine.<br>\n</p>\n</blockquote>",
        "id": 450169665,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1720530901
    },
    {
        "content": "<p>pimeys edited a <a href=\"https://github.com/bytecodealliance/wasmtime/issues/8898#issuecomment-2217715031\">comment</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/8898\">issue #8898</a>:</p>\n<blockquote>\n<p>Hey @alexcrichton, is there some documentation how exactly the static musl compilation of a Rust project with C dependencies should look like? In general everybody seems to say you _just_ add a target with rustup and add the target to the cargo cli params. This has worked in the past eight years I've been working with Rust quite well. Now, when changing the  <code>CARGO_TARGET_X86_64_UNKNOWN_LINUX_MUSL_LINKER</code> to <code>musl-gcc</code>, immediately when getting a crate depending on libc we get:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">error</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">linking</span><span class=\"w\"> </span><span class=\"n\">with</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">cc</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">failed</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">exit</span><span class=\"w\"> </span><span class=\"n\">status</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"w\">  </span><span class=\"o\">|</span>\n<span class=\"w\">  </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">note</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">LC_ALL</span><span class=\"o\">=</span><span class=\"s\">\"C\"</span><span class=\"w\"> </span><span class=\"n\">PATH</span><span class=\"o\">=</span><span class=\"s\">\"/home/pimeys/.rustup/toolchains/1.79.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/bin:/home/pimeys/code/grafbase/grafbase/cli/.cargo/bin:/home/pimeys/code/grafbase/grafbase/node_modules/.bin:/nix/store/628y2lfy59bz200rcpbrh9sc2p9v83dm-cargo-insta-1.33.0/bin:/nix/store/vcpa0lb46lyk6afvaj1bqk6z3sayz4ak-cargo-nextest-0.9.72/bin:/nix/store/pxnxx19lr32mqgxkpsz4h7qixzyd84q8-cargo-component-0.13.2/bin:/nix/store/9dna4y1s34nv8glc6d7pkp3a0a9v6ijr-hey-0.1.4/bin:/nix/store/z8lzlvwbygb865qx25wrvxpfa9x8k81i-cargo-bloat-0.12.1/bin:/nix/store/fdg2c6w444j2718mi6q88n5g4lap51pa-cargo-make-0.37.12/bin:/nix/store/q0v146ks60hyw0lc9z91gg7b991rsvys-cargo-release-0.25.0/bin:/nix/store/gfsnb85cmpavq0qkxl0k62jrxmvrriz8-npm-10.8.1/bin:/nix/store/kkkk3zjfa8nm6ghdd1rpdbavzvlyixcy-semver-7.6.2/bin:/nix/store/gcsghgcyax8ri9z9hif5cgqzqvq2dib0-sd-1.0.0/bin:/nix/store/6g9n96qf1yx139xklnmy3v4xhjvjgsji-nodejs-20.12.2/bin:/nix/store/v3ws3vn47r0lm16rjr6yriq6ywv4xvwv-prettier-3.3.0/bin:/nix/store/3ws1qnjgq1rbxs96q67php6i8aygcxgg-bun-1.1.10/bin:/nix/store/qannz09m66qpcy3ny1f4nkl4ql0g71ks-openssl-3.0.13-bin/bin:/nix/store/zdvrzlvzbn9ymb0z8na50w995j8np16z-pkg-config-wrapper-0.29.2/bin:/nix/store/q1nssraba326p2kp6627hldd2bhg254c-cmake-3.29.2/bin:/nix/store/y74bzy6hjnc2n5d3hgq309imwfa0fpw4-rustup-1.26.0/bin:/nix/store/yrmlzr241pa9irf54fslilijnwv664c6-musl-1.2.3-dev/bin:/nix/store/bqjb40djywqk5n4dfzs5babpz7mycz04-musl-1.2.3-bin/bin:/nix/store/s25mgibyiwc2ahwpz2pbvdpj4vvngsva-pnpm-9.1.1/bin:/nix/store/k0d34jsjxzr7mg1c02vvbr616rb1m8nq-yarn-1.22.22/bin:/nix/store/hv6lq8yxrk5cb24147qaakp8isqq4pd9-cargo-about-0.6.2/bin:/nix/store/nbad47q0m0m9c5xid7zh05hiknwircbp-patchelf-0.15.0/bin:/nix/store/9bv7dcvmfcjnmg5mnqwqlq2wxfn8d7yi-gcc-wrapper-13.2.0/bin:/nix/store/14c6s4xzhy14i2b05s00rjns2j93gzz4-gcc-13.2.0/bin:/nix/store/c2i631h8i5vcs1sqifwxfsazhwrg6wr5-glibc-2.39-52-bin/bin:/nix/store/php4qidg2bxzmm79vpri025bqi0fa889-coreutils-9.5/bin:/nix/store/kln7kinji3b7sz8r50h4gn9yy6k1js9a-binutils-wrapper-2.41/bin:/nix/store/bgcaxhhxswzvmxjbbgvvaximm5hwghz1-binutils-2.41/bin:/nix/store/php4qidg2bxzmm79vpri025bqi0fa889-coreutils-9.5/bin:/nix/store/jjcsr5gs4qanf7ln5c6wgcq4sn75a978-findutils-4.9.0/bin:/nix/store/i34mknsjgrfyy71k2h79gda0bvagzc2j-diffutils-3.10/bin:/nix/store/5zjms21vpxlkbc0qyl5pmj2sidfmzmd7-gnused-4.9/bin:/nix/store/28gpmx3z6ss3znd7fhmrzmvk3x5lnfbk-gnugrep-3.11/bin:/nix/store/8vvkbgmnin1x2jkp7wcb2zg1p0vc4ks9-gawk-5.2.2/bin:/nix/store/rik7p68cq7yzlj5pmfpf4yv6jnrpvlgf-gnutar-1.35/bin:/nix/store/j5chw7v1x3vlmf3wmdpdb5gwh9hl0b80-gzip-1.13/bin:/nix/store/mxcq77rlan82dzpv3cgj0fh6qvv8ncil-bzip2-1.0.8-bin/bin:/nix/store/cdzpn0rdq810aknww3w9fy3wmw9ixr66-gnumake-4.4.1/bin:/nix/store/306znyj77fv49kwnkpxmb0j2znqpa8bj-bash-5.2p26/bin:/nix/store/0lfxbmchigx9vs9qmrlbahcy6nxwfnj1-patch-2.7.6/bin:/nix/store/6i4xxaa812vsbli9jkq4mksdddrk27lw-xz-5.4.6-bin/bin:/nix/store/xx7x1dwybpssfhq8yikvzz38bh3yrq97-file-5.45/bin:/home/pimeys/code/grafbase/grafbase/.direnv/bin:/home/pimeys/.cargo/bin:/home/pimeys/.local/bin:/home/pimeys/.atuin/bin:/run/wrappers/bin:/home/pimeys/.nix-profile/bin:/nix/profile/bin:/home/pimeys/.local/state/nix/profile/bin:/etc/profiles/per-user/pimeys/bin:/nix/var/nix/profiles/default/bin:/run/current-system/sw/bin\"</span><span class=\"w\"> </span><span class=\"n\">VSLANG</span><span class=\"o\">=</span><span class=\"s\">\"1033\"</span><span class=\"w\"> </span><span class=\"s\">\"cc\"</span><span class=\"w\"> </span><span class=\"s\">\"-m64\"</span><span class=\"w\"> </span><span class=\"s\">\"/tmp/rustcmngWD1/symbols.o\"</span><span class=\"w\"> </span><span class=\"s\">\"/home/pimeys/code/grafbase/grafbase/target/release/build/serde-7224d35ce8b6f84a/build_script_build-7224d35ce8b6f84a.build_script_build.6d0fdb83d6651bae-cgu.0.rcgu.o\"</span><span class=\"w\"> </span><span class=\"s\">\"/home/pimeys/code/grafbase/grafbase/target/release/build/serde-7224d35ce8b6f84a/build_script_build-7224d35ce8b6f84a.441cvjjahr7ngc3d.rcgu.o\"</span><span class=\"w\"> </span><span class=\"s\">\"-Wl,--as-needed\"</span><span class=\"w\"> </span><span class=\"s\">\"-L\"</span><span class=\"w\"> </span><span class=\"s\">\"/home/pimeys/code/grafbase/grafbase/target/release/deps\"</span><span class=\"w\"> </span><span class=\"s\">\"-L\"</span><span class=\"w\"> </span><span class=\"s\">\"/home/pimeys/.rustup/toolchains/1.79.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib\"</span><span class=\"w\"> </span><span class=\"s\">\"-Wl,-Bstatic\"</span><span class=\"w\"> </span><span class=\"s\">\"/home/pimeys/.rustup/toolchains/1.79.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libstd-d5189b81a4fa4d36.rlib\"</span><span class=\"w\"> </span><span class=\"s\">\"/home/pimeys/.rustup/toolchains/1.79.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libpanic_unwind-6a4779412a873200.rlib\"</span><span class=\"w\"> </span><span class=\"s\">\"/home/pimeys/.rustup/toolchains/1.79.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libobject-c88c426dd6780435.rlib\"</span><span class=\"w\"> </span><span class=\"s\">\"/home/pimeys/.rustup/toolchains/1.79.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libmemchr-e74540b31113a555.rlib\"</span><span class=\"w\"> </span><span class=\"s\">\"/home/pimeys/.rustup/toolchains/1.79.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libaddr2line-8751b61bd13c15cf.rlib\"</span><span class=\"w\"> </span><span class=\"s\">\"/home/pimeys/.rustup/toolchains/1.79.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libgimli-a8b99dba9f449259.rlib\"</span><span class=\"w\"> </span><span class=\"s\">\"/home/pimeys/.rustup/toolchains/1.79.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/librustc_demangle-f0068d76172a0372.rlib\"</span><span class=\"w\"> </span><span class=\"s\">\"/home/pimeys/.rustup/toolchains/1.79.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libstd_detect-c16dfaf47799564e.rlib\"</span><span class=\"w\"> </span><span class=\"s\">\"/home/pimeys/.rustup/toolchains/1.79.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libhashbrown-bfa26dd63e299db5.rlib\"</span><span class=\"w\"> </span><span class=\"s\">\"/home/pimeys/.rustup/toolchains/1.79.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/librustc_std_workspace_alloc-75a2330a693e738f.rlib\"</span><span class=\"w\"> </span><span class=\"s\">\"/home/pimeys/.rustup/toolchains/1.79.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libminiz_oxide-76779dce1f7ab63d.rlib\"</span><span class=\"w\"> </span><span class=\"s\">\"/home/pimeys/.rustup/toolchains/1.79.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libadler-01c5cc588623cb35.rlib\"</span><span class=\"w\"> </span><span class=\"s\">\"/home/pimeys/.rustup/toolchains/1.79.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libunwind-07bb9745ec737292.rlib\"</span><span class=\"w\"> </span><span class=\"s\">\"/home/pimeys/.rustup/toolchains/1.79.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libcfg_if-6eacdcc91004cefb.rlib\"</span><span class=\"w\"> </span><span class=\"s\">\"/home/pimeys/.rustup/toolchains/1.79.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/liblibc-ae2488b58226c836.rlib\"</span><span class=\"w\"> </span><span class=\"s\">\"/home/pimeys/.rustup/toolchains/1.79.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/liballoc-52acaddcaaba04c6.rlib\"</span><span class=\"w\"> </span><span class=\"s\">\"/home/pimeys/.rustup/toolchains/1.79.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/librustc_std_workspace_core-326b78eac9ecd050.rlib\"</span><span class=\"w\"> </span><span class=\"s\">\"/home/pimeys/.rustup/toolchains/1.79.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libcore-307ebf19f0f13d30.rlib\"</span><span class=\"w\"> </span><span class=\"s\">\"/home/pimeys/.rustup/toolchains/1.79.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libcompiler_builtins-d9076ee5964191bf.rlib\"</span><span class=\"w\"> </span><span class=\"s\">\"-Wl,-Bdynamic\"</span><span class=\"w\"> </span><span class=\"s\">\"-lgcc_s\"</span><span class=\"w\"> </span><span class=\"s\">\"-lutil\"</span><span class=\"w\"> </span><span class=\"s\">\"-lrt\"</span><span class=\"w\"> </span><span class=\"s\">\"-lpthread\"</span><span class=\"w\"> </span><span class=\"s\">\"-lm\"</span><span class=\"w\"> </span><span class=\"s\">\"-ldl\"</span><span class=\"w\"> </span><span class=\"s\">\"-lc\"</span><span class=\"w\"> </span><span class=\"s\">\"-Wl,--eh-frame-hdr\"</span><span class=\"w\"> </span><span class=\"s\">\"-Wl,-z,noexecstack\"</span><span class=\"w\"> </span><span class=\"s\">\"-L\"</span><span class=\"w\"> </span><span class=\"s\">\"/home/pimeys/.rustup/toolchains/1.79.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib\"</span><span class=\"w\"> </span><span class=\"s\">\"-o\"</span><span class=\"w\"> </span><span class=\"s\">\"/home/pimeys/code/grafbase/grafbase/target/release/build/serde-7224d35ce8b6f84a/build_script_build-7224d35ce8b6f84a\"</span><span class=\"w\"> </span><span class=\"s\">\"-Wl,--gc-sections\"</span><span class=\"w\"> </span><span class=\"s\">\"-pie\"</span><span class=\"w\"> </span><span class=\"s\">\"-Wl,-z,relro,-z,now\"</span><span class=\"w\"> </span><span class=\"s\">\"-Wl,--strip-all\"</span><span class=\"w\"> </span><span class=\"s\">\"-nodefaultlibs\"</span>\n<span class=\"w\">  </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">note</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">nix</span><span class=\"o\">/</span><span class=\"n\">store</span><span class=\"o\">/</span><span class=\"n\">bgcaxhhxswzvmxjbbgvvaximm5hwghz1</span><span class=\"o\">-</span><span class=\"n\">binutils</span><span class=\"o\">-</span><span class=\"mf\">2.41</span><span class=\"o\">/</span><span class=\"n\">bin</span><span class=\"o\">/</span><span class=\"n\">ld</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">pimeys</span><span class=\"o\">/</span><span class=\"p\">.</span><span class=\"n\">rustup</span><span class=\"o\">/</span><span class=\"n\">toolchains</span><span class=\"o\">/</span><span class=\"mf\">1.79.0</span><span class=\"o\">-</span><span class=\"n\">x86_64</span><span class=\"o\">-</span><span class=\"n\">unknown</span><span class=\"o\">-</span><span class=\"n\">linux</span><span class=\"o\">-</span><span class=\"n\">gnu</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"o\">/</span><span class=\"n\">rustlib</span><span class=\"o\">/</span><span class=\"n\">x86_64</span><span class=\"o\">-</span><span class=\"n\">unknown</span><span class=\"o\">-</span><span class=\"n\">linux</span><span class=\"o\">-</span><span class=\"n\">gnu</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"o\">/</span><span class=\"n\">libstd</span><span class=\"o\">-</span><span class=\"n\">d5189b81a4fa4d36</span><span class=\"p\">.</span><span class=\"n\">rlib</span><span class=\"p\">(</span><span class=\"n\">std</span><span class=\"o\">-</span><span class=\"n\">d5189b81a4fa4d36</span><span class=\"p\">.</span><span class=\"n\">std</span><span class=\"p\">.</span><span class=\"mi\">3</span><span class=\"n\">c8ba8ebcf555201</span><span class=\"o\">-</span><span class=\"n\">cgu</span><span class=\"p\">.</span><span class=\"mf\">0.</span><span class=\"n\">rcgu</span><span class=\"p\">.</span><span class=\"n\">o</span><span class=\"p\">):</span><span class=\"w\"> </span><span class=\"nc\">undefined</span><span class=\"w\"> </span><span class=\"n\">reference</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">symbol</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"na\">gnu_get_libc_version</span><span class=\"o\">@@</span><span class=\"n\">GLIBC_2</span><span class=\"p\">.</span><span class=\"mf\">2.5</span><span class=\"o\">'</span>\n<span class=\"w\">          </span><span class=\"o\">/</span><span class=\"n\">nix</span><span class=\"o\">/</span><span class=\"n\">store</span><span class=\"o\">/</span><span class=\"n\">bgcaxhhxswzvmxjbbgvvaximm5hwghz1</span><span class=\"o\">-</span><span class=\"n\">binutils</span><span class=\"o\">-</span><span class=\"mf\">2.41</span><span class=\"o\">/</span><span class=\"n\">bin</span><span class=\"o\">/</span><span class=\"n\">ld</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">nix</span><span class=\"o\">/</span><span class=\"n\">store</span><span class=\"o\">/</span><span class=\"n\">k7zgvzp2r31zkg9xqgjim7mbknryv6bs</span><span class=\"o\">-</span><span class=\"n\">glibc</span><span class=\"o\">-</span><span class=\"mf\">2.39</span><span class=\"o\">-</span><span class=\"mi\">52</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"o\">/</span><span class=\"n\">libc</span><span class=\"p\">.</span><span class=\"n\">so</span><span class=\"p\">.</span><span class=\"mi\">6</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">error</span><span class=\"w\"> </span><span class=\"n\">adding</span><span class=\"w\"> </span><span class=\"n\">symbols</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">DSO</span><span class=\"w\"> </span><span class=\"n\">missing</span><span class=\"w\"> </span><span class=\"n\">from</span><span class=\"w\"> </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"n\">line</span>\n<span class=\"w\">          </span><span class=\"n\">collect2</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">error</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">ld</span><span class=\"w\"> </span><span class=\"n\">returned</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">exit</span><span class=\"w\"> </span><span class=\"n\">status</span>\n</code></pre></div>\n<p>I'm all in on changing our build setup (probably even writing a blog post about that), but first I'd really like to know what is the recommended setup with musl? What we see with wasmtime is the added build param to include libm really started causing trouble. Without having that include, the compilation works just fine.<br>\n</p>\n</blockquote>",
        "id": 450169754,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1720530929
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/8898#issuecomment-2217867966\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/8898\">issue #8898</a>:</p>\n<blockquote>\n<p>Unfortunately the linker configuration didn't seem to apply, in the error message you can see it's still executing <code>cc</code>. The solution is to get that plumbed correctly so rustc invokes <code>musl-gcc</code> as a linker instead of <code>cc</code>.</p>\n<blockquote>\n<p>What we see with wasmtime is the added build param to include libm really started causing trouble</p>\n</blockquote>\n<p>Cross compliation is not always easy or obvious. If your setup was executing <code>cc</code> before then it was incorrect. If it happened to work without <code>-lm</code> then that's basically just by luck. Cross compilation requires understanding error messages that are totally unrelated to the actual problem at hand unfortunately, such as this one.</p>\n</blockquote>",
        "id": 450185557,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1720534761
    },
    {
        "content": "<p>pimeys <a href=\"https://github.com/bytecodealliance/wasmtime/issues/8898#issuecomment-2218152134\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/8898\">issue #8898</a>:</p>\n<blockquote>\n<p>Ok, fair. I think the plan is to just utilize Alpine and not bother with cross compilation. Did a full build using docker for the project and it spat out a fully functional binary without any issues.</p>\n</blockquote>",
        "id": 450220889,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1720542841
    }
]