[
    {
        "content": "<p>bjorn3 <a href=\"https://github.com/bytecodealliance/wasmtime/issues/1109#issuecomment-772680495\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/1109\">Issue #1109</a>:</p>\n<blockquote>\n<p>In new backend framework <code>fold_redundant_jumps</code> doesn't exist.</p>\n</blockquote>",
        "id": 225048974,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1612373011
    },
    {
        "content": "<p>cfallin closed <a href=\"https://github.com/bytecodealliance/wasmtime/issues/1109\">Issue #1109</a>:</p>\n<blockquote>\n<p>With this testcase:</p>\n<div class=\"codehilite\" data-code-language=\"wasm\"><pre><span></span><code>(module\n  (func $dummy)\n\n  (func (export \"as-binary-operand\") (result i32)\n    (i32.mul\n      (loop (result i32) (i32.const 3))\n      (loop (result i32) (i32.const 4))\n    )\n  )\n)\n</code></pre></div>\n<p>This command:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">clif</span><span class=\"o\">-</span><span class=\"n\">util</span><span class=\"w\"> </span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">target</span><span class=\"w\"> </span><span class=\"n\">x86_64</span><span class=\"w\"> </span><span class=\"n\">test</span><span class=\"p\">.</span><span class=\"n\">wast</span><span class=\"w\"></span>\n</code></pre></div>\n<p>gets this error:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"n\">u0</span>:<span class=\"mi\">1</span><span class=\"p\">(</span><span class=\"kt\">i64</span><span class=\"w\"> </span><span class=\"n\">vmctx</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"o\">%</span><span class=\"n\">rdi</span><span class=\"p\">],</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"w\"> </span><span class=\"n\">fp</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"o\">%</span><span class=\"n\">rbp</span><span class=\"p\">])</span><span class=\"w\"> </span>-&gt; <span class=\"kt\">i32</span> <span class=\"p\">[</span><span class=\"o\">%</span><span class=\"n\">rax</span><span class=\"p\">],</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"w\"> </span><span class=\"n\">fp</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"o\">%</span><span class=\"n\">rbp</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"n\">system_v</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">ss0</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">incoming_arg</span><span class=\"w\"> </span><span class=\"mi\">16</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">offset</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"mi\">16</span><span class=\"w\"></span>\n\n<span class=\"w\">                                </span><span class=\"n\">ebb0</span><span class=\"p\">(</span><span class=\"n\">v0</span>: <span class=\"kt\">i64</span> <span class=\"p\">[</span><span class=\"o\">%</span><span class=\"n\">rdi</span><span class=\"p\">],</span><span class=\"w\"> </span><span class=\"n\">v7</span>: <span class=\"kt\">i64</span> <span class=\"p\">[</span><span class=\"o\">%</span><span class=\"n\">rbp</span><span class=\"p\">])</span>:\n<span class=\"p\">[</span><span class=\"n\">RexOp1pushq</span><span class=\"err\">#</span><span class=\"mi\">50</span><span class=\"p\">]</span><span class=\"w\">                    </span><span class=\"n\">x86_push</span><span class=\"w\"> </span><span class=\"n\">v7</span><span class=\"w\"></span>\n<span class=\"p\">[</span><span class=\"n\">RexOp1copysp</span><span class=\"err\">#</span><span class=\"mi\">8089</span><span class=\"p\">]</span><span class=\"w\">                 </span><span class=\"n\">copy_special</span><span class=\"w\"> </span><span class=\"o\">%</span><span class=\"n\">rsp</span><span class=\"w\"> </span>-&gt; <span class=\"o\">%</span><span class=\"n\">rbp</span><span class=\"w\"></span>\n<span class=\"o\">@</span><span class=\"mi\">0036</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"o\">-</span><span class=\"p\">]</span><span class=\"w\">                           </span><span class=\"n\">fallthrough</span><span class=\"w\"> </span><span class=\"n\">ebb2</span><span class=\"w\"></span>\n\n<span class=\"w\">                                </span><span class=\"n\">ebb2</span>:\n<span class=\"o\">@</span><span class=\"mi\">0038</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">RexOp1pu_id</span><span class=\"err\">#</span><span class=\"n\">b8</span><span class=\"p\">,</span><span class=\"o\">%</span><span class=\"n\">rax</span><span class=\"p\">]</span><span class=\"w\">         </span><span class=\"n\">v3</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">iconst</span><span class=\"p\">.</span><span class=\"kt\">i32</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"></span>\n<span class=\"o\">@</span><span class=\"mi\">003</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"o\">-</span><span class=\"p\">]</span><span class=\"w\">                           </span><span class=\"n\">fallthrough</span><span class=\"w\"> </span><span class=\"n\">ebb4</span><span class=\"w\"></span>\n\n<span class=\"w\">                                </span><span class=\"n\">ebb4</span>:\n<span class=\"o\">@</span><span class=\"mi\">003</span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">RexOp1pu_id</span><span class=\"err\">#</span><span class=\"n\">b8</span><span class=\"p\">,</span><span class=\"o\">%</span><span class=\"n\">rcx</span><span class=\"p\">]</span><span class=\"w\">         </span><span class=\"n\">v5</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">iconst</span><span class=\"p\">.</span><span class=\"kt\">i32</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"w\"></span>\n<span class=\"o\">@</span><span class=\"mi\">003</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"o\">-</span><span class=\"p\">]</span><span class=\"w\">                           </span><span class=\"n\">fallthrough</span><span class=\"w\"> </span><span class=\"n\">ebb5</span><span class=\"p\">(</span><span class=\"n\">v5</span><span class=\"p\">)</span><span class=\"w\"></span>\n\n<span class=\"w\">                                </span><span class=\"n\">ebb5</span><span class=\"p\">(</span><span class=\"n\">v4</span>: <span class=\"kt\">i32</span> <span class=\"p\">[</span><span class=\"o\">%</span><span class=\"n\">rcx</span><span class=\"p\">])</span>:\n<span class=\"o\">@</span><span class=\"mi\">0040</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">RexOp2rrx</span><span class=\"err\">#</span><span class=\"mi\">4</span><span class=\"n\">af</span><span class=\"p\">,</span><span class=\"o\">%</span><span class=\"n\">rax</span><span class=\"p\">]</span><span class=\"w\">          </span><span class=\"n\">v6</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">imul</span><span class=\"p\">.</span><span class=\"kt\">i32</span><span class=\"w\"> </span><span class=\"n\">v2</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v4</span><span class=\"w\"></span>\n<span class=\"p\">;</span><span class=\"o\">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span class=\"w\"></span>\n<span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">error</span>: <span class=\"nc\">inst6</span>: <span class=\"nc\">v2</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">defined</span><span class=\"w\"> </span><span class=\"n\">by</span><span class=\"w\"> </span><span class=\"n\">ebb3</span><span class=\"w\"> </span><span class=\"n\">which</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">layout</span><span class=\"w\"></span>\n\n<span class=\"o\">@</span><span class=\"mi\">0041</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"o\">-</span><span class=\"p\">]</span><span class=\"w\">                           </span><span class=\"n\">fallthrough</span><span class=\"w\"> </span><span class=\"n\">ebb1</span><span class=\"p\">(</span><span class=\"n\">v6</span><span class=\"p\">)</span><span class=\"w\"></span>\n\n<span class=\"w\">                                </span><span class=\"n\">ebb1</span><span class=\"p\">(</span><span class=\"n\">v1</span>: <span class=\"kt\">i32</span> <span class=\"p\">[</span><span class=\"o\">%</span><span class=\"n\">rax</span><span class=\"p\">])</span>:\n<span class=\"p\">[</span><span class=\"n\">RexOp1popq</span><span class=\"err\">#</span><span class=\"mi\">58</span><span class=\"p\">,</span><span class=\"o\">%</span><span class=\"n\">rbp</span><span class=\"p\">]</span><span class=\"w\">                </span><span class=\"n\">v8</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">x86_pop</span><span class=\"p\">.</span><span class=\"kt\">i64</span><span class=\"w\"></span>\n<span class=\"o\">@</span><span class=\"mi\">0041</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">Op1ret</span><span class=\"err\">#</span><span class=\"n\">c3</span><span class=\"p\">]</span><span class=\"w\">                   </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">v1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v8</span><span class=\"w\"></span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n</code></pre></div>\n<p>Bisection points to 57fa45c8520110ee7e9b216538f1990376aed0e9, and the error goes away when I comment out the call to <code>fold_redundant_jumps</code>.</p>\n</blockquote>",
        "id": 225056943,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1612376143
    }
]