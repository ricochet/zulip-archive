[
    {
        "content": "<p>afonso360 opened <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4406\">issue #4406</a>:</p>\n<blockquote>\n<p><span aria-label=\"wave\" class=\"emoji emoji-1f44b\" role=\"img\" title=\"wave\">:wave:</span> Hey,</p>\n<p>As a followup to #4403, it looks like we are wrongly lowering <code>icmp of</code> and <code>icmp nof</code> on the <code>x86_64</code> backend for <code>i128</code> values.</p>\n<h3><code>.clif</code> Test Case</h3>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">test</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"></span>\n<span class=\"n\">set</span><span class=\"w\"> </span><span class=\"n\">enable_llvm_abi_extensions</span><span class=\"o\">=</span><span class=\"kc\">true</span><span class=\"w\"></span>\n<span class=\"n\">target</span><span class=\"w\"> </span><span class=\"n\">x86_64</span><span class=\"w\"></span>\n\n<span class=\"n\">function</span><span class=\"w\"> </span><span class=\"o\">%</span><span class=\"n\">icmp_of_i128</span><span class=\"p\">(</span><span class=\"kt\">i128</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">i128</span><span class=\"p\">)</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">b1</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"n\">block0</span><span class=\"p\">(</span><span class=\"n\">v0</span>: <span class=\"kt\">i128</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v1</span>: <span class=\"kt\">i128</span><span class=\"p\">)</span>:\n  <span class=\"nc\">v2</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">icmp</span><span class=\"p\">.</span><span class=\"kt\">i128</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v1</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">v2</span><span class=\"w\"></span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n<span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">run</span>: <span class=\"o\">%</span><span class=\"n\">icmp_of_i128</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"kc\">false</span><span class=\"w\"></span>\n<span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">run</span>: <span class=\"o\">%</span><span class=\"n\">icmp_of_i128</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"kc\">false</span><span class=\"w\"></span>\n<span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">run</span>: <span class=\"o\">%</span><span class=\"n\">icmp_of_i128</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"kc\">false</span><span class=\"w\"></span>\n<span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">run</span>: <span class=\"o\">%</span><span class=\"n\">icmp_of_i128</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"kc\">false</span><span class=\"w\"></span>\n<span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">run</span>: <span class=\"o\">%</span><span class=\"n\">icmp_of_i128</span><span class=\"p\">(</span><span class=\"mh\">0x80000000_00000000_00000000_00000000</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"kc\">false</span><span class=\"w\"></span>\n<span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">run</span>: <span class=\"o\">%</span><span class=\"n\">icmp_of_i128</span><span class=\"p\">(</span><span class=\"mh\">0x7FFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFF</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"kc\">false</span><span class=\"w\"></span>\n<span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">run</span>: <span class=\"o\">%</span><span class=\"n\">icmp_of_i128</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mh\">0x7FFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFF</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"kc\">false</span><span class=\"w\"></span>\n<span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">run</span>: <span class=\"o\">%</span><span class=\"n\">icmp_of_i128</span><span class=\"p\">(</span><span class=\"mh\">0x7FFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFF</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"kc\">false</span><span class=\"w\"></span>\n<span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">run</span>: <span class=\"o\">%</span><span class=\"n\">icmp_of_i128</span><span class=\"p\">(</span><span class=\"mh\">0x80000000_00000000_00000000_00000000</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"kc\">true</span><span class=\"w\"></span>\n<span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">run</span>: <span class=\"o\">%</span><span class=\"n\">icmp_of_i128</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mh\">0x80000000_00000000_00000000_00000000</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"kc\">true</span><span class=\"w\"></span>\n<span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">run</span>: <span class=\"o\">%</span><span class=\"n\">icmp_of_i128</span><span class=\"p\">(</span><span class=\"mh\">0x7FFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFF</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mh\">0x80000000_00000000_00000000_00000000</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"kc\">true</span><span class=\"w\"></span>\n<span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">run</span>: <span class=\"o\">%</span><span class=\"n\">icmp_of_i128</span><span class=\"p\">(</span><span class=\"mh\">0x80000000_00000000_00000000_00000000</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mh\">0x7FFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFF</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"kc\">true</span><span class=\"w\"></span>\n<span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">run</span>: <span class=\"o\">%</span><span class=\"n\">icmp_of_i128</span><span class=\"p\">(</span><span class=\"mh\">0x4FFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFF</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mh\">0x30000000_00000000_00000000_00000000</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"kc\">false</span><span class=\"w\"></span>\n<span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">run</span>: <span class=\"o\">%</span><span class=\"n\">icmp_of_i128</span><span class=\"p\">(</span><span class=\"mh\">0x4FFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFF</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mh\">0x30000000_00000000_00000000_00000001</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"kc\">false</span><span class=\"w\"></span>\n</code></pre></div>\n<p>There is a more comprehensive testsuite for this in tree at <code>cranelift/filetests/filetests/runtests/i128-icmp-overflow.clif</code>.</p>\n<h3>Steps to Reproduce</h3>\n<p><code>clif-util test ./the-above.clif</code></p>\n<h3>Expected Results</h3>\n<p>The tests to pass.</p>\n<h3>Actual Results</h3>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"w\">     </span><span class=\"n\">Running</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">C</span>:<span class=\"err\">\\</span><span class=\"n\">Users</span><span class=\"err\">\\</span><span class=\"n\">Afonso</span><span class=\"err\">\\</span><span class=\"n\">CLionProjects</span><span class=\"err\">\\</span><span class=\"n\">wasmtime</span><span class=\"err\">\\</span><span class=\"n\">target</span><span class=\"err\">\\</span><span class=\"n\">debug</span><span class=\"err\">\\</span><span class=\"n\">clif</span><span class=\"o\">-</span><span class=\"n\">util</span><span class=\"p\">.</span><span class=\"n\">exe</span><span class=\"w\"> </span><span class=\"n\">test</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"err\">\\</span><span class=\"n\">filetests</span><span class=\"err\">\\</span><span class=\"n\">filetests</span><span class=\"err\">\\</span><span class=\"n\">runtests</span><span class=\"err\">\\</span><span class=\"kt\">i128</span><span class=\"o\">-</span><span class=\"n\">icmp</span><span class=\"o\">-</span><span class=\"n\">overflow</span><span class=\"p\">.</span><span class=\"n\">clif</span><span class=\"err\">`</span><span class=\"w\"></span>\n<span class=\"n\">skipped</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"err\">\\</span><span class=\"n\">filetests</span><span class=\"err\">\\</span><span class=\"n\">filetests</span><span class=\"err\">\\</span><span class=\"n\">runtests</span><span class=\"err\">\\</span><span class=\"kt\">i128</span><span class=\"o\">-</span><span class=\"n\">icmp</span><span class=\"o\">-</span><span class=\"n\">overflow</span><span class=\"p\">.</span><span class=\"n\">clif</span>: <span class=\"nc\">host</span><span class=\"w\"> </span><span class=\"n\">can</span><span class=\"o\">'</span><span class=\"na\">t</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">Aarch64</span><span class=\"p\">(</span><span class=\"n\">Aarch64</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">programs</span><span class=\"w\"></span>\n<span class=\"n\">FAIL</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"err\">\\</span><span class=\"n\">filetests</span><span class=\"err\">\\</span><span class=\"n\">filetests</span><span class=\"err\">\\</span><span class=\"n\">runtests</span><span class=\"err\">\\</span><span class=\"kt\">i128</span><span class=\"o\">-</span><span class=\"n\">icmp</span><span class=\"o\">-</span><span class=\"n\">overflow</span><span class=\"p\">.</span><span class=\"n\">clif</span>: <span class=\"nc\">run</span><span class=\"w\"></span>\n\n<span class=\"n\">Caused</span><span class=\"w\"> </span><span class=\"n\">by</span>:\n    <span class=\"nc\">Failed</span><span class=\"w\"> </span><span class=\"n\">test</span>: <span class=\"nc\">run</span>: <span class=\"o\">%</span><span class=\"n\">icmp_of_i128</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mi\">170141183460469231731687303715884105728</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"kc\">true</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">actual</span>: <span class=\"nc\">false</span><span class=\"w\"></span>\n<span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">tests</span><span class=\"w\"></span>\n<span class=\"n\">Error</span>: <span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">failure</span><span class=\"w\"></span>\n<span class=\"n\">error</span>: <span class=\"nc\">process</span><span class=\"w\"> </span><span class=\"n\">didn</span><span class=\"o\">'</span><span class=\"na\">t</span><span class=\"w\"> </span><span class=\"n\">exit</span><span class=\"w\"> </span><span class=\"n\">successfully</span>: <span class=\"err\">`</span><span class=\"n\">C</span>:<span class=\"err\">\\</span><span class=\"n\">Users</span><span class=\"err\">\\</span><span class=\"n\">Afonso</span><span class=\"err\">\\</span><span class=\"n\">CLionProjects</span><span class=\"err\">\\</span><span class=\"n\">wasmtime</span><span class=\"err\">\\</span><span class=\"n\">target</span><span class=\"err\">\\</span><span class=\"n\">debug</span><span class=\"err\">\\</span><span class=\"n\">clif</span><span class=\"o\">-</span><span class=\"n\">util</span><span class=\"p\">.</span><span class=\"n\">exe</span><span class=\"w\"> </span><span class=\"n\">test</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"err\">\\</span><span class=\"n\">filetests</span><span class=\"err\">\\</span><span class=\"n\">filetests</span><span class=\"err\">\\</span><span class=\"n\">runtests</span><span class=\"err\">\\</span><span class=\"kt\">i128</span><span class=\"o\">-</span><span class=\"n\">icmp</span><span class=\"o\">-</span><span class=\"n\">overflow</span><span class=\"p\">.</span><span class=\"n\">clif</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">exit</span><span class=\"w\"> </span><span class=\"n\">code</span>: <span class=\"mi\">1</span><span class=\"p\">)</span><span class=\"w\"></span>\n</code></pre></div>\n<h3>Versions and Environment</h3>\n<p>Cranelift version or commit: <code>main</code> <br>\nOperating system: Windows<br>\nArchitecture: <code>x86_64</code></p>\n<h3>Extra Info</h3>\n<p>We also do some weird codegen compared to <a href=\"https://godbolt.org/z/1o46xqf9P\">llvm</a>:</p>\n<p>Here's what we generate:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">push</span><span class=\"w\">    </span><span class=\"n\">rbp</span><span class=\"w\"></span>\n<span class=\"n\">mov</span><span class=\"w\">     </span><span class=\"n\">rbp</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">rsp</span><span class=\"w\"></span>\n<span class=\"n\">mov</span><span class=\"w\">     </span><span class=\"n\">r10</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">r8</span><span class=\"w\"></span>\n<span class=\"n\">cmp</span><span class=\"w\">     </span><span class=\"n\">rdx</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">r9</span><span class=\"w\"></span>\n<span class=\"n\">seto</span><span class=\"w\">    </span><span class=\"n\">al</span><span class=\"w\"></span>\n<span class=\"n\">sete</span><span class=\"w\">    </span><span class=\"n\">r8b</span><span class=\"w\"></span>\n<span class=\"n\">mov</span><span class=\"w\">     </span><span class=\"n\">rdx</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">r10</span><span class=\"w\"></span>\n<span class=\"n\">cmp</span><span class=\"w\">     </span><span class=\"n\">rcx</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">rdx</span><span class=\"w\"></span>\n<span class=\"n\">seto</span><span class=\"w\">    </span><span class=\"n\">r9b</span><span class=\"w\"></span>\n<span class=\"n\">and</span><span class=\"w\">     </span><span class=\"n\">r8</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">r9</span><span class=\"w\"></span>\n<span class=\"n\">or</span><span class=\"w\">      </span><span class=\"n\">rax</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">r8</span><span class=\"w\"></span>\n<span class=\"n\">and</span><span class=\"w\">     </span><span class=\"n\">rax</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"></span>\n<span class=\"n\">mov</span><span class=\"w\">     </span><span class=\"n\">rsp</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">rbp</span><span class=\"w\"></span>\n<span class=\"n\">pop</span><span class=\"w\">     </span><span class=\"n\">rbp</span><span class=\"w\"></span>\n<span class=\"n\">ret</span><span class=\"w\"></span>\n</code></pre></div>\n<p>VS llvm's implementation:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">cmp</span><span class=\"w\">     </span><span class=\"n\">rdi</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">rdx</span><span class=\"w\"></span>\n<span class=\"n\">sbb</span><span class=\"w\">     </span><span class=\"n\">rsi</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">rcx</span><span class=\"w\"></span>\n<span class=\"n\">seto</span><span class=\"w\">    </span><span class=\"n\">al</span><span class=\"w\"></span>\n<span class=\"n\">ret</span><span class=\"w\"></span>\n</code></pre></div>\n</blockquote>",
        "id": 288841360,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1657216163
    },
    {
        "content": "<p>afonso360 labeled <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4406\">issue #4406</a>:</p>\n<blockquote>\n<p><span aria-label=\"wave\" class=\"emoji emoji-1f44b\" role=\"img\" title=\"wave\">:wave:</span> Hey,</p>\n<p>As a followup to #4403, it looks like we are wrongly lowering <code>icmp of</code> and <code>icmp nof</code> on the <code>x86_64</code> backend for <code>i128</code> values.</p>\n<h3><code>.clif</code> Test Case</h3>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">test</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"></span>\n<span class=\"n\">set</span><span class=\"w\"> </span><span class=\"n\">enable_llvm_abi_extensions</span><span class=\"o\">=</span><span class=\"kc\">true</span><span class=\"w\"></span>\n<span class=\"n\">target</span><span class=\"w\"> </span><span class=\"n\">x86_64</span><span class=\"w\"></span>\n\n<span class=\"n\">function</span><span class=\"w\"> </span><span class=\"o\">%</span><span class=\"n\">icmp_of_i128</span><span class=\"p\">(</span><span class=\"kt\">i128</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">i128</span><span class=\"p\">)</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">b1</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"n\">block0</span><span class=\"p\">(</span><span class=\"n\">v0</span>: <span class=\"kt\">i128</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v1</span>: <span class=\"kt\">i128</span><span class=\"p\">)</span>:\n  <span class=\"nc\">v2</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">icmp</span><span class=\"p\">.</span><span class=\"kt\">i128</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v1</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">v2</span><span class=\"w\"></span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n<span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">run</span>: <span class=\"o\">%</span><span class=\"n\">icmp_of_i128</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"kc\">false</span><span class=\"w\"></span>\n<span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">run</span>: <span class=\"o\">%</span><span class=\"n\">icmp_of_i128</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"kc\">false</span><span class=\"w\"></span>\n<span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">run</span>: <span class=\"o\">%</span><span class=\"n\">icmp_of_i128</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"kc\">false</span><span class=\"w\"></span>\n<span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">run</span>: <span class=\"o\">%</span><span class=\"n\">icmp_of_i128</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"kc\">false</span><span class=\"w\"></span>\n<span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">run</span>: <span class=\"o\">%</span><span class=\"n\">icmp_of_i128</span><span class=\"p\">(</span><span class=\"mh\">0x80000000_00000000_00000000_00000000</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"kc\">false</span><span class=\"w\"></span>\n<span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">run</span>: <span class=\"o\">%</span><span class=\"n\">icmp_of_i128</span><span class=\"p\">(</span><span class=\"mh\">0x7FFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFF</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"kc\">false</span><span class=\"w\"></span>\n<span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">run</span>: <span class=\"o\">%</span><span class=\"n\">icmp_of_i128</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mh\">0x7FFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFF</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"kc\">false</span><span class=\"w\"></span>\n<span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">run</span>: <span class=\"o\">%</span><span class=\"n\">icmp_of_i128</span><span class=\"p\">(</span><span class=\"mh\">0x7FFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFF</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"kc\">false</span><span class=\"w\"></span>\n<span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">run</span>: <span class=\"o\">%</span><span class=\"n\">icmp_of_i128</span><span class=\"p\">(</span><span class=\"mh\">0x80000000_00000000_00000000_00000000</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"kc\">true</span><span class=\"w\"></span>\n<span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">run</span>: <span class=\"o\">%</span><span class=\"n\">icmp_of_i128</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mh\">0x80000000_00000000_00000000_00000000</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"kc\">true</span><span class=\"w\"></span>\n<span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">run</span>: <span class=\"o\">%</span><span class=\"n\">icmp_of_i128</span><span class=\"p\">(</span><span class=\"mh\">0x7FFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFF</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mh\">0x80000000_00000000_00000000_00000000</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"kc\">true</span><span class=\"w\"></span>\n<span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">run</span>: <span class=\"o\">%</span><span class=\"n\">icmp_of_i128</span><span class=\"p\">(</span><span class=\"mh\">0x80000000_00000000_00000000_00000000</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mh\">0x7FFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFF</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"kc\">true</span><span class=\"w\"></span>\n<span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">run</span>: <span class=\"o\">%</span><span class=\"n\">icmp_of_i128</span><span class=\"p\">(</span><span class=\"mh\">0x4FFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFF</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mh\">0x30000000_00000000_00000000_00000000</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"kc\">false</span><span class=\"w\"></span>\n<span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">run</span>: <span class=\"o\">%</span><span class=\"n\">icmp_of_i128</span><span class=\"p\">(</span><span class=\"mh\">0x4FFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFF</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mh\">0x30000000_00000000_00000000_00000001</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"kc\">false</span><span class=\"w\"></span>\n</code></pre></div>\n<p>There is a more comprehensive testsuite for this in tree at <code>cranelift/filetests/filetests/runtests/i128-icmp-overflow.clif</code>.</p>\n<h3>Steps to Reproduce</h3>\n<p><code>clif-util test ./the-above.clif</code></p>\n<h3>Expected Results</h3>\n<p>The tests to pass.</p>\n<h3>Actual Results</h3>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"w\">     </span><span class=\"n\">Running</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">C</span>:<span class=\"err\">\\</span><span class=\"n\">Users</span><span class=\"err\">\\</span><span class=\"n\">Afonso</span><span class=\"err\">\\</span><span class=\"n\">CLionProjects</span><span class=\"err\">\\</span><span class=\"n\">wasmtime</span><span class=\"err\">\\</span><span class=\"n\">target</span><span class=\"err\">\\</span><span class=\"n\">debug</span><span class=\"err\">\\</span><span class=\"n\">clif</span><span class=\"o\">-</span><span class=\"n\">util</span><span class=\"p\">.</span><span class=\"n\">exe</span><span class=\"w\"> </span><span class=\"n\">test</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"err\">\\</span><span class=\"n\">filetests</span><span class=\"err\">\\</span><span class=\"n\">filetests</span><span class=\"err\">\\</span><span class=\"n\">runtests</span><span class=\"err\">\\</span><span class=\"kt\">i128</span><span class=\"o\">-</span><span class=\"n\">icmp</span><span class=\"o\">-</span><span class=\"n\">overflow</span><span class=\"p\">.</span><span class=\"n\">clif</span><span class=\"err\">`</span><span class=\"w\"></span>\n<span class=\"n\">skipped</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"err\">\\</span><span class=\"n\">filetests</span><span class=\"err\">\\</span><span class=\"n\">filetests</span><span class=\"err\">\\</span><span class=\"n\">runtests</span><span class=\"err\">\\</span><span class=\"kt\">i128</span><span class=\"o\">-</span><span class=\"n\">icmp</span><span class=\"o\">-</span><span class=\"n\">overflow</span><span class=\"p\">.</span><span class=\"n\">clif</span>: <span class=\"nc\">host</span><span class=\"w\"> </span><span class=\"n\">can</span><span class=\"o\">'</span><span class=\"na\">t</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">Aarch64</span><span class=\"p\">(</span><span class=\"n\">Aarch64</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">programs</span><span class=\"w\"></span>\n<span class=\"n\">FAIL</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"err\">\\</span><span class=\"n\">filetests</span><span class=\"err\">\\</span><span class=\"n\">filetests</span><span class=\"err\">\\</span><span class=\"n\">runtests</span><span class=\"err\">\\</span><span class=\"kt\">i128</span><span class=\"o\">-</span><span class=\"n\">icmp</span><span class=\"o\">-</span><span class=\"n\">overflow</span><span class=\"p\">.</span><span class=\"n\">clif</span>: <span class=\"nc\">run</span><span class=\"w\"></span>\n\n<span class=\"n\">Caused</span><span class=\"w\"> </span><span class=\"n\">by</span>:\n    <span class=\"nc\">Failed</span><span class=\"w\"> </span><span class=\"n\">test</span>: <span class=\"nc\">run</span>: <span class=\"o\">%</span><span class=\"n\">icmp_of_i128</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mi\">170141183460469231731687303715884105728</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"kc\">true</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">actual</span>: <span class=\"nc\">false</span><span class=\"w\"></span>\n<span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">tests</span><span class=\"w\"></span>\n<span class=\"n\">Error</span>: <span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">failure</span><span class=\"w\"></span>\n<span class=\"n\">error</span>: <span class=\"nc\">process</span><span class=\"w\"> </span><span class=\"n\">didn</span><span class=\"o\">'</span><span class=\"na\">t</span><span class=\"w\"> </span><span class=\"n\">exit</span><span class=\"w\"> </span><span class=\"n\">successfully</span>: <span class=\"err\">`</span><span class=\"n\">C</span>:<span class=\"err\">\\</span><span class=\"n\">Users</span><span class=\"err\">\\</span><span class=\"n\">Afonso</span><span class=\"err\">\\</span><span class=\"n\">CLionProjects</span><span class=\"err\">\\</span><span class=\"n\">wasmtime</span><span class=\"err\">\\</span><span class=\"n\">target</span><span class=\"err\">\\</span><span class=\"n\">debug</span><span class=\"err\">\\</span><span class=\"n\">clif</span><span class=\"o\">-</span><span class=\"n\">util</span><span class=\"p\">.</span><span class=\"n\">exe</span><span class=\"w\"> </span><span class=\"n\">test</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"err\">\\</span><span class=\"n\">filetests</span><span class=\"err\">\\</span><span class=\"n\">filetests</span><span class=\"err\">\\</span><span class=\"n\">runtests</span><span class=\"err\">\\</span><span class=\"kt\">i128</span><span class=\"o\">-</span><span class=\"n\">icmp</span><span class=\"o\">-</span><span class=\"n\">overflow</span><span class=\"p\">.</span><span class=\"n\">clif</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">exit</span><span class=\"w\"> </span><span class=\"n\">code</span>: <span class=\"mi\">1</span><span class=\"p\">)</span><span class=\"w\"></span>\n</code></pre></div>\n<h3>Versions and Environment</h3>\n<p>Cranelift version or commit: <code>main</code> <br>\nOperating system: Windows<br>\nArchitecture: <code>x86_64</code></p>\n<h3>Extra Info</h3>\n<p>We also do some weird codegen compared to <a href=\"https://godbolt.org/z/1o46xqf9P\">llvm</a>:</p>\n<p>Here's what we generate:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">push</span><span class=\"w\">    </span><span class=\"n\">rbp</span><span class=\"w\"></span>\n<span class=\"n\">mov</span><span class=\"w\">     </span><span class=\"n\">rbp</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">rsp</span><span class=\"w\"></span>\n<span class=\"n\">mov</span><span class=\"w\">     </span><span class=\"n\">r10</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">r8</span><span class=\"w\"></span>\n<span class=\"n\">cmp</span><span class=\"w\">     </span><span class=\"n\">rdx</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">r9</span><span class=\"w\"></span>\n<span class=\"n\">seto</span><span class=\"w\">    </span><span class=\"n\">al</span><span class=\"w\"></span>\n<span class=\"n\">sete</span><span class=\"w\">    </span><span class=\"n\">r8b</span><span class=\"w\"></span>\n<span class=\"n\">mov</span><span class=\"w\">     </span><span class=\"n\">rdx</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">r10</span><span class=\"w\"></span>\n<span class=\"n\">cmp</span><span class=\"w\">     </span><span class=\"n\">rcx</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">rdx</span><span class=\"w\"></span>\n<span class=\"n\">seto</span><span class=\"w\">    </span><span class=\"n\">r9b</span><span class=\"w\"></span>\n<span class=\"n\">and</span><span class=\"w\">     </span><span class=\"n\">r8</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">r9</span><span class=\"w\"></span>\n<span class=\"n\">or</span><span class=\"w\">      </span><span class=\"n\">rax</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">r8</span><span class=\"w\"></span>\n<span class=\"n\">and</span><span class=\"w\">     </span><span class=\"n\">rax</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"></span>\n<span class=\"n\">mov</span><span class=\"w\">     </span><span class=\"n\">rsp</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">rbp</span><span class=\"w\"></span>\n<span class=\"n\">pop</span><span class=\"w\">     </span><span class=\"n\">rbp</span><span class=\"w\"></span>\n<span class=\"n\">ret</span><span class=\"w\"></span>\n</code></pre></div>\n<p>VS llvm's implementation:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">cmp</span><span class=\"w\">     </span><span class=\"n\">rdi</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">rdx</span><span class=\"w\"></span>\n<span class=\"n\">sbb</span><span class=\"w\">     </span><span class=\"n\">rsi</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">rcx</span><span class=\"w\"></span>\n<span class=\"n\">seto</span><span class=\"w\">    </span><span class=\"n\">al</span><span class=\"w\"></span>\n<span class=\"n\">ret</span><span class=\"w\"></span>\n</code></pre></div>\n</blockquote>",
        "id": 288841361,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1657216163
    },
    {
        "content": "<p>afonso360 labeled <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4406\">issue #4406</a>:</p>\n<blockquote>\n<p><span aria-label=\"wave\" class=\"emoji emoji-1f44b\" role=\"img\" title=\"wave\">:wave:</span> Hey,</p>\n<p>As a followup to #4403, it looks like we are wrongly lowering <code>icmp of</code> and <code>icmp nof</code> on the <code>x86_64</code> backend for <code>i128</code> values.</p>\n<h3><code>.clif</code> Test Case</h3>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">test</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"></span>\n<span class=\"n\">set</span><span class=\"w\"> </span><span class=\"n\">enable_llvm_abi_extensions</span><span class=\"o\">=</span><span class=\"kc\">true</span><span class=\"w\"></span>\n<span class=\"n\">target</span><span class=\"w\"> </span><span class=\"n\">x86_64</span><span class=\"w\"></span>\n\n<span class=\"n\">function</span><span class=\"w\"> </span><span class=\"o\">%</span><span class=\"n\">icmp_of_i128</span><span class=\"p\">(</span><span class=\"kt\">i128</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">i128</span><span class=\"p\">)</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">b1</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"n\">block0</span><span class=\"p\">(</span><span class=\"n\">v0</span>: <span class=\"kt\">i128</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v1</span>: <span class=\"kt\">i128</span><span class=\"p\">)</span>:\n  <span class=\"nc\">v2</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">icmp</span><span class=\"p\">.</span><span class=\"kt\">i128</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v1</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">v2</span><span class=\"w\"></span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n<span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">run</span>: <span class=\"o\">%</span><span class=\"n\">icmp_of_i128</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"kc\">false</span><span class=\"w\"></span>\n<span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">run</span>: <span class=\"o\">%</span><span class=\"n\">icmp_of_i128</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"kc\">false</span><span class=\"w\"></span>\n<span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">run</span>: <span class=\"o\">%</span><span class=\"n\">icmp_of_i128</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"kc\">false</span><span class=\"w\"></span>\n<span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">run</span>: <span class=\"o\">%</span><span class=\"n\">icmp_of_i128</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"kc\">false</span><span class=\"w\"></span>\n<span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">run</span>: <span class=\"o\">%</span><span class=\"n\">icmp_of_i128</span><span class=\"p\">(</span><span class=\"mh\">0x80000000_00000000_00000000_00000000</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"kc\">false</span><span class=\"w\"></span>\n<span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">run</span>: <span class=\"o\">%</span><span class=\"n\">icmp_of_i128</span><span class=\"p\">(</span><span class=\"mh\">0x7FFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFF</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"kc\">false</span><span class=\"w\"></span>\n<span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">run</span>: <span class=\"o\">%</span><span class=\"n\">icmp_of_i128</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mh\">0x7FFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFF</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"kc\">false</span><span class=\"w\"></span>\n<span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">run</span>: <span class=\"o\">%</span><span class=\"n\">icmp_of_i128</span><span class=\"p\">(</span><span class=\"mh\">0x7FFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFF</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"kc\">false</span><span class=\"w\"></span>\n<span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">run</span>: <span class=\"o\">%</span><span class=\"n\">icmp_of_i128</span><span class=\"p\">(</span><span class=\"mh\">0x80000000_00000000_00000000_00000000</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"kc\">true</span><span class=\"w\"></span>\n<span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">run</span>: <span class=\"o\">%</span><span class=\"n\">icmp_of_i128</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mh\">0x80000000_00000000_00000000_00000000</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"kc\">true</span><span class=\"w\"></span>\n<span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">run</span>: <span class=\"o\">%</span><span class=\"n\">icmp_of_i128</span><span class=\"p\">(</span><span class=\"mh\">0x7FFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFF</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mh\">0x80000000_00000000_00000000_00000000</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"kc\">true</span><span class=\"w\"></span>\n<span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">run</span>: <span class=\"o\">%</span><span class=\"n\">icmp_of_i128</span><span class=\"p\">(</span><span class=\"mh\">0x80000000_00000000_00000000_00000000</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mh\">0x7FFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFF</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"kc\">true</span><span class=\"w\"></span>\n<span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">run</span>: <span class=\"o\">%</span><span class=\"n\">icmp_of_i128</span><span class=\"p\">(</span><span class=\"mh\">0x4FFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFF</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mh\">0x30000000_00000000_00000000_00000000</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"kc\">false</span><span class=\"w\"></span>\n<span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">run</span>: <span class=\"o\">%</span><span class=\"n\">icmp_of_i128</span><span class=\"p\">(</span><span class=\"mh\">0x4FFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFF</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mh\">0x30000000_00000000_00000000_00000001</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"kc\">false</span><span class=\"w\"></span>\n</code></pre></div>\n<p>There is a more comprehensive testsuite for this in tree at <code>cranelift/filetests/filetests/runtests/i128-icmp-overflow.clif</code>.</p>\n<h3>Steps to Reproduce</h3>\n<p><code>clif-util test ./the-above.clif</code></p>\n<h3>Expected Results</h3>\n<p>The tests to pass.</p>\n<h3>Actual Results</h3>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"w\">     </span><span class=\"n\">Running</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">C</span>:<span class=\"err\">\\</span><span class=\"n\">Users</span><span class=\"err\">\\</span><span class=\"n\">Afonso</span><span class=\"err\">\\</span><span class=\"n\">CLionProjects</span><span class=\"err\">\\</span><span class=\"n\">wasmtime</span><span class=\"err\">\\</span><span class=\"n\">target</span><span class=\"err\">\\</span><span class=\"n\">debug</span><span class=\"err\">\\</span><span class=\"n\">clif</span><span class=\"o\">-</span><span class=\"n\">util</span><span class=\"p\">.</span><span class=\"n\">exe</span><span class=\"w\"> </span><span class=\"n\">test</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"err\">\\</span><span class=\"n\">filetests</span><span class=\"err\">\\</span><span class=\"n\">filetests</span><span class=\"err\">\\</span><span class=\"n\">runtests</span><span class=\"err\">\\</span><span class=\"kt\">i128</span><span class=\"o\">-</span><span class=\"n\">icmp</span><span class=\"o\">-</span><span class=\"n\">overflow</span><span class=\"p\">.</span><span class=\"n\">clif</span><span class=\"err\">`</span><span class=\"w\"></span>\n<span class=\"n\">skipped</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"err\">\\</span><span class=\"n\">filetests</span><span class=\"err\">\\</span><span class=\"n\">filetests</span><span class=\"err\">\\</span><span class=\"n\">runtests</span><span class=\"err\">\\</span><span class=\"kt\">i128</span><span class=\"o\">-</span><span class=\"n\">icmp</span><span class=\"o\">-</span><span class=\"n\">overflow</span><span class=\"p\">.</span><span class=\"n\">clif</span>: <span class=\"nc\">host</span><span class=\"w\"> </span><span class=\"n\">can</span><span class=\"o\">'</span><span class=\"na\">t</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">Aarch64</span><span class=\"p\">(</span><span class=\"n\">Aarch64</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">programs</span><span class=\"w\"></span>\n<span class=\"n\">FAIL</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"err\">\\</span><span class=\"n\">filetests</span><span class=\"err\">\\</span><span class=\"n\">filetests</span><span class=\"err\">\\</span><span class=\"n\">runtests</span><span class=\"err\">\\</span><span class=\"kt\">i128</span><span class=\"o\">-</span><span class=\"n\">icmp</span><span class=\"o\">-</span><span class=\"n\">overflow</span><span class=\"p\">.</span><span class=\"n\">clif</span>: <span class=\"nc\">run</span><span class=\"w\"></span>\n\n<span class=\"n\">Caused</span><span class=\"w\"> </span><span class=\"n\">by</span>:\n    <span class=\"nc\">Failed</span><span class=\"w\"> </span><span class=\"n\">test</span>: <span class=\"nc\">run</span>: <span class=\"o\">%</span><span class=\"n\">icmp_of_i128</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mi\">170141183460469231731687303715884105728</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"kc\">true</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">actual</span>: <span class=\"nc\">false</span><span class=\"w\"></span>\n<span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">tests</span><span class=\"w\"></span>\n<span class=\"n\">Error</span>: <span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">failure</span><span class=\"w\"></span>\n<span class=\"n\">error</span>: <span class=\"nc\">process</span><span class=\"w\"> </span><span class=\"n\">didn</span><span class=\"o\">'</span><span class=\"na\">t</span><span class=\"w\"> </span><span class=\"n\">exit</span><span class=\"w\"> </span><span class=\"n\">successfully</span>: <span class=\"err\">`</span><span class=\"n\">C</span>:<span class=\"err\">\\</span><span class=\"n\">Users</span><span class=\"err\">\\</span><span class=\"n\">Afonso</span><span class=\"err\">\\</span><span class=\"n\">CLionProjects</span><span class=\"err\">\\</span><span class=\"n\">wasmtime</span><span class=\"err\">\\</span><span class=\"n\">target</span><span class=\"err\">\\</span><span class=\"n\">debug</span><span class=\"err\">\\</span><span class=\"n\">clif</span><span class=\"o\">-</span><span class=\"n\">util</span><span class=\"p\">.</span><span class=\"n\">exe</span><span class=\"w\"> </span><span class=\"n\">test</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"err\">\\</span><span class=\"n\">filetests</span><span class=\"err\">\\</span><span class=\"n\">filetests</span><span class=\"err\">\\</span><span class=\"n\">runtests</span><span class=\"err\">\\</span><span class=\"kt\">i128</span><span class=\"o\">-</span><span class=\"n\">icmp</span><span class=\"o\">-</span><span class=\"n\">overflow</span><span class=\"p\">.</span><span class=\"n\">clif</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">exit</span><span class=\"w\"> </span><span class=\"n\">code</span>: <span class=\"mi\">1</span><span class=\"p\">)</span><span class=\"w\"></span>\n</code></pre></div>\n<h3>Versions and Environment</h3>\n<p>Cranelift version or commit: <code>main</code> <br>\nOperating system: Windows<br>\nArchitecture: <code>x86_64</code></p>\n<h3>Extra Info</h3>\n<p>We also do some weird codegen compared to <a href=\"https://godbolt.org/z/1o46xqf9P\">llvm</a>:</p>\n<p>Here's what we generate:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">push</span><span class=\"w\">    </span><span class=\"n\">rbp</span><span class=\"w\"></span>\n<span class=\"n\">mov</span><span class=\"w\">     </span><span class=\"n\">rbp</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">rsp</span><span class=\"w\"></span>\n<span class=\"n\">mov</span><span class=\"w\">     </span><span class=\"n\">r10</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">r8</span><span class=\"w\"></span>\n<span class=\"n\">cmp</span><span class=\"w\">     </span><span class=\"n\">rdx</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">r9</span><span class=\"w\"></span>\n<span class=\"n\">seto</span><span class=\"w\">    </span><span class=\"n\">al</span><span class=\"w\"></span>\n<span class=\"n\">sete</span><span class=\"w\">    </span><span class=\"n\">r8b</span><span class=\"w\"></span>\n<span class=\"n\">mov</span><span class=\"w\">     </span><span class=\"n\">rdx</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">r10</span><span class=\"w\"></span>\n<span class=\"n\">cmp</span><span class=\"w\">     </span><span class=\"n\">rcx</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">rdx</span><span class=\"w\"></span>\n<span class=\"n\">seto</span><span class=\"w\">    </span><span class=\"n\">r9b</span><span class=\"w\"></span>\n<span class=\"n\">and</span><span class=\"w\">     </span><span class=\"n\">r8</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">r9</span><span class=\"w\"></span>\n<span class=\"n\">or</span><span class=\"w\">      </span><span class=\"n\">rax</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">r8</span><span class=\"w\"></span>\n<span class=\"n\">and</span><span class=\"w\">     </span><span class=\"n\">rax</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"></span>\n<span class=\"n\">mov</span><span class=\"w\">     </span><span class=\"n\">rsp</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">rbp</span><span class=\"w\"></span>\n<span class=\"n\">pop</span><span class=\"w\">     </span><span class=\"n\">rbp</span><span class=\"w\"></span>\n<span class=\"n\">ret</span><span class=\"w\"></span>\n</code></pre></div>\n<p>VS llvm's implementation:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">cmp</span><span class=\"w\">     </span><span class=\"n\">rdi</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">rdx</span><span class=\"w\"></span>\n<span class=\"n\">sbb</span><span class=\"w\">     </span><span class=\"n\">rsi</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">rcx</span><span class=\"w\"></span>\n<span class=\"n\">seto</span><span class=\"w\">    </span><span class=\"n\">al</span><span class=\"w\"></span>\n<span class=\"n\">ret</span><span class=\"w\"></span>\n</code></pre></div>\n</blockquote>",
        "id": 288841362,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1657216163
    },
    {
        "content": "<p>cfallin <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4406#issuecomment-1178000800\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4406\">issue #4406</a>:</p>\n<blockquote>\n<p>cc @abrown @jlb6740 </p>\n</blockquote>",
        "id": 288842017,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1657216423
    },
    {
        "content": "<p>jameysharp closed <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4406\">issue #4406</a>:</p>\n<blockquote>\n<p><span aria-label=\"wave\" class=\"emoji emoji-1f44b\" role=\"img\" title=\"wave\">:wave:</span> Hey,</p>\n<p>As a followup to #4403, it looks like we are wrongly lowering <code>icmp of</code> and <code>icmp nof</code> on the <code>x86_64</code> backend for <code>i128</code> values.</p>\n<h3><code>.clif</code> Test Case</h3>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">test</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"></span>\n<span class=\"n\">set</span><span class=\"w\"> </span><span class=\"n\">enable_llvm_abi_extensions</span><span class=\"o\">=</span><span class=\"kc\">true</span><span class=\"w\"></span>\n<span class=\"n\">target</span><span class=\"w\"> </span><span class=\"n\">x86_64</span><span class=\"w\"></span>\n\n<span class=\"n\">function</span><span class=\"w\"> </span><span class=\"o\">%</span><span class=\"n\">icmp_of_i128</span><span class=\"p\">(</span><span class=\"kt\">i128</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">i128</span><span class=\"p\">)</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">b1</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"n\">block0</span><span class=\"p\">(</span><span class=\"n\">v0</span>: <span class=\"kt\">i128</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v1</span>: <span class=\"kt\">i128</span><span class=\"p\">)</span>:\n  <span class=\"nc\">v2</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">icmp</span><span class=\"p\">.</span><span class=\"kt\">i128</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v1</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">v2</span><span class=\"w\"></span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n<span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">run</span>: <span class=\"o\">%</span><span class=\"n\">icmp_of_i128</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"kc\">false</span><span class=\"w\"></span>\n<span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">run</span>: <span class=\"o\">%</span><span class=\"n\">icmp_of_i128</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"kc\">false</span><span class=\"w\"></span>\n<span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">run</span>: <span class=\"o\">%</span><span class=\"n\">icmp_of_i128</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"kc\">false</span><span class=\"w\"></span>\n<span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">run</span>: <span class=\"o\">%</span><span class=\"n\">icmp_of_i128</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"kc\">false</span><span class=\"w\"></span>\n<span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">run</span>: <span class=\"o\">%</span><span class=\"n\">icmp_of_i128</span><span class=\"p\">(</span><span class=\"mh\">0x80000000_00000000_00000000_00000000</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"kc\">false</span><span class=\"w\"></span>\n<span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">run</span>: <span class=\"o\">%</span><span class=\"n\">icmp_of_i128</span><span class=\"p\">(</span><span class=\"mh\">0x7FFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFF</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"kc\">false</span><span class=\"w\"></span>\n<span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">run</span>: <span class=\"o\">%</span><span class=\"n\">icmp_of_i128</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mh\">0x7FFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFF</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"kc\">false</span><span class=\"w\"></span>\n<span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">run</span>: <span class=\"o\">%</span><span class=\"n\">icmp_of_i128</span><span class=\"p\">(</span><span class=\"mh\">0x7FFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFF</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"kc\">false</span><span class=\"w\"></span>\n<span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">run</span>: <span class=\"o\">%</span><span class=\"n\">icmp_of_i128</span><span class=\"p\">(</span><span class=\"mh\">0x80000000_00000000_00000000_00000000</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"kc\">true</span><span class=\"w\"></span>\n<span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">run</span>: <span class=\"o\">%</span><span class=\"n\">icmp_of_i128</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mh\">0x80000000_00000000_00000000_00000000</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"kc\">true</span><span class=\"w\"></span>\n<span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">run</span>: <span class=\"o\">%</span><span class=\"n\">icmp_of_i128</span><span class=\"p\">(</span><span class=\"mh\">0x7FFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFF</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mh\">0x80000000_00000000_00000000_00000000</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"kc\">true</span><span class=\"w\"></span>\n<span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">run</span>: <span class=\"o\">%</span><span class=\"n\">icmp_of_i128</span><span class=\"p\">(</span><span class=\"mh\">0x80000000_00000000_00000000_00000000</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mh\">0x7FFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFF</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"kc\">true</span><span class=\"w\"></span>\n<span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">run</span>: <span class=\"o\">%</span><span class=\"n\">icmp_of_i128</span><span class=\"p\">(</span><span class=\"mh\">0x4FFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFF</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mh\">0x30000000_00000000_00000000_00000000</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"kc\">false</span><span class=\"w\"></span>\n<span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">run</span>: <span class=\"o\">%</span><span class=\"n\">icmp_of_i128</span><span class=\"p\">(</span><span class=\"mh\">0x4FFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFF</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mh\">0x30000000_00000000_00000000_00000001</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"kc\">false</span><span class=\"w\"></span>\n</code></pre></div>\n<p>There is a more comprehensive testsuite for this in tree at <code>cranelift/filetests/filetests/runtests/i128-icmp-overflow.clif</code>.</p>\n<h3>Steps to Reproduce</h3>\n<p><code>clif-util test ./the-above.clif</code></p>\n<h3>Expected Results</h3>\n<p>The tests to pass.</p>\n<h3>Actual Results</h3>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"w\">     </span><span class=\"n\">Running</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">C</span>:<span class=\"err\">\\</span><span class=\"n\">Users</span><span class=\"err\">\\</span><span class=\"n\">Afonso</span><span class=\"err\">\\</span><span class=\"n\">CLionProjects</span><span class=\"err\">\\</span><span class=\"n\">wasmtime</span><span class=\"err\">\\</span><span class=\"n\">target</span><span class=\"err\">\\</span><span class=\"n\">debug</span><span class=\"err\">\\</span><span class=\"n\">clif</span><span class=\"o\">-</span><span class=\"n\">util</span><span class=\"p\">.</span><span class=\"n\">exe</span><span class=\"w\"> </span><span class=\"n\">test</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"err\">\\</span><span class=\"n\">filetests</span><span class=\"err\">\\</span><span class=\"n\">filetests</span><span class=\"err\">\\</span><span class=\"n\">runtests</span><span class=\"err\">\\</span><span class=\"kt\">i128</span><span class=\"o\">-</span><span class=\"n\">icmp</span><span class=\"o\">-</span><span class=\"n\">overflow</span><span class=\"p\">.</span><span class=\"n\">clif</span><span class=\"err\">`</span><span class=\"w\"></span>\n<span class=\"n\">skipped</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"err\">\\</span><span class=\"n\">filetests</span><span class=\"err\">\\</span><span class=\"n\">filetests</span><span class=\"err\">\\</span><span class=\"n\">runtests</span><span class=\"err\">\\</span><span class=\"kt\">i128</span><span class=\"o\">-</span><span class=\"n\">icmp</span><span class=\"o\">-</span><span class=\"n\">overflow</span><span class=\"p\">.</span><span class=\"n\">clif</span>: <span class=\"nc\">host</span><span class=\"w\"> </span><span class=\"n\">can</span><span class=\"o\">'</span><span class=\"na\">t</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">Aarch64</span><span class=\"p\">(</span><span class=\"n\">Aarch64</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">programs</span><span class=\"w\"></span>\n<span class=\"n\">FAIL</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"err\">\\</span><span class=\"n\">filetests</span><span class=\"err\">\\</span><span class=\"n\">filetests</span><span class=\"err\">\\</span><span class=\"n\">runtests</span><span class=\"err\">\\</span><span class=\"kt\">i128</span><span class=\"o\">-</span><span class=\"n\">icmp</span><span class=\"o\">-</span><span class=\"n\">overflow</span><span class=\"p\">.</span><span class=\"n\">clif</span>: <span class=\"nc\">run</span><span class=\"w\"></span>\n\n<span class=\"n\">Caused</span><span class=\"w\"> </span><span class=\"n\">by</span>:\n    <span class=\"nc\">Failed</span><span class=\"w\"> </span><span class=\"n\">test</span>: <span class=\"nc\">run</span>: <span class=\"o\">%</span><span class=\"n\">icmp_of_i128</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mi\">170141183460469231731687303715884105728</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"kc\">true</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">actual</span>: <span class=\"nc\">false</span><span class=\"w\"></span>\n<span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">tests</span><span class=\"w\"></span>\n<span class=\"n\">Error</span>: <span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">failure</span><span class=\"w\"></span>\n<span class=\"n\">error</span>: <span class=\"nc\">process</span><span class=\"w\"> </span><span class=\"n\">didn</span><span class=\"o\">'</span><span class=\"na\">t</span><span class=\"w\"> </span><span class=\"n\">exit</span><span class=\"w\"> </span><span class=\"n\">successfully</span>: <span class=\"err\">`</span><span class=\"n\">C</span>:<span class=\"err\">\\</span><span class=\"n\">Users</span><span class=\"err\">\\</span><span class=\"n\">Afonso</span><span class=\"err\">\\</span><span class=\"n\">CLionProjects</span><span class=\"err\">\\</span><span class=\"n\">wasmtime</span><span class=\"err\">\\</span><span class=\"n\">target</span><span class=\"err\">\\</span><span class=\"n\">debug</span><span class=\"err\">\\</span><span class=\"n\">clif</span><span class=\"o\">-</span><span class=\"n\">util</span><span class=\"p\">.</span><span class=\"n\">exe</span><span class=\"w\"> </span><span class=\"n\">test</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"err\">\\</span><span class=\"n\">filetests</span><span class=\"err\">\\</span><span class=\"n\">filetests</span><span class=\"err\">\\</span><span class=\"n\">runtests</span><span class=\"err\">\\</span><span class=\"kt\">i128</span><span class=\"o\">-</span><span class=\"n\">icmp</span><span class=\"o\">-</span><span class=\"n\">overflow</span><span class=\"p\">.</span><span class=\"n\">clif</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">exit</span><span class=\"w\"> </span><span class=\"n\">code</span>: <span class=\"mi\">1</span><span class=\"p\">)</span><span class=\"w\"></span>\n</code></pre></div>\n<h3>Versions and Environment</h3>\n<p>Cranelift version or commit: <code>main</code> <br>\nOperating system: Windows<br>\nArchitecture: <code>x86_64</code></p>\n<h3>Extra Info</h3>\n<p>We also do some weird codegen compared to <a href=\"https://godbolt.org/z/1o46xqf9P\">llvm</a>:</p>\n<p>Here's what we generate:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">push</span><span class=\"w\">    </span><span class=\"n\">rbp</span><span class=\"w\"></span>\n<span class=\"n\">mov</span><span class=\"w\">     </span><span class=\"n\">rbp</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">rsp</span><span class=\"w\"></span>\n<span class=\"n\">mov</span><span class=\"w\">     </span><span class=\"n\">r10</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">r8</span><span class=\"w\"></span>\n<span class=\"n\">cmp</span><span class=\"w\">     </span><span class=\"n\">rdx</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">r9</span><span class=\"w\"></span>\n<span class=\"n\">seto</span><span class=\"w\">    </span><span class=\"n\">al</span><span class=\"w\"></span>\n<span class=\"n\">sete</span><span class=\"w\">    </span><span class=\"n\">r8b</span><span class=\"w\"></span>\n<span class=\"n\">mov</span><span class=\"w\">     </span><span class=\"n\">rdx</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">r10</span><span class=\"w\"></span>\n<span class=\"n\">cmp</span><span class=\"w\">     </span><span class=\"n\">rcx</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">rdx</span><span class=\"w\"></span>\n<span class=\"n\">seto</span><span class=\"w\">    </span><span class=\"n\">r9b</span><span class=\"w\"></span>\n<span class=\"n\">and</span><span class=\"w\">     </span><span class=\"n\">r8</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">r9</span><span class=\"w\"></span>\n<span class=\"n\">or</span><span class=\"w\">      </span><span class=\"n\">rax</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">r8</span><span class=\"w\"></span>\n<span class=\"n\">and</span><span class=\"w\">     </span><span class=\"n\">rax</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"></span>\n<span class=\"n\">mov</span><span class=\"w\">     </span><span class=\"n\">rsp</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">rbp</span><span class=\"w\"></span>\n<span class=\"n\">pop</span><span class=\"w\">     </span><span class=\"n\">rbp</span><span class=\"w\"></span>\n<span class=\"n\">ret</span><span class=\"w\"></span>\n</code></pre></div>\n<p>VS llvm's implementation:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">cmp</span><span class=\"w\">     </span><span class=\"n\">rdi</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">rdx</span><span class=\"w\"></span>\n<span class=\"n\">sbb</span><span class=\"w\">     </span><span class=\"n\">rsi</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">rcx</span><span class=\"w\"></span>\n<span class=\"n\">seto</span><span class=\"w\">    </span><span class=\"n\">al</span><span class=\"w\"></span>\n<span class=\"n\">ret</span><span class=\"w\"></span>\n</code></pre></div>\n</blockquote>",
        "id": 297616099,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1662565124
    }
]