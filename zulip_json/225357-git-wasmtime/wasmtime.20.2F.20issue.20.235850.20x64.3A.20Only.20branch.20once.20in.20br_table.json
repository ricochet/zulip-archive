[
    {
        "content": "<p>jameysharp <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5850#issuecomment-1441120566\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/5850\">issue #5850</a>:</p>\n<blockquote>\n<p>Spidermonkey retires slightly fewer instructions during execution, slightly more during compilation, but no significant difference in CPU cycles in either case.</p>\n<p>&lt;details&gt;&lt;summary&gt;Significant spidermonkey performance differences&lt;/summary&gt;</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">execution</span><span class=\"w\"> </span>:: <span class=\"nc\">instructions</span><span class=\"o\">-</span><span class=\"n\">retired</span><span class=\"w\"> </span>:: <span class=\"nc\">benchmarks</span><span class=\"o\">/</span><span class=\"n\">spidermonkey</span><span class=\"o\">/</span><span class=\"n\">benchmark</span><span class=\"p\">.</span><span class=\"n\">wasm</span>\n\n<span class=\"w\">  </span><span class=\"err\">Δ</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">23022316.85</span><span class=\"w\"> </span><span class=\"err\">±</span><span class=\"w\"> </span><span class=\"mf\">32869.86</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">confidence</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">99</span><span class=\"o\">%</span><span class=\"p\">)</span>\n\n<span class=\"w\">  </span><span class=\"n\">branch</span><span class=\"o\">-</span><span class=\"n\">once</span><span class=\"o\">-</span><span class=\"mf\">82e006</span><span class=\"n\">e56</span><span class=\"p\">.</span><span class=\"n\">so</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"mf\">1.01</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"mf\">1.01</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">faster</span><span class=\"w\"> </span><span class=\"n\">than</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"o\">-</span><span class=\"mi\">0</span><span class=\"n\">f51338de</span><span class=\"p\">.</span><span class=\"n\">so</span><span class=\"o\">!</span>\n\n<span class=\"w\">  </span><span class=\"p\">[</span><span class=\"mi\">2852144560</span><span class=\"w\"> </span><span class=\"mf\">2852262544.40</span><span class=\"w\"> </span><span class=\"mi\">2852550305</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"n\">branch</span><span class=\"o\">-</span><span class=\"n\">once</span><span class=\"o\">-</span><span class=\"mf\">82e006</span><span class=\"n\">e56</span><span class=\"p\">.</span><span class=\"n\">so</span>\n<span class=\"w\">  </span><span class=\"p\">[</span><span class=\"mi\">2875156298</span><span class=\"w\"> </span><span class=\"mf\">2875284861.25</span><span class=\"w\"> </span><span class=\"mi\">2875531456</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"o\">-</span><span class=\"mi\">0</span><span class=\"n\">f51338de</span><span class=\"p\">.</span><span class=\"n\">so</span>\n\n<span class=\"n\">compilation</span><span class=\"w\"> </span>:: <span class=\"nc\">instructions</span><span class=\"o\">-</span><span class=\"n\">retired</span><span class=\"w\"> </span>:: <span class=\"nc\">benchmarks</span><span class=\"o\">/</span><span class=\"n\">spidermonkey</span><span class=\"o\">/</span><span class=\"n\">benchmark</span><span class=\"p\">.</span><span class=\"n\">wasm</span>\n\n<span class=\"w\">  </span><span class=\"err\">Δ</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">37675655.35</span><span class=\"w\"> </span><span class=\"err\">±</span><span class=\"w\"> </span><span class=\"mf\">1170739.83</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">confidence</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">99</span><span class=\"o\">%</span><span class=\"p\">)</span>\n\n<span class=\"w\">  </span><span class=\"n\">main</span><span class=\"o\">-</span><span class=\"mi\">0</span><span class=\"n\">f51338de</span><span class=\"p\">.</span><span class=\"n\">so</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"mf\">1.00</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"mf\">1.00</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">faster</span><span class=\"w\"> </span><span class=\"n\">than</span><span class=\"w\"> </span><span class=\"n\">branch</span><span class=\"o\">-</span><span class=\"n\">once</span><span class=\"o\">-</span><span class=\"mf\">82e006</span><span class=\"n\">e56</span><span class=\"p\">.</span><span class=\"n\">so</span><span class=\"o\">!</span>\n\n<span class=\"w\">  </span><span class=\"p\">[</span><span class=\"mi\">38943859484</span><span class=\"w\"> </span><span class=\"mf\">38953919135.25</span><span class=\"w\"> </span><span class=\"mi\">38956367889</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"n\">branch</span><span class=\"o\">-</span><span class=\"n\">once</span><span class=\"o\">-</span><span class=\"mf\">82e006</span><span class=\"n\">e56</span><span class=\"p\">.</span><span class=\"n\">so</span>\n<span class=\"w\">  </span><span class=\"p\">[</span><span class=\"mi\">38906558057</span><span class=\"w\"> </span><span class=\"mf\">38916243479.90</span><span class=\"w\"> </span><span class=\"mi\">38921200049</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"o\">-</span><span class=\"mi\">0</span><span class=\"n\">f51338de</span><span class=\"p\">.</span><span class=\"n\">so</span>\n</code></pre></div>\n<p>&lt;/details&gt;</p>\n<p>The pulldown-cmark benchmark executes slightly faster by CPU cycles and slightly slower by number of instructions retired, which I think means it's hitting the default branch somewhat often.</p>\n<p>&lt;details&gt;&lt;summary&gt;Significant pulldown-cmark performance differences&lt;/summary&gt;</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">execution</span><span class=\"w\"> </span>:: <span class=\"nc\">cpu</span><span class=\"o\">-</span><span class=\"n\">cycles</span><span class=\"w\"> </span>:: <span class=\"nc\">benchmarks</span><span class=\"o\">/</span><span class=\"n\">pulldown</span><span class=\"o\">-</span><span class=\"n\">cmark</span><span class=\"o\">/</span><span class=\"n\">benchmark</span><span class=\"p\">.</span><span class=\"n\">wasm</span>\n\n<span class=\"w\">  </span><span class=\"err\">Δ</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">87213.87</span><span class=\"w\"> </span><span class=\"err\">±</span><span class=\"w\"> </span><span class=\"mf\">20212.56</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">confidence</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">99</span><span class=\"o\">%</span><span class=\"p\">)</span>\n\n<span class=\"w\">  </span><span class=\"n\">branch</span><span class=\"o\">-</span><span class=\"n\">once</span><span class=\"o\">-</span><span class=\"mf\">82e006</span><span class=\"n\">e56</span><span class=\"p\">.</span><span class=\"n\">so</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"mf\">1.01</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"mf\">1.01</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">faster</span><span class=\"w\"> </span><span class=\"n\">than</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"o\">-</span><span class=\"mi\">0</span><span class=\"n\">f51338de</span><span class=\"p\">.</span><span class=\"n\">so</span><span class=\"o\">!</span>\n\n<span class=\"w\">  </span><span class=\"p\">[</span><span class=\"mi\">8033614</span><span class=\"w\"> </span><span class=\"mf\">8138405.50</span><span class=\"w\"> </span><span class=\"mi\">8285060</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"n\">branch</span><span class=\"o\">-</span><span class=\"n\">once</span><span class=\"o\">-</span><span class=\"mf\">82e006</span><span class=\"n\">e56</span><span class=\"p\">.</span><span class=\"n\">so</span>\n<span class=\"w\">  </span><span class=\"p\">[</span><span class=\"mi\">8140335</span><span class=\"w\"> </span><span class=\"mf\">8225619.37</span><span class=\"w\"> </span><span class=\"mi\">8496124</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"o\">-</span><span class=\"mi\">0</span><span class=\"n\">f51338de</span><span class=\"p\">.</span><span class=\"n\">so</span>\n\n<span class=\"n\">execution</span><span class=\"w\"> </span>:: <span class=\"nc\">instructions</span><span class=\"o\">-</span><span class=\"n\">retired</span><span class=\"w\"> </span>:: <span class=\"nc\">benchmarks</span><span class=\"o\">/</span><span class=\"n\">pulldown</span><span class=\"o\">-</span><span class=\"n\">cmark</span><span class=\"o\">/</span><span class=\"n\">benchmark</span><span class=\"p\">.</span><span class=\"n\">wasm</span>\n\n<span class=\"w\">  </span><span class=\"err\">Δ</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">117594.21</span><span class=\"w\"> </span><span class=\"err\">±</span><span class=\"w\"> </span><span class=\"mf\">109.08</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">confidence</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">99</span><span class=\"o\">%</span><span class=\"p\">)</span>\n\n<span class=\"w\">  </span><span class=\"n\">main</span><span class=\"o\">-</span><span class=\"mi\">0</span><span class=\"n\">f51338de</span><span class=\"p\">.</span><span class=\"n\">so</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"mf\">1.00</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"mf\">1.00</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">faster</span><span class=\"w\"> </span><span class=\"n\">than</span><span class=\"w\"> </span><span class=\"n\">branch</span><span class=\"o\">-</span><span class=\"n\">once</span><span class=\"o\">-</span><span class=\"mf\">82e006</span><span class=\"n\">e56</span><span class=\"p\">.</span><span class=\"n\">so</span><span class=\"o\">!</span>\n\n<span class=\"w\">  </span><span class=\"p\">[</span><span class=\"mi\">23761214</span><span class=\"w\"> </span><span class=\"mf\">23761446.97</span><span class=\"w\"> </span><span class=\"mi\">23762080</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"n\">branch</span><span class=\"o\">-</span><span class=\"n\">once</span><span class=\"o\">-</span><span class=\"mf\">82e006</span><span class=\"n\">e56</span><span class=\"p\">.</span><span class=\"n\">so</span>\n<span class=\"w\">  </span><span class=\"p\">[</span><span class=\"mi\">23643597</span><span class=\"w\"> </span><span class=\"mf\">23643852.76</span><span class=\"w\"> </span><span class=\"mi\">23644483</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"o\">-</span><span class=\"mi\">0</span><span class=\"n\">f51338de</span><span class=\"p\">.</span><span class=\"n\">so</span>\n\n<span class=\"n\">compilation</span><span class=\"w\"> </span>:: <span class=\"nc\">instructions</span><span class=\"o\">-</span><span class=\"n\">retired</span><span class=\"w\"> </span>:: <span class=\"nc\">benchmarks</span><span class=\"o\">/</span><span class=\"n\">pulldown</span><span class=\"o\">-</span><span class=\"n\">cmark</span><span class=\"o\">/</span><span class=\"n\">benchmark</span><span class=\"p\">.</span><span class=\"n\">wasm</span>\n\n<span class=\"w\">  </span><span class=\"err\">Δ</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">3504417.95</span><span class=\"w\"> </span><span class=\"err\">±</span><span class=\"w\"> </span><span class=\"mf\">49961.22</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">confidence</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">99</span><span class=\"o\">%</span><span class=\"p\">)</span>\n\n<span class=\"w\">  </span><span class=\"n\">main</span><span class=\"o\">-</span><span class=\"mi\">0</span><span class=\"n\">f51338de</span><span class=\"p\">.</span><span class=\"n\">so</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"mf\">1.00</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"mf\">1.00</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"n\">faster</span><span class=\"w\"> </span><span class=\"n\">than</span><span class=\"w\"> </span><span class=\"n\">branch</span><span class=\"o\">-</span><span class=\"n\">once</span><span class=\"o\">-</span><span class=\"mf\">82e006</span><span class=\"n\">e56</span><span class=\"p\">.</span><span class=\"n\">so</span><span class=\"o\">!</span>\n\n<span class=\"w\">  </span><span class=\"p\">[</span><span class=\"mi\">1652866013</span><span class=\"w\"> </span><span class=\"mf\">1653078182.09</span><span class=\"w\"> </span><span class=\"mi\">1653490982</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"n\">branch</span><span class=\"o\">-</span><span class=\"n\">once</span><span class=\"o\">-</span><span class=\"mf\">82e006</span><span class=\"n\">e56</span><span class=\"p\">.</span><span class=\"n\">so</span>\n<span class=\"w\">  </span><span class=\"p\">[</span><span class=\"mi\">1649289182</span><span class=\"w\"> </span><span class=\"mf\">1649573764.14</span><span class=\"w\"> </span><span class=\"mi\">1650067353</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"o\">-</span><span class=\"mi\">0</span><span class=\"n\">f51338de</span><span class=\"p\">.</span><span class=\"n\">so</span>\n</code></pre></div>\n<p>&lt;/details&gt;</p>\n<p>But overall it looks to me like there's very little performance difference either way on these benchmarks.</p>\n</blockquote>",
        "id": 329615327,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1677116826
    }
]