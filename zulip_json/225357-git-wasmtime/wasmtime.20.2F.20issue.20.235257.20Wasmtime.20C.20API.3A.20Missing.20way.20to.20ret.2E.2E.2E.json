[
    {
        "content": "<p>kpreisser opened <a href=\"https://github.com/bytecodealliance/wasmtime/issues/5257\">issue #5257</a>:</p>\n<blockquote>\n<p>Hi!</p>\n<p>As far as I understand the trap redesign with #5149, host traps/errors created with <code>wasmtime_trap_new</code>, as well as traps caused by setting the WASI exit code (by calling WASI's <code>proc_exit</code>), are now returned as <code>wasmtime_error_t*</code> instead of <code>wasm_trap_t*</code> (e.g. with <code>wasmtime_func_call</code> and <code>wasmtime_linker_instantiate</code>); whereas only actual WASM traps that have a corresponding trap code (<code>wasmtime_trap_code_t</code>) are still returned as <code>wasm_trap_t*</code>.</p>\n<p>With #5215, the WASI exit code can now be retrieved from the <code>wasmtime_error_t*</code>.</p>\n<p>However, the unchecked variant <code>wasmtime_func_call_unchecked</code> only returns a <code>wasm_trap_t*</code>, but no <code>wasmtime_error_t*</code>. Therefore, it doesn't seem possible e.g. to extract the WASI exit code from it:<br>\n<a href=\"https://github.com/bytecodealliance/wasmtime/blob/95ca72a37ae17d33d6fa727150dab5a49011b555/crates/c-api/include/wasmtime/func.h#L244-L248\">https://github.com/bytecodealliance/wasmtime/blob/95ca72a37ae17d33d6fa727150dab5a49011b555/crates/c-api/include/wasmtime/func.h#L244-L248</a></p>\n<p>Would this require an adjustment of the C API? E.g., should <code>wasmtime_func_call_unchecked</code> additionally return a <code>wasmtime_error_t*</code>, for consistency with <code>wasmtime_func_call</code>, so that it would return host traps and WASI exit traps as <code>wasmtime_error_t*</code>, instead of <code>wasm_trap_t*</code>?</p>\n<p>Thanks!</p>\n</blockquote>",
        "id": 309395097,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1668292988
    },
    {
        "content": "<p>kpreisser edited <a href=\"https://github.com/bytecodealliance/wasmtime/issues/5257\">issue #5257</a>:</p>\n<blockquote>\n<p>Hi!</p>\n<p>As far as I understand the trap redesign with #5149 regarding the C API, host traps/errors created with <code>wasmtime_trap_new</code>, as well as traps caused by setting the WASI exit code (by calling WASI's <code>proc_exit</code>), are now returned as <code>wasmtime_error_t*</code> instead of <code>wasm_trap_t*</code> (e.g. with <code>wasmtime_func_call</code> and <code>wasmtime_linker_instantiate</code>); whereas only actual WASM traps that have a corresponding trap code (<code>wasmtime_trap_code_t</code>) are still returned as <code>wasm_trap_t*</code>.</p>\n<p>With #5215, the WASI exit code can now be retrieved from the <code>wasmtime_error_t*</code>.</p>\n<p>However, the unchecked variant <code>wasmtime_func_call_unchecked</code> only returns a <code>wasm_trap_t*</code>, but no <code>wasmtime_error_t*</code>. Therefore, it doesn't seem possible e.g. to extract the WASI exit code from it:<br>\n<a href=\"https://github.com/bytecodealliance/wasmtime/blob/95ca72a37ae17d33d6fa727150dab5a49011b555/crates/c-api/include/wasmtime/func.h#L244-L248\">https://github.com/bytecodealliance/wasmtime/blob/95ca72a37ae17d33d6fa727150dab5a49011b555/crates/c-api/include/wasmtime/func.h#L244-L248</a></p>\n<p>Would this require an adjustment of the C API? E.g., should <code>wasmtime_func_call_unchecked</code> additionally return a <code>wasmtime_error_t*</code>, for consistency with <code>wasmtime_func_call</code>, so that it would return host traps and WASI exit traps as <code>wasmtime_error_t*</code>, instead of <code>wasm_trap_t*</code>?</p>\n<p>Thanks!</p>\n</blockquote>",
        "id": 309398177,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1668295485
    },
    {
        "content": "<p>kpreisser edited <a href=\"https://github.com/bytecodealliance/wasmtime/issues/5257\">issue #5257</a>:</p>\n<blockquote>\n<p>Hi!</p>\n<p>As far as I understand the trap redesign with #5149 regarding the C API, host traps/errors created with <code>wasmtime_trap_new</code>, as well as traps caused by setting the WASI exit code (by calling WASI's <code>proc_exit</code>), are now returned as <code>wasmtime_error_t*</code> instead of <code>wasm_trap_t*</code> (e.g. with <code>wasmtime_func_call</code> and <code>wasmtime_linker_instantiate</code>); whereas normally only actual WASM traps that have a corresponding trap code (<code>wasmtime_trap_code_t</code>) are still returned as <code>wasm_trap_t*</code>.</p>\n<p>With #5215, the WASI exit code can now be retrieved from the <code>wasmtime_error_t*</code>.</p>\n<p>However, the unchecked variant <code>wasmtime_func_call_unchecked</code> only returns a <code>wasm_trap_t*</code>, but no <code>wasmtime_error_t*</code>. Therefore, it doesn't seem possible e.g. to extract the WASI exit code from it:<br>\n<a href=\"https://github.com/bytecodealliance/wasmtime/blob/95ca72a37ae17d33d6fa727150dab5a49011b555/crates/c-api/include/wasmtime/func.h#L244-L248\">https://github.com/bytecodealliance/wasmtime/blob/95ca72a37ae17d33d6fa727150dab5a49011b555/crates/c-api/include/wasmtime/func.h#L244-L248</a></p>\n<p>Would this require an adjustment of the C API? E.g., should <code>wasmtime_func_call_unchecked</code> additionally return a <code>wasmtime_error_t*</code>, for consistency with <code>wasmtime_func_call</code>, so that it would return host traps and WASI exit traps as <code>wasmtime_error_t*</code>, instead of <code>wasm_trap_t*</code>?</p>\n<p>Thanks!</p>\n</blockquote>",
        "id": 309398205,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1668295511
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/5257#issuecomment-1313918563\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/5257\">issue #5257</a>:</p>\n<blockquote>\n<p>Oh dear you are right, thanks for the report! I'll work on updating this API today to return the error/trap combo. I think the error/trap combo probably needs to be redone in the future since it makes less sense than it did before, but in the meantime no functionality should be lost with this prior refactoring.</p>\n</blockquote>",
        "id": 309626202,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1668439104
    },
    {
        "content": "<p>alexcrichton closed <a href=\"https://github.com/bytecodealliance/wasmtime/issues/5257\">issue #5257</a>:</p>\n<blockquote>\n<p>Hi!</p>\n<p>As far as I understand the trap redesign with #5149 regarding the C API, host traps/errors created with <code>wasmtime_trap_new</code>, as well as traps caused by setting the WASI exit code (by calling WASI's <code>proc_exit</code>), are now returned as <code>wasmtime_error_t*</code> instead of <code>wasm_trap_t*</code> (e.g. with <code>wasmtime_func_call</code> and <code>wasmtime_linker_instantiate</code>); whereas normally only actual WASM traps that have a corresponding trap code (<code>wasmtime_trap_code_t</code>) are still returned as <code>wasm_trap_t*</code>.</p>\n<p>With #5215, the WASI exit code can now be retrieved from the <code>wasmtime_error_t*</code>.</p>\n<p>However, the unchecked variant <code>wasmtime_func_call_unchecked</code> only returns a <code>wasm_trap_t*</code>, but no <code>wasmtime_error_t*</code>. Therefore, it doesn't seem possible e.g. to extract the WASI exit code from it:<br>\n<a href=\"https://github.com/bytecodealliance/wasmtime/blob/95ca72a37ae17d33d6fa727150dab5a49011b555/crates/c-api/include/wasmtime/func.h#L244-L248\">https://github.com/bytecodealliance/wasmtime/blob/95ca72a37ae17d33d6fa727150dab5a49011b555/crates/c-api/include/wasmtime/func.h#L244-L248</a></p>\n<p>Would this require an adjustment of the C API? E.g., should <code>wasmtime_func_call_unchecked</code> additionally return a <code>wasmtime_error_t*</code>, for consistency with <code>wasmtime_func_call</code>, so that it would return host traps and WASI exit traps as <code>wasmtime_error_t*</code>, instead of <code>wasm_trap_t*</code>?</p>\n<p>Thanks!</p>\n</blockquote>",
        "id": 309923991,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1668450620
    }
]