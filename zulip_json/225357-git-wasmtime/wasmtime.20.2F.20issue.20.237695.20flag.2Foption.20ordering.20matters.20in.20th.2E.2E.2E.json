[
    {
        "content": "<p>brendandburns edited <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7695\">issue #7695</a>:</p>\n<blockquote>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"o\">@</span><span class=\"n\">brendandburns</span><span class=\"w\"> </span><span class=\"err\">➜</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">workspaces</span><span class=\"o\">/</span><span class=\"n\">dev</span><span class=\"o\">-</span><span class=\"n\">wasm</span><span class=\"o\">-</span><span class=\"n\">go</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">main</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">WASMTIME_NEW_CLI</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">dir</span><span class=\"o\">=</span><span class=\"p\">.</span>::<span class=\"p\">.</span>\n<span class=\"n\">Hello</span><span class=\"w\"> </span><span class=\"n\">Go</span><span class=\"w\"> </span><span class=\"n\">World</span><span class=\"o\">!</span>\n<span class=\"n\">Error</span><span class=\"w\"> </span><span class=\"n\">writing</span><span class=\"w\"> </span><span class=\"n\">open</span><span class=\"w\"> </span><span class=\"n\">test</span><span class=\"p\">.</span><span class=\"n\">txt</span>: <span class=\"nc\">errno</span><span class=\"w\"> </span><span class=\"mi\">76</span>\n<span class=\"o\">@</span><span class=\"n\">brendandburns</span><span class=\"w\"> </span><span class=\"err\">➜</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">workspaces</span><span class=\"o\">/</span><span class=\"n\">dev</span><span class=\"o\">-</span><span class=\"n\">wasm</span><span class=\"o\">-</span><span class=\"n\">go</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">main</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">WASMTIME_NEW_CLI</span><span class=\"o\">=</span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">dir</span><span class=\"o\">=</span><span class=\"p\">.</span>\n<span class=\"n\">Hello</span><span class=\"w\"> </span><span class=\"n\">Go</span><span class=\"w\"> </span><span class=\"n\">World</span><span class=\"o\">!</span>\n<span class=\"n\">Wrote</span><span class=\"w\"> </span><span class=\"n\">file</span>\n<span class=\"n\">Copied</span><span class=\"w\"> </span><span class=\"n\">file</span>\n</code></pre></div>\n<p>Note that with the old CLI the wasm program works, with the new CLI it doesn't. I'm not sure if this is on purpose, but if it is what is the correct new syntax?</p>\n<h3>Test Case</h3>\n<p>WASM file uploaded. If you want to rebuild see:<br>\n<a href=\"https://github.com/dev-wasm/dev-wasm-go?tab=readme-ov-file#simple-example\">https://github.com/dev-wasm/dev-wasm-go?tab=readme-ov-file#simple-example</a></p>\n<h3>Versions and Environment</h3>\n<p>Wasmtime version or commit: 15.0.1</p>\n<p>Operating system: Linux</p>\n<p>Architecture: amd64</p>\n<p><a href=\"https://github.com/bytecodealliance/wasmtime/files/13688245/main.zip\">main.zip</a><br>\n</p>\n</blockquote>",
        "id": 408240203,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1702666666
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7695#issuecomment-1858367745\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7695\">issue #7695</a>:</p>\n<blockquote>\n<p>The ordering of arguments with Wasmtime has always mattered, both before and after the CLI refactor. For example in the old CLI <code>wasmtime foo.wasm arg --dir .</code> does not work because <code>--dir</code> is interpreted as an argument to <code>foo.wasm</code>, not Wasmtime. The reason for this is that the old CLI would stop feeding options to Wasmtime after <code>--</code> or after the second positional argument (in this case <code>arg</code>). The new CLI updates this to stop feeding options to Wasmtime after <code>--</code> or after the first positional argument (in this case <code>foo.wasm</code>). That's why the new CLI doesn't work with the command above and why the old CLI does.</p>\n<p>When taken literally I see how it can be concluded that Wasmtime violates the guideline that you have mentioned. Despite this though the CLI changes were done to make Wasmtime more consistent with all other tools that I at least personally know about within the space of \"execute a sub-program\" (e.g. <code>docker</code>, <code>strace</code>, <code>cargo</code>, etc). All of those commands stop feeding options to the source program after the first positional argument (e.g. <code>strace ls -l</code> doesn't pass <code>-l</code> to <code>strace</code>, it passes it to <code>ls</code>). Wasmtime is now consistently following the same semantics where it stops parsing options after the first positional argument (which for Wasmtime is always the <code>*.wasm</code> file to execute).</p>\n<p>Taken a little less literally Wasmtime is not violating the guideline you highlighted. Wasmtime's option parser produces the same result no matter what order Wasmtime's own flags are passed in. For example <code>--allow-precompiled --dir .</code> is parsed the same way as <code>--dir . --allow-precompiled</code>. I say \"taken less literally\" here because it still requires all of Wasmtime's own options to come before the first positional argument, the <code>*.wasm</code> file.</p>\n<p>Regardless though the behavior you're seeing in this issue is intended and there's not currently a bug that I'm at least personally aware of, and the issue can be fixed by passing Wasmtime's own arguments before the <code>*.wasm</code> for both the old and the new CLI.</p>\n</blockquote>",
        "id": 408242420,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1702667546
    },
    {
        "content": "<p>brendandburns <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7695#issuecomment-1858373670\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7695\">issue #7695</a>:</p>\n<blockquote>\n<p>fwiw, imho the docker behavior is a bad design also. Docker explicitly introduced the <code>--</code> operator into it's CLI to help correct the (bad) decisions they had previously made.</p>\n<p>If you are looking for a counter example <code>kubectl</code> and practically every other standard unix command line tool does not behave this way.</p>\n<p>Clearly I'm not in a position to force any changes in the <code>wasmtime</code> interpretation of the command line, but I do believe (strongly) that you are violating the principal of least surprise for the majority of users who will use your tool (and be confused when it behaves differently with different CLI ordering)</p>\n</blockquote>",
        "id": 408243115,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1702667881
    },
    {
        "content": "<p>brendandburns edited a <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7695#issuecomment-1858373670\">comment</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7695\">issue #7695</a>:</p>\n<blockquote>\n<p>fwiw, imho the docker behavior is a bad design also. ~Docker explicitly introduced the <code>--</code> operator into it's CLI to help correct the (bad) decisions they had previously made.~ </p>\n<p>I should have said <code>kubectl</code>  explicitly introduced the <code>--</code> operator into it's CLI to help correct the (bad) decisions they had previously made (to match docker)</p>\n<p>If you are looking for a counter example <code>kubectl</code> and practically every other standard unix command line tool does not behave this way.</p>\n<p>Clearly I'm not in a position to force any changes in the <code>wasmtime</code> interpretation of the command line, but I do believe (strongly) that you are violating the principal of least surprise for the majority of users who will use your tool (and be confused when it behaves differently with different CLI ordering)</p>\n</blockquote>",
        "id": 408243442,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1702668021
    }
]