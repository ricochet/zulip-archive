[
    {
        "content": "<p><a href=\"https://github.com/alexcrichton\">alexcrichton</a> added the winch label to <a href=\"https://github.com/bytecodealliance/wasmtime/issues/8632\">Issue #8632</a>.</p>",
        "id": 438893840,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1715810903
    },
    {
        "content": "<p>alexcrichton opened <a href=\"https://github.com/bytecodealliance/wasmtime/issues/8632\">issue #8632</a>:</p>\n<blockquote>\n<p>Given this input:</p>\n<div class=\"codehilite\" data-code-language=\"wasm\"><pre><span></span><code>(module\n  (func (result i32 i32 i32)\n    i32.const 1\n    i32.eqz\n    f64.const 0\n    f64.const 1\n    f64.ne\n    i32.const 1111\n  )\n  (export \"d\" (func 0))\n)\n</code></pre></div>\n<p>I locally get:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">target</span><span class=\"o\">/</span><span class=\"n\">release</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">compiler</span><span class=\"o\">=</span><span class=\"n\">cranelift</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">invoke</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"n\">out</span><span class=\"p\">.</span><span class=\"n\">wat</span>\n<span class=\"n\">warning</span>: <span class=\"nc\">using</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"o\">--</span><span class=\"n\">invoke</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">with</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"n\">that</span><span class=\"w\"> </span><span class=\"n\">returns</span><span class=\"w\"> </span><span class=\"n\">values</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">experimental</span><span class=\"w\"> </span><span class=\"n\">and</span><span class=\"w\"> </span><span class=\"n\">may</span><span class=\"w\"> </span><span class=\"k\">break</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">future</span>\n<span class=\"mi\">0</span>\n<span class=\"mi\">1</span>\n<span class=\"mi\">1111</span>\n<span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">target</span><span class=\"o\">/</span><span class=\"n\">release</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">compiler</span><span class=\"o\">=</span><span class=\"n\">winch</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">invoke</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"n\">out</span><span class=\"p\">.</span><span class=\"n\">wat</span>\n<span class=\"n\">warning</span>: <span class=\"nc\">using</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"o\">--</span><span class=\"n\">invoke</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">with</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"n\">that</span><span class=\"w\"> </span><span class=\"n\">returns</span><span class=\"w\"> </span><span class=\"n\">values</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">experimental</span><span class=\"w\"> </span><span class=\"n\">and</span><span class=\"w\"> </span><span class=\"n\">may</span><span class=\"w\"> </span><span class=\"k\">break</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">future</span>\n<span class=\"mi\">0</span>\n<span class=\"mi\">0</span>\n<span class=\"mi\">1111</span>\n</code></pre></div>\n<p>Notably the second return value here, the <code>f64.ne</code> branch, differs in Winch and Cranelift. I believe that Cranelift is correct in this case, hence the bug report for winch.</p>\n<p>cc @saulecabrera </p>\n</blockquote>",
        "id": 438893842,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1715810904
    },
    {
        "content": "<p>github-actions[bot] <a href=\"https://github.com/bytecodealliance/wasmtime/issues/8632#issuecomment-2113532762\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/8632\">issue #8632</a>:</p>\n<blockquote>\n<h4>Subscribe to Label Action</h4>\n<p>cc @saulecabrera</p>\n<p>&lt;details&gt;<br>\nThis issue or pull request has been labeled: \"winch\"</p>\n<p>Thus the following users have been cc'd because of the following labels:</p>\n<ul>\n<li>saulecabrera: winch</li>\n</ul>\n<p>To subscribe or unsubscribe from this label, edit the &lt;code&gt;.github/subscribe-to-label.json&lt;/code&gt; configuration file.</p>\n<p><a href=\"https://github.com/bytecodealliance/subscribe-to-label-action\">Learn more.</a><br>\n&lt;/details&gt;</p>\n</blockquote>",
        "id": 438893895,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1715810937
    },
    {
        "content": "<p><a href=\"https://github.com/alexcrichton\">alexcrichton</a> added the fuzz-bug label to <a href=\"https://github.com/bytecodealliance/wasmtime/issues/8632\">Issue #8632</a>.</p>",
        "id": 438893924,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1715810957
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/8632#issuecomment-2113535913\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/8632\">issue #8632</a>:</p>\n<blockquote>\n<p>For reference the compiler outputs for this function are:</p>\n<p>&lt;details&gt;</p>\n<p>&lt;summary&gt;cranelift&lt;/summary&gt;</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"mi\">0000000000000000</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">wasm</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span>::<span class=\"n\">function</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span><span class=\"o\">&gt;</span>:\n       <span class=\"mi\">0</span>:       <span class=\"mi\">55</span><span class=\"w\">                      </span><span class=\"n\">push</span><span class=\"w\">   </span><span class=\"o\">%</span><span class=\"n\">rbp</span>\n<span class=\"w\">       </span><span class=\"mi\">1</span>:       <span class=\"mi\">48</span><span class=\"w\"> </span><span class=\"mi\">89</span><span class=\"w\"> </span><span class=\"n\">e5</span><span class=\"w\">                </span><span class=\"n\">mov</span><span class=\"w\">    </span><span class=\"o\">%</span><span class=\"n\">rsp</span><span class=\"p\">,</span><span class=\"o\">%</span><span class=\"n\">rbp</span>\n<span class=\"w\">       </span><span class=\"mi\">4</span>:       <span class=\"mi\">31</span><span class=\"w\"> </span><span class=\"n\">c0</span><span class=\"w\">                   </span><span class=\"n\">xor</span><span class=\"w\">    </span><span class=\"o\">%</span><span class=\"n\">eax</span><span class=\"p\">,</span><span class=\"o\">%</span><span class=\"n\">eax</span>\n<span class=\"w\">       </span><span class=\"mi\">6</span>:       <span class=\"nc\">c5</span><span class=\"w\"> </span><span class=\"n\">c1</span><span class=\"w\"> </span><span class=\"mi\">57</span><span class=\"w\"> </span><span class=\"n\">cf</span><span class=\"w\">             </span><span class=\"n\">vxorpd</span><span class=\"w\"> </span><span class=\"o\">%</span><span class=\"n\">xmm7</span><span class=\"p\">,</span><span class=\"o\">%</span><span class=\"n\">xmm7</span><span class=\"p\">,</span><span class=\"o\">%</span><span class=\"n\">xmm1</span>\n<span class=\"w\">       </span><span class=\"n\">a</span>:       <span class=\"nc\">c5</span><span class=\"w\"> </span><span class=\"n\">f9</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\">    </span><span class=\"n\">vucomisd</span><span class=\"w\"> </span><span class=\"mh\">0x1e</span><span class=\"p\">(</span><span class=\"o\">%</span><span class=\"n\">rip</span><span class=\"p\">),</span><span class=\"o\">%</span><span class=\"n\">xmm1</span><span class=\"w\">        </span>#<span class=\"w\"> </span><span class=\"mi\">30</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">wasm</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span>::<span class=\"n\">function</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span><span class=\"o\">+</span><span class=\"mh\">0x30</span><span class=\"o\">&gt;</span>\n<span class=\"w\">      </span><span class=\"mi\">11</span>:       <span class=\"mi\">00</span>\n<span class=\"w\">      </span><span class=\"mi\">12</span>:       <span class=\"mi\">40</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"mi\">9</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">c6</span><span class=\"w\">             </span><span class=\"n\">setp</span><span class=\"w\">   </span><span class=\"o\">%</span><span class=\"n\">sil</span>\n<span class=\"w\">      </span><span class=\"mi\">16</span>:       <span class=\"mi\">40</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"mi\">95</span><span class=\"w\"> </span><span class=\"n\">c7</span><span class=\"w\">             </span><span class=\"n\">setne</span><span class=\"w\">  </span><span class=\"o\">%</span><span class=\"n\">dil</span>\n<span class=\"w\">      </span><span class=\"mi\">1</span><span class=\"n\">a</span>:       <span class=\"mi\">09</span><span class=\"w\"> </span><span class=\"n\">fe</span><span class=\"w\">                   </span><span class=\"n\">or</span><span class=\"w\">     </span><span class=\"o\">%</span><span class=\"n\">edi</span><span class=\"p\">,</span><span class=\"o\">%</span><span class=\"n\">esi</span>\n<span class=\"w\">      </span><span class=\"mi\">1</span><span class=\"n\">c</span>:       <span class=\"mi\">40</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"n\">b6</span><span class=\"w\"> </span><span class=\"n\">ce</span><span class=\"w\">             </span><span class=\"n\">movzbl</span><span class=\"w\"> </span><span class=\"o\">%</span><span class=\"n\">sil</span><span class=\"p\">,</span><span class=\"o\">%</span><span class=\"n\">ecx</span>\n<span class=\"w\">      </span><span class=\"mi\">20</span>:       <span class=\"nc\">ba</span><span class=\"w\"> </span><span class=\"mi\">57</span><span class=\"w\"> </span><span class=\"mi\">04</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\">          </span><span class=\"n\">mov</span><span class=\"w\">    </span><span class=\"cp\">$</span><span class=\"mh\">0x457</span><span class=\"p\">,</span><span class=\"o\">%</span><span class=\"n\">edx</span>\n<span class=\"w\">      </span><span class=\"mi\">25</span>:       <span class=\"mi\">48</span><span class=\"w\"> </span><span class=\"mi\">89</span><span class=\"w\"> </span><span class=\"n\">ec</span><span class=\"w\">                </span><span class=\"n\">mov</span><span class=\"w\">    </span><span class=\"o\">%</span><span class=\"n\">rbp</span><span class=\"p\">,</span><span class=\"o\">%</span><span class=\"n\">rsp</span>\n<span class=\"w\">      </span><span class=\"mi\">28</span>:       <span class=\"mi\">5</span><span class=\"n\">d</span><span class=\"w\">                      </span><span class=\"n\">pop</span><span class=\"w\">    </span><span class=\"o\">%</span><span class=\"n\">rbp</span>\n<span class=\"w\">      </span><span class=\"mi\">29</span>:       <span class=\"nc\">c3</span><span class=\"w\">                      </span><span class=\"n\">ret</span>\n<span class=\"w\">        </span><span class=\"o\">..</span><span class=\"p\">.</span>\n<span class=\"w\">      </span><span class=\"mi\">36</span>:       <span class=\"nc\">f0</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"n\">f</span><span class=\"w\">                   </span><span class=\"n\">lock</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">bad</span><span class=\"p\">)</span>\n<span class=\"w\">        </span><span class=\"o\">..</span><span class=\"p\">.</span>\n</code></pre></div>\n<p>&lt;/details&gt;</p>\n<p>&lt;details&gt;</p>\n<p>&lt;summary&gt;winch&lt;/summary&gt;</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"mi\">0000000000000000</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">wasm</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span>::<span class=\"n\">function</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span><span class=\"o\">&gt;</span>:\n       <span class=\"mi\">0</span>:       <span class=\"mi\">55</span><span class=\"w\">                      </span><span class=\"n\">push</span><span class=\"w\">   </span><span class=\"o\">%</span><span class=\"n\">rbp</span>\n<span class=\"w\">       </span><span class=\"mi\">1</span>:       <span class=\"mi\">48</span><span class=\"w\"> </span><span class=\"mi\">89</span><span class=\"w\"> </span><span class=\"n\">e5</span><span class=\"w\">                </span><span class=\"n\">mov</span><span class=\"w\">    </span><span class=\"o\">%</span><span class=\"n\">rsp</span><span class=\"p\">,</span><span class=\"o\">%</span><span class=\"n\">rbp</span>\n<span class=\"w\">       </span><span class=\"mi\">4</span>:       <span class=\"mi\">4</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"mi\">8</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"mi\">08</span><span class=\"w\">             </span><span class=\"n\">mov</span><span class=\"w\">    </span><span class=\"mh\">0x8</span><span class=\"p\">(</span><span class=\"o\">%</span><span class=\"n\">rdi</span><span class=\"p\">),</span><span class=\"o\">%</span><span class=\"n\">r11</span>\n<span class=\"w\">       </span><span class=\"mi\">8</span>:       <span class=\"mi\">4</span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"mi\">8</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"n\">b</span><span class=\"w\">                </span><span class=\"n\">mov</span><span class=\"w\">    </span><span class=\"p\">(</span><span class=\"o\">%</span><span class=\"n\">r11</span><span class=\"p\">),</span><span class=\"o\">%</span><span class=\"n\">r11</span>\n<span class=\"w\">       </span><span class=\"n\">b</span>:       <span class=\"mi\">49</span><span class=\"w\"> </span><span class=\"mi\">81</span><span class=\"w\"> </span><span class=\"n\">c3</span><span class=\"w\"> </span><span class=\"mi\">24</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\">    </span><span class=\"n\">add</span><span class=\"w\">    </span><span class=\"cp\">$</span><span class=\"mh\">0x24</span><span class=\"p\">,</span><span class=\"o\">%</span><span class=\"n\">r11</span>\n<span class=\"w\">      </span><span class=\"mi\">12</span>:       <span class=\"mi\">49</span><span class=\"w\"> </span><span class=\"mi\">39</span><span class=\"w\"> </span><span class=\"n\">e3</span><span class=\"w\">                </span><span class=\"n\">cmp</span><span class=\"w\">    </span><span class=\"o\">%</span><span class=\"n\">rsp</span><span class=\"p\">,</span><span class=\"o\">%</span><span class=\"n\">r11</span>\n<span class=\"w\">      </span><span class=\"mi\">15</span>:       <span class=\"mi\">0</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"mi\">87</span><span class=\"w\"> </span><span class=\"mi\">83</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\">       </span><span class=\"n\">ja</span><span class=\"w\">     </span><span class=\"mi\">9</span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">wasm</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span>::<span class=\"n\">function</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span><span class=\"o\">+</span><span class=\"mh\">0x9e</span><span class=\"o\">&gt;</span>\n<span class=\"w\">      </span><span class=\"mi\">1</span><span class=\"n\">b</span>:       <span class=\"mi\">49</span><span class=\"w\"> </span><span class=\"mi\">89</span><span class=\"w\"> </span><span class=\"n\">fe</span><span class=\"w\">                </span><span class=\"n\">mov</span><span class=\"w\">    </span><span class=\"o\">%</span><span class=\"n\">rdi</span><span class=\"p\">,</span><span class=\"o\">%</span><span class=\"n\">r14</span>\n<span class=\"w\">      </span><span class=\"mi\">1</span><span class=\"n\">e</span>:       <span class=\"mi\">48</span><span class=\"w\"> </span><span class=\"mi\">83</span><span class=\"w\"> </span><span class=\"n\">ec</span><span class=\"w\"> </span><span class=\"mi\">18</span><span class=\"w\">             </span><span class=\"n\">sub</span><span class=\"w\">    </span><span class=\"cp\">$</span><span class=\"mh\">0x18</span><span class=\"p\">,</span><span class=\"o\">%</span><span class=\"n\">rsp</span>\n<span class=\"w\">      </span><span class=\"mi\">22</span>:       <span class=\"mi\">48</span><span class=\"w\"> </span><span class=\"mi\">89</span><span class=\"w\"> </span><span class=\"mi\">7</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"mi\">24</span><span class=\"w\"> </span><span class=\"mi\">10</span><span class=\"w\">          </span><span class=\"n\">mov</span><span class=\"w\">    </span><span class=\"o\">%</span><span class=\"n\">rdi</span><span class=\"p\">,</span><span class=\"mh\">0x10</span><span class=\"p\">(</span><span class=\"o\">%</span><span class=\"n\">rsp</span><span class=\"p\">)</span>\n<span class=\"w\">      </span><span class=\"mi\">27</span>:       <span class=\"mi\">48</span><span class=\"w\"> </span><span class=\"mi\">89</span><span class=\"w\"> </span><span class=\"mi\">74</span><span class=\"w\"> </span><span class=\"mi\">24</span><span class=\"w\"> </span><span class=\"mi\">08</span><span class=\"w\">          </span><span class=\"n\">mov</span><span class=\"w\">    </span><span class=\"o\">%</span><span class=\"n\">rsi</span><span class=\"p\">,</span><span class=\"mh\">0x8</span><span class=\"p\">(</span><span class=\"o\">%</span><span class=\"n\">rsp</span><span class=\"p\">)</span>\n<span class=\"w\">      </span><span class=\"mi\">2</span><span class=\"n\">c</span>:       <span class=\"mi\">48</span><span class=\"w\"> </span><span class=\"mi\">89</span><span class=\"w\"> </span><span class=\"mi\">14</span><span class=\"w\"> </span><span class=\"mi\">24</span><span class=\"w\">             </span><span class=\"n\">mov</span><span class=\"w\">    </span><span class=\"o\">%</span><span class=\"n\">rdx</span><span class=\"p\">,(</span><span class=\"o\">%</span><span class=\"n\">rsp</span><span class=\"p\">)</span>\n<span class=\"w\">      </span><span class=\"mi\">30</span>:       <span class=\"nc\">b8</span><span class=\"w\"> </span><span class=\"mi\">01</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\">          </span><span class=\"n\">mov</span><span class=\"w\">    </span><span class=\"cp\">$</span><span class=\"mh\">0x1</span><span class=\"p\">,</span><span class=\"o\">%</span><span class=\"n\">eax</span>\n<span class=\"w\">      </span><span class=\"mi\">35</span>:       <span class=\"mi\">83</span><span class=\"w\"> </span><span class=\"n\">f8</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\">                </span><span class=\"n\">cmp</span><span class=\"w\">    </span><span class=\"cp\">$</span><span class=\"mh\">0x0</span><span class=\"p\">,</span><span class=\"o\">%</span><span class=\"n\">eax</span>\n<span class=\"w\">      </span><span class=\"mi\">38</span>:       <span class=\"nc\">b8</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\">          </span><span class=\"n\">mov</span><span class=\"w\">    </span><span class=\"cp\">$</span><span class=\"mh\">0x0</span><span class=\"p\">,</span><span class=\"o\">%</span><span class=\"n\">eax</span>\n<span class=\"w\">      </span><span class=\"mi\">3</span><span class=\"n\">d</span>:       <span class=\"mi\">40</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"mi\">94</span><span class=\"w\"> </span><span class=\"n\">c0</span><span class=\"w\">             </span><span class=\"n\">rex</span><span class=\"w\"> </span><span class=\"n\">sete</span><span class=\"w\"> </span><span class=\"o\">%</span><span class=\"n\">al</span>\n<span class=\"w\">      </span><span class=\"mi\">41</span>:       <span class=\"nc\">f2</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"mi\">10</span><span class=\"w\"> </span><span class=\"mi\">05</span><span class=\"w\"> </span><span class=\"mi\">57</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\">    </span><span class=\"n\">movsd</span><span class=\"w\">  </span><span class=\"mh\">0x57</span><span class=\"p\">(</span><span class=\"o\">%</span><span class=\"n\">rip</span><span class=\"p\">),</span><span class=\"o\">%</span><span class=\"n\">xmm0</span><span class=\"w\">        </span>#<span class=\"w\"> </span><span class=\"n\">a0</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">wasm</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span>::<span class=\"n\">function</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span><span class=\"o\">+</span><span class=\"mh\">0xa0</span><span class=\"o\">&gt;</span>\n<span class=\"w\">      </span><span class=\"mi\">48</span>:       <span class=\"mi\">00</span>\n<span class=\"w\">      </span><span class=\"mi\">49</span>:       <span class=\"nc\">f2</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"mi\">10</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"mi\">57</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\">    </span><span class=\"n\">movsd</span><span class=\"w\">  </span><span class=\"mh\">0x57</span><span class=\"p\">(</span><span class=\"o\">%</span><span class=\"n\">rip</span><span class=\"p\">),</span><span class=\"o\">%</span><span class=\"n\">xmm1</span><span class=\"w\">        </span>#<span class=\"w\"> </span><span class=\"n\">a8</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">wasm</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span>::<span class=\"n\">function</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span><span class=\"o\">+</span><span class=\"mh\">0xa8</span><span class=\"o\">&gt;</span>\n<span class=\"w\">      </span><span class=\"mi\">50</span>:       <span class=\"mi\">00</span>\n<span class=\"w\">      </span><span class=\"mi\">51</span>:       <span class=\"mi\">66</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"n\">e</span><span class=\"w\"> </span><span class=\"n\">c8</span><span class=\"w\">             </span><span class=\"n\">ucomisd</span><span class=\"w\"> </span><span class=\"o\">%</span><span class=\"n\">xmm0</span><span class=\"p\">,</span><span class=\"o\">%</span><span class=\"n\">xmm1</span>\n<span class=\"w\">      </span><span class=\"mi\">55</span>:       <span class=\"nc\">b9</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\">          </span><span class=\"n\">mov</span><span class=\"w\">    </span><span class=\"cp\">$</span><span class=\"mh\">0x0</span><span class=\"p\">,</span><span class=\"o\">%</span><span class=\"n\">ecx</span>\n<span class=\"w\">      </span><span class=\"mi\">5</span><span class=\"n\">a</span>:       <span class=\"mi\">40</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"mi\">95</span><span class=\"w\"> </span><span class=\"n\">c1</span><span class=\"w\">             </span><span class=\"n\">rex</span><span class=\"w\"> </span><span class=\"n\">setne</span><span class=\"w\"> </span><span class=\"o\">%</span><span class=\"n\">cl</span>\n<span class=\"w\">      </span><span class=\"mi\">5</span><span class=\"n\">e</span>:       <span class=\"mi\">41</span><span class=\"w\"> </span><span class=\"n\">bb</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\">       </span><span class=\"n\">mov</span><span class=\"w\">    </span><span class=\"cp\">$</span><span class=\"mh\">0x0</span><span class=\"p\">,</span><span class=\"o\">%</span><span class=\"n\">r11d</span>\n<span class=\"w\">      </span><span class=\"mi\">64</span>:       <span class=\"mi\">41</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"mi\">9</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">c3</span><span class=\"w\">             </span><span class=\"n\">setp</span><span class=\"w\">   </span><span class=\"o\">%</span><span class=\"n\">r11b</span>\n<span class=\"w\">      </span><span class=\"mi\">68</span>:       <span class=\"mi\">4</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"mi\">09</span><span class=\"w\"> </span><span class=\"n\">d9</span><span class=\"w\">                </span><span class=\"n\">or</span><span class=\"w\">     </span><span class=\"o\">%</span><span class=\"n\">r11</span><span class=\"p\">,</span><span class=\"o\">%</span><span class=\"n\">rcx</span>\n<span class=\"w\">      </span><span class=\"mi\">6</span><span class=\"n\">b</span>:       <span class=\"mi\">48</span><span class=\"w\"> </span><span class=\"mi\">83</span><span class=\"w\"> </span><span class=\"n\">ec</span><span class=\"w\"> </span><span class=\"mi\">04</span><span class=\"w\">             </span><span class=\"n\">sub</span><span class=\"w\">    </span><span class=\"cp\">$</span><span class=\"mh\">0x4</span><span class=\"p\">,</span><span class=\"o\">%</span><span class=\"n\">rsp</span>\n<span class=\"w\">      </span><span class=\"mi\">6</span><span class=\"n\">f</span>:       <span class=\"mi\">89</span><span class=\"w\"> </span><span class=\"mi\">04</span><span class=\"w\"> </span><span class=\"mi\">24</span><span class=\"w\">                </span><span class=\"n\">mov</span><span class=\"w\">    </span><span class=\"o\">%</span><span class=\"n\">eax</span><span class=\"p\">,(</span><span class=\"o\">%</span><span class=\"n\">rsp</span><span class=\"p\">)</span>\n<span class=\"w\">      </span><span class=\"mi\">72</span>:       <span class=\"mi\">51</span><span class=\"w\">                      </span><span class=\"n\">push</span><span class=\"w\">   </span><span class=\"o\">%</span><span class=\"n\">rcx</span>\n<span class=\"w\">      </span><span class=\"mi\">73</span>:       <span class=\"nc\">b8</span><span class=\"w\"> </span><span class=\"mi\">57</span><span class=\"w\"> </span><span class=\"mi\">04</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\">          </span><span class=\"n\">mov</span><span class=\"w\">    </span><span class=\"cp\">$</span><span class=\"mh\">0x457</span><span class=\"p\">,</span><span class=\"o\">%</span><span class=\"n\">eax</span>\n<span class=\"w\">      </span><span class=\"mi\">78</span>:       <span class=\"mi\">48</span><span class=\"w\"> </span><span class=\"mi\">83</span><span class=\"w\"> </span><span class=\"n\">c4</span><span class=\"w\"> </span><span class=\"mi\">04</span><span class=\"w\">             </span><span class=\"n\">add</span><span class=\"w\">    </span><span class=\"cp\">$</span><span class=\"mh\">0x4</span><span class=\"p\">,</span><span class=\"o\">%</span><span class=\"n\">rsp</span>\n<span class=\"w\">      </span><span class=\"mi\">7</span><span class=\"n\">c</span>:       <span class=\"mi\">48</span><span class=\"w\"> </span><span class=\"mi\">8</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"mi\">24</span><span class=\"w\"> </span><span class=\"mi\">08</span><span class=\"w\">          </span><span class=\"n\">mov</span><span class=\"w\">    </span><span class=\"mh\">0x8</span><span class=\"p\">(</span><span class=\"o\">%</span><span class=\"n\">rsp</span><span class=\"p\">),</span><span class=\"o\">%</span><span class=\"n\">rcx</span>\n<span class=\"w\">      </span><span class=\"mi\">81</span>:       <span class=\"mi\">44</span><span class=\"w\"> </span><span class=\"mi\">8</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"mi\">24</span><span class=\"w\">             </span><span class=\"n\">mov</span><span class=\"w\">    </span><span class=\"p\">(</span><span class=\"o\">%</span><span class=\"n\">rsp</span><span class=\"p\">),</span><span class=\"o\">%</span><span class=\"n\">r11d</span>\n<span class=\"w\">      </span><span class=\"mi\">85</span>:       <span class=\"mi\">48</span><span class=\"w\"> </span><span class=\"mi\">83</span><span class=\"w\"> </span><span class=\"n\">c4</span><span class=\"w\"> </span><span class=\"mi\">04</span><span class=\"w\">             </span><span class=\"n\">add</span><span class=\"w\">    </span><span class=\"cp\">$</span><span class=\"mh\">0x4</span><span class=\"p\">,</span><span class=\"o\">%</span><span class=\"n\">rsp</span>\n<span class=\"w\">      </span><span class=\"mi\">89</span>:       <span class=\"mi\">44</span><span class=\"w\"> </span><span class=\"mi\">89</span><span class=\"w\"> </span><span class=\"mi\">19</span><span class=\"w\">                </span><span class=\"n\">mov</span><span class=\"w\">    </span><span class=\"o\">%</span><span class=\"n\">r11d</span><span class=\"p\">,(</span><span class=\"o\">%</span><span class=\"n\">rcx</span><span class=\"p\">)</span>\n<span class=\"w\">      </span><span class=\"mi\">8</span><span class=\"n\">c</span>:       <span class=\"mi\">44</span><span class=\"w\"> </span><span class=\"mi\">8</span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"mi\">24</span><span class=\"w\">             </span><span class=\"n\">mov</span><span class=\"w\">    </span><span class=\"p\">(</span><span class=\"o\">%</span><span class=\"n\">rsp</span><span class=\"p\">),</span><span class=\"o\">%</span><span class=\"n\">r11d</span>\n<span class=\"w\">      </span><span class=\"mi\">90</span>:       <span class=\"mi\">48</span><span class=\"w\"> </span><span class=\"mi\">83</span><span class=\"w\"> </span><span class=\"n\">c4</span><span class=\"w\"> </span><span class=\"mi\">04</span><span class=\"w\">             </span><span class=\"n\">add</span><span class=\"w\">    </span><span class=\"cp\">$</span><span class=\"mh\">0x4</span><span class=\"p\">,</span><span class=\"o\">%</span><span class=\"n\">rsp</span>\n<span class=\"w\">      </span><span class=\"mi\">94</span>:       <span class=\"mi\">44</span><span class=\"w\"> </span><span class=\"mi\">89</span><span class=\"w\"> </span><span class=\"mi\">59</span><span class=\"w\"> </span><span class=\"mi\">04</span><span class=\"w\">             </span><span class=\"n\">mov</span><span class=\"w\">    </span><span class=\"o\">%</span><span class=\"n\">r11d</span><span class=\"p\">,</span><span class=\"mh\">0x4</span><span class=\"p\">(</span><span class=\"o\">%</span><span class=\"n\">rcx</span><span class=\"p\">)</span>\n<span class=\"w\">      </span><span class=\"mi\">98</span>:       <span class=\"mi\">48</span><span class=\"w\"> </span><span class=\"mi\">83</span><span class=\"w\"> </span><span class=\"n\">c4</span><span class=\"w\"> </span><span class=\"mi\">18</span><span class=\"w\">             </span><span class=\"n\">add</span><span class=\"w\">    </span><span class=\"cp\">$</span><span class=\"mh\">0x18</span><span class=\"p\">,</span><span class=\"o\">%</span><span class=\"n\">rsp</span>\n<span class=\"w\">      </span><span class=\"mi\">9</span><span class=\"n\">c</span>:       <span class=\"mi\">5</span><span class=\"n\">d</span><span class=\"w\">                      </span><span class=\"n\">pop</span><span class=\"w\">    </span><span class=\"o\">%</span><span class=\"n\">rbp</span>\n<span class=\"w\">      </span><span class=\"mi\">9</span><span class=\"n\">d</span>:       <span class=\"nc\">c3</span><span class=\"w\">                      </span><span class=\"n\">ret</span>\n<span class=\"w\">      </span><span class=\"mi\">9</span><span class=\"n\">e</span>:       <span class=\"mi\">0</span><span class=\"n\">f</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"n\">b</span><span class=\"w\">                   </span><span class=\"n\">ud2</span>\n<span class=\"w\">      </span><span class=\"n\">a0</span>:       <span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\">                   </span><span class=\"n\">add</span><span class=\"w\">    </span><span class=\"o\">%</span><span class=\"n\">al</span><span class=\"p\">,(</span><span class=\"o\">%</span><span class=\"n\">rax</span><span class=\"p\">)</span>\n<span class=\"w\">      </span><span class=\"n\">a2</span>:       <span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\">                   </span><span class=\"n\">add</span><span class=\"w\">    </span><span class=\"o\">%</span><span class=\"n\">al</span><span class=\"p\">,(</span><span class=\"o\">%</span><span class=\"n\">rax</span><span class=\"p\">)</span>\n<span class=\"w\">      </span><span class=\"n\">a4</span>:       <span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\">                   </span><span class=\"n\">add</span><span class=\"w\">    </span><span class=\"o\">%</span><span class=\"n\">al</span><span class=\"p\">,(</span><span class=\"o\">%</span><span class=\"n\">rax</span><span class=\"p\">)</span>\n<span class=\"w\">      </span><span class=\"n\">a6</span>:       <span class=\"nc\">f0</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"n\">f</span><span class=\"w\">                   </span><span class=\"n\">lock</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">bad</span><span class=\"p\">)</span>\n<span class=\"w\">        </span><span class=\"o\">..</span><span class=\"p\">.</span>\n</code></pre></div>\n<p>&lt;/details&gt;</p>\n</blockquote>",
        "id": 438894145,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1715811068
    },
    {
        "content": "<p>saulecabrera assigned saulecabrera to <a href=\"https://github.com/bytecodealliance/wasmtime/issues/8632\">issue #8632</a>.</p>",
        "id": 438896253,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1715812177
    },
    {
        "content": "<p>saulecabrera <a href=\"https://github.com/bytecodealliance/wasmtime/issues/8632#issuecomment-2115218516\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/8632\">issue #8632</a>:</p>\n<blockquote>\n<p>Thanks for catching this one, Alex! I'll take a look. </p>\n</blockquote>",
        "id": 439017882,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1715865306
    },
    {
        "content": "<p>saulecabrera <a href=\"https://github.com/bytecodealliance/wasmtime/issues/8632#issuecomment-2124843678\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/8632\">issue #8632</a>:</p>\n<blockquote>\n<p>A quick update: I've identified the root cause and I'm working on fix. There's a bug in the <a href=\"https://github.com/bytecodealliance/wasmtime/blob/main/winch/codegen/src/codegen/control.rs#L763\">stack shuffling algorithm</a> which is causing truncation of values when handling multi-value returns. </p>\n</blockquote>",
        "id": 440095745,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1716385605
    },
    {
        "content": "<p>saulecabrera <a href=\"https://github.com/bytecodealliance/wasmtime/issues/8632#issuecomment-2125998119\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/8632\">issue #8632</a>:</p>\n<blockquote>\n<p>The stack shuffling algorithm was a bit of a red herring. Here's a fix: <a href=\"https://github.com/bytecodealliance/wasmtime/pull/8685/files\">https://github.com/bytecodealliance/wasmtime/pull/8685/files</a></p>\n</blockquote>",
        "id": 440212178,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1716425164
    },
    {
        "content": "<p>saulecabrera closed <a href=\"https://github.com/bytecodealliance/wasmtime/issues/8632\">issue #8632</a>:</p>\n<blockquote>\n<p>Given this input:</p>\n<div class=\"codehilite\" data-code-language=\"wasm\"><pre><span></span><code>(module\n  (func (result i32 i32 i32)\n    i32.const 1\n    i32.eqz\n    f64.const 0\n    f64.const 1\n    f64.ne\n    i32.const 1111\n  )\n  (export \"d\" (func 0))\n)\n</code></pre></div>\n<p>I locally get:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">target</span><span class=\"o\">/</span><span class=\"n\">release</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">compiler</span><span class=\"o\">=</span><span class=\"n\">cranelift</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">invoke</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"n\">out</span><span class=\"p\">.</span><span class=\"n\">wat</span>\n<span class=\"n\">warning</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">using</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"o\">--</span><span class=\"n\">invoke</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">with</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"n\">that</span><span class=\"w\"> </span><span class=\"n\">returns</span><span class=\"w\"> </span><span class=\"n\">values</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">experimental</span><span class=\"w\"> </span><span class=\"n\">and</span><span class=\"w\"> </span><span class=\"n\">may</span><span class=\"w\"> </span><span class=\"k\">break</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">future</span>\n<span class=\"mi\">0</span>\n<span class=\"mi\">1</span>\n<span class=\"mi\">1111</span>\n<span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">target</span><span class=\"o\">/</span><span class=\"n\">release</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">compiler</span><span class=\"o\">=</span><span class=\"n\">winch</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">invoke</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"n\">out</span><span class=\"p\">.</span><span class=\"n\">wat</span>\n<span class=\"n\">warning</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">using</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"o\">--</span><span class=\"n\">invoke</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">with</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"n\">that</span><span class=\"w\"> </span><span class=\"n\">returns</span><span class=\"w\"> </span><span class=\"n\">values</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">experimental</span><span class=\"w\"> </span><span class=\"n\">and</span><span class=\"w\"> </span><span class=\"n\">may</span><span class=\"w\"> </span><span class=\"k\">break</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">future</span>\n<span class=\"mi\">0</span>\n<span class=\"mi\">0</span>\n<span class=\"mi\">1111</span>\n</code></pre></div>\n<p>Notably the second return value here, the <code>f64.ne</code> branch, differs in Winch and Cranelift. I believe that Cranelift is correct in this case, hence the bug report for winch.</p>\n<p>cc @saulecabrera </p>\n</blockquote>",
        "id": 440341632,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1716476240
    }
]