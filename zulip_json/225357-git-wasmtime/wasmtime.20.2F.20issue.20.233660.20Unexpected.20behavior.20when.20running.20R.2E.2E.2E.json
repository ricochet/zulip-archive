[
    {
        "content": "<p>KernelErr labeled <a href=\"https://github.com/bytecodealliance/wasmtime/issues/3660\">issue #3660</a>:</p>\n<blockquote>\n<h3>Test Case</h3>\n<p><a href=\"https://github.com/bytecodealliance/wasmtime/files/7827003/rustpython.wasm.zip\">rustpython.wasm.zip</a></p>\n<p>Compiled RustPython.</p>\n<h3>Steps to Reproduce</h3>\n<p>Input any wrong python syntax like:</p>\n<p>![image](<a href=\"https://user-images.githubusercontent.com/45716019/148503714-2a11531e-848b-4196-b26d-aee79a12dded.png\">https://user-images.githubusercontent.com/45716019/148503714-2a11531e-848b-4196-b26d-aee79a12dded.png</a>)</p>\n<h3>Expected Results</h3>\n<p>There should be a Python error pointing out a syntax error.</p>\n<h3>Actual Results</h3>\n<p>Syntax errors could not be printed out in time.</p>\n<h3>Versions and Environment</h3>\n<p>Wasmtime version or commit: 0.33.0</p>\n<p>Operating system: Linux</p>\n<p>Architecture: amd64</p>\n<h3>Extra Info</h3>\n<p>On other runtimes, there could be current output.</p>\n<p>![image](<a href=\"https://user-images.githubusercontent.com/45716019/148503910-48c4cfc3-3df2-4d60-a028-9527a3ee8d4f.png\">https://user-images.githubusercontent.com/45716019/148503910-48c4cfc3-3df2-4d60-a028-9527a3ee8d4f.png</a>)</p>\n</blockquote>",
        "id": 267156884,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1641538378
    },
    {
        "content": "<p>KernelErr opened <a href=\"https://github.com/bytecodealliance/wasmtime/issues/3660\">issue #3660</a>:</p>\n<blockquote>\n<h3>Test Case</h3>\n<p><a href=\"https://github.com/bytecodealliance/wasmtime/files/7827003/rustpython.wasm.zip\">rustpython.wasm.zip</a></p>\n<p>Compiled RustPython.</p>\n<h3>Steps to Reproduce</h3>\n<p>Input any wrong python syntax like:</p>\n<p>![image](<a href=\"https://user-images.githubusercontent.com/45716019/148503714-2a11531e-848b-4196-b26d-aee79a12dded.png\">https://user-images.githubusercontent.com/45716019/148503714-2a11531e-848b-4196-b26d-aee79a12dded.png</a>)</p>\n<h3>Expected Results</h3>\n<p>There should be a Python error pointing out a syntax error.</p>\n<h3>Actual Results</h3>\n<p>Syntax errors could not be printed out in time.</p>\n<h3>Versions and Environment</h3>\n<p>Wasmtime version or commit: 0.33.0</p>\n<p>Operating system: Linux</p>\n<p>Architecture: amd64</p>\n<h3>Extra Info</h3>\n<p>On other runtimes, there could be current output.</p>\n<p>![image](<a href=\"https://user-images.githubusercontent.com/45716019/148503910-48c4cfc3-3df2-4d60-a028-9527a3ee8d4f.png\">https://user-images.githubusercontent.com/45716019/148503910-48c4cfc3-3df2-4d60-a028-9527a3ee8d4f.png</a>)</p>\n</blockquote>",
        "id": 267156885,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1641538378
    },
    {
        "content": "<p>KernelErr edited <a href=\"https://github.com/bytecodealliance/wasmtime/issues/3660\">issue #3660</a>:</p>\n<blockquote>\n<h3>Test Case</h3>\n<p><a href=\"https://github.com/bytecodealliance/wasmtime/files/7827003/rustpython.wasm.zip\">rustpython.wasm.zip</a></p>\n<p>Compiled RustPython.</p>\n<h3>Steps to Reproduce</h3>\n<p>Input any wrong python syntax like:</p>\n<p>![image](<a href=\"https://user-images.githubusercontent.com/45716019/148503714-2a11531e-848b-4196-b26d-aee79a12dded.png\">https://user-images.githubusercontent.com/45716019/148503714-2a11531e-848b-4196-b26d-aee79a12dded.png</a>)</p>\n<h3>Expected Results</h3>\n<p>There should be a syntax error right after the wrong line.</p>\n<h3>Actual Results</h3>\n<p>Syntax errors could not be printed out in time.</p>\n<h3>Versions and Environment</h3>\n<p>Wasmtime version or commit: 0.33.0</p>\n<p>Operating system: Linux</p>\n<p>Architecture: amd64</p>\n<h3>Extra Info</h3>\n<p>On other runtimes, there could be correct output.</p>\n<p>![image](<a href=\"https://user-images.githubusercontent.com/45716019/148503910-48c4cfc3-3df2-4d60-a028-9527a3ee8d4f.png\">https://user-images.githubusercontent.com/45716019/148503910-48c4cfc3-3df2-4d60-a028-9527a3ee8d4f.png</a>)</p>\n</blockquote>",
        "id": 267156912,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1641538436
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/3660#issuecomment-1007505395\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/3660\">issue #3660</a>:</p>\n<blockquote>\n<p>Thanks for the report, are you able to share the source for how this module was built? Testing locally it appears that Wasmtime is doing the right thing with respect to the WASI API calls made. It may be a difference in WASI behavior between runtimes, though, causing this issue.</p>\n</blockquote>",
        "id": 267203348,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1641569970
    },
    {
        "content": "<p>KernelErr <a href=\"https://github.com/bytecodealliance/wasmtime/issues/3660#issuecomment-1007520366\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/3660\">issue #3660</a>:</p>\n<blockquote>\n<p>Hi, I am using code from RustPython's pr 3514(<a href=\"https://github.com/RustPython/RustPython/pull/3514\">https://github.com/RustPython/RustPython/pull/3514</a>). That's because I opened issue 3513 for it.</p>\n<p>After cloning the RustPython repo, I used GitHub CLI to checkout the pr and ran the following command to build:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">cargo</span><span class=\"w\"> </span><span class=\"n\">build</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">release</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">target</span><span class=\"w\"> </span><span class=\"n\">wasm32</span><span class=\"o\">-</span><span class=\"n\">wasi</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">features</span><span class=\"o\">=</span><span class=\"s\">\"freeze-stdlib\"</span><span class=\"w\"></span>\n</code></pre></div>\n<p>I built it again, and the problem still exists.</p>\n<p>![image](<a href=\"https://user-images.githubusercontent.com/45716019/148570101-54e0332a-40a5-4e20-a8a2-157c87ff18fc.png\">https://user-images.githubusercontent.com/45716019/148570101-54e0332a-40a5-4e20-a8a2-157c87ff18fc.png</a>)</p>\n</blockquote>",
        "id": 267205295,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1641570994
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/3660#issuecomment-1007761307\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/3660\">issue #3660</a>:</p>\n<blockquote>\n<p>cc @sunfishcode and @pchickey, this all boils down to <code>isatty({0,1,2})</code> which is a mixture of:</p>\n<ul>\n<li><a href=\"https://github.com/WebAssembly/wasi-libc/blob/ad5133410f66b93a2381db5b542aad5e0964db96/libc-bottom-half/sources/isatty.c\"><code>isatty</code> in wasi-libc</a></li>\n<li><a href=\"https://github.com/bytecodealliance/wasmtime/blob/ab1d845ac164813a595b2820da2994968af76b32/crates/wasi-common/src/ctx.rs#L73-L83\">default rights for stdio in wasi-common set to <code>::all()</code></a></li>\n<li><a href=\"https://github.com/bytecodealliance/wasmtime/blob/ab1d845ac164813a595b2820da2994968af76b32/crates/wasi-common/cap-std-sync/src/stdio.rs#L140-L142\">stdio types having an <code>Unknown</code> file type</a></li>\n</ul>\n<p>It looks like the <code>rustpython.wasm</code> is differing its behavior based on whether the stdin/stdout/stderr are a tty, and that basically affects buffering which means that the error being expected here is buffered to be printed later. The test for <code>isatty</code> in <code>wasi-libc</code> needs two modifications in <code>wasi-common</code> to clear checks, one being changing <code>Unknown</code> to something not-unknown, and another being removing rights from the stdio descriptors.</p>\n<p>I don't really know where the bug here is. A lot of this is basically legacy I think and there's not really a crisp-and-clear definition of what everything should be. There's not really a bug in Wasmtime per-se, it's just that our stdio descriptors don't look like something that rustpython is expecting and as a result rustpython behaves oddly.</p>\n</blockquote>",
        "id": 267246396,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1641591833
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/3660#issuecomment-1034075805\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/3660\">issue #3660</a>:</p>\n<blockquote>\n<p>I think this was fixed in <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3696\">https://github.com/bytecodealliance/wasmtime/pull/3696</a>, so closing.</p>\n</blockquote>",
        "id": 271326992,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1644431890
    },
    {
        "content": "<p>alexcrichton closed <a href=\"https://github.com/bytecodealliance/wasmtime/issues/3660\">issue #3660</a>:</p>\n<blockquote>\n<h3>Test Case</h3>\n<p><a href=\"https://github.com/bytecodealliance/wasmtime/files/7827003/rustpython.wasm.zip\">rustpython.wasm.zip</a></p>\n<p>Compiled RustPython.</p>\n<h3>Steps to Reproduce</h3>\n<p>Input any wrong python syntax like:</p>\n<p>![image](<a href=\"https://user-images.githubusercontent.com/45716019/148503714-2a11531e-848b-4196-b26d-aee79a12dded.png\">https://user-images.githubusercontent.com/45716019/148503714-2a11531e-848b-4196-b26d-aee79a12dded.png</a>)</p>\n<h3>Expected Results</h3>\n<p>There should be a syntax error right after the wrong line.</p>\n<h3>Actual Results</h3>\n<p>Syntax errors could not be printed out in time.</p>\n<h3>Versions and Environment</h3>\n<p>Wasmtime version or commit: 0.33.0</p>\n<p>Operating system: Linux</p>\n<p>Architecture: amd64</p>\n<h3>Extra Info</h3>\n<p>On other runtimes, there could be correct output.</p>\n<p>![image](<a href=\"https://user-images.githubusercontent.com/45716019/148503910-48c4cfc3-3df2-4d60-a028-9527a3ee8d4f.png\">https://user-images.githubusercontent.com/45716019/148503910-48c4cfc3-3df2-4d60-a028-9527a3ee8d4f.png</a>)</p>\n</blockquote>",
        "id": 271326995,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1644431890
    }
]