[
    {
        "content": "<p>kubkon edited <a href=\"https://github.com/bytecodealliance/wasmtime/pull/1253\" target=\"_blank\" title=\"https://github.com/bytecodealliance/wasmtime/pull/1253\">PR #1253</a> from <code>error-cleanup</code> to <code>master</code>:</p>\n<blockquote>\n<p><code>WasiCtxBuilderError</code> is the <code>wasi-common</code> client-facing error type which is exclusively thrown when building a new <code>WasiCtx</code> instance. As such, building such an instance should not require the client to understand different WASI errno values as was assumed until now.</p>\n<p>This commit is a first step at streamlining error handling in <code>wasi-common</code> and makes way for the <code>wiggle</code> crate.</p>\n<p>When adding the <code>WasiCtxBuilderError</code>, I've had to do two things of notable importance:</p>\n<ol>\n<li>I've removed a couple of <code>ok_or</code> calls in <code>WasiCtxBuilder::build</code> and replaced them with <code>unwrap</code>s, following the same pattern in different builder methods above. This is fine since we _always_ operate on non-empty <code>Option</code>s in <code>WasiCtxBuilder</code> thus <code>unwrap</code>ing will never fail. On the other hand, this might be a good opportunity to rethink the structure of our builder, and how we good remove the said <code>Option</code>s especially since we always populate them with empty containers to begin with. I understand this is to make chaining of builder methods easier which take and return <code>&amp;mut self</code> and the same applies to <code>WasiCtxBuilder::build(&amp;mut self)</code> method, but perhaps it would more cleanly signal the intentions if we simply moved <code>WasiCtxBuilder</code> instance around. Food for thought!</li>\n<li>Methods specific to determining rights of passed around <code>std::fs::File</code> objects when populating <code>WasiCtx</code> <code>FdEntry</code> entities now return <code>io::Error</code> directly so that we can reuse them in <code>WasiCtxBuilder</code> methods (returning <code>WasiCtxBuilderError</code> error type), and in syscalls (returning WASI errno).</li>\n</ol>\n<p>With <code>WasiCtxBuilderError</code> in place, we now can return a pure <code>WasiError</code> in all syscalls-related functions. This means we can completely remove <code>error::Error</code> type, and now, <code>io::Error</code> and<br>\nrelated are automatically converted to their corresponding WASI errno value encapsulated as <code>WasiError</code>. IMHO this makes tracking errors in syscalls a lot cleaner and simpler.</p>\n<p>While here, it also made sense to me to move <code>WasiError</code> to <code>wasi</code> module which will align itself well with the upcoming changes introduced by <code>wiggle</code>. To different standard <code>Result</code> from WASI specific, I've created a helper alias <code>WasiResult</code> also residing in <code>wasi</code> module.</p>\n<h3>Prereqs:</h3>\n<p>OK, while technically we only depend on #1243 since we're rebased on it, it'd be best if we landed #1255 before as well. So:</p>\n<ul>\n<li>[ ] #1243 landed</li>\n<li>[ ] #1255 landed</li>\n</ul>\n<h3>ToDo:</h3>\n<ul>\n<li>[x] introduce <code>WasiCtxBuilderError</code></li>\n<li>[x] return <code>WasiError</code> directly in syscalls</li>\n<li>[x] hence remove <code>error::Error</code> type</li>\n<li>[x] fix <code>wig</code></li>\n</ul>\n</blockquote>",
        "id": 189984866,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1583612869
    },
    {
        "content": "<p>kubkon updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/1253\" target=\"_blank\" title=\"https://github.com/bytecodealliance/wasmtime/pull/1253\">PR #1253</a> from <code>error-cleanup</code> to <code>master</code>:</p>\n<blockquote>\n<p><code>WasiCtxBuilderError</code> is the <code>wasi-common</code> client-facing error type which is exclusively thrown when building a new <code>WasiCtx</code> instance. As such, building such an instance should not require the client to understand different WASI errno values as was assumed until now.</p>\n<p>This commit is a first step at streamlining error handling in <code>wasi-common</code> and makes way for the <code>wiggle</code> crate.</p>\n<p>When adding the <code>WasiCtxBuilderError</code>, I've had to do two things of notable importance:</p>\n<ol>\n<li>I've removed a couple of <code>ok_or</code> calls in <code>WasiCtxBuilder::build</code> and replaced them with <code>unwrap</code>s, following the same pattern in different builder methods above. This is fine since we _always_ operate on non-empty <code>Option</code>s in <code>WasiCtxBuilder</code> thus <code>unwrap</code>ing will never fail. On the other hand, this might be a good opportunity to rethink the structure of our builder, and how we good remove the said <code>Option</code>s especially since we always populate them with empty containers to begin with. I understand this is to make chaining of builder methods easier which take and return <code>&amp;mut self</code> and the same applies to <code>WasiCtxBuilder::build(&amp;mut self)</code> method, but perhaps it would more cleanly signal the intentions if we simply moved <code>WasiCtxBuilder</code> instance around. Food for thought!</li>\n<li>Methods specific to determining rights of passed around <code>std::fs::File</code> objects when populating <code>WasiCtx</code> <code>FdEntry</code> entities now return <code>io::Error</code> directly so that we can reuse them in <code>WasiCtxBuilder</code> methods (returning <code>WasiCtxBuilderError</code> error type), and in syscalls (returning WASI errno).</li>\n</ol>\n<p>With <code>WasiCtxBuilderError</code> in place, we now can return a pure <code>WasiError</code> in all syscalls-related functions. This means we can completely remove <code>error::Error</code> type, and now, <code>io::Error</code> and<br>\nrelated are automatically converted to their corresponding WASI errno value encapsulated as <code>WasiError</code>. IMHO this makes tracking errors in syscalls a lot cleaner and simpler.</p>\n<p>While here, it also made sense to me to move <code>WasiError</code> to <code>wasi</code> module which will align itself well with the upcoming changes introduced by <code>wiggle</code>. To different standard <code>Result</code> from WASI specific, I've created a helper alias <code>WasiResult</code> also residing in <code>wasi</code> module.</p>\n<h3>Prereqs:</h3>\n<p>OK, while technically we only depend on #1243 since we're rebased on it, it'd be best if we landed #1255 before as well. So:</p>\n<ul>\n<li>[ ] #1243 landed</li>\n<li>[ ] #1255 landed</li>\n</ul>\n<h3>ToDo:</h3>\n<ul>\n<li>[x] introduce <code>WasiCtxBuilderError</code></li>\n<li>[x] return <code>WasiError</code> directly in syscalls</li>\n<li>[x] hence remove <code>error::Error</code> type</li>\n<li>[x] fix <code>wig</code></li>\n</ul>\n</blockquote>",
        "id": 189985707,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1583614300
    },
    {
        "content": "<p>sunfishcode submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/1253#pullrequestreview-370788347\" target=\"_blank\" title=\"https://github.com/bytecodealliance/wasmtime/pull/1253#pullrequestreview-370788347\">PR Review</a>.</p>",
        "id": 189986413,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1583615499
    },
    {
        "content": "<p>sunfishcode submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/1253#pullrequestreview-370788347\" target=\"_blank\" title=\"https://github.com/bytecodealliance/wasmtime/pull/1253#pullrequestreview-370788347\">PR Review</a>.</p>",
        "id": 189986414,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1583615499
    },
    {
        "content": "<p>sunfishcode created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/1253#discussion_r389312456\" target=\"_blank\" title=\"https://github.com/bytecodealliance/wasmtime/pull/1253#discussion_r389312456\">PR Review Comment</a>:</p>\n<blockquote>\n<p>This is a super minor nit, but it feels awkward to me to return <code>Utf8Error</code> as its own arm of <code>WasiCtxBuilderResult</code> while mapping <code>NulError</code> to <code>io::Error</code>. Also, the <code>NulError</code>s we get don't arise from doing any actual I/O. What would you think of adding a new <code>WasiCtxBuilderError</code> arm for this?</p>\n</blockquote>",
        "id": 189986415,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1583615499
    },
    {
        "content": "<p>sunfishcode created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/1253#discussion_r389311430\" target=\"_blank\" title=\"https://github.com/bytecodealliance/wasmtime/pull/1253#discussion_r389311430\">PR Review Comment</a>:</p>\n<blockquote>\n<p>Is this used in this patch?</p>\n</blockquote>",
        "id": 189986416,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1583615499
    },
    {
        "content": "<p>sunfishcode created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/1253#discussion_r389311352\" target=\"_blank\" title=\"https://github.com/bytecodealliance/wasmtime/pull/1253#discussion_r389311352\">PR Review Comment</a>:</p>\n<blockquote>\n<p>These errors are likely to be fairly visible, and unlike POSIX where ENOTDIR is typically returned from simple system calls where you can pretty much guess which thing it was that wasn't a directory that should have been, these are returned from WasiCtxBuilder::build, which does many things. So I suggest adding a path field to this error and making the message more specific, mentioning that this is about the preopens. Something like \"Preopen directory path {} is not a directory\", so that it's clear what the problem is.</p>\n</blockquote>",
        "id": 189986417,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1583615499
    },
    {
        "content": "<p>kubkon submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/1253#pullrequestreview-370820638\" target=\"_blank\" title=\"https://github.com/bytecodealliance/wasmtime/pull/1253#pullrequestreview-370820638\">PR Review</a>.</p>",
        "id": 190009433,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1583664543
    },
    {
        "content": "<p>kubkon created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/1253#discussion_r389357217\" target=\"_blank\" title=\"https://github.com/bytecodealliance/wasmtime/pull/1253#discussion_r389357217\">PR Review Comment</a>:</p>\n<blockquote>\n<p>Ah, excellent catch! A leftover from prior attempts, thanks!</p>\n</blockquote>",
        "id": 190009434,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1583664543
    },
    {
        "content": "<p>kubkon submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/1253#pullrequestreview-370820691\" target=\"_blank\" title=\"https://github.com/bytecodealliance/wasmtime/pull/1253#pullrequestreview-370820691\">PR Review</a>.</p>",
        "id": 190009442,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1583664594
    },
    {
        "content": "<p>kubkon created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/1253#discussion_r389357265\" target=\"_blank\" title=\"https://github.com/bytecodealliance/wasmtime/pull/1253#discussion_r389357265\">PR Review Comment</a>:</p>\n<blockquote>\n<p>Makes sense! Lemme fix then!</p>\n</blockquote>",
        "id": 190009443,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1583664594
    },
    {
        "content": "<p>kubkon submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/1253#pullrequestreview-370820722\" target=\"_blank\" title=\"https://github.com/bytecodealliance/wasmtime/pull/1253#pullrequestreview-370820722\">PR Review</a>.</p>",
        "id": 190009497,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1583664631
    },
    {
        "content": "<p>kubkon created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/1253#discussion_r389357304\" target=\"_blank\" title=\"https://github.com/bytecodealliance/wasmtime/pull/1253#discussion_r389357304\">PR Review Comment</a>:</p>\n<blockquote>\n<p>I totally agree! The more info we can pass back to the client at this stage, the better!</p>\n</blockquote>",
        "id": 190009498,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1583664631
    },
    {
        "content": "<p>kubkon updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/1253\" target=\"_blank\" title=\"https://github.com/bytecodealliance/wasmtime/pull/1253\">PR #1253</a> from <code>error-cleanup</code> to <code>master</code>:</p>\n<blockquote>\n<p><code>WasiCtxBuilderError</code> is the <code>wasi-common</code> client-facing error type which is exclusively thrown when building a new <code>WasiCtx</code> instance. As such, building such an instance should not require the client to understand different WASI errno values as was assumed until now.</p>\n<p>This commit is a first step at streamlining error handling in <code>wasi-common</code> and makes way for the <code>wiggle</code> crate.</p>\n<p>When adding the <code>WasiCtxBuilderError</code>, I've had to do two things of notable importance:</p>\n<ol>\n<li>I've removed a couple of <code>ok_or</code> calls in <code>WasiCtxBuilder::build</code> and replaced them with <code>unwrap</code>s, following the same pattern in different builder methods above. This is fine since we _always_ operate on non-empty <code>Option</code>s in <code>WasiCtxBuilder</code> thus <code>unwrap</code>ing will never fail. On the other hand, this might be a good opportunity to rethink the structure of our builder, and how we good remove the said <code>Option</code>s especially since we always populate them with empty containers to begin with. I understand this is to make chaining of builder methods easier which take and return <code>&amp;mut self</code> and the same applies to <code>WasiCtxBuilder::build(&amp;mut self)</code> method, but perhaps it would more cleanly signal the intentions if we simply moved <code>WasiCtxBuilder</code> instance around. Food for thought!</li>\n<li>Methods specific to determining rights of passed around <code>std::fs::File</code> objects when populating <code>WasiCtx</code> <code>FdEntry</code> entities now return <code>io::Error</code> directly so that we can reuse them in <code>WasiCtxBuilder</code> methods (returning <code>WasiCtxBuilderError</code> error type), and in syscalls (returning WASI errno).</li>\n</ol>\n<p>With <code>WasiCtxBuilderError</code> in place, we now can return a pure <code>WasiError</code> in all syscalls-related functions. This means we can completely remove <code>error::Error</code> type, and now, <code>io::Error</code> and<br>\nrelated are automatically converted to their corresponding WASI errno value encapsulated as <code>WasiError</code>. IMHO this makes tracking errors in syscalls a lot cleaner and simpler.</p>\n<p>While here, it also made sense to me to move <code>WasiError</code> to <code>wasi</code> module which will align itself well with the upcoming changes introduced by <code>wiggle</code>. To different standard <code>Result</code> from WASI specific, I've created a helper alias <code>WasiResult</code> also residing in <code>wasi</code> module.</p>\n<h3>Prereqs:</h3>\n<p>OK, while technically we only depend on #1243 since we're rebased on it, it'd be best if we landed #1255 before as well. So:</p>\n<ul>\n<li>[ ] #1243 landed</li>\n<li>[ ] #1255 landed</li>\n</ul>\n<h3>ToDo:</h3>\n<ul>\n<li>[x] introduce <code>WasiCtxBuilderError</code></li>\n<li>[x] return <code>WasiError</code> directly in syscalls</li>\n<li>[x] hence remove <code>error::Error</code> type</li>\n<li>[x] fix <code>wig</code></li>\n</ul>\n</blockquote>",
        "id": 190011597,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1583669156
    },
    {
        "content": "<p>kubkon edited <a href=\"https://github.com/bytecodealliance/wasmtime/pull/1253\" target=\"_blank\" title=\"https://github.com/bytecodealliance/wasmtime/pull/1253\">PR #1253</a> from <code>error-cleanup</code> to <code>master</code>:</p>\n<blockquote>\n<p><code>WasiCtxBuilderError</code> is the <code>wasi-common</code> client-facing error type which is exclusively thrown when building a new <code>WasiCtx</code> instance. As such, building such an instance should not require the client to understand different WASI errno values as was assumed until now.</p>\n<p>This commit is a first step at streamlining error handling in <code>wasi-common</code> and makes way for the <code>wiggle</code> crate.</p>\n<p>When adding the <code>WasiCtxBuilderError</code>, I've had to do two things of notable importance:</p>\n<ol>\n<li>I've removed a couple of <code>ok_or</code> calls in <code>WasiCtxBuilder::build</code> and replaced them with <code>unwrap</code>s, following the same pattern in different builder methods above. This is fine since we _always_ operate on non-empty <code>Option</code>s in <code>WasiCtxBuilder</code> thus <code>unwrap</code>ing will never fail. On the other hand, this might be a good opportunity to rethink the structure of our builder, and how we good remove the said <code>Option</code>s especially since we always populate them with empty containers to begin with. I understand this is to make chaining of builder methods easier which take and return <code>&amp;mut self</code> and the same applies to <code>WasiCtxBuilder::build(&amp;mut self)</code> method, but perhaps it would more cleanly signal the intentions if we simply moved <code>WasiCtxBuilder</code> instance around. Food for thought!</li>\n<li>Methods specific to determining rights of passed around <code>std::fs::File</code> objects when populating <code>WasiCtx</code> <code>FdEntry</code> entities now return <code>io::Error</code> directly so that we can reuse them in <code>WasiCtxBuilder</code> methods (returning <code>WasiCtxBuilderError</code> error type), and in syscalls (returning WASI errno).</li>\n</ol>\n<p>With <code>WasiCtxBuilderError</code> in place, we now can return a pure <code>WasiError</code> in all syscalls-related functions. This means we can completely remove <code>error::Error</code> type, and now, <code>io::Error</code> and<br>\nrelated are automatically converted to their corresponding WASI errno value encapsulated as <code>WasiError</code>. IMHO this makes tracking errors in syscalls a lot cleaner and simpler.</p>\n<p>While here, it also made sense to me to move <code>WasiError</code> to <code>wasi</code> module which will align itself well with the upcoming changes introduced by <code>wiggle</code>. To different standard <code>Result</code> from WASI specific, I've created a helper alias <code>WasiResult</code> also residing in <code>wasi</code> module.</p>\n<h3>Prereqs:</h3>\n<p>OK, while technically we only depend on #1243 since we're rebased on it, it'd be best if we landed #1255 before as well. So:</p>\n<ul>\n<li>[x] #1243 landed</li>\n<li>[ ] #1255 landed</li>\n</ul>\n<h3>ToDo:</h3>\n<ul>\n<li>[x] introduce <code>WasiCtxBuilderError</code></li>\n<li>[x] return <code>WasiError</code> directly in syscalls</li>\n<li>[x] hence remove <code>error::Error</code> type</li>\n<li>[x] fix <code>wig</code></li>\n</ul>\n</blockquote>",
        "id": 190052004,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1583746353
    },
    {
        "content": "<p>kubkon updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/1253\" target=\"_blank\" title=\"https://github.com/bytecodealliance/wasmtime/pull/1253\">PR #1253</a> from <code>error-cleanup</code> to <code>master</code>:</p>\n<blockquote>\n<p><code>WasiCtxBuilderError</code> is the <code>wasi-common</code> client-facing error type which is exclusively thrown when building a new <code>WasiCtx</code> instance. As such, building such an instance should not require the client to understand different WASI errno values as was assumed until now.</p>\n<p>This commit is a first step at streamlining error handling in <code>wasi-common</code> and makes way for the <code>wiggle</code> crate.</p>\n<p>When adding the <code>WasiCtxBuilderError</code>, I've had to do two things of notable importance:</p>\n<ol>\n<li>I've removed a couple of <code>ok_or</code> calls in <code>WasiCtxBuilder::build</code> and replaced them with <code>unwrap</code>s, following the same pattern in different builder methods above. This is fine since we _always_ operate on non-empty <code>Option</code>s in <code>WasiCtxBuilder</code> thus <code>unwrap</code>ing will never fail. On the other hand, this might be a good opportunity to rethink the structure of our builder, and how we good remove the said <code>Option</code>s especially since we always populate them with empty containers to begin with. I understand this is to make chaining of builder methods easier which take and return <code>&amp;mut self</code> and the same applies to <code>WasiCtxBuilder::build(&amp;mut self)</code> method, but perhaps it would more cleanly signal the intentions if we simply moved <code>WasiCtxBuilder</code> instance around. Food for thought!</li>\n<li>Methods specific to determining rights of passed around <code>std::fs::File</code> objects when populating <code>WasiCtx</code> <code>FdEntry</code> entities now return <code>io::Error</code> directly so that we can reuse them in <code>WasiCtxBuilder</code> methods (returning <code>WasiCtxBuilderError</code> error type), and in syscalls (returning WASI errno).</li>\n</ol>\n<p>With <code>WasiCtxBuilderError</code> in place, we now can return a pure <code>WasiError</code> in all syscalls-related functions. This means we can completely remove <code>error::Error</code> type, and now, <code>io::Error</code> and<br>\nrelated are automatically converted to their corresponding WASI errno value encapsulated as <code>WasiError</code>. IMHO this makes tracking errors in syscalls a lot cleaner and simpler.</p>\n<p>While here, it also made sense to me to move <code>WasiError</code> to <code>wasi</code> module which will align itself well with the upcoming changes introduced by <code>wiggle</code>. To different standard <code>Result</code> from WASI specific, I've created a helper alias <code>WasiResult</code> also residing in <code>wasi</code> module.</p>\n<h3>Prereqs:</h3>\n<p>OK, while technically we only depend on #1243 since we're rebased on it, it'd be best if we landed #1255 before as well. So:</p>\n<ul>\n<li>[x] #1243 landed</li>\n<li>[ ] #1255 landed</li>\n</ul>\n<h3>ToDo:</h3>\n<ul>\n<li>[x] introduce <code>WasiCtxBuilderError</code></li>\n<li>[x] return <code>WasiError</code> directly in syscalls</li>\n<li>[x] hence remove <code>error::Error</code> type</li>\n<li>[x] fix <code>wig</code></li>\n</ul>\n</blockquote>",
        "id": 190052268,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1583746613
    },
    {
        "content": "<p>kubkon edited <a href=\"https://github.com/bytecodealliance/wasmtime/pull/1253\" target=\"_blank\" title=\"https://github.com/bytecodealliance/wasmtime/pull/1253\">PR #1253</a> from <code>error-cleanup</code> to <code>master</code>:</p>\n<blockquote>\n<p><code>WasiCtxBuilderError</code> is the <code>wasi-common</code> client-facing error type which is exclusively thrown when building a new <code>WasiCtx</code> instance. As such, building such an instance should not require the client to understand different WASI errno values as was assumed until now.</p>\n<p>This commit is a first step at streamlining error handling in <code>wasi-common</code> and makes way for the <code>wiggle</code> crate.</p>\n<p>When adding the <code>WasiCtxBuilderError</code>, I've had to do two things of notable importance:</p>\n<ol>\n<li>I've removed a couple of <code>ok_or</code> calls in <code>WasiCtxBuilder::build</code> and replaced them with <code>unwrap</code>s, following the same pattern in different builder methods above. This is fine since we _always_ operate on non-empty <code>Option</code>s in <code>WasiCtxBuilder</code> thus <code>unwrap</code>ing will never fail. On the other hand, this might be a good opportunity to rethink the structure of our builder, and how we good remove the said <code>Option</code>s especially since we always populate them with empty containers to begin with. I understand this is to make chaining of builder methods easier which take and return <code>&amp;mut self</code> and the same applies to <code>WasiCtxBuilder::build(&amp;mut self)</code> method, but perhaps it would more cleanly signal the intentions if we simply moved <code>WasiCtxBuilder</code> instance around. Food for thought!</li>\n<li>Methods specific to determining rights of passed around <code>std::fs::File</code> objects when populating <code>WasiCtx</code> <code>FdEntry</code> entities now return <code>io::Error</code> directly so that we can reuse them in <code>WasiCtxBuilder</code> methods (returning <code>WasiCtxBuilderError</code> error type), and in syscalls (returning WASI errno).</li>\n</ol>\n<p>With <code>WasiCtxBuilderError</code> in place, we now can return a pure <code>WasiError</code> in all syscalls-related functions. This means we can completely remove <code>error::Error</code> type, and now, <code>io::Error</code> and<br>\nrelated are automatically converted to their corresponding WASI errno value encapsulated as <code>WasiError</code>. IMHO this makes tracking errors in syscalls a lot cleaner and simpler.</p>\n<p>While here, it also made sense to me to move <code>WasiError</code> to <code>wasi</code> module which will align itself well with the upcoming changes introduced by <code>wiggle</code>. To different standard <code>Result</code> from WASI specific, I've created a helper alias <code>WasiResult</code> also residing in <code>wasi</code> module.</p>\n<h3>Prereqs:</h3>\n<p>OK, while technically we only depend on #1243 since we're rebased on it, it'd be best if we landed #1255 before as well. So:</p>\n<ul>\n<li>[x] #1243 landed</li>\n<li>[x] #1255 landed</li>\n</ul>\n<h3>ToDo:</h3>\n<ul>\n<li>[x] introduce <code>WasiCtxBuilderError</code></li>\n<li>[x] return <code>WasiError</code> directly in syscalls</li>\n<li>[x] hence remove <code>error::Error</code> type</li>\n<li>[x] fix <code>wig</code></li>\n</ul>\n</blockquote>",
        "id": 190078691,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1583766452
    },
    {
        "content": "<p>kubkon updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/1253\" target=\"_blank\" title=\"https://github.com/bytecodealliance/wasmtime/pull/1253\">PR #1253</a> from <code>error-cleanup</code> to <code>master</code>:</p>\n<blockquote>\n<p><code>WasiCtxBuilderError</code> is the <code>wasi-common</code> client-facing error type which is exclusively thrown when building a new <code>WasiCtx</code> instance. As such, building such an instance should not require the client to understand different WASI errno values as was assumed until now.</p>\n<p>This commit is a first step at streamlining error handling in <code>wasi-common</code> and makes way for the <code>wiggle</code> crate.</p>\n<p>When adding the <code>WasiCtxBuilderError</code>, I've had to do two things of notable importance:</p>\n<ol>\n<li>I've removed a couple of <code>ok_or</code> calls in <code>WasiCtxBuilder::build</code> and replaced them with <code>unwrap</code>s, following the same pattern in different builder methods above. This is fine since we _always_ operate on non-empty <code>Option</code>s in <code>WasiCtxBuilder</code> thus <code>unwrap</code>ing will never fail. On the other hand, this might be a good opportunity to rethink the structure of our builder, and how we good remove the said <code>Option</code>s especially since we always populate them with empty containers to begin with. I understand this is to make chaining of builder methods easier which take and return <code>&amp;mut self</code> and the same applies to <code>WasiCtxBuilder::build(&amp;mut self)</code> method, but perhaps it would more cleanly signal the intentions if we simply moved <code>WasiCtxBuilder</code> instance around. Food for thought!</li>\n<li>Methods specific to determining rights of passed around <code>std::fs::File</code> objects when populating <code>WasiCtx</code> <code>FdEntry</code> entities now return <code>io::Error</code> directly so that we can reuse them in <code>WasiCtxBuilder</code> methods (returning <code>WasiCtxBuilderError</code> error type), and in syscalls (returning WASI errno).</li>\n</ol>\n<p>With <code>WasiCtxBuilderError</code> in place, we now can return a pure <code>WasiError</code> in all syscalls-related functions. This means we can completely remove <code>error::Error</code> type, and now, <code>io::Error</code> and<br>\nrelated are automatically converted to their corresponding WASI errno value encapsulated as <code>WasiError</code>. IMHO this makes tracking errors in syscalls a lot cleaner and simpler.</p>\n<p>While here, it also made sense to me to move <code>WasiError</code> to <code>wasi</code> module which will align itself well with the upcoming changes introduced by <code>wiggle</code>. To different standard <code>Result</code> from WASI specific, I've created a helper alias <code>WasiResult</code> also residing in <code>wasi</code> module.</p>\n<h3>Prereqs:</h3>\n<p>OK, while technically we only depend on #1243 since we're rebased on it, it'd be best if we landed #1255 before as well. So:</p>\n<ul>\n<li>[x] #1243 landed</li>\n<li>[x] #1255 landed</li>\n</ul>\n<h3>ToDo:</h3>\n<ul>\n<li>[x] introduce <code>WasiCtxBuilderError</code></li>\n<li>[x] return <code>WasiError</code> directly in syscalls</li>\n<li>[x] hence remove <code>error::Error</code> type</li>\n<li>[x] fix <code>wig</code></li>\n</ul>\n</blockquote>",
        "id": 190080408,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1583767371
    },
    {
        "content": "<p><strong>kubkon</strong> requested <a href=\"https://github.com/alexcrichton\" target=\"_blank\" title=\"https://github.com/alexcrichton\">alexcrichton</a>, <a href=\"https://github.com/pchickey\" target=\"_blank\" title=\"https://github.com/pchickey\">pchickey</a>, and <a href=\"https://github.com/sunfishcode\" target=\"_blank\" title=\"https://github.com/sunfishcode\">sunfishcode</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/1253\" target=\"_blank\" title=\"https://github.com/bytecodealliance/wasmtime/pull/1253\">PR #1253</a>.</p>",
        "id": 190080698,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1583767499
    },
    {
        "content": "<p>kubkon updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/1253\" target=\"_blank\" title=\"https://github.com/bytecodealliance/wasmtime/pull/1253\">PR #1253</a> from <code>error-cleanup</code> to <code>master</code>:</p>\n<blockquote>\n<p><code>WasiCtxBuilderError</code> is the <code>wasi-common</code> client-facing error type which is exclusively thrown when building a new <code>WasiCtx</code> instance. As such, building such an instance should not require the client to understand different WASI errno values as was assumed until now.</p>\n<p>This commit is a first step at streamlining error handling in <code>wasi-common</code> and makes way for the <code>wiggle</code> crate.</p>\n<p>When adding the <code>WasiCtxBuilderError</code>, I've had to do two things of notable importance:</p>\n<ol>\n<li>I've removed a couple of <code>ok_or</code> calls in <code>WasiCtxBuilder::build</code> and replaced them with <code>unwrap</code>s, following the same pattern in different builder methods above. This is fine since we _always_ operate on non-empty <code>Option</code>s in <code>WasiCtxBuilder</code> thus <code>unwrap</code>ing will never fail. On the other hand, this might be a good opportunity to rethink the structure of our builder, and how we good remove the said <code>Option</code>s especially since we always populate them with empty containers to begin with. I understand this is to make chaining of builder methods easier which take and return <code>&amp;mut self</code> and the same applies to <code>WasiCtxBuilder::build(&amp;mut self)</code> method, but perhaps it would more cleanly signal the intentions if we simply moved <code>WasiCtxBuilder</code> instance around. Food for thought!</li>\n<li>Methods specific to determining rights of passed around <code>std::fs::File</code> objects when populating <code>WasiCtx</code> <code>FdEntry</code> entities now return <code>io::Error</code> directly so that we can reuse them in <code>WasiCtxBuilder</code> methods (returning <code>WasiCtxBuilderError</code> error type), and in syscalls (returning WASI errno).</li>\n</ol>\n<p>With <code>WasiCtxBuilderError</code> in place, we now can return a pure <code>WasiError</code> in all syscalls-related functions. This means we can completely remove <code>error::Error</code> type, and now, <code>io::Error</code> and<br>\nrelated are automatically converted to their corresponding WASI errno value encapsulated as <code>WasiError</code>. IMHO this makes tracking errors in syscalls a lot cleaner and simpler.</p>\n<p>While here, it also made sense to me to move <code>WasiError</code> to <code>wasi</code> module which will align itself well with the upcoming changes introduced by <code>wiggle</code>. To different standard <code>Result</code> from WASI specific, I've created a helper alias <code>WasiResult</code> also residing in <code>wasi</code> module.</p>\n<h3>Prereqs:</h3>\n<p>OK, while technically we only depend on #1243 since we're rebased on it, it'd be best if we landed #1255 before as well. So:</p>\n<ul>\n<li>[x] #1243 landed</li>\n<li>[x] #1255 landed</li>\n</ul>\n<h3>ToDo:</h3>\n<ul>\n<li>[x] introduce <code>WasiCtxBuilderError</code></li>\n<li>[x] return <code>WasiError</code> directly in syscalls</li>\n<li>[x] hence remove <code>error::Error</code> type</li>\n<li>[x] fix <code>wig</code></li>\n</ul>\n</blockquote>",
        "id": 190089314,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1583771718
    },
    {
        "content": "<p>sunfishcode submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/1253#pullrequestreview-371454188\" target=\"_blank\" title=\"https://github.com/bytecodealliance/wasmtime/pull/1253#pullrequestreview-371454188\">PR Review</a>.</p>",
        "id": 190105972,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1583780881
    },
    {
        "content": "<p>kubkon updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/1253\" target=\"_blank\" title=\"https://github.com/bytecodealliance/wasmtime/pull/1253\">PR #1253</a> from <code>error-cleanup</code> to <code>master</code>:</p>\n<blockquote>\n<p><code>WasiCtxBuilderError</code> is the <code>wasi-common</code> client-facing error type which is exclusively thrown when building a new <code>WasiCtx</code> instance. As such, building such an instance should not require the client to understand different WASI errno values as was assumed until now.</p>\n<p>This commit is a first step at streamlining error handling in <code>wasi-common</code> and makes way for the <code>wiggle</code> crate.</p>\n<p>When adding the <code>WasiCtxBuilderError</code>, I've had to do two things of notable importance:</p>\n<ol>\n<li>I've removed a couple of <code>ok_or</code> calls in <code>WasiCtxBuilder::build</code> and replaced them with <code>unwrap</code>s, following the same pattern in different builder methods above. This is fine since we _always_ operate on non-empty <code>Option</code>s in <code>WasiCtxBuilder</code> thus <code>unwrap</code>ing will never fail. On the other hand, this might be a good opportunity to rethink the structure of our builder, and how we good remove the said <code>Option</code>s especially since we always populate them with empty containers to begin with. I understand this is to make chaining of builder methods easier which take and return <code>&amp;mut self</code> and the same applies to <code>WasiCtxBuilder::build(&amp;mut self)</code> method, but perhaps it would more cleanly signal the intentions if we simply moved <code>WasiCtxBuilder</code> instance around. Food for thought!</li>\n<li>Methods specific to determining rights of passed around <code>std::fs::File</code> objects when populating <code>WasiCtx</code> <code>FdEntry</code> entities now return <code>io::Error</code> directly so that we can reuse them in <code>WasiCtxBuilder</code> methods (returning <code>WasiCtxBuilderError</code> error type), and in syscalls (returning WASI errno).</li>\n</ol>\n<p>With <code>WasiCtxBuilderError</code> in place, we now can return a pure <code>WasiError</code> in all syscalls-related functions. This means we can completely remove <code>error::Error</code> type, and now, <code>io::Error</code> and<br>\nrelated are automatically converted to their corresponding WASI errno value encapsulated as <code>WasiError</code>. IMHO this makes tracking errors in syscalls a lot cleaner and simpler.</p>\n<p>While here, it also made sense to me to move <code>WasiError</code> to <code>wasi</code> module which will align itself well with the upcoming changes introduced by <code>wiggle</code>. To different standard <code>Result</code> from WASI specific, I've created a helper alias <code>WasiResult</code> also residing in <code>wasi</code> module.</p>\n<h3>Prereqs:</h3>\n<p>OK, while technically we only depend on #1243 since we're rebased on it, it'd be best if we landed #1255 before as well. So:</p>\n<ul>\n<li>[x] #1243 landed</li>\n<li>[x] #1255 landed</li>\n</ul>\n<h3>ToDo:</h3>\n<ul>\n<li>[x] introduce <code>WasiCtxBuilderError</code></li>\n<li>[x] return <code>WasiError</code> directly in syscalls</li>\n<li>[x] hence remove <code>error::Error</code> type</li>\n<li>[x] fix <code>wig</code></li>\n</ul>\n</blockquote>",
        "id": 190115652,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1583786569
    },
    {
        "content": "<p>kubkon merged <a href=\"https://github.com/bytecodealliance/wasmtime/pull/1253\" target=\"_blank\" title=\"https://github.com/bytecodealliance/wasmtime/pull/1253\">PR #1253</a>.</p>",
        "id": 190122209,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1583791137
    }
]