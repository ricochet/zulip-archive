[
    {
        "content": "<p>ognevny opened <a href=\"https://github.com/bytecodealliance/wasmtime/issues/9382\">issue #9382</a>:</p>\n<blockquote>\n<p>when built with MSYS2 toolchain, <code>wasmtime/conf.h</code> isn't installed, and (for example) tree-sitter compilation fails with</p>\n<p><div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">In</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"w\"> </span><span class=\"n\">included</span><span class=\"w\"> </span><span class=\"n\">from</span><span class=\"w\"> </span><span class=\"n\">C</span><span class=\"p\">:</span><span class=\"o\">/</span><span class=\"n\">msys64</span><span class=\"o\">/</span><span class=\"n\">clang64</span><span class=\"o\">/</span><span class=\"n\">include</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"p\">.</span><span class=\"n\">h</span><span class=\"p\">:</span><span class=\"mi\">182</span><span class=\"p\">:</span>\n<span class=\"nc\">C</span><span class=\"p\">:</span><span class=\"o\">/</span><span class=\"n\">msys64</span><span class=\"o\">/</span><span class=\"n\">clang64</span><span class=\"o\">/</span><span class=\"n\">include</span><span class=\"o\">/</span><span class=\"n\">wasi</span><span class=\"p\">.</span><span class=\"n\">h</span><span class=\"p\">:</span><span class=\"mi\">12</span><span class=\"p\">:</span><span class=\"mi\">10</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">fatal</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"na\">wasmtime</span><span class=\"o\">/</span><span class=\"n\">conf</span><span class=\"p\">.</span><span class=\"n\">h</span><span class=\"o\">'</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">found</span>\n<span class=\"w\">   </span><span class=\"mi\">12</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"p\">#</span><span class=\"n\">include</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">wasmtime</span><span class=\"o\">/</span><span class=\"n\">conf</span><span class=\"p\">.</span><span class=\"n\">h</span><span class=\"o\">&gt;</span>\n<span class=\"w\">      </span><span class=\"o\">|</span><span class=\"w\">          </span><span class=\"o\">^~~~~~~~~~~~~~~~~</span>\n</code></pre></div><br>\n</p>\n</blockquote>",
        "id": 475089306,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1728213164
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/9382#issuecomment-2395575188\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/9382\">issue #9382</a>:</p>\n<blockquote>\n<p>Thanks for the report! The installation of the C API changed a few versions ago in Wasmtime to use <code>cmake</code> to install, and cmake should install the <code>conf.h</code> header file. If it's missing here then that means whatever is managing the C API probably isn't pulling in the latest version one way or another. There's been a few other PRs/issues for tree-sitter using a Rust dependency on the C API and getting that working too. </p>\n<p>If you're interested in primarily packaging tree-sitter this might be a better issue to raise with them? They might be more familiar with the build system and packaging of tree sitter.</p>\n</blockquote>",
        "id": 475140213,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1728246614
    },
    {
        "content": "<p>ognevny <a href=\"https://github.com/bytecodealliance/wasmtime/issues/9382#issuecomment-2429600607\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/9382\">issue #9382</a>:</p>\n<blockquote>\n<p>I forgot to answer, but cmake doesn't install <code>conf.h</code> this just can't be issue from tree-sitter's side</p>\n</blockquote>",
        "id": 478313481,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1729610951
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/9382#issuecomment-2430092427\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/9382\">issue #9382</a>:</p>\n<blockquote>\n<p>Would you be able to provide some steps for reproduction? </p>\n</blockquote>",
        "id": 478354362,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1729625693
    },
    {
        "content": "<p>ognevny <a href=\"https://github.com/bytecodealliance/wasmtime/issues/9382#issuecomment-2430799981\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/9382\">issue #9382</a>:</p>\n<blockquote>\n<p>download msys2<br>\nrun <code>makepkg-mingw -s</code> for <a href=\"https://github.com/msys2/MINGW-packages/blob/master/mingw-w64-wasmtime%2FPKGBUILD\">recipe</a></p>\n</blockquote>",
        "id": 478405937,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1729655051
    },
    {
        "content": "<p>ognevny <a href=\"https://github.com/bytecodealliance/wasmtime/issues/9382#issuecomment-2430810618\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/9382\">issue #9382</a>:</p>\n<blockquote>\n<p>but without the line, that install conf.h _manually_</p>\n</blockquote>",
        "id": 478406712,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1729655589
    },
    {
        "content": "<p>ognevny edited a <a href=\"https://github.com/bytecodealliance/wasmtime/issues/9382#issuecomment-2430810618\">comment</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/9382\">issue #9382</a>:</p>\n<blockquote>\n<p>but without the line, that install conf.h _manually_ (<a href=\"https://github.com/msys2/MINGW-packages/blob/cb29d91491e2e202d66e0ffc5a1ff2ed068e8622/mingw-w64-wasmtime/PKGBUILD#L118\">https://github.com/msys2/MINGW-packages/blob/cb29d91491e2e202d66e0ffc5a1ff2ed068e8622/mingw-w64-wasmtime/PKGBUILD#L118</a>)</p>\n</blockquote>",
        "id": 478406815,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1729655666
    },
    {
        "content": "<p>ognevny edited a <a href=\"https://github.com/bytecodealliance/wasmtime/issues/9382#issuecomment-2430799981\">comment</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/9382\">issue #9382</a>:</p>\n<blockquote>\n<p>download msys2<br>\nrun <code>makepkg-mingw -s</code> for <a href=\"https://github.com/msys2/MINGW-packages/blob/cb29d91491e2e202d66e0ffc5a1ff2ed068e8622/mingw-w64-wasmtime%2FPKGBUILD\">recipe</a></p>\n</blockquote>",
        "id": 478406848,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1729655700
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/9382#issuecomment-2432791313\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/9382\">issue #9382</a>:</p>\n<blockquote>\n<p>I ran these commands:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">cmake</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">G</span><span class=\"w\"> </span><span class=\"n\">Ninja</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">DCMAKE_INSTALL_PREFIX</span><span class=\"o\">=</span><span class=\"err\">`</span><span class=\"n\">pwd</span><span class=\"err\">`</span><span class=\"o\">/</span><span class=\"n\">target</span><span class=\"o\">/</span><span class=\"n\">c</span><span class=\"o\">-</span><span class=\"n\">api</span><span class=\"o\">-</span><span class=\"n\">install</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">DBUILD_SHARED_LIBS</span><span class=\"o\">=</span><span class=\"n\">OFF</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">crates</span><span class=\"o\">/</span><span class=\"n\">c</span><span class=\"o\">-</span><span class=\"n\">api</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"n\">target</span><span class=\"o\">/</span><span class=\"n\">build</span><span class=\"o\">-</span><span class=\"k\">static</span>\n<span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">cmake</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">build</span><span class=\"w\"> </span><span class=\"n\">target</span><span class=\"o\">/</span><span class=\"n\">build</span><span class=\"o\">-</span><span class=\"k\">static</span>\n<span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">DESTDIR</span><span class=\"o\">=</span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">target</span><span class=\"o\">/</span><span class=\"n\">c</span><span class=\"o\">-</span><span class=\"n\">api</span><span class=\"o\">-</span><span class=\"n\">install2</span><span class=\"w\"> </span><span class=\"n\">cmake</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">install</span><span class=\"w\"> </span><span class=\"n\">target</span><span class=\"o\">/</span><span class=\"n\">build</span><span class=\"o\">-</span><span class=\"k\">static</span>\n</code></pre></div>\n<p>to model what that script is doing</p>\n<p>The <code>--install</code> step shows:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"o\">..</span><span class=\"p\">.</span>\n<span class=\"o\">--</span><span class=\"w\"> </span><span class=\"n\">Installing</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">alex</span><span class=\"o\">/</span><span class=\"n\">code</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">/</span><span class=\"n\">target</span><span class=\"o\">/</span><span class=\"n\">c</span><span class=\"o\">-</span><span class=\"n\">api</span><span class=\"o\">-</span><span class=\"n\">install</span><span class=\"o\">/</span><span class=\"n\">include</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">/</span><span class=\"n\">conf</span><span class=\"p\">.</span><span class=\"n\">h</span>\n<span class=\"o\">--</span><span class=\"w\"> </span><span class=\"n\">Up</span><span class=\"o\">-</span><span class=\"n\">to</span><span class=\"o\">-</span><span class=\"n\">date</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">target</span><span class=\"o\">/</span><span class=\"n\">c</span><span class=\"o\">-</span><span class=\"n\">api</span><span class=\"o\">-</span><span class=\"n\">install2</span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">alex</span><span class=\"o\">/</span><span class=\"n\">code</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">/</span><span class=\"n\">target</span><span class=\"o\">/</span><span class=\"n\">c</span><span class=\"o\">-</span><span class=\"n\">api</span><span class=\"o\">-</span><span class=\"n\">install</span><span class=\"o\">/</span><span class=\"n\">include</span>\n<span class=\"o\">--</span><span class=\"w\"> </span><span class=\"n\">Installing</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">target</span><span class=\"o\">/</span><span class=\"n\">c</span><span class=\"o\">-</span><span class=\"n\">api</span><span class=\"o\">-</span><span class=\"n\">install2</span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">alex</span><span class=\"o\">/</span><span class=\"n\">code</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">/</span><span class=\"n\">target</span><span class=\"o\">/</span><span class=\"n\">c</span><span class=\"o\">-</span><span class=\"n\">api</span><span class=\"o\">-</span><span class=\"n\">install</span><span class=\"o\">/</span><span class=\"n\">include</span><span class=\"o\">/</span><span class=\"n\">wasi</span><span class=\"p\">.</span><span class=\"n\">h</span>\n<span class=\"o\">..</span><span class=\"p\">.</span>\n</code></pre></div>\n<p>which shows that the <code>conf.h</code> is being installed, just to the wrong spot.</p>\n<p>I think this has to do with the combination of <code>DESTDIR</code> and <code>-DCMAKE_INSTALL_PREFIX</code> and those being different. I fear though that I'm not knowledgable enough with CMake to know how best to solve this.</p>\n</blockquote>",
        "id": 478536304,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1729700743
    },
    {
        "content": "<p>ognevny <a href=\"https://github.com/bytecodealliance/wasmtime/issues/9382#issuecomment-2432804631\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/9382\">issue #9382</a>:</p>\n<blockquote>\n<p>I wonder can you switch to meson?</p>\n</blockquote>",
        "id": 478537581,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1729701104
    }
]