[
    {
        "content": "<p><strong>fitzgen</strong> requested <a href=\"https://github.com/alexcrichton\">alexcrichton</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3556\">PR #3556</a>.</p>",
        "id": 262138783,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1637360538
    },
    {
        "content": "<p>fitzgen opened <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3556\">PR #3556</a> from <code>isle-integration-docs</code> to <code>main</code>:</p>\n<blockquote>\n<p>&lt;!--</p>\n<p>Please ensure that the following steps are all taken care of before submitting<br>\nthe PR.</p>\n<ul>\n<li>\n<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>\n  here.</p>\n</li>\n<li>\n<p>[ ] A short description of what this does, why it is needed; if the<br>\n  description becomes long, the matter should probably be discussed in an issue<br>\n  first.</p>\n</li>\n<li>\n<p>[ ] This PR contains test cases, if meaningful.</p>\n</li>\n<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>\n  If you don't know who could review this, please indicate so. The list of<br>\n  suggested reviewers on the right can help you.</li>\n</ul>\n<p>Please ensure all communication adheres to the <a href=\"https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md\">code of\nconduct</a>.<br>\n--&gt;<br>\n</p>\n</blockquote>",
        "id": 262138784,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1637360538
    },
    {
        "content": "<p><strong>fitzgen</strong> requested <a href=\"https://github.com/cfallin\">cfallin</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3556\">PR #3556</a>.</p>",
        "id": 262138785,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1637360538
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3556#pullrequestreview-811732077\">PR review</a>.</p>",
        "id": 262141290,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1637361924
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3556#pullrequestreview-811732077\">PR review</a>.</p>",
        "id": 262141292,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1637361924
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3556#discussion_r753572859\">PR review comment</a>:</p>\n<blockquote>\n<p>s/doesn't/don't/</p>\n</blockquote>",
        "id": 262141293,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1637361924
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3556#discussion_r753575478\">PR review comment</a>:</p>\n<blockquote>\n<p>This <code>SinkableLoad</code> discussion could refer to the section below as well, noting that it's a form of type safety, disallowing use of the value until we commit to merging it :-)</p>\n</blockquote>",
        "id": 262141294,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1637361924
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3556#discussion_r753575655\">PR review comment</a>:</p>\n<blockquote>\n<p>This paragraph has good detail but is a little dense; a snippet or two showing how <code>sinkable_load</code> and <code>sink_load</code> are used in a rule might help?</p>\n</blockquote>",
        "id": 262141295,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1637361924
    },
    {
        "content": "<p>jlb6740 submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3556#pullrequestreview-811749620\">PR review</a>.</p>",
        "id": 262146010,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1637365036
    },
    {
        "content": "<p>jlb6740 submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3556#pullrequestreview-811749620\">PR review</a>.</p>",
        "id": 262146011,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1637365036
    },
    {
        "content": "<p>jlb6740 created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3556#discussion_r753592115\">PR review comment</a>:</p>\n<blockquote>\n<p>s/fnally/finally/</p>\n</blockquote>",
        "id": 262146012,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1637365036
    },
    {
        "content": "<p>jlb6740 created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3556#discussion_r753586770\">PR review comment</a>:</p>\n<blockquote>\n<p>s/themselves they//</p>\n</blockquote>",
        "id": 262146013,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1637365036
    },
    {
        "content": "<p>jlb6740 submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3556#pullrequestreview-811760525\">PR review</a>.</p>",
        "id": 262146973,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1637365741
    },
    {
        "content": "<p>jlb6740 submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3556#pullrequestreview-811760525\">PR review</a>.</p>",
        "id": 262146974,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1637365741
    },
    {
        "content": "<p>jlb6740 created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3556#discussion_r753595813\">PR review comment</a>:</p>\n<blockquote>\n<p>? caare</p>\n</blockquote>",
        "id": 262146983,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1637365748
    },
    {
        "content": "<p>jlb6740 submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3556#pullrequestreview-811762652\">PR review</a>.</p>",
        "id": 262147610,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1637366224
    },
    {
        "content": "<p>jlb6740 submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3556#pullrequestreview-811762652\">PR review</a>.</p>",
        "id": 262147611,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1637366225
    },
    {
        "content": "<p>jlb6740 created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3556#discussion_r753597554\">PR review comment</a>:</p>\n<blockquote>\n<p>The description of what constitutes a side effect, I am having a hard time appreciating what's really being described or taking it an applying it and thinking up a different example. Is there some way or mechanism to help prevent writing code that violates this no side effect rule? With the description of a side effect here it worries me that it will be easier to create bugs that are harder to track down. </p>\n</blockquote>",
        "id": 262147612,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1637366225
    },
    {
        "content": "<p>jlb6740 edited <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3556#discussion_r753597554\">PR review comment</a>.</p>",
        "id": 262147642,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1637366269
    },
    {
        "content": "<p>jlb6740 edited <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3556#discussion_r753597554\">PR review comment</a>.</p>",
        "id": 262147713,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1637366289
    },
    {
        "content": "<p>alexcrichton submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3556#pullrequestreview-812781657\">PR review</a>.</p>",
        "id": 262345380,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1637599558
    },
    {
        "content": "<p>avanhatt submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3556#pullrequestreview-814231227\">PR review</a>.</p>",
        "id": 262522203,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1637706021
    },
    {
        "content": "<p>avanhatt created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3556#discussion_r755547587\">PR review comment</a>:</p>\n<blockquote>\n<p>Is this/can this be enforced by the ISLE compiler? Or is it the responsibility of the rule-writer?</p>\n</blockquote>",
        "id": 262522204,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1637706021
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3556#pullrequestreview-814238330\">PR review</a>.</p>",
        "id": 262523349,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1637706674
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3556#discussion_r755553202\">PR review comment</a>:</p>\n<blockquote>\n<p>The latter; the external extractor is a call into Rust, which could in theory do anything.</p>\n<p>I had suggested at one point (in a conversation with @fitzgen I think) that we could split the <code>Context</code> trait into <code>InputContext</code> and <code>OutputContext</code>, and hold only an immutable borrow to <code>InputContext</code>, which would give us some type-level enforcement of this, at least...</p>\n</blockquote>",
        "id": 262523350,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1637706674
    },
    {
        "content": "<p>fitzgen submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3556#pullrequestreview-818229442\">PR review</a>.</p>",
        "id": 263057468,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1638214595
    },
    {
        "content": "<p>fitzgen created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3556#discussion_r758676939\">PR review comment</a>:</p>\n<blockquote>\n<p>I thought some more about this and determined that if we actually did this, it would make rewriting our peephole optimizations in ISLE impossible because both the input and output contexts would need to borrow the DFG (shared/immutable borrow for input, exclusive/mutable for output) which would be a borrowck error. Or at least it would force us to use <code>RefCell</code> pervasively, which could be a perf hit and certainly would be a pain to work with.</p>\n</blockquote>",
        "id": 263057469,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1638214595
    },
    {
        "content": "<p>fitzgen submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3556#pullrequestreview-818230454\">PR review</a>.</p>",
        "id": 263057564,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1638214642
    },
    {
        "content": "<p>fitzgen created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3556#discussion_r758677469\">PR review comment</a>:</p>\n<blockquote>\n<p>(Even the existing lowering doesn't have an input and output <code>LowerCtx</code> so we would have the same issues with instruction selection, even though we \"shouldn't\" if we were building this all from scratch)</p>\n</blockquote>",
        "id": 263057565,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1638214642
    },
    {
        "content": "<p>fitzgen updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3556\">PR #3556</a> from <code>isle-integration-docs</code> to <code>main</code>.</p>",
        "id": 263085845,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1638231206
    },
    {
        "content": "<p>fitzgen submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3556#pullrequestreview-818440819\">PR review</a>.</p>",
        "id": 263086722,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1638231879
    },
    {
        "content": "<p>fitzgen created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3556#discussion_r758837108\">PR review comment</a>:</p>\n<blockquote>\n<p>I rewrote this paragraph a bit and broke it up with examples, as Chris suggested. Hope it is clearer now.</p>\n<blockquote>\n<p>It has me thinking, is there some way or mechanism to help prevent writing code that violates this no side effect rule? With the description of a side effect here it worries me that it will be easier to create bugs that are harder to track down.</p>\n</blockquote>\n<p>It's the same thing you have to deal with writing Rust code right now too. If you do</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">something_with_side_effects</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">foo</span><span class=\"p\">();</span><span class=\"w\"></span>\n<span class=\"p\">}</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">bar</span><span class=\"p\">();</span><span class=\"w\"></span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n</code></pre></div>\n<p>the side effects of the condition aren't rolled back if you take the <code>bar();</code> branch.</p>\n<p>Unfortunately, this isn't really something we can reason about in ISLE itself because all the things that could perform side effects are external Rust helpers.</p>\n</blockquote>",
        "id": 263086723,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1638231879
    },
    {
        "content": "<p>fitzgen updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3556\">PR #3556</a> from <code>isle-integration-docs</code> to <code>main</code>.</p>",
        "id": 263090099,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1638234124
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3556#pullrequestreview-818467120\">PR review</a>.</p>",
        "id": 263091280,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1638235246
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3556#discussion_r758858143\">PR review comment</a>:</p>\n<blockquote>\n<p>@fitzgen I think that the peephole (CLIF-to-CLIF) case is a separate design question with some interesting possibilities. The most natural approach (given our constraints) might actually be to send emitted instructions to a separate buffer (either a patch buffer on top of the IR with a later batch-update, or just emit new IR in a straight-through pass), in which case the Input and Output contexts are truly independent. That has the advantage of making the lowerings fine-grained-parallelizable as well. And it would allow us to move to a more VCode-like representation of \"compact array of insts, no redirections or next/prev links\" which is much more efficient to stream through. The downside is of course that it might take multiple passes to converge, but that's an effort-vs-quality tradeoff knob we can turn.</p>\n<p>Anyway, that's a separate discussion (and one I'd love to dive into more!) but the relevance here is just to say \"there's another way\" :-)</p>\n</blockquote>",
        "id": 263091281,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1638235246
    },
    {
        "content": "<p>fitzgen merged <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3556\">PR #3556</a>.</p>",
        "id": 263097574,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1638242189
    },
    {
        "content": "<p>fitzgen submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3556#pullrequestreview-819361785\">PR review</a>.</p>",
        "id": 263181251,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1638294189
    },
    {
        "content": "<p>fitzgen created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3556#discussion_r759518302\">PR review comment</a>:</p>\n<blockquote>\n<p>That would make it possible, yes. But it's also a lot further off than \"porting simple preopt to ISLE\" is, at least in my mind.</p>\n</blockquote>",
        "id": 263181252,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1638294189
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3556#discussion_r759548074\">PR review comment</a>:</p>\n<blockquote>\n<p>Hmm, interesting -- we should definitely talk design more here, I think. I'm somewhat uncomfortable with the idea of a pass that does in-place edits, or at least it's not what I had in mind when designing the DSL or when thinking about the pipeline-of-streaming-passes architecture that the new backends are built around. My main concern is that it would paint us into a corner (in terms of rules that we write) where we depend on the immediate availability of the result of an edit, and can't get out of this corner later when we want to do any sort of batch-update optimization (separate streaming passes, or parallelization, or anything like that).</p>\n<p>I think that it actually may not be so bad to buffer new instructions at insertion points and \"replace value X with value Y\" actions. In my estimation probably not any more work than what it would take to build in-place editing glue; both seem like ~a few hundred lines of code, in my estimation.</p>\n<p>Anyway, we've branched off the thread topic here, and this is the sort of architectural thing that probably merits at least an issue thread of discussion, so I'm happy to discuss more elsewhere when it comes time for this!</p>\n</blockquote>",
        "id": 263186690,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1638296550
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3556#pullrequestreview-819403028\">PR review</a>.</p>",
        "id": 263186691,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1638296550
    }
]