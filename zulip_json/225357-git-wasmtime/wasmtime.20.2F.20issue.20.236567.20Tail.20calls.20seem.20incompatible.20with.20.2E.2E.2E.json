[
    {
        "content": "<p>alexcrichton opened <a href=\"https://github.com/bytecodealliance/wasmtime/issues/6567\">issue #6567</a>:</p>\n<blockquote>\n<p>Locally on an AArch64 macbook I get:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">cargo</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"n\">test</span><span class=\"w\"> </span><span class=\"n\">filetests</span><span class=\"o\">/</span><span class=\"n\">filetests</span><span class=\"o\">/</span><span class=\"n\">runtests</span><span class=\"o\">/</span><span class=\"n\">tail</span><span class=\"o\">-</span><span class=\"n\">call</span><span class=\"o\">-</span><span class=\"n\">conv</span><span class=\"p\">.</span><span class=\"n\">clif</span>\n<span class=\"n\">zsh</span>: <span class=\"nc\">bus</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"w\">  </span><span class=\"n\">cargo</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"n\">test</span><span class=\"w\"> </span><span class=\"n\">filetests</span><span class=\"o\">/</span><span class=\"n\">filetests</span><span class=\"o\">/</span><span class=\"n\">runtests</span><span class=\"o\">/</span><span class=\"n\">tail</span><span class=\"o\">-</span><span class=\"n\">call</span><span class=\"o\">-</span><span class=\"n\">conv</span><span class=\"p\">.</span><span class=\"n\">clif</span>\n</code></pre></div>\n<p>If I comment out the <code>target aarch64 has_pauth sign_return_address</code> directive the test passes, and the first test that fails is:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">test</span><span class=\"w\"> </span><span class=\"n\">run</span>\n\n<span class=\"n\">target</span><span class=\"w\"> </span><span class=\"n\">aarch64</span><span class=\"w\"> </span><span class=\"n\">has_pauth</span><span class=\"w\"> </span><span class=\"n\">sign_return_address</span>\n\n<span class=\"p\">;;</span><span class=\"w\"> </span><span class=\"n\">Test</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">tail</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">calling</span><span class=\"w\"> </span><span class=\"n\">convention</span><span class=\"w\"> </span><span class=\"n\">with</span><span class=\"w\"> </span><span class=\"n\">non</span><span class=\"o\">-</span><span class=\"n\">tail</span><span class=\"w\"> </span><span class=\"n\">calls</span><span class=\"w\"> </span><span class=\"n\">and</span><span class=\"w\"> </span><span class=\"n\">stack</span><span class=\"w\"> </span><span class=\"n\">arguments</span><span class=\"p\">.</span>\n\n<span class=\"n\">function</span><span class=\"w\"> </span><span class=\"o\">%</span><span class=\"n\">tail_callee_stack_args</span><span class=\"p\">(</span><span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"p\">)</span><span class=\"w\"> </span>-&gt; <span class=\"kt\">i64</span> <span class=\"nc\">tail</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"n\">block0</span><span class=\"p\">(</span><span class=\"n\">v0</span>: <span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v1</span>: <span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v2</span>: <span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v3</span>: <span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v4</span>: <span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v5</span>: <span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v6</span>: <span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v7</span>: <span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v8</span>: <span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v9</span>: <span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v10</span>: <span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v11</span>: <span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v12</span>: <span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v13</span>: <span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v14</span>: <span class=\"kt\">i64</span><span class=\"p\">)</span>:\n    <span class=\"nc\">return</span><span class=\"w\"> </span><span class=\"n\">v14</span>\n<span class=\"p\">}</span>\n\n<span class=\"n\">function</span><span class=\"w\"> </span><span class=\"o\">%</span><span class=\"n\">tail_caller_stack_args</span><span class=\"p\">()</span><span class=\"w\"> </span>-&gt; <span class=\"kt\">i64</span> <span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"n\">fn0</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">%</span><span class=\"n\">tail_callee_stack_args</span><span class=\"p\">(</span><span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"p\">)</span><span class=\"w\"> </span>-&gt; <span class=\"kt\">i64</span> <span class=\"nc\">tail</span>\n\n<span class=\"n\">block0</span>:\n    <span class=\"nc\">v0</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">iconst</span><span class=\"p\">.</span><span class=\"kt\">i64</span><span class=\"w\"> </span><span class=\"mi\">10</span>\n<span class=\"w\">    </span><span class=\"n\">v1</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">iconst</span><span class=\"p\">.</span><span class=\"kt\">i64</span><span class=\"w\"> </span><span class=\"mi\">15</span>\n<span class=\"w\">    </span><span class=\"n\">v2</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">iconst</span><span class=\"p\">.</span><span class=\"kt\">i64</span><span class=\"w\"> </span><span class=\"mi\">20</span>\n<span class=\"w\">    </span><span class=\"n\">v3</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">iconst</span><span class=\"p\">.</span><span class=\"kt\">i64</span><span class=\"w\"> </span><span class=\"mi\">25</span>\n<span class=\"w\">    </span><span class=\"n\">v4</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">iconst</span><span class=\"p\">.</span><span class=\"kt\">i64</span><span class=\"w\"> </span><span class=\"mi\">30</span>\n<span class=\"w\">    </span><span class=\"n\">v5</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">iconst</span><span class=\"p\">.</span><span class=\"kt\">i64</span><span class=\"w\"> </span><span class=\"mi\">35</span>\n<span class=\"w\">    </span><span class=\"n\">v6</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">iconst</span><span class=\"p\">.</span><span class=\"kt\">i64</span><span class=\"w\"> </span><span class=\"mi\">40</span>\n<span class=\"w\">    </span><span class=\"n\">v7</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">iconst</span><span class=\"p\">.</span><span class=\"kt\">i64</span><span class=\"w\"> </span><span class=\"mi\">45</span>\n<span class=\"w\">    </span><span class=\"n\">v8</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">iconst</span><span class=\"p\">.</span><span class=\"kt\">i64</span><span class=\"w\"> </span><span class=\"mi\">50</span>\n<span class=\"w\">    </span><span class=\"n\">v9</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">iconst</span><span class=\"p\">.</span><span class=\"kt\">i64</span><span class=\"w\"> </span><span class=\"mi\">55</span>\n<span class=\"w\">    </span><span class=\"n\">v10</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">iconst</span><span class=\"p\">.</span><span class=\"kt\">i64</span><span class=\"w\"> </span><span class=\"mi\">60</span>\n<span class=\"w\">    </span><span class=\"n\">v11</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">iconst</span><span class=\"p\">.</span><span class=\"kt\">i64</span><span class=\"w\"> </span><span class=\"mi\">65</span>\n<span class=\"w\">    </span><span class=\"n\">v12</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">iconst</span><span class=\"p\">.</span><span class=\"kt\">i64</span><span class=\"w\"> </span><span class=\"mi\">70</span>\n<span class=\"w\">    </span><span class=\"n\">v13</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">iconst</span><span class=\"p\">.</span><span class=\"kt\">i64</span><span class=\"w\"> </span><span class=\"mi\">75</span>\n<span class=\"w\">    </span><span class=\"n\">v14</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">iconst</span><span class=\"p\">.</span><span class=\"kt\">i64</span><span class=\"w\"> </span><span class=\"mi\">80</span>\n<span class=\"w\">    </span><span class=\"n\">v15</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">call</span><span class=\"w\"> </span><span class=\"n\">fn0</span><span class=\"p\">(</span><span class=\"n\">v0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v2</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v3</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v4</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v5</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v6</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v7</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v8</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v9</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v10</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v11</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v12</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v13</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v14</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">v15</span>\n<span class=\"p\">}</span>\n\n<span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">run</span>: <span class=\"o\">%</span><span class=\"n\">tail_caller_stack_args</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"mi\">80</span>\n</code></pre></div>\n<p>Running in a debugger isn't too useful because the crashing thread says it's at address <code>0x0000000000000037</code></p>\n<p>I don't know much about pointer authentication myself, but stepping through in a debugger this is the entire function <code>tail_caller_stack_args</code> with the highlighted instruction where when at that instruction the debugger no longer produces a backtrace:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"w\">    </span><span class=\"mh\">0x103fa80c8</span>: <span class=\"nc\">paciasp</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa80cc</span>: <span class=\"nc\">stp</span><span class=\"w\">    </span><span class=\"n\">x29</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">x30</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">sp</span><span class=\"p\">,</span><span class=\"w\"> </span>#<span class=\"o\">-</span><span class=\"mh\">0x10</span><span class=\"p\">]</span><span class=\"o\">!</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa80d0</span>: <span class=\"nc\">mov</span><span class=\"w\">    </span><span class=\"n\">x29</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">sp</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa80d4</span>: <span class=\"nc\">mov</span><span class=\"w\">    </span><span class=\"n\">x0</span><span class=\"p\">,</span><span class=\"w\"> </span>#<span class=\"mh\">0xa</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa80d8</span>: <span class=\"nc\">mov</span><span class=\"w\">    </span><span class=\"n\">x1</span><span class=\"p\">,</span><span class=\"w\"> </span>#<span class=\"mh\">0xf</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa80dc</span>: <span class=\"nc\">mov</span><span class=\"w\">    </span><span class=\"n\">x2</span><span class=\"p\">,</span><span class=\"w\"> </span>#<span class=\"mh\">0x14</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa80e0</span>: <span class=\"nc\">mov</span><span class=\"w\">    </span><span class=\"n\">x3</span><span class=\"p\">,</span><span class=\"w\"> </span>#<span class=\"mh\">0x19</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa80e4</span>: <span class=\"nc\">mov</span><span class=\"w\">    </span><span class=\"n\">x4</span><span class=\"p\">,</span><span class=\"w\"> </span>#<span class=\"mh\">0x1e</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa80e8</span>: <span class=\"nc\">mov</span><span class=\"w\">    </span><span class=\"n\">x5</span><span class=\"p\">,</span><span class=\"w\"> </span>#<span class=\"mh\">0x23</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa80ec</span>: <span class=\"nc\">mov</span><span class=\"w\">    </span><span class=\"n\">x6</span><span class=\"p\">,</span><span class=\"w\"> </span>#<span class=\"mh\">0x28</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa80f0</span>: <span class=\"nc\">mov</span><span class=\"w\">    </span><span class=\"n\">x7</span><span class=\"p\">,</span><span class=\"w\"> </span>#<span class=\"mh\">0x2d</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa80f4</span>: <span class=\"nc\">mov</span><span class=\"w\">    </span><span class=\"n\">x8</span><span class=\"p\">,</span><span class=\"w\"> </span>#<span class=\"mh\">0x32</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa80f8</span>: <span class=\"nc\">mov</span><span class=\"w\">    </span><span class=\"n\">x9</span><span class=\"p\">,</span><span class=\"w\"> </span>#<span class=\"mh\">0x37</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa80fc</span>: <span class=\"nc\">mov</span><span class=\"w\">    </span><span class=\"n\">x10</span><span class=\"p\">,</span><span class=\"w\"> </span>#<span class=\"mh\">0x3c</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa8100</span>: <span class=\"nc\">mov</span><span class=\"w\">    </span><span class=\"n\">x11</span><span class=\"p\">,</span><span class=\"w\"> </span>#<span class=\"mh\">0x41</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa8104</span>: <span class=\"nc\">mov</span><span class=\"w\">    </span><span class=\"n\">x12</span><span class=\"p\">,</span><span class=\"w\"> </span>#<span class=\"mh\">0x46</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa8108</span>: <span class=\"nc\">mov</span><span class=\"w\">    </span><span class=\"n\">x13</span><span class=\"p\">,</span><span class=\"w\"> </span>#<span class=\"mh\">0x4b</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa810c</span>: <span class=\"nc\">mov</span><span class=\"w\">    </span><span class=\"n\">x14</span><span class=\"p\">,</span><span class=\"w\"> </span>#<span class=\"mh\">0x50</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa8110</span>: <span class=\"nc\">sub</span><span class=\"w\">    </span><span class=\"n\">sp</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">sp</span><span class=\"p\">,</span><span class=\"w\"> </span>#<span class=\"mh\">0x40</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa8114</span>: <span class=\"nc\">stur</span><span class=\"w\">   </span><span class=\"n\">x8</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">sp</span><span class=\"p\">]</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa8118</span>: <span class=\"nc\">stur</span><span class=\"w\">   </span><span class=\"n\">x9</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">sp</span><span class=\"p\">,</span><span class=\"w\"> </span>#<span class=\"mh\">0x8</span><span class=\"p\">]</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa811c</span>: <span class=\"nc\">stur</span><span class=\"w\">   </span><span class=\"n\">x10</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">sp</span><span class=\"p\">,</span><span class=\"w\"> </span>#<span class=\"mh\">0x10</span><span class=\"p\">]</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa8120</span>: <span class=\"nc\">stur</span><span class=\"w\">   </span><span class=\"n\">x11</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">sp</span><span class=\"p\">,</span><span class=\"w\"> </span>#<span class=\"mh\">0x18</span><span class=\"p\">]</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa8124</span>: <span class=\"nc\">stur</span><span class=\"w\">   </span><span class=\"n\">x12</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">sp</span><span class=\"p\">,</span><span class=\"w\"> </span>#<span class=\"mh\">0x20</span><span class=\"p\">]</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa8128</span>: <span class=\"nc\">stur</span><span class=\"w\">   </span><span class=\"n\">x13</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">sp</span><span class=\"p\">,</span><span class=\"w\"> </span>#<span class=\"mh\">0x28</span><span class=\"p\">]</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa812c</span>: <span class=\"nc\">stur</span><span class=\"w\">   </span><span class=\"n\">x14</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">sp</span><span class=\"p\">,</span><span class=\"w\"> </span>#<span class=\"mh\">0x30</span><span class=\"p\">]</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa8130</span>: <span class=\"nc\">ldr</span><span class=\"w\">    </span><span class=\"n\">x9</span><span class=\"p\">,</span><span class=\"w\"> </span>#<span class=\"mh\">0x8</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa8134</span>: <span class=\"nc\">b</span><span class=\"w\">      </span><span class=\"mh\">0x103fa8140</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa8138</span>: <span class=\"p\">.</span><span class=\"n\">long</span><span class=\"w\">  </span><span class=\"mh\">0x03fa8000</span><span class=\"w\">                </span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">unknown</span><span class=\"w\"> </span><span class=\"n\">opcode</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa813c</span>: <span class=\"nc\">udf</span><span class=\"w\">    </span>#<span class=\"mh\">0x1</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa8140</span>: <span class=\"nc\">blr</span><span class=\"w\">    </span><span class=\"n\">x9</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa8144</span>: <span class=\"nc\">ldp</span><span class=\"w\">    </span><span class=\"n\">x29</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">x30</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">sp</span><span class=\"p\">],</span><span class=\"w\"> </span>#<span class=\"mh\">0x10</span>\n-&gt;  <span class=\"mh\">0x103fa8148</span>: <span class=\"nc\">retaa</span>\n</code></pre></div>\n<p>The disassembly of <code>tail_callee_stack_args</code> looks like:</p>\n<p><div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"w\">    </span><span class=\"mh\">0x103fa8000</span>: <span class=\"nc\">paciasp</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa8004</span>: <span class=\"nc\">stp</span><span class=\"w\">    </span><span class=\"n\">x29</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">x30</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">sp</span><span class=\"p\">,</span><span class=\"w\"> </span>#<span class=\"o\">-</span><span class=\"mh\">0x10</span><span class=\"p\">]</span><span class=\"o\">!</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa8008</span>: <span class=\"nc\">mov</span><span class=\"w\">    </span><span class=\"n\">x29</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">sp</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa800c</span>: <span class=\"nc\">ldur</span><span class=\"w\">   </span><span class=\"n\">x9</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">x29</span><span class=\"p\">,</span><span class=\"w\"> </span>#<span class=\"mh\">0x10</span><span class=\"p\">]</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa8010</span>: <span class=\"nc\">ldur</span><span class=\"w\">   </span><span class=\"n\">x11</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">x29</span><span class=\"p\">,</span><span class=\"w\"> </span>#<span class=\"mh\">0x18</span><span class=\"p\">]</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa8014</span>: <span class=\"nc\">ldur</span><span class=\"w\">   </span><span class=\"n\">x13</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">x29</span><span class=\"p\">,</span><span class=\"w\"> </span>#<span class=\"mh\">0x20</span><span class=\"p\">]</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa8018</span>: <span class=\"nc\">ldur</span><span class=\"w\">   </span><span class=\"n\">x15</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">x29</span><span class=\"p\">,</span><span class=\"w\"> </span>#<span class=\"mh\">0x28</span><span class=\"p\">]</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa801c</span>: <span class=\"nc\">ldur</span><span class=\"w\">   </span><span class=\"n\">x1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">x29</span><span class=\"p\">,</span><span class=\"w\"> </span>#<span class=\"mh\">0x30</span><span class=\"p\">]</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa8020</span>: <span class=\"nc\">ldur</span><span class=\"w\">   </span><span class=\"n\">x3</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">x29</span><span class=\"p\">,</span><span class=\"w\"> </span>#<span class=\"mh\">0x38</span><span class=\"p\">]</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa8024</span>: <span class=\"nc\">ldur</span><span class=\"w\">   </span><span class=\"n\">x0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">x29</span><span class=\"p\">,</span><span class=\"w\"> </span>#<span class=\"mh\">0x40</span><span class=\"p\">]</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa8028</span>: <span class=\"nc\">ldp</span><span class=\"w\">    </span><span class=\"n\">x29</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">x30</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">sp</span><span class=\"p\">],</span><span class=\"w\"> </span>#<span class=\"mh\">0x10</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa802c</span>: <span class=\"nc\">retaa</span>\n</code></pre></div><br>\n</p>\n</blockquote>",
        "id": 365685490,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1686605299
    },
    {
        "content": "<p>alexcrichton labeled <a href=\"https://github.com/bytecodealliance/wasmtime/issues/6567\">issue #6567</a>:</p>\n<blockquote>\n<p>Locally on an AArch64 macbook I get:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">cargo</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"n\">test</span><span class=\"w\"> </span><span class=\"n\">filetests</span><span class=\"o\">/</span><span class=\"n\">filetests</span><span class=\"o\">/</span><span class=\"n\">runtests</span><span class=\"o\">/</span><span class=\"n\">tail</span><span class=\"o\">-</span><span class=\"n\">call</span><span class=\"o\">-</span><span class=\"n\">conv</span><span class=\"p\">.</span><span class=\"n\">clif</span>\n<span class=\"n\">zsh</span>: <span class=\"nc\">bus</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"w\">  </span><span class=\"n\">cargo</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">q</span><span class=\"w\"> </span><span class=\"n\">test</span><span class=\"w\"> </span><span class=\"n\">filetests</span><span class=\"o\">/</span><span class=\"n\">filetests</span><span class=\"o\">/</span><span class=\"n\">runtests</span><span class=\"o\">/</span><span class=\"n\">tail</span><span class=\"o\">-</span><span class=\"n\">call</span><span class=\"o\">-</span><span class=\"n\">conv</span><span class=\"p\">.</span><span class=\"n\">clif</span>\n</code></pre></div>\n<p>If I comment out the <code>target aarch64 has_pauth sign_return_address</code> directive the test passes, and the first test that fails is:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">test</span><span class=\"w\"> </span><span class=\"n\">run</span>\n\n<span class=\"n\">target</span><span class=\"w\"> </span><span class=\"n\">aarch64</span><span class=\"w\"> </span><span class=\"n\">has_pauth</span><span class=\"w\"> </span><span class=\"n\">sign_return_address</span>\n\n<span class=\"p\">;;</span><span class=\"w\"> </span><span class=\"n\">Test</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">tail</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">calling</span><span class=\"w\"> </span><span class=\"n\">convention</span><span class=\"w\"> </span><span class=\"n\">with</span><span class=\"w\"> </span><span class=\"n\">non</span><span class=\"o\">-</span><span class=\"n\">tail</span><span class=\"w\"> </span><span class=\"n\">calls</span><span class=\"w\"> </span><span class=\"n\">and</span><span class=\"w\"> </span><span class=\"n\">stack</span><span class=\"w\"> </span><span class=\"n\">arguments</span><span class=\"p\">.</span>\n\n<span class=\"n\">function</span><span class=\"w\"> </span><span class=\"o\">%</span><span class=\"n\">tail_callee_stack_args</span><span class=\"p\">(</span><span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"p\">)</span><span class=\"w\"> </span>-&gt; <span class=\"kt\">i64</span> <span class=\"nc\">tail</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"n\">block0</span><span class=\"p\">(</span><span class=\"n\">v0</span>: <span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v1</span>: <span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v2</span>: <span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v3</span>: <span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v4</span>: <span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v5</span>: <span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v6</span>: <span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v7</span>: <span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v8</span>: <span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v9</span>: <span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v10</span>: <span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v11</span>: <span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v12</span>: <span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v13</span>: <span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v14</span>: <span class=\"kt\">i64</span><span class=\"p\">)</span>:\n    <span class=\"nc\">return</span><span class=\"w\"> </span><span class=\"n\">v14</span>\n<span class=\"p\">}</span>\n\n<span class=\"n\">function</span><span class=\"w\"> </span><span class=\"o\">%</span><span class=\"n\">tail_caller_stack_args</span><span class=\"p\">()</span><span class=\"w\"> </span>-&gt; <span class=\"kt\">i64</span> <span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"n\">fn0</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">%</span><span class=\"n\">tail_callee_stack_args</span><span class=\"p\">(</span><span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"p\">)</span><span class=\"w\"> </span>-&gt; <span class=\"kt\">i64</span> <span class=\"nc\">tail</span>\n\n<span class=\"n\">block0</span>:\n    <span class=\"nc\">v0</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">iconst</span><span class=\"p\">.</span><span class=\"kt\">i64</span><span class=\"w\"> </span><span class=\"mi\">10</span>\n<span class=\"w\">    </span><span class=\"n\">v1</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">iconst</span><span class=\"p\">.</span><span class=\"kt\">i64</span><span class=\"w\"> </span><span class=\"mi\">15</span>\n<span class=\"w\">    </span><span class=\"n\">v2</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">iconst</span><span class=\"p\">.</span><span class=\"kt\">i64</span><span class=\"w\"> </span><span class=\"mi\">20</span>\n<span class=\"w\">    </span><span class=\"n\">v3</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">iconst</span><span class=\"p\">.</span><span class=\"kt\">i64</span><span class=\"w\"> </span><span class=\"mi\">25</span>\n<span class=\"w\">    </span><span class=\"n\">v4</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">iconst</span><span class=\"p\">.</span><span class=\"kt\">i64</span><span class=\"w\"> </span><span class=\"mi\">30</span>\n<span class=\"w\">    </span><span class=\"n\">v5</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">iconst</span><span class=\"p\">.</span><span class=\"kt\">i64</span><span class=\"w\"> </span><span class=\"mi\">35</span>\n<span class=\"w\">    </span><span class=\"n\">v6</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">iconst</span><span class=\"p\">.</span><span class=\"kt\">i64</span><span class=\"w\"> </span><span class=\"mi\">40</span>\n<span class=\"w\">    </span><span class=\"n\">v7</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">iconst</span><span class=\"p\">.</span><span class=\"kt\">i64</span><span class=\"w\"> </span><span class=\"mi\">45</span>\n<span class=\"w\">    </span><span class=\"n\">v8</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">iconst</span><span class=\"p\">.</span><span class=\"kt\">i64</span><span class=\"w\"> </span><span class=\"mi\">50</span>\n<span class=\"w\">    </span><span class=\"n\">v9</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">iconst</span><span class=\"p\">.</span><span class=\"kt\">i64</span><span class=\"w\"> </span><span class=\"mi\">55</span>\n<span class=\"w\">    </span><span class=\"n\">v10</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">iconst</span><span class=\"p\">.</span><span class=\"kt\">i64</span><span class=\"w\"> </span><span class=\"mi\">60</span>\n<span class=\"w\">    </span><span class=\"n\">v11</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">iconst</span><span class=\"p\">.</span><span class=\"kt\">i64</span><span class=\"w\"> </span><span class=\"mi\">65</span>\n<span class=\"w\">    </span><span class=\"n\">v12</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">iconst</span><span class=\"p\">.</span><span class=\"kt\">i64</span><span class=\"w\"> </span><span class=\"mi\">70</span>\n<span class=\"w\">    </span><span class=\"n\">v13</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">iconst</span><span class=\"p\">.</span><span class=\"kt\">i64</span><span class=\"w\"> </span><span class=\"mi\">75</span>\n<span class=\"w\">    </span><span class=\"n\">v14</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">iconst</span><span class=\"p\">.</span><span class=\"kt\">i64</span><span class=\"w\"> </span><span class=\"mi\">80</span>\n<span class=\"w\">    </span><span class=\"n\">v15</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">call</span><span class=\"w\"> </span><span class=\"n\">fn0</span><span class=\"p\">(</span><span class=\"n\">v0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v2</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v3</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v4</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v5</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v6</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v7</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v8</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v9</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v10</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v11</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v12</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v13</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v14</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">v15</span>\n<span class=\"p\">}</span>\n\n<span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">run</span>: <span class=\"o\">%</span><span class=\"n\">tail_caller_stack_args</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"mi\">80</span>\n</code></pre></div>\n<p>Running in a debugger isn't too useful because the crashing thread says it's at address <code>0x0000000000000037</code></p>\n<p>I don't know much about pointer authentication myself, but stepping through in a debugger this is the entire function <code>tail_caller_stack_args</code> with the highlighted instruction where when at that instruction the debugger no longer produces a backtrace:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"w\">    </span><span class=\"mh\">0x103fa80c8</span>: <span class=\"nc\">paciasp</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa80cc</span>: <span class=\"nc\">stp</span><span class=\"w\">    </span><span class=\"n\">x29</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">x30</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">sp</span><span class=\"p\">,</span><span class=\"w\"> </span>#<span class=\"o\">-</span><span class=\"mh\">0x10</span><span class=\"p\">]</span><span class=\"o\">!</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa80d0</span>: <span class=\"nc\">mov</span><span class=\"w\">    </span><span class=\"n\">x29</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">sp</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa80d4</span>: <span class=\"nc\">mov</span><span class=\"w\">    </span><span class=\"n\">x0</span><span class=\"p\">,</span><span class=\"w\"> </span>#<span class=\"mh\">0xa</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa80d8</span>: <span class=\"nc\">mov</span><span class=\"w\">    </span><span class=\"n\">x1</span><span class=\"p\">,</span><span class=\"w\"> </span>#<span class=\"mh\">0xf</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa80dc</span>: <span class=\"nc\">mov</span><span class=\"w\">    </span><span class=\"n\">x2</span><span class=\"p\">,</span><span class=\"w\"> </span>#<span class=\"mh\">0x14</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa80e0</span>: <span class=\"nc\">mov</span><span class=\"w\">    </span><span class=\"n\">x3</span><span class=\"p\">,</span><span class=\"w\"> </span>#<span class=\"mh\">0x19</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa80e4</span>: <span class=\"nc\">mov</span><span class=\"w\">    </span><span class=\"n\">x4</span><span class=\"p\">,</span><span class=\"w\"> </span>#<span class=\"mh\">0x1e</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa80e8</span>: <span class=\"nc\">mov</span><span class=\"w\">    </span><span class=\"n\">x5</span><span class=\"p\">,</span><span class=\"w\"> </span>#<span class=\"mh\">0x23</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa80ec</span>: <span class=\"nc\">mov</span><span class=\"w\">    </span><span class=\"n\">x6</span><span class=\"p\">,</span><span class=\"w\"> </span>#<span class=\"mh\">0x28</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa80f0</span>: <span class=\"nc\">mov</span><span class=\"w\">    </span><span class=\"n\">x7</span><span class=\"p\">,</span><span class=\"w\"> </span>#<span class=\"mh\">0x2d</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa80f4</span>: <span class=\"nc\">mov</span><span class=\"w\">    </span><span class=\"n\">x8</span><span class=\"p\">,</span><span class=\"w\"> </span>#<span class=\"mh\">0x32</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa80f8</span>: <span class=\"nc\">mov</span><span class=\"w\">    </span><span class=\"n\">x9</span><span class=\"p\">,</span><span class=\"w\"> </span>#<span class=\"mh\">0x37</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa80fc</span>: <span class=\"nc\">mov</span><span class=\"w\">    </span><span class=\"n\">x10</span><span class=\"p\">,</span><span class=\"w\"> </span>#<span class=\"mh\">0x3c</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa8100</span>: <span class=\"nc\">mov</span><span class=\"w\">    </span><span class=\"n\">x11</span><span class=\"p\">,</span><span class=\"w\"> </span>#<span class=\"mh\">0x41</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa8104</span>: <span class=\"nc\">mov</span><span class=\"w\">    </span><span class=\"n\">x12</span><span class=\"p\">,</span><span class=\"w\"> </span>#<span class=\"mh\">0x46</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa8108</span>: <span class=\"nc\">mov</span><span class=\"w\">    </span><span class=\"n\">x13</span><span class=\"p\">,</span><span class=\"w\"> </span>#<span class=\"mh\">0x4b</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa810c</span>: <span class=\"nc\">mov</span><span class=\"w\">    </span><span class=\"n\">x14</span><span class=\"p\">,</span><span class=\"w\"> </span>#<span class=\"mh\">0x50</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa8110</span>: <span class=\"nc\">sub</span><span class=\"w\">    </span><span class=\"n\">sp</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">sp</span><span class=\"p\">,</span><span class=\"w\"> </span>#<span class=\"mh\">0x40</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa8114</span>: <span class=\"nc\">stur</span><span class=\"w\">   </span><span class=\"n\">x8</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">sp</span><span class=\"p\">]</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa8118</span>: <span class=\"nc\">stur</span><span class=\"w\">   </span><span class=\"n\">x9</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">sp</span><span class=\"p\">,</span><span class=\"w\"> </span>#<span class=\"mh\">0x8</span><span class=\"p\">]</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa811c</span>: <span class=\"nc\">stur</span><span class=\"w\">   </span><span class=\"n\">x10</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">sp</span><span class=\"p\">,</span><span class=\"w\"> </span>#<span class=\"mh\">0x10</span><span class=\"p\">]</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa8120</span>: <span class=\"nc\">stur</span><span class=\"w\">   </span><span class=\"n\">x11</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">sp</span><span class=\"p\">,</span><span class=\"w\"> </span>#<span class=\"mh\">0x18</span><span class=\"p\">]</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa8124</span>: <span class=\"nc\">stur</span><span class=\"w\">   </span><span class=\"n\">x12</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">sp</span><span class=\"p\">,</span><span class=\"w\"> </span>#<span class=\"mh\">0x20</span><span class=\"p\">]</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa8128</span>: <span class=\"nc\">stur</span><span class=\"w\">   </span><span class=\"n\">x13</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">sp</span><span class=\"p\">,</span><span class=\"w\"> </span>#<span class=\"mh\">0x28</span><span class=\"p\">]</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa812c</span>: <span class=\"nc\">stur</span><span class=\"w\">   </span><span class=\"n\">x14</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">sp</span><span class=\"p\">,</span><span class=\"w\"> </span>#<span class=\"mh\">0x30</span><span class=\"p\">]</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa8130</span>: <span class=\"nc\">ldr</span><span class=\"w\">    </span><span class=\"n\">x9</span><span class=\"p\">,</span><span class=\"w\"> </span>#<span class=\"mh\">0x8</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa8134</span>: <span class=\"nc\">b</span><span class=\"w\">      </span><span class=\"mh\">0x103fa8140</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa8138</span>: <span class=\"p\">.</span><span class=\"n\">long</span><span class=\"w\">  </span><span class=\"mh\">0x03fa8000</span><span class=\"w\">                </span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">unknown</span><span class=\"w\"> </span><span class=\"n\">opcode</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa813c</span>: <span class=\"nc\">udf</span><span class=\"w\">    </span>#<span class=\"mh\">0x1</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa8140</span>: <span class=\"nc\">blr</span><span class=\"w\">    </span><span class=\"n\">x9</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa8144</span>: <span class=\"nc\">ldp</span><span class=\"w\">    </span><span class=\"n\">x29</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">x30</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">sp</span><span class=\"p\">],</span><span class=\"w\"> </span>#<span class=\"mh\">0x10</span>\n-&gt;  <span class=\"mh\">0x103fa8148</span>: <span class=\"nc\">retaa</span>\n</code></pre></div>\n<p>The disassembly of <code>tail_callee_stack_args</code> looks like:</p>\n<p><div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"w\">    </span><span class=\"mh\">0x103fa8000</span>: <span class=\"nc\">paciasp</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa8004</span>: <span class=\"nc\">stp</span><span class=\"w\">    </span><span class=\"n\">x29</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">x30</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">sp</span><span class=\"p\">,</span><span class=\"w\"> </span>#<span class=\"o\">-</span><span class=\"mh\">0x10</span><span class=\"p\">]</span><span class=\"o\">!</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa8008</span>: <span class=\"nc\">mov</span><span class=\"w\">    </span><span class=\"n\">x29</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">sp</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa800c</span>: <span class=\"nc\">ldur</span><span class=\"w\">   </span><span class=\"n\">x9</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">x29</span><span class=\"p\">,</span><span class=\"w\"> </span>#<span class=\"mh\">0x10</span><span class=\"p\">]</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa8010</span>: <span class=\"nc\">ldur</span><span class=\"w\">   </span><span class=\"n\">x11</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">x29</span><span class=\"p\">,</span><span class=\"w\"> </span>#<span class=\"mh\">0x18</span><span class=\"p\">]</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa8014</span>: <span class=\"nc\">ldur</span><span class=\"w\">   </span><span class=\"n\">x13</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">x29</span><span class=\"p\">,</span><span class=\"w\"> </span>#<span class=\"mh\">0x20</span><span class=\"p\">]</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa8018</span>: <span class=\"nc\">ldur</span><span class=\"w\">   </span><span class=\"n\">x15</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">x29</span><span class=\"p\">,</span><span class=\"w\"> </span>#<span class=\"mh\">0x28</span><span class=\"p\">]</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa801c</span>: <span class=\"nc\">ldur</span><span class=\"w\">   </span><span class=\"n\">x1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">x29</span><span class=\"p\">,</span><span class=\"w\"> </span>#<span class=\"mh\">0x30</span><span class=\"p\">]</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa8020</span>: <span class=\"nc\">ldur</span><span class=\"w\">   </span><span class=\"n\">x3</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">x29</span><span class=\"p\">,</span><span class=\"w\"> </span>#<span class=\"mh\">0x38</span><span class=\"p\">]</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa8024</span>: <span class=\"nc\">ldur</span><span class=\"w\">   </span><span class=\"n\">x0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">x29</span><span class=\"p\">,</span><span class=\"w\"> </span>#<span class=\"mh\">0x40</span><span class=\"p\">]</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa8028</span>: <span class=\"nc\">ldp</span><span class=\"w\">    </span><span class=\"n\">x29</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">x30</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">sp</span><span class=\"p\">],</span><span class=\"w\"> </span>#<span class=\"mh\">0x10</span>\n<span class=\"w\">    </span><span class=\"mh\">0x103fa802c</span>: <span class=\"nc\">retaa</span>\n</code></pre></div><br>\n</p>\n</blockquote>",
        "id": 365685504,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1686605309
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/6567#issuecomment-1588141274\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/6567\">issue #6567</a>:</p>\n<blockquote>\n<p>With some tweaks I could reproduce this in QEMU. I downloaded and built QEMU 8.0.2 (not sure if that's required it's just the latest) and then changed <a href=\"https://github.com/bytecodealliance/wasmtime/blob/a986ce968232918bf8493d9f61b0462d1e72e5ef/cranelift/native/src/lib.rs#L143\">this condition</a> to always return <code>true</code>. I then ran this in one window:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">qemu</span><span class=\"o\">-</span><span class=\"n\">aarch64</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"mi\">1234</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">cpu</span><span class=\"w\"> </span><span class=\"n\">max</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">acrichto</span><span class=\"o\">/</span><span class=\"n\">code</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">/</span><span class=\"n\">target</span><span class=\"o\">/</span><span class=\"n\">debug</span><span class=\"o\">/</span><span class=\"n\">clif</span><span class=\"o\">-</span><span class=\"n\">util</span><span class=\"w\"> </span><span class=\"n\">test</span><span class=\"w\"> </span><span class=\"n\">filetests</span><span class=\"o\">/</span><span class=\"n\">filetests</span><span class=\"o\">/</span><span class=\"n\">runtests</span><span class=\"o\">/</span><span class=\"n\">tail</span><span class=\"o\">-</span><span class=\"n\">call</span><span class=\"o\">-</span><span class=\"n\">conv</span><span class=\"p\">.</span><span class=\"n\">clif</span>\n</code></pre></div>\n<p>and this in another window:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">gdb</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">acrichto</span><span class=\"o\">/</span><span class=\"n\">code</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">/</span><span class=\"n\">target</span><span class=\"o\">/</span><span class=\"n\">debug</span><span class=\"o\">/</span><span class=\"n\">clif</span><span class=\"o\">-</span><span class=\"n\">util</span>\n<span class=\"p\">(</span><span class=\"n\">gdb</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">target</span><span class=\"w\"> </span><span class=\"n\">remote</span><span class=\"w\"> </span>:<span class=\"mi\">1234</span>\n<span class=\"n\">Remote</span><span class=\"w\"> </span><span class=\"n\">debugging</span><span class=\"w\"> </span><span class=\"n\">using</span><span class=\"w\"> </span>:<span class=\"mi\">1234</span>\n<span class=\"n\">warning</span>: <span class=\"nc\">remote</span><span class=\"w\"> </span><span class=\"n\">target</span><span class=\"w\"> </span><span class=\"n\">does</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">support</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"w\"> </span><span class=\"n\">transfer</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">attempting</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">access</span><span class=\"w\"> </span><span class=\"n\">files</span><span class=\"w\"> </span><span class=\"n\">from</span><span class=\"w\"> </span><span class=\"n\">local</span><span class=\"w\"> </span><span class=\"n\">filesystem</span><span class=\"p\">.</span>\n<span class=\"n\">Reading</span><span class=\"w\"> </span><span class=\"n\">symbols</span><span class=\"w\"> </span><span class=\"n\">from</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"o\">/</span><span class=\"n\">ld</span><span class=\"o\">-</span><span class=\"n\">linux</span><span class=\"o\">-</span><span class=\"n\">aarch64</span><span class=\"p\">.</span><span class=\"n\">so</span><span class=\"p\">.</span><span class=\"mi\">1</span><span class=\"o\">..</span><span class=\"p\">.</span>\n<span class=\"p\">(</span><span class=\"n\">No</span><span class=\"w\"> </span><span class=\"n\">debugging</span><span class=\"w\"> </span><span class=\"n\">symbols</span><span class=\"w\"> </span><span class=\"n\">found</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"o\">/</span><span class=\"n\">ld</span><span class=\"o\">-</span><span class=\"n\">linux</span><span class=\"o\">-</span><span class=\"n\">aarch64</span><span class=\"p\">.</span><span class=\"n\">so</span><span class=\"p\">.</span><span class=\"mi\">1</span><span class=\"p\">)</span>\n<span class=\"mh\">0x000000550470e140</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"o\">??</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">from</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"o\">/</span><span class=\"n\">ld</span><span class=\"o\">-</span><span class=\"n\">linux</span><span class=\"o\">-</span><span class=\"n\">aarch64</span><span class=\"p\">.</span><span class=\"n\">so</span><span class=\"p\">.</span><span class=\"mi\">1</span>\n<span class=\"p\">(</span><span class=\"n\">gdb</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">c</span>\n<span class=\"n\">Continuing</span><span class=\"p\">.</span>\n<span class=\"p\">[</span><span class=\"n\">New</span><span class=\"w\"> </span><span class=\"n\">Thread</span><span class=\"w\"> </span><span class=\"mf\">1.753689</span><span class=\"p\">]</span>\n<span class=\"p\">[</span><span class=\"n\">New</span><span class=\"w\"> </span><span class=\"n\">Thread</span><span class=\"w\"> </span><span class=\"mf\">1.753686</span><span class=\"p\">]</span>\n\n<span class=\"n\">Thread</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"n\">received</span><span class=\"w\"> </span><span class=\"n\">signal</span><span class=\"w\"> </span><span class=\"n\">SIGSEGV</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Segmentation</span><span class=\"w\"> </span><span class=\"n\">fault</span><span class=\"p\">.</span>\n<span class=\"p\">[</span><span class=\"n\">Switching</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">Thread</span><span class=\"w\"> </span><span class=\"mf\">1.753689</span><span class=\"p\">]</span>\n<span class=\"mh\">0x0020000000000037</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"o\">??</span><span class=\"w\"> </span><span class=\"p\">()</span>\n</code></pre></div>\n<p>which I think reproduces the issue (although I'm not 100% sure, but it's at least the same crashing address as it was natively)</p>\n</blockquote>",
        "id": 365686753,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1686605824
    }
]