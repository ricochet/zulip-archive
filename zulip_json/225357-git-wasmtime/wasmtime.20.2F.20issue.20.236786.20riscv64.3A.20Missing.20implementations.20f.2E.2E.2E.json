[
    {
        "content": "<p>candymate opened <a href=\"https://github.com/bytecodealliance/wasmtime/issues/6786\">issue #6786</a>:</p>\n<blockquote>\n<h3>Test Case</h3>\n<p>Any cases with v128.loadXXX or v128.storeXXX would work</p>\n<p>One example</p>\n<div class=\"codehilite\" data-code-language=\"WebAssembly\"><pre><span></span><code><span class=\"p\">(</span><span class=\"k\">module</span>\n  <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"cm\">(;0;)</span> <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"p\">(</span><span class=\"k\">param</span> <span class=\"kt\">i32</span> <span class=\"err\">v</span><span class=\"mf\">128</span><span class=\"p\">)))</span>\n  <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"cm\">(;0;)</span> <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"mi\">0</span><span class=\"p\">)</span> <span class=\"p\">(</span><span class=\"k\">param</span> <span class=\"kt\">i32</span> <span class=\"err\">v</span><span class=\"mf\">128</span><span class=\"p\">)</span>\n    <span class=\"nb\">local.get</span> <span class=\"mi\">0</span>\n    <span class=\"nb\">local.get</span> <span class=\"mi\">1</span>\n    <span class=\"err\">v</span><span class=\"mf\">128</span><span class=\"err\">.store</span><span class=\"mi\">16</span><span class=\"err\">_lane</span> <span class=\"err\">align=</span><span class=\"mf\">1 0</span>\n  <span class=\"p\">)</span>\n  <span class=\"p\">(</span><span class=\"k\">export</span> <span class=\"s2\">\"main\"</span> <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"mi\">0</span><span class=\"p\">))</span>\n<span class=\"p\">)</span>\n</code></pre></div>\n<h3>Steps to Reproduce</h3>\n<p>Compiling any cases containing v128.loadXXX or v128.storeXXX leads to reaching unreachable code.<br>\nSuch compilations lead to reaching the following codes</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"c1\">// cranelift/codegen/src/isa/riscv64/inst/args.rs:1289</span>\n<span class=\"k\">pub</span><span class=\"p\">(</span><span class=\"k\">crate</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"k\">fn</span> <span class=\"nf\">from_type</span><span class=\"p\">(</span><span class=\"n\">t</span>: <span class=\"nc\">Type</span><span class=\"p\">)</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">Self</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"p\">.</span><span class=\"n\">is_float</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"n\">F32</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"bp\">Self</span>::<span class=\"n\">Flw</span><span class=\"w\"> </span><span class=\"p\">}</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"bp\">Self</span>::<span class=\"n\">Fld</span><span class=\"w\"> </span><span class=\"p\">};</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n<span class=\"w\">    </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"n\">R32</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">Self</span>::<span class=\"n\">Lwu</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"n\">R64</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">I64</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">Self</span>::<span class=\"n\">Ld</span><span class=\"p\">,</span>\n\n<span class=\"w\">        </span><span class=\"n\">I8</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">Self</span>::<span class=\"n\">Lb</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"n\">I16</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">Self</span>::<span class=\"n\">Lh</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"n\">I32</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">Self</span>::<span class=\"n\">Lw</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"n\">_</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"fm\">unreachable!</span><span class=\"p\">(),</span><span class=\"w\"> </span><span class=\"c1\">// reaches here</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"c1\">// cranelift/codegen/src/isa/riscv64/inst/args.rs:1338</span>\n<span class=\"k\">pub</span><span class=\"p\">(</span><span class=\"k\">crate</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"k\">fn</span> <span class=\"nf\">from_type</span><span class=\"p\">(</span><span class=\"n\">t</span>: <span class=\"nc\">Type</span><span class=\"p\">)</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">Self</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"p\">.</span><span class=\"n\">is_float</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"n\">F32</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"bp\">Self</span>::<span class=\"n\">Fsw</span><span class=\"w\"> </span><span class=\"p\">}</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"bp\">Self</span>::<span class=\"n\">Fsd</span><span class=\"w\"> </span><span class=\"p\">};</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n<span class=\"w\">    </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"p\">.</span><span class=\"n\">bits</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"mi\">8</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">Self</span>::<span class=\"n\">Sb</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"mi\">16</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">Self</span>::<span class=\"n\">Sh</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"mi\">32</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">Self</span>::<span class=\"n\">Sw</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"mi\">64</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">Self</span>::<span class=\"n\">Sd</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"n\">_</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"fm\">unreachable!</span><span class=\"p\">(),</span><span class=\"w\"> </span><span class=\"c1\">// reaches here</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p>Steps are the following:</p>\n<ol>\n<li><code>git submodule update --init</code></li>\n<li><code>cargo run --release --target=riscv64gc-unknown-linux-gnu test.wasm</code></li>\n</ol>\n<h3>Expected Results</h3>\n<p>Successful compilation</p>\n<h3>Actual Results</h3>\n<p>Panics with 'internal error: entered unreachable code'</p>\n<h3>Versions and Environment</h3>\n<p>Wasmtime version or commit: v11.0.1 Release</p>\n<p>Operating system: Ubuntu 20.04.6</p>\n<p>Architecture: RISC-V64</p>\n</blockquote>",
        "id": 380186553,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1690777364
    },
    {
        "content": "<p><a href=\"https://github.com/candymate\">candymate</a> added the bug label to <a href=\"https://github.com/bytecodealliance/wasmtime/issues/6786\">Issue #6786</a>.</p>",
        "id": 380186554,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1690777364
    },
    {
        "content": "<p>cfallin <a href=\"https://github.com/bytecodealliance/wasmtime/issues/6786#issuecomment-1657567569\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/6786\">issue #6786</a>:</p>\n<blockquote>\n<p>SIMD support on RISC-V is still a work-in-progress; @afonso360 was contributing code a few opcodes at a time recently. So it's expected that this doesn't yet work, though contributions are welcome if you're interested in tackling this!</p>\n</blockquote>",
        "id": 380188739,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1690778664
    },
    {
        "content": "<p>afonso360 <a href=\"https://github.com/bytecodealliance/wasmtime/issues/6786#issuecomment-1657930997\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/6786\">issue #6786</a>:</p>\n<blockquote>\n<p><span aria-label=\"wave\" class=\"emoji emoji-1f44b\" role=\"img\" title=\"wave\">:wave:</span> Hey,</p>\n<p>This code should work, but SIMD support only works on machines with Vector extensions. </p>\n<p>Are you running this natively on a RISC-V machine? Or just using QEMU?</p>\n<p>If you are running on QEMU you can add the following parameter to make <code>-cpu rv64,v=true,vlen=128,vext_spec=v1.0</code> this compile and run.</p>\n<p>If you are running on an actual RISC-V machine, please make sure it supports version 1.0 of the Vector Extension. I haven't tested with 0.7.1 (popular in a lot of current CPU's) but I doubt it would work since they are somewhat incompatible.</p>\n<p>That being said, we should probably have a better error message for this stuff.</p>\n</blockquote>",
        "id": 380244770,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1690793030
    },
    {
        "content": "<p>afonso360 edited a <a href=\"https://github.com/bytecodealliance/wasmtime/issues/6786#issuecomment-1657930997\">comment</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/6786\">issue #6786</a>:</p>\n<blockquote>\n<p><span aria-label=\"wave\" class=\"emoji emoji-1f44b\" role=\"img\" title=\"wave\">:wave:</span> Hey,</p>\n<p>This code should work, but SIMD support only works on machines with Vector extensions. </p>\n<p>Are you running this natively on a RISC-V machine? Or just using QEMU?</p>\n<p>If you are running on QEMU you can add the following parameter <code>-cpu rv64,v=true,vlen=128,vext_spec=v1.0</code> to make this compile and run.</p>\n<p>If you are running on an actual RISC-V machine, please make sure it supports version 1.0 of the Vector Extension. I haven't tested with 0.7.1 (popular in a lot of current CPU's) but I doubt it would work since they are somewhat incompatible.</p>\n<p>That being said, we should probably have a better error message for this stuff.</p>\n</blockquote>",
        "id": 380244912,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1690793048
    },
    {
        "content": "<p><a href=\"https://github.com/afonso360\">afonso360</a> added the cranelift:area:riscv64 label to <a href=\"https://github.com/bytecodealliance/wasmtime/issues/6786\">Issue #6786</a>.</p>",
        "id": 380247511,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1690793517
    },
    {
        "content": "<p>afonso360 edited a <a href=\"https://github.com/bytecodealliance/wasmtime/issues/6786#issuecomment-1657930997\">comment</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/6786\">issue #6786</a>:</p>\n<blockquote>\n<p><span aria-label=\"wave\" class=\"emoji emoji-1f44b\" role=\"img\" title=\"wave\">:wave:</span> Hey,</p>\n<p>This code should work, but SIMD support only works on machines with Vector extensions. </p>\n<p>Are you running this natively on a RISC-V machine, or just using QEMU?</p>\n<p>If you are running on QEMU you can add the following parameter <code>-cpu rv64,v=true,vlen=128,vext_spec=v1.0</code> to make this compile and run.</p>\n<p>If you are running on an actual RISC-V machine, please make sure it supports version 1.0 of the Vector Extension. I haven't tested with 0.7.1 (popular in a lot of current CPU's) but I doubt it would work since they are somewhat incompatible.</p>\n<p>That being said, we should probably have a better error message for this stuff.</p>\n</blockquote>",
        "id": 380247703,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1690793539
    },
    {
        "content": "<p>afonso360 edited a <a href=\"https://github.com/bytecodealliance/wasmtime/issues/6786#issuecomment-1657930997\">comment</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/6786\">issue #6786</a>:</p>\n<blockquote>\n<p><span aria-label=\"wave\" class=\"emoji emoji-1f44b\" role=\"img\" title=\"wave\">:wave:</span> Hey,</p>\n<p>This code should work, but SIMD support only works on machines with Vector extensions. </p>\n<p>Are you running this natively on a RISC-V machine, or just using QEMU?</p>\n<p>If you are running on QEMU you can add the following parameter <code>-cpu rv64,v=true,vlen=128,vext_spec=v1.0</code> to the QEMU arguments to make this compile and run.</p>\n<p>If you are running on an actual RISC-V machine, please make sure it supports version 1.0 of the Vector Extension. I haven't tested with 0.7.1 (popular in a lot of current CPU's) but I doubt it would work since they are somewhat incompatible.</p>\n<p>That being said, we should probably have a better error message for this stuff.</p>\n</blockquote>",
        "id": 380247807,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1690793557
    },
    {
        "content": "<p>afonso360 edited a <a href=\"https://github.com/bytecodealliance/wasmtime/issues/6786#issuecomment-1657930997\">comment</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/6786\">issue #6786</a>:</p>\n<blockquote>\n<p><span aria-label=\"wave\" class=\"emoji emoji-1f44b\" role=\"img\" title=\"wave\">:wave:</span> Hey,</p>\n<p>This code should work, but SIMD support only works on machines with Vector extensions. </p>\n<p>Are you running this natively on a RISC-V machine, or just using QEMU?</p>\n<p>If you are running on QEMU you can add the following parameter <code>-cpu rv64,v=true,vlen=128,vext_spec=v1.0</code> to the QEMU arguments to make this compile and run.</p>\n<p>If you are running on an actual RISC-V machine, please make sure it supports version 1.0 of the Vector Extension and that this is reported in <code>/proc/cpuinfo</code>. I haven't tested with 0.7.1 (popular in a lot of current CPU's) but I doubt it would work since they are somewhat incompatible.</p>\n<p>That being said, we should probably have a better error message for this stuff.</p>\n</blockquote>",
        "id": 380252670,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1690794403
    },
    {
        "content": "<p>candymate <a href=\"https://github.com/bytecodealliance/wasmtime/issues/6786#issuecomment-1659474296\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/6786\">issue #6786</a>:</p>\n<blockquote>\n<p>Hi,</p>\n<p>I'm currently running QEMU, so I added the parameter you gave me. But, it doesn't change anything.</p>\n<p>In ~/.cargo/config.toml, I have the following:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"p\">[</span><span class=\"n\">target</span><span class=\"p\">.</span><span class=\"n\">riscv64gc</span><span class=\"o\">-</span><span class=\"n\">unknown</span><span class=\"o\">-</span><span class=\"n\">linux</span><span class=\"o\">-</span><span class=\"n\">gnu</span><span class=\"p\">]</span>\n<span class=\"n\">linker</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">\"riscv64-linux-gnu-gcc\"</span>\n<span class=\"n\">runner</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">\"qemu-riscv64 -cpu rv64,v=true,vlen=128,vext_spec=v1.0 -L /usr/riscv64-linux-gnu -E LD_LIBRARY_PATH=/usr/riscv64-linux-gnu/lib -E WASMTIME_TEST_NO_HOG_MEMORY=1\"</span>\n</code></pre></div>\n<p>Just in case, I upgraded Ubuntu to 22.04, and built <code>qemu-riscv64</code> from the latest version of riscv-gnu-toolchain. (<a href=\"https://github.com/riscv-collab/riscv-gnu-toolchain\">https://github.com/riscv-collab/riscv-gnu-toolchain</a>)</p>\n<p>Versions I'm using are the following:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">qemu</span><span class=\"o\">-</span><span class=\"n\">riscv64</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">version</span>\n<span class=\"n\">qemu</span><span class=\"o\">-</span><span class=\"n\">riscv64</span><span class=\"w\"> </span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"mf\">7.1.0</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">v7</span><span class=\"p\">.</span><span class=\"mf\">1.0</span><span class=\"p\">)</span>\n<span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">riscv64</span><span class=\"o\">-</span><span class=\"n\">linux</span><span class=\"o\">-</span><span class=\"n\">gnu</span><span class=\"o\">-</span><span class=\"n\">gcc</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">version</span>\n<span class=\"n\">riscv64</span><span class=\"o\">-</span><span class=\"n\">linux</span><span class=\"o\">-</span><span class=\"n\">gnu</span><span class=\"o\">-</span><span class=\"n\">gcc</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">Ubuntu</span><span class=\"w\"> </span><span class=\"mf\">11.4.0</span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"n\">ubuntu1</span><span class=\"o\">~</span><span class=\"mf\">22.04</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"mf\">11.4.0</span>\n</code></pre></div>\n<p>Still leads to the following error message. (Ran with a simple wrapper to provide Wasm memory)</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"w\">     </span><span class=\"n\">Running</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">qemu</span><span class=\"o\">-</span><span class=\"n\">riscv64</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">cpu</span><span class=\"w\"> </span><span class=\"n\">rv64</span><span class=\"p\">,</span><span class=\"n\">v</span><span class=\"o\">=</span><span class=\"kc\">true</span><span class=\"p\">,</span><span class=\"n\">vlen</span><span class=\"o\">=</span><span class=\"mi\">128</span><span class=\"p\">,</span><span class=\"n\">vext_spec</span><span class=\"o\">=</span><span class=\"n\">v1</span><span class=\"p\">.</span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">L</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">usr</span><span class=\"o\">/</span><span class=\"n\">riscv64</span><span class=\"o\">-</span><span class=\"n\">linux</span><span class=\"o\">-</span><span class=\"n\">gnu</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"n\">LD_LIBRARY_PATH</span><span class=\"o\">=/</span><span class=\"n\">usr</span><span class=\"o\">/</span><span class=\"n\">riscv64</span><span class=\"o\">-</span><span class=\"n\">linux</span><span class=\"o\">-</span><span class=\"n\">gnu</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"n\">WASMTIME_TEST_NO_HOG_MEMORY</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">target</span><span class=\"o\">/</span><span class=\"n\">riscv64gc</span><span class=\"o\">-</span><span class=\"n\">unknown</span><span class=\"o\">-</span><span class=\"n\">linux</span><span class=\"o\">-</span><span class=\"n\">gnu</span><span class=\"o\">/</span><span class=\"n\">debug</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">wrapper</span><span class=\"w\"> </span><span class=\"n\">input</span><span class=\"err\">`</span>\n<span class=\"n\">thread</span><span class=\"w\"> </span><span class=\"o\">'&lt;</span><span class=\"n\">unnamed</span><span class=\"o\">&gt;'</span><span class=\"w\"> </span><span class=\"n\">panicked</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"na\">internal</span><span class=\"w\"> </span><span class=\"n\">error</span>: <span class=\"nc\">entered</span><span class=\"w\"> </span><span class=\"n\">unreachable</span><span class=\"w\"> </span><span class=\"n\">code</span><span class=\"o\">'</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">candymate</span><span class=\"o\">/</span><span class=\"p\">.</span><span class=\"n\">cargo</span><span class=\"o\">/</span><span class=\"n\">registry</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">index</span><span class=\"p\">.</span><span class=\"n\">crates</span><span class=\"p\">.</span><span class=\"n\">io</span><span class=\"o\">-</span><span class=\"mi\">6</span><span class=\"n\">f17d22bba15001f</span><span class=\"o\">/</span><span class=\"n\">cranelift</span><span class=\"o\">-</span><span class=\"n\">codegen</span><span class=\"o\">-</span><span class=\"mf\">0.98.1</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">isa</span><span class=\"o\">/</span><span class=\"n\">riscv64</span><span class=\"o\">/</span><span class=\"n\">inst</span><span class=\"o\">/</span><span class=\"n\">args</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">1347</span>:<span class=\"mi\">18</span>\n<span class=\"n\">note</span>: <span class=\"nc\">run</span><span class=\"w\"> </span><span class=\"n\">with</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">RUST_BACKTRACE</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">environment</span><span class=\"w\"> </span><span class=\"n\">variable</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">display</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">backtrace</span>\n</code></pre></div>\n<p>It would be helpful if you tell me what I'm missing.</p>\n</blockquote>",
        "id": 380543190,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1690857271
    },
    {
        "content": "<p>candymate edited a <a href=\"https://github.com/bytecodealliance/wasmtime/issues/6786#issuecomment-1659474296\">comment</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/6786\">issue #6786</a>:</p>\n<blockquote>\n<p>Hi,</p>\n<p>I'm currently running QEMU, so I added the parameter you gave me. But, it doesn't change anything.</p>\n<p>In ~/.cargo/config.toml, I have the following:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"p\">[</span><span class=\"n\">target</span><span class=\"p\">.</span><span class=\"n\">riscv64gc</span><span class=\"o\">-</span><span class=\"n\">unknown</span><span class=\"o\">-</span><span class=\"n\">linux</span><span class=\"o\">-</span><span class=\"n\">gnu</span><span class=\"p\">]</span>\n<span class=\"n\">linker</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">\"riscv64-linux-gnu-gcc\"</span>\n<span class=\"n\">runner</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">\"qemu-riscv64 -cpu rv64,v=true,vlen=128,vext_spec=v1.0 -L /usr/riscv64-linux-gnu -E LD_LIBRARY_PATH=/usr/riscv64-linux-gnu/lib -E WASMTIME_TEST_NO_HOG_MEMORY=1\"</span>\n</code></pre></div>\n<p>Just in case, I upgraded Ubuntu to 22.04, and built <code>qemu-riscv64</code> from the latest version of riscv-gnu-toolchain. (<a href=\"https://github.com/riscv-collab/riscv-gnu-toolchain\">https://github.com/riscv-collab/riscv-gnu-toolchain</a>)</p>\n<p>Versions I'm using are the following:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">rustc</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">version</span>\n<span class=\"n\">rustc</span><span class=\"w\"> </span><span class=\"mf\">1.71.0</span><span class=\"o\">-</span><span class=\"n\">nightly</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">ce5919fce</span><span class=\"w\"> </span><span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">05</span><span class=\"o\">-</span><span class=\"mi\">15</span><span class=\"p\">)</span>\n<span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">qemu</span><span class=\"o\">-</span><span class=\"n\">riscv64</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">version</span>\n<span class=\"n\">qemu</span><span class=\"o\">-</span><span class=\"n\">riscv64</span><span class=\"w\"> </span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"mf\">7.1.0</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">v7</span><span class=\"p\">.</span><span class=\"mf\">1.0</span><span class=\"p\">)</span>\n<span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">riscv64</span><span class=\"o\">-</span><span class=\"n\">linux</span><span class=\"o\">-</span><span class=\"n\">gnu</span><span class=\"o\">-</span><span class=\"n\">gcc</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">version</span>\n<span class=\"n\">riscv64</span><span class=\"o\">-</span><span class=\"n\">linux</span><span class=\"o\">-</span><span class=\"n\">gnu</span><span class=\"o\">-</span><span class=\"n\">gcc</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">Ubuntu</span><span class=\"w\"> </span><span class=\"mf\">11.4.0</span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"n\">ubuntu1</span><span class=\"o\">~</span><span class=\"mf\">22.04</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"mf\">11.4.0</span>\n</code></pre></div>\n<p>Still leads to the following error message. (Ran with a simple wrapper to provide Wasm memory)</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"w\">     </span><span class=\"n\">Running</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">qemu</span><span class=\"o\">-</span><span class=\"n\">riscv64</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">cpu</span><span class=\"w\"> </span><span class=\"n\">rv64</span><span class=\"p\">,</span><span class=\"n\">v</span><span class=\"o\">=</span><span class=\"kc\">true</span><span class=\"p\">,</span><span class=\"n\">vlen</span><span class=\"o\">=</span><span class=\"mi\">128</span><span class=\"p\">,</span><span class=\"n\">vext_spec</span><span class=\"o\">=</span><span class=\"n\">v1</span><span class=\"p\">.</span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">L</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">usr</span><span class=\"o\">/</span><span class=\"n\">riscv64</span><span class=\"o\">-</span><span class=\"n\">linux</span><span class=\"o\">-</span><span class=\"n\">gnu</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"n\">LD_LIBRARY_PATH</span><span class=\"o\">=/</span><span class=\"n\">usr</span><span class=\"o\">/</span><span class=\"n\">riscv64</span><span class=\"o\">-</span><span class=\"n\">linux</span><span class=\"o\">-</span><span class=\"n\">gnu</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"n\">WASMTIME_TEST_NO_HOG_MEMORY</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">target</span><span class=\"o\">/</span><span class=\"n\">riscv64gc</span><span class=\"o\">-</span><span class=\"n\">unknown</span><span class=\"o\">-</span><span class=\"n\">linux</span><span class=\"o\">-</span><span class=\"n\">gnu</span><span class=\"o\">/</span><span class=\"n\">debug</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">wrapper</span><span class=\"w\"> </span><span class=\"n\">input</span><span class=\"err\">`</span>\n<span class=\"n\">thread</span><span class=\"w\"> </span><span class=\"o\">'&lt;</span><span class=\"n\">unnamed</span><span class=\"o\">&gt;'</span><span class=\"w\"> </span><span class=\"n\">panicked</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"na\">internal</span><span class=\"w\"> </span><span class=\"n\">error</span>: <span class=\"nc\">entered</span><span class=\"w\"> </span><span class=\"n\">unreachable</span><span class=\"w\"> </span><span class=\"n\">code</span><span class=\"o\">'</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">candymate</span><span class=\"o\">/</span><span class=\"p\">.</span><span class=\"n\">cargo</span><span class=\"o\">/</span><span class=\"n\">registry</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">index</span><span class=\"p\">.</span><span class=\"n\">crates</span><span class=\"p\">.</span><span class=\"n\">io</span><span class=\"o\">-</span><span class=\"mi\">6</span><span class=\"n\">f17d22bba15001f</span><span class=\"o\">/</span><span class=\"n\">cranelift</span><span class=\"o\">-</span><span class=\"n\">codegen</span><span class=\"o\">-</span><span class=\"mf\">0.98.1</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">isa</span><span class=\"o\">/</span><span class=\"n\">riscv64</span><span class=\"o\">/</span><span class=\"n\">inst</span><span class=\"o\">/</span><span class=\"n\">args</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">1347</span>:<span class=\"mi\">18</span>\n<span class=\"n\">note</span>: <span class=\"nc\">run</span><span class=\"w\"> </span><span class=\"n\">with</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">RUST_BACKTRACE</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">environment</span><span class=\"w\"> </span><span class=\"n\">variable</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">display</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">backtrace</span>\n</code></pre></div>\n<p>It would be helpful if you tell me what I'm missing.</p>\n</blockquote>",
        "id": 380543479,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1690857436
    },
    {
        "content": "<p>candymate edited a <a href=\"https://github.com/bytecodealliance/wasmtime/issues/6786#issuecomment-1659474296\">comment</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/6786\">issue #6786</a>:</p>\n<blockquote>\n<p>Hi,</p>\n<p>I'm currently running QEMU, so I added the parameter you gave me. But, it doesn't change anything.</p>\n<p>In ~/.cargo/config.toml, I have the following:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"p\">[</span><span class=\"n\">target</span><span class=\"p\">.</span><span class=\"n\">riscv64gc</span><span class=\"o\">-</span><span class=\"n\">unknown</span><span class=\"o\">-</span><span class=\"n\">linux</span><span class=\"o\">-</span><span class=\"n\">gnu</span><span class=\"p\">]</span>\n<span class=\"n\">linker</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">\"riscv64-linux-gnu-gcc\"</span>\n<span class=\"n\">runner</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">\"qemu-riscv64 -cpu rv64,v=true,vlen=128,vext_spec=v1.0 -L /usr/riscv64-linux-gnu -E LD_LIBRARY_PATH=/usr/riscv64-linux-gnu/lib -E WASMTIME_TEST_NO_HOG_MEMORY=1\"</span>\n</code></pre></div>\n<p>Just in case, I upgraded Ubuntu to 22.04, and built <code>qemu-riscv64</code> from the latest version of riscv-gnu-toolchain. (<a href=\"https://github.com/riscv-collab/riscv-gnu-toolchain\">https://github.com/riscv-collab/riscv-gnu-toolchain</a>)</p>\n<p>Versions I'm using are the following:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">cargo</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">version</span>\n<span class=\"n\">cargo</span><span class=\"w\"> </span><span class=\"mf\">1.71.0</span><span class=\"o\">-</span><span class=\"n\">nightly</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"mi\">13413</span><span class=\"n\">c64f</span><span class=\"w\"> </span><span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">05</span><span class=\"o\">-</span><span class=\"mi\">10</span><span class=\"p\">)</span>\n<span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">rustc</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">version</span>\n<span class=\"n\">rustc</span><span class=\"w\"> </span><span class=\"mf\">1.71.0</span><span class=\"o\">-</span><span class=\"n\">nightly</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">ce5919fce</span><span class=\"w\"> </span><span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">05</span><span class=\"o\">-</span><span class=\"mi\">15</span><span class=\"p\">)</span>\n<span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">qemu</span><span class=\"o\">-</span><span class=\"n\">riscv64</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">version</span>\n<span class=\"n\">qemu</span><span class=\"o\">-</span><span class=\"n\">riscv64</span><span class=\"w\"> </span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"mf\">7.1.0</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">v7</span><span class=\"p\">.</span><span class=\"mf\">1.0</span><span class=\"p\">)</span>\n<span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">riscv64</span><span class=\"o\">-</span><span class=\"n\">linux</span><span class=\"o\">-</span><span class=\"n\">gnu</span><span class=\"o\">-</span><span class=\"n\">gcc</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">version</span>\n<span class=\"n\">riscv64</span><span class=\"o\">-</span><span class=\"n\">linux</span><span class=\"o\">-</span><span class=\"n\">gnu</span><span class=\"o\">-</span><span class=\"n\">gcc</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">Ubuntu</span><span class=\"w\"> </span><span class=\"mf\">11.4.0</span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"n\">ubuntu1</span><span class=\"o\">~</span><span class=\"mf\">22.04</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"mf\">11.4.0</span>\n</code></pre></div>\n<p>Still leads to the following error message. (Ran with a simple wrapper to provide Wasm memory)</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"w\">     </span><span class=\"n\">Running</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">qemu</span><span class=\"o\">-</span><span class=\"n\">riscv64</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">cpu</span><span class=\"w\"> </span><span class=\"n\">rv64</span><span class=\"p\">,</span><span class=\"n\">v</span><span class=\"o\">=</span><span class=\"kc\">true</span><span class=\"p\">,</span><span class=\"n\">vlen</span><span class=\"o\">=</span><span class=\"mi\">128</span><span class=\"p\">,</span><span class=\"n\">vext_spec</span><span class=\"o\">=</span><span class=\"n\">v1</span><span class=\"p\">.</span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">L</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">usr</span><span class=\"o\">/</span><span class=\"n\">riscv64</span><span class=\"o\">-</span><span class=\"n\">linux</span><span class=\"o\">-</span><span class=\"n\">gnu</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"n\">LD_LIBRARY_PATH</span><span class=\"o\">=/</span><span class=\"n\">usr</span><span class=\"o\">/</span><span class=\"n\">riscv64</span><span class=\"o\">-</span><span class=\"n\">linux</span><span class=\"o\">-</span><span class=\"n\">gnu</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">E</span><span class=\"w\"> </span><span class=\"n\">WASMTIME_TEST_NO_HOG_MEMORY</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">target</span><span class=\"o\">/</span><span class=\"n\">riscv64gc</span><span class=\"o\">-</span><span class=\"n\">unknown</span><span class=\"o\">-</span><span class=\"n\">linux</span><span class=\"o\">-</span><span class=\"n\">gnu</span><span class=\"o\">/</span><span class=\"n\">debug</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">wrapper</span><span class=\"w\"> </span><span class=\"n\">input</span><span class=\"err\">`</span>\n<span class=\"n\">thread</span><span class=\"w\"> </span><span class=\"o\">'&lt;</span><span class=\"n\">unnamed</span><span class=\"o\">&gt;'</span><span class=\"w\"> </span><span class=\"n\">panicked</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"na\">internal</span><span class=\"w\"> </span><span class=\"n\">error</span>: <span class=\"nc\">entered</span><span class=\"w\"> </span><span class=\"n\">unreachable</span><span class=\"w\"> </span><span class=\"n\">code</span><span class=\"o\">'</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">candymate</span><span class=\"o\">/</span><span class=\"p\">.</span><span class=\"n\">cargo</span><span class=\"o\">/</span><span class=\"n\">registry</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">index</span><span class=\"p\">.</span><span class=\"n\">crates</span><span class=\"p\">.</span><span class=\"n\">io</span><span class=\"o\">-</span><span class=\"mi\">6</span><span class=\"n\">f17d22bba15001f</span><span class=\"o\">/</span><span class=\"n\">cranelift</span><span class=\"o\">-</span><span class=\"n\">codegen</span><span class=\"o\">-</span><span class=\"mf\">0.98.1</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">isa</span><span class=\"o\">/</span><span class=\"n\">riscv64</span><span class=\"o\">/</span><span class=\"n\">inst</span><span class=\"o\">/</span><span class=\"n\">args</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">1347</span>:<span class=\"mi\">18</span>\n<span class=\"n\">note</span>: <span class=\"nc\">run</span><span class=\"w\"> </span><span class=\"n\">with</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">RUST_BACKTRACE</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">environment</span><span class=\"w\"> </span><span class=\"n\">variable</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">display</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">backtrace</span>\n</code></pre></div>\n<p>It would be helpful if you tell me what I'm missing.</p>\n</blockquote>",
        "id": 380543508,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1690857471
    },
    {
        "content": "<p>afonso360 <a href=\"https://github.com/bytecodealliance/wasmtime/issues/6786#issuecomment-1660098265\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/6786\">issue #6786</a>:</p>\n<blockquote>\n<p>Oh! Right, QEMU only gained the ability to emulate <code>/proc/cpuinfo</code> in version 8.1, we use that to detect the features of the processor and automatically enable them.</p>\n<p>To manually force it on, you can use the wasmtime flag <code>--cranelift-enable has_v</code>, which should forcefully enable them on our side. </p>\n</blockquote>",
        "id": 380654197,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1690888168
    },
    {
        "content": "<p>candymate <a href=\"https://github.com/bytecodealliance/wasmtime/issues/6786#issuecomment-1661393893\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/6786\">issue #6786</a>:</p>\n<blockquote>\n<p>Adding the <code>has_v</code> flag solved the problem. Thanks!</p>\n</blockquote>",
        "id": 380885675,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1690943275
    },
    {
        "content": "<p>candymate closed <a href=\"https://github.com/bytecodealliance/wasmtime/issues/6786\">issue #6786</a>:</p>\n<blockquote>\n<h3>Test Case</h3>\n<p>Any cases with v128.loadXXX or v128.storeXXX would work</p>\n<p>One example</p>\n<div class=\"codehilite\" data-code-language=\"WebAssembly\"><pre><span></span><code><span class=\"p\">(</span><span class=\"k\">module</span>\n  <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"cm\">(;0;)</span> <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"p\">(</span><span class=\"k\">param</span> <span class=\"kt\">i32</span> <span class=\"err\">v</span><span class=\"mf\">128</span><span class=\"p\">)))</span>\n  <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"cm\">(;0;)</span> <span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"mi\">0</span><span class=\"p\">)</span> <span class=\"p\">(</span><span class=\"k\">param</span> <span class=\"kt\">i32</span> <span class=\"err\">v</span><span class=\"mf\">128</span><span class=\"p\">)</span>\n    <span class=\"nb\">local.get</span> <span class=\"mi\">0</span>\n    <span class=\"nb\">local.get</span> <span class=\"mi\">1</span>\n    <span class=\"err\">v</span><span class=\"mf\">128</span><span class=\"err\">.store</span><span class=\"mi\">16</span><span class=\"err\">_lane</span> <span class=\"err\">align=</span><span class=\"mf\">1 0</span>\n  <span class=\"p\">)</span>\n  <span class=\"p\">(</span><span class=\"k\">export</span> <span class=\"s2\">\"main\"</span> <span class=\"p\">(</span><span class=\"k\">func</span> <span class=\"mi\">0</span><span class=\"p\">))</span>\n<span class=\"p\">)</span>\n</code></pre></div>\n<h3>Steps to Reproduce</h3>\n<p>Compiling any cases containing v128.loadXXX or v128.storeXXX leads to reaching unreachable code.<br>\nSuch compilations lead to reaching the following codes</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"c1\">// cranelift/codegen/src/isa/riscv64/inst/args.rs:1289</span>\n<span class=\"k\">pub</span><span class=\"p\">(</span><span class=\"k\">crate</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"k\">fn</span> <span class=\"nf\">from_type</span><span class=\"p\">(</span><span class=\"n\">t</span>: <span class=\"nc\">Type</span><span class=\"p\">)</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">Self</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"p\">.</span><span class=\"n\">is_float</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"n\">F32</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"bp\">Self</span>::<span class=\"n\">Flw</span><span class=\"w\"> </span><span class=\"p\">}</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"bp\">Self</span>::<span class=\"n\">Fld</span><span class=\"w\"> </span><span class=\"p\">};</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n<span class=\"w\">    </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"n\">R32</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">Self</span>::<span class=\"n\">Lwu</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"n\">R64</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">I64</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">Self</span>::<span class=\"n\">Ld</span><span class=\"p\">,</span>\n\n<span class=\"w\">        </span><span class=\"n\">I8</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">Self</span>::<span class=\"n\">Lb</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"n\">I16</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">Self</span>::<span class=\"n\">Lh</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"n\">I32</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">Self</span>::<span class=\"n\">Lw</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"n\">_</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"fm\">unreachable!</span><span class=\"p\">(),</span><span class=\"w\"> </span><span class=\"c1\">// reaches here</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"c1\">// cranelift/codegen/src/isa/riscv64/inst/args.rs:1338</span>\n<span class=\"k\">pub</span><span class=\"p\">(</span><span class=\"k\">crate</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"k\">fn</span> <span class=\"nf\">from_type</span><span class=\"p\">(</span><span class=\"n\">t</span>: <span class=\"nc\">Type</span><span class=\"p\">)</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">Self</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"p\">.</span><span class=\"n\">is_float</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"n\">F32</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"bp\">Self</span>::<span class=\"n\">Fsw</span><span class=\"w\"> </span><span class=\"p\">}</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"bp\">Self</span>::<span class=\"n\">Fsd</span><span class=\"w\"> </span><span class=\"p\">};</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n<span class=\"w\">    </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">t</span><span class=\"p\">.</span><span class=\"n\">bits</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"mi\">8</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">Self</span>::<span class=\"n\">Sb</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"mi\">16</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">Self</span>::<span class=\"n\">Sh</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"mi\">32</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">Self</span>::<span class=\"n\">Sw</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"mi\">64</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"bp\">Self</span>::<span class=\"n\">Sd</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"n\">_</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"fm\">unreachable!</span><span class=\"p\">(),</span><span class=\"w\"> </span><span class=\"c1\">// reaches here</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p>Steps are the following:</p>\n<ol>\n<li><code>git submodule update --init</code></li>\n<li><code>cargo run --release --target=riscv64gc-unknown-linux-gnu test.wasm</code></li>\n</ol>\n<h3>Expected Results</h3>\n<p>Successful compilation</p>\n<h3>Actual Results</h3>\n<p>Panics with 'internal error: entered unreachable code'</p>\n<h3>Versions and Environment</h3>\n<p>Wasmtime version or commit: v11.0.1 Release</p>\n<p>Operating system: Ubuntu 20.04.6</p>\n<p>Architecture: RISC-V64</p>\n</blockquote>",
        "id": 380885677,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1690943275
    }
]