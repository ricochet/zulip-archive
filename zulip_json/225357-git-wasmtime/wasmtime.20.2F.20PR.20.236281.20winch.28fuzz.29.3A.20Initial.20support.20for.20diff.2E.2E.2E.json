[
    {
        "content": "<p>saulecabrera opened <a href=\"https://github.com/bytecodealliance/wasmtime/pull/6281\">PR #6281</a> from <code>saulecabrera:winch-fuzzing-init</code> to <code>bytecodealliance:main</code>:</p>\n<blockquote>\n<p>This commit introduces initial support for differential fuzzing for Winch. In order to fuzz winch, this change introduces the <code>winch</code> cargo feature. When the <code>winch</code> cargo feature is enabled the differential fuzz target uses <code>wasmi</code> as the differential engine and <code>wasm-smith</code> and <code>single-inst</code> as the module sources.</p>\n<p>The intention behind this change is to have a <em>local</em> approach for fuzzing and verifying programs generated by Winch and to have an initial implementation that will allow us to eventually enable this change by default. Currently it's not worth it to enable this change by default given all the filtering that needs to happen to ensure that the generated modules are supported by Winch.</p>\n<p>&lt;!--<br>\nPlease make sure you include the following information:</p>\n<ul>\n<li>\n<p>If this work has been discussed elsewhere, please include a link to that<br>\n  conversation. If it was discussed in an issue, just mention \"issue #...\".</p>\n</li>\n<li>\n<p>Explain why this change is needed. If the details are in an issue already,<br>\n  this can be brief.</p>\n</li>\n</ul>\n<p>Our development process is documented in the Wasmtime book:<br>\n<a href=\"https://docs.wasmtime.dev/contributing-development-process.html\">https://docs.wasmtime.dev/contributing-development-process.html</a></p>\n<p>Please ensure all communication follows the code of conduct:<br>\n<a href=\"https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md\">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>\n--&gt;</p>\n</blockquote>",
        "id": 352399875,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1682380596
    },
    {
        "content": "<p><strong>saulecabrera</strong> requested <a href=\"https://github.com/orgs/bytecodealliance/teams/wasmtime-fuzz-reviewers\">wasmtime-fuzz-reviewers</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/6281\">PR #6281</a>.</p>",
        "id": 352399877,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1682380597
    },
    {
        "content": "<p><strong>saulecabrera</strong> requested <a href=\"https://github.com/fitzgen\">fitzgen</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/6281\">PR #6281</a>.</p>",
        "id": 352399878,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1682380597
    },
    {
        "content": "<p><strong>saulecabrera</strong> requested <a href=\"https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers\">wasmtime-core-reviewers</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/6281\">PR #6281</a>.</p>",
        "id": 352399879,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1682380597
    },
    {
        "content": "<p><strong>saulecabrera</strong> requested <a href=\"https://github.com/orgs/bytecodealliance/teams/wasmtime-default-reviewers\">wasmtime-default-reviewers</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/6281\">PR #6281</a>.</p>",
        "id": 352399880,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1682380597
    },
    {
        "content": "<p>saulecabrera updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/6281\">PR #6281</a>.</p>",
        "id": 352400220,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1682380826
    },
    {
        "content": "<p>saulecabrera edited <a href=\"https://github.com/bytecodealliance/wasmtime/pull/6281\">PR #6281</a>:</p>\n<blockquote>\n<p>This commit introduces initial support for differential fuzzing for Winch. In order to fuzz winch, this change introduces the <code>winch</code> cargo feature. When the <code>winch</code> cargo feature is enabled the differential fuzz target uses <code>wasmi</code> as the differential engine and <code>wasm-smith</code> and <code>single-inst</code> as the module sources.</p>\n<p>The intention behind this change is to have a <em>local</em> approach for fuzzing and verifying programs generated by Winch and to have an initial implementation that will allow us to eventually enable this change by default. Currently it's not worth it to enable this change by default given all the filtering that needs to happen to ensure that the generated modules are supported by Winch.</p>\n<p>It's worth noting that the Wasm filtering code will be temporary, until Winch<br>\nreaches feature parity in terms of Wasm operators.</p>\n<p>&lt;!--<br>\nPlease make sure you include the following information:</p>\n<ul>\n<li>\n<p>If this work has been discussed elsewhere, please include a link to that<br>\n  conversation. If it was discussed in an issue, just mention \"issue #...\".</p>\n</li>\n<li>\n<p>Explain why this change is needed. If the details are in an issue already,<br>\n  this can be brief.</p>\n</li>\n</ul>\n<p>Our development process is documented in the Wasmtime book:<br>\n<a href=\"https://docs.wasmtime.dev/contributing-development-process.html\">https://docs.wasmtime.dev/contributing-development-process.html</a></p>\n<p>Please ensure all communication follows the code of conduct:<br>\n<a href=\"https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md\">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>\n--&gt;</p>\n</blockquote>",
        "id": 352400261,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1682380858
    },
    {
        "content": "<p><strong>saulecabrera</strong> requested <a href=\"https://github.com/cfallin\">cfallin</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/6281\">PR #6281</a>.</p>",
        "id": 352400880,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1682381256
    },
    {
        "content": "<p>saulecabrera updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/6281\">PR #6281</a>.</p>",
        "id": 352401077,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1682381369
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/6281#pullrequestreview-1398967703\">PR review</a>:</p>\n<blockquote>\n<p>This looks generally good-- I'm reviewing it with the understanding that the WInch-specific config details are temporary (in the long run) so I won't fuss too much about configuration details :-)</p>\n<p>One thing I might suggest: the <code>winch</code> feature in a fuzz-build does something subtly different than the <code>winch</code> feature in the rest of Wasmtime, namely it <em>restricts</em> options rather than <em>adds</em> support. It turns the general fuzz target into a Winch-specific thing. So perhaps we could name the feature in the fuzz crate something more specific, like <code>fuzz-winch-only</code> or <code>winch-fuzz</code> or somesuch? (Then the feature can require the <code>winch</code> feature in the rest of the engine.)</p>\n<p>LGTM with or without that -- I'll leave it up to you -- but thought it might be clearer. Thanks!</p>\n</blockquote>",
        "id": 352403482,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1682382826
    },
    {
        "content": "<p>saulecabrera updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/6281\">PR #6281</a>.</p>",
        "id": 352407473,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1682385155
    },
    {
        "content": "<p>cfallin merged <a href=\"https://github.com/bytecodealliance/wasmtime/pull/6281\">PR #6281</a>.</p>",
        "id": 352424687,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1682397160
    },
    {
        "content": "<p>alexcrichton submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/6281#pullrequestreview-1400139225\">PR review</a>.</p>",
        "id": 352565677,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1682435366
    },
    {
        "content": "<p>alexcrichton submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/6281#pullrequestreview-1400139225\">PR review</a>.</p>",
        "id": 352565678,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1682435366
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/6281#discussion_r1176665533\">PR review comment</a>:</p>\n<blockquote>\n<p>One thought I had reading over this is that the winch support here seems pretty specific and targeted, which while ok for now may not translate to easier integration in the future. For example having specific paths for winch such as this may not age well as more support is added.</p>\n<p>An alternative, though, would be something like:</p>\n<ul>\n<li>Always have <code>CompilerStrategy</code></li>\n<li>Only generate <code>CompilerStrategy::Winch</code> when <code>fuzz-winch</code> is enabled</li>\n<li>Don't configure <code>allowed_instructions</code>, but allow modules fall through to <code>winch_supports_module</code> below</li>\n</ul>\n<p>This would result in a higher \"rejection rate\" or a smaller rate of coverage for winch since modules won't be tailor-made to run in winch, but I think that could be possibly smoothed over with environment variable based configuration like <code>ALLOWED_ENGINES</code>?</p>\n<p>Overall I think it'd be best to integrate without <code>#[cfg]</code> where possible since having special one-off instructions like that tend to accumulate more-complicated logic over time.</p>\n<p>To be clear though this is more of a stylistic concern than anything else. I think it's fine to leave this all as-is and it can be revisited when the fuzzing support is updated in the future.</p>\n</blockquote>",
        "id": 352565680,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1682435366
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/6281#discussion_r1176659639\">PR review comment</a>:</p>\n<blockquote>\n<p>How come winch changes the selection of default engines? </p>\n</blockquote>",
        "id": 352565682,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1682435366
    },
    {
        "content": "<p>saulecabrera created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/6281#discussion_r1176731310\">PR review comment</a>:</p>\n<blockquote>\n<p>Since the objective of this change is mostly to have a way to fuzz locally, my line of thought here was to choose the most lightweight option for differential fuzzing, in that sense, this decision is very specific to Winch and to how I intend to use this fuzz target today. Once Winch is robust enough, such that we are able to enable fuzzing in cluster-fuzz, I think we can revert this change. The other thing that I've discussed briefly with @cfallin is that maybe for Winch, even in cluster-fuzz we could consider only fuzzing Winch against an interpreter like <code>wasmi</code> in order to save some fuzz time in cluster-fuzz, and also because Winch is already partly covered by Cranelift's fuzzing given its dependency on its backends. </p>\n</blockquote>",
        "id": 352580056,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1682438461
    },
    {
        "content": "<p>saulecabrera created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/6281#discussion_r1176756954\">PR review comment</a>:</p>\n<blockquote>\n<p>Agreed with all your points @alexcrichton, thanks for bringing this up; the only thing that I'll note is that the main reason for configuring <code>allowed_instructions</code> as part of this change is to have a higher change of getting a module supported by Winch, which is important for me at the moment, given that I'm only intending to use this locally, I found that configuring <code>wasm-smith</code> to do this would be the easiest for now.  </p>\n<p>In terms of the <code>cfg</code> complexity, my expectation is that as more features are added to Winch the complexity here shouldn't increase, aside from having to add the supported instructions to <code>winch_supports_module</code>. But in general, my expectation is that once decide to enable fuzzing for Winch by default, the <code>cfg</code> complexity should be minimal or non-existent and my hope if that we can control any Winch specific behaviour through environment variables as you suggested.  </p>\n</blockquote>",
        "id": 352584746,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1682439615
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/6281#discussion_r1176855339\">PR review comment</a>:</p>\n<blockquote>\n<p>To add a bit, @alexcrichton the intent of the design here is to give temporary support for Winch bringup; as @saulecabrera noted we hope that eventually it's \"just another engine in the list\". The alternative to this would be to develop a completely separate \"bringup fuzz target\" doing the targeted comparison that we want, which we decided would be less ideal (code duplication etc).</p>\n</blockquote>",
        "id": 352606755,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1682445550
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/6281#discussion_r1176977575\">PR review comment</a>:</p>\n<blockquote>\n<p>That all makes sense to me, but for fuzzing locally the env vars can be set, so I'm not sure why this change was needed? It's not wrong of course, and I agree that there's no need for a whole separate fuzz target for winch. I was expecting, though, that how to fuzz winch would be \"probably set some env vars to specific values to avoid known crashes and get quicker test coverage\", so that way fuzzing winch in full is \"remove the env vars\" or similar.</p>\n</blockquote>",
        "id": 352629499,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1682452795
    }
]