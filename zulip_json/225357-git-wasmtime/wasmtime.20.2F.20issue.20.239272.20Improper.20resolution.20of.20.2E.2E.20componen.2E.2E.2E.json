[
    {
        "content": "<p><a href=\"https://github.com/neild\">neild</a> added the bug label to <a href=\"https://github.com/bytecodealliance/wasmtime/issues/9272\">Issue #9272</a>.</p>",
        "id": 471108732,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1726611445
    },
    {
        "content": "<p>neild opened <a href=\"https://github.com/bytecodealliance/wasmtime/issues/9272\">issue #9272</a>:</p>\n<blockquote>\n<p>I believe I've run across a bug in wasmtime's handling of symlink targets which include <code>\"..\"</code>. I've reproduced this using the Go program below which calls <code>path_open</code> on a path and reports the result. It's not the simplest test program, but it avoids dependencies and I have a Go compiler handy.</p>\n<p>Simple case, no bug:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">echo</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"n\">file</span>\n<span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">ln</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"w\"> </span><span class=\"n\">link</span>\n<span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">GOOS</span><span class=\"o\">=</span><span class=\"n\">wasip1</span><span class=\"w\"> </span><span class=\"n\">GOARCH</span><span class=\"o\">=</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"n\">go</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"p\">.</span><span class=\"n\">go</span><span class=\"w\"> </span><span class=\"n\">link</span>\n<span class=\"n\">errno</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n</code></pre></div>\n<p>The bug shows up when resolving a link with a target of <code>\"..\"</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">echo</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"n\">target</span>\n<span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">mkdir</span><span class=\"w\"> </span><span class=\"n\">b</span>\n<span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">cd</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"n\">ln</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">..</span><span class=\"w\"> </span><span class=\"n\">up</span><span class=\"p\">)</span>\n<span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">cat</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">/</span><span class=\"n\">up</span><span class=\"o\">/</span><span class=\"n\">target</span>\n<span class=\"n\">foo</span>\n<span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">GOOS</span><span class=\"o\">=</span><span class=\"n\">wasip1</span><span class=\"w\"> </span><span class=\"n\">GOARCH</span><span class=\"o\">=</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"n\">go</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"p\">.</span><span class=\"n\">go</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">/</span><span class=\"n\">up</span>\n<span class=\"n\">errno</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">GOOS</span><span class=\"o\">=</span><span class=\"n\">wasip1</span><span class=\"w\"> </span><span class=\"n\">GOARCH</span><span class=\"o\">=</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"n\">go</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"p\">.</span><span class=\"n\">go</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">/</span><span class=\"n\">up</span><span class=\"o\">/</span><span class=\"n\">target</span>\n<span class=\"n\">Not</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">directory</span>\n</code></pre></div>\n<p>I'm not sure exactly what is going awry, but the \"not a directory\" error is clearly wrong. Note that we can open <code>b/up</code> (resolves to <code>.</code> as expected). The problem seems to be specific to links that end in <code>..</code>: if we change the link target to <code>../a</code>, everything works as expected:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">mkdir</span><span class=\"w\"> </span><span class=\"n\">a</span>\n<span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">echo</span><span class=\"w\"> </span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">/</span><span class=\"n\">target</span>\n<span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">mkdir</span><span class=\"w\"> </span><span class=\"n\">b</span>\n<span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">cd</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"n\">ln</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">../</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">upa</span><span class=\"p\">)</span>\n<span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">cat</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">/</span><span class=\"n\">upa</span><span class=\"o\">/</span><span class=\"n\">target</span>\n<span class=\"n\">bar</span>\n<span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">GOOS</span><span class=\"o\">=</span><span class=\"n\">wasip1</span><span class=\"w\"> </span><span class=\"n\">GOARCH</span><span class=\"o\">=</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"n\">go</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"p\">.</span><span class=\"n\">go</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">/</span><span class=\"n\">upa</span><span class=\"o\">/</span><span class=\"n\">target</span>\n<span class=\"n\">errno</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n</code></pre></div>\n<p>Test program:</p>\n<p><div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">main</span>\n\n<span class=\"n\">import</span><span class=\"w\"> </span><span class=\"p\">(</span>\n<span class=\"w\">        </span><span class=\"s\">\"fmt\"</span>\n<span class=\"w\">        </span><span class=\"s\">\"os\"</span>\n<span class=\"w\">        </span><span class=\"s\">\"syscall\"</span>\n<span class=\"w\">        </span><span class=\"s\">\"unsafe\"</span>\n<span class=\"p\">)</span>\n\n<span class=\"c1\">//go:wasmimport wasi_snapshot_preview1 path_open</span>\n<span class=\"c1\">//go:noescape</span>\n<span class=\"n\">func</span><span class=\"w\"> </span><span class=\"n\">path_open</span><span class=\"p\">(</span><span class=\"n\">rootFD</span><span class=\"w\"> </span><span class=\"n\">int32</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">dirflags</span><span class=\"w\"> </span><span class=\"n\">uint32</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">path</span><span class=\"w\"> </span><span class=\"k\">unsafe</span><span class=\"p\">.</span><span class=\"n\">Pointer</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">pathLen</span><span class=\"w\"> </span><span class=\"n\">uint32</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">oflags</span><span class=\"w\"> </span><span class=\"n\">uint32</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">fsRightsBase</span><span class=\"w\"> </span><span class=\"n\">uint64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">fsRightsInheriting</span><span class=\"w\"> </span><span class=\"n\">uint64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">fsFlags</span><span class=\"w\"> </span><span class=\"n\">uint32</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">fd</span><span class=\"w\"> </span><span class=\"k\">unsafe</span><span class=\"p\">.</span><span class=\"n\">Pointer</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">uint32</span>\n\n<span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">LOOKUP_SYMLINK_FOLLOW</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n\n<span class=\"n\">func</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"n\">f</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">err</span><span class=\"w\"> </span><span class=\"p\">:</span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">os</span><span class=\"p\">.</span><span class=\"n\">Open</span><span class=\"p\">(</span><span class=\"s\">\".\"</span><span class=\"p\">)</span>\n<span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">err</span><span class=\"w\"> </span><span class=\"o\">!=</span><span class=\"w\"> </span><span class=\"n\">nil</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">                </span><span class=\"n\">panic</span><span class=\"p\">(</span><span class=\"n\">err</span><span class=\"p\">)</span>\n<span class=\"w\">        </span><span class=\"p\">}</span>\n\n<span class=\"w\">        </span><span class=\"n\">filename</span><span class=\"w\"> </span><span class=\"p\">:</span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">os</span><span class=\"p\">.</span><span class=\"n\">Args</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">]</span>\n<span class=\"w\">        </span><span class=\"n\">var</span><span class=\"w\"> </span><span class=\"n\">fd</span><span class=\"w\"> </span><span class=\"n\">int32</span>\n<span class=\"w\">        </span><span class=\"n\">errno</span><span class=\"w\"> </span><span class=\"p\">:</span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">path_open</span><span class=\"p\">(</span>\n<span class=\"w\">                </span><span class=\"n\">int32</span><span class=\"p\">(</span><span class=\"n\">f</span><span class=\"p\">.</span><span class=\"n\">Fd</span><span class=\"p\">()),</span>\n<span class=\"w\">                </span><span class=\"n\">syscall</span><span class=\"p\">.</span><span class=\"n\">LOOKUP_SYMLINK_FOLLOW</span><span class=\"p\">,</span>\n<span class=\"w\">                </span><span class=\"k\">unsafe</span><span class=\"p\">.</span><span class=\"n\">Pointer</span><span class=\"p\">(</span><span class=\"k\">unsafe</span><span class=\"p\">.</span><span class=\"n\">StringData</span><span class=\"p\">(</span><span class=\"n\">filename</span><span class=\"p\">)),</span>\n<span class=\"w\">                </span><span class=\"n\">uint32</span><span class=\"p\">(</span><span class=\"n\">len</span><span class=\"p\">(</span><span class=\"n\">filename</span><span class=\"p\">)),</span>\n<span class=\"w\">                </span><span class=\"mi\">0</span><span class=\"p\">,</span>\n<span class=\"w\">                </span><span class=\"n\">syscall</span><span class=\"p\">.</span><span class=\"n\">RIGHT_FD_READ</span><span class=\"p\">,</span>\n<span class=\"w\">                </span><span class=\"n\">syscall</span><span class=\"p\">.</span><span class=\"n\">RIGHT_FD_READ</span><span class=\"p\">,</span>\n<span class=\"w\">                </span><span class=\"mi\">0</span><span class=\"p\">,</span>\n<span class=\"w\">                </span><span class=\"k\">unsafe</span><span class=\"p\">.</span><span class=\"n\">Pointer</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"n\">fd</span><span class=\"p\">),</span>\n<span class=\"w\">        </span><span class=\"p\">)</span>\n<span class=\"w\">        </span><span class=\"n\">fmt</span><span class=\"p\">.</span><span class=\"n\">Println</span><span class=\"p\">(</span><span class=\"n\">syscall</span><span class=\"p\">.</span><span class=\"n\">Errno</span><span class=\"p\">(</span><span class=\"n\">errno</span><span class=\"p\">))</span>\n<span class=\"p\">}</span>\n</code></pre></div><br>\n</p>\n</blockquote>",
        "id": 471108734,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1726611446
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/9272#issuecomment-2364291267\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/9272\">issue #9272</a>:</p>\n<blockquote>\n<p>Thanks for the report! Would you be able to gist exactly what <code>wasmtime</code> command is being used? You're using <code>go run</code> but it's not clear to me what exactly <code>wasmtime</code> is doing. Locally I can't seem to reproduce this with what I believe is an equivalent Rust program:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">cat</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">rs</span>\n<span class=\"k\">fn</span><span class=\"w\"> </span><span class=\"nf\">main</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"fm\">println!</span><span class=\"p\">(</span>\n<span class=\"w\">        </span><span class=\"s\">\"{:?}\"</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"n\">std</span><span class=\"p\">::</span><span class=\"n\">fs</span><span class=\"p\">::</span><span class=\"n\">File</span><span class=\"p\">::</span><span class=\"n\">open</span><span class=\"p\">(</span><span class=\"n\">std</span><span class=\"p\">::</span><span class=\"n\">env</span><span class=\"p\">::</span><span class=\"n\">args</span><span class=\"p\">().</span><span class=\"n\">nth</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">).</span><span class=\"n\">unwrap</span><span class=\"p\">())</span>\n<span class=\"w\">    </span><span class=\"p\">);</span>\n<span class=\"p\">}</span>\n<span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">rustc</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">target</span><span class=\"w\"> </span><span class=\"n\">wasm32</span><span class=\"o\">-</span><span class=\"n\">wasip1</span>\n<span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">mkdir</span><span class=\"w\"> </span><span class=\"n\">a</span>\n<span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">echo</span><span class=\"w\"> </span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">/</span><span class=\"n\">target</span>\n<span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">mkdir</span><span class=\"w\"> </span><span class=\"n\">b</span>\n<span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">cd</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"n\">ln</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">../</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">upa</span><span class=\"p\">)</span>\n<span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">cat</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">/</span><span class=\"n\">upa</span><span class=\"o\">/</span><span class=\"n\">target</span>\n<span class=\"n\">bar</span>\n<span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">dir</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">/</span><span class=\"n\">upa</span><span class=\"o\">/</span><span class=\"n\">target</span>\n<span class=\"nb\">Ok</span><span class=\"p\">(</span><span class=\"n\">File</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">fd</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"w\"> </span><span class=\"p\">})</span>\n<span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">ls</span>\n<span class=\"n\">a</span><span class=\"w\">  </span><span class=\"n\">b</span><span class=\"w\">  </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"w\">  </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span>\n<span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">rm</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">rf</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">b</span>\n<span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">echo</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"n\">target</span>\n<span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">mkdir</span><span class=\"w\"> </span><span class=\"n\">b</span>\n<span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">cd</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"n\">ln</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">..</span><span class=\"w\"> </span><span class=\"n\">up</span><span class=\"p\">)</span>\n<span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">cat</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">/</span><span class=\"n\">up</span><span class=\"o\">/</span><span class=\"n\">target</span>\n<span class=\"n\">foo</span>\n<span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">dir</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">/</span><span class=\"n\">up</span>\n<span class=\"nb\">Ok</span><span class=\"p\">(</span><span class=\"n\">File</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">fd</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"w\"> </span><span class=\"p\">})</span>\n<span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">dir</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">/</span><span class=\"n\">up</span><span class=\"o\">/</span><span class=\"n\">target</span>\n<span class=\"nb\">Ok</span><span class=\"p\">(</span><span class=\"n\">File</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">fd</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"w\"> </span><span class=\"p\">})</span>\n<span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">dir</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"n\">nonexistent</span>\n<span class=\"nb\">Err</span><span class=\"p\">(</span><span class=\"n\">Os</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">code</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">44</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">kind</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">NotFound</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">message</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"No such file or directory\"</span><span class=\"w\"> </span><span class=\"p\">})</span>\n</code></pre></div>\n<p>That may mean that the difference boils down to what Rust and Go are doing, and so the next step here would be to narrow in on that and see what's going on. If you're able to upload the Go-generated wasm binary here that would also help too</p>\n</blockquote>",
        "id": 471801400,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1726856716
    },
    {
        "content": "<p>neild <a href=\"https://github.com/bytecodealliance/wasmtime/issues/9272#issuecomment-2364342911\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/9272\">issue #9272</a>:</p>\n<blockquote>\n<p>The wasmtime command is from here: <a href=\"https://go.googlesource.com/go/+/refs/tags/go1.23.0/misc/wasm/go_wasip1_wasm_exec\">https://go.googlesource.com/go/+/refs/tags/go1.23.0/misc/wasm/go_wasip1_wasm_exec</a></p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">dir</span><span class=\"o\">=/</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">env</span><span class=\"w\"> </span><span class=\"n\">PWD</span><span class=\"o\">=</span><span class=\"s\">\"$PWD\"</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">env</span><span class=\"w\"> </span><span class=\"n\">PATH</span><span class=\"o\">=</span><span class=\"s\">\"$PATH\"</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">W</span><span class=\"w\"> </span><span class=\"n\">max</span><span class=\"o\">-</span><span class=\"n\">wasm</span><span class=\"o\">-</span><span class=\"n\">stack</span><span class=\"o\">=</span><span class=\"mi\">1048576</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">/</span><span class=\"n\">up</span><span class=\"o\">/</span><span class=\"n\">target</span>\n</code></pre></div>\n<p>Wasm binary I'm using:<br>\n<a href=\"https://github.com/user-attachments/files/17079815/main.wasm.gz\">main.wasm.gz</a></p>\n</blockquote>",
        "id": 471809001,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1726858578
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/9272#issuecomment-2364583630\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/9272\">issue #9272</a>:</p>\n<blockquote>\n<p>Hm I actually can't seem to reproduce with the binary that you provided. I get:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">dir</span><span class=\"o\">=/</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">env</span><span class=\"w\"> </span><span class=\"n\">PWD</span><span class=\"o\">=</span><span class=\"s\">\"$PWD\"</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">env</span><span class=\"w\"> </span><span class=\"n\">PATH</span><span class=\"o\">=</span><span class=\"s\">\"$PATH\"</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">W</span><span class=\"w\"> </span><span class=\"n\">max</span><span class=\"o\">-</span><span class=\"n\">wasm</span><span class=\"o\">-</span><span class=\"n\">stack</span><span class=\"o\">=</span><span class=\"mi\">1048576</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">/</span><span class=\"n\">up</span><span class=\"o\">/</span><span class=\"n\">target</span>\n<span class=\"n\">errno</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n</code></pre></div>\n<p>which I think means that it's working?</p>\n<p>I noticed above sometimes the symlink was called \"up\" and sometimes it was \"upa\". I mixed the two up and thought Rust was working and Go wasn't but then when I fixed the name they both worked. Mind double-checking on your end too?</p>\n</blockquote>",
        "id": 471829234,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1726864681
    },
    {
        "content": "<p>neild <a href=\"https://github.com/bytecodealliance/wasmtime/issues/9272#issuecomment-2364656922\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/9272\">issue #9272</a>:</p>\n<blockquote>\n<p>Setup:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">echo</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"n\">target</span>\n<span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">mkdir</span><span class=\"w\"> </span><span class=\"n\">b</span>\n<span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">cd</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"n\">ln</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">..</span><span class=\"w\"> </span><span class=\"n\">up</span><span class=\"p\">)</span>\n<span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">cat</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">/</span><span class=\"n\">up</span><span class=\"o\">/</span><span class=\"n\">target</span>\n<span class=\"n\">foo</span>\n</code></pre></div>\n<p>And running:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">version</span>\n<span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"mf\">25.0.0</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"mb\">0b1</span><span class=\"mi\">95</span><span class=\"n\">ef5d</span><span class=\"w\"> </span><span class=\"mi\">2024</span><span class=\"o\">-</span><span class=\"mi\">09</span><span class=\"o\">-</span><span class=\"mi\">20</span><span class=\"p\">)</span>\n<span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">dir</span><span class=\"o\">=/</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">env</span><span class=\"w\"> </span><span class=\"n\">PWD</span><span class=\"o\">=</span><span class=\"s\">\"$PWD\"</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">env</span><span class=\"w\"> </span><span class=\"n\">PATH</span><span class=\"o\">=</span><span class=\"s\">\"$PATH\"</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">W</span><span class=\"w\"> </span><span class=\"n\">max</span><span class=\"o\">-</span><span class=\"n\">wasm</span><span class=\"o\">-</span><span class=\"n\">stack</span><span class=\"o\">=</span><span class=\"mi\">1048576</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">/</span><span class=\"n\">up</span><span class=\"o\">/</span><span class=\"n\">target</span>\n<span class=\"n\">Not</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">directory</span>\n</code></pre></div>\n<p>This is on macOS. I had thought I'd observed this on macOS and Linux, but I just rechecked and I can't reproduce on Linux. So perhaps macOS-specific?</p>\n<p>Or possibly even Linux version specific, if wasmtime uses openat2 with RESOLVE_BENEATH when available.</p>\n</blockquote>",
        "id": 471837529,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1726868547
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/9272#issuecomment-2364682401\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/9272\">issue #9272</a>:</p>\n<blockquote>\n<p>Aha the plot thickens! I was indeed testing on Linux. I'll work next week on digging more into macOS, as I suspect you're right this is macOS-specific behavior. </p>\n</blockquote>",
        "id": 471840507,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1726870034
    },
    {
        "content": "<p>sunfishcode <a href=\"https://github.com/bytecodealliance/wasmtime/issues/9272#issuecomment-2364724234\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/9272\">issue #9272</a>:</p>\n<blockquote>\n<p>I can reproduce the problem using cap-std directly with this example:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">std</span><span class=\"p\">::</span><span class=\"n\">io</span><span class=\"p\">::</span><span class=\"n\">Read</span><span class=\"p\">;</span>\n\n<span class=\"k\">fn</span><span class=\"w\"> </span><span class=\"nf\">main</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">path</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">\"b/up/target\"</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">dir</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">cap_std</span><span class=\"p\">::</span><span class=\"n\">fs</span><span class=\"p\">::</span><span class=\"n\">Dir</span><span class=\"p\">::</span><span class=\"n\">open_ambient_dir</span><span class=\"p\">(</span><span class=\"s\">\".\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">cap_std</span><span class=\"p\">::</span><span class=\"n\">ambient_authority</span><span class=\"p\">()).</span><span class=\"n\">unwrap</span><span class=\"p\">();</span>\n<span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"k\">mut</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">dir</span><span class=\"p\">.</span><span class=\"n\">open</span><span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">).</span><span class=\"n\">unwrap</span><span class=\"p\">();</span>\n<span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"k\">mut</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nb\">String</span><span class=\"p\">::</span><span class=\"n\">new</span><span class=\"p\">();</span>\n<span class=\"w\">    </span><span class=\"n\">file</span><span class=\"p\">.</span><span class=\"n\">read_to_string</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"k\">mut</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"p\">).</span><span class=\"n\">unwrap</span><span class=\"p\">();</span>\n<span class=\"w\">    </span><span class=\"fm\">eprintln!</span><span class=\"p\">(</span><span class=\"s\">\"read: {:?}\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"p\">);</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p>If I modify cap-std to avoid using <code>openat2</code>, then I can reproduce the \"Not a directory\" error even on Linux. I'll investigate further.</p>\n</blockquote>",
        "id": 471846944,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1726872516
    },
    {
        "content": "<p>sunfishcode <a href=\"https://github.com/bytecodealliance/wasmtime/issues/9272#issuecomment-2372529896\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/9272\">issue #9272</a>:</p>\n<blockquote>\n<p>I've now submitted #9307 which should fix this issue.</p>\n</blockquote>",
        "id": 472585263,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1727218647
    },
    {
        "content": "<p>alexcrichton closed <a href=\"https://github.com/bytecodealliance/wasmtime/issues/9272\">issue #9272</a>:</p>\n<blockquote>\n<p>I believe I've run across a bug in wasmtime's handling of symlink targets which include <code>\"..\"</code>. I've reproduced this using the Go program below which calls <code>path_open</code> on a path and reports the result. It's not the simplest test program, but it avoids dependencies and I have a Go compiler handy.</p>\n<p>Simple case, no bug:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">echo</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"n\">file</span>\n<span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">ln</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"w\"> </span><span class=\"n\">link</span>\n<span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">GOOS</span><span class=\"o\">=</span><span class=\"n\">wasip1</span><span class=\"w\"> </span><span class=\"n\">GOARCH</span><span class=\"o\">=</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"n\">go</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"p\">.</span><span class=\"n\">go</span><span class=\"w\"> </span><span class=\"n\">link</span>\n<span class=\"n\">errno</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n</code></pre></div>\n<p>The bug shows up when resolving a link with a target of <code>\"..\"</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">echo</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"n\">target</span>\n<span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">mkdir</span><span class=\"w\"> </span><span class=\"n\">b</span>\n<span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">cd</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"n\">ln</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">..</span><span class=\"w\"> </span><span class=\"n\">up</span><span class=\"p\">)</span>\n<span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">cat</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">/</span><span class=\"n\">up</span><span class=\"o\">/</span><span class=\"n\">target</span>\n<span class=\"n\">foo</span>\n<span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">GOOS</span><span class=\"o\">=</span><span class=\"n\">wasip1</span><span class=\"w\"> </span><span class=\"n\">GOARCH</span><span class=\"o\">=</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"n\">go</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"p\">.</span><span class=\"n\">go</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">/</span><span class=\"n\">up</span>\n<span class=\"n\">errno</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">GOOS</span><span class=\"o\">=</span><span class=\"n\">wasip1</span><span class=\"w\"> </span><span class=\"n\">GOARCH</span><span class=\"o\">=</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"n\">go</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"p\">.</span><span class=\"n\">go</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">/</span><span class=\"n\">up</span><span class=\"o\">/</span><span class=\"n\">target</span>\n<span class=\"n\">Not</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">directory</span>\n</code></pre></div>\n<p>I'm not sure exactly what is going awry, but the \"not a directory\" error is clearly wrong. Note that we can open <code>b/up</code> (resolves to <code>.</code> as expected). The problem seems to be specific to links that end in <code>..</code>: if we change the link target to <code>../a</code>, everything works as expected:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">mkdir</span><span class=\"w\"> </span><span class=\"n\">a</span>\n<span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">echo</span><span class=\"w\"> </span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"o\">/</span><span class=\"n\">target</span>\n<span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">mkdir</span><span class=\"w\"> </span><span class=\"n\">b</span>\n<span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">cd</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"n\">ln</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">../</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">upa</span><span class=\"p\">)</span>\n<span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">cat</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">/</span><span class=\"n\">upa</span><span class=\"o\">/</span><span class=\"n\">target</span>\n<span class=\"n\">bar</span>\n<span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">GOOS</span><span class=\"o\">=</span><span class=\"n\">wasip1</span><span class=\"w\"> </span><span class=\"n\">GOARCH</span><span class=\"o\">=</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"n\">go</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"p\">.</span><span class=\"n\">go</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"o\">/</span><span class=\"n\">upa</span><span class=\"o\">/</span><span class=\"n\">target</span>\n<span class=\"n\">errno</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n</code></pre></div>\n<p>Test program:</p>\n<p><div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">main</span>\n\n<span class=\"n\">import</span><span class=\"w\"> </span><span class=\"p\">(</span>\n<span class=\"w\">        </span><span class=\"s\">\"fmt\"</span>\n<span class=\"w\">        </span><span class=\"s\">\"os\"</span>\n<span class=\"w\">        </span><span class=\"s\">\"syscall\"</span>\n<span class=\"w\">        </span><span class=\"s\">\"unsafe\"</span>\n<span class=\"p\">)</span>\n\n<span class=\"c1\">//go:wasmimport wasi_snapshot_preview1 path_open</span>\n<span class=\"c1\">//go:noescape</span>\n<span class=\"n\">func</span><span class=\"w\"> </span><span class=\"n\">path_open</span><span class=\"p\">(</span><span class=\"n\">rootFD</span><span class=\"w\"> </span><span class=\"n\">int32</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">dirflags</span><span class=\"w\"> </span><span class=\"n\">uint32</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">path</span><span class=\"w\"> </span><span class=\"k\">unsafe</span><span class=\"p\">.</span><span class=\"n\">Pointer</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">pathLen</span><span class=\"w\"> </span><span class=\"n\">uint32</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">oflags</span><span class=\"w\"> </span><span class=\"n\">uint32</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">fsRightsBase</span><span class=\"w\"> </span><span class=\"n\">uint64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">fsRightsInheriting</span><span class=\"w\"> </span><span class=\"n\">uint64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">fsFlags</span><span class=\"w\"> </span><span class=\"n\">uint32</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">fd</span><span class=\"w\"> </span><span class=\"k\">unsafe</span><span class=\"p\">.</span><span class=\"n\">Pointer</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">uint32</span>\n\n<span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">LOOKUP_SYMLINK_FOLLOW</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n\n<span class=\"n\">func</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"n\">f</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">err</span><span class=\"w\"> </span><span class=\"p\">:</span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">os</span><span class=\"p\">.</span><span class=\"n\">Open</span><span class=\"p\">(</span><span class=\"s\">\".\"</span><span class=\"p\">)</span>\n<span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">err</span><span class=\"w\"> </span><span class=\"o\">!=</span><span class=\"w\"> </span><span class=\"n\">nil</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">                </span><span class=\"n\">panic</span><span class=\"p\">(</span><span class=\"n\">err</span><span class=\"p\">)</span>\n<span class=\"w\">        </span><span class=\"p\">}</span>\n\n<span class=\"w\">        </span><span class=\"n\">filename</span><span class=\"w\"> </span><span class=\"p\">:</span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">os</span><span class=\"p\">.</span><span class=\"n\">Args</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">]</span>\n<span class=\"w\">        </span><span class=\"n\">var</span><span class=\"w\"> </span><span class=\"n\">fd</span><span class=\"w\"> </span><span class=\"n\">int32</span>\n<span class=\"w\">        </span><span class=\"n\">errno</span><span class=\"w\"> </span><span class=\"p\">:</span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">path_open</span><span class=\"p\">(</span>\n<span class=\"w\">                </span><span class=\"n\">int32</span><span class=\"p\">(</span><span class=\"n\">f</span><span class=\"p\">.</span><span class=\"n\">Fd</span><span class=\"p\">()),</span>\n<span class=\"w\">                </span><span class=\"n\">syscall</span><span class=\"p\">.</span><span class=\"n\">LOOKUP_SYMLINK_FOLLOW</span><span class=\"p\">,</span>\n<span class=\"w\">                </span><span class=\"k\">unsafe</span><span class=\"p\">.</span><span class=\"n\">Pointer</span><span class=\"p\">(</span><span class=\"k\">unsafe</span><span class=\"p\">.</span><span class=\"n\">StringData</span><span class=\"p\">(</span><span class=\"n\">filename</span><span class=\"p\">)),</span>\n<span class=\"w\">                </span><span class=\"n\">uint32</span><span class=\"p\">(</span><span class=\"n\">len</span><span class=\"p\">(</span><span class=\"n\">filename</span><span class=\"p\">)),</span>\n<span class=\"w\">                </span><span class=\"mi\">0</span><span class=\"p\">,</span>\n<span class=\"w\">                </span><span class=\"n\">syscall</span><span class=\"p\">.</span><span class=\"n\">RIGHT_FD_READ</span><span class=\"p\">,</span>\n<span class=\"w\">                </span><span class=\"n\">syscall</span><span class=\"p\">.</span><span class=\"n\">RIGHT_FD_READ</span><span class=\"p\">,</span>\n<span class=\"w\">                </span><span class=\"mi\">0</span><span class=\"p\">,</span>\n<span class=\"w\">                </span><span class=\"k\">unsafe</span><span class=\"p\">.</span><span class=\"n\">Pointer</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"n\">fd</span><span class=\"p\">),</span>\n<span class=\"w\">        </span><span class=\"p\">)</span>\n<span class=\"w\">        </span><span class=\"n\">fmt</span><span class=\"p\">.</span><span class=\"n\">Println</span><span class=\"p\">(</span><span class=\"n\">syscall</span><span class=\"p\">.</span><span class=\"n\">Errno</span><span class=\"p\">(</span><span class=\"n\">errno</span><span class=\"p\">))</span>\n<span class=\"p\">}</span>\n</code></pre></div><br>\n</p>\n</blockquote>",
        "id": 472595287,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1727226379
    }
]