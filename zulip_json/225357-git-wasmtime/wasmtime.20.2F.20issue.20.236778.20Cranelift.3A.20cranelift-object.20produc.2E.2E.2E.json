[
    {
        "content": "<p>bjorn3 opened <a href=\"https://github.com/bytecodealliance/wasmtime/issues/6778\">issue #6778</a>:</p>\n<blockquote>\n<h3>Steps to Reproduce</h3>\n<p>Write an AArch64 object file with a function using a TLS variable and link it using lld.</p>\n<h3>Expected Results</h3>\n<p>It links.</p>\n<h3>Actual Results</h3>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"w\">  </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">note</span>: <span class=\"nc\">ld</span><span class=\"p\">.</span><span class=\"n\">lld</span>: <span class=\"nc\">error</span>: <span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">gh</span><span class=\"o\">-</span><span class=\"n\">bjorn3</span><span class=\"o\">/</span><span class=\"n\">rust</span><span class=\"o\">/</span><span class=\"n\">build</span><span class=\"o\">/</span><span class=\"n\">aarch64</span><span class=\"o\">-</span><span class=\"n\">unknown</span><span class=\"o\">-</span><span class=\"n\">linux</span><span class=\"o\">-</span><span class=\"n\">gnu</span><span class=\"o\">/</span><span class=\"n\">stage1</span><span class=\"o\">-</span><span class=\"n\">tools</span><span class=\"o\">/</span><span class=\"n\">cg_clif</span><span class=\"o\">/</span><span class=\"n\">build</span><span class=\"o\">/</span><span class=\"n\">example</span><span class=\"o\">/</span><span class=\"n\">mini_core</span><span class=\"p\">.</span><span class=\"n\">mini_core</span><span class=\"p\">.</span><span class=\"mi\">427</span><span class=\"n\">c9c3b2a3159b4</span><span class=\"o\">-</span><span class=\"n\">cgu</span><span class=\"p\">.</span><span class=\"mf\">0.</span><span class=\"n\">rcgu</span><span class=\"p\">.</span><span class=\"n\">o</span>:<span class=\"p\">(</span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"n\">get_tls</span>: <span class=\"p\">.</span><span class=\"n\">text</span><span class=\"o\">+</span><span class=\"mh\">0x6d4</span><span class=\"p\">)</span>: <span class=\"nc\">unknown</span><span class=\"w\"> </span><span class=\"n\">relocation</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"mi\">513</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">against</span><span class=\"w\"> </span><span class=\"n\">symbol</span><span class=\"w\"> </span><span class=\"n\">mini_core</span>::<span class=\"n\">get_tls</span>::<span class=\"n\">A</span>\n<span class=\"w\">          </span><span class=\"n\">ld</span><span class=\"p\">.</span><span class=\"n\">lld</span>: <span class=\"nc\">error</span>: <span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">gh</span><span class=\"o\">-</span><span class=\"n\">bjorn3</span><span class=\"o\">/</span><span class=\"n\">rust</span><span class=\"o\">/</span><span class=\"n\">build</span><span class=\"o\">/</span><span class=\"n\">aarch64</span><span class=\"o\">-</span><span class=\"n\">unknown</span><span class=\"o\">-</span><span class=\"n\">linux</span><span class=\"o\">-</span><span class=\"n\">gnu</span><span class=\"o\">/</span><span class=\"n\">stage1</span><span class=\"o\">-</span><span class=\"n\">tools</span><span class=\"o\">/</span><span class=\"n\">cg_clif</span><span class=\"o\">/</span><span class=\"n\">build</span><span class=\"o\">/</span><span class=\"n\">example</span><span class=\"o\">/</span><span class=\"n\">mini_core</span><span class=\"p\">.</span><span class=\"n\">mini_core</span><span class=\"p\">.</span><span class=\"mi\">427</span><span class=\"n\">c9c3b2a3159b4</span><span class=\"o\">-</span><span class=\"n\">cgu</span><span class=\"p\">.</span><span class=\"mf\">0.</span><span class=\"n\">rcgu</span><span class=\"p\">.</span><span class=\"n\">o</span>:<span class=\"p\">(</span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"n\">get_tls</span>: <span class=\"p\">.</span><span class=\"n\">text</span><span class=\"o\">+</span><span class=\"mh\">0x6d8</span><span class=\"p\">)</span>: <span class=\"nc\">unknown</span><span class=\"w\"> </span><span class=\"n\">relocation</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"mi\">514</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">against</span><span class=\"w\"> </span><span class=\"n\">symbol</span><span class=\"w\"> </span><span class=\"n\">mini_core</span>::<span class=\"n\">get_tls</span>::<span class=\"n\">A</span>\n<span class=\"w\">          </span><span class=\"n\">collect2</span>: <span class=\"nc\">error</span>: <span class=\"nc\">ld</span><span class=\"w\"> </span><span class=\"n\">returned</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">exit</span><span class=\"w\"> </span><span class=\"n\">status</span>\n</code></pre></div>\n<h3>Versions and Environment</h3>\n<p>Cranelift version or commit: 92ccdcb8d68b586715957c2335031bc057e4876d</p>\n<p>Operating system: Linux</p>\n<p>Architecture: AArch64</p>\n<h3>Extra Info</h3>\n<p>Cranelift uses <code>R_AARCH64_TLSGD_ADR_PAGE21</code> and <code>R_AARCH64_TLSGD_ADD_LO12_NC</code> relocations for TLS, which seems to be unsupported by lld. Instead I think TLSDESC has to be used. This is an improvement on the traditional <code>__tls_get_addr</code> based TLS lookup: <a href=\"https://www.fsfla.org/~lxoliva/writeups/TLS/paper-lk2006.pdf\">https://www.fsfla.org/~lxoliva/writeups/TLS/paper-lk2006.pdf</a></p>\n</blockquote>",
        "id": 378880599,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1690390969
    },
    {
        "content": "<p><a href=\"https://github.com/bjorn3\">bjorn3</a> added the bug label to <a href=\"https://github.com/bytecodealliance/wasmtime/issues/6778\">Issue #6778</a>.</p>",
        "id": 378880600,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1690390969
    },
    {
        "content": "<p><a href=\"https://github.com/bjorn3\">bjorn3</a> added the cranelift label to <a href=\"https://github.com/bytecodealliance/wasmtime/issues/6778\">Issue #6778</a>.</p>",
        "id": 378880602,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1690390970
    },
    {
        "content": "<p>alexcrichton closed <a href=\"https://github.com/bytecodealliance/wasmtime/issues/6778\">issue #6778</a>:</p>\n<blockquote>\n<h3>Steps to Reproduce</h3>\n<p>Write an AArch64 object file with a function using a TLS variable and link it using lld.</p>\n<h3>Expected Results</h3>\n<p>It links.</p>\n<h3>Actual Results</h3>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"w\">  </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">note</span>: <span class=\"nc\">ld</span><span class=\"p\">.</span><span class=\"n\">lld</span>: <span class=\"nc\">error</span>: <span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">gh</span><span class=\"o\">-</span><span class=\"n\">bjorn3</span><span class=\"o\">/</span><span class=\"n\">rust</span><span class=\"o\">/</span><span class=\"n\">build</span><span class=\"o\">/</span><span class=\"n\">aarch64</span><span class=\"o\">-</span><span class=\"n\">unknown</span><span class=\"o\">-</span><span class=\"n\">linux</span><span class=\"o\">-</span><span class=\"n\">gnu</span><span class=\"o\">/</span><span class=\"n\">stage1</span><span class=\"o\">-</span><span class=\"n\">tools</span><span class=\"o\">/</span><span class=\"n\">cg_clif</span><span class=\"o\">/</span><span class=\"n\">build</span><span class=\"o\">/</span><span class=\"n\">example</span><span class=\"o\">/</span><span class=\"n\">mini_core</span><span class=\"p\">.</span><span class=\"n\">mini_core</span><span class=\"p\">.</span><span class=\"mi\">427</span><span class=\"n\">c9c3b2a3159b4</span><span class=\"o\">-</span><span class=\"n\">cgu</span><span class=\"p\">.</span><span class=\"mf\">0.</span><span class=\"n\">rcgu</span><span class=\"p\">.</span><span class=\"n\">o</span>:<span class=\"p\">(</span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"n\">get_tls</span>: <span class=\"p\">.</span><span class=\"n\">text</span><span class=\"o\">+</span><span class=\"mh\">0x6d4</span><span class=\"p\">)</span>: <span class=\"nc\">unknown</span><span class=\"w\"> </span><span class=\"n\">relocation</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"mi\">513</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">against</span><span class=\"w\"> </span><span class=\"n\">symbol</span><span class=\"w\"> </span><span class=\"n\">mini_core</span>::<span class=\"n\">get_tls</span>::<span class=\"n\">A</span>\n<span class=\"w\">          </span><span class=\"n\">ld</span><span class=\"p\">.</span><span class=\"n\">lld</span>: <span class=\"nc\">error</span>: <span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">gh</span><span class=\"o\">-</span><span class=\"n\">bjorn3</span><span class=\"o\">/</span><span class=\"n\">rust</span><span class=\"o\">/</span><span class=\"n\">build</span><span class=\"o\">/</span><span class=\"n\">aarch64</span><span class=\"o\">-</span><span class=\"n\">unknown</span><span class=\"o\">-</span><span class=\"n\">linux</span><span class=\"o\">-</span><span class=\"n\">gnu</span><span class=\"o\">/</span><span class=\"n\">stage1</span><span class=\"o\">-</span><span class=\"n\">tools</span><span class=\"o\">/</span><span class=\"n\">cg_clif</span><span class=\"o\">/</span><span class=\"n\">build</span><span class=\"o\">/</span><span class=\"n\">example</span><span class=\"o\">/</span><span class=\"n\">mini_core</span><span class=\"p\">.</span><span class=\"n\">mini_core</span><span class=\"p\">.</span><span class=\"mi\">427</span><span class=\"n\">c9c3b2a3159b4</span><span class=\"o\">-</span><span class=\"n\">cgu</span><span class=\"p\">.</span><span class=\"mf\">0.</span><span class=\"n\">rcgu</span><span class=\"p\">.</span><span class=\"n\">o</span>:<span class=\"p\">(</span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"n\">get_tls</span>: <span class=\"p\">.</span><span class=\"n\">text</span><span class=\"o\">+</span><span class=\"mh\">0x6d8</span><span class=\"p\">)</span>: <span class=\"nc\">unknown</span><span class=\"w\"> </span><span class=\"n\">relocation</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"mi\">514</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">against</span><span class=\"w\"> </span><span class=\"n\">symbol</span><span class=\"w\"> </span><span class=\"n\">mini_core</span>::<span class=\"n\">get_tls</span>::<span class=\"n\">A</span>\n<span class=\"w\">          </span><span class=\"n\">collect2</span>: <span class=\"nc\">error</span>: <span class=\"nc\">ld</span><span class=\"w\"> </span><span class=\"n\">returned</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">exit</span><span class=\"w\"> </span><span class=\"n\">status</span>\n</code></pre></div>\n<h3>Versions and Environment</h3>\n<p>Cranelift version or commit: 92ccdcb8d68b586715957c2335031bc057e4876d</p>\n<p>Operating system: Linux</p>\n<p>Architecture: AArch64</p>\n<h3>Extra Info</h3>\n<p>Cranelift uses <code>R_AARCH64_TLSGD_ADR_PAGE21</code> and <code>R_AARCH64_TLSGD_ADD_LO12_NC</code> relocations for TLS, which seems to be unsupported by lld. Instead I think TLSDESC has to be used. This is an improvement on the traditional <code>__tls_get_addr</code> based TLS lookup: <a href=\"https://www.fsfla.org/~lxoliva/writeups/TLS/paper-lk2006.pdf\">https://www.fsfla.org/~lxoliva/writeups/TLS/paper-lk2006.pdf</a></p>\n</blockquote>",
        "id": 395859742,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1696936487
    }
]