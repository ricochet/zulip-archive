[
    {
        "content": "<p>mmcloughlin opened <a href=\"https://github.com/bytecodealliance/wasmtime/pull/8761\">PR #8761</a> from <code>mmcloughlin:mbm/isle-binding-make-some</code> to <code>bytecodealliance:main</code>:</p>\n<blockquote>\n<p>Work-in-progress PR to demonstrate an idea for discussion.</p>\n<p>When working with the ISLE \"trie again\" representation there is an awkward detail with partial internal constructors. Specifically, the result binding in the rule will refer to an expression of type <code>T</code>, while the return type of the generated constructor is type <code>Option&lt;T&gt;</code>. The wrapping of the return expression in <code>Some(..)</code> happens at codegen when the return kind is <code>ReturnKind::Option</code>.</p>\n<p>This presents an incompatibility when implementing inlining at the trie level. If a constructor binding is selected for inlining then all the bindings for the rule application are imported, and the constructor callsite is replaced with the result binding. Therefore the result of inlining replaces a binding of type <code>Option&lt;T&gt;</code> with one of type <code>T</code> and the result is invalid. To fix this we just need to figure out where the right place is to insert the <code>Some(..)</code> wrapper.</p>\n<p>This PR offers one approach to add a <code>Binding::MakeSome</code> variant and materialize the <code>Some(..)</code> wrapping in the trie. Note we already have <code>Binding::{Match,Make}Variant</code> and <code>Binding::MatchSome</code> so <code>Binding::MakeSome</code> is a natural addition. The rule set builder is expanded to wrap the result binding in MakeSome for partial constructors. With this change the <code>Some(..)</code> wrapper in codegen is no longer needed, and the inlining problem mentioned above goes away.</p>\n</blockquote>",
        "id": 443527603,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1717884404
    },
    {
        "content": "<p>github-actions[bot] <a href=\"https://github.com/bytecodealliance/wasmtime/pull/8761#issuecomment-2156252355\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/8761\">PR #8761</a>:</p>\n<blockquote>\n<h4>Subscribe to Label Action</h4>\n<p>cc @cfallin, @fitzgen</p>\n<p>&lt;details&gt;<br>\nThis issue or pull request has been labeled: \"cranelift\", \"isle\"</p>\n<p>Thus the following users have been cc'd because of the following labels:</p>\n<ul>\n<li>cfallin: isle</li>\n<li>fitzgen: isle</li>\n</ul>\n<p>To subscribe or unsubscribe from this label, edit the &lt;code&gt;.github/subscribe-to-label.json&lt;/code&gt; configuration file.</p>\n<p><a href=\"https://github.com/bytecodealliance/subscribe-to-label-action\">Learn more.</a><br>\n&lt;/details&gt;</p>\n</blockquote>",
        "id": 443539168,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1717895064
    },
    {
        "content": "<p>mmcloughlin edited <a href=\"https://github.com/bytecodealliance/wasmtime/pull/8761\">PR #8761</a>:</p>\n<blockquote>\n<p>When working with ISLE's \"trie again\" representation there is an awkward detail with partial internal constructors. The result binding of a rule will refer to an expression of type <code>T</code>, while the return type of the generated constructor is type <code>Option&lt;T&gt;</code>. The wrapping of the return expression in <code>Some(..)</code> happens at codegen when the return kind is <code>ReturnKind::Option</code>.</p>\n<p>This presents an incompatibility when implementing inlining at the trie level. If a constructor binding is selected for inlining then all the bindings for the rule application are imported, and the constructor callsite is replaced with the result binding. Therefore the result of inlining replaces a binding of type <code>Option&lt;T&gt;</code> with one of type <code>T</code> and the result is invalid. To fix this we just need to figure out where the right place is to insert the <code>Some(..)</code> wrapper.</p>\n<p>This PR offers one approach to add a <code>Binding::MakeSome</code> variant and materialize the <code>Some(..)</code> wrapping in the trie. Note we already have <code>Binding::{Match,Make}Variant</code> and <code>Binding::MatchSome</code> so <code>Binding::MakeSome</code> is a natural addition. The rule set builder is expanded to wrap the result binding in MakeSome for partial constructors. With this change the <code>Some(..)</code> wrapper in codegen is no longer needed, and the inlining problem mentioned above goes away.</p>\n</blockquote>",
        "id": 444374610,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1718250475
    }
]