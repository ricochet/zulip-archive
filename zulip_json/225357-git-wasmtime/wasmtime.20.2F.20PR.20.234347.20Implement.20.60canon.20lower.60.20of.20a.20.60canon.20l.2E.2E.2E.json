[
    {
        "content": "<p>alexcrichton opened <a href=\"https://github.com/bytecodealliance/wasmtime/pull/4347\">PR #4347</a> from <code>component-lift-then-lower</code> to <code>main</code>:</p>\n<blockquote>\n<p>This commit implements the \"degenerate\" logic for implementing a<br>\nfunction within a component that is lifted and then immediately lowered<br>\nagain. In this situation the lowered function will immediately generate<br>\na trap and doesn't need to implement anything else.</p>\n<p>The implementation in this commit is somewhat heavyweight but I think is<br>\nprobably justified moreso in future additions to the component model<br>\nrather than what exactly is here right now. It's not expected that this<br>\n\"always trap\" functionality will really be used all that often since it<br>\nwould generally mean a buggy component, but the functionality plumbed<br>\nthrough here is hopefully going to be useful for implementing<br>\ncomponent-to-component adapter trampolines.</p>\n<p>Specifically this commit implements a strategy where the <code>canon.lower</code>'d<br>\nfunction is generated by Cranelift and simply has a single trap<br>\ninstruction when called, doing nothing else. The main complexity comes<br>\nfrom juggling around all the data associated with these functions,<br>\nprimarily plumbing through the traps into the <code>ModuleRegistry</code> to<br>\nensure that the global <code>is_wasm_trap_pc</code> function returns <code>true</code> and at<br>\nruntime when we lookup information about the trap it's all readily<br>\navailable (e.g. translating the trapping pc to a <code>TrapCode</code>).</p>\n<p>&lt;!--</p>\n<p>Please ensure that the following steps are all taken care of before submitting<br>\nthe PR.</p>\n<ul>\n<li>\n<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>\n  here.</p>\n</li>\n<li>\n<p>[ ] A short description of what this does, why it is needed; if the<br>\n  description becomes long, the matter should probably be discussed in an issue<br>\n  first.</p>\n</li>\n<li>\n<p>[ ] This PR contains test cases, if meaningful.</p>\n</li>\n<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>\n  If you don't know who could review this, please indicate so. The list of<br>\n  suggested reviewers on the right can help you.</li>\n</ul>\n<p>Please ensure all communication adheres to the <a href=\"https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md\">code of\nconduct</a>.<br>\n--&gt;<br>\n</p>\n</blockquote>",
        "id": 287762429,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1656443464
    },
    {
        "content": "<p><strong>alexcrichton</strong> requested <a href=\"https://github.com/fitzgen\">fitzgen</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/4347\">PR #4347</a>.</p>",
        "id": 287762432,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1656443467
    },
    {
        "content": "<p>alexcrichton updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/4347\">PR #4347</a> from <code>component-lift-then-lower</code> to <code>main</code>.</p>",
        "id": 287764554,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1656444531
    },
    {
        "content": "<p>alexcrichton updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/4347\">PR #4347</a> from <code>component-lift-then-lower</code> to <code>main</code>.</p>",
        "id": 287773679,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1656449226
    },
    {
        "content": "<p>fitzgen submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/4347#pullrequestreview-1022515455\">PR review</a>.</p>",
        "id": 287783279,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1656454553
    },
    {
        "content": "<p>fitzgen submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/4347#pullrequestreview-1022515455\">PR review</a>.</p>",
        "id": 287783280,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1656454553
    },
    {
        "content": "<p>fitzgen created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/4347#discussion_r909036675\">PR review comment</a>:</p>\n<blockquote>\n<p>I guess this is a pretty rare edge case, most components will have zero, not somthing we need to worry about optimizing.</p>\n</blockquote>",
        "id": 287783281,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1656454553
    },
    {
        "content": "<p>fitzgen created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/4347#discussion_r909027786\">PR review comment</a>:</p>\n<blockquote>\n<p>Can we compile a single always-trap function per signature?</p>\n</blockquote>",
        "id": 287783282,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1656454553
    },
    {
        "content": "<p>alexcrichton submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/4347#pullrequestreview-1023561356\">PR review</a>.</p>",
        "id": 287869614,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1656515536
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/4347#discussion_r910073502\">PR review comment</a>:</p>\n<blockquote>\n<p>Nah yeah that makes sense and is easy enough to do. I've added deduplication at the \"inliner\" layer so byt the time it reaches the compilation in cranelift everything is already deduplicated.</p>\n</blockquote>",
        "id": 287869615,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1656515536
    },
    {
        "content": "<p>alexcrichton updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/4347\">PR #4347</a> from <code>component-lift-then-lower</code> to <code>main</code>.</p>",
        "id": 287875486,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1656517731
    },
    {
        "content": "<p>alexcrichton has enabled auto merge for <a href=\"https://github.com/bytecodealliance/wasmtime/pull/4347\">PR #4347</a>.</p>",
        "id": 287875494,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1656517737
    },
    {
        "content": "<p>alexcrichton merged <a href=\"https://github.com/bytecodealliance/wasmtime/pull/4347\">PR #4347</a>.</p>",
        "id": 287882680,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1656520539
    }
]