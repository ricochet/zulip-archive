[
    {
        "content": "<p>alexcrichton labeled <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4852\">issue #4852</a>:</p>\n<blockquote>\n<p>Currently the spec interpreter is very rarely used when differential fuzzing due to the current constraints of the integration. Some new features are required (all of which I think require writing some OCaml) to support better integration:</p>\n<ul>\n<li>The instantiation and execution phases of a wasm instance need to be split apart. Right now <a href=\"https://github.com/bytecodealliance/wasmtime/blob/d2e19b8d74f557d862214938aa3184efe2409641/crates/fuzzing/src/oracles/diff_spec.rs#L55-L60\">instantiation always feigns success</a> which means that wasm modules which fail to instantiate (with an out-of-bounds element segment for example) fail later than other engines. This is why the spec fuzzer <a href=\"https://github.com/bytecodealliance/wasmtime/blob/d2e19b8d74f557d862214938aa3184efe2409641/crates/fuzzing/src/oracles/diff_spec.rs#L29-L37\">disallows tables</a></li>\n<li>Currently the integration with the spec test fuzzing <a href=\"https://github.com/bytecodealliance/wasmtime/blob/d2e19b8d74f557d862214938aa3184efe2409641/crates/fuzzing/src/oracles/diff_spec.rs#L21-L27\">does not support more than one function</a> because the current OCaml harness I believe executes the first function. Instead <a href=\"https://github.com/bytecodealliance/wasmtime/blob/d2e19b8d74f557d862214938aa3184efe2409641/crates/fuzzing/src/oracles/diff_spec.rs#L90\">the function name should get threaded through here</a> and executed.</li>\n<li>Getting the values of linear memory and/or wasm globals <a href=\"https://github.com/bytecodealliance/wasmtime/blob/d2e19b8d74f557d862214938aa3184efe2409641/crates/fuzzing/src/oracles/diff_spec.rs#L96-L104\">is currently unimplemented</a>.</li>\n<li>Less critical but still nice-to-have, <a href=\"https://github.com/bytecodealliance/wasmtime/blob/d2e19b8d74f557d862214938aa3184efe2409641/crates/fuzzing/src/oracles/diff_spec.rs#L62-L65\">error messages are not validated</a> to ensure that Wasmtime and the spec interpreter produce the same flavor of trap.</li>\n</ul>\n<p>cc @conrad-watt IIRC you've been working with @abrown to make a more generalized harness and I think the intention was to land it in <a href=\"https://github.com/bytecodealliance/wasm-spec-interpreter\">https://github.com/bytecodealliance/wasm-spec-interpreter</a> but if you're willing I think it'd also be good to get the updates into this repository ahead of that if there are orthogonal issues there to tackle (I'm unsure of its status, we could also fill out that repo and then replace the in-tree copy of the repo here with the external dependency)</p>\n</blockquote>",
        "id": 296832415,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1662129236
    },
    {
        "content": "<p>alexcrichton opened <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4852\">issue #4852</a>:</p>\n<blockquote>\n<p>Currently the spec interpreter is very rarely used when differential fuzzing due to the current constraints of the integration. Some new features are required (all of which I think require writing some OCaml) to support better integration:</p>\n<ul>\n<li>The instantiation and execution phases of a wasm instance need to be split apart. Right now <a href=\"https://github.com/bytecodealliance/wasmtime/blob/d2e19b8d74f557d862214938aa3184efe2409641/crates/fuzzing/src/oracles/diff_spec.rs#L55-L60\">instantiation always feigns success</a> which means that wasm modules which fail to instantiate (with an out-of-bounds element segment for example) fail later than other engines. This is why the spec fuzzer <a href=\"https://github.com/bytecodealliance/wasmtime/blob/d2e19b8d74f557d862214938aa3184efe2409641/crates/fuzzing/src/oracles/diff_spec.rs#L29-L37\">disallows tables</a></li>\n<li>Currently the integration with the spec test fuzzing <a href=\"https://github.com/bytecodealliance/wasmtime/blob/d2e19b8d74f557d862214938aa3184efe2409641/crates/fuzzing/src/oracles/diff_spec.rs#L21-L27\">does not support more than one function</a> because the current OCaml harness I believe executes the first function. Instead <a href=\"https://github.com/bytecodealliance/wasmtime/blob/d2e19b8d74f557d862214938aa3184efe2409641/crates/fuzzing/src/oracles/diff_spec.rs#L90\">the function name should get threaded through here</a> and executed.</li>\n<li>Getting the values of linear memory and/or wasm globals <a href=\"https://github.com/bytecodealliance/wasmtime/blob/d2e19b8d74f557d862214938aa3184efe2409641/crates/fuzzing/src/oracles/diff_spec.rs#L96-L104\">is currently unimplemented</a>.</li>\n<li>Less critical but still nice-to-have, <a href=\"https://github.com/bytecodealliance/wasmtime/blob/d2e19b8d74f557d862214938aa3184efe2409641/crates/fuzzing/src/oracles/diff_spec.rs#L62-L65\">error messages are not validated</a> to ensure that Wasmtime and the spec interpreter produce the same flavor of trap.</li>\n</ul>\n<p>cc @conrad-watt IIRC you've been working with @abrown to make a more generalized harness and I think the intention was to land it in <a href=\"https://github.com/bytecodealliance/wasm-spec-interpreter\">https://github.com/bytecodealliance/wasm-spec-interpreter</a> but if you're willing I think it'd also be good to get the updates into this repository ahead of that if there are orthogonal issues there to tackle (I'm unsure of its status, we could also fill out that repo and then replace the in-tree copy of the repo here with the external dependency)</p>\n</blockquote>",
        "id": 296832416,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1662129236
    },
    {
        "content": "<p>github-actions[bot] <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4852#issuecomment-1235579309\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4852\">issue #4852</a>:</p>\n<blockquote>\n<h4>Subscribe to Label Action</h4>\n<p>cc @fitzgen</p>\n<p>&lt;details&gt;<br>\nThis issue or pull request has been labeled: \"fuzzing\"</p>\n<p>Thus the following users have been cc'd because of the following labels:</p>\n<ul>\n<li>fitzgen: fuzzing</li>\n</ul>\n<p>To subscribe or unsubscribe from this label, edit the &lt;code&gt;.github/subscribe-to-label.json&lt;/code&gt; configuration file.</p>\n<p><a href=\"https://github.com/bytecodealliance/subscribe-to-label-action\">Learn more.</a><br>\n&lt;/details&gt;</p>\n</blockquote>",
        "id": 296832559,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1662129277
    },
    {
        "content": "<p>conrad-watt <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4852#issuecomment-1235585699\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4852\">issue #4852</a>:</p>\n<blockquote>\n<p>@abrown, I believe that the new interface I implemented for the interpreter <a href=\"https://github.com/bytecodealliance/wasmtime/compare/main...conrad-watt:wasmtime:main\">here</a> addresses the first three bullet points in the OP. How much effort would it be to merge this in?</p>\n</blockquote>",
        "id": 296833832,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1662129635
    },
    {
        "content": "<p>conrad-watt edited a <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4852#issuecomment-1235585699\">comment</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4852\">issue #4852</a>:</p>\n<blockquote>\n<p>@abrown, I believe that the new interface I implemented for the interpreter <a href=\"https://github.com/bytecodealliance/wasmtime/compare/main...conrad-watt:wasmtime:main\">here</a> addresses the first three bullet points in the OP. How much effort would it be to merge this in (edit: possibly with appropriate cleanup of the tests and legacy API)?</p>\n</blockquote>",
        "id": 296834220,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1662129752
    },
    {
        "content": "<p>abrown <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4852#issuecomment-1235631165\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4852\">issue #4852</a>:</p>\n<blockquote>\n<p>Sure, I like the idea of trying it out here first. I can work in the changes we made next week and submit a PR.</p>\n</blockquote>",
        "id": 296842558,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1662132289
    },
    {
        "content": "<p>conrad-watt <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4852#issuecomment-1244713752\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4852\">issue #4852</a>:</p>\n<blockquote>\n<p>With the merging of <a href=\"https://github.com/bytecodealliance/wasmtime/pull/4881\">https://github.com/bytecodealliance/wasmtime/pull/4881</a>, where are we on this now?</p>\n</blockquote>",
        "id": 298494787,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1663025882
    },
    {
        "content": "<p>abrown <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4852#issuecomment-1244818315\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4852\">issue #4852</a>:</p>\n<blockquote>\n<p>It looks like mostly done; maybe matching up the error messages to the Wasmtime trap equivalent is all that is left?</p>\n</blockquote>",
        "id": 298505946,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1663036285
    },
    {
        "content": "<p>alexcrichton closed <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4852\">issue #4852</a>:</p>\n<blockquote>\n<p>Currently the spec interpreter is very rarely used when differential fuzzing due to the current constraints of the integration. Some new features are required (all of which I think require writing some OCaml) to support better integration:</p>\n<ul>\n<li>The instantiation and execution phases of a wasm instance need to be split apart. Right now <a href=\"https://github.com/bytecodealliance/wasmtime/blob/d2e19b8d74f557d862214938aa3184efe2409641/crates/fuzzing/src/oracles/diff_spec.rs#L55-L60\">instantiation always feigns success</a> which means that wasm modules which fail to instantiate (with an out-of-bounds element segment for example) fail later than other engines. This is why the spec fuzzer <a href=\"https://github.com/bytecodealliance/wasmtime/blob/d2e19b8d74f557d862214938aa3184efe2409641/crates/fuzzing/src/oracles/diff_spec.rs#L29-L37\">disallows tables</a></li>\n<li>Currently the integration with the spec test fuzzing <a href=\"https://github.com/bytecodealliance/wasmtime/blob/d2e19b8d74f557d862214938aa3184efe2409641/crates/fuzzing/src/oracles/diff_spec.rs#L21-L27\">does not support more than one function</a> because the current OCaml harness I believe executes the first function. Instead <a href=\"https://github.com/bytecodealliance/wasmtime/blob/d2e19b8d74f557d862214938aa3184efe2409641/crates/fuzzing/src/oracles/diff_spec.rs#L90\">the function name should get threaded through here</a> and executed.</li>\n<li>Getting the values of linear memory and/or wasm globals <a href=\"https://github.com/bytecodealliance/wasmtime/blob/d2e19b8d74f557d862214938aa3184efe2409641/crates/fuzzing/src/oracles/diff_spec.rs#L96-L104\">is currently unimplemented</a>.</li>\n<li>Less critical but still nice-to-have, <a href=\"https://github.com/bytecodealliance/wasmtime/blob/d2e19b8d74f557d862214938aa3184efe2409641/crates/fuzzing/src/oracles/diff_spec.rs#L62-L65\">error messages are not validated</a> to ensure that Wasmtime and the spec interpreter produce the same flavor of trap.</li>\n</ul>\n<p>cc @conrad-watt IIRC you've been working with @abrown to make a more generalized harness and I think the intention was to land it in <a href=\"https://github.com/bytecodealliance/wasm-spec-interpreter\">https://github.com/bytecodealliance/wasm-spec-interpreter</a> but if you're willing I think it'd also be good to get the updates into this repository ahead of that if there are orthogonal issues there to tackle (I'm unsure of its status, we could also fill out that repo and then replace the in-tree copy of the repo here with the external dependency)</p>\n</blockquote>",
        "id": 298596873,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1663079083
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4852#issuecomment-1245492055\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4852\">issue #4852</a>:</p>\n<blockquote>\n<p>Indeed, yeah, I think that the spec interpreter could have something <a href=\"https://github.com/bytecodealliance/wasmtime/blob/c3f8415ac7535a5462eea017131fbaca61618461/crates/fuzzing/src/oracles/diff_v8.rs#L80-L149\">similar to v8</a> where it checks trap messages, but that's not critical since we already test against v8 and wasmi as well, so I think this can be closed.</p>\n</blockquote>",
        "id": 298596875,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1663079083
    }
]