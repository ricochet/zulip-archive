[
    {
        "content": "<p>pchickey opened <a href=\"https://github.com/bytecodealliance/wasmtime/pull/7095\">PR #7095</a> from <code>bytecodealliance:pch/component_call_hooks</code> to <code>bytecodealliance:main</code>:</p>\n<blockquote>\n<p>&lt;!--<br>\nPlease make sure you include the following information:</p>\n<ul>\n<li>\n<p>If this work has been discussed elsewhere, please include a link to that<br>\n  conversation. If it was discussed in an issue, just mention \"issue #...\".</p>\n</li>\n<li>\n<p>Explain why this change is needed. If the details are in an issue already,<br>\n  this can be brief.</p>\n</li>\n</ul>\n<p>Our development process is documented in the Wasmtime book:<br>\n<a href=\"https://docs.wasmtime.dev/contributing-development-process.html\">https://docs.wasmtime.dev/contributing-development-process.html</a></p>\n<p>Please ensure all communication follows the code of conduct:<br>\n<a href=\"https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md\">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>\n--&gt;</p>\n</blockquote>",
        "id": 393385386,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1695787575
    },
    {
        "content": "<p><strong>pchickey</strong> requested <a href=\"https://github.com/alexcrichton\">alexcrichton</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/7095\">PR #7095</a>.</p>",
        "id": 393385395,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1695787581
    },
    {
        "content": "<p>pchickey edited <a href=\"https://github.com/bytecodealliance/wasmtime/pull/7095\">PR #7095</a>:</p>\n<blockquote>\n<p>This needs more fleshing out and testing. </p>\n<p>Without this patch, @acfoltzer reported an unexpected trace when calling into a component:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code>#<span class=\"w\">    </span><span class=\"mf\">7.148</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"p\">.</span><span class=\"n\">v0</span><span class=\"w\"> </span><span class=\"n\">XQD</span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">09</span><span class=\"o\">-</span><span class=\"mi\">27</span><span class=\"n\">T00</span>:<span class=\"mi\">39</span>:<span class=\"mf\">46.963691</span><span class=\"n\">Z</span><span class=\"w\"> </span><span class=\"n\">TRACE</span><span class=\"w\"> </span><span class=\"n\">request</span><span class=\"p\">{</span><span class=\"n\">id</span><span class=\"o\">=</span><span class=\"mi\">00000000</span><span class=\"o\">-</span><span class=\"mi\">0000</span><span class=\"o\">-</span><span class=\"mi\">0000</span><span class=\"o\">-</span><span class=\"mi\">0000</span><span class=\"o\">-</span><span class=\"mi\">000000000000</span><span class=\"p\">}</span>:<span class=\"nc\">service</span><span class=\"p\">{</span><span class=\"n\">sid</span><span class=\"o\">=</span><span class=\"n\">enabled</span><span class=\"p\">}</span>: <span class=\"nc\">xqd</span>::<span class=\"n\">guest</span>::<span class=\"n\">component</span>: <span class=\"nc\">call_hook</span><span class=\"o\">=</span><span class=\"n\">CallingWasm</span><span class=\"err\">\\</span><span class=\"n\">n</span>\n#<span class=\"w\">    </span><span class=\"mf\">7.148</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"p\">.</span><span class=\"n\">v0</span><span class=\"w\"> </span><span class=\"n\">XQD</span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">09</span><span class=\"o\">-</span><span class=\"mi\">27</span><span class=\"n\">T00</span>:<span class=\"mi\">39</span>:<span class=\"mf\">46.964430</span><span class=\"n\">Z</span><span class=\"w\"> </span><span class=\"n\">TRACE</span><span class=\"w\"> </span><span class=\"n\">request</span><span class=\"p\">{</span><span class=\"n\">id</span><span class=\"o\">=</span><span class=\"mi\">00000000</span><span class=\"o\">-</span><span class=\"mi\">0000</span><span class=\"o\">-</span><span class=\"mi\">0000</span><span class=\"o\">-</span><span class=\"mi\">0000</span><span class=\"o\">-</span><span class=\"mi\">000000000000</span><span class=\"p\">}</span>:<span class=\"nc\">service</span><span class=\"p\">{</span><span class=\"n\">sid</span><span class=\"o\">=</span><span class=\"n\">enabled</span><span class=\"p\">}</span>: <span class=\"nc\">xqd</span>::<span class=\"n\">guest</span>::<span class=\"n\">component</span>: <span class=\"nc\">call_hook</span><span class=\"o\">=</span><span class=\"n\">CallingWasm</span><span class=\"err\">\\</span><span class=\"n\">n</span>\n#<span class=\"w\">    </span><span class=\"mf\">7.148</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"p\">.</span><span class=\"n\">v0</span><span class=\"w\"> </span><span class=\"n\">XQD</span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">09</span><span class=\"o\">-</span><span class=\"mi\">27</span><span class=\"n\">T00</span>:<span class=\"mi\">39</span>:<span class=\"mf\">46.964485</span><span class=\"n\">Z</span><span class=\"w\"> </span><span class=\"n\">TRACE</span><span class=\"w\"> </span><span class=\"n\">request</span><span class=\"p\">{</span><span class=\"n\">id</span><span class=\"o\">=</span><span class=\"mi\">00000000</span><span class=\"o\">-</span><span class=\"mi\">0000</span><span class=\"o\">-</span><span class=\"mi\">0000</span><span class=\"o\">-</span><span class=\"mi\">0000</span><span class=\"o\">-</span><span class=\"mi\">000000000000</span><span class=\"p\">}</span>:<span class=\"nc\">service</span><span class=\"p\">{</span><span class=\"n\">sid</span><span class=\"o\">=</span><span class=\"n\">enabled</span><span class=\"p\">}</span>: <span class=\"nc\">xqd</span>::<span class=\"n\">guest</span>::<span class=\"n\">component</span>: <span class=\"nc\">call_hook</span><span class=\"o\">=</span><span class=\"n\">ReturningFromWasm</span><span class=\"err\">\\</span><span class=\"n\">n</span>\n#<span class=\"w\">    </span><span class=\"mf\">7.148</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"p\">.</span><span class=\"n\">v0</span><span class=\"w\"> </span><span class=\"n\">XQD</span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">09</span><span class=\"o\">-</span><span class=\"mi\">27</span><span class=\"n\">T00</span>:<span class=\"mi\">39</span>:<span class=\"mf\">46.964932</span><span class=\"n\">Z</span><span class=\"w\"> </span><span class=\"n\">TRACE</span><span class=\"w\"> </span><span class=\"n\">request</span><span class=\"p\">{</span><span class=\"n\">id</span><span class=\"o\">=</span><span class=\"mi\">00000000</span><span class=\"o\">-</span><span class=\"mi\">0000</span><span class=\"o\">-</span><span class=\"mi\">0000</span><span class=\"o\">-</span><span class=\"mi\">0000</span><span class=\"o\">-</span><span class=\"mi\">000000000000</span><span class=\"p\">}</span>:<span class=\"nc\">service</span><span class=\"p\">{</span><span class=\"n\">sid</span><span class=\"o\">=</span><span class=\"n\">enabled</span><span class=\"p\">}</span>: <span class=\"nc\">xqd</span>::<span class=\"n\">guest</span>::<span class=\"n\">component</span>: <span class=\"nc\">call_hook</span><span class=\"o\">=</span><span class=\"n\">ReturningFromWasm</span><span class=\"err\">\\</span><span class=\"n\">n</span>\n</code></pre></div>\n</blockquote>",
        "id": 393385715,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1695787736
    },
    {
        "content": "<p>alexcrichton submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/7095#pullrequestreview-1646777336\">PR review</a>:</p>\n<blockquote>\n<p>Looks good!</p>\n<p>I know there's a test for call hooks which verifies the transitions are all expected, and it might be nice to enable that for all component model tests via a <code>debug_assert!</code> in the store, but that's a bit of a refactoring to take on that I don't think is worth it just yet. The realloc bits won't be covered by these tests but those are a bit more difficult too to cover.</p>\n</blockquote>",
        "id": 393506286,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1695825114
    },
    {
        "content": "<p>alexcrichton submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/7095#pullrequestreview-1646777336\">PR review</a>:</p>\n<blockquote>\n<p>Looks good!</p>\n<p>I know there's a test for call hooks which verifies the transitions are all expected, and it might be nice to enable that for all component model tests via a <code>debug_assert!</code> in the store, but that's a bit of a refactoring to take on that I don't think is worth it just yet. The realloc bits won't be covered by these tests but those are a bit more difficult too to cover.</p>\n</blockquote>",
        "id": 393506287,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1695825114
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/7095#discussion_r1338708579\">PR review comment</a>:</p>\n<blockquote>\n<p>The error semantics here are a bit subtle I think -- to match core wasm the <code>ReturningFromHost</code> hook should be called no matter what regardelss of whether <code>closure</code> returned an error or not.</p>\n<p>Additionally the <code>ReturningFromHost</code> hook should be delayed to the end of the function because lowering may invoke realloc in the guest which is another instance of entering wasm and I think <code>ReturningFromHost</code> followed by <code>CallWasm</code> might be a bit unexpected.</p>\n</blockquote>",
        "id": 393506289,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1695825114
    },
    {
        "content": "<p>pchickey closed without merge <a href=\"https://github.com/bytecodealliance/wasmtime/pull/7095\">PR #7095</a>.</p>",
        "id": 425412339,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1709852925
    },
    {
        "content": "<p>pchickey <a href=\"https://github.com/bytecodealliance/wasmtime/pull/7095#issuecomment-1984756075\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/7095\">PR #7095</a>:</p>\n<blockquote>\n<p>I forgot about this and I don't really think its critical, we can let someone re-open it if they need to.</p>\n</blockquote>",
        "id": 425412340,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1709852925
    }
]