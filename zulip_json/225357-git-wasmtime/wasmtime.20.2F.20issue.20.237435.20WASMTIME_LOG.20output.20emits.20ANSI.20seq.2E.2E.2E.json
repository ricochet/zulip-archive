[
    {
        "content": "<p>cfallin opened <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7435\">issue #7435</a>:</p>\n<blockquote>\n<p>In #7239 we added a <code>tracing-log</code> subscriber that prints log output to stderr when the <code>WASMTIME_LOG</code> environment variable is set. This is useful for debugging, but unfortunately its ANSI color sequence heuristics seem somewhat broken: on Linux, if I run</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">WASMTIME_LOG</span><span class=\"o\">=</span><span class=\"n\">tracing</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">compile</span><span class=\"w\"> </span><span class=\"o\">..</span><span class=\"p\">.</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">&gt;</span><span class=\"n\">log</span>\n</code></pre></div>\n<p>I see a <code>log</code> file that looks like</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"w\">    </span><span class=\"n\">Finished</span><span class=\"w\"> </span><span class=\"n\">dev</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">unoptimized</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"n\">debuginfo</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"n\">target</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"mf\">0.13</span><span class=\"n\">s</span>\n<span class=\"w\">     </span><span class=\"n\">Running</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">target</span><span class=\"o\">/</span><span class=\"n\">debug</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">compile</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">target</span><span class=\"w\"> </span><span class=\"n\">aarch64</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">pcc</span><span class=\"o\">=</span><span class=\"n\">yes</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">O</span><span class=\"w\"> </span><span class=\"k\">static</span><span class=\"o\">-</span><span class=\"n\">memory</span><span class=\"o\">-</span><span class=\"n\">maximum</span><span class=\"o\">-</span><span class=\"n\">size</span><span class=\"o\">=</span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">test</span><span class=\"p\">.</span><span class=\"n\">wat</span><span class=\"err\">`</span>\n<span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">2</span><span class=\"n\">m2023</span><span class=\"o\">-</span><span class=\"mi\">11</span><span class=\"o\">-</span><span class=\"mi\">01</span><span class=\"n\">T04</span>:<span class=\"mi\">49</span>:<span class=\"mf\">35.596710</span><span class=\"n\">Z</span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">0</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">34</span><span class=\"n\">mDEBUG</span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">0</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">2</span><span class=\"n\">mwasmtime_cache</span>::<span class=\"n\">worker</span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">0</span><span class=\"n\">m</span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">2</span><span class=\"n\">m</span>:<span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">0</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">Cache</span><span class=\"w\"> </span><span class=\"n\">worker</span><span class=\"w\"> </span><span class=\"n\">thread</span><span class=\"w\"> </span><span class=\"n\">started</span><span class=\"p\">.</span>\n<span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">2</span><span class=\"n\">m2023</span><span class=\"o\">-</span><span class=\"mi\">11</span><span class=\"o\">-</span><span class=\"mi\">01</span><span class=\"n\">T04</span>:<span class=\"mi\">49</span>:<span class=\"mf\">35.596813</span><span class=\"n\">Z</span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">0</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">34</span><span class=\"n\">mDEBUG</span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">0</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">2</span><span class=\"n\">mwasmtime_cache</span>::<span class=\"n\">worker</span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">0</span><span class=\"n\">m</span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">2</span><span class=\"n\">m</span>:<span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">0</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">New</span><span class=\"w\"> </span><span class=\"n\">nice</span><span class=\"w\"> </span><span class=\"n\">value</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">worker</span><span class=\"w\"> </span><span class=\"n\">thread</span>: <span class=\"mi\">3</span>\n<span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">2</span><span class=\"n\">m2023</span><span class=\"o\">-</span><span class=\"mi\">11</span><span class=\"o\">-</span><span class=\"mi\">01</span><span class=\"n\">T04</span>:<span class=\"mi\">49</span>:<span class=\"mf\">35.600299</span><span class=\"n\">Z</span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">0</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">34</span><span class=\"n\">mDEBUG</span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">0</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">2</span><span class=\"n\">mcranelift_codegen</span>::<span class=\"n\">timing</span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">0</span><span class=\"n\">m</span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">2</span><span class=\"n\">m</span>:<span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">0</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">timing</span>: <span class=\"nc\">Starting</span><span class=\"w\"> </span><span class=\"n\">Translate</span><span class=\"w\"> </span><span class=\"n\">WASM</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">during</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">no</span><span class=\"w\"> </span><span class=\"n\">pass</span><span class=\"o\">&gt;</span><span class=\"p\">)</span>\n<span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">2</span><span class=\"n\">m2023</span><span class=\"o\">-</span><span class=\"mi\">11</span><span class=\"o\">-</span><span class=\"mi\">01</span><span class=\"n\">T04</span>:<span class=\"mi\">49</span>:<span class=\"mf\">35.600374</span><span class=\"n\">Z</span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">0</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">35</span><span class=\"n\">mTRACE</span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">0</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">2</span><span class=\"n\">mcranelift_wasm</span>::<span class=\"n\">func_translator</span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">0</span><span class=\"n\">m</span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">2</span><span class=\"n\">m</span>:<span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">0</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">translate</span><span class=\"p\">(</span><span class=\"mi\">12</span><span class=\"w\"> </span><span class=\"n\">bytes</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">u0</span>:<span class=\"mi\">0</span><span class=\"p\">(</span><span class=\"kt\">i64</span><span class=\"w\"> </span><span class=\"n\">vmctx</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">i32</span><span class=\"p\">)</span><span class=\"w\"> </span>-&gt; <span class=\"kt\">i32</span> <span class=\"nc\">fast</span><span class=\"p\">)</span>\n<span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">2</span><span class=\"n\">m2023</span><span class=\"o\">-</span><span class=\"mi\">11</span><span class=\"o\">-</span><span class=\"mi\">01</span><span class=\"n\">T04</span>:<span class=\"mi\">49</span>:<span class=\"mf\">35.600595</span><span class=\"n\">Z</span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">0</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">34</span><span class=\"n\">mDEBUG</span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">0</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">2</span><span class=\"n\">mcranelift_codegen</span>::<span class=\"n\">timing</span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">0</span><span class=\"n\">m</span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">2</span><span class=\"n\">m</span>:<span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">0</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">timing</span>: <span class=\"nc\">Starting</span><span class=\"w\"> </span><span class=\"n\">Compilation</span><span class=\"w\"> </span><span class=\"n\">passes</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">during</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">no</span><span class=\"w\"> </span><span class=\"n\">pass</span><span class=\"o\">&gt;</span><span class=\"p\">)</span>\n<span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">2</span><span class=\"n\">m2023</span><span class=\"o\">-</span><span class=\"mi\">11</span><span class=\"o\">-</span><span class=\"mi\">01</span><span class=\"n\">T04</span>:<span class=\"mi\">49</span>:<span class=\"mf\">35.600669</span><span class=\"n\">Z</span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">0</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">34</span><span class=\"n\">mDEBUG</span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">0</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">2</span><span class=\"n\">mcranelift_codegen</span>::<span class=\"n\">context</span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">0</span><span class=\"n\">m</span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">2</span><span class=\"n\">m</span>:<span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">0</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">Number</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">CLIF</span><span class=\"w\"> </span><span class=\"n\">instructions</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">optimize</span>: <span class=\"mi\">12</span>\n<span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">2</span><span class=\"n\">m2023</span><span class=\"o\">-</span><span class=\"mi\">11</span><span class=\"o\">-</span><span class=\"mi\">01</span><span class=\"n\">T04</span>:<span class=\"mi\">49</span>:<span class=\"mf\">35.600694</span><span class=\"n\">Z</span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">0</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">34</span><span class=\"n\">mDEBUG</span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">0</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">2</span><span class=\"n\">mcranelift_codegen</span>::<span class=\"n\">context</span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">0</span><span class=\"n\">m</span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">2</span><span class=\"n\">m</span>:<span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">0</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">Number</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">CLIF</span><span class=\"w\"> </span><span class=\"n\">blocks</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">optimize</span>: <span class=\"mi\">1</span>\n<span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">2</span><span class=\"n\">m2023</span><span class=\"o\">-</span><span class=\"mi\">11</span><span class=\"o\">-</span><span class=\"mi\">01</span><span class=\"n\">T04</span>:<span class=\"mi\">49</span>:<span class=\"mf\">35.600716</span><span class=\"n\">Z</span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">0</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">35</span><span class=\"n\">mTRACE</span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">0</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">2</span><span class=\"n\">mcranelift_codegen</span>::<span class=\"n\">context</span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">0</span><span class=\"n\">m</span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">2</span><span class=\"n\">m</span>:<span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">0</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">Optimizing</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">opt</span><span class=\"w\"> </span><span class=\"n\">level</span><span class=\"w\"> </span><span class=\"n\">Speed</span><span class=\"p\">)</span>:\n</code></pre></div>\n<p>The code does indeed <a href=\"https://github.com/bytecodealliance/wasmtime/blob/9b976048689cfc3aec3d12f4742364c8cb2a115c/crates/cli-flags/src/lib.rs#L368-L370\">check whether stderr is a terminal</a> before enabling ANSI sequences; but somehow this is not working right.</p>\n</blockquote>",
        "id": 399656926,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1698814569
    },
    {
        "content": "<p>fitzgen closed <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7435\">issue #7435</a>:</p>\n<blockquote>\n<p>In #7239 we added a <code>tracing-log</code> subscriber that prints log output to stderr when the <code>WASMTIME_LOG</code> environment variable is set. This is useful for debugging, but unfortunately its ANSI color sequence heuristics seem somewhat broken: on Linux, if I run</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">WASMTIME_LOG</span><span class=\"o\">=</span><span class=\"n\">tracing</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">compile</span><span class=\"w\"> </span><span class=\"o\">..</span><span class=\"p\">.</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"o\">&gt;</span><span class=\"n\">log</span>\n</code></pre></div>\n<p>I see a <code>log</code> file that looks like</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"w\">    </span><span class=\"n\">Finished</span><span class=\"w\"> </span><span class=\"n\">dev</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">unoptimized</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"n\">debuginfo</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"n\">target</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"mf\">0.13</span><span class=\"n\">s</span>\n<span class=\"w\">     </span><span class=\"n\">Running</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">target</span><span class=\"o\">/</span><span class=\"n\">debug</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">compile</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">target</span><span class=\"w\"> </span><span class=\"n\">aarch64</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">pcc</span><span class=\"o\">=</span><span class=\"n\">yes</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">O</span><span class=\"w\"> </span><span class=\"k\">static</span><span class=\"o\">-</span><span class=\"n\">memory</span><span class=\"o\">-</span><span class=\"n\">maximum</span><span class=\"o\">-</span><span class=\"n\">size</span><span class=\"o\">=</span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">test</span><span class=\"p\">.</span><span class=\"n\">wat</span><span class=\"err\">`</span>\n<span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">2</span><span class=\"n\">m2023</span><span class=\"o\">-</span><span class=\"mi\">11</span><span class=\"o\">-</span><span class=\"mi\">01</span><span class=\"n\">T04</span>:<span class=\"mi\">49</span>:<span class=\"mf\">35.596710</span><span class=\"n\">Z</span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">0</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">34</span><span class=\"n\">mDEBUG</span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">0</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">2</span><span class=\"n\">mwasmtime_cache</span>::<span class=\"n\">worker</span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">0</span><span class=\"n\">m</span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">2</span><span class=\"n\">m</span>:<span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">0</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">Cache</span><span class=\"w\"> </span><span class=\"n\">worker</span><span class=\"w\"> </span><span class=\"n\">thread</span><span class=\"w\"> </span><span class=\"n\">started</span><span class=\"p\">.</span>\n<span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">2</span><span class=\"n\">m2023</span><span class=\"o\">-</span><span class=\"mi\">11</span><span class=\"o\">-</span><span class=\"mi\">01</span><span class=\"n\">T04</span>:<span class=\"mi\">49</span>:<span class=\"mf\">35.596813</span><span class=\"n\">Z</span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">0</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">34</span><span class=\"n\">mDEBUG</span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">0</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">2</span><span class=\"n\">mwasmtime_cache</span>::<span class=\"n\">worker</span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">0</span><span class=\"n\">m</span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">2</span><span class=\"n\">m</span>:<span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">0</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">New</span><span class=\"w\"> </span><span class=\"n\">nice</span><span class=\"w\"> </span><span class=\"n\">value</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">worker</span><span class=\"w\"> </span><span class=\"n\">thread</span>: <span class=\"mi\">3</span>\n<span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">2</span><span class=\"n\">m2023</span><span class=\"o\">-</span><span class=\"mi\">11</span><span class=\"o\">-</span><span class=\"mi\">01</span><span class=\"n\">T04</span>:<span class=\"mi\">49</span>:<span class=\"mf\">35.600299</span><span class=\"n\">Z</span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">0</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">34</span><span class=\"n\">mDEBUG</span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">0</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">2</span><span class=\"n\">mcranelift_codegen</span>::<span class=\"n\">timing</span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">0</span><span class=\"n\">m</span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">2</span><span class=\"n\">m</span>:<span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">0</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">timing</span>: <span class=\"nc\">Starting</span><span class=\"w\"> </span><span class=\"n\">Translate</span><span class=\"w\"> </span><span class=\"n\">WASM</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">during</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">no</span><span class=\"w\"> </span><span class=\"n\">pass</span><span class=\"o\">&gt;</span><span class=\"p\">)</span>\n<span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">2</span><span class=\"n\">m2023</span><span class=\"o\">-</span><span class=\"mi\">11</span><span class=\"o\">-</span><span class=\"mi\">01</span><span class=\"n\">T04</span>:<span class=\"mi\">49</span>:<span class=\"mf\">35.600374</span><span class=\"n\">Z</span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">0</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">35</span><span class=\"n\">mTRACE</span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">0</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">2</span><span class=\"n\">mcranelift_wasm</span>::<span class=\"n\">func_translator</span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">0</span><span class=\"n\">m</span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">2</span><span class=\"n\">m</span>:<span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">0</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">translate</span><span class=\"p\">(</span><span class=\"mi\">12</span><span class=\"w\"> </span><span class=\"n\">bytes</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">u0</span>:<span class=\"mi\">0</span><span class=\"p\">(</span><span class=\"kt\">i64</span><span class=\"w\"> </span><span class=\"n\">vmctx</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">i32</span><span class=\"p\">)</span><span class=\"w\"> </span>-&gt; <span class=\"kt\">i32</span> <span class=\"nc\">fast</span><span class=\"p\">)</span>\n<span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">2</span><span class=\"n\">m2023</span><span class=\"o\">-</span><span class=\"mi\">11</span><span class=\"o\">-</span><span class=\"mi\">01</span><span class=\"n\">T04</span>:<span class=\"mi\">49</span>:<span class=\"mf\">35.600595</span><span class=\"n\">Z</span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">0</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">34</span><span class=\"n\">mDEBUG</span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">0</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">2</span><span class=\"n\">mcranelift_codegen</span>::<span class=\"n\">timing</span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">0</span><span class=\"n\">m</span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">2</span><span class=\"n\">m</span>:<span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">0</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">timing</span>: <span class=\"nc\">Starting</span><span class=\"w\"> </span><span class=\"n\">Compilation</span><span class=\"w\"> </span><span class=\"n\">passes</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">during</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">no</span><span class=\"w\"> </span><span class=\"n\">pass</span><span class=\"o\">&gt;</span><span class=\"p\">)</span>\n<span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">2</span><span class=\"n\">m2023</span><span class=\"o\">-</span><span class=\"mi\">11</span><span class=\"o\">-</span><span class=\"mi\">01</span><span class=\"n\">T04</span>:<span class=\"mi\">49</span>:<span class=\"mf\">35.600669</span><span class=\"n\">Z</span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">0</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">34</span><span class=\"n\">mDEBUG</span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">0</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">2</span><span class=\"n\">mcranelift_codegen</span>::<span class=\"n\">context</span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">0</span><span class=\"n\">m</span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">2</span><span class=\"n\">m</span>:<span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">0</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">Number</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">CLIF</span><span class=\"w\"> </span><span class=\"n\">instructions</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">optimize</span>: <span class=\"mi\">12</span>\n<span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">2</span><span class=\"n\">m2023</span><span class=\"o\">-</span><span class=\"mi\">11</span><span class=\"o\">-</span><span class=\"mi\">01</span><span class=\"n\">T04</span>:<span class=\"mi\">49</span>:<span class=\"mf\">35.600694</span><span class=\"n\">Z</span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">0</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">34</span><span class=\"n\">mDEBUG</span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">0</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">2</span><span class=\"n\">mcranelift_codegen</span>::<span class=\"n\">context</span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">0</span><span class=\"n\">m</span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">2</span><span class=\"n\">m</span>:<span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">0</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">Number</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">CLIF</span><span class=\"w\"> </span><span class=\"n\">blocks</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">optimize</span>: <span class=\"mi\">1</span>\n<span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">2</span><span class=\"n\">m2023</span><span class=\"o\">-</span><span class=\"mi\">11</span><span class=\"o\">-</span><span class=\"mi\">01</span><span class=\"n\">T04</span>:<span class=\"mi\">49</span>:<span class=\"mf\">35.600716</span><span class=\"n\">Z</span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">0</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">35</span><span class=\"n\">mTRACE</span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">0</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">2</span><span class=\"n\">mcranelift_codegen</span>::<span class=\"n\">context</span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">0</span><span class=\"n\">m</span><span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">2</span><span class=\"n\">m</span>:<span class=\"o\">^</span><span class=\"p\">[[</span><span class=\"mi\">0</span><span class=\"n\">m</span><span class=\"w\"> </span><span class=\"n\">Optimizing</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">opt</span><span class=\"w\"> </span><span class=\"n\">level</span><span class=\"w\"> </span><span class=\"n\">Speed</span><span class=\"p\">)</span>:\n</code></pre></div>\n<p>The code does indeed <a href=\"https://github.com/bytecodealliance/wasmtime/blob/9b976048689cfc3aec3d12f4742364c8cb2a115c/crates/cli-flags/src/lib.rs#L368-L370\">check whether stderr is a terminal</a> before enabling ANSI sequences; but somehow this is not working right.</p>\n</blockquote>",
        "id": 399768651,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1698859767
    }
]