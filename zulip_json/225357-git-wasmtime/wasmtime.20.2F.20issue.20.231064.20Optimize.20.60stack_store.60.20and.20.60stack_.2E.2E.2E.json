[
    {
        "content": "<p>cfallin labeled <a href=\"https://github.com/bytecodealliance/wasmtime/issues/1064\">issue #1064</a>:</p>\n<blockquote>\n<p>Currently, <code>stack_store</code> and <code>stack_load</code> are legalized into <code>stack_addr</code> followed by plain <code>store</code> and <code>load</code>, producing code like this:</p>\n<div class=\"codehilite\" data-code-language=\"GAS\"><pre><span></span><code><span class=\"w\">    </span><span class=\"nf\">lea</span><span class=\"w\"> </span><span class=\"no\">rax</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"no\">qword</span><span class=\"w\"> </span><span class=\"no\">ptr</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"no\">rsp</span><span class=\"w\"> </span><span class=\"err\">+</span><span class=\"w\"> </span><span class=\"mi\">8</span><span class=\"p\">]</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"nf\">mov</span><span class=\"w\"> </span><span class=\"no\">qword</span><span class=\"w\"> </span><span class=\"no\">ptr</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"no\">rax</span><span class=\"p\">],</span><span class=\"w\"> </span><span class=\"no\">rdi</span><span class=\"w\"></span>\n</code></pre></div>\n<p>We really want to just emit this:</p>\n<div class=\"codehilite\" data-code-language=\"GAS\"><pre><span></span><code><span class=\"w\">        </span><span class=\"nf\">mov</span><span class=\"w\"> </span><span class=\"no\">qword</span><span class=\"w\"> </span><span class=\"no\">ptr</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"no\">rsp</span><span class=\"w\"> </span><span class=\"err\">+</span><span class=\"w\"> </span><span class=\"mi\">8</span><span class=\"p\">],</span><span class=\"w\"> </span><span class=\"no\">rdi</span><span class=\"w\"></span>\n</code></pre></div>\n<p>Options include:<br>\n - Add encoding rules for <code>stack_load</code> and <code>stack_store</code>, making them legal. This is straightforward, but if we later want to extend this to allow extending loads and narrowing stores, we'll need a bunch more instructions.<br>\n - Extend <code>load_complex</code>/<code>store_complex</code> to have a way represent a base pointer which is the stack pointer, and then fold <code>stack_addr</code> into <code>load</code>/<code>store</code>.<br>\n</p>\n</blockquote>",
        "id": 281216864,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1651696943
    }
]