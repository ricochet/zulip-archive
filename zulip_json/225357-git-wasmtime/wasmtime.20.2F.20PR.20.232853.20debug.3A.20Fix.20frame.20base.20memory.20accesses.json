[
    {
        "content": "<p>uweigand opened <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2853\">PR #2853</a> from <code>debug-deref</code> to <code>main</code>:</p>\n<blockquote>\n<p>When translating a WebAssembly DWARF expression into a native<br>\nDWARF expression, care needs to be taken to translate WebAssembly<br>\nmemory addresses into native memory addresses by adding the base<br>\naddress.  However, some addresses are already native addresses,<br>\nso the two cases need to be distinguished.  Existing code uses<br>\nthe \"need_deref\" flag to do so.</p>\n<p>However, this flag seems to be calculated incorrectly in some<br>\ncases involving frame base register accesses.  For example,<br>\nin the test case file tests/all/debug/testsuite/fib-wasm.wasm,<br>\nthe location of the local parameter \"n\" is described as:<br>\n  DW_OP_fbreg + 28<br>\nwhile the frame base register is described as:<br>\n  DW_OP_WASM_location 0x0 0x3, DW_OP_stack_value</p>\n<p>Now, the result of evaluating the DW_OP_WASM_location is a<br>\nnative memory address (retrieved from a native register or<br>\na native stack slot), so we must not add the memory base.<br>\nAnd indeed, when evaluating the DW_AT_frame_base attribute,<br>\nthe resulting expression does <em>not</em> have need_deref set.</p>\n<p>However, when evaluating the DW_OP_fbreg operation, the<br>\nframe base expression is copied, the offset (28) is added,<br>\nbut then also the need_deref flag is set, causing the<br>\nmemory base to be added.  This seems incorrect.  If the<br>\nframe base is already a native address, then an offset<br>\nrelative to the frame base is likewise a native address.</p>\n<p>This patch fixes the problem by respecting the need_deref<br>\nflag of DW_AT_frame_base when evaluating DW_OP_fbreg.<br>\nThis fixes the test failure I was seeing on s390x.</p>\n<p>&lt;!--</p>\n<p>Please ensure that the following steps are all taken care of before submitting<br>\nthe PR.</p>\n<ul>\n<li>\n<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>\n  here.</p>\n</li>\n<li>\n<p>[ ] A short description of what this does, why it is needed; if the<br>\n  description becomes long, the matter should probably be discussed in an issue<br>\n  first.</p>\n</li>\n<li>\n<p>[ ] This PR contains test cases, if meaningful.</p>\n</li>\n<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>\n  If you don't know who could review this, please indicate so. The list of<br>\n  suggested reviewers on the right can help you.</li>\n</ul>\n<p>Please ensure all communication adheres to the <a href=\"https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md\">code of\nconduct</a>.<br>\n--&gt;<br>\n</p>\n</blockquote>",
        "id": 235497719,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1619006641
    },
    {
        "content": "<p>uweigand closed without merge <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2853\">PR #2853</a>.</p>",
        "id": 235536723,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1619020915
    }
]