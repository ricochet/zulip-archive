[
    {
        "content": "<p>MarinPostma opened <a href=\"https://github.com/bytecodealliance/wasmtime/pull/9798\">PR #9798</a> from <code>MarinPostma:i32-div-aarch64</code> to <code>bytecodealliance:main</code>:</p>\n<blockquote>\n<p>This PR takes first steps towards completing #9766, by implementing support for 32bit unsigned division in cranelift and winch.<br>\nwe had to take the following steps to enable that:</p>\n<ul>\n<li>extend the ISLE lowering rules in cranelift to properly handle 32bits udiv, by have a rule that matches 64bit division, and another for anything else that fits 32bit. The 32 bits basically is the old 64bits rule but for 32bits.</li>\n<li>stop extending registers to 64bits in the ISLE rules.</li>\n<li>patch the emit code to emit the correct instruction for 32bits division.</li>\n<li>in winch: stop emitting extend operations for urem and udiv.</li>\n</ul>\n<p>question: we emit a <code>trapz</code> to catch overflow, but trapz currently only work with 64bits registers. We either need a new trapz instruction for 32bits, or, pass the type info to trapz during lower, for emission. This would cover the case where the lower half of the divisor is 0, but not the upper part. Although, is that even possible in practice, by code generated by cranelift?<br>\n</p>\n</blockquote>",
        "id": 488533841,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1733966636
    },
    {
        "content": "<p><strong>MarinPostma</strong> requested <a href=\"https://github.com/cfallin\">cfallin</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/9798\">PR #9798</a>.</p>",
        "id": 488533843,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1733966637
    },
    {
        "content": "<p><strong>MarinPostma</strong> requested <a href=\"https://github.com/orgs/bytecodealliance/teams/wasmtime-compiler-reviewers\">wasmtime-compiler-reviewers</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/9798\">PR #9798</a>.</p>",
        "id": 488533844,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1733966637
    },
    {
        "content": "<p><strong>MarinPostma</strong> requested <a href=\"https://github.com/alexcrichton\">alexcrichton</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/9798\">PR #9798</a>.</p>",
        "id": 488533846,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1733966639
    },
    {
        "content": "<p><strong>MarinPostma</strong> requested <a href=\"https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers\">wasmtime-core-reviewers</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/9798\">PR #9798</a>.</p>",
        "id": 488533848,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1733966640
    },
    {
        "content": "<p>MarinPostma updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/9798\">PR #9798</a>.</p>",
        "id": 488533982,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1733966728
    },
    {
        "content": "<p>MarinPostma updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/9798\">PR #9798</a>.</p>",
        "id": 488534445,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1733967063
    },
    {
        "content": "<p>github-actions[bot] <a href=\"https://github.com/bytecodealliance/wasmtime/pull/9798#issuecomment-2537693154\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/9798\">PR #9798</a>:</p>\n<blockquote>\n<h4>Subscribe to Label Action</h4>\n<p>cc @saulecabrera</p>\n<p>&lt;details&gt;<br>\nThis issue or pull request has been labeled: \"cranelift\", \"cranelift:area:aarch64\", \"winch\"</p>\n<p>Thus the following users have been cc'd because of the following labels:</p>\n<ul>\n<li>saulecabrera: winch</li>\n</ul>\n<p>To subscribe or unsubscribe from this label, edit the &lt;code&gt;.github/subscribe-to-label.json&lt;/code&gt; configuration file.</p>\n<p><a href=\"https://github.com/bytecodealliance/subscribe-to-label-action\">Learn more.</a><br>\n&lt;/details&gt;</p>\n</blockquote>",
        "id": 488542088,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1733972625
    },
    {
        "content": "<p>MarinPostma updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/9798\">PR #9798</a>.</p>",
        "id": 488655131,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1734016335
    },
    {
        "content": "<p>MarinPostma edited <a href=\"https://github.com/bytecodealliance/wasmtime/pull/9798\">PR #9798</a>:</p>\n<blockquote>\n<p>This PR takes first steps towards completing #9766, by implementing support for 32bit unsigned division in cranelift and winch.<br>\nwe had to take the following steps to enable that:</p>\n<ul>\n<li>extend the ISLE lowering rules in cranelift to properly handle 32bits udiv, by have a rule that matches 64bit division, and another for anything else that fits 32bit. The 32 bits basically is the old 64bits rule but for 32bits.</li>\n<li>stop extending registers to 64bits in the ISLE rules.</li>\n<li>patch the emit code to emit the correct instruction for 32bits division.</li>\n<li>in winch: stop emitting extend operations for urem and udiv.</li>\n<li>Make <code>trap_if</code> size aware: this avoids having to perform extensions before <code>cbz</code>, shaving more instructions.</li>\n</ul>\n</blockquote>",
        "id": 488655417,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1734016419
    },
    {
        "content": "<p>MarinPostma updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/9798\">PR #9798</a>.</p>",
        "id": 488656802,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1734016782
    },
    {
        "content": "<p>MarinPostma submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/9798#pullrequestreview-2499998776\">PR review</a>.</p>",
        "id": 488657739,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1734017013
    },
    {
        "content": "<p>MarinPostma created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/9798#discussion_r1882366911\">PR review comment</a>:</p>\n<blockquote>\n<p>I think we mostly had two choices here:</p>\n<ul>\n<li>either make the size part of the <code>CondBrKind</code>, which is tighter, but yields more changes in the code</li>\n<li>or setting the size in the op itself (current approach), which required less changes</li>\n</ul>\n</blockquote>",
        "id": 488657744,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1734017013
    },
    {
        "content": "<p>MarinPostma edited <a href=\"https://github.com/bytecodealliance/wasmtime/pull/9798\">PR #9798</a>:</p>\n<blockquote>\n<p>This PR takes first steps towards completing #9766, by implementing support for 32bit unsigned division in cranelift and winch.<br>\nwe had to take the following steps to enable that:</p>\n<ul>\n<li>extend the ISLE lowering rules in cranelift to properly handle 32bits udiv, by have a rule that matches 64bit division, and another for anything else that fits 32bit. The 32 bits basically is the old 64bits rule but for 32bits.</li>\n<li>stop extending registers to 64bits in the ISLE rules.</li>\n<li>patch the emit code to emit the correct instruction for 32bits division.</li>\n<li>in winch: stop emitting extend operations for urem and udiv.</li>\n<li>Make <code>trap_if</code> size aware: this avoids having to perform extensions before <code>cbz</code>, shaving more instructions. This is reflected in the lowering rules for checking division by zero for udiv.</li>\n</ul>\n</blockquote>",
        "id": 488658105,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1734017107
    },
    {
        "content": "<p><strong>MarinPostma</strong> has marked <a href=\"https://github.com/bytecodealliance/wasmtime/pull/9798\">PR #9798</a> as ready for review.</p>",
        "id": 488658120,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1734017110
    },
    {
        "content": "<p>MarinPostma updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/9798\">PR #9798</a>.</p>",
        "id": 488659008,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1734017308
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/9798#pullrequestreview-2503375421\">PR review</a>:</p>\n<blockquote>\n<p>Thanks! One thought below on the way that <code>TrapIf</code> is extended, but generally I like how this is turning out.</p>\n</blockquote>",
        "id": 488936842,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1734132078
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/9798#discussion_r1884637582\">PR review comment</a>:</p>\n<blockquote>\n<p><code>todo!()</code> here -- can we just show the reg (and below for vector too) with <code>show_reg</code> for now?</p>\n</blockquote>",
        "id": 488936843,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1734132078
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/9798#discussion_r1884642108\">PR review comment</a>:</p>\n<blockquote>\n<p>Also, separately, if we modify <code>CondBrKind</code>, this is toward the direction that we want for supporting 32-bit zero/nonzero tests in regular conditional branches too. We don't have to implement that now (you can <code>unimplemented!()</code> it in the <code>CondBr</code> case; but if you wanted to, it would certainly be fine with me) but it's nice to lay the groundwork.</p>\n</blockquote>",
        "id": 488936844,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1734132078
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/9798#discussion_r1884636262\">PR review comment</a>:</p>\n<blockquote>\n<p>I think I might prefer the first option actually -- I was a bit confused at first how the <code>OperandSize</code> would affect the <code>TrapIf</code> if we're just talking about conditional branch kinds like <code>b.lo</code>, <code>b.hi</code>, etc; until I realized that <code>CondBrKind::Zero(reg)</code> and <code>NonZero(reg)</code> exist and encode <code>cbz</code>/<code>cbnz</code>. If you don't mind, do you think you could try the refactor out? On the upside, it seems like it should get rid of a bunch of extraneous <code>OperandSize</code>s on branches emitted in various places that are condcode-based (e.g. in <code>abi.rs</code> above and in many of the emit-tests below).</p>\n</blockquote>",
        "id": 488936846,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1734132078
    },
    {
        "content": "<p>MarinPostma <a href=\"https://github.com/bytecodealliance/wasmtime/pull/9798#issuecomment-2542546333\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/9798\">PR #9798</a>:</p>\n<blockquote>\n<p>Thanks @cfallin, will do the refactor <span aria-label=\"+1\" class=\"emoji emoji-1f44d\" role=\"img\" title=\"+1\">:+1:</span> </p>\n</blockquote>",
        "id": 488937785,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1734132699
    },
    {
        "content": "<p>MarinPostma submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/9798#pullrequestreview-2503390109\">PR review</a>.</p>",
        "id": 488937902,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1734132769
    },
    {
        "content": "<p>MarinPostma created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/9798#discussion_r1884649128\">PR review comment</a>:</p>\n<blockquote>\n<p>This make sense to me, I'll refactor</p>\n</blockquote>",
        "id": 488937903,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1734132769
    },
    {
        "content": "<p>MarinPostma updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/9798\">PR #9798</a>.</p>",
        "id": 489068195,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1734253979
    },
    {
        "content": "<p>MarinPostma updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/9798\">PR #9798</a>.</p>",
        "id": 489068784,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1734254585
    },
    {
        "content": "<p>github-actions[bot] <a href=\"https://github.com/bytecodealliance/wasmtime/pull/9798#issuecomment-2543806946\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/9798\">PR #9798</a>:</p>\n<blockquote>\n<h4>Subscribe to Label Action</h4>\n<p>cc @cfallin, @fitzgen</p>\n<p>&lt;details&gt;<br>\nThis issue or pull request has been labeled: \"cranelift:area:machinst\", \"isle\"</p>\n<p>Thus the following users have been cc'd because of the following labels:</p>\n<ul>\n<li>cfallin: isle</li>\n<li>fitzgen: isle</li>\n</ul>\n<p>To subscribe or unsubscribe from this label, edit the &lt;code&gt;.github/subscribe-to-label.json&lt;/code&gt; configuration file.</p>\n<p><a href=\"https://github.com/bytecodealliance/subscribe-to-label-action\">Learn more.</a><br>\n&lt;/details&gt;</p>\n</blockquote>",
        "id": 489073547,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1734259559
    },
    {
        "content": "<p><strong>MarinPostma</strong> requested <a href=\"https://github.com/cfallin\">cfallin</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/9798\">PR #9798</a>.</p>",
        "id": 489532660,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1734455074
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/9798#pullrequestreview-2509795059\">PR review</a>:</p>\n<blockquote>\n<p>Looks great; thanks a bunch!</p>\n</blockquote>",
        "id": 489550884,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1734461243
    },
    {
        "content": "<p>cfallin merged <a href=\"https://github.com/bytecodealliance/wasmtime/pull/9798\">PR #9798</a>.</p>",
        "id": 489554246,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1734462495
    }
]