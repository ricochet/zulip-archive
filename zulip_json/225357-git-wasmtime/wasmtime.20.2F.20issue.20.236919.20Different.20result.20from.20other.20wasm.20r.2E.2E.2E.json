[
    {
        "content": "<p>luxinyi0105 opened <a href=\"https://github.com/bytecodealliance/wasmtime/issues/6919\">issue #6919</a>:</p>\n<blockquote>\n<h3>Test Case</h3>\n<p><a href=\"https://github.com/luxinyi0105/wasm_runtime_test/raw/main/08-27.zip\">The given testcase</a> was simply mutated a wasm file, which was obtained by compiling C program generated with <code>Csmith</code> using <code>Emscripten Compiler</code>(Emcc). </p>\n<p>The original C program is <code>c_file.c</code>, the compilation results with Emscripten is <code>wasm_file.wasm</code>, and its wat format is <code>wat_file.wat</code>. </p>\n<p>We mutated the wat file to change its <code>global.set 0</code> in line 7627 with <code>local.set 0</code>. The result after mutation is <code>mutated_file.wat</code>, and its wasm format is <code>mutated_file.wasm</code>.</p>\n<h3>Expected Results</h3>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>$<span class=\"w\"> </span>wasmtime<span class=\"w\"> </span>mutated_file.wasm\n<span class=\"nv\">checksum</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span>61D81D2D\n</code></pre></div>\n<h3>Actual Results</h3>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>$<span class=\"w\"> </span>wasmedge<span class=\"w\"> </span>mutated_file.wasm\n<span class=\"nv\">checksum</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span>61D81D2D\nError:<span class=\"w\"> </span>failed<span class=\"w\"> </span>to<span class=\"w\"> </span>run<span class=\"w\"> </span>main<span class=\"w\"> </span>module<span class=\"w\"> </span><span class=\"sb\">`</span>mutated_file.wasm<span class=\"sb\">`</span>\n\nCaused<span class=\"w\"> </span>by:\n<span class=\"w\">    </span><span class=\"m\">0</span>:<span class=\"w\"> </span>failed<span class=\"w\"> </span>to<span class=\"w\"> </span>invoke<span class=\"w\"> </span><span class=\"nb\">command</span><span class=\"w\"> </span>default\n<span class=\"w\">    </span><span class=\"m\">1</span>:<span class=\"w\"> </span>error<span class=\"w\"> </span><span class=\"k\">while</span><span class=\"w\"> </span>executing<span class=\"w\"> </span>at<span class=\"w\"> </span>wasm<span class=\"w\"> </span>backtrace:\n<span class=\"w\">           </span><span class=\"m\">0</span>:<span class=\"w\"> </span>0x53b2<span class=\"w\"> </span>-<span class=\"w\"> </span>&lt;unknown&gt;!&lt;wasm<span class=\"w\"> </span><span class=\"k\">function</span><span class=\"w\"> </span><span class=\"m\">22</span>&gt;\n<span class=\"w\">           </span><span class=\"m\">1</span>:<span class=\"w\"> </span>0x53aa<span class=\"w\"> </span>-<span class=\"w\"> </span>&lt;unknown&gt;!&lt;wasm<span class=\"w\"> </span><span class=\"k\">function</span><span class=\"w\"> </span><span class=\"m\">21</span>&gt;\n<span class=\"w\">           </span><span class=\"m\">2</span>:<span class=\"w\"> </span>0x50e3<span class=\"w\"> </span>-<span class=\"w\"> </span>&lt;unknown&gt;!&lt;wasm<span class=\"w\"> </span><span class=\"k\">function</span><span class=\"w\"> </span><span class=\"m\">16</span>&gt;\n<span class=\"w\">    </span><span class=\"m\">2</span>:<span class=\"w\"> </span><span class=\"nb\">exit</span><span class=\"w\"> </span>with<span class=\"w\"> </span>invalid<span class=\"w\"> </span><span class=\"nb\">exit</span><span class=\"w\"> </span>status<span class=\"w\"> </span>outside<span class=\"w\"> </span>of<span class=\"w\"> </span><span class=\"o\">[</span><span class=\"m\">0</span>..126<span class=\"o\">)</span>\n</code></pre></div>\n<h3>Versions and Environment</h3>\n<p>Wasmtime version or commit: wasmtime-cli 13.0.0<br>\nOperating system: Ubuntu 22.04.1<br>\nArchitecture: x86_64</p>\n<h3>Extra Info</h3>\n<p>I tried to use some other wasm runtimes, such as wasmer and wasmedge to execute the same testcase, they just output the checksum result and do not trigger errors. </p>\n<p>It seems that there is something wrong with the “exception handling module”, but I am not sure if the problem lies in wasmtime or other runtime tools due to a lack of understanding of WebAssembly. So the details still need you to confirm. Thanks a lot!</p>\n</blockquote>",
        "id": 387672639,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1693230541
    },
    {
        "content": "<p><a href=\"https://github.com/luxinyi0105\">luxinyi0105</a> added the bug label to <a href=\"https://github.com/bytecodealliance/wasmtime/issues/6919\">Issue #6919</a>.</p>",
        "id": 387672640,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1693230541
    },
    {
        "content": "<p>luxinyi0105 edited <a href=\"https://github.com/bytecodealliance/wasmtime/issues/6919\">issue #6919</a>:</p>\n<blockquote>\n<h3>Test Case</h3>\n<p><a href=\"https://github.com/luxinyi0105/wasm_runtime_test/raw/main/08-27.zip\">The given testcase</a> was simply mutated a wasm file, which was obtained by compiling C program generated with <code>Csmith</code> using <code>Emscripten Compiler</code>(Emcc). </p>\n<p>The original C program is <code>c_file.c</code>, the compilation results with Emscripten is <code>wasm_file.wasm</code>, and its wat format is <code>wat_file.wat</code>. </p>\n<p>We mutated the wat file to change its <code>global.set 0</code> in line 7627 with <code>local.set 0</code>. The result after mutation is <code>mutated_file.wat</code>, and its wasm format is <code>mutated_file.wasm</code>.</p>\n<h3>Expected Results</h3>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>$<span class=\"w\"> </span>wasmtime<span class=\"w\"> </span>mutated_file.wasm\n<span class=\"nv\">checksum</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span>61D81D2D\n</code></pre></div>\n<h3>Actual Results</h3>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>$<span class=\"w\"> </span>wasmedge<span class=\"w\"> </span>mutated_file.wasm\n<span class=\"nv\">checksum</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span>61D81D2D\nError:<span class=\"w\"> </span>failed<span class=\"w\"> </span>to<span class=\"w\"> </span>run<span class=\"w\"> </span>main<span class=\"w\"> </span>module<span class=\"w\"> </span><span class=\"sb\">`</span>mutated_file.wasm<span class=\"sb\">`</span>\n\nCaused<span class=\"w\"> </span>by:\n<span class=\"w\">    </span><span class=\"m\">0</span>:<span class=\"w\"> </span>failed<span class=\"w\"> </span>to<span class=\"w\"> </span>invoke<span class=\"w\"> </span><span class=\"nb\">command</span><span class=\"w\"> </span>default\n<span class=\"w\">    </span><span class=\"m\">1</span>:<span class=\"w\"> </span>error<span class=\"w\"> </span><span class=\"k\">while</span><span class=\"w\"> </span>executing<span class=\"w\"> </span>at<span class=\"w\"> </span>wasm<span class=\"w\"> </span>backtrace:\n<span class=\"w\">           </span><span class=\"m\">0</span>:<span class=\"w\"> </span>0x53b2<span class=\"w\"> </span>-<span class=\"w\"> </span>&lt;unknown&gt;!&lt;wasm<span class=\"w\"> </span><span class=\"k\">function</span><span class=\"w\"> </span><span class=\"m\">22</span>&gt;\n<span class=\"w\">           </span><span class=\"m\">1</span>:<span class=\"w\"> </span>0x53aa<span class=\"w\"> </span>-<span class=\"w\"> </span>&lt;unknown&gt;!&lt;wasm<span class=\"w\"> </span><span class=\"k\">function</span><span class=\"w\"> </span><span class=\"m\">21</span>&gt;\n<span class=\"w\">           </span><span class=\"m\">2</span>:<span class=\"w\"> </span>0x50e3<span class=\"w\"> </span>-<span class=\"w\"> </span>&lt;unknown&gt;!&lt;wasm<span class=\"w\"> </span><span class=\"k\">function</span><span class=\"w\"> </span><span class=\"m\">16</span>&gt;\n<span class=\"w\">    </span><span class=\"m\">2</span>:<span class=\"w\"> </span><span class=\"nb\">exit</span><span class=\"w\"> </span>with<span class=\"w\"> </span>invalid<span class=\"w\"> </span><span class=\"nb\">exit</span><span class=\"w\"> </span>status<span class=\"w\"> </span>outside<span class=\"w\"> </span>of<span class=\"w\"> </span><span class=\"o\">[</span><span class=\"m\">0</span>..126<span class=\"o\">)</span>\n</code></pre></div>\n<h3>Versions and Environment</h3>\n<p>Wasmtime version or commit: wasmtime-cli 13.0.0<br>\nOperating system: Ubuntu 22.04.1<br>\nArchitecture: x86_64</p>\n<h3>Extra Info</h3>\n<p>I tried to use some other wasm runtimes, such as wasmer, wasmedge and wasm-micro-runtime(WAMR) to execute the same testcase, they just output the checksum result and do not trigger errors. </p>\n<p>It seems that there is something wrong with the “exception handling module”, but I am not sure if the problem lies in wasmtime or other runtime tools due to a lack of understanding of WebAssembly. So the details still need you to confirm. Thanks a lot!</p>\n</blockquote>",
        "id": 387673065,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1693230665
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/6919#issuecomment-1695816895\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/6919\">issue #6919</a>:</p>\n<blockquote>\n<p>Thanks for the report, but I don't think there's a problem here on our side. The mutated instruction is changing the return value of the function to something totally different, and this function is the <code>main</code> function. This means that <code>main</code>'s return value, which was previously 0, is now something totally different. That gets threaded through to <code>proc_exit</code> which has the requirement that the exit status is in the printed range, which presumably the provided status isn't.</p>\n<p>My guess is that other runtimes are not validating the exit status at all. Wasmtime does that for portability and platform compatibility and other runtimes may eschew this. The <a href=\"https://github.com/WebAssembly/WASI/blob/4712d490fd7662f689af6faa5d718e042f014931/legacy/preview1/witx/wasi_snapshot_preview1.witx#L460-L467\">current documentation for <code>proc_exit</code></a> does not exactly specify what to do here. I can't currently easily find the PR that introduced that condition, but I believe it's been around for awhile in Wasmtime.</p>\n<p>If you're curious to push on this further I'd recommend opening an issue with WASI to clarify whether this behavior is still desired and/or should be codified in the documentation. If not we should remove it in Wasmtime. If so other runtimes should be updated.</p>\n</blockquote>",
        "id": 387682513,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1693233428
    },
    {
        "content": "<p>alexcrichton closed <a href=\"https://github.com/bytecodealliance/wasmtime/issues/6919\">issue #6919</a>:</p>\n<blockquote>\n<h3>Test Case</h3>\n<p><a href=\"https://github.com/luxinyi0105/wasm_runtime_test/raw/main/08-27.zip\">The given testcase</a> was simply mutated a wasm file, which was obtained by compiling C program generated with <code>Csmith</code> using <code>Emscripten Compiler</code>(Emcc). </p>\n<p>The original C program is <code>c_file.c</code>, the compilation results with Emscripten is <code>wasm_file.wasm</code>, and its wat format is <code>wat_file.wat</code>. </p>\n<p>We mutated the wat file to change its <code>global.set 0</code> in line 7627 with <code>local.set 0</code>. The result after mutation is <code>mutated_file.wat</code>, and its wasm format is <code>mutated_file.wasm</code>.</p>\n<h3>Expected Results</h3>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>$<span class=\"w\"> </span>wasmtime<span class=\"w\"> </span>mutated_file.wasm\n<span class=\"nv\">checksum</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span>61D81D2D\n</code></pre></div>\n<h3>Actual Results</h3>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>$<span class=\"w\"> </span>wasmedge<span class=\"w\"> </span>mutated_file.wasm\n<span class=\"nv\">checksum</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span>61D81D2D\nError:<span class=\"w\"> </span>failed<span class=\"w\"> </span>to<span class=\"w\"> </span>run<span class=\"w\"> </span>main<span class=\"w\"> </span>module<span class=\"w\"> </span><span class=\"sb\">`</span>mutated_file.wasm<span class=\"sb\">`</span>\n\nCaused<span class=\"w\"> </span>by:\n<span class=\"w\">    </span><span class=\"m\">0</span>:<span class=\"w\"> </span>failed<span class=\"w\"> </span>to<span class=\"w\"> </span>invoke<span class=\"w\"> </span><span class=\"nb\">command</span><span class=\"w\"> </span>default\n<span class=\"w\">    </span><span class=\"m\">1</span>:<span class=\"w\"> </span>error<span class=\"w\"> </span><span class=\"k\">while</span><span class=\"w\"> </span>executing<span class=\"w\"> </span>at<span class=\"w\"> </span>wasm<span class=\"w\"> </span>backtrace:\n<span class=\"w\">           </span><span class=\"m\">0</span>:<span class=\"w\"> </span>0x53b2<span class=\"w\"> </span>-<span class=\"w\"> </span>&lt;unknown&gt;!&lt;wasm<span class=\"w\"> </span><span class=\"k\">function</span><span class=\"w\"> </span><span class=\"m\">22</span>&gt;\n<span class=\"w\">           </span><span class=\"m\">1</span>:<span class=\"w\"> </span>0x53aa<span class=\"w\"> </span>-<span class=\"w\"> </span>&lt;unknown&gt;!&lt;wasm<span class=\"w\"> </span><span class=\"k\">function</span><span class=\"w\"> </span><span class=\"m\">21</span>&gt;\n<span class=\"w\">           </span><span class=\"m\">2</span>:<span class=\"w\"> </span>0x50e3<span class=\"w\"> </span>-<span class=\"w\"> </span>&lt;unknown&gt;!&lt;wasm<span class=\"w\"> </span><span class=\"k\">function</span><span class=\"w\"> </span><span class=\"m\">16</span>&gt;\n<span class=\"w\">    </span><span class=\"m\">2</span>:<span class=\"w\"> </span><span class=\"nb\">exit</span><span class=\"w\"> </span>with<span class=\"w\"> </span>invalid<span class=\"w\"> </span><span class=\"nb\">exit</span><span class=\"w\"> </span>status<span class=\"w\"> </span>outside<span class=\"w\"> </span>of<span class=\"w\"> </span><span class=\"o\">[</span><span class=\"m\">0</span>..126<span class=\"o\">)</span>\n</code></pre></div>\n<h3>Versions and Environment</h3>\n<p>Wasmtime version or commit: wasmtime-cli 13.0.0<br>\nOperating system: Ubuntu 22.04.1<br>\nArchitecture: x86_64</p>\n<h3>Extra Info</h3>\n<p>I tried to use some other wasm runtimes, such as wasmer, wasmedge and wasm-micro-runtime(WAMR) to execute the same testcase, they just output the checksum result and do not trigger errors. </p>\n<p>It seems that there is something wrong with the “exception handling module”, but I am not sure if the problem lies in wasmtime or other runtime tools due to a lack of understanding of WebAssembly. So the details still need you to confirm. Thanks a lot!</p>\n</blockquote>",
        "id": 387682514,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1693233428
    }
]