[
    {
        "content": "<p>cfallin opened <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3616\">PR #3616</a> from <code>check-isle-feature</code> to <code>main</code>:</p>\n<blockquote>\n<p>Some use-cases are very sensitive to the number of crates pulled in,<br>\nboth for audit-related reasons and for build-time reasons.</p>\n<p>Our manifest-based ISLE-up-to-date approach in #3534 was meant to help<br>\nwith this while still avoiding the footgun of a completely opt-in source<br>\nrebuild: by including generated source in the checked-in tree, and just<br>\nchecking that source is up to date, we allow for fast builds without the<br>\nwhole ISLE compiler meta-step, but still catch attempted use of stale<br>\ngenerated source (and allow the developer to opt-in to regenerating the<br>\nin-tree source).</p>\n<p>Unfortunately this still requires the hash algorithm itself (<code>sha2</code>)<br>\nwhich turns out to pull in a number of other small crates. In cases<br>\nwhere we know the source won't be stale -- for example, depending on the<br>\n<code>main</code> branch in git, or a published crate version of<br>\n<code>cranelift-codegen</code> -- the checks are actually not needed at all.</p>\n<p>This PR thus introduces a feature <code>check-isle</code> that controls whether<br>\n<code>build.rs</code> does the checks. It is on by default, so developer safety<br>\nremains: if someone checks out the source, modifies some ISLE, and then<br>\ndoes a <code>cargo build</code>, they will get an error that helps them with the<br>\nproper steps to regenerate the source. But, dependencies that know what<br>\nthey are doing can turn it off with <code>default-features = false</code>.</p>\n<p>I've verified that we have the expected small dependency tree now:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">cargo</span><span class=\"w\"> </span><span class=\"n\">tree</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">depth</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">cranelift</span><span class=\"o\">-</span><span class=\"n\">codegen</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">no</span><span class=\"o\">-</span><span class=\"n\">default</span><span class=\"o\">-</span><span class=\"n\">features</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">features</span><span class=\"w\"> </span><span class=\"s\">\"std unwind all-arch\"</span><span class=\"w\"></span>\n<span class=\"n\">cranelift</span><span class=\"o\">-</span><span class=\"n\">codegen</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"p\">.</span><span class=\"mf\">79.0</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">cfallin</span><span class=\"o\">/</span><span class=\"n\">work</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">/</span><span class=\"n\">cranelift</span><span class=\"o\">/</span><span class=\"n\">codegen</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"err\">├──</span><span class=\"w\"> </span><span class=\"n\">cranelift</span><span class=\"o\">-</span><span class=\"n\">bforest</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"p\">.</span><span class=\"mf\">79.0</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">cfallin</span><span class=\"o\">/</span><span class=\"n\">work</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">/</span><span class=\"n\">cranelift</span><span class=\"o\">/</span><span class=\"n\">bforest</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"err\">├──</span><span class=\"w\"> </span><span class=\"n\">cranelift</span><span class=\"o\">-</span><span class=\"n\">codegen</span><span class=\"o\">-</span><span class=\"n\">shared</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"p\">.</span><span class=\"mf\">79.0</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">cfallin</span><span class=\"o\">/</span><span class=\"n\">work</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">/</span><span class=\"n\">cranelift</span><span class=\"o\">/</span><span class=\"n\">codegen</span><span class=\"o\">/</span><span class=\"n\">shared</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"err\">├──</span><span class=\"w\"> </span><span class=\"n\">cranelift</span><span class=\"o\">-</span><span class=\"n\">entity</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"p\">.</span><span class=\"mf\">79.0</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">cfallin</span><span class=\"o\">/</span><span class=\"n\">work</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">/</span><span class=\"n\">cranelift</span><span class=\"o\">/</span><span class=\"n\">entity</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"err\">├──</span><span class=\"w\"> </span><span class=\"n\">gimli</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"p\">.</span><span class=\"mf\">26.1</span><span class=\"w\"></span>\n<span class=\"err\">├──</span><span class=\"w\"> </span><span class=\"n\">log</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"p\">.</span><span class=\"mf\">4.14</span><span class=\"w\"></span>\n<span class=\"err\">├──</span><span class=\"w\"> </span><span class=\"n\">regalloc</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"p\">.</span><span class=\"mf\">0.33</span><span class=\"w\"></span>\n<span class=\"err\">├──</span><span class=\"w\"> </span><span class=\"n\">smallvec</span><span class=\"w\"> </span><span class=\"n\">v1</span><span class=\"p\">.</span><span class=\"mf\">6.1</span><span class=\"w\"></span>\n<span class=\"err\">└──</span><span class=\"w\"> </span><span class=\"n\">target</span><span class=\"o\">-</span><span class=\"n\">lexicon</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"p\">.</span><span class=\"mf\">12.0</span><span class=\"w\"></span>\n<span class=\"p\">[</span><span class=\"n\">build</span><span class=\"o\">-</span><span class=\"n\">dependencies</span><span class=\"p\">]</span><span class=\"w\"></span>\n<span class=\"err\">├──</span><span class=\"w\"> </span><span class=\"n\">cranelift</span><span class=\"o\">-</span><span class=\"n\">codegen</span><span class=\"o\">-</span><span class=\"n\">meta</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"p\">.</span><span class=\"mf\">79.0</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">cfallin</span><span class=\"o\">/</span><span class=\"n\">work</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">/</span><span class=\"n\">cranelift</span><span class=\"o\">/</span><span class=\"n\">codegen</span><span class=\"o\">/</span><span class=\"n\">meta</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"err\">└──</span><span class=\"w\"> </span><span class=\"n\">sha2</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"p\">.</span><span class=\"mf\">9.8</span><span class=\"w\"></span>\n<span class=\"p\">[</span><span class=\"n\">dev</span><span class=\"o\">-</span><span class=\"n\">dependencies</span><span class=\"p\">]</span><span class=\"w\"></span>\n<span class=\"err\">└──</span><span class=\"w\"> </span><span class=\"n\">criterion</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"p\">.</span><span class=\"mf\">3.5</span><span class=\"w\"></span>\n</code></pre></div>\n<p>Fixes #3609.</p>\n<p>The diff looks wonky here but all I did was put the ISLE-related<br>\nlogic inside a <code>mod isle { ... }</code> with a conditional-on-feature directive<br>\nand then alter the toplevel a bit.</p>\n<p>&lt;!--</p>\n<p>Please ensure that the following steps are all taken care of before submitting<br>\nthe PR.</p>\n<ul>\n<li>\n<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>\n  here.</p>\n</li>\n<li>\n<p>[ ] A short description of what this does, why it is needed; if the<br>\n  description becomes long, the matter should probably be discussed in an issue<br>\n  first.</p>\n</li>\n<li>\n<p>[ ] This PR contains test cases, if meaningful.</p>\n</li>\n<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>\n  If you don't know who could review this, please indicate so. The list of<br>\n  suggested reviewers on the right can help you.</li>\n</ul>\n<p>Please ensure all communication adheres to the <a href=\"https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md\">code of\nconduct</a>.<br>\n--&gt;<br>\n</p>\n</blockquote>",
        "id": 265344957,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1639768189
    },
    {
        "content": "<p><strong>cfallin</strong> requested <a href=\"https://github.com/alexcrichton\">alexcrichton</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3616\">PR #3616</a>.</p>",
        "id": 265344958,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1639768189
    },
    {
        "content": "<p>cfallin updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3616\">PR #3616</a> from <code>check-isle-feature</code> to <code>main</code>.</p>",
        "id": 265345786,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1639768586
    },
    {
        "content": "<p>cfallin edited <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3616\">PR #3616</a> from <code>check-isle-feature</code> to <code>main</code>:</p>\n<blockquote>\n<p>Some use-cases are very sensitive to the number of crates pulled in,<br>\nboth for audit-related reasons and for build-time reasons.</p>\n<p>Our manifest-based ISLE-up-to-date approach in #3534 was meant to help<br>\nwith this while still avoiding the footgun of a completely opt-in source<br>\nrebuild: by including generated source in the checked-in tree, and just<br>\nchecking that source is up to date, we allow for fast builds without the<br>\nwhole ISLE compiler meta-step, but still catch attempted use of stale<br>\ngenerated source (and allow the developer to opt-in to regenerating the<br>\nin-tree source).</p>\n<p>Unfortunately this still requires the hash algorithm itself (<code>sha2</code>)<br>\nwhich turns out to pull in a number of other small crates. In cases<br>\nwhere we know the source won't be stale -- for example, depending on the<br>\n<code>main</code> branch in git, or a published crate version of<br>\n<code>cranelift-codegen</code> -- the checks are actually not needed at all.</p>\n<p>This PR thus introduces a feature <code>check-isle</code> that controls whether<br>\n<code>build.rs</code> does the checks. It is on by default, so developer safety<br>\nremains: if someone checks out the source, modifies some ISLE, and then<br>\ndoes a <code>cargo build</code>, they will get an error that helps them with the<br>\nproper steps to regenerate the source. But, dependencies that know what<br>\nthey are doing can turn it off with <code>default-features = false</code>.</p>\n<p>I've verified that we have the expected small dependency tree now:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">cargo</span><span class=\"w\"> </span><span class=\"n\">tree</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">depth</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">cranelift</span><span class=\"o\">-</span><span class=\"n\">codegen</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">no</span><span class=\"o\">-</span><span class=\"n\">default</span><span class=\"o\">-</span><span class=\"n\">features</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">features</span><span class=\"w\"> </span><span class=\"s\">\"std unwind all-arch\"</span><span class=\"w\"></span>\n<span class=\"n\">cranelift</span><span class=\"o\">-</span><span class=\"n\">codegen</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"p\">.</span><span class=\"mf\">79.0</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">cfallin</span><span class=\"o\">/</span><span class=\"n\">work</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">/</span><span class=\"n\">cranelift</span><span class=\"o\">/</span><span class=\"n\">codegen</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"err\">├──</span><span class=\"w\"> </span><span class=\"n\">cranelift</span><span class=\"o\">-</span><span class=\"n\">bforest</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"p\">.</span><span class=\"mf\">79.0</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">cfallin</span><span class=\"o\">/</span><span class=\"n\">work</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">/</span><span class=\"n\">cranelift</span><span class=\"o\">/</span><span class=\"n\">bforest</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"err\">├──</span><span class=\"w\"> </span><span class=\"n\">cranelift</span><span class=\"o\">-</span><span class=\"n\">codegen</span><span class=\"o\">-</span><span class=\"n\">shared</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"p\">.</span><span class=\"mf\">79.0</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">cfallin</span><span class=\"o\">/</span><span class=\"n\">work</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">/</span><span class=\"n\">cranelift</span><span class=\"o\">/</span><span class=\"n\">codegen</span><span class=\"o\">/</span><span class=\"n\">shared</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"err\">├──</span><span class=\"w\"> </span><span class=\"n\">cranelift</span><span class=\"o\">-</span><span class=\"n\">entity</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"p\">.</span><span class=\"mf\">79.0</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">cfallin</span><span class=\"o\">/</span><span class=\"n\">work</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">/</span><span class=\"n\">cranelift</span><span class=\"o\">/</span><span class=\"n\">entity</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"err\">├──</span><span class=\"w\"> </span><span class=\"n\">gimli</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"p\">.</span><span class=\"mf\">26.1</span><span class=\"w\"></span>\n<span class=\"err\">├──</span><span class=\"w\"> </span><span class=\"n\">log</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"p\">.</span><span class=\"mf\">4.14</span><span class=\"w\"></span>\n<span class=\"err\">├──</span><span class=\"w\"> </span><span class=\"n\">regalloc</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"p\">.</span><span class=\"mf\">0.33</span><span class=\"w\"></span>\n<span class=\"err\">├──</span><span class=\"w\"> </span><span class=\"n\">smallvec</span><span class=\"w\"> </span><span class=\"n\">v1</span><span class=\"p\">.</span><span class=\"mf\">6.1</span><span class=\"w\"></span>\n<span class=\"err\">└──</span><span class=\"w\"> </span><span class=\"n\">target</span><span class=\"o\">-</span><span class=\"n\">lexicon</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"p\">.</span><span class=\"mf\">12.0</span><span class=\"w\"></span>\n<span class=\"p\">[</span><span class=\"n\">build</span><span class=\"o\">-</span><span class=\"n\">dependencies</span><span class=\"p\">]</span><span class=\"w\"></span>\n<span class=\"err\">└──</span><span class=\"w\"> </span><span class=\"n\">cranelift</span><span class=\"o\">-</span><span class=\"n\">codegen</span><span class=\"o\">-</span><span class=\"n\">meta</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"p\">.</span><span class=\"mf\">79.0</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">cfallin</span><span class=\"o\">/</span><span class=\"n\">work</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"o\">/</span><span class=\"n\">cranelift</span><span class=\"o\">/</span><span class=\"n\">codegen</span><span class=\"o\">/</span><span class=\"n\">meta</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"p\">[</span><span class=\"n\">dev</span><span class=\"o\">-</span><span class=\"n\">dependencies</span><span class=\"p\">]</span><span class=\"w\"></span>\n<span class=\"err\">└──</span><span class=\"w\"> </span><span class=\"n\">criterion</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"p\">.</span><span class=\"mf\">3.5</span><span class=\"w\"></span>\n</code></pre></div>\n<p>Fixes #3609.</p>\n<p>The diff looks wonky here but all I did was put the ISLE-related<br>\nlogic inside a <code>mod isle { ... }</code> with a conditional-on-feature directive<br>\nand then alter the toplevel a bit.</p>\n<p>&lt;!--</p>\n<p>Please ensure that the following steps are all taken care of before submitting<br>\nthe PR.</p>\n<ul>\n<li>\n<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>\n  here.</p>\n</li>\n<li>\n<p>[ ] A short description of what this does, why it is needed; if the<br>\n  description becomes long, the matter should probably be discussed in an issue<br>\n  first.</p>\n</li>\n<li>\n<p>[ ] This PR contains test cases, if meaningful.</p>\n</li>\n<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>\n  If you don't know who could review this, please indicate so. The list of<br>\n  suggested reviewers on the right can help you.</li>\n</ul>\n<p>Please ensure all communication adheres to the <a href=\"https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md\">code of\nconduct</a>.<br>\n--&gt;<br>\n</p>\n</blockquote>",
        "id": 265345875,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1639768630
    },
    {
        "content": "<p>cfallin closed without merge <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3616\">PR #3616</a>.</p>",
        "id": 265353301,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1639771376
    }
]