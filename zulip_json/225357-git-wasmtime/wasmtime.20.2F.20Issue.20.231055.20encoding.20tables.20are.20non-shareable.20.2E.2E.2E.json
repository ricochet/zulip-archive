[
    {
        "content": "<p>bjorn3 <a href=\"https://github.com/bytecodealliance/wasmtime/issues/1055#issuecomment-772665884\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/1055\">Issue #1055</a>:</p>\n<blockquote>\n<p>The new backend framework uses a completely different architecture that doesn't include encoding tables.</p>\n</blockquote>",
        "id": 225045856,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1612371809
    },
    {
        "content": "<p>cfallin closed <a href=\"https://github.com/bytecodealliance/wasmtime/issues/1055\">Issue #1055</a>:</p>\n<blockquote>\n<p>Looking at a recent-ish Firefox nightly, I see the following:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"err\">#</span><span class=\"w\"> </span><span class=\"n\">Look</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">x86</span><span class=\"w\"> </span><span class=\"n\">cranelift</span><span class=\"w\"> </span><span class=\"n\">symbols</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">sorted</span><span class=\"w\"> </span><span class=\"n\">by</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">descending</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">size</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"n\">data</span><span class=\"p\">.</span><span class=\"n\">rel</span><span class=\"p\">.</span><span class=\"n\">ro</span><span class=\"w\"> </span><span class=\"n\">section</span><span class=\"p\">.</span><span class=\"w\"></span>\n<span class=\"n\">froydnj</span><span class=\"o\">@</span><span class=\"n\">hawkeye</span>:<span class=\"o\">~</span><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">readelf</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">sW</span><span class=\"w\"> </span><span class=\"n\">firefox</span><span class=\"o\">/</span><span class=\"n\">libxul</span><span class=\"p\">.</span><span class=\"n\">so</span><span class=\"o\">|</span><span class=\"n\">grep</span><span class=\"w\"> </span><span class=\"n\">cranelift</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"n\">sort</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">k</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">g</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"n\">awk</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"cp\">$</span><span class=\"mi\">7</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"mi\">27</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">print</span><span class=\"w\"> </span><span class=\"p\">}</span><span class=\"o\">'</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"n\">grep</span><span class=\"w\"> </span><span class=\"n\">OBJECT</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"n\">grep</span><span class=\"w\"> </span><span class=\"n\">x86</span><span class=\"w\"></span>\n<span class=\"mi\">123872</span>: <span class=\"mi\">0000000007342048</span><span class=\"w\">  </span><span class=\"mi\">9480</span><span class=\"w\"> </span><span class=\"n\">OBJECT</span><span class=\"w\">  </span><span class=\"n\">LOCAL</span><span class=\"w\">  </span><span class=\"n\">DEFAULT</span><span class=\"w\">   </span><span class=\"mi\">27</span><span class=\"w\"> </span><span class=\"n\">_ZN17cranelift_codegen3isa3x8610enc_tables18RECIPE_CONSTRAINTS17h10c82bc0de555a21E</span><span class=\"w\"></span>\n<span class=\"mi\">123849</span>: <span class=\"mi\">0000000007344550</span><span class=\"w\">  </span><span class=\"mi\">3792</span><span class=\"w\"> </span><span class=\"n\">OBJECT</span><span class=\"w\">  </span><span class=\"n\">LOCAL</span><span class=\"w\">  </span><span class=\"n\">DEFAULT</span><span class=\"w\">   </span><span class=\"mi\">27</span><span class=\"w\"> </span><span class=\"n\">_ZN17cranelift_codegen3isa3x8610enc_tables12RECIPE_NAMES17h54e6a911fe6097bbE</span><span class=\"w\"></span>\n<span class=\"mi\">123866</span>: <span class=\"mi\">0000000007345</span><span class=\"n\">c20</span><span class=\"w\">  </span><span class=\"mi\">1896</span><span class=\"w\"> </span><span class=\"n\">OBJECT</span><span class=\"w\">  </span><span class=\"n\">LOCAL</span><span class=\"w\">  </span><span class=\"n\">DEFAULT</span><span class=\"w\">   </span><span class=\"mi\">27</span><span class=\"w\"> </span><span class=\"n\">_ZN17cranelift_codegen3isa3x8610enc_tables17RECIPE_PREDICATES17hc3712077e222c860E</span><span class=\"w\"></span>\n<span class=\"mi\">123908</span>: <span class=\"mi\">0000000007347</span><span class=\"n\">da0</span><span class=\"w\">   </span><span class=\"mi\">408</span><span class=\"w\"> </span><span class=\"n\">OBJECT</span><span class=\"w\">  </span><span class=\"n\">LOCAL</span><span class=\"w\">  </span><span class=\"n\">DEFAULT</span><span class=\"w\">   </span><span class=\"mi\">27</span><span class=\"w\"> </span><span class=\"n\">_ZN17cranelift_codegen3isa3x868settings11DESCRIPTORS17h03dfd2ae0adf323dE</span><span class=\"w\"></span>\n<span class=\"mi\">123854</span>: <span class=\"mi\">0000000007346388</span><span class=\"w\">   </span><span class=\"mi\">120</span><span class=\"w\"> </span><span class=\"n\">OBJECT</span><span class=\"w\">  </span><span class=\"n\">LOCAL</span><span class=\"w\">  </span><span class=\"n\">DEFAULT</span><span class=\"w\">   </span><span class=\"mi\">27</span><span class=\"w\"> </span><span class=\"n\">_ZN17cranelift_codegen3isa3x8610enc_tables15INST_PREDICATES17h3a3bab86e4a3b3e7E</span><span class=\"w\"></span>\n<span class=\"mi\">123911</span>: <span class=\"mi\">0000000007347</span><span class=\"n\">f38</span><span class=\"w\">    </span><span class=\"mi\">96</span><span class=\"w\"> </span><span class=\"n\">OBJECT</span><span class=\"w\">  </span><span class=\"n\">LOCAL</span><span class=\"w\">  </span><span class=\"n\">DEFAULT</span><span class=\"w\">   </span><span class=\"mi\">27</span><span class=\"w\"> </span><span class=\"n\">_ZN17cranelift_codegen3isa3x868settings8TEMPLATE17hdfd5aa2b6a7f01ecE</span><span class=\"w\"></span>\n<span class=\"mi\">123922</span>: <span class=\"mi\">0000000007341</span><span class=\"n\">ea8</span><span class=\"w\">    </span><span class=\"mi\">48</span><span class=\"w\"> </span><span class=\"n\">OBJECT</span><span class=\"w\">  </span><span class=\"n\">LOCAL</span><span class=\"w\">  </span><span class=\"n\">DEFAULT</span><span class=\"w\">   </span><span class=\"mi\">27</span><span class=\"w\"> </span><span class=\"n\">_ZN17cranelift_codegen3isa3x869registers9GPR8_DATA17h4c7c028be6f5b4d8E</span><span class=\"w\"></span>\n<span class=\"mi\">123921</span>: <span class=\"mi\">0000000007341</span><span class=\"n\">f68</span><span class=\"w\">    </span><span class=\"mi\">48</span><span class=\"w\"> </span><span class=\"n\">OBJECT</span><span class=\"w\">  </span><span class=\"n\">LOCAL</span><span class=\"w\">  </span><span class=\"n\">DEFAULT</span><span class=\"w\">   </span><span class=\"mi\">27</span><span class=\"w\"> </span><span class=\"n\">_ZN17cranelift_codegen3isa3x869registers9FPR8_DATA17h4d3540abe0a3bbe2E</span><span class=\"w\"></span>\n<span class=\"mi\">123920</span>: <span class=\"mf\">0000000007341e18</span><span class=\"w\">    </span><span class=\"mi\">48</span><span class=\"w\"> </span><span class=\"n\">OBJECT</span><span class=\"w\">  </span><span class=\"n\">LOCAL</span><span class=\"w\">  </span><span class=\"n\">DEFAULT</span><span class=\"w\">   </span><span class=\"mi\">27</span><span class=\"w\"> </span><span class=\"n\">_ZN17cranelift_codegen3isa3x869registers9FLAG_DATA17h06234297cfb01581E</span><span class=\"w\"></span>\n<span class=\"mi\">123919</span>: <span class=\"mi\">0000000007341</span><span class=\"n\">f38</span><span class=\"w\">    </span><span class=\"mi\">48</span><span class=\"w\"> </span><span class=\"n\">OBJECT</span><span class=\"w\">  </span><span class=\"n\">LOCAL</span><span class=\"w\">  </span><span class=\"n\">DEFAULT</span><span class=\"w\">   </span><span class=\"mi\">27</span><span class=\"w\"> </span><span class=\"n\">_ZN17cranelift_codegen3isa3x869registers9ABCD_DATA17h231c9e2f56f02113E</span><span class=\"w\"></span>\n<span class=\"mi\">123918</span>: <span class=\"mi\">0000000007341</span><span class=\"n\">db8</span><span class=\"w\">    </span><span class=\"mi\">48</span><span class=\"w\"> </span><span class=\"n\">OBJECT</span><span class=\"w\">  </span><span class=\"n\">LOCAL</span><span class=\"w\">  </span><span class=\"n\">DEFAULT</span><span class=\"w\">   </span><span class=\"mi\">27</span><span class=\"w\"> </span><span class=\"n\">_ZN17cranelift_codegen3isa3x869registers8GPR_DATA17h327360c70468dbffE</span><span class=\"w\"></span>\n<span class=\"mi\">123917</span>: <span class=\"mi\">0000000007341</span><span class=\"n\">de8</span><span class=\"w\">    </span><span class=\"mi\">48</span><span class=\"w\"> </span><span class=\"n\">OBJECT</span><span class=\"w\">  </span><span class=\"n\">LOCAL</span><span class=\"w\">  </span><span class=\"n\">DEFAULT</span><span class=\"w\">   </span><span class=\"mi\">27</span><span class=\"w\"> </span><span class=\"n\">_ZN17cranelift_codegen3isa3x869registers8FPR_DATA17h3d44028fd0ecbabdE</span><span class=\"w\"></span>\n<span class=\"mi\">123915</span>: <span class=\"mi\">0000000007341</span><span class=\"n\">f08</span><span class=\"w\">    </span><span class=\"mi\">48</span><span class=\"w\"> </span><span class=\"n\">OBJECT</span><span class=\"w\">  </span><span class=\"n\">LOCAL</span><span class=\"w\">  </span><span class=\"n\">DEFAULT</span><span class=\"w\">   </span><span class=\"mi\">27</span><span class=\"w\"> </span><span class=\"n\">_ZN17cranelift_codegen3isa3x869registers25GPR8_ZERO_DEREF_SAFE_DATA17h743615e457b73283E</span><span class=\"w\"></span>\n<span class=\"mi\">123914</span>: <span class=\"mf\">0000000007341e78</span><span class=\"w\">    </span><span class=\"mi\">48</span><span class=\"w\"> </span><span class=\"n\">OBJECT</span><span class=\"w\">  </span><span class=\"n\">LOCAL</span><span class=\"w\">  </span><span class=\"n\">DEFAULT</span><span class=\"w\">   </span><span class=\"mi\">27</span><span class=\"w\"> </span><span class=\"n\">_ZN17cranelift_codegen3isa3x869registers24GPR_ZERO_DEREF_SAFE_DATA17h82d7795ce9382dfbE</span><span class=\"w\"></span>\n<span class=\"mi\">123913</span>: <span class=\"mi\">0000000007341</span><span class=\"n\">ed8</span><span class=\"w\">    </span><span class=\"mi\">48</span><span class=\"w\"> </span><span class=\"n\">OBJECT</span><span class=\"w\">  </span><span class=\"n\">LOCAL</span><span class=\"w\">  </span><span class=\"n\">DEFAULT</span><span class=\"w\">   </span><span class=\"mi\">27</span><span class=\"w\"> </span><span class=\"n\">_ZN17cranelift_codegen3isa3x869registers20GPR8_DEREF_SAFE_DATA17h460e84f7bb9ca949E</span><span class=\"w\"></span>\n<span class=\"mi\">123912</span>: <span class=\"mf\">0000000007341e48</span><span class=\"w\">    </span><span class=\"mi\">48</span><span class=\"w\"> </span><span class=\"n\">OBJECT</span><span class=\"w\">  </span><span class=\"n\">LOCAL</span><span class=\"w\">  </span><span class=\"n\">DEFAULT</span><span class=\"w\">   </span><span class=\"mi\">27</span><span class=\"w\"> </span><span class=\"n\">_ZN17cranelift_codegen3isa3x869registers19GPR_DEREF_SAFE_DATA17had1b3296ef50e9ebE</span><span class=\"w\"></span>\n<span class=\"mi\">123916</span>: <span class=\"mi\">0000000007341</span><span class=\"n\">f98</span><span class=\"w\">    </span><span class=\"mi\">32</span><span class=\"w\"> </span><span class=\"n\">OBJECT</span><span class=\"w\">  </span><span class=\"n\">LOCAL</span><span class=\"w\">  </span><span class=\"n\">DEFAULT</span><span class=\"w\">   </span><span class=\"mi\">27</span><span class=\"w\"> </span><span class=\"n\">_ZN17cranelift_codegen3isa3x869registers4INFO17h2a2b91216d7265ffE</span><span class=\"w\"></span>\n<span class=\"mi\">123855</span>: <span class=\"mi\">0000000007345</span><span class=\"n\">c00</span><span class=\"w\">    </span><span class=\"mi\">32</span><span class=\"w\"> </span><span class=\"n\">OBJECT</span><span class=\"w\">  </span><span class=\"n\">LOCAL</span><span class=\"w\">  </span><span class=\"n\">DEFAULT</span><span class=\"w\">   </span><span class=\"mi\">27</span><span class=\"w\"> </span><span class=\"n\">_ZN17cranelift_codegen3isa3x8610enc_tables16LEGALIZE_ACTIONS17h4ddebdf4d5a40777E</span><span class=\"w\"></span>\n</code></pre></div>\n<p>There's about 15k of symbols in <code>cranelift_codegen::isa::x86</code> that live in <code>.data.rel.ro</code>, which renders them non-shareable.  For Firefox's purposes, we'd really like to minimize the amount of data that lives in <code>.data.rel.ro</code>, moving it to <code>.rodata</code> if at all possible.</p>\n<p>The usual problem for data winding up in <code>.data.rel.ro</code> is data structures that contain slices, and indeed, for <code>RECIPE_CONSTRAINTS</code>, the <code>RecipeConstraints</code> structure has a couple slices in it.  I haven't looked at <code>RECIPE_NAMES</code>, <code>RECIPE_PREDICATES</code>, and so forth, but I assume the problems are similar there.</p>\n<p>It would be great if things were shuffled around somehow so the data associated with these symbols could live in <code>.rodata</code>.  <a href=\"https://github.com/unicode-rs/unicode-normalization/issues/14\">unicode-rs/unicode-normalization#14</a> is one example of how we addressed this in another Rust library; I might have time to implement the same changes here, not sure though.  We don't necessarily have to address <em>all</em> of these, but addressing the top five or so would make a big difference.</p>\n<p>/cc @EricRahm</p>\n</blockquote>",
        "id": 225049818,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1612373322
    }
]