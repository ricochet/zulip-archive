[
    {
        "content": "<p>spacewander opened <a href=\"https://github.com/bytecodealliance/wasmtime/issues/3321\">issue #3321</a>:</p>\n<blockquote>\n<h3>Test Case</h3>\n<h3>Steps to Reproduce</h3>\n<p>When I try to integrate wasmtime to my host program written in C, the program crashed during executing</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"w\">    </span><span class=\"n\">vm_wasi_config</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">wasi_config_new</span><span class=\"p\">();</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">vm_wasi_config</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"n\">NULL</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"n\">goto</span><span class=\"w\"> </span><span class=\"o\">..</span><span class=\"p\">.;</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">}</span><span class=\"w\"></span>\n\n<span class=\"w\">    </span><span class=\"n\">wasi_config_inherit_argv</span><span class=\"p\">(</span><span class=\"n\">vm_wasi_config</span><span class=\"p\">);</span><span class=\"w\"> </span><span class=\"cm\">/* &lt;- this line! */</span><span class=\"w\"></span>\n</code></pre></div>\n<p>The bt is:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code>#<span class=\"mi\">0</span><span class=\"w\">  </span><span class=\"n\">__strlen_avx2</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">../</span><span class=\"n\">sysdeps</span><span class=\"o\">/</span><span class=\"n\">x86_64</span><span class=\"o\">/</span><span class=\"n\">multiarch</span><span class=\"o\">/</span><span class=\"n\">strlen</span><span class=\"o\">-</span><span class=\"n\">avx2</span><span class=\"p\">.</span><span class=\"n\">S</span>:<span class=\"mi\">65</span><span class=\"w\"></span>\n#<span class=\"mi\">1</span><span class=\"w\">  </span><span class=\"mh\">0x00007ff7c2b4ee69</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">std</span>::<span class=\"n\">ffi</span>::<span class=\"n\">c_str</span>::<span class=\"n\">CStr</span>::<span class=\"n\">from_ptr</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">ffi</span><span class=\"o\">/</span><span class=\"n\">c_str</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">1174</span><span class=\"w\"></span>\n#<span class=\"mi\">2</span><span class=\"w\">  </span><span class=\"n\">std</span>::<span class=\"n\">sys</span>::<span class=\"n\">unix</span>::<span class=\"n\">args</span>::<span class=\"n\">imp</span>::<span class=\"n\">clone</span>::<span class=\"p\">{{</span><span class=\"n\">closure</span><span class=\"p\">}}</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">sys</span><span class=\"o\">/</span><span class=\"n\">unix</span><span class=\"o\">/</span><span class=\"n\">args</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">147</span><span class=\"w\"></span>\n#<span class=\"mi\">3</span><span class=\"w\">  </span><span class=\"n\">core</span>::<span class=\"n\">iter</span>::<span class=\"n\">adapters</span>::<span class=\"n\">map</span>::<span class=\"n\">map_fold</span>::<span class=\"p\">{{</span><span class=\"n\">closure</span><span class=\"p\">}}</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a178d0322ce20e33eac124758e837cbd80a6f633</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">iter</span><span class=\"o\">/</span><span class=\"n\">adapters</span><span class=\"o\">/</span><span class=\"n\">map</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">82</span><span class=\"w\"></span>\n#<span class=\"mi\">4</span><span class=\"w\">  </span><span class=\"n\">core</span>::<span class=\"n\">iter</span>::<span class=\"n\">traits</span>::<span class=\"n\">iterator</span>::<span class=\"nb\">Iterator</span>::<span class=\"n\">fold</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a178d0322ce20e33eac124758e837cbd80a6f633</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">iter</span><span class=\"o\">/</span><span class=\"n\">traits</span><span class=\"o\">/</span><span class=\"n\">iterator</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">2112</span><span class=\"w\"></span>\n#<span class=\"mi\">5</span><span class=\"w\">  </span><span class=\"o\">&lt;</span><span class=\"n\">core</span>::<span class=\"n\">iter</span>::<span class=\"n\">adapters</span>::<span class=\"n\">map</span>::<span class=\"n\">Map</span><span class=\"o\">&lt;</span><span class=\"n\">I</span><span class=\"p\">,</span><span class=\"n\">F</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">core</span>::<span class=\"n\">iter</span>::<span class=\"n\">traits</span>::<span class=\"n\">iterator</span>::<span class=\"nb\">Iterator</span><span class=\"o\">&gt;</span>::<span class=\"n\">fold</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a178d0322ce20e33eac124758e837cbd80a6f633</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">iter</span><span class=\"o\">/</span><span class=\"n\">adapters</span><span class=\"o\">/</span><span class=\"n\">map</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">122</span><span class=\"w\"></span>\n#<span class=\"mi\">6</span><span class=\"w\">  </span><span class=\"n\">core</span>::<span class=\"n\">iter</span>::<span class=\"n\">traits</span>::<span class=\"n\">iterator</span>::<span class=\"nb\">Iterator</span>::<span class=\"n\">for_each</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a178d0322ce20e33eac124758e837cbd80a6f633</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">iter</span><span class=\"o\">/</span><span class=\"n\">traits</span><span class=\"o\">/</span><span class=\"n\">iterator</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">736</span><span class=\"w\"></span>\n#<span class=\"mi\">7</span><span class=\"w\">  </span><span class=\"o\">&lt;</span><span class=\"n\">alloc</span>::<span class=\"n\">vec</span>::<span class=\"nb\">Vec</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"p\">,</span><span class=\"n\">A</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">alloc</span>::<span class=\"n\">vec</span>::<span class=\"n\">spec_extend</span>::<span class=\"n\">SpecExtend</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"p\">,</span><span class=\"n\">I</span><span class=\"o\">&gt;&gt;</span>::<span class=\"n\">spec_extend</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a178d0322ce20e33eac124758e837cbd80a6f633</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">alloc</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">vec</span><span class=\"o\">/</span><span class=\"n\">spec_extend</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">40</span><span class=\"w\"></span>\n#<span class=\"mi\">8</span><span class=\"w\">  </span><span class=\"o\">&lt;</span><span class=\"n\">alloc</span>::<span class=\"n\">vec</span>::<span class=\"nb\">Vec</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">alloc</span>::<span class=\"n\">vec</span>::<span class=\"n\">spec_from_iter_nested</span>::<span class=\"n\">SpecFromIterNested</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"p\">,</span><span class=\"n\">I</span><span class=\"o\">&gt;&gt;</span>::<span class=\"n\">from_iter</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a178d0322ce20e33eac124758e837cbd80a6f633</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">alloc</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">vec</span><span class=\"o\">/</span><span class=\"n\">spec_from_iter_nested</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">56</span><span class=\"w\"></span>\n#<span class=\"mi\">9</span><span class=\"w\">  </span><span class=\"o\">&lt;</span><span class=\"n\">alloc</span>::<span class=\"n\">vec</span>::<span class=\"nb\">Vec</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">alloc</span>::<span class=\"n\">vec</span>::<span class=\"n\">spec_from_iter</span>::<span class=\"n\">SpecFromIter</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"p\">,</span><span class=\"n\">I</span><span class=\"o\">&gt;&gt;</span>::<span class=\"n\">from_iter</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a178d0322ce20e33eac124758e837cbd80a6f633</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">alloc</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">vec</span><span class=\"o\">/</span><span class=\"n\">spec_from_iter</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">33</span><span class=\"w\"></span>\n#<span class=\"mi\">10</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">alloc</span>::<span class=\"n\">vec</span>::<span class=\"nb\">Vec</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">core</span>::<span class=\"n\">iter</span>::<span class=\"n\">traits</span>::<span class=\"n\">collect</span>::<span class=\"n\">FromIterator</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"o\">&gt;&gt;</span>::<span class=\"n\">from_iter</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a178d0322ce20e33eac124758e837cbd80a6f633</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">alloc</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">vec</span><span class=\"o\">/</span><span class=\"k\">mod</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">2449</span><span class=\"w\"></span>\n#<span class=\"mi\">11</span><span class=\"w\"> </span><span class=\"n\">core</span>::<span class=\"n\">iter</span>::<span class=\"n\">traits</span>::<span class=\"n\">iterator</span>::<span class=\"nb\">Iterator</span>::<span class=\"n\">collect</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a178d0322ce20e33eac124758e837cbd80a6f633</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">iter</span><span class=\"o\">/</span><span class=\"n\">traits</span><span class=\"o\">/</span><span class=\"n\">iterator</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">1748</span><span class=\"w\"></span>\n#<span class=\"mi\">12</span><span class=\"w\"> </span><span class=\"n\">std</span>::<span class=\"n\">sys</span>::<span class=\"n\">unix</span>::<span class=\"n\">args</span>::<span class=\"n\">imp</span>::<span class=\"n\">clone</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">sys</span><span class=\"o\">/</span><span class=\"n\">unix</span><span class=\"o\">/</span><span class=\"n\">args</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">145</span><span class=\"w\"></span>\n#<span class=\"mi\">13</span><span class=\"w\"> </span><span class=\"n\">std</span>::<span class=\"n\">sys</span>::<span class=\"n\">unix</span>::<span class=\"n\">args</span>::<span class=\"n\">imp</span>::<span class=\"n\">args</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">sys</span><span class=\"o\">/</span><span class=\"n\">unix</span><span class=\"o\">/</span><span class=\"n\">args</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">137</span><span class=\"w\"></span>\n#<span class=\"mi\">14</span><span class=\"w\"> </span><span class=\"n\">std</span>::<span class=\"n\">sys</span>::<span class=\"n\">unix</span>::<span class=\"n\">args</span>::<span class=\"n\">args</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">sys</span><span class=\"o\">/</span><span class=\"n\">unix</span><span class=\"o\">/</span><span class=\"n\">args</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">24</span><span class=\"w\"></span>\n#<span class=\"mi\">15</span><span class=\"w\"> </span><span class=\"n\">std</span>::<span class=\"n\">env</span>::<span class=\"n\">args_os</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">env</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">780</span><span class=\"w\"></span>\n#<span class=\"mi\">16</span><span class=\"w\"> </span><span class=\"mh\">0x00007ff7c2b4ecf1</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">std</span>::<span class=\"n\">env</span>::<span class=\"n\">args</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">env</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">745</span><span class=\"w\"></span>\n#<span class=\"mi\">17</span><span class=\"w\"> </span><span class=\"mh\">0x00007ff7c2578112</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">wasi_cap_std_sync</span>::<span class=\"n\">WasiCtxBuilder</span>::<span class=\"n\">inherit_args</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">panicking</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">541</span><span class=\"w\"></span>\n#<span class=\"mi\">18</span><span class=\"w\"> </span><span class=\"mh\">0x00007ff7c24cff55</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span>::<span class=\"n\">wasi</span>::<span class=\"n\">wasi_config_t</span>::<span class=\"n\">into_wasi_ctx</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">panicking</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">541</span><span class=\"w\"></span>\n#<span class=\"mi\">19</span><span class=\"w\"> </span><span class=\"mh\">0x00007ff7c241a92a</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">wasmtime_context_set_wasi</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">panicking</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">541</span><span class=\"w\"></span>\n#<span class=\"mi\">20</span><span class=\"w\"> </span><span class=\"mh\">0x000000000068c766</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"o\">..</span><span class=\"p\">.</span><span class=\"w\"></span>\n</code></pre></div>\n<p>My CPU has avx2 support:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">grep</span><span class=\"w\"> </span><span class=\"n\">avx2</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">proc</span><span class=\"o\">/</span><span class=\"n\">cpuinfo</span><span class=\"w\"></span>\n<span class=\"n\">flags</span><span class=\"w\">           </span>: <span class=\"nc\">fpu</span><span class=\"w\"> </span><span class=\"n\">vme</span><span class=\"w\"> </span><span class=\"n\">de</span><span class=\"w\"> </span><span class=\"n\">pse</span><span class=\"w\"> </span><span class=\"n\">tsc</span><span class=\"w\"> </span><span class=\"n\">msr</span><span class=\"w\"> </span><span class=\"n\">pae</span><span class=\"w\"> </span><span class=\"n\">mce</span><span class=\"w\"> </span><span class=\"n\">cx8</span><span class=\"w\"> </span><span class=\"n\">apic</span><span class=\"w\"> </span><span class=\"n\">sep</span><span class=\"w\"> </span><span class=\"n\">mtrr</span><span class=\"w\"> </span><span class=\"n\">pge</span><span class=\"w\"> </span><span class=\"n\">mca</span><span class=\"w\"> </span><span class=\"n\">cmov</span><span class=\"w\"> </span><span class=\"n\">pat</span><span class=\"w\"> </span><span class=\"n\">pse36</span><span class=\"w\"> </span><span class=\"n\">clflush</span><span class=\"w\"> </span><span class=\"n\">mmx</span><span class=\"w\"> </span><span class=\"n\">fxsr</span><span class=\"w\"> </span><span class=\"n\">sse</span><span class=\"w\"> </span><span class=\"n\">sse2</span><span class=\"w\"> </span><span class=\"n\">ss</span><span class=\"w\"> </span><span class=\"n\">ht</span><span class=\"w\"> </span><span class=\"n\">syscall</span><span class=\"w\"> </span><span class=\"n\">nx</span><span class=\"w\"> </span><span class=\"n\">pdpe1gb</span><span class=\"w\"> </span><span class=\"n\">rdtscp</span><span class=\"w\"> </span><span class=\"n\">lm</span><span class=\"w\"> </span><span class=\"n\">constant_tsc</span><span class=\"w\"> </span><span class=\"n\">rep_good</span><span class=\"w\"> </span><span class=\"n\">nopl</span><span class=\"w\"> </span><span class=\"n\">xtopology</span><span class=\"w\"> </span><span class=\"n\">cpuid</span><span class=\"w\"> </span><span class=\"n\">pni</span><span class=\"w\"> </span><span class=\"n\">pclmulqdq</span><span class=\"w\"> </span><span class=\"n\">ssse3</span><span class=\"w\"> </span><span class=\"n\">fma</span><span class=\"w\"> </span><span class=\"n\">cx16</span><span class=\"w\"> </span><span class=\"n\">pcid</span><span class=\"w\"> </span><span class=\"n\">sse4_1</span><span class=\"w\"> </span><span class=\"n\">sse4_2</span><span class=\"w\"> </span><span class=\"n\">movbe</span><span class=\"w\"> </span><span class=\"n\">popcnt</span><span class=\"w\"> </span><span class=\"n\">aes</span><span class=\"w\"> </span><span class=\"n\">xsave</span><span class=\"w\"> </span><span class=\"n\">avx</span><span class=\"w\"> </span><span class=\"n\">f16c</span><span class=\"w\"> </span><span class=\"n\">rdrand</span><span class=\"w\"> </span><span class=\"n\">hypervisor</span><span class=\"w\"> </span><span class=\"n\">lahf_lm</span><span class=\"w\"> </span><span class=\"n\">abm</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"n\">dnowprefetch</span><span class=\"w\"> </span><span class=\"n\">invpcid_single</span><span class=\"w\"> </span><span class=\"n\">ssbd</span><span class=\"w\"> </span><span class=\"n\">ibrs</span><span class=\"w\"> </span><span class=\"n\">ibpb</span><span class=\"w\"> </span><span class=\"n\">stibp</span><span class=\"w\"> </span><span class=\"n\">ibrs_enhanced</span><span class=\"w\"> </span><span class=\"n\">fsgsbase</span><span class=\"w\"> </span><span class=\"n\">bmi1</span><span class=\"w\"> </span><span class=\"n\">avx2</span><span class=\"w\"> </span><span class=\"n\">smep</span><span class=\"w\"> </span><span class=\"n\">bmi2</span><span class=\"w\"> </span><span class=\"n\">erms</span><span class=\"w\"> </span><span class=\"n\">invpcid</span><span class=\"w\"> </span><span class=\"n\">rdseed</span><span class=\"w\"> </span><span class=\"n\">adx</span><span class=\"w\"> </span><span class=\"n\">smap</span><span class=\"w\"> </span><span class=\"n\">clflushopt</span><span class=\"w\"> </span><span class=\"n\">xsaveopt</span><span class=\"w\"> </span><span class=\"n\">xsavec</span><span class=\"w\"> </span><span class=\"n\">xgetbv1</span><span class=\"w\"> </span><span class=\"n\">xsaves</span><span class=\"w\"> </span><span class=\"n\">flush_l1d</span><span class=\"w\"> </span><span class=\"n\">arch_capabilities</span><span class=\"w\"></span>\n<span class=\"o\">..</span><span class=\"p\">.</span><span class=\"w\"></span>\n</code></pre></div>\n<p>It only happened when the argv of the program is not empty.</p>\n<h3>Expected Results</h3>\n<p>Run successfully</p>\n<h3>Actual Results</h3>\n<p>Segfault on wasi_config_inherit_argv</p>\n<h3>Versions and Environment</h3>\n<p>Wasmtime version or commit: v0.29.0</p>\n<p>Operating system: Linux run on WSL</p>\n<p>Architecture: x64</p>\n<h3>Extra Info</h3>\n</blockquote>",
        "id": 252587597,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1631175233
    },
    {
        "content": "<p>spacewander labeled <a href=\"https://github.com/bytecodealliance/wasmtime/issues/3321\">issue #3321</a>:</p>\n<blockquote>\n<h3>Test Case</h3>\n<h3>Steps to Reproduce</h3>\n<p>When I try to integrate wasmtime to my host program written in C, the program crashed during executing</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"w\">    </span><span class=\"n\">vm_wasi_config</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">wasi_config_new</span><span class=\"p\">();</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">vm_wasi_config</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"n\">NULL</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"n\">goto</span><span class=\"w\"> </span><span class=\"o\">..</span><span class=\"p\">.;</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">}</span><span class=\"w\"></span>\n\n<span class=\"w\">    </span><span class=\"n\">wasi_config_inherit_argv</span><span class=\"p\">(</span><span class=\"n\">vm_wasi_config</span><span class=\"p\">);</span><span class=\"w\"> </span><span class=\"cm\">/* &lt;- this line! */</span><span class=\"w\"></span>\n</code></pre></div>\n<p>The bt is:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code>#<span class=\"mi\">0</span><span class=\"w\">  </span><span class=\"n\">__strlen_avx2</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">../</span><span class=\"n\">sysdeps</span><span class=\"o\">/</span><span class=\"n\">x86_64</span><span class=\"o\">/</span><span class=\"n\">multiarch</span><span class=\"o\">/</span><span class=\"n\">strlen</span><span class=\"o\">-</span><span class=\"n\">avx2</span><span class=\"p\">.</span><span class=\"n\">S</span>:<span class=\"mi\">65</span><span class=\"w\"></span>\n#<span class=\"mi\">1</span><span class=\"w\">  </span><span class=\"mh\">0x00007ff7c2b4ee69</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">std</span>::<span class=\"n\">ffi</span>::<span class=\"n\">c_str</span>::<span class=\"n\">CStr</span>::<span class=\"n\">from_ptr</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">ffi</span><span class=\"o\">/</span><span class=\"n\">c_str</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">1174</span><span class=\"w\"></span>\n#<span class=\"mi\">2</span><span class=\"w\">  </span><span class=\"n\">std</span>::<span class=\"n\">sys</span>::<span class=\"n\">unix</span>::<span class=\"n\">args</span>::<span class=\"n\">imp</span>::<span class=\"n\">clone</span>::<span class=\"p\">{{</span><span class=\"n\">closure</span><span class=\"p\">}}</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">sys</span><span class=\"o\">/</span><span class=\"n\">unix</span><span class=\"o\">/</span><span class=\"n\">args</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">147</span><span class=\"w\"></span>\n#<span class=\"mi\">3</span><span class=\"w\">  </span><span class=\"n\">core</span>::<span class=\"n\">iter</span>::<span class=\"n\">adapters</span>::<span class=\"n\">map</span>::<span class=\"n\">map_fold</span>::<span class=\"p\">{{</span><span class=\"n\">closure</span><span class=\"p\">}}</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a178d0322ce20e33eac124758e837cbd80a6f633</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">iter</span><span class=\"o\">/</span><span class=\"n\">adapters</span><span class=\"o\">/</span><span class=\"n\">map</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">82</span><span class=\"w\"></span>\n#<span class=\"mi\">4</span><span class=\"w\">  </span><span class=\"n\">core</span>::<span class=\"n\">iter</span>::<span class=\"n\">traits</span>::<span class=\"n\">iterator</span>::<span class=\"nb\">Iterator</span>::<span class=\"n\">fold</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a178d0322ce20e33eac124758e837cbd80a6f633</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">iter</span><span class=\"o\">/</span><span class=\"n\">traits</span><span class=\"o\">/</span><span class=\"n\">iterator</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">2112</span><span class=\"w\"></span>\n#<span class=\"mi\">5</span><span class=\"w\">  </span><span class=\"o\">&lt;</span><span class=\"n\">core</span>::<span class=\"n\">iter</span>::<span class=\"n\">adapters</span>::<span class=\"n\">map</span>::<span class=\"n\">Map</span><span class=\"o\">&lt;</span><span class=\"n\">I</span><span class=\"p\">,</span><span class=\"n\">F</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">core</span>::<span class=\"n\">iter</span>::<span class=\"n\">traits</span>::<span class=\"n\">iterator</span>::<span class=\"nb\">Iterator</span><span class=\"o\">&gt;</span>::<span class=\"n\">fold</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a178d0322ce20e33eac124758e837cbd80a6f633</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">iter</span><span class=\"o\">/</span><span class=\"n\">adapters</span><span class=\"o\">/</span><span class=\"n\">map</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">122</span><span class=\"w\"></span>\n#<span class=\"mi\">6</span><span class=\"w\">  </span><span class=\"n\">core</span>::<span class=\"n\">iter</span>::<span class=\"n\">traits</span>::<span class=\"n\">iterator</span>::<span class=\"nb\">Iterator</span>::<span class=\"n\">for_each</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a178d0322ce20e33eac124758e837cbd80a6f633</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">iter</span><span class=\"o\">/</span><span class=\"n\">traits</span><span class=\"o\">/</span><span class=\"n\">iterator</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">736</span><span class=\"w\"></span>\n#<span class=\"mi\">7</span><span class=\"w\">  </span><span class=\"o\">&lt;</span><span class=\"n\">alloc</span>::<span class=\"n\">vec</span>::<span class=\"nb\">Vec</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"p\">,</span><span class=\"n\">A</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">alloc</span>::<span class=\"n\">vec</span>::<span class=\"n\">spec_extend</span>::<span class=\"n\">SpecExtend</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"p\">,</span><span class=\"n\">I</span><span class=\"o\">&gt;&gt;</span>::<span class=\"n\">spec_extend</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a178d0322ce20e33eac124758e837cbd80a6f633</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">alloc</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">vec</span><span class=\"o\">/</span><span class=\"n\">spec_extend</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">40</span><span class=\"w\"></span>\n#<span class=\"mi\">8</span><span class=\"w\">  </span><span class=\"o\">&lt;</span><span class=\"n\">alloc</span>::<span class=\"n\">vec</span>::<span class=\"nb\">Vec</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">alloc</span>::<span class=\"n\">vec</span>::<span class=\"n\">spec_from_iter_nested</span>::<span class=\"n\">SpecFromIterNested</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"p\">,</span><span class=\"n\">I</span><span class=\"o\">&gt;&gt;</span>::<span class=\"n\">from_iter</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a178d0322ce20e33eac124758e837cbd80a6f633</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">alloc</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">vec</span><span class=\"o\">/</span><span class=\"n\">spec_from_iter_nested</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">56</span><span class=\"w\"></span>\n#<span class=\"mi\">9</span><span class=\"w\">  </span><span class=\"o\">&lt;</span><span class=\"n\">alloc</span>::<span class=\"n\">vec</span>::<span class=\"nb\">Vec</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">alloc</span>::<span class=\"n\">vec</span>::<span class=\"n\">spec_from_iter</span>::<span class=\"n\">SpecFromIter</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"p\">,</span><span class=\"n\">I</span><span class=\"o\">&gt;&gt;</span>::<span class=\"n\">from_iter</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a178d0322ce20e33eac124758e837cbd80a6f633</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">alloc</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">vec</span><span class=\"o\">/</span><span class=\"n\">spec_from_iter</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">33</span><span class=\"w\"></span>\n#<span class=\"mi\">10</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">alloc</span>::<span class=\"n\">vec</span>::<span class=\"nb\">Vec</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">core</span>::<span class=\"n\">iter</span>::<span class=\"n\">traits</span>::<span class=\"n\">collect</span>::<span class=\"n\">FromIterator</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"o\">&gt;&gt;</span>::<span class=\"n\">from_iter</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a178d0322ce20e33eac124758e837cbd80a6f633</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">alloc</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">vec</span><span class=\"o\">/</span><span class=\"k\">mod</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">2449</span><span class=\"w\"></span>\n#<span class=\"mi\">11</span><span class=\"w\"> </span><span class=\"n\">core</span>::<span class=\"n\">iter</span>::<span class=\"n\">traits</span>::<span class=\"n\">iterator</span>::<span class=\"nb\">Iterator</span>::<span class=\"n\">collect</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a178d0322ce20e33eac124758e837cbd80a6f633</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">iter</span><span class=\"o\">/</span><span class=\"n\">traits</span><span class=\"o\">/</span><span class=\"n\">iterator</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">1748</span><span class=\"w\"></span>\n#<span class=\"mi\">12</span><span class=\"w\"> </span><span class=\"n\">std</span>::<span class=\"n\">sys</span>::<span class=\"n\">unix</span>::<span class=\"n\">args</span>::<span class=\"n\">imp</span>::<span class=\"n\">clone</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">sys</span><span class=\"o\">/</span><span class=\"n\">unix</span><span class=\"o\">/</span><span class=\"n\">args</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">145</span><span class=\"w\"></span>\n#<span class=\"mi\">13</span><span class=\"w\"> </span><span class=\"n\">std</span>::<span class=\"n\">sys</span>::<span class=\"n\">unix</span>::<span class=\"n\">args</span>::<span class=\"n\">imp</span>::<span class=\"n\">args</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">sys</span><span class=\"o\">/</span><span class=\"n\">unix</span><span class=\"o\">/</span><span class=\"n\">args</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">137</span><span class=\"w\"></span>\n#<span class=\"mi\">14</span><span class=\"w\"> </span><span class=\"n\">std</span>::<span class=\"n\">sys</span>::<span class=\"n\">unix</span>::<span class=\"n\">args</span>::<span class=\"n\">args</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">sys</span><span class=\"o\">/</span><span class=\"n\">unix</span><span class=\"o\">/</span><span class=\"n\">args</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">24</span><span class=\"w\"></span>\n#<span class=\"mi\">15</span><span class=\"w\"> </span><span class=\"n\">std</span>::<span class=\"n\">env</span>::<span class=\"n\">args_os</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">env</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">780</span><span class=\"w\"></span>\n#<span class=\"mi\">16</span><span class=\"w\"> </span><span class=\"mh\">0x00007ff7c2b4ecf1</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">std</span>::<span class=\"n\">env</span>::<span class=\"n\">args</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">env</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">745</span><span class=\"w\"></span>\n#<span class=\"mi\">17</span><span class=\"w\"> </span><span class=\"mh\">0x00007ff7c2578112</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">wasi_cap_std_sync</span>::<span class=\"n\">WasiCtxBuilder</span>::<span class=\"n\">inherit_args</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">panicking</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">541</span><span class=\"w\"></span>\n#<span class=\"mi\">18</span><span class=\"w\"> </span><span class=\"mh\">0x00007ff7c24cff55</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span>::<span class=\"n\">wasi</span>::<span class=\"n\">wasi_config_t</span>::<span class=\"n\">into_wasi_ctx</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">panicking</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">541</span><span class=\"w\"></span>\n#<span class=\"mi\">19</span><span class=\"w\"> </span><span class=\"mh\">0x00007ff7c241a92a</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">wasmtime_context_set_wasi</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">panicking</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">541</span><span class=\"w\"></span>\n#<span class=\"mi\">20</span><span class=\"w\"> </span><span class=\"mh\">0x000000000068c766</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"o\">..</span><span class=\"p\">.</span><span class=\"w\"></span>\n</code></pre></div>\n<p>My CPU has avx2 support:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">grep</span><span class=\"w\"> </span><span class=\"n\">avx2</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">proc</span><span class=\"o\">/</span><span class=\"n\">cpuinfo</span><span class=\"w\"></span>\n<span class=\"n\">flags</span><span class=\"w\">           </span>: <span class=\"nc\">fpu</span><span class=\"w\"> </span><span class=\"n\">vme</span><span class=\"w\"> </span><span class=\"n\">de</span><span class=\"w\"> </span><span class=\"n\">pse</span><span class=\"w\"> </span><span class=\"n\">tsc</span><span class=\"w\"> </span><span class=\"n\">msr</span><span class=\"w\"> </span><span class=\"n\">pae</span><span class=\"w\"> </span><span class=\"n\">mce</span><span class=\"w\"> </span><span class=\"n\">cx8</span><span class=\"w\"> </span><span class=\"n\">apic</span><span class=\"w\"> </span><span class=\"n\">sep</span><span class=\"w\"> </span><span class=\"n\">mtrr</span><span class=\"w\"> </span><span class=\"n\">pge</span><span class=\"w\"> </span><span class=\"n\">mca</span><span class=\"w\"> </span><span class=\"n\">cmov</span><span class=\"w\"> </span><span class=\"n\">pat</span><span class=\"w\"> </span><span class=\"n\">pse36</span><span class=\"w\"> </span><span class=\"n\">clflush</span><span class=\"w\"> </span><span class=\"n\">mmx</span><span class=\"w\"> </span><span class=\"n\">fxsr</span><span class=\"w\"> </span><span class=\"n\">sse</span><span class=\"w\"> </span><span class=\"n\">sse2</span><span class=\"w\"> </span><span class=\"n\">ss</span><span class=\"w\"> </span><span class=\"n\">ht</span><span class=\"w\"> </span><span class=\"n\">syscall</span><span class=\"w\"> </span><span class=\"n\">nx</span><span class=\"w\"> </span><span class=\"n\">pdpe1gb</span><span class=\"w\"> </span><span class=\"n\">rdtscp</span><span class=\"w\"> </span><span class=\"n\">lm</span><span class=\"w\"> </span><span class=\"n\">constant_tsc</span><span class=\"w\"> </span><span class=\"n\">rep_good</span><span class=\"w\"> </span><span class=\"n\">nopl</span><span class=\"w\"> </span><span class=\"n\">xtopology</span><span class=\"w\"> </span><span class=\"n\">cpuid</span><span class=\"w\"> </span><span class=\"n\">pni</span><span class=\"w\"> </span><span class=\"n\">pclmulqdq</span><span class=\"w\"> </span><span class=\"n\">ssse3</span><span class=\"w\"> </span><span class=\"n\">fma</span><span class=\"w\"> </span><span class=\"n\">cx16</span><span class=\"w\"> </span><span class=\"n\">pcid</span><span class=\"w\"> </span><span class=\"n\">sse4_1</span><span class=\"w\"> </span><span class=\"n\">sse4_2</span><span class=\"w\"> </span><span class=\"n\">movbe</span><span class=\"w\"> </span><span class=\"n\">popcnt</span><span class=\"w\"> </span><span class=\"n\">aes</span><span class=\"w\"> </span><span class=\"n\">xsave</span><span class=\"w\"> </span><span class=\"n\">avx</span><span class=\"w\"> </span><span class=\"n\">f16c</span><span class=\"w\"> </span><span class=\"n\">rdrand</span><span class=\"w\"> </span><span class=\"n\">hypervisor</span><span class=\"w\"> </span><span class=\"n\">lahf_lm</span><span class=\"w\"> </span><span class=\"n\">abm</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"n\">dnowprefetch</span><span class=\"w\"> </span><span class=\"n\">invpcid_single</span><span class=\"w\"> </span><span class=\"n\">ssbd</span><span class=\"w\"> </span><span class=\"n\">ibrs</span><span class=\"w\"> </span><span class=\"n\">ibpb</span><span class=\"w\"> </span><span class=\"n\">stibp</span><span class=\"w\"> </span><span class=\"n\">ibrs_enhanced</span><span class=\"w\"> </span><span class=\"n\">fsgsbase</span><span class=\"w\"> </span><span class=\"n\">bmi1</span><span class=\"w\"> </span><span class=\"n\">avx2</span><span class=\"w\"> </span><span class=\"n\">smep</span><span class=\"w\"> </span><span class=\"n\">bmi2</span><span class=\"w\"> </span><span class=\"n\">erms</span><span class=\"w\"> </span><span class=\"n\">invpcid</span><span class=\"w\"> </span><span class=\"n\">rdseed</span><span class=\"w\"> </span><span class=\"n\">adx</span><span class=\"w\"> </span><span class=\"n\">smap</span><span class=\"w\"> </span><span class=\"n\">clflushopt</span><span class=\"w\"> </span><span class=\"n\">xsaveopt</span><span class=\"w\"> </span><span class=\"n\">xsavec</span><span class=\"w\"> </span><span class=\"n\">xgetbv1</span><span class=\"w\"> </span><span class=\"n\">xsaves</span><span class=\"w\"> </span><span class=\"n\">flush_l1d</span><span class=\"w\"> </span><span class=\"n\">arch_capabilities</span><span class=\"w\"></span>\n<span class=\"o\">..</span><span class=\"p\">.</span><span class=\"w\"></span>\n</code></pre></div>\n<p>It only happened when the argv of the program is not empty.</p>\n<h3>Expected Results</h3>\n<p>Run successfully</p>\n<h3>Actual Results</h3>\n<p>Segfault on wasi_config_inherit_argv</p>\n<h3>Versions and Environment</h3>\n<p>Wasmtime version or commit: v0.29.0</p>\n<p>Operating system: Linux run on WSL</p>\n<p>Architecture: x64</p>\n<h3>Extra Info</h3>\n</blockquote>",
        "id": 252587598,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1631175233
    },
    {
        "content": "<p>spacewander <a href=\"https://github.com/bytecodealliance/wasmtime/issues/3321#issuecomment-915870361\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/3321\">issue #3321</a>:</p>\n<blockquote>\n<p>I also notice a crash without <code>wasi_config_inherit_argv</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code>#<span class=\"mi\">0</span><span class=\"w\">  </span><span class=\"n\">__strlen_avx2</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">../</span><span class=\"n\">sysdeps</span><span class=\"o\">/</span><span class=\"n\">x86_64</span><span class=\"o\">/</span><span class=\"n\">multiarch</span><span class=\"o\">/</span><span class=\"n\">strlen</span><span class=\"o\">-</span><span class=\"n\">avx2</span><span class=\"p\">.</span><span class=\"n\">S</span>:<span class=\"mi\">65</span><span class=\"w\"></span>\n#<span class=\"mi\">1</span><span class=\"w\">  </span><span class=\"mh\">0x00007fbc04ec1e69</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">std</span>::<span class=\"n\">ffi</span>::<span class=\"n\">c_str</span>::<span class=\"n\">CStr</span>::<span class=\"n\">from_ptr</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">ffi</span><span class=\"o\">/</span><span class=\"n\">c_str</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">1174</span><span class=\"w\"></span>\n#<span class=\"mi\">2</span><span class=\"w\">  </span><span class=\"n\">std</span>::<span class=\"n\">sys</span>::<span class=\"n\">unix</span>::<span class=\"n\">args</span>::<span class=\"n\">imp</span>::<span class=\"n\">clone</span>::<span class=\"p\">{{</span><span class=\"n\">closure</span><span class=\"p\">}}</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">sys</span><span class=\"o\">/</span><span class=\"n\">unix</span><span class=\"o\">/</span><span class=\"n\">args</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">147</span><span class=\"w\"></span>\n#<span class=\"mi\">3</span><span class=\"w\">  </span><span class=\"n\">core</span>::<span class=\"n\">iter</span>::<span class=\"n\">adapters</span>::<span class=\"n\">map</span>::<span class=\"n\">map_fold</span>::<span class=\"p\">{{</span><span class=\"n\">closure</span><span class=\"p\">}}</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a178d0322ce20e33eac124758e837cbd80a6f633</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">iter</span><span class=\"o\">/</span><span class=\"n\">adapters</span><span class=\"o\">/</span><span class=\"n\">map</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">82</span><span class=\"w\"></span>\n#<span class=\"mi\">4</span><span class=\"w\">  </span><span class=\"n\">core</span>::<span class=\"n\">iter</span>::<span class=\"n\">traits</span>::<span class=\"n\">iterator</span>::<span class=\"nb\">Iterator</span>::<span class=\"n\">fold</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a178d0322ce20e33eac124758e837cbd80a6f633</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">iter</span><span class=\"o\">/</span><span class=\"n\">traits</span><span class=\"o\">/</span><span class=\"n\">iterator</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">2112</span><span class=\"w\"></span>\n#<span class=\"mi\">5</span><span class=\"w\">  </span><span class=\"o\">&lt;</span><span class=\"n\">core</span>::<span class=\"n\">iter</span>::<span class=\"n\">adapters</span>::<span class=\"n\">map</span>::<span class=\"n\">Map</span><span class=\"o\">&lt;</span><span class=\"n\">I</span><span class=\"p\">,</span><span class=\"n\">F</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">core</span>::<span class=\"n\">iter</span>::<span class=\"n\">traits</span>::<span class=\"n\">iterator</span>::<span class=\"nb\">Iterator</span><span class=\"o\">&gt;</span>::<span class=\"n\">fold</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a178d0322ce20e33eac124758e837cbd80a6f633</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">iter</span><span class=\"o\">/</span><span class=\"n\">adapters</span><span class=\"o\">/</span><span class=\"n\">map</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">122</span><span class=\"w\"></span>\n#<span class=\"mi\">6</span><span class=\"w\">  </span><span class=\"n\">core</span>::<span class=\"n\">iter</span>::<span class=\"n\">traits</span>::<span class=\"n\">iterator</span>::<span class=\"nb\">Iterator</span>::<span class=\"n\">for_each</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a178d0322ce20e33eac124758e837cbd80a6f633</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">iter</span><span class=\"o\">/</span><span class=\"n\">traits</span><span class=\"o\">/</span><span class=\"n\">iterator</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">736</span><span class=\"w\"></span>\n#<span class=\"mi\">7</span><span class=\"w\">  </span><span class=\"o\">&lt;</span><span class=\"n\">alloc</span>::<span class=\"n\">vec</span>::<span class=\"nb\">Vec</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"p\">,</span><span class=\"n\">A</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">alloc</span>::<span class=\"n\">vec</span>::<span class=\"n\">spec_extend</span>::<span class=\"n\">SpecExtend</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"p\">,</span><span class=\"n\">I</span><span class=\"o\">&gt;&gt;</span>::<span class=\"n\">spec_extend</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a178d0322ce20e33eac124758e837cbd80a6f633</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">alloc</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">vec</span><span class=\"o\">/</span><span class=\"n\">spec_extend</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">40</span><span class=\"w\"></span>\n#<span class=\"mi\">8</span><span class=\"w\">  </span><span class=\"o\">&lt;</span><span class=\"n\">alloc</span>::<span class=\"n\">vec</span>::<span class=\"nb\">Vec</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">alloc</span>::<span class=\"n\">vec</span>::<span class=\"n\">spec_from_iter_nested</span>::<span class=\"n\">SpecFromIterNested</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"p\">,</span><span class=\"n\">I</span><span class=\"o\">&gt;&gt;</span>::<span class=\"n\">from_iter</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a178d0322ce20e33eac124758e837cbd80a6f633</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">alloc</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">vec</span><span class=\"o\">/</span><span class=\"n\">spec_from_iter_nested</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">56</span><span class=\"w\"></span>\n#<span class=\"mi\">9</span><span class=\"w\">  </span><span class=\"o\">&lt;</span><span class=\"n\">alloc</span>::<span class=\"n\">vec</span>::<span class=\"nb\">Vec</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">alloc</span>::<span class=\"n\">vec</span>::<span class=\"n\">spec_from_iter</span>::<span class=\"n\">SpecFromIter</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"p\">,</span><span class=\"n\">I</span><span class=\"o\">&gt;&gt;</span>::<span class=\"n\">from_iter</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a178d0322ce20e33eac124758e837cbd80a6f633</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">alloc</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">vec</span><span class=\"o\">/</span><span class=\"n\">spec_from_iter</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">33</span><span class=\"w\"></span>\n#<span class=\"mi\">10</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">alloc</span>::<span class=\"n\">vec</span>::<span class=\"nb\">Vec</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">core</span>::<span class=\"n\">iter</span>::<span class=\"n\">traits</span>::<span class=\"n\">collect</span>::<span class=\"n\">FromIterator</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"o\">&gt;&gt;</span>::<span class=\"n\">from_iter</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a178d0322ce20e33eac124758e837cbd80a6f633</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">alloc</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">vec</span><span class=\"o\">/</span><span class=\"k\">mod</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">2449</span><span class=\"w\"></span>\n#<span class=\"mi\">11</span><span class=\"w\"> </span><span class=\"n\">core</span>::<span class=\"n\">iter</span>::<span class=\"n\">traits</span>::<span class=\"n\">iterator</span>::<span class=\"nb\">Iterator</span>::<span class=\"n\">collect</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a178d0322ce20e33eac124758e837cbd80a6f633</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">iter</span><span class=\"o\">/</span><span class=\"n\">traits</span><span class=\"o\">/</span><span class=\"n\">iterator</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">1748</span><span class=\"w\"></span>\n#<span class=\"mi\">12</span><span class=\"w\"> </span><span class=\"n\">std</span>::<span class=\"n\">sys</span>::<span class=\"n\">unix</span>::<span class=\"n\">args</span>::<span class=\"n\">imp</span>::<span class=\"n\">clone</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">sys</span><span class=\"o\">/</span><span class=\"n\">unix</span><span class=\"o\">/</span><span class=\"n\">args</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">145</span><span class=\"w\"></span>\n#<span class=\"mi\">13</span><span class=\"w\"> </span><span class=\"n\">std</span>::<span class=\"n\">sys</span>::<span class=\"n\">unix</span>::<span class=\"n\">args</span>::<span class=\"n\">imp</span>::<span class=\"n\">args</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">sys</span><span class=\"o\">/</span><span class=\"n\">unix</span><span class=\"o\">/</span><span class=\"n\">args</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">137</span><span class=\"w\"></span>\n#<span class=\"mi\">14</span><span class=\"w\"> </span><span class=\"n\">std</span>::<span class=\"n\">sys</span>::<span class=\"n\">unix</span>::<span class=\"n\">args</span>::<span class=\"n\">args</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">sys</span><span class=\"o\">/</span><span class=\"n\">unix</span><span class=\"o\">/</span><span class=\"n\">args</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">24</span><span class=\"w\"></span>\n#<span class=\"mi\">15</span><span class=\"w\"> </span><span class=\"n\">std</span>::<span class=\"n\">env</span>::<span class=\"n\">args_os</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">env</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">780</span><span class=\"w\"></span>\n#<span class=\"mi\">16</span><span class=\"w\"> </span><span class=\"mh\">0x00007fbc04ec1cf1</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">std</span>::<span class=\"n\">env</span>::<span class=\"n\">args</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">env</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">745</span><span class=\"w\"></span>\n#<span class=\"mi\">17</span><span class=\"w\"> </span><span class=\"mh\">0x00007fbc048eb112</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">wasi_cap_std_sync</span>::<span class=\"n\">WasiCtxBuilder</span>::<span class=\"n\">inherit_args</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">panicking</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">541</span><span class=\"w\"></span>\n#<span class=\"mi\">18</span><span class=\"w\"> </span><span class=\"mh\">0x00007fbc04842f55</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span>::<span class=\"n\">wasi</span>::<span class=\"n\">wasi_config_t</span>::<span class=\"n\">into_wasi_ctx</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">panicking</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">541</span><span class=\"w\"></span>\n#<span class=\"mi\">19</span><span class=\"w\"> </span><span class=\"mh\">0x00007fbc0478d92a</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">wasmtime_context_set_wasi</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">panicking</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">541</span><span class=\"w\"></span>\n#<span class=\"mi\">20</span><span class=\"w\"> </span><span class=\"mh\">0x000000000068c706</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"></span>\n</code></pre></div>\n<p>Same bt but starts from <code>error = wasmtime_context_set_wasi(context, vm_wasi_config);</code>, happened only with argv is given.</p>\n</blockquote>",
        "id": 252588478,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1631175661
    },
    {
        "content": "<p>spacewander deleted a <a href=\"https://github.com/bytecodealliance/wasmtime/issues/3321#issuecomment-915870361\">comment</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/3321\">issue #3321</a>:</p>\n<blockquote>\n<p>I also notice a crash without <code>wasi_config_inherit_argv</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code>#<span class=\"mi\">0</span><span class=\"w\">  </span><span class=\"n\">__strlen_avx2</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">../</span><span class=\"n\">sysdeps</span><span class=\"o\">/</span><span class=\"n\">x86_64</span><span class=\"o\">/</span><span class=\"n\">multiarch</span><span class=\"o\">/</span><span class=\"n\">strlen</span><span class=\"o\">-</span><span class=\"n\">avx2</span><span class=\"p\">.</span><span class=\"n\">S</span>:<span class=\"mi\">65</span><span class=\"w\"></span>\n#<span class=\"mi\">1</span><span class=\"w\">  </span><span class=\"mh\">0x00007fbc04ec1e69</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">std</span>::<span class=\"n\">ffi</span>::<span class=\"n\">c_str</span>::<span class=\"n\">CStr</span>::<span class=\"n\">from_ptr</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">ffi</span><span class=\"o\">/</span><span class=\"n\">c_str</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">1174</span><span class=\"w\"></span>\n#<span class=\"mi\">2</span><span class=\"w\">  </span><span class=\"n\">std</span>::<span class=\"n\">sys</span>::<span class=\"n\">unix</span>::<span class=\"n\">args</span>::<span class=\"n\">imp</span>::<span class=\"n\">clone</span>::<span class=\"p\">{{</span><span class=\"n\">closure</span><span class=\"p\">}}</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">sys</span><span class=\"o\">/</span><span class=\"n\">unix</span><span class=\"o\">/</span><span class=\"n\">args</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">147</span><span class=\"w\"></span>\n#<span class=\"mi\">3</span><span class=\"w\">  </span><span class=\"n\">core</span>::<span class=\"n\">iter</span>::<span class=\"n\">adapters</span>::<span class=\"n\">map</span>::<span class=\"n\">map_fold</span>::<span class=\"p\">{{</span><span class=\"n\">closure</span><span class=\"p\">}}</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a178d0322ce20e33eac124758e837cbd80a6f633</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">iter</span><span class=\"o\">/</span><span class=\"n\">adapters</span><span class=\"o\">/</span><span class=\"n\">map</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">82</span><span class=\"w\"></span>\n#<span class=\"mi\">4</span><span class=\"w\">  </span><span class=\"n\">core</span>::<span class=\"n\">iter</span>::<span class=\"n\">traits</span>::<span class=\"n\">iterator</span>::<span class=\"nb\">Iterator</span>::<span class=\"n\">fold</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a178d0322ce20e33eac124758e837cbd80a6f633</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">iter</span><span class=\"o\">/</span><span class=\"n\">traits</span><span class=\"o\">/</span><span class=\"n\">iterator</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">2112</span><span class=\"w\"></span>\n#<span class=\"mi\">5</span><span class=\"w\">  </span><span class=\"o\">&lt;</span><span class=\"n\">core</span>::<span class=\"n\">iter</span>::<span class=\"n\">adapters</span>::<span class=\"n\">map</span>::<span class=\"n\">Map</span><span class=\"o\">&lt;</span><span class=\"n\">I</span><span class=\"p\">,</span><span class=\"n\">F</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">core</span>::<span class=\"n\">iter</span>::<span class=\"n\">traits</span>::<span class=\"n\">iterator</span>::<span class=\"nb\">Iterator</span><span class=\"o\">&gt;</span>::<span class=\"n\">fold</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a178d0322ce20e33eac124758e837cbd80a6f633</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">iter</span><span class=\"o\">/</span><span class=\"n\">adapters</span><span class=\"o\">/</span><span class=\"n\">map</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">122</span><span class=\"w\"></span>\n#<span class=\"mi\">6</span><span class=\"w\">  </span><span class=\"n\">core</span>::<span class=\"n\">iter</span>::<span class=\"n\">traits</span>::<span class=\"n\">iterator</span>::<span class=\"nb\">Iterator</span>::<span class=\"n\">for_each</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a178d0322ce20e33eac124758e837cbd80a6f633</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">iter</span><span class=\"o\">/</span><span class=\"n\">traits</span><span class=\"o\">/</span><span class=\"n\">iterator</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">736</span><span class=\"w\"></span>\n#<span class=\"mi\">7</span><span class=\"w\">  </span><span class=\"o\">&lt;</span><span class=\"n\">alloc</span>::<span class=\"n\">vec</span>::<span class=\"nb\">Vec</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"p\">,</span><span class=\"n\">A</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">alloc</span>::<span class=\"n\">vec</span>::<span class=\"n\">spec_extend</span>::<span class=\"n\">SpecExtend</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"p\">,</span><span class=\"n\">I</span><span class=\"o\">&gt;&gt;</span>::<span class=\"n\">spec_extend</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a178d0322ce20e33eac124758e837cbd80a6f633</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">alloc</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">vec</span><span class=\"o\">/</span><span class=\"n\">spec_extend</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">40</span><span class=\"w\"></span>\n#<span class=\"mi\">8</span><span class=\"w\">  </span><span class=\"o\">&lt;</span><span class=\"n\">alloc</span>::<span class=\"n\">vec</span>::<span class=\"nb\">Vec</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">alloc</span>::<span class=\"n\">vec</span>::<span class=\"n\">spec_from_iter_nested</span>::<span class=\"n\">SpecFromIterNested</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"p\">,</span><span class=\"n\">I</span><span class=\"o\">&gt;&gt;</span>::<span class=\"n\">from_iter</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a178d0322ce20e33eac124758e837cbd80a6f633</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">alloc</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">vec</span><span class=\"o\">/</span><span class=\"n\">spec_from_iter_nested</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">56</span><span class=\"w\"></span>\n#<span class=\"mi\">9</span><span class=\"w\">  </span><span class=\"o\">&lt;</span><span class=\"n\">alloc</span>::<span class=\"n\">vec</span>::<span class=\"nb\">Vec</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">alloc</span>::<span class=\"n\">vec</span>::<span class=\"n\">spec_from_iter</span>::<span class=\"n\">SpecFromIter</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"p\">,</span><span class=\"n\">I</span><span class=\"o\">&gt;&gt;</span>::<span class=\"n\">from_iter</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a178d0322ce20e33eac124758e837cbd80a6f633</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">alloc</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">vec</span><span class=\"o\">/</span><span class=\"n\">spec_from_iter</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">33</span><span class=\"w\"></span>\n#<span class=\"mi\">10</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">alloc</span>::<span class=\"n\">vec</span>::<span class=\"nb\">Vec</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">core</span>::<span class=\"n\">iter</span>::<span class=\"n\">traits</span>::<span class=\"n\">collect</span>::<span class=\"n\">FromIterator</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"o\">&gt;&gt;</span>::<span class=\"n\">from_iter</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a178d0322ce20e33eac124758e837cbd80a6f633</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">alloc</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">vec</span><span class=\"o\">/</span><span class=\"k\">mod</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">2449</span><span class=\"w\"></span>\n#<span class=\"mi\">11</span><span class=\"w\"> </span><span class=\"n\">core</span>::<span class=\"n\">iter</span>::<span class=\"n\">traits</span>::<span class=\"n\">iterator</span>::<span class=\"nb\">Iterator</span>::<span class=\"n\">collect</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a178d0322ce20e33eac124758e837cbd80a6f633</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">iter</span><span class=\"o\">/</span><span class=\"n\">traits</span><span class=\"o\">/</span><span class=\"n\">iterator</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">1748</span><span class=\"w\"></span>\n#<span class=\"mi\">12</span><span class=\"w\"> </span><span class=\"n\">std</span>::<span class=\"n\">sys</span>::<span class=\"n\">unix</span>::<span class=\"n\">args</span>::<span class=\"n\">imp</span>::<span class=\"n\">clone</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">sys</span><span class=\"o\">/</span><span class=\"n\">unix</span><span class=\"o\">/</span><span class=\"n\">args</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">145</span><span class=\"w\"></span>\n#<span class=\"mi\">13</span><span class=\"w\"> </span><span class=\"n\">std</span>::<span class=\"n\">sys</span>::<span class=\"n\">unix</span>::<span class=\"n\">args</span>::<span class=\"n\">imp</span>::<span class=\"n\">args</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">sys</span><span class=\"o\">/</span><span class=\"n\">unix</span><span class=\"o\">/</span><span class=\"n\">args</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">137</span><span class=\"w\"></span>\n#<span class=\"mi\">14</span><span class=\"w\"> </span><span class=\"n\">std</span>::<span class=\"n\">sys</span>::<span class=\"n\">unix</span>::<span class=\"n\">args</span>::<span class=\"n\">args</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">sys</span><span class=\"o\">/</span><span class=\"n\">unix</span><span class=\"o\">/</span><span class=\"n\">args</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">24</span><span class=\"w\"></span>\n#<span class=\"mi\">15</span><span class=\"w\"> </span><span class=\"n\">std</span>::<span class=\"n\">env</span>::<span class=\"n\">args_os</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">env</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">780</span><span class=\"w\"></span>\n#<span class=\"mi\">16</span><span class=\"w\"> </span><span class=\"mh\">0x00007fbc04ec1cf1</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">std</span>::<span class=\"n\">env</span>::<span class=\"n\">args</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">env</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">745</span><span class=\"w\"></span>\n#<span class=\"mi\">17</span><span class=\"w\"> </span><span class=\"mh\">0x00007fbc048eb112</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">wasi_cap_std_sync</span>::<span class=\"n\">WasiCtxBuilder</span>::<span class=\"n\">inherit_args</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">panicking</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">541</span><span class=\"w\"></span>\n#<span class=\"mi\">18</span><span class=\"w\"> </span><span class=\"mh\">0x00007fbc04842f55</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span>::<span class=\"n\">wasi</span>::<span class=\"n\">wasi_config_t</span>::<span class=\"n\">into_wasi_ctx</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">panicking</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">541</span><span class=\"w\"></span>\n#<span class=\"mi\">19</span><span class=\"w\"> </span><span class=\"mh\">0x00007fbc0478d92a</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">wasmtime_context_set_wasi</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">panicking</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">541</span><span class=\"w\"></span>\n#<span class=\"mi\">20</span><span class=\"w\"> </span><span class=\"mh\">0x000000000068c706</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"></span>\n</code></pre></div>\n<p>Same bt but starts from <code>error = wasmtime_context_set_wasi(context, vm_wasi_config);</code>, happened only with argv is given.</p>\n</blockquote>",
        "id": 252589221,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1631176016
    },
    {
        "content": "<p>spacewander <a href=\"https://github.com/bytecodealliance/wasmtime/issues/3321#issuecomment-915889569\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/3321\">issue #3321</a>:</p>\n<blockquote>\n<p>Look like it is because I called wasmtime_context_set_wasi twice on the same wasi_config.</p>\n</blockquote>",
        "id": 252591688,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1631177309
    },
    {
        "content": "<p>spacewander closed <a href=\"https://github.com/bytecodealliance/wasmtime/issues/3321\">issue #3321</a>:</p>\n<blockquote>\n<h3>Test Case</h3>\n<h3>Steps to Reproduce</h3>\n<p>When I try to integrate wasmtime to my host program written in C, the program crashed during executing</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"w\">    </span><span class=\"n\">vm_wasi_config</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">wasi_config_new</span><span class=\"p\">();</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">vm_wasi_config</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"n\">NULL</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"n\">goto</span><span class=\"w\"> </span><span class=\"o\">..</span><span class=\"p\">.;</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">}</span><span class=\"w\"></span>\n\n<span class=\"w\">    </span><span class=\"n\">wasi_config_inherit_argv</span><span class=\"p\">(</span><span class=\"n\">vm_wasi_config</span><span class=\"p\">);</span><span class=\"w\"> </span><span class=\"cm\">/* &lt;- this line! */</span><span class=\"w\"></span>\n</code></pre></div>\n<p>The bt is:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code>#<span class=\"mi\">0</span><span class=\"w\">  </span><span class=\"n\">__strlen_avx2</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">../</span><span class=\"n\">sysdeps</span><span class=\"o\">/</span><span class=\"n\">x86_64</span><span class=\"o\">/</span><span class=\"n\">multiarch</span><span class=\"o\">/</span><span class=\"n\">strlen</span><span class=\"o\">-</span><span class=\"n\">avx2</span><span class=\"p\">.</span><span class=\"n\">S</span>:<span class=\"mi\">65</span><span class=\"w\"></span>\n#<span class=\"mi\">1</span><span class=\"w\">  </span><span class=\"mh\">0x00007ff7c2b4ee69</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">std</span>::<span class=\"n\">ffi</span>::<span class=\"n\">c_str</span>::<span class=\"n\">CStr</span>::<span class=\"n\">from_ptr</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">ffi</span><span class=\"o\">/</span><span class=\"n\">c_str</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">1174</span><span class=\"w\"></span>\n#<span class=\"mi\">2</span><span class=\"w\">  </span><span class=\"n\">std</span>::<span class=\"n\">sys</span>::<span class=\"n\">unix</span>::<span class=\"n\">args</span>::<span class=\"n\">imp</span>::<span class=\"n\">clone</span>::<span class=\"p\">{{</span><span class=\"n\">closure</span><span class=\"p\">}}</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">sys</span><span class=\"o\">/</span><span class=\"n\">unix</span><span class=\"o\">/</span><span class=\"n\">args</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">147</span><span class=\"w\"></span>\n#<span class=\"mi\">3</span><span class=\"w\">  </span><span class=\"n\">core</span>::<span class=\"n\">iter</span>::<span class=\"n\">adapters</span>::<span class=\"n\">map</span>::<span class=\"n\">map_fold</span>::<span class=\"p\">{{</span><span class=\"n\">closure</span><span class=\"p\">}}</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a178d0322ce20e33eac124758e837cbd80a6f633</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">iter</span><span class=\"o\">/</span><span class=\"n\">adapters</span><span class=\"o\">/</span><span class=\"n\">map</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">82</span><span class=\"w\"></span>\n#<span class=\"mi\">4</span><span class=\"w\">  </span><span class=\"n\">core</span>::<span class=\"n\">iter</span>::<span class=\"n\">traits</span>::<span class=\"n\">iterator</span>::<span class=\"nb\">Iterator</span>::<span class=\"n\">fold</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a178d0322ce20e33eac124758e837cbd80a6f633</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">iter</span><span class=\"o\">/</span><span class=\"n\">traits</span><span class=\"o\">/</span><span class=\"n\">iterator</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">2112</span><span class=\"w\"></span>\n#<span class=\"mi\">5</span><span class=\"w\">  </span><span class=\"o\">&lt;</span><span class=\"n\">core</span>::<span class=\"n\">iter</span>::<span class=\"n\">adapters</span>::<span class=\"n\">map</span>::<span class=\"n\">Map</span><span class=\"o\">&lt;</span><span class=\"n\">I</span><span class=\"p\">,</span><span class=\"n\">F</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">core</span>::<span class=\"n\">iter</span>::<span class=\"n\">traits</span>::<span class=\"n\">iterator</span>::<span class=\"nb\">Iterator</span><span class=\"o\">&gt;</span>::<span class=\"n\">fold</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a178d0322ce20e33eac124758e837cbd80a6f633</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">iter</span><span class=\"o\">/</span><span class=\"n\">adapters</span><span class=\"o\">/</span><span class=\"n\">map</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">122</span><span class=\"w\"></span>\n#<span class=\"mi\">6</span><span class=\"w\">  </span><span class=\"n\">core</span>::<span class=\"n\">iter</span>::<span class=\"n\">traits</span>::<span class=\"n\">iterator</span>::<span class=\"nb\">Iterator</span>::<span class=\"n\">for_each</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a178d0322ce20e33eac124758e837cbd80a6f633</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">iter</span><span class=\"o\">/</span><span class=\"n\">traits</span><span class=\"o\">/</span><span class=\"n\">iterator</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">736</span><span class=\"w\"></span>\n#<span class=\"mi\">7</span><span class=\"w\">  </span><span class=\"o\">&lt;</span><span class=\"n\">alloc</span>::<span class=\"n\">vec</span>::<span class=\"nb\">Vec</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"p\">,</span><span class=\"n\">A</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">alloc</span>::<span class=\"n\">vec</span>::<span class=\"n\">spec_extend</span>::<span class=\"n\">SpecExtend</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"p\">,</span><span class=\"n\">I</span><span class=\"o\">&gt;&gt;</span>::<span class=\"n\">spec_extend</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a178d0322ce20e33eac124758e837cbd80a6f633</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">alloc</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">vec</span><span class=\"o\">/</span><span class=\"n\">spec_extend</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">40</span><span class=\"w\"></span>\n#<span class=\"mi\">8</span><span class=\"w\">  </span><span class=\"o\">&lt;</span><span class=\"n\">alloc</span>::<span class=\"n\">vec</span>::<span class=\"nb\">Vec</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">alloc</span>::<span class=\"n\">vec</span>::<span class=\"n\">spec_from_iter_nested</span>::<span class=\"n\">SpecFromIterNested</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"p\">,</span><span class=\"n\">I</span><span class=\"o\">&gt;&gt;</span>::<span class=\"n\">from_iter</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a178d0322ce20e33eac124758e837cbd80a6f633</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">alloc</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">vec</span><span class=\"o\">/</span><span class=\"n\">spec_from_iter_nested</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">56</span><span class=\"w\"></span>\n#<span class=\"mi\">9</span><span class=\"w\">  </span><span class=\"o\">&lt;</span><span class=\"n\">alloc</span>::<span class=\"n\">vec</span>::<span class=\"nb\">Vec</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">alloc</span>::<span class=\"n\">vec</span>::<span class=\"n\">spec_from_iter</span>::<span class=\"n\">SpecFromIter</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"p\">,</span><span class=\"n\">I</span><span class=\"o\">&gt;&gt;</span>::<span class=\"n\">from_iter</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a178d0322ce20e33eac124758e837cbd80a6f633</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">alloc</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">vec</span><span class=\"o\">/</span><span class=\"n\">spec_from_iter</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">33</span><span class=\"w\"></span>\n#<span class=\"mi\">10</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">alloc</span>::<span class=\"n\">vec</span>::<span class=\"nb\">Vec</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">core</span>::<span class=\"n\">iter</span>::<span class=\"n\">traits</span>::<span class=\"n\">collect</span>::<span class=\"n\">FromIterator</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"o\">&gt;&gt;</span>::<span class=\"n\">from_iter</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a178d0322ce20e33eac124758e837cbd80a6f633</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">alloc</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">vec</span><span class=\"o\">/</span><span class=\"k\">mod</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">2449</span><span class=\"w\"></span>\n#<span class=\"mi\">11</span><span class=\"w\"> </span><span class=\"n\">core</span>::<span class=\"n\">iter</span>::<span class=\"n\">traits</span>::<span class=\"n\">iterator</span>::<span class=\"nb\">Iterator</span>::<span class=\"n\">collect</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a178d0322ce20e33eac124758e837cbd80a6f633</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">iter</span><span class=\"o\">/</span><span class=\"n\">traits</span><span class=\"o\">/</span><span class=\"n\">iterator</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">1748</span><span class=\"w\"></span>\n#<span class=\"mi\">12</span><span class=\"w\"> </span><span class=\"n\">std</span>::<span class=\"n\">sys</span>::<span class=\"n\">unix</span>::<span class=\"n\">args</span>::<span class=\"n\">imp</span>::<span class=\"n\">clone</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">sys</span><span class=\"o\">/</span><span class=\"n\">unix</span><span class=\"o\">/</span><span class=\"n\">args</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">145</span><span class=\"w\"></span>\n#<span class=\"mi\">13</span><span class=\"w\"> </span><span class=\"n\">std</span>::<span class=\"n\">sys</span>::<span class=\"n\">unix</span>::<span class=\"n\">args</span>::<span class=\"n\">imp</span>::<span class=\"n\">args</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">sys</span><span class=\"o\">/</span><span class=\"n\">unix</span><span class=\"o\">/</span><span class=\"n\">args</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">137</span><span class=\"w\"></span>\n#<span class=\"mi\">14</span><span class=\"w\"> </span><span class=\"n\">std</span>::<span class=\"n\">sys</span>::<span class=\"n\">unix</span>::<span class=\"n\">args</span>::<span class=\"n\">args</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">sys</span><span class=\"o\">/</span><span class=\"n\">unix</span><span class=\"o\">/</span><span class=\"n\">args</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">24</span><span class=\"w\"></span>\n#<span class=\"mi\">15</span><span class=\"w\"> </span><span class=\"n\">std</span>::<span class=\"n\">env</span>::<span class=\"n\">args_os</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">env</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">780</span><span class=\"w\"></span>\n#<span class=\"mi\">16</span><span class=\"w\"> </span><span class=\"mh\">0x00007ff7c2b4ecf1</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">std</span>::<span class=\"n\">env</span>::<span class=\"n\">args</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">env</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">745</span><span class=\"w\"></span>\n#<span class=\"mi\">17</span><span class=\"w\"> </span><span class=\"mh\">0x00007ff7c2578112</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">wasi_cap_std_sync</span>::<span class=\"n\">WasiCtxBuilder</span>::<span class=\"n\">inherit_args</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">panicking</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">541</span><span class=\"w\"></span>\n#<span class=\"mi\">18</span><span class=\"w\"> </span><span class=\"mh\">0x00007ff7c24cff55</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span>::<span class=\"n\">wasi</span>::<span class=\"n\">wasi_config_t</span>::<span class=\"n\">into_wasi_ctx</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">panicking</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">541</span><span class=\"w\"></span>\n#<span class=\"mi\">19</span><span class=\"w\"> </span><span class=\"mh\">0x00007ff7c241a92a</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">wasmtime_context_set_wasi</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">panicking</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">541</span><span class=\"w\"></span>\n#<span class=\"mi\">20</span><span class=\"w\"> </span><span class=\"mh\">0x000000000068c766</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"o\">..</span><span class=\"p\">.</span><span class=\"w\"></span>\n</code></pre></div>\n<p>My CPU has avx2 support:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">grep</span><span class=\"w\"> </span><span class=\"n\">avx2</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">proc</span><span class=\"o\">/</span><span class=\"n\">cpuinfo</span><span class=\"w\"></span>\n<span class=\"n\">flags</span><span class=\"w\">           </span>: <span class=\"nc\">fpu</span><span class=\"w\"> </span><span class=\"n\">vme</span><span class=\"w\"> </span><span class=\"n\">de</span><span class=\"w\"> </span><span class=\"n\">pse</span><span class=\"w\"> </span><span class=\"n\">tsc</span><span class=\"w\"> </span><span class=\"n\">msr</span><span class=\"w\"> </span><span class=\"n\">pae</span><span class=\"w\"> </span><span class=\"n\">mce</span><span class=\"w\"> </span><span class=\"n\">cx8</span><span class=\"w\"> </span><span class=\"n\">apic</span><span class=\"w\"> </span><span class=\"n\">sep</span><span class=\"w\"> </span><span class=\"n\">mtrr</span><span class=\"w\"> </span><span class=\"n\">pge</span><span class=\"w\"> </span><span class=\"n\">mca</span><span class=\"w\"> </span><span class=\"n\">cmov</span><span class=\"w\"> </span><span class=\"n\">pat</span><span class=\"w\"> </span><span class=\"n\">pse36</span><span class=\"w\"> </span><span class=\"n\">clflush</span><span class=\"w\"> </span><span class=\"n\">mmx</span><span class=\"w\"> </span><span class=\"n\">fxsr</span><span class=\"w\"> </span><span class=\"n\">sse</span><span class=\"w\"> </span><span class=\"n\">sse2</span><span class=\"w\"> </span><span class=\"n\">ss</span><span class=\"w\"> </span><span class=\"n\">ht</span><span class=\"w\"> </span><span class=\"n\">syscall</span><span class=\"w\"> </span><span class=\"n\">nx</span><span class=\"w\"> </span><span class=\"n\">pdpe1gb</span><span class=\"w\"> </span><span class=\"n\">rdtscp</span><span class=\"w\"> </span><span class=\"n\">lm</span><span class=\"w\"> </span><span class=\"n\">constant_tsc</span><span class=\"w\"> </span><span class=\"n\">rep_good</span><span class=\"w\"> </span><span class=\"n\">nopl</span><span class=\"w\"> </span><span class=\"n\">xtopology</span><span class=\"w\"> </span><span class=\"n\">cpuid</span><span class=\"w\"> </span><span class=\"n\">pni</span><span class=\"w\"> </span><span class=\"n\">pclmulqdq</span><span class=\"w\"> </span><span class=\"n\">ssse3</span><span class=\"w\"> </span><span class=\"n\">fma</span><span class=\"w\"> </span><span class=\"n\">cx16</span><span class=\"w\"> </span><span class=\"n\">pcid</span><span class=\"w\"> </span><span class=\"n\">sse4_1</span><span class=\"w\"> </span><span class=\"n\">sse4_2</span><span class=\"w\"> </span><span class=\"n\">movbe</span><span class=\"w\"> </span><span class=\"n\">popcnt</span><span class=\"w\"> </span><span class=\"n\">aes</span><span class=\"w\"> </span><span class=\"n\">xsave</span><span class=\"w\"> </span><span class=\"n\">avx</span><span class=\"w\"> </span><span class=\"n\">f16c</span><span class=\"w\"> </span><span class=\"n\">rdrand</span><span class=\"w\"> </span><span class=\"n\">hypervisor</span><span class=\"w\"> </span><span class=\"n\">lahf_lm</span><span class=\"w\"> </span><span class=\"n\">abm</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"n\">dnowprefetch</span><span class=\"w\"> </span><span class=\"n\">invpcid_single</span><span class=\"w\"> </span><span class=\"n\">ssbd</span><span class=\"w\"> </span><span class=\"n\">ibrs</span><span class=\"w\"> </span><span class=\"n\">ibpb</span><span class=\"w\"> </span><span class=\"n\">stibp</span><span class=\"w\"> </span><span class=\"n\">ibrs_enhanced</span><span class=\"w\"> </span><span class=\"n\">fsgsbase</span><span class=\"w\"> </span><span class=\"n\">bmi1</span><span class=\"w\"> </span><span class=\"n\">avx2</span><span class=\"w\"> </span><span class=\"n\">smep</span><span class=\"w\"> </span><span class=\"n\">bmi2</span><span class=\"w\"> </span><span class=\"n\">erms</span><span class=\"w\"> </span><span class=\"n\">invpcid</span><span class=\"w\"> </span><span class=\"n\">rdseed</span><span class=\"w\"> </span><span class=\"n\">adx</span><span class=\"w\"> </span><span class=\"n\">smap</span><span class=\"w\"> </span><span class=\"n\">clflushopt</span><span class=\"w\"> </span><span class=\"n\">xsaveopt</span><span class=\"w\"> </span><span class=\"n\">xsavec</span><span class=\"w\"> </span><span class=\"n\">xgetbv1</span><span class=\"w\"> </span><span class=\"n\">xsaves</span><span class=\"w\"> </span><span class=\"n\">flush_l1d</span><span class=\"w\"> </span><span class=\"n\">arch_capabilities</span><span class=\"w\"></span>\n<span class=\"o\">..</span><span class=\"p\">.</span><span class=\"w\"></span>\n</code></pre></div>\n<p>It only happened when the argv of the program is not empty.</p>\n<h3>Expected Results</h3>\n<p>Run successfully</p>\n<h3>Actual Results</h3>\n<p>Segfault on wasi_config_inherit_argv</p>\n<h3>Versions and Environment</h3>\n<p>Wasmtime version or commit: v0.29.0</p>\n<p>Operating system: Linux run on WSL</p>\n<p>Architecture: x64</p>\n<h3>Extra Info</h3>\n</blockquote>",
        "id": 252591689,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1631177310
    },
    {
        "content": "<p>bjorn3 <a href=\"https://github.com/bytecodealliance/wasmtime/issues/3321#issuecomment-915906334\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/3321\">issue #3321</a>:</p>\n<blockquote>\n<p>I think doing so shouldn't cause a SIGSEGV. At most it should case a panic or abort IMHO.</p>\n</blockquote>",
        "id": 252594315,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1631178662
    },
    {
        "content": "<p>spacewander <a href=\"https://github.com/bytecodealliance/wasmtime/issues/3321#issuecomment-915930165\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/3321\">issue #3321</a>:</p>\n<blockquote>\n<p>It is quite weird. Even I can confirm the <code>wasmtime_context_set_wasi</code> is called once, the same thing can happen again. Remove <code>wasi_config_inherit_argv</code> so far make a segfault disappear.</p>\n</blockquote>",
        "id": 252598238,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1631180598
    },
    {
        "content": "<p>spacewander reopened <a href=\"https://github.com/bytecodealliance/wasmtime/issues/3321\">issue #3321</a>:</p>\n<blockquote>\n<h3>Test Case</h3>\n<h3>Steps to Reproduce</h3>\n<p>When I try to integrate wasmtime to my host program written in C, the program crashed during executing</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"w\">    </span><span class=\"n\">vm_wasi_config</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">wasi_config_new</span><span class=\"p\">();</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">vm_wasi_config</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"n\">NULL</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"n\">goto</span><span class=\"w\"> </span><span class=\"o\">..</span><span class=\"p\">.;</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">}</span><span class=\"w\"></span>\n\n<span class=\"w\">    </span><span class=\"n\">wasi_config_inherit_argv</span><span class=\"p\">(</span><span class=\"n\">vm_wasi_config</span><span class=\"p\">);</span><span class=\"w\"> </span><span class=\"cm\">/* &lt;- this line! */</span><span class=\"w\"></span>\n</code></pre></div>\n<p>The bt is:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code>#<span class=\"mi\">0</span><span class=\"w\">  </span><span class=\"n\">__strlen_avx2</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">../</span><span class=\"n\">sysdeps</span><span class=\"o\">/</span><span class=\"n\">x86_64</span><span class=\"o\">/</span><span class=\"n\">multiarch</span><span class=\"o\">/</span><span class=\"n\">strlen</span><span class=\"o\">-</span><span class=\"n\">avx2</span><span class=\"p\">.</span><span class=\"n\">S</span>:<span class=\"mi\">65</span><span class=\"w\"></span>\n#<span class=\"mi\">1</span><span class=\"w\">  </span><span class=\"mh\">0x00007ff7c2b4ee69</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">std</span>::<span class=\"n\">ffi</span>::<span class=\"n\">c_str</span>::<span class=\"n\">CStr</span>::<span class=\"n\">from_ptr</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">ffi</span><span class=\"o\">/</span><span class=\"n\">c_str</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">1174</span><span class=\"w\"></span>\n#<span class=\"mi\">2</span><span class=\"w\">  </span><span class=\"n\">std</span>::<span class=\"n\">sys</span>::<span class=\"n\">unix</span>::<span class=\"n\">args</span>::<span class=\"n\">imp</span>::<span class=\"n\">clone</span>::<span class=\"p\">{{</span><span class=\"n\">closure</span><span class=\"p\">}}</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">sys</span><span class=\"o\">/</span><span class=\"n\">unix</span><span class=\"o\">/</span><span class=\"n\">args</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">147</span><span class=\"w\"></span>\n#<span class=\"mi\">3</span><span class=\"w\">  </span><span class=\"n\">core</span>::<span class=\"n\">iter</span>::<span class=\"n\">adapters</span>::<span class=\"n\">map</span>::<span class=\"n\">map_fold</span>::<span class=\"p\">{{</span><span class=\"n\">closure</span><span class=\"p\">}}</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a178d0322ce20e33eac124758e837cbd80a6f633</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">iter</span><span class=\"o\">/</span><span class=\"n\">adapters</span><span class=\"o\">/</span><span class=\"n\">map</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">82</span><span class=\"w\"></span>\n#<span class=\"mi\">4</span><span class=\"w\">  </span><span class=\"n\">core</span>::<span class=\"n\">iter</span>::<span class=\"n\">traits</span>::<span class=\"n\">iterator</span>::<span class=\"nb\">Iterator</span>::<span class=\"n\">fold</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a178d0322ce20e33eac124758e837cbd80a6f633</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">iter</span><span class=\"o\">/</span><span class=\"n\">traits</span><span class=\"o\">/</span><span class=\"n\">iterator</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">2112</span><span class=\"w\"></span>\n#<span class=\"mi\">5</span><span class=\"w\">  </span><span class=\"o\">&lt;</span><span class=\"n\">core</span>::<span class=\"n\">iter</span>::<span class=\"n\">adapters</span>::<span class=\"n\">map</span>::<span class=\"n\">Map</span><span class=\"o\">&lt;</span><span class=\"n\">I</span><span class=\"p\">,</span><span class=\"n\">F</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">core</span>::<span class=\"n\">iter</span>::<span class=\"n\">traits</span>::<span class=\"n\">iterator</span>::<span class=\"nb\">Iterator</span><span class=\"o\">&gt;</span>::<span class=\"n\">fold</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a178d0322ce20e33eac124758e837cbd80a6f633</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">iter</span><span class=\"o\">/</span><span class=\"n\">adapters</span><span class=\"o\">/</span><span class=\"n\">map</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">122</span><span class=\"w\"></span>\n#<span class=\"mi\">6</span><span class=\"w\">  </span><span class=\"n\">core</span>::<span class=\"n\">iter</span>::<span class=\"n\">traits</span>::<span class=\"n\">iterator</span>::<span class=\"nb\">Iterator</span>::<span class=\"n\">for_each</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a178d0322ce20e33eac124758e837cbd80a6f633</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">iter</span><span class=\"o\">/</span><span class=\"n\">traits</span><span class=\"o\">/</span><span class=\"n\">iterator</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">736</span><span class=\"w\"></span>\n#<span class=\"mi\">7</span><span class=\"w\">  </span><span class=\"o\">&lt;</span><span class=\"n\">alloc</span>::<span class=\"n\">vec</span>::<span class=\"nb\">Vec</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"p\">,</span><span class=\"n\">A</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">alloc</span>::<span class=\"n\">vec</span>::<span class=\"n\">spec_extend</span>::<span class=\"n\">SpecExtend</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"p\">,</span><span class=\"n\">I</span><span class=\"o\">&gt;&gt;</span>::<span class=\"n\">spec_extend</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a178d0322ce20e33eac124758e837cbd80a6f633</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">alloc</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">vec</span><span class=\"o\">/</span><span class=\"n\">spec_extend</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">40</span><span class=\"w\"></span>\n#<span class=\"mi\">8</span><span class=\"w\">  </span><span class=\"o\">&lt;</span><span class=\"n\">alloc</span>::<span class=\"n\">vec</span>::<span class=\"nb\">Vec</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">alloc</span>::<span class=\"n\">vec</span>::<span class=\"n\">spec_from_iter_nested</span>::<span class=\"n\">SpecFromIterNested</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"p\">,</span><span class=\"n\">I</span><span class=\"o\">&gt;&gt;</span>::<span class=\"n\">from_iter</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a178d0322ce20e33eac124758e837cbd80a6f633</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">alloc</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">vec</span><span class=\"o\">/</span><span class=\"n\">spec_from_iter_nested</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">56</span><span class=\"w\"></span>\n#<span class=\"mi\">9</span><span class=\"w\">  </span><span class=\"o\">&lt;</span><span class=\"n\">alloc</span>::<span class=\"n\">vec</span>::<span class=\"nb\">Vec</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">alloc</span>::<span class=\"n\">vec</span>::<span class=\"n\">spec_from_iter</span>::<span class=\"n\">SpecFromIter</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"p\">,</span><span class=\"n\">I</span><span class=\"o\">&gt;&gt;</span>::<span class=\"n\">from_iter</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a178d0322ce20e33eac124758e837cbd80a6f633</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">alloc</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">vec</span><span class=\"o\">/</span><span class=\"n\">spec_from_iter</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">33</span><span class=\"w\"></span>\n#<span class=\"mi\">10</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">alloc</span>::<span class=\"n\">vec</span>::<span class=\"nb\">Vec</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">core</span>::<span class=\"n\">iter</span>::<span class=\"n\">traits</span>::<span class=\"n\">collect</span>::<span class=\"n\">FromIterator</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"o\">&gt;&gt;</span>::<span class=\"n\">from_iter</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a178d0322ce20e33eac124758e837cbd80a6f633</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">alloc</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">vec</span><span class=\"o\">/</span><span class=\"k\">mod</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">2449</span><span class=\"w\"></span>\n#<span class=\"mi\">11</span><span class=\"w\"> </span><span class=\"n\">core</span>::<span class=\"n\">iter</span>::<span class=\"n\">traits</span>::<span class=\"n\">iterator</span>::<span class=\"nb\">Iterator</span>::<span class=\"n\">collect</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a178d0322ce20e33eac124758e837cbd80a6f633</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">iter</span><span class=\"o\">/</span><span class=\"n\">traits</span><span class=\"o\">/</span><span class=\"n\">iterator</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">1748</span><span class=\"w\"></span>\n#<span class=\"mi\">12</span><span class=\"w\"> </span><span class=\"n\">std</span>::<span class=\"n\">sys</span>::<span class=\"n\">unix</span>::<span class=\"n\">args</span>::<span class=\"n\">imp</span>::<span class=\"n\">clone</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">sys</span><span class=\"o\">/</span><span class=\"n\">unix</span><span class=\"o\">/</span><span class=\"n\">args</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">145</span><span class=\"w\"></span>\n#<span class=\"mi\">13</span><span class=\"w\"> </span><span class=\"n\">std</span>::<span class=\"n\">sys</span>::<span class=\"n\">unix</span>::<span class=\"n\">args</span>::<span class=\"n\">imp</span>::<span class=\"n\">args</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">sys</span><span class=\"o\">/</span><span class=\"n\">unix</span><span class=\"o\">/</span><span class=\"n\">args</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">137</span><span class=\"w\"></span>\n#<span class=\"mi\">14</span><span class=\"w\"> </span><span class=\"n\">std</span>::<span class=\"n\">sys</span>::<span class=\"n\">unix</span>::<span class=\"n\">args</span>::<span class=\"n\">args</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">sys</span><span class=\"o\">/</span><span class=\"n\">unix</span><span class=\"o\">/</span><span class=\"n\">args</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">24</span><span class=\"w\"></span>\n#<span class=\"mi\">15</span><span class=\"w\"> </span><span class=\"n\">std</span>::<span class=\"n\">env</span>::<span class=\"n\">args_os</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">env</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">780</span><span class=\"w\"></span>\n#<span class=\"mi\">16</span><span class=\"w\"> </span><span class=\"mh\">0x00007ff7c2b4ecf1</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">std</span>::<span class=\"n\">env</span>::<span class=\"n\">args</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">env</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">745</span><span class=\"w\"></span>\n#<span class=\"mi\">17</span><span class=\"w\"> </span><span class=\"mh\">0x00007ff7c2578112</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">wasi_cap_std_sync</span>::<span class=\"n\">WasiCtxBuilder</span>::<span class=\"n\">inherit_args</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">panicking</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">541</span><span class=\"w\"></span>\n#<span class=\"mi\">18</span><span class=\"w\"> </span><span class=\"mh\">0x00007ff7c24cff55</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span>::<span class=\"n\">wasi</span>::<span class=\"n\">wasi_config_t</span>::<span class=\"n\">into_wasi_ctx</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">panicking</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">541</span><span class=\"w\"></span>\n#<span class=\"mi\">19</span><span class=\"w\"> </span><span class=\"mh\">0x00007ff7c241a92a</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">wasmtime_context_set_wasi</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">panicking</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">541</span><span class=\"w\"></span>\n#<span class=\"mi\">20</span><span class=\"w\"> </span><span class=\"mh\">0x000000000068c766</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"o\">..</span><span class=\"p\">.</span><span class=\"w\"></span>\n</code></pre></div>\n<p>My CPU has avx2 support:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">grep</span><span class=\"w\"> </span><span class=\"n\">avx2</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">proc</span><span class=\"o\">/</span><span class=\"n\">cpuinfo</span><span class=\"w\"></span>\n<span class=\"n\">flags</span><span class=\"w\">           </span>: <span class=\"nc\">fpu</span><span class=\"w\"> </span><span class=\"n\">vme</span><span class=\"w\"> </span><span class=\"n\">de</span><span class=\"w\"> </span><span class=\"n\">pse</span><span class=\"w\"> </span><span class=\"n\">tsc</span><span class=\"w\"> </span><span class=\"n\">msr</span><span class=\"w\"> </span><span class=\"n\">pae</span><span class=\"w\"> </span><span class=\"n\">mce</span><span class=\"w\"> </span><span class=\"n\">cx8</span><span class=\"w\"> </span><span class=\"n\">apic</span><span class=\"w\"> </span><span class=\"n\">sep</span><span class=\"w\"> </span><span class=\"n\">mtrr</span><span class=\"w\"> </span><span class=\"n\">pge</span><span class=\"w\"> </span><span class=\"n\">mca</span><span class=\"w\"> </span><span class=\"n\">cmov</span><span class=\"w\"> </span><span class=\"n\">pat</span><span class=\"w\"> </span><span class=\"n\">pse36</span><span class=\"w\"> </span><span class=\"n\">clflush</span><span class=\"w\"> </span><span class=\"n\">mmx</span><span class=\"w\"> </span><span class=\"n\">fxsr</span><span class=\"w\"> </span><span class=\"n\">sse</span><span class=\"w\"> </span><span class=\"n\">sse2</span><span class=\"w\"> </span><span class=\"n\">ss</span><span class=\"w\"> </span><span class=\"n\">ht</span><span class=\"w\"> </span><span class=\"n\">syscall</span><span class=\"w\"> </span><span class=\"n\">nx</span><span class=\"w\"> </span><span class=\"n\">pdpe1gb</span><span class=\"w\"> </span><span class=\"n\">rdtscp</span><span class=\"w\"> </span><span class=\"n\">lm</span><span class=\"w\"> </span><span class=\"n\">constant_tsc</span><span class=\"w\"> </span><span class=\"n\">rep_good</span><span class=\"w\"> </span><span class=\"n\">nopl</span><span class=\"w\"> </span><span class=\"n\">xtopology</span><span class=\"w\"> </span><span class=\"n\">cpuid</span><span class=\"w\"> </span><span class=\"n\">pni</span><span class=\"w\"> </span><span class=\"n\">pclmulqdq</span><span class=\"w\"> </span><span class=\"n\">ssse3</span><span class=\"w\"> </span><span class=\"n\">fma</span><span class=\"w\"> </span><span class=\"n\">cx16</span><span class=\"w\"> </span><span class=\"n\">pcid</span><span class=\"w\"> </span><span class=\"n\">sse4_1</span><span class=\"w\"> </span><span class=\"n\">sse4_2</span><span class=\"w\"> </span><span class=\"n\">movbe</span><span class=\"w\"> </span><span class=\"n\">popcnt</span><span class=\"w\"> </span><span class=\"n\">aes</span><span class=\"w\"> </span><span class=\"n\">xsave</span><span class=\"w\"> </span><span class=\"n\">avx</span><span class=\"w\"> </span><span class=\"n\">f16c</span><span class=\"w\"> </span><span class=\"n\">rdrand</span><span class=\"w\"> </span><span class=\"n\">hypervisor</span><span class=\"w\"> </span><span class=\"n\">lahf_lm</span><span class=\"w\"> </span><span class=\"n\">abm</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"n\">dnowprefetch</span><span class=\"w\"> </span><span class=\"n\">invpcid_single</span><span class=\"w\"> </span><span class=\"n\">ssbd</span><span class=\"w\"> </span><span class=\"n\">ibrs</span><span class=\"w\"> </span><span class=\"n\">ibpb</span><span class=\"w\"> </span><span class=\"n\">stibp</span><span class=\"w\"> </span><span class=\"n\">ibrs_enhanced</span><span class=\"w\"> </span><span class=\"n\">fsgsbase</span><span class=\"w\"> </span><span class=\"n\">bmi1</span><span class=\"w\"> </span><span class=\"n\">avx2</span><span class=\"w\"> </span><span class=\"n\">smep</span><span class=\"w\"> </span><span class=\"n\">bmi2</span><span class=\"w\"> </span><span class=\"n\">erms</span><span class=\"w\"> </span><span class=\"n\">invpcid</span><span class=\"w\"> </span><span class=\"n\">rdseed</span><span class=\"w\"> </span><span class=\"n\">adx</span><span class=\"w\"> </span><span class=\"n\">smap</span><span class=\"w\"> </span><span class=\"n\">clflushopt</span><span class=\"w\"> </span><span class=\"n\">xsaveopt</span><span class=\"w\"> </span><span class=\"n\">xsavec</span><span class=\"w\"> </span><span class=\"n\">xgetbv1</span><span class=\"w\"> </span><span class=\"n\">xsaves</span><span class=\"w\"> </span><span class=\"n\">flush_l1d</span><span class=\"w\"> </span><span class=\"n\">arch_capabilities</span><span class=\"w\"></span>\n<span class=\"o\">..</span><span class=\"p\">.</span><span class=\"w\"></span>\n</code></pre></div>\n<p>It only happened when the argv of the program is not empty.</p>\n<h3>Expected Results</h3>\n<p>Run successfully</p>\n<h3>Actual Results</h3>\n<p>Segfault on wasi_config_inherit_argv</p>\n<h3>Versions and Environment</h3>\n<p>Wasmtime version or commit: v0.29.0</p>\n<p>Operating system: Linux run on WSL</p>\n<p>Architecture: x64</p>\n<h3>Extra Info</h3>\n</blockquote>",
        "id": 252598239,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1631180598
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/3321#issuecomment-916189028\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/3321\">issue #3321</a>:</p>\n<blockquote>\n<p>I don't think there's really much we can do to fix this. The C API documents that <code>wasmtime_context_set_wasi</code> consumes the <code>wasi_config_t</code> and it can't be reused. Attempting to reuse it involves a use-after-free, which is undefined behavior and can do whatever it wants. In that sense we can't really preemptively fix this or panic or something like that. The only other option would be to change the API to not consume the input.</p>\n</blockquote>",
        "id": 252642595,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1631200208
    },
    {
        "content": "<p>spacewander <a href=\"https://github.com/bytecodealliance/wasmtime/issues/3321#issuecomment-916571372\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/3321\">issue #3321</a>:</p>\n<blockquote>\n<p>Thanks!</p>\n</blockquote>",
        "id": 252721713,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1631239171
    },
    {
        "content": "<p>spacewander closed <a href=\"https://github.com/bytecodealliance/wasmtime/issues/3321\">issue #3321</a>:</p>\n<blockquote>\n<h3>Test Case</h3>\n<h3>Steps to Reproduce</h3>\n<p>When I try to integrate wasmtime to my host program written in C, the program crashed during executing</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"w\">    </span><span class=\"n\">vm_wasi_config</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">wasi_config_new</span><span class=\"p\">();</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">vm_wasi_config</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"n\">NULL</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"n\">goto</span><span class=\"w\"> </span><span class=\"o\">..</span><span class=\"p\">.;</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">}</span><span class=\"w\"></span>\n\n<span class=\"w\">    </span><span class=\"n\">wasi_config_inherit_argv</span><span class=\"p\">(</span><span class=\"n\">vm_wasi_config</span><span class=\"p\">);</span><span class=\"w\"> </span><span class=\"cm\">/* &lt;- this line! */</span><span class=\"w\"></span>\n</code></pre></div>\n<p>The bt is:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code>#<span class=\"mi\">0</span><span class=\"w\">  </span><span class=\"n\">__strlen_avx2</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">../</span><span class=\"n\">sysdeps</span><span class=\"o\">/</span><span class=\"n\">x86_64</span><span class=\"o\">/</span><span class=\"n\">multiarch</span><span class=\"o\">/</span><span class=\"n\">strlen</span><span class=\"o\">-</span><span class=\"n\">avx2</span><span class=\"p\">.</span><span class=\"n\">S</span>:<span class=\"mi\">65</span><span class=\"w\"></span>\n#<span class=\"mi\">1</span><span class=\"w\">  </span><span class=\"mh\">0x00007ff7c2b4ee69</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">std</span>::<span class=\"n\">ffi</span>::<span class=\"n\">c_str</span>::<span class=\"n\">CStr</span>::<span class=\"n\">from_ptr</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">ffi</span><span class=\"o\">/</span><span class=\"n\">c_str</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">1174</span><span class=\"w\"></span>\n#<span class=\"mi\">2</span><span class=\"w\">  </span><span class=\"n\">std</span>::<span class=\"n\">sys</span>::<span class=\"n\">unix</span>::<span class=\"n\">args</span>::<span class=\"n\">imp</span>::<span class=\"n\">clone</span>::<span class=\"p\">{{</span><span class=\"n\">closure</span><span class=\"p\">}}</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">sys</span><span class=\"o\">/</span><span class=\"n\">unix</span><span class=\"o\">/</span><span class=\"n\">args</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">147</span><span class=\"w\"></span>\n#<span class=\"mi\">3</span><span class=\"w\">  </span><span class=\"n\">core</span>::<span class=\"n\">iter</span>::<span class=\"n\">adapters</span>::<span class=\"n\">map</span>::<span class=\"n\">map_fold</span>::<span class=\"p\">{{</span><span class=\"n\">closure</span><span class=\"p\">}}</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a178d0322ce20e33eac124758e837cbd80a6f633</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">iter</span><span class=\"o\">/</span><span class=\"n\">adapters</span><span class=\"o\">/</span><span class=\"n\">map</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">82</span><span class=\"w\"></span>\n#<span class=\"mi\">4</span><span class=\"w\">  </span><span class=\"n\">core</span>::<span class=\"n\">iter</span>::<span class=\"n\">traits</span>::<span class=\"n\">iterator</span>::<span class=\"nb\">Iterator</span>::<span class=\"n\">fold</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a178d0322ce20e33eac124758e837cbd80a6f633</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">iter</span><span class=\"o\">/</span><span class=\"n\">traits</span><span class=\"o\">/</span><span class=\"n\">iterator</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">2112</span><span class=\"w\"></span>\n#<span class=\"mi\">5</span><span class=\"w\">  </span><span class=\"o\">&lt;</span><span class=\"n\">core</span>::<span class=\"n\">iter</span>::<span class=\"n\">adapters</span>::<span class=\"n\">map</span>::<span class=\"n\">Map</span><span class=\"o\">&lt;</span><span class=\"n\">I</span><span class=\"p\">,</span><span class=\"n\">F</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">core</span>::<span class=\"n\">iter</span>::<span class=\"n\">traits</span>::<span class=\"n\">iterator</span>::<span class=\"nb\">Iterator</span><span class=\"o\">&gt;</span>::<span class=\"n\">fold</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a178d0322ce20e33eac124758e837cbd80a6f633</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">iter</span><span class=\"o\">/</span><span class=\"n\">adapters</span><span class=\"o\">/</span><span class=\"n\">map</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">122</span><span class=\"w\"></span>\n#<span class=\"mi\">6</span><span class=\"w\">  </span><span class=\"n\">core</span>::<span class=\"n\">iter</span>::<span class=\"n\">traits</span>::<span class=\"n\">iterator</span>::<span class=\"nb\">Iterator</span>::<span class=\"n\">for_each</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a178d0322ce20e33eac124758e837cbd80a6f633</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">iter</span><span class=\"o\">/</span><span class=\"n\">traits</span><span class=\"o\">/</span><span class=\"n\">iterator</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">736</span><span class=\"w\"></span>\n#<span class=\"mi\">7</span><span class=\"w\">  </span><span class=\"o\">&lt;</span><span class=\"n\">alloc</span>::<span class=\"n\">vec</span>::<span class=\"nb\">Vec</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"p\">,</span><span class=\"n\">A</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">alloc</span>::<span class=\"n\">vec</span>::<span class=\"n\">spec_extend</span>::<span class=\"n\">SpecExtend</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"p\">,</span><span class=\"n\">I</span><span class=\"o\">&gt;&gt;</span>::<span class=\"n\">spec_extend</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a178d0322ce20e33eac124758e837cbd80a6f633</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">alloc</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">vec</span><span class=\"o\">/</span><span class=\"n\">spec_extend</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">40</span><span class=\"w\"></span>\n#<span class=\"mi\">8</span><span class=\"w\">  </span><span class=\"o\">&lt;</span><span class=\"n\">alloc</span>::<span class=\"n\">vec</span>::<span class=\"nb\">Vec</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">alloc</span>::<span class=\"n\">vec</span>::<span class=\"n\">spec_from_iter_nested</span>::<span class=\"n\">SpecFromIterNested</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"p\">,</span><span class=\"n\">I</span><span class=\"o\">&gt;&gt;</span>::<span class=\"n\">from_iter</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a178d0322ce20e33eac124758e837cbd80a6f633</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">alloc</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">vec</span><span class=\"o\">/</span><span class=\"n\">spec_from_iter_nested</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">56</span><span class=\"w\"></span>\n#<span class=\"mi\">9</span><span class=\"w\">  </span><span class=\"o\">&lt;</span><span class=\"n\">alloc</span>::<span class=\"n\">vec</span>::<span class=\"nb\">Vec</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">alloc</span>::<span class=\"n\">vec</span>::<span class=\"n\">spec_from_iter</span>::<span class=\"n\">SpecFromIter</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"p\">,</span><span class=\"n\">I</span><span class=\"o\">&gt;&gt;</span>::<span class=\"n\">from_iter</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a178d0322ce20e33eac124758e837cbd80a6f633</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">alloc</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">vec</span><span class=\"o\">/</span><span class=\"n\">spec_from_iter</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">33</span><span class=\"w\"></span>\n#<span class=\"mi\">10</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">alloc</span>::<span class=\"n\">vec</span>::<span class=\"nb\">Vec</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">core</span>::<span class=\"n\">iter</span>::<span class=\"n\">traits</span>::<span class=\"n\">collect</span>::<span class=\"n\">FromIterator</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"o\">&gt;&gt;</span>::<span class=\"n\">from_iter</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a178d0322ce20e33eac124758e837cbd80a6f633</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">alloc</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">vec</span><span class=\"o\">/</span><span class=\"k\">mod</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">2449</span><span class=\"w\"></span>\n#<span class=\"mi\">11</span><span class=\"w\"> </span><span class=\"n\">core</span>::<span class=\"n\">iter</span>::<span class=\"n\">traits</span>::<span class=\"n\">iterator</span>::<span class=\"nb\">Iterator</span>::<span class=\"n\">collect</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">a178d0322ce20e33eac124758e837cbd80a6f633</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">core</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">iter</span><span class=\"o\">/</span><span class=\"n\">traits</span><span class=\"o\">/</span><span class=\"n\">iterator</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">1748</span><span class=\"w\"></span>\n#<span class=\"mi\">12</span><span class=\"w\"> </span><span class=\"n\">std</span>::<span class=\"n\">sys</span>::<span class=\"n\">unix</span>::<span class=\"n\">args</span>::<span class=\"n\">imp</span>::<span class=\"n\">clone</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">sys</span><span class=\"o\">/</span><span class=\"n\">unix</span><span class=\"o\">/</span><span class=\"n\">args</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">145</span><span class=\"w\"></span>\n#<span class=\"mi\">13</span><span class=\"w\"> </span><span class=\"n\">std</span>::<span class=\"n\">sys</span>::<span class=\"n\">unix</span>::<span class=\"n\">args</span>::<span class=\"n\">imp</span>::<span class=\"n\">args</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">sys</span><span class=\"o\">/</span><span class=\"n\">unix</span><span class=\"o\">/</span><span class=\"n\">args</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">137</span><span class=\"w\"></span>\n#<span class=\"mi\">14</span><span class=\"w\"> </span><span class=\"n\">std</span>::<span class=\"n\">sys</span>::<span class=\"n\">unix</span>::<span class=\"n\">args</span>::<span class=\"n\">args</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">sys</span><span class=\"o\">/</span><span class=\"n\">unix</span><span class=\"o\">/</span><span class=\"n\">args</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">24</span><span class=\"w\"></span>\n#<span class=\"mi\">15</span><span class=\"w\"> </span><span class=\"n\">std</span>::<span class=\"n\">env</span>::<span class=\"n\">args_os</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">env</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">780</span><span class=\"w\"></span>\n#<span class=\"mi\">16</span><span class=\"w\"> </span><span class=\"mh\">0x00007ff7c2b4ecf1</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">std</span>::<span class=\"n\">env</span>::<span class=\"n\">args</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">env</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">745</span><span class=\"w\"></span>\n#<span class=\"mi\">17</span><span class=\"w\"> </span><span class=\"mh\">0x00007ff7c2578112</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">wasi_cap_std_sync</span>::<span class=\"n\">WasiCtxBuilder</span>::<span class=\"n\">inherit_args</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">panicking</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">541</span><span class=\"w\"></span>\n#<span class=\"mi\">18</span><span class=\"w\"> </span><span class=\"mh\">0x00007ff7c24cff55</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span>::<span class=\"n\">wasi</span>::<span class=\"n\">wasi_config_t</span>::<span class=\"n\">into_wasi_ctx</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">panicking</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">541</span><span class=\"w\"></span>\n#<span class=\"mi\">19</span><span class=\"w\"> </span><span class=\"mh\">0x00007ff7c241a92a</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">wasmtime_context_set_wasi</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">panicking</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">541</span><span class=\"w\"></span>\n#<span class=\"mi\">20</span><span class=\"w\"> </span><span class=\"mh\">0x000000000068c766</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"o\">..</span><span class=\"p\">.</span><span class=\"w\"></span>\n</code></pre></div>\n<p>My CPU has avx2 support:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">grep</span><span class=\"w\"> </span><span class=\"n\">avx2</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">proc</span><span class=\"o\">/</span><span class=\"n\">cpuinfo</span><span class=\"w\"></span>\n<span class=\"n\">flags</span><span class=\"w\">           </span>: <span class=\"nc\">fpu</span><span class=\"w\"> </span><span class=\"n\">vme</span><span class=\"w\"> </span><span class=\"n\">de</span><span class=\"w\"> </span><span class=\"n\">pse</span><span class=\"w\"> </span><span class=\"n\">tsc</span><span class=\"w\"> </span><span class=\"n\">msr</span><span class=\"w\"> </span><span class=\"n\">pae</span><span class=\"w\"> </span><span class=\"n\">mce</span><span class=\"w\"> </span><span class=\"n\">cx8</span><span class=\"w\"> </span><span class=\"n\">apic</span><span class=\"w\"> </span><span class=\"n\">sep</span><span class=\"w\"> </span><span class=\"n\">mtrr</span><span class=\"w\"> </span><span class=\"n\">pge</span><span class=\"w\"> </span><span class=\"n\">mca</span><span class=\"w\"> </span><span class=\"n\">cmov</span><span class=\"w\"> </span><span class=\"n\">pat</span><span class=\"w\"> </span><span class=\"n\">pse36</span><span class=\"w\"> </span><span class=\"n\">clflush</span><span class=\"w\"> </span><span class=\"n\">mmx</span><span class=\"w\"> </span><span class=\"n\">fxsr</span><span class=\"w\"> </span><span class=\"n\">sse</span><span class=\"w\"> </span><span class=\"n\">sse2</span><span class=\"w\"> </span><span class=\"n\">ss</span><span class=\"w\"> </span><span class=\"n\">ht</span><span class=\"w\"> </span><span class=\"n\">syscall</span><span class=\"w\"> </span><span class=\"n\">nx</span><span class=\"w\"> </span><span class=\"n\">pdpe1gb</span><span class=\"w\"> </span><span class=\"n\">rdtscp</span><span class=\"w\"> </span><span class=\"n\">lm</span><span class=\"w\"> </span><span class=\"n\">constant_tsc</span><span class=\"w\"> </span><span class=\"n\">rep_good</span><span class=\"w\"> </span><span class=\"n\">nopl</span><span class=\"w\"> </span><span class=\"n\">xtopology</span><span class=\"w\"> </span><span class=\"n\">cpuid</span><span class=\"w\"> </span><span class=\"n\">pni</span><span class=\"w\"> </span><span class=\"n\">pclmulqdq</span><span class=\"w\"> </span><span class=\"n\">ssse3</span><span class=\"w\"> </span><span class=\"n\">fma</span><span class=\"w\"> </span><span class=\"n\">cx16</span><span class=\"w\"> </span><span class=\"n\">pcid</span><span class=\"w\"> </span><span class=\"n\">sse4_1</span><span class=\"w\"> </span><span class=\"n\">sse4_2</span><span class=\"w\"> </span><span class=\"n\">movbe</span><span class=\"w\"> </span><span class=\"n\">popcnt</span><span class=\"w\"> </span><span class=\"n\">aes</span><span class=\"w\"> </span><span class=\"n\">xsave</span><span class=\"w\"> </span><span class=\"n\">avx</span><span class=\"w\"> </span><span class=\"n\">f16c</span><span class=\"w\"> </span><span class=\"n\">rdrand</span><span class=\"w\"> </span><span class=\"n\">hypervisor</span><span class=\"w\"> </span><span class=\"n\">lahf_lm</span><span class=\"w\"> </span><span class=\"n\">abm</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"n\">dnowprefetch</span><span class=\"w\"> </span><span class=\"n\">invpcid_single</span><span class=\"w\"> </span><span class=\"n\">ssbd</span><span class=\"w\"> </span><span class=\"n\">ibrs</span><span class=\"w\"> </span><span class=\"n\">ibpb</span><span class=\"w\"> </span><span class=\"n\">stibp</span><span class=\"w\"> </span><span class=\"n\">ibrs_enhanced</span><span class=\"w\"> </span><span class=\"n\">fsgsbase</span><span class=\"w\"> </span><span class=\"n\">bmi1</span><span class=\"w\"> </span><span class=\"n\">avx2</span><span class=\"w\"> </span><span class=\"n\">smep</span><span class=\"w\"> </span><span class=\"n\">bmi2</span><span class=\"w\"> </span><span class=\"n\">erms</span><span class=\"w\"> </span><span class=\"n\">invpcid</span><span class=\"w\"> </span><span class=\"n\">rdseed</span><span class=\"w\"> </span><span class=\"n\">adx</span><span class=\"w\"> </span><span class=\"n\">smap</span><span class=\"w\"> </span><span class=\"n\">clflushopt</span><span class=\"w\"> </span><span class=\"n\">xsaveopt</span><span class=\"w\"> </span><span class=\"n\">xsavec</span><span class=\"w\"> </span><span class=\"n\">xgetbv1</span><span class=\"w\"> </span><span class=\"n\">xsaves</span><span class=\"w\"> </span><span class=\"n\">flush_l1d</span><span class=\"w\"> </span><span class=\"n\">arch_capabilities</span><span class=\"w\"></span>\n<span class=\"o\">..</span><span class=\"p\">.</span><span class=\"w\"></span>\n</code></pre></div>\n<p>It only happened when the argv of the program is not empty.</p>\n<h3>Expected Results</h3>\n<p>Run successfully</p>\n<h3>Actual Results</h3>\n<p>Segfault on wasi_config_inherit_argv</p>\n<h3>Versions and Environment</h3>\n<p>Wasmtime version or commit: v0.29.0</p>\n<p>Operating system: Linux run on WSL</p>\n<p>Architecture: x64</p>\n<h3>Extra Info</h3>\n</blockquote>",
        "id": 252721714,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1631239171
    }
]