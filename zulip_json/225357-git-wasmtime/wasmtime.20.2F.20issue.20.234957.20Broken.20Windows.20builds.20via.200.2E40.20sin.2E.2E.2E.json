[
    {
        "content": "<p>pinkforest edited <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4957\">issue #4957</a>:</p>\n<blockquote>\n<p>Problem now is that anyone using 0.40 e.g. via <code>wasi-common</code> will get 0.25 cap-std </p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"err\">│</span><span class=\"w\">   </span><span class=\"err\">│</span><span class=\"w\">   </span><span class=\"err\">│</span><span class=\"w\">   </span><span class=\"err\">├──</span><span class=\"w\"> </span><span class=\"n\">wasi</span><span class=\"o\">-</span><span class=\"n\">common</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"p\">.</span><span class=\"mf\">40.0</span><span class=\"w\"></span>\n<span class=\"err\">│</span><span class=\"w\">   </span><span class=\"err\">│</span><span class=\"w\">   </span><span class=\"err\">│</span><span class=\"w\">   </span><span class=\"err\">│</span><span class=\"w\">   </span><span class=\"err\">├──</span><span class=\"w\"> </span><span class=\"n\">cap</span><span class=\"o\">-</span><span class=\"n\">rand</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"p\">.</span><span class=\"mf\">25.2</span><span class=\"w\"></span>\n<span class=\"err\">│</span><span class=\"w\">   </span><span class=\"err\">│</span><span class=\"w\">   </span><span class=\"err\">│</span><span class=\"w\">   </span><span class=\"err\">│</span><span class=\"w\">   </span><span class=\"err\">├──</span><span class=\"w\"> </span><span class=\"n\">cap</span><span class=\"o\">-</span><span class=\"n\">std</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"p\">.</span><span class=\"mf\">25.2</span><span class=\"w\"></span>\n<span class=\"err\">│</span><span class=\"w\">   </span><span class=\"err\">│</span><span class=\"w\">   </span><span class=\"err\">│</span><span class=\"w\">   </span><span class=\"err\">│</span><span class=\"w\">   </span><span class=\"err\">│</span><span class=\"w\">   </span><span class=\"err\">├──</span><span class=\"w\"> </span><span class=\"n\">cap</span><span class=\"o\">-</span><span class=\"n\">primitives</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"p\">.</span><span class=\"mf\">25.2</span><span class=\"w\"></span>\n</code></pre></div>\n<p>And therefore incompat cap-primitives in Windows when using stable &gt; 1.64.0 rust stable that has sealed the <code>FileTypeExt</code> trait</p>\n<p>By doing nothing this still works on at least unix but Windows is now broken on it's default state doing nothing on rust stable 1.64</p>\n<h2>wasi-common &lt; 1 Windows builds broken</h2>\n<p>I would have to bump everything to ^1 atm from 0.40</p>\n<h2>Root cause</h2>\n<p>This was seen earlier in <a href=\"https://github.com/bytecodealliance/cap-std/issues/275\">https://github.com/bytecodealliance/cap-std/issues/275</a> via nightly broken</p>\n<p>A trait was sealed that then broke the builds via <code>[cap-primitives](https://crates.io/crates/cap-primitives)</code></p>\n<p>I documented my find originally: <a href=\"https://github.com/rust-lang/rust/issues/102260\">https://github.com/rust-lang/rust/issues/102260</a></p>\n<h2>Work/Around - Works for Windows Only probably ?</h2>\n<p>There is a work/around here: <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4936\">https://github.com/bytecodealliance/wasmtime/issues/4936</a></p>\n<p>The work/around patch is in cap-std commits:<br>\n<code>git diff de739728299408dfce96315b3c82a14c952a6cf3 949f251bccbb84513fe81a427a46864c1e8ad82c</code></p>\n<h2>Work/Around does not work for unix</h2>\n<p>Work/around in turn seems to break unix builds as described here: <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4936#issuecomment-1257183650\">https://github.com/bytecodealliance/wasmtime/issues/4936#issuecomment-1257183650</a></p>\n<h2>Ideal Resolution ?</h2>\n<ul>\n<li>[ ] Avoid forcing ^1 bump via wasi-common from 0.40</li>\n<li>[ ] Patch was broken on unix via patch-branch ?</li>\n<li>[ ] Test patch on both Windows and Unix</li>\n<li>[ ] Recursive point-release fix to 0.40 wasi-common -&gt; cap-std 0.26 -&gt; cap-primitives 0.26</li>\n</ul>\n<p>Could we address so this builds for both Windows and Linux / unix via 0.40 ?</p>\n<p>Perhaps we could also bump wasi-common so it bumps up to 0.26 that whole chain for cap-primitives ?</p>\n<p>But I think the build errors need to be sorted for unix as I suspect the patch has broken all unix now ? <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4936#issuecomment-1257183650\">https://github.com/bytecodealliance/wasmtime/issues/4936#issuecomment-1257183650</a></p>\n<p>This is how I bumped my :lock: to 0.40.1 - released 25 days ago or so</p>\n<h2>Additional attempts</h2>\n<p>I also tried quickly with 0.40.1 wasi-common but it still brings 0.25 tree</p>\n<p>$ cargo update -p wasmtime-wasi --precise 0.40.1</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"w\">    </span><span class=\"n\">Updating</span><span class=\"w\"> </span><span class=\"n\">crates</span><span class=\"p\">.</span><span class=\"n\">io</span><span class=\"w\"> </span><span class=\"n\">index</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">Updating</span><span class=\"w\"> </span><span class=\"n\">cranelift</span><span class=\"o\">-</span><span class=\"n\">bforest</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"p\">.</span><span class=\"mf\">87.0</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">v0</span><span class=\"p\">.</span><span class=\"mf\">87.1</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">Updating</span><span class=\"w\"> </span><span class=\"n\">cranelift</span><span class=\"o\">-</span><span class=\"n\">codegen</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"p\">.</span><span class=\"mf\">87.0</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">v0</span><span class=\"p\">.</span><span class=\"mf\">87.1</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">Updating</span><span class=\"w\"> </span><span class=\"n\">cranelift</span><span class=\"o\">-</span><span class=\"n\">codegen</span><span class=\"o\">-</span><span class=\"n\">meta</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"p\">.</span><span class=\"mf\">87.0</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">v0</span><span class=\"p\">.</span><span class=\"mf\">87.1</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">Updating</span><span class=\"w\"> </span><span class=\"n\">cranelift</span><span class=\"o\">-</span><span class=\"n\">codegen</span><span class=\"o\">-</span><span class=\"n\">shared</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"p\">.</span><span class=\"mf\">87.0</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">v0</span><span class=\"p\">.</span><span class=\"mf\">87.1</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">Updating</span><span class=\"w\"> </span><span class=\"n\">cranelift</span><span class=\"o\">-</span><span class=\"n\">entity</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"p\">.</span><span class=\"mf\">87.0</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">v0</span><span class=\"p\">.</span><span class=\"mf\">87.1</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">Updating</span><span class=\"w\"> </span><span class=\"n\">cranelift</span><span class=\"o\">-</span><span class=\"n\">frontend</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"p\">.</span><span class=\"mf\">87.0</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">v0</span><span class=\"p\">.</span><span class=\"mf\">87.1</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">Updating</span><span class=\"w\"> </span><span class=\"n\">cranelift</span><span class=\"o\">-</span><span class=\"n\">isle</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"p\">.</span><span class=\"mf\">87.0</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">v0</span><span class=\"p\">.</span><span class=\"mf\">87.1</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">Updating</span><span class=\"w\"> </span><span class=\"n\">cranelift</span><span class=\"o\">-</span><span class=\"n\">native</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"p\">.</span><span class=\"mf\">87.0</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">v0</span><span class=\"p\">.</span><span class=\"mf\">87.1</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">Updating</span><span class=\"w\"> </span><span class=\"n\">cranelift</span><span class=\"o\">-</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"p\">.</span><span class=\"mf\">87.0</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">v0</span><span class=\"p\">.</span><span class=\"mf\">87.1</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">Updating</span><span class=\"w\"> </span><span class=\"n\">wasi</span><span class=\"o\">-</span><span class=\"n\">cap</span><span class=\"o\">-</span><span class=\"n\">std</span><span class=\"o\">-</span><span class=\"n\">sync</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"p\">.</span><span class=\"mf\">40.0</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">v0</span><span class=\"p\">.</span><span class=\"mf\">40.1</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">Updating</span><span class=\"w\"> </span><span class=\"n\">wasi</span><span class=\"o\">-</span><span class=\"n\">common</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"p\">.</span><span class=\"mf\">40.0</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">v0</span><span class=\"p\">.</span><span class=\"mf\">40.1</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">Updating</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"p\">.</span><span class=\"mf\">40.0</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">v0</span><span class=\"p\">.</span><span class=\"mf\">40.1</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">Updating</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">asm</span><span class=\"o\">-</span><span class=\"n\">macros</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"p\">.</span><span class=\"mf\">40.0</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">v0</span><span class=\"p\">.</span><span class=\"mf\">40.1</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">Updating</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">cache</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"p\">.</span><span class=\"mf\">40.0</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">v0</span><span class=\"p\">.</span><span class=\"mf\">40.1</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">Updating</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">cranelift</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"p\">.</span><span class=\"mf\">40.0</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">v0</span><span class=\"p\">.</span><span class=\"mf\">40.1</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">Updating</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">environ</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"p\">.</span><span class=\"mf\">40.0</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">v0</span><span class=\"p\">.</span><span class=\"mf\">40.1</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">Updating</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">fiber</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"p\">.</span><span class=\"mf\">40.0</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">v0</span><span class=\"p\">.</span><span class=\"mf\">40.1</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">Updating</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">jit</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"p\">.</span><span class=\"mf\">40.0</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">v0</span><span class=\"p\">.</span><span class=\"mf\">40.1</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">Updating</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">jit</span><span class=\"o\">-</span><span class=\"n\">debug</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"p\">.</span><span class=\"mf\">40.0</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">v0</span><span class=\"p\">.</span><span class=\"mf\">40.1</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">Updating</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">runtime</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"p\">.</span><span class=\"mf\">40.0</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">v0</span><span class=\"p\">.</span><span class=\"mf\">40.1</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">Updating</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">types</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"p\">.</span><span class=\"mf\">40.0</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">v0</span><span class=\"p\">.</span><span class=\"mf\">40.1</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">Updating</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">wasi</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"p\">.</span><span class=\"mf\">40.0</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">v0</span><span class=\"p\">.</span><span class=\"mf\">40.1</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">Updating</span><span class=\"w\"> </span><span class=\"n\">wiggle</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"p\">.</span><span class=\"mf\">40.0</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">v0</span><span class=\"p\">.</span><span class=\"mf\">40.1</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">Updating</span><span class=\"w\"> </span><span class=\"n\">wiggle</span><span class=\"o\">-</span><span class=\"n\">generate</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"p\">.</span><span class=\"mf\">40.0</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">v0</span><span class=\"p\">.</span><span class=\"mf\">40.1</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">Updating</span><span class=\"w\"> </span><span class=\"n\">wiggle</span><span class=\"o\">-</span><span class=\"kr\">macro</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"p\">.</span><span class=\"mf\">40.0</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">v0</span><span class=\"p\">.</span><span class=\"mf\">40.1</span><span class=\"w\"></span>\n</code></pre></div>\n<p>And my dependency tree gets 0.25 on which I had to apply the branch-patch</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"err\">│</span><span class=\"w\">   </span><span class=\"err\">│</span><span class=\"w\">   </span><span class=\"err\">│</span><span class=\"w\">   </span><span class=\"err\">├──</span><span class=\"w\"> </span><span class=\"n\">wasi</span><span class=\"o\">-</span><span class=\"n\">common</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"p\">.</span><span class=\"mf\">40.1</span><span class=\"w\"></span>\n<span class=\"err\">│</span><span class=\"w\">   </span><span class=\"err\">│</span><span class=\"w\">   </span><span class=\"err\">│</span><span class=\"w\">   </span><span class=\"err\">│</span><span class=\"w\">   </span><span class=\"err\">├──</span><span class=\"w\"> </span><span class=\"n\">cap</span><span class=\"o\">-</span><span class=\"n\">rand</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"p\">.</span><span class=\"mf\">25.2</span><span class=\"w\"></span>\n<span class=\"err\">│</span><span class=\"w\">   </span><span class=\"err\">│</span><span class=\"w\">   </span><span class=\"err\">│</span><span class=\"w\">   </span><span class=\"err\">│</span><span class=\"w\">   </span><span class=\"err\">├──</span><span class=\"w\"> </span><span class=\"n\">cap</span><span class=\"o\">-</span><span class=\"n\">std</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"p\">.</span><span class=\"mf\">25.3</span><span class=\"w\"></span>\n<span class=\"err\">│</span><span class=\"w\">   </span><span class=\"err\">│</span><span class=\"w\">   </span><span class=\"err\">│</span><span class=\"w\">   </span><span class=\"err\">│</span><span class=\"w\">   </span><span class=\"err\">│</span><span class=\"w\">   </span><span class=\"err\">├──</span><span class=\"w\"> </span><span class=\"n\">cap</span><span class=\"o\">-</span><span class=\"n\">primitives</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"p\">.</span><span class=\"mf\">25.3</span><span class=\"w\"></span>\n</code></pre></div>\n<p>I originally went down the <span aria-label=\"hole\" class=\"emoji emoji-1f573\" role=\"img\" title=\"hole\">:hole:</span> <a href=\"https://github.com/bytecodealliance/cap-std/issues/270#issuecomment-1257176470\">https://github.com/bytecodealliance/cap-std/issues/270#issuecomment-1257176470</a></p>\n<h2>Refs</h2>\n<p><a href=\"https://github.com/lunatic-solutions/lunatic/issues/136\">https://github.com/lunatic-solutions/lunatic/issues/136</a> &lt;-- Downstream crate impacted<br>\n<a href=\"https://github.com/rust-lang/rust/issues/102260\">https://github.com/rust-lang/rust/issues/102260</a> &lt;-- Went finding out what happened in std first - did not find these issues here<br>\n<a href=\"https://github.com/bytecodealliance/cap-std/issues/275\">https://github.com/bytecodealliance/cap-std/issues/275</a> &lt;-- I went first <br>\n<a href=\"https://rust-lang.zulipchat.com/#narrow/stream/219381-t-libs/topic/.E2.9C.94.20.23102260.20Sealed.20Windows.20FileTypeExt/near/300637075\">https://rust-lang.zulipchat.com/#narrow/stream/219381-t-libs/topic/.E2.9C.94.20.23102260.20Sealed.20Windows.20FileTypeExt/near/300637075</a> &lt;-- Chris Denton was helpful to point the above issue</p>\n<p>Cheers</p>\n</blockquote>",
        "id": 300652851,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1664113731
    }
]