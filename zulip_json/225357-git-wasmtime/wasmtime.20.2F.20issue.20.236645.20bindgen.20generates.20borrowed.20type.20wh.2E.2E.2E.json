[
    {
        "content": "<p>xxchan opened <a href=\"https://github.com/bytecodealliance/wasmtime/issues/6645\">issue #6645</a>:</p>\n<blockquote>\n<p>I have WIT definitions like this:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">default</span><span class=\"w\"> </span><span class=\"n\">world</span><span class=\"w\"> </span><span class=\"n\">w</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">  </span><span class=\"n\">export</span><span class=\"w\"> </span><span class=\"n\">abc</span>: <span class=\"nc\">self</span><span class=\"p\">.</span><span class=\"n\">abc</span>\n<span class=\"p\">}</span>\n\n<span class=\"n\">interface</span><span class=\"w\"> </span><span class=\"n\">abc</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">  </span><span class=\"k\">type</span> <span class=\"nc\">column</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">list</span><span class=\"o\">&lt;</span><span class=\"kt\">u8</span><span class=\"o\">&gt;</span>\n\n<span class=\"w\">  </span><span class=\"n\">record</span><span class=\"w\"> </span><span class=\"n\">record</span><span class=\"o\">-</span><span class=\"n\">batch</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"n\">schema</span>: <span class=\"nc\">schema</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"c1\">// columns: list&lt;array-data&gt;,</span>\n<span class=\"w\">    </span><span class=\"n\">columns</span>: <span class=\"nc\">list</span><span class=\"o\">&lt;</span><span class=\"n\">column</span><span class=\"o\">&gt;</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"c1\">// row-count: u32,</span>\n<span class=\"w\">  </span><span class=\"p\">}</span>\n\n<span class=\"w\">  </span><span class=\"k\">enum</span> <span class=\"nc\">data</span><span class=\"o\">-</span><span class=\"k\">type</span> <span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"n\">dt</span><span class=\"o\">-</span><span class=\"kt\">i16</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"n\">dt</span><span class=\"o\">-</span><span class=\"kt\">i32</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"n\">dt</span><span class=\"o\">-</span><span class=\"kt\">i64</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"n\">dt</span><span class=\"o\">-</span><span class=\"kt\">bool</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"n\">dt</span><span class=\"o\">-</span><span class=\"n\">string</span><span class=\"p\">,</span>\n<span class=\"w\">  </span><span class=\"p\">}</span>\n\n<span class=\"w\">  </span><span class=\"n\">record</span><span class=\"w\"> </span><span class=\"n\">field</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"n\">name</span>: <span class=\"nc\">string</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"n\">data</span><span class=\"o\">-</span><span class=\"k\">type</span>: <span class=\"nc\">data</span><span class=\"o\">-</span><span class=\"k\">type</span><span class=\"p\">,</span>\n<span class=\"w\">  </span><span class=\"p\">}</span>\n\n<span class=\"w\">  </span><span class=\"n\">record</span><span class=\"w\"> </span><span class=\"n\">schema</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"n\">fields</span>: <span class=\"nc\">list</span><span class=\"o\">&lt;</span><span class=\"n\">field</span><span class=\"o\">&gt;</span><span class=\"p\">,</span>\n<span class=\"w\">  </span><span class=\"p\">}</span>\n\n<span class=\"w\">  </span><span class=\"k\">enum</span> <span class=\"nc\">eval</span><span class=\"o\">-</span><span class=\"n\">errno</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"n\">err1</span>\n<span class=\"w\">  </span><span class=\"p\">}</span>\n\n<span class=\"w\">  </span><span class=\"n\">eval</span>: <span class=\"nc\">func</span><span class=\"p\">(</span><span class=\"n\">batch</span>: <span class=\"nc\">record</span><span class=\"o\">-</span><span class=\"n\">batch</span><span class=\"p\">)</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">result</span><span class=\"o\">&lt;</span><span class=\"n\">column</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">eval</span><span class=\"o\">-</span><span class=\"n\">errno</span><span class=\"o\">&gt;</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p>wasmtime generates <code>RecordBatch&lt;'a&gt;</code>, </p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"w\">    </span><span class=\"cp\">#[derive(wasmtime::component::ComponentType, wasmtime::component::Lower)]</span>\n<span class=\"w\">    </span><span class=\"cp\">#[component(record)]</span>\n<span class=\"w\">    </span><span class=\"cp\">#[derive(Clone)]</span>\n<span class=\"w\">    </span><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"k\">struct</span> <span class=\"nc\">Field</span><span class=\"o\">&lt;'</span><span class=\"na\">a</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"cp\">#[component(name = </span><span class=\"s\">\"name\"</span><span class=\"cp\">)]</span>\n<span class=\"w\">        </span><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"n\">name</span>: <span class=\"kp\">&amp;</span><span class=\"o\">'</span><span class=\"na\">a</span> <span class=\"kt\">str</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"cp\">#[component(name = </span><span class=\"s\">\"data-type\"</span><span class=\"cp\">)]</span>\n<span class=\"w\">        </span><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"n\">data_type</span>: <span class=\"nc\">DataType</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n\n<span class=\"w\">    </span><span class=\"cp\">#[derive(wasmtime::component::ComponentType, wasmtime::component::Lower)]</span>\n<span class=\"w\">    </span><span class=\"cp\">#[component(record)]</span>\n<span class=\"w\">    </span><span class=\"cp\">#[derive(Clone)]</span>\n<span class=\"w\">    </span><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"k\">struct</span> <span class=\"nc\">Schema</span><span class=\"o\">&lt;'</span><span class=\"na\">a</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"cp\">#[component(name = </span><span class=\"s\">\"fields\"</span><span class=\"cp\">)]</span>\n<span class=\"w\">        </span><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"n\">fields</span>: <span class=\"kp\">&amp;</span><span class=\"o\">'</span><span class=\"na\">a</span> <span class=\"p\">[</span><span class=\"n\">Field</span><span class=\"o\">&lt;'</span><span class=\"na\">a</span><span class=\"o\">&gt;</span><span class=\"p\">],</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n<span class=\"w\">    </span><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"k\">type</span> <span class=\"nc\">Column</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nb\">Vec</span><span class=\"o\">&lt;</span><span class=\"kt\">u8</span><span class=\"o\">&gt;</span><span class=\"p\">;</span>\n\n<span class=\"w\">    </span><span class=\"cp\">#[derive(wasmtime::component::ComponentType, wasmtime::component::Lower)]</span>\n<span class=\"w\">    </span><span class=\"cp\">#[component(record)]</span>\n<span class=\"w\">    </span><span class=\"cp\">#[derive(Clone)]</span>\n<span class=\"w\">    </span><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"k\">struct</span> <span class=\"nc\">RecordBatch</span><span class=\"o\">&lt;'</span><span class=\"na\">a</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"cp\">#[component(name = </span><span class=\"s\">\"schema\"</span><span class=\"cp\">)]</span>\n<span class=\"w\">        </span><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"n\">schema</span>: <span class=\"nc\">Schema</span><span class=\"o\">&lt;'</span><span class=\"na\">a</span><span class=\"o\">&gt;</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"cp\">#[component(name = </span><span class=\"s\">\"columns\"</span><span class=\"cp\">)]</span>\n<span class=\"w\">        </span><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"n\">columns</span>: <span class=\"kp\">&amp;</span><span class=\"o\">'</span><span class=\"na\">a</span> <span class=\"p\">[</span><span class=\"o\">&amp;'</span><span class=\"na\">a</span><span class=\"w\"> </span><span class=\"n\">Column</span><span class=\"p\">],</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n</code></pre></div>\n<p>while wit-bindgen generates <code>RecordBatch</code></p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"w\">    </span><span class=\"cp\">#[derive(Clone)]</span>\n<span class=\"w\">    </span><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"k\">struct</span> <span class=\"nc\">Field</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">      </span><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"n\">name</span>:<span class=\"nc\">wit_bindgen</span>::<span class=\"n\">rt</span>::<span class=\"n\">string</span>::<span class=\"nb\">String</span><span class=\"p\">,</span><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"n\">data_type</span>:<span class=\"nc\">DataType</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n<span class=\"w\">    </span><span class=\"cp\">#[derive(Clone)]</span>\n<span class=\"w\">    </span><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"k\">struct</span> <span class=\"nc\">Schema</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">      </span><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"n\">fields</span>:<span class=\"nc\">wit_bindgen</span>::<span class=\"n\">rt</span>::<span class=\"n\">vec</span>::<span class=\"nb\">Vec</span>::<span class=\"o\">&lt;</span><span class=\"n\">Field</span><span class=\"o\">&gt;</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n<span class=\"w\">    </span><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"k\">type</span> <span class=\"nc\">Column</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">wit_bindgen</span>::<span class=\"n\">rt</span>::<span class=\"n\">vec</span>::<span class=\"nb\">Vec</span><span class=\"o\">&lt;</span><span class=\"kt\">u8</span><span class=\"o\">&gt;</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"cp\">#[derive(Clone)]</span>\n<span class=\"w\">    </span><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"k\">struct</span> <span class=\"nc\">RecordBatch</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"n\">schema</span>: <span class=\"nc\">Schema</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"n\">columns</span>: <span class=\"nc\">wit_bindgen</span>::<span class=\"n\">rt</span>::<span class=\"n\">vec</span>::<span class=\"nb\">Vec</span><span class=\"o\">&lt;</span><span class=\"n\">Column</span><span class=\"o\">&gt;</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n</code></pre></div>\n<p>Is this expected? I don't quite understand the reason and the lifetimes are not easy to work with <span aria-label=\"oh no\" class=\"emoji emoji-1f615\" role=\"img\" title=\"oh no\">:oh_no:</span></p>\n</blockquote>",
        "id": 369976375,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1687857473
    },
    {
        "content": "<p>xxchan <a href=\"https://github.com/bytecodealliance/wasmtime/issues/6645#issuecomment-1609116316\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/6645\">issue #6645</a>:</p>\n<blockquote>\n<p>I found if I change the function interface</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"c1\">// from</span>\n<span class=\"n\">eval</span>: <span class=\"nc\">func</span><span class=\"p\">(</span><span class=\"n\">batch</span>: <span class=\"nc\">record</span><span class=\"o\">-</span><span class=\"n\">batch</span><span class=\"p\">)</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">result</span><span class=\"o\">&lt;</span><span class=\"n\">column</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">eval</span><span class=\"o\">-</span><span class=\"n\">errno</span><span class=\"o\">&gt;</span>\n<span class=\"c1\">// to</span>\n<span class=\"n\">eval</span>: <span class=\"nc\">func</span><span class=\"p\">(</span><span class=\"n\">batch</span>: <span class=\"nc\">record</span><span class=\"o\">-</span><span class=\"n\">batch</span><span class=\"p\">)</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">result</span><span class=\"o\">&lt;</span><span class=\"n\">record</span><span class=\"o\">-</span><span class=\"n\">batch</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">eval</span><span class=\"o\">-</span><span class=\"n\">errno</span><span class=\"o\">&gt;</span>\n</code></pre></div>\n<p>wasmtime will also generate</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"w\">    </span><span class=\"cp\">#[derive(</span>\n<span class=\"cp\">        wasmtime::component::ComponentType, wasmtime::component::Lift, wasmtime::component::Lower,</span>\n<span class=\"cp\">    )]</span>\n<span class=\"w\">    </span><span class=\"cp\">#[component(record)]</span>\n<span class=\"w\">    </span><span class=\"cp\">#[derive(Clone)]</span>\n<span class=\"w\">    </span><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"k\">struct</span> <span class=\"nc\">RecordBatch</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"cp\">#[component(name = </span><span class=\"s\">\"schema\"</span><span class=\"cp\">)]</span>\n<span class=\"w\">        </span><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"n\">schema</span>: <span class=\"nc\">Schema</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"cp\">#[component(name = </span><span class=\"s\">\"columns\"</span><span class=\"cp\">)]</span>\n<span class=\"w\">        </span><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"n\">columns</span>: <span class=\"nb\">Vec</span><span class=\"o\">&lt;</span><span class=\"n\">Column</span><span class=\"o\">&gt;</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n</code></pre></div>\n<p>I become more confused about the difference <span aria-label=\"eyes\" class=\"emoji emoji-1f440\" role=\"img\" title=\"eyes\">:eyes:</span></p>\n</blockquote>",
        "id": 369977154,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1687857597
    }
]