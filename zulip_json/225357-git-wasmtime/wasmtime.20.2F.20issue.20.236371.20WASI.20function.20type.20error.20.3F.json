[
    {
        "content": "<p>Zhangyx24 opened <a href=\"https://github.com/bytecodealliance/wasmtime/issues/6371\">issue #6371</a>:</p>\n<blockquote>\n<p>In the doc of WASI func : <a href=\"https://github.com/WebAssembly/WASI/blob/0ba0c5e2e37625ca5a6d3e4255a998dfaa3efc52/phases/snapshot/docs.md\">https://github.com/WebAssembly/WASI/blob/0ba0c5e2e37625ca5a6d3e4255a998dfaa3efc52/phases/snapshot/docs.md</a><br>\nThe signature of the WASI func 'clock_res_get' is params: i32, and result :i32.<br>\n&lt;img width=\"1302\" alt=\"截屏2023-05-11 20 22 57\" src=\"<a href=\"https://github.com/bytecodealliance/wasmtime/assets/28601300/4c0984fa-6753-49cc-a1b6-69998608bd22\">https://github.com/bytecodealliance/wasmtime/assets/28601300/4c0984fa-6753-49cc-a1b6-69998608bd22</a>\"&gt;</p>\n<p>And in the wasi_snapshot_preview1.witx (<a href=\"https://github.com/WebAssembly/WASI/blob/0ba0c5e2e37625ca5a6d3e4255a998dfaa3efc52/phases/snapshot/witx/wasi_snapshot_preview1.witx\">https://github.com/WebAssembly/WASI/blob/0ba0c5e2e37625ca5a6d3e4255a998dfaa3efc52/phases/snapshot/witx/wasi_snapshot_preview1.witx</a>), it shows the same signature of 'clock_res_get'.<br>\n&lt;img width=\"980\" alt=\"截屏2023-05-11 20 23 57\" src=\"<a href=\"https://github.com/bytecodealliance/wasmtime/assets/28601300/cc17c695-8e2a-4619-9bd1-24d3b8cfda7f\">https://github.com/bytecodealliance/wasmtime/assets/28601300/cc17c695-8e2a-4619-9bd1-24d3b8cfda7f</a>\"&gt;</p>\n<p>So we generate a wat fie to import the 'clock_res_get' func:<br>\n'''<br>\n(module<br>\n  (type (;0;) (func (param i32) (result i64)))<br>\n  (import \"wasi_snapshot_preview1\" \"clock_res_get\" (func (;0;) (type 0)))<br>\n  (func (;1;) (type 0) (param i32) (result i64)<br>\n    local.get 0<br>\n    call 0)<br>\n  (memory (;0;) 1)<br>\n  (export \"memory\" (memory 0))<br>\n  (export \"_start\" (func 1)))<br>\n'''</p>\n<p>Then we use 'wat2wasm clock_res_get.wat' to generate the wasm file, and use 'wasmer vaildate clock_res_get.wasm' to validate the wasm file and it passes the validation.</p>\n<p>After that, we use command 'wasmtime --invoke \"_start\" clock_res_get.wasm 1 2' to execute it, but get the error:<br>\nError: failed to run main module <code>clock_res_get.wasm</code></p>\n<p>Caused by:<br>\n    0: failed to instantiate \"clock_res_get.wasm\"<br>\n    1: incompatible import type for <code>wasi_snapshot_preview1::clock_res_get</code><br>\n    2: function types incompatible: expected func of type <code>(i32) -&gt; (i64)</code>, found func of type <code>(i32, i32) -&gt; (i32)</code></p>\n</blockquote>",
        "id": 357568305,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1683807975
    },
    {
        "content": "<p>Zhangyx24 edited <a href=\"https://github.com/bytecodealliance/wasmtime/issues/6371\">issue #6371</a>:</p>\n<blockquote>\n<p>In the doc of WASI func : <a href=\"https://github.com/WebAssembly/WASI/blob/0ba0c5e2e37625ca5a6d3e4255a998dfaa3efc52/phases/snapshot/docs.md\">https://github.com/WebAssembly/WASI/blob/0ba0c5e2e37625ca5a6d3e4255a998dfaa3efc52/phases/snapshot/docs.md</a><br>\nThe signature of the WASI func 'clock_res_get' is params: i32, and result :i32.<br>\n&lt;img width=\"1302\" alt=\"截屏2023-05-11 20 22 57\" src=\"<a href=\"https://github.com/bytecodealliance/wasmtime/assets/28601300/4c0984fa-6753-49cc-a1b6-69998608bd22\">https://github.com/bytecodealliance/wasmtime/assets/28601300/4c0984fa-6753-49cc-a1b6-69998608bd22</a>\"&gt;</p>\n<p>And in the wasi_snapshot_preview1.witx (<a href=\"https://github.com/WebAssembly/WASI/blob/0ba0c5e2e37625ca5a6d3e4255a998dfaa3efc52/phases/snapshot/witx/wasi_snapshot_preview1.witx\">https://github.com/WebAssembly/WASI/blob/0ba0c5e2e37625ca5a6d3e4255a998dfaa3efc52/phases/snapshot/witx/wasi_snapshot_preview1.witx</a>), it shows the same signature of 'clock_res_get'.<br>\n&lt;img width=\"980\" alt=\"截屏2023-05-11 20 23 57\" src=\"<a href=\"https://github.com/bytecodealliance/wasmtime/assets/28601300/cc17c695-8e2a-4619-9bd1-24d3b8cfda7f\">https://github.com/bytecodealliance/wasmtime/assets/28601300/cc17c695-8e2a-4619-9bd1-24d3b8cfda7f</a>\"&gt;</p>\n<p>So we generate a wat fie to import the 'clock_res_get' func:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"p\">(</span><span class=\"n\">module</span>\n<span class=\"w\">  </span><span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"p\">(;</span><span class=\"mi\">0</span><span class=\"p\">;)</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">func</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">param</span><span class=\"w\"> </span><span class=\"kt\">i32</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">result</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"p\">)))</span>\n<span class=\"w\">  </span><span class=\"p\">(</span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"s\">\"wasi_snapshot_preview1\"</span><span class=\"w\"> </span><span class=\"s\">\"clock_res_get\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">func</span><span class=\"w\"> </span><span class=\"p\">(;</span><span class=\"mi\">0</span><span class=\"p\">;)</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"mi\">0</span><span class=\"p\">)))</span>\n<span class=\"w\">  </span><span class=\"p\">(</span><span class=\"n\">func</span><span class=\"w\"> </span><span class=\"p\">(;</span><span class=\"mi\">1</span><span class=\"p\">;)</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"mi\">0</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">param</span><span class=\"w\"> </span><span class=\"kt\">i32</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">result</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"n\">local</span><span class=\"p\">.</span><span class=\"n\">get</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"w\">    </span><span class=\"n\">call</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">)</span>\n<span class=\"w\">  </span><span class=\"p\">(</span><span class=\"n\">memory</span><span class=\"w\"> </span><span class=\"p\">(;</span><span class=\"mi\">0</span><span class=\"p\">;)</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">)</span>\n<span class=\"w\">  </span><span class=\"p\">(</span><span class=\"n\">export</span><span class=\"w\"> </span><span class=\"s\">\"memory\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">memory</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">))</span>\n<span class=\"w\">  </span><span class=\"p\">(</span><span class=\"n\">export</span><span class=\"w\"> </span><span class=\"s\">\"_start\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">func</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">)))</span>\n</code></pre></div>\n<p>Then we use <code>wat2wasm clock_res_get.wat</code> to generate the wasm file, and use <code>wasmer vaildate clock_res_get.wasm'</code>to validate the wasm file and it passes the validation.</p>\n<p>After that, we use command <code>wasmtime --invoke \"_start\" clock_res_get.wasm 1 2</code> to execute it, but get the error:</p>\n<p><div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">Error</span>: <span class=\"nc\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"w\"> </span><span class=\"n\">module</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">clock_res_get</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"err\">`</span>\n\n<span class=\"n\">Caused</span><span class=\"w\"> </span><span class=\"n\">by</span>:\n    <span class=\"mi\">0</span>: <span class=\"nc\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">instantiate</span><span class=\"w\"> </span><span class=\"s\">\"clock_res_get.wasm\"</span>\n<span class=\"w\">    </span><span class=\"mi\">1</span>: <span class=\"nc\">incompatible</span><span class=\"w\"> </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"k\">type</span> <span class=\"nc\">for</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">wasi_snapshot_preview1</span>::<span class=\"n\">clock_res_get</span><span class=\"err\">`</span>\n<span class=\"w\">    </span><span class=\"mi\">2</span>: <span class=\"nc\">function</span><span class=\"w\"> </span><span class=\"n\">types</span><span class=\"w\"> </span><span class=\"n\">incompatible</span>: <span class=\"nc\">expected</span><span class=\"w\"> </span><span class=\"n\">func</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"k\">type</span> <span class=\"err\">`</span><span class=\"p\">(</span><span class=\"kt\">i32</span><span class=\"p\">)</span><span class=\"w\"> </span>-&gt; <span class=\"p\">(</span><span class=\"kt\">i64</span><span class=\"p\">)</span><span class=\"err\">`</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">found</span><span class=\"w\"> </span><span class=\"n\">func</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"k\">type</span> <span class=\"err\">`</span><span class=\"p\">(</span><span class=\"kt\">i32</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">i32</span><span class=\"p\">)</span><span class=\"w\"> </span>-&gt; <span class=\"p\">(</span><span class=\"kt\">i32</span><span class=\"p\">)</span><span class=\"err\">`</span>\n</code></pre></div><br>\n</p>\n</blockquote>",
        "id": 357569420,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1683808243
    },
    {
        "content": "<p>Zhangyx24 edited <a href=\"https://github.com/bytecodealliance/wasmtime/issues/6371\">issue #6371</a>:</p>\n<blockquote>\n<p>In the doc of WASI func : <a href=\"https://github.com/WebAssembly/WASI/blob/0ba0c5e2e37625ca5a6d3e4255a998dfaa3efc52/phases/snapshot/docs.md\">https://github.com/WebAssembly/WASI/blob/0ba0c5e2e37625ca5a6d3e4255a998dfaa3efc52/phases/snapshot/docs.md</a><br>\nThe signature of the WASI func 'clock_res_get' is params: i32, and result :i32.<br>\n&lt;img width=\"1302\" alt=\"截屏2023-05-11 20 22 57\" src=\"<a href=\"https://github.com/bytecodealliance/wasmtime/assets/28601300/4c0984fa-6753-49cc-a1b6-69998608bd22\">https://github.com/bytecodealliance/wasmtime/assets/28601300/4c0984fa-6753-49cc-a1b6-69998608bd22</a>\"&gt;</p>\n<p>And in the wasi_snapshot_preview1.witx (<a href=\"https://github.com/WebAssembly/WASI/blob/0ba0c5e2e37625ca5a6d3e4255a998dfaa3efc52/phases/snapshot/witx/wasi_snapshot_preview1.witx\">https://github.com/WebAssembly/WASI/blob/0ba0c5e2e37625ca5a6d3e4255a998dfaa3efc52/phases/snapshot/witx/wasi_snapshot_preview1.witx</a>), it shows the same signature of 'clock_res_get'.<br>\n&lt;img width=\"980\" alt=\"截屏2023-05-11 20 23 57\" src=\"<a href=\"https://github.com/bytecodealliance/wasmtime/assets/28601300/cc17c695-8e2a-4619-9bd1-24d3b8cfda7f\">https://github.com/bytecodealliance/wasmtime/assets/28601300/cc17c695-8e2a-4619-9bd1-24d3b8cfda7f</a>\"&gt;</p>\n<p>So we generate a wat fie to import the 'clock_res_get' func:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"p\">(</span><span class=\"n\">module</span>\n<span class=\"w\">  </span><span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"p\">(;</span><span class=\"mi\">0</span><span class=\"p\">;)</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">func</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">param</span><span class=\"w\"> </span><span class=\"kt\">i32</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">result</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"p\">)))</span>\n<span class=\"w\">  </span><span class=\"p\">(</span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"s\">\"wasi_snapshot_preview1\"</span><span class=\"w\"> </span><span class=\"s\">\"clock_res_get\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">func</span><span class=\"w\"> </span><span class=\"p\">(;</span><span class=\"mi\">0</span><span class=\"p\">;)</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"mi\">0</span><span class=\"p\">)))</span>\n<span class=\"w\">  </span><span class=\"p\">(</span><span class=\"n\">func</span><span class=\"w\"> </span><span class=\"p\">(;</span><span class=\"mi\">1</span><span class=\"p\">;)</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"mi\">0</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">param</span><span class=\"w\"> </span><span class=\"kt\">i32</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">result</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"n\">local</span><span class=\"p\">.</span><span class=\"n\">get</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"w\">    </span><span class=\"n\">call</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">)</span>\n<span class=\"w\">  </span><span class=\"p\">(</span><span class=\"n\">memory</span><span class=\"w\"> </span><span class=\"p\">(;</span><span class=\"mi\">0</span><span class=\"p\">;)</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">)</span>\n<span class=\"w\">  </span><span class=\"p\">(</span><span class=\"n\">export</span><span class=\"w\"> </span><span class=\"s\">\"memory\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">memory</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">))</span>\n<span class=\"w\">  </span><span class=\"p\">(</span><span class=\"n\">export</span><span class=\"w\"> </span><span class=\"s\">\"_start\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">func</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">)))</span>\n</code></pre></div>\n<p>Then we use <code>wat2wasm clock_res_get.wat</code> to generate the wasm file, and use <code>wasmer vaildate clock_res_get.wasm'</code>to validate the wasm file and it passes the validation.</p>\n<p>After that, we use command <code>wasmtime --invoke \"_start\" clock_res_get.wasm 1</code> to execute it, but get the error:</p>\n<p><div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">Error</span>: <span class=\"nc\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"w\"> </span><span class=\"n\">module</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">clock_res_get</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"err\">`</span>\n\n<span class=\"n\">Caused</span><span class=\"w\"> </span><span class=\"n\">by</span>:\n    <span class=\"mi\">0</span>: <span class=\"nc\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">instantiate</span><span class=\"w\"> </span><span class=\"s\">\"clock_res_get.wasm\"</span>\n<span class=\"w\">    </span><span class=\"mi\">1</span>: <span class=\"nc\">incompatible</span><span class=\"w\"> </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"k\">type</span> <span class=\"nc\">for</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">wasi_snapshot_preview1</span>::<span class=\"n\">clock_res_get</span><span class=\"err\">`</span>\n<span class=\"w\">    </span><span class=\"mi\">2</span>: <span class=\"nc\">function</span><span class=\"w\"> </span><span class=\"n\">types</span><span class=\"w\"> </span><span class=\"n\">incompatible</span>: <span class=\"nc\">expected</span><span class=\"w\"> </span><span class=\"n\">func</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"k\">type</span> <span class=\"err\">`</span><span class=\"p\">(</span><span class=\"kt\">i32</span><span class=\"p\">)</span><span class=\"w\"> </span>-&gt; <span class=\"p\">(</span><span class=\"kt\">i64</span><span class=\"p\">)</span><span class=\"err\">`</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">found</span><span class=\"w\"> </span><span class=\"n\">func</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"k\">type</span> <span class=\"err\">`</span><span class=\"p\">(</span><span class=\"kt\">i32</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">i32</span><span class=\"p\">)</span><span class=\"w\"> </span>-&gt; <span class=\"p\">(</span><span class=\"kt\">i32</span><span class=\"p\">)</span><span class=\"err\">`</span>\n</code></pre></div><br>\n</p>\n</blockquote>",
        "id": 357572006,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1683808830
    },
    {
        "content": "<p>Zhangyx24 edited <a href=\"https://github.com/bytecodealliance/wasmtime/issues/6371\">issue #6371</a>:</p>\n<blockquote>\n<p>In the doc of WASI func : <a href=\"https://github.com/WebAssembly/WASI/blob/0ba0c5e2e37625ca5a6d3e4255a998dfaa3efc52/phases/snapshot/docs.md\">https://github.com/WebAssembly/WASI/blob/0ba0c5e2e37625ca5a6d3e4255a998dfaa3efc52/phases/snapshot/docs.md</a><br>\nThe signature of the WASI func 'clock_res_get' is params: i32, and result :i32.<br>\n&lt;img width=\"1302\" alt=\"截屏2023-05-11 20 22 57\" src=\"<a href=\"https://github.com/bytecodealliance/wasmtime/assets/28601300/4c0984fa-6753-49cc-a1b6-69998608bd22\">https://github.com/bytecodealliance/wasmtime/assets/28601300/4c0984fa-6753-49cc-a1b6-69998608bd22</a>\"&gt;</p>\n<p>And in the wasi_snapshot_preview1.witx (<a href=\"https://github.com/WebAssembly/WASI/blob/0ba0c5e2e37625ca5a6d3e4255a998dfaa3efc52/phases/snapshot/witx/wasi_snapshot_preview1.witx\">https://github.com/WebAssembly/WASI/blob/0ba0c5e2e37625ca5a6d3e4255a998dfaa3efc52/phases/snapshot/witx/wasi_snapshot_preview1.witx</a>), it shows the same signature of 'clock_res_get'.<br>\n&lt;img width=\"980\" alt=\"截屏2023-05-11 20 23 57\" src=\"<a href=\"https://github.com/bytecodealliance/wasmtime/assets/28601300/cc17c695-8e2a-4619-9bd1-24d3b8cfda7f\">https://github.com/bytecodealliance/wasmtime/assets/28601300/cc17c695-8e2a-4619-9bd1-24d3b8cfda7f</a>\"&gt;</p>\n<p>So we generate a wat fie to import the 'clock_res_get' func:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"p\">(</span><span class=\"n\">module</span>\n<span class=\"w\">  </span><span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"p\">(;</span><span class=\"mi\">0</span><span class=\"p\">;)</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">func</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">param</span><span class=\"w\"> </span><span class=\"kt\">i32</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">result</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"p\">)))</span>\n<span class=\"w\">  </span><span class=\"p\">(</span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"s\">\"wasi_snapshot_preview1\"</span><span class=\"w\"> </span><span class=\"s\">\"clock_res_get\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">func</span><span class=\"w\"> </span><span class=\"p\">(;</span><span class=\"mi\">0</span><span class=\"p\">;)</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"mi\">0</span><span class=\"p\">)))</span>\n<span class=\"w\">  </span><span class=\"p\">(</span><span class=\"n\">func</span><span class=\"w\"> </span><span class=\"p\">(;</span><span class=\"mi\">1</span><span class=\"p\">;)</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"mi\">0</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">param</span><span class=\"w\"> </span><span class=\"kt\">i32</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">result</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"n\">local</span><span class=\"p\">.</span><span class=\"n\">get</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"w\">    </span><span class=\"n\">call</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">)</span>\n<span class=\"w\">  </span><span class=\"p\">(</span><span class=\"n\">memory</span><span class=\"w\"> </span><span class=\"p\">(;</span><span class=\"mi\">0</span><span class=\"p\">;)</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">)</span>\n<span class=\"w\">  </span><span class=\"p\">(</span><span class=\"n\">export</span><span class=\"w\"> </span><span class=\"s\">\"memory\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">memory</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">))</span>\n<span class=\"w\">  </span><span class=\"p\">(</span><span class=\"n\">export</span><span class=\"w\"> </span><span class=\"s\">\"_start\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">func</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">)))</span>\n</code></pre></div>\n<p>Then we use <code>wat2wasm clock_res_get.wat</code> to generate the wasm file, and use <code>wasmer vaildate clock_res_get.wasm'</code>to validate the wasm file and it passes the validation.</p>\n<p>After that, we use command <code>wasmtime --invoke \"_start\" clock_res_get.wasm 1</code> to execute it, but get the error:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">Error</span>: <span class=\"nc\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"w\"> </span><span class=\"n\">module</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">clock_res_get</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"err\">`</span>\n\n<span class=\"n\">Caused</span><span class=\"w\"> </span><span class=\"n\">by</span>:\n    <span class=\"mi\">0</span>: <span class=\"nc\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">instantiate</span><span class=\"w\"> </span><span class=\"s\">\"clock_res_get.wasm\"</span>\n<span class=\"w\">    </span><span class=\"mi\">1</span>: <span class=\"nc\">incompatible</span><span class=\"w\"> </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"k\">type</span> <span class=\"nc\">for</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">wasi_snapshot_preview1</span>::<span class=\"n\">clock_res_get</span><span class=\"err\">`</span>\n<span class=\"w\">    </span><span class=\"mi\">2</span>: <span class=\"nc\">function</span><span class=\"w\"> </span><span class=\"n\">types</span><span class=\"w\"> </span><span class=\"n\">incompatible</span>: <span class=\"nc\">expected</span><span class=\"w\"> </span><span class=\"n\">func</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"k\">type</span> <span class=\"err\">`</span><span class=\"p\">(</span><span class=\"kt\">i32</span><span class=\"p\">)</span><span class=\"w\"> </span>-&gt; <span class=\"p\">(</span><span class=\"kt\">i64</span><span class=\"p\">)</span><span class=\"err\">`</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">found</span><span class=\"w\"> </span><span class=\"n\">func</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"k\">type</span> <span class=\"err\">`</span><span class=\"p\">(</span><span class=\"kt\">i32</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">i32</span><span class=\"p\">)</span><span class=\"w\"> </span>-&gt; <span class=\"p\">(</span><span class=\"kt\">i32</span><span class=\"p\">)</span><span class=\"err\">`</span>\n</code></pre></div>\n<p>And <code>wasmer clock_res_get.wasm</code> get the same error:</p>\n<p><div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">error</span>: <span class=\"nc\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">clock_res_get</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"err\">`</span>\n<span class=\"err\">│</span><span class=\"w\">   </span><span class=\"mi\">1</span>: <span class=\"nc\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">instantiate</span><span class=\"w\"> </span><span class=\"n\">WASI</span><span class=\"w\"> </span><span class=\"n\">module</span>\n<span class=\"err\">╰─▶</span><span class=\"w\"> </span><span class=\"mi\">2</span>: <span class=\"nc\">Error</span><span class=\"w\"> </span><span class=\"k\">while</span><span class=\"w\"> </span><span class=\"n\">importing</span><span class=\"w\"> </span><span class=\"s\">\"wasi_snapshot_preview1\"</span><span class=\"p\">.</span><span class=\"s\">\"clock_res_get\"</span>: <span class=\"nc\">incompatible</span><span class=\"w\"> </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"k\">type</span><span class=\"p\">.</span><span class=\"w\"> </span><span class=\"n\">Expected</span><span class=\"w\"> </span><span class=\"n\">Function</span><span class=\"p\">(</span><span class=\"n\">FunctionType</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">params</span>: <span class=\"p\">[</span><span class=\"n\">I32</span><span class=\"p\">],</span><span class=\"w\"> </span><span class=\"n\">results</span>: <span class=\"p\">[</span><span class=\"n\">I64</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"p\">})</span><span class=\"w\"> </span><span class=\"n\">but</span><span class=\"w\"> </span><span class=\"n\">received</span><span class=\"w\"> </span><span class=\"n\">Function</span><span class=\"p\">(</span><span class=\"n\">FunctionType</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">params</span>: <span class=\"p\">[</span><span class=\"n\">I32</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">I32</span><span class=\"p\">],</span><span class=\"w\"> </span><span class=\"n\">results</span>: <span class=\"p\">[</span><span class=\"n\">I32</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"p\">})</span>\n</code></pre></div><br>\n</p>\n</blockquote>",
        "id": 357572828,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1683808992
    },
    {
        "content": "<p>Zhangyx24 closed <a href=\"https://github.com/bytecodealliance/wasmtime/issues/6371\">issue #6371</a>:</p>\n<blockquote>\n<p>In the doc of WASI func : <a href=\"https://github.com/WebAssembly/WASI/blob/0ba0c5e2e37625ca5a6d3e4255a998dfaa3efc52/phases/snapshot/docs.md\">https://github.com/WebAssembly/WASI/blob/0ba0c5e2e37625ca5a6d3e4255a998dfaa3efc52/phases/snapshot/docs.md</a><br>\nThe signature of the WASI func 'clock_res_get' is params: i32, and result :i32.<br>\n&lt;img width=\"1302\" alt=\"截屏2023-05-11 20 22 57\" src=\"<a href=\"https://github.com/bytecodealliance/wasmtime/assets/28601300/4c0984fa-6753-49cc-a1b6-69998608bd22\">https://github.com/bytecodealliance/wasmtime/assets/28601300/4c0984fa-6753-49cc-a1b6-69998608bd22</a>\"&gt;</p>\n<p>And in the wasi_snapshot_preview1.witx (<a href=\"https://github.com/WebAssembly/WASI/blob/0ba0c5e2e37625ca5a6d3e4255a998dfaa3efc52/phases/snapshot/witx/wasi_snapshot_preview1.witx\">https://github.com/WebAssembly/WASI/blob/0ba0c5e2e37625ca5a6d3e4255a998dfaa3efc52/phases/snapshot/witx/wasi_snapshot_preview1.witx</a>), it shows the same signature of 'clock_res_get'.<br>\n&lt;img width=\"980\" alt=\"截屏2023-05-11 20 23 57\" src=\"<a href=\"https://github.com/bytecodealliance/wasmtime/assets/28601300/cc17c695-8e2a-4619-9bd1-24d3b8cfda7f\">https://github.com/bytecodealliance/wasmtime/assets/28601300/cc17c695-8e2a-4619-9bd1-24d3b8cfda7f</a>\"&gt;</p>\n<p>So we generate a wat fie to import the 'clock_res_get' func:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"p\">(</span><span class=\"n\">module</span>\n<span class=\"w\">  </span><span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"p\">(;</span><span class=\"mi\">0</span><span class=\"p\">;)</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">func</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">param</span><span class=\"w\"> </span><span class=\"kt\">i32</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">result</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"p\">)))</span>\n<span class=\"w\">  </span><span class=\"p\">(</span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"s\">\"wasi_snapshot_preview1\"</span><span class=\"w\"> </span><span class=\"s\">\"clock_res_get\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">func</span><span class=\"w\"> </span><span class=\"p\">(;</span><span class=\"mi\">0</span><span class=\"p\">;)</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"mi\">0</span><span class=\"p\">)))</span>\n<span class=\"w\">  </span><span class=\"p\">(</span><span class=\"n\">func</span><span class=\"w\"> </span><span class=\"p\">(;</span><span class=\"mi\">1</span><span class=\"p\">;)</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"mi\">0</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">param</span><span class=\"w\"> </span><span class=\"kt\">i32</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">result</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"n\">local</span><span class=\"p\">.</span><span class=\"n\">get</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"w\">    </span><span class=\"n\">call</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">)</span>\n<span class=\"w\">  </span><span class=\"p\">(</span><span class=\"n\">memory</span><span class=\"w\"> </span><span class=\"p\">(;</span><span class=\"mi\">0</span><span class=\"p\">;)</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">)</span>\n<span class=\"w\">  </span><span class=\"p\">(</span><span class=\"n\">export</span><span class=\"w\"> </span><span class=\"s\">\"memory\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">memory</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">))</span>\n<span class=\"w\">  </span><span class=\"p\">(</span><span class=\"n\">export</span><span class=\"w\"> </span><span class=\"s\">\"_start\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">func</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">)))</span>\n</code></pre></div>\n<p>Then we use <code>wat2wasm clock_res_get.wat</code> to generate the wasm file, and use <code>wasmer vaildate clock_res_get.wasm'</code>to validate the wasm file and it passes the validation.</p>\n<p>After that, we use command <code>wasmtime --invoke \"_start\" clock_res_get.wasm 1</code> to execute it, but get the error:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">Error</span>: <span class=\"nc\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"w\"> </span><span class=\"n\">module</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">clock_res_get</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"err\">`</span>\n\n<span class=\"n\">Caused</span><span class=\"w\"> </span><span class=\"n\">by</span>:\n    <span class=\"mi\">0</span>: <span class=\"nc\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">instantiate</span><span class=\"w\"> </span><span class=\"s\">\"clock_res_get.wasm\"</span>\n<span class=\"w\">    </span><span class=\"mi\">1</span>: <span class=\"nc\">incompatible</span><span class=\"w\"> </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"k\">type</span> <span class=\"nc\">for</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">wasi_snapshot_preview1</span>::<span class=\"n\">clock_res_get</span><span class=\"err\">`</span>\n<span class=\"w\">    </span><span class=\"mi\">2</span>: <span class=\"nc\">function</span><span class=\"w\"> </span><span class=\"n\">types</span><span class=\"w\"> </span><span class=\"n\">incompatible</span>: <span class=\"nc\">expected</span><span class=\"w\"> </span><span class=\"n\">func</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"k\">type</span> <span class=\"err\">`</span><span class=\"p\">(</span><span class=\"kt\">i32</span><span class=\"p\">)</span><span class=\"w\"> </span>-&gt; <span class=\"p\">(</span><span class=\"kt\">i64</span><span class=\"p\">)</span><span class=\"err\">`</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">found</span><span class=\"w\"> </span><span class=\"n\">func</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"k\">type</span> <span class=\"err\">`</span><span class=\"p\">(</span><span class=\"kt\">i32</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">i32</span><span class=\"p\">)</span><span class=\"w\"> </span>-&gt; <span class=\"p\">(</span><span class=\"kt\">i32</span><span class=\"p\">)</span><span class=\"err\">`</span>\n</code></pre></div>\n<p>And <code>wasmer clock_res_get.wasm</code> get the same error:</p>\n<p><div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">error</span>: <span class=\"nc\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">clock_res_get</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"err\">`</span>\n<span class=\"err\">│</span><span class=\"w\">   </span><span class=\"mi\">1</span>: <span class=\"nc\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">instantiate</span><span class=\"w\"> </span><span class=\"n\">WASI</span><span class=\"w\"> </span><span class=\"n\">module</span>\n<span class=\"err\">╰─▶</span><span class=\"w\"> </span><span class=\"mi\">2</span>: <span class=\"nc\">Error</span><span class=\"w\"> </span><span class=\"k\">while</span><span class=\"w\"> </span><span class=\"n\">importing</span><span class=\"w\"> </span><span class=\"s\">\"wasi_snapshot_preview1\"</span><span class=\"p\">.</span><span class=\"s\">\"clock_res_get\"</span>: <span class=\"nc\">incompatible</span><span class=\"w\"> </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"k\">type</span><span class=\"p\">.</span><span class=\"w\"> </span><span class=\"n\">Expected</span><span class=\"w\"> </span><span class=\"n\">Function</span><span class=\"p\">(</span><span class=\"n\">FunctionType</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">params</span>: <span class=\"p\">[</span><span class=\"n\">I32</span><span class=\"p\">],</span><span class=\"w\"> </span><span class=\"n\">results</span>: <span class=\"p\">[</span><span class=\"n\">I64</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"p\">})</span><span class=\"w\"> </span><span class=\"n\">but</span><span class=\"w\"> </span><span class=\"n\">received</span><span class=\"w\"> </span><span class=\"n\">Function</span><span class=\"p\">(</span><span class=\"n\">FunctionType</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">params</span>: <span class=\"p\">[</span><span class=\"n\">I32</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">I32</span><span class=\"p\">],</span><span class=\"w\"> </span><span class=\"n\">results</span>: <span class=\"p\">[</span><span class=\"n\">I32</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"p\">})</span>\n</code></pre></div><br>\n</p>\n</blockquote>",
        "id": 357586386,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1683811727
    },
    {
        "content": "<p>bjorn3 <a href=\"https://github.com/bytecodealliance/wasmtime/issues/6371#issuecomment-1544014617\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/6371\">issue #6371</a>:</p>\n<blockquote>\n<p>If a result type is <code>(expected $some_type (error $errno))</code> in witx, an out pointer is used for the <code>$some_type</code> value, while the return value is <code>$errno</code>. See for example <a href=\"https://docs.rs/wasi/latest/src/wasi/lib_generated.rs.html#1282-1289\">https://docs.rs/wasi/latest/src/wasi/lib_generated.rs.html#1282-1289</a> on how to call it.</p>\n</blockquote>",
        "id": 357586548,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1683811767
    },
    {
        "content": "<p>Zhangyx24 reopened <a href=\"https://github.com/bytecodealliance/wasmtime/issues/6371\">issue #6371</a>:</p>\n<blockquote>\n<p>In the doc of WASI func : <a href=\"https://github.com/WebAssembly/WASI/blob/0ba0c5e2e37625ca5a6d3e4255a998dfaa3efc52/phases/snapshot/docs.md\">https://github.com/WebAssembly/WASI/blob/0ba0c5e2e37625ca5a6d3e4255a998dfaa3efc52/phases/snapshot/docs.md</a><br>\nThe signature of the WASI func 'clock_res_get' is params: i32, and result :i32.<br>\n&lt;img width=\"1302\" alt=\"截屏2023-05-11 20 22 57\" src=\"<a href=\"https://github.com/bytecodealliance/wasmtime/assets/28601300/4c0984fa-6753-49cc-a1b6-69998608bd22\">https://github.com/bytecodealliance/wasmtime/assets/28601300/4c0984fa-6753-49cc-a1b6-69998608bd22</a>\"&gt;</p>\n<p>And in the wasi_snapshot_preview1.witx (<a href=\"https://github.com/WebAssembly/WASI/blob/0ba0c5e2e37625ca5a6d3e4255a998dfaa3efc52/phases/snapshot/witx/wasi_snapshot_preview1.witx\">https://github.com/WebAssembly/WASI/blob/0ba0c5e2e37625ca5a6d3e4255a998dfaa3efc52/phases/snapshot/witx/wasi_snapshot_preview1.witx</a>), it shows the same signature of 'clock_res_get'.<br>\n&lt;img width=\"980\" alt=\"截屏2023-05-11 20 23 57\" src=\"<a href=\"https://github.com/bytecodealliance/wasmtime/assets/28601300/cc17c695-8e2a-4619-9bd1-24d3b8cfda7f\">https://github.com/bytecodealliance/wasmtime/assets/28601300/cc17c695-8e2a-4619-9bd1-24d3b8cfda7f</a>\"&gt;</p>\n<p>So we generate a wat fie to import the 'clock_res_get' func:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"p\">(</span><span class=\"n\">module</span>\n<span class=\"w\">  </span><span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"p\">(;</span><span class=\"mi\">0</span><span class=\"p\">;)</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">func</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">param</span><span class=\"w\"> </span><span class=\"kt\">i32</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">result</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"p\">)))</span>\n<span class=\"w\">  </span><span class=\"p\">(</span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"s\">\"wasi_snapshot_preview1\"</span><span class=\"w\"> </span><span class=\"s\">\"clock_res_get\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">func</span><span class=\"w\"> </span><span class=\"p\">(;</span><span class=\"mi\">0</span><span class=\"p\">;)</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"mi\">0</span><span class=\"p\">)))</span>\n<span class=\"w\">  </span><span class=\"p\">(</span><span class=\"n\">func</span><span class=\"w\"> </span><span class=\"p\">(;</span><span class=\"mi\">1</span><span class=\"p\">;)</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"mi\">0</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">param</span><span class=\"w\"> </span><span class=\"kt\">i32</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">result</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"n\">local</span><span class=\"p\">.</span><span class=\"n\">get</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"w\">    </span><span class=\"n\">call</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">)</span>\n<span class=\"w\">  </span><span class=\"p\">(</span><span class=\"n\">memory</span><span class=\"w\"> </span><span class=\"p\">(;</span><span class=\"mi\">0</span><span class=\"p\">;)</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">)</span>\n<span class=\"w\">  </span><span class=\"p\">(</span><span class=\"n\">export</span><span class=\"w\"> </span><span class=\"s\">\"memory\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">memory</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">))</span>\n<span class=\"w\">  </span><span class=\"p\">(</span><span class=\"n\">export</span><span class=\"w\"> </span><span class=\"s\">\"_start\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">func</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">)))</span>\n</code></pre></div>\n<p>Then we use <code>wat2wasm clock_res_get.wat</code> to generate the wasm file, and use <code>wasmer vaildate clock_res_get.wasm'</code>to validate the wasm file and it passes the validation.</p>\n<p>After that, we use command <code>wasmtime --invoke \"_start\" clock_res_get.wasm 1</code> to execute it, but get the error:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">Error</span>: <span class=\"nc\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"w\"> </span><span class=\"n\">module</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">clock_res_get</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"err\">`</span>\n\n<span class=\"n\">Caused</span><span class=\"w\"> </span><span class=\"n\">by</span>:\n    <span class=\"mi\">0</span>: <span class=\"nc\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">instantiate</span><span class=\"w\"> </span><span class=\"s\">\"clock_res_get.wasm\"</span>\n<span class=\"w\">    </span><span class=\"mi\">1</span>: <span class=\"nc\">incompatible</span><span class=\"w\"> </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"k\">type</span> <span class=\"nc\">for</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">wasi_snapshot_preview1</span>::<span class=\"n\">clock_res_get</span><span class=\"err\">`</span>\n<span class=\"w\">    </span><span class=\"mi\">2</span>: <span class=\"nc\">function</span><span class=\"w\"> </span><span class=\"n\">types</span><span class=\"w\"> </span><span class=\"n\">incompatible</span>: <span class=\"nc\">expected</span><span class=\"w\"> </span><span class=\"n\">func</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"k\">type</span> <span class=\"err\">`</span><span class=\"p\">(</span><span class=\"kt\">i32</span><span class=\"p\">)</span><span class=\"w\"> </span>-&gt; <span class=\"p\">(</span><span class=\"kt\">i64</span><span class=\"p\">)</span><span class=\"err\">`</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">found</span><span class=\"w\"> </span><span class=\"n\">func</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"k\">type</span> <span class=\"err\">`</span><span class=\"p\">(</span><span class=\"kt\">i32</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">i32</span><span class=\"p\">)</span><span class=\"w\"> </span>-&gt; <span class=\"p\">(</span><span class=\"kt\">i32</span><span class=\"p\">)</span><span class=\"err\">`</span>\n</code></pre></div>\n<p>And <code>wasmer clock_res_get.wasm</code> get the same error:</p>\n<p><div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">error</span>: <span class=\"nc\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">clock_res_get</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"err\">`</span>\n<span class=\"err\">│</span><span class=\"w\">   </span><span class=\"mi\">1</span>: <span class=\"nc\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">instantiate</span><span class=\"w\"> </span><span class=\"n\">WASI</span><span class=\"w\"> </span><span class=\"n\">module</span>\n<span class=\"err\">╰─▶</span><span class=\"w\"> </span><span class=\"mi\">2</span>: <span class=\"nc\">Error</span><span class=\"w\"> </span><span class=\"k\">while</span><span class=\"w\"> </span><span class=\"n\">importing</span><span class=\"w\"> </span><span class=\"s\">\"wasi_snapshot_preview1\"</span><span class=\"p\">.</span><span class=\"s\">\"clock_res_get\"</span>: <span class=\"nc\">incompatible</span><span class=\"w\"> </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"k\">type</span><span class=\"p\">.</span><span class=\"w\"> </span><span class=\"n\">Expected</span><span class=\"w\"> </span><span class=\"n\">Function</span><span class=\"p\">(</span><span class=\"n\">FunctionType</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">params</span>: <span class=\"p\">[</span><span class=\"n\">I32</span><span class=\"p\">],</span><span class=\"w\"> </span><span class=\"n\">results</span>: <span class=\"p\">[</span><span class=\"n\">I64</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"p\">})</span><span class=\"w\"> </span><span class=\"n\">but</span><span class=\"w\"> </span><span class=\"n\">received</span><span class=\"w\"> </span><span class=\"n\">Function</span><span class=\"p\">(</span><span class=\"n\">FunctionType</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">params</span>: <span class=\"p\">[</span><span class=\"n\">I32</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">I32</span><span class=\"p\">],</span><span class=\"w\"> </span><span class=\"n\">results</span>: <span class=\"p\">[</span><span class=\"n\">I32</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"p\">})</span>\n</code></pre></div><br>\n</p>\n</blockquote>",
        "id": 357586552,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1683811768
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/6371#issuecomment-1544192528\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/6371\">issue #6371</a>:</p>\n<blockquote>\n<p>I'd recommend following the link that @bjorn3 mentioned to determine the ABIs here. Otherwise the error here is correct and working as expected, so I'm going to close this.</p>\n<p>When you say you generated a <code>*.wat</code>, though, how did you generate that? What led you to thinking that the return value could be <code>i64</code>?</p>\n<p>Additionally the validation phase of WebAssembly does not check against actual host imports, it instead only validates the WebAssembly module in isolation. Instantiation later on, when host imports are provided, is where further type-checking happens to ensure that whatever is imported by the module is actually provided by the host.</p>\n</blockquote>",
        "id": 357623364,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1683818572
    },
    {
        "content": "<p>alexcrichton closed <a href=\"https://github.com/bytecodealliance/wasmtime/issues/6371\">issue #6371</a>:</p>\n<blockquote>\n<p>In the doc of WASI func : <a href=\"https://github.com/WebAssembly/WASI/blob/0ba0c5e2e37625ca5a6d3e4255a998dfaa3efc52/phases/snapshot/docs.md\">https://github.com/WebAssembly/WASI/blob/0ba0c5e2e37625ca5a6d3e4255a998dfaa3efc52/phases/snapshot/docs.md</a><br>\nThe signature of the WASI func 'clock_res_get' is params: i32, and result :i32.<br>\n&lt;img width=\"1302\" alt=\"截屏2023-05-11 20 22 57\" src=\"<a href=\"https://github.com/bytecodealliance/wasmtime/assets/28601300/4c0984fa-6753-49cc-a1b6-69998608bd22\">https://github.com/bytecodealliance/wasmtime/assets/28601300/4c0984fa-6753-49cc-a1b6-69998608bd22</a>\"&gt;</p>\n<p>And in the wasi_snapshot_preview1.witx (<a href=\"https://github.com/WebAssembly/WASI/blob/0ba0c5e2e37625ca5a6d3e4255a998dfaa3efc52/phases/snapshot/witx/wasi_snapshot_preview1.witx\">https://github.com/WebAssembly/WASI/blob/0ba0c5e2e37625ca5a6d3e4255a998dfaa3efc52/phases/snapshot/witx/wasi_snapshot_preview1.witx</a>), it shows the same signature of 'clock_res_get'.<br>\n&lt;img width=\"980\" alt=\"截屏2023-05-11 20 23 57\" src=\"<a href=\"https://github.com/bytecodealliance/wasmtime/assets/28601300/cc17c695-8e2a-4619-9bd1-24d3b8cfda7f\">https://github.com/bytecodealliance/wasmtime/assets/28601300/cc17c695-8e2a-4619-9bd1-24d3b8cfda7f</a>\"&gt;</p>\n<p>So we generate a wat fie to import the 'clock_res_get' func:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"p\">(</span><span class=\"n\">module</span>\n<span class=\"w\">  </span><span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"p\">(;</span><span class=\"mi\">0</span><span class=\"p\">;)</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">func</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">param</span><span class=\"w\"> </span><span class=\"kt\">i32</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">result</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"p\">)))</span>\n<span class=\"w\">  </span><span class=\"p\">(</span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"s\">\"wasi_snapshot_preview1\"</span><span class=\"w\"> </span><span class=\"s\">\"clock_res_get\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">func</span><span class=\"w\"> </span><span class=\"p\">(;</span><span class=\"mi\">0</span><span class=\"p\">;)</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"mi\">0</span><span class=\"p\">)))</span>\n<span class=\"w\">  </span><span class=\"p\">(</span><span class=\"n\">func</span><span class=\"w\"> </span><span class=\"p\">(;</span><span class=\"mi\">1</span><span class=\"p\">;)</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"k\">type</span> <span class=\"mi\">0</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">param</span><span class=\"w\"> </span><span class=\"kt\">i32</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">result</span><span class=\"w\"> </span><span class=\"kt\">i64</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"n\">local</span><span class=\"p\">.</span><span class=\"n\">get</span><span class=\"w\"> </span><span class=\"mi\">0</span>\n<span class=\"w\">    </span><span class=\"n\">call</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">)</span>\n<span class=\"w\">  </span><span class=\"p\">(</span><span class=\"n\">memory</span><span class=\"w\"> </span><span class=\"p\">(;</span><span class=\"mi\">0</span><span class=\"p\">;)</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">)</span>\n<span class=\"w\">  </span><span class=\"p\">(</span><span class=\"n\">export</span><span class=\"w\"> </span><span class=\"s\">\"memory\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">memory</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">))</span>\n<span class=\"w\">  </span><span class=\"p\">(</span><span class=\"n\">export</span><span class=\"w\"> </span><span class=\"s\">\"_start\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">func</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">)))</span>\n</code></pre></div>\n<p>Then we use <code>wat2wasm clock_res_get.wat</code> to generate the wasm file, and use <code>wasmer vaildate clock_res_get.wasm'</code>to validate the wasm file and it passes the validation.</p>\n<p>After that, we use command <code>wasmtime --invoke \"_start\" clock_res_get.wasm 1</code> to execute it, but get the error:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">Error</span>: <span class=\"nc\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"w\"> </span><span class=\"n\">module</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">clock_res_get</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"err\">`</span>\n\n<span class=\"n\">Caused</span><span class=\"w\"> </span><span class=\"n\">by</span>:\n    <span class=\"mi\">0</span>: <span class=\"nc\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">instantiate</span><span class=\"w\"> </span><span class=\"s\">\"clock_res_get.wasm\"</span>\n<span class=\"w\">    </span><span class=\"mi\">1</span>: <span class=\"nc\">incompatible</span><span class=\"w\"> </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"k\">type</span> <span class=\"nc\">for</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">wasi_snapshot_preview1</span>::<span class=\"n\">clock_res_get</span><span class=\"err\">`</span>\n<span class=\"w\">    </span><span class=\"mi\">2</span>: <span class=\"nc\">function</span><span class=\"w\"> </span><span class=\"n\">types</span><span class=\"w\"> </span><span class=\"n\">incompatible</span>: <span class=\"nc\">expected</span><span class=\"w\"> </span><span class=\"n\">func</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"k\">type</span> <span class=\"err\">`</span><span class=\"p\">(</span><span class=\"kt\">i32</span><span class=\"p\">)</span><span class=\"w\"> </span>-&gt; <span class=\"p\">(</span><span class=\"kt\">i64</span><span class=\"p\">)</span><span class=\"err\">`</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">found</span><span class=\"w\"> </span><span class=\"n\">func</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"k\">type</span> <span class=\"err\">`</span><span class=\"p\">(</span><span class=\"kt\">i32</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">i32</span><span class=\"p\">)</span><span class=\"w\"> </span>-&gt; <span class=\"p\">(</span><span class=\"kt\">i32</span><span class=\"p\">)</span><span class=\"err\">`</span>\n</code></pre></div>\n<p>And <code>wasmer clock_res_get.wasm</code> get the same error:</p>\n<p><div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">error</span>: <span class=\"nc\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">clock_res_get</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"err\">`</span>\n<span class=\"err\">│</span><span class=\"w\">   </span><span class=\"mi\">1</span>: <span class=\"nc\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">instantiate</span><span class=\"w\"> </span><span class=\"n\">WASI</span><span class=\"w\"> </span><span class=\"n\">module</span>\n<span class=\"err\">╰─▶</span><span class=\"w\"> </span><span class=\"mi\">2</span>: <span class=\"nc\">Error</span><span class=\"w\"> </span><span class=\"k\">while</span><span class=\"w\"> </span><span class=\"n\">importing</span><span class=\"w\"> </span><span class=\"s\">\"wasi_snapshot_preview1\"</span><span class=\"p\">.</span><span class=\"s\">\"clock_res_get\"</span>: <span class=\"nc\">incompatible</span><span class=\"w\"> </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"k\">type</span><span class=\"p\">.</span><span class=\"w\"> </span><span class=\"n\">Expected</span><span class=\"w\"> </span><span class=\"n\">Function</span><span class=\"p\">(</span><span class=\"n\">FunctionType</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">params</span>: <span class=\"p\">[</span><span class=\"n\">I32</span><span class=\"p\">],</span><span class=\"w\"> </span><span class=\"n\">results</span>: <span class=\"p\">[</span><span class=\"n\">I64</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"p\">})</span><span class=\"w\"> </span><span class=\"n\">but</span><span class=\"w\"> </span><span class=\"n\">received</span><span class=\"w\"> </span><span class=\"n\">Function</span><span class=\"p\">(</span><span class=\"n\">FunctionType</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">params</span>: <span class=\"p\">[</span><span class=\"n\">I32</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">I32</span><span class=\"p\">],</span><span class=\"w\"> </span><span class=\"n\">results</span>: <span class=\"p\">[</span><span class=\"n\">I32</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"p\">})</span>\n</code></pre></div><br>\n</p>\n</blockquote>",
        "id": 357623365,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1683818572
    },
    {
        "content": "<p>Zhangyx24 <a href=\"https://github.com/bytecodealliance/wasmtime/issues/6371#issuecomment-1545045970\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/6371\">issue #6371</a>:</p>\n<blockquote>\n<p>Thanks a lot.<br>\n</p>\n</blockquote>",
        "id": 357741104,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1683860917
    }
]