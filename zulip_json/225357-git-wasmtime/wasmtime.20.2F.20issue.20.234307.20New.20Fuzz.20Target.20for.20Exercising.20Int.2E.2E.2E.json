[
    {
        "content": "<p>fitzgen opened <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4307\">issue #4307</a>:</p>\n<blockquote>\n<p>To help make the component model and interface types production ready, we want<br>\nto extensively fuzz and exercise Wasmtime's ability to pass interface values<br>\nback and forth with Wasm.</p>\n<p>This fuzz target should:</p>\n<ul>\n<li>generate an arbitrary interface type <code>T</code>,</li>\n<li>\n<p>generate a Wasm component that</p>\n<ul>\n<li>imports a host function <code>T -&gt; T</code>, and</li>\n<li>exports a function <code>T -&gt; T</code> that passes its argument to the import function<br>\n  and returns the result of the import function,</li>\n</ul>\n</li>\n<li>\n<p>generate some number of arbitrary values of type <code>T</code>,</p>\n</li>\n<li>\n<p>and for each value:</p>\n<ul>\n<li>call the Wasm's exported function,</li>\n<li>\n<p>when the host function is called, assert that the argument is equal to the<br>\n  original value,</p>\n</li>\n<li>\n<p>return the argument from the host function,</p>\n</li>\n<li>\n<p>when the Wasm function returns to the host, assert that the argument is<br>\n  equal to the original value,</p>\n</li>\n<li>\n<p>assert that the host function was actually called.</p>\n</li>\n</ul>\n</li>\n</ul>\n<p>This tests that we can round trip interface values of type <code>T</code> both as arguments<br>\nand returns to and from Wasm.</p>\n<p>Here is a diagram showing what the fuzz target should do:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"o\">+-------------------+</span><span class=\"w\">                   </span><span class=\"o\">+------------------+</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">Host</span><span class=\"w\">              </span><span class=\"o\">|</span><span class=\"w\">                   </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">Wasm</span><span class=\"w\">             </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">                   </span><span class=\"o\">|</span><span class=\"w\">   </span><span class=\"n\">argument</span><span class=\"w\">        </span><span class=\"o\">|</span><span class=\"w\">                  </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">     </span><span class=\"n\">arbitrary</span><span class=\"w\"> </span><span class=\"o\">-----------------------------</span>-&gt;            <span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">     </span><span class=\"n\">value</span><span class=\"w\">         </span><span class=\"o\">|</span><span class=\"w\">                   </span><span class=\"o\">|</span><span class=\"w\">      </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">                   </span><span class=\"o\">|</span><span class=\"w\">                   </span><span class=\"o\">|</span><span class=\"w\">      </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">                   </span><span class=\"o\">|</span><span class=\"w\">                   </span><span class=\"o\">|</span><span class=\"w\">      </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">         </span><span class=\"o\">+-----------------+</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\">      </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">         </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">host</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\">   </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\">      </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">         </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">imported</span><span class=\"w\"> </span><span class=\"n\">by</span><span class=\"w\">     </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\">      </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">         </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">Wasm</span><span class=\"w\">            </span><span class=\"o\">|</span><span class=\"w\">  </span><span class=\"n\">argument</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\">      </span><span class=\"n\">V</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">         </span><span class=\"o\">|</span><span class=\"w\">            </span><span class=\"o\">&lt;-----------------------</span><span class=\"w\">            </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">         </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\">     </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\">                  </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">         </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">assert</span><span class=\"w\">    </span><span class=\"o\">|</span><span class=\"w\">     </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\">                  </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">         </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">value</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\">  </span><span class=\"o\">|</span><span class=\"w\">     </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\">                  </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">         </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">equal</span><span class=\"w\">     </span><span class=\"n\">V</span><span class=\"w\">     </span><span class=\"o\">|</span><span class=\"w\">  </span><span class=\"k\">return</span><span class=\"w\">   </span><span class=\"o\">|</span><span class=\"w\">                  </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">         </span><span class=\"o\">|</span><span class=\"w\">            </span><span class=\"o\">----------------------</span>-&gt;            <span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">         </span><span class=\"o\">|</span><span class=\"w\">                 </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\">      </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">         </span><span class=\"o\">+-----------------+</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\">      </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">                   </span><span class=\"o\">|</span><span class=\"w\">                   </span><span class=\"o\">|</span><span class=\"w\">      </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">                   </span><span class=\"o\">|</span><span class=\"w\">                   </span><span class=\"o\">|</span><span class=\"w\">      </span><span class=\"n\">V</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">   </span><span class=\"n\">assert</span><span class=\"w\">    </span><span class=\"o\">&lt;--------------------------------</span><span class=\"w\">            </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">   </span><span class=\"n\">value</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\">        </span><span class=\"o\">|</span><span class=\"w\">                   </span><span class=\"o\">|</span><span class=\"w\">                  </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">   </span><span class=\"n\">equal</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\">                   </span><span class=\"o\">|</span><span class=\"w\">                  </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">                   </span><span class=\"o\">|</span><span class=\"w\">                   </span><span class=\"o\">|</span><span class=\"w\">                  </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">+-------------------+</span><span class=\"w\">                   </span><span class=\"o\">+------------------+</span><span class=\"w\"></span>\n</code></pre></div>\n<h2>Test Case Generator</h2>\n<p>The test case generator will be responsible for generating</p>\n<ul>\n<li>the arbitrary interface type <code>T</code>,</li>\n<li>\n<p>the Wasm component that takes values of type <code>T</code>, passes them to the imported<br>\n  host function, and returns the result of the host function,</p>\n</li>\n<li>\n<p>and instances of type <code>T</code>.</p>\n</li>\n</ul>\n<h2>Oracle</h2>\n<p>There are two versions of the oracle:</p>\n<ol>\n<li>\n<p>a version that uses the dynamic interface types API to pass values to Wasm,<br>\n   and</p>\n</li>\n<li>\n<p>a version that uses the static interface types API to pass values to Wasm.</p>\n</li>\n</ol>\n<h3>Dynamic API Oracle</h3>\n<p>The dynamic API oracle will be paired with the test case generator <em>at runtime</em><br>\nand use Wasmtime's dynamic API for interface type values (doesn't exist at time<br>\nof writing; the component equivalent of <code>wasmtime::Val</code>).</p>\n<h3>Static API Oracle</h3>\n<p>The static API oracle will use the test case generator <em>at build time</em> to<br>\ngenerate, say, 1000 interface types <code>T</code> to fuzz, and then generate arbitrary<br>\ninstances of <code>T</code> at runtime. This means that if <code>T</code> is a struct, for example, we<br>\ncan define a Rust type like</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"cp\">#[derive(InterfaceType)]</span><span class=\"w\"></span>\n<span class=\"k\">struct</span> <span class=\"nc\">MyRustType</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">foo</span>: <span class=\"kt\">u32</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">bar</span>: <span class=\"nb\">String</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n</code></pre></div>\n<p>whose instances can be passed to the Wasm directly via Wasmtime's static API for<br>\ninterface types. We will generate arbitrary instance of <code>MyRustType</code> at runtime<br>\nin this scenario, but not new types <code>T</code>.</p>\n<p>(Note that <code>derive(InterfaceType)</code> does not exist at the time of writing.)<br>\n</p>\n</blockquote>",
        "id": 287230719,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1656009086
    },
    {
        "content": "<p>fitzgen <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4307#issuecomment-1164743223\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4307\">issue #4307</a>:</p>\n<blockquote>\n<p>We might actually want to have two instances of the Wasm component, so that values flow like</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">argument</span>: <span class=\"nc\">host</span><span class=\"w\"> </span><span class=\"o\">--</span>-&gt; <span class=\"nc\">wasm</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">--</span>-&gt; <span class=\"nc\">wasm</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"o\">--</span>-&gt; <span class=\"nc\">host</span><span class=\"w\"> </span><span class=\"n\">import</span><span class=\"w\"></span>\n<span class=\"k\">return</span>: <span class=\"nc\">host</span><span class=\"w\"> </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"o\">--</span>-&gt; <span class=\"nc\">wasm</span><span class=\"w\"> </span><span class=\"n\">B</span><span class=\"w\"> </span><span class=\"o\">--</span>-&gt; <span class=\"nc\">wasm</span><span class=\"w\"> </span><span class=\"n\">A</span><span class=\"w\"> </span><span class=\"o\">--</span>-&gt; <span class=\"nc\">host</span><span class=\"w\"></span>\n</code></pre></div>\n<p>so that we are exercising component-to-component trampolines and all that.</p>\n</blockquote>",
        "id": 287231323,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1656009395
    },
    {
        "content": "<p>dicej <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4307#issuecomment-1164826430\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4307\">issue #4307</a>:</p>\n<blockquote>\n<p>Thanks, for writing this up, @fitzgen.  A few of questions for you:</p>\n<ol>\n<li>Given that neither the dynamic API for interface type values nor <code>derive(InterfaceType)</code> yet exist, I assume each of those things will need to be implemented before the corresponding oracle is created.  Is that correct?</li>\n<li>Is it worthwhile to do any work on this issue before one of the above features is implemented?  I.e. is there any point in writing the test case generator without any oracles to use it?</li>\n<li>For the static API oracle, were you thinking of creating (or extending) a <a href=\"http://build.rs\">build.rs</a> that generates Rust code or writing a procedural macro?</li>\n</ol>\n</blockquote>",
        "id": 287243060,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1656015338
    },
    {
        "content": "<p>dicej edited a <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4307#issuecomment-1164826430\">comment</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4307\">issue #4307</a>:</p>\n<blockquote>\n<p>Thanks, for writing this up, @fitzgen.  A few of questions for you:</p>\n<ol>\n<li>Given that neither the dynamic API for interface type values nor <code>derive(InterfaceType)</code> yet exist, I assume each of those things will need to be implemented before the corresponding oracle is created.  Is that correct?</li>\n<li>Is it worthwhile to do any work on this issue before one of the above features is implemented?  I.e. is there any value in writing the test case generator prior to being able to write oracles that use it?</li>\n<li>For the static API oracle, were you thinking of creating (or extending) a <a href=\"http://build.rs\">build.rs</a> that generates Rust code or writing a procedural macro?</li>\n</ol>\n</blockquote>",
        "id": 287243196,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1656015403
    },
    {
        "content": "<p>fitzgen <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4307#issuecomment-1164842338\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4307\">issue #4307</a>:</p>\n<blockquote>\n<blockquote>\n<ul>\n<li>\n<p>Given that neither the dynamic API for interface type values nor <code>derive(InterfaceType)</code> yet exist, I assume each of those things will need to be implemented before the corresponding oracle is created.  Is that correct?</p>\n</li>\n<li>\n<p>Is it worthwhile to do any work on this issue before one of the above features is implemented?  I.e. is there any value in writing the test case generator prior to being able to write oracles that use it?</p>\n</li>\n</ul>\n</blockquote>\n<p>Yeah, I think it makes sense to unblock this before working on it. We could probably technically implement some (most?) of the test case generator without the oracles, but I think it would be best if they were developed in together since I think the shape of the generator may be informed by the oracles.</p>\n<blockquote>\n<p>For the static API oracle, were you thinking of creating (or extending) a <a href=\"http://build.rs\">build.rs</a> that generates Rust code or writing a procedural macro?</p>\n</blockquote>\n<p>I think a <code>build.rs</code> would be better, since it would generally just be easier to write, read, and debug.</p>\n</blockquote>",
        "id": 287244369,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1656015996
    },
    {
        "content": "<p>fitzgen edited <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4307\">issue #4307</a>:</p>\n<blockquote>\n<p>To help make the component model and interface types production ready, we want<br>\nto extensively fuzz and exercise Wasmtime's ability to pass interface values<br>\nback and forth with Wasm.</p>\n<p>This fuzz target should:</p>\n<ul>\n<li>generate an arbitrary interface type <code>T</code>,</li>\n<li>\n<p>generate a Wasm component that</p>\n<ul>\n<li>imports a host function <code>T -&gt; T</code>, and</li>\n<li>exports a function <code>T -&gt; T</code> that passes its argument to the import function<br>\n  and returns the result of the import function,</li>\n</ul>\n</li>\n<li>\n<p>generate some number of arbitrary values of type <code>T</code>,</p>\n</li>\n<li>\n<p>and for each value:</p>\n<ul>\n<li>call the Wasm's exported function,</li>\n<li>\n<p>when the host function is called, assert that the argument is equal to the<br>\n  original value,</p>\n</li>\n<li>\n<p>return the argument from the host function,</p>\n</li>\n<li>\n<p>when the Wasm function returns to the host, assert that the argument is<br>\n  equal to the original value,</p>\n</li>\n<li>\n<p>assert that the host function was actually called.</p>\n</li>\n</ul>\n</li>\n</ul>\n<p>This tests that we can round trip interface values of type <code>T</code> both as arguments<br>\nand returns to and from Wasm.</p>\n<p>Here is a diagram showing what the fuzz target should do:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"o\">+-------------------+</span><span class=\"w\">                   </span><span class=\"o\">+------------------+</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">Host</span><span class=\"w\">              </span><span class=\"o\">|</span><span class=\"w\">                   </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">Wasm</span><span class=\"w\">             </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">                   </span><span class=\"o\">|</span><span class=\"w\">   </span><span class=\"n\">argument</span><span class=\"w\">        </span><span class=\"o\">|</span><span class=\"w\">                  </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">     </span><span class=\"n\">arbitrary</span><span class=\"w\"> </span><span class=\"o\">-----------------------------</span>-&gt;            <span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">     </span><span class=\"n\">value</span><span class=\"w\">         </span><span class=\"o\">|</span><span class=\"w\">                   </span><span class=\"o\">|</span><span class=\"w\">      </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">                   </span><span class=\"o\">|</span><span class=\"w\">                   </span><span class=\"o\">|</span><span class=\"w\">      </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">                   </span><span class=\"o\">|</span><span class=\"w\">                   </span><span class=\"o\">|</span><span class=\"w\">      </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">         </span><span class=\"o\">+-----------------+</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\">      </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">         </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">host</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\">   </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\">      </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">         </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">imported</span><span class=\"w\"> </span><span class=\"n\">by</span><span class=\"w\">     </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\">      </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">         </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">Wasm</span><span class=\"w\">            </span><span class=\"o\">|</span><span class=\"w\">  </span><span class=\"n\">argument</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\">      </span><span class=\"n\">V</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">         </span><span class=\"o\">|</span><span class=\"w\">            </span><span class=\"o\">&lt;-----------------------</span><span class=\"w\">            </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">         </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\">     </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\">                  </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">         </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">assert</span><span class=\"w\">    </span><span class=\"o\">|</span><span class=\"w\">     </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\">                  </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">         </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">value</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\">  </span><span class=\"o\">|</span><span class=\"w\">     </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\">                  </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">         </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">equal</span><span class=\"w\">     </span><span class=\"n\">V</span><span class=\"w\">     </span><span class=\"o\">|</span><span class=\"w\">  </span><span class=\"k\">return</span><span class=\"w\">   </span><span class=\"o\">|</span><span class=\"w\">                  </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">         </span><span class=\"o\">|</span><span class=\"w\">            </span><span class=\"o\">----------------------</span>-&gt;            <span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">         </span><span class=\"o\">|</span><span class=\"w\">                 </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\">      </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">         </span><span class=\"o\">+-----------------+</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\">      </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">                   </span><span class=\"o\">|</span><span class=\"w\">                   </span><span class=\"o\">|</span><span class=\"w\">      </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">                   </span><span class=\"o\">|</span><span class=\"w\">          </span><span class=\"k\">return</span><span class=\"w\">   </span><span class=\"o\">|</span><span class=\"w\">      </span><span class=\"n\">V</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">   </span><span class=\"n\">assert</span><span class=\"w\">    </span><span class=\"o\">&lt;--------------------------------</span><span class=\"w\">            </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">   </span><span class=\"n\">value</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\">        </span><span class=\"o\">|</span><span class=\"w\">                   </span><span class=\"o\">|</span><span class=\"w\">                  </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">   </span><span class=\"n\">equal</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\">                   </span><span class=\"o\">|</span><span class=\"w\">                  </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">                   </span><span class=\"o\">|</span><span class=\"w\">                   </span><span class=\"o\">|</span><span class=\"w\">                  </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">+-------------------+</span><span class=\"w\">                   </span><span class=\"o\">+------------------+</span><span class=\"w\"></span>\n</code></pre></div>\n<h2>Test Case Generator</h2>\n<p>The test case generator will be responsible for generating</p>\n<ul>\n<li>the arbitrary interface type <code>T</code>,</li>\n<li>\n<p>the Wasm component that takes values of type <code>T</code>, passes them to the imported<br>\n  host function, and returns the result of the host function,</p>\n</li>\n<li>\n<p>and instances of type <code>T</code>.</p>\n</li>\n</ul>\n<h2>Oracle</h2>\n<p>There are two versions of the oracle:</p>\n<ol>\n<li>\n<p>a version that uses the dynamic interface types API to pass values to Wasm,<br>\n   and</p>\n</li>\n<li>\n<p>a version that uses the static interface types API to pass values to Wasm.</p>\n</li>\n</ol>\n<h3>Dynamic API Oracle</h3>\n<p>The dynamic API oracle will be paired with the test case generator <em>at runtime</em><br>\nand use Wasmtime's dynamic API for interface type values (doesn't exist at time<br>\nof writing; the component equivalent of <code>wasmtime::Val</code>).</p>\n<h3>Static API Oracle</h3>\n<p>The static API oracle will use the test case generator <em>at build time</em> to<br>\ngenerate, say, 1000 interface types <code>T</code> to fuzz, and then generate arbitrary<br>\ninstances of <code>T</code> at runtime. This means that if <code>T</code> is a struct, for example, we<br>\ncan define a Rust type like</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"cp\">#[derive(InterfaceType)]</span><span class=\"w\"></span>\n<span class=\"k\">struct</span> <span class=\"nc\">MyRustType</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">foo</span>: <span class=\"kt\">u32</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">bar</span>: <span class=\"nb\">String</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n</code></pre></div>\n<p>whose instances can be passed to the Wasm directly via Wasmtime's static API for<br>\ninterface types. We will generate arbitrary instance of <code>MyRustType</code> at runtime<br>\nin this scenario, but not new types <code>T</code>.</p>\n<p>(Note that <code>derive(InterfaceType)</code> does not exist at the time of writing.)<br>\n</p>\n</blockquote>",
        "id": 287244719,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1656016183
    },
    {
        "content": "<p>dicej edited a <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4307#issuecomment-1164826430\">comment</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4307\">issue #4307</a>:</p>\n<blockquote>\n<p>Thanks, for writing this up, @fitzgen.  A few questions for you:</p>\n<ol>\n<li>Given that neither the dynamic API for interface type values nor <code>derive(InterfaceType)</code> yet exist, I assume each of those things will need to be implemented before the corresponding oracle is created.  Is that correct?</li>\n<li>Is it worthwhile to do any work on this issue before one of the above features is implemented?  I.e. is there any value in writing the test case generator prior to being able to write oracles that use it?</li>\n<li>For the static API oracle, were you thinking of creating (or extending) a <a href=\"http://build.rs\">build.rs</a> that generates Rust code or writing a procedural macro?</li>\n</ol>\n</blockquote>",
        "id": 287245099,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1656016346
    },
    {
        "content": "<p>dicej <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4307#issuecomment-1164870481\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4307\">issue #4307</a>:</p>\n<blockquote>\n<p>@alexcrichton Are you planning to create an issue for <code>derive(InterfaceType</code>?  I'd be happy to create a placeholder, but I'm still fuzzy on the details, so I'll need help fleshing it out.</p>\n<p>Also, it sounds like we might also need an issue for the interface-type-equivalent of <code>wasmtime::Val</code> Nick mentioned above.  I _think_ I understand what's involved there (e.g. copying <a href=\"http://values.rs\">values.rs</a> and adapting it for interface types), but I could use guidance there, too.</p>\n</blockquote>",
        "id": 287248816,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1656018184
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4307#issuecomment-1164877807\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4307\">issue #4307</a>:</p>\n<blockquote>\n<p>I do indeed want to open an issue! Sorry I got caught up all day in a <a href=\"https://github.com/bytecodealliance/wasmtime/pull/4306#issuecomment-1164875082\">debugging adventure</a> but that's over now so I'll go make an issue next.</p>\n</blockquote>",
        "id": 287259137,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1656018748
    },
    {
        "content": "<p>alexcrichton labeled <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4307\">issue #4307</a>:</p>\n<blockquote>\n<p>To help make the component model and interface types production ready, we want<br>\nto extensively fuzz and exercise Wasmtime's ability to pass interface values<br>\nback and forth with Wasm.</p>\n<p>This fuzz target should:</p>\n<ul>\n<li>generate an arbitrary interface type <code>T</code>,</li>\n<li>\n<p>generate a Wasm component that</p>\n<ul>\n<li>imports a host function <code>T -&gt; T</code>, and</li>\n<li>exports a function <code>T -&gt; T</code> that passes its argument to the import function<br>\n  and returns the result of the import function,</li>\n</ul>\n</li>\n<li>\n<p>generate some number of arbitrary values of type <code>T</code>,</p>\n</li>\n<li>\n<p>and for each value:</p>\n<ul>\n<li>call the Wasm's exported function,</li>\n<li>\n<p>when the host function is called, assert that the argument is equal to the<br>\n  original value,</p>\n</li>\n<li>\n<p>return the argument from the host function,</p>\n</li>\n<li>\n<p>when the Wasm function returns to the host, assert that the argument is<br>\n  equal to the original value,</p>\n</li>\n<li>\n<p>assert that the host function was actually called.</p>\n</li>\n</ul>\n</li>\n</ul>\n<p>This tests that we can round trip interface values of type <code>T</code> both as arguments<br>\nand returns to and from Wasm.</p>\n<p>Here is a diagram showing what the fuzz target should do:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"o\">+-------------------+</span><span class=\"w\">                   </span><span class=\"o\">+------------------+</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">Host</span><span class=\"w\">              </span><span class=\"o\">|</span><span class=\"w\">                   </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">Wasm</span><span class=\"w\">             </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">                   </span><span class=\"o\">|</span><span class=\"w\">   </span><span class=\"n\">argument</span><span class=\"w\">        </span><span class=\"o\">|</span><span class=\"w\">                  </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">     </span><span class=\"n\">arbitrary</span><span class=\"w\"> </span><span class=\"o\">-----------------------------</span>-&gt;            <span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">     </span><span class=\"n\">value</span><span class=\"w\">         </span><span class=\"o\">|</span><span class=\"w\">                   </span><span class=\"o\">|</span><span class=\"w\">      </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">                   </span><span class=\"o\">|</span><span class=\"w\">                   </span><span class=\"o\">|</span><span class=\"w\">      </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">                   </span><span class=\"o\">|</span><span class=\"w\">                   </span><span class=\"o\">|</span><span class=\"w\">      </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">         </span><span class=\"o\">+-----------------+</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\">      </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">         </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">host</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\">   </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\">      </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">         </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">imported</span><span class=\"w\"> </span><span class=\"n\">by</span><span class=\"w\">     </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\">      </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">         </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">Wasm</span><span class=\"w\">            </span><span class=\"o\">|</span><span class=\"w\">  </span><span class=\"n\">argument</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\">      </span><span class=\"n\">V</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">         </span><span class=\"o\">|</span><span class=\"w\">            </span><span class=\"o\">&lt;-----------------------</span><span class=\"w\">            </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">         </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\">     </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\">                  </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">         </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">assert</span><span class=\"w\">    </span><span class=\"o\">|</span><span class=\"w\">     </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\">                  </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">         </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">value</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\">  </span><span class=\"o\">|</span><span class=\"w\">     </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\">                  </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">         </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">equal</span><span class=\"w\">     </span><span class=\"n\">V</span><span class=\"w\">     </span><span class=\"o\">|</span><span class=\"w\">  </span><span class=\"k\">return</span><span class=\"w\">   </span><span class=\"o\">|</span><span class=\"w\">                  </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">         </span><span class=\"o\">|</span><span class=\"w\">            </span><span class=\"o\">----------------------</span>-&gt;            <span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">         </span><span class=\"o\">|</span><span class=\"w\">                 </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\">      </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">         </span><span class=\"o\">+-----------------+</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\">      </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">                   </span><span class=\"o\">|</span><span class=\"w\">                   </span><span class=\"o\">|</span><span class=\"w\">      </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">                   </span><span class=\"o\">|</span><span class=\"w\">          </span><span class=\"k\">return</span><span class=\"w\">   </span><span class=\"o\">|</span><span class=\"w\">      </span><span class=\"n\">V</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">   </span><span class=\"n\">assert</span><span class=\"w\">    </span><span class=\"o\">&lt;--------------------------------</span><span class=\"w\">            </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">   </span><span class=\"n\">value</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\">        </span><span class=\"o\">|</span><span class=\"w\">                   </span><span class=\"o\">|</span><span class=\"w\">                  </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">   </span><span class=\"n\">equal</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\">                   </span><span class=\"o\">|</span><span class=\"w\">                  </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">                   </span><span class=\"o\">|</span><span class=\"w\">                   </span><span class=\"o\">|</span><span class=\"w\">                  </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">+-------------------+</span><span class=\"w\">                   </span><span class=\"o\">+------------------+</span><span class=\"w\"></span>\n</code></pre></div>\n<h2>Test Case Generator</h2>\n<p>The test case generator will be responsible for generating</p>\n<ul>\n<li>the arbitrary interface type <code>T</code>,</li>\n<li>\n<p>the Wasm component that takes values of type <code>T</code>, passes them to the imported<br>\n  host function, and returns the result of the host function,</p>\n</li>\n<li>\n<p>and instances of type <code>T</code>.</p>\n</li>\n</ul>\n<h2>Oracle</h2>\n<p>There are two versions of the oracle:</p>\n<ol>\n<li>\n<p>a version that uses the dynamic interface types API to pass values to Wasm,<br>\n   and</p>\n</li>\n<li>\n<p>a version that uses the static interface types API to pass values to Wasm.</p>\n</li>\n</ol>\n<h3>Dynamic API Oracle</h3>\n<p>The dynamic API oracle will be paired with the test case generator <em>at runtime</em><br>\nand use Wasmtime's dynamic API for interface type values (doesn't exist at time<br>\nof writing; the component equivalent of <code>wasmtime::Val</code>).</p>\n<h3>Static API Oracle</h3>\n<p>The static API oracle will use the test case generator <em>at build time</em> to<br>\ngenerate, say, 1000 interface types <code>T</code> to fuzz, and then generate arbitrary<br>\ninstances of <code>T</code> at runtime. This means that if <code>T</code> is a struct, for example, we<br>\ncan define a Rust type like</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"cp\">#[derive(InterfaceType)]</span><span class=\"w\"></span>\n<span class=\"k\">struct</span> <span class=\"nc\">MyRustType</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">foo</span>: <span class=\"kt\">u32</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">bar</span>: <span class=\"nb\">String</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n</code></pre></div>\n<p>whose instances can be passed to the Wasm directly via Wasmtime's static API for<br>\ninterface types. We will generate arbitrary instance of <code>MyRustType</code> at runtime<br>\nin this scenario, but not new types <code>T</code>.</p>\n<p>(Note that <code>derive(InterfaceType)</code> does not exist at the time of writing.)<br>\n</p>\n</blockquote>",
        "id": 287259180,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1656018772
    },
    {
        "content": "<p>jameysharp labeled <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4307\">issue #4307</a>:</p>\n<blockquote>\n<p>To help make the component model and interface types production ready, we want<br>\nto extensively fuzz and exercise Wasmtime's ability to pass interface values<br>\nback and forth with Wasm.</p>\n<p>This fuzz target should:</p>\n<ul>\n<li>generate an arbitrary interface type <code>T</code>,</li>\n<li>\n<p>generate a Wasm component that</p>\n<ul>\n<li>imports a host function <code>T -&gt; T</code>, and</li>\n<li>exports a function <code>T -&gt; T</code> that passes its argument to the import function<br>\n  and returns the result of the import function,</li>\n</ul>\n</li>\n<li>\n<p>generate some number of arbitrary values of type <code>T</code>,</p>\n</li>\n<li>\n<p>and for each value:</p>\n<ul>\n<li>call the Wasm's exported function,</li>\n<li>\n<p>when the host function is called, assert that the argument is equal to the<br>\n  original value,</p>\n</li>\n<li>\n<p>return the argument from the host function,</p>\n</li>\n<li>\n<p>when the Wasm function returns to the host, assert that the argument is<br>\n  equal to the original value,</p>\n</li>\n<li>\n<p>assert that the host function was actually called.</p>\n</li>\n</ul>\n</li>\n</ul>\n<p>This tests that we can round trip interface values of type <code>T</code> both as arguments<br>\nand returns to and from Wasm.</p>\n<p>Here is a diagram showing what the fuzz target should do:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"o\">+-------------------+</span><span class=\"w\">                   </span><span class=\"o\">+------------------+</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">Host</span><span class=\"w\">              </span><span class=\"o\">|</span><span class=\"w\">                   </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">Wasm</span><span class=\"w\">             </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">                   </span><span class=\"o\">|</span><span class=\"w\">   </span><span class=\"n\">argument</span><span class=\"w\">        </span><span class=\"o\">|</span><span class=\"w\">                  </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">     </span><span class=\"n\">arbitrary</span><span class=\"w\"> </span><span class=\"o\">-----------------------------</span>-&gt;            <span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">     </span><span class=\"n\">value</span><span class=\"w\">         </span><span class=\"o\">|</span><span class=\"w\">                   </span><span class=\"o\">|</span><span class=\"w\">      </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">                   </span><span class=\"o\">|</span><span class=\"w\">                   </span><span class=\"o\">|</span><span class=\"w\">      </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">                   </span><span class=\"o\">|</span><span class=\"w\">                   </span><span class=\"o\">|</span><span class=\"w\">      </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">         </span><span class=\"o\">+-----------------+</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\">      </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">         </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">host</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\">   </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\">      </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">         </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">imported</span><span class=\"w\"> </span><span class=\"n\">by</span><span class=\"w\">     </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\">      </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">         </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">Wasm</span><span class=\"w\">            </span><span class=\"o\">|</span><span class=\"w\">  </span><span class=\"n\">argument</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\">      </span><span class=\"n\">V</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">         </span><span class=\"o\">|</span><span class=\"w\">            </span><span class=\"o\">&lt;-----------------------</span><span class=\"w\">            </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">         </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\">     </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\">                  </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">         </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">assert</span><span class=\"w\">    </span><span class=\"o\">|</span><span class=\"w\">     </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\">                  </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">         </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">value</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\">  </span><span class=\"o\">|</span><span class=\"w\">     </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\">                  </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">         </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">equal</span><span class=\"w\">     </span><span class=\"n\">V</span><span class=\"w\">     </span><span class=\"o\">|</span><span class=\"w\">  </span><span class=\"k\">return</span><span class=\"w\">   </span><span class=\"o\">|</span><span class=\"w\">                  </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">         </span><span class=\"o\">|</span><span class=\"w\">            </span><span class=\"o\">----------------------</span>-&gt;            <span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">         </span><span class=\"o\">|</span><span class=\"w\">                 </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\">      </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">         </span><span class=\"o\">+-----------------+</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\">      </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">                   </span><span class=\"o\">|</span><span class=\"w\">                   </span><span class=\"o\">|</span><span class=\"w\">      </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">                   </span><span class=\"o\">|</span><span class=\"w\">          </span><span class=\"k\">return</span><span class=\"w\">   </span><span class=\"o\">|</span><span class=\"w\">      </span><span class=\"n\">V</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">   </span><span class=\"n\">assert</span><span class=\"w\">    </span><span class=\"o\">&lt;--------------------------------</span><span class=\"w\">            </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">   </span><span class=\"n\">value</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\">        </span><span class=\"o\">|</span><span class=\"w\">                   </span><span class=\"o\">|</span><span class=\"w\">                  </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">   </span><span class=\"n\">equal</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\">                   </span><span class=\"o\">|</span><span class=\"w\">                  </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">                   </span><span class=\"o\">|</span><span class=\"w\">                   </span><span class=\"o\">|</span><span class=\"w\">                  </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">+-------------------+</span><span class=\"w\">                   </span><span class=\"o\">+------------------+</span><span class=\"w\"></span>\n</code></pre></div>\n<h2>Test Case Generator</h2>\n<p>The test case generator will be responsible for generating</p>\n<ul>\n<li>the arbitrary interface type <code>T</code>,</li>\n<li>\n<p>the Wasm component that takes values of type <code>T</code>, passes them to the imported<br>\n  host function, and returns the result of the host function,</p>\n</li>\n<li>\n<p>and instances of type <code>T</code>.</p>\n</li>\n</ul>\n<h2>Oracle</h2>\n<p>There are two versions of the oracle:</p>\n<ol>\n<li>\n<p>a version that uses the dynamic interface types API to pass values to Wasm,<br>\n   and</p>\n</li>\n<li>\n<p>a version that uses the static interface types API to pass values to Wasm.</p>\n</li>\n</ol>\n<h3>Dynamic API Oracle</h3>\n<p>The dynamic API oracle will be paired with the test case generator <em>at runtime</em><br>\nand use Wasmtime's dynamic API for interface type values (doesn't exist at time<br>\nof writing; the component equivalent of <code>wasmtime::Val</code>).</p>\n<h3>Static API Oracle</h3>\n<p>The static API oracle will use the test case generator <em>at build time</em> to<br>\ngenerate, say, 1000 interface types <code>T</code> to fuzz, and then generate arbitrary<br>\ninstances of <code>T</code> at runtime. This means that if <code>T</code> is a struct, for example, we<br>\ncan define a Rust type like</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"cp\">#[derive(InterfaceType)]</span><span class=\"w\"></span>\n<span class=\"k\">struct</span> <span class=\"nc\">MyRustType</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">foo</span>: <span class=\"kt\">u32</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">bar</span>: <span class=\"nb\">String</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n</code></pre></div>\n<p>whose instances can be passed to the Wasm directly via Wasmtime's static API for<br>\ninterface types. We will generate arbitrary instance of <code>MyRustType</code> at runtime<br>\nin this scenario, but not new types <code>T</code>.</p>\n<p>(Note that <code>derive(InterfaceType)</code> does not exist at the time of writing.)<br>\n</p>\n</blockquote>",
        "id": 288832290,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1657212055
    },
    {
        "content": "<p>dicej <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4307#issuecomment-1183749659\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4307\">issue #4307</a>:</p>\n<blockquote>\n<p>FYI, I'm planning to start working on this tomorrow, assuming no significant additional work is needed on #4442.</p>\n</blockquote>",
        "id": 289529970,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1657751793
    },
    {
        "content": "<p>dicej <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4307#issuecomment-1184605845\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4307\">issue #4307</a>:</p>\n<blockquote>\n<p>Looks like #4442 needs more work, so I won't be able to tackle this one quite yet.</p>\n</blockquote>",
        "id": 289609964,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1657813733
    },
    {
        "content": "<p>dicej <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4307#issuecomment-1185770089\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4307\">issue #4307</a>:</p>\n<blockquote>\n<p>Quick question: Should the test case generator deliberately generate instances and components which do _not_ match the generated type?</p>\n<p>For example, if the generated type is a record with three fields, should the instance generator (sometimes) generate values with too many, not enough, or mis-typed field values (or values which are instances of an entirely different sort of type), and should the component generator (sometimes) generate a component which expects a different record type (or a different sort of type)?</p>\n</blockquote>",
        "id": 289760710,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1657907584
    },
    {
        "content": "<p>fitzgen <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4307#issuecomment-1185776968\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4307\">issue #4307</a>:</p>\n<blockquote>\n<p>You could do that with very low probability (something like <code>u.ratio(1, 1_000)</code>) if you want, but I don't think it is super critical. Wouldn't work on this kind of thing ahead of working on the main bits.</p>\n</blockquote>",
        "id": 289762042,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1657908167
    },
    {
        "content": "<p>dicej <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4307#issuecomment-1185869270\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4307\">issue #4307</a>:</p>\n<blockquote>\n<p>Regarding the static API oracle: neither <code>libFuzzer</code> nor <code>cargo-fuzz</code> will be involved, correct?  I'm envisioning adding code to the <a href=\"http://build.rs\">build.rs</a> at the root of the repo which generates a .rs file under the tests directory containing a single test that exercises 1000 random test cases, each of which has been generated in <a href=\"http://build.rs\">build.rs</a> using the test case generator with an <code>arbitrary::Unstructured</code> initialized with a random byte slice.  Does that sound right?</p>\n</blockquote>",
        "id": 289776643,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1657915414
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4307#issuecomment-1187429770\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4307\">issue #4307</a>:</p>\n<blockquote>\n<p>Yeah that sounds right to me. We'll want the seed of the byte slice to be deterministic somewhat in the sense that if something hits a bug on oss-fuzz we want to be able to reproduce it locally by overriding the seed. For now I think having an optional env var to specify the seed would be fine, we can always fiddle with it later too.</p>\n</blockquote>",
        "id": 289964947,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1658150898
    },
    {
        "content": "<p>dicej <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4307#issuecomment-1189252406\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4307\">issue #4307</a>:</p>\n<blockquote>\n<p>I'm making good progress on this, but getting hung up on the asymmetry between the <code>ComponentType</code> impls for <code>str</code> and <code>WasmStr</code>.  The former only implements <code>Lower</code>, and the latter only implements <code>Lift</code>, so there's currently no available string type that implements both AFAICT.  This would be an issue any time someone wanted to derive both <code>Lift</code> and <code>Lower</code> for a type containing a string, and it's especially annoying when generating a fuzz test like this one.</p>\n<p>My first thought was to create my own type wrapper (e.g. <code>struct MyString(Box&lt;str&gt;)</code>) and then manually implement both <code>Lift</code> and <code>Lower</code> for it, but that's getting ugly fast, and I don't think we should expect <code>wasmtime</code> embedders to do that anyway.  Another option is to have the test case generator generate two versions of each type: one for lifting and one for lowering -- just in case the type has a string somewhere in the hierarchy.  I'd also need to generate a <code>PartialEq</code> impl for each such pair of types, which would be extremely tedious.</p>\n<p>@alexcrichton I think life would be a lot easier if <code>String</code> (and <code>Box&lt;str&gt;</code>, etc.) implemented <code>Lift</code>, raising an error if the bytes aren't valid UTF-8.  What do you think?</p>\n</blockquote>",
        "id": 290121799,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1658246717
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4307#issuecomment-1189342042\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4307\">issue #4307</a>:</p>\n<blockquote>\n<p>That actually seems quite reasonable to me, the <code>WasmStr</code> type needed to exist as a base-level of support, but building <code>String</code> on top of <code>Lower for str</code> and <code>Lift for WasmStr</code> I think would work great!</p>\n</blockquote>",
        "id": 290130906,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1658250392
    },
    {
        "content": "<p>dicej <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4307#issuecomment-1190832164\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4307\">issue #4307</a>:</p>\n<blockquote>\n<blockquote>\n<p>That actually seems quite reasonable to me, the <code>WasmStr</code> type needed to exist as a base-level of support, but building <code>String</code> on top of <code>Lower for str</code> and <code>Lift for WasmStr</code> I think would work great!</p>\n</blockquote>\n<p>I tried to do this, but given that <code>Lift::load</code> only receives a <code>Memory</code> and a <code>&amp;[u8]</code> (and no store), there doesn't seem to be a way to access the memory of the string body, so there's no way to construct an actual non-empty <code>String</code>.  Am I missing something?</p>\n</blockquote>",
        "id": 290308602,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1658356469
    },
    {
        "content": "<p>dicej <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4307#issuecomment-1190837445\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4307\">issue #4307</a>:</p>\n<blockquote>\n<p>Regarding the above, would it be reasonable to add a <code>&amp;StoreOpaque</code> parameter to <code>Lift::load</code>?</p>\n</blockquote>",
        "id": 290309011,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1658356695
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4307#issuecomment-1191566344\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4307\">issue #4307</a>:</p>\n<blockquote>\n<p>I think <a href=\"https://github.com/bytecodealliance/wasmtime/blob/4ce329d1ebdd5a8556f58535b4cbeb698b5c03c4/crates/wasmtime/src/component/func/options.rs#L226-L228\"><code>Memory::as_slice</code></a> can be used to get the view into the entire linear memory for indirect pointers?</p>\n</blockquote>",
        "id": 290383864,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1658414266
    },
    {
        "content": "<p>dicej <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4307#issuecomment-1191578388\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4307\">issue #4307</a>:</p>\n<blockquote>\n<blockquote>\n<p>I think <a href=\"https://github.com/bytecodealliance/wasmtime/blob/4ce329d1ebdd5a8556f58535b4cbeb698b5c03c4/crates/wasmtime/src/component/func/options.rs#L226-L228\"><code>Memory::as_slice</code></a> can be used to get the view into the entire linear memory for indirect pointers?</p>\n</blockquote>\n<p>Oh, good call.  I missed that <code>Memory</code> had a <code>StoreOpaque</code> field.  Thanks!</p>\n</blockquote>",
        "id": 290385318,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1658414875
    },
    {
        "content": "<p>dicej <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4307#issuecomment-1199615965\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4307\">issue #4307</a>:</p>\n<blockquote>\n<p>@alexcrichton Things are coming together nicely.  The fuzz tests have found a few bugs, which I've been debugging and fixing.  I could use your help with dependency management, though.</p>\n<p>The publish CI job isn't happy with the \"component-test-util/component-model\" line I added to Cargo.toml, and my cargo skills aren't sharp enough to know how to address it.  In this case <code>component-test-util</code> is a dev depencency, but it's only used when the <code>component-model</code> feature is enabled.  However, apparently dev dependencies can't be <code>optional</code>, so I'm not sure what to do.  Any ideas?</p>\n</blockquote>",
        "id": 291345054,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1659110452
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4307#issuecomment-1199624852\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4307\">issue #4307</a>:</p>\n<blockquote>\n<p>Nice! I'm also happy to help out with debugging if you'd like as well.</p>\n<p>Otherwise though I think the best fix is to just unconditionally enable the <code>component-model</code> feature when testing. We already do this for other optional features like <code>async</code> and it'll avoid us having to deal with features-in-tests. In short there's no other easy answer for having an optional dev-dependency.</p>\n<p>I'll try to work on a PR to unconditionally enable the <code>component-model</code> when testing.</p>\n</blockquote>",
        "id": 291345653,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1659110686
    },
    {
        "content": "<p>dicej <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4307#issuecomment-1199657161\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4307\">issue #4307</a>:</p>\n<blockquote>\n<p>Here's a fun one:</p>\n<p><div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">thread</span><span class=\"w\"> </span><span class=\"o\">'&lt;</span><span class=\"n\">unnamed</span><span class=\"o\">&gt;'</span><span class=\"w\"> </span><span class=\"n\">panicked</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"na\">called</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"nb\">Result</span>::<span class=\"n\">unwrap</span><span class=\"p\">()</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">on</span><span class=\"w\"> </span><span class=\"n\">an</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"nb\">Err</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">value</span>: <span class=\"nc\">item</span><span class=\"w\"> </span><span class=\"n\">nesting</span><span class=\"w\"> </span><span class=\"n\">too</span><span class=\"w\"> </span><span class=\"n\">deep</span><span class=\"w\"></span>\n<span class=\"w\">     </span><span class=\"o\">-</span>-&gt; <span class=\"o\">&lt;</span><span class=\"n\">anon</span><span class=\"o\">&gt;</span>:<span class=\"mi\">66</span>:<span class=\"mi\">1005</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"w\">   </span><span class=\"mi\">66</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\">             </span><span class=\"p\">(</span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"s\">\"echo\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">func</span><span class=\"w\"> </span><span class=\"cp\">$f</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">param</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">variant</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"s\">\"C0\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">variant</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"s\">\"C0\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">variant</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"s\">\"C0\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">record</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">field</span><span class=\"w\"> </span><span class=\"s\">\"f0\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">record</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">field</span><span class=\"w\"> </span><span class=\"s\">\"f0\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">record</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">field</span><span class=\"w\"> </span><span class=\"s\">\"f0\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">record</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">field</span><span class=\"w\"> </span><span class=\"s\">\"f0\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">record</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">field</span><span class=\"w\"> </span><span class=\"s\">\"f0\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">record</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">field</span><span class=\"w\"> </span><span class=\"s\">\"f0\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">record</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">field</span><span class=\"w\"> </span><span class=\"s\">\"f0\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">record</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">field</span><span class=\"w\"> </span><span class=\"s\">\"f0\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">record</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">field</span><span class=\"w\"> </span><span class=\"s\">\"f0\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">record</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">field</span><span class=\"w\"> </span><span class=\"s\">\"f0\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">record</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">field</span><span class=\"w\"> </span><span class=\"s\">\"f0\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">record</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">field</span><span class=\"w\"> </span><span class=\"s\">\"f0\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">record</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">field</span><span class=\"w\"> </span><span class=\"s\">\"f0\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">record</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">field</span><span class=\"w\"> </span><span class=\"s\">\"f0\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">record</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">field</span><span class=\"w\"> </span><span class=\"s\">\"f0\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">record</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">field</span><span class=\"w\"> </span><span class=\"s\">\"f0\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">variant</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"s\">\"C0\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">variant</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"s\">\"C0\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">variant</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"s\">\"C0\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">variant</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"s\">\"C0\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">variant</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"s\">\"C0\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">variant</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"s\">\"C0\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">variant</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"s\">\"C0\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">variant</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"s\">\"C0\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">variant</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"s\">\"C0\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">variant</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"s\">\"C0\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">variant</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"s\">\"C0\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">variant</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"s\">\"C0\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">variant</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"s\">\"C0\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">variant</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"s\">\"C0\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">variant</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"s\">\"C0\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">variant</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"s\">\"C0\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">variant</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"s\">\"C0\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">variant</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"s\">\"C0\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">variant</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"s\">\"C0\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">variant</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"s\">\"C0\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">variant</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"s\">\"C0\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">variant</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"s\">\"C0\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">variant</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"s\">\"C0\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">variant</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"s\">\"C0\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">variant</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"s\">\"C0\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">variant</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"s\">\"C0\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">variant</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"s\">\"C0\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">variant</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"s\">\"C0\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">variant</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"s\">\"C0\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">variant</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"s\">\"C0\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">variant</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"s\">\"C0\"</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">variant</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"s\">\"C0\"</span><span class=\"w\"> </span><span class=\"n\">string</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">case</span><span class=\"w\"> </span><span class=\"s\">\"C1\"</span><span class=\"w\"> </span><span class=\"n\">unit</span><span class=\"p\">)))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">result</span><span class=\"w\"> </span><span class=\"n\">unit</span><span class=\"p\">)))</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"o\">|</span><span class=\"w\">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             </span><span class=\"o\">^'</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">crates</span><span class=\"o\">/</span><span class=\"n\">fuzzing</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">oracles</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">1088</span>:<span class=\"mi\">6</span><span class=\"w\"></span>\n</code></pre></div><br>\n</p>\n</blockquote>",
        "id": 291347416,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1659111511
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4307#issuecomment-1199717875\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4307\">issue #4307</a>:</p>\n<blockquote>\n<p>Ah yeah for that we'll want to constrain the <code>Arbitrary</code> for the type hierarchy to have some maximum depth. For that we'll either need to throw out test cases earlier or otherwise change the <code>Arbitrary</code> impl to constrain how deep types can be.</p>\n<p>I suppose another idea is to use the binary encoding instead of the text encoding of components since that specific error is coming from the <code>wast</code> parser. </p>\n<p>... This makes me think that we may stack overflow with super deep type hierarchies now...</p>\n</blockquote>",
        "id": 291350405,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1659113054
    },
    {
        "content": "<p>dicej <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4307#issuecomment-1205648302\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4307\">issue #4307</a>:</p>\n<blockquote>\n<p>This is done as of #4537, I believe.</p>\n</blockquote>",
        "id": 292053215,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1659638986
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4307#issuecomment-1205668162\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4307\">issue #4307</a>:</p>\n<blockquote>\n<p>Indeed, and thanks again @dicej!</p>\n</blockquote>",
        "id": 292055852,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1659640255
    },
    {
        "content": "<p>alexcrichton closed <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4307\">issue #4307</a>:</p>\n<blockquote>\n<p>To help make the component model and interface types production ready, we want<br>\nto extensively fuzz and exercise Wasmtime's ability to pass interface values<br>\nback and forth with Wasm.</p>\n<p>This fuzz target should:</p>\n<ul>\n<li>generate an arbitrary interface type <code>T</code>,</li>\n<li>\n<p>generate a Wasm component that</p>\n<ul>\n<li>imports a host function <code>T -&gt; T</code>, and</li>\n<li>exports a function <code>T -&gt; T</code> that passes its argument to the import function<br>\n  and returns the result of the import function,</li>\n</ul>\n</li>\n<li>\n<p>generate some number of arbitrary values of type <code>T</code>,</p>\n</li>\n<li>\n<p>and for each value:</p>\n<ul>\n<li>call the Wasm's exported function,</li>\n<li>\n<p>when the host function is called, assert that the argument is equal to the<br>\n  original value,</p>\n</li>\n<li>\n<p>return the argument from the host function,</p>\n</li>\n<li>\n<p>when the Wasm function returns to the host, assert that the argument is<br>\n  equal to the original value,</p>\n</li>\n<li>\n<p>assert that the host function was actually called.</p>\n</li>\n</ul>\n</li>\n</ul>\n<p>This tests that we can round trip interface values of type <code>T</code> both as arguments<br>\nand returns to and from Wasm.</p>\n<p>Here is a diagram showing what the fuzz target should do:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"o\">+-------------------+</span><span class=\"w\">                   </span><span class=\"o\">+------------------+</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">Host</span><span class=\"w\">              </span><span class=\"o\">|</span><span class=\"w\">                   </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">Wasm</span><span class=\"w\">             </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">                   </span><span class=\"o\">|</span><span class=\"w\">   </span><span class=\"n\">argument</span><span class=\"w\">        </span><span class=\"o\">|</span><span class=\"w\">                  </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">     </span><span class=\"n\">arbitrary</span><span class=\"w\"> </span><span class=\"o\">-----------------------------</span>-&gt;            <span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">     </span><span class=\"n\">value</span><span class=\"w\">         </span><span class=\"o\">|</span><span class=\"w\">                   </span><span class=\"o\">|</span><span class=\"w\">      </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">                   </span><span class=\"o\">|</span><span class=\"w\">                   </span><span class=\"o\">|</span><span class=\"w\">      </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">                   </span><span class=\"o\">|</span><span class=\"w\">                   </span><span class=\"o\">|</span><span class=\"w\">      </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">         </span><span class=\"o\">+-----------------+</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\">      </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">         </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">host</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\">   </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\">      </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">         </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">imported</span><span class=\"w\"> </span><span class=\"n\">by</span><span class=\"w\">     </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\">      </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">         </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">Wasm</span><span class=\"w\">            </span><span class=\"o\">|</span><span class=\"w\">  </span><span class=\"n\">argument</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\">      </span><span class=\"n\">V</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">         </span><span class=\"o\">|</span><span class=\"w\">            </span><span class=\"o\">&lt;-----------------------</span><span class=\"w\">            </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">         </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\">     </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\">                  </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">         </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">assert</span><span class=\"w\">    </span><span class=\"o\">|</span><span class=\"w\">     </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\">                  </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">         </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">value</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\">  </span><span class=\"o\">|</span><span class=\"w\">     </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\">                  </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">         </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">equal</span><span class=\"w\">     </span><span class=\"n\">V</span><span class=\"w\">     </span><span class=\"o\">|</span><span class=\"w\">  </span><span class=\"k\">return</span><span class=\"w\">   </span><span class=\"o\">|</span><span class=\"w\">                  </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">         </span><span class=\"o\">|</span><span class=\"w\">            </span><span class=\"o\">----------------------</span>-&gt;            <span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">         </span><span class=\"o\">|</span><span class=\"w\">                 </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\">      </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">         </span><span class=\"o\">+-----------------+</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\">      </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">                   </span><span class=\"o\">|</span><span class=\"w\">                   </span><span class=\"o\">|</span><span class=\"w\">      </span><span class=\"o\">|</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">                   </span><span class=\"o\">|</span><span class=\"w\">          </span><span class=\"k\">return</span><span class=\"w\">   </span><span class=\"o\">|</span><span class=\"w\">      </span><span class=\"n\">V</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">   </span><span class=\"n\">assert</span><span class=\"w\">    </span><span class=\"o\">&lt;--------------------------------</span><span class=\"w\">            </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">   </span><span class=\"n\">value</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\">        </span><span class=\"o\">|</span><span class=\"w\">                   </span><span class=\"o\">|</span><span class=\"w\">                  </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">   </span><span class=\"n\">equal</span><span class=\"w\">           </span><span class=\"o\">|</span><span class=\"w\">                   </span><span class=\"o\">|</span><span class=\"w\">                  </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">|</span><span class=\"w\">                   </span><span class=\"o\">|</span><span class=\"w\">                   </span><span class=\"o\">|</span><span class=\"w\">                  </span><span class=\"o\">|</span><span class=\"w\"></span>\n<span class=\"o\">+-------------------+</span><span class=\"w\">                   </span><span class=\"o\">+------------------+</span><span class=\"w\"></span>\n</code></pre></div>\n<h2>Test Case Generator</h2>\n<p>The test case generator will be responsible for generating</p>\n<ul>\n<li>the arbitrary interface type <code>T</code>,</li>\n<li>\n<p>the Wasm component that takes values of type <code>T</code>, passes them to the imported<br>\n  host function, and returns the result of the host function,</p>\n</li>\n<li>\n<p>and instances of type <code>T</code>.</p>\n</li>\n</ul>\n<h2>Oracle</h2>\n<p>There are two versions of the oracle:</p>\n<ol>\n<li>\n<p>a version that uses the dynamic interface types API to pass values to Wasm,<br>\n   and</p>\n</li>\n<li>\n<p>a version that uses the static interface types API to pass values to Wasm.</p>\n</li>\n</ol>\n<h3>Dynamic API Oracle</h3>\n<p>The dynamic API oracle will be paired with the test case generator <em>at runtime</em><br>\nand use Wasmtime's dynamic API for interface type values (doesn't exist at time<br>\nof writing; the component equivalent of <code>wasmtime::Val</code>).</p>\n<h3>Static API Oracle</h3>\n<p>The static API oracle will use the test case generator <em>at build time</em> to<br>\ngenerate, say, 1000 interface types <code>T</code> to fuzz, and then generate arbitrary<br>\ninstances of <code>T</code> at runtime. This means that if <code>T</code> is a struct, for example, we<br>\ncan define a Rust type like</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"cp\">#[derive(InterfaceType)]</span><span class=\"w\"></span>\n<span class=\"k\">struct</span> <span class=\"nc\">MyRustType</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">foo</span>: <span class=\"kt\">u32</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">bar</span>: <span class=\"nb\">String</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n</code></pre></div>\n<p>whose instances can be passed to the Wasm directly via Wasmtime's static API for<br>\ninterface types. We will generate arbitrary instance of <code>MyRustType</code> at runtime<br>\nin this scenario, but not new types <code>T</code>.</p>\n<p>(Note that <code>derive(InterfaceType)</code> does not exist at the time of writing.)<br>\n</p>\n</blockquote>",
        "id": 292055853,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1659640255
    }
]