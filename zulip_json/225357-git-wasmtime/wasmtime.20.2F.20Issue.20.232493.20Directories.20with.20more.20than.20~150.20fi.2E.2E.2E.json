[
    {
        "content": "<p>abbec opened <a href=\"https://github.com/bytecodealliance/wasmtime/issues/2493\">Issue #2493</a>:</p>\n<blockquote>\n<p>I am using this simple C program to test:</p>\n<div class=\"codehilite\" data-code-language=\"C\"><pre><span></span><code><span class=\"cp\">#include</span> <span class=\"cpf\">&lt;dirent.h&gt;</span><span class=\"cp\"></span>\n<span class=\"cp\">#include</span> <span class=\"cpf\">&lt;stdio.h&gt;</span><span class=\"cp\"></span>\n<span class=\"cp\">#include</span> <span class=\"cpf\">&lt;errno.h&gt;</span><span class=\"cp\"></span>\n\n<span class=\"kt\">int</span> <span class=\"nf\">main</span><span class=\"p\">(</span><span class=\"kt\">int</span> <span class=\"n\">argc</span><span class=\"p\">,</span> <span class=\"kt\">char</span> <span class=\"o\">**</span><span class=\"n\">argv</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n  <span class=\"kt\">DIR</span> <span class=\"o\">*</span><span class=\"n\">d</span><span class=\"p\">;</span>\n\n  <span class=\"kt\">char</span> <span class=\"o\">*</span> <span class=\"n\">target</span> <span class=\"o\">=</span> <span class=\"s\">\".\"</span><span class=\"p\">;</span>\n  <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"n\">argc</span> <span class=\"o\">==</span> <span class=\"mi\">2</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n      <span class=\"n\">target</span> <span class=\"o\">=</span> <span class=\"n\">argv</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">];</span>\n  <span class=\"p\">}</span>\n  <span class=\"k\">struct</span> <span class=\"nc\">dirent</span> <span class=\"o\">*</span><span class=\"n\">dir</span><span class=\"p\">;</span>\n  <span class=\"n\">d</span> <span class=\"o\">=</span> <span class=\"n\">opendir</span><span class=\"p\">(</span><span class=\"n\">target</span><span class=\"p\">);</span>\n  <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"n\">d</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"k\">while</span> <span class=\"p\">((</span><span class=\"n\">dir</span> <span class=\"o\">=</span> <span class=\"n\">readdir</span><span class=\"p\">(</span><span class=\"n\">d</span><span class=\"p\">))</span> <span class=\"o\">!=</span> <span class=\"nb\">NULL</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n      <span class=\"n\">printf</span><span class=\"p\">(</span><span class=\"s\">\"%s</span><span class=\"se\">\\n</span><span class=\"s\">\"</span><span class=\"p\">,</span> <span class=\"n\">dir</span><span class=\"o\">-&gt;</span><span class=\"n\">d_name</span><span class=\"p\">);</span>\n    <span class=\"p\">}</span>\n\n    <span class=\"n\">printf</span><span class=\"p\">(</span><span class=\"s\">\"errno: %d</span><span class=\"se\">\\n</span><span class=\"s\">\"</span><span class=\"p\">,</span> <span class=\"n\">errno</span><span class=\"p\">);</span>\n    <span class=\"n\">closedir</span><span class=\"p\">(</span><span class=\"n\">d</span><span class=\"p\">);</span>\n  <span class=\"p\">}</span>\n\n  <span class=\"k\">return</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">);</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p>I then use this bash script to generate a directory with <code>N</code> files in</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>rm -rf testfolder\nmkdir -p testfolder\n<span class=\"k\">for</span> n in <span class=\"k\">$(</span>seq <span class=\"m\">1</span> <span class=\"si\">${</span><span class=\"nv\">1</span><span class=\"k\">:-</span><span class=\"nv\">100</span><span class=\"si\">}</span><span class=\"k\">)</span><span class=\"p\">;</span> <span class=\"k\">do</span>\n        touch testfolder/<span class=\"k\">$(</span><span class=\"nb\">printf</span> %04d <span class=\"s2\">\"</span><span class=\"nv\">$n</span><span class=\"s2\">\"</span><span class=\"k\">)</span>\n<span class=\"k\">done</span>\n</code></pre></div>\n<p>This is what happens when I run it</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>$ bash generate-files.sh <span class=\"m\">100</span>\n\n$ ls testfolder/\n<span class=\"m\">0001</span>  <span class=\"m\">0005</span>  <span class=\"m\">0009</span>  <span class=\"m\">0013</span>  <span class=\"m\">0017</span>  <span class=\"m\">0021</span>  <span class=\"m\">0025</span>  <span class=\"m\">0029</span>  <span class=\"m\">0033</span>  <span class=\"m\">0037</span>  <span class=\"m\">0041</span>  <span class=\"m\">0045</span>  <span class=\"m\">0049</span>  <span class=\"m\">0053</span>  <span class=\"m\">0057</span>  <span class=\"m\">0061</span>  <span class=\"m\">0065</span>  <span class=\"m\">0069</span>  <span class=\"m\">0073</span>  <span class=\"m\">0077</span>  <span class=\"m\">0081</span>  <span class=\"m\">0085</span>  <span class=\"m\">0089</span>  <span class=\"m\">0093</span>  <span class=\"m\">0097</span>\n<span class=\"m\">0002</span>  <span class=\"m\">0006</span>  <span class=\"m\">0010</span>  <span class=\"m\">0014</span>  <span class=\"m\">0018</span>  <span class=\"m\">0022</span>  <span class=\"m\">0026</span>  <span class=\"m\">0030</span>  <span class=\"m\">0034</span>  <span class=\"m\">0038</span>  <span class=\"m\">0042</span>  <span class=\"m\">0046</span>  <span class=\"m\">0050</span>  <span class=\"m\">0054</span>  <span class=\"m\">0058</span>  <span class=\"m\">0062</span>  <span class=\"m\">0066</span>  <span class=\"m\">0070</span>  <span class=\"m\">0074</span>  <span class=\"m\">0078</span>  <span class=\"m\">0082</span>  <span class=\"m\">0086</span>  <span class=\"m\">0090</span>  <span class=\"m\">0094</span>  <span class=\"m\">0098</span>\n<span class=\"m\">0003</span>  <span class=\"m\">0007</span>  <span class=\"m\">0011</span>  <span class=\"m\">0015</span>  <span class=\"m\">0019</span>  <span class=\"m\">0023</span>  <span class=\"m\">0027</span>  <span class=\"m\">0031</span>  <span class=\"m\">0035</span>  <span class=\"m\">0039</span>  <span class=\"m\">0043</span>  <span class=\"m\">0047</span>  <span class=\"m\">0051</span>  <span class=\"m\">0055</span>  <span class=\"m\">0059</span>  <span class=\"m\">0063</span>  <span class=\"m\">0067</span>  <span class=\"m\">0071</span>  <span class=\"m\">0075</span>  <span class=\"m\">0079</span>  <span class=\"m\">0083</span>  <span class=\"m\">0087</span>  <span class=\"m\">0091</span>  <span class=\"m\">0095</span>  <span class=\"m\">0099</span>\n<span class=\"m\">0004</span>  <span class=\"m\">0008</span>  <span class=\"m\">0012</span>  <span class=\"m\">0016</span>  <span class=\"m\">0020</span>  <span class=\"m\">0024</span>  <span class=\"m\">0028</span>  <span class=\"m\">0032</span>  <span class=\"m\">0036</span>  <span class=\"m\">0040</span>  <span class=\"m\">0044</span>  <span class=\"m\">0048</span>  <span class=\"m\">0052</span>  <span class=\"m\">0056</span>  <span class=\"m\">0060</span>  <span class=\"m\">0064</span>  <span class=\"m\">0068</span>  <span class=\"m\">0072</span>  <span class=\"m\">0076</span>  <span class=\"m\">0080</span>  <span class=\"m\">0084</span>  <span class=\"m\">0088</span>  <span class=\"m\">0092</span>  <span class=\"m\">0096</span>  <span class=\"m\">0100</span>\n\n$ wasmtime run ls.wasm --dir<span class=\"o\">=</span>./testfolder -- testfolder <span class=\"p\">|</span> wc -l\n<span class=\"m\">103</span> <span class=\"c1\"># 100 files + \".\" \"..\" and the \"errno\" print</span>\n\n$ bash generate-files.sh <span class=\"m\">200</span>\n\n$ wasmtime run ls.wasm --dir<span class=\"o\">=</span>./testfolder -- testfolder <span class=\"p\">|</span> wc -l\n<span class=\"m\">147</span> <span class=\"c1\"># lots of files missing</span>\n\n<span class=\"c1\"># for example 0012</span>\n$ wasmtime run ls.wasm --dir<span class=\"o\">=</span>./testfolder -- testfolder <span class=\"p\">|</span> grep <span class=\"m\">0012</span>\n\n$ wasmtime run ls.wasm --dir<span class=\"o\">=</span>./testfolder -- testfolder <span class=\"p\">|</span> grep <span class=\"m\">0011</span>\n<span class=\"m\">0011</span>\n</code></pre></div>\n<p>Running wasmer on the same input works as expected:</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>$ ~/.wasmer/bin/wasmer run ls.wasm --dir<span class=\"o\">=</span>./testfolder -- testfolder <span class=\"p\">|</span> wc -l\n<span class=\"m\">201</span> <span class=\"c1\"># wasmer does not return \".\" and \"..\"</span>\n\n$ ~/.wasmer/bin/wasmer run ls.wasm --dir<span class=\"o\">=</span>./testfolder -- testfolder <span class=\"p\">|</span> grep <span class=\"m\">0012</span>\n<span class=\"m\">0012</span>\n</code></pre></div>\n<h1>Expected Behavior</h1>\n<p>Calls to <code>readdir</code> returns all directory entries, even for folders with more than 150 files.<br>\n</p>\n</blockquote>",
        "id": 219361552,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1607531561
    },
    {
        "content": "<p>abbec labeled <a href=\"https://github.com/bytecodealliance/wasmtime/issues/2493\">Issue #2493</a>:</p>\n<blockquote>\n<p>I am using this simple C program to test:</p>\n<div class=\"codehilite\" data-code-language=\"C\"><pre><span></span><code><span class=\"cp\">#include</span> <span class=\"cpf\">&lt;dirent.h&gt;</span><span class=\"cp\"></span>\n<span class=\"cp\">#include</span> <span class=\"cpf\">&lt;stdio.h&gt;</span><span class=\"cp\"></span>\n<span class=\"cp\">#include</span> <span class=\"cpf\">&lt;errno.h&gt;</span><span class=\"cp\"></span>\n\n<span class=\"kt\">int</span> <span class=\"nf\">main</span><span class=\"p\">(</span><span class=\"kt\">int</span> <span class=\"n\">argc</span><span class=\"p\">,</span> <span class=\"kt\">char</span> <span class=\"o\">**</span><span class=\"n\">argv</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n  <span class=\"kt\">DIR</span> <span class=\"o\">*</span><span class=\"n\">d</span><span class=\"p\">;</span>\n\n  <span class=\"kt\">char</span> <span class=\"o\">*</span> <span class=\"n\">target</span> <span class=\"o\">=</span> <span class=\"s\">\".\"</span><span class=\"p\">;</span>\n  <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"n\">argc</span> <span class=\"o\">==</span> <span class=\"mi\">2</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n      <span class=\"n\">target</span> <span class=\"o\">=</span> <span class=\"n\">argv</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">];</span>\n  <span class=\"p\">}</span>\n  <span class=\"k\">struct</span> <span class=\"nc\">dirent</span> <span class=\"o\">*</span><span class=\"n\">dir</span><span class=\"p\">;</span>\n  <span class=\"n\">d</span> <span class=\"o\">=</span> <span class=\"n\">opendir</span><span class=\"p\">(</span><span class=\"n\">target</span><span class=\"p\">);</span>\n  <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"n\">d</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"k\">while</span> <span class=\"p\">((</span><span class=\"n\">dir</span> <span class=\"o\">=</span> <span class=\"n\">readdir</span><span class=\"p\">(</span><span class=\"n\">d</span><span class=\"p\">))</span> <span class=\"o\">!=</span> <span class=\"nb\">NULL</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n      <span class=\"n\">printf</span><span class=\"p\">(</span><span class=\"s\">\"%s</span><span class=\"se\">\\n</span><span class=\"s\">\"</span><span class=\"p\">,</span> <span class=\"n\">dir</span><span class=\"o\">-&gt;</span><span class=\"n\">d_name</span><span class=\"p\">);</span>\n    <span class=\"p\">}</span>\n\n    <span class=\"n\">printf</span><span class=\"p\">(</span><span class=\"s\">\"errno: %d</span><span class=\"se\">\\n</span><span class=\"s\">\"</span><span class=\"p\">,</span> <span class=\"n\">errno</span><span class=\"p\">);</span>\n    <span class=\"n\">closedir</span><span class=\"p\">(</span><span class=\"n\">d</span><span class=\"p\">);</span>\n  <span class=\"p\">}</span>\n\n  <span class=\"k\">return</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">);</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p>I then use this bash script to generate a directory with <code>N</code> files in</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>rm -rf testfolder\nmkdir -p testfolder\n<span class=\"k\">for</span> n in <span class=\"k\">$(</span>seq <span class=\"m\">1</span> <span class=\"si\">${</span><span class=\"nv\">1</span><span class=\"k\">:-</span><span class=\"nv\">100</span><span class=\"si\">}</span><span class=\"k\">)</span><span class=\"p\">;</span> <span class=\"k\">do</span>\n        touch testfolder/<span class=\"k\">$(</span><span class=\"nb\">printf</span> %04d <span class=\"s2\">\"</span><span class=\"nv\">$n</span><span class=\"s2\">\"</span><span class=\"k\">)</span>\n<span class=\"k\">done</span>\n</code></pre></div>\n<p>This is what happens when I run it</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>$ bash generate-files.sh <span class=\"m\">100</span>\n\n$ ls testfolder/\n<span class=\"m\">0001</span>  <span class=\"m\">0005</span>  <span class=\"m\">0009</span>  <span class=\"m\">0013</span>  <span class=\"m\">0017</span>  <span class=\"m\">0021</span>  <span class=\"m\">0025</span>  <span class=\"m\">0029</span>  <span class=\"m\">0033</span>  <span class=\"m\">0037</span>  <span class=\"m\">0041</span>  <span class=\"m\">0045</span>  <span class=\"m\">0049</span>  <span class=\"m\">0053</span>  <span class=\"m\">0057</span>  <span class=\"m\">0061</span>  <span class=\"m\">0065</span>  <span class=\"m\">0069</span>  <span class=\"m\">0073</span>  <span class=\"m\">0077</span>  <span class=\"m\">0081</span>  <span class=\"m\">0085</span>  <span class=\"m\">0089</span>  <span class=\"m\">0093</span>  <span class=\"m\">0097</span>\n<span class=\"m\">0002</span>  <span class=\"m\">0006</span>  <span class=\"m\">0010</span>  <span class=\"m\">0014</span>  <span class=\"m\">0018</span>  <span class=\"m\">0022</span>  <span class=\"m\">0026</span>  <span class=\"m\">0030</span>  <span class=\"m\">0034</span>  <span class=\"m\">0038</span>  <span class=\"m\">0042</span>  <span class=\"m\">0046</span>  <span class=\"m\">0050</span>  <span class=\"m\">0054</span>  <span class=\"m\">0058</span>  <span class=\"m\">0062</span>  <span class=\"m\">0066</span>  <span class=\"m\">0070</span>  <span class=\"m\">0074</span>  <span class=\"m\">0078</span>  <span class=\"m\">0082</span>  <span class=\"m\">0086</span>  <span class=\"m\">0090</span>  <span class=\"m\">0094</span>  <span class=\"m\">0098</span>\n<span class=\"m\">0003</span>  <span class=\"m\">0007</span>  <span class=\"m\">0011</span>  <span class=\"m\">0015</span>  <span class=\"m\">0019</span>  <span class=\"m\">0023</span>  <span class=\"m\">0027</span>  <span class=\"m\">0031</span>  <span class=\"m\">0035</span>  <span class=\"m\">0039</span>  <span class=\"m\">0043</span>  <span class=\"m\">0047</span>  <span class=\"m\">0051</span>  <span class=\"m\">0055</span>  <span class=\"m\">0059</span>  <span class=\"m\">0063</span>  <span class=\"m\">0067</span>  <span class=\"m\">0071</span>  <span class=\"m\">0075</span>  <span class=\"m\">0079</span>  <span class=\"m\">0083</span>  <span class=\"m\">0087</span>  <span class=\"m\">0091</span>  <span class=\"m\">0095</span>  <span class=\"m\">0099</span>\n<span class=\"m\">0004</span>  <span class=\"m\">0008</span>  <span class=\"m\">0012</span>  <span class=\"m\">0016</span>  <span class=\"m\">0020</span>  <span class=\"m\">0024</span>  <span class=\"m\">0028</span>  <span class=\"m\">0032</span>  <span class=\"m\">0036</span>  <span class=\"m\">0040</span>  <span class=\"m\">0044</span>  <span class=\"m\">0048</span>  <span class=\"m\">0052</span>  <span class=\"m\">0056</span>  <span class=\"m\">0060</span>  <span class=\"m\">0064</span>  <span class=\"m\">0068</span>  <span class=\"m\">0072</span>  <span class=\"m\">0076</span>  <span class=\"m\">0080</span>  <span class=\"m\">0084</span>  <span class=\"m\">0088</span>  <span class=\"m\">0092</span>  <span class=\"m\">0096</span>  <span class=\"m\">0100</span>\n\n$ wasmtime run ls.wasm --dir<span class=\"o\">=</span>./testfolder -- testfolder <span class=\"p\">|</span> wc -l\n<span class=\"m\">103</span> <span class=\"c1\"># 100 files + \".\" \"..\" and the \"errno\" print</span>\n\n$ bash generate-files.sh <span class=\"m\">200</span>\n\n$ wasmtime run ls.wasm --dir<span class=\"o\">=</span>./testfolder -- testfolder <span class=\"p\">|</span> wc -l\n<span class=\"m\">147</span> <span class=\"c1\"># lots of files missing</span>\n\n<span class=\"c1\"># for example 0012</span>\n$ wasmtime run ls.wasm --dir<span class=\"o\">=</span>./testfolder -- testfolder <span class=\"p\">|</span> grep <span class=\"m\">0012</span>\n\n$ wasmtime run ls.wasm --dir<span class=\"o\">=</span>./testfolder -- testfolder <span class=\"p\">|</span> grep <span class=\"m\">0011</span>\n<span class=\"m\">0011</span>\n</code></pre></div>\n<p>Running wasmer on the same input works as expected:</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>$ ~/.wasmer/bin/wasmer run ls.wasm --dir<span class=\"o\">=</span>./testfolder -- testfolder <span class=\"p\">|</span> wc -l\n<span class=\"m\">201</span> <span class=\"c1\"># wasmer does not return \".\" and \"..\"</span>\n\n$ ~/.wasmer/bin/wasmer run ls.wasm --dir<span class=\"o\">=</span>./testfolder -- testfolder <span class=\"p\">|</span> grep <span class=\"m\">0012</span>\n<span class=\"m\">0012</span>\n</code></pre></div>\n<h1>Expected Behavior</h1>\n<p>Calls to <code>readdir</code> returns all directory entries, even for folders with more than 150 files.<br>\n</p>\n</blockquote>",
        "id": 219361553,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1607531561
    },
    {
        "content": "<p>abbec edited <a href=\"https://github.com/bytecodealliance/wasmtime/issues/2493\">Issue #2493</a>:</p>\n<blockquote>\n<p>I am using this simple C program to test:</p>\n<div class=\"codehilite\" data-code-language=\"C\"><pre><span></span><code><span class=\"cp\">#include</span> <span class=\"cpf\">&lt;dirent.h&gt;</span><span class=\"cp\"></span>\n<span class=\"cp\">#include</span> <span class=\"cpf\">&lt;stdio.h&gt;</span><span class=\"cp\"></span>\n<span class=\"cp\">#include</span> <span class=\"cpf\">&lt;errno.h&gt;</span><span class=\"cp\"></span>\n\n<span class=\"kt\">int</span> <span class=\"nf\">main</span><span class=\"p\">(</span><span class=\"kt\">int</span> <span class=\"n\">argc</span><span class=\"p\">,</span> <span class=\"kt\">char</span> <span class=\"o\">**</span><span class=\"n\">argv</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n  <span class=\"kt\">DIR</span> <span class=\"o\">*</span><span class=\"n\">d</span><span class=\"p\">;</span>\n\n  <span class=\"kt\">char</span> <span class=\"o\">*</span> <span class=\"n\">target</span> <span class=\"o\">=</span> <span class=\"s\">\".\"</span><span class=\"p\">;</span>\n  <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"n\">argc</span> <span class=\"o\">==</span> <span class=\"mi\">2</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n      <span class=\"n\">target</span> <span class=\"o\">=</span> <span class=\"n\">argv</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">];</span>\n  <span class=\"p\">}</span>\n  <span class=\"k\">struct</span> <span class=\"nc\">dirent</span> <span class=\"o\">*</span><span class=\"n\">dir</span><span class=\"p\">;</span>\n  <span class=\"n\">d</span> <span class=\"o\">=</span> <span class=\"n\">opendir</span><span class=\"p\">(</span><span class=\"n\">target</span><span class=\"p\">);</span>\n  <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"n\">d</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"k\">while</span> <span class=\"p\">((</span><span class=\"n\">dir</span> <span class=\"o\">=</span> <span class=\"n\">readdir</span><span class=\"p\">(</span><span class=\"n\">d</span><span class=\"p\">))</span> <span class=\"o\">!=</span> <span class=\"nb\">NULL</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n      <span class=\"n\">printf</span><span class=\"p\">(</span><span class=\"s\">\"%s</span><span class=\"se\">\\n</span><span class=\"s\">\"</span><span class=\"p\">,</span> <span class=\"n\">dir</span><span class=\"o\">-&gt;</span><span class=\"n\">d_name</span><span class=\"p\">);</span>\n    <span class=\"p\">}</span>\n\n    <span class=\"n\">printf</span><span class=\"p\">(</span><span class=\"s\">\"errno: %d</span><span class=\"se\">\\n</span><span class=\"s\">\"</span><span class=\"p\">,</span> <span class=\"n\">errno</span><span class=\"p\">);</span>\n    <span class=\"n\">closedir</span><span class=\"p\">(</span><span class=\"n\">d</span><span class=\"p\">);</span>\n  <span class=\"p\">}</span>\n\n  <span class=\"k\">return</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">);</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p>I then use this bash script to generate a directory with <code>N</code> files in</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>rm -rf testfolder\nmkdir -p testfolder\n<span class=\"k\">for</span> n in <span class=\"k\">$(</span>seq <span class=\"m\">1</span> <span class=\"si\">${</span><span class=\"nv\">1</span><span class=\"k\">:-</span><span class=\"nv\">100</span><span class=\"si\">}</span><span class=\"k\">)</span><span class=\"p\">;</span> <span class=\"k\">do</span>\n        touch testfolder/<span class=\"k\">$(</span><span class=\"nb\">printf</span> %04d <span class=\"s2\">\"</span><span class=\"nv\">$n</span><span class=\"s2\">\"</span><span class=\"k\">)</span>\n<span class=\"k\">done</span>\n</code></pre></div>\n<p>This is what happens when I run it</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>$ bash generate-files.sh <span class=\"m\">100</span>\n\n$ ls testfolder/\n<span class=\"m\">0001</span>  <span class=\"m\">0005</span>  <span class=\"m\">0009</span>  <span class=\"m\">0013</span>  <span class=\"m\">0017</span>  <span class=\"m\">0021</span>  <span class=\"m\">0025</span>  <span class=\"m\">0029</span>  <span class=\"m\">0033</span>  <span class=\"m\">0037</span>  <span class=\"m\">0041</span>  <span class=\"m\">0045</span>  <span class=\"m\">0049</span>  <span class=\"m\">0053</span>  <span class=\"m\">0057</span>  <span class=\"m\">0061</span>  <span class=\"m\">0065</span>  <span class=\"m\">0069</span>  <span class=\"m\">0073</span>  <span class=\"m\">0077</span>  <span class=\"m\">0081</span>  <span class=\"m\">0085</span>  <span class=\"m\">0089</span>  <span class=\"m\">0093</span>  <span class=\"m\">0097</span>\n<span class=\"m\">0002</span>  <span class=\"m\">0006</span>  <span class=\"m\">0010</span>  <span class=\"m\">0014</span>  <span class=\"m\">0018</span>  <span class=\"m\">0022</span>  <span class=\"m\">0026</span>  <span class=\"m\">0030</span>  <span class=\"m\">0034</span>  <span class=\"m\">0038</span>  <span class=\"m\">0042</span>  <span class=\"m\">0046</span>  <span class=\"m\">0050</span>  <span class=\"m\">0054</span>  <span class=\"m\">0058</span>  <span class=\"m\">0062</span>  <span class=\"m\">0066</span>  <span class=\"m\">0070</span>  <span class=\"m\">0074</span>  <span class=\"m\">0078</span>  <span class=\"m\">0082</span>  <span class=\"m\">0086</span>  <span class=\"m\">0090</span>  <span class=\"m\">0094</span>  <span class=\"m\">0098</span>\n<span class=\"m\">0003</span>  <span class=\"m\">0007</span>  <span class=\"m\">0011</span>  <span class=\"m\">0015</span>  <span class=\"m\">0019</span>  <span class=\"m\">0023</span>  <span class=\"m\">0027</span>  <span class=\"m\">0031</span>  <span class=\"m\">0035</span>  <span class=\"m\">0039</span>  <span class=\"m\">0043</span>  <span class=\"m\">0047</span>  <span class=\"m\">0051</span>  <span class=\"m\">0055</span>  <span class=\"m\">0059</span>  <span class=\"m\">0063</span>  <span class=\"m\">0067</span>  <span class=\"m\">0071</span>  <span class=\"m\">0075</span>  <span class=\"m\">0079</span>  <span class=\"m\">0083</span>  <span class=\"m\">0087</span>  <span class=\"m\">0091</span>  <span class=\"m\">0095</span>  <span class=\"m\">0099</span>\n<span class=\"m\">0004</span>  <span class=\"m\">0008</span>  <span class=\"m\">0012</span>  <span class=\"m\">0016</span>  <span class=\"m\">0020</span>  <span class=\"m\">0024</span>  <span class=\"m\">0028</span>  <span class=\"m\">0032</span>  <span class=\"m\">0036</span>  <span class=\"m\">0040</span>  <span class=\"m\">0044</span>  <span class=\"m\">0048</span>  <span class=\"m\">0052</span>  <span class=\"m\">0056</span>  <span class=\"m\">0060</span>  <span class=\"m\">0064</span>  <span class=\"m\">0068</span>  <span class=\"m\">0072</span>  <span class=\"m\">0076</span>  <span class=\"m\">0080</span>  <span class=\"m\">0084</span>  <span class=\"m\">0088</span>  <span class=\"m\">0092</span>  <span class=\"m\">0096</span>  <span class=\"m\">0100</span>\n\n$ wasmtime run ls.wasm --dir<span class=\"o\">=</span>./testfolder -- testfolder <span class=\"p\">|</span> wc -l\n<span class=\"m\">103</span> <span class=\"c1\"># 100 files + \".\" \"..\" and the \"errno\" print</span>\n\n$ bash generate-files.sh <span class=\"m\">200</span>\n\n$ wasmtime run ls.wasm --dir<span class=\"o\">=</span>./testfolder -- testfolder <span class=\"p\">|</span> wc -l\n<span class=\"m\">147</span> <span class=\"c1\"># lots of files missing</span>\n\n<span class=\"c1\"># for example 0012</span>\n$ wasmtime run ls.wasm --dir<span class=\"o\">=</span>./testfolder -- testfolder <span class=\"p\">|</span> grep <span class=\"m\">0012</span>\n\n$ wasmtime run ls.wasm --dir<span class=\"o\">=</span>./testfolder -- testfolder <span class=\"p\">|</span> grep <span class=\"m\">0011</span>\n<span class=\"m\">0011</span>\n</code></pre></div>\n<p>Running wasmer on the same input works as expected:</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>$ ~/.wasmer/bin/wasmer run ls.wasm --dir<span class=\"o\">=</span>./testfolder -- testfolder <span class=\"p\">|</span> wc -l\n<span class=\"m\">201</span> <span class=\"c1\"># wasmer does not return \".\" and \"..\"</span>\n\n$ ~/.wasmer/bin/wasmer run ls.wasm --dir<span class=\"o\">=</span>./testfolder -- testfolder <span class=\"p\">|</span> grep <span class=\"m\">0012</span>\n<span class=\"m\">0012</span>\n</code></pre></div>\n<h1>Expected Behavior</h1>\n<p>Calls to <code>readdir</code> returns all directory entries, even for folders with more than ~150 files.<br>\n</p>\n</blockquote>",
        "id": 219361777,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1607531645
    },
    {
        "content": "<p>abbec <a href=\"https://github.com/bytecodealliance/wasmtime/issues/2493#issuecomment-741898192\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/2493\">Issue #2493</a>:</p>\n<blockquote>\n<p>Tested wasmtime versions are 0.19 and 0.21 (both with the same result)</p>\n</blockquote>",
        "id": 219363515,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1607532397
    },
    {
        "content": "<p>pchickey assigned <a href=\"https://github.com/bytecodealliance/wasmtime/issues/2493\">Issue #2493</a>:</p>\n<blockquote>\n<p>I am using this simple C program to test:</p>\n<div class=\"codehilite\" data-code-language=\"C\"><pre><span></span><code><span class=\"cp\">#include</span> <span class=\"cpf\">&lt;dirent.h&gt;</span><span class=\"cp\"></span>\n<span class=\"cp\">#include</span> <span class=\"cpf\">&lt;stdio.h&gt;</span><span class=\"cp\"></span>\n<span class=\"cp\">#include</span> <span class=\"cpf\">&lt;errno.h&gt;</span><span class=\"cp\"></span>\n\n<span class=\"kt\">int</span> <span class=\"nf\">main</span><span class=\"p\">(</span><span class=\"kt\">int</span> <span class=\"n\">argc</span><span class=\"p\">,</span> <span class=\"kt\">char</span> <span class=\"o\">**</span><span class=\"n\">argv</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n  <span class=\"kt\">DIR</span> <span class=\"o\">*</span><span class=\"n\">d</span><span class=\"p\">;</span>\n\n  <span class=\"kt\">char</span> <span class=\"o\">*</span> <span class=\"n\">target</span> <span class=\"o\">=</span> <span class=\"s\">\".\"</span><span class=\"p\">;</span>\n  <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"n\">argc</span> <span class=\"o\">==</span> <span class=\"mi\">2</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n      <span class=\"n\">target</span> <span class=\"o\">=</span> <span class=\"n\">argv</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">];</span>\n  <span class=\"p\">}</span>\n  <span class=\"k\">struct</span> <span class=\"nc\">dirent</span> <span class=\"o\">*</span><span class=\"n\">dir</span><span class=\"p\">;</span>\n  <span class=\"n\">d</span> <span class=\"o\">=</span> <span class=\"n\">opendir</span><span class=\"p\">(</span><span class=\"n\">target</span><span class=\"p\">);</span>\n  <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"n\">d</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"k\">while</span> <span class=\"p\">((</span><span class=\"n\">dir</span> <span class=\"o\">=</span> <span class=\"n\">readdir</span><span class=\"p\">(</span><span class=\"n\">d</span><span class=\"p\">))</span> <span class=\"o\">!=</span> <span class=\"nb\">NULL</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n      <span class=\"n\">printf</span><span class=\"p\">(</span><span class=\"s\">\"%s</span><span class=\"se\">\\n</span><span class=\"s\">\"</span><span class=\"p\">,</span> <span class=\"n\">dir</span><span class=\"o\">-&gt;</span><span class=\"n\">d_name</span><span class=\"p\">);</span>\n    <span class=\"p\">}</span>\n\n    <span class=\"n\">printf</span><span class=\"p\">(</span><span class=\"s\">\"errno: %d</span><span class=\"se\">\\n</span><span class=\"s\">\"</span><span class=\"p\">,</span> <span class=\"n\">errno</span><span class=\"p\">);</span>\n    <span class=\"n\">closedir</span><span class=\"p\">(</span><span class=\"n\">d</span><span class=\"p\">);</span>\n  <span class=\"p\">}</span>\n\n  <span class=\"k\">return</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">);</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p>I then use this bash script to generate a directory with <code>N</code> files in</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>rm -rf testfolder\nmkdir -p testfolder\n<span class=\"k\">for</span> n in <span class=\"k\">$(</span>seq <span class=\"m\">1</span> <span class=\"si\">${</span><span class=\"nv\">1</span><span class=\"k\">:-</span><span class=\"nv\">100</span><span class=\"si\">}</span><span class=\"k\">)</span><span class=\"p\">;</span> <span class=\"k\">do</span>\n        touch testfolder/<span class=\"k\">$(</span><span class=\"nb\">printf</span> %04d <span class=\"s2\">\"</span><span class=\"nv\">$n</span><span class=\"s2\">\"</span><span class=\"k\">)</span>\n<span class=\"k\">done</span>\n</code></pre></div>\n<p>This is what happens when I run it</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>$ bash generate-files.sh <span class=\"m\">100</span>\n\n$ ls testfolder/\n<span class=\"m\">0001</span>  <span class=\"m\">0005</span>  <span class=\"m\">0009</span>  <span class=\"m\">0013</span>  <span class=\"m\">0017</span>  <span class=\"m\">0021</span>  <span class=\"m\">0025</span>  <span class=\"m\">0029</span>  <span class=\"m\">0033</span>  <span class=\"m\">0037</span>  <span class=\"m\">0041</span>  <span class=\"m\">0045</span>  <span class=\"m\">0049</span>  <span class=\"m\">0053</span>  <span class=\"m\">0057</span>  <span class=\"m\">0061</span>  <span class=\"m\">0065</span>  <span class=\"m\">0069</span>  <span class=\"m\">0073</span>  <span class=\"m\">0077</span>  <span class=\"m\">0081</span>  <span class=\"m\">0085</span>  <span class=\"m\">0089</span>  <span class=\"m\">0093</span>  <span class=\"m\">0097</span>\n<span class=\"m\">0002</span>  <span class=\"m\">0006</span>  <span class=\"m\">0010</span>  <span class=\"m\">0014</span>  <span class=\"m\">0018</span>  <span class=\"m\">0022</span>  <span class=\"m\">0026</span>  <span class=\"m\">0030</span>  <span class=\"m\">0034</span>  <span class=\"m\">0038</span>  <span class=\"m\">0042</span>  <span class=\"m\">0046</span>  <span class=\"m\">0050</span>  <span class=\"m\">0054</span>  <span class=\"m\">0058</span>  <span class=\"m\">0062</span>  <span class=\"m\">0066</span>  <span class=\"m\">0070</span>  <span class=\"m\">0074</span>  <span class=\"m\">0078</span>  <span class=\"m\">0082</span>  <span class=\"m\">0086</span>  <span class=\"m\">0090</span>  <span class=\"m\">0094</span>  <span class=\"m\">0098</span>\n<span class=\"m\">0003</span>  <span class=\"m\">0007</span>  <span class=\"m\">0011</span>  <span class=\"m\">0015</span>  <span class=\"m\">0019</span>  <span class=\"m\">0023</span>  <span class=\"m\">0027</span>  <span class=\"m\">0031</span>  <span class=\"m\">0035</span>  <span class=\"m\">0039</span>  <span class=\"m\">0043</span>  <span class=\"m\">0047</span>  <span class=\"m\">0051</span>  <span class=\"m\">0055</span>  <span class=\"m\">0059</span>  <span class=\"m\">0063</span>  <span class=\"m\">0067</span>  <span class=\"m\">0071</span>  <span class=\"m\">0075</span>  <span class=\"m\">0079</span>  <span class=\"m\">0083</span>  <span class=\"m\">0087</span>  <span class=\"m\">0091</span>  <span class=\"m\">0095</span>  <span class=\"m\">0099</span>\n<span class=\"m\">0004</span>  <span class=\"m\">0008</span>  <span class=\"m\">0012</span>  <span class=\"m\">0016</span>  <span class=\"m\">0020</span>  <span class=\"m\">0024</span>  <span class=\"m\">0028</span>  <span class=\"m\">0032</span>  <span class=\"m\">0036</span>  <span class=\"m\">0040</span>  <span class=\"m\">0044</span>  <span class=\"m\">0048</span>  <span class=\"m\">0052</span>  <span class=\"m\">0056</span>  <span class=\"m\">0060</span>  <span class=\"m\">0064</span>  <span class=\"m\">0068</span>  <span class=\"m\">0072</span>  <span class=\"m\">0076</span>  <span class=\"m\">0080</span>  <span class=\"m\">0084</span>  <span class=\"m\">0088</span>  <span class=\"m\">0092</span>  <span class=\"m\">0096</span>  <span class=\"m\">0100</span>\n\n$ wasmtime run ls.wasm --dir<span class=\"o\">=</span>./testfolder -- testfolder <span class=\"p\">|</span> wc -l\n<span class=\"m\">103</span> <span class=\"c1\"># 100 files + \".\" \"..\" and the \"errno\" print</span>\n\n$ bash generate-files.sh <span class=\"m\">200</span>\n\n$ wasmtime run ls.wasm --dir<span class=\"o\">=</span>./testfolder -- testfolder <span class=\"p\">|</span> wc -l\n<span class=\"m\">147</span> <span class=\"c1\"># lots of files missing</span>\n\n<span class=\"c1\"># for example 0012</span>\n$ wasmtime run ls.wasm --dir<span class=\"o\">=</span>./testfolder -- testfolder <span class=\"p\">|</span> grep <span class=\"m\">0012</span>\n\n$ wasmtime run ls.wasm --dir<span class=\"o\">=</span>./testfolder -- testfolder <span class=\"p\">|</span> grep <span class=\"m\">0011</span>\n<span class=\"m\">0011</span>\n</code></pre></div>\n<p>Running wasmer on the same input works as expected:</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>$ ~/.wasmer/bin/wasmer run ls.wasm --dir<span class=\"o\">=</span>./testfolder -- testfolder <span class=\"p\">|</span> wc -l\n<span class=\"m\">201</span> <span class=\"c1\"># wasmer does not return \".\" and \"..\"</span>\n\n$ ~/.wasmer/bin/wasmer run ls.wasm --dir<span class=\"o\">=</span>./testfolder -- testfolder <span class=\"p\">|</span> grep <span class=\"m\">0012</span>\n<span class=\"m\">0012</span>\n</code></pre></div>\n<h1>Expected Behavior</h1>\n<p>Calls to <code>readdir</code> returns all directory entries, even for folders with more than ~150 files.<br>\n</p>\n</blockquote>",
        "id": 219383730,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1607541233
    },
    {
        "content": "<p>pchickey <a href=\"https://github.com/bytecodealliance/wasmtime/issues/2493#issuecomment-741998937\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/2493\">Issue #2493</a>:</p>\n<blockquote>\n<p>What toolchain and libc did you compile the example with?</p>\n<p>When I compiled with wasi-sdk 12, I was unable to reproduce.<br>\n<a href=\"https://github.com/bytecodealliance/wasmtime/files/5668210/issue2493.zip\">issue2493.zip</a></p>\n</blockquote>",
        "id": 219386238,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1607542331
    },
    {
        "content": "<p>pchickey deleted a <a href=\"https://github.com/bytecodealliance/wasmtime/issues/2493#issuecomment-741998937\">comment</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/2493\">Issue #2493</a>:</p>\n<blockquote>\n<p>What toolchain and libc did you compile the example with?</p>\n<p>When I compiled with wasi-sdk 12, I was unable to reproduce.<br>\n<a href=\"https://github.com/bytecodealliance/wasmtime/files/5668210/issue2493.zip\">issue2493.zip</a></p>\n</blockquote>",
        "id": 219386470,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1607542426
    },
    {
        "content": "<p>pchickey <a href=\"https://github.com/bytecodealliance/wasmtime/issues/2493#issuecomment-742000470\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/2493\">Issue #2493</a>:</p>\n<blockquote>\n<p>I was able to reproduce, this is a wasi-common bug</p>\n</blockquote>",
        "id": 219386691,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1607542492
    },
    {
        "content": "<p>pchickey labeled <a href=\"https://github.com/bytecodealliance/wasmtime/issues/2493\">Issue #2493</a> (assigned to pchickey):</p>\n<blockquote>\n<p>I am using this simple C program to test:</p>\n<div class=\"codehilite\" data-code-language=\"C\"><pre><span></span><code><span class=\"cp\">#include</span> <span class=\"cpf\">&lt;dirent.h&gt;</span><span class=\"cp\"></span>\n<span class=\"cp\">#include</span> <span class=\"cpf\">&lt;stdio.h&gt;</span><span class=\"cp\"></span>\n<span class=\"cp\">#include</span> <span class=\"cpf\">&lt;errno.h&gt;</span><span class=\"cp\"></span>\n\n<span class=\"kt\">int</span> <span class=\"nf\">main</span><span class=\"p\">(</span><span class=\"kt\">int</span> <span class=\"n\">argc</span><span class=\"p\">,</span> <span class=\"kt\">char</span> <span class=\"o\">**</span><span class=\"n\">argv</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n  <span class=\"kt\">DIR</span> <span class=\"o\">*</span><span class=\"n\">d</span><span class=\"p\">;</span>\n\n  <span class=\"kt\">char</span> <span class=\"o\">*</span> <span class=\"n\">target</span> <span class=\"o\">=</span> <span class=\"s\">\".\"</span><span class=\"p\">;</span>\n  <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"n\">argc</span> <span class=\"o\">==</span> <span class=\"mi\">2</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n      <span class=\"n\">target</span> <span class=\"o\">=</span> <span class=\"n\">argv</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">];</span>\n  <span class=\"p\">}</span>\n  <span class=\"k\">struct</span> <span class=\"nc\">dirent</span> <span class=\"o\">*</span><span class=\"n\">dir</span><span class=\"p\">;</span>\n  <span class=\"n\">d</span> <span class=\"o\">=</span> <span class=\"n\">opendir</span><span class=\"p\">(</span><span class=\"n\">target</span><span class=\"p\">);</span>\n  <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"n\">d</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"k\">while</span> <span class=\"p\">((</span><span class=\"n\">dir</span> <span class=\"o\">=</span> <span class=\"n\">readdir</span><span class=\"p\">(</span><span class=\"n\">d</span><span class=\"p\">))</span> <span class=\"o\">!=</span> <span class=\"nb\">NULL</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n      <span class=\"n\">printf</span><span class=\"p\">(</span><span class=\"s\">\"%s</span><span class=\"se\">\\n</span><span class=\"s\">\"</span><span class=\"p\">,</span> <span class=\"n\">dir</span><span class=\"o\">-&gt;</span><span class=\"n\">d_name</span><span class=\"p\">);</span>\n    <span class=\"p\">}</span>\n\n    <span class=\"n\">printf</span><span class=\"p\">(</span><span class=\"s\">\"errno: %d</span><span class=\"se\">\\n</span><span class=\"s\">\"</span><span class=\"p\">,</span> <span class=\"n\">errno</span><span class=\"p\">);</span>\n    <span class=\"n\">closedir</span><span class=\"p\">(</span><span class=\"n\">d</span><span class=\"p\">);</span>\n  <span class=\"p\">}</span>\n\n  <span class=\"k\">return</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">);</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p>I then use this bash script to generate a directory with <code>N</code> files in</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>rm -rf testfolder\nmkdir -p testfolder\n<span class=\"k\">for</span> n in <span class=\"k\">$(</span>seq <span class=\"m\">1</span> <span class=\"si\">${</span><span class=\"nv\">1</span><span class=\"k\">:-</span><span class=\"nv\">100</span><span class=\"si\">}</span><span class=\"k\">)</span><span class=\"p\">;</span> <span class=\"k\">do</span>\n        touch testfolder/<span class=\"k\">$(</span><span class=\"nb\">printf</span> %04d <span class=\"s2\">\"</span><span class=\"nv\">$n</span><span class=\"s2\">\"</span><span class=\"k\">)</span>\n<span class=\"k\">done</span>\n</code></pre></div>\n<p>This is what happens when I run it</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>$ bash generate-files.sh <span class=\"m\">100</span>\n\n$ ls testfolder/\n<span class=\"m\">0001</span>  <span class=\"m\">0005</span>  <span class=\"m\">0009</span>  <span class=\"m\">0013</span>  <span class=\"m\">0017</span>  <span class=\"m\">0021</span>  <span class=\"m\">0025</span>  <span class=\"m\">0029</span>  <span class=\"m\">0033</span>  <span class=\"m\">0037</span>  <span class=\"m\">0041</span>  <span class=\"m\">0045</span>  <span class=\"m\">0049</span>  <span class=\"m\">0053</span>  <span class=\"m\">0057</span>  <span class=\"m\">0061</span>  <span class=\"m\">0065</span>  <span class=\"m\">0069</span>  <span class=\"m\">0073</span>  <span class=\"m\">0077</span>  <span class=\"m\">0081</span>  <span class=\"m\">0085</span>  <span class=\"m\">0089</span>  <span class=\"m\">0093</span>  <span class=\"m\">0097</span>\n<span class=\"m\">0002</span>  <span class=\"m\">0006</span>  <span class=\"m\">0010</span>  <span class=\"m\">0014</span>  <span class=\"m\">0018</span>  <span class=\"m\">0022</span>  <span class=\"m\">0026</span>  <span class=\"m\">0030</span>  <span class=\"m\">0034</span>  <span class=\"m\">0038</span>  <span class=\"m\">0042</span>  <span class=\"m\">0046</span>  <span class=\"m\">0050</span>  <span class=\"m\">0054</span>  <span class=\"m\">0058</span>  <span class=\"m\">0062</span>  <span class=\"m\">0066</span>  <span class=\"m\">0070</span>  <span class=\"m\">0074</span>  <span class=\"m\">0078</span>  <span class=\"m\">0082</span>  <span class=\"m\">0086</span>  <span class=\"m\">0090</span>  <span class=\"m\">0094</span>  <span class=\"m\">0098</span>\n<span class=\"m\">0003</span>  <span class=\"m\">0007</span>  <span class=\"m\">0011</span>  <span class=\"m\">0015</span>  <span class=\"m\">0019</span>  <span class=\"m\">0023</span>  <span class=\"m\">0027</span>  <span class=\"m\">0031</span>  <span class=\"m\">0035</span>  <span class=\"m\">0039</span>  <span class=\"m\">0043</span>  <span class=\"m\">0047</span>  <span class=\"m\">0051</span>  <span class=\"m\">0055</span>  <span class=\"m\">0059</span>  <span class=\"m\">0063</span>  <span class=\"m\">0067</span>  <span class=\"m\">0071</span>  <span class=\"m\">0075</span>  <span class=\"m\">0079</span>  <span class=\"m\">0083</span>  <span class=\"m\">0087</span>  <span class=\"m\">0091</span>  <span class=\"m\">0095</span>  <span class=\"m\">0099</span>\n<span class=\"m\">0004</span>  <span class=\"m\">0008</span>  <span class=\"m\">0012</span>  <span class=\"m\">0016</span>  <span class=\"m\">0020</span>  <span class=\"m\">0024</span>  <span class=\"m\">0028</span>  <span class=\"m\">0032</span>  <span class=\"m\">0036</span>  <span class=\"m\">0040</span>  <span class=\"m\">0044</span>  <span class=\"m\">0048</span>  <span class=\"m\">0052</span>  <span class=\"m\">0056</span>  <span class=\"m\">0060</span>  <span class=\"m\">0064</span>  <span class=\"m\">0068</span>  <span class=\"m\">0072</span>  <span class=\"m\">0076</span>  <span class=\"m\">0080</span>  <span class=\"m\">0084</span>  <span class=\"m\">0088</span>  <span class=\"m\">0092</span>  <span class=\"m\">0096</span>  <span class=\"m\">0100</span>\n\n$ wasmtime run ls.wasm --dir<span class=\"o\">=</span>./testfolder -- testfolder <span class=\"p\">|</span> wc -l\n<span class=\"m\">103</span> <span class=\"c1\"># 100 files + \".\" \"..\" and the \"errno\" print</span>\n\n$ bash generate-files.sh <span class=\"m\">200</span>\n\n$ wasmtime run ls.wasm --dir<span class=\"o\">=</span>./testfolder -- testfolder <span class=\"p\">|</span> wc -l\n<span class=\"m\">147</span> <span class=\"c1\"># lots of files missing</span>\n\n<span class=\"c1\"># for example 0012</span>\n$ wasmtime run ls.wasm --dir<span class=\"o\">=</span>./testfolder -- testfolder <span class=\"p\">|</span> grep <span class=\"m\">0012</span>\n\n$ wasmtime run ls.wasm --dir<span class=\"o\">=</span>./testfolder -- testfolder <span class=\"p\">|</span> grep <span class=\"m\">0011</span>\n<span class=\"m\">0011</span>\n</code></pre></div>\n<p>Running wasmer on the same input works as expected:</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>$ ~/.wasmer/bin/wasmer run ls.wasm --dir<span class=\"o\">=</span>./testfolder -- testfolder <span class=\"p\">|</span> wc -l\n<span class=\"m\">201</span> <span class=\"c1\"># wasmer does not return \".\" and \"..\"</span>\n\n$ ~/.wasmer/bin/wasmer run ls.wasm --dir<span class=\"o\">=</span>./testfolder -- testfolder <span class=\"p\">|</span> grep <span class=\"m\">0012</span>\n<span class=\"m\">0012</span>\n</code></pre></div>\n<h1>Expected Behavior</h1>\n<p>Calls to <code>readdir</code> returns all directory entries, even for folders with more than ~150 files.<br>\n</p>\n</blockquote>",
        "id": 219388993,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1607543572
    },
    {
        "content": "<p>sunfishcode <a href=\"https://github.com/bytecodealliance/wasmtime/issues/2493#issuecomment-742256706\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/2493\">Issue #2493</a>:</p>\n<blockquote>\n<p>Me too. #2494 is a fix for this.</p>\n</blockquote>",
        "id": 219434498,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1607579294
    },
    {
        "content": "<p>abbec <a href=\"https://github.com/bytecodealliance/wasmtime/issues/2493#issuecomment-742268347\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/2493\">Issue #2493</a>:</p>\n<blockquote>\n<p>Nice, that was fast! <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span></p>\n</blockquote>",
        "id": 219435797,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1607581112
    },
    {
        "content": "<p>sunfishcode closed <a href=\"https://github.com/bytecodealliance/wasmtime/issues/2493\">Issue #2493</a> (assigned to pchickey):</p>\n<blockquote>\n<p>I am using this simple C program to test:</p>\n<div class=\"codehilite\" data-code-language=\"C\"><pre><span></span><code><span class=\"cp\">#include</span> <span class=\"cpf\">&lt;dirent.h&gt;</span><span class=\"cp\"></span>\n<span class=\"cp\">#include</span> <span class=\"cpf\">&lt;stdio.h&gt;</span><span class=\"cp\"></span>\n<span class=\"cp\">#include</span> <span class=\"cpf\">&lt;errno.h&gt;</span><span class=\"cp\"></span>\n\n<span class=\"kt\">int</span> <span class=\"nf\">main</span><span class=\"p\">(</span><span class=\"kt\">int</span> <span class=\"n\">argc</span><span class=\"p\">,</span> <span class=\"kt\">char</span> <span class=\"o\">**</span><span class=\"n\">argv</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n  <span class=\"kt\">DIR</span> <span class=\"o\">*</span><span class=\"n\">d</span><span class=\"p\">;</span>\n\n  <span class=\"kt\">char</span> <span class=\"o\">*</span> <span class=\"n\">target</span> <span class=\"o\">=</span> <span class=\"s\">\".\"</span><span class=\"p\">;</span>\n  <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"n\">argc</span> <span class=\"o\">==</span> <span class=\"mi\">2</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n      <span class=\"n\">target</span> <span class=\"o\">=</span> <span class=\"n\">argv</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">];</span>\n  <span class=\"p\">}</span>\n  <span class=\"k\">struct</span> <span class=\"nc\">dirent</span> <span class=\"o\">*</span><span class=\"n\">dir</span><span class=\"p\">;</span>\n  <span class=\"n\">d</span> <span class=\"o\">=</span> <span class=\"n\">opendir</span><span class=\"p\">(</span><span class=\"n\">target</span><span class=\"p\">);</span>\n  <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"n\">d</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"k\">while</span> <span class=\"p\">((</span><span class=\"n\">dir</span> <span class=\"o\">=</span> <span class=\"n\">readdir</span><span class=\"p\">(</span><span class=\"n\">d</span><span class=\"p\">))</span> <span class=\"o\">!=</span> <span class=\"nb\">NULL</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n      <span class=\"n\">printf</span><span class=\"p\">(</span><span class=\"s\">\"%s</span><span class=\"se\">\\n</span><span class=\"s\">\"</span><span class=\"p\">,</span> <span class=\"n\">dir</span><span class=\"o\">-&gt;</span><span class=\"n\">d_name</span><span class=\"p\">);</span>\n    <span class=\"p\">}</span>\n\n    <span class=\"n\">printf</span><span class=\"p\">(</span><span class=\"s\">\"errno: %d</span><span class=\"se\">\\n</span><span class=\"s\">\"</span><span class=\"p\">,</span> <span class=\"n\">errno</span><span class=\"p\">);</span>\n    <span class=\"n\">closedir</span><span class=\"p\">(</span><span class=\"n\">d</span><span class=\"p\">);</span>\n  <span class=\"p\">}</span>\n\n  <span class=\"k\">return</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">);</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p>I then use this bash script to generate a directory with <code>N</code> files in</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>rm -rf testfolder\nmkdir -p testfolder\n<span class=\"k\">for</span> n in <span class=\"k\">$(</span>seq <span class=\"m\">1</span> <span class=\"si\">${</span><span class=\"nv\">1</span><span class=\"k\">:-</span><span class=\"nv\">100</span><span class=\"si\">}</span><span class=\"k\">)</span><span class=\"p\">;</span> <span class=\"k\">do</span>\n        touch testfolder/<span class=\"k\">$(</span><span class=\"nb\">printf</span> %04d <span class=\"s2\">\"</span><span class=\"nv\">$n</span><span class=\"s2\">\"</span><span class=\"k\">)</span>\n<span class=\"k\">done</span>\n</code></pre></div>\n<p>This is what happens when I run it</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>$ bash generate-files.sh <span class=\"m\">100</span>\n\n$ ls testfolder/\n<span class=\"m\">0001</span>  <span class=\"m\">0005</span>  <span class=\"m\">0009</span>  <span class=\"m\">0013</span>  <span class=\"m\">0017</span>  <span class=\"m\">0021</span>  <span class=\"m\">0025</span>  <span class=\"m\">0029</span>  <span class=\"m\">0033</span>  <span class=\"m\">0037</span>  <span class=\"m\">0041</span>  <span class=\"m\">0045</span>  <span class=\"m\">0049</span>  <span class=\"m\">0053</span>  <span class=\"m\">0057</span>  <span class=\"m\">0061</span>  <span class=\"m\">0065</span>  <span class=\"m\">0069</span>  <span class=\"m\">0073</span>  <span class=\"m\">0077</span>  <span class=\"m\">0081</span>  <span class=\"m\">0085</span>  <span class=\"m\">0089</span>  <span class=\"m\">0093</span>  <span class=\"m\">0097</span>\n<span class=\"m\">0002</span>  <span class=\"m\">0006</span>  <span class=\"m\">0010</span>  <span class=\"m\">0014</span>  <span class=\"m\">0018</span>  <span class=\"m\">0022</span>  <span class=\"m\">0026</span>  <span class=\"m\">0030</span>  <span class=\"m\">0034</span>  <span class=\"m\">0038</span>  <span class=\"m\">0042</span>  <span class=\"m\">0046</span>  <span class=\"m\">0050</span>  <span class=\"m\">0054</span>  <span class=\"m\">0058</span>  <span class=\"m\">0062</span>  <span class=\"m\">0066</span>  <span class=\"m\">0070</span>  <span class=\"m\">0074</span>  <span class=\"m\">0078</span>  <span class=\"m\">0082</span>  <span class=\"m\">0086</span>  <span class=\"m\">0090</span>  <span class=\"m\">0094</span>  <span class=\"m\">0098</span>\n<span class=\"m\">0003</span>  <span class=\"m\">0007</span>  <span class=\"m\">0011</span>  <span class=\"m\">0015</span>  <span class=\"m\">0019</span>  <span class=\"m\">0023</span>  <span class=\"m\">0027</span>  <span class=\"m\">0031</span>  <span class=\"m\">0035</span>  <span class=\"m\">0039</span>  <span class=\"m\">0043</span>  <span class=\"m\">0047</span>  <span class=\"m\">0051</span>  <span class=\"m\">0055</span>  <span class=\"m\">0059</span>  <span class=\"m\">0063</span>  <span class=\"m\">0067</span>  <span class=\"m\">0071</span>  <span class=\"m\">0075</span>  <span class=\"m\">0079</span>  <span class=\"m\">0083</span>  <span class=\"m\">0087</span>  <span class=\"m\">0091</span>  <span class=\"m\">0095</span>  <span class=\"m\">0099</span>\n<span class=\"m\">0004</span>  <span class=\"m\">0008</span>  <span class=\"m\">0012</span>  <span class=\"m\">0016</span>  <span class=\"m\">0020</span>  <span class=\"m\">0024</span>  <span class=\"m\">0028</span>  <span class=\"m\">0032</span>  <span class=\"m\">0036</span>  <span class=\"m\">0040</span>  <span class=\"m\">0044</span>  <span class=\"m\">0048</span>  <span class=\"m\">0052</span>  <span class=\"m\">0056</span>  <span class=\"m\">0060</span>  <span class=\"m\">0064</span>  <span class=\"m\">0068</span>  <span class=\"m\">0072</span>  <span class=\"m\">0076</span>  <span class=\"m\">0080</span>  <span class=\"m\">0084</span>  <span class=\"m\">0088</span>  <span class=\"m\">0092</span>  <span class=\"m\">0096</span>  <span class=\"m\">0100</span>\n\n$ wasmtime run ls.wasm --dir<span class=\"o\">=</span>./testfolder -- testfolder <span class=\"p\">|</span> wc -l\n<span class=\"m\">103</span> <span class=\"c1\"># 100 files + \".\" \"..\" and the \"errno\" print</span>\n\n$ bash generate-files.sh <span class=\"m\">200</span>\n\n$ wasmtime run ls.wasm --dir<span class=\"o\">=</span>./testfolder -- testfolder <span class=\"p\">|</span> wc -l\n<span class=\"m\">147</span> <span class=\"c1\"># lots of files missing</span>\n\n<span class=\"c1\"># for example 0012</span>\n$ wasmtime run ls.wasm --dir<span class=\"o\">=</span>./testfolder -- testfolder <span class=\"p\">|</span> grep <span class=\"m\">0012</span>\n\n$ wasmtime run ls.wasm --dir<span class=\"o\">=</span>./testfolder -- testfolder <span class=\"p\">|</span> grep <span class=\"m\">0011</span>\n<span class=\"m\">0011</span>\n</code></pre></div>\n<p>Running wasmer on the same input works as expected:</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>$ ~/.wasmer/bin/wasmer run ls.wasm --dir<span class=\"o\">=</span>./testfolder -- testfolder <span class=\"p\">|</span> wc -l\n<span class=\"m\">201</span> <span class=\"c1\"># wasmer does not return \".\" and \"..\"</span>\n\n$ ~/.wasmer/bin/wasmer run ls.wasm --dir<span class=\"o\">=</span>./testfolder -- testfolder <span class=\"p\">|</span> grep <span class=\"m\">0012</span>\n<span class=\"m\">0012</span>\n</code></pre></div>\n<h1>Expected Behavior</h1>\n<p>Calls to <code>readdir</code> returns all directory entries, even for folders with more than ~150 files.<br>\n</p>\n</blockquote>",
        "id": 219646167,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1607712776
    }
]