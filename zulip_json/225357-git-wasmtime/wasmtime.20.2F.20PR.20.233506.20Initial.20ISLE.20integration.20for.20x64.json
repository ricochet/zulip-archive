[
    {
        "content": "<p>fitzgen opened <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506\">PR #3506</a> from <code>isle</code> to <code>main</code>:</p>\n<blockquote>\n<p>This pull request introduces initial ISLE integration for the x64 backend. It is blocked on <a href=\"https://github.com/bytecodealliance/rfcs/pull/15\">https://github.com/bytecodealliance/rfcs/pull/15</a> finishing its final comment period and being accepted.</p>\n<p>I'm opening this up early since (a) I have a bunch of working code here that already ports a significant amount of the hand-written clif-to-MachInst lowering for x64, and (b) so that folks who are interested in how ISLE will work can get a chance to dig into more details and actual code rather than just slides I've presented at Cranelift meetings.</p>\n<p>I'll keep pushing to this branch/PR as I continue porting more hand-written lowering code to ISLE.</p>\n<p>Feel free to comment and give feedback or ask questions!</p>\n</blockquote>",
        "id": 260211576,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1635982077
    },
    {
        "content": "<p>sunfishcode submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#pullrequestreview-797215702\">PR review</a>.</p>",
        "id": 260214633,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1635984726
    },
    {
        "content": "<p>sunfishcode submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#pullrequestreview-797215702\">PR review</a>.</p>",
        "id": 260214634,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1635984726
    },
    {
        "content": "<p>sunfishcode created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#discussion_r742429725\">PR review comment</a>:</p>\n<blockquote>\n<p>Similarly, I'd find it clearer to have the SSE version after all the GPR versions.</p>\n</blockquote>",
        "id": 260214635,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1635984726
    },
    {
        "content": "<p>sunfishcode created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#discussion_r742425211\">PR review comment</a>:</p>\n<blockquote>\n<p>Some error implementations have more helpful messages in their debug output than in their <code>Display</code> output, so I suggest using <code>{:?}</code> instead of <code>{}</code> here.</p>\n</blockquote>",
        "id": 260214637,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1635984726
    },
    {
        "content": "<p>sunfishcode created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#discussion_r742434684\">PR review comment</a>:</p>\n<blockquote>\n<p>Should this be <code>imul</code> instead of <code>iadd</code>? And similar below.</p>\n</blockquote>",
        "id": 260214638,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1635984726
    },
    {
        "content": "<p>sunfishcode created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#discussion_r742429207\">PR review comment</a>:</p>\n<blockquote>\n<p>As a minor style suggestion, I'd find it easier to read if the <code>i64</code> and smaller code was before the <code>i128</code> code. That way, reading this top-to-bottom, I can start with the simple form, figure out what that's doing, and then look at the <code>i128</code> version and see how it differs in the obvious way.</p>\n<p>And similar for the patterns below.</p>\n</blockquote>",
        "id": 260214640,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1635984726
    },
    {
        "content": "<p>sunfishcode created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#discussion_r742427893\">PR review comment</a>:</p>\n<blockquote>\n<p>Is the <code>with_type</code> a predicate that determines whether the pattern matches? Could I suggest the name <code>has_type</code> for this?</p>\n</blockquote>",
        "id": 260214641,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1635984726
    },
    {
        "content": "<p>sunfishcode created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#discussion_r742432255\">PR review comment</a>:</p>\n<blockquote>\n<p>It's not obvious to me what this <code>&lt;ty</code> syntax means.</p>\n</blockquote>",
        "id": 260214642,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1635984726
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#pullrequestreview-797266871\">PR review</a>.</p>",
        "id": 260219279,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1635989532
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#discussion_r742469362\">PR review comment</a>:</p>\n<blockquote>\n<p>This is an \"in-arg\" to the left-hand-side extractor; the basic idea is that while the arg-positions of left-hand-side patterns are mostly \"outputs\" of whatever the matcher is doing (the inverse of a function application on the RHS), some matcher implementations will want an <em>input</em> (in addition to the thing they're matching on) to configure how they match. So here I think <code>simm32_from_value</code> is a pattern-matcher that is parameterized on a type.</p>\n<p>(If one were doing this in e.g. Prolog it'd be just another argument, and dataflow could flow either way during unification. Here we have \"argument polarity\" instead, which one can think of as an approximation of this...)</p>\n<p>I did mostly intend this to be a low-level feature that we could use to define other sorts of extractors/matchers... </p>\n<p>@fitzgen: I wonder if there's a way to better write this? It looks like the <code>ty</code> in-arg eventually gets down to <code>to_simm32</code> <a href=\"https://github.com/fitzgen/wasmtime/blob/435df0f9d2191d050e29a93a01df1517e4edfceb/cranelift/codegen/src/isa/x64/lower/isle.rs#L413\">here</a> which just checks if <code>ty</code> is less than 64 bits, and skips an \"is sign extendable\" check if so; but it looks like this may actually be unnecessary (I don't fully remember the semantics of simm32 values on 32 vs 64 bit instructions though)? Or could we just split out the 8/16/32 and 64 bit cases (one of the advantages of just having a list of patterns even!)?</p>\n</blockquote>",
        "id": 260219280,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1635989532
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#discussion_r742470005\">PR review comment</a>:</p>\n<blockquote>\n<p>Alternately, we propagate arg polarity to the parser and parse in-args as expressions without the <code>&lt;</code>, but then that makes this a type-dependent parse (a la C++) which is kind of not great. We could do it though if we require decls to come before uses of terms...</p>\n</blockquote>",
        "id": 260219396,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1635989660
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#pullrequestreview-797267651\">PR review</a>.</p>",
        "id": 260219397,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1635989660
    },
    {
        "content": "<p>bjorn3 submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#pullrequestreview-797711463\">PR review</a>.</p>",
        "id": 260266233,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636031129
    },
    {
        "content": "<p>bjorn3 created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#discussion_r742814387\">PR review comment</a>:</p>\n<blockquote>\n<p>This unconditionally writes to the source dir. <a href=\"http://Crates.io\">Crates.io</a> dependencies aren't allowed to write to their source dir. <code>cargo publish</code> checks that the source dir stays identical. If the isle file is up to date, this check will currently pass, but if in the future the source dirs are made readonly, this will break.</p>\n</blockquote>",
        "id": 260266234,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636031129
    },
    {
        "content": "<p>bjorn3 submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#pullrequestreview-797714165\">PR review</a>.</p>",
        "id": 260266589,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636031282
    },
    {
        "content": "<p>bjorn3 created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#discussion_r742816228\">PR review comment</a>:</p>\n<blockquote>\n<p>Maybe write it to <code>OUT_DIR</code> too and let ISLE read it from there?</p>\n</blockquote>",
        "id": 260266599,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636031283
    },
    {
        "content": "<p>bjorn3 submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#pullrequestreview-797720495\">PR review</a>.</p>",
        "id": 260267236,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636031619
    },
    {
        "content": "<p>bjorn3 created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#discussion_r742820759\">PR review comment</a>:</p>\n<blockquote>\n<p>The pre-regalloc printing now doesn't make sense anymore. After regalloc it will hide invariant violations.</p>\n</blockquote>",
        "id": 260267237,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636031619
    },
    {
        "content": "<p>bjorn3 submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#pullrequestreview-797722214\">PR review</a>.</p>",
        "id": 260267417,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636031711
    },
    {
        "content": "<p>bjorn3 created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#discussion_r742822012\">PR review comment</a>:</p>\n<blockquote>\n<p>This is unconditionally using isle, right? This shouldn't be merged without benchmarking first.</p>\n</blockquote>",
        "id": 260267418,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636031712
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#pullrequestreview-798034921\">PR review</a>.</p>",
        "id": 260303610,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636045861
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#discussion_r743045020\">PR review comment</a>:</p>\n<blockquote>\n<p>I wonder if the checked-in-generated-code approach could be done as follows: (i) provide a shell-script that regenerates all relevant source; (ii) in CI, fail if generated source is not up-to-date; (iii) do nothing in <a href=\"http://build.rs\">build.rs</a>, to avoid surprising side-effects in the source tree.</p>\n<p>This seems to be the simplest and fastest option, and keeps to the general principle that the source tree is human-managed and not edited by tools except by explicit invocation of a command. It does however require a manual <code>./update-isle.sh &amp;&amp; cargo build</code> when iterating on the rules. Maybe a way to avoid a footgun here is to error in <code>build.rs</code> if the generated source is out of data. We could do <em>that</em> without putting <code>islec</code> in the build deps by recording a hash of the ISLE source alongside generated code, and checking against that hash in <a href=\"http://build.rs\">build.rs</a>. Thoughts?</p>\n</blockquote>",
        "id": 260303611,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636045862
    },
    {
        "content": "<p>cfallin edited <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#discussion_r743045020\">PR review comment</a>.</p>",
        "id": 260303717,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636045908
    },
    {
        "content": "<p>fitzgen submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#pullrequestreview-798098759\">PR review</a>.</p>",
        "id": 260311649,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636049432
    },
    {
        "content": "<p>fitzgen created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#discussion_r743089766\">PR review comment</a>:</p>\n<blockquote>\n<blockquote>\n<p>Is the <code>with_type</code> a predicate that determines whether the pattern matches?</p>\n</blockquote>\n<p>Yep</p>\n<blockquote>\n<p>Could I suggest the name <code>has_type</code> for this?</p>\n</blockquote>\n<p>Nice, its even a character shorter</p>\n</blockquote>",
        "id": 260311651,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636049433
    },
    {
        "content": "<p>fitzgen submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#pullrequestreview-798110310\">PR review</a>.</p>",
        "id": 260313329,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636050178
    },
    {
        "content": "<p>sunfishcode submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#pullrequestreview-798110311\">PR review</a>.</p>",
        "id": 260313330,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636050178
    },
    {
        "content": "<p>fitzgen created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#discussion_r743098296\">PR review comment</a>:</p>\n<blockquote>\n<blockquote>\n<p>Or could we just split out the 8/16/32 and 64 bit cases (one of the advantages of just having a list of patterns even!)?</p>\n</blockquote>\n<p>What's nice about having polymorphic rules instead of a separate rule for each of <code>i{8,16,32,64}</code> is that they actually end up as a single branch in the trie/generated code, instead of four different branches.</p>\n<blockquote>\n<p>I wonder if there's a way to better write this? It looks like the <code>ty</code> in-arg eventually gets down to <code>to_simm32</code> <a href=\"https://github.com/fitzgen/wasmtime/blob/435df0f9d2191d050e29a93a01df1517e4edfceb/cranelift/codegen/src/isa/x64/lower/isle.rs#L413\">here</a> which just checks if <code>ty</code> is less than 64 bits, and skips an \"is sign extendable\" check if so; but it looks like this may actually be unnecessary</p>\n</blockquote>\n<p>Yeah I think we could just always do the \"is sign extendable\" check and it would be equivalent.</p>\n</blockquote>",
        "id": 260313331,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636050179
    },
    {
        "content": "<p>sunfishcode created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#discussion_r743098297\">PR review comment</a>:</p>\n<blockquote>\n<p>Ah, I see. Fwiw, I'd find <code>=ty</code> more intuitive syntax for this than <code>&lt;ty</code>.</p>\n</blockquote>",
        "id": 260313333,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636050179
    },
    {
        "content": "<p>fitzgen created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#discussion_r743101868\">PR review comment</a>:</p>\n<blockquote>\n<p>Whoops, good catch!</p>\n</blockquote>",
        "id": 260314168,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636050485
    },
    {
        "content": "<p>fitzgen submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#pullrequestreview-798115093\">PR review</a>.</p>",
        "id": 260314169,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636050485
    },
    {
        "content": "<p>fitzgen submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#pullrequestreview-798121251\">PR review</a>.</p>",
        "id": 260315011,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636050880
    },
    {
        "content": "<p>fitzgen created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#discussion_r743106383\">PR review comment</a>:</p>\n<blockquote>\n<p>I plan to add a CI check for whether the ISLE code is up-to-date, will implement that soon.</p>\n<p>I think it would be easier to add a <code>rebuild-isle</code> feature to <code>cranelift-codegen-meta</code> than to do all of that with the hashing and everything.</p>\n</blockquote>",
        "id": 260315013,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636050880
    },
    {
        "content": "<p>fitzgen submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#pullrequestreview-798122208\">PR review</a>.</p>",
        "id": 260315106,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636050936
    },
    {
        "content": "<p>fitzgen created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#discussion_r743107046\">PR review comment</a>:</p>\n<blockquote>\n<p>Yes, expanding formatting is something to do eventually, but I don't think it needs to block this PR.</p>\n</blockquote>",
        "id": 260315107,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636050936
    },
    {
        "content": "<p>fitzgen submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#pullrequestreview-798122479\">PR review</a>.</p>",
        "id": 260315122,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636050944
    },
    {
        "content": "<p>fitzgen created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#discussion_r743107125\">PR review comment</a>:</p>\n<blockquote>\n<p>Yes, that's the plan.</p>\n</blockquote>",
        "id": 260315123,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636050944
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#pullrequestreview-798137069\">PR review</a>.</p>",
        "id": 260316287,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636051497
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#discussion_r743113351\">PR review comment</a>:</p>\n<blockquote>\n<p>I think, at least the way I'm imagining it, the rebuild (<code>rebuild-isle</code> feature sounds good, I guess that's an implementation strategy for an <code>update-isle.sh</code> or moral equivalent?) and the local-development-loop check (using hashing or something else) are orthogonal.</p>\n<p>Basically, (i) the rebuild is an explicit action that the user invokes in order to update the in-tree generated source, and (ii) hashing and checking in <code>build.rs</code> is one strategy of ensuring that a local build doesn't succeed unless the user does this explicit update.</p>\n<p>My thinking comes from two principles -- first, that we shouldn't have a setup where an edit to a <code>.isle</code> file is ignored during a rebuild if one forgets to do a manual step (otherwise, we're bound to waste time debugging why a change didn't make a difference...) and second, that it's kind of an anti-pattern to have a build step that <em>automatically</em> updates a file in <code>src/</code>, without the user asking for it. So from those two principles, we have that (i) there should be a separate update step, and (ii) we should check that it was done.</p>\n<p>Possibly those aren't principles that we want, but they seem to me to be a reasonable starting place; thoughts?</p>\n</blockquote>",
        "id": 260316288,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636051497
    },
    {
        "content": "<p>fitzgen updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506\">PR #3506</a> from <code>isle</code> to <code>main</code>.</p>",
        "id": 260316761,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636051719
    },
    {
        "content": "<p>bjorn3 submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#pullrequestreview-797723914\">PR review</a>.</p>",
        "id": 260317356,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636051979
    },
    {
        "content": "<p>bjorn3 created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#discussion_r742823265\">PR review comment</a>:</p>\n<blockquote>\n<p>Can these be inlined into the generated code? That should reduce compile times and improve debug mode performance. (The latter is important for cg_clif as CI compiles rustc using cg_clif and then builds a sysroot using it as test.)</p>\n</blockquote>",
        "id": 260317357,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636051979
    },
    {
        "content": "<p>bjorn3 submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#pullrequestreview-797723914\">PR review</a>.</p>",
        "id": 260317358,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636051979
    },
    {
        "content": "<p>bjorn3 created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#discussion_r742834749\">PR review comment</a>:</p>\n<blockquote>\n<p>This is a codegen regression, right?</p>\n</blockquote>",
        "id": 260317359,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636051979
    },
    {
        "content": "<p>bjorn3 created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#discussion_r742830658\">PR review comment</a>:</p>\n<blockquote>\n<p>There is a lot of inefficiencies in the generated code. While an optimizer can fix it, this only happens in release mode and increases build time.</p>\n</blockquote>",
        "id": 260317360,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636051979
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#pullrequestreview-798148854\">PR review</a>.</p>",
        "id": 260318030,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636052271
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#discussion_r743121975\">PR review comment</a>:</p>\n<blockquote>\n<p>That would be a major rearchitecting of the ISLE DSL compiler -- it would require us to carry around Rust code as strings and inject it, and have a general language feature for this, which IMHO at least is a thing we want to avoid.</p>\n<p>The basic idea of the integration between DSL code and Rust code is that we're able to define helpers like these, and then call them; blending the boundary further is I think a recipe (as it were) for complexity and pain...</p>\n</blockquote>",
        "id": 260318032,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636052272
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#pullrequestreview-798151102\">PR review</a>.</p>",
        "id": 260318432,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636052407
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#discussion_r743123534\">PR review comment</a>:</p>\n<blockquote>\n<p>It's true that the DSL compiler has a simple emission strategy, but I don't think this sort of thing specifically actually results in worse code. Basically we are taking a compound expression and pulling it apart into separate let-bindings; afaik the MIR from this should be identical.</p>\n</blockquote>",
        "id": 260318433,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636052408
    },
    {
        "content": "<p>fitzgen submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#pullrequestreview-798152969\">PR review</a>.</p>",
        "id": 260318726,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636052516
    },
    {
        "content": "<p>fitzgen created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#discussion_r743124841\">PR review comment</a>:</p>\n<blockquote>\n<p><code>=variable</code> is already used for unifying two variables, eg</p>\n<p><div class=\"codehilite\" data-code-language=\"Common Lisp\"><pre><span></span><code><span class=\"p\">(</span><span class=\"nv\">rule</span> <span class=\"p\">(</span><span class=\"nv\">has_type</span> <span class=\"nv\">ty</span> <span class=\"p\">(</span><span class=\"nv\">ixor</span> <span class=\"nv\">x</span> <span class=\"nv\">=x</span><span class=\"p\">))</span>\n    <span class=\"p\">(</span><span class=\"nv\">imm</span> <span class=\"nv\">ty</span> <span class=\"mi\">0</span><span class=\"p\">))</span>\n</code></pre></div><br>\n</p>\n</blockquote>",
        "id": 260318727,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636052516
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#discussion_r743127783\">PR review comment</a>:</p>\n<blockquote>\n<p>As a higher-level point, while I definitely understand the request, I don't think that \"optimize for performance when the inliner doesn't inline anything\" is a reasonable principle from a broader point of view: it is basically saying that we cannot use abstraction or helper functions, because the toolchain might have a bad worst-case behavior. IMHO it's reasonable to assume we can write single-line helpers, and sacrificing expressivity (even basic principles like extracting helper functions) in order to speed up the software in a debug build seems like a poor tradeoff, and one that is better fixed by finding ways to build software in fast-but-lightly-optimized ways (which is, incidentally, what <code>cg_clif</code> is meant to solve if I'm not mistaken!).</p>\n</blockquote>",
        "id": 260319403,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636052795
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#pullrequestreview-798157471\">PR review</a>.</p>",
        "id": 260319404,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636052795
    },
    {
        "content": "<p>fitzgen submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#pullrequestreview-798158275\">PR review</a>.</p>",
        "id": 260319488,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636052847
    },
    {
        "content": "<p>fitzgen created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#discussion_r743128367\">PR review comment</a>:</p>\n<blockquote>\n<p>I don't think so: these used to be the <code>mov $$0, %reg</code>s in the branches and correctly get turned into <code>xor %reg, %reg</code> now.</p>\n</blockquote>",
        "id": 260319489,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636052847
    },
    {
        "content": "<p>fitzgen edited <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#discussion_r743128367\">PR review comment</a>.</p>",
        "id": 260319540,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636052875
    },
    {
        "content": "<p>fitzgen edited <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#discussion_r743128367\">PR review comment</a>.</p>",
        "id": 260319610,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636052895
    },
    {
        "content": "<p>fitzgen submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#pullrequestreview-798160373\">PR review</a>.</p>",
        "id": 260319746,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636052988
    },
    {
        "content": "<p>fitzgen created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#discussion_r743129842\">PR review comment</a>:</p>\n<blockquote>\n<blockquote>\n<p>I don't think that \"optimize for performance when the inliner doesn't inline anything\" is a reasonable principle</p>\n</blockquote>\n<p>Strong agree</p>\n</blockquote>",
        "id": 260319747,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636052989
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#pullrequestreview-798160425\">PR review</a>.</p>",
        "id": 260319749,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636052990
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#discussion_r743129875\">PR review comment</a>:</p>\n<blockquote>\n<p>@fitzgen since we're hoping it will mostly be a lower-level thing that we build on top of, we could make the syntax more explicit, maybe: what do you think about something like <code>(eval ...)</code> or <code>(matcher-input ...)</code>?</p>\n<p>(Basically, I too would be happy to see <code>&lt;ty</code> die; it was literally just the first punctuation character I thought of and I wish I had chosen something better initially!)</p>\n</blockquote>",
        "id": 260319751,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636052990
    },
    {
        "content": "<p>fitzgen updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506\">PR #3506</a> from <code>isle</code> to <code>main</code>.</p>",
        "id": 260319843,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636053038
    },
    {
        "content": "<p>bjorn3 submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#pullrequestreview-798162591\">PR review</a>.</p>",
        "id": 260320015,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636053129
    },
    {
        "content": "<p>bjorn3 created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#discussion_r743131379\">PR review comment</a>:</p>\n<blockquote>\n<p>MIR doesn't do copy propagation. Every assignment results in a copy at MIR level.</p>\n<p>Current code: <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2021&amp;gist=8cf97ba023221ffafccb62ab89231fab\">https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2021&amp;gist=8cf97ba023221ffafccb62ab89231fab</a></p>\n<p>Excerpt:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"w\">    </span><span class=\"n\">bb0</span>: <span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"n\">_5</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">move</span><span class=\"w\"> </span><span class=\"n\">_2</span><span class=\"p\">;</span><span class=\"w\">                    </span><span class=\"c1\">// scope 0 at src/lib.rs:21:22: 21:26</span>\n<span class=\"w\">        </span><span class=\"n\">_6</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">move</span><span class=\"w\"> </span><span class=\"n\">_3</span><span class=\"p\">;</span><span class=\"w\">                    </span><span class=\"c1\">// scope 1 at src/lib.rs:22:22: 22:26</span>\n<span class=\"w\">        </span><span class=\"n\">_7</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">_4</span><span class=\"p\">;</span><span class=\"w\">                         </span><span class=\"c1\">// scope 2 at src/lib.rs:23:22: 23:26</span>\n<span class=\"w\">        </span><span class=\"n\">discriminant</span><span class=\"p\">(</span><span class=\"n\">_8</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"w\">            </span><span class=\"c1\">// scope 3 at src/lib.rs:25:19: 25:50</span>\n<span class=\"w\">        </span><span class=\"n\">_12</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"k\">mut</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"n\">_1</span><span class=\"p\">);</span><span class=\"w\">                </span><span class=\"c1\">// scope 4 at src/lib.rs:26:39: 26:42</span>\n<span class=\"w\">        </span><span class=\"n\">_13</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">move</span><span class=\"w\"> </span><span class=\"n\">_5</span><span class=\"p\">;</span><span class=\"w\">                   </span><span class=\"c1\">// scope 4 at src/lib.rs:26:44: 26:54</span>\n<span class=\"w\">        </span><span class=\"n\">_15</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">_8</span><span class=\"p\">;</span><span class=\"w\">                       </span><span class=\"c1\">// scope 4 at src/lib.rs:26:56: 26:64</span>\n<span class=\"w\">        </span><span class=\"n\">_14</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">_15</span><span class=\"p\">;</span><span class=\"w\">                       </span><span class=\"c1\">// scope 4 at src/lib.rs:26:56: 26:64</span>\n<span class=\"w\">        </span><span class=\"n\">_16</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">move</span><span class=\"w\"> </span><span class=\"n\">_6</span><span class=\"p\">;</span><span class=\"w\">                   </span><span class=\"c1\">// scope 4 at src/lib.rs:26:66: 26:76</span>\n<span class=\"w\">        </span><span class=\"n\">_17</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">_7</span><span class=\"p\">;</span><span class=\"w\">                        </span><span class=\"c1\">// scope 4 at src/lib.rs:26:78: 26:88</span>\n<span class=\"w\">        </span><span class=\"n\">_11</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">constructor_shift_r</span>::<span class=\"o\">&lt;</span><span class=\"n\">C</span><span class=\"o\">&gt;</span><span class=\"p\">(</span><span class=\"k\">move</span><span class=\"w\"> </span><span class=\"n\">_12</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"k\">move</span><span class=\"w\"> </span><span class=\"n\">_13</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"k\">move</span><span class=\"w\"> </span><span class=\"n\">_14</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"k\">move</span><span class=\"w\"> </span><span class=\"n\">_16</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"k\">move</span><span class=\"w\"> </span><span class=\"n\">_17</span><span class=\"p\">)</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">bb1</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"c1\">// scope 4 at src/lib.rs:26:19: 26:89</span>\n<span class=\"w\">                                         </span><span class=\"c1\">// mir::Constant</span>\n<span class=\"w\">                                         </span><span class=\"c1\">// + span: src/lib.rs:26:19: 26:38</span>\n<span class=\"w\">                                         </span><span class=\"c1\">// + literal: Const { ty: for&lt;'r, 's, 't0&gt; fn(&amp;'r mut C, Type, &amp;'s ShiftKind, Reg, &amp;'t0 Imm8Reg) -&gt; std::option::Option&lt;Reg&gt; {constructor_shift_r::&lt;C&gt;}, val: Value(Scalar(&lt;ZST&gt;)) }</span>\n<span class=\"w\">    </span><span class=\"p\">}</span><span class=\"w\"></span>\n</code></pre></div>\n<p>With copies eliminated: <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2021&amp;gist=61312e466966b68bd721e61f98cc62e3\">https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2021&amp;gist=61312e466966b68bd721e61f98cc62e3</a></p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"w\">    </span><span class=\"n\">bb0</span>: <span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"n\">_8</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"k\">mut</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"n\">_1</span><span class=\"p\">);</span><span class=\"w\">                 </span><span class=\"c1\">// scope 0 at src/lib.rs:21:39: 21:42</span>\n<span class=\"w\">        </span><span class=\"n\">_9</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">move</span><span class=\"w\"> </span><span class=\"n\">_2</span><span class=\"p\">;</span><span class=\"w\">                    </span><span class=\"c1\">// scope 0 at src/lib.rs:21:44: 21:48</span>\n<span class=\"w\">        </span><span class=\"n\">_19</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">constructor_sar</span>::<span class=\"o\">&lt;</span><span class=\"n\">C</span><span class=\"o\">&gt;</span>::<span class=\"n\">promoted</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">];</span><span class=\"w\"> </span><span class=\"c1\">// scope 0 at src/lib.rs:21:50: 21:82</span>\n<span class=\"w\">        </span><span class=\"n\">_11</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">_19</span><span class=\"p\">;</span><span class=\"w\">                       </span><span class=\"c1\">// scope 0 at src/lib.rs:21:50: 21:82</span>\n<span class=\"w\">        </span><span class=\"n\">_10</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">_11</span><span class=\"p\">;</span><span class=\"w\">                       </span><span class=\"c1\">// scope 0 at src/lib.rs:21:50: 21:82</span>\n<span class=\"w\">        </span><span class=\"n\">_12</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">move</span><span class=\"w\"> </span><span class=\"n\">_3</span><span class=\"p\">;</span><span class=\"w\">                   </span><span class=\"c1\">// scope 0 at src/lib.rs:21:84: 21:88</span>\n<span class=\"w\">        </span><span class=\"n\">_13</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">_4</span><span class=\"p\">;</span><span class=\"w\">                        </span><span class=\"c1\">// scope 0 at src/lib.rs:21:90: 21:94</span>\n<span class=\"w\">        </span><span class=\"n\">_7</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">constructor_shift_r</span>::<span class=\"o\">&lt;</span><span class=\"n\">C</span><span class=\"o\">&gt;</span><span class=\"p\">(</span><span class=\"k\">move</span><span class=\"w\"> </span><span class=\"n\">_8</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"k\">move</span><span class=\"w\"> </span><span class=\"n\">_9</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"k\">move</span><span class=\"w\"> </span><span class=\"n\">_10</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"k\">move</span><span class=\"w\"> </span><span class=\"n\">_12</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"k\">move</span><span class=\"w\"> </span><span class=\"n\">_13</span><span class=\"p\">)</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">bb1</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"c1\">// scope 0 at src/lib.rs:21:19: 21:95</span>\n<span class=\"w\">                                         </span><span class=\"c1\">// mir::Constant</span>\n<span class=\"w\">                                         </span><span class=\"c1\">// + span: src/lib.rs:21:19: 21:38</span>\n<span class=\"w\">                                         </span><span class=\"c1\">// + literal: Const { ty: for&lt;'r, 's, 't0&gt; fn(&amp;'r mut C, Type, &amp;'s ShiftKind, Reg, &amp;'t0 Imm8Reg) -&gt; std::option::Option&lt;Reg&gt; {constructor_shift_r::&lt;C&gt;}, val: Value(Scalar(&lt;ZST&gt;)) }</span>\n<span class=\"w\">    </span><span class=\"p\">}</span><span class=\"w\"></span>\n</code></pre></div>\n<p>Something that would probably help a lot more though is avoiding <code>?</code> and instead using <code>match</code>. <code>?</code> desugars into several function calls:</p>\n<p><div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"w\">    </span><span class=\"n\">bb1</span>: <span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"n\">_7</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"nb\">Option</span><span class=\"o\">&lt;</span><span class=\"n\">Reg</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">Try</span><span class=\"o\">&gt;</span>::<span class=\"n\">branch</span><span class=\"p\">(</span><span class=\"k\">move</span><span class=\"w\"> </span><span class=\"n\">_8</span><span class=\"p\">)</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">bb2</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"c1\">// scope 1 at src/lib.rs:22:19: 22:68</span>\n<span class=\"w\">                                         </span><span class=\"c1\">// mir::Constant</span>\n<span class=\"w\">                                         </span><span class=\"c1\">// + span: src/lib.rs:22:19: 22:68</span>\n<span class=\"w\">                                         </span><span class=\"c1\">// + literal: Const { ty: fn(std::option::Option&lt;Reg&gt;) -&gt; std::ops::ControlFlow&lt;&lt;std::option::Option&lt;Reg&gt; as std::ops::Try&gt;::Residual, &lt;std::option::Option&lt;Reg&gt; as std::ops::Try&gt;::Output&gt; {&lt;std::option::Option&lt;Reg&gt; as std::ops::Try&gt;::branch}, val: Value(Scalar(&lt;ZST&gt;)) }</span>\n<span class=\"w\">    </span><span class=\"p\">}</span><span class=\"w\"></span>\n\n<span class=\"w\">    </span><span class=\"n\">bb2</span>: <span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"n\">_15</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">discriminant</span><span class=\"p\">(</span><span class=\"n\">_7</span><span class=\"p\">);</span><span class=\"w\">          </span><span class=\"c1\">// scope 1 at src/lib.rs:22:19: 22:68</span>\n<span class=\"w\">        </span><span class=\"n\">switchInt</span><span class=\"p\">(</span><span class=\"k\">move</span><span class=\"w\"> </span><span class=\"n\">_15</span><span class=\"p\">)</span><span class=\"w\"> </span>-&gt; <span class=\"p\">[</span><span class=\"mi\">0_</span><span class=\"k\">isize</span>: <span class=\"nc\">bb3</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">1_</span><span class=\"k\">isize</span>: <span class=\"nc\">bb5</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">otherwise</span>: <span class=\"nc\">bb4</span><span class=\"p\">];</span><span class=\"w\"> </span><span class=\"c1\">// scope 1 at src/lib.rs:22:19: 22:68</span>\n<span class=\"w\">    </span><span class=\"p\">}</span><span class=\"w\"></span>\n\n<span class=\"w\">    </span><span class=\"n\">bb3</span>: <span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"n\">_18</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">move</span><span class=\"w\"> </span><span class=\"p\">((</span><span class=\"n\">_7</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">Continue</span><span class=\"p\">).</span><span class=\"mi\">0</span>: <span class=\"nc\">Reg</span><span class=\"p\">);</span><span class=\"w\"> </span><span class=\"c1\">// scope 1 at src/lib.rs:22:19: 22:68</span>\n<span class=\"w\">        </span><span class=\"n\">_6</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">move</span><span class=\"w\"> </span><span class=\"n\">_18</span><span class=\"p\">;</span><span class=\"w\">                   </span><span class=\"c1\">// scope 6 at src/lib.rs:22:19: 22:68</span>\n<span class=\"w\">        </span><span class=\"n\">_19</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">move</span><span class=\"w\"> </span><span class=\"n\">_6</span><span class=\"p\">;</span><span class=\"w\">                   </span><span class=\"c1\">// scope 2 at src/lib.rs:23:17: 23:24</span>\n<span class=\"w\">        </span><span class=\"p\">((</span><span class=\"n\">_0</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"nb\">Some</span><span class=\"p\">).</span><span class=\"mi\">0</span>: <span class=\"nc\">Reg</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">move</span><span class=\"w\"> </span><span class=\"n\">_19</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"c1\">// scope 2 at src/lib.rs:23:12: 23:25</span>\n<span class=\"w\">        </span><span class=\"n\">discriminant</span><span class=\"p\">(</span><span class=\"n\">_0</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">;</span><span class=\"w\">            </span><span class=\"c1\">// scope 2 at src/lib.rs:23:12: 23:25</span>\n<span class=\"w\">        </span><span class=\"n\">goto</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">bb6</span><span class=\"p\">;</span><span class=\"w\">                     </span><span class=\"c1\">// scope 2 at src/lib.rs:23:5: 23:25</span>\n<span class=\"w\">    </span><span class=\"p\">}</span><span class=\"w\"></span>\n\n<span class=\"w\">    </span><span class=\"n\">bb4</span>: <span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"n\">unreachable</span><span class=\"p\">;</span><span class=\"w\">                     </span><span class=\"c1\">// scope 1 at src/lib.rs:22:19: 22:68</span>\n<span class=\"w\">    </span><span class=\"p\">}</span><span class=\"w\"></span>\n\n<span class=\"w\">    </span><span class=\"n\">bb5</span>: <span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"n\">_0</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"nb\">Option</span><span class=\"o\">&lt;</span><span class=\"n\">Reg</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">FromResidual</span><span class=\"o\">&lt;</span><span class=\"nb\">Option</span><span class=\"o\">&lt;</span><span class=\"n\">Infallible</span><span class=\"o\">&gt;&gt;&gt;</span>::<span class=\"n\">from_residual</span><span class=\"p\">(</span><span class=\"k\">move</span><span class=\"w\"> </span><span class=\"n\">_17</span><span class=\"p\">)</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">bb6</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"c1\">// scope 4 at src/lib.rs:22:19: 22:68</span>\n<span class=\"w\">                                         </span><span class=\"c1\">// mir::Constant</span>\n<span class=\"w\">                                         </span><span class=\"c1\">// + span: src/lib.rs:22:67: 22:68</span>\n<span class=\"w\">                                         </span><span class=\"c1\">// + literal: Const { ty: fn(std::option::Option&lt;std::convert::Infallible&gt;) -&gt; std::option::Option&lt;Reg&gt; {&lt;std::option::Option&lt;Reg&gt; as std::ops::FromResidual&lt;std::option::Option&lt;std::convert::Infallible&gt;&gt;&gt;::from_residual}, val: Value(Scalar(&lt;ZST&gt;)) }</span>\n<span class=\"w\">    </span><span class=\"p\">}</span><span class=\"w\"></span>\n\n<span class=\"w\">    </span><span class=\"n\">bb6</span>: <span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"k\">return</span><span class=\"p\">;</span><span class=\"w\">                          </span><span class=\"c1\">// scope 0 at src/lib.rs:24:2: 24:2</span>\n<span class=\"w\">    </span><span class=\"p\">}</span><span class=\"w\"></span>\n</code></pre></div><br>\n</p>\n</blockquote>",
        "id": 260320017,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636053130
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#pullrequestreview-798174496\">PR review</a>.</p>",
        "id": 260321535,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636053917
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#discussion_r743139459\">PR review comment</a>:</p>\n<blockquote>\n<p>OK, interesting. Echoing the point I made above in another thread, though, this seems to me to be more a problem that debug builds of Rust do no optimization whatsoever (and this is a problem for <em>any</em> Rust code that is written with abstractions or redundancies that optimize away), and less that our particular DSL codegen produces code that has optimizable parts.</p>\n</blockquote>",
        "id": 260321536,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636053917
    },
    {
        "content": "<p>bjorn3 submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#pullrequestreview-798178678\">PR review</a>.</p>",
        "id": 260322075,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636054204
    },
    {
        "content": "<p>bjorn3 created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#discussion_r743142390\">PR review comment</a>:</p>\n<blockquote>\n<p>Replacing <code>expr?</code> with <code>if let Some(x) = expr { x } else { return None; }</code> should be an easy change in the codegen. The other suggested changes are not worth it I guess, though they will help with improving build time.</p>\n</blockquote>",
        "id": 260322078,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636054204
    },
    {
        "content": "<p>sunfishcode submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#pullrequestreview-798187687\">PR review</a>.</p>",
        "id": 260323527,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636054837
    },
    {
        "content": "<p>sunfishcode created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#discussion_r743148901\">PR review comment</a>:</p>\n<blockquote>\n<p>I agree that this kind of thing could end up being significant, especially as we add more patterns to isle and the generated files grow. However, optimizations like these complicate the generator, and right now, keeping that code simple is particularly valuable, as the code is new and still rapidly changing. </p>\n<p>As ISLE matures, we add more patterns, and the generated files become large enough that effects like this are measurable, I expect it'll make sense to revisit this.</p>\n</blockquote>",
        "id": 260323528,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636054837
    },
    {
        "content": "<p>fitzgen submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#pullrequestreview-798211136\">PR review</a>.</p>",
        "id": 260326988,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636056430
    },
    {
        "content": "<p>fitzgen created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#discussion_r743166195\">PR review comment</a>:</p>\n<blockquote>\n<p><code>simm32</code> immediates no longer need input parameters, fwiw. They were the only use of input args to extractors in all of the lowering code.</p>\n<p>One thing I was thinking, and maybe this is wild, was to always have extractors use <code>[...]</code> and always have expressions use <code>(...)</code> but this doesn't really solve the case where a simple, non-operation expression is an input.</p>\n<p>Or maybe, since we aren't using input polarity arguments for extractors anymore, we simply don't need them and can remove them from the language?</p>\n</blockquote>",
        "id": 260326992,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636056430
    },
    {
        "content": "<p>fitzgen submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#pullrequestreview-798214141\">PR review</a>.</p>",
        "id": 260327475,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636056643
    },
    {
        "content": "<p>fitzgen created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#discussion_r743168436\">PR review comment</a>:</p>\n<blockquote>\n<blockquote>\n<p>So from those two principles, we have that (i) there should be a separate update step, and (ii) we should check that it was done.</p>\n</blockquote>\n<p>Agreed with these principals.</p>\n<p>I'm not convinced we have to do more than what this PR currently does in <em>this</em> PR though.</p>\n<p>Like I think there is a separate chunk of work that removes all of <code>cranelift-codegen-meta</code> from <code>cranelift-codegen</code>'s dependency tree and does the all things you're talking about. But for now, the ISLE integration basically does what we already do for the rest of <code>cranelift-codegen-meta</code>, and I think that is fine for landing the initial ISLE integration.</p>\n</blockquote>",
        "id": 260327476,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636056643
    },
    {
        "content": "<p>fitzgen updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506\">PR #3506</a> from <code>isle</code> to <code>main</code>.</p>",
        "id": 260329633,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636057641
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#pullrequestreview-798234327\">PR review</a>.</p>",
        "id": 260330133,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636057872
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#discussion_r743181659\">PR review comment</a>:</p>\n<blockquote>\n<p>Ah, OK, possibly I'm not understanding then -- from what I can tell in this PR, the <code>rebuild-isle</code> feature is non-default, and if I (i) do a clean git-clone, (ii) modify some ISLE source, and (iii) <code>cargo build</code>, without specifying the feature or doing anything else, my local build doesn't pick up the new ISLE changes -- is that right? Or is there some plumbing somewhere that takes care of that?</p>\n<p>This is basically the case that motivates what I had suggested above -- I think that we need a check not just in CI, but locally, that the checked-in code matches what would have been generated (but only actually overwrite if the user opts-in, with a feature or script or whatnot). To do otherwise seems to me to invite lots of confusion the first time a new contributor tries to add a lowering and wonders why it doesn't work :-)</p>\n</blockquote>",
        "id": 260330136,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636057873
    },
    {
        "content": "<p>sunfishcode submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#pullrequestreview-798237135\">PR review</a>.</p>",
        "id": 260330603,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636058071
    },
    {
        "content": "<p>sunfishcode created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#discussion_r743183667\">PR review comment</a>:</p>\n<blockquote>\n<p>It may be different in terms of what's actually going on in the DSL, however as someone just reading the code, this <code>=x</code> and the <code>&lt;ty</code> above kinda feel like they're doing the same conceptual thing. Whether it's a type or a variable, the prefix means \"don't bind a new thing here, reuse an existing binding\". So I wonder if it would work to use prefix-<code>=</code> syntax for both.</p>\n</blockquote>",
        "id": 260330604,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636058071
    },
    {
        "content": "<p>fitzgen submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#pullrequestreview-798255713\">PR review</a>.</p>",
        "id": 260333423,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636059387
    },
    {
        "content": "<p>fitzgen created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#discussion_r743197315\">PR review comment</a>:</p>\n<blockquote>\n<p>Yeah if you don't build with <code>--features rebuild-isle</code> then it won't rebuild ISLE or tell you to use that feature right now.</p>\n<p>I think this is fine for this PR (since we <strong>do</strong> check for and catch this in CI in this PR) and then in a future PR we can redo the whole paradigm for how we do meta, compiler compile time.</p>\n</blockquote>",
        "id": 260333424,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636059388
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#pullrequestreview-798262476\">PR review</a>.</p>",
        "id": 260334510,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636059868
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#discussion_r743202047\">PR review comment</a>:</p>\n<blockquote>\n<p>OK; I agree it's fine for now (first PR) but it seems like something that's likely to bite us pretty soon after, just as soon as others start to use it. I suspect it could be addressed in ~50 lines or so of code in <code>build.rs</code>, without requiring us to build the ISLE compiler in the default build, just hashing files and either reading/comparing or writing to a checked-in \"manifest\". I'm happy to do so once the initial thing merges. In the meantime could you add a TODO somewhere with a tracking issue?</p>\n<p>Thanks for the patience in working this one out!</p>\n</blockquote>",
        "id": 260334511,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636059868
    },
    {
        "content": "<p>fitzgen submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#pullrequestreview-798264543\">PR review</a>.</p>",
        "id": 260334773,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636060015
    },
    {
        "content": "<p>fitzgen created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#discussion_r743203504\">PR review comment</a>:</p>\n<blockquote>\n<p><a href=\"https://github.com/bytecodealliance/wasmtime/issues/3508\">https://github.com/bytecodealliance/wasmtime/issues/3508</a></p>\n</blockquote>",
        "id": 260334774,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636060015
    },
    {
        "content": "<p>fitzgen updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506\">PR #3506</a> from <code>isle</code> to <code>main</code>.</p>",
        "id": 260340601,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636063229
    },
    {
        "content": "<p>fitzgen updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506\">PR #3506</a> from <code>isle</code> to <code>main</code>.</p>",
        "id": 260344796,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636065800
    },
    {
        "content": "<p>fitzgen updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506\">PR #3506</a> from <code>isle</code> to <code>main</code>.</p>",
        "id": 260346452,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636066938
    },
    {
        "content": "<p>fitzgen updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506\">PR #3506</a> from <code>isle</code> to <code>main</code>.</p>",
        "id": 260346731,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636067154
    },
    {
        "content": "<p>fitzgen updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506\">PR #3506</a> from <code>isle</code> to <code>main</code>.</p>",
        "id": 260349714,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636069378
    },
    {
        "content": "<p>fitzgen updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506\">PR #3506</a> from <code>isle</code> to <code>main</code>.</p>",
        "id": 260350759,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636070274
    },
    {
        "content": "<p>bnjbvr submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#pullrequestreview-798690502\">PR review</a>.</p>",
        "id": 260385334,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636106492
    },
    {
        "content": "<p>bnjbvr created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#discussion_r743527521\">PR review comment</a>:</p>\n<blockquote>\n<p>Wouldn't there be a way to have very explicit syntax with another sub-expression or an annotation, instead of using an operator which significance has to be looked up in documentation and learned about? Ad-hoc syntax isn't self-explanatory, and as a matter of fact it is spurious extra complexity for newcomers, especially if it _can_ be avoided by using another more explicit syntax.</p>\n</blockquote>",
        "id": 260385335,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636106493
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#pullrequestreview-799060787\">PR review</a>.</p>",
        "id": 260423976,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636127664
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#discussion_r743782729\">PR review comment</a>:</p>\n<blockquote>\n<p>Agreed with @bnjbvr; I'd like to re-boost my suggestion above for <code>(matcher-input ...)</code> if we end up needing this feature still. I'm also hoping that, if it remains, we can keep its use confined to just whatever \"standard library helpers\" need it, if that, and keep it out of ordinary patterns entirely.</p>\n<p>Also agreed with @fitzgen that given that we found a way to avoid it here, maybe we can remove it; it nudges the language more toward \"general-purpose constraint solver\" (ie the Prolog direction) and less toward \"patterns of instructions\", when the latter is really the simplicity and approachability we're going for, so with whatever influence I still have on the language design, I'd like to push to undo my mistake :-)</p>\n</blockquote>",
        "id": 260423977,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636127664
    },
    {
        "content": "<p>fitzgen submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#pullrequestreview-799159516\">PR review</a>.</p>",
        "id": 260437801,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636133391
    },
    {
        "content": "<p>fitzgen created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#discussion_r743854116\">PR review comment</a>:</p>\n<blockquote>\n<p>For sure. I'm not going to deal with it right now, in this PR, but if we don't end up removing this feature from the DSL completely, we can use <code>(eval ...)</code> or <code>(matcher-input ...)</code> or something.</p>\n</blockquote>",
        "id": 260437802,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636133391
    },
    {
        "content": "<p>fitzgen updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506\">PR #3506</a> from <code>isle</code> to <code>main</code>.</p>",
        "id": 260438178,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636133567
    },
    {
        "content": "<p>bjorn3 submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#pullrequestreview-799175763\">PR review</a>.</p>",
        "id": 260439999,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636134442
    },
    {
        "content": "<p>bjorn3 created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#discussion_r743865899\">PR review comment</a>:</p>\n<blockquote>\n<p>Should it be versioned together with cranelift?</p>\n</blockquote>",
        "id": 260440000,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636134443
    },
    {
        "content": "<p>fitzgen updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506\">PR #3506</a> from <code>isle</code> to <code>main</code>.</p>",
        "id": 260462523,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636145194
    },
    {
        "content": "<p>fitzgen updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506\">PR #3506</a> from <code>isle</code> to <code>main</code>.</p>",
        "id": 260464887,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636146440
    },
    {
        "content": "<p>fitzgen updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506\">PR #3506</a> from <code>isle</code> to <code>main</code>.</p>",
        "id": 260475109,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636153517
    },
    {
        "content": "<p>fitzgen updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506\">PR #3506</a> from <code>isle</code> to <code>main</code>.</p>",
        "id": 260720646,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636406510
    },
    {
        "content": "<p>fitzgen updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506\">PR #3506</a> from <code>isle</code> to <code>main</code>.</p>",
        "id": 261164082,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636652428
    },
    {
        "content": "<p>fitzgen updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506\">PR #3506</a> from <code>isle</code> to <code>main</code>.</p>",
        "id": 261195261,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636672796
    },
    {
        "content": "<p>fitzgen updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506\">PR #3506</a> from <code>isle</code> to <code>main</code>.</p>",
        "id": 261529756,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636997111
    },
    {
        "content": "<p>fitzgen updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506\">PR #3506</a> from <code>isle</code> to <code>main</code>.</p>",
        "id": 261529864,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636997150
    },
    {
        "content": "<p><strong>fitzgen</strong> has marked <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506\">PR #3506</a> as ready for review.</p>",
        "id": 261530883,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636997521
    },
    {
        "content": "<p>alexcrichton submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#pullrequestreview-806331856\">PR review</a>.</p>",
        "id": 261534262,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636998824
    },
    {
        "content": "<p>alexcrichton submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#pullrequestreview-806331856\">PR review</a>.</p>",
        "id": 261534263,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636998824
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#discussion_r749519866\">PR review comment</a>:</p>\n<blockquote>\n<p>Is this step still necesary now that rustfmt is baked in?</p>\n</blockquote>",
        "id": 261534264,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636998824
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#discussion_r749522404\">PR review comment</a>:</p>\n<blockquote>\n<p>I was poking around with a lowering that used this locally, and I think that this may not have been listed in the right order? I think that <code>Idx</code> should come after the <code>value_array_2</code>, right?</p>\n</blockquote>",
        "id": 261534266,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636998824
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#discussion_r749520485\">PR review comment</a>:</p>\n<blockquote>\n<p>FWIW I don't think this will run on oss-fuzz unless it's in the top-level directory by default (but we could modify oss-fuzz to build here too if desired)</p>\n</blockquote>",
        "id": 261534267,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636998824
    },
    {
        "content": "<p>alexcrichton created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#discussion_r749523135\">PR review comment</a>:</p>\n<blockquote>\n<p>I ended up having this -- <a href=\"https://github.com/alexcrichton/wasmtime/commit/d0f2bf4c140730566d00319def57fa1bdbc27269\">https://github.com/alexcrichton/wasmtime/commit/d0f2bf4c140730566d00319def57fa1bdbc27269</a> -- to get matchers on <code>insertlane</code> working (although I'm not 100% sure it was correct)</p>\n</blockquote>",
        "id": 261534268,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636998824
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#pullrequestreview-806362741\">PR review</a>.</p>",
        "id": 261536932,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636999879
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#pullrequestreview-806362741\">PR review</a>.</p>",
        "id": 261536935,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636999879
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#discussion_r749546408\">PR review comment</a>:</p>\n<blockquote>\n<p>Just a small thing, but unconditionally emitting terminal control codes without tty detection is kind of unfortunate; e.g. sometimes I pipe compiler output to a file or page through it with <code>less</code>. Also someone who is <em>actually</em> using a Braille screenreader would be broken by this option. Can we make this opt-in via an environment variable or Cargo feature?</p>\n</blockquote>",
        "id": 261536936,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636999879
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#discussion_r749551865\">PR review comment</a>:</p>\n<blockquote>\n<p>Idle thought: it might make sense to namespace the x86 MachInst constructors all to <code>(x86_rotl ...)</code>, <code>(x86_add ...)</code>, etc. -- then it's clear that we're lowering into a MachInst and not into some other intermediate form. If we did this it wouldn't have to be with <em>this</em> PR but we'd want to do it soon to avoid more find/replace pain later. Thoughts?</p>\n</blockquote>",
        "id": 261536937,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636999879
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#discussion_r749565082\">PR review comment</a>:</p>\n<blockquote>\n<p>This can change to the Wasmtime repository now I think?</p>\n</blockquote>",
        "id": 261536938,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636999879
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#discussion_r749542249\">PR review comment</a>:</p>\n<blockquote>\n<p>That's not a bad idea; @fitzgen can we call this \"isle 0.78.0\" along with Cranelift? We should make sure the version-bumping logic in <code>publish.rs</code> updates the isle/islec crates as well.</p>\n</blockquote>",
        "id": 261536939,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636999879
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#discussion_r749561625\">PR review comment</a>:</p>\n<blockquote>\n<p>Is this file leftover from an earlier generated-code setup? I don't see where it's generated or used (but possibly I'm missing something)... and <code>src/clif.isle</code> is also used to generate the x64-specific lowering code so I don't think we need this separate machine-independent one?</p>\n</blockquote>",
        "id": 261536940,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1636999880
    },
    {
        "content": "<p>fitzgen submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#pullrequestreview-806450607\">PR review</a>.</p>",
        "id": 261544315,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1637003410
    },
    {
        "content": "<p>fitzgen created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#discussion_r749607809\">PR review comment</a>:</p>\n<blockquote>\n<p>This isn't emitting the terminal control codes, there is a separate config for colors, it is just whether we get pure-text error messages or whether it includes the source context snippets and unicode box characters. It works just fine piped to <code>less</code> or into a file.</p>\n</blockquote>",
        "id": 261544316,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1637003410
    },
    {
        "content": "<p>fitzgen submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#pullrequestreview-806452024\">PR review</a>.</p>",
        "id": 261544463,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1637003512
    },
    {
        "content": "<p>fitzgen created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#discussion_r749608860\">PR review comment</a>:</p>\n<blockquote>\n<p>I had similar thoughts of using <code>namespace:instruction</code> like <code>(clif:iadd ...)</code> and <code>(x86:add ...)</code>. Happy to bike shed in a follow up PR.</p>\n</blockquote>",
        "id": 261544465,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1637003512
    },
    {
        "content": "<p>fitzgen submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#pullrequestreview-806455014\">PR review</a>.</p>",
        "id": 261544928,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1637003720
    },
    {
        "content": "<p>fitzgen created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#discussion_r749611127\">PR review comment</a>:</p>\n<blockquote>\n<p>Whoops yeah this is unused.</p>\n</blockquote>",
        "id": 261544929,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1637003720
    },
    {
        "content": "<p>fitzgen updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506\">PR #3506</a> from <code>isle</code> to <code>main</code>.</p>",
        "id": 261544942,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1637003726
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#pullrequestreview-806455453\">PR review</a>.</p>",
        "id": 261544994,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1637003747
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#discussion_r749611469\">PR review comment</a>:</p>\n<blockquote>\n<p>Ah, OK, that's much better, sorry for misunderstanding! Maybe a comment here to the effect of \"Ensure <code>miette</code> emits source snippets, even when the output is not a tty (note there are no terminal control codes in 'graphical' output)\" or somesuch would help?</p>\n</blockquote>",
        "id": 261544995,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1637003747
    },
    {
        "content": "<p>fitzgen updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506\">PR #3506</a> from <code>isle</code> to <code>main</code>.</p>",
        "id": 261545402,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1637003911
    },
    {
        "content": "<p>fitzgen submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#pullrequestreview-806461058\">PR review</a>.</p>",
        "id": 261545905,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1637004123
    },
    {
        "content": "<p>fitzgen created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#discussion_r749615686\">PR review comment</a>:</p>\n<blockquote>\n<p>I actually don't think we should run this fuzz target in oss-fuzz. It is useful to run locally a bit for folks poking on the ISLE compiler, but the ISLE compiler doesn't need to be hardened in the same way that Wasmtime does.</p>\n</blockquote>",
        "id": 261545914,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1637004124
    },
    {
        "content": "<p>fitzgen submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#pullrequestreview-806461781\">PR review</a>.</p>",
        "id": 261546035,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1637004175
    },
    {
        "content": "<p>fitzgen created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#discussion_r749616265\">PR review comment</a>:</p>\n<blockquote>\n<p>Yes, since the <code>rustfmt</code>ing is happening on a best-effort basis, and if <code>rustfmt</code> isn't on <code>$PATH</code> it doesn't break the build.</p>\n</blockquote>",
        "id": 261546036,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1637004176
    },
    {
        "content": "<p>fitzgen created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#discussion_r749616592\">PR review comment</a>:</p>\n<blockquote>\n<p>That looks correct to me. Do you want to make a PR after this one merges?</p>\n</blockquote>",
        "id": 261546091,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1637004203
    },
    {
        "content": "<p>fitzgen submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#pullrequestreview-806462208\">PR review</a>.</p>",
        "id": 261546092,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1637004204
    },
    {
        "content": "<p>fitzgen updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506\">PR #3506</a> from <code>isle</code> to <code>main</code>.</p>",
        "id": 261546580,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1637004425
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#pullrequestreview-806468209\">PR review</a>.</p>",
        "id": 261547011,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1637004619
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#discussion_r749621210\">PR review comment</a>:</p>\n<blockquote>\n<p>Ah, actually, reading this again, I note 'unicode box characters'. I do think that making this opt-in is actually an important accessibility thing; if <code>miette</code> went to the trouble of supporting screenreaders, we should not undo that work.</p>\n</blockquote>",
        "id": 261547013,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1637004619
    },
    {
        "content": "<p>fitzgen submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#pullrequestreview-806470912\">PR review</a>.</p>",
        "id": 261547377,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1637004806
    },
    {
        "content": "<p>fitzgen created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#discussion_r749623314\">PR review comment</a>:</p>\n<blockquote>\n<p>The problem is that their detection algorithm is broken and the errors are basically unusable without <code>force_graphical(true)</code> for me, the main person reading these errors.</p>\n</blockquote>",
        "id": 261547378,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1637004806
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#discussion_r749626310\">PR review comment</a>:</p>\n<blockquote>\n<p>I don't think it's either-or, though; could we just add a Cargo feature? What I'm envisioning is <code>if cfg!(feature = \"miette-errors-graphical\") {</code> ... <code>}</code> around this. Or an environment-variable if that's easier...</p>\n</blockquote>",
        "id": 261547982,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1637005080
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#pullrequestreview-806474800\">PR review</a>.</p>",
        "id": 261547983,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1637005081
    },
    {
        "content": "<p>fitzgen submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#pullrequestreview-806481577\">PR review</a>.</p>",
        "id": 261549080,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1637005576
    },
    {
        "content": "<p>fitzgen created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#discussion_r749631749\">PR review comment</a>:</p>\n<blockquote>\n<p>I'm not keen to add another speed bump to my own development process by requiring that I enable another env var or cargo feature that I'll forget most of the time.</p>\n<p>How about we leave it as is for now, I file a bug upstream in <code>miette</code>, and then we remove this hack once <code>miette</code> fixes the root cause?</p>\n</blockquote>",
        "id": 261549083,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1637005577
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#pullrequestreview-806529958\">PR review</a>.</p>",
        "id": 261556538,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1637009188
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#discussion_r749668802\">PR review comment</a>:</p>\n<blockquote>\n<p>Yep, that sounds like a reasonable compromise! Just a FIXME comment here noting said issue would be good, then I'm happy <span aria-label=\"+1\" class=\"emoji emoji-1f44d\" role=\"img\" title=\"+1\">:+1:</span> </p>\n</blockquote>",
        "id": 261556539,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1637009189
    },
    {
        "content": "<p>fitzgen updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506\">PR #3506</a> from <code>isle</code> to <code>main</code>.</p>",
        "id": 261572401,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1637016856
    },
    {
        "content": "<p>fitzgen merged <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506\">PR #3506</a>.</p>",
        "id": 261576981,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1637019490
    },
    {
        "content": "<p>fitzgen submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#pullrequestreview-806654951\">PR review</a>.</p>",
        "id": 261577892,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1637020164
    },
    {
        "content": "<p>fitzgen created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/3506#discussion_r749767195\">PR review comment</a>:</p>\n<blockquote>\n<p><a href=\"https://github.com/bytecodealliance/wasmtime/issues/3529\">https://github.com/bytecodealliance/wasmtime/issues/3529</a></p>\n</blockquote>",
        "id": 261577893,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1637020164
    }
]