[
    {
        "content": "<p><strong>yurydelendik</strong> requested <a href=\"https://github.com/peterhuene\">peterhuene</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2357\">PR #2357</a>.</p>",
        "id": 215522809,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1604445153
    },
    {
        "content": "<p>yurydelendik opened <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2357\">PR #2357</a> from <code>pub-unwindcode</code> to <code>main</code>:</p>\n<blockquote>\n<p>Prepares code for #2313</p>\n<ul>\n<li>Make cranelift_codegen::isa::unwind::input public</li>\n<li>Move <code>UnwindCode</code>'s common <code>offset</code> field out of the structure</li>\n<li>Make <code>MachCompileResult::unwind_info</code> more generic</li>\n</ul>\n</blockquote>",
        "id": 215522810,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1604445153
    },
    {
        "content": "<p>yurydelendik updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2357\">PR #2357</a> from <code>pub-unwindcode</code> to <code>main</code>:</p>\n<blockquote>\n<p>Prepares code for #2313</p>\n<ul>\n<li>Make cranelift_codegen::isa::unwind::input public</li>\n<li>Move <code>UnwindCode</code>'s common <code>offset</code> field out of the structure</li>\n<li>Make <code>MachCompileResult::unwind_info</code> more generic</li>\n</ul>\n</blockquote>",
        "id": 215583639,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1604498490
    },
    {
        "content": "<p>yurydelendik updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2357\">PR #2357</a> from <code>pub-unwindcode</code> to <code>main</code>:</p>\n<blockquote>\n<p>Prepares code for #2313</p>\n<ul>\n<li>Make cranelift_codegen::isa::unwind::input public</li>\n<li>Move <code>UnwindCode</code>'s common <code>offset</code> field out of the structure</li>\n<li>Make <code>MachCompileResult::unwind_info</code> more generic</li>\n</ul>\n</blockquote>",
        "id": 215590677,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1604501502
    },
    {
        "content": "<p>yurydelendik updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2357\">PR #2357</a> from <code>pub-unwindcode</code> to <code>main</code>:</p>\n<blockquote>\n<p>Prepares code for #2313</p>\n<ul>\n<li>Make cranelift_codegen::isa::unwind::input public</li>\n<li>Move <code>UnwindCode</code>'s common <code>offset</code> field out of the structure</li>\n<li>Make <code>MachCompileResult::unwind_info</code> more generic</li>\n</ul>\n</blockquote>",
        "id": 215616259,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1604511625
    },
    {
        "content": "<p>yurydelendik updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2357\">PR #2357</a> from <code>pub-unwindcode</code> to <code>main</code>:</p>\n<blockquote>\n<p>Prepares code for #2313</p>\n<ul>\n<li>Make cranelift_codegen::isa::unwind::input public</li>\n<li>Move <code>UnwindCode</code>'s common <code>offset</code> field out of the structure</li>\n<li>Make <code>MachCompileResult::unwind_info</code> more generic</li>\n</ul>\n</blockquote>",
        "id": 215639135,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1604522806
    },
    {
        "content": "<p>yurydelendik edited <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2357\">PR #2357</a> from <code>pub-unwindcode</code> to <code>main</code>:</p>\n<blockquote>\n<p>Prepares code for #2313</p>\n<ul>\n<li>Make cranelift_codegen::isa::unwind::input public</li>\n<li>Move <code>UnwindCode</code>'s common <code>offset</code> field out of the structure</li>\n<li>Make <code>MachCompileResult::unwind_info</code> more generic</li>\n<li>Record initial stack pointer offset (as in CIE)</li>\n</ul>\n<p>The changes allows furthe introduction of fastcall logic and support of ARM-like architectures.</p>\n</blockquote>",
        "id": 215711299,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1604583215
    },
    {
        "content": "<p>yurydelendik updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2357\">PR #2357</a> from <code>pub-unwindcode</code> to <code>main</code>:</p>\n<blockquote>\n<p>Prepares code for #2313</p>\n<ul>\n<li>Make cranelift_codegen::isa::unwind::input public</li>\n<li>Move <code>UnwindCode</code>'s common <code>offset</code> field out of the structure</li>\n<li>Make <code>MachCompileResult::unwind_info</code> more generic</li>\n<li>Record initial stack pointer offset (as in CIE)</li>\n</ul>\n<p>The changes allows furthe introduction of fastcall logic and support of ARM-like architectures.</p>\n</blockquote>",
        "id": 215717567,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1604586221
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2357#pullrequestreview-524527196\">PR Review</a>.</p>",
        "id": 215764558,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1604605589
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2357#pullrequestreview-524527196\">PR Review</a>.</p>",
        "id": 215764560,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1604605590
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2357#discussion_r518252528\">PR Review Comment</a>:</p>\n<blockquote>\n<p>s/intermidate/intermediate/</p>\n</blockquote>",
        "id": 215764561,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1604605590
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2357#discussion_r518253144\">PR Review Comment</a>:</p>\n<blockquote>\n<p>s/speficied/specified/ (and below)</p>\n</blockquote>",
        "id": 215764562,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1604605590
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2357#discussion_r518265995\">PR Review Comment</a>:</p>\n<blockquote>\n<p>Outdated comment (not just one word-size but configurable)?</p>\n</blockquote>",
        "id": 215764563,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1604605590
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2357#discussion_r518274450\">PR Review Comment</a>:</p>\n<blockquote>\n<p>This is pretty counter-intuitive to me without more context: maybe a comment describing the scheme would help. I think what is going on is: if the call-frame address is already defined in terms of a frame register, then this call overrides that definition (<code>Cfa</code> sets both reg and offset); but if no frame register is defined, then this call defines the given register to be the frame register. Is that right?</p>\n<p>I'm not sure I understand the semantics fully either. \"Frame register\" implies to me a register that does not move, and elsewhere in this impl, we conditionally adjust offsets based on whether or not we're using a frame register. It seems that whether or not we're using a frame register is determined by how many times we call <code>set_cfa_reg</code> (whether odd or even count, I think?), which is confusing to me.</p>\n</blockquote>",
        "id": 215764564,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1604605590
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2357#discussion_r518320505\">PR Review Comment</a>:</p>\n<blockquote>\n<p>Hmm -- long-term, I think it might make more sense to generate the necessary <code>UnwindCode</code> sequence directly in prologue/epilogue generation, rather than reverse-engineering the VCode sequence; this feels somewhat fragile (we have to keep in mind this translation if we change the ABI code). Out of scope for this PR, but I wonder if you have any thoughts on that...</p>\n</blockquote>",
        "id": 215764565,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1604605590
    },
    {
        "content": "<p>bjorn3 submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2357#pullrequestreview-524638570\">PR Review</a>.</p>",
        "id": 215769192,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1604607903
    },
    {
        "content": "<p>bjorn3 created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2357#discussion_r518342958\">PR Review Comment</a>:</p>\n<blockquote>\n<p>\"Reliable and Fast DWARF-Based Stack Unwinding\" (<a href=\"https://hal.inria.fr/hal-02297690/document\">https://hal.inria.fr/hal-02297690/document</a>), actually states the how hard it is to keep the unwind info in sync while performing optimizations as one of it's reasons to generate unwind info from the actual assembly.</p>\n</blockquote>",
        "id": 215769193,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1604607903
    },
    {
        "content": "<p>peterhuene created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2357#discussion_r518340362\">PR Review Comment</a>:</p>\n<blockquote>\n<p>This is really strange to me as this <code>rsp</code> isn't really a frame pointer and if this is only necessary to incur a call to <code>set_cfa_reg</code> for popping <code>rbp</code> in SystemV unwind information generation then I'd prefer it done a different way.</p>\n</blockquote>",
        "id": 215769743,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1604608191
    },
    {
        "content": "<p>peterhuene created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2357#discussion_r518312654\">PR Review Comment</a>:</p>\n<blockquote>\n<p>nit: should we keep this a constant?</p>\n</blockquote>",
        "id": 215769744,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1604608191
    },
    {
        "content": "<p>peterhuene submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2357#pullrequestreview-524601172\">PR Review</a>.</p>",
        "id": 215769745,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1604608192
    },
    {
        "content": "<p>peterhuene created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2357#discussion_r518318832\">PR Review Comment</a>:</p>\n<blockquote>\n<p>Perhaps a <code>filter_map</code> here instead of returning an empty <code>Vec</code> for the last epilogue?</p>\n<p>Also, if there's always two elements in the <code>Vec</code>, I wonder if <code>UnwindInfo&lt;Reg&gt;::epilogues_unwind_codes</code> should be <code>Vec&lt;[(CodeOffset, UnwindCode&lt;Reg&gt;); 2]&gt;</code> to reduce these small allocations?</p>\n</blockquote>",
        "id": 215769746,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1604608192
    },
    {
        "content": "<p>peterhuene created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2357#discussion_r518344264\">PR Review Comment</a>:</p>\n<blockquote>\n<p>I'm also having a hard time understanding why this is necessary from what it was previously implemented, namely recording a CFA change for the restore of <code>rbp</code> (i.e. in <code>restore_reg</code>) rather than having a strange, to me at least, \"set frame pointer to <code>rsp</code>\" unwind operation with these changes that causes the call to <code>set_cfa_reg</code>.</p>\n<p>Yury, is there a semantic difference to the resulting baseline changes?</p>\n<p>specifically:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">DW_CFA_def_cfa</span><span class=\"p\">(</span><span class=\"n\">rsp</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">8</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"n\">DW_CFA_same_value</span><span class=\"p\">(</span><span class=\"n\">rbp</span><span class=\"p\">)</span><span class=\"w\"></span>\n</code></pre></div>\n<p>and </p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">DW_CFA_same_value</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">rbp</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"n\">DW_CFA_def_cfa</span><span class=\"p\">(</span><span class=\"n\">rsp</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">8</span><span class=\"p\">)</span><span class=\"w\"></span>\n</code></pre></div>\n</blockquote>",
        "id": 215769747,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1604608192
    },
    {
        "content": "<p>peterhuene submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2357#pullrequestreview-524601172\">PR Review</a>.</p>",
        "id": 215769748,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1604608192
    },
    {
        "content": "<p>peterhuene edited <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2357#discussion_r518344264\">PR Review Comment</a>.</p>",
        "id": 215769877,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1604608254
    },
    {
        "content": "<p>peterhuene created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2357#discussion_r518348393\">PR Review Comment</a>:</p>\n<blockquote>\n<p>The more I think about this, the more I wonder if <code>UnwindInfo&lt;Reg&gt;::epilogues_unwind_codes</code> is even necessary rather than letting the unwind format consume the epilogue ranges from <code>UnwindInfoContext</code> and handle the remember state / restore state logic (which is DWARF-specific anyway).</p>\n</blockquote>",
        "id": 215770458,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1604608523
    },
    {
        "content": "<p>peterhuene submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2357#pullrequestreview-524645426\">PR Review</a>.</p>",
        "id": 215770460,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1604608524
    },
    {
        "content": "<p>peterhuene created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2357#discussion_r518350143\">PR Review Comment</a>:</p>\n<blockquote>\n<p>On an aside: do we have any test cases for <code>DW_CFA_remember_state</code>/<code>DW_CFA_restore_state</code>?  A quick grep doesn't show any results.</p>\n</blockquote>",
        "id": 215770816,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1604608735
    },
    {
        "content": "<p>peterhuene submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2357#pullrequestreview-524647639\">PR Review</a>.</p>",
        "id": 215770817,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1604608735
    },
    {
        "content": "<p>yurydelendik submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2357#pullrequestreview-524649752\">PR Review</a>.</p>",
        "id": 215771154,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1604608921
    },
    {
        "content": "<p>yurydelendik created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2357#discussion_r518351807\">PR Review Comment</a>:</p>\n<blockquote>\n<p><code>DW_CFA_def_cfa(rsp, 8)</code> and <code>DW_CFA_same_value(rbp)</code> affect different states, so in this case order is not relevant. </p>\n<p>I'll add <code>ResetFramePointer</code> to restore CFA to its default value, as specified as the CIE.</p>\n</blockquote>",
        "id": 215771155,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1604608921
    },
    {
        "content": "<p>peterhuene submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2357#pullrequestreview-524651667\">PR Review</a>.</p>",
        "id": 215771451,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1604609092
    },
    {
        "content": "<p>peterhuene created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2357#discussion_r518353295\">PR Review Comment</a>:</p>\n<blockquote>\n<p>A different unwind operation (e.g. <code>RestoreFramePointer</code>) I think makes sense to me <span aria-label=\"+1\" class=\"emoji emoji-1f44d\" role=\"img\" title=\"+1\">:+1:</span> </p>\n</blockquote>",
        "id": 215771452,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1604609093
    },
    {
        "content": "<p>yurydelendik updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2357\">PR #2357</a> from <code>pub-unwindcode</code> to <code>main</code>:</p>\n<blockquote>\n<p>Prepares code for #2313</p>\n<ul>\n<li>Make cranelift_codegen::isa::unwind::input public</li>\n<li>Move <code>UnwindCode</code>'s common <code>offset</code> field out of the structure</li>\n<li>Make <code>MachCompileResult::unwind_info</code> more generic</li>\n<li>Record initial stack pointer offset (as in CIE)</li>\n</ul>\n<p>The changes allows furthe introduction of fastcall logic and support of ARM-like architectures.</p>\n</blockquote>",
        "id": 215772332,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1604609528
    },
    {
        "content": "<p>peterhuene created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2357#discussion_r518360074\">PR Review Comment</a>:</p>\n<blockquote>\n<p>Per the discussion in the other comment thread, I think this will be resolved with a new <code>RestoreFramePointer</code> unwind code.</p>\n</blockquote>",
        "id": 215772934,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1604609869
    },
    {
        "content": "<p>peterhuene submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2357#pullrequestreview-524660495\">PR Review</a>.</p>",
        "id": 215772936,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1604609870
    },
    {
        "content": "<p>yurydelendik submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2357#pullrequestreview-524660793\">PR Review</a>.</p>",
        "id": 215773005,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1604609899
    },
    {
        "content": "<p>yurydelendik created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2357#discussion_r518360266\">PR Review Comment</a>:</p>\n<blockquote>\n<p>It is a TODO -- added a comment about that. The test is <code>test_multi_return_func</code> at unwind/system.rs</p>\n</blockquote>",
        "id": 215773008,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1604609899
    },
    {
        "content": "<p>peterhuene edited <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2357#discussion_r518360074\">PR Review Comment</a>.</p>",
        "id": 215773013,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1604609901
    },
    {
        "content": "<p>peterhuene submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2357#pullrequestreview-524661927\">PR Review</a>.</p>",
        "id": 215773203,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1604609998
    },
    {
        "content": "<p>peterhuene created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2357#discussion_r518361147\">PR Review Comment</a>:</p>\n<blockquote>\n<p>Ah, missed that as I was looking for a file test.</p>\n</blockquote>",
        "id": 215773204,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1604609998
    },
    {
        "content": "<p>yurydelendik updated <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2357\">PR #2357</a> from <code>pub-unwindcode</code> to <code>main</code>:</p>\n<blockquote>\n<p>Prepares code for #2313</p>\n<ul>\n<li>Make cranelift_codegen::isa::unwind::input public</li>\n<li>Move <code>UnwindCode</code>'s common <code>offset</code> field out of the structure</li>\n<li>Make <code>MachCompileResult::unwind_info</code> more generic</li>\n<li>Record initial stack pointer offset (as in CIE)</li>\n</ul>\n<p>The changes allows furthe introduction of fastcall logic and support of ARM-like architectures.</p>\n</blockquote>",
        "id": 215782021,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1604614958
    },
    {
        "content": "<p>cfallin submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2357#pullrequestreview-524724176\">PR Review</a>.</p>",
        "id": 215782726,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1604615500
    },
    {
        "content": "<p>cfallin created <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2357#discussion_r518409908\">PR Review Comment</a>:</p>\n<blockquote>\n<p>Interesting; one thing to note is that the prologue generation in our case happens right before code emission, after any optimizations, but point taken that there is a potential for mismatch. I suppose as long as we are careful with any changes to the prologue code that the translation still works (though the tests look quite good here so that gives me confidence).</p>\n</blockquote>",
        "id": 215782727,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1604615500
    },
    {
        "content": "<p>peterhuene submitted <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2357#pullrequestreview-524724813\">PR Review</a>.</p>",
        "id": 215782865,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1604615570
    },
    {
        "content": "<p>yurydelendik merged <a href=\"https://github.com/bytecodealliance/wasmtime/pull/2357\">PR #2357</a>.</p>",
        "id": 215785033,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1604617061
    }
]