[
    {
        "content": "<p>jzhn opened <a href=\"https://github.com/bytecodealliance/wasmtime/issues/9799\">issue #9799</a>:</p>\n<blockquote>\n<h4>Feature</h4>\n<p>Currently, the <code>wasmtime serve</code> always prefixes the stdout and stderr output of http handlers. This prevents users from implementing structured logs like json.</p>\n<h4>Benefit</h4>\n<p>If <code>wasmtime serve</code> allows customizing log prefixes, it would allow users to implement structured logging at their http handlers, like json, so the stdout and stderr logs from wasmtime serve can be easily parsed by popular log management tools like <a href=\"https://grafana.com/docs/loki/latest/send-data/promtail/stages/json/\">Grafana Loki</a> and <a href=\"https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/CWL_AnalyzeLogData-discoverable-fields.html#CWL_AnalyzeLogData-discoverable-JSON-logs\">AWS CloudWatch</a></p>\n<h4>Implementation</h4>\n<p>Hopefully it's as simple as adding a coupld CLI flags.</p>\n<h4>Alternatives</h4>\n<p>No workarounds/alternatives I could think of.<br>\n</p>\n</blockquote>",
        "id": 488540014,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1733971133
    },
    {
        "content": "<p>jzhn edited <a href=\"https://github.com/bytecodealliance/wasmtime/issues/9799\">issue #9799</a>:</p>\n<blockquote>\n<h4>Feature</h4>\n<p>Currently, the <code>wasmtime serve</code> always prefixes the stdout and stderr output of http handlers. This prevents users from implementing structured logs like json.</p>\n<h4>Benefit</h4>\n<p>If <code>wasmtime serve</code> allows customizing log prefixes, it would allow users to implement structured logging at their http handlers, like json, so the stdout and stderr logs from wasmtime serve can be easily parsed by popular log management tools like <a href=\"https://grafana.com/docs/loki/latest/send-data/promtail/stages/json/\">Grafana Loki</a> and <a href=\"https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/CWL_AnalyzeLogData-discoverable-fields.html#CWL_AnalyzeLogData-discoverable-JSON-logs\">AWS CloudWatch</a></p>\n<h4>Implementation</h4>\n<p>Hopefully it's as simple as adding a coupld CLI flags, to make <a href=\"https://github.com/bytecodealliance/wasmtime/blob/9aa048b0eb0caf2bbd85a24bdada33928e42ad3b/src/commands/serve.rs#L141-L149\">https://github.com/bytecodealliance/wasmtime/blob/9aa048b0eb0caf2bbd85a24bdada33928e42ad3b/src/commands/serve.rs#L141-L149</a> configurable.</p>\n<h4>Alternatives</h4>\n<p>No workarounds/alternatives I could think of.<br>\n</p>\n</blockquote>",
        "id": 488540044,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1733971173
    },
    {
        "content": "<p>jzhn edited <a href=\"https://github.com/bytecodealliance/wasmtime/issues/9799\">issue #9799</a>:</p>\n<blockquote>\n<h4>Feature</h4>\n<p>Currently, the <code>wasmtime serve</code> always prefixes the stdout and stderr output of http handlers. This prevents users from implementing structured logs like json.</p>\n<h5>Expected behaviour</h5>\n<p>logging from http handler in json will be logged by <code>wasmtime serve</code> as-is, without any prefixes.</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"p\">{</span><span class=\"s\">\"timestamp\"</span><span class=\"p\">:</span><span class=\"s\">\"2024-12-12T02:01:04.794485Z\"</span><span class=\"p\">,</span><span class=\"s\">\"level\"</span><span class=\"p\">:</span><span class=\"s\">\"INFO\"</span><span class=\"p\">,</span><span class=\"s\">\"fields\"</span><span class=\"p\">:{</span><span class=\"s\">\"message\"</span><span class=\"p\">:</span><span class=\"s\">\"hello world\"</span><span class=\"p\">,</span><span class=\"s\">\"log.target\"</span><span class=\"p\">:</span><span class=\"s\">\"webservice\"</span><span class=\"p\">,</span><span class=\"s\">\"log.module_path\"</span><span class=\"p\">:</span><span class=\"s\">\"webservice\"</span><span class=\"p\">,</span><span class=\"s\">\"log.file\"</span><span class=\"p\">:</span><span class=\"s\">\"webservice/src/lib.rs\"</span><span class=\"p\">,</span><span class=\"s\">\"log.line\"</span><span class=\"p\">:</span><span class=\"mi\">237</span><span class=\"p\">},</span><span class=\"s\">\"target\"</span><span class=\"p\">:</span><span class=\"s\">\"webservice\"</span><span class=\"p\">}</span>\n</code></pre></div>\n<h5>Actual behaviour</h5>\n<p>handler logs are prefixed with <code>stdout [{req_id}] :: </code>.</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">stdout</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"mi\">176</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"p\">::</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"s\">\"timestamp\"</span><span class=\"p\">:</span><span class=\"s\">\"2024-12-12T02:01:04.794485Z\"</span><span class=\"p\">,</span><span class=\"s\">\"level\"</span><span class=\"p\">:</span><span class=\"s\">\"INFO\"</span><span class=\"p\">,</span><span class=\"s\">\"fields\"</span><span class=\"p\">:{</span><span class=\"s\">\"message\"</span><span class=\"p\">:</span><span class=\"s\">\"hello world\"</span><span class=\"p\">,</span><span class=\"s\">\"log.target\"</span><span class=\"p\">:</span><span class=\"s\">\"webservice\"</span><span class=\"p\">,</span><span class=\"s\">\"log.module_path\"</span><span class=\"p\">:</span><span class=\"s\">\"webservice\"</span><span class=\"p\">,</span><span class=\"s\">\"log.file\"</span><span class=\"p\">:</span><span class=\"s\">\"webservice/src/lib.rs\"</span><span class=\"p\">,</span><span class=\"s\">\"log.line\"</span><span class=\"p\">:</span><span class=\"mi\">237</span><span class=\"p\">},</span><span class=\"s\">\"target\"</span><span class=\"p\">:</span><span class=\"s\">\"webservice\"</span><span class=\"p\">}</span>\n</code></pre></div>\n<h4>Benefit</h4>\n<p>If <code>wasmtime serve</code> allows customizing log prefixes, it would allow users to implement structured logging at their http handlers, like json, so the stdout and stderr logs from wasmtime serve can be easily parsed by popular log management tools like <a href=\"https://grafana.com/docs/loki/latest/send-data/promtail/stages/json/\">Grafana Loki</a> and <a href=\"https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/CWL_AnalyzeLogData-discoverable-fields.html#CWL_AnalyzeLogData-discoverable-JSON-logs\">AWS CloudWatch</a></p>\n<h4>Implementation</h4>\n<p>Hopefully it's as simple as adding a coupld CLI flags, to make <a href=\"https://github.com/bytecodealliance/wasmtime/blob/9aa048b0eb0caf2bbd85a24bdada33928e42ad3b/src/commands/serve.rs#L141-L149\">https://github.com/bytecodealliance/wasmtime/blob/9aa048b0eb0caf2bbd85a24bdada33928e42ad3b/src/commands/serve.rs#L141-L149</a> configurable.</p>\n<h4>Alternatives</h4>\n<p>No workarounds/alternatives I could think of.<br>\n</p>\n</blockquote>",
        "id": 488540295,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1733971331
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/9799#issuecomment-2539981133\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/9799\">issue #9799</a>:</p>\n<blockquote>\n<p>Sounds reasonable to me to have some CLI flags for this yeah, would you be interested in sending a PR? Perhaps we could start out with a flag to just turn off the prefixes?</p>\n</blockquote>",
        "id": 488715092,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1734036322
    },
    {
        "content": "<p>jzhn <a href=\"https://github.com/bytecodealliance/wasmtime/issues/9799#issuecomment-2542653737\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/9799\">issue #9799</a>:</p>\n<blockquote>\n<p>@alexcrichton : I'm fairly new to Rust and WASM, but with your encouragement I've created a PR for this. Please take a look and let me know your feedbacks. Thank you!</p>\n</blockquote>",
        "id": 488948706,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1734140870
    }
]