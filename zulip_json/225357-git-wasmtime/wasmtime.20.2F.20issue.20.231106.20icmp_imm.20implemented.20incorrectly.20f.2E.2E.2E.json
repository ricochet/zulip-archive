[
    {
        "content": "<p>cfallin <a href=\"https://github.com/bytecodealliance/wasmtime/issues/1106#issuecomment-1117931693\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/1106\">issue #1106</a>:</p>\n<blockquote>\n<p>@bjorn3 I suspect this may be fixed now with the new backend, can you verify?</p>\n</blockquote>",
        "id": 281218355,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1651697835
    },
    {
        "content": "<p>bjorn3 <a href=\"https://github.com/bytecodealliance/wasmtime/issues/1106#issuecomment-1120185575\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/1106\">issue #1106</a>:</p>\n<blockquote>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"o\">%</span><span class=\"n\">foo</span><span class=\"p\">()</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">b1</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"n\">block0</span>:\n    <span class=\"nc\">v0</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">iconst</span><span class=\"p\">.</span><span class=\"kt\">i8</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"mi\">128</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">v1</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">iconst</span><span class=\"p\">.</span><span class=\"kt\">i8</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"mi\">128</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">v2</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">icmp</span><span class=\"w\"> </span><span class=\"n\">ne</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v1</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">v2</span><span class=\"w\"></span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n<span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">run</span>: <span class=\"o\">%</span><span class=\"n\">foo</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"kc\">false</span><span class=\"w\"></span>\n</code></pre></div>\n<p>now works on x86_64. It compiles to</p>\n<div class=\"codehilite\" data-code-language=\"GAS\"><pre><span></span><code><span class=\"w\">   </span><span class=\"err\">0:</span><span class=\"w\">   </span><span class=\"err\">55</span><span class=\"w\">                      </span><span class=\"nf\">push</span><span class=\"w\">    </span><span class=\"no\">rbp</span><span class=\"w\"></span>\n<span class=\"w\">   </span><span class=\"err\">1:</span><span class=\"w\">   </span><span class=\"err\">48</span><span class=\"w\"> </span><span class=\"err\">89</span><span class=\"w\"> </span><span class=\"nf\">e5</span><span class=\"w\">                </span><span class=\"no\">mov</span><span class=\"w\">     </span><span class=\"no\">rbp</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"no\">rsp</span><span class=\"w\"></span>\n<span class=\"w\">   </span><span class=\"err\">4:</span><span class=\"w\">   </span><span class=\"nf\">bf</span><span class=\"w\"> </span><span class=\"mi\">80</span><span class=\"w\"> </span><span class=\"no\">ff</span><span class=\"w\"> </span><span class=\"no\">ff</span><span class=\"w\"> </span><span class=\"no\">ff</span><span class=\"w\">          </span><span class=\"no\">mov</span><span class=\"w\">     </span><span class=\"no\">edi</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">0xffffff80</span><span class=\"w\"></span>\n<span class=\"w\">   </span><span class=\"err\">9:</span><span class=\"w\">   </span><span class=\"err\">40</span><span class=\"w\"> </span><span class=\"err\">80</span><span class=\"w\"> </span><span class=\"nf\">ff</span><span class=\"w\"> </span><span class=\"mi\">80</span><span class=\"w\">             </span><span class=\"no\">cmp</span><span class=\"w\">     </span><span class=\"no\">dil</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">0x80</span><span class=\"w\"></span>\n<span class=\"w\">   </span><span class=\"nl\">d:</span><span class=\"w\">   </span><span class=\"err\">40</span><span class=\"w\"> </span><span class=\"err\">0</span><span class=\"nf\">f</span><span class=\"w\"> </span><span class=\"mi\">95</span><span class=\"w\"> </span><span class=\"no\">c0</span><span class=\"w\">             </span><span class=\"no\">setne</span><span class=\"w\">   </span><span class=\"no\">al</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"err\">11:</span><span class=\"w\">   </span><span class=\"err\">48</span><span class=\"w\"> </span><span class=\"err\">89</span><span class=\"w\"> </span><span class=\"nf\">ec</span><span class=\"w\">                </span><span class=\"no\">mov</span><span class=\"w\">     </span><span class=\"no\">rsp</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"no\">rbp</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"err\">14:</span><span class=\"w\">   </span><span class=\"err\">5</span><span class=\"nf\">d</span><span class=\"w\">                      </span><span class=\"no\">pop</span><span class=\"w\">     </span><span class=\"no\">rbp</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"err\">15:</span><span class=\"w\">   </span><span class=\"nf\">c3</span><span class=\"w\">                      </span><span class=\"no\">ret</span><span class=\"w\"></span>\n</code></pre></div>\n<p>And so does</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"o\">%</span><span class=\"n\">foo</span><span class=\"p\">()</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">b1</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"n\">block0</span>:\n    <span class=\"nc\">v0</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">iconst</span><span class=\"p\">.</span><span class=\"kt\">i8</span><span class=\"w\"> </span><span class=\"mi\">128</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">v1</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">iconst</span><span class=\"p\">.</span><span class=\"kt\">i8</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"mi\">128</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">v2</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">icmp</span><span class=\"w\"> </span><span class=\"n\">ne</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v1</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">v2</span><span class=\"w\"></span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n<span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">run</span>: <span class=\"o\">%</span><span class=\"n\">foo</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"kc\">false</span><span class=\"w\"></span>\n</code></pre></div>\n<p>which compiles to</p>\n<div class=\"codehilite\" data-code-language=\"GAS\"><pre><span></span><code><span class=\"w\">   </span><span class=\"err\">0:</span><span class=\"w\">   </span><span class=\"err\">55</span><span class=\"w\">                      </span><span class=\"nf\">push</span><span class=\"w\">    </span><span class=\"no\">rbp</span><span class=\"w\"></span>\n<span class=\"w\">   </span><span class=\"err\">1:</span><span class=\"w\">   </span><span class=\"err\">48</span><span class=\"w\"> </span><span class=\"err\">89</span><span class=\"w\"> </span><span class=\"nf\">e5</span><span class=\"w\">                </span><span class=\"no\">mov</span><span class=\"w\">     </span><span class=\"no\">rbp</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"no\">rsp</span><span class=\"w\"></span>\n<span class=\"w\">   </span><span class=\"err\">4:</span><span class=\"w\">   </span><span class=\"nf\">bf</span><span class=\"w\"> </span><span class=\"mi\">80</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\"> </span><span class=\"mi\">00</span><span class=\"w\">          </span><span class=\"no\">mov</span><span class=\"w\">     </span><span class=\"no\">edi</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">0x80</span><span class=\"w\"></span>\n<span class=\"w\">   </span><span class=\"err\">9:</span><span class=\"w\">   </span><span class=\"err\">40</span><span class=\"w\"> </span><span class=\"err\">80</span><span class=\"w\"> </span><span class=\"nf\">ff</span><span class=\"w\"> </span><span class=\"mi\">80</span><span class=\"w\">             </span><span class=\"no\">cmp</span><span class=\"w\">     </span><span class=\"no\">dil</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">0x80</span><span class=\"w\"></span>\n<span class=\"w\">   </span><span class=\"nl\">d:</span><span class=\"w\">   </span><span class=\"err\">40</span><span class=\"w\"> </span><span class=\"err\">0</span><span class=\"nf\">f</span><span class=\"w\"> </span><span class=\"mi\">95</span><span class=\"w\"> </span><span class=\"no\">c0</span><span class=\"w\">             </span><span class=\"no\">setne</span><span class=\"w\">   </span><span class=\"no\">al</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"err\">11:</span><span class=\"w\">   </span><span class=\"err\">48</span><span class=\"w\"> </span><span class=\"err\">89</span><span class=\"w\"> </span><span class=\"nf\">ec</span><span class=\"w\">                </span><span class=\"no\">mov</span><span class=\"w\">     </span><span class=\"no\">rsp</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"no\">rbp</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"err\">14:</span><span class=\"w\">   </span><span class=\"err\">5</span><span class=\"nf\">d</span><span class=\"w\">                      </span><span class=\"no\">pop</span><span class=\"w\">     </span><span class=\"no\">rbp</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"err\">15:</span><span class=\"w\">   </span><span class=\"nf\">c3</span><span class=\"w\">                      </span><span class=\"no\">ret</span><span class=\"w\"></span>\n</code></pre></div>\n<p>Both are expected.</p>\n</blockquote>",
        "id": 281533616,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1651920425
    },
    {
        "content": "<p>bjorn3 closed <a href=\"https://github.com/bytecodealliance/wasmtime/issues/1106\">issue #1106</a>:</p>\n<blockquote>\n<p><a href=\"https://github.com/CraneStation/cranelift/blob/57fa45c8520110ee7e9b216538f1990376aed0e9/cranelift-codegen/meta/src/shared/legalize.rs#L434-L435\">https://github.com/CraneStation/cranelift/blob/57fa45c8520110ee7e9b216538f1990376aed0e9/cranelift-codegen/meta/src/shared/legalize.rs#L434-L435</a></p>\n<p>For example</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">v0</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">iconst</span><span class=\"p\">.</span><span class=\"kt\">i8</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"mi\">128</span><span class=\"w\"></span>\n<span class=\"n\">v1</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">iconst</span><span class=\"p\">.</span><span class=\"kt\">i8</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"mi\">128</span><span class=\"w\"></span>\n<span class=\"n\">v2</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">icmp</span><span class=\"w\"> </span><span class=\"n\">ne</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">v1</span><span class=\"w\"></span>\n</code></pre></div>\n<p>gets turned into:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">v7</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">iconst</span><span class=\"p\">.</span><span class=\"kt\">i32</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"mi\">128</span><span class=\"w\"></span>\n<span class=\"n\">v0</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">ireduce</span><span class=\"p\">.</span><span class=\"kt\">i8</span><span class=\"w\"> </span><span class=\"n\">v7</span><span class=\"w\"></span>\n<span class=\"n\">v9</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">uextend</span><span class=\"p\">.</span><span class=\"kt\">i32</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"w\"></span>\n<span class=\"n\">v2</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">icmp_imm</span><span class=\"w\"> </span><span class=\"n\">ne</span><span class=\"w\"> </span><span class=\"n\">v9</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"mi\">128</span><span class=\"w\"></span>\n</code></pre></div>\n<p>Which is equal to:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">v9</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">iconst</span><span class=\"p\">.</span><span class=\"kt\">i32</span><span class=\"w\"> </span><span class=\"mi\">128</span><span class=\"w\"></span>\n<span class=\"n\">v2</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">icmp_imm</span><span class=\"w\"> </span><span class=\"n\">ne</span><span class=\"w\"> </span><span class=\"n\">v9</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"mi\">128</span><span class=\"w\"></span>\n</code></pre></div>\n<p>That is obviously false.</p>\n</blockquote>",
        "id": 281533617,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1651920426
    }
]