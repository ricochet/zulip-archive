[
    {
        "content": "<p>peterhuene edited <a href=\"https://github.com/bytecodealliance/wasmtime/pull/557\" title=\"https://github.com/bytecodealliance/wasmtime/pull/557\">PR #557</a> from <code>implement-windows-fdstat-flags</code> to <code>master</code>:</p>\n<blockquote>\n<p>This PR fully implements <code>__wasi_fd_fdstat_get</code> on Windows so that<br>\nthe descriptor flags can be determined.</p>\n<p>It does this by calling into <code>NtQueryInformationFile</code> (safe to call from<br>\nuser mode) to get the open mode and access of the underlying OS handle.</p>\n<p><code>NtQueryInformationFile</code> isn't included in the <code>winapi</code> crate, so it is<br>\nmanually being linked against.</p>\n<p>This PR also fixes several bugs on Windows:</p>\n<ul>\n<li>\n<p>Ignore <code>__WASI_FDFLAG_NONBLOCK</code> by not setting <code>FILE_FLAG_OVERLAPPED</code><br>\n   on file handles (the POSIX behavior for <code>O_NONBLOCK</code> on files).</p>\n</li>\n<li>\n<p>Use <code>FILE_FLAG_WRITE_THROUGH</code> for the <code>__WASI_FDFLAG_?SYNC</code> flags.</p>\n</li>\n<li>\n<p><code>__WASI_FDFLAG_APPEND</code> should disallow <code>FILE_WRITE_DATA</code> access to<br>\n  force append-only on write operations.</p>\n</li>\n<li>\n<p>Use <code>GENERIC_READ</code> and <code>GENERIC_WRITE</code> access flags.  The<br>\n  latter is required when opening a file for truncation.</p>\n</li>\n</ul>\n</blockquote>",
        "id": 191781534,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1585156804
    }
]