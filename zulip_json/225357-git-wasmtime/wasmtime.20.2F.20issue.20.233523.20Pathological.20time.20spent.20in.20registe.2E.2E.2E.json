[
    {
        "content": "<p>alexcrichton edited <a href=\"https://github.com/bytecodealliance/wasmtime/issues/3523\">issue #3523</a>:</p>\n<blockquote>\n<p>We have implemented this repo <a href=\"https://github.com/girazoki/wasmtime-try\">https://github.com/girazoki/wasmtime-try</a> to try something that has been happening us with some latest code change we have done at moonbeam. The code change is <a href=\"https://github.com/PureStake/moonbeam/pull/989\">https://github.com/PureStake/moonbeam/pull/989</a>.</p>\n<p>Without the PR, wasmtime takes around 15 seconds to compile the wasm. However, if we include the change (removal of the trait) wasmtime takes less than a second to compile. We wonder how these differences can be so big with such a small code change.</p>\n<p>Both runtimes are in <a href=\"https://github.com/girazoki/wasmtime-try\">https://github.com/girazoki/wasmtime-try</a> to try them out<br>\nAny help would be appreciated, thanks!</p>\n</blockquote>",
        "id": 261559665,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1637010691
    },
    {
        "content": "<p>cfallin <a href=\"https://github.com/bytecodealliance/wasmtime/issues/3523#issuecomment-969326035\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/3523\">issue #3523</a>:</p>\n<blockquote>\n<p>@alexcrichton That's a good question; ordinarily we'd definitely want to chase something like this, but if the RA2 transition happens soon-ish then the payoff of the time it would take to understand the issue and update the old regalloc, and be confident in the fix, doesn't seem worth it. Especially as many of the details of <a href=\"http://regalloc.rs\">regalloc.rs</a> have fallen out of my mental L2 cache by now...</p>\n<p>These sorts of things do put pressure on the transition, though, so hopefully the moving pieces needed for that will come together soon!</p>\n</blockquote>",
        "id": 261559823,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1637010749
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/3523#issuecomment-969328744\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/3523\">issue #3523</a>:</p>\n<blockquote>\n<p>@adamrk given your interest on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/3441#issuecomment-947072360\">this issue</a> you might be interested in this one as well (<a href=\"https://github.com/bytecodealliance/wasmtime/issues/3523#issuecomment-969319849\">detailed here</a>) but if not no worries!</p>\n</blockquote>",
        "id": 261560293,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1637010963
    },
    {
        "content": "<p>crystalin <a href=\"https://github.com/bytecodealliance/wasmtime/issues/3523#issuecomment-970312015\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/3523\">issue #3523</a>:</p>\n<blockquote>\n<p>Not sure if that would help, but here are the perf (you can open in <a href=\"https://www.speedscope.app/\">https://www.speedscope.app/</a> ) for when it is loading the wasm: <a href=\"https://drive.google.com/file/d/1LSid_h9vs8LGtbaQ8z41CD3vn4-y4g2U/view?usp=sharing\">https://drive.google.com/file/d/1LSid_h9vs8LGtbaQ8z41CD3vn4-y4g2U/view?usp=sharing</a></p>\n<p>(Here is where most of the work goes it seems)<br>\n![20211111_164744](<a href=\"https://user-images.githubusercontent.com/329248/142000660-5bb26ba7-6458-4bda-8813-8075fd3bc00b.jpg\">https://user-images.githubusercontent.com/329248/142000660-5bb26ba7-6458-4bda-8813-8075fd3bc00b.jpg</a>)<br>\n.</p>\n</blockquote>",
        "id": 261645742,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1637071876
    },
    {
        "content": "<p>crystalin edited a <a href=\"https://github.com/bytecodealliance/wasmtime/issues/3523#issuecomment-970312015\">comment</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/3523\">issue #3523</a>:</p>\n<blockquote>\n<p>Not sure if that would help, but here are the perf (you can open in <a href=\"https://www.speedscope.app/\">https://www.speedscope.app/</a> ) for when it is loading the wasm: <a href=\"https://drive.google.com/file/d/1LSid_h9vs8LGtbaQ8z41CD3vn4-y4g2U/view?usp=sharing\">https://drive.google.com/file/d/1LSid_h9vs8LGtbaQ8z41CD3vn4-y4g2U/view?usp=sharing</a></p>\n<p>(Here is where most of the work goes it seems)<br>\n</p>\n</blockquote>",
        "id": 261645758,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1637071885
    },
    {
        "content": "<p>crystalin edited a <a href=\"https://github.com/bytecodealliance/wasmtime/issues/3523#issuecomment-970312015\">comment</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/3523\">issue #3523</a>:</p>\n<blockquote>\n<p>Not sure if that would help, but here are the perf (you can open in <a href=\"https://www.speedscope.app/\">https://www.speedscope.app/</a> ) for when it is loading the wasm: <a href=\"https://drive.google.com/file/d/1LSid_h9vs8LGtbaQ8z41CD3vn4-y4g2U/view?usp=sharing\">https://drive.google.com/file/d/1LSid_h9vs8LGtbaQ8z41CD3vn4-y4g2U/view?usp=sharing</a></p>\n<p>(Here is where most of the work goes it seems<br>\n![image (1)](<a href=\"https://user-images.githubusercontent.com/329248/142000825-4c5a5f37-ba7e-41f3-9b19-31989555b883.png\">https://user-images.githubusercontent.com/329248/142000825-4c5a5f37-ba7e-41f3-9b19-31989555b883.png</a>)<br>\n)</p>\n</blockquote>",
        "id": 261645781,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1637071895
    },
    {
        "content": "<p>crystalin edited a <a href=\"https://github.com/bytecodealliance/wasmtime/issues/3523#issuecomment-970312015\">comment</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/3523\">issue #3523</a>:</p>\n<blockquote>\n<p>Not sure if that would help, but here are the perf (you can open in <a href=\"https://www.speedscope.app/\">https://www.speedscope.app/</a> ) for when it is loading the wasm: <a href=\"https://drive.google.com/file/d/1LSid_h9vs8LGtbaQ8z41CD3vn4-y4g2U/view?usp=sharing\">https://drive.google.com/file/d/1LSid_h9vs8LGtbaQ8z41CD3vn4-y4g2U/view?usp=sharing</a></p>\n<p>(Here is where most of the work goes it seems)<br>\n![image (1)](<a href=\"https://user-images.githubusercontent.com/329248/142000825-4c5a5f37-ba7e-41f3-9b19-31989555b883.png\">https://user-images.githubusercontent.com/329248/142000825-4c5a5f37-ba7e-41f3-9b19-31989555b883.png</a>)</p>\n</blockquote>",
        "id": 261645797,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1637071902
    },
    {
        "content": "<p>alexcrichton labeled <a href=\"https://github.com/bytecodealliance/wasmtime/issues/3523\">issue #3523</a>:</p>\n<blockquote>\n<p>We have implemented this repo <a href=\"https://github.com/girazoki/wasmtime-try\">https://github.com/girazoki/wasmtime-try</a> to try something that has been happening us with some latest code change we have done at moonbeam. The code change is <a href=\"https://github.com/PureStake/moonbeam/pull/989\">https://github.com/PureStake/moonbeam/pull/989</a>.</p>\n<p>Without the PR, wasmtime takes around 15 seconds to compile the wasm. However, if we include the change (removal of the trait) wasmtime takes less than a second to compile. We wonder how these differences can be so big with such a small code change.</p>\n<p>Both runtimes are in <a href=\"https://github.com/girazoki/wasmtime-try\">https://github.com/girazoki/wasmtime-try</a> to try them out<br>\nAny help would be appreciated, thanks!</p>\n</blockquote>",
        "id": 262089313,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1637338931
    },
    {
        "content": "<p>alexcrichton labeled <a href=\"https://github.com/bytecodealliance/wasmtime/issues/3523\">issue #3523</a>:</p>\n<blockquote>\n<p>We have implemented this repo <a href=\"https://github.com/girazoki/wasmtime-try\">https://github.com/girazoki/wasmtime-try</a> to try something that has been happening us with some latest code change we have done at moonbeam. The code change is <a href=\"https://github.com/PureStake/moonbeam/pull/989\">https://github.com/PureStake/moonbeam/pull/989</a>.</p>\n<p>Without the PR, wasmtime takes around 15 seconds to compile the wasm. However, if we include the change (removal of the trait) wasmtime takes less than a second to compile. We wonder how these differences can be so big with such a small code change.</p>\n<p>Both runtimes are in <a href=\"https://github.com/girazoki/wasmtime-try\">https://github.com/girazoki/wasmtime-try</a> to try them out<br>\nAny help would be appreciated, thanks!</p>\n</blockquote>",
        "id": 262089535,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1637339027
    },
    {
        "content": "<p>adamrk <a href=\"https://github.com/bytecodealliance/wasmtime/issues/3523#issuecomment-980461512\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/3523\">issue #3523</a>:</p>\n<blockquote>\n<p>Sorry, just noticed this. Yeah, I'll take a look at it.</p>\n</blockquote>",
        "id": 262840580,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1637967425
    },
    {
        "content": "<p>JoshOrndorff <a href=\"https://github.com/bytecodealliance/wasmtime/issues/3523#issuecomment-994702854\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/3523\">issue #3523</a>:</p>\n<blockquote>\n<p>@alexcrichton We have hit what appears to be the same issue in the Moonbeam project again. This time it is in <a href=\"https://github.com/JoshOrndorff/wasmtime-try/blob/main/moonbase_runtime.compact.wasm\">this wasm file</a>.</p>\n<p>Following your example, @girazoki, explored this:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">RUST_LOG</span><span class=\"o\">=</span><span class=\"n\">wasmtime_cranelift</span><span class=\"w\"> </span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">compile</span><span class=\"w\"> </span><span class=\"n\">moonbase_runtime</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"></span>\n\n<span class=\"o\">..</span><span class=\"p\">.</span><span class=\"w\"></span>\n\n<span class=\"w\"> </span><span class=\"n\">DEBUG</span><span class=\"w\"> </span><span class=\"n\">wasmtime_cranelift</span>::<span class=\"n\">compiler</span><span class=\"w\"> </span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"n\">FuncIndex</span><span class=\"p\">(</span><span class=\"mi\">1276</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">translated</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"mf\">13.571936365</span><span class=\"n\">s</span><span class=\"w\"></span>\n<span class=\"w\"> </span><span class=\"n\">TRACE</span><span class=\"w\"> </span><span class=\"n\">wasmtime_cranelift</span>::<span class=\"n\">compiler</span><span class=\"w\"> </span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"n\">FuncIndex</span><span class=\"p\">(</span><span class=\"mi\">1276</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">timing</span><span class=\"w\"> </span><span class=\"n\">info</span><span class=\"w\"></span>\n<span class=\"o\">========</span><span class=\"w\"> </span><span class=\"o\">========</span><span class=\"w\">  </span><span class=\"o\">==================================</span><span class=\"w\"></span>\n<span class=\"w\">   </span><span class=\"n\">Total</span><span class=\"w\">     </span><span class=\"bp\">Self</span><span class=\"w\">  </span><span class=\"n\">Pass</span><span class=\"w\"></span>\n<span class=\"o\">--------</span><span class=\"w\"> </span><span class=\"o\">--------</span><span class=\"w\">  </span><span class=\"o\">----------------------------------</span><span class=\"w\"></span>\n<span class=\"w\">   </span><span class=\"mf\">0.510</span><span class=\"w\">    </span><span class=\"mf\">0.510</span><span class=\"w\">  </span><span class=\"n\">Translate</span><span class=\"w\"> </span><span class=\"n\">WASM</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"mf\">13.056</span><span class=\"w\">    </span><span class=\"mf\">0.030</span><span class=\"w\">  </span><span class=\"n\">Compilation</span><span class=\"w\"> </span><span class=\"n\">passes</span><span class=\"w\"></span>\n<span class=\"w\">   </span><span class=\"mf\">0.001</span><span class=\"w\">    </span><span class=\"mf\">0.001</span><span class=\"w\">  </span><span class=\"n\">Control</span><span class=\"w\"> </span><span class=\"n\">flow</span><span class=\"w\"> </span><span class=\"n\">graph</span><span class=\"w\"></span>\n<span class=\"w\">   </span><span class=\"mf\">0.002</span><span class=\"w\">    </span><span class=\"mf\">0.002</span><span class=\"w\">  </span><span class=\"n\">Dominator</span><span class=\"w\"> </span><span class=\"n\">tree</span><span class=\"w\"></span>\n<span class=\"w\">   </span><span class=\"mf\">0.000</span><span class=\"w\">    </span><span class=\"mf\">0.000</span><span class=\"w\">  </span><span class=\"n\">Loop</span><span class=\"w\"> </span><span class=\"n\">analysis</span><span class=\"w\"></span>\n<span class=\"w\">   </span><span class=\"mf\">0.001</span><span class=\"w\">    </span><span class=\"mf\">0.001</span><span class=\"w\">  </span><span class=\"n\">Pre</span><span class=\"o\">-</span><span class=\"n\">legalization</span><span class=\"w\"> </span><span class=\"n\">rewriting</span><span class=\"w\"></span>\n<span class=\"w\">   </span><span class=\"mf\">0.005</span><span class=\"w\">    </span><span class=\"mf\">0.005</span><span class=\"w\">  </span><span class=\"n\">Dead</span><span class=\"w\"> </span><span class=\"n\">code</span><span class=\"w\"> </span><span class=\"n\">elimination</span><span class=\"w\"></span>\n<span class=\"w\">   </span><span class=\"mf\">0.009</span><span class=\"w\">    </span><span class=\"mf\">0.009</span><span class=\"w\">  </span><span class=\"n\">Global</span><span class=\"w\"> </span><span class=\"n\">value</span><span class=\"w\"> </span><span class=\"n\">numbering</span><span class=\"w\"></span>\n<span class=\"w\">   </span><span class=\"mf\">0.044</span><span class=\"w\">    </span><span class=\"mf\">0.033</span><span class=\"w\">  </span><span class=\"n\">Loop</span><span class=\"w\"> </span><span class=\"n\">invariant</span><span class=\"w\"> </span><span class=\"n\">code</span><span class=\"w\"> </span><span class=\"n\">motion</span><span class=\"w\"></span>\n<span class=\"w\">   </span><span class=\"mf\">0.000</span><span class=\"w\">    </span><span class=\"mf\">0.000</span><span class=\"w\">  </span><span class=\"n\">Remove</span><span class=\"w\"> </span><span class=\"n\">unreachable</span><span class=\"w\"> </span><span class=\"n\">blocks</span><span class=\"w\"></span>\n<span class=\"w\">   </span><span class=\"mf\">0.210</span><span class=\"w\">    </span><span class=\"mf\">0.210</span><span class=\"w\">  </span><span class=\"n\">Remove</span><span class=\"w\"> </span><span class=\"n\">constant</span><span class=\"w\"> </span><span class=\"n\">phi</span><span class=\"o\">-</span><span class=\"n\">nodes</span><span class=\"w\"></span>\n<span class=\"w\">   </span><span class=\"mf\">0.222</span><span class=\"w\">    </span><span class=\"mf\">0.222</span><span class=\"w\">  </span><span class=\"n\">VCode</span><span class=\"w\"> </span><span class=\"n\">lowering</span><span class=\"w\"></span>\n<span class=\"w\">   </span><span class=\"mf\">0.060</span><span class=\"w\">    </span><span class=\"mf\">0.060</span><span class=\"w\">  </span><span class=\"n\">VCode</span><span class=\"w\"> </span><span class=\"n\">post</span><span class=\"o\">-</span><span class=\"n\">register</span><span class=\"w\"> </span><span class=\"n\">allocation</span><span class=\"w\"> </span><span class=\"n\">finalization</span><span class=\"w\"></span>\n<span class=\"w\">   </span><span class=\"mf\">0.029</span><span class=\"w\">    </span><span class=\"mf\">0.029</span><span class=\"w\">  </span><span class=\"n\">VCode</span><span class=\"w\"> </span><span class=\"n\">emission</span><span class=\"w\"></span>\n<span class=\"w\">   </span><span class=\"mf\">0.000</span><span class=\"w\">    </span><span class=\"mf\">0.000</span><span class=\"w\">  </span><span class=\"n\">VCode</span><span class=\"w\"> </span><span class=\"n\">emission</span><span class=\"w\"> </span><span class=\"n\">finalization</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"mf\">12.443</span><span class=\"w\">   </span><span class=\"mf\">12.443</span><span class=\"w\">  </span><span class=\"n\">Register</span><span class=\"w\"> </span><span class=\"n\">allocation</span><span class=\"w\"></span>\n<span class=\"w\">   </span><span class=\"mf\">0.006</span><span class=\"w\">    </span><span class=\"mf\">0.006</span><span class=\"w\">  </span><span class=\"n\">Binary</span><span class=\"w\"> </span><span class=\"n\">machine</span><span class=\"w\"> </span><span class=\"n\">code</span><span class=\"w\"> </span><span class=\"n\">emission</span><span class=\"w\"></span>\n<span class=\"w\">   </span><span class=\"mf\">0.009</span><span class=\"w\">    </span><span class=\"mf\">0.009</span><span class=\"w\">  </span><span class=\"n\">Layout</span><span class=\"w\"> </span><span class=\"n\">full</span><span class=\"w\"> </span><span class=\"n\">renumbering</span><span class=\"w\"></span>\n<span class=\"o\">========</span><span class=\"w\"> </span><span class=\"o\">========</span><span class=\"w\">  </span><span class=\"o\">==================================</span><span class=\"w\"></span>\n</code></pre></div>\n<p>How did you figure out the human-readale or even the mangled name of the function to know where to put the <code>#[inline(never)]</code>?</p>\n</blockquote>",
        "id": 264996327,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1639567920
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/3523#issuecomment-995023900\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/3523\">issue #3523</a>:</p>\n<blockquote>\n<p>Oh nice, thanks for that! I was able to find the function-in-question with:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">RUST_LOG</span><span class=\"o\">=</span><span class=\"n\">wasmtime_cranelift</span><span class=\"o\">=</span><span class=\"n\">debug</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">target</span><span class=\"o\">/</span><span class=\"n\">release</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">compile</span><span class=\"w\"> </span><span class=\"n\">moonbase_runtime</span><span class=\"p\">.</span><span class=\"n\">compact</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"></span>\n</code></pre></div>\n<p>which prints out:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"o\">..</span><span class=\"p\">.</span><span class=\"w\"></span>\n<span class=\"w\"> </span><span class=\"n\">DEBUG</span><span class=\"w\"> </span><span class=\"n\">wasmtime_cranelift</span>::<span class=\"n\">compiler</span><span class=\"w\"> </span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"n\">FuncIndex</span><span class=\"p\">(</span><span class=\"mi\">1776</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">translated</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"mf\">70.436892</span><span class=\"n\">ms</span><span class=\"w\"></span>\n<span class=\"w\"> </span><span class=\"n\">DEBUG</span><span class=\"w\"> </span><span class=\"n\">wasmtime_cranelift</span>::<span class=\"n\">compiler</span><span class=\"w\"> </span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"n\">FuncIndex</span><span class=\"p\">(</span><span class=\"mi\">679</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">translated</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"mf\">69.31585</span><span class=\"n\">ms</span><span class=\"w\"></span>\n<span class=\"w\"> </span><span class=\"n\">DEBUG</span><span class=\"w\"> </span><span class=\"n\">wasmtime_cranelift</span>::<span class=\"n\">compiler</span><span class=\"w\"> </span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"n\">FuncIndex</span><span class=\"p\">(</span><span class=\"mi\">2050</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">translated</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"mf\">61.266995</span><span class=\"n\">ms</span><span class=\"w\"></span>\n<span class=\"w\"> </span><span class=\"n\">DEBUG</span><span class=\"w\"> </span><span class=\"n\">wasmtime_cranelift</span>::<span class=\"n\">compiler</span><span class=\"w\"> </span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"n\">FuncIndex</span><span class=\"p\">(</span><span class=\"mi\">1574</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">translated</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"mf\">68.276648</span><span class=\"n\">ms</span><span class=\"w\"></span>\n<span class=\"w\"> </span><span class=\"n\">DEBUG</span><span class=\"w\"> </span><span class=\"n\">wasmtime_cranelift</span>::<span class=\"n\">compiler</span><span class=\"w\"> </span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"n\">FuncIndex</span><span class=\"p\">(</span><span class=\"mi\">1622</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">translated</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"mf\">75.956103</span><span class=\"n\">ms</span><span class=\"w\"></span>\n<span class=\"w\"> </span><span class=\"n\">DEBUG</span><span class=\"w\"> </span><span class=\"n\">wasmtime_cranelift</span>::<span class=\"n\">compiler</span><span class=\"w\"> </span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"n\">FuncIndex</span><span class=\"p\">(</span><span class=\"mi\">1983</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">translated</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"mf\">85.31272</span><span class=\"n\">ms</span><span class=\"w\"></span>\n<span class=\"w\"> </span><span class=\"n\">DEBUG</span><span class=\"w\"> </span><span class=\"n\">wasmtime_cranelift</span>::<span class=\"n\">compiler</span><span class=\"w\"> </span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"n\">FuncIndex</span><span class=\"p\">(</span><span class=\"mi\">1347</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">translated</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"mf\">282.235891</span><span class=\"n\">ms</span><span class=\"w\"></span>\n<span class=\"w\"> </span><span class=\"n\">DEBUG</span><span class=\"w\"> </span><span class=\"n\">wasmtime_cranelift</span>::<span class=\"n\">compiler</span><span class=\"w\"> </span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"n\">FuncIndex</span><span class=\"p\">(</span><span class=\"mi\">1276</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">translated</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"mf\">19.01582367</span><span class=\"n\">s</span><span class=\"w\"></span>\n</code></pre></div>\n<p>which points to function 1276 as the offender here.</p>\n<p>Using <code>wasm-opt</code> I got:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">wasm</span><span class=\"o\">-</span><span class=\"n\">opt</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">extract</span><span class=\"o\">-</span><span class=\"n\">function</span><span class=\"o\">-</span><span class=\"n\">index</span><span class=\"o\">=</span><span class=\"mi\">1276</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">moonbase_runtime</span><span class=\"p\">.</span><span class=\"n\">compact</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">o</span><span class=\"w\"> </span><span class=\"n\">extract</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"></span>\n<span class=\"n\">extracting</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">xcm_executor</span>::<span class=\"n\">XcmExecutor</span><span class=\"o\">&lt;</span><span class=\"n\">Config</span><span class=\"o\">&gt;</span><span class=\"err\">\\</span><span class=\"mi\">20</span><span class=\"k\">as</span><span class=\"err\">\\</span><span class=\"mi\">20</span><span class=\"n\">xcm</span>::<span class=\"n\">v2</span>::<span class=\"n\">traits</span>::<span class=\"n\">ExecuteXcm</span><span class=\"o\">&lt;&lt;</span><span class=\"n\">Config</span><span class=\"err\">\\</span><span class=\"mi\">20</span><span class=\"k\">as</span><span class=\"err\">\\</span><span class=\"mi\">20</span><span class=\"n\">xcm_executor</span>::<span class=\"n\">config</span>::<span class=\"n\">Config</span><span class=\"o\">&gt;</span>::<span class=\"n\">Call</span><span class=\"o\">&gt;&gt;</span>::<span class=\"n\">execute_xcm_in_credit</span>::<span class=\"n\">hf77207caf74f0f13</span><span class=\"w\"></span>\n</code></pre></div>\n<p>which I can confirm the <a href=\"https://github.com/bytecodealliance/wasmtime/files/7721648/extract.wasm.gz\">extracted wasm file</a> takes ~20s to compile, quite too long!</p>\n</blockquote>",
        "id": 265047527,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1639590560
    },
    {
        "content": "<p>alexcrichton edited <a href=\"https://github.com/bytecodealliance/wasmtime/issues/3523\">issue #3523</a>:</p>\n<blockquote>\n<h2>Original Issue</h2>\n<p>We have implemented this repo <a href=\"https://github.com/girazoki/wasmtime-try\">https://github.com/girazoki/wasmtime-try</a> to try something that has been happening us with some latest code change we have done at moonbeam. The code change is <a href=\"https://github.com/PureStake/moonbeam/pull/989\">https://github.com/PureStake/moonbeam/pull/989</a>.</p>\n<p>Without the PR, wasmtime takes around 15 seconds to compile the wasm. However, if we include the change (removal of the trait) wasmtime takes less than a second to compile. We wonder how these differences can be so big with such a small code change.</p>\n<p>Both runtimes are in <a href=\"https://github.com/girazoki/wasmtime-try\">https://github.com/girazoki/wasmtime-try</a> to try them out<br>\nAny help would be appreciated, thanks!</p>\n<h2>Current status</h2>\n<p>Modules with way-too-long-compile-times:</p>\n<ul>\n<li><a href=\"https://github.com/bytecodealliance/wasmtime/issues/3523#issuecomment-969324846\">https://github.com/bytecodealliance/wasmtime/issues/3523#issuecomment-969324846</a></li>\n<li><a href=\"https://github.com/bytecodealliance/wasmtime/issues/3523#issuecomment-995023900\">https://github.com/bytecodealliance/wasmtime/issues/3523#issuecomment-995023900</a></li>\n</ul>\n</blockquote>",
        "id": 265047651,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1639590603
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/3523#issuecomment-1109907417\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/3523\">issue #3523</a>:</p>\n<blockquote>\n<p>I'm going to close this given the discussion on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4060\">https://github.com/bytecodealliance/wasmtime/issues/4060</a>. The new regalloc probably improves things here but these sorts of outliers are inevitable with Cranelift's design goals.</p>\n</blockquote>",
        "id": 280223078,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1650985289
    },
    {
        "content": "<p>alexcrichton closed <a href=\"https://github.com/bytecodealliance/wasmtime/issues/3523\">issue #3523</a>:</p>\n<blockquote>\n<h2>Original Issue</h2>\n<p>We have implemented this repo <a href=\"https://github.com/girazoki/wasmtime-try\">https://github.com/girazoki/wasmtime-try</a> to try something that has been happening us with some latest code change we have done at moonbeam. The code change is <a href=\"https://github.com/PureStake/moonbeam/pull/989\">https://github.com/PureStake/moonbeam/pull/989</a>.</p>\n<p>Without the PR, wasmtime takes around 15 seconds to compile the wasm. However, if we include the change (removal of the trait) wasmtime takes less than a second to compile. We wonder how these differences can be so big with such a small code change.</p>\n<p>Both runtimes are in <a href=\"https://github.com/girazoki/wasmtime-try\">https://github.com/girazoki/wasmtime-try</a> to try them out<br>\nAny help would be appreciated, thanks!</p>\n<h2>Current status</h2>\n<p>Modules with way-too-long-compile-times:</p>\n<ul>\n<li><a href=\"https://github.com/bytecodealliance/wasmtime/issues/3523#issuecomment-969324846\">https://github.com/bytecodealliance/wasmtime/issues/3523#issuecomment-969324846</a></li>\n<li><a href=\"https://github.com/bytecodealliance/wasmtime/issues/3523#issuecomment-995023900\">https://github.com/bytecodealliance/wasmtime/issues/3523#issuecomment-995023900</a></li>\n</ul>\n</blockquote>",
        "id": 280223084,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1650985289
    }
]