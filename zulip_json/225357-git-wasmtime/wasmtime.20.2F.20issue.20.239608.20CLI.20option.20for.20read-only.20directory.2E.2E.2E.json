[
    {
        "content": "<p>simonw opened <a href=\"https://github.com/bytecodealliance/wasmtime/issues/9608\">issue #9608</a>:</p>\n<blockquote>\n<h4>Feature</h4>\n<p>When using the <code>wasmtime run</code> command I'd like to be able to attach a directory as read-only.</p>\n<h4>Benefit</h4>\n<p>Currently this works:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">wget</span><span class=\"w\"> </span><span class=\"n\">https</span><span class=\"p\">:</span><span class=\"c1\">//github.com/brettcannon/cpython-wasi-build/releases/download/v3.13.0/python-3.13.0-wasi_sdk-24.zip</span>\n<span class=\"n\">unzip</span><span class=\"w\"> </span><span class=\"n\">python</span><span class=\"o\">-</span><span class=\"mf\">3.13.0</span><span class=\"o\">-</span><span class=\"n\">wasi_sdk</span><span class=\"o\">-</span><span class=\"mf\">24.</span><span class=\"n\">zip</span>\n<span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">dir</span><span class=\"w\"> </span><span class=\"p\">.::</span><span class=\"o\">/</span><span class=\"w\"> </span><span class=\"n\">python</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"na\">print</span><span class=\"p\">(</span><span class=\"s\">\"hello world\"</span><span class=\"p\">)</span><span class=\"o\">'</span>\n</code></pre></div>\n<p>But you can break the installation if you run code like this:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">dir</span><span class=\"w\"> </span><span class=\"p\">.::</span><span class=\"o\">/</span><span class=\"w\"> </span><span class=\"n\">python</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"na\">open</span><span class=\"p\">(</span><span class=\"s\">\"python.wasm\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">\"wb\"</span><span class=\"p\">).</span><span class=\"n\">write</span><span class=\"p\">(</span><span class=\"s\">b\"blah\"</span><span class=\"p\">)</span><span class=\"o\">'</span>\n</code></pre></div>\n<p>I'd like to be able to open a directory as readonly - maybe something like this:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">dir</span><span class=\"o\">-</span><span class=\"n\">ro</span><span class=\"w\"> </span><span class=\"p\">.::</span><span class=\"o\">/</span><span class=\"w\"> </span><span class=\"n\">python</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"na\">open</span><span class=\"p\">(</span><span class=\"s\">\"python.wasm\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">\"wb\"</span><span class=\"p\">).</span><span class=\"n\">write</span><span class=\"p\">(</span><span class=\"s\">b\"blah\"</span><span class=\"p\">)</span><span class=\"o\">'</span>\n</code></pre></div>\n<h4>Implementation</h4>\n<p>The underlying library has support for this:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"w\"> </span><span class=\"nf\">preopened_dir</span><span class=\"p\">(</span>\n<span class=\"w\">    </span><span class=\"o\">&amp;</span><span class=\"k\">mut</span><span class=\"w\"> </span><span class=\"bp\">self</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"n\">host_path</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">impl</span><span class=\"w\"> </span><span class=\"nb\">AsRef</span><span class=\"o\">&lt;</span><span class=\"n\">Path</span><span class=\"o\">&gt;</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"n\">guest_path</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">impl</span><span class=\"w\"> </span><span class=\"nb\">AsRef</span><span class=\"o\">&lt;</span><span class=\"kt\">str</span><span class=\"o\">&gt;</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"n\">dir_perms</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">DirPerms</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"n\">file_perms</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">FilePerms</span><span class=\"p\">,</span>\n<span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nb\">Result</span><span class=\"o\">&lt;&amp;</span><span class=\"k\">mut</span><span class=\"w\"> </span><span class=\"bp\">Self</span><span class=\"o\">&gt;</span>\n</code></pre></div>\n<p><a href=\"https://docs.rs/wasmtime-wasi/latest/wasmtime_wasi/struct.WasiCtxBuilder.html#method.preopened_dir\">https://docs.rs/wasmtime-wasi/latest/wasmtime_wasi/struct.WasiCtxBuilder.html#method.preopened_dir</a></p>\n<p>Exposing that in the CLI would be very useful.</p>\n</blockquote>",
        "id": 482486204,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1731619779
    },
    {
        "content": "<p>pchickey <a href=\"https://github.com/bytecodealliance/wasmtime/issues/9608#issuecomment-2477538531\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/9608\">issue #9608</a>:</p>\n<blockquote>\n<p>Thanks for this request, this is straightforward to implement and has clear benefits.</p>\n<p>For the CLI syntax, I think it should be provided, optionally, in the argument passed to <code>--dir</code>, perhaps as <code>--dir $src::$dst::ro</code>.</p>\n<p>As a quick survey of prior art: Docker has two different syntaxes for read-only volumes <a href=\"https://docs.docker.com/engine/storage/volumes/#use-a-read-only-volume\">https://docs.docker.com/engine/storage/volumes/#use-a-read-only-volume</a>, <code>-v $src:$dst:ro</code> and <code>--mount source=$src,dest=$dst,readonly</code>. From my reading of the podman docs, it supports the <code>-v</code> syntax but not <code>--mount</code>, but I don't have any insight into why podman made that decision.</p>\n<p>Wasmtime doesn't match either of Docker's, but given its closer to <code>-v</code> than <code>--mount</code> I think we could add support for a <code>ro</code> or <code>rw</code> specifier after an additional <code>::</code> separator. There are many alternatives, however - we could treat <code>--dir $src::$dst</code> as legacy syntax (to not break existing users) an start supporting <code>--dir $src:$dst</code> and <code>--dir $src:$dst:ro</code> as the new syntax. We could adopt docker's <code>--mount</code> syntax under <code>wasmtime run -S mount</code> and expose readonly there and not try to add it to <code>--dir</code>. I don't have any particularly strong preferences here but maybe @alexcrichton can chime in, as he did lots of the design of the current CLI scheme.</p>\n</blockquote>",
        "id": 482494651,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1731623565
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/9608#issuecomment-2479646260\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/9608\">issue #9608</a>:</p>\n<blockquote>\n<p>Doing some digging some historical bits and pieces here are:</p>\n<ul>\n<li><a href=\"https://github.com/bytecodealliance/wasmtime/issues/7309\">https://github.com/bytecodealliance/wasmtime/issues/7309</a> - general discussion of <code>--dir</code> and its syntax</li>\n<li><a href=\"https://github.com/bytecodealliance/wasmtime/issues/5974\">https://github.com/bytecodealliance/wasmtime/issues/5974</a> - a similar, but older, issue although doesn't have any other suggestions</li>\n</ul>\n<p>Going off #7309 the conclusion there was to support a json blob to <code>--dir</code>. Not ergonomic to pass manually but easy to extend. I suspect readonly is somewhat common enough that it specifically may want a <code>::ro</code> suffix as well, but I also don't feel strongly</p>\n</blockquote>",
        "id": 482668956,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1731694353
    },
    {
        "content": "<p>fitzgen <a href=\"https://github.com/bytecodealliance/wasmtime/issues/9608#issuecomment-2521650346\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/9608\">issue #9608</a>:</p>\n<blockquote>\n<p>Perhaps <code>--ro-dir src::dst</code> instead of making the <code>src::dst</code> syntax more complicated?</p>\n</blockquote>",
        "id": 486407983,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1733439414
    },
    {
        "content": "<p>liquidaty <a href=\"https://github.com/bytecodealliance/wasmtime/issues/9608#issuecomment-2559301208\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/9608\">issue #9608</a>:</p>\n<blockquote>\n<p>No preference as to how this is implemented, but just want to +1 that however implemented, the ability to mount a directory as read-only would be <em>very</em> useful!</p>\n</blockquote>",
        "id": 490484445,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1734946497
    }
]