[
    {
        "content": "<p>Photosounder opened <a href=\"https://github.com/bytecodealliance/wasmtime/issues/6269\">issue #6269</a>:</p>\n<blockquote>\n<p>I wrote a host to run functions from WASM reactors and with one WASM module after calling one of its functions I get the following trap message:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">error</span><span class=\"w\"> </span><span class=\"k\">while</span><span class=\"w\"> </span><span class=\"n\">executing</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"n\">backtrace</span>:\n    <span class=\"mi\">0</span>: <span class=\"mh\">0xeb40</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!&lt;</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"mi\">80</span><span class=\"o\">&gt;</span>\n<span class=\"w\">    </span><span class=\"mi\">1</span>: <span class=\"mh\">0x1dba3</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!&lt;</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"mi\">130</span><span class=\"o\">&gt;</span>\n<span class=\"w\">    </span><span class=\"mi\">2</span>:  <span class=\"mh\">0x87d</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!&lt;</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"mi\">7</span><span class=\"o\">&gt;</span>\n</code></pre></div>\n<p>It's rather unhelpful so I wanted to add debug information, which I thought I'd do by adding <code>wasmtime_config_debug_info_set(config, true);</code> to my code. But now that I've done this when my program runs <code>wasmtime_module_new()</code> I get this:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">thread</span><span class=\"w\"> </span><span class=\"o\">'&lt;</span><span class=\"n\">unnamed</span><span class=\"o\">&gt;'</span><span class=\"w\"> </span><span class=\"n\">panicked</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"na\">assertion</span><span class=\"w\"> </span><span class=\"n\">failed</span>: <span class=\"nc\">range_start</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"w\"> </span><span class=\"n\">range_end</span><span class=\"o\">'</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">crates</span><span class=\"err\">\\</span><span class=\"n\">cranelift</span><span class=\"err\">\\</span><span class=\"n\">src</span><span class=\"err\">\\</span><span class=\"n\">debug</span><span class=\"err\">\\</span><span class=\"n\">transform</span><span class=\"err\">\\</span><span class=\"n\">expression</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">689</span>:<span class=\"mi\">13</span>\n<span class=\"n\">stack</span><span class=\"w\"> </span><span class=\"n\">backtrace</span>:\n   <span class=\"mi\">0</span>: <span class=\"nc\">rust_begin_unwind</span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"mi\">001</span><span class=\"n\">a77fac33f6560ff361ff38f661ff5f1c6bf85</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"err\">\\</span><span class=\"n\">std</span><span class=\"err\">\\</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">panicking</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">575</span>:<span class=\"mi\">5</span>\n<span class=\"w\">   </span><span class=\"mi\">1</span>: <span class=\"nc\">core</span>::<span class=\"n\">panicking</span>::<span class=\"n\">panic_fmt</span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"mi\">001</span><span class=\"n\">a77fac33f6560ff361ff38f661ff5f1c6bf85</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"err\">\\</span><span class=\"n\">core</span><span class=\"err\">\\</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">panicking</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">64</span>:<span class=\"mi\">14</span>\n<span class=\"w\">   </span><span class=\"mi\">2</span>: <span class=\"nc\">core</span>::<span class=\"n\">panicking</span>::<span class=\"n\">panic</span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"mi\">001</span><span class=\"n\">a77fac33f6560ff361ff38f661ff5f1c6bf85</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"err\">\\</span><span class=\"n\">core</span><span class=\"err\">\\</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">panicking</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">114</span>:<span class=\"mi\">5</span>\n<span class=\"w\">   </span><span class=\"mi\">3</span>: <span class=\"nc\">wasmtime_cranelift</span>::<span class=\"n\">debug</span>::<span class=\"n\">transform</span>::<span class=\"n\">expression</span>::<span class=\"n\">ValueLabelRangesBuilder</span>::<span class=\"n\">process_label</span>\n<span class=\"w\">   </span><span class=\"mi\">4</span>: <span class=\"nc\">wasmtime_cranelift</span>::<span class=\"n\">debug</span>::<span class=\"n\">transform</span>::<span class=\"n\">expression</span>::<span class=\"n\">CompiledExpression</span>::<span class=\"n\">build_with_locals</span>\n<span class=\"w\">   </span><span class=\"mi\">5</span>: <span class=\"nc\">wasmtime_cranelift</span>::<span class=\"n\">debug</span>::<span class=\"n\">transform</span>::<span class=\"n\">simulate</span>::<span class=\"n\">generate_simulated_dwarf</span>\n<span class=\"w\">   </span><span class=\"mi\">6</span>: <span class=\"nc\">wasmtime_cranelift</span>::<span class=\"n\">debug</span>::<span class=\"n\">transform</span>::<span class=\"n\">transform_dwarf</span>\n<span class=\"w\">   </span><span class=\"mi\">7</span>: <span class=\"nc\">wasmtime_cranelift</span>::<span class=\"n\">debug</span>::<span class=\"n\">write_debuginfo</span>::<span class=\"n\">emit_dwarf</span>\n<span class=\"w\">   </span><span class=\"mi\">8</span>: <span class=\"o\">&lt;</span><span class=\"n\">wasmtime_cranelift</span>::<span class=\"n\">compiler</span>::<span class=\"n\">Compiler</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">wasmtime_environ</span>::<span class=\"n\">compilation</span>::<span class=\"n\">Compiler</span><span class=\"o\">&gt;</span>::<span class=\"n\">append_dwarf</span>\n<span class=\"w\">   </span><span class=\"mi\">9</span>: <span class=\"nc\">wasmtime</span>::<span class=\"n\">module</span>::<span class=\"n\">Module</span>::<span class=\"n\">build_artifacts</span>\n<span class=\"w\">  </span><span class=\"mi\">10</span>: <span class=\"nc\">core</span>::<span class=\"n\">ops</span>::<span class=\"n\">function</span>::<span class=\"nb\">FnOnce</span>::<span class=\"n\">call_once</span>\n<span class=\"w\">  </span><span class=\"mi\">11</span>: <span class=\"nc\">wasmtime_cache</span>::<span class=\"n\">ModuleCacheEntry</span>::<span class=\"n\">get_data_raw</span>\n<span class=\"w\">  </span><span class=\"mi\">12</span>: <span class=\"nc\">wasmtime</span>::<span class=\"n\">module</span>::<span class=\"n\">Module</span>::<span class=\"n\">from_binary</span>\n<span class=\"w\">  </span><span class=\"mi\">13</span>: <span class=\"nc\">wasmtime_module_new</span>\n<span class=\"w\">  </span><span class=\"mi\">14</span>: <span class=\"nc\">wasm_host</span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"err\">\\</span><span class=\"n\">C</span>:<span class=\"o\">/</span><span class=\"n\">msys</span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">exp</span><span class=\"o\">/</span><span class=\"n\">wasm_app</span><span class=\"o\">/</span><span class=\"n\">Wasmtime</span><span class=\"w\"> </span><span class=\"n\">host</span><span class=\"o\">/</span><span class=\"n\">wasm_host</span><span class=\"p\">.</span><span class=\"n\">c</span>:<span class=\"mi\">217</span>:<span class=\"mi\">11</span>\n<span class=\"w\">  </span><span class=\"mi\">15</span>: <span class=\"nc\">rl_sdl_standard_main_loop</span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"err\">\\</span><span class=\"n\">D</span>:<span class=\"o\">/</span><span class=\"n\">VC_libs</span><span class=\"o\">/</span><span class=\"n\">include</span><span class=\"o\">/</span><span class=\"n\">rouziclib</span><span class=\"o\">/</span><span class=\"n\">libraries</span><span class=\"o\">/</span><span class=\"n\">sdl</span><span class=\"p\">.</span><span class=\"n\">c</span>:<span class=\"mi\">998</span>:<span class=\"mi\">3</span>\n<span class=\"w\">  </span><span class=\"mi\">16</span>: <span class=\"nc\">main_loop</span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"err\">\\</span><span class=\"n\">C</span>:<span class=\"o\">/</span><span class=\"n\">msys</span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">exp</span><span class=\"o\">/</span><span class=\"n\">wasm_app</span><span class=\"o\">/</span><span class=\"n\">Wasmtime</span><span class=\"w\"> </span><span class=\"n\">host</span><span class=\"o\">/</span><span class=\"n\">wasm_host</span><span class=\"p\">.</span><span class=\"n\">c</span>:<span class=\"mi\">318</span>:<span class=\"mi\">2</span>\n</code></pre></div>\n<p>I have no idea why. I compiled the WASM module (from C using wasi-sdk) with <code>-Og -g3</code>, which I'm not sure is sufficient to get the debug info needed. Here's the host program's relevant code:</p>\n<div class=\"codehilite\" data-code-language=\"C\"><pre><span></span><code><span class=\"w\">    </span><span class=\"c1\">// WASM initialisation</span>\n<span class=\"w\">    </span><span class=\"n\">wasm_config_t</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">config</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">wasm_config_new</span><span class=\"p\">();</span>\n<span class=\"w\">    </span><span class=\"n\">wasmtime_config_debug_info_set</span><span class=\"p\">(</span><span class=\"n\">config</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nb\">true</span><span class=\"p\">);</span>\n<span class=\"w\">    </span><span class=\"n\">ctx</span><span class=\"p\">.</span><span class=\"n\">engine</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">wasm_engine_new_with_config</span><span class=\"p\">(</span><span class=\"n\">config</span><span class=\"p\">);</span>\n<span class=\"w\">    </span><span class=\"n\">ctx</span><span class=\"p\">.</span><span class=\"n\">store</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">wasmtime_store_new</span><span class=\"p\">(</span><span class=\"n\">ctx</span><span class=\"p\">.</span><span class=\"n\">engine</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nb\">NULL</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nb\">NULL</span><span class=\"p\">);</span>\n<span class=\"w\">    </span><span class=\"n\">ctx</span><span class=\"p\">.</span><span class=\"n\">context</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">wasmtime_store_context</span><span class=\"p\">(</span><span class=\"n\">ctx</span><span class=\"p\">.</span><span class=\"n\">store</span><span class=\"p\">);</span>\n\n<span class=\"w\">    </span><span class=\"c1\">// Create a linker with WASI functions defined</span>\n<span class=\"w\">    </span><span class=\"n\">ctx</span><span class=\"p\">.</span><span class=\"n\">linker</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">wasmtime_linker_new</span><span class=\"p\">(</span><span class=\"n\">ctx</span><span class=\"p\">.</span><span class=\"n\">engine</span><span class=\"p\">);</span>\n<span class=\"w\">    </span><span class=\"n\">error</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">wasmtime_linker_define_wasi</span><span class=\"p\">(</span><span class=\"n\">ctx</span><span class=\"p\">.</span><span class=\"n\">linker</span><span class=\"p\">);</span>\n\n<span class=\"w\">    </span><span class=\"c1\">// Load WASM file</span>\n<span class=\"w\">    </span><span class=\"n\">buffer_t</span><span class=\"w\"> </span><span class=\"n\">wasm_buf</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">buf_load_raw_file</span><span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">);</span>\n\n<span class=\"w\">    </span><span class=\"c1\">// Compile WASM</span>\n<span class=\"w\">    </span><span class=\"n\">error</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">wasmtime_module_new</span><span class=\"p\">(</span><span class=\"n\">ctx</span><span class=\"p\">.</span><span class=\"n\">engine</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">wasm_buf</span><span class=\"p\">.</span><span class=\"n\">buf</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">wasm_buf</span><span class=\"p\">.</span><span class=\"n\">len</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">ctx</span><span class=\"p\">.</span><span class=\"n\">module</span><span class=\"p\">);</span>\n</code></pre></div>\n<p>The version of Wasmtime is the <code>dev</code> build <code>wasmtime-dev-x86_64-mingw-c-api.zip</code> from the Releases from 7 hours ago.</p>\n</blockquote>",
        "id": 352103667,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1682272117
    },
    {
        "content": "<p>Photosounder edited <a href=\"https://github.com/bytecodealliance/wasmtime/issues/6269\">issue #6269</a>:</p>\n<blockquote>\n<p>I wrote a host to run functions from WASM reactors and with one WASM module after calling one of its functions I get the following trap message:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">error</span><span class=\"w\"> </span><span class=\"k\">while</span><span class=\"w\"> </span><span class=\"n\">executing</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"n\">backtrace</span>:\n    <span class=\"mi\">0</span>: <span class=\"mh\">0xeb40</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!&lt;</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"mi\">80</span><span class=\"o\">&gt;</span>\n<span class=\"w\">    </span><span class=\"mi\">1</span>: <span class=\"mh\">0x1dba3</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!&lt;</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"mi\">130</span><span class=\"o\">&gt;</span>\n<span class=\"w\">    </span><span class=\"mi\">2</span>:  <span class=\"mh\">0x87d</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!&lt;</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"mi\">7</span><span class=\"o\">&gt;</span>\n</code></pre></div>\n<p>It's rather unhelpful so I wanted to add debug information, which I thought I'd do by adding <code>wasmtime_config_debug_info_set(config, true);</code> to my code. But now that I've done this when my program runs <code>wasmtime_module_new()</code> I get this:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">thread</span><span class=\"w\"> </span><span class=\"o\">'&lt;</span><span class=\"n\">unnamed</span><span class=\"o\">&gt;'</span><span class=\"w\"> </span><span class=\"n\">panicked</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"na\">assertion</span><span class=\"w\"> </span><span class=\"n\">failed</span>: <span class=\"nc\">range_start</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"w\"> </span><span class=\"n\">range_end</span><span class=\"o\">'</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">crates</span><span class=\"err\">\\</span><span class=\"n\">cranelift</span><span class=\"err\">\\</span><span class=\"n\">src</span><span class=\"err\">\\</span><span class=\"n\">debug</span><span class=\"err\">\\</span><span class=\"n\">transform</span><span class=\"err\">\\</span><span class=\"n\">expression</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">689</span>:<span class=\"mi\">13</span>\n<span class=\"n\">stack</span><span class=\"w\"> </span><span class=\"n\">backtrace</span>:\n   <span class=\"mi\">0</span>: <span class=\"nc\">rust_begin_unwind</span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"mi\">001</span><span class=\"n\">a77fac33f6560ff361ff38f661ff5f1c6bf85</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"err\">\\</span><span class=\"n\">std</span><span class=\"err\">\\</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">panicking</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">575</span>:<span class=\"mi\">5</span>\n<span class=\"w\">   </span><span class=\"mi\">1</span>: <span class=\"nc\">core</span>::<span class=\"n\">panicking</span>::<span class=\"n\">panic_fmt</span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"mi\">001</span><span class=\"n\">a77fac33f6560ff361ff38f661ff5f1c6bf85</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"err\">\\</span><span class=\"n\">core</span><span class=\"err\">\\</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">panicking</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">64</span>:<span class=\"mi\">14</span>\n<span class=\"w\">   </span><span class=\"mi\">2</span>: <span class=\"nc\">core</span>::<span class=\"n\">panicking</span>::<span class=\"n\">panic</span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"mi\">001</span><span class=\"n\">a77fac33f6560ff361ff38f661ff5f1c6bf85</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"err\">\\</span><span class=\"n\">core</span><span class=\"err\">\\</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">panicking</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">114</span>:<span class=\"mi\">5</span>\n<span class=\"w\">   </span><span class=\"mi\">3</span>: <span class=\"nc\">wasmtime_cranelift</span>::<span class=\"n\">debug</span>::<span class=\"n\">transform</span>::<span class=\"n\">expression</span>::<span class=\"n\">ValueLabelRangesBuilder</span>::<span class=\"n\">process_label</span>\n<span class=\"w\">   </span><span class=\"mi\">4</span>: <span class=\"nc\">wasmtime_cranelift</span>::<span class=\"n\">debug</span>::<span class=\"n\">transform</span>::<span class=\"n\">expression</span>::<span class=\"n\">CompiledExpression</span>::<span class=\"n\">build_with_locals</span>\n<span class=\"w\">   </span><span class=\"mi\">5</span>: <span class=\"nc\">wasmtime_cranelift</span>::<span class=\"n\">debug</span>::<span class=\"n\">transform</span>::<span class=\"n\">simulate</span>::<span class=\"n\">generate_simulated_dwarf</span>\n<span class=\"w\">   </span><span class=\"mi\">6</span>: <span class=\"nc\">wasmtime_cranelift</span>::<span class=\"n\">debug</span>::<span class=\"n\">transform</span>::<span class=\"n\">transform_dwarf</span>\n<span class=\"w\">   </span><span class=\"mi\">7</span>: <span class=\"nc\">wasmtime_cranelift</span>::<span class=\"n\">debug</span>::<span class=\"n\">write_debuginfo</span>::<span class=\"n\">emit_dwarf</span>\n<span class=\"w\">   </span><span class=\"mi\">8</span>: <span class=\"o\">&lt;</span><span class=\"n\">wasmtime_cranelift</span>::<span class=\"n\">compiler</span>::<span class=\"n\">Compiler</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">wasmtime_environ</span>::<span class=\"n\">compilation</span>::<span class=\"n\">Compiler</span><span class=\"o\">&gt;</span>::<span class=\"n\">append_dwarf</span>\n<span class=\"w\">   </span><span class=\"mi\">9</span>: <span class=\"nc\">wasmtime</span>::<span class=\"n\">module</span>::<span class=\"n\">Module</span>::<span class=\"n\">build_artifacts</span>\n<span class=\"w\">  </span><span class=\"mi\">10</span>: <span class=\"nc\">core</span>::<span class=\"n\">ops</span>::<span class=\"n\">function</span>::<span class=\"nb\">FnOnce</span>::<span class=\"n\">call_once</span>\n<span class=\"w\">  </span><span class=\"mi\">11</span>: <span class=\"nc\">wasmtime_cache</span>::<span class=\"n\">ModuleCacheEntry</span>::<span class=\"n\">get_data_raw</span>\n<span class=\"w\">  </span><span class=\"mi\">12</span>: <span class=\"nc\">wasmtime</span>::<span class=\"n\">module</span>::<span class=\"n\">Module</span>::<span class=\"n\">from_binary</span>\n<span class=\"w\">  </span><span class=\"mi\">13</span>: <span class=\"nc\">wasmtime_module_new</span>\n<span class=\"w\">  </span><span class=\"mi\">14</span>: <span class=\"nc\">wasm_host</span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"err\">\\</span><span class=\"n\">C</span>:<span class=\"o\">/</span><span class=\"n\">msys</span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">exp</span><span class=\"o\">/</span><span class=\"n\">wasm_app</span><span class=\"o\">/</span><span class=\"n\">Wasmtime</span><span class=\"w\"> </span><span class=\"n\">host</span><span class=\"o\">/</span><span class=\"n\">wasm_host</span><span class=\"p\">.</span><span class=\"n\">c</span>:<span class=\"mi\">217</span>:<span class=\"mi\">11</span>\n<span class=\"w\">  </span><span class=\"mi\">15</span>: <span class=\"nc\">rl_sdl_standard_main_loop</span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"err\">\\</span><span class=\"n\">D</span>:<span class=\"o\">/</span><span class=\"n\">VC_libs</span><span class=\"o\">/</span><span class=\"n\">include</span><span class=\"o\">/</span><span class=\"n\">rouziclib</span><span class=\"o\">/</span><span class=\"n\">libraries</span><span class=\"o\">/</span><span class=\"n\">sdl</span><span class=\"p\">.</span><span class=\"n\">c</span>:<span class=\"mi\">998</span>:<span class=\"mi\">3</span>\n<span class=\"w\">  </span><span class=\"mi\">16</span>: <span class=\"nc\">main_loop</span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"err\">\\</span><span class=\"n\">C</span>:<span class=\"o\">/</span><span class=\"n\">msys</span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">exp</span><span class=\"o\">/</span><span class=\"n\">wasm_app</span><span class=\"o\">/</span><span class=\"n\">Wasmtime</span><span class=\"w\"> </span><span class=\"n\">host</span><span class=\"o\">/</span><span class=\"n\">wasm_host</span><span class=\"p\">.</span><span class=\"n\">c</span>:<span class=\"mi\">318</span>:<span class=\"mi\">2</span>\n</code></pre></div>\n<p>I have no idea why. I compiled the WASM module (from C using wasi-sdk) with <code>-Og -g3</code>, which I'm not sure is sufficient to get the debug info needed. Here's the host program's relevant code:</p>\n<div class=\"codehilite\" data-code-language=\"C\"><pre><span></span><code><span class=\"w\">    </span><span class=\"c1\">// WASM initialisation</span>\n<span class=\"w\">    </span><span class=\"n\">wasm_config_t</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">config</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">wasm_config_new</span><span class=\"p\">();</span>\n<span class=\"w\">    </span><span class=\"n\">wasmtime_config_debug_info_set</span><span class=\"p\">(</span><span class=\"n\">config</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nb\">true</span><span class=\"p\">);</span>\n<span class=\"w\">    </span><span class=\"n\">ctx</span><span class=\"p\">.</span><span class=\"n\">engine</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">wasm_engine_new_with_config</span><span class=\"p\">(</span><span class=\"n\">config</span><span class=\"p\">);</span>\n<span class=\"w\">    </span><span class=\"n\">ctx</span><span class=\"p\">.</span><span class=\"n\">store</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">wasmtime_store_new</span><span class=\"p\">(</span><span class=\"n\">ctx</span><span class=\"p\">.</span><span class=\"n\">engine</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nb\">NULL</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nb\">NULL</span><span class=\"p\">);</span>\n<span class=\"w\">    </span><span class=\"n\">ctx</span><span class=\"p\">.</span><span class=\"n\">context</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">wasmtime_store_context</span><span class=\"p\">(</span><span class=\"n\">ctx</span><span class=\"p\">.</span><span class=\"n\">store</span><span class=\"p\">);</span>\n\n<span class=\"w\">    </span><span class=\"c1\">// Create a linker with WASI functions defined</span>\n<span class=\"w\">    </span><span class=\"n\">ctx</span><span class=\"p\">.</span><span class=\"n\">linker</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">wasmtime_linker_new</span><span class=\"p\">(</span><span class=\"n\">ctx</span><span class=\"p\">.</span><span class=\"n\">engine</span><span class=\"p\">);</span>\n<span class=\"w\">    </span><span class=\"n\">error</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">wasmtime_linker_define_wasi</span><span class=\"p\">(</span><span class=\"n\">ctx</span><span class=\"p\">.</span><span class=\"n\">linker</span><span class=\"p\">);</span>\n\n<span class=\"w\">    </span><span class=\"c1\">// Load WASM file</span>\n<span class=\"w\">    </span><span class=\"n\">buffer_t</span><span class=\"w\"> </span><span class=\"n\">wasm_buf</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">buf_load_raw_file</span><span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">);</span>\n\n<span class=\"w\">    </span><span class=\"c1\">// Compile WASM</span>\n<span class=\"w\">    </span><span class=\"n\">error</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">wasmtime_module_new</span><span class=\"p\">(</span><span class=\"n\">ctx</span><span class=\"p\">.</span><span class=\"n\">engine</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">wasm_buf</span><span class=\"p\">.</span><span class=\"n\">buf</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">wasm_buf</span><span class=\"p\">.</span><span class=\"n\">len</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">ctx</span><span class=\"p\">.</span><span class=\"n\">module</span><span class=\"p\">);</span>\n</code></pre></div>\n<p>The version of Wasmtime is the <code>dev</code> build <code>wasmtime-dev-x86_64-mingw-c-api.zip</code> from the Releases from 7 hours ago.</p>\n<p>Edit: I just checked with a .wasm module that works fine and when I enable debug info it also works fine, just not with a buggy WASM module. So it would probably help to include the fault module:<br>\n<a href=\"https://github.com/bytecodealliance/wasmtime/files/11304495/test.zip\">test.zip</a></p>\n</blockquote>",
        "id": 352106293,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1682273414
    },
    {
        "content": "<p>bjorn3 <a href=\"https://github.com/bytecodealliance/wasmtime/issues/6269#issuecomment-1519128571\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/6269\">issue #6269</a>:</p>\n<blockquote>\n<p>See <a href=\"https://github.com/bytecodealliance/wasmtime/issues/3999\">https://github.com/bytecodealliance/wasmtime/issues/3999</a></p>\n</blockquote>",
        "id": 352109398,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1682274991
    },
    {
        "content": "<p>Photosounder <a href=\"https://github.com/bytecodealliance/wasmtime/issues/6269#issuecomment-1519370759\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/6269\">issue #6269</a>:</p>\n<blockquote>\n<p>I see, doesn't seem like I should hold my breath for a fix. So in a situation like the one described at the beginning of my post, how does one go about locating the source of the problem?</p>\n</blockquote>",
        "id": 352158845,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1682310755
    },
    {
        "content": "<p>cfallin <a href=\"https://github.com/bytecodealliance/wasmtime/issues/6269#issuecomment-1519398694\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/6269\">issue #6269</a>:</p>\n<blockquote>\n<p>The state-of-the-art is unfortunately \"printf debugging\" in cases like this. The situation described <a href=\"https://github.com/bytecodealliance/wasmtime/issues/4669#issuecomment-1210997950\">here</a> is unfortunately still the case -- we don't have anyone who understands the existing DWARF-handling code deeply enough to attempt to fix it -- but we do at least have some discussions going in our \"<a href=\"https://github.com/bytecodealliance/governance/blob/main/SIGs/SIG-debugging/proposal.md\">debugging SIG</a>\" that might eventually lead to something. The bottleneck as always is engineer time...</p>\n</blockquote>",
        "id": 352164147,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1682313427
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/6269#issuecomment-1520345543\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/6269\">issue #6269</a>:</p>\n<blockquote>\n<p>I'm going to close this in favor of <a href=\"https://github.com/bytecodealliance/wasmtime/issues/3999\">https://github.com/bytecodealliance/wasmtime/issues/3999</a> since it's the same issue as that one, but thanks for the report!</p>\n</blockquote>",
        "id": 352303899,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1682348452
    },
    {
        "content": "<p>alexcrichton closed <a href=\"https://github.com/bytecodealliance/wasmtime/issues/6269\">issue #6269</a>:</p>\n<blockquote>\n<p>I wrote a host to run functions from WASM reactors and with one WASM module after calling one of its functions I get the following trap message:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">error</span><span class=\"w\"> </span><span class=\"k\">while</span><span class=\"w\"> </span><span class=\"n\">executing</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"n\">backtrace</span>:\n    <span class=\"mi\">0</span>: <span class=\"mh\">0xeb40</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!&lt;</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"mi\">80</span><span class=\"o\">&gt;</span>\n<span class=\"w\">    </span><span class=\"mi\">1</span>: <span class=\"mh\">0x1dba3</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!&lt;</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"mi\">130</span><span class=\"o\">&gt;</span>\n<span class=\"w\">    </span><span class=\"mi\">2</span>:  <span class=\"mh\">0x87d</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!&lt;</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"mi\">7</span><span class=\"o\">&gt;</span>\n</code></pre></div>\n<p>It's rather unhelpful so I wanted to add debug information, which I thought I'd do by adding <code>wasmtime_config_debug_info_set(config, true);</code> to my code. But now that I've done this when my program runs <code>wasmtime_module_new()</code> I get this:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">thread</span><span class=\"w\"> </span><span class=\"o\">'&lt;</span><span class=\"n\">unnamed</span><span class=\"o\">&gt;'</span><span class=\"w\"> </span><span class=\"n\">panicked</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"na\">assertion</span><span class=\"w\"> </span><span class=\"n\">failed</span>: <span class=\"nc\">range_start</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"w\"> </span><span class=\"n\">range_end</span><span class=\"o\">'</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">crates</span><span class=\"err\">\\</span><span class=\"n\">cranelift</span><span class=\"err\">\\</span><span class=\"n\">src</span><span class=\"err\">\\</span><span class=\"n\">debug</span><span class=\"err\">\\</span><span class=\"n\">transform</span><span class=\"err\">\\</span><span class=\"n\">expression</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">689</span>:<span class=\"mi\">13</span>\n<span class=\"n\">stack</span><span class=\"w\"> </span><span class=\"n\">backtrace</span>:\n   <span class=\"mi\">0</span>: <span class=\"nc\">rust_begin_unwind</span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"mi\">001</span><span class=\"n\">a77fac33f6560ff361ff38f661ff5f1c6bf85</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"err\">\\</span><span class=\"n\">std</span><span class=\"err\">\\</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">panicking</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">575</span>:<span class=\"mi\">5</span>\n<span class=\"w\">   </span><span class=\"mi\">1</span>: <span class=\"nc\">core</span>::<span class=\"n\">panicking</span>::<span class=\"n\">panic_fmt</span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"mi\">001</span><span class=\"n\">a77fac33f6560ff361ff38f661ff5f1c6bf85</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"err\">\\</span><span class=\"n\">core</span><span class=\"err\">\\</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">panicking</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">64</span>:<span class=\"mi\">14</span>\n<span class=\"w\">   </span><span class=\"mi\">2</span>: <span class=\"nc\">core</span>::<span class=\"n\">panicking</span>::<span class=\"n\">panic</span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"mi\">001</span><span class=\"n\">a77fac33f6560ff361ff38f661ff5f1c6bf85</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"err\">\\</span><span class=\"n\">core</span><span class=\"err\">\\</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">panicking</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">114</span>:<span class=\"mi\">5</span>\n<span class=\"w\">   </span><span class=\"mi\">3</span>: <span class=\"nc\">wasmtime_cranelift</span>::<span class=\"n\">debug</span>::<span class=\"n\">transform</span>::<span class=\"n\">expression</span>::<span class=\"n\">ValueLabelRangesBuilder</span>::<span class=\"n\">process_label</span>\n<span class=\"w\">   </span><span class=\"mi\">4</span>: <span class=\"nc\">wasmtime_cranelift</span>::<span class=\"n\">debug</span>::<span class=\"n\">transform</span>::<span class=\"n\">expression</span>::<span class=\"n\">CompiledExpression</span>::<span class=\"n\">build_with_locals</span>\n<span class=\"w\">   </span><span class=\"mi\">5</span>: <span class=\"nc\">wasmtime_cranelift</span>::<span class=\"n\">debug</span>::<span class=\"n\">transform</span>::<span class=\"n\">simulate</span>::<span class=\"n\">generate_simulated_dwarf</span>\n<span class=\"w\">   </span><span class=\"mi\">6</span>: <span class=\"nc\">wasmtime_cranelift</span>::<span class=\"n\">debug</span>::<span class=\"n\">transform</span>::<span class=\"n\">transform_dwarf</span>\n<span class=\"w\">   </span><span class=\"mi\">7</span>: <span class=\"nc\">wasmtime_cranelift</span>::<span class=\"n\">debug</span>::<span class=\"n\">write_debuginfo</span>::<span class=\"n\">emit_dwarf</span>\n<span class=\"w\">   </span><span class=\"mi\">8</span>: <span class=\"o\">&lt;</span><span class=\"n\">wasmtime_cranelift</span>::<span class=\"n\">compiler</span>::<span class=\"n\">Compiler</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">wasmtime_environ</span>::<span class=\"n\">compilation</span>::<span class=\"n\">Compiler</span><span class=\"o\">&gt;</span>::<span class=\"n\">append_dwarf</span>\n<span class=\"w\">   </span><span class=\"mi\">9</span>: <span class=\"nc\">wasmtime</span>::<span class=\"n\">module</span>::<span class=\"n\">Module</span>::<span class=\"n\">build_artifacts</span>\n<span class=\"w\">  </span><span class=\"mi\">10</span>: <span class=\"nc\">core</span>::<span class=\"n\">ops</span>::<span class=\"n\">function</span>::<span class=\"nb\">FnOnce</span>::<span class=\"n\">call_once</span>\n<span class=\"w\">  </span><span class=\"mi\">11</span>: <span class=\"nc\">wasmtime_cache</span>::<span class=\"n\">ModuleCacheEntry</span>::<span class=\"n\">get_data_raw</span>\n<span class=\"w\">  </span><span class=\"mi\">12</span>: <span class=\"nc\">wasmtime</span>::<span class=\"n\">module</span>::<span class=\"n\">Module</span>::<span class=\"n\">from_binary</span>\n<span class=\"w\">  </span><span class=\"mi\">13</span>: <span class=\"nc\">wasmtime_module_new</span>\n<span class=\"w\">  </span><span class=\"mi\">14</span>: <span class=\"nc\">wasm_host</span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"err\">\\</span><span class=\"n\">C</span>:<span class=\"o\">/</span><span class=\"n\">msys</span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">exp</span><span class=\"o\">/</span><span class=\"n\">wasm_app</span><span class=\"o\">/</span><span class=\"n\">Wasmtime</span><span class=\"w\"> </span><span class=\"n\">host</span><span class=\"o\">/</span><span class=\"n\">wasm_host</span><span class=\"p\">.</span><span class=\"n\">c</span>:<span class=\"mi\">217</span>:<span class=\"mi\">11</span>\n<span class=\"w\">  </span><span class=\"mi\">15</span>: <span class=\"nc\">rl_sdl_standard_main_loop</span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"err\">\\</span><span class=\"n\">D</span>:<span class=\"o\">/</span><span class=\"n\">VC_libs</span><span class=\"o\">/</span><span class=\"n\">include</span><span class=\"o\">/</span><span class=\"n\">rouziclib</span><span class=\"o\">/</span><span class=\"n\">libraries</span><span class=\"o\">/</span><span class=\"n\">sdl</span><span class=\"p\">.</span><span class=\"n\">c</span>:<span class=\"mi\">998</span>:<span class=\"mi\">3</span>\n<span class=\"w\">  </span><span class=\"mi\">16</span>: <span class=\"nc\">main_loop</span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"err\">\\</span><span class=\"n\">C</span>:<span class=\"o\">/</span><span class=\"n\">msys</span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">exp</span><span class=\"o\">/</span><span class=\"n\">wasm_app</span><span class=\"o\">/</span><span class=\"n\">Wasmtime</span><span class=\"w\"> </span><span class=\"n\">host</span><span class=\"o\">/</span><span class=\"n\">wasm_host</span><span class=\"p\">.</span><span class=\"n\">c</span>:<span class=\"mi\">318</span>:<span class=\"mi\">2</span>\n</code></pre></div>\n<p>I have no idea why. I compiled the WASM module (from C using wasi-sdk) with <code>-Og -g3</code>, which I'm not sure is sufficient to get the debug info needed. Here's the host program's relevant code:</p>\n<div class=\"codehilite\" data-code-language=\"C\"><pre><span></span><code><span class=\"w\">    </span><span class=\"c1\">// WASM initialisation</span>\n<span class=\"w\">    </span><span class=\"n\">wasm_config_t</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">config</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">wasm_config_new</span><span class=\"p\">();</span>\n<span class=\"w\">    </span><span class=\"n\">wasmtime_config_debug_info_set</span><span class=\"p\">(</span><span class=\"n\">config</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nb\">true</span><span class=\"p\">);</span>\n<span class=\"w\">    </span><span class=\"n\">ctx</span><span class=\"p\">.</span><span class=\"n\">engine</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">wasm_engine_new_with_config</span><span class=\"p\">(</span><span class=\"n\">config</span><span class=\"p\">);</span>\n<span class=\"w\">    </span><span class=\"n\">ctx</span><span class=\"p\">.</span><span class=\"n\">store</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">wasmtime_store_new</span><span class=\"p\">(</span><span class=\"n\">ctx</span><span class=\"p\">.</span><span class=\"n\">engine</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nb\">NULL</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nb\">NULL</span><span class=\"p\">);</span>\n<span class=\"w\">    </span><span class=\"n\">ctx</span><span class=\"p\">.</span><span class=\"n\">context</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">wasmtime_store_context</span><span class=\"p\">(</span><span class=\"n\">ctx</span><span class=\"p\">.</span><span class=\"n\">store</span><span class=\"p\">);</span>\n\n<span class=\"w\">    </span><span class=\"c1\">// Create a linker with WASI functions defined</span>\n<span class=\"w\">    </span><span class=\"n\">ctx</span><span class=\"p\">.</span><span class=\"n\">linker</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">wasmtime_linker_new</span><span class=\"p\">(</span><span class=\"n\">ctx</span><span class=\"p\">.</span><span class=\"n\">engine</span><span class=\"p\">);</span>\n<span class=\"w\">    </span><span class=\"n\">error</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">wasmtime_linker_define_wasi</span><span class=\"p\">(</span><span class=\"n\">ctx</span><span class=\"p\">.</span><span class=\"n\">linker</span><span class=\"p\">);</span>\n\n<span class=\"w\">    </span><span class=\"c1\">// Load WASM file</span>\n<span class=\"w\">    </span><span class=\"n\">buffer_t</span><span class=\"w\"> </span><span class=\"n\">wasm_buf</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">buf_load_raw_file</span><span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">);</span>\n\n<span class=\"w\">    </span><span class=\"c1\">// Compile WASM</span>\n<span class=\"w\">    </span><span class=\"n\">error</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">wasmtime_module_new</span><span class=\"p\">(</span><span class=\"n\">ctx</span><span class=\"p\">.</span><span class=\"n\">engine</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">wasm_buf</span><span class=\"p\">.</span><span class=\"n\">buf</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">wasm_buf</span><span class=\"p\">.</span><span class=\"n\">len</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">ctx</span><span class=\"p\">.</span><span class=\"n\">module</span><span class=\"p\">);</span>\n</code></pre></div>\n<p>The version of Wasmtime is the <code>dev</code> build <code>wasmtime-dev-x86_64-mingw-c-api.zip</code> from the Releases from 7 hours ago.</p>\n<p>Edit: I just checked with a .wasm module that works fine and when I enable debug info it also works fine, just not with a buggy WASM module. So it would probably help to include the fault module:<br>\n<a href=\"https://github.com/bytecodealliance/wasmtime/files/11304495/test.zip\">test.zip</a></p>\n</blockquote>",
        "id": 352303900,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1682348452
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/6269#issuecomment-1520347992\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/6269\">issue #6269</a>:</p>\n<blockquote>\n<p>I will mention though that as for your original issue you can try enabling debug information in whatever is compiled to wasm. That will generate a filename/line number in the trap backtrace which can be useful for debugging.</p>\n</blockquote>",
        "id": 352304289,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1682348529
    },
    {
        "content": "<p>Photosounder <a href=\"https://github.com/bytecodealliance/wasmtime/issues/6269#issuecomment-1520464044\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/6269\">issue #6269</a>:</p>\n<blockquote>\n<p>Thanks, I realised that I had stripping enabled in my module compilation command. Anyway my problem was due to the module's stack size being way too small (2048 bytes), it's a shame the runtime didn't warn about this.</p>\n</blockquote>",
        "id": 352324112,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1682352793
    }
]