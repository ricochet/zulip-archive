[
    {
        "content": "<p>cfallin opened <a href=\"https://github.com/bytecodealliance/wasmtime/pull/1656\" title=\"https://github.com/bytecodealliance/wasmtime/pull/1656\">PR #1656</a> from <code>sink-constants</code> to <code>master</code>:</p>\n<blockquote>\n<p>We've observed that there is sometimes significant wasted work in the generated<br>\ncode due to spills/reloads when constants that have been CSE'd are codegen'd<br>\nonce and then used much later. Because we don't support constant<br>\nrematerialization yet (bytecodealliance/regalloc.rs#19), it seems best to clone<br>\nand sink <code>iconst</code>-and-friends to just before their uses; this should avoid many<br>\nspills/reloads.</p>\n<p>Stats on <code>bz2.wasm</code> under wasmtime on aarch64 hardware, before and<br>\nafter:</p>\n<p>Before:</p>\n<div class=\"codehilite\"><pre><span></span><code> Performance counter stats for &#39;target/release/wasmtime run --disable-cache /home/cfallin/wasm-tests/bz2.wasm&#39;:\n\n       3841.058300      task-clock (msec)         #    1.996 CPUs utilized\n            31,786      context-switches          #    0.008 M/sec\n               503      cpu-migrations            #    0.131 K/sec\n            23,709      page-faults               #    0.006 M/sec\n     9,803,413,280      cycles                    #    2.552 GHz\n     9,470,301,612      instructions              #    0.97  insn per cycle\n   &lt;not supported&gt;      branches\n        49,773,064      branch-misses\n\n       1.924119736 seconds time elapsed\n</code></pre></div>\n\n\n<p>After:</p>\n<div class=\"codehilite\"><pre><span></span><code> Performance counter stats for &#39;target/release/wasmtime run --disable-cache /home/cfallin/wasm-tests/bz2.wasm&#39;:\n\n       3390.286950      task-clock (msec)         #    1.962 CPUs utilized\n            16,780      context-switches          #    0.005 M/sec\n               157      cpu-migrations            #    0.046 K/sec\n            20,398      page-faults               #    0.006 M/sec\n     8,336,868,801      cycles                    #    2.459 GHz\n     7,867,825,316      instructions              #    0.94  insn per cycle\n   &lt;not supported&gt;      branches\n        44,435,002      branch-misses\n\n       1.728082422 seconds time elapsed\n</code></pre></div>\n\n\n<p>Compile time, as measured by <code>clif-util wasm</code>, went up very slightly (1.02s -&gt;<br>\n1.07s, but 2635M insns to 2628M insns), but this is more than offset by the<br>\nruntime decrease: total wallclock time decreased by ~10% and instruction count<br>\nby ~17%.</p>\n<p>&lt;!--</p>\n<p>Please ensure that the following steps are all taken care of before submitting<br>\nthe PR.</p>\n<ul>\n<li>\n<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>\n  here.</p>\n</li>\n<li>\n<p>[ ] A short description of what this does, why it is needed; if the<br>\n  description becomes long, the matter should probably be discussed in an issue<br>\n  first.</p>\n</li>\n<li>\n<p>[ ] This PR contains test cases, if meaningful.</p>\n</li>\n<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>\n  If you don't know who could review this, please indicate so. The list of<br>\n  suggested reviewers on the right can help you.</li>\n</ul>\n<p>Please ensure all communication adheres to the <a href=\"https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md\" title=\"https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md\">code of\nconduct</a>.<br>\n--&gt;</p>\n</blockquote>",
        "id": 196246064,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1588630340
    },
    {
        "content": "<p><strong>cfallin</strong> requested <a href=\"https://github.com/bnjbvr\" title=\"https://github.com/bnjbvr\">bnjbvr</a> and <a href=\"https://github.com/julian-seward1\" title=\"https://github.com/julian-seward1\">julian-seward1</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/1656\" title=\"https://github.com/bytecodealliance/wasmtime/pull/1656\">PR #1656</a>.</p>",
        "id": 196246095,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1588630361
    },
    {
        "content": "<p><strong>cfallin</strong> requested <a href=\"https://github.com/bnjbvr\" title=\"https://github.com/bnjbvr\">bnjbvr</a> and <a href=\"https://github.com/julian-seward1\" title=\"https://github.com/julian-seward1\">julian-seward1</a> for a review on <a href=\"https://github.com/bytecodealliance/wasmtime/pull/1656\" title=\"https://github.com/bytecodealliance/wasmtime/pull/1656\">PR #1656</a>.</p>",
        "id": 196246097,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1588630361
    },
    {
        "content": "<p>cfallin closed without merge <a href=\"https://github.com/bytecodealliance/wasmtime/pull/1656\">PR #1656</a>.</p>",
        "id": 198080823,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1589901131
    }
]