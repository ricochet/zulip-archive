[
    {
        "content": "<p><a href=\"https://github.com/k82cn\">k82cn</a> added the bug label to <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7716\">Issue #7716</a>.</p>",
        "id": 409308806,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1703133627
    },
    {
        "content": "<p>k82cn opened <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7716\">issue #7716</a>:</p>\n<blockquote>\n<h3>Test Case</h3>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">component</span>:<span class=\"nc\">matrix</span><span class=\"p\">;</span>\n\n<span class=\"n\">interface</span><span class=\"w\"> </span><span class=\"n\">service</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"k\">enum</span> <span class=\"nc\">flame</span><span class=\"o\">-</span><span class=\"n\">error</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"n\">internal</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n<span class=\"w\">    </span><span class=\"k\">type</span> <span class=\"nc\">task</span><span class=\"o\">-</span><span class=\"n\">input</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">list</span><span class=\"o\">&lt;</span><span class=\"kt\">u8</span><span class=\"o\">&gt;</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"k\">type</span> <span class=\"nc\">task</span><span class=\"o\">-</span><span class=\"n\">output</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">list</span><span class=\"o\">&lt;</span><span class=\"kt\">u8</span><span class=\"o\">&gt;</span><span class=\"p\">;</span>\n\n<span class=\"w\">    </span><span class=\"n\">record</span><span class=\"w\"> </span><span class=\"n\">session</span><span class=\"o\">-</span><span class=\"n\">context</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"n\">session</span><span class=\"o\">-</span><span class=\"n\">id</span>: <span class=\"nc\">string</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"n\">common</span><span class=\"o\">-</span><span class=\"n\">data</span>: <span class=\"nc\">option</span><span class=\"o\">&lt;</span><span class=\"n\">list</span><span class=\"o\">&lt;</span><span class=\"kt\">u8</span><span class=\"o\">&gt;&gt;</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n\n<span class=\"w\">    </span><span class=\"n\">record</span><span class=\"w\"> </span><span class=\"n\">task</span><span class=\"o\">-</span><span class=\"n\">context</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"n\">task</span><span class=\"o\">-</span><span class=\"n\">id</span>: <span class=\"nc\">string</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"n\">session</span><span class=\"o\">-</span><span class=\"n\">id</span>: <span class=\"nc\">string</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n\n<span class=\"w\">    </span><span class=\"c1\">// handle request function</span>\n<span class=\"w\">    </span><span class=\"n\">on</span><span class=\"o\">-</span><span class=\"n\">session</span><span class=\"o\">-</span><span class=\"n\">enter</span>: <span class=\"nc\">func</span><span class=\"p\">(</span><span class=\"n\">ctx</span>: <span class=\"nc\">session</span><span class=\"o\">-</span><span class=\"n\">context</span><span class=\"p\">)</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">result</span><span class=\"o\">&lt;</span><span class=\"n\">_</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">flame</span><span class=\"o\">-</span><span class=\"n\">error</span><span class=\"o\">&gt;</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"n\">on</span><span class=\"o\">-</span><span class=\"n\">session</span><span class=\"o\">-</span><span class=\"n\">leave</span>: <span class=\"nc\">func</span><span class=\"p\">(</span><span class=\"n\">ctx</span>: <span class=\"nc\">session</span><span class=\"o\">-</span><span class=\"n\">context</span><span class=\"p\">)</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">result</span><span class=\"o\">&lt;</span><span class=\"n\">_</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">flame</span><span class=\"o\">-</span><span class=\"n\">error</span><span class=\"o\">&gt;</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"n\">on</span><span class=\"o\">-</span><span class=\"n\">task</span><span class=\"o\">-</span><span class=\"n\">invoke</span>: <span class=\"nc\">func</span><span class=\"p\">(</span><span class=\"n\">ctx</span>: <span class=\"nc\">task</span><span class=\"o\">-</span><span class=\"n\">context</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">input</span>: <span class=\"nc\">option</span><span class=\"o\">&lt;</span><span class=\"n\">task</span><span class=\"o\">-</span><span class=\"n\">input</span><span class=\"o\">&gt;</span><span class=\"p\">)</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">result</span><span class=\"o\">&lt;</span><span class=\"n\">option</span><span class=\"o\">&lt;</span><span class=\"n\">task</span><span class=\"o\">-</span><span class=\"n\">output</span><span class=\"o\">&gt;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">flame</span><span class=\"o\">-</span><span class=\"n\">error</span><span class=\"o\">&gt;</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n\n<span class=\"c1\">// exports the interface</span>\n<span class=\"n\">world</span><span class=\"w\"> </span><span class=\"n\">flame</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"n\">export</span><span class=\"w\"> </span><span class=\"n\">service</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<h3>Steps to Reproduce</h3>\n<ul>\n<li>build wasm <code>cargo component build -p matrix-server</code></li>\n<li>build wasm main <code>cargo build -p matrix-local</code></li>\n<li>run wasm main <code>./target/debug/matrix-local</code></li>\n</ul>\n<p><strong>References</strong>:</p>\n<ul>\n<li>matrix-local: <a href=\"https://github.com/xflops/flame/pull/75/files#diff-448546749b6625cbca1a43c400f6d86637db5f014968c96ece09705e07f65c7c\">https://github.com/xflops/flame/pull/75/files#diff-448546749b6625cbca1a43c400f6d86637db5f014968c96ece09705e07f65c7c</a></li>\n<li>matrix-server (wasm): <a href=\"https://github.com/xflops/flame/pull/75/files#diff-e21ed78fa8d569631fed0fdddc6c99d585fc4d25806da0c7c00c4ebb2bacc8e9\">https://github.com/xflops/flame/pull/75/files#diff-e21ed78fa8d569631fed0fdddc6c99d585fc4d25806da0c7c00c4ebb2bacc8e9</a></li>\n</ul>\n<h3>Expected Results</h3>\n<p>Execute the callbacks accordingly, e.g. on_session_enter.</p>\n<h3>Actual Results</h3>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">target</span><span class=\"o\">/</span><span class=\"n\">debug</span><span class=\"o\">/</span><span class=\"n\">matrix</span><span class=\"o\">-</span><span class=\"n\">local</span>\n<span class=\"n\">Error</span>: <span class=\"nc\">Internal</span><span class=\"p\">(</span><span class=\"s\">\"Failed to instantiate the flame world\"</span><span class=\"p\">)</span>\n</code></pre></div>\n<h3>Versions and Environment</h3>\n<p>Wasmtime version or commit: </p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">\"16\"</span>\n<span class=\"n\">wasmtime</span><span class=\"o\">-</span><span class=\"n\">wasi</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">\"16\"</span>\n<span class=\"n\">anyhow</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">\"1\"</span>\n</code></pre></div>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">rustc</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">version</span>\n<span class=\"n\">rustc</span><span class=\"w\"> </span><span class=\"mf\">1.74.1</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">a28077b28</span><span class=\"w\"> </span><span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">12</span><span class=\"o\">-</span><span class=\"mi\">04</span><span class=\"p\">)</span>\n<span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">cargo</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">version</span>\n<span class=\"n\">cargo</span><span class=\"w\"> </span><span class=\"mf\">1.74.1</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">ecb9851af</span><span class=\"w\"> </span><span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">10</span><span class=\"o\">-</span><span class=\"mi\">18</span><span class=\"p\">)</span>\n</code></pre></div>\n<p>Operating system: <code>Ubuntu 22.04</code></p>\n<p>Architecture: x86</p>\n</blockquote>",
        "id": 409308807,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1703133628
    },
    {
        "content": "<p>k82cn <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7716#issuecomment-1865483029\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7716\">issue #7716</a>:</p>\n<blockquote>\n<p>The same issue with the add example:</p>\n<p><div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">target</span><span class=\"o\">/</span><span class=\"n\">debug</span><span class=\"o\">/</span><span class=\"n\">host</span><span class=\"o\">-</span><span class=\"n\">add</span>\n<span class=\"n\">Error</span>: <span class=\"nc\">Failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">instantiate</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">example</span><span class=\"w\"> </span><span class=\"n\">world</span>\n\n<span class=\"n\">Caused</span><span class=\"w\"> </span><span class=\"n\">by</span>:\n    <span class=\"mi\">0</span>: <span class=\"nc\">import</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">wasi</span>:<span class=\"nc\">cli</span><span class=\"o\">/</span><span class=\"n\">environment</span><span class=\"o\">@</span><span class=\"mf\">0.2.0</span><span class=\"o\">-</span><span class=\"n\">rc</span><span class=\"o\">-</span><span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">11</span><span class=\"o\">-</span><span class=\"mi\">10</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">has</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">wrong</span><span class=\"w\"> </span><span class=\"k\">type</span>\n    <span class=\"mi\">1</span>: <span class=\"nc\">instance</span><span class=\"w\"> </span><span class=\"n\">export</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">get</span><span class=\"o\">-</span><span class=\"n\">environment</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">has</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">wrong</span><span class=\"w\"> </span><span class=\"k\">type</span>\n    <span class=\"mi\">2</span>: <span class=\"nc\">expected</span><span class=\"w\"> </span><span class=\"n\">func</span><span class=\"w\"> </span><span class=\"n\">found</span><span class=\"w\"> </span><span class=\"n\">nothing</span>\n</code></pre></div><br>\n</p>\n</blockquote>",
        "id": 409310588,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1703134821
    },
    {
        "content": "<p>k82cn <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7716#issuecomment-1865544756\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7716\">issue #7716</a>:</p>\n<blockquote>\n<p>It works when rollback to wasmtime <code>15</code>.</p>\n</blockquote>",
        "id": 409316659,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1703138572
    },
    {
        "content": "<p>alexcrichton <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7716#issuecomment-1874407164\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7716\">issue #7716</a>:</p>\n<blockquote>\n<p>Thanks for the report! This is probably due to a missing <code>add_to_linker</code> somewhere to register WASI with the linker. Do you have a version of the code to read over which isn't a PR? </p>\n</blockquote>",
        "id": 410889373,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1704221052
    },
    {
        "content": "<p>k82cn <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7716#issuecomment-1874685228\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7716\">issue #7716</a>:</p>\n<blockquote>\n<p>Just try it with <code>16.0</code>, the issue should be there. The version <code>15</code> works for me, did not try the latest one.</p>\n<p>Reference: </p>\n<ul>\n<li>WASM app: <a href=\"https://github.com/xflops/flame/tree/main/examples/matrix/server\">https://github.com/xflops/flame/tree/main/examples/matrix/server</a></li>\n<li>WASM engine: <a href=\"https://github.com/xflops/flame/blob/main/executor_manager/src/shims/wasm_shim.rs\">https://github.com/xflops/flame/blob/main/executor_manager/src/shims/wasm_shim.rs</a></li>\n</ul>\n</blockquote>",
        "id": 410920491,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1704238361
    },
    {
        "content": "<p>pchickey <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7716#issuecomment-1875757316\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7716\">issue #7716</a>:</p>\n<blockquote>\n<p>When upgrading from wasmtime-wasi 15 to 16, the version numbers in the wit packages changed. I can't find it in your build, but wherever you are running <code>wasm-tools component new</code> (maybe you are using cargo-component?) you need to change the wasi preview 1 adapter to the version that ships with wasmtime 16 as well, which will match those wit packages.</p>\n</blockquote>",
        "id": 411055690,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1704304794
    },
    {
        "content": "<p>zeeshanlakhani <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7716#issuecomment-1879289442\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7716\">issue #7716</a>:</p>\n<blockquote>\n<p>As mentioned in Zulip, I'm suffering from:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">running</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">test</span>\n<span class=\"n\">thread</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"na\">test_crop_base64</span><span class=\"o\">'</span><span class=\"w\"> </span><span class=\"n\">panicked</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">homestar</span><span class=\"o\">-</span><span class=\"n\">wasm</span><span class=\"o\">/</span><span class=\"n\">tests</span><span class=\"o\">/</span><span class=\"n\">execute_wasm</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">156</span>:<span class=\"mi\">10</span>:\n<span class=\"nc\">called</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"nb\">Result</span>::<span class=\"n\">unwrap</span><span class=\"p\">()</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">on</span><span class=\"w\"> </span><span class=\"n\">an</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"nb\">Err</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">value</span>: <span class=\"nc\">WasmRuntime</span><span class=\"p\">(</span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">wasi</span>:<span class=\"nc\">cli</span><span class=\"o\">/</span><span class=\"n\">environment</span><span class=\"o\">@</span><span class=\"mf\">0.2.0</span><span class=\"o\">-</span><span class=\"n\">rc</span><span class=\"o\">-</span><span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">12</span><span class=\"o\">-</span><span class=\"mi\">05</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">has</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">wrong</span><span class=\"w\"> </span><span class=\"k\">type</span>\n\n<span class=\"nc\">Caused</span><span class=\"w\"> </span><span class=\"n\">by</span>:\n    <span class=\"mi\">0</span>: <span class=\"nc\">instance</span><span class=\"w\"> </span><span class=\"n\">export</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">get</span><span class=\"o\">-</span><span class=\"n\">environment</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">has</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">wrong</span><span class=\"w\"> </span><span class=\"k\">type</span>\n    <span class=\"mi\">1</span>: <span class=\"nc\">expected</span><span class=\"w\"> </span><span class=\"n\">func</span><span class=\"w\"> </span><span class=\"n\">found</span><span class=\"w\"> </span><span class=\"n\">nothing</span>\n</code></pre></div>\n<p>This happens when compiling my wasm wit-bindgen (version 0.16) code with wasi (it works fine with wasm32-unknown-known). I'm using the reactor version of wasi_snapshot_preview1.wasm from wasmtime 16 when running --adapt. Our runtime, which embeds wasmtime, has:</p>\n<div class=\"codehilite\" data-code-language=\"TOML\"><pre><span></span><code><span class=\"n\">wasmparser</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"0.118\"</span>\n<span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"p\">=</span><span class=\"w\"> </span><span class=\"s2\">\"16.0\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">default-features</span><span class=\"w\"> </span><span class=\"p\">=</span><span class=\"w\"> </span><span class=\"kc\">false</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">features</span><span class=\"w\"> </span><span class=\"p\">=</span><span class=\"w\"> </span><span class=\"p\">[</span>\n<span class=\"w\">  </span><span class=\"s2\">\"async\"</span><span class=\"p\">,</span>\n<span class=\"w\">  </span><span class=\"s2\">\"component-model\"</span><span class=\"p\">,</span>\n<span class=\"w\">  </span><span class=\"s2\">\"cranelift\"</span><span class=\"p\">,</span>\n<span class=\"w\">  </span><span class=\"s2\">\"parallel-compilation\"</span><span class=\"p\">,</span>\n<span class=\"w\">  </span><span class=\"s2\">\"pooling-allocator\"</span><span class=\"p\">,</span>\n<span class=\"w\">  </span><span class=\"s2\">\"wat\"</span><span class=\"p\">,</span>\n<span class=\"p\">]</span><span class=\"w\"> </span><span class=\"p\">}</span>\n<span class=\"n\">wasmtime-component-util</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"16.0\"</span>\n<span class=\"n\">wasmtime-wasi</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"p\">=</span><span class=\"w\"> </span><span class=\"s2\">\"16.0\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">default-features</span><span class=\"w\"> </span><span class=\"p\">=</span><span class=\"w\"> </span><span class=\"kc\">false</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">features</span><span class=\"w\"> </span><span class=\"p\">=</span><span class=\"w\"> </span><span class=\"p\">[</span>\n<span class=\"w\">  </span><span class=\"s2\">\"tokio\"</span><span class=\"p\">,</span>\n<span class=\"p\">]</span><span class=\"w\"> </span><span class=\"p\">}</span>\n<span class=\"n\">wat</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"1.0\"</span>\n<span class=\"n\">wit-component</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"0.19\"</span>\n</code></pre></div>\n<p>It fails on instantiation:</p>\n<p><div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">instance</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">linker</span><span class=\"p\">.</span><span class=\"n\">instantiate_async</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"k\">mut</span><span class=\"w\"> </span><span class=\"n\">store</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">component</span><span class=\"p\">).</span><span class=\"k\">await</span><span class=\"o\">?</span><span class=\"p\">;</span>\n<span class=\"n\">I</span><span class=\"w\"> </span><span class=\"n\">even</span><span class=\"w\"> </span><span class=\"n\">removed</span><span class=\"w\"> </span><span class=\"n\">any</span><span class=\"w\"> </span><span class=\"n\">WASI</span><span class=\"w\"> </span><span class=\"n\">bits</span><span class=\"w\"> </span><span class=\"n\">from</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">component</span><span class=\"w\"> </span><span class=\"n\">code</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">but</span><span class=\"w\"> </span><span class=\"n\">just</span><span class=\"w\"> </span><span class=\"n\">focused</span><span class=\"w\"> </span><span class=\"n\">on</span><span class=\"w\"> </span><span class=\"n\">targetting</span><span class=\"w\"> </span><span class=\"n\">wasm32</span><span class=\"o\">-</span><span class=\"n\">wasi</span><span class=\"p\">.</span>\n</code></pre></div><br>\n</p>\n</blockquote>",
        "id": 411436957,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1704490960
    },
    {
        "content": "<p>zeeshanlakhani deleted a <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7716#issuecomment-1879289442\">comment</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7716\">issue #7716</a>:</p>\n<blockquote>\n<p>As mentioned in Zulip, I'm suffering from:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">running</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">test</span>\n<span class=\"n\">thread</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"na\">test_crop_base64</span><span class=\"o\">'</span><span class=\"w\"> </span><span class=\"n\">panicked</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">homestar</span><span class=\"o\">-</span><span class=\"n\">wasm</span><span class=\"o\">/</span><span class=\"n\">tests</span><span class=\"o\">/</span><span class=\"n\">execute_wasm</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">156</span>:<span class=\"mi\">10</span>:\n<span class=\"nc\">called</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"nb\">Result</span>::<span class=\"n\">unwrap</span><span class=\"p\">()</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">on</span><span class=\"w\"> </span><span class=\"n\">an</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"nb\">Err</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">value</span>: <span class=\"nc\">WasmRuntime</span><span class=\"p\">(</span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">wasi</span>:<span class=\"nc\">cli</span><span class=\"o\">/</span><span class=\"n\">environment</span><span class=\"o\">@</span><span class=\"mf\">0.2.0</span><span class=\"o\">-</span><span class=\"n\">rc</span><span class=\"o\">-</span><span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">12</span><span class=\"o\">-</span><span class=\"mi\">05</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">has</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">wrong</span><span class=\"w\"> </span><span class=\"k\">type</span>\n\n<span class=\"nc\">Caused</span><span class=\"w\"> </span><span class=\"n\">by</span>:\n    <span class=\"mi\">0</span>: <span class=\"nc\">instance</span><span class=\"w\"> </span><span class=\"n\">export</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">get</span><span class=\"o\">-</span><span class=\"n\">environment</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">has</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">wrong</span><span class=\"w\"> </span><span class=\"k\">type</span>\n    <span class=\"mi\">1</span>: <span class=\"nc\">expected</span><span class=\"w\"> </span><span class=\"n\">func</span><span class=\"w\"> </span><span class=\"n\">found</span><span class=\"w\"> </span><span class=\"n\">nothing</span>\n</code></pre></div>\n<p>This happens when compiling my wasm wit-bindgen (version 0.16) code with wasi (it works fine with wasm32-unknown-known). I'm using the reactor version of wasi_snapshot_preview1.wasm from wasmtime 16 when running --adapt. Our runtime, which embeds wasmtime, has:</p>\n<div class=\"codehilite\" data-code-language=\"TOML\"><pre><span></span><code><span class=\"n\">wasmparser</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"0.118\"</span>\n<span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"p\">=</span><span class=\"w\"> </span><span class=\"s2\">\"16.0\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">default-features</span><span class=\"w\"> </span><span class=\"p\">=</span><span class=\"w\"> </span><span class=\"kc\">false</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">features</span><span class=\"w\"> </span><span class=\"p\">=</span><span class=\"w\"> </span><span class=\"p\">[</span>\n<span class=\"w\">  </span><span class=\"s2\">\"async\"</span><span class=\"p\">,</span>\n<span class=\"w\">  </span><span class=\"s2\">\"component-model\"</span><span class=\"p\">,</span>\n<span class=\"w\">  </span><span class=\"s2\">\"cranelift\"</span><span class=\"p\">,</span>\n<span class=\"w\">  </span><span class=\"s2\">\"parallel-compilation\"</span><span class=\"p\">,</span>\n<span class=\"w\">  </span><span class=\"s2\">\"pooling-allocator\"</span><span class=\"p\">,</span>\n<span class=\"w\">  </span><span class=\"s2\">\"wat\"</span><span class=\"p\">,</span>\n<span class=\"p\">]</span><span class=\"w\"> </span><span class=\"p\">}</span>\n<span class=\"n\">wasmtime-component-util</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"16.0\"</span>\n<span class=\"n\">wasmtime-wasi</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"p\">=</span><span class=\"w\"> </span><span class=\"s2\">\"16.0\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">default-features</span><span class=\"w\"> </span><span class=\"p\">=</span><span class=\"w\"> </span><span class=\"kc\">false</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">features</span><span class=\"w\"> </span><span class=\"p\">=</span><span class=\"w\"> </span><span class=\"p\">[</span>\n<span class=\"w\">  </span><span class=\"s2\">\"tokio\"</span><span class=\"p\">,</span>\n<span class=\"p\">]</span><span class=\"w\"> </span><span class=\"p\">}</span>\n<span class=\"n\">wat</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"1.0\"</span>\n<span class=\"n\">wit-component</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"0.19\"</span>\n</code></pre></div>\n<p>It fails on instantiation:</p>\n<p><div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">instance</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">linker</span><span class=\"p\">.</span><span class=\"n\">instantiate_async</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"k\">mut</span><span class=\"w\"> </span><span class=\"n\">store</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">component</span><span class=\"p\">).</span><span class=\"k\">await</span><span class=\"o\">?</span><span class=\"p\">;</span>\n<span class=\"n\">I</span><span class=\"w\"> </span><span class=\"n\">even</span><span class=\"w\"> </span><span class=\"n\">removed</span><span class=\"w\"> </span><span class=\"n\">any</span><span class=\"w\"> </span><span class=\"n\">WASI</span><span class=\"w\"> </span><span class=\"n\">bits</span><span class=\"w\"> </span><span class=\"n\">from</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">component</span><span class=\"w\"> </span><span class=\"n\">code</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">but</span><span class=\"w\"> </span><span class=\"n\">just</span><span class=\"w\"> </span><span class=\"n\">focused</span><span class=\"w\"> </span><span class=\"n\">on</span><span class=\"w\"> </span><span class=\"n\">targetting</span><span class=\"w\"> </span><span class=\"n\">wasm32</span><span class=\"o\">-</span><span class=\"n\">wasi</span><span class=\"p\">.</span>\n</code></pre></div><br>\n</p>\n</blockquote>",
        "id": 411440330,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1704492684
    },
    {
        "content": "<p>AccessViolation95 <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7716#issuecomment-1888047716\">commented</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7716\">issue #7716</a>:</p>\n<blockquote>\n<blockquote>\n<p>wherever you are running <code>wasm-tools component new</code> (maybe you are using cargo-component?) you need to change the wasi preview 1 adapter to the version that ships with wasmtime 16 as well</p>\n</blockquote>\n<p>I don't quite understand. Could you be more specific about how to do this? I'm having this issue as well, and for me, switching to Wasmtime 15 did not fix the issue and I don't know how to proceed.</p>\n</blockquote>",
        "id": 412429754,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1705010966
    },
    {
        "content": "<p>AccessViolation95 edited a <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7716#issuecomment-1888047716\">comment</a> on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/7716\">issue #7716</a>:</p>\n<blockquote>\n<blockquote>\n<p>wherever you are running <code>wasm-tools component new</code> (maybe you are using cargo-component?) you need to change the wasi preview 1 adapter to the version that ships with wasmtime 16 as well</p>\n</blockquote>\n<p>I don't quite understand. Could you be more specific about how to do this? I'm having this issue as well when running a modified version of <a href=\"https://component-model.bytecodealliance.org/language-support/rust.html#importing-an-interface-with-cargo-component\">one of the component model examples</a>, and for me, switching to Wasmtime 15 did not fix the issue and I don't know how to proceed.</p>\n</blockquote>",
        "id": 412430118,
        "sender_full_name": "Wasmtime GitHub notifications bot",
        "timestamp": 1705011136
    }
]