[
    {
        "content": "<p>Hey <span aria-label=\"wave\" class=\"emoji emoji-1f44b\" role=\"img\" title=\"wave\">:wave:</span> ,<br>\nI'm currently experimenting with <code>jco</code> and I'm trying to import some lib into my js file, which is then bundled with <code>esbuild --format esm</code> all is working fine for \"simple\" lib. But then when trying more  complex one I'm sometimes hit by this problem. Right now I have this one to be precise </p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">Caused</span><span class=\"w\"> </span><span class=\"n\">by</span><span class=\"p\">:</span>\n<span class=\"w\">    </span><span class=\"mi\">0</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">error</span><span class=\"w\"> </span><span class=\"k\">while</span><span class=\"w\"> </span><span class=\"n\">executing</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"n\">backtrace</span><span class=\"p\">:</span>\n<span class=\"w\">           </span><span class=\"mi\">0</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mh\">0x78705a</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!&lt;</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"mi\">9672</span><span class=\"o\">&gt;</span>\n<span class=\"w\">           </span><span class=\"mi\">1</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mh\">0x35239f</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!&lt;</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"mi\">522</span><span class=\"o\">&gt;</span>\n<span class=\"w\">           </span><span class=\"mi\">2</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mh\">0xab1cb</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!&lt;</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"mi\">79</span><span class=\"o\">&gt;</span>\n<span class=\"w\">           </span><span class=\"mi\">3</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mh\">0x3424ec</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!&lt;</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"mi\">498</span><span class=\"o\">&gt;</span>\n<span class=\"w\">           </span><span class=\"mi\">4</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mh\">0x66ac8b</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!&lt;</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"mi\">4035</span><span class=\"o\">&gt;</span>\n<span class=\"w\">           </span><span class=\"mi\">5</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mh\">0x625361</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!&lt;</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"mi\">3385</span><span class=\"o\">&gt;</span>\n<span class=\"w\">           </span><span class=\"mi\">6</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mh\">0x42288c</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!&lt;</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"mi\">940</span><span class=\"o\">&gt;</span>\n<span class=\"w\">           </span><span class=\"mi\">7</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mh\">0x4225d9</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!&lt;</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"mi\">940</span><span class=\"o\">&gt;</span>\n<span class=\"w\">           </span><span class=\"mi\">8</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mh\">0x2d00c5</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!&lt;</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"mi\">358</span><span class=\"o\">&gt;</span>\n<span class=\"w\">           </span><span class=\"mi\">9</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mh\">0x1fc7d2</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!&lt;</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"mi\">186</span><span class=\"o\">&gt;</span>\n<span class=\"w\">          </span><span class=\"mi\">10</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mh\">0x50cf05</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!&lt;</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"mi\">1721</span><span class=\"o\">&gt;</span>\n<span class=\"w\">          </span><span class=\"mi\">11</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mh\">0x338556</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">unknown</span><span class=\"o\">&gt;!&lt;</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"mi\">485</span><span class=\"o\">&gt;</span>\n<span class=\"w\">       </span><span class=\"n\">note</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">using</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">WASMTIME_BACKTRACE_DETAILS</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">environment</span><span class=\"w\"> </span><span class=\"n\">variable</span><span class=\"w\"> </span><span class=\"n\">may</span><span class=\"w\"> </span><span class=\"n\">show</span><span class=\"w\"> </span><span class=\"n\">more</span><span class=\"w\"> </span><span class=\"n\">debugging</span><span class=\"w\"> </span><span class=\"n\">information</span>\n<span class=\"w\">    </span><span class=\"mi\">1</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">Error</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">attempted</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">call</span><span class=\"w\"> </span><span class=\"n\">an</span><span class=\"w\"> </span><span class=\"n\">unknown</span><span class=\"w\"> </span><span class=\"n\">imported</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"na\">wasi</span><span class=\"p\">:</span><span class=\"nc\">random</span><span class=\"o\">/</span><span class=\"n\">random</span><span class=\"o\">@</span><span class=\"mf\">0.2.0</span><span class=\"sc\">' '</span><span class=\"n\">get</span><span class=\"o\">-</span><span class=\"n\">random</span><span class=\"o\">-</span><span class=\"kt\">u64</span><span class=\"o\">'</span>\n</code></pre></div>\n<p>Most of the time is just something not available in wasm which don't work but there the problem is different. So I'd just like to know a bit more on how to read the backtrace to checkout where in the bundle there is a problem so I can try and fix it.</p>\n<p>Thanks in advance.</p>",
        "id": 472286596,
        "sender_full_name": "kiwibe",
        "timestamp": 1727111550
    },
    {
        "content": "<p>(I've already enabled the <br>\nconst DEBUG_BINDINGS = true;)</p>",
        "id": 472286885,
        "sender_full_name": "kiwibe",
        "timestamp": 1727111639
    },
    {
        "content": "<p>Hey <span class=\"user-mention\" data-user-id=\"759666\">@kiwibe</span> it seems like that last message is the one that matters, but it's weird because that function (<code>get-randomu64</code>) is indeed in <code>wasi:random@0.2.0</code>. What version of <code>jco</code> are you using?</p>\n<p>A minimal reproduction repo would certainly be helpful, if you can share some more code!</p>",
        "id": 472619083,
        "sender_full_name": "Victor Adossi",
        "timestamp": 1727244108
    },
    {
        "content": "<p>Hey <span class=\"user-mention\" data-user-id=\"598440\">@Victor Adossi</span> I'll try to pull up a repro repo asap, but quick question on the side while I do this how could I know which line in my current JS could cause this error ?</p>",
        "id": 472629454,
        "sender_full_name": "kiwibe",
        "timestamp": 1727248895
    },
    {
        "content": "<p>So it could actually be <em>any</em> part of your code (or deps) that uses JS randomness functionality (i.e. <code>Math.random()</code>)  provided by the <a href=\"https://github.com/bytecodealliance/jco/blob/6b84470b829b54ecdef6b0f052f75cc045e52bcd/packages/preview2-shim/lib/nodejs/random.js#L34\">preview2 shim for NodeJS</a>. </p>\n<p>By default IIRC WASI random should be enabled by default, so you shouldn't have to do anything special for it.</p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/bytecodealliance/jco/blob/6b84470b829b54ecdef6b0f052f75cc045e52bcd/packages/preview2-shim/lib/nodejs/random.js#L34\" style=\"background-image: url(&quot;https://uploads.zulipusercontent.net/e9cf2755a1783742fe211c814d527bafbf499e9e/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f306261316532636538643633353931373466343339306663376537333537666233616262333466663862313538656465353938383730613433663539353730632f62797465636f6465616c6c69616e63652f6a636f&quot;)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/bytecodealliance/jco/blob/6b84470b829b54ecdef6b0f052f75cc045e52bcd/packages/preview2-shim/lib/nodejs/random.js#L34\" title=\"jco/packages/preview2-shim/lib/nodejs/random.js at 6b84470b829b54ecdef6b0f052f75cc045e52bcd · bytecodealliance/jco\">jco/packages/preview2-shim/lib/nodejs/random.js at 6b84470b829b54ecdef6b0f052f75cc045e52bcd · bytecodealliance/jco</a></div><div class=\"message_embed_description\">JavaScript toolchain for working with WebAssembly Components - bytecodealliance/jco</div></div></div>",
        "id": 472654962,
        "sender_full_name": "Victor Adossi",
        "timestamp": 1727257594
    },
    {
        "content": "<p>Oh perfect thanks I see now where it's calling this I shall be able to put an example, as soon I'm off work I'll try to do it and share it with you thanks !</p>",
        "id": 472655483,
        "sender_full_name": "kiwibe",
        "timestamp": 1727257781
    },
    {
        "content": "<p>Yeah I'm going to try and see if I can reproduce with a little repo too!</p>",
        "id": 472655593,
        "sender_full_name": "Victor Adossi",
        "timestamp": 1727257810
    },
    {
        "content": "<p>Hey <span class=\"user-mention\" data-user-id=\"759666\">@kiwibe</span> I'm not sure it'll help, but just to make sure <code>Math.random</code> was working properly with currently released stuff I made a small example (<code>jco</code> already has a great test suite so I didn't need to but just to have a self contained example you can compare to):</p>\n<p><a href=\"https://github.com/vados-cosmonic/jco-math-random-example\">https://github.com/vados-cosmonic/jco-math-random-example</a></p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/vados-cosmonic/jco-math-random-example\" style=\"background-image: url(&quot;https://uploads.zulipusercontent.net/de95c076e3aba027f5699ab5488e0658c7059c46/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f626334656633313733323333316338363734373063613133663366356362613238613762643735616462313039316630306562393436363563636133663162382f7661646f732d636f736d6f6e69632f6a636f2d6d6174682d72616e646f6d2d6578616d706c65&quot;)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/vados-cosmonic/jco-math-random-example\" title=\"GitHub - vados-cosmonic/jco-math-random-example: Example of using jco with Math.random\">GitHub - vados-cosmonic/jco-math-random-example: Example of using jco with Math.random</a></div><div class=\"message_embed_description\">Example of using jco with Math.random. Contribute to vados-cosmonic/jco-math-random-example development by creating an account on GitHub.</div></div></div>",
        "id": 472662717,
        "sender_full_name": "Victor Adossi",
        "timestamp": 1727260246
    },
    {
        "content": "<p>Hey sorry about my lag, i'm gonna give you a good reproduction soon but just to give you a bit more info the problem is originating form this line <a href=\"https://github.com/davidbau/seedrandom/blob/released/seedrandom.js#L219-L226\">https://github.com/davidbau/seedrandom/blob/released/seedrandom.js#L219-L226</a></p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/davidbau/seedrandom/blob/released/seedrandom.js#L219-L226\" style=\"background-image: url(&quot;https://uploads.zulipusercontent.net/02c617c8098a310c2517e1fe7928dfabc0bc0014/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f613234663939633363313663363237366239623266366533306239353462626561643937616336616337613634633361343865656234353565323130336439382f64617669646261752f7365656472616e646f6d&quot;)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/davidbau/seedrandom/blob/released/seedrandom.js#L219-L226\" title=\"seedrandom/seedrandom.js at released · davidbau/seedrandom\">seedrandom/seedrandom.js at released · davidbau/seedrandom</a></div><div class=\"message_embed_description\">seeded random number generator for Javascript. Contribute to davidbau/seedrandom development by creating an account on GitHub.</div></div></div>",
        "id": 474584561,
        "sender_full_name": "kiwibe",
        "timestamp": 1727960106
    },
    {
        "content": "<p>Thanks for looking into this -- interesting, I wouldn't expect <code>Math.random()</code> to fail, but if the bug is there it should be <em>really</em> easy to reproduce. </p>\n<p>As far as trying to get a small repro together, consider using one of the projects <a href=\"https://github.com/bytecodealliance/jco/pull/507/files\">in this PR here</a> -- they'll be in <code>examples</code> soon enough!</p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/bytecodealliance/jco/pull/507/files\" style=\"background-image: url(&quot;https://uploads.zulipusercontent.net/bd0632c933ac849587b2546693ee76559eb5217c/68747470733a2f2f617661746172732e67697468756275736572636f6e74656e742e636f6d2f752f3132333936383132373f733d34303026763d34&quot;)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/bytecodealliance/jco/pull/507/files\" title=\"chore(examples): add examples by vados-cosmonic · Pull Request #507 · bytecodealliance/jco\">chore(examples): add examples by vados-cosmonic · Pull Request #507 · bytecodealliance/jco</a></div><div class=\"message_embed_description\">This commit adds examples to the jco, some of which are/will be referenced from the component-model book (https://component-model.bytecodealliance.org/).</div></div></div>",
        "id": 474590834,
        "sender_full_name": "Victor Adossi",
        "timestamp": 1727962019
    },
    {
        "content": "<p>Thanks a lot for being that responsive, I shall finally have more time to dig into that, this w-e but work is taking too much of my time right now.</p>",
        "id": 474783298,
        "sender_full_name": "kiwibe",
        "timestamp": 1728034975
    }
]