[
    {
        "content": "<p>yurydelendik opened <a href=\"https://github.com/bytecodealliance/cranelift/issues/1372\" target=\"_blank\" title=\"https://github.com/bytecodealliance/cranelift/issues/1372\">Issue #1372</a>:</p>\n<blockquote>\n<p>Based on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/841\" target=\"_blank\" title=\"https://github.com/bytecodealliance/wasmtime/issues/841\">https://github.com/bytecodealliance/wasmtime/issues/841</a></p>\n<p>The following wasm function has multiple exits:</p>\n<div class=\"codehilite\"><pre><span></span>      (func $test_conditional_panic (result i64)\n        block\n          i32.const 1\n          br_if 0\n          i64.const 0\n          return\n        end\n        unreachable\n      )\n</pre></div>\n\n\n<p>It generates machine code for x86_64:</p>\n<div class=\"codehilite\"><pre><span></span>   0:   40 55                   push    rbp\n   2:   48 89 e5                mov rbp, rsp\n   5:   40 b8 01 00 00 00       mov eax, 1\n   b:   40 85 c0                test    eax, eax\n   e:   75 09                   jne 0x19\n  10:   40 b8 00 00 00 00       mov eax, 0\n  16:   40 5d                   pop rbp\n  18:   c3                      ret\n  19:   0f 0b                   ud2\n</pre></div>\n\n\n<p>The generated FDE looks like:</p>\n<ul>\n<li>at 0x02:<ul>\n<li>define cfa base as <code>RSP + 0x10</code></li>\n<li>RBP is at <code>CFA - 0x10</code></li>\n</ul>\n</li>\n<li>at 0x05:<ul>\n<li>define cfa base as <code>RBP + 0x10</code></li>\n</ul>\n</li>\n<li>at 0x18:<ul>\n<li>define cfa base as <code>RSP + 0x8</code></li>\n</ul>\n</li>\n</ul>\n<p>The issue we are having is with stack traces below first function exit, due to FDE restructuring frame info for <code>ret</code>, though not restoring it back for <code>ud2</code>.</p>\n</blockquote>",
        "id": 187159629,
        "sender_full_name": "GitHub",
        "timestamp": 1580558235
    },
    {
        "content": "<p>yurydelendik labeled <a href=\"https://github.com/bytecodealliance/cranelift/issues/1372\" target=\"_blank\" title=\"https://github.com/bytecodealliance/cranelift/issues/1372\">Issue #1372</a>:</p>\n<blockquote>\n<p>Based on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/841\" target=\"_blank\" title=\"https://github.com/bytecodealliance/wasmtime/issues/841\">https://github.com/bytecodealliance/wasmtime/issues/841</a></p>\n<p>The following wasm function has multiple exits:</p>\n<div class=\"codehilite\"><pre><span></span>      (func $test_conditional_panic (result i64)\n        block\n          i32.const 1\n          br_if 0\n          i64.const 0\n          return\n        end\n        unreachable\n      )\n</pre></div>\n\n\n<p>It generates machine code for x86_64:</p>\n<div class=\"codehilite\"><pre><span></span>   0:   40 55                   push    rbp\n   2:   48 89 e5                mov rbp, rsp\n   5:   40 b8 01 00 00 00       mov eax, 1\n   b:   40 85 c0                test    eax, eax\n   e:   75 09                   jne 0x19\n  10:   40 b8 00 00 00 00       mov eax, 0\n  16:   40 5d                   pop rbp\n  18:   c3                      ret\n  19:   0f 0b                   ud2\n</pre></div>\n\n\n<p>The generated FDE looks like:</p>\n<ul>\n<li>at 0x02:<ul>\n<li>define cfa base as <code>RSP + 0x10</code></li>\n<li>RBP is at <code>CFA - 0x10</code></li>\n</ul>\n</li>\n<li>at 0x05:<ul>\n<li>define cfa base as <code>RBP + 0x10</code></li>\n</ul>\n</li>\n<li>at 0x18:<ul>\n<li>define cfa base as <code>RSP + 0x8</code></li>\n</ul>\n</li>\n</ul>\n<p>The issue we are having is with stack traces below first function exit, due to FDE restructuring frame info for <code>ret</code>, though not restoring it back for <code>ud2</code>.</p>\n</blockquote>",
        "id": 187159630,
        "sender_full_name": "GitHub",
        "timestamp": 1580558235
    },
    {
        "content": "<p>yurydelendik edited <a href=\"https://github.com/bytecodealliance/cranelift/issues/1372\" target=\"_blank\" title=\"https://github.com/bytecodealliance/cranelift/issues/1372\">Issue #1372</a>:</p>\n<blockquote>\n<p>Based on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/841\" target=\"_blank\" title=\"https://github.com/bytecodealliance/wasmtime/issues/841\">https://github.com/bytecodealliance/wasmtime/issues/841</a></p>\n<p>The following wasm function has multiple exits:</p>\n<div class=\"codehilite\"><pre><span></span>      (func $test_conditional_panic (result i64)\n        block\n          i32.const 1\n          br_if 0\n          i64.const 0\n          return\n        end\n        unreachable\n      )\n</pre></div>\n\n\n<p>It generates machine code for x86_64:</p>\n<div class=\"codehilite\"><pre><span></span>   0:   40 55                   push    rbp\n   2:   48 89 e5                mov rbp, rsp\n   5:   40 b8 01 00 00 00       mov eax, 1\n   b:   40 85 c0                test    eax, eax\n   e:   75 09                   jne 0x19\n  10:   40 b8 00 00 00 00       mov eax, 0\n  16:   40 5d                   pop rbp\n  18:   c3                      ret\n  19:   0f 0b                   ud2\n</pre></div>\n\n\n<p>The generated FDE looks like:</p>\n<ul>\n<li>at 0x02:<ul>\n<li>define cfa base as <code>RSP + 0x10</code></li>\n<li>RBP is at <code>CFA - 0x10</code></li>\n</ul>\n</li>\n<li>at 0x05:<ul>\n<li>define cfa base as <code>RBP + 0x10</code></li>\n</ul>\n</li>\n<li>at 0x18:<ul>\n<li>define cfa base as <code>RSP + 0x8</code></li>\n</ul>\n</li>\n</ul>\n<p>The issue we are having is with stack traces below first function exit -- the FDE does not restore initial state after the <code>ret</code> for other block/branch (in our case<code>ud2</code>).</p>\n</blockquote>",
        "id": 187193461,
        "sender_full_name": "GitHub",
        "timestamp": 1580625945
    },
    {
        "content": "<p>iximeow closed <a href=\"https://github.com/bytecodealliance/cranelift/issues/1372\" target=\"_blank\" title=\"https://github.com/bytecodealliance/cranelift/issues/1372\">Issue #1372</a>:</p>\n<blockquote>\n<p>Based on <a href=\"https://github.com/bytecodealliance/wasmtime/issues/841\" target=\"_blank\" title=\"https://github.com/bytecodealliance/wasmtime/issues/841\">https://github.com/bytecodealliance/wasmtime/issues/841</a></p>\n<p>The following wasm function has multiple exits:</p>\n<div class=\"codehilite\"><pre><span></span>      (func $test_conditional_panic (result i64)\n        block\n          i32.const 1\n          br_if 0\n          i64.const 0\n          return\n        end\n        unreachable\n      )\n</pre></div>\n\n\n<p>It generates machine code for x86_64:</p>\n<div class=\"codehilite\"><pre><span></span>   0:   40 55                   push    rbp\n   2:   48 89 e5                mov rbp, rsp\n   5:   40 b8 01 00 00 00       mov eax, 1\n   b:   40 85 c0                test    eax, eax\n   e:   75 09                   jne 0x19\n  10:   40 b8 00 00 00 00       mov eax, 0\n  16:   40 5d                   pop rbp\n  18:   c3                      ret\n  19:   0f 0b                   ud2\n</pre></div>\n\n\n<p>The generated FDE looks like:</p>\n<ul>\n<li>at 0x02:<ul>\n<li>define cfa base as <code>RSP + 0x10</code></li>\n<li>RBP is at <code>CFA - 0x10</code></li>\n</ul>\n</li>\n<li>at 0x05:<ul>\n<li>define cfa base as <code>RBP + 0x10</code></li>\n</ul>\n</li>\n<li>at 0x18:<ul>\n<li>define cfa base as <code>RSP + 0x8</code></li>\n</ul>\n</li>\n</ul>\n<p>The issue we are having is with stack traces below first function exit -- the FDE does not restore initial state after the <code>ret</code> for other block/branch (in our case<code>ud2</code>).</p>\n</blockquote>",
        "id": 187310349,
        "sender_full_name": "GitHub",
        "timestamp": 1580767722
    }
]