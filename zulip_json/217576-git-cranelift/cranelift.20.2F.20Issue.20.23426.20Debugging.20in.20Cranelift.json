[
    {
        "content": "<p>alexcrichton transferred <a href=\"https://github.com/bytecodealliance/cranelift/issues/426\" target=\"_blank\" title=\"https://github.com/bytecodealliance/cranelift/issues/426\">Issue #426</a>:</p>\n<blockquote>\n<p>It's become clear that Cranelift needs the facilities to debug the compiled code.</p>\n<p>I propose implementing a trait <code>DebugSink</code> that looks something like this:</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"k\">trait</span><span class=\"w\"> </span><span class=\"n\">DebugSink</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"k\">fn</span> <span class=\"nf\">insert_inst</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"k\">mut</span><span class=\"w\"> </span><span class=\"bp\">self</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">inst</span>: <span class=\"nc\">InstructionData</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">source_loc</span>: <span class=\"nc\">SourceLoc</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">code_offset</span>: <span class=\"nc\">CodeOffset</span><span class=\"p\">);</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"k\">fn</span> <span class=\"nf\">insert_func</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"k\">mut</span><span class=\"w\"> </span><span class=\"bp\">self</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">name</span>: <span class=\"nb\">String</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">source_loc</span>: <span class=\"nc\">SourceLoc</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">code_offset</span>: <span class=\"nc\">CodeOffset</span><span class=\"p\">);</span><span class=\"w\"></span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n</pre></div>\n\n\n<p>Once <code>insert_func</code> is called, all instructions afterwards (until another function is inserted) belong to that function.</p>\n<p>It could also take on the form of two traits:</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"k\">trait</span><span class=\"w\"> </span><span class=\"n\">DebugSinkFunc</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"k\">fn</span> <span class=\"nf\">insert_inst</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"k\">mut</span><span class=\"w\"> </span><span class=\"bp\">self</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">inst</span>: <span class=\"nc\">InstructionData</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">source_loc</span>: <span class=\"nc\">SourceLoc</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">code_offset</span>: <span class=\"nc\">CodeOffset</span><span class=\"p\">);</span><span class=\"w\"></span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n\n<span class=\"k\">trait</span><span class=\"w\"> </span><span class=\"n\">DebugSink</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"k\">fn</span> <span class=\"nf\">insert_func</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"k\">mut</span><span class=\"w\"> </span><span class=\"bp\">self</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">name</span>: <span class=\"nb\">String</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">source_loc</span>: <span class=\"nc\">SourceLoc</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">code_offset</span>: <span class=\"nc\">CodeOffset</span><span class=\"p\">)</span><span class=\"w\"> </span>-&gt; <span class=\"kp\">&amp;</span><span class=\"nc\">mut</span><span class=\"w\"> </span><span class=\"n\">DebugSinkFunc</span><span class=\"w\"></span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n</pre></div>\n\n\n</blockquote>",
        "id": 189361345,
        "sender_full_name": "GitHub",
        "timestamp": 1582932277
    }
]