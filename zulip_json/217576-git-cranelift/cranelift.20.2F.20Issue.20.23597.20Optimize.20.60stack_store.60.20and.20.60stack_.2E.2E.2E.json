[
    {
        "content": "<p>alexcrichton transferred <a href=\"https://github.com/bytecodealliance/cranelift/issues/597\" target=\"_blank\" title=\"https://github.com/bytecodealliance/cranelift/issues/597\">Issue #597</a>:</p>\n<blockquote>\n<p>Currently, <code>stack_store</code> and <code>stack_load</code> are legalized into <code>stack_addr</code> followed by plain <code>store</code> and <code>load</code>, producing code like this:</p>\n<div class=\"codehilite\"><pre><span></span>    <span class=\"nf\">lea</span> <span class=\"no\">rax</span><span class=\"p\">,</span> <span class=\"no\">qword</span> <span class=\"no\">ptr</span> <span class=\"p\">[</span><span class=\"no\">rsp</span> <span class=\"err\">+</span> <span class=\"mi\">8</span><span class=\"p\">]</span>\n        <span class=\"nf\">mov</span> <span class=\"no\">qword</span> <span class=\"no\">ptr</span> <span class=\"p\">[</span><span class=\"no\">rax</span><span class=\"p\">],</span> <span class=\"no\">rdi</span>\n</pre></div>\n\n\n<p>We really want to just emit this:</p>\n<div class=\"codehilite\"><pre><span></span>        <span class=\"nf\">mov</span> <span class=\"no\">qword</span> <span class=\"no\">ptr</span> <span class=\"p\">[</span><span class=\"no\">rsp</span> <span class=\"err\">+</span> <span class=\"mi\">8</span><span class=\"p\">],</span> <span class=\"no\">rdi</span>\n</pre></div>\n\n\n<p>Options include:</p>\n<ul>\n<li>Add encoding rules for <code>stack_load</code> and <code>stack_store</code>, making them legal. This is straightforward, but if we later want to extend this to allow extending loads and narrowing stores, we'll need a bunch more instructions.</li>\n<li>Extend <code>load_complex</code>/<code>store_complex</code> to have a way represent a base pointer which is the stack pointer, and then fold <code>stack_addr</code> into <code>load</code>/<code>store</code>.</li>\n</ul>\n</blockquote>",
        "id": 189361390,
        "sender_full_name": "GitHub",
        "timestamp": 1582932318
    }
]