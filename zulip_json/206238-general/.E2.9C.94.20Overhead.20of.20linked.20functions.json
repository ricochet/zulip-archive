[
    {
        "content": "<p>I am calling some linked functions provided by the host from my guest wasm (all in Rust), and I've put some timers around the functions, and it seems like the overhead of calling a host function is 30ms?</p>\n<p>I time my host function with this:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">linker</span><span class=\"p\">.</span><span class=\"n\">func_wrap5_async</span><span class=\"p\">(</span><span class=\"s\">\"myapp\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">\"execute\"</span><span class=\"p\">,</span><span class=\"w\">  </span><span class=\"nb\">Box</span>::<span class=\"n\">new</span><span class=\"p\">(</span><span class=\"k\">async</span><span class=\"w\"> </span><span class=\"k\">move</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">start</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Instant</span>::<span class=\"n\">now</span><span class=\"p\">();</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"o\">..</span><span class=\"p\">.</span><span class=\"w\"> </span><span class=\"p\">}</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">end</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Instant</span>::<span class=\"n\">now</span><span class=\"p\">();</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"fm\">println!</span><span class=\"p\">(</span><span class=\"s\">\"Host function time: {}ms\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">end</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">start</span><span class=\"p\">).</span><span class=\"n\">as_millis</span><span class=\"p\">());</span><span class=\"w\"></span>\n<span class=\"p\">}));</span><span class=\"w\"></span>\n</code></pre></div>\n<p>And my guest code does the same:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">start</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Instant</span>::<span class=\"n\">now</span><span class=\"p\">();</span><span class=\"w\"></span>\n<span class=\"n\">host</span>::<span class=\"n\">myapp</span>::<span class=\"n\">execute</span><span class=\"p\">(</span><span class=\"err\">â€¦</span><span class=\"p\">);</span><span class=\"w\"></span>\n<span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">end</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Instant</span>::<span class=\"n\">now</span><span class=\"p\">();</span><span class=\"w\"></span>\n<span class=\"fm\">println!</span><span class=\"p\">(</span><span class=\"s\">\"Guest function time: {}ms\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">end</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">start</span><span class=\"p\">).</span><span class=\"n\">as_millis</span><span class=\"p\">());</span><span class=\"w\"></span>\n</code></pre></div>\n<p>And I get the output of:</p>\n<blockquote>\n<p>Host function time: 0ms<br>\nGuest function time: 32ms</p>\n</blockquote>\n<p><del>Is there some crazy overhead for calling host functions like this?</del></p>\n<p>Nevermind <span aria-label=\"man facepalming\" class=\"emoji emoji-1f926-200d-2642\" role=\"img\" title=\"man facepalming\">:man_facepalming:</span> I had <code>start - end</code> in the host. Should've been <code>end - start</code></p>",
        "id": 310548112,
        "sender_full_name": "Ari Seyhun",
        "timestamp": 1668663369
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"474928\">Ari Seyhun</span> has marked this topic as resolved.</p>",
        "id": 310548211,
        "sender_full_name": "Notification Bot",
        "timestamp": 1668663508
    }
]