[
    {
        "content": "<p>I'm trying to follow the guide <a href=\"https://component-model.bytecodealliance.org/language-support/csharp.html\">here</a> for compiling C# as a WASM component, but I'm getting an error:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">Restore</span><span class=\"w\"> </span><span class=\"n\">complete</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"mf\">0.4</span><span class=\"n\">s</span><span class=\"p\">)</span>\n<span class=\"n\">You</span><span class=\"w\"> </span><span class=\"n\">are</span><span class=\"w\"> </span><span class=\"n\">using</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">preview</span><span class=\"w\"> </span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"n\">NET</span><span class=\"p\">.</span><span class=\"w\"> </span><span class=\"n\">See</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">https</span><span class=\"p\">:</span><span class=\"c1\">//aka.ms/dotnet-support-policy</span>\n<span class=\"w\">  </span><span class=\"n\">dotnet</span><span class=\"o\">-</span><span class=\"n\">guest</span><span class=\"o\">-</span><span class=\"n\">test</span><span class=\"w\"> </span><span class=\"n\">failed</span><span class=\"w\"> </span><span class=\"n\">with</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"mf\">2.8</span><span class=\"n\">s</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"err\">→</span><span class=\"w\"> </span><span class=\"n\">bin</span><span class=\"o\">/</span><span class=\"n\">Debug</span><span class=\"o\">/</span><span class=\"n\">net9</span><span class=\"p\">.</span><span class=\"mi\">0</span><span class=\"o\">/</span><span class=\"n\">wasi</span><span class=\"o\">-</span><span class=\"n\">wasm</span><span class=\"o\">/</span><span class=\"n\">dotnet</span><span class=\"o\">-</span><span class=\"n\">guest</span><span class=\"o\">-</span><span class=\"n\">test</span><span class=\"p\">.</span><span class=\"n\">dll</span>\n<span class=\"w\">    </span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">seanomik</span><span class=\"o\">/</span><span class=\"p\">.</span><span class=\"n\">nuget</span><span class=\"o\">/</span><span class=\"n\">packages</span><span class=\"o\">/</span><span class=\"n\">microsoft</span><span class=\"p\">.</span><span class=\"n\">dotnet</span><span class=\"p\">.</span><span class=\"n\">ilcompiler</span><span class=\"p\">.</span><span class=\"n\">llvm</span><span class=\"o\">/</span><span class=\"mf\">10.0.0</span><span class=\"o\">-</span><span class=\"n\">alpha</span><span class=\"p\">.</span><span class=\"mf\">1.24525.6</span><span class=\"o\">/</span><span class=\"n\">build</span><span class=\"o\">/</span><span class=\"n\">Microsoft</span><span class=\"p\">.</span><span class=\"n\">NETCore</span><span class=\"p\">.</span><span class=\"n\">Native</span><span class=\"p\">.</span><span class=\"n\">targets</span><span class=\"p\">(</span><span class=\"mi\">363</span><span class=\"p\">,</span><span class=\"mi\">5</span><span class=\"p\">):</span><span class=\"w\"> </span><span class=\"nc\">error</span><span class=\"w\"> </span><span class=\"n\">MSB3073</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">The</span><span class=\"w\"> </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"s\">\"\"</span><span class=\"err\">\\</span><span class=\"n\">tools</span><span class=\"err\">\\\\</span><span class=\"n\">ilc</span><span class=\"s\">\" @\"</span><span class=\"n\">obj</span><span class=\"o\">/</span><span class=\"n\">Debug</span><span class=\"o\">/</span><span class=\"n\">net9</span><span class=\"p\">.</span><span class=\"mi\">0</span><span class=\"o\">/</span><span class=\"n\">wasi</span><span class=\"o\">-</span><span class=\"n\">wasm</span><span class=\"o\">/</span><span class=\"n\">native</span><span class=\"o\">/</span><span class=\"n\">dotnet</span><span class=\"o\">-</span><span class=\"n\">guest</span><span class=\"o\">-</span><span class=\"n\">test</span><span class=\"p\">.</span><span class=\"n\">ilc</span><span class=\"p\">.</span><span class=\"n\">rsp</span><span class=\"s\">\"\"</span><span class=\"w\"> </span><span class=\"n\">exited</span><span class=\"w\"> </span><span class=\"n\">with</span><span class=\"w\"> </span><span class=\"n\">code</span><span class=\"w\"> </span><span class=\"mf\">127.</span>\n</code></pre></div>\n<p>I'm on Arch Linux and installed <code>dotnet-sdk-preview-bin</code> to get dotnet 9.0. I tried to switch the target to 8.0, but got the same error. I even tried to downgrade dotnet to 8.0, but that didn't change anything. I tried to build the project in a podman container using <code>mcr.microsoft.com/dotnet/sdk:9.0</code> which is based off of Debian 12, but got the same error.</p>\n<p>Any help appreciated!</p>",
        "id": 480816465,
        "sender_full_name": "SeanOMik",
        "timestamp": 1730849765
    },
    {
        "content": "<p>My understanding is that componentize-dotnet and specifically the NativeAOT compiler are not supported on Linux yet, see the note under Getting Started: <a href=\"https://bytecodealliance.org/articles/simplifying-components-for-dotnet-developers-with-componentize-dotnet\">https://bytecodealliance.org/articles/simplifying-components-for-dotnet-developers-with-componentize-dotnet</a></p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://bytecodealliance.org/articles/simplifying-components-for-dotnet-developers-with-componentize-dotnet\" style=\"background-image: url(&quot;https://uploads.zulipusercontent.net/b666ca74a20745aca2566cd241108afdcfa09d04/68747470733a2f2f62797465636f6465616c6c69616e63652e6f72672f696d616765732f6176617461722e706e67&quot;)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://bytecodealliance.org/articles/simplifying-components-for-dotnet-developers-with-componentize-dotnet\" title=\"Simplifying components for .NET/C# developers with componentize-dotnet\">Simplifying components for .NET/C# developers with componentize-dotnet</a></div><div class=\"message_embed_description\">If you’re a .NET/C# developer, componentize-dotnet makes it easy to compile your code to WebAssembly components using a single tool. This Bytecode Alliance project is a NuGet package that can be used to create a fully AOT-compiled compon...</div></div></div>",
        "id": 480819398,
        "sender_full_name": "Milan",
        "timestamp": 1730851661
    },
    {
        "content": "<p>Damn, okay. I didn't see that page. Maybe I'll make a windows vm just for compiling this component then lol. I actually found a <a href=\"https://github.com/bytecodealliance/componentize-dotnet/pull/54\">PR</a> that was opened a week ago on the componentize-dotnet repo to fix linux support. I tried that fork, but it didn't fix it <span aria-label=\"sad\" class=\"emoji emoji-2639\" role=\"img\" title=\"sad\">:sad:</span> so I made a comment.</p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/bytecodealliance/componentize-dotnet/pull/54\" style=\"background-image: url(&quot;https://uploads.zulipusercontent.net/8a199806a173dfaf4e53028c08aa69deba1c7644/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f356566313635333038646431346661333064646264613732316562666133316436333165396161306666343339323935343533663763366230336365636635312f62797465636f6465616c6c69616e63652f636f6d706f6e656e74697a652d646f746e65742f70756c6c2f3534&quot;)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/bytecodealliance/componentize-dotnet/pull/54\" title=\"Remove the Windows specific dep in SDK by jsturtevant · Pull Request #54 · bytecodealliance/componentize-dotnet\">Remove the Windows specific dep in SDK by jsturtevant · Pull Request #54 · bytecodealliance/componentize-dotnet</a></div><div class=\"message_embed_description\">The reference to &lt;Import Project=&quot;build\\BytecodeAlliance.Componentize.DotNet.Wasm.SDK.props&quot; /&gt;\nwas causing the SDK to pull the Windows specific dep in at packaging time:\n dotnet li...</div></div></div>",
        "id": 480920212,
        "sender_full_name": "SeanOMik",
        "timestamp": 1730899727
    },
    {
        "content": "<p>I've used <code>componentize-dotnet</code> on Linux, although I had to hack a few files to make it work.  Since then, I <em>think</em> those fixes have been upstreamed, so I would have expected it to work out-of-the-box at this point.  <span class=\"user-mention\" data-user-id=\"625613\">@James Sturtevant</span> would you expect that to work?</p>",
        "id": 480945755,
        "sender_full_name": "Joel Dice",
        "timestamp": 1730907031
    },
    {
        "content": "<p>Its possible I'm missing a required system package. I'm pretty new to compiling C# to WASM, and relatively new to C# in general. All I did was install the dotnet 9.0 preview, the exact version is<code>9.0.100-rc.2.24474.11</code>. I have Rust stable and nightly installed. Not sure if I need to install something else.</p>",
        "id": 480946610,
        "sender_full_name": "SeanOMik",
        "timestamp": 1730907288
    },
    {
        "content": "<p>James is PDT, so he'll not quite be up yet..... but I think Joel is correct.</p>",
        "id": 480948429,
        "sender_full_name": "Ralph",
        "timestamp": 1730907854
    },
    {
        "content": "<p>It does work on Linux but there is a bug when the pacakges are published to nuget via a Windows machine: It always hard links the windows LLVM compiler: <a href=\"https://github.com/bytecodealliance/componentize-dotnet/issues/55\">https://github.com/bytecodealliance/componentize-dotnet/issues/55</a>.  If you build the pacakge on linux you get the opposite affect.</p>\n<p>After adding componentize-dotnet dep, You should be able to manualy add the correct LLVM pacakge with: <code>dotnet add runtime.linux-x64.Microsoft.DotNet.ILCompiler.LLVM </code>.  If you are on the latest preview of .net9 then a <code>dotnet publish</code> is required to generate the package.</p>\n<p>Been working on resolving this in <a href=\"https://github.com/bytecodealliance/componentize-dotnet/pull/54\">https://github.com/bytecodealliance/componentize-dotnet/pull/54</a>  but ran into some issues with the latest  preview version on .net9, mainly some of the build flags changed  leading to the same issues you've seen in <a href=\"https://github.com/bytecodealliance/componentize-dotnet/pull/54#issuecomment-2459742388\">https://github.com/bytecodealliance/componentize-dotnet/pull/54#issuecomment-2459742388</a></p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/bytecodealliance/componentize-dotnet/issues/55\" style=\"background-image: url(&quot;https://uploads.zulipusercontent.net/7518913aaf554b8ced9726901b2855a69d8eef17/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f303536666332373131643561633564346639346334363633343565393264623865316139623932396535646330323162633161636533633266666666633635332f62797465636f6465616c6c69616e63652f636f6d706f6e656e74697a652d646f746e65742f6973737565732f3535&quot;)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/bytecodealliance/componentize-dotnet/issues/55\" title=\"Fix componentize-dotnet for Linux · Issue #55 · bytecodealliance/componentize-dotnet\">Fix componentize-dotnet for Linux · Issue #55 · bytecodealliance/componentize-dotnet</a></div><div class=\"message_embed_description\">Currently the package only pulls in the Windows version of the runtime packages: runtime.win-x64.Microsoft.DotNet.ILCompiler.LLVM It should do this for the version that it is running against. #54 i...</div></div></div><div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/bytecodealliance/componentize-dotnet/pull/54\" style=\"background-image: url(&quot;https://uploads.zulipusercontent.net/8a199806a173dfaf4e53028c08aa69deba1c7644/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f356566313635333038646431346661333064646264613732316562666133316436333165396161306666343339323935343533663763366230336365636635312f62797465636f6465616c6c69616e63652f636f6d706f6e656e74697a652d646f746e65742f70756c6c2f3534&quot;)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/bytecodealliance/componentize-dotnet/pull/54\" title=\"Remove the Windows specific dep in SDK by jsturtevant · Pull Request #54 · bytecodealliance/componentize-dotnet\">Remove the Windows specific dep in SDK by jsturtevant · Pull Request #54 · bytecodealliance/componentize-dotnet</a></div><div class=\"message_embed_description\">The reference to &lt;Import Project=&quot;build\\BytecodeAlliance.Componentize.DotNet.Wasm.SDK.props&quot; /&gt;\nwas causing the SDK to pull the Windows specific dep in at packaging time:\n dotnet li...</div></div></div><div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/bytecodealliance/componentize-dotnet/pull/54#issuecomment-2459742388\" style=\"background-image: url(&quot;https://uploads.zulipusercontent.net/8a199806a173dfaf4e53028c08aa69deba1c7644/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f356566313635333038646431346661333064646264613732316562666133316436333165396161306666343339323935343533663763366230336365636635312f62797465636f6465616c6c69616e63652f636f6d706f6e656e74697a652d646f746e65742f70756c6c2f3534&quot;)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/bytecodealliance/componentize-dotnet/pull/54#issuecomment-2459742388\" title=\"Remove the Windows specific dep in SDK by jsturtevant · Pull Request #54 · bytecodealliance/componentize-dotnet\">Remove the Windows specific dep in SDK by jsturtevant · Pull Request #54 · bytecodealliance/componentize-dotnet</a></div><div class=\"message_embed_description\">The reference to &lt;Import Project=&quot;build\\BytecodeAlliance.Componentize.DotNet.Wasm.SDK.props&quot; /&gt;\nwas causing the SDK to pull the Windows specific dep in at packaging time:\n dotnet li...</div></div></div>",
        "id": 480959846,
        "sender_full_name": "James Sturtevant",
        "timestamp": 1730911323
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"739973\">SeanOMik</span> <a href=\"#narrow/channel/206238-general/topic/Errors.20when.20compiling.20C.23.20as.20a.20WASM.20component.20with.20wit.20world/near/480920212\">said</a>:</p>\n<blockquote>\n<p>Maybe I'll make a windows vm just for compiling this component then lol.</p>\n</blockquote>\n<p>I would try building it using the Windows version running in Wine, it may work just fine.</p>",
        "id": 481048902,
        "sender_full_name": "Jacob Lifshay",
        "timestamp": 1730958073
    },
    {
        "content": "<p>in my experience installing Wine is much easier than creating a Windows VM (unless you already have a VM image lying around)</p>",
        "id": 481049177,
        "sender_full_name": "Jacob Lifshay",
        "timestamp": 1730958280
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"625613\">James Sturtevant</span> <a href=\"#narrow/channel/206238-general/topic/Errors.20when.20compiling.20C.23.20as.20a.20WASM.20component.20with.20wit.20world/near/480959846\">said</a>:</p>\n<blockquote>\n<p>It does work on Linux but there is a bug when the pacakges are published to nuget via a Windows machine: It always hard links the windows LLVM compiler: <a href=\"https://github.com/bytecodealliance/componentize-dotnet/issues/55\">https://github.com/bytecodealliance/componentize-dotnet/issues/55</a>.  If you build the pacakge on linux you get the opposite affect.</p>\n<p>After adding componentize-dotnet dep, You should be able to manualy add the correct LLVM pacakge with: <code>dotnet add runtime.linux-x64.Microsoft.DotNet.ILCompiler.LLVM </code>.  If you are on the latest preview of .net9 then a <code>dotnet publish</code> is required to generate the package.</p>\n</blockquote>\n<p>That fixed it, that must have been what I was missing! I struggled a bit with getting my wit world to work with bindgen, but eventually figured it out. Thanks!!</p>",
        "id": 481212141,
        "sender_full_name": "SeanOMik",
        "timestamp": 1731019774
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"315881\">Jacob Lifshay</span> <a href=\"#narrow/channel/206238-general/topic/Errors.20when.20compiling.20C.23.20as.20a.20WASM.20component.20with.20wit.20world/near/481048902\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"739973\">SeanOMik</span> <a href=\"#narrow/channel/206238-general/topic/Errors.20when.20compiling.20C.23.20as.20a.20WASM.20component.20with.20wit.20world/near/480920212\">said</a>:</p>\n<blockquote>\n<p>Maybe I'll make a windows vm just for compiling this component then lol.</p>\n</blockquote>\n<p>I would try building it using the Windows version running in Wine, it may work just fine.</p>\n</blockquote>\n<p>I'll have to try that if I do end up needing it. I wasn't sure it would work on wine since its dev stuff, not application stuff, but its worth a shot next time.</p>",
        "id": 481212273,
        "sender_full_name": "SeanOMik",
        "timestamp": 1731019850
    },
    {
        "content": "<p>Glad it worked!  I am trying to resolve that issue to make a smoother expereince but msbuild hasn't played nicely so far.</p>",
        "id": 481349327,
        "sender_full_name": "James Sturtevant",
        "timestamp": 1731083849
    }
]