[
    {
        "content": "<p>Hi, I'm trying to set up development environment for the wasmtime project, but struggling with some wierd rust-analyzer experiences.</p>\n<p>Current environment: Aarch64, MacOS 13, VSCode, Rust 1.65(1.64 seems same), rust-analyzer v0.3.1293 (latest), wasmtime <code>42d460f3a67ef5fdcf072d30a7751c1bd975272e</code> (main, latest)<br>\n<code>.vscode/settings.json</code>(suggested by <code>bjorn3</code>, see <a href=\"#narrow/stream/206238-general/topic/Can.20you.20share.20your.20IDE.20settings.20for.20wasmtime.3F/near/310826572\">https://bytecodealliance.zulipchat.com/#narrow/stream/206238-general/topic/Can.20you.20share.20your.20IDE.20settings.20for.20wasmtime.3F/near/310826572</a>):</p>\n<div class=\"codehilite\" data-code-language=\"JSON\"><pre><span></span><code><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"nt\">\"rust-analyzer.checkOnSave.features\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"s2\">\"wasmtime/cranelift\"</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">],</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"nt\">\"rust-analyzer.cargo.features\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"s2\">\"wasmtime/cranelift\"</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">],</span><span class=\"w\"></span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n</code></pre></div>\n<p>First problem: Type mismatch on <code>src/commands/run.rs</code>, only on rust-analyzer: <code>expected &amp;mut {unknown}, found &amp;mut Linker&lt;Host&gt;</code><br>\n<a href=\"/user_uploads/15107/vnA96t90YG2NPmhgwlPpBfMS/image.png\">image.png</a> <br>\nSeems like the <code>define_wasi!</code> macro defining <code>add_to_linker</code> is the cause, but I couldn't find any solution yet.</p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/15107/vnA96t90YG2NPmhgwlPpBfMS/image.png\" title=\"image.png\"><img src=\"/user_uploads/15107/vnA96t90YG2NPmhgwlPpBfMS/image.png\"></a></div><p>Second problem: rust-analyzer does nothing on <code>wasmtime</code> crate, except syntax checks. If I do create invalid expressions like adding i32 and Modules on <code>crates/wasmtime/modules.rs</code>, no complains made by rust-analyzer but <code>cargo check</code> fails.</p>\n<p><a href=\"/user_uploads/15107/5GVXmFkiHhd1CEaVMy97WMS0/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/15107/5GVXmFkiHhd1CEaVMy97WMS0/image.png\" title=\"image.png\"><img src=\"/user_uploads/15107/5GVXmFkiHhd1CEaVMy97WMS0/image.png\"></a></div><p>Also every code annotated by #[cfg(compiler)] is greyed out on the <code>wasmtime</code> crate. The <code>build.rs</code> of it dynamically defines <code>rust-cfg=compiler</code> so rust-analyzer is not recognizing this? <span aria-label=\"shrug\" class=\"emoji emoji-1f937\" role=\"img\" title=\"shrug\">:shrug:</span> </p>\n<p><a href=\"/user_uploads/15107/ny3oXhymwWM9V4RBO8XT5WOS/image.png\">image.png</a><br>\n(a workaround is setting <code>RUSTFLAGS</code> on <code>rust-analyzer.{cargo, checkOnSave}.extraEnv</code>, but I'm not confident if this is the right path)</p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/15107/ny3oXhymwWM9V4RBO8XT5WOS/image.png\" title=\"image.png\"><img src=\"/user_uploads/15107/ny3oXhymwWM9V4RBO8XT5WOS/image.png\"></a></div><p>These greatly harm development experience and I'm looking for a help to troubleshoot this. Thanks in advance.</p>",
        "id": 312038034,
        "sender_full_name": "Nam Junghyun",
        "timestamp": 1669303083
    },
    {
        "content": "<p>Also I tried re-opening this project on Debian Bullseye Docker container, but the same errors occur :(</p>",
        "id": 312038200,
        "sender_full_name": "Nam Junghyun",
        "timestamp": 1669303137
    }
]