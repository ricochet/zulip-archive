[
    {
        "content": "<p>bjorn: thanks. will come back to that if I need it. will stick to wasm-c-api only for now. extensions if I need them.</p>",
        "id": 195563557,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588080485
    },
    {
        "content": "<p>you got this weird typedef/enum clash going on. visual studio doesn't like it.</p>\n<p>typedef uint8_t wasmtime_opt_level_t;<br>\nenum wasmtime_opt_level_enum { // OptLevel<br>\n  WASMTIME_OPT_LEVEL_NONE,<br>\n  WASMTIME_OPT_LEVEL_SPEED,<br>\n  WASMTIME_OPT_LEVEL_SPEED_AND_SIZE,<br>\n};</p>",
        "id": 195563926,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588080634
    },
    {
        "content": "<p>I don't care as going wasm-c-api direct so can work around it but fyi</p>",
        "id": 195564362,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588080799
    },
    {
        "content": "<p>should change my subject as this isn't WMRT, its wasmtime :)</p>",
        "id": 195564554,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588080877
    },
    {
        "content": "<p>Great to hear that you have initial things working! Please do let us know about issues as you find themâ€”this is great feedback!</p>",
        "id": 195564638,
        "sender_full_name": "Till Schneidereit",
        "timestamp": 1588080916
    },
    {
        "content": "<p>As <span class=\"user-mention\" data-user-id=\"271313\">@Benjamin Brittain</span> says, Wasmtime supports the wasm-c-api. It does have some additions, such as support for WASI, but those might not be immediately relevant to your use case, at least to begin with</p>",
        "id": 195564775,
        "sender_full_name": "Till Schneidereit",
        "timestamp": 1588080970
    },
    {
        "content": "<p>yeah, nothing like hitting something for real to see what happens :)</p>\n<p>looks like I should be able to get the basics up &amp; running from here. so lets see ...</p>\n<p>cheers guys :)</p>",
        "id": 195564841,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588081010
    },
    {
        "content": "<p>(it also has a few things stubbed out like <code>wasm_frame_instance</code>)</p>",
        "id": 195564853,
        "sender_full_name": "Benjamin Brittain",
        "timestamp": 1588081020
    },
    {
        "content": "<p>good point on the stubs, yes. There are some corners of the api that we've only filled in as needed</p>",
        "id": 195565172,
        "sender_full_name": "Till Schneidereit",
        "timestamp": 1588081182
    },
    {
        "content": "<p>runs, works as expected. clean exit. </p>\n<p>&lt;&gt;&lt;&gt; contact :)</p>",
        "id": 195565528,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588081338
    },
    {
        "content": "<p>for clean wasm-c-api, standard wasm.h header can be used with wasmtime-c-api, wasmtime.h and wasi.h just for extras</p>",
        "id": 195565905,
        "sender_full_name": "Yury Delendik",
        "timestamp": 1588081545
    },
    {
        "content": "<p>had no joy compiling against your extras &amp; as noob don't need them just yet. pushed me to the standard stuff where I should be anyway so all good. can look at how to interface to your extensions when I get that far. cheers.</p>",
        "id": 195566359,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588081724
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"297332\">@Steve Williams</span> oh one important thing to note is that the examples in the repo should be up-to-date, but they need to be paired with the same version of wasmtime. There's been a number of changes to wasmtime-specific APIs since 0.15.0 so if you're using the examples in the repo you'll likely need to use the dev releases</p>",
        "id": 195572647,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1588084426
    },
    {
        "content": "<p>yup - understood. getting my head around standard wasm-c-api first :) </p>\n<p>thanks. don't suppose there's a chatroom for that somewhere as that's not really what this room's for.</p>",
        "id": 195578033,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588086574
    },
    {
        "content": "<p>thinking where to start. we've had versions of our scripting interface in javascript, java, csharp and native.</p>\n<p>as I like c++, found this : <a href=\"https://github.com/alexnoz/wasm-class-sample/blob/master/dog.cc\" title=\"https://github.com/alexnoz/wasm-class-sample/blob/master/dog.cc\">https://github.com/alexnoz/wasm-class-sample/blob/master/dog.cc</a></p>\n<p>maybe start there, which is comfortable for me, but not necessarily for webdevs.</p>\n<p>this is a bit off topic for here but anyone for insight for what's the cleanest performant web assembly source language that will suit webdevs ?</p>\n<p>with an example &amp; means of compilation. the easier it is, the better as we're going for accessibility here.</p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/alexnoz/wasm-class-sample/blob/master/dog.cc\" style=\"background-image: url(https://avatars2.githubusercontent.com/u/22446806?s=400&amp;v=4)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/alexnoz/wasm-class-sample/blob/master/dog.cc\" title=\"alexnoz/wasm-class-sample\">alexnoz/wasm-class-sample</a></div><div class=\"message_embed_description\">A simple C++ WASM demo. Contribute to alexnoz/wasm-class-sample development by creating an account on GitHub.</div></div></div>",
        "id": 195579571,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588087190
    },
    {
        "content": "<p>maybe I do start there. gets me a class. I'll want instances of the class to connect to their native equivalent somehow. have done this before by having a master engine class which generates instances of things, which creates the instances inside a callback, which binds in a native instance, which should be hidden from the runtime view. the native pointer is accessible from within native callbacks. </p>\n<p>that's too much for here. sorry thinking out loud. I'll shut up and just do it :)</p>",
        "id": 195581169,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588087830
    },
    {
        "content": "<p>Note that that example uses Emscripten, which means that it won't work with Wasmtime, as Wasmtime doesn't support Emscripten's ABI</p>",
        "id": 195582766,
        "sender_full_name": "Till Schneidereit",
        "timestamp": 1588088492
    },
    {
        "content": "<p>that's gold, thanks :) care to suggest something that will work ?</p>",
        "id": 195582903,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588088534
    },
    {
        "content": "<p>As for source languages, I think Rust and AssemblyScript are the best supported ones right now, and are generally seen pretty positively by webdevs. C++ might work, but is seen as much scarier by most webdevs</p>",
        "id": 195583039,
        "sender_full_name": "Till Schneidereit",
        "timestamp": 1588088591
    },
    {
        "content": "<p>the problem is that right now you need some kind of binding layer for being able to communicate using high-level data types (as opposed to just numbers). <a href=\"https://github.com/WebAssembly/interface-types\" title=\"https://github.com/WebAssembly/interface-types\">Interface Types</a> will address that, but neither is the spec done, nor do we have a complete implementation in Wasmtime, nor is there a C++ toolchain for them <span aria-label=\"confused\" class=\"emoji emoji-1f615\" role=\"img\" title=\"confused\">:confused:</span></p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/WebAssembly/interface-types\" style=\"background-image: url(https://avatars3.githubusercontent.com/u/11578470?s=400&amp;v=4)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/WebAssembly/interface-types\" title=\"WebAssembly/interface-types\">WebAssembly/interface-types</a></div><div class=\"message_embed_description\">Contribute to WebAssembly/interface-types development by creating an account on GitHub.</div></div></div>",
        "id": 195583291,
        "sender_full_name": "Till Schneidereit",
        "timestamp": 1588088700
    },
    {
        "content": "<p>I know that both <span class=\"user-mention\" data-user-id=\"254083\">@Dan Gohman</span> and <span class=\"user-mention\" data-user-id=\"253990\">@fitzgen (he/him)</span> had sketches of a C++ bindings layer that could work, but I don't think there's anything you could just take and run with</p>",
        "id": 195583393,
        "sender_full_name": "Till Schneidereit",
        "timestamp": 1588088752
    },
    {
        "content": "<p>hmmmmm ....</p>",
        "id": 195583514,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588088794
    },
    {
        "content": "<p>don't need anything fancy. I can get objects into native callbacks. if I have a void * I can scribble in there, I can tag in our native thing and in a destructor, remove it, with access in any of the methods. if you don't have a void * I can scribble in, doesn't sound the hardest job ever to add one.</p>",
        "id": 195583985,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588088980
    },
    {
        "content": "<p>&amp; that wouldn't be accessible script side so would be safe &amp; secure.</p>",
        "id": 195584038,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588088999
    },
    {
        "content": "<p>binding all this is the tricky bit. I've done it with other scripting APIs so just going at it should get me to the point of identifying what's missing, if anything.</p>",
        "id": 195584202,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588089055
    },
    {
        "content": "<p>looking for a simple assemblyscript exampel, bit like the Dog C++ one above. no joy thus far.</p>",
        "id": 195584569,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588089216
    },
    {
        "content": "<p>assuming its a bit like javascript, which would keep current webdevs happy, but I know nothing - this is all new to me.</p>",
        "id": 195584660,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588089254
    },
    {
        "content": "<p>realize you guys like your rust &amp; we'll support that in due course, just don't think its the smart move right now as it does nt help migrate existing web apps over.</p>",
        "id": 195584732,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588089289
    },
    {
        "content": "<p>I'm here - noob on multiple fronts whilst just about to write something tricky :)</p>\n<p><a href=\"https://www.sitepen.com/blog/getting-started-with-assemblyscript/\" title=\"https://www.sitepen.com/blog/getting-started-with-assemblyscript/\">https://www.sitepen.com/blog/getting-started-with-assemblyscript/</a></p>\n<p>gets my head in the right place. so assemblyscript it is. coz easy ish. will learn it as I go, I suppose :)</p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://www.sitepen.com/blog/getting-started-with-assemblyscript/\" style=\"background-image: url(https://www.sitepen.com/wp-content/uploads/2020/01/og_imageV1.jpg)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://www.sitepen.com/blog/getting-started-with-assemblyscript/\" title=\"Getting Started with AssemblyScript\">Getting Started with AssemblyScript</a></div><div class=\"message_embed_description\">In a previous post we looked at how to compile the popular programming language Go to WebAssembly. WebAssembly is a new programming language which provides a compact binary format for the web. In this post weâ€™ll explore another WebAssembly target language called AssemblyScript. AssemblyScript allows developers to write strictly typed TypeScript (a typed superset of â€¦</div></div></div>",
        "id": 195585842,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588089712
    },
    {
        "content": "<p>think I'm in the scripting twilight zone :)</p>",
        "id": 195586290,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588089886
    },
    {
        "content": "<p>here's the bit I don't understand. my native c++ engine instantiates wasmtime. wasmtime loads a wasm binary. that wasm binary asks what invoked it (my c++ thing) to create a Foo. how does whatever compiles <a href=\"http://mything.as\" title=\"http://mything.as\">mything.as</a> know the class Foo exists ? in .net I had a bootstrap assembly we referenced in with all this stuff defined in it.</p>",
        "id": 195587514,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588090301
    },
    {
        "content": "<p>here's a snippet from our mono csharp bootstrap.</p>\n<p>public class Zone<br>\n   {<br>\n      [DllImport(\"__Internal\")] static extern IntPtr Zone_CreateNative();</p>\n<div class=\"codehilite\"><pre><span></span><code>  public Zone()\n     {\n          m_native = Zone_CreateNative();\n     }\n\n    IntPtr m_native;\n</code></pre></div>\n\n\n<p>}</p>\n<p>Its not ideal, as the native pointer is visible script side but hopefully you can see what I'm trying to do.</p>",
        "id": 195587720,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588090391
    },
    {
        "content": "<p>assemblyscript looks like rust, think I'm being conneed into migrating to rust here :) but whatever. web assembly is language neutral so can backtrack later :)</p>",
        "id": 195588068,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588090535
    },
    {
        "content": "<p>so, from what I've seen, callbacks into trusted native code can be compiled or at least referenced.</p>",
        "id": 195588292,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588090623
    },
    {
        "content": "<p>Then you have </p>\n<p>[DllImport(\"__Internal\")] static extern void Zone_SomeMethod(IntPtr  native);</p>\n<p>void Zone::SomeMethod()<br>\n{<br>\n     Zone_SomeMethod(m_native);<br>\n}</p>\n<p>... to hook native interop into the scripted equivalent.</p>\n<p>that probaby has some fancy comp sci terminology I don't understand. I just do it :)</p>",
        "id": 195589088,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588090991
    },
    {
        "content": "<p>it works &amp; looks like it'll work again, but I don't want the script to be able to see its m_native handle as modifying a native pointer would be bad. as would doing unsupported things with it such as swapping handles between two instances or any other hackery.</p>",
        "id": 195589268,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588091074
    },
    {
        "content": "<p>equivalent of __Internal in mono appears to be this stuff in wasm text thingy. </p>\n<p>(func $print (import \"\" \"print\") (param i32) (result i32))<br>\n  (func $closure (import \"\" \"closure\") (result i32))</p>\n<p>which then gets bound by the runtime as per the examples.</p>\n<p>so just a case of figuring out the syntax for that bit.</p>\n<p>guessing I can compile that into a module other wasm stuff can bind to ... equivalent of our mono bootstrap.dll</p>\n<p>but I have no idea yet as new to this stuff :)</p>",
        "id": 195596446,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588094010
    },
    {
        "content": "<p>so ... I can hack together a bunch of import functions into a wsm text thingy, which our runtime will load &amp; fix up the pointers as per sample code examples. what I don't understand is how a wasm thing I'm compiling knows about this stuff.</p>",
        "id": 195598374,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588094783
    },
    {
        "content": "<p>something like this ?</p>\n<p><a href=\"https://github.com/AssemblyScript/assemblyscript/blob/master/tests/compiler/external.ts\" title=\"https://github.com/AssemblyScript/assemblyscript/blob/master/tests/compiler/external.ts\">https://github.com/AssemblyScript/assemblyscript/blob/master/tests/compiler/external.ts</a></p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/AssemblyScript/assemblyscript/blob/master/tests/compiler/external.ts\" style=\"background-image: url(https://avatars3.githubusercontent.com/u/28916798?s=400&amp;v=4)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/AssemblyScript/assemblyscript/blob/master/tests/compiler/external.ts\" title=\"AssemblyScript/assemblyscript\">AssemblyScript/assemblyscript</a></div><div class=\"message_embed_description\">Definitely not a TypeScript to WebAssembly compiler ðŸš€ - AssemblyScript/assemblyscript</div></div></div>",
        "id": 195598746,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588094969
    },
    {
        "content": "<p>going right to basics, we got this as the simples wasm example.</p>\n<p><a href=\"https://github.com/WebAssembly/wasm-c-api/blob/master/example/hello.wat\" title=\"https://github.com/WebAssembly/wasm-c-api/blob/master/example/hello.wat\">https://github.com/WebAssembly/wasm-c-api/blob/master/example/hello.wat</a></p>\n<p>which is a precompiled script in text format. what might be the equivalent of that in assemblyscript.</p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/WebAssembly/wasm-c-api/blob/master/example/hello.wat\" style=\"background-image: url(https://avatars3.githubusercontent.com/u/11578470?s=400&amp;v=4)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/WebAssembly/wasm-c-api/blob/master/example/hello.wat\" title=\"WebAssembly/wasm-c-api\">WebAssembly/wasm-c-api</a></div><div class=\"message_embed_description\">Wasm C API prototype. Contribute to WebAssembly/wasm-c-api development by creating an account on GitHub.</div></div></div>",
        "id": 195599210,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588095146
    },
    {
        "content": "<p>ahhh :)</p>\n<p><a href=\"https://assemblyscript.org/docs/std/\" title=\"https://assemblyscript.org/docs/std/\">https://assemblyscript.org/docs/std/</a></p>\n<p>sorry, too much thinking out loud.</p>",
        "id": 195599930,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588095481
    },
    {
        "content": "<p>I got this as my first I have no clue what I'm doing rough block out. have no idea if it compiles yet :)</p>\n<p><a href=\"https://pastebin.com/GBz9HtuP\" title=\"https://pastebin.com/GBz9HtuP\">https://pastebin.com/GBz9HtuP</a></p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://pastebin.com/GBz9HtuP\" style=\"background-image: url(https://pastebin.com/i/facebook.png)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://pastebin.com/GBz9HtuP\" title=\"  //export declare namespace infinity   //{    //@external(&quot;bootstrap&quot;)  export  - Pastebin.com\">  //export declare namespace infinity   //{    //@external(\"bootstrap\")  export  - Pastebin.com</a></div></div></div>",
        "id": 195602015,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588096345
    },
    {
        "content": "<p>if I can get something like that to at least run, that gets us to roughly where we were with mono. can then worry about how to lock down the native pointer &amp; perhaps specifiy it better as it doesn't need to be 64 bit on 32 bit run times.</p>",
        "id": 195602202,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588096449
    },
    {
        "content": "<p>ooh, we got uintptr type. that's better. </p>\n<p>sorry :)</p>",
        "id": 195602835,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588096745
    },
    {
        "content": "<p>hi. me again, with trivial questions. wanting to experiment with assemblyscript. I'm on windows (can use linux, but I want a windows end-end solution asap). so I need asc.exe to compile. finding one seems harder than I'd expect. any clues ?</p>",
        "id": 195672882,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588146966
    },
    {
        "content": "<p>found assemblyscript discord channel, so can ask issues specific to that tool chain over there rather than bother you lot :) sorry.</p>",
        "id": 195674160,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588147652
    },
    {
        "content": "<p>yeah, I think the ASC Discord channel is probably better for these questionsâ€”lots more people with good knowledge of that toolchain than here <span aria-label=\"slight smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"slight smile\">:slight_smile:</span></p>",
        "id": 195693858,
        "sender_full_name": "Till Schneidereit",
        "timestamp": 1588159495
    },
    {
        "content": "<p>Its a whole world of pain. their toolchain relies on node.js which is a whole ecosystem I'd like to avoid. so I'm trying emscripten after you said not supported coz I don't see the problem if I keep within your constraints &amp; not wanting to lose my mind with crate weirdnesses either :)</p>",
        "id": 195698570,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588162302
    },
    {
        "content": "<p>think I'm getting old, I just want to have a source file and have it compile. I don't want to install zigabytes of junk with weird names for stuff.<br>\nI learnt a crate is a library. library is a fine word. we don't need to rename things :)</p>",
        "id": 195698675,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588162362
    },
    {
        "content": "<p>this is the problem with open sores software, it gets way too nerdy. I like to keep things simple :) rant over :)</p>",
        "id": 195698727,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588162400
    },
    {
        "content": "<p>If your target audience are webdevs, I'm really skeptical C++ is the language to go with, but anyway, I hope things work out</p>",
        "id": 195698767,
        "sender_full_name": "Till Schneidereit",
        "timestamp": 1588162423
    },
    {
        "content": "<p>absolutely, but right now, my audience is me to get our wasm stuff talking to our native stuff and I'm a c++ guy.</p>",
        "id": 195698897,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588162508
    },
    {
        "content": "<p>(I will point out that while pears are <em>very</em> similar to apples indeed, it still makes sense to not call them apples)</p>",
        "id": 195698912,
        "sender_full_name": "Till Schneidereit",
        "timestamp": 1588162523
    },
    {
        "content": "<p>once wasm -&gt; native is working, we can hook up various languages on top of wasm.</p>",
        "id": 195698921,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588162534
    },
    {
        "content": "<p>that being the point. everyone can use whatever high level stuff they want once the interfaces are established.</p>",
        "id": 195699077,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588162627
    },
    {
        "content": "<p>your stuff is nice - its all the stuff over this that's got holes all over the place.</p>",
        "id": 195699323,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588162771
    },
    {
        "content": "<p>emscripten may not be ideal, but it actually installs without too many weirdnesses and actually compiles its own examples with errors.<br>\nif assemblyscript did that, I'd be using assemblyscript :)</p>",
        "id": 195701093,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588163724
    },
    {
        "content": "<p>given assemblyscript targets your runtime, it'd be nice if it compiled itself to target your runtime. then node.js weirdnesses can get trashed.</p>",
        "id": 195701248,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588163815
    },
    {
        "content": "<p>before I dive into this any further, how are you guys doing performance wise vs .net assembly mono &amp; microsoft implementations - close or miles out at this point. not sure how mature this stuff is. in fact, haven't much of a clue if ready for prime time.</p>",
        "id": 195704291,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588165263
    },
    {
        "content": "<p>I don't think those are directly comparable, because the source languages are so different. Going from C++ or Rust, you should expect something along the lines of 50% of native performance for most usage. Not sure for AssemblyScript, but then there's no \"native\" version of that ...</p>\n<p>Fastly have a very different use case from yours, but for that they have pretty impressive results: <a href=\"https://www.fastly.com/blog/lucet-performance-and-lifecycle\" title=\"https://www.fastly.com/blog/lucet-performance-and-lifecycle\">https://www.fastly.com/blog/lucet-performance-and-lifecycle</a></p>\n<p>(Fastly is using a different runtime, Lucet, which is a sibling to Wasmtime and pretty much the same wrt to runtime performance)</p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://www.fastly.com/blog/lucet-performance-and-lifecycle\" style=\"background-image: url(https://www.fastly.com/assets/blog/announcements-df453f33398ed75b7682429236182ebdc698e9d227e3c183cf3ef3f6769250ed.png?canvas=1200:630&amp;width=1200&amp;height=630&amp;fit=bounds&amp;bg-color=FFFFFF)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://www.fastly.com/blog/lucet-performance-and-lifecycle\" title=\"Lucet's performance and lifecycle\">Lucet's performance and lifecycle</a></div><div class=\"message_embed_description\">Lucet, Fastly's open source WebAssembly compiler and runtime system, is designed to take WebAssembly beyond the browser. This post will introduce each step in the Lucet lifecycle, and benchmark its performance to highlight how we keep overhead low. </div></div></div>",
        "id": 195705019,
        "sender_full_name": "Till Schneidereit",
        "timestamp": 1588165550
    },
    {
        "content": "<p>thanks I'd like to see the results of the same benchmark running on .net and wasmtime on the same machine. mono &amp; ms for .net.</p>",
        "id": 195705485,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588165739
    },
    {
        "content": "<p>not your problem, obv, but that's what I'd like to see.</p>",
        "id": 195705513,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588165753
    },
    {
        "content": "<p>so, performance aside, lets look at practicalities. here's my minimal c++ testcase &amp; an extract of what emcc spits out.</p>\n<p><a href=\"https://pastebin.com/r2H23Bqw\" title=\"https://pastebin.com/r2H23Bqw\">https://pastebin.com/r2H23Bqw</a></p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://pastebin.com/r2H23Bqw\" style=\"background-image: url(https://pastebin.com/i/facebook.png)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://pastebin.com/r2H23Bqw\" title=\"extern &quot;C&quot;  {  void *Zone_CreateNative();  }    class Zone  {  public:  \tZone()  - Pastebin.com\">extern \"C\"  {  void *Zone_CreateNative();  }    class Zone  {  public:  \tZone()  - Pastebin.com</a></div></div></div>",
        "id": 195705775,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588165880
    },
    {
        "content": "<p>Zone_CreateNative is my experimental wasm callback thingy I can fix up as per wasm-c-api example.</p>",
        "id": 195706051,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588165972
    },
    {
        "content": "<p>the others are concerning. I don't understand how they resolve. is this why you were saying don't use emcc ?</p>",
        "id": 195706188,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588166025
    },
    {
        "content": "<p>don't even want to do it quite like that, but I'd expect one unresolved from that. happy to switch languages to get what I need. doesn't have to be c++. just want to get into solution space asap. not have holes.</p>",
        "id": 195706445,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588166140
    },
    {
        "content": "<p>is this one for the emcc guys ?</p>",
        "id": 195706608,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588166202
    },
    {
        "content": "<p>ie. how to get it to spit out entirely resolved output. (except for anything deliberately external)</p>",
        "id": 195706671,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588166234
    },
    {
        "content": "<p>if the answer to getting things to resolve is just switch to rust like everyone else, then I guess I do. if that's the solution path, then it is.</p>",
        "id": 195707918,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588166794
    },
    {
        "content": "<p>maybe I get that as its just compiling one source file &amp; not linking. I have no clue, this is all new :)</p>",
        "id": 195710030,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588167673
    },
    {
        "content": "<p>I won't be able to look into this enough to be able to answer these questions, I'm afraid <span aria-label=\"frown\" class=\"emoji emoji-1f641\" role=\"img\" title=\"frown\">:frown:</span></p>",
        "id": 195710628,
        "sender_full_name": "Till Schneidereit",
        "timestamp": 1588167953
    },
    {
        "content": "<p>understood. what I need to progress further is <em>any</em> high level language that emits resolved output that runs in wasmtime. with explicit externals where I put them so I can hook them up. if that's not possible, I gotta go back to .net assembly as I need a solution not a problem.</p>",
        "id": 195710852,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588168038
    },
    {
        "content": "<p>got to be frank - if this isn't ready, then its not. we're out of cash &amp; I've got to ship product. this is interesting but if its not ready, our v.1 will have to target .net assembly.</p>",
        "id": 195710991,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588168082
    },
    {
        "content": "<p>and understand you work from wasm down. what generates that isn't your problem.</p>",
        "id": 195711097,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588168113
    },
    {
        "content": "<p>also not sure how hiding our native pointers is going to work. in .net assembly, there's the concept of objects so we can hook something in those the managed script can't see. web assembly is lower level. everything is seen.</p>",
        "id": 195711664,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588168326
    },
    {
        "content": "<p>if I can get a working example in <em>any</em> language, I can play around &amp; try to figure something out.</p>",
        "id": 195711889,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588168412
    },
    {
        "content": "<p>the final issue is the only one that's appropriate for here. we need a means of securely connecting from script side to native that the script side can't see. if we can't do that, web assembly, weirdly wouldn't be secure enough to use and so got to stop there.</p>",
        "id": 195712317,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588168573
    },
    {
        "content": "<p>if I'm understanding correctly, unlike .net assembly, web assembly doesn't have an object model. that, I think is a deal breaker as we can't connect securely. maybe I'm wrong. as I can't compile an example right now, I'm not in the code enough to be sure.</p>",
        "id": 195712936,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588168790
    },
    {
        "content": "<p>to fix this, you need the concept of a hybrid class shared between native &amp; script side. the script side can call methods native side but can't see the native side pointer. I don't think you have that yet.</p>",
        "id": 195713918,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588169066
    },
    {
        "content": "<p>Do we have any doc/blog that discusses the wasmtime components. I just wanted to read about it and understand how the wasm code is executed.</p>",
        "id": 195714035,
        "sender_full_name": "Shivam Balikondwar",
        "timestamp": 1588169108
    },
    {
        "content": "<p>Hmm, I don't think we do, but that sounds like something that'd be really useful! <span class=\"user-mention\" data-user-id=\"254083\">@Dan Gohman</span>, is there something in this direction somewhere?</p>",
        "id": 195714377,
        "sender_full_name": "Till Schneidereit",
        "timestamp": 1588169233
    },
    {
        "content": "<p>is there a document or summary of the low level types supported by wasm ? is there the equivalent of a base class for objects ?</p>",
        "id": 195714618,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588169307
    },
    {
        "content": "<p>did .net assembly just win ?</p>\n<p>:)</p>",
        "id": 195714703,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588169349
    },
    {
        "content": "<p>because secure. its the web. if your security derives from security in the javascript layer, you're not inherently secure, as the js layer is legacy.</p>\n<p>hope I'm wrong.</p>",
        "id": 195715142,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588169518
    },
    {
        "content": "<p>yes, somewhat true in case of emscripten, its binding layer give a world to wasm code. you have to be careful what you are exposing to untrusted code.</p>",
        "id": 195717041,
        "sender_full_name": "Yury Delendik",
        "timestamp": 1588170272
    },
    {
        "content": "<p>thanks, yury. played around a bit more, came up with this.</p>\n<p><a href=\"https://pastebin.com/iyMdAiuS\" title=\"https://pastebin.com/iyMdAiuS\">https://pastebin.com/iyMdAiuS</a></p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://pastebin.com/iyMdAiuS\" style=\"background-image: url(https://pastebin.com/i/facebook.png)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://pastebin.com/iyMdAiuS\" title=\"  extern &quot;C&quot;  {  void *Secure_CreateNative(const GUID &amp;type_id);  void  Secure_D - Pastebin.com\">  extern \"C\"  {  void *Secure_CreateNative(const GUID &amp;type_id);  void  Secure_D - Pastebin.com</a></div></div></div>",
        "id": 195717256,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588170366
    },
    {
        "content": "<p>but I can't, as far as I'm aware hide the secure base class away. I want the runtime to define that and never let derived types access it direct.</p>",
        "id": 195717402,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588170446
    },
    {
        "content": "<p>... but then we need to be able to get stuff done so we need secure methods, which gets us to this.</p>\n<p><a href=\"https://pastebin.com/5V2UP0nW\" title=\"https://pastebin.com/5V2UP0nW\">https://pastebin.com/5V2UP0nW</a></p>\n<p>which I'm not really liking. At this point, I'm thinking .net assembly is more elegant &amp; secure.</p>\n<p>like I say, hope I'm wrong, I'm noob at web assembly. I might have completely the wrong end of the stick here.</p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://pastebin.com/5V2UP0nW\" style=\"background-image: url(https://pastebin.com/i/facebook.png)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://pastebin.com/5V2UP0nW\" title=\"  extern &quot;C&quot;  {  void *Secure_CreateNative(const GUID &amp;type_id);  void  Secure_D - Pastebin.com\">  extern \"C\"  {  void *Secure_CreateNative(const GUID &amp;type_id);  void  Secure_D - Pastebin.com</a></div></div></div>",
        "id": 195718863,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588170978
    },
    {
        "content": "<p>regardless of the language &amp; exact approach, I think this boils down to the runtime needs to define the base class for anything you need to interop with the runtime.   dot net implements that web assembly doesn't. as of current version.</p>",
        "id": 195719792,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588171379
    },
    {
        "content": "<p>The Wasm security model is definitely as strong as (properly sandboxed) .Net, but the mechanisms are quite different, so I think applying the same kind of pattern matching might not be the right way to go.</p>\n<p>I'd encourage you to read up on Wasm more thoroughly before jumping to conclusions. At the same time, I appreciate that you have limited time, so perhaps going with something that you're already more familiar with makes sense.</p>",
        "id": 195721230,
        "sender_full_name": "Till Schneidereit",
        "timestamp": 1588171917
    },
    {
        "content": "<p>in the event we deliver a solid 3d web solution, our choice of secure scripting mechanism will be fairly permanent, as javascript is for html today. <br>\nso I'd like to get it right. to make a decision based on what is the best technical solution, rather than quick fix.</p>",
        "id": 195721604,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588172041
    },
    {
        "content": "<p>as of this moment, I'm thinking .net is a better architecture. its more secure. I want to be wrong. that's why I want some straight c++ that compiles to wasm so I can see exactly what's going on.</p>",
        "id": 195721821,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588172115
    },
    {
        "content": "<p>I want to try to corrupt my own example script side to see if I can. right now I'm not seeing anything stopping me.</p>",
        "id": 195721949,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588172160
    },
    {
        "content": "<p>can even drop the c++ requirement &amp; code this in web assembly direct. I still need a base class with a runtime side pointer my runtime overload will allocate that the web assembly code can't access directly.</p>",
        "id": 195722633,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588172361
    },
    {
        "content": "<p>Ok, all I can say at this point is that Wasm isn't less secure, and that its security model has nothing to do with JS, but I unfortunately don't have the bandwidth to talk you through the architecture. There's a wealth of information about it available, though</p>",
        "id": 195722661,
        "sender_full_name": "Till Schneidereit",
        "timestamp": 1588172372
    },
    {
        "content": "<p>If its not less secure, where is your base class, please.</p>",
        "id": 195722801,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588172417
    },
    {
        "content": "<p>have I lost the plot here ? am I making sense ? I am new to this system. I could be completely wrong and I should read more. I picked this up a day ago. its way too early to jump to conclusions, especially before experts.</p>",
        "id": 195723035,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588172503
    },
    {
        "content": "<p>there needs to be a protected pointer in classes that are shared with the runtime. what is the mechanism for ensuring script side can't access such pointers please.</p>",
        "id": 195723666,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588172723
    },
    {
        "content": "<p>or, if you don't have such a thing yet, can you see the need. I get that this is new. I understand I can't have everything today and that code evolves.</p>",
        "id": 195723972,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588172830
    },
    {
        "content": "<p>[Runtime view]  &lt;----- method  &lt;------- [wasm view]</p>\n<p>to do anything on the DOM.</p>\n<p>in legacy, you go via javascript. when using wasm direct, there's no javascript isolation layer.</p>",
        "id": 195725938,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588173624
    },
    {
        "content": "<p><a href=\"https://webassembly.org/docs/semantics/#types\" title=\"https://webassembly.org/docs/semantics/#types\">https://webassembly.org/docs/semantics/#types</a></p>\n<p>I'll add to that unprotected memory - stuff created &amp; managed by the native app DOM (\"web browser\") - an extension to your runtime, running in the same memory space.</p>\n<p>Pointers to unprotected memory must be guarded or you just lost whatever security you had.</p>\n<p>Only trusted methods - implemented runtime side should be able to access unprotected memory pointers.</p>",
        "id": 195727195,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588174151
    },
    {
        "content": "<p>I'm heading back to mono / .net  as I need a secure performant scripting system without a bunch of legacy in the middle. if you don't have that yet, but you do in html browsers with javascript magic I don't currently comprehend, perhaps you can boil your magic javascript down to its core essentials to in effect get wasm a secure base class.  sorry I can't contribute more but funding crisis means I need to deliver an immediate solution to assure investors.</p>",
        "id": 195731768,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588175857
    },
    {
        "content": "<p>Uhm, Wasm was designed with memory safety in mind, and AFAIK accessing anything out-of-bounds for instance is inherently illegal in Wasm and will result in an immediate trap. Did you perhaps have a look at <a href=\"https://webassembly.org/docs/security/\" title=\"https://webassembly.org/docs/security/\">this</a>?</p>",
        "id": 195733603,
        "sender_full_name": "Jakub Konka",
        "timestamp": 1588176561
    },
    {
        "content": "<p>yeah I looked at that. obj_1 with dom handle.  obj_2 with dom handle. wasm code swaps the handles. bad stuff happens.</p>",
        "id": 195735662,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588177492
    },
    {
        "content": "<p>wasm was designed with javascript running on top. when you take that away, it falls apart. show me an example with a single dom base class implemented trusted (\"web browser\") side, accessed wasm (untrusted script side) that I can't break.</p>",
        "id": 195735871,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588177606
    },
    {
        "content": "<p>Hmm, given my limited knowledge of how DOM classes actually work, I'm not sure I understand what the problem is. But that aside, is your usecase targetting Wasm + JS, or standalone Wasm?</p>",
        "id": 195737119,
        "sender_full_name": "Jakub Konka",
        "timestamp": 1588178176
    },
    {
        "content": "<p>standalone. as I can do with mono. mentioned not to annoy you but to explain where solution space is.</p>",
        "id": 195737241,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588178227
    },
    {
        "content": "<p>Oh, not to worry, not getting annoyed, just trying to understand where you're coming from ;-)</p>",
        "id": 195737287,
        "sender_full_name": "Jakub Konka",
        "timestamp": 1588178257
    },
    {
        "content": "<p>k, currently here : <a href=\"https://github.com/WebAssembly/wasm-c-api/blob/master/example/hello.c\" title=\"https://github.com/WebAssembly/wasm-c-api/blob/master/example/hello.c\">https://github.com/WebAssembly/wasm-c-api/blob/master/example/hello.c</a></p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/WebAssembly/wasm-c-api/blob/master/example/hello.c\" style=\"background-image: url(https://avatars3.githubusercontent.com/u/11578470?s=400&amp;v=4)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/WebAssembly/wasm-c-api/blob/master/example/hello.c\" title=\"WebAssembly/wasm-c-api\">WebAssembly/wasm-c-api</a></div><div class=\"message_embed_description\">Wasm C API prototype. Contribute to WebAssembly/wasm-c-api development by creating an account on GitHub.</div></div></div>",
        "id": 195737394,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588178289
    },
    {
        "content": "<p>OK, so how do you think standalone Wasm with Wasmtime runtime say is any less secure than .NET vm?</p>",
        "id": 195737398,
        "sender_full_name": "Jakub Konka",
        "timestamp": 1588178290
    },
    {
        "content": "<p>hello_callback is untrusted. I can do anything there - it's straight c</p>",
        "id": 195737451,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588178322
    },
    {
        "content": "<p>including call native methods using a native pointer. that example doesn't have one as its too simple but take it a step further to pull one out of its parameters and you can.</p>",
        "id": 195737655,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588178417
    },
    {
        "content": "<p>But <code>hello_callback</code> is the callback supplied by you, the runtime provider, is it not?</p>",
        "id": 195737680,
        "sender_full_name": "Jakub Konka",
        "timestamp": 1588178427
    },
    {
        "content": "<p>yes. that's what makes it trusted code. I wrote it so I trust it coz I know what its doing.</p>",
        "id": 195737711,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588178452
    },
    {
        "content": "<p>So if you open up for an attack inside a callback like this, then it's the runtime's problem, is it not?</p>",
        "id": 195737778,
        "sender_full_name": "Jakub Konka",
        "timestamp": 1588178486
    },
    {
        "content": "<p>What I'm getting at here, is that Wasm code that's executed by your runtime is untrusted and sandboxed but only as much as you will provide in your runtime</p>",
        "id": 195737831,
        "sender_full_name": "Jakub Konka",
        "timestamp": 1588178516
    },
    {
        "content": "<p>absolutely. we don't open up an attack inside our callback. we're careful. we're the web browser.</p>",
        "id": 195737876,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588178526
    },
    {
        "content": "<p>but what we have to do is give the script a reference of some kind to one of our things. lets keep it simple and say a html table.</p>",
        "id": 195737986,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588178588
    },
    {
        "content": "<p>say the script wants to add a row to the table, it has to tell us what table it wants to add a row to.</p>",
        "id": 195738020,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588178606
    },
    {
        "content": "<p>wasm-c-api and web browser use cases are not the same</p>",
        "id": 195738048,
        "sender_full_name": "Yury Delendik",
        "timestamp": 1588178622
    },
    {
        "content": "<p>I know :)  its not all about web browser. its about having trusted stuff and untrusted stuff and having some way of communicating across that divide.</p>",
        "id": 195738173,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588178666
    },
    {
        "content": "<p>Can you explain why two thing are mixed in the same conversation?</p>",
        "id": 195738175,
        "sender_full_name": "Yury Delendik",
        "timestamp": 1588178666
    },
    {
        "content": "<p>Yeah, I'm kinda confused here as well :-)</p>",
        "id": 195738199,
        "sender_full_name": "Jakub Konka",
        "timestamp": 1588178683
    },
    {
        "content": "<p>web browser / web script is the obvious example.</p>",
        "id": 195738223,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588178690
    },
    {
        "content": "<p>Oh, and in WASI, you can only communicate with resources if you've given such a capability to the runtime in the first place</p>",
        "id": 195738258,
        "sender_full_name": "Jakub Konka",
        "timestamp": 1588178707
    },
    {
        "content": "<p>So even if your Wasm binary wants to access <code>/dev/random</code> say, it will only be able to if and only if you, as the runtime user, will provide such a capability</p>",
        "id": 195738332,
        "sender_full_name": "Jakub Konka",
        "timestamp": 1588178745
    },
    {
        "content": "<p>So I guess to answer your question, in WASI, the comms across the divide (trusted vs untrusted) should happen only via capabilities</p>",
        "id": 195738417,
        "sender_full_name": "Jakub Konka",
        "timestamp": 1588178771
    },
    {
        "content": "<p>Also, looks like you fond of mono, can you provide hello_callback example of how mono does embedding + callback. Is it described in <a href=\"https://www.mono-project.com/docs/advanced/pinvoke/\" title=\"https://www.mono-project.com/docs/advanced/pinvoke/\">https://www.mono-project.com/docs/advanced/pinvoke/</a> ?</p>",
        "id": 195738422,
        "sender_full_name": "Yury Delendik",
        "timestamp": 1588178773
    },
    {
        "content": "<p>pinvoke is nasty. that's what I don't like about mono, you can call out to anything.</p>",
        "id": 195738508,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588178804
    },
    {
        "content": "<p>okay</p>",
        "id": 195738645,
        "sender_full_name": "Yury Delendik",
        "timestamp": 1588178875
    },
    {
        "content": "<p>I don't know your stuff well enough yet, but lets see if we can get an example so we're on the same page.</p>",
        "id": 195738938,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588179015
    },
    {
        "content": "<p>without JS or DOM please :) wasmtime does not know what it is</p>",
        "id": 195739172,
        "sender_full_name": "Yury Delendik",
        "timestamp": 1588179155
    },
    {
        "content": "<p>yeah, I know, DOM is just shorthand for trusted native. its not all about web browsers.</p>",
        "id": 195739237,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588179194
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"297332\">@Steve Williams</span> from what you've been saying, I believe that wasm would fit your use case but it may not be quite as you might imagine (and not the same as mono). The feature that wasm has to support this is called <code>anyref</code> and is part of the reference types proposal. This proposal is not currently fully implemented in Wasmtime nor is it a fully finished proposal, it's still in the stabilization process. The purpose of <code>anyref</code> is so that the host can pass a value to a wasm module which is impossible for wasm to forge. For example you could pass your html table directly to wasm, and wasm couldn't do anything with it other than pass it back to you later on (which is what it sounds like you're going for)</p>",
        "id": 195739244,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1588179201
    },
    {
        "content": "<p>As a workaround today we implement this with table indices. The host has a table of object it wants the wasm module to have access to, for example you'd have a list of html tables on the host, and you'd pass indexes into the table to the wasm module. When calling a host API the host would then need to translate that index to a resource. The context of the API indicates that the index is to the list of html tables, and the host would bounds-check that</p>",
        "id": 195739371,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1588179257
    },
    {
        "content": "<p>alex - that sounds about right - thank you :)</p>",
        "id": 195739375,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588179260
    },
    {
        "content": "<p>this is not a perfect solution, but it is what works today. This is how WASI is implemented which works with files/directories/etc, where the host has a table of files/directories and passes i32 file descriptors to the wasm module.</p>",
        "id": 195739431,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1588179289
    },
    {
        "content": "<p>Once fully implemented everything will be <code>anyref</code> though where you will literally pass an unforgeable reference to a wasm module, and then wasm will later pass it back to your host imports.</p>",
        "id": 195739471,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1588179311
    },
    {
        "content": "<p>You are guaranteed that wasm never modified the value, and you're also guaranteed that the host constructed the value.</p>",
        "id": 195739487,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1588179326
    },
    {
        "content": "<p>I'm not personally familiar with .NET but it is likely not as powerful as .NET. The anyref/reference-types proposal is pretty minimal and doesn't allow things like classes/extensions/etc, it's just opaque values being passed around. Whether or not that works for your use case I'm not sure.</p>",
        "id": 195739611,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1588179374
    },
    {
        "content": "<p>handles are a bit better but script side can still mess with them. I want tight binding between script side view and runtime view such that script side can't even see, never mind change its runtime side reference - however that might be represented. its stuck to it hard &amp; invisible.</p>",
        "id": 195739867,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588179492
    },
    {
        "content": "<p>You've got no equivalent of mono_object_new     </p>\n<p><a href=\"http://docs.go-mono.com/?link=xhtml%3adeploy%2fmono-api-object.html\" title=\"http://docs.go-mono.com/?link=xhtml%3adeploy%2fmono-api-object.html\">http://docs.go-mono.com/?link=xhtml%3adeploy%2fmono-api-object.html</a></p>",
        "id": 195740567,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588179847
    },
    {
        "content": "<p>that's sounding interesting though.  if can see but can't mess with, a step in the right direction. problem is you can swap handles to drop them into views of objects they weren't created with when being malicious. in our trusted side, we cast the pointer to what we know it is to do stuff and bang things go wrong. or perform too many checks for it to be performant.</p>",
        "id": 195740930,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588180022
    },
    {
        "content": "<p>hence don't want untrusted side to have access. at all.</p>",
        "id": 195740959,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588180037
    },
    {
        "content": "<p>You can store a list of objects. The index received from wasm then points in that list of objects. For safety you then only need to perform a bounds check and you need to check if the object isn't destroyed.</p>",
        "id": 195741203,
        "sender_full_name": "bjorn3",
        "timestamp": 1588180146
    },
    {
        "content": "<p>per type.  maybe. then if untrusted wants to switch its references around, it does &amp; whatever happens does, but with known types so safe &amp; result is up to the app. maybe. will let that settle.</p>",
        "id": 195741679,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588180383
    },
    {
        "content": "<p>thanks bjorn3 :)</p>",
        "id": 195746803,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588182838
    },
    {
        "content": "<p>Hi everyone. Just joining the community. I'm working on a (subset of) Ruby to Web Assembly compiler (see <a href=\"https://github.com/ljulliar/rlang\" title=\"https://github.com/ljulliar/rlang\">https://github.com/ljulliar/rlang</a>). I'm currently trying to integrate Rlang with Wasmtime (WASI, type interface, command line arguments,...)</p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/ljulliar/rlang\" style=\"background-image: url(https://avatars2.githubusercontent.com/u/16881?s=400&amp;v=4)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/ljulliar/rlang\" title=\"ljulliar/rlang\">ljulliar/rlang</a></div><div class=\"message_embed_description\">A (subset of) Ruby to WebAssembly compiler. Contribute to ljulliar/rlang development by creating an account on GitHub.</div></div></div>",
        "id": 195766561,
        "sender_full_name": "Laurent Julliard",
        "timestamp": 1588192628
    },
    {
        "content": "<p>Hello!</p>",
        "id": 195768888,
        "sender_full_name": "Dan Gohman",
        "timestamp": 1588193855
    },
    {
        "content": "<p>update. got the basics compiling assemblyscript so should have a working example of above nonsense tomorrow :)</p>\n<p>cheers all :)</p>",
        "id": 195771031,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588194880
    },
    {
        "content": "<p>so ... if I'm understanding, wasmtime is just pure runtime. it doesn't understand anything about file i/o for example. so, first example of the native interfacing I'm proposing should be to add native file i/o support, then assemblyscript compiler could target wasmtime direct.</p>",
        "id": 195775360,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588197335
    },
    {
        "content": "<p>perhaps trying to run before I can walk here, but that's current thoughts. we'll see where it leads.</p>",
        "id": 195775537,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588197450
    },
    {
        "content": "<p>The WASI code in wasmtime should give you file IO, I believe; as I glanced at the comments above, I wonder about going down the AssemblyScript route: I've been able to successfully compile C to Wasm (with some limitations) using both Emscripten and wasi-sdk</p>",
        "id": 195779550,
        "sender_full_name": "Andrew Brown",
        "timestamp": 1588200412
    },
    {
        "content": "<p>Yeah, you can access files and directories on the host in Wasmtime via WASI and its capabilities-oriented security model.</p>",
        "id": 195798389,
        "sender_full_name": "Jakub Konka",
        "timestamp": 1588222278
    },
    {
        "content": "<p>We currently only allow for preopening of the directories (preopening meaning, you can give permission to Wasmtime to access some directory on the host).</p>",
        "id": 195798437,
        "sender_full_name": "Jakub Konka",
        "timestamp": 1588222326
    },
    {
        "content": "<p>In the future, this will naturally be extended to other host resources.</p>",
        "id": 195798447,
        "sender_full_name": "Jakub Konka",
        "timestamp": 1588222347
    },
    {
        "content": "<p>Morning all. So if file i/o is there already, is there anything inherently stopping assemblyscript compiling assemblyscript targeting wasmtime ?</p>\n<p>I'm not understanding why their dev environment has a node.js dependency.  I'd like to see this system \"float\" on its own - bootstrap itself, or at the very least understand why that hasn't happened yet. If simply its just a job on the list that hasn't happened yet, that's life at the edge :)</p>\n<p>EU next gen internet funding event today - most likely a dull webinar, but might interest some.</p>\n<p><a href=\"https://www.eventbrite.co.uk/e/how-the-new-internet-architects-can-get-up-to-200k-equity-free-funding-tickets-102771361910\" title=\"https://www.eventbrite.co.uk/e/how-the-new-internet-architects-can-get-up-to-200k-equity-free-funding-tickets-102771361910\">https://www.eventbrite.co.uk/e/how-the-new-internet-architects-can-get-up-to-200k-equity-free-funding-tickets-102771361910</a></p>\n<p>With regard to this project, I'd like to see AssemblyScript targeting wasmtime &amp; whatever it takes to make that happen funded.</p>\n<p>Why - coz if we have a self sustaining ecosystem, we need our own stuff so make sure it's spot on.</p>\n<p>Why I'm going AssemblyScript (at least for now) - I'm implementing performant secure scripting into our 3D web tech, with the primary audience for that being webdevs. AssemblyScript is the closest we have right now to what they're familiar with. I prefer C++, but I'm not currently targeting me (did that yesterday - so far so good).</p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://www.eventbrite.co.uk/e/how-the-new-internet-architects-can-get-up-to-200k-equity-free-funding-tickets-102771361910\" style=\"background-image: url(https://img.evbuc.com/https%3A%2F%2Fcdn.evbuc.com%2Fimages%2F99655716%2F151482523619%2F1%2Foriginal.20200428-075904?w=1000&amp;auto=format%2Ccompress&amp;q=75&amp;sharp=10&amp;rect=3%2C0%2C1976%2C988&amp;s=3dbbe285604e8de6ac43a2a4705f6928)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://www.eventbrite.co.uk/e/how-the-new-internet-architects-can-get-up-to-200k-equity-free-funding-tickets-102771361910\" title=\"How the New Internet Architects can get up to 200Kâ‚¬ equity free funding?\">How the New Internet Architects can get up to 200Kâ‚¬ equity free funding?</a></div><div class=\"message_embed_description\">Learn how to participate in the open call for researchers, developers, startups and SMEs can define the future of Internet.</div></div></div>",
        "id": 195808043,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588233380
    },
    {
        "content": "<ul>\n<li>AssemblyScript compiler / linker targeting wasmtime direct.</li>\n</ul>",
        "id": 195809642,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588234541
    },
    {
        "content": "<p>or, to at least prove the principle, is there any compiler to wasmtime that runs within the wasmtime runtime yet ?</p>\n<p>if not does anyone have any insight as to why ? </p>\n<p>is it simply nobody's been motivated to do that yet ?</p>\n<p>or is there some gap I don't currently understand.</p>",
        "id": 195812055,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588236375
    },
    {
        "content": "<p>with to regard to moving the assemblyscript compiler over, I think that work has merit, I'd like to see it done, but don't want to either do or manage that work as got too much on as it is. if anyone's up for doing that with eu funding (if approved - not up to me), happy to put in a word (not that anyone cares what I think) to say I think that project should be funded. reasoning above.</p>",
        "id": 195812291,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588236518
    },
    {
        "content": "<p>ummmm .... noob intro has an error. fopen needs to be in \"rb\" mode, windoze :)</p>\n<p>just tried loading something else into it &amp; it failed part way into a load. thought how could that possibly fail, then had that doh moment :)</p>\n<p><a href=\"https://github.com/WebAssembly/wasm-c-api/blob/master/example/hello.c\" title=\"https://github.com/WebAssembly/wasm-c-api/blob/master/example/hello.c\">https://github.com/WebAssembly/wasm-c-api/blob/master/example/hello.c</a></p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/WebAssembly/wasm-c-api/blob/master/example/hello.c\" style=\"background-image: url(https://avatars3.githubusercontent.com/u/11578470?s=400&amp;v=4)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/WebAssembly/wasm-c-api/blob/master/example/hello.c\" title=\"WebAssembly/wasm-c-api\">WebAssembly/wasm-c-api</a></div><div class=\"message_embed_description\">Wasm C API prototype. Contribute to WebAssembly/wasm-c-api development by creating an account on GitHub.</div></div></div>",
        "id": 195828329,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588247708
    },
    {
        "content": "<p>AssemblyScript seems to want one of these things defining.</p>\n<p>(import \"env\" \"abort\" (func $~lib/builtins/abort (param i32 i32 i32 i32)))</p>\n<p>don't suppose anyone wants to drop some c-api hints as to how to do that. I'll figure it out but shortcuts welcome :)</p>",
        "id": 195829422,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588248399
    },
    {
        "content": "<p>thats an abort function in namespace env with 4 int32 parameters ?</p>",
        "id": 195830289,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588248941
    },
    {
        "content": "<p>in the event there's an easier way than patching this up, all ears :)</p>",
        "id": 195830431,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588248996
    },
    {
        "content": "<p>ummm if that is a namespace thing, I don't see namespaces in the c api.  think I'm stuck.</p>\n<p>here's my minimal assemblyscript test, modelled as far as possible on c-api hello.c example.</p>\n<p>//// ---- code[start]</p>\n<p>export declare function hello(): void</p>\n<p>export function run(): void <br>\n{<br>\n   hello();<br>\n}</p>\n<p>/// --- code[end]</p>",
        "id": 195831118,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588249407
    },
    {
        "content": "<p>that gets me two imports I'm not sure what to do with yet. one I'm expecting, the other seems to be some kind of a default.</p>\n<p>(import \"env\" \"abort\" (func $~lib/builtins/abort (param i32 i32 i32 i32)))<br>\n (import \"index\" \"hello\" (func $assembly/index/hello))</p>\n<p>suggest something like this is a noob tutorial. happy to run with it once I can see what I'm doing.</p>",
        "id": 195831282,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588249535
    },
    {
        "content": "<p>export declare function is a very long winded way of saying import, but lets not mess with assembyscript syntax just yet :)</p>",
        "id": 195831427,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588249634
    },
    {
        "content": "<p>also, as these are c-api questions, maybe this isn't the right place for them as you have a runtime that implements the api, you're not maintainers of the api.</p>",
        "id": 195833175,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588250672
    },
    {
        "content": "<p>c-api examples are missing an example that resolves multiple imports from an assembly explicitly by name so I know I'm assigning things correctly.</p>\n<p>docs seem light. will have another look at the headers to see if it's obvious.</p>",
        "id": 195835979,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588252180
    },
    {
        "content": "<p>nope. checked the header. I pass in an array of external functions. I don't understand how I present that in the right order. I need to bind my implementation to its identifier not cross fingers &amp; hope things are in some pre-deterimined order ... I think. unless I can create some kind of a binding module that does have them in a guaranteed order.</p>",
        "id": 195837679,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588253115
    },
    {
        "content": "<p>happy to pivot to your extensions api if that's required to resolve these robustly.</p>",
        "id": 195838200,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588253381
    },
    {
        "content": "<p>c-api module has meta data that describes import and exports types and names.</p>",
        "id": 195838550,
        "sender_full_name": "Yury Delendik",
        "timestamp": 1588253534
    },
    {
        "content": "<p>ahhh ... thanks. care to shine a light on where that is please :)</p>",
        "id": 195838611,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588253569
    },
    {
        "content": "<p>searched meta in wasm.h ... nothing.</p>",
        "id": 195838907,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588253679
    },
    {
        "content": "<p>there is an example about exports <a href=\"https://github.com/WebAssembly/wasm-c-api/blob/master/example/reflect.c#L128\" title=\"https://github.com/WebAssembly/wasm-c-api/blob/master/example/reflect.c#L128\">https://github.com/WebAssembly/wasm-c-api/blob/master/example/reflect.c#L128</a> , but imports will look the same, see wasm_module_exports and wasm_module_imports</p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/WebAssembly/wasm-c-api/blob/master/example/reflect.c#L128\" style=\"background-image: url(https://avatars3.githubusercontent.com/u/11578470?s=400&amp;v=4)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/WebAssembly/wasm-c-api/blob/master/example/reflect.c#L128\" title=\"WebAssembly/wasm-c-api\">WebAssembly/wasm-c-api</a></div><div class=\"message_embed_description\">Wasm C API prototype. Contribute to WebAssembly/wasm-c-api development by creating an account on GitHub.</div></div></div>",
        "id": 195838953,
        "sender_full_name": "Yury Delendik",
        "timestamp": 1588253698
    },
    {
        "content": "<p>thanks, yury. will see if I can get my head around that.</p>",
        "id": 195839338,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588253862
    },
    {
        "content": "<p>is there a doc somewhere explaining how wasmtime run command line arguments are being passed to the _start entry point of the WASM module ?</p>",
        "id": 195891355,
        "sender_full_name": "Laurent Julliard",
        "timestamp": 1588275871
    },
    {
        "content": "<p>Not as such. \"_start\" doesn't get passed args; the program to query for them via <code>args_sizes_get</code> and <code>args_get</code> calls.</p>",
        "id": 195891751,
        "sender_full_name": "Dan Gohman",
        "timestamp": 1588276066
    },
    {
        "content": "<p>Are these functions imported in the WASM module by the WASm runtime ? (let me explain: I'm writing WAT code more or less directly by hand so I cannot rely on C to wasm or Rust to WSM compiler to handle that for me)</p>",
        "id": 195892720,
        "sender_full_name": "Laurent Julliard",
        "timestamp": 1588276494
    },
    {
        "content": "<p>Yes, these are WASI functions, imported in a wasm module and typically implemented by the runtime.</p>",
        "id": 195893761,
        "sender_full_name": "Dan Gohman",
        "timestamp": 1588276939
    },
    {
        "content": "<p>In a C or Rust toolchain, the code to call these and set up the user-facing argv is added by the toolchain</p>",
        "id": 195893854,
        "sender_full_name": "Dan Gohman",
        "timestamp": 1588277000
    },
    {
        "content": "<p>A little more of my nonsense - sorry. I've got getting my head around the reflection stuff to do next but gave the whole problem some more thought.<br>\nOur use case is secure performant 3D web scripting. My first thought was to go with AssemblyScript as initial webdev supported language for that. However, if I'm honest, I don't like it. The current compiler runs in node.js which means the  compiler is written in javascript. Which hardcore compiler engineers write their compilers in js ? Not many. What's the optimal compiler toolchain right now ? llvm stuff. So for webdevs, we get to rust. Which isn't a million miles away in terms of syntax from AssemblyScript. So think I pivot our connectivity to Rust. Thinking out loud. Hope that's ok. Realise entire point of WebAssembly is to be language agnostic, but all the same I have to choose one. Others can be supported later.</p>",
        "id": 195939400,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588319893
    },
    {
        "content": "<p>Apologies if anyone here works on what I just dismissed. Maybe its great and I'm wrong.</p>",
        "id": 195940677,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588321459
    },
    {
        "content": "<p>Ahhhh ... doh, got it. AssemblyScript compiler isn't written in javascript, it hooks into html browser tech tree javascript compilers.  So it'll be decent. However, the focus there is speed of compilation over pure optimized performance so still reckon llvm path is a better call. </p>\n<p>Anyhow, we'll see. As long as interface is accessible from all, plenty of R&amp;D, competition &amp;  complementary approaches possible.</p>\n<p>Not the biggest fan of Rust syntax from what I've seen, but it'll do for now.</p>",
        "id": 195948352,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588328957
    },
    {
        "content": "<p>&amp; that's why AssemblyScrript compiler guys can't target wasmtime, coz they need to pull the compiler from the legacy tech tree :)</p>\n<p>or maybe I'm way off. haven't checked the code, running this in my head, which isn't always right.</p>",
        "id": 195948613,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588329196
    },
    {
        "content": "<p>This looks to be my new starting point : <a href=\"https://dev.to/h_ajsf/simple-rust--wasm-example-5b1m\" title=\"https://dev.to/h_ajsf/simple-rust--wasm-example-5b1m\">https://dev.to/h_ajsf/simple-rust--wasm-example-5b1m</a></p>\n<p>Too much off topic rambling here, sorry, not sure where else to put it.</p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://dev.to/h_ajsf/simple-rust--wasm-example-5b1m\" style=\"background-image: url(https://res.cloudinary.com/practicaldev/image/fetch/s--1AV03t42--/c_imagga_scale,f_auto,fl_progressive,h_500,q_auto,w_1000/https://cl.ly/7cbff8b6ef29/Image%25202018-12-08%2520at%252012.06.58%2520PM.png)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://dev.to/h_ajsf/simple-rust--wasm-example-5b1m\" title=\"Simple Rust + WASM example\">Simple Rust + WASM example</a></div><div class=\"message_embed_description\">\n\n\nInstall rust\n\n\n\n\n$ brew install rustup\n$ rustup-init\n\n\n\n\n\nSet default toolchai...</div></div></div>",
        "id": 195950738,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588330999
    },
    {
        "content": "<p>Don't need all of that as not hooking into js/html, but lets me build a simple example. yay :)<br>\nwill create our own channel somewhere for this stuff soon. its off topic for here &amp; not wanting to annoy or derail anything else.<br>\nbut progress. back to the reflect stuff &amp; lets see if I can hook something in.</p>",
        "id": 195951448,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588331705
    },
    {
        "content": "<p>I just learnt wasm address space is 32 bit. not a problem for now. cool. getting there :)</p>",
        "id": 195951980,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588332189
    },
    {
        "content": "<p>ahhh ... that's better. small test, small output where I can see what's going on :) </p>\n<p><a href=\"https://pastebin.com/3fBP5mji\" title=\"https://pastebin.com/3fBP5mji\">https://pastebin.com/3fBP5mji</a></p>\n<p>love how the format has a list of function signatures &amp; each entry only references that sig id.</p>\n<p>nice :)</p>\n<p>going super slow as exhausted.</p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://pastebin.com/3fBP5mji\" style=\"background-image: url(https://pastebin.com/i/facebook.png)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://pastebin.com/3fBP5mji\" title=\"  #[no_mangle]  extern {      fn create_native(type_id: u32) -&gt; u32;  }        # - Pastebin.com\">  #[no_mangle]  extern {      fn create_native(type_id: u32) -&gt; u32;  }        # - Pastebin.com</a></div></div></div>",
        "id": 195966942,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588343802
    },
    {
        "content": "<p>Now do clang without stdlibs :) <code>clang --target=wasm32 -nostdlib -Wl,--no-entry,--export=foobar ..</code></p>",
        "id": 195972388,
        "sender_full_name": "Yury Delendik",
        "timestamp": 1588346985
    },
    {
        "content": "<p>Going to take it all the way Rust unless I find a good reason not to. Can come back to C++ later. Needed a reason to learn it, think I've got one :)<br>\nShame we can't do c# without all the junk yet, maybe that'll come at some point. Managed heap has its place in high level stuff &amp; the syntax is pretty sweet.</p>",
        "id": 195976775,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588349394
    },
    {
        "content": "<p>I know mono can target wasm getting c# thru, but it brings with it a ton of .net baggage we don't need. I like things minimalist.</p>",
        "id": 195977125,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588349604
    },
    {
        "content": "<p>not understanding why the wat for that rust test is tiny (expected) but the wasm is huge.</p>\n<p>utils.wat - 525 bytes<br>\nutils.wasm - 1773461 bytes </p>\n<p>that's an issue we can no doubt resolve but not a production stop issue.</p>\n<p>the following is however a production stop issue.</p>\n<p>utils .wasm crashes wasm_instance_new in the refect example.</p>\n<p>my hunch is coz there's an unresolved extern (deliberate). that's the entire point of loading this way is to scan for it so we can patch it up.</p>\n<p>I need to be able to do a reflection scan or whatever the terminology is  with a gap as the point is to find the gaps so we can fill them :)</p>\n<p>anything unresolved after our expected gaps are found &amp; patched is an error, but that'd be up to us to fail on or otherwise.</p>",
        "id": 195982770,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588352521
    },
    {
        "content": "<p>to reproduce, the rust source is in the pastebin immediately above, compile standard rust as per the tutorial I'm working from above. <br>\nload into reflect.c with s/export/import.</p>",
        "id": 195983332,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588352808
    },
    {
        "content": "<p>fopen \"rb\" so the load doesn't mess up :)</p>",
        "id": 195983405,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588352854
    },
    {
        "content": "<p>modified reflect.c here to save everyone a job : <a href=\"https://pastebin.com/1KQQqTCv\" title=\"https://pastebin.com/1KQQqTCv\">https://pastebin.com/1KQQqTCv</a></p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://pastebin.com/1KQQqTCv\" style=\"background-image: url(https://pastebin.com/i/facebook.png)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://pastebin.com/1KQQqTCv\" title=\"#include &lt;stdio.h&gt;  #include &lt;stdlib.h&gt;  #include &lt;string.h&gt;  #include &lt;inttypes - Pastebin.com\">#include &lt;stdio.h&gt;  #include &lt;stdlib.h&gt;  #include &lt;string.h&gt;  #include &lt;inttypes - Pastebin.com</a></div></div></div>",
        "id": 195983620,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588352955
    },
    {
        "content": "<p>if you guys need anything else to repro or I'm doing something idiotic, please let me know :) could be import loads need to be done a different way. I literally did a search &amp; replace. might be more to it.</p>",
        "id": 195983826,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588353052
    },
    {
        "content": "<p>I'm running wasmtime-v0.15.0-x86_64-windows-c-api - happy to switch to upgrade if that's required to patch this up. also happy to fix it myself if it's trivial.</p>",
        "id": 195984345,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588353298
    },
    {
        "content": "<p>as an alternative, if its possible to replace exported functions, could do it that way instead.</p>",
        "id": 195986761,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588354428
    },
    {
        "content": "<p>losing it. you can load with imports that can be patched. that's what hello.c does. so it must be something specific regarding that example triggering a fault.</p>",
        "id": 195988655,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588355340
    },
    {
        "content": "<p><a href=\"http://advance-software.com/misc/test.wasm\" title=\"http://advance-software.com/misc/test.wasm\">advance-software.com/misc/test.wasm</a></p>",
        "id": 195988853,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588355461
    },
    {
        "content": "<p>nope, not losing it, if a little tired. in hello.c, the missing function (the import) is passed into wasm_instance_new so everything can resolve &amp; the file loads.</p>\n<p>in the import reflection example we're throwing together here, the resolving function isn't available as we're scanning for imports prior to resolving them..</p>\n<p>so its not file specific. its api misuse, an api gap or an implementation error.</p>",
        "id": 195989936,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588356005
    },
    {
        "content": "<p>happy to log over here if required, or if the info in this chat is sufficient, I can swtich to something else whilst waiting for this to resolve.</p>\n<p><a href=\"https://github.com/bytecodealliance/wasmtime/issues\" title=\"https://github.com/bytecodealliance/wasmtime/issues\">https://github.com/bytecodealliance/wasmtime/issues</a></p>\n<p>anything else I need to do at this time, please let me know.</p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/bytecodealliance/wasmtime/issues\" style=\"background-image: url(https://avatars0.githubusercontent.com/u/54038801?s=400&amp;v=4)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/bytecodealliance/wasmtime/issues\" title=\"bytecodealliance/wasmtime\">bytecodealliance/wasmtime</a></div><div class=\"message_embed_description\">Standalone JIT-style runtime for WebAssembly, using Cranelift - bytecodealliance/wasmtime</div></div></div>",
        "id": 195996651,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588359696
    },
    {
        "content": "<p>if this is tricky, maybe can figure out some way of routing everything via a single imported entrypoint for now.</p>",
        "id": 196038348,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588404156
    },
    {
        "content": "<p>summary for those not wanting to read a wall of text : wasm-c-api reflection example is exports. flipped it to imports as per suggestion here.</p>\n<p>problem: can't reflect bcoz wasm_instance_new crashes with unresolved imports, thereby making import reflection impossible at this point. unless of course I'm doing it wrong. in any case, function shouldn't crash with essentially valid input. realise this is work in progress at the edge :)</p>\n<p>.... but you've got a real user here. if wasmtime is up to it &amp; license is acceptable (something bsd-ish will do), we'll go for it.</p>",
        "id": 196038643,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588404803
    },
    {
        "content": "<p>turn around in a real app is about a week once I've got a way through.  single entry point as I've suggested might be a way through. I'll experiment.<br>\nat the very least, I need that function not crashing as passing a function with unresolved imports we're not expecting will be outside my control. I can dive in &amp; try &amp; patch that if I have to, but that'll have to wait until I have api use side up to minimum first.</p>\n<p>given there are other implementations of the api, perhaps we have to run with one of those to start with. currently have no idea what they do with the use case explained above.</p>",
        "id": 196038749,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588405015
    },
    {
        "content": "<p>wasmtime website missing legal. we might open source our 3d web tech at some point, but that decision hasn't been made yet so I need to work with complementary technologies that allow us to open source as &amp; where we see fit at a time of our choosing. our direct interfacing to wasmtime will be an infinity \"action\" plugin - we've got those for .net, mono, java, javascript and native right now. no objection to that being open source.</p>",
        "id": 196038957,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588405348
    },
    {
        "content": "<ul>\n<li>as passing a wasm with unresolved exports we're not expecting will be outside my control. untrusted script devs throw what they want at it. sometimes deliberately wrong (malicious attacks).</li>\n</ul>",
        "id": 196039303,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588406003
    },
    {
        "content": "<blockquote>\n<p>.... but you've got a real user here. if wasmtime is up to it &amp; license is acceptable (something bsd-ish will do), we'll go for it.</p>\n</blockquote>\n<p>Is <code>Apache-2.0 WITH LLVM-exception</code> acceptable?</p>\n<p><a href=\"https://github.com/bytecodealliance/wasmtime/blob/c284ffe6c036b8058228d576c46688968629b48c/Cargo.toml#L6\" title=\"https://github.com/bytecodealliance/wasmtime/blob/c284ffe6c036b8058228d576c46688968629b48c/Cargo.toml#L6\">https://github.com/bytecodealliance/wasmtime/blob/c284ffe6c036b8058228d576c46688968629b48c/Cargo.toml#L6</a></p>\n<blockquote>\n<p>wasmtime website missing legal.</p>\n</blockquote>\n<p>What exactly are you missing? You may find it at <a href=\"https://bytecodealliance.org/\" title=\"https://bytecodealliance.org/\">https://bytecodealliance.org/</a>. This is the website of the alliance which wasmtime is part of.</p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/bytecodealliance/wasmtime/blob/c284ffe6c036b8058228d576c46688968629b48c/Cargo.toml#L6\" style=\"background-image: url(https://avatars0.githubusercontent.com/u/54038801?s=400&amp;v=4)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/bytecodealliance/wasmtime/blob/c284ffe6c036b8058228d576c46688968629b48c/Cargo.toml#L6\" title=\"bytecodealliance/wasmtime\">bytecodealliance/wasmtime</a></div><div class=\"message_embed_description\">Standalone JIT-style runtime for WebAssembly, using Cranelift - bytecodealliance/wasmtime</div></div></div><div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://bytecodealliance.org/\" style=\"background-image: url(https://bytecodealliance.org/images/avatar.png)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://bytecodealliance.org/\" title=\"Bytecode Alliance\">Bytecode Alliance</a></div><div class=\"message_embed_description\">Welcome to the Bytecode Alliance</div></div></div>",
        "id": 196040419,
        "sender_full_name": "bjorn3",
        "timestamp": 1588407793
    },
    {
        "content": "<blockquote>\n<p>Is Apache-2.0 WITH LLVM-exception acceptable?</p>\n</blockquote>\n<p>Dunno yet, thanks for the link. Will review. At this point I've stated our intent &amp; configuration &amp; nobody's complained, so suspect we're good.</p>\n<p>Thanks again, bjorn3</p>",
        "id": 196040746,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588408336
    },
    {
        "content": "<p>hate legal, but got to have all bases covered. </p>\n<p>appears to be this thing : <a href=\"https://www.apache.org/licenses/LICENSE-2.0\" title=\"https://www.apache.org/licenses/LICENSE-2.0\">https://www.apache.org/licenses/LICENSE-2.0</a></p>",
        "id": 196040883,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588408629
    },
    {
        "content": "<p>My reading of this is that legal is sound. </p>\n<ol start=\"2\">\n<li>Grant of Copyright License. Subject to the terms and conditions of this License, each Contributor hereby grants to You a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare Derivative Works of, publicly display, publicly perform, sublicense, and distribute the Work and such Derivative Works in Source or Object form.</li>\n</ol>\n<p>Though I haven't seen the llvm excemption legal yet as I don't know where that is.</p>",
        "id": 196041009,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588408845
    },
    {
        "content": "<p>suspect we're good. the intent there is to be permissive which is what I'm looking for, so pretty much bsd.</p>",
        "id": 196041021,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588408917
    },
    {
        "content": "<p>ahhh, here :)</p>\n<p><a href=\"https://llvm.org/LICENSE.txt\" title=\"https://llvm.org/LICENSE.txt\">https://llvm.org/LICENSE.txt</a></p>",
        "id": 196041130,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588409087
    },
    {
        "content": "<p>prefer BSD as these things get complicated for no good reason, that being why I prefer BSD -  its simple, but lets stay technical here unless there's a good reason to dive into legal. I don't have one. that'll do. thanks, all. wanting to contribute back too, have already done so in terms of one bugfix (sample code fopen mode) &amp; trialing this tech first in a real world application. we continue ...</p>",
        "id": 196041304,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588409367
    },
    {
        "content": "<p>lets keep focus here to get to something production ready.</p>\n<p>wasm_instance_new crashes with unresolved imports. can't have it crashing. reject with error code is minimal fix to get inside solution space.</p>",
        "id": 196044088,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588413582
    },
    {
        "content": "<p>The last argument of <code>wasm_instance_new</code> is a pointer to write a pointer to a <code>wasm_trap_t</code> to. Did you pass a null pointer for it? If so, I think you will need to pass it a pointer to a variable to store the pointer in. You can initialize the variable itself to a null pointer though.</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"n\">wasm_trap_t</span> <span class=\"o\">*</span><span class=\"n\">err</span> <span class=\"o\">=</span> <span class=\"nb\">NULL</span><span class=\"p\">;</span>\n<span class=\"n\">wasm_instance_new</span><span class=\"p\">(...,</span> <span class=\"o\">&amp;</span><span class=\"n\">err</span><span class=\"p\">);</span>\n<span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"n\">err</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"c1\">// handle error</span>\n<span class=\"p\">}</span>\n</code></pre></div>",
        "id": 196044621,
        "sender_full_name": "bjorn3",
        "timestamp": 1588414335
    },
    {
        "content": "<p>ahhhh, is that what it is :) </p>\n<p>you rock, again :)</p>\n<p>/passes a virtual beer.</p>",
        "id": 196044666,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588414442
    },
    {
        "content": "<p>will give it a shot, cheers.</p>",
        "id": 196044703,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588414449
    },
    {
        "content": "<p>nope, doesn't fix it. nice try :) still crashes. if it was that, function should fail passing a null back.</p>",
        "id": 196044863,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588414726
    },
    {
        "content": "<p>Do you have a backtrace?</p>",
        "id": 196044880,
        "sender_full_name": "bjorn3",
        "timestamp": 1588414776
    },
    {
        "content": "<p>how is this even working anyway. going to show my ignorance here.</p>\n<p>from hello.c</p>\n<p>const wasm_extern_t* imports[] = { wasm_func_as_extern(test_func) };<br>\n own wasm_instance_t* instance = wasm_instance_new( store, module, imports, &amp;err);</p>\n<p>so ... imports is wasm_extern_t**   - how do you know how long the array is ?</p>\n<p>I'd have minimum null terminated, so this :</p>\n<p>const wasm_extern_t* imports[] = { wasm_func_as_extern(test_func), nullptr };</p>\n<p>is there some trick to get the array length I don't know about ?</p>",
        "id": 196045120,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588415083
    },
    {
        "content": "<p>Looks like <code>wasm_instance_new</code> uses the amount of imports of the wasm module as length of that array: <a href=\"https://github.com/bytecodealliance/wasmtime/blob/9364eb1d98d4b82d30ce72ec1e46ee72a1ea6a0c/crates/c-api/src/instance.rs#L52\" title=\"https://github.com/bytecodealliance/wasmtime/blob/9364eb1d98d4b82d30ce72ec1e46ee72a1ea6a0c/crates/c-api/src/instance.rs#L52\">https://github.com/bytecodealliance/wasmtime/blob/9364eb1d98d4b82d30ce72ec1e46ee72a1ea6a0c/crates/c-api/src/instance.rs#L52</a></p>\n<p>If you directly use <code>wasmtime_instance_new</code>, you can explicitly pass an array length.</p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/bytecodealliance/wasmtime/blob/9364eb1d98d4b82d30ce72ec1e46ee72a1ea6a0c/crates/c-api/src/instance.rs#L52\" style=\"background-image: url(https://avatars0.githubusercontent.com/u/54038801?s=400&amp;v=4)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/bytecodealliance/wasmtime/blob/9364eb1d98d4b82d30ce72ec1e46ee72a1ea6a0c/crates/c-api/src/instance.rs#L52\" title=\"bytecodealliance/wasmtime\">bytecodealliance/wasmtime</a></div><div class=\"message_embed_description\">Standalone JIT-style runtime for WebAssembly, using Cranelift - bytecodealliance/wasmtime</div></div></div>",
        "id": 196045202,
        "sender_full_name": "bjorn3",
        "timestamp": 1588415200
    },
    {
        "content": "<p>I think this should be either documented or preferably changed for <code>wasm-c-api</code>, as it is quite dangerous. cc <span class=\"user-mention\" data-user-id=\"254083\">@Dan Gohman</span>?</p>",
        "id": 196045276,
        "sender_full_name": "bjorn3",
        "timestamp": 1588415311
    },
    {
        "content": "<p>wasmtime_instance_new seems to be the way to go, thanks.</p>\n<p>was going to dive in &amp; fix this myself, but of course wasmtime is written in rust. I am rust noobie, I can barely throw together a 2 line test so think I should leave internals to the pros for now.</p>",
        "id": 196045824,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588416132
    },
    {
        "content": "<p>&amp; that gets me to the wasmtime api - I have  reason to be there now, thanks. will see what other goodies are there.</p>",
        "id": 196045831,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588416170
    },
    {
        "content": "<p>that I think is the crash.  an implicit length from untrusted variable input is used where the code should specify explicitly what its providing as wasmtime_instance_new indeed does. so that's my next job - see if that gets us past the hurdle. cheers :)</p>",
        "id": 196045985,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588416400
    },
    {
        "content": "<p>I think minimum we need to be able to scan input wasm for how many of each time of unresolved it has &amp; then decide whether to proceed. if malicious, corrupt or unintended wasm passes me something with 1000s of unresolved, I think I want to reject it right there.</p>",
        "id": 196046662,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588417616
    },
    {
        "content": "<p>wasmtime_instance_new isn't in the header. maybe I can patch it as it looks exported in the code. also perhaps time to move from distribution to build this myself if we're in active development bouncing off each other now.</p>",
        "id": 196054313,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588429847
    },
    {
        "content": "<p>a distribution update with that in it would be smashing if its easy enough to do. I'd rather not dive into other people's projects if at all possible as hands full where I am.</p>",
        "id": 196054334,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588429900
    },
    {
        "content": "<p>think I step back until I have a wasmtime.h with wasmtime_instance_new defined in it. if thoughts are just come grab trunk and build it, maybe I should. but I'd prefer a package update containing this as its essential &amp; not all about me.</p>",
        "id": 196054737,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588430543
    },
    {
        "content": "<p>ahhh ... it is in truck header :)</p>\n<p><a href=\"https://github.com/bytecodealliance/wasmtime/blob/9364eb1d98d4b82d30ce72ec1e46ee72a1ea6a0c/crates/c-api/include/wasmtime.h\" title=\"https://github.com/bytecodealliance/wasmtime/blob/9364eb1d98d4b82d30ce72ec1e46ee72a1ea6a0c/crates/c-api/include/wasmtime.h\">https://github.com/bytecodealliance/wasmtime/blob/9364eb1d98d4b82d30ce72ec1e46ee72a1ea6a0c/crates/c-api/include/wasmtime.h</a></p>\n<p>so being impatient, I suppose I have a go at building this bad boy :)</p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/bytecodealliance/wasmtime/blob/9364eb1d98d4b82d30ce72ec1e46ee72a1ea6a0c/crates/c-api/include/wasmtime.h\" style=\"background-image: url(https://avatars0.githubusercontent.com/u/54038801?s=400&amp;v=4)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/bytecodealliance/wasmtime/blob/9364eb1d98d4b82d30ce72ec1e46ee72a1ea6a0c/crates/c-api/include/wasmtime.h\" title=\"bytecodealliance/wasmtime\">bytecodealliance/wasmtime</a></div><div class=\"message_embed_description\">Standalone JIT-style runtime for WebAssembly, using Cranelift - bytecodealliance/wasmtime</div></div></div>",
        "id": 196054756,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588430625
    },
    {
        "content": "<p>time for a distribution update as that entrypoint is required to use wasmtime.</p>",
        "id": 196054830,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588430736
    },
    {
        "content": "<p>if current wasm-c-api specifies a nullptr terminated list for imports, you're good as its then fully specified. that it doesn't is the issue. so that's a documentation fix &amp; implementation &amp; sample code fix to resolve. api can stay as it is.</p>",
        "id": 196055097,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588431150
    },
    {
        "content": "<p>wall of text above not helps, can you explain how many modules you are trying to instantiate and how you fill the imports array?</p>",
        "id": 196055159,
        "sender_full_name": "Yury Delendik",
        "timestamp": 1588431273
    },
    {
        "content": "<p>1 test module for now but long term this is how webdevs pass us functionality so we could receive anything.</p>",
        "id": 196055187,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588431329
    },
    {
        "content": "<p>wasm-c-api does not do linking, so building the imports (linking) falls on embedder shoulder</p>",
        "id": 196055193,
        "sender_full_name": "Yury Delendik",
        "timestamp": 1588431361
    },
    {
        "content": "<p>how many imports is in said module and what their types?</p>",
        "id": 196055231,
        "sender_full_name": "Yury Delendik",
        "timestamp": 1588431385
    },
    {
        "content": "<p>I understand I have to provide the imports. for now, I'll go with one function uint32_t mything(uint32 class_id)</p>",
        "id": 196055237,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588431418
    },
    {
        "content": "<p>alright, basic hello_world example covers this use case</p>",
        "id": 196055265,
        "sender_full_name": "Yury Delendik",
        "timestamp": 1588431478
    },
    {
        "content": "<p>so I'm expecting that to be unresolved as we bind it, but this is where webdevs pass us code to run. they might have other stuff unresolved.<br>\nso I need to know whats unresolved to understand if its just our stuff I'm about to patch or other stuff too (a reject)</p>",
        "id": 196055267,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588431481
    },
    {
        "content": "<p>no, hello.c doesn't cover this use case. because webdevs might pass me something with the unresolved I'm expecting &amp; perhaps a bunch of others too.</p>",
        "id": 196055315,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588431522
    },
    {
        "content": "<p>such files should be rejects, but I have no idea what they'll pass as they're untrusted.</p>",
        "id": 196055320,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588431541
    },
    {
        "content": "<p>correct, your code suppose to use wasm_module_imports to build imports for wasm_instance_new</p>",
        "id": 196055325,
        "sender_full_name": "Yury Delendik",
        "timestamp": 1588431548
    },
    {
        "content": "<p>the same order</p>",
        "id": 196055333,
        "sender_full_name": "Yury Delendik",
        "timestamp": 1588431563
    },
    {
        "content": "<p>basically you are doing linking</p>",
        "id": 196055385,
        "sender_full_name": "Yury Delendik",
        "timestamp": 1588431603
    },
    {
        "content": "<p>hang on ... light bulb moment :)</p>",
        "id": 196055402,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588431636
    },
    {
        "content": "<p>sample code has wasm_module_imports <em>after</em> wasmtime_instance_new but there's no reason for it to be that way around.</p>",
        "id": 196055426,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588431673
    },
    {
        "content": "<p>which sample code?</p>",
        "id": 196055433,
        "sender_full_name": "Yury Delendik",
        "timestamp": 1588431689
    },
    {
        "content": "<p>there is no sample code for wasm_module_imports, so you have to improvise and guess that the imports array is populated based on module metadata</p>",
        "id": 196055487,
        "sender_full_name": "Yury Delendik",
        "timestamp": 1588431763
    },
    {
        "content": "<p>I'm hybrid munged reflect.c and hello.c at this point.</p>",
        "id": 196055579,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588431889
    },
    {
        "content": "<p>so yeah, I can perform a wasm_module_imports prior to instantiating anything. and that's part of a sanity check.</p>",
        "id": 196055608,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588431953
    },
    {
        "content": "<p>or maybe it is my santity check. with the minimal example we're running here, I expect 1 import. anything else is fail at that point.</p>",
        "id": 196055662,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588432005
    },
    {
        "content": "<p>in wasmtime, we tried to map c-api to rust, maybe documentation in the rust API will help more, see e.g. <a href=\"https://docs.rs/wasmtime/0.16.0/wasmtime/struct.Instance.html#providing-imports\" title=\"https://docs.rs/wasmtime/0.16.0/wasmtime/struct.Instance.html#providing-imports\">https://docs.rs/wasmtime/0.16.0/wasmtime/struct.Instance.html#providing-imports</a></p>",
        "id": 196055663,
        "sender_full_name": "Yury Delendik",
        "timestamp": 1588432006
    },
    {
        "content": "<p>thanks. /0.16.0/ would help - I'm on 0.15.0 &amp; 0.16.0 has wasmtime_instance_new which I still might need :)</p>",
        "id": 196055746,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588432121
    },
    {
        "content": "<p>Instance::new was there from old versions</p>",
        "id": 196055765,
        "sender_full_name": "Yury Delendik",
        "timestamp": 1588432165
    },
    {
        "content": "<p>wasmtime_instance_new is not directly related to Instance::new, wasm_instance_new is</p>",
        "id": 196055816,
        "sender_full_name": "Yury Delendik",
        "timestamp": 1588432205
    },
    {
        "content": "<p>actually now they are</p>",
        "id": 196055852,
        "sender_full_name": "Yury Delendik",
        "timestamp": 1588432295
    },
    {
        "content": "<p>this might work. I've still got a crash, but after what I think I need. let me figure out what's going bang now.</p>",
        "id": 196055927,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588432373
    },
    {
        "content": "<p>to answer what sample code - the import reflection example we're working on that I'm happy to pass back.</p>",
        "id": 196055940,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588432412
    },
    {
        "content": "<p>maybe worth to sending it to wasm-c-api?</p>",
        "id": 196056031,
        "sender_full_name": "Yury Delendik",
        "timestamp": 1588432509
    },
    {
        "content": "<p>happy to send it where you want. let me clean it up first. this works, thanks so much :)</p>",
        "id": 196056090,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588432603
    },
    {
        "content": "<p>output :</p>\n<p>Initializing...<br>\nLoading binary...<br>\nCompiling module...<br>\nExtracting imports...<br>\nInstantiating module...</p>\n<blockquote>\n<p>import 0 \"create_native\"<br>\nfunc i32 -&gt; i32<br>\nShutting down...</p>\n</blockquote>",
        "id": 196056092,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588432609
    },
    {
        "content": "<p>do extracting imports before \"Instantiate module..\" also, the module field needs to be shown</p>",
        "id": 196056129,
        "sender_full_name": "Yury Delendik",
        "timestamp": 1588432679
    },
    {
        "content": "<p>doh. so simple. now we know what we have we can reject anything that's not as expected before it has the chance to go bang, so its safe.</p>",
        "id": 196056131,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588432681
    },
    {
        "content": "<p>let me grab some more caffeine, tidy that up (its minimal) then you can check I'm doing things correctly direct if you'd like. seems good.</p>",
        "id": 196056191,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588432728
    },
    {
        "content": "<p>right, there is a sensitive topic about what safe and what is not at <a href=\"https://github.com/WebAssembly/wasm-c-api/issues/132\" title=\"https://github.com/WebAssembly/wasm-c-api/issues/132\">https://github.com/WebAssembly/wasm-c-api/issues/132</a></p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/WebAssembly/wasm-c-api/issues/132\" style=\"background-image: url(https://avatars3.githubusercontent.com/u/11578470?s=400&amp;v=4)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/WebAssembly/wasm-c-api/issues/132\" title=\"Safety in the WebAssembly C API Â· Issue #132 Â· WebAssembly/wasm-c-api\">Safety in the WebAssembly C API Â· Issue #132 Â· WebAssembly/wasm-c-api</a></div><div class=\"message_embed_description\">The official C API for WebAssembly should strive for safety to the extent that it can, since security is critically important to many WebAssembly use cases. C is an inherently unsafe language, and ...</div></div></div>",
        "id": 196056208,
        "sender_full_name": "Yury Delendik",
        "timestamp": 1588432779
    },
    {
        "content": "<p>summary: all good. noob stupid moment :)</p>",
        "id": 196056331,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588432961
    },
    {
        "content": "<p>I've got this for imports.c </p>\n<p><a href=\"https://pastebin.com/kmtnVuGy\" title=\"https://pastebin.com/kmtnVuGy\">https://pastebin.com/kmtnVuGy</a></p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://pastebin.com/kmtnVuGy\" style=\"background-image: url(https://pastebin.com/i/facebook.png)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://pastebin.com/kmtnVuGy\" title=\"  #include &lt;stdio.h&gt;  #include &lt;stdlib.h&gt;  #include &lt;string.h&gt;  #include &lt;inttyp - Pastebin.com\">  #include &lt;stdio.h&gt;  #include &lt;stdlib.h&gt;  #include &lt;string.h&gt;  #include &lt;inttyp - Pastebin.com</a></div></div></div>",
        "id": 196056814,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588433425
    },
    {
        "content": "<p>concern - as I'm literally getting my head around this as we go - is the thing that's giving me how many of these things there are the number of unique function signatures or the number of unique functions. I'll put together another test wasm file so I know.</p>",
        "id": 196056844,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588433496
    },
    {
        "content": "<p>perfect. gets the number of unique functions. output from test doing exactly that as follows.</p>\n<p>Initializing...<br>\nLoading binary...<br>\nCompiling module...<br>\nExtracting imports...<br>\nimport 0 \"create_native\"                func i32 -&gt; i32<br>\nimport 1 \"release_native\"               func i32 -&gt; i32<br>\nShutting down...</p>",
        "id": 196057412,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588434321
    },
    {
        "content": "<p>so imports.c above with whatever test wasm anyone wants - it should be able to safely load anything ready to roll.</p>\n<p>and I've got what I need to continue in a safe &amp; robust way. thanks all. back on track. apologies for offroading into fail :)</p>\n<p>that new sample should stop it happening again.</p>",
        "id": 196057479,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588434437
    },
    {
        "content": "<p>might make sense to delete this thread. its quite verbose &amp; don't want to waste people's time on stuff that isn't needed. <br>\nit boils down to see imports.c example code, which I've provided &amp; happy to submit somewhere if desired.</p>",
        "id": 196057618,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588434655
    },
    {
        "content": "<p>thanks for the clang command line, yury. took rust for a spin. I hate it, so implementing our bootstrap in wasm/c++ . <br>\ngot the basics running.<br>\nrust is awful. full of things done differently for no good reason.   yuk.  <br>\nif others want to use it, fine, I won't be one of them :)<br>\nthis isn't a rust group so perhaps shouldn't have even said that &amp; realise you guys like it.<br>\nyou're insane :)</p>",
        "id": 196169488,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588592691
    },
    {
        "content": "<p>... and yes, I know wasmtime is written in rust. not trying to cause offence, its just not for me. we've got solid interfacing so we can all use the language of our choice. we don't all have to choose the same one. that being the elegance of the setup. we continue ... all good :)</p>",
        "id": 196169973,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588593069
    },
    {
        "content": "<p>Just saying you don't want to cause offense doesn't really work if it follows inflammatory language like in this case. Please tone it down.</p>",
        "id": 196172639,
        "sender_full_name": "Till Schneidereit",
        "timestamp": 1588594865
    },
    {
        "content": "<p>sure, sorry.  point was to thank yury for pointing me in the right direction.</p>\n<p>simple stuff like :</p>\n<p>let mut x : int32;</p>\n<p>that doesn't make sense. what's wrong with var if you must have a reserved word ?</p>\n<p>x : int32; </p>\n<p>would be sufficient. its implicit you're declaring.</p>\n<p>the language offends me, hence the tone.</p>\n<p>c-like has many advantages.</p>\n<p>so I tried to macro \"let mut\" to var &amp; couldn't.</p>\n<p>at that point I decided the language doesn't let me do what I want.</p>",
        "id": 196175434,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588596570
    },
    {
        "content": "<p>but anyhow, as stated, this isn't a rust group. just explaining why I'm pivoting back to my happy place. it has no tangible effect on our or your deliverables.</p>\n<p>debug interface upgrade is where the focus should be here. I think, anyway. we can argue about rust syntax other places.</p>",
        "id": 196175618,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588596721
    },
    {
        "content": "<p>also, from c++ I can bash wasm &amp; wasmtime runtime hard to see if your security model stands up. so this is all good.</p>",
        "id": 196175757,
        "sender_full_name": "Steve Williams",
        "timestamp": 1588596801
    }
]