[
    {
        "content": "<p>Hi bytecode alliance,<br>\nI'm having trouble composing two components where one world's interface is 'use'ing a dependent interface. The specific error is as follows. <br>\nNotes</p>\n<ul>\n<li>I get the same error with <code>wac</code> as well.</li>\n<li>wasm-tools validate succeeds for both components</li>\n<li>considering the spec it seems to me like it should work: <a href=\"https://github.com/WebAssembly/component-model/blob/main/design/mvp/WIT.md#transitive-imports-and-worlds\">https://github.com/WebAssembly/component-model/blob/main/design/mvp/WIT.md#transitive-imports-and-worlds</a></li>\n</ul>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"n\">wasm</span><span class=\"o\">-</span><span class=\"n\">tools</span><span class=\"w\"> </span><span class=\"n\">compose</span><span class=\"w\"> </span><span class=\"n\">salutation</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"n\">types</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">o</span><span class=\"w\"> </span><span class=\"n\">sal_ty</span><span class=\"p\">.</span><span class=\"n\">wasm</span>\n<span class=\"n\">error</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">validate</span><span class=\"w\"> </span><span class=\"n\">output</span><span class=\"w\"> </span><span class=\"n\">component</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">sal_ty</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"err\">`</span>\n\n<span class=\"n\">Caused</span><span class=\"w\"> </span><span class=\"n\">by</span><span class=\"p\">:</span>\n<span class=\"w\">    </span><span class=\"mi\">0</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">instance</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">valid</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">be</span><span class=\"w\"> </span><span class=\"n\">used</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">export</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">offset</span><span class=\"w\"> </span><span class=\"mh\">0x10a56</span><span class=\"p\">)</span>\n</code></pre></div>\n<p>salutation/types.wit</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">hotswap</span><span class=\"p\">:</span><span class=\"nc\">salutation</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"p\">;</span>\n\n<span class=\"n\">interface</span><span class=\"w\"> </span><span class=\"n\">user</span><span class=\"o\">-</span><span class=\"n\">interface</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"k\">type</span><span class=\"w\"> </span><span class=\"nc\">tag</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"kt\">u64</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"k\">enum</span><span class=\"w\"> </span><span class=\"nc\">gender</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"n\">male</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"n\">female</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"n\">other</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n\n<span class=\"w\">    </span><span class=\"n\">record</span><span class=\"w\"> </span><span class=\"n\">user</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"n\">name</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">string</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"n\">id</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"kt\">u64</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"n\">tenant</span><span class=\"o\">-</span><span class=\"n\">tags</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">list</span><span class=\"o\">&lt;</span><span class=\"n\">tag</span><span class=\"o\">&gt;</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"n\">gender</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">gender</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n<span class=\"w\">    </span><span class=\"n\">record</span><span class=\"w\"> </span><span class=\"n\">time</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"n\">seconds</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"kt\">u64</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"n\">nanos</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"kt\">u64</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n\n<span class=\"w\">    </span><span class=\"n\">age</span><span class=\"o\">-</span><span class=\"k\">in</span><span class=\"o\">-</span><span class=\"n\">weeks</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">func</span><span class=\"p\">(</span><span class=\"n\">u</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">user</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">now</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">time</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"kt\">u32</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n<span class=\"n\">world</span><span class=\"w\"> </span><span class=\"n\">types</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"n\">export</span><span class=\"w\"> </span><span class=\"n\">user</span><span class=\"o\">-</span><span class=\"n\">interface</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p>salutation/salutation.wit</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">hotswap</span><span class=\"p\">:</span><span class=\"nc\">salutation</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"p\">;</span>\n\n<span class=\"n\">interface</span><span class=\"w\"> </span><span class=\"n\">salutation</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">user</span><span class=\"o\">-</span><span class=\"n\">interface</span><span class=\"p\">.{</span><span class=\"n\">user</span><span class=\"p\">};</span>\n\n<span class=\"w\">    </span><span class=\"n\">variant</span><span class=\"w\"> </span><span class=\"n\">formal</span><span class=\"o\">-</span><span class=\"n\">honorific</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"n\">sir</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"n\">maam</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"n\">sir</span><span class=\"o\">-</span><span class=\"n\">maam</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"n\">custom</span><span class=\"p\">(</span><span class=\"n\">string</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n<span class=\"w\">    </span><span class=\"n\">get</span><span class=\"o\">-</span><span class=\"n\">formal</span><span class=\"o\">-</span><span class=\"n\">honorific</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">func</span><span class=\"p\">(</span><span class=\"n\">u</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">user</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nc\">formal</span><span class=\"o\">-</span><span class=\"n\">honorific</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"n\">greet</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">func</span><span class=\"p\">(</span><span class=\"n\">u</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">user</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nc\">string</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n\n<span class=\"n\">world</span><span class=\"w\"> </span><span class=\"n\">app</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"n\">export</span><span class=\"w\"> </span><span class=\"n\">salutation</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p>Thanks for your help!</p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/WebAssembly/component-model/blob/main/design/mvp/WIT.md#transitive-imports-and-worlds\" style=\"background-image: url(&quot;https://uploads.zulipusercontent.net/badd4c7e4a0400095e260ef4f122f65d61583a99/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f383832333534316666626631616566643163313066363730616630373636643332663166323831393163303533366639323165333130386230626338373836342f576562417373656d626c792f636f6d706f6e656e742d6d6f64656c&quot;)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/WebAssembly/component-model/blob/main/design/mvp/WIT.md#transitive-imports-and-worlds\" title=\"component-model/design/mvp/WIT.md at main · WebAssembly/component-model\">component-model/design/mvp/WIT.md at main · WebAssembly/component-model</a></div><div class=\"message_embed_description\">Repository for design and specification of the Component Model - WebAssembly/component-model</div></div></div>",
        "id": 471034769,
        "sender_full_name": "Evan Simmons",
        "timestamp": 1726591029
    },
    {
        "content": "<p>Can you provide more steps of how to reproduce? As-is I'm not sure what the various components in play are here. It's also worth mentioning that <code>wac</code> should generally be used instead of <code>wasm-tools compose</code> nowadays. I know you say it's the same error message, but figured I'd reiterate anyway</p>",
        "id": 471049967,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1726595429
    },
    {
        "content": "<p>Hi Alex, thanks so much for your suggestion. I've created a repo for repro (lol) here: <a href=\"https://github.com/estk/hotswap-example\">https://github.com/estk/hotswap-example</a></p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/estk/hotswap-example\" style=\"background-image: url(&quot;https://uploads.zulipusercontent.net/bc9ff87c96006ddc1ce81a9e0b530e3b7f6f0984/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f306664373836616438316232303632653162616339376663376161393564363533376437383035623762313961316565653233613039373639646532336263382f6573746b2f686f74737761702d6578616d706c65&quot;)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/estk/hotswap-example\" title=\"GitHub - estk/hotswap-example\">GitHub - estk/hotswap-example</a></div><div class=\"message_embed_description\">Contribute to estk/hotswap-example development by creating an account on GitHub.</div></div></div>",
        "id": 471111570,
        "sender_full_name": "Evan Simmons",
        "timestamp": 1726612704
    },
    {
        "content": "<p>After having the same issue with wac, i enabled logging and backtracing:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"o\">..</span><span class=\"p\">.</span>\n<span class=\"w\"> </span><span class=\"n\">DEBUG</span><span class=\"w\"> </span><span class=\"n\">wac_graph</span><span class=\"p\">::</span><span class=\"n\">encoding</span><span class=\"w\">     </span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"n\">popping</span><span class=\"w\"> </span><span class=\"k\">type</span><span class=\"w\"> </span><span class=\"nc\">scope</span>\n<span class=\"w\"> </span><span class=\"n\">DEBUG</span><span class=\"w\"> </span><span class=\"n\">wac_graph</span><span class=\"p\">::</span><span class=\"n\">encoding</span><span class=\"w\">     </span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"n\">instance</span><span class=\"w\"> </span><span class=\"k\">type</span><span class=\"w\"> </span><span class=\"nc\">encoded</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"k\">type</span><span class=\"w\"> </span><span class=\"nc\">index</span><span class=\"w\"> </span><span class=\"mi\">17</span>\n<span class=\"w\"> </span><span class=\"n\">DEBUG</span><span class=\"w\"> </span><span class=\"n\">wac_graph</span><span class=\"p\">::</span><span class=\"n\">graph</span><span class=\"w\">        </span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">wasi</span><span class=\"p\">:</span><span class=\"nc\">filesystem</span><span class=\"o\">/</span><span class=\"n\">preopens</span><span class=\"o\">@</span><span class=\"mf\">0.2.0</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">encoded</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">instance</span><span class=\"w\"> </span><span class=\"n\">index</span><span class=\"w\"> </span><span class=\"mi\">9</span>\n<span class=\"w\"> </span><span class=\"n\">DEBUG</span><span class=\"w\"> </span><span class=\"n\">wac_graph</span><span class=\"p\">::</span><span class=\"n\">graph</span><span class=\"w\">        </span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"n\">interface</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">wasi</span><span class=\"p\">:</span><span class=\"nc\">filesystem</span><span class=\"o\">/</span><span class=\"n\">preopens</span><span class=\"o\">@</span><span class=\"mf\">0.2.0</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">is</span><span class=\"w\"> </span><span class=\"n\">available</span><span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"n\">aliasing</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">instance</span><span class=\"w\"> </span><span class=\"n\">index</span><span class=\"w\"> </span><span class=\"mi\">9</span>\n<span class=\"w\"> </span><span class=\"n\">DEBUG</span><span class=\"w\"> </span><span class=\"n\">wac_graph</span><span class=\"p\">::</span><span class=\"n\">graph</span><span class=\"w\">        </span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"n\">instantiating</span><span class=\"w\"> </span><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">plug</span><span class=\"p\">:</span><span class=\"nc\">types</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">with</span><span class=\"w\"> </span><span class=\"n\">arguments</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[(</span><span class=\"s\">\"wasi:cli/environment@0.2.0\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Instance</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"s\">\"wasi:cli/exit@0.2.0\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Instance</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"s\">\"wasi:io/error@0.2.0\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Instance</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"s\">\"wasi:io/streams@0.2.0\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Instance</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"s\">\"wasi:cli/stdin@0.2.0\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Instance</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"s\">\"wasi:cli/stdout@0.2.0\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Instance</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"s\">\"wasi:cli/stderr@0.2.0\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Instance</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">6</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"s\">\"wasi:clocks/wall-clock@0.2.0\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Instance</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">7</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"s\">\"wasi:filesystem/types@0.2.0\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Instance</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">8</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"s\">\"wasi:filesystem/preopens@0.2.0\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Instance</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">9</span><span class=\"p\">)]</span>\n<span class=\"w\"> </span><span class=\"n\">DEBUG</span><span class=\"w\"> </span><span class=\"n\">wac_graph</span><span class=\"p\">::</span><span class=\"n\">graph</span><span class=\"w\">        </span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"n\">instantiation</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">plug</span><span class=\"p\">:</span><span class=\"nc\">types</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">encoded</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">instance</span><span class=\"w\"> </span><span class=\"n\">index</span><span class=\"w\"> </span><span class=\"mi\">10</span>\n<span class=\"w\"> </span><span class=\"n\">DEBUG</span><span class=\"w\"> </span><span class=\"n\">wac_graph</span><span class=\"p\">::</span><span class=\"n\">graph</span><span class=\"w\">        </span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"n\">encoding</span><span class=\"w\"> </span><span class=\"n\">alias</span><span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"n\">instance</span><span class=\"w\"> </span><span class=\"n\">export</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">hotswap</span><span class=\"p\">:</span><span class=\"nc\">salutation</span><span class=\"o\">/</span><span class=\"n\">user</span><span class=\"o\">-</span><span class=\"n\">interface</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">instance</span><span class=\"w\"> </span><span class=\"n\">index</span><span class=\"w\"> </span><span class=\"mi\">10</span>\n<span class=\"w\"> </span><span class=\"n\">DEBUG</span><span class=\"w\"> </span><span class=\"n\">wac_graph</span><span class=\"p\">::</span><span class=\"n\">graph</span><span class=\"w\">        </span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"n\">alias</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">export</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">hotswap</span><span class=\"p\">:</span><span class=\"nc\">salutation</span><span class=\"o\">/</span><span class=\"n\">user</span><span class=\"o\">-</span><span class=\"n\">interface</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">encoded</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">instance</span><span class=\"w\"> </span><span class=\"n\">index</span><span class=\"w\"> </span><span class=\"mi\">11</span>\n<span class=\"w\"> </span><span class=\"n\">DEBUG</span><span class=\"w\"> </span><span class=\"n\">wac_graph</span><span class=\"p\">::</span><span class=\"n\">graph</span><span class=\"w\">        </span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"n\">instantiating</span><span class=\"w\"> </span><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">socket</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">with</span><span class=\"w\"> </span><span class=\"n\">arguments</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[(</span><span class=\"s\">\"hotswap:salutation/user-interface@0.1.0\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Instance</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">11</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"s\">\"wasi:cli/environment@0.2.0\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Instance</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"s\">\"wasi:cli/exit@0.2.0\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Instance</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"s\">\"wasi:io/error@0.2.0\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Instance</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"s\">\"wasi:io/streams@0.2.0\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Instance</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"s\">\"wasi:cli/stdin@0.2.0\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Instance</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"s\">\"wasi:cli/stdout@0.2.0\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Instance</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"s\">\"wasi:cli/stderr@0.2.0\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Instance</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">6</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"s\">\"wasi:clocks/wall-clock@0.2.0\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Instance</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">7</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"s\">\"wasi:filesystem/types@0.2.0\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Instance</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">8</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"s\">\"wasi:filesystem/preopens@0.2.0\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Instance</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">9</span><span class=\"p\">)]</span>\n<span class=\"w\"> </span><span class=\"n\">DEBUG</span><span class=\"w\"> </span><span class=\"n\">wac_graph</span><span class=\"p\">::</span><span class=\"n\">graph</span><span class=\"w\">        </span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"n\">instantiation</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">socket</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">encoded</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">instance</span><span class=\"w\"> </span><span class=\"n\">index</span><span class=\"w\"> </span><span class=\"mi\">12</span>\n<span class=\"w\"> </span><span class=\"n\">DEBUG</span><span class=\"w\"> </span><span class=\"n\">wac_graph</span><span class=\"p\">::</span><span class=\"n\">graph</span><span class=\"w\">        </span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"n\">encoding</span><span class=\"w\"> </span><span class=\"n\">alias</span><span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"n\">instance</span><span class=\"w\"> </span><span class=\"n\">export</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">hotswap</span><span class=\"p\">:</span><span class=\"nc\">salutation</span><span class=\"o\">/</span><span class=\"n\">salutation</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">instance</span><span class=\"w\"> </span><span class=\"n\">index</span><span class=\"w\"> </span><span class=\"mi\">12</span>\n<span class=\"w\"> </span><span class=\"n\">DEBUG</span><span class=\"w\"> </span><span class=\"n\">wac_graph</span><span class=\"p\">::</span><span class=\"n\">graph</span><span class=\"w\">        </span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"n\">alias</span><span class=\"w\"> </span><span class=\"n\">of</span><span class=\"w\"> </span><span class=\"n\">export</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">hotswap</span><span class=\"p\">:</span><span class=\"nc\">salutation</span><span class=\"o\">/</span><span class=\"n\">salutation</span><span class=\"o\">@</span><span class=\"mf\">0.1.0</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">encoded</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">instance</span><span class=\"w\"> </span><span class=\"n\">index</span><span class=\"w\"> </span><span class=\"mi\">13</span>\n<span class=\"n\">error</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">encoding</span><span class=\"w\"> </span><span class=\"n\">produced</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">component</span><span class=\"w\"> </span><span class=\"n\">that</span><span class=\"w\"> </span><span class=\"n\">failed</span><span class=\"w\"> </span><span class=\"n\">validation</span>\n\n<span class=\"n\">Caused</span><span class=\"w\"> </span><span class=\"n\">by</span><span class=\"p\">:</span>\n<span class=\"w\">    </span><span class=\"nc\">instance</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">valid</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">be</span><span class=\"w\"> </span><span class=\"n\">used</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">export</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">offset</span><span class=\"w\"> </span><span class=\"mh\">0x36d3bf</span><span class=\"p\">)</span>\n\n<span class=\"n\">Stack</span><span class=\"w\"> </span><span class=\"n\">backtrace</span><span class=\"p\">:</span>\n<span class=\"w\">   </span><span class=\"mi\">0</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">std</span><span class=\"p\">::</span><span class=\"n\">backtrace_rs</span><span class=\"p\">::</span><span class=\"n\">backtrace</span><span class=\"p\">::</span><span class=\"n\">libunwind</span><span class=\"p\">::</span><span class=\"n\">trace</span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">eeb90cda1969383f56a2637cbd3037bdf598841c</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/../../</span><span class=\"n\">backtrace</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">backtrace</span><span class=\"o\">/</span><span class=\"n\">libunwind</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">116</span><span class=\"p\">:</span><span class=\"mi\">5</span>\n<span class=\"w\">   </span><span class=\"mi\">1</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">std</span><span class=\"p\">::</span><span class=\"n\">backtrace_rs</span><span class=\"p\">::</span><span class=\"n\">backtrace</span><span class=\"p\">::</span><span class=\"n\">trace_unsynchronized</span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">eeb90cda1969383f56a2637cbd3037bdf598841c</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/../../</span><span class=\"n\">backtrace</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">backtrace</span><span class=\"o\">/</span><span class=\"k\">mod</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">66</span><span class=\"p\">:</span><span class=\"mi\">5</span>\n<span class=\"w\">   </span><span class=\"mi\">2</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">std</span><span class=\"p\">::</span><span class=\"n\">backtrace</span><span class=\"p\">::</span><span class=\"n\">Backtrace</span><span class=\"p\">::</span><span class=\"n\">create</span>\n<span class=\"w\">             </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">eeb90cda1969383f56a2637cbd3037bdf598841c</span><span class=\"o\">/</span><span class=\"n\">library</span><span class=\"o\">/</span><span class=\"n\">std</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">backtrace</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">331</span><span class=\"p\">:</span><span class=\"mi\">13</span>\n<span class=\"w\">   </span><span class=\"mi\">3</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">anyhow</span><span class=\"p\">::</span><span class=\"n\">error</span><span class=\"p\">::</span><span class=\"o\">&lt;</span><span class=\"k\">impl</span><span class=\"w\"> </span><span class=\"n\">core</span><span class=\"p\">::</span><span class=\"n\">convert</span><span class=\"p\">::</span><span class=\"nb\">From</span><span class=\"o\">&lt;</span><span class=\"n\">E</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"n\">anyhow</span><span class=\"p\">::</span><span class=\"n\">Error</span><span class=\"o\">&gt;</span><span class=\"p\">::</span><span class=\"n\">from</span>\n<span class=\"w\">   </span><span class=\"mi\">4</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">core</span><span class=\"p\">::</span><span class=\"n\">result</span><span class=\"p\">::</span><span class=\"nb\">Result</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"p\">,</span><span class=\"n\">F</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">core</span><span class=\"p\">::</span><span class=\"n\">ops</span><span class=\"p\">::</span><span class=\"n\">try_trait</span><span class=\"p\">::</span><span class=\"n\">FromResidual</span><span class=\"o\">&lt;</span><span class=\"n\">core</span><span class=\"p\">::</span><span class=\"n\">result</span><span class=\"p\">::</span><span class=\"nb\">Result</span><span class=\"o\">&lt;</span><span class=\"n\">core</span><span class=\"p\">::</span><span class=\"n\">convert</span><span class=\"p\">::</span><span class=\"n\">Infallible</span><span class=\"p\">,</span><span class=\"n\">E</span><span class=\"o\">&gt;&gt;&gt;</span><span class=\"p\">::</span><span class=\"n\">from_residual</span>\n<span class=\"w\">   </span><span class=\"mi\">5</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">wac_cli</span><span class=\"p\">::</span><span class=\"n\">commands</span><span class=\"p\">::</span><span class=\"n\">plug</span><span class=\"p\">::</span><span class=\"n\">PlugCommand</span><span class=\"p\">::</span><span class=\"n\">exec</span><span class=\"p\">::{{</span><span class=\"n\">closure</span><span class=\"p\">}}</span>\n<span class=\"w\">   </span><span class=\"mi\">6</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">wac</span><span class=\"p\">::</span><span class=\"n\">main</span><span class=\"p\">::{{</span><span class=\"n\">closure</span><span class=\"p\">}}</span>\n<span class=\"o\">..</span><span class=\"p\">.</span>\n</code></pre></div>",
        "id": 471112049,
        "sender_full_name": "Evan Simmons",
        "timestamp": 1726612933
    },
    {
        "content": "<p>thanks! I'll try to take a look at this in the near future. If you'd like as well in the meantime I think it'd be reasonable to file an issue too</p>",
        "id": 471282061,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1726672030
    },
    {
        "content": "<p>Cool, ya i think this might be the same issue: <a href=\"https://github.com/bytecodealliance/wasm-tools/issues/1798\">https://github.com/bytecodealliance/wasm-tools/issues/1798</a></p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/bytecodealliance/wasm-tools/issues/1798\" style=\"background-image: url(&quot;https://uploads.zulipusercontent.net/415b4943b56f4ffb05cc4af064eb69abb28e9ca4/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f323662633236333438666438643439613038656331383633613664323531393533386434663135353064623530396334393535383130616566396333326463662f62797465636f6465616c6c69616e63652f7761736d2d746f6f6c732f6973737565732f31373938&quot;)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/bytecodealliance/wasm-tools/issues/1798\" title=\"failed to validate output component · Issue #1798 · bytecodealliance/wasm-tools\">failed to validate output component · Issue #1798 · bytecodealliance/wasm-tools</a></div><div class=\"message_embed_description\">Component has been built successfully but failed the invalidation. This repo https://github.com/sammyne/wasm-component-broken-compose is made to reproduce the problem. Requirement Rust 1.80.1 (3762...</div></div></div>",
        "id": 471367705,
        "sender_full_name": "Evan Simmons",
        "timestamp": 1726703278
    },
    {
        "content": "<p>A bit delayed getting to this but I left a comment on the issue there about what's going wrong, let me know if the workaround of \"move the types around\" doesn't work for you though</p>",
        "id": 471808343,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1726858411
    },
    {
        "content": "<p>That was a super helpful explanation. I just tried the suggestion, and it seems the consequences of moving the type up is that the top level component then needs to implement that interface.</p>",
        "id": 471819495,
        "sender_full_name": "Evan Simmons",
        "timestamp": 1726861879
    },
    {
        "content": "<p>My use case is roughly, team A owns the raw data and type definitions, team B, C, ... imports those and uses them in their business logic. Maybe there is some other way to accomplish this?</p>",
        "id": 471819814,
        "sender_full_name": "Evan Simmons",
        "timestamp": 1726861953
    },
    {
        "content": "<p>Ive created an issue in the wac repo here: <a href=\"https://github.com/bytecodealliance/wac/issues/141\">https://github.com/bytecodealliance/wac/issues/141</a></p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/bytecodealliance/wac/issues/141\" style=\"background-image: url(&quot;https://uploads.zulipusercontent.net/0010187f47680491e9720dfa40dbeedeaeb63eb0/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f303165396536613535353134623432656639363363346532363738333865336434613265363837616363656334626666333065393835353630333531383138612f62797465636f6465616c6c69616e63652f7761632f6973737565732f313431&quot;)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/bytecodealliance/wac/issues/141\" title=\"wac plug error: &quot;error: encoding produced a component that failed validation&quot; · Issue #141 · bytecodealliance/wac\">wac plug error: \"error: encoding produced a component that failed validation\" · Issue #141 · bytecodealliance/wac</a></div><div class=\"message_embed_description\">Repro https://github.com/estk/hotswap-example The error wac plug --plug types.wasm salutation.wasm -o tysal.wasm error: encoding produced a component that failed validation Caused by: instance not ...</div></div></div>",
        "id": 471820870,
        "sender_full_name": "Evan Simmons",
        "timestamp": 1726862124
    },
    {
        "content": "<p>Another possibility is to split <code>interface salutation</code> into <code>interface salutation</code> and <code>interface salutation-types</code>, and I think that should work?</p>",
        "id": 471824282,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1726862879
    },
    {
        "content": "<p>standby let me try that</p>",
        "id": 471824766,
        "sender_full_name": "Evan Simmons",
        "timestamp": 1726863083
    },
    {
        "content": "<p>i pushed the changes to my main branch, one sec and ill try to fix the compile err</p>",
        "id": 471826551,
        "sender_full_name": "Evan Simmons",
        "timestamp": 1726863643
    },
    {
        "content": "<p>ok, its typechecking now, but same error</p>",
        "id": 471827845,
        "sender_full_name": "Evan Simmons",
        "timestamp": 1726864086
    },
    {
        "content": "<p><a href=\"http://types.rs\">types.rs</a></p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">interface</span><span class=\"w\"> </span><span class=\"n\">user</span><span class=\"o\">-</span><span class=\"n\">types</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"k\">type</span><span class=\"w\"> </span><span class=\"nc\">tag</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"kt\">u64</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"k\">enum</span><span class=\"w\"> </span><span class=\"nc\">gender</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"n\">male</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"n\">female</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"n\">other</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n\n<span class=\"w\">    </span><span class=\"n\">record</span><span class=\"w\"> </span><span class=\"n\">user</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"n\">name</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">string</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"n\">id</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"kt\">u64</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"n\">tenant</span><span class=\"o\">-</span><span class=\"n\">tags</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">list</span><span class=\"o\">&lt;</span><span class=\"n\">tag</span><span class=\"o\">&gt;</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"n\">gender</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">gender</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n<span class=\"w\">    </span><span class=\"n\">record</span><span class=\"w\"> </span><span class=\"n\">time</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"n\">seconds</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"kt\">u64</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"n\">nanos</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"kt\">u64</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n<span class=\"p\">}</span>\n\n<span class=\"n\">interface</span><span class=\"w\"> </span><span class=\"n\">user</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">user</span><span class=\"o\">-</span><span class=\"n\">types</span><span class=\"p\">.{</span><span class=\"n\">user</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">time</span><span class=\"p\">};</span>\n<span class=\"w\">    </span><span class=\"n\">age</span><span class=\"o\">-</span><span class=\"k\">in</span><span class=\"o\">-</span><span class=\"n\">weeks</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">func</span><span class=\"p\">(</span><span class=\"n\">u</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">user</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">now</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">time</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"kt\">u32</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n<span class=\"n\">world</span><span class=\"w\"> </span><span class=\"n\">types</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"n\">export</span><span class=\"w\"> </span><span class=\"n\">user</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"n\">export</span><span class=\"w\"> </span><span class=\"n\">user</span><span class=\"o\">-</span><span class=\"n\">types</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div>",
        "id": 471827953,
        "sender_full_name": "Evan Simmons",
        "timestamp": 1726864137
    },
    {
        "content": "<p><a href=\"http://salutation.rs\">salutation.rs</a></p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">interface</span><span class=\"w\"> </span><span class=\"n\">salutation</span><span class=\"o\">-</span><span class=\"n\">types</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"n\">variant</span><span class=\"w\"> </span><span class=\"n\">formal</span><span class=\"o\">-</span><span class=\"n\">honorific</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"n\">sir</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"n\">maam</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"n\">sir</span><span class=\"o\">-</span><span class=\"n\">maam</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"n\">custom</span><span class=\"p\">(</span><span class=\"n\">string</span><span class=\"p\">)</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n<span class=\"p\">}</span>\n<span class=\"n\">interface</span><span class=\"w\"> </span><span class=\"n\">salutation</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">user</span><span class=\"o\">-</span><span class=\"n\">types</span><span class=\"p\">.{</span><span class=\"n\">user</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">time</span><span class=\"p\">};</span>\n<span class=\"w\">    </span><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">salutation</span><span class=\"o\">-</span><span class=\"n\">types</span><span class=\"p\">.{</span><span class=\"n\">formal</span><span class=\"o\">-</span><span class=\"n\">honorific</span><span class=\"p\">};</span>\n\n<span class=\"w\">    </span><span class=\"n\">get</span><span class=\"o\">-</span><span class=\"n\">formal</span><span class=\"o\">-</span><span class=\"n\">honorific</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">func</span><span class=\"p\">(</span><span class=\"n\">u</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">user</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nc\">formal</span><span class=\"o\">-</span><span class=\"n\">honorific</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"n\">greet</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">func</span><span class=\"p\">(</span><span class=\"n\">u</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">user</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nc\">string</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n\n<span class=\"n\">world</span><span class=\"w\"> </span><span class=\"n\">app</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"n\">user</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"n\">user</span><span class=\"o\">-</span><span class=\"n\">types</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"n\">export</span><span class=\"w\"> </span><span class=\"n\">salutation</span><span class=\"o\">-</span><span class=\"n\">types</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"n\">export</span><span class=\"w\"> </span><span class=\"n\">salutation</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div>",
        "id": 471828003,
        "sender_full_name": "Evan Simmons",
        "timestamp": 1726864162
    },
    {
        "content": "<p>if you remove <code>export salutation-types</code> does it work?</p>",
        "id": 471829925,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1726864991
    },
    {
        "content": "<p>(maybe <code>export user-types</code> too?)</p>",
        "id": 471829949,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1726865003
    },
    {
        "content": "<p>standby</p>",
        "id": 471830731,
        "sender_full_name": "Evan Simmons",
        "timestamp": 1726865354
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">world</span><span class=\"w\"> </span><span class=\"n\">app</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"n\">user</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"n\">export</span><span class=\"w\"> </span><span class=\"n\">salutation</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">cargo</span><span class=\"w\"> </span><span class=\"n\">component</span><span class=\"w\"> </span><span class=\"n\">build</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">types</span>\n<span class=\"n\">cargo</span><span class=\"w\"> </span><span class=\"n\">component</span><span class=\"w\"> </span><span class=\"n\">build</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">p</span><span class=\"w\"> </span><span class=\"n\">salutation</span>\n<span class=\"w\">    </span><span class=\"n\">Finished</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">dev</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">profile</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">unoptimized</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"n\">debuginfo</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"n\">target</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"mf\">0.02</span><span class=\"n\">s</span>\n<span class=\"w\">    </span><span class=\"n\">Finished</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">dev</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">profile</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"n\">unoptimized</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"n\">debuginfo</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"n\">target</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"mf\">0.00</span><span class=\"n\">s</span>\n\n<span class=\"n\">wac</span><span class=\"w\"> </span><span class=\"n\">plug</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">plug</span><span class=\"w\"> </span><span class=\"n\">types</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"n\">salutation</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">o</span><span class=\"w\"> </span><span class=\"n\">tysal</span><span class=\"p\">.</span><span class=\"n\">wasm</span>\n<span class=\"n\">error</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">encoding</span><span class=\"w\"> </span><span class=\"n\">produced</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">component</span><span class=\"w\"> </span><span class=\"n\">that</span><span class=\"w\"> </span><span class=\"n\">failed</span><span class=\"w\"> </span><span class=\"n\">validation</span>\n\n<span class=\"n\">Caused</span><span class=\"w\"> </span><span class=\"n\">by</span><span class=\"p\">:</span>\n<span class=\"w\">    </span><span class=\"nc\">instance</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">valid</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">be</span><span class=\"w\"> </span><span class=\"n\">used</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">export</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">offset</span><span class=\"w\"> </span><span class=\"mh\">0x36dcea</span><span class=\"p\">)</span>\n</code></pre></div>",
        "id": 471830932,
        "sender_full_name": "Evan Simmons",
        "timestamp": 1726865443
    },
    {
        "content": "<p>(same deal with user-types still imported)</p>",
        "id": 471831047,
        "sender_full_name": "Evan Simmons",
        "timestamp": 1726865513
    },
    {
        "content": "<p>hm so locally if I take the WITs you just mentioned above and delete <code>export user-types;</code>, <code>import user-types;</code>, and <code>export salutation-types;</code> I can get a composition to work locally</p>",
        "id": 471832471,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1726866165
    },
    {
        "content": "<p>did you update <code>world types { ... }</code> as well to not have the <code>export user-types</code>?</p>",
        "id": 471832506,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1726866190
    },
    {
        "content": "<p>(and to be clear this is all still a bug in wac/wasm-compose, in the meantime I'm curious if a workaround is possible)</p>",
        "id": 471832533,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1726866209
    },
    {
        "content": "<p>Sorry for the delay, was in mtgs. Ok, so yes with those changes it does work!</p>",
        "id": 471851673,
        "sender_full_name": "Evan Simmons",
        "timestamp": 1726875468
    },
    {
        "content": "<p>I've pushed a commit to the main branch with those fixes. Super interesting that that worked.</p>",
        "id": 471851810,
        "sender_full_name": "Evan Simmons",
        "timestamp": 1726875574
    }
]