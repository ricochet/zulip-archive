[
    {
        "content": "<p>Hi Community,</p>\n<p>I am trying to follow the steps in <a href=\"https://bytecodealliance.org/articles/wasi-threads\">https://bytecodealliance.org/articles/wasi-threads</a>, and I have encountered the error:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"o\">../</span><span class=\"n\">wasmtime</span><span class=\"o\">/</span><span class=\"n\">target</span><span class=\"o\">/</span><span class=\"n\">debug</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">wasm</span><span class=\"o\">=</span><span class=\"n\">threads</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">wasi</span><span class=\"o\">-</span><span class=\"n\">modules</span><span class=\"o\">=</span><span class=\"n\">experimental</span><span class=\"o\">-</span><span class=\"n\">wasi</span><span class=\"o\">-</span><span class=\"n\">threads</span><span class=\"w\"> </span><span class=\"n\">thread</span><span class=\"o\">-</span><span class=\"n\">test</span><span class=\"p\">.</span><span class=\"n\">wasm</span>\n<span class=\"n\">error</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">unexpected</span><span class=\"w\"> </span><span class=\"n\">argument</span><span class=\"w\"> </span><span class=\"o\">'--</span><span class=\"n\">wasi</span><span class=\"o\">-</span><span class=\"n\">modules</span><span class=\"o\">'</span><span class=\"w\"> </span><span class=\"n\">found</span>\n\n<span class=\"w\">  </span><span class=\"n\">tip</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">a</span><span class=\"w\"> </span><span class=\"n\">similar</span><span class=\"w\"> </span><span class=\"n\">argument</span><span class=\"w\"> </span><span class=\"n\">exists</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"o\">'--</span><span class=\"n\">wasi</span><span class=\"o\">'</span>\n\n<span class=\"n\">Usage</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">&lt;--</span><span class=\"n\">optimize</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">KEY</span><span class=\"p\">[</span><span class=\"o\">=</span><span class=\"n\">VAL</span><span class=\"p\">[,</span><span class=\"o\">..</span><span class=\"p\">]]</span><span class=\"o\">&gt;|--</span><span class=\"n\">codegen</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">KEY</span><span class=\"p\">[</span><span class=\"o\">=</span><span class=\"n\">VAL</span><span class=\"p\">[,</span><span class=\"o\">..</span><span class=\"p\">]]</span><span class=\"o\">&gt;|--</span><span class=\"n\">debug</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">KEY</span><span class=\"p\">[</span><span class=\"o\">=</span><span class=\"n\">VAL</span><span class=\"p\">[,</span><span class=\"o\">..</span><span class=\"p\">]]</span><span class=\"o\">&gt;|--</span><span class=\"n\">wasm</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">KEY</span><span class=\"p\">[</span><span class=\"o\">=</span><span class=\"n\">VAL</span><span class=\"p\">[,</span><span class=\"o\">..</span><span class=\"p\">]]</span><span class=\"o\">&gt;|--</span><span class=\"n\">wasi</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">KEY</span><span class=\"p\">[</span><span class=\"o\">=</span><span class=\"n\">VAL</span><span class=\"p\">[,</span><span class=\"o\">..</span><span class=\"p\">]]</span><span class=\"o\">&gt;&gt;</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">WASM</span><span class=\"o\">&gt;..</span><span class=\"p\">.</span>\n\n<span class=\"n\">For</span><span class=\"w\"> </span><span class=\"n\">more</span><span class=\"w\"> </span><span class=\"n\">information</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kr\">try</span><span class=\"w\"> </span><span class=\"o\">'--</span><span class=\"n\">help</span><span class=\"o\">'</span><span class=\"p\">.</span>\n</code></pre></div>\n<p>Then I tried another commend, but still get error:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"o\">../</span><span class=\"n\">wasmtime</span><span class=\"o\">/</span><span class=\"n\">target</span><span class=\"o\">/</span><span class=\"n\">debug</span><span class=\"o\">/</span><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">wasm</span><span class=\"o\">=</span><span class=\"n\">threads</span><span class=\"w\"> </span><span class=\"n\">thread</span><span class=\"o\">-</span><span class=\"n\">test</span><span class=\"p\">.</span><span class=\"n\">wasm</span>\n<span class=\"n\">Error</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"w\"> </span><span class=\"n\">module</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">thread</span><span class=\"o\">-</span><span class=\"n\">test</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"err\">`</span>\n\n<span class=\"n\">Caused</span><span class=\"w\"> </span><span class=\"n\">by</span><span class=\"p\">:</span>\n<span class=\"w\">    </span><span class=\"mi\">0</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">instantiate</span><span class=\"w\"> </span><span class=\"s\">\"thread-test.wasm\"</span>\n<span class=\"w\">    </span><span class=\"mi\">1</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">unknown</span><span class=\"w\"> </span><span class=\"n\">import</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">env</span><span class=\"p\">::</span><span class=\"n\">memory</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">has</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">been</span><span class=\"w\"> </span><span class=\"n\">defined</span>\n</code></pre></div>\n<p>Any help will be appreciated!</p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://bytecodealliance.org/articles/wasi-threads\" style=\"background-image: url(&quot;https://uploads.zulipusercontent.net/b666ca74a20745aca2566cd241108afdcfa09d04/68747470733a2f2f62797465636f6465616c6c69616e63652e6f72672f696d616765732f6176617461722e706e67&quot;)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://bytecodealliance.org/articles/wasi-threads\" title=\"Announcing wasi-threads\">Announcing wasi-threads</a></div><div class=\"message_embed_description\">Until now, one piece missing from WebAssembly standalone engines was the ability to spawn threads.Browsers have had this ability for some time via Web Workers, but standalone engines had no standardway to do this. This post describes the...</div></div></div>",
        "id": 446134885,
        "sender_full_name": "Dennis Zhang",
        "timestamp": 1718991162
    },
    {
        "content": "<p>You need <code>wasmtime run --wasi threads=y --wasi preview2=n</code>.</p>",
        "id": 446136433,
        "sender_full_name": "bjorn3",
        "timestamp": 1718991518
    },
    {
        "content": "<p>The wasmtime cli has changed since the wasi-threads announcement was made.</p>",
        "id": 446136756,
        "sender_full_name": "bjorn3",
        "timestamp": 1718991598
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"264278\">bjorn3</span> <a href=\"#narrow/stream/206238-general/topic/wasmtime.20cannot.20run.20wasi-threads/near/446136756\">said</a>:</p>\n<blockquote>\n<p>The wasmtime cli has changed since the wasi-threads announcement was made.</p>\n</blockquote>\n<p>Thanks so much!</p>",
        "id": 446137840,
        "sender_full_name": "Dennis Zhang",
        "timestamp": 1718991956
    }
]