[
    {
        "content": "<p>hi again all, I'm trying to get WASI code working in the browser.  I'm using the following example code (minimal example):</p>\n<div class=\"codehilite\"><pre><span></span>#include &lt;stdio.h&gt;\n\nint main(int argc, const char** argv)\n{\n    FILE* f = fopen(&quot;file.txt&quot;, &quot;wb&quot;);\n    fprintf(f, &quot;%s&quot;, &quot;Hello World!\\n&quot;);\n    fclose(f);\n\n    return 0;\n}\n</pre></div>\n\n\n<p>The program works fine when compiled natively, and when compiled to wasm and run inside wasmtime.  But when I try to run it inside either Chromium or Firefox, I get an exception.  From Chromium (which seems to find more debug info):</p>\n<div class=\"codehilite\"><pre><span></span>Uncaught (in promise) RuntimeError: function signature mismatch\n    at fclose (wasm-function[85]:0x19097)\n    at main (wasm-function[15]:0x468)\n(...)\n</pre></div>\n\n\n<p>Poking around some more in the debugger, it looks like that error corresponds to this line inside the implementation of <code>fclose()</code>, in the sysroot that I'm using:  (I don't immediately see a function signature mismatch here, but function pointers are weird so...)</p>\n<div class=\"codehilite\"><pre><span></span>        r |= f-&gt;close(f);\n</pre></div>\n\n\n<p>The code works fine if I comment out the fclose() call (but presumably leaks the file handle -- doesn't matter in this trivial example but not ideal for real code :-) )<br>\nAnyway, I don't suppose anyone has any idea what's up?</p>",
        "id": 193683189,
        "sender_full_name": "Adam Seering",
        "timestamp": 1586644775
    }
]