[
    {
        "content": "<p>Hey everyone,<br>\nI'm trying to compile a component without any WASI imports as they're not necessary in this case. I'm using target <code>wasm32-unknown-unknown</code> and I'm getting this error,</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">error</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">decode</span><span class=\"w\"> </span><span class=\"n\">world</span><span class=\"w\"> </span><span class=\"n\">from</span><span class=\"w\"> </span><span class=\"n\">module</span>\n\n<span class=\"n\">Caused</span><span class=\"w\"> </span><span class=\"n\">by</span><span class=\"p\">:</span>\n<span class=\"w\">    </span><span class=\"mi\">0</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">module</span><span class=\"w\"> </span><span class=\"n\">was</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">valid</span>\n<span class=\"w\">    </span><span class=\"mi\">1</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">module</span><span class=\"w\"> </span><span class=\"n\">requires</span><span class=\"w\"> </span><span class=\"n\">an</span><span class=\"w\"> </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"n\">interface</span><span class=\"w\"> </span><span class=\"n\">named</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">__wbindgen_placeholder__</span><span class=\"err\">`</span>\n</code></pre></div>\n<p>Here is the WIT file,</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">package</span><span class=\"w\"> </span><span class=\"n\">graph</span><span class=\"p\">:</span><span class=\"nc\">api</span><span class=\"o\">@</span><span class=\"mf\">0.0.1</span><span class=\"p\">;</span>\n\n<span class=\"n\">interface</span><span class=\"w\"> </span><span class=\"n\">data</span><span class=\"o\">-</span><span class=\"n\">store</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"n\">resource</span><span class=\"w\"> </span><span class=\"n\">db</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"n\">constructor</span><span class=\"p\">();</span>\n<span class=\"w\">        </span><span class=\"n\">scan</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">func</span><span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">tuple</span><span class=\"o\">&lt;</span><span class=\"n\">string</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">string</span><span class=\"o\">&gt;</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nc\">list</span><span class=\"o\">&lt;</span><span class=\"kt\">u8</span><span class=\"o\">&gt;</span><span class=\"p\">;</span>\n<span class=\"w\">        </span><span class=\"n\">schema</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">func</span><span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">tuple</span><span class=\"o\">&lt;</span><span class=\"n\">string</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">string</span><span class=\"o\">&gt;</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nc\">list</span><span class=\"o\">&lt;</span><span class=\"kt\">u8</span><span class=\"o\">&gt;</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n<span class=\"p\">}</span>\n\n<span class=\"n\">world</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"k\">enum</span><span class=\"w\"> </span><span class=\"nc\">error</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"n\">none</span><span class=\"p\">,</span>\n<span class=\"w\">        </span><span class=\"n\">deserialize</span><span class=\"p\">,</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n\n<span class=\"w\">    </span><span class=\"n\">export</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"o\">-</span><span class=\"n\">query</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">func</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nc\">result</span><span class=\"o\">&lt;</span><span class=\"n\">tuple</span><span class=\"o\">&lt;</span><span class=\"n\">list</span><span class=\"o\">&lt;</span><span class=\"kt\">u8</span><span class=\"o\">&gt;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">list</span><span class=\"o\">&lt;</span><span class=\"kt\">u8</span><span class=\"o\">&gt;&gt;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">error</span><span class=\"o\">&gt;</span><span class=\"p\">;</span>\n\n<span class=\"w\">    </span><span class=\"n\">import</span><span class=\"w\"> </span><span class=\"n\">data</span><span class=\"o\">-</span><span class=\"n\">store</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p>I've been going around in circles with this for a few hours. Any help would be greatly appreciated.</p>\n<p>Thanks</p>",
        "id": 447122929,
        "sender_full_name": "Matt Andrews",
        "timestamp": 1719377345
    },
    {
        "content": "<p>I'd also add that the component does actually compile and a <code>wasm</code> file is created, but the error appears after compilation is finished and the component cant be compiled in the runtime.</p>",
        "id": 447128407,
        "sender_full_name": "Matt Andrews",
        "timestamp": 1719380185
    },
    {
        "content": "<p>the mention of wbindgen means that you are using some rust crate that detects \"wasm32-unknown-unknown\" and assumes that means wasm-bindgen wasm targeting browsers</p>",
        "id": 447193871,
        "sender_full_name": "Ramon Klass",
        "timestamp": 1719401792
    },
    {
        "content": "<p>ask cargo tree what depends on wasm-bindgen</p>",
        "id": 447193988,
        "sender_full_name": "Ramon Klass",
        "timestamp": 1719401829
    },
    {
        "content": "<p>(I hope my information is still up to date, wbindgen_placeholder seems unfamiliar but so far all wbindgen errors meant something depends on wasm-bindgen)</p>",
        "id": 447194364,
        "sender_full_name": "Ramon Klass",
        "timestamp": 1719401943
    },
    {
        "content": "<p>There's no dependency on <code>wasm-bindgen</code>. If I compile with the default <code>wasm32-wasi</code> i get this error when trying to run the component,</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">component</span><span class=\"w\"> </span><span class=\"n\">imports</span><span class=\"w\"> </span><span class=\"n\">instance</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">wasi</span><span class=\"p\">:</span><span class=\"nc\">cli</span><span class=\"o\">/</span><span class=\"n\">environment</span><span class=\"o\">@</span><span class=\"mf\">0.2.0</span><span class=\"err\">`</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">but</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">matching</span><span class=\"w\"> </span><span class=\"n\">implementation</span><span class=\"w\"> </span><span class=\"n\">was</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">found</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">linker</span>\n</code></pre></div>",
        "id": 447321994,
        "sender_full_name": "Matt Andrews",
        "timestamp": 1719432413
    },
    {
        "content": "<p>As Roman points out, the most likely cause is that one of your dependencies interprets the <code>wasm32-unknown-unknown</code> target to mean \"I'm running in a browser\" which is not what you want. Without seeing more about your project (e.g., Cargo.toml file), it's hard to say for sure where the issue is coming from.</p>",
        "id": 447467648,
        "sender_full_name": "Ryan Levick (rylev)",
        "timestamp": 1719491955
    }
]