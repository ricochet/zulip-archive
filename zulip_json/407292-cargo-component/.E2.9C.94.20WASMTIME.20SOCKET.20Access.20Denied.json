[
    {
        "content": "<p>Hello i created a component  to test socket  </p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"cp\">#[allow(warnings)]</span>\n<span class=\"k\">mod</span><span class=\"w\"> </span><span class=\"nn\">bindings</span><span class=\"p\">;</span>\n<span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">std</span><span class=\"p\">::{</span><span class=\"n\">fs</span><span class=\"p\">::</span><span class=\"n\">File</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">net</span><span class=\"p\">::{</span><span class=\"n\">IpAddr</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Ipv4Addr</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">SocketAddr</span><span class=\"p\">},</span><span class=\"w\"> </span><span class=\"n\">result</span><span class=\"p\">};</span>\n<span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">wasi</span><span class=\"p\">::</span><span class=\"n\">sockets</span><span class=\"p\">::{</span><span class=\"n\">network</span><span class=\"p\">::{</span><span class=\"n\">IpSocketAddress</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Ipv4SocketAddress</span><span class=\"p\">},</span><span class=\"w\"> </span><span class=\"n\">tcp</span><span class=\"p\">::</span><span class=\"n\">Network</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">tcp_create_socket</span><span class=\"p\">::</span><span class=\"n\">create_tcp_socket</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"p\">};</span>\n<span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">wasi</span><span class=\"p\">::</span><span class=\"n\">sockets</span><span class=\"p\">::</span><span class=\"n\">tcp</span><span class=\"p\">::</span><span class=\"n\">ErrorCode</span><span class=\"p\">;</span>\n\n<span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">bindings</span><span class=\"p\">::</span><span class=\"n\">Guest</span><span class=\"p\">;</span>\n\n<span class=\"k\">struct</span><span class=\"w\"> </span><span class=\"nc\">Component</span><span class=\"p\">;</span>\n\n<span class=\"k\">impl</span><span class=\"w\"> </span><span class=\"n\">Guest</span><span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"n\">Component</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"sd\">/// Say hello!</span>\n<span class=\"w\">    </span><span class=\"k\">fn</span><span class=\"w\"> </span><span class=\"nf\">create_tcp</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nb\">String</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">        </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"k\">mut</span><span class=\"w\"> </span><span class=\"n\">listener</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">create_tcp_socket</span><span class=\"p\">(</span><span class=\"n\">network</span><span class=\"p\">::</span><span class=\"n\">IpAddressFamily</span><span class=\"p\">::</span><span class=\"n\">Ipv4</span><span class=\"p\">).</span><span class=\"n\">unwrap</span><span class=\"p\">();</span>\n<span class=\"w\">        </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">socketaddress</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">IpSocketAddress</span><span class=\"p\">::</span><span class=\"n\">Ipv4</span><span class=\"p\">(</span><span class=\"n\">Ipv4SocketAddress</span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">port</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">9000</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">address</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"mi\">127</span><span class=\"p\">,</span><span class=\"mi\">0</span><span class=\"p\">,</span><span class=\"mi\">0</span><span class=\"p\">,</span><span class=\"mi\">1</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">});</span>\n<span class=\"w\">        </span><span class=\"n\">listener</span><span class=\"p\">.</span><span class=\"n\">start_bind</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"n\">instance_network</span><span class=\"p\">::</span><span class=\"n\">instance_network</span><span class=\"p\">(),</span><span class=\"w\"> </span><span class=\"n\">socketaddress</span><span class=\"p\">).</span><span class=\"n\">unwrap</span><span class=\"p\">();</span>\n<span class=\"w\">        </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">sub</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">listener</span><span class=\"p\">.</span><span class=\"n\">subscribe</span><span class=\"p\">();</span>\n<span class=\"w\">        </span><span class=\"k\">loop</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">            </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">listener</span><span class=\"p\">.</span><span class=\"n\">finish_bind</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">                </span><span class=\"nb\">Err</span><span class=\"p\">(</span><span class=\"n\">ErrorCode</span><span class=\"p\">::</span><span class=\"n\">WouldBlock</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">sub</span><span class=\"p\">.</span><span class=\"n\">block</span><span class=\"p\">(),</span>\n<span class=\"w\">                </span><span class=\"n\">_</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"fm\">panic!</span><span class=\"p\">(</span><span class=\"s\">\"failure\"</span><span class=\"p\">),</span>\n<span class=\"w\">            </span><span class=\"p\">}</span>\n<span class=\"w\">        </span><span class=\"p\">}</span>\n<span class=\"w\">        </span><span class=\"s\">\"Hello\"</span><span class=\"p\">.</span><span class=\"n\">to_string</span><span class=\"p\">()</span>\n<span class=\"w\">    </span><span class=\"p\">}</span>\n<span class=\"p\">}</span>\n\n<span class=\"n\">bindings</span><span class=\"p\">::</span><span class=\"n\">export</span><span class=\"o\">!</span><span class=\"p\">(</span><span class=\"n\">Component</span><span class=\"w\"> </span><span class=\"n\">with_types_in</span><span class=\"w\"> </span><span class=\"n\">bindings</span><span class=\"p\">);</span>\n</code></pre></div>\n<p>when i tried to run with command  <strong>wasmtime run target/wasm32-wasi/release/wasi_socket.wasm</strong><br>\nIt outputs error : </p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">thread</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"na\">main</span><span class=\"o\">'</span><span class=\"w\"> </span><span class=\"n\">panicked</span><span class=\"w\"> </span><span class=\"n\">at</span><span class=\"w\"> </span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">main</span><span class=\"p\">.</span><span class=\"n\">rs</span><span class=\"p\">:</span><span class=\"mi\">13</span><span class=\"p\">:</span><span class=\"mi\">79</span><span class=\"p\">:</span>\n<span class=\"nc\">called</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"nb\">Result</span><span class=\"p\">::</span><span class=\"n\">unwrap</span><span class=\"p\">()</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">on</span><span class=\"w\"> </span><span class=\"n\">an</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"nb\">Err</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">value</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">ErrorCode</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">code</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">name</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"access-denied\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">message</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">\"Access denied.</span><span class=\"se\">\\n\\n</span><span class=\"s\">            POSIX equivalent: EACCES, EPERM\"</span><span class=\"w\"> </span><span class=\"p\">}</span>\n<span class=\"n\">note</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">run</span><span class=\"w\"> </span><span class=\"n\">with</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">RUST_BACKTRACE</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">environment</span><span class=\"w\"> </span><span class=\"n\">variable</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">display</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">backtrace</span>\n<span class=\"n\">Error</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"w\"> </span><span class=\"n\">module</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">target</span><span class=\"o\">/</span><span class=\"n\">wasm32</span><span class=\"o\">-</span><span class=\"n\">wasi</span><span class=\"o\">/</span><span class=\"n\">release</span><span class=\"o\">/</span><span class=\"n\">wasi_socket</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"err\">`</span>\n</code></pre></div>",
        "id": 440856354,
        "sender_full_name": "Joshua Aruokhai",
        "timestamp": 1716816738
    },
    {
        "content": "<p>I believe this is from not enabling the WASI CLI world set of capabilities. Add the following to your wasmtime run: <code>-scli</code> <a href=\"https://github.com/bytecodealliance/wasmtime/blob/main/src%2Fcommands%2Fserve.rs\">https://github.com/bytecodealliance/wasmtime/blob/main/src%2Fcommands%2Fserve.rs</a></p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/bytecodealliance/wasmtime/blob/main/src%2Fcommands%2Fserve.rs\" style=\"background-image: url(&quot;https://uploads.zulipusercontent.net/b1c071149af8b700f160eaceb73f8b84491bf341/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f313665333636653336643765663935663830303431386664626137633632383061353637633036313763613833333964366534393565323363356430656636652f62797465636f6465616c6c69616e63652f7761736d74696d65&quot;)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/bytecodealliance/wasmtime/blob/main/src%2Fcommands%2Fserve.rs\" title=\"wasmtime/src/commands/serve.rs at main · bytecodealliance/wasmtime\">wasmtime/src/commands/serve.rs at main · bytecodealliance/wasmtime</a></div><div class=\"message_embed_description\">A fast and secure runtime for WebAssembly. Contribute to bytecodealliance/wasmtime development by creating an account on GitHub.</div></div></div>",
        "id": 441040586,
        "sender_full_name": "Bailey Hayes",
        "timestamp": 1716902887
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"421591\">Bailey Hayes</span> <a href=\"#narrow/stream/407292-cargo-component/topic/WASMTIME.20SOCKET.20Access.20Denied/near/441040586\">said</a>:</p>\n<blockquote>\n<p>I believe this is from not enabling the WASI CLI world set of capabilities. Add the following to your wasmtime run: <code>-scli</code> <a href=\"https://github.com/bytecodealliance/wasmtime/blob/main/src%2Fcommands%2Fserve.rs\">https://github.com/bytecodealliance/wasmtime/blob/main/src%2Fcommands%2Fserve.rs</a></p>\n</blockquote>\n<p>I tried your suggestion, it still outputted the same  error.</p>",
        "id": 441175468,
        "sender_full_name": "Joshua Aruokhai",
        "timestamp": 1716965228
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"723815\">Joshua Aruokhai</span> <a href=\"#narrow/stream/407292-cargo-component/topic/WASMTIME.20SOCKET.20Access.20Denied/near/441175468\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"421591\">Bailey Hayes</span> <a href=\"#narrow/stream/407292-cargo-component/topic/WASMTIME.20SOCKET.20Access.20Denied/near/441040586\">said</a>:</p>\n<blockquote>\n<p>I believe this is from not enabling the WASI CLI world set of capabilities. Add the following to your wasmtime run: <code>-scli</code> <a href=\"https://github.com/bytecodealliance/wasmtime/blob/main/src%2Fcommands%2Fserve.rs\">https://github.com/bytecodealliance/wasmtime/blob/main/src%2Fcommands%2Fserve.rs</a></p>\n</blockquote>\n<p>I tried your suggestion, it still outputted the same  error.</p>\n</blockquote>\n<p>In my opinion, i think something is wrong with this line of code <code>instance_network::instance_network()</code> .  When i also  tried to resolve ip from address  <code>ip_name_lookup::resolve_addresses(network, name)?;</code>, there was also an error specifically <strong>PermanentError</strong> .</p>",
        "id": 441179390,
        "sender_full_name": "Joshua Aruokhai",
        "timestamp": 1716966880
    },
    {
        "content": "<p>Hey <span class=\"user-mention\" data-user-id=\"723815\">@Joshua Aruokhai</span> , it looks like the Wasmtime environment you are using does not have access to host network, which is why you're getting the \"access denied\" (networking is not allowed in the sandbox you're using)</p>\n<p>Could you try to run your component with:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"n\">cli</span><span class=\"o\">=</span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"n\">inherit</span><span class=\"o\">-</span><span class=\"n\">network</span><span class=\"o\">=</span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">component</span><span class=\"p\">.</span><span class=\"n\">wasm</span>\n</code></pre></div>\n<p>You can see most of the flags documented via:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">wasmtime</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">S</span><span class=\"w\"> </span><span class=\"n\">help</span><span class=\"o\">-</span><span class=\"n\">long</span>\n</code></pre></div>",
        "id": 441236577,
        "sender_full_name": "Roman Volosatovs",
        "timestamp": 1716987900
    },
    {
        "content": "<p>Thanks a lot, this actually worked, I tried it before, maybe I did something wrong.</p>",
        "id": 441386352,
        "sender_full_name": "Joshua Aruokhai",
        "timestamp": 1717048629
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"234973\">Till Schneidereit</span> has marked this topic as resolved.</p>",
        "id": 444693906,
        "sender_full_name": "Notification Bot",
        "timestamp": 1718369556
    }
]