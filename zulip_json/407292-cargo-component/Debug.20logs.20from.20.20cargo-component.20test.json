[
    {
        "content": "<p>I have some tests run via cargo-component that are failing. I would like to use the combination of the <code>RUST_LOG=wasi_common=trace</code> env variable and the <code>-D log-to-files</code> flag to get more in depth logs as to why. <a href=\"https://github.com/bytecodealliance/cargo-component/blob/920dbdc8cec4a06c5bcd04f64d3d9a5fc3f09896/src/lib.rs#L276-L280\">This comment</a> in the cargo-component code seems to suggest that I can pass additional arguments to the wasmtime test runner, but I can't quite seem to figure that out. </p>\n<p>This doesn't seem to be working, and even the env var doesn't seem to be picked up as I am still getting the minimum error:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">RUST_LOG</span><span class=\"o\">=</span><span class=\"n\">wasi_common</span><span class=\"o\">=</span><span class=\"n\">trace</span><span class=\"w\"> </span><span class=\"n\">cargo</span><span class=\"w\"> </span><span class=\"n\">component</span><span class=\"w\"> </span><span class=\"n\">test</span><span class=\"w\"> </span><span class=\"n\">s3_upload_bytes</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">manifest</span><span class=\"o\">-</span><span class=\"n\">path</span><span class=\"w\"> </span><span class=\"p\">.</span><span class=\"o\">/</span><span class=\"n\">packages</span><span class=\"o\">/</span><span class=\"n\">components</span><span class=\"o\">/</span><span class=\"n\">runtime</span><span class=\"o\">/</span><span class=\"n\">Cargo</span><span class=\"p\">.</span><span class=\"n\">toml</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">no</span><span class=\"o\">-</span><span class=\"n\">capture</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">D</span><span class=\"w\"> </span><span class=\"n\">log</span><span class=\"o\">-</span><span class=\"n\">to</span><span class=\"o\">-</span><span class=\"n\">files</span>\n\n<span class=\"o\">..</span><span class=\"p\">.</span>\n\n<span class=\"n\">Error</span>: <span class=\"nc\">failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">run</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"w\"> </span><span class=\"n\">module</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"o\">/</span><span class=\"n\">Volumes</span><span class=\"o\">/</span><span class=\"n\">workplace</span><span class=\"o\">/</span><span class=\"n\">my</span><span class=\"o\">-</span><span class=\"n\">project</span><span class=\"o\">/</span><span class=\"n\">target</span><span class=\"o\">/</span><span class=\"n\">wasm32</span><span class=\"o\">-</span><span class=\"n\">wasi</span><span class=\"o\">/</span><span class=\"n\">debug</span><span class=\"o\">/</span><span class=\"n\">deps</span><span class=\"o\">/</span><span class=\"n\">my_project</span><span class=\"o\">-</span><span class=\"n\">cd29621f97f814b3</span><span class=\"p\">.</span><span class=\"n\">wasm</span><span class=\"err\">`</span>\n\n<span class=\"n\">Caused</span><span class=\"w\"> </span><span class=\"n\">by</span>:\n    <span class=\"mi\">0</span>: <span class=\"nc\">import</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">wasi</span>:<span class=\"nc\">http</span><span class=\"o\">/</span><span class=\"n\">types</span><span class=\"o\">@</span><span class=\"mf\">0.2.0</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">has</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">wrong</span><span class=\"w\"> </span><span class=\"k\">type</span>\n    <span class=\"mi\">1</span>: <span class=\"nc\">instance</span><span class=\"w\"> </span><span class=\"n\">export</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">fields</span><span class=\"err\">`</span><span class=\"w\"> </span><span class=\"n\">has</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">wrong</span><span class=\"w\"> </span><span class=\"k\">type</span>\n    <span class=\"mi\">2</span>: <span class=\"nc\">expected</span><span class=\"w\"> </span><span class=\"n\">resource</span><span class=\"w\"> </span><span class=\"n\">found</span><span class=\"w\"> </span><span class=\"n\">nothing</span>\n</code></pre></div>\n<p>I think it is likely that the error is also related to not being able to pass in extra arguments since it seems to be caused by the lack of <code>-S http</code></p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/bytecodealliance/cargo-component/blob/920dbdc8cec4a06c5bcd04f64d3d9a5fc3f09896/src/lib.rs#L276-L280\" style=\"background-image: url(https\\:\\/\\/uploads\\.zulipusercontent\\.net\\/772bba55a19acbbd2182330a534b0821649ecdaf\\/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f383833383366393635383837313937636534303934346438346363343135356331656339383361323163663538393334373738306531653165666464663738322f62797465636f6465616c6c69616e63652f636172676f2d636f6d706f6e656e74)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/bytecodealliance/cargo-component/blob/920dbdc8cec4a06c5bcd04f64d3d9a5fc3f09896/src/lib.rs#L276-L280\" title=\"cargo-component/src/lib.rs at 920dbdc8cec4a06c5bcd04f64d3d9a5fc3f09896 · bytecodealliance/cargo-component\">cargo-component/src/lib.rs at 920dbdc8cec4a06c5bcd04f64d3d9a5fc3f09896 · bytecodealliance/cargo-component</a></div><div class=\"message_embed_description\">A Cargo subcommand for creating WebAssembly components based on the component model proposal. - bytecodealliance/cargo-component</div></div></div>",
        "id": 435075686,
        "sender_full_name": "Landon James",
        "timestamp": 1713910363
    },
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"678052\">@Landon James</span>, sorry for the late reply as I've been away until this week and now have started a new position with a huge ramp-up, so it's consuming my time considerably.</p>\n<p>You can find an example of using a custom runner in this issue: <a href=\"https://github.com/bytecodealliance/cargo-component/issues/276\">https://github.com/bytecodealliance/cargo-component/issues/276</a></p>\n<p>Effectively, you can set <code>CARGO_TARGET_WASM32_WASI_RUNNER</code> to <code>wasmtime</code> with any options / commands you want and <code>cargo-component</code> will automatically spawn it with the build artifact passed as an argument</p>\n<div class=\"message_embed\"><a class=\"message_embed_image\" href=\"https://github.com/bytecodealliance/cargo-component/issues/276\" style=\"background-image: url(&quot;https://uploads.zulipusercontent.net/767550260aa411d27e98dda69e76e5e1ba8f0d59/68747470733a2f2f6f70656e67726170682e6769746875626173736574732e636f6d2f356365353561326461373031333862346463653635343864633338303261323239653535633761303532346539653965393564646462313733653965333834302f62797465636f6465616c6c69616e63652f636172676f2d636f6d706f6e656e742f6973737565732f323736&quot;)\"></a><div class=\"data-container\"><div class=\"message_embed_title\"><a href=\"https://github.com/bytecodealliance/cargo-component/issues/276\" title=\"Add a `cargo component serve` subcommand that uses a default runner of `wasmtime serve` · Issue #276 · bytecodealliance/cargo-component\">Add a `cargo component serve` subcommand that uses a default runner of `wasmtime serve` · Issue #276 · bytecodealliance/cargo-component</a></div><div class=\"message_embed_description\">This would make running wasi:http components easier. Currently users have to set CARGO_TARGET_WASM32_WASI_RUNNER environment variable to get it to work: CARGO_TARGET_WASM32_WASI_RUNNER=\"wasmtime se...</div></div></div>",
        "id": 436377517,
        "sender_full_name": "Peter Huene",
        "timestamp": 1714525515
    },
    {
        "content": "<p>it's also possible to do the same with a <code>.config/cargo.toml</code> file by setting <code>target.wasm32-wasi.runner</code> (as documented <a href=\"https://doc.rust-lang.org/cargo/reference/config.html\">here</a></p>",
        "id": 436377674,
        "sender_full_name": "Peter Huene",
        "timestamp": 1714525621
    }
]